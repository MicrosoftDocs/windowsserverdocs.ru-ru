---
title: Общие сведения о совместном использовании файлов с помощью протокола SMB 3 в Windows Server
description: Общие сведения об использовании протокола SMB 3 для общих папок и файлов в Windows Server.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 01/10/2020
ms.localizationpriority: medium
ms.openlocfilehash: aafcfcd4d0f2f14836c5b7dee2bdbccbf99fa887
ms.sourcegitcommit: 9687d3eb221b89061a48bf1e73fb3b25bee69f9a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/28/2020
ms.locfileid: "78169624"
---
# <a name="overview-of-file-sharing-using-the-smb-3-protocol-in-windows-server"></a>Общие сведения о совместном использовании файлов с помощью протокола SMB 3 в Windows Server

>Применяется к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этой статье описывается функция SMB 3 в Windows Server 2019, Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012, а также практическое применение совершенно новой или обновленной функциональной возможности этой версии по сравнению с предыдущими, а также требования к оборудованию. SMB также является протоколом структуры для решений [программно-определяемого центра обработки данных (SDDC)](../../sddc.md), например для Локальных дисковых пространств, реплик хранилища и др. SMB версии 3.0 появился в Windows Server 2012 и постепенно улучшался в последующих выпусках.

## <a name="feature-description"></a>Описание компонента

Протокол SMB — это сетевой протокол для общего доступа к файлам, который позволяет приложениям компьютера читать и записывать файлы, а также запрашивать службы серверных программ в компьютерной сети. Протокол SMB может использоваться поверх протокола TCP/IP или других сетевых протоколов. С помощью протокола SMB приложение (или использующий его пользователь) может получать доступ к файлам и другим ресурсам удаленного сервера. Это позволяет приложениям читать, создавать и обновлять файлы на удаленном сервере. SMB может также обмениваться данными с любой серверной программой, которая настроена на получение клиентских запросов SMB. SMB — это протокол структуры, который используется вычислительными технологиями программно-определяемых центров обработки данных (SDDC), такими как Локальные дисковые пространства и реплики хранилища. Дополнительные сведения см. в статье [Windows Server software-defined datacenter](../../sddc.md) (Программно-определяемый центр обработки данных Windows Server).

## <a name="practical-applications"></a>Практическое применение

В этом подразделе описан ряд способов использования нового протокола SMB 3.0.

* **Хранилище файлов для виртуализации (Hyper-V™ через SMB)** . С помощью протокола SMB 3.0 Hyper-V может хранить в файловых ресурсах общего доступа файлы виртуального компьютера, например файлы конфигурации, файлы виртуального жесткого диска (VHD) и снимки. Этот способ может использоваться как для изолированных файловых серверов, так и для кластерных файловых серверов, которые используют Hyper-V вместе с общедоступным хранилищем файлов для кластера.
* **Microsoft SQL Server через SMB**. SQL Server может хранить файлы базы данных пользователей в файловых ресурсах SMB. Сейчас эта возможность поддерживается SQL Server 2008 R2 для изолированных серверов SQL. В будущих версиях SQL Server будет добавлена поддержка кластерных серверов SQL и системных баз данных.
* **Традиционное хранение данных пользователя**. Протокол SMB 3.0 предоставляет дополнительные возможности для рабочих нагрузок клиентов или сотрудников, работающих с информацией. Эти возможности включают сокращение задержек приложений при получении пользователями филиала доступа к данным через глобальную сеть и защиту данных от перехвата злоумышленниками.

## <a name="new-and-changed-functionality"></a>Новые и измененные функции

В следующих разделах описываются функциональные возможности, добавленные в SMB 3, и последующие обновления.

## <a name="features-added-in-windows-server-2019-and-windows-10-version-1809"></a>Функции, добавленные в Windows Server 2019 и Windows 10 версии 1809

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Возможность требовать сквозную запись на диск в общих папках, которые не постоянно доступны | Создать | Чтобы гарантировать запись в общую папку через стек программного и аппаратного обеспечения на физический диск до получения сообщения о завершении операции записи, можно включить сквозную запись в общую папку с помощью команды `NET USE /WRITETHROUGH` или командлета PowerShell `New-SMBMapping -UseWriteThrough`. При использовании сквозной записи возникает небольшое уменьшение производительности. Дополнительные сведения см. в записи блога [Controlling write-through behaviors in SMB](https://techcommunity.microsoft.com/t5/storage-at-microsoft/controlling-write-through-behaviors-in-smb/bc-p/1083417#M677) (Управление поведением сквозной записи в SMB). |

## <a name="features-added-in-windows-server-version-1709-and-windows-10-version-1709"></a>Функции, добавленные в Windows Server версии 1709 и Windows 10 версии 1709

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Гостевой доступ к общим папкам отключен | Создать | Клиент SMB больше не разрешает следующие действия: доступ учетной записи гостя к удаленному серверу; откат к учетной записи гостя после ввода недопустимых учетных данных. Дополнительные сведения см. в статье [Гостевой доступ в SMB2 отключен по умолчанию в Windows](https://support.microsoft.com/help/4046019/guest-access-in-smb2-disabled-by-default-in-windows-10-and-windows-ser). | 
| Глобальное сопоставление SMB | Создать | Сопоставляет удаленную общую папку SMB с буквой диска, доступного всем пользователям на локальном узле, включая контейнеры. Это необходимо, чтобы включить операции ввода-вывода для контейнера в томе данных для прохода через удаленную точку подключения. Учтите, что при использовании глобального сопоставления SMB для контейнеров всем пользователям на узле контейнера предоставляется доступ к удаленной общей папке. Все приложения, работающие на узле контейнера, также получат доступ к сопоставленной удаленной общей папке. Дополнительные сведения см. в статье [Container Storage Support with Cluster Shared Volumes (CSV), Storage Spaces Direct, SMB Global Mapping](https://techcommunity.microsoft.com/t5/failover-clustering/container-storage-support-with-cluster-shared-volumes-csv/ba-p/372140) (Поддержка контейнера хранилища с общими томами кластера (CSV), Локальными дисковыми пространствами и глобальным сопоставлением SMB). |
| Управление диалектом SMB | Создать | Теперь можно задать значения реестра, чтобы управлять минимальной (диалектом) и максимальной версией SMB. Дополнительные сведения см. в статье [Controlling SMB Dialects](https://techcommunity.microsoft.com/t5/storage-at-microsoft/controlling-smb-dialects/ba-p/860024) (Управление диалектами SMB). |

## <a name="features-added-in-smb-311-with-windows-server-2016-and-windows-10-version-1607"></a>Функции, добавленные в SMB 3.11 с Windows Server 2016 и Windows 10 версии 1607

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Шифрование SMB     |   Обновлено      | Шифрование SMB 3.1.1 в режиме AES-GCM выполняется быстрее, чем подписывание SMB или шифрование SMB предыдущей версии с использованием AES-CCM.   |
| Кэширование каталогов | Создать | SMB 3.1.1 включает дополнительные возможности для кэширования каталогов. Клиенты Windows теперь могут кэшировать каталоги гораздо большего размера (приблизительно с 500 000 записей). Клиенты Windows могут выполнять запросы к каталогу, используя буферы размером в 1 МБ, чтобы сократить круговые пути и увеличить производительность. |
| Целостность предварительной проверки подлинности | Создать |  В SMB 3.1.1 целостность предварительной проверки подлинности обеспечивает улучшенную защиту от атак типа "злоумышленник в середине", при которых несанкционировано изменяются подключения SMB и сообщения проверки подлинности. Дополнительные сведения см. в статье [SMB 3.1.1 Pre-authentication integrity in Windows 10](https://docs.microsoft.com/archive/blogs/openspecification/smb-3-1-1-pre-authentication-integrity-in-windows-10) (Целостность предварительной проверки подлинности с SMB 3.1.1 в Windows 10). |
| Улучшения в шифровании SMB | Создать | SMB 3.1.1 предоставляет механизм для согласования алгоритма шифрования при каждом соединении с вариантами для AES-128-CCM и AES-128-GCM. AES-128-GCM используется по умолчанию для новых версий Windows, в то время как для более старых версий продолжается использование AES-128-CCM. |
| Поддержка последовательного обновления кластера | Создать | Позволяет [последовательно обновлять кластер](../../failover-clustering/cluster-operating-system-rolling-upgrade.md), используя SMB для поддержки различных максимальных версий SMB для кластеров в процессе обновления. Дополнительные сведения об обмене данными SMB с помощью различных версий (диалектов) протокола см. в статье [Controlling SMB Dialects](https://techcommunity.microsoft.com/t5/storage-at-microsoft/controlling-smb-dialects/ba-p/860024) (Управление диалектами SMB). |
| Поддержка клиентов SMB Direct в Windows 10 | Создать | Windows 10 Корпоративная, Windows 10 для образовательных учреждений и Windows 10 Pro для рабочих станций теперь предусматривают поддержку клиентов SMB Direct. |
| Встроенная поддержка вызовов API FileNormalizedNameInformation | Создать | Добавлена встроенная поддержка для запросов нормализованного имени файла. Дополнительные сведения см. в статье о [FileNormalizedNameInformation](https://docs.microsoft.com/openspecs/windows_protocols/ms-fscc/20bcadba-808c-4880-b757-4af93e41edf6). |

Дополнительные сведения см. в статье [What’s new in SMB 3.1.1 in the Windows Server 2016 Technical Preview 2](https://docs.microsoft.com/archive/blogs/josebda/whats-new-in-smb-3-1-1-in-the-windows-server-2016-technical-preview-2) (Новые возможности SMB 3.1.1 в Windows Server 2016 (техническая версия 2)).

## <a name="features-added-in-smb-302-with-windows-server-2012-r2-and-windows-81"></a>Возможности, добавленные в SMB 3.02 с Windows Server 2012 R2 и Windows 8.1

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Автоматическая повторная балансировка клиентов масштабируемого файлового сервера     |   Создать      | Увеличивает масштабируемость и управляемость масштабируемых файловых серверов. Клиентские подключения SMB отслеживаются для каждого общего файлового ресурса (а не для каждого сервера), после чего клиенты перенаправляются в узел кластера с оптимальным доступом к тому, используемому общим файловым ресурсом. Это повышает производительность, снижая трафик перенаправления между узлами файлового сервера. Клиенты перенаправляются после начального подключения при перенастройке системы хранения данных кластера.    |
| Производительность в глобальной сети   | Обновлено  | В Windows 8.1 и Windows 10 улучшена работа CopyFile SRV_COPYCHUNK благодаря поддержке SMB при использовании проводника для удаленного копирования из одного расположения на удаленном компьютере в другую копию на том же сервере. Вы скопируете только небольшой объем метаданных через сеть (передается 1/2 КиБ на 16 МиБ данных файла). Это приводит к значительному увеличению производительности. Для SMB — это различие на уровне операционной системы и проводника. |
| SMB Direct     |   Обновлено      | Улучшает производительность нагрузок малого ввода-вывода, повышая эффективность при размещении нагрузок с малыми вводами-выводами (например, база данных оперативной обработки транзакций (OLTP) в виртуальной машине). Эти улучшения заметны при использовании более быстрых сетевых интерфейсов, таких как Ethernet 40 Гбит/с и InfiniBand 56 Гбит/с.  |
| Ограничения пропускной способности SMB | Создать | Теперь можно использовать [Set-SmbBandwidthLimit](https://docs.microsoft.com/powershell/module/smbshare/set-smbbandwidthlimit), чтобы задать ограничения пропускной способности в трех категориях: VirtualMachine (трафик Hyper-V по протоколу SMB), LiveMigration (трафик динамической миграции Hyper-V по протоколу SMB) или по умолчанию (все остальные типы трафика SMB).

Дополнительные сведения о новых и измененных функциях SMB в Windows Server 2012 R2 см. в статье [What's New in SMB in Windows Server](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831474(v%3dws.11)>) (Новые возможности SMB в Windows Server).

## <a name="features-added-in-smb-30-with-windows-server-2012-and-windows-8"></a>Функции, добавленные в SMB 3.0 с Windows Server 2012 и Windows 8

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Прозрачная отказоустойчивость SMB     |   Создать    | Позволяет администраторам обслуживать аппаратное и программное обеспечение узлов кластерного файлового сервера, не прерывая работу приложений сервера, хранящих данные в этих файловых ресурсах. Кроме того, при сбое оборудования или программного обеспечения в узле кластера клиенты SMB подключатся к другому узлу кластера, не прерывая работу приложений сервера, хранящих данные в этих файловых ресурсах.        |
| Масштабирование SMB     |   Создать      | Поддержка нескольких экземпляров SMB на масштабируемом файловом сервере. С помощью версии 2 общих томов кластера (CSV) администраторы могут создавать файловые ресурсы, предоставляющие одновременный доступ к файлам данных с прямыми операциями ввода-вывода через все узлы кластера файлового сервера. Это улучшает использование пропускной способности сети и балансировку нагрузки клиентов файлового сервера, а также оптимизирует производительность серверных приложений.  |
| Технология SMB Multichannel     |   Создать      |  Обеспечивает агрегирование пропускной способности и отказоустойчивости сети, если доступно несколько путей между клиентом SMB и сервером. Это позволяет приложениям сервера использовать всю доступную пропускную способность сети и быть устойчивыми к сетевым сбоям.<br><br>SMB Multichannel в SMB 3 вносит значительные улучшения в производительность по сравнению с предыдущими версиями SMB. |
| SMB Direct     |   Создать      | Поддерживает использование сетевых адаптеров, которые поддерживают RDMA и могут работать на полной скорости с очень низкой задержкой, используя очень малую часть ЦП. При использовании этой функции для таких рабочих нагрузок, как Hyper-V и Microsoft SQL Server, работа с удаленным файловым сервером будет похожа на работу с локальным хранилищем.<br><br>SMB Direct в SMB 3 вносит значительные улучшения в производительность по сравнению с предыдущими версиями SMB.  |
| Счетчики производительности для серверных приложений     |   Создать      |  Новые счетчики производительности SMB предоставляют подробную информацию о пропускной способности, задержке и числе операций ввода-вывода в секунду для каждой общей папки, что позволяет администраторам анализировать производительность общих папок SMB, в которых они хранят данные. Эти счетчики разработаны специально для серверных приложений, таких как Hyper-V и SQL Server, которые хранят файлы в удаленных файловых ресурсах.      |
| Оптимизация производительности    |  Обновлено   | Клиент SMB и сервер оптимизированы с целью уменьшения числа случайных операций ввода-вывода для чтения и записи, которые часто происходят в таких серверных приложениях, как SQL Server OLTP (оперативная обработка транзакций). Помимо этого, большое значение для наибольшего размера передаваемых данных (MTU) теперь включено по умолчанию, что значительно повышает производительность больших последовательных передач, таких как работа с хранилищем данных SQL Server, архивация и восстановление базы данных, развертывание и копирование виртуальных жестких дисков. |
| Командлеты Windows PowerShell для SMB     |   Создать      |  С помощью командлетов Windows PowerShell для SMB администраторы могут полностью управлять файловыми ресурсами файлового сервера из командной строки.   |
| Шифрование SMB     |   Создать      | Обеспечивает непрерывное шифрование данных SMB и защищает их от перехвата в недоверенных сетях. Не нуждается в новых затратах на развертывание, протоколе IPsec, специализированном оборудовании и ускорителях WAN. Шифрование SMB может быть настроено для отдельных ресурсов или всего файлового сервера и может быть включено для ряда сценариев, при которых данные проходят через недоверенные сети. |
| Аренда каталогов SMB     |  Создать | Сокращает время ответа приложений в филиалах При использовании аренды каталогов число передач пакетов от клиента к серверу и обратно сокращается, так как метаданные извлекаются из кэша каталога с большим временем хранения. Обеспечивается согласованность кэша, так как клиенты извещаются об изменениях информации о каталоге на сервере. Аренда каталогов работает со сценариями для HomeFolder (Домашняя папка: чтение и запись без общего доступа) и Публикации (только для чтения с общим доступом).    |
| Производительность в глобальной сети   | Создать   | С SMB 3.0 теперь доступны уступающие блокировки каталогов и аренда уступающих блокировок. Для типичных рабочих нагрузок типа "офис — клиент" уступающие блокировки и аренда показаны для уменьшения кругового пути по сети примерно на 15 %.<br><br>В SMB 3 реализация SMB в Windows изменена для улучшения поведения кэширования на клиенте, а также увеличения пропускной способности.<br><br>SMB 3 предусматривает улучшения для API CopyFile (), а также для связанных инструментов, таких как Robocopy, позволяя отправлять значительно больше данных через сеть. |
| Безопасное согласование диалектов | Создать | Помогает защититься от атак типа "злоумышленник в середине", которые могут понизить уровень согласования диалектов. Идея состоит в том, чтобы не допустить понижение злоумышленником уровня изначально согласованного диалекта и возможностей между клиентом и сервером. Дополнительные сведения см. в статье [SMB3 Secure Dialect Negotiation](https://docs.microsoft.com/archive/blogs/openspecification/smb3-secure-dialect-negotiation) (Согласование безопасного диалекта SMB 3). Обратите внимание, что эта функция заменена на функцию обеспечения [целостности предварительной проверки подлинности SMB 3.1.1 в Windows 10](https://docs.microsoft.com/archive/blogs/openspecification/smb-3-1-1-pre-authentication-integrity-in-windows-10). |


## <a name="hardware-requirements"></a>Требования к оборудованию

Для обеспечения прозрачной отказоустойчивости SMB необходимо соблюдать следующие требования.

* Отказоустойчивый кластер под управлением Windows Server 2012 или Windows Server 2016 по крайней мере с двумя настроенными узлами. Кластер должен пройти проверочный тест для кластеров, входящий в состав мастера проверки.
* Файловые ресурсы должны быть созданы со свойством "Постоянная доступность" (CA), что является настройкой по умолчанию.
* Файловые ресурсы нужно создавать на путях к тому CSV, чтобы обеспечить масштабирование SMB.
* Клиентские компьютеры должны работать под управлением Windows® 8 или Windows Server 2012, которые содержат обновленный клиент SMB, поддерживающий постоянную доступность.

> [!NOTE]
> Клиенты нижнего уровня могут подключаться к общим папкам со свойством "Постоянная доступность", но для таких клиентов прозрачная отказоустойчивость не поддерживается.

Для поддержки многоканальности SMB необходимо соблюдать следующие требования.

* Требуются по меньшей мере два компьютера под управлением Windows Server 2012. Установки дополнительных компонентов не требуется — эта технология включена по умолчанию.
* Сведения о рекомендуемых сетевых настройках см. в подразделе "Дополнительные сведения" в конце этого раздела.

Для поддержки прямой технологии SMB необходимо соблюдать следующие требования.

* Требуются по меньшей мере два компьютера под управлением Windows Server 2012. Установки дополнительных компонентов не требуется — эта технология включена по умолчанию.
* Сетевые адаптеры с поддержкой RDMA. На данный момент существует три типа таких адаптеров: iWARP, Infiniband и RoCE (RDMA over Converged Ethernet).

## <a name="more-information"></a>Дополнительные сведения

Следующий список содержит дополнительные ресурсы со сведениями о работе в сети по протоколу SMB и связанным технологиям в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.

* [Хранилище в Windows Server](../storage.md)
* [Scale-Out File Server for Application Data](../../failover-clustering/sofs-overview.md) (Масштабируемый файловый сервер для данных приложений)
* [Увеличение производительности файлового сервера с помощью SMB Direct](smb-direct.md)
* [Deploy Hyper-V over SMB](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134187(v%3dws.11)>) (Развертывание Hyper-V поверх SMB)
* [Deploy SMB Multichannel](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn610980(v%3dws.11)>) (Развертывание SMB Multichannel)
* [Deploying Fast and Efficient File Servers for Server Applications](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831723(v%3dws.11)>) (Развертывание быстрых и производительных файловых серверов для серверных приложений)
* [SMB: Troubleshooting Guide](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn659439(v%3dws.11)>) (Руководство по устранению проблем: SMB)
