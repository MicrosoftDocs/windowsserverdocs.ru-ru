---
title: Общие сведения о совместном использовании файлов с помощью протокола SMB 3 в Windows Server
description: Общие сведения об использовании протокола SMB 3 для файловых ресурсов и файлов, обслуживающих Windows Server.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 01/10/2020
ms.localizationpriority: medium
ms.openlocfilehash: 416145a8c4ec20eaf46cf4b5ac88a0cdf38bdf33
ms.sourcegitcommit: 76469d1b7465800315eaca3e0c7f0438fc3939ed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/13/2020
ms.locfileid: "75919888"
---
# <a name="overview-of-file-sharing-using-the-smb-3-protocol-in-windows-server"></a>Общие сведения о совместном использовании файлов с помощью протокола SMB 3 в Windows Server

>Область применения: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описывается функция SMB 3 в Windows Server 2019, Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012 — практические применения функции, наиболее существенных новых или обновленных функциональных возможностей в этой версии по сравнению с предыдущими версиями. требования к оборудованию. SMB также является протоколом структуры, используемым [программно-определенными решениями центра обработки данных (SDDC)](../../sddc.md) , такими как локальные дисковые пространства, Реплика хранилища и другие. SMB версии 3,0 была представлена в Windows Server 2012 и постепенно улучшилась в последующих выпусках.

## <a name="feature-description"></a>Описание компонента

Протокол SMB — это сетевой протокол для общего доступа к файлам, который позволяет приложениям компьютера читать и записывать файлы, а также запрашивать службы серверных программ в компьютерной сети. Протокол SMB может использоваться поверх протокола TCP/IP или других сетевых протоколов. С помощью протокола SMB приложение (или использующий его пользователь) может получать доступ к файлам и другим ресурсам удаленного сервера. Это позволяет приложениям читать, создавать и обновлять файлы на удаленном сервере. SMB также может взаимодействовать с любой серверной программой, настроенной на получение запроса SMB-клиента. SMB — это протокол структуры, который используется вычислительными технологиями центра обработки данных (SDDC), такими как Локальные дисковые пространства, Реплика хранилища. Дополнительные сведения см. в разделе [Windows Server Software-Defined Datacenter](../../sddc.md).

## <a name="practical-applications"></a>Практическое применение

В этом подразделе описан ряд способов использования нового протокола SMB 3.0.

* **Хранилище файлов для виртуализации (Hyper-V™ через SMB)** . С помощью протокола SMB 3.0 Hyper-V может хранить в файловых ресурсах общего доступа файлы виртуального компьютера, например файлы конфигурации, файлы виртуального жесткого диска (VHD) и снимки. Этот способ может использоваться как для изолированных файловых серверов, так и для кластерных файловых серверов, которые используют Hyper-V вместе с общедоступным хранилищем файлов для кластера.
* **Microsoft SQL Server через SMB**. SQL Server может хранить файлы базы данных пользователей в файловых ресурсах SMB. Сейчас эта возможность поддерживается SQL Server 2008 R2 для изолированных серверов SQL. В будущих версиях SQL Server будет добавлена поддержка кластерных серверов SQL и системных баз данных.
* **Традиционное хранение данных пользователя**. Протокол SMB 3.0 предоставляет дополнительные возможности для рабочих нагрузок клиентов или сотрудников, работающих с информацией. Эти возможности включают сокращение задержек приложений при получении пользователями филиала доступа к данным через глобальную сеть и защиту данных от перехвата злоумышленниками.

## <a name="new-and-changed-functionality"></a>Новые и измененные функции

В следующих разделах описываются функциональные возможности, добавленные в SMB 3 и последующие обновления.

## <a name="features-added-in-windows-server-2019-and-windows-10-version-1809"></a>Функции, добавленные в Windows Server 2019 и Windows 10, версия 1809

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Возможность требовать сквозной записи на диск в общих файловых ресурсах, которые не постоянно доступны | Новая | Чтобы предоставить некоторую гарантию, что запись в файловый ресурс делает все таким образом через стек программного обеспечения и оборудования на физический диск до завершения операции записи, можно включить сквозную запись в файловый ресурс с помощью команды `NET USE /WRITETHROUGH` или командлета `New-SMBMapping -UseWriteThrough` PowerShell. При использовании сквозной записи возникает некоторый объем производительности. Дополнительные сведения см. в записи блога [Управление поведением записи в SMB](https://techcommunity.microsoft.com/t5/storage-at-microsoft/controlling-write-through-behaviors-in-smb/bc-p/1083417#M677) . |

## <a name="features-added-in-windows-server-version-1709-and-windows-10-version-1709"></a>Функции, добавленные в Windows Server, версии 1709 и Windows 10, версия 1709

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Гостевой доступ к общим папкам отключен | Новая | Клиент SMB больше не разрешает выполнять следующие действия: Гостевая учетная запись имеет доступ к удаленному серверу; Откат к гостевой учетной записи после ввода недопустимых учетных данных. Дополнительные сведения см. в разделе [гостевой доступ в SMB2 отключен по умолчанию в Windows](https://support.microsoft.com/help/4046019/guest-access-in-smb2-disabled-by-default-in-windows-10-and-windows-ser). | 
| Глобальное сопоставление SMB | Новая | Сопоставляет удаленный общий ресурс SMB с буквой диска, доступной всем пользователям на локальном узле, включая контейнеры. Это необходимо, чтобы включить операции ввода-вывода контейнера на томе данных для прохода по удаленной точке подключения. Имейте в виду, что при использовании глобального сопоставления SMB для контейнеров все пользователи на узле контейнера могут получить доступ к удаленной общей папке. Любое приложение, выполняющееся на узле контейнера, также имеет доступ к сопоставленной удаленной общей папке. Дополнительные сведения см. в разделе [Поддержка хранилища контейнеров с общими томами кластера (CSV), Локальные дисковые пространства, глобальном сопоставлении SMB](https://techcommunity.microsoft.com/t5/failover-clustering/container-storage-support-with-cluster-shared-volumes-csv/ba-p/372140). |
| Элемент управления "диалект SMB" | Новая | Теперь можно задать значения реестра, чтобы управлять минимальной версией SMB (диалектом) и максимальной используемой версией SMB. Дополнительные сведения см. в разделе [Управление диалектами SMB](https://techcommunity.microsoft.com/t5/storage-at-microsoft/controlling-smb-dialects/ba-p/860024). |

## <a name="features-added-in-smb-311-with-windows-server-2016-and-windows-10-version-1607"></a>Функции, добавленные в SMB 3,11 с Windows Server 2016 и Windows 10, версия 1607

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Шифрование SMB     |   Обновлено      | Шифрование SMB 3.1.1 с режимом AES-Галоис/Counter (AES-GCM) выполняется быстрее, чем подписывание SMB или предыдущее шифрование SMB с использованием AES-CCM.   |
| Кэширование каталога | Новая | SMB 3.1.1 включает улучшения в кэширование каталога. Клиенты Windows теперь могут кэшировать гораздо большие каталоги, приблизительно 500 тыс записи. Клиенты Windows будут пытаться выполнять запросы к каталогу с использованием буферов размером в 1 МБ, чтобы сократить круговые поездки и повысить производительность. |
| Целостность предварительной проверки подлинности | Новая |  В SMB 3.1.1 целостность предварительной проверки подлинности обеспечивает улучшенную защиту от атаки "злоумышленник в середине", изменяя подключение к протоколу SMB и сообщения проверки подлинности. Дополнительные сведения см. [в статье Проверка целостности предварительной проверки подлинности SMB 3.1.1 в Windows 10](https://docs.microsoft.com/archive/blogs/openspecification/smb-3-1-1-pre-authentication-integrity-in-windows-10). |
| Усовершенствования шифрования SMB | Новая | SMB 3.1.1 предлагает механизм для согласования алгоритма шифрования на каждом соединении с параметрами AES-128-CCM и AES-128-GCM. AES-128-GCM — это значение по умолчанию для новых версий Windows, в то время как более старые версии продолжат использовать AES-128-CCM. |
| Поддержка последовательного обновления кластера | Новая | Включает [Последовательные обновления кластера](../../failover-clustering/cluster-operating-system-rolling-upgrade.md) , позволяя SMB поддерживать различные максимальные версии SMB для кластеров в процессе обновления. Дополнительные сведения о том, как разрешить обмен данными по протоколу SMB с использованием разных версий (диалектов) протокола, см. в записи блога [Управление диалектами SMB](https://techcommunity.microsoft.com/t5/storage-at-microsoft/controlling-smb-dialects/ba-p/860024). |
| Поддержка клиентов SMB Direct в Windows 10 | Новая | Windows 10 Корпоративная, Windows 10 для образовательных учреждений и Windows 10 Pro для рабочих станций теперь включают поддержку SMB Direct Client. |
| Встроенная поддержка вызовов API Филенормализеднамеинформатион | Новая | Добавляет собственную поддержку для запроса нормализованного имени файла. Дополнительные сведения см. в разделе [филенормализеднамеинформатион](https://docs.microsoft.com/openspecs/windows_protocols/ms-fscc/20bcadba-808c-4880-b757-4af93e41edf6). |

Дополнительные сведения см. в записи блога [новые возможности SMB 3.1.1 в Windows Server 2016 Technical Preview 2](https://docs.microsoft.com/archive/blogs/josebda/whats-new-in-smb-3-1-1-in-the-windows-server-2016-technical-preview-2).

## <a name="features-added-in-smb-302-with-windows-server-2012-r2-and-windows-81"></a>Компоненты, добавленные в SMB 3,02 с Windows Server 2012 R2 и Windows 8.1

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Автоматическая повторная балансировка клиентов масштабируемого файлового сервера     |   Новая      | Повышается масштабируемость и управляемость масштабируемых файловых серверов. Клиентские подключения SMB отслеживаются для каждого общего файлового ресурса (а не для каждого сервера), после чего клиенты перенаправляются в узел кластера с оптимальным доступом к тому, используемому общим файловым ресурсом. Это повышает производительность, снижая трафик перенаправления между узлами файлового сервера. Клиенты перенаправляются после начального подключения при перенастройке системы хранения данных кластера.    |
| Производительность по глобальной сети   | Обновлено  | Windows 8.1 и Windows 10 предоставляют улучшенные SRV_COPYCHUNK CopyFile по сравнению с поддержкой SMB при использовании проводника для удаленных копий из одного места на удаленном компьютере к другой копии на том же сервере. Вы скопируете только небольшой объем метаданных по сети (1/2KiB на 16MiB данных файлов передается). Это приводит к значительному улучшению производительности. Это различие на уровне операционной системы и обозревателя файлов для SMB. |
| SMB Direct     |   Обновлено      | Улучшает производительность нагрузок малого ввода-вывода, повышая эффективность при размещении нагрузок с малыми вводами-выводами (например, база данных оперативной обработки транзакций (OLTP) в виртуальной машине). Эти улучшения очевидны при использовании более высокоскоростных сетевых интерфейсов, таких как 40 Гбит/с Ethernet и 56 Гбит/с.  |
| Ограничения пропускной способности SMB | Новая | Теперь можно использовать [Set-смббандвидслимит](https://docs.microsoft.com/powershell/module/smbshare/set-smbbandwidthlimit) для установки ограничений пропускной способности в трех категориях: VirtualMachine (трафик Hyper-v через SMB), Ливемигратион (Hyper-v динамическая миграция трафик через SMB) или по умолчанию (все остальные типы трафика SMB).

Дополнительные сведения о новых и измененных функциях SMB в Windows Server 2012 R2 см. в статье [новые возможности SMB в Windows Server](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831474(v%3dws.11)>).

## <a name="features-added-in-smb-30-with-windows-server-2012-and-windows-8"></a>Функции, добавленные в SMB 3,0 с Windows Server 2012 и Windows 8

| Компонент или функция  | Новинка или обновление  | Сводка  |
| --------- | --------- | --------- |
| Прозрачная отказоустойчивость SMB     |   Новая    | Позволяет администраторам обслуживать аппаратное и программное обеспечение узлов кластерного файлового сервера, не прерывая работу приложений сервера, хранящих данные в этих файловых ресурсах. Кроме того, при сбое оборудования или программного обеспечения в узле кластера клиенты SMB подключатся к другому узлу кластера, не прерывая работу приложений сервера, хранящих данные в этих файловых ресурсах.        |
| Масштабирование SMB     |   Новая      | Поддержка нескольких экземпляров SMB в масштабируемый файловый сервер. С помощью версии 2 общих томов кластера (CSV) администраторы могут создавать файловые ресурсы, предоставляющие одновременный доступ к файлам данных с прямыми операциями ввода-вывода через все узлы кластера файлового сервера. Это улучшает использование пропускной способности сети и балансировку нагрузки клиентов файлового сервера, а также оптимизирует производительность серверных приложений.  |
| Технология SMB Multichannel     |   Новая      |  Включает агрегирование пропускной способности сети и отказоустойчивости сети, если между клиентом SMB и сервером доступно несколько путей. Это позволяет приложениям сервера использовать всю доступную пропускную способность сети и быть устойчивыми к сетевым сбоям.<br><br>Многоканальный SMB в SMB 3 вносит значительные улучшения в производительность по сравнению с предыдущими версиями SMB. |
| SMB Direct     |   Новая      | Поддерживает использование сетевых адаптеров, которые поддерживают RDMA и могут работать на полной скорости с очень низкой задержкой, используя очень малую часть ЦП. При использовании этой функции для таких рабочих нагрузок, как Hyper-V и Microsoft SQL Server, работа с удаленным файловым сервером будет похожа на работу с локальным хранилищем.<br><br>SMB Direct в SMB 3 вносит значительные улучшения в производительность по сравнению с предыдущими версиями SMB.  |
| Счетчики производительности для серверных приложений     |   Новая      |  Новые счетчики производительности SMB предоставляют подробные сведения о пропускной способности, задержках и операциях ввода-вывода в секунду, которые позволяют администраторам анализировать производительность файловых ресурсов SMB, где хранятся их данные. Эти счетчики разработаны специально для серверных приложений, таких как Hyper-V и SQL Server, которые хранят файлы в удаленных файловых ресурсах.      |
| Оптимизация производительности    |  Обновлено   | Клиент SMB и сервер оптимизированы для небольшого случайного ввода-вывода для чтения и записи, что часто встречается в серверных приложениях, таких как SQL Server OLTP. Помимо этого, большое значение для наибольшего размера передаваемых данных (MTU) теперь включено по умолчанию, что значительно повышает производительность больших последовательных передач, таких как работа с хранилищем данных SQL Server, архивация и восстановление базы данных, развертывание и копирование виртуальных жестких дисков. |
| Командлеты Windows PowerShell для SMB     |   Новая      |  С помощью командлетов Windows PowerShell для SMB администраторы могут полностью управлять файловыми ресурсами файлового сервера из командной строки.   |
| Шифрование SMB     |   Новая      | Обеспечивает непрерывное шифрование данных SMB и защищает их от перехвата в недоверенных сетях. Не нуждается в новых затратах на развертывание, протоколе IPsec, специализированном оборудовании и ускорителях WAN. Шифрование SMB может быть настроено для отдельных ресурсов или всего файлового сервера и может быть включено для ряда сценариев, при которых данные проходят через недоверенные сети. |
| Аренда каталогов SMB     |  Новая | Сокращает время ответа приложений в филиалах При использовании аренды каталогов число передач пакетов от клиента к серверу и обратно сокращается, так как метаданные извлекаются из кэша каталога с большим временем хранения. Обеспечивается согласованность кэша, так как клиенты извещаются об изменениях информации о каталоге на сервере. Аренда каталогов работает с сценариями для Хомефолдер (чтение и запись без общего доступа) и публикация (только для чтения с общим доступом).    |
| Производительность по глобальной сети   | Новая   | В SMB 3,0 появились оппортунистической блокировки каталога (Операционные блокировки) и аренды оппортунистической блокировки. Для типичных рабочих нагрузок Office и клиента операционные блокировки/Аренда показана для сокращения круговых обходов сети примерно на 15%.<br><br>В SMB 3 реализация SMB Windows была улучшена, чтобы улучшить поведение кэширования на клиенте, а также повысить пропускную способность.<br><br>SMB 3 включает усовершенствования в API CopyFile (), а также связанные средства, такие как Robocopy, для отправки значительно большего объема данных по сети. |
| Безопасное согласование диалектов | Новая | Помогает защититься от атак типа "злоумышленник в середине" для понизить согласование диалектов. Идея состоит в предотвращении того, что злоумышленник попытается понизить уровень изначально согласованного диалекта и возможностей между клиентом и сервером. Дополнительные сведения см. в разделе [SMB3 безопасное согласование диалектов](https://docs.microsoft.com/archive/blogs/openspecification/smb3-secure-dialect-negotiation). Обратите внимание, что это было заменено функцией [предварительной проверки подлинности SMB 3.1.1 в Windows 10](https://docs.microsoft.com/archive/blogs/openspecification/smb-3-1-1-pre-authentication-integrity-in-windows-10) в SMB 3.1.1. |


## <a name="hardware-requirements"></a>Требования к оборудованию

Для обеспечения прозрачной отказоустойчивости SMB необходимо соблюдать следующие требования.

* Отказоустойчивый кластер под Windows Server 2012 или Windows Server 2016 с настроенными как минимум двумя узлами. Кластер должен пройти проверочный тест для кластеров, входящий в состав мастера проверки.
* Файловые ресурсы должны быть созданы со свойством "Постоянная доступность" (CA), что является настройкой по умолчанию.
* Файловые ресурсы нужно создавать на путях к тому CSV, чтобы обеспечить масштабирование SMB.
* Клиентские компьютеры должны работать под управлением Windows® 8 или Windows Server 2012, включая обновленный клиент SMB, поддерживающий постоянную доступность.

> [!NOTE]
> Клиенты нижнего уровня могут подключаться к общим папкам, имеющим свойство CA, но прозрачная отработка отказа не будет поддерживаться для этих клиентов.

Для поддержки многоканальности SMB необходимо соблюдать следующие требования.

* Требуется по меньшей мере два компьютера под управлением Windows Server 2012. Установки дополнительных компонентов не требуется — эта технология включена по умолчанию.
* Сведения о рекомендуемых сетевых настройках см. в подразделе "Дополнительные сведения" в конце этого раздела.

Для поддержки прямой технологии SMB необходимо соблюдать следующие требования.

* Требуется по меньшей мере два компьютера под управлением Windows Server 2012. Установки дополнительных компонентов не требуется — эта технология включена по умолчанию.
* Сетевые адаптеры с поддержкой RDMA. На данный момент существует три типа таких адаптеров: iWARP, Infiniband и RoCE (RDMA over Converged Ethernet).

## <a name="more-information"></a>Дополнительные сведения

Следующий список содержит дополнительные ресурсы по протоколу SMB и связанным технологиям в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.

* [Хранилище в Windows Server](../storage.md)
* [масштабируемый файловый сервер для данных приложения](../../failover-clustering/sofs-overview.md)
* [Повышение производительности файлового сервера с помощью SMB Direct](smb-direct.md)
* [Развертывание Hyper-V по протоколу SMB](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134187(v%3dws.11)>)
* [Развертывание многоканального SMB](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn610980(v%3dws.11)>)
* [Развертывание быстрых и эффективных файловых серверов для серверных приложений](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831723(v%3dws.11)>)
* [SMB: руководство по устранению неполадок](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn659439(v%3dws.11)>)
