---
title: Повышение производительности файлового сервера с помощью SMB Direct
description: Описание SMB Direct функции в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: ed8fd5b4114fc9fd9c7dc278a98cea8cc67a8749
ms.sourcegitcommit: d31e266130b3b082372f7af4024e6089cb347d74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "4239231"
---
# SMB Direct

>Область применения: Windows Server 2012 R2, Windows Server 2012, Windows Server 2016

Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016 включают компонент SMB Direct, который поддерживает использование сетевых адаптеров, имеющих возможности удаленного Direct памяти доступа (RDMA). Сетевые адаптеры, имеющих RDMA может работать на полной скорости с очень низкой задержкой при использовании очень мало ЦП. Для рабочих нагрузок, например Hyper-V или Microsoft SQL Server это позволяет удаленным файловым сервером выглядеть локального хранилища. SMB Direct включает в себя:

- Увеличить пропускную способность: используется полная пропускная способность высокой скорости сети, где сетевых адаптеров координат передачи больших объемов данных на скорости линии.
- Низкая задержка: обеспечивает очень быстро ответов на запросы сетевой и, таким образом, делает хранения удаленных файлов вы можете как, если это непосредственно подключенных блочные хранилища.
- Низкий ЦП: использует меньше ресурсов процессора при передачей данных по сети, который оставляет больше электроэнергии доступных приложениям сервера.

SMB Direct автоматически настраивается Windows Server 2012 R2 и Windows Server 2012.

## SMB Multichannel и SMB Direct

Поддержка нескольких каналов SMB — это функция ответственность за обнаружение возможностей RDMA сетевых адаптеров, чтобы включить SMB Direct. Без функции SMB Multichannel SMB использует обычный TCP/IP с поддержкой RDMA сетевых адаптеров (все сетевые адаптеры обеспечивают стек TCP/IP, а также новый стек RDMA).

С помощью функции SMB Multichannel SMB обнаруживает ли сетевой адаптер имеет возможность RDMA, а затем создает несколько подключений RDMA для данного одного сеанса (два на интерфейс). Это позволяет SMB на использование высокой пропускной способностью, Низкая задержка и низкой загрузки ЦП, обеспечиваемую поддержкой RDMA сетевых адаптеров. Обеспечивает отказоустойчивость при использовании нескольких интерфейсов RDMA.

>[!NOTE]
>Не следует team поддержкой RDMA сетевых адаптеров, если вы планируете использовать возможность RDMA сетевых адаптеров. Туннелированием, сетевых адаптеров не будет поддерживать RDMA.
>После создания по крайней мере одно подключение сети RDMA подключения TCP/IP, используемый для согласования исходное протокола больше не используется. Тем не менее подключение TCP/IP сохраняется на случай, если сбой RDMA сетевых подключений.

## Требования

SMB Direct необходимо следующее:

- По крайней мере два компьютера под управлением Windows Server 2012 R2 или Windows Server 2012
- Один или несколько сетевых адаптеров с возможностью RDMA.

### Рекомендации по использованию SMB Direct

- Вы можете использовать SMB Direct в отказоустойчивом кластере; Тем не менее необходимо убедиться, что сети кластера, используемые для клиентского доступа не пригоден для SMB Direct. Отказоустойчивая кластеризация поддерживает использование нескольких сетей для клиентского доступа, а также сетевых адаптеров, которые RSS (масштабирование на стороне приема)-поддержкой и поддержкой RDMA.
- Можно использовать SMB Direct в операционной системе управления Hyper-V для поддержки с помощью Hyper-V через SMB и предоставлять хранилища на виртуальной машине, которая использует стек хранилища Hyper-V. Тем не менее поддержкой RDMA сетевых адаптеров не предоставляются непосредственно клиенту Hyper-V. Если сетевой адаптер поддержкой RDMA подключиться к виртуальному коммутатору, виртуальные сетевые адаптеры с коммутатора не будет поддержкой RDMA.
- Если вы отключите функции SMB Multichannel, SMB Direct также отключается. Так как SMB Multichannel обнаруживает возможностей сетевой адаптер и определяет, является ли адаптер с поддержкой RDMA, SMB Direct не может использоваться клиентом при отключении функции SMB Multichannel.
- SMB Direct не поддерживается в Windows RT. SMB Direct требуется поддержка сетевые адаптеры с поддержкой RDMA, которая доступна только в Windows Server 2012 R2 и Windows Server 2012.
- SMB Direct не поддерживается в старых версиях Windows Server. Он поддерживается только в Windows Server 2012 R2 и Windows Server 2012.

## Включение и отключение SMB Direct

SMB Direct включена по умолчанию при установке Windows Server 2012 R2 или Windows Server 2012. SMB-клиент Автоматическое обнаружение и использует несколько сетевых подключений, если обнаружено соответствующую конфигурацию.

### Отключить SMB Direct

Как правило вам не потребуется отключить SMB Direct, тем не менее, вы можете отключить, выполнив одну из следующих сценариев Windows PowerShell.

Чтобы отключить RDMA для определенного интерфейса, введите следующую команду:

```PowerShell
Disable-NetAdapterRdma <name>
```

Чтобы отключить RDMA для всех интерфейсов, введите следующую команду:

```PowerShell
Set-NetOffloadGlobalSetting -NetworkDirect Disabled
```

При отключении RDMA на стороне клиента или сервера, его нельзя использовать в системах. *Прямой сети* — это внутреннее имя для Windows Server 2012 R2 и Windows Server 2012 основные сетевые поддержка RDMA интерфейсов.

### Повторно включить SMB Direct

После отключения RDMA, вы можете повторно включить ее, выполнив одну из следующих сценариев Windows PowerShell.

Чтобы снова включить RDMA для определенного интерфейса, введите следующую команду:

```PowerShell
Enable-NetAdapterRDMA <name>
```

Чтобы снова включить RDMA для всех интерфейсов, введите следующую команду:

```PowerShell
Set-NetOffloadGlobalSetting -NetworkDirect Enabled
```

Необходимо включить RDMA для клиента и сервера, чтобы начать использовать его повторно.

## Тестирование производительности SMB Direct

Вы сможете проверить, как работает производительности с помощью одного из следующих процедур.

### Сравнение копию файла с и без использования SMB Direct

Вот как измерить увеличить пропускную способность SMB Direct.

1. Настройка пространств SMB
2. Измерьте количество времени для выполнения копирования больших файлов, с помощью SMB Direct.
3. Отключить RDMA на сетевом адаптере, см. в разделе [Включение и отключение SMB Direct](#enabling-and-disabling-smb-direct).
4. Измерьте количество времени для выполнения копирования больших файлов без использования SMB Direct.
5. Повторно включить RDMA на сетевом адаптере, а затем сравнить двух результатов.
6. Во избежание влияние кэширование, необходимо выполнить следующее:
    1. Скопируйте большой объем данных (больше данных, чем доступное для обработки памяти).
    2. Скопируйте данные дважды, с первой копии как практика и затем согласование по времени вторую копию.
    3. Перезапустите сервер и клиент перед каждого теста, убедитесь, что они работают аналогично условиях.

### Во время копирования файлов с помощью SMB Direct сбой один из нескольких сетевых адаптеров

Вот как убедиться, возможность перехода на другой ресурс SMB Direct.

1. Убедитесь, что в конфигурации с несколькими сетевой адаптер функционирует SMB Direct.
2. Запустите копию большого файла. Во время запуска копирование имитации сбоя одного из сетевые пути путем отключения один из кабели (или путем отключения один из сетевых адаптеров).
3. Убедитесь, что копирования файлов продолжается с помощью одного из остальных сетевых адаптеров, и что отсутствии ошибок копию файла.

>[!NOTE]
>Чтобы избежать ошибок из рабочей нагрузки, которая не использует SMB Direct, убедитесь, что нет других рабочих нагрузок, с помощью отключенный сетевой путь.

## Дополнительные сведения

- [Общие сведения о блок сообщений сервера](file-server-smb-overview.md)
- [Увеличение сервера, хранилища и доступность сети: Scenario Overview](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831437(v%3dws.11)>)
- [Развертывание Hyper-V при SMB](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134187(v%3dws.11)>)
