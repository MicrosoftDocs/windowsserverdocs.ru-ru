---
Title: Служба теневого копирования томов
ms.date: 01/30/2019
ms.prod: windows-server-threshold
ms.technology: storage
author: JasonGerend
manager: elizapo
ms.author: jgerend
ms.openlocfilehash: 0a4af25723c6d1e796cd3255875c15faf21fb8be
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67284387"
---
# <a name="volume-shadow-copy-service"></a>Служба теневого копирования томов

Относится к: Windows Server 2019 г., Windows Server 2016, Windows Server 2012 R2, Windows Server 2012 и Windows Server 2008 R2, Windows Server 2008, Windows 10, Windows 8.1, Windows 8, Windows 7

Резервное копирование и восстановление важных бизнес-данных могут быть очень сложными, из-за следующих проблем:

  - Данные обычно требуется для резервного копирования, хотя по-прежнему работают приложения, которые создают эти данные. Это означает, что некоторые файлы данных могут быть открыты, или они могут находиться в несогласованном состоянии.  
      
  - Если используется большой набор данных, может быть сложно создавать резервные копии всех ее за один раз.  
      

Правильно для выполнения операций резервного копирования и восстановления требуется тесном сотрудничестве между приложения резервного копирования, бизнес приложений, которые были созданы резервные копии, и хранилище управления оборудования и программного обеспечения. Тома службы теневого копирования (VSS), которая была введена в Windows Server® 2003, облегчает диалога между этими компонентами, чтобы они могли лучше работают вместе. Когда все компоненты поддерживает VSS, их можно использовать для резервного копирования данных приложения, не отключая приложения.

VSS координирует действия, необходимые для создания согласованные теневые копии данных, подлежащие резервному копированию (также известное как моментальный снимок или копию на определенный момент). Теневая копия может служить-, или он может использоваться в сценариях, таких как следующие:

  - Вы хотите создать резервную копию данных и системных состояния сведений о приложении, включая Архивация данных на другом жестком диске, на ленту или другого съемного носителя.  
      
  - Вы являетесь интеллектуального анализа данных.  
      
  - Выполняется резервное копирование с диска на диск.  
      
  - Необходимо быстрое восстановление после потери данных, восстановив данные исходного LUN или совершенно новых LUN, которое заменяет исходного LUN, в котором произошел сбой.  
      

Компоненты Windows и приложений, использующих VSS следующие:

  - [Архивации данных Windows Server](http://go.microsoft.com/fwlink/?linkid=180891) ()http://go.microsoft.com/fwlink/?LinkId=180891)  
      
  - [Теневые копии общих папок](http://go.microsoft.com/fwlink/?linkid=142874) ()http://go.microsoft.com/fwlink/?LinkId=142874)  
      
  - [System Center Data Protection Manager](http://go.microsoft.com/fwlink/?linkid=180892) (http://go.microsoft.com/fwlink/?LinkId=180892)  
      
  - [Восстановление системы](http://go.microsoft.com/fwlink/?linkid=180893) ()http://go.microsoft.com/fwlink/?LinkId=180893)  
      

## <a name="how-volume-shadow-copy-service-works"></a>Как работает служба теневого копирования томов

Законченное решение VSS требует наличия всех указанных ниже основных частей:

**Служба VSS**   частью операционной системы Windows, которое гарантирует, что другие компоненты могут взаимодействовать друг с другом, должным образом и совместной работы.

**Инициатор запроса VSS**   программное обеспечение, которое запрашивает фактическое создание теневых копий (или другие высокоуровневые операции, такие как импорт или их удаления). Как правило это приложение резервного копирования. Программа архивации данных Windows Server и System Center Data Protection Manager приложения являются инициатор запроса VSS. Инициатор запроса VSS Non-Microsoft® включают практически все программное обеспечение резервного копирования, под управлением Windows.

**Модуль записи VSS**   компонент, который гарантирует, что у нас есть согласованного набора данных для резервного копирования. Обычно предоставляется как часть бизнес-приложения, например SQL Server® или Exchange Server. Модули записи VSS для различных компонентов Windows, такие как реестр, входят в состав операционной системы Windows. Модули записи VSS, отличная от Майкрософт входят в состав многих приложений для Windows, необходимо гарантировать согласованность данных во время резервного копирования.

**Поставщик VSS**   компонент, который создает и обслуживает теневые копии. Это может произойти в программное обеспечение или оборудование. В операционной системе Windows имеется поставщик VSS, который использует копирования при записи. Если вы используете сеть хранения данных (SAN), очень важно установить поставщик оборудования VSS для сети хранения данных, если он указан. Поставщик оборудования разгружает задачи создания и сопровождения теневой копии из операционной системы.

На следующей схеме показано, как служба VSS службы координат инициаторы запроса, записи и поставщиков, создать теневую копию тома.

![](media/volume-shadow-copy-service/Ee923636.94dfb91e-8fc9-47c6-abc6-b96077196741(WS.10).jpg)

**Рис. 1**   схема архитектуры службы теневого копирования томов

### <a name="how-a-shadow-copy-is-created"></a>Способ создания теневой копии

В этом разделе помещаются в различные роли инициатора запроса, записи и поставщик контекста, перечисляя действия, которые необходимо выполнить для создания теневой копии. На следующей схеме показано, каким образом службы теневого копирования томов контролирует общей координации инициатор запроса, записи и поставщика.

![](media/volume-shadow-copy-service/Ee923636.1c481a14-d6bc-4796-a3ff-8c6e2174749b(WS.10).jpg)

**Рис. 2** процесс создания теневой копии

Для создания теневой копии, инициатор запроса, записи и поставщика выполните следующие действия.

1.  Требованием теневого копирования тома на перечисление модулей записи, сбор метаданных модуля записи и подготовиться к теневой копии.  
      
2.  Каждый модуль записи создает XML-описание компонентов и хранилищ данных, которые необходимо создавать резервные копии и предоставляет его службы теневого копирования томов. Модуль записи также определяет метод восстановления, который используется для всех компонентов. Службы теневого копирования томов предоставляет описание его запрашивающей стороне, который выбирает компоненты, которые будут создаваться резервные копии.  
      
3.  Службы теневого копирования томов уведомляет всех модулей записи, чтобы подготовить свои данные для создания теневых копий.  
      
4.  Каждый модуль записи подготавливает данные соответствующим образом, например после выполнения всех открытых транзакций, чередующихся журналов транзакций и Очистка кэшей. Когда данные готовы выполняться теневое копирование, модуль записи уведомляет службу теневого копирования томов.  
      
5.  Службы теневого копирования томов сообщает модулей записи, можно временно зафиксировать запросов ввода-вывода записи приложения (чтение запросов ввода/вывода, по-прежнему возможны) на несколько секунд, которые необходимы для создания теневой копии тома или томов. Замораживание приложения не допускается занимает больше 60 секунд. Службы теневого копирования томов очищает буферы системы файл и затем замораживает файловой системы, которая гарантирует, что для правильной записи метаданные файловой системы, так и для данных теневого копирования записывается в последовательном порядке.  
      
6.  Службы теневого копирования томов указывает поставщику создать теневую копию. Период создания теневого копирования длится не более 10 секунд, во время которых все записи остаются замороженный запросов ввода-вывода в файловой системе.  
      
7.  Службы теневого копирования томов освобождает запросы ввода-вывода записи файловой системы.  
      
8.  VSS указывает записи Разморозить запросов ввода-вывода записи приложения. На этом этапе приложений могут возобновить запись данных на диск, для которого создается теневого копирования.  
      

> [!NOTE]
> Создание теневой копии может прерываться, если записи хранятся в состоянии замораживание дольше, чем 60 секунд или если поставщики занимать более 10 секунд, чтобы зафиксировать теневой копии. 
<br>

9. Инициатор запроса можно повторить процесс (перейти к шагу 1) или уведомлять администратора, чтобы повторить попытку позже.  
      
10. Если успешного создания теневой копии службы теневого копирования томов возвращает сведения о расположении для теневой копии для запрашивающей стороны. В некоторых случаях теневая копия может быть временно доступна как том чтения и записи, VSS и одного или нескольких приложений может изменить содержимое теневой копии до завершения теневой копии. После VSS и приложениями, внесите свои изменения, теневая копия только для чтения. Этот этап называется автоматического восстановления, и он используется для отмены файловой системы или приложения транзакций на том теневых копий, которые не были завершены до создания теневой копии.  
      

### <a name="how-the-provider-creates-a-shadow-copy"></a>Как поставщик создает теневую копию

Оборудования или программного обеспечения поставщик теневого копирования использует один из следующих методов для создания теневой копии:

**Завершите копирование**   этот метод выполняет полную копию (называемые «полная копия» или «клонирования») исходный том в определенный момент времени. Эта копия только для чтения.

**Копирования при записи**   этот метод не копирует исходный том. Вместо этого он создает копию разностного путем копирования всех изменений (завершенной записи запросов ввода-вывода), которые выполняются в том после указанной точки во времени.

**Перенаправление при записи**   этот метод не копирует исходный том и при этом не делает все изменения на исходный том с данного момента времени. Вместо этого он создает копию разностного, перенаправляя все изменения на другой том.

## <a name="complete-copy"></a>Полную копию

Полная копия обычно создается, сделав «зеркальном разбиение» следующим образом:

1.  Исходный том и том теневых копий представляют собой набор зеркальный том.  
      
2.  Том теневых копий, отделен от исходного тома. Это разрывает соединение зеркального.  
      

После зеркальной подключение разрывается, исходный том и том теневых копий независимы. Исходный том по-прежнему для принятия всех изменений (запросов ввода-вывода записи), при теневого копирования томов остается точную копию только для чтения исходных данных во время паузы.

### <a name="copy-on-write-method"></a>Метод копирования при записи

При внесении изменений на исходный том (но до записи завершения запроса ввода-вывода), каждый блок, чтобы изменить в методе копирования при записи считывается и затем записываются в тома области на хранения теневых копий (также называемый его «области копирования»). Области хранения теневых копий могут размещаться на том же или другой том. Это позволяет сохранить копию блока данных на исходном томе, прежде чем изменения перезаписывает его.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Time</th>
<th>Исходные данные (состояние и данные)</th>
<th>Теневая копия (состояние и данные)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>T0</p></td>
<td><p>Исходные данные: 1 2 3 4 5</p></td>
<td><p>Копия не: —</p></td>
</tr>
<tr class="even">
<td><p>T1</p></td>
<td><p>Изменения в кэше данных: 3 на 3'</p></td>
<td><p>Теневого копирования создана (только различия): 3</p></td>
</tr>
<tr class="odd">
<td><p>T2</p></td>
<td><p>Перезапись исходных данных: 1 2 3’ 4 5</p></td>
<td><p>Различия и индекса, хранящегося в теневой копии: 3</p></td>
</tr>
</tbody>
</table>

**Таблица 1**   метод копирования при записи создания теневых копий

Метод копирования при записи — быстрый метод для создания теневой копии, поскольку копируются только данные, необходимо изменить. Блокировки копируются в области копирования могут сочетаться с измененные данные на исходном томе для восстановления тома в состояние, перед внесением изменений. Если большое количество изменений, метод копирования при записи может стать дорого.

### <a name="redirect-on-write-method"></a>Метод перенаправления при записи

В методе перенаправления при записи всякий раз, когда исходный том получит изменение (операций ввода-вывода запроса на запись), изменение не применено к исходного тома. Вместо этого изменения записываются в области хранения теневых копий другой том.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Time</th>
<th>Исходные данные (состояние и данные)</th>
<th>Теневая копия (состояние и данные)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>T0</p></td>
<td><p>Исходные данные: 1 2 3 4 5</p></td>
<td><p>Копия не: —</p></td>
</tr>
<tr class="even">
<td><p>T1</p></td>
<td><p>Изменения в кэше данных: 3 на 3'</p></td>
<td><p>Теневого копирования создана (только различия): 3’</p></td>
</tr>
<tr class="odd">
<td><p>T2</p></td>
<td><p>Исходные данные без изменений: 1 2 3 4 5</p></td>
<td><p>Различия и индекса, хранящегося в теневой копии: 3’</p></td>
</tr>
</tbody>
</table>

**Таблица 2**   метод перенаправления при записи создания теневых копий

Как и метод копирования при записи метод перенаправления при записи является быстрый метод для создания теневой копии, так как оно копирует только изменения в данных. Блокировки копируются в области копирования могут сочетаться с без изменений данных на исходном томе, чтобы создать полную и актуальную копию данных. При наличии большого числа запросов ввода-вывода для чтения, метод перенаправления при записи может стать дорого.

## <a name="shadow-copy-providers"></a>Поставщиков теневых копий

Существует два типа поставщиков теневых копий: аппаратные поставщики и поставщики на основе программного обеспечения. Имеется также поставщика системы, который является поставщиком программного обеспечения, который встроен в операционную систему Windows.

### <a name="hardware-based-providers"></a>Поставщики на основе оборудования

Act поставщиков аппаратный теневого копирования как интерфейс между службы теневого копирования томов и уровнем оборудования, работая в сочетании с оборудованием адаптера хранилища или контроллера. Работа создания и сопровождения теневой копии выполняется массивом хранения.

Поставщики оборудования, всегда имеют теневую копию всего LUN, но службы теневого копирования томов предоставляет только теневого копирования тома или томов, которые были запрошены.

Поставщик аппаратных теневого копирования использует службу теневого копирования томов функциональность, которая определяет точку во времени, позволяет синхронизировать данные, управляет теневой копии и обеспечивает общий интерфейс с приложениями для резервного копирования. Тем не менее службы теневого копирования томов не содержит базовый механизм, по которому аппаратный поставщик создает и обслуживает теневые копии.

### <a name="software-based-providers"></a>Поставщики на основе программного обеспечения

Поставщиков программных теневых копий обычно перехвата и обработки запросов чтения и записи ввода-вывода в слой программного обеспечения между файловой системы и программное обеспечение диспетчера томов.

Эти поставщики реализуются как компонент библиотеки DLL режима пользователя и по крайней мере один в режиме ядра драйвера, драйвер фильтра обычно хранилища. В отличие от аппаратных поставщиков поставщики на основе программного обеспечения создавать теневые копии на уровне программного обеспечения, а не на уровне оборудования.

Поставщик программных теневого копирования необходимо поддерживать «в определенный момент времени» представление тома за счет доступа к набору данных, который может использоваться для повторного создания состояние тома перед время создания теневой копии. Например, метод копирования при записи системного поставщика. Тем не менее службы теневого копирования томов не накладывает ограничений на какой способ, поставщики программных используют для создания и настройки теневых копий.

Поставщик программного обеспечения применяется к более широкий диапазон платформ хранилища, чем поставщик на основе оборудования, и он должен работать одинаково хорошо с базовых дисках или логических томах. (Логический том — это том, который создается путем объединения свободного места из двух или нескольких дисков). В отличие от аппаратных теневых копий поставщиками программного обеспечения потребляют ресурсы операционной системы для поддержания теневой копии.

Дополнительные сведения о базовых дисках см. в разделе [Каковы базовые диски и тома?](http://go.microsoft.com/fwlink/?linkid=180894) (http://go.microsoft.com/fwlink/?LinkId=180894) на сайте TechNet.

### <a name="system-provider"></a>Поставщик системы

Один поставщик теневого копирования, системного поставщика, предоставляется в операционной системе Windows. Несмотря на то, что поставщик по умолчанию предоставляется в Windows, другие поставщики могут предоставлять реализации, которые оптимизированы для хранения приложений оборудования и программного обеспечения.

Для поддержания представления «в определенный момент времени», содержащийся в теневую копию тома, системного поставщика использует метод копирования при записи. Копий на томе блоков, которые были изменены с момента начала теневой копии хранятся в области хранения теневых копий.

Поставщик системы могут предоставлять рабочего тома, который могут быть записаны и прочитаны из обычно. При необходимости теневой копии логически применяется различия к данным на рабочего тома для предоставления полного теневой копии.

Для системного поставщика области хранения теневых копий должна находиться на томе NTFS. Теневая копия тома не нужно быть томом NTFS, но по крайней мере один томе, подключенном к системе должен быть томом NTFS.

Файлы компонентов, составляющих системного поставщика: swprv.dll и volsnap.sys, удаляющий.

### <a name="in-box-vss-writers"></a>Модули записи VSS в поле

Операционная система Windows включает в себя набор модулей записи VSS, которые отвечают за перечисление данных, который необходим при использовании разных функций Windows.

Дополнительные сведения об этих модулей записи см. в разделе следующих веб-сайтах Microsoft:

  - [Модули записи VSS в поле](http://go.microsoft.com/fwlink/?linkid=180895) ()http://go.microsoft.com/fwlink/?LinkId=180895)  
      
  - [Новых модулей записи VSS в комплект для Windows Server 2008 и Windows Vista с пакетом обновления 1](http://go.microsoft.com/fwlink/?linkid=180896) ()http://go.microsoft.com/fwlink/?LinkId=180896)  
      
  - [Новых модулей записи VSS в комплект для Windows Server 2008 R2 и Windows 7](http://go.microsoft.com/fwlink/?linkid=180897) ()http://go.microsoft.com/fwlink/?LinkId=180897)  
      

## <a name="how-shadow-copies-are-used"></a>Использование теневых копий

Помимо резервного копирования данных и системы состояния сведений о приложении, можно использовать теневые копии для различных целей, включая следующие:

  - Восстановление LUN (повторная синхронизация LUN и последующее переключение LUN)  
      
  - Восстановление отдельных файлов (теневые копии общих папок)  
      
  - Интеллектуальный анализ данных с помощью переносимых теневых копий  
      

### <a name="restoring-luns-lun-resynchronization-and-lun-swapping"></a>Восстановление LUN (повторная синхронизация LUN и последующее переключение LUN)

В Windows Server 2008 R2 и Windows 7 инициатор запроса VSS можно использовать функцию поставщика оборудования теневого копирования вызывается LUN повторной синхронизации (или «LUN повторная синхронизация»). Это схема быстрого восстановления, предоставляющим администратору этого приложения для восстановления данных из теневой копии исходного LUN или новый LUN.

Теневая копия может быть клон полной или разностной копии. В любом случае в конце операции повторной синхронизации назначение LUN будет иметь того же содержимого, теневая копия LUN. Во время операции повторной синхронизации массив выполняет копирование уровня блока из теневой копии в место назначения LUN.


> [!NOTE]
> Теневой копии должно быть переносимые аппаратной теневой копии. 
<br>


Большинство массивы позволяют рабочих операциях ввода-вывода для возобновления вскоре после начала операции повторной синхронизации. Операция повторной синхронизации во время выполнения, что запросы перенаправляются в теневой копии LUN, запросов чтения и записи в место назначения LUN. Это позволяет массивы, чтобы восстановить большие наборы данных и возобновить нормальную работу через несколько секунд.

Повторная синхронизация LUN отличается от замены LUN. Замены LUN — это быстрое восстановление сценарий, который занимался поддержкой VSS, начиная с Windows Server 2003 с пакетом обновления 1. В операцию переключения LUN теневой копии импортируется и затем преобразуется в том чтения и записи. Преобразование — это необратимая операция и тома и LUN базовой нельзя управлять при помощи API-интерфейсы VSS после этого. Ниже перечислены сравнение LUN повторной синхронизации с LUN переключения.

  - В повторной синхронизации LUN теневая копия не изменяется, поэтому он может использоваться несколько раз. В LUN замены, теневой копии можно использовать только один раз для восстановления. Для администраторов наиболее безопасности ка это важно. При повторной синхронизации LUN, инициатора запроса можно повторить операцию восстановления всего, если что-то пойдет не так первый раз.  
      
  - В конце замены LUN теневая копия LUN используется для запросов ввода-вывода рабочей среде. По этой причине теневая копия LUN необходимо использовать такого же качества хранилища как производственный исходного LUN, чтобы убедиться, что не влияет на работу после операции восстановления. Если вместо него используется повторной синхронизации LUN, поставщик оборудования может поддерживать теневой копии в хранилище, которое является менее дорогостоящим, чем хранилище промышленного качества.  
      
  - Если назначение LUN не может использоваться и нужно создать заново, замена LUN возможно наиболее экономичным решением, так как он не требует назначения LUN.  
      


> [!WARNING]
> Все операции, перечисленные, операции на уровне LUN. Если попытаться восстановить конкретного тома с помощью повторной синхронизации LUN, не подумав нужно восстановить все тома, которые совместно используют LUN. 
<br>


### <a name="restoring-individual-files-shadow-copies-for-shared-folders"></a>Восстановление отдельных файлов (теневые копии общих папок)

Теневых копий общих папок использует службу теневого копирования томов для предоставления копии на определенный момент файлы, расположенные на общий сетевой ресурс, например файловый сервер. С теневыми копиями общих папок пользователи могут быстро восстанавливать удаленные или измененные файлы, которые хранятся в сети. Так как он может сделать это без помощи администратора, теневые копии общих папок можно повысить производительность и снизить расходы на администрирование.

Дополнительные сведения о теневых копий общих папок, см. в разделе [теневые копии общих папок](http://go.microsoft.com/fwlink/?linkid=180898) (http://go.microsoft.com/fwlink/?LinkId=180898) на сайте TechNet.

### <a name="data-mining-by-using-transportable-shadow-copies"></a>Интеллектуальный анализ данных с помощью переносимых теневых копий

С поставщиком оборудования, который предназначен для использования со службой теневого копирования тома вы можете создать переносимых теневых копий, которые можно импортировать на серверы в одну подсистему (например, SAN). Этих теневых копий используется для заполнения рабочей или тестовой установки только для чтения данных для интеллектуального анализа данных.

С помощью службы теневого копирования томов и массива хранилища с поставщиком оборудования, который предназначен для использования со службой теневого копирования тома имеется возможность создать теневую копию тома источника данных на одном сервере, а затем импортировать теневой копии на другой сервер  (или обратно в том же сервере). Этот процесс выполняется через несколько минут, вне зависимости от объема данных. Процесс передачи выполняется через ряд шагов, которые используют теневого копирования источникам запросов (приложение управления хранением), поддерживающий переносимых теневых копий.

## <a name="to-transport-a-shadow-copy"></a>Транспортировка теневой копии

1.  Создание переносимых теневых копии исходных данных на сервере.

2.  Импортировать теневой копии на сервер, который подключен к сети SAN (вы можете импортировать на другой сервер или том же сервере).

3.  Данные теперь готов для использования.

![](media/volume-shadow-copy-service/Ee923636.633752e0-92f6-49a7-9348-f451b1dc0ed7(WS.10).jpg)

**Рис. 3**   теневой копии и транспорта между двумя серверами


> [!NOTE]
> Переносимой теневой копии, создаваемого в Windows Server 2003 невозможно импортировать на сервер под управлением Windows Server 2008 или Windows Server 2008 R2. Переносимой теневой копии, который был создан в Windows Server 2008 или Windows Server 2008 R2 нельзя импортировать на сервер под управлением Windows Server 2003. Тем не менее теневой копии, создаваемого в Windows Server 2008 можно импортировать на сервер под управлением Windows Server 2008 R2 и наоборот. 
<br>


Теневые копии доступны только для чтения. Если вы хотите преобразовать теневой копии на чтение и запись LUN, можно использовать приложении управления хранилищами в основе службу виртуальных дисков (включая некоторые инициаторы запроса) в дополнение к службы теневого копирования томов. С помощью этого приложения, можно удалить теневую копию из системы управления службы теневого копирования томов и преобразовать его для чтения и записи LUN.

Транспорта службы теневого копирования тома — это расширенный решение на компьютерах под управлением Windows Server 2003 Enterprise Edition, Windows Server 2003 Datacenter Edition, Windows Server 2008 или Windows Server 2008 R2. Он работает только в том случае, если поставщик оборудования имеется в массиве хранения. Транспорт теневого копирования можно использовать для различных целей, включая резервное копирование на ленту, данных интеллектуального анализа данных и тестирования.

## <a name="frequently-asked-questions"></a>Вопросы и ответы

Ответы на вопросы о том службы теневого копирования (VSS) для системных администраторов. Сведения о VSS прикладных программных интерфейсов, см. в разделе [службы теневого копирования томов](http://go.microsoft.com/fwlink/?linkid=180899) (http://go.microsoft.com/fwlink/?LinkId=180899) в библиотеке Windows Developer Center.

### <a name="when-was-volume-shadow-copy-service-introduced-on-which-windows-operating-system-versions-is-it-available"></a>Когда появилась службы теневого копирования томов? На какие версии операционной системы Windows доступна ли она?

VSS появилась в Windows XP. Он доступен в Windows XP, Windows Server 2003, Windows Vista®, Windows Server 2008, Windows 7 и Windows Server 2008 R2.

### <a name="what-is-the-difference-between-a-shadow-copy-and-a-backup"></a>Какова разница между теневую копию и резервную копию?

В случае с резервной копии жесткого диска созданная теневая копия также выполняется резервное копирование. Данные можно скопировать из теневой копии для восстановления или теневой копии можно использовать для быстрого восстановления сценария — например, повторная синхронизация LUN или LUN переключения.

При копировании данных из теневой копии на ленту или другого съемного носителя, содержимое, которое хранится на носителе, представляет собой резервную копию. После копирования данных из него можно удалить теневую копию самого.

### <a name="what-is-the-largest-size-volume-that-volume-shadow-copy-service-supports"></a>Что такое том максимального размера, который поддерживает службу теневого копирования томов?

Служба теневого копирования томов поддерживает размер тома размером до 64 ТБ.

### <a name="i-made-a-backup-on-windows-server2008-can-i-restore-it-on-windows-server2008r2"></a>Я сделана резервная копия на Windows Server 2008. Можно ли восстановить ее на Windows Server 2008 R2?

Это зависит от программное обеспечение резервного копирования, которое использовалось. Большинство программ резервного копирования поддерживает этот сценарий для данных, но не для резервных копий состояния системы.

Теневые копии, созданные на одну из этих версий Windows можно использовать на другом.

### <a name="i-made-a-backup-on-windows-server2003-can-i-restore-it-on-windows-server2008"></a>Я сделана резервная копия в Windows Server 2003. Можно ли восстановить его в Windows Server 2008?

Это зависит от резервных копий программного обеспечения, которое вы использовали. При создании теневого копирования в Windows Server 2003, его нельзя использовать в Windows Server 2008. Кроме того при создании теневого копирования в Windows Server 2008, его нельзя восстановить на Windows Server 2003.

### <a name="how-can-i-disable-vss"></a>Как отключить VSS

Это можно отключить с помощью консоли управления MMC службы теневого копирования томов. Тем не менее не следует это. Отключение VSS отрицательно влияет на программное обеспечение, которое можно использовать, зависит, таких как восстановление системы и архивации данных Windows Server.

Дополнительные сведения см. на следующих сайтах Microsoft TechNet Web:

  - [Восстановление системы](http://go.microsoft.com/fwlink/?linkid=157113) ()http://go.microsoft.com/fwlink/?LinkID=157113)  
      
  - [Архивации данных Windows Server](http://go.microsoft.com/fwlink/?linkid=180891) ()http://go.microsoft.com/fwlink/?LinkID=180891)  
      

### <a name="can-i-exclude-files-from-a-shadow-copy-to-save-space"></a>Можно исключить файлы из теневой копии для экономии места?

VSS позволяет создавать теневые копии целых томов. Временные файлы, такие как файлы подкачки, автоматически исключаются из теневых копий для экономии места.

Чтобы исключить определенные файлы из теневых копий, используйте следующий раздел реестра: **FilesNotToSnapshot**.


> [!NOTE]
> <STRONG>FilesNotToSnapshot</STRONG> раздел реестра должен использоваться только приложениями. Пользователи, пытающиеся использовать столкнутся ограничения, например следующие:
> <br>
> <UL>
> <LI>Он не может удалить файлы из теневой копии, который был создан на сервере Windows с помощью функции предыдущих версий.<BR><BR>
> <LI>Он не может удалить файлы из теневых копий общих папок.<BR><BR>
> <LI>Его можно удалить файлы из теневой копии, который был создан с помощью <a href="https://docs.microsoft.com/windows-server/administration/windows-commands/diskshadow" data-raw-source="[Diskshadow](https://docs.microsoft.com/windows-server/administration/windows-commands/diskshadow)">Diskshadow</a> программы, но он не может удалить файлы из теневой копии, который был создан с помощью <a href="https://docs.microsoft.com/windows-server/administration/windows-commands/vssadmin" data-raw-source="[Vssadmin](https://docs.microsoft.com/windows-server/administration/windows-commands/vssadmin)">Vssadmin</a> служебной программы.<BR><BR>
> <LI>Файлы будут удалены из теневой копии на основе результативности. Это означает, что они не обязательно быть удалены.<BR><BR></LI></UL>


Дополнительные сведения см. в разделе [исключение файлов из теневых копий](http://go.microsoft.com/fwlink/?linkid=180904) (http://go.microsoft.com/fwlink/?LinkId=180904) на сайте MSDN.

### <a name="my-non-microsoft-backup-program-failed-with-a-vss-error-what-can-i-do"></a>Моей программы резервного копирования сторонних производителей, завершилась с ошибкой VSS. Что я могу сделать?

Обратитесь к разделу поддержки продукта на веб-узле компании, создавшей программы резервного копирования. Возможно, обновление, можно загрузить и установить их устранения. В противном случае обратитесь в отдел поддержки продуктов компании.

Системные администраторы могут использовать сведения об устранении неполадок VSS на следующем сайте Microsoft TechNet библиотека Web собирать диагностическую информацию о проблемах, связанных с VSS.

Дополнительные сведения см. в разделе [службы теневого копирования томов](http://go.microsoft.com/fwlink/?linkid=180905) (http://go.microsoft.com/fwlink/?LinkId=180905) на сайте TechNet.

### <a name="what-is-the-diff-area"></a>Что такое «области копирования»

Области хранения теневых копий (или «области копирования») — расположение, где хранятся данные для теневой копии, которая создается с системного поставщика программного обеспечения.

### <a name="where-is-the-diff-area-located"></a>Где находится области копирования?

Области копирования может находиться на любом локальном томе. Тем не менее он должен быть расположен на томе NTFS, на котором достаточно свободного места для его сохранения.

### <a name="how-is-the-diff-area-location-determined"></a>Как такое месте области копирования

В следующем порядке, чтобы определить расположение области копирования оцениваются следующим критериям:

  - Если том уже содержит к существующей теневой копии, используется это расположение.  
      
  - Если предварительно настроенные вручную ассоциации между исходный том и расположению теневых копий томов, используется это расположение.  
      
  - Если два предыдущих условия не указано расположение, службу теневого копирования выбирает расположение, в зависимости от места на диске. Если более чем одного тома теневой копии, службу теневого копирования создает список местоположений возможных моментальных снимков, в зависимости от размера свободного места, в порядке убывания. Количество расположениях, передаваемых равно числу создаются теневые копии томов.  
      
  - Если создаются теневые копии тома является одним из возможных расположений, то создается локальную ассоциацию. В противном случае создается связь с тома с наибольший объем места.  
      

### <a name="can-vss-create-shadow-copies-of-non-ntfs-volumes"></a>Можно VSS создавать теневые копии томов, отличной от NTFS?

Да. Тем не менее можно сделать постоянные теневые копии только для томов NTFS. Кроме того по крайней мере один томе, подключенном к системе должен быть томом NTFS.

### <a name="whats-the-maximum-number-of-shadow-copies-i-can-create-at-one-time"></a>Каково максимальное количество теневых копий, который можно создать за один раз?

Теневые копии тома в набор единый теневых копий не более 64. Обратите внимание на то, что это не совпадает с количеством теневых копий.

### <a name="whats-the-maximum-number-of-software-shadow-copies-created-by-the-system-provider-that-i-can-maintain-for-a-volume"></a>Максимальное количество теневых копий программного обеспечения полученного поставщиком системы, который я может поддерживать тома?

Максимальное число является теневых копий программного обеспечения для каждого тома составляет 512. Тем не менее по умолчанию может поддерживать только 64 теневых копий, которые используются функцией теневых копий общих папок. Чтобы изменить ограничение для функции теневых копий общих папок, используйте следующий раздел реестра: **MaxShadowCopies**.

### <a name="how-can-i-control-the-space-that-is-used-for-shadow-copy-storage-space"></a>Как контролировать пространство, которое используется для пространство хранения теневых копий?

Тип **vssadmin изменение размера местонахождения** команды.

Дополнительные сведения см. в разделе [Vssadmin изменение размера местонахождения](http://go.microsoft.com/fwlink/?linkid=180906) (http://go.microsoft.com/fwlink/?LinkId=180906) на сайте TechNet.

### <a name="what-happens-when-i-run-out-of-space"></a>Что происходит, когда я не останется свободного места?

Теневые копии для тома будут удалены, начиная с самая старая теневая копия.

## <a name="volume-shadow-copy-service-tools"></a>Средства Service тома теневого копирования

Операционная система Windows предоставляет следующие средства для работы с помощью службы VSS:

  - [DiskShadow](http://go.microsoft.com/fwlink/?linkid=180907) ()http://go.microsoft.com/fwlink/?LinkId=180907)  
      
  - [VssAdmin](http://go.microsoft.com/fwlink/?linkid=84008) ()http://go.microsoft.com/fwlink/?LinkId=84008)  
      

### <a name="diskshadow"></a>DiskShadow

DiskShadow представляет инициатор службы VSS, который можно использовать для управления все оборудование и программное обеспечение моментальные снимки, которые имеются в системе. DiskShadow содержит команды, например следующие:

  - **список**: Список модулей записи VSS, поставщики VSS и теневых копий  
      
  - **Создание**: Создает новую копию тени  
      
  - **Импорт**: Импортирует переносимой теневой копии  
      
  - **предоставлять**: Предоставляет постоянное теневого копирования (как букву диска, например)  
      
  - **Отменить**: Возвращается к указанным теневого копирования тома  
      

Этот инструмент предназначен для использования ИТ-специалистов, но разработчики также бывает удобно при тестировании модуль записи VSS или поставщик VSS.

Программа DiskShadow доступна только в операционных системах Windows Server. Он доступен в операционных системах клиентов Windows.

### <a name="vssadmin"></a>VssAdmin

VssAdmin используется для создания, удаления и список сведений о теневых копий. Его также можно изменить размер области хранения теневых копий («области копирования»).

VssAdmin содержит команды, например следующие:

  - **Создание тени**: Создает новую копию тени  
      
  - **удалить shadows**: Операции удаления теневых копий  
      
  - **Список поставщиков**: Список всех зарегистрированных поставщиков VSS  
      
  - **Список модулей записи**: Отображает список всех подписанных модулей записи VSS  
      
  - **Изменение размера местонахождения**: Изменяет максимальный размер области хранения теневых копий  
      

VssAdmin может использоваться только для администрирования теневые копии, созданные с системного поставщика программного обеспечения.

VssAdmin можно найти в клиента Windows и версий операционной системы Windows Server.

## <a name="volume-shadow-copy-service-registry-keys"></a>Тома теневой копии службы реестра

Для использования с помощью службы VSS, доступны следующие разделы реестра:

  - **VssAccessControl**  
      
  - **MaxShadowCopies**  
      
  - **MinDiffAreaFileSize**  
      

### <a name="vssaccesscontrol"></a>VssAccessControl

Этот ключ используется для указания, какие пользователи имеют доступ к теневым копиям.

Дополнительные сведения см. в статье следующие записи на сайте MSDN:

  - [Вопросы безопасности для модулей записи](http://go.microsoft.com/fwlink/?linkid=157739) ()http://go.microsoft.com/fwlink/?LinkId=157739)  
      
  - [Вопросы безопасности для запроса](http://go.microsoft.com/fwlink/?linkid=180908) ()http://go.microsoft.com/fwlink/?LinkId=180908)  
      

### <a name="maxshadowcopies"></a>MaxShadowCopies

Этот ключ указывает максимальное количество доступных для клиента теневые копии, которые могут храниться на каждом томе компьютера. Теневых копий, доступных для клиента используются теневые копии общих папок.

Дополнительные сведения см. следующую запись на сайте MSDN:

**MaxShadowCopies** под [разделы реестра для резервного копирования и восстановления](http://go.microsoft.com/fwlink/?linkid=180909) ()http://go.microsoft.com/fwlink/?LinkId=180909)

### <a name="mindiffareafilesize"></a>MinDiffAreaFileSize

Этот ключ указывает минимальный исходный размер в МБ, из области хранения теневых копий.

Дополнительные сведения см. следующую запись на сайте MSDN:

**MinDiffAreaFileSize** под [разделы реестра для резервного копирования и восстановления](http://go.microsoft.com/fwlink/?linkid=180910) ()http://go.microsoft.com/fwlink/?LinkId=180910)

`##`# "Поддерживаемые версии операционной системы

Ниже перечислены минимальные поддерживаемые версии операционных систем для VSS функций.


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция VSS</th>
<th>Минимальная версия клиента</th>
<th>Минимальная версия сервера</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>Повторная синхронизация LUN</p></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2008 R2</p></td>
</tr>
<tr class="even">
<td><p><strong>FilesNotToSnapshot</strong> раздел реестра</p></td>
<td><p>Windows Vista</p></td>
<td><p>Windows Server 2008</p></td>
</tr>
<tr class="odd">
<td><p>Переносимых теневых копий</p></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2003 с пакетом обновления 1 (SP1);</p></td>
</tr>
<tr class="even">
<td><p>Аппаратные теневые копии</p></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2003.</p></td>
</tr>
<tr class="odd">
<td><p>Предыдущие версии Windows Server</p></td>
<td><p>Windows Vista</p></td>
<td><p>Windows Server 2003.</p></td>
</tr>
<tr class="even">
<td><p>Быстрое восстановление за счет замены LUN</p></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2003 с пакетом обновления 1 (SP1);</p></td>
</tr>
<tr class="odd">
<td><p>Импортирует несколько теневых копий для оборудования</p>
<div class="alert">
<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="header">
<th><img src="media/volume-shadow-copy-service/Dd560667.note(WS.10).gif" />Примечание.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Это возможность импорта теневой копии более одного раза. Импорт только одна операция может выполняться одновременно.
<p></p></td>
</tr>
</tbody>
</table>
<p></p>
</div></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2008</p></td>
</tr>
<tr class="even">
<td><p>Теневые копии общих папок</p></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2003.</p></td>
</tr>
<tr class="odd">
<td><p>Переносимых автоматически восстанавливаемого теневых копий</p></td>
<td><p>Ни одна версия не поддерживается</p></td>
<td><p>Windows Server 2008</p></td>
</tr>
<tr class="even">
<td><p>Параллельные сеансы резервного копирования (до 64)</p></td>
<td><p>Windows XP</p></td>
<td><p>Windows Server 2003.</p></td>
</tr>
<tr class="odd">
<td><p>Единый восстановление сеанса параллельных с резервными копиями</p></td>
<td><p>Windows Vista</p></td>
<td><p>Windows Server 2003 с пакетом обновления 2</p></td>
</tr>
<tr class="even">
<td><p>До 8 сеансов восстановления, одновременно с резервными копиями</p></td>
<td><p>Windows 7</p></td>
<td><p>Windows Server 2003 R2</p></td>
</tr>
</tbody>
</table>

## <a name="see-also"></a>См. также

[Служба теневого копирования томов в центре разработчиков Windows](https://docs.microsoft.com/windows/desktop/vss/volume-shadow-copy-service-overview)