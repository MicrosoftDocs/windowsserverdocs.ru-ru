---
title: Улучшения системы безопасности SMB
description: Описание функции шифрования SMB в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: b1586c8c63e46452075b4106c944670395734142
ms.sourcegitcommit: 21165734a0f37c4cd702c275e85c9e7c42d6b3cb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/03/2019
ms.locfileid: "65034403"
---
# <a name="smb-security-enhancements"></a>Улучшения системы безопасности SMB

>Относится к: Windows Server 2012 R2, Windows Server 2012, Windows Server 2016

В этом разделе объясняется, усовершенствования безопасности SMB в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.

## <a name="smb-encryption"></a>Шифрование SMB

Шифрование SMB обеспечивает end-to-end шифрование данных SMB и защищает данные от перехвата в недоверенных сетях. Шифрование SMB можно развернуть с минимальными усилиями, но может потребоваться небольшой дополнительные затраты для специализированного оборудования или программного обеспечения. Он не имеет требований безопасности протокола Интернета (IPsec) или ускорители WAN. Можно настроить шифрование SMB для отдельных ресурсов или для всего файлового сервера и его можно включить для различных сценариев, где данные проходят через недоверенные сети.

>[!NOTE]
>Шифрование SMB не рассматривается безопасность на уровне rest, который обычно осуществляется с помощью шифрования диска BitLocker.

Шифрование SMB следует рассматривать для любого сценария, в котором должна быть защищена от атак man-in--middle конфиденциальных данных. Вот возможные сценарии.

- Информационный работник конфиденциальных данных перемещается с помощью протокола SMB. Шифрование SMB предлагает гарантия целостности и конфиденциальности end-to-end между файлового сервера и клиента, независимо от того, сетей, просматривать, например соединения глобальной сети (WAN), которые поддерживаются поставщиками сторонних производителей.
- SMB 3.0 обеспечивает файловых серверов для обеспечения постоянно доступное хранилище для серверных приложений, таких как SQL Server или Hyper-V. Включение шифрования SMB предоставляет возможность защищать эти сведения от атак. Шифрование SMB проще в использовании, чем специальные аппаратные решения, которые требуются для большинства сетей хранения данных (SAN).

>[!IMPORTANT]
>Следует отметить, что имеется примечательным, эксплуатационные расходы, с какой-либо защиты шифрования end-to-end, по сравнению с без шифрования.

## <a name="enable-smb-encryption"></a>Включить шифрование SMB

Вы можете включить шифрование SMB для всего файлового сервера или только для определенных файловых. Чтобы включить шифрование SMB, используйте один из следующих процедур.

### <a name="enable-smb-encryption-with-windows-powershell"></a>Включить шифрование SMB с помощью Windows PowerShell

1. Чтобы включить шифрование SMB для отдельных файловый ресурс, введите следующий скрипт на сервере:
    
    ```PowerShell
    Set-SmbShare –Name <sharename> -EncryptData $true
    ```
2. Чтобы включить шифрование SMB для всего файлового сервера, введите следующий скрипт на сервере:
    
    ```PowerShell
    Set-SmbServerConfiguration –EncryptData $true
    ```
3. Чтобы создать новый файловый ресурс SMB с включенным шифрованием SMB, введите следующий скрипт:
    
    ```PowerShell
    New-SmbShare –Name <sharename> -Path <pathname> –EncryptData $true
    ```

### <a name="enable-smb-encryption-with-server-manager"></a>Включить шифрование SMB с помощью диспетчера серверов

1. В диспетчере серверов откройте **файловых служб и служб хранилища**.
2. Выберите **общих папок** чтобы открыть страницу управления общих ресурсов.
3. Щелкните правой кнопкой мыши общую папку, на котором вы хотите включить шифрование SMB, а затем выберите **свойства**.
4. На **параметры** страницы общего ресурса, выберите **шифровать доступ к данным**. Удаленный доступ к этой общей папке, шифруются.

### <a name="considerations-for-deploying-smb-encryption"></a>Рекомендации по развертыванию шифрования SMB

По умолчанию при включении шифрования SMB для общей папки или сервера, только клиентам SMB 3.0 разрешен доступ к указанных общих папок. Это обеспечивает намерения администратора повысилась данные для всех клиентов, которые обращаются к общим папкам. Тем не менее в некоторых случаях администратор может потребоваться разрешить незашифрованный доступ для клиентов, которые не поддерживают SMB 3.0 (например, во время переходного периода, при использовании смешанных клиентских операционных системах). Чтобы разрешить незашифрованный доступ для клиентов, которые не поддерживают SMB 3.0, введите следующий скрипт в Windows PowerShell:

```PowerShell
Set-SmbServerConfiguration –RejectUnencryptedAccess $false
```

Возможность согласования безопасного диалект, описанные в следующем разделе предотвращает атаки man-in--middle понижение соединение SMB 3.0 SMB 2.0 (которую будет использовать незашифрованный доступ). Тем не менее он не предотвращает понижение версии SMB 1.0, который также приведет незашифрованный доступ. Чтобы гарантировать, что клиенты SMB 3.0 всегда используют шифрование SMB для доступа к зашифрованным общим ресурсам, необходимо отключить сервер SMB 1.0. (Инструкции см. в разделе [отключение SMB 1.0](#disabling-smb-10).) Если **— RejectUnencryptedAccess** параметр остается в значения по умолчанию **$true**, только поддержкой шифрования SMB 3.0 клиенты получают доступ к к общим файловым ресурсам (клиенты SMB 1.0, будут также отклонены).

>[!NOTE]
>* Шифрование SMB использует Advanced Encryption Standard (AES)-CCM алгоритм для шифрования и расшифровки данных. AES-CCM также обеспечивает проверку целостности данных (подпись) для зашифрованных файловых ресурсов, независимо от того, параметры подписывания SMB. Если вы хотите включить подписывание без шифрования SMB, вы можете это сделать. Дополнительные сведения см. в разделе [основы из подписывание SMB](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/).
>* При попытке доступа к общей папки или сервера, если ваша организация использует устройства ускорение глобальной сети (WAN), могут возникнуть проблемы.
>* В конфигурации по умолчанию (где отсутствует незашифрованный доступ разрешен к общим папкам зашифрованный файл), если клиентов, которые не поддерживают SMB 3.0 попытка доступа к зашифрованной общей папке, 1003 ИД событий регистрируется в журнале событий Microsoft-Windows-SmbServer/Operational , и клиент получит **отказано в доступе** сообщение об ошибке.
>* Шифрование SMB и шифрованной файловой системы (EFS) в файловой системе NTFS не связаны, и шифрование SMB не требует и не зависят от используемой файловой системы EFS.
>* Шифрование SMB и шифрование диска BitLocker не связаны, и шифрование SMB не требует и не зависят от того, с помощью шифрования диска BitLocker.

## <a name="secure-dialect-negotiation"></a>Защита согласования диалектов

SMB 3.0 способен определить man-in--middle атак, которые пытаются понизить протокола SMB 2.0 или SMB 3.0 или возможности, которые клиент и сервер согласования. При выявлении такой атаки, клиентом или сервере произойдет отключение соединения, и событие 1005 идентификатор регистрируется в журнале событий Microsoft-Windows-SmbServer/Operational. Защита диалект согласование не удается обнаружить или предотвратить возврат к предыдущей версии SMB 2.0 или 3.0 SMB 1.0. По этой причине, а также воспользоваться всеми возможностями шифрования SMB настоятельно рекомендуется отключить сервер SMB 1.0. Дополнительные сведения см. в разделе [отключение SMB 1.0](#disabling-smb-10).

Возможность согласования безопасного диалект, описанное в следующем разделе предотвращает атаки man-in--middle понижение соединение SMB 3 SMB 2 (которую будет использовать незашифрованный доступ); Тем не менее он не предотвращает возврат к предыдущей версии SMB 1, что также приведет к незашифрованный доступ. Дополнительные сведения о потенциальных проблем с ранее не Windows реализациями SMB, см. в разделе [базы знаний Майкрософт](http://support.microsoft.com/kb/2686098).

## <a name="new-signing-algorithm"></a>Новый алгоритм подписи

SMB 3.0 использует более новый алгоритм шифрования для подписывания: Расширенный стандарт шифрования (AES) - cipher - на основе кода проверки подлинности сообщения (CMAC). SMB 2.0 используется устаревший алгоритм шифрования HMAC-SHA256. AES CMAC и AES-CCM могут значительно ускорить шифрование данных на большинство современных процессорах, имеющих поддерживают инструкции AES. Дополнительные сведения см. в разделе [основы из подписывание SMB](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/).

## <a name="disabling-smb-10"></a>Отключение SMB 1.0

Устаревшую службу браузера компьютеров и возможности протокола удаленного администрирования в SMB 1.0 теперь отделены, и они могут быть удалены. Эти функции по-прежнему включены по умолчанию, но если у вас нет старых клиентов SMB, таких как компьютеры под управлением Windows Server 2003 или Windows XP, можно удалить компоненты SMB 1.0 для повышения безопасности и потенциального снижения объема исправлений.

>[!NOTE]
>SMB 2.0 появилась в Windows Server 2008 и Windows Vista. Старые клиенты, например компьютеров под управлением Windows Server 2003 или Windows XP, не поддерживают SMB 2.0; и, следовательно, они не будут возможность доступа к общим папкам или общим принтерам, при отключении сервера SMB 1.0. Кроме того некоторые клиенты SMB сторонних разработчиков могут не иметь возможность доступа к общим папкам SMB 2.0 или печать общих ресурсов (например, принтеры с помощью функции «проверка share»).

Прежде чем начать, отключение SMB 1.0, необходимо выяснить, если клиенты SMB подключены к серверу под управлением SMB 1.0. Для этого введите следующий командлет в Windows PowerShell:

```PowerShell
Get-SmbSession | Select Dialect,ClientComputerName,ClientUserName | ? Dialect -lt 2
```

>[!NOTE]
>Этот скрипт следует запускать несколько раз в ходе недели (несколько раз в день), чтобы создать журнал аудита. Можно также запустить это как запланированная задача.

Чтобы отключить протокол SMB 1.0, введите следующий сценарий в Windows PowerShell:

```PowerShell
Set-SmbServerConfiguration –EnableSMB1Protocol $false
```

>[!NOTE]
>Если подключение по протоколу SMB клиента запрещено, так как сервер под управлением SMB 1.0 была отключена, идентификатор события 1001 будут регистрироваться в журнале событий Microsoft-Windows-SmbServer/Operational.

## <a name="more-information"></a>Дополнительные сведения

Ниже приведены ссылки на дополнительные сведения о SMB и связанных технологиях в Windows Server 2012.

- [Протокол SMB](file-server-smb-overview.md)
- [Хранилища в Windows Server](../storage.md)
- [Масштабируемый файловый сервер для данных приложений](../../failover-clustering/sofs-overview.md)