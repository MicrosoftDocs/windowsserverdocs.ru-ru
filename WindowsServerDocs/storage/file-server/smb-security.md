---
title: Улучшения в системе безопасности протокол SMB
description: Описание функции шифрования SMB в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 831ca8266c3ec18ffb83227dcb2d39b3f953ad1a
ms.sourcegitcommit: 375e94dc70c76e7aa5679c32f0f4dbc26cf7dd83
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2018
ms.locfileid: "2233530"
---
# <a name="smb-security-enhancements"></a>Улучшения в системе безопасности протокол SMB

>Применимо к: Windows Server 2012 R2, Windows Server 2012, Windows Server 2016

В этом разделе объясняется улучшения безопасности SMB в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.

## <a name="smb-encryption"></a>SMB Encryption

SMB Encryption обеспечивает шифрование данных SMB начала до конца и защищает данные от подслушивания вхождений в ненадежных сетях. SMB Encryption можно развернуть с минимальными усилиями, но она может потребоваться небольшой дополнительные затраты для специального оборудования или программного обеспечения. Он не имеет требований к безопасности протокола IP (IPsec) или ускорители глобальной сети. SMB Encryption можно настроить на основе каждой папки или для всей файлового сервера, и его можно включить для различных сценариев, где данные проходят через ненадежных сетей.

>[!NOTE]
>SMB Encryption не рассматриваются безопасность на уровне rest, которое обычно обрабатывается с помощью шифрования диска BitLocker.

SMB Encryption необходимо рассмотреть для любого сценария, в котором необходимо защитить в третьего конфиденциальных данных. Возможны следующие сценарии обновления:

- С помощью протокола SMB перемещать информационных работников конфиденциальных данных. SMB Encryption предлагает начала до конца целостности и конфиденциальности Software assurance между файлового сервера и клиента, вне зависимости от сети, обход, например соединения глобальной сети (WAN), которые обслуживают сторонних поставщиков.
- SMB 3.0 включает файловые серверы для хранения постоянно доступны для серверных приложений, таких как SQL Server или Hyper-V. Включение шифрования SMB позволяет предотвратить атаки слежения эти сведения. SMB Encryption более простой в использовании, чем выделенные аппаратных решений, которые необходимы для большинства сети хранения данных (SAN).

>[!IMPORTANT]
>Следует отметить, что является важным производительности эксплуатационные расходы с начала до конца шифрования защиту по сравнению с без шифрования.

## <a name="enable-smb-encryption"></a>Включение шифрования протокол SMB

SMB Encryption можно включить для всего файлового сервера или только для определенных общие файловые ресурсы. Включение шифрования SMB используйте одну из следующих процедур:

### <a name="enable-smb-encryption-with-windows-powershell"></a>Включение шифрования SMB с помощью Windows PowerShell

1. Чтобы включить протокол SMB Encryption для отдельных общей папки, введите следующий сценарий на сервере:
    
    ```PowerShell
    Set-SmbShare –Name <sharename> -EncryptData $true
    ```
2. Чтобы включить протокол SMB Encryption для всей файлового сервера, введите следующий сценарий на сервере:
    
    ```PowerShell
    Set-SmbServerConfiguration –EncryptData $true
    ```
3. Для создания новой общей папки SMB с поддержкой SMB Encryption, введите следующий скрипт:
    
    ```PowerShell
    New-SmbShare –Name <sharename> -Path <pathname> –EncryptData $true
    ```

### <a name="enable-smb-encryption-with-server-manager"></a>Включение шифрования SMB с помощью диспетчера сервера

1. В диспетчере сервера откройте **файл и служб хранилища**.
2. Выберите **Общие папки** для открытия страницы Управление общих папок.
3. Щелкните правой кнопкой мыши общий ресурс, на котором необходимо включить протокол SMB Encryption и выберите пункт **Свойства**.
4. На странице " **Параметры** " общей папки выберите **шифровать доступ к данным**. Удаленный доступ к этому общему ресурсу шифруются.

### <a name="considerations-for-deploying-smb-encryption"></a>Рекомендации по развертыванию SMB Encryption

По умолчанию при включении SMB Encryption для общей папки или сервера, только клиенты SMB 3.0 разрешен доступ к указанной общих папках. Это обеспечивает администратора смыслу защита данных для всех клиентов, которые доступа к общим ресурсам. Тем не менее в некоторых случаях администратор может потребоваться разрешить незашифрованные доступ для клиентов, которые не поддерживают SMB 3.0 (например, во время периода перехода, которые используются при смешанных клиентские версии операционной системы). Чтобы разрешить незашифрованные доступ для клиентов, которые не поддерживают протокол SMB 3.0, введите приведенный ниже сценарий Windows PowerShell:

```PowerShell
Set-SmbServerConfiguration –RejectUnencryptedAccess $false
```

Возможность согласования безопасной диалект, описанных в следующем разделе предотвращает атаки в середине понижение уровня подключение SMB 3.0 2.0 SMB (который будет использовать незашифрованное доступа). Тем не менее он не запрещает снижение уровня SMB 1.0, которые также привести незашифрованных доступа. Чтобы гарантировать, что клиенты SMB 3.0 всегда использовать шифрование SMB для доступа к общим ресурсам зашифрованные, необходимо отключить сервера SMB 1.0. (Для получения инструкций, обратитесь к разделу [Отключение SMB 1.0](#disabling-smb-1.0).) Параметр **– RejectUnencryptedAccess** остается в значения по умолчанию **$true**, только поддержкой шифрования клиенты SMB 3.0 разрешается доступ к общим ресурсам, (клиенты SMB 1.0 будет также отклонено).

>[!NOTE]
>* SMB Encryption использует расширенный стандарт шифрования (AES)-CCM алгоритм шифрования и расшифровки данных. AES-CCM также предоставляет проверку целостности данных (подпись) для общих зашифрованных файлов, независимо от того, параметры подписывания SMB. Если вы хотите включить протокол SMB подписи без шифрования, можно продолжить это сделать. Для получения дополнительных сведений см. [Основные сведения о подписи SMB](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/).
>* Проблемы могут возникнуть при попытке получить доступ к общей папки или сервера, если организация использует appliances ускорения глобальной сети (WAN).
>* С помощью конфигурации по умолчанию (где у пользователей нет доступа незашифрованных общих зашифрованных файлов), если клиенты, которые не поддерживают протокол SMB 3.0 попытка доступа зашифрованной общей папке, 1003 идентификатор события следует заносить в журнал событий Microsoft-Windows-SmbServer/операций , а клиент получит сообщение об ошибке **в доступе** .
>* SMB Encryption и шифрованной файловой системы (EFS) в файловой системе NTFS не связанных и SMB Encryption не требуется и не зависят от того, с помощью шифрованной файловой системы.
>* SMB Encryption и шифрования диска BitLocker не связанных и SMB Encryption не требуется и не зависят от того, с помощью шифрования диска BitLocker.

## <a name="secure-dialect-negotiation"></a>Согласование безопасного диалект

SMB 3.0 поддерживающего обнаружение атак в середине с целью перехода протокол SMB 2.0 или SMB 3.0 или возможностей, клиентские и серверные согласование. При обнаружении такой атаки путем клиент или сервер соединения и идентификатор 1005 записывается в журнал событий Microsoft-Windows-SmbServer/операций. Secure диалект согласования не удается обнаружить или предотвратить возврат к предыдущей версии с SMB 2.0 или 3.0 с SMB 1.0. В связи с этим и использовать все возможности SMB Encryption настоятельно рекомендуется отключить сервер SMB 1.0. Для получения дополнительных сведений см [Отключение SMB 1.0](#disabling-smb-1.0).

Возможность согласования безопасной диалект, как описано в следующем разделе предотвращает атаки в середине понижение уровня SMB 3 подключение 2 SMB (который будет использовать незашифрованное доступа); Тем не менее он не запрещает возврат к предыдущей версии 1 SMB, которые также привести незашифрованных доступа. Дополнительные сведения о потенциальных проблем с более ранних версий отличных от Windows реализациями SMB содержатся в [базе знаний Майкрософт](http://support.microsoft.com/kb/2686098).

## <a name="new-signing-algorithm"></a>Новый алгоритм подписи

SMB 3.0 использует последних алгоритм шифрования для подписания: улучшенный стандарт шифрования (AES) - шифр - на основе кода проверки подлинности сообщения (CMAC). SMB 2.0 используется старая алгоритм шифрования HMAC SHA256. AES-CMAC и AES CCM можно значительно повысить шифрование данных на большинство современных ЦП, которые имеют инструкции AES поддержки. Для получения дополнительных сведений см. [Основные сведения о подписи SMB](https://blogs.technet.microsoft.com/josebda/2010/12/01/the-basics-of-smb-signing-covering-both-smb1-and-smb2/).

## <a name="disabling-smb-10"></a>Отключение SMB 1.0

Службы обозревателя компьютеров прежних версий и функции удаленного администрирования протокол SMB 1.0 теперь отделенные и они могут быть удалены. Эти функции, по-прежнему включены по умолчанию, но если у вас нет старые клиенты SMB, например компьютеров под управлением Windows Server 2003 или Windows XP можно удалить компоненты SMB 1.0 для повышения безопасности и уменьшить исправления.

>[!NOTE]
>SMB 2.0 была введена в Windows Server 2008 и Windows Vista. Старые клиенты, например, компьютеры под управлением Windows Server 2003 или Windows XP не поддерживают протокол SMB 2.0; и, следовательно, они не смогут получать доступ к общих файлов или печать общих ресурсов, если этот параметр отключен сервер SMB 1.0. Кроме того некоторые клиенты SMB сторонних разработчиков может не могут получать доступ к SMB 2.0 общих файлов или печать общие папки (например, принтеров с помощью функции «сканирования для папки»).

Прежде чем начать, отключение SMB 1.0, необходимо выяснить, если клиенты SMB выполнено подключение к серверу под управлением SMB 1.0. Для этого введите следующий командлет в Windows PowerShell:

```PowerShell
Get-SmbSession | Select Dialect,ClientComputerName,ClientUserName | ? Dialect -lt 2
```

>[!NOTE]
>Этот сценарий следует запускать несколько раз в течение недели (несколько раз в день), чтобы создать журнал аудита. Можно также запустить это как запланированная задача.

Чтобы отключить протокол SMB 1.0, в Windows PowerShell введите следующий скрипт:

```PowerShell
Set-SmbServerConfiguration –EnableSMB1Protocol $false
```

>[!NOTE]
>Если подключение клиента SMB запрещен, поскольку отключена от сервера с SMB 1.0, событие с кодом 1001 заносятся в журнал событий Microsoft-Windows-SmbServer/операций.

## <a name="more-information"></a>Дополнительные сведения

Ниже приведены ссылки на дополнительные сведения о связанных технологиях в Windows Server 2012 и SMB.

- [Протокол SMB](file-server-smb-overview.md)
- [Хранилище в Windows Server](../storage.md)
- [Горизонтального масштабирования файлового сервера для данных приложения](../../failover-clustering/sofs-overview.md)