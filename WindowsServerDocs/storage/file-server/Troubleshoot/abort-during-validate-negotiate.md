---
title: Подключение TCP прервано во время проверки согласования
description: В этой статье объясняется, как устранить неполадки SMB при прерывании подключения TCP во время проверки согласования.
author: Deland-Han
manager: dcscontentpm
audience: ITPro
ms.topic: article
ms.author: delhan
ms.date: 12/25/2019
ms.openlocfilehash: 3455b4ac0a2706f80702378dda02c1877af219ca
ms.sourcegitcommit: 8cf04db0bc44fd98f4321dca334e38c6573fae6c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2020
ms.locfileid: "75654625"
---
# <a name="tcp-connection-is-aborted-during-validate-negotiate"></a>Подключение TCP прервано во время проверки согласования

В трассировке сети для проблемы SMB вы заметили, что в процессе проверки согласования произошла ошибка сброса TCP. В этой статье описывается устранение ситуации.

## <a name="cause"></a>Причина

Эта проблема может быть вызвана неудачной проверкой согласования. Обычно это происходит потому, что ускоритель WAN изменяет исходный пакет СОГЛАСОВАНия SMB.

Корпорация Майкрософт больше не разрешает вносить изменения в пакет проверки согласованности по любой причине. Это обусловлено тем, что такое поведение создает серьезную угрозу безопасности.

К пакету проверки согласованности применяются следующие требования.

- В процессе проверки согласования используется команда ФСКТЛ\_VALIDATE\_СОГЛАСОВАТЬ\_INFO.

- Ответ на проверку согласования должен быть подписан. В противном случае соединение будет прервано.

- Необходимо сравнить ФСКТЛ\_проверить\_СОГЛАСОВАТЬ\_сообщения с сообщениями об согласовании, чтобы убедиться в том, что ничего не изменилось.

## <a name="workaround"></a>Возможное решение

Процесс проверки согласованности можно временно отключить. Для этого откройте следующий подраздел реестра:

**HKEY\_локальный\_компьютер\\SYSTEM\\CurrentControlSet\\Services\\LanmanWorkstation\\параметры**

В разделе **параметров** задайте для **рекуиресекуренеготиате** значение **0**.

В Windows PowerShell можно выполнить следующую команду, чтобы задать это значение:

```PowerShell
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" RequireSecureNegotiate -Value 0 -Force
```

> [!NOTE]
> Процесс проверки согласованности не может быть отключен в Windows 10, Windows Server 2016 или более поздних версиях Windows.

Если клиент или сервер не могут поддерживать команду "проверить согласование", эту ошибку можно обойти, задав для подписывания SMB требуемый вариант. Подписывание SMB считается более безопасным, чем проверка согласованности. Однако при необходимости подписи также может снизиться производительность.

## <a name="reference"></a>Справочные материалы

Дополнительные сведения доступны в следующих статьях.

[3.3.5.15.12 Обработка запроса на проверку сведений о согласовании](https://docs.microsoft.com/openspecs/windows_protocols/ms-smb2/0b7803eb-d561-48a4-8654-327803f59ec6)

[3.2.5.14.12 Обработка ответа "проверить сведения о согласовании"](https://docs.microsoft.com/openspecs/windows_protocols/ms-smb2/6a5bc90d-3c08-4498-905b-e7dab30b2e0e)
