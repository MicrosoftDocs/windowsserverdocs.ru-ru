---
title: Устранение неполадок с многоканальными SMB
description: Представляет методы многоканального устранения неполадок SMB.
author: Deland-Han
manager: dcscontentpm
audience: ITPro
ms.topic: article
ms.author: delhan
ms.date: 12/25/2019
ms.openlocfilehash: 91f034a0062f509b1185f04554af4383022a68e1
ms.sourcegitcommit: 8cf04db0bc44fd98f4321dca334e38c6573fae6c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/03/2020
ms.locfileid: "75654545"
---
# <a name="smb-multichannel-troubleshooting"></a>Устранение неполадок с многоканальными SMB

В этой статье описывается, как устранять неполадки, связанные с многоканальным SMB.

## <a name="check-the-network-interface-status"></a>Проверка состояния сетевого интерфейса

Убедитесь, что для привязки сетевого интерфейса задано значение **true** в клиенте SMB (клиент MS\_) и на сервере SMB (сервер MS\_). При выполнении следующей команды на выходе должно отобразиться **значение true** в параметре **включено** для обоих сетевых интерфейсов:

```PowerShell
Get-NetAdapterBinding -ComponentID ms_server,ms_msclient
```

После этого убедитесь, что сетевой интерфейс указан в выходных данных следующих команд:

```PowerShell
Get-SmbServerNetworkInterface
```

```PowerShell
Get-SmbClientNetworkInterface
```

Можно также выполнить команду **Get-NetAdapter** , чтобы просмотреть индекс интерфейса для проверки результата. В индексе интерфейса отображаются все активные адаптеры SMB, которые активно привязаны к соответствующему интерфейсу.

## <a name="check-the-firewall"></a>Проверка брандмауэра

Если имеется только локальный IP-адрес, а адрес для общедоступной маршрутизации отсутствует, то скорее всего, сетевой профиль имеет значение **общедоступный**. Это означает, что по умолчанию SMB блокируется в брандмауэре.

Следующая команда показывает, какой профиль подключения используется. Для получения этих сведений можно также использовать центр управления сетями и общим доступом.

**Get-Нетконнектионпрофиле**

В группе " **общий доступ к файлам и принтерам** " проверьте правила входящего трафика брандмауэра, чтобы убедиться в том, что для правильного профиля включен протокол SMB-in.

![Правила SMB](media/smb-multichannel-troubleshooting-1.png)

Также можно включить **общий доступ к файлам и принтерам** в окне **центр управления сетями и общим доступом** . Для этого выберите **изменить дополнительные параметры общего доступа** в меню слева, а затем выберите **включить общий доступ к файлам и принтерам** для профиля. Этот параметр включает правила брандмауэра для общего доступа к файлам и принтерам.

![«Измените дополнительные параметры общего доступа»](media/smb-multichannel-troubleshooting-2.png)

## <a name="capture-client-and-server-sided-traffic-for-troubleshooting"></a>Запись клиентского и серверного трафика для устранения неполадок

Вам понадобятся данные трассировки подключения SMB, которые начинаются с 3-стороннего подтверждения TCP. Перед началом записи рекомендуется закрыть все приложения (особенно проводник Windows). Перезапустите службу **рабочей станции** на клиенте SMB, запустите запись пакетов и воспроизведите ошибку.

Убедитесь, что соединение SMBv3.*x* согласовывается и что между сервером и клиентом не влияет согласование диалекта. SMB 2.0 и более ранние версии не поддерживают многоканальную поддержку.

Найдите сетевой интерфейс\_\_информационные пакеты. Именно здесь SMB-клиент запрашивает список адаптеров от SMB-сервера. Если эти пакеты не обмениваются данными, то многоканальный канал не работает.

Сервер отвечает, возвращая список допустимых сетевых интерфейсов. Затем клиент SMB добавляет их в список доступных адаптеров для многоканального доступа. На этом этапе многоканальный запуск должен начинаться и, по крайней мере, пытаться запустить подключение.

Дополнительные сведения доступны в следующих статьях.

- [3.2.4.20.10 приложения запрашивают сетевые интерфейсы сервера](https://docs.microsoft.com/openspecs/windows_protocols/ms-smb2/147adde4-d936-4597-924a-8caa3429c6b0)

- [2.2.32.5 сетевой интерфейс\_\_ответа на сведения](https://docs.microsoft.com/openspecs/windows_protocols/ms-smb2/fcd862d1-1b85-42df-92b1-e103199f531f)

- [3.2.5.14.11 обработки ответа на сетевые интерфейсы](https://docs.microsoft.com/openspecs/windows_protocols/ms-smb2/5459722b-1eaa-4ead-b465-284363264cad)

В следующих сценариях нельзя использовать адаптер:

- На клиенте возникла ошибка маршрутизации. Обычно это вызвано неверной таблицей маршрутизации, которая заставляет трафик поверх неправильного интерфейса.

- Заданы многоканальные ограничения. Дополнительные сведения см. в разделе [New-смбмултичаннелконстраинт](https://docs.microsoft.com/powershell/module/smbshare/new-smbmultichannelconstraint).

- Что-то заблокировало пакеты запросов и ответов сетевого интерфейса.

- Клиент и сервер не могут взаимодействовать через дополнительный сетевой интерфейс. Например, сбой TCP-подключения с тремя способами, подключение блокируется брандмауэром, установка сеанса завершилась сбоем и т. д.

Если адаптер и его IPv6-адрес находятся в списке, отправляемом сервером, то следующим шагом будет определить, попытаются ли обмен данными с этим интерфейсом. Отфильтруйте трассировку по адресу локальной связи и трафику SMB и найдите попытки подключения. Если это NetConnection трассировка, можно также изучить события платформы фильтрации Windows (WFP), чтобы определить, блокируется ли подключение.
