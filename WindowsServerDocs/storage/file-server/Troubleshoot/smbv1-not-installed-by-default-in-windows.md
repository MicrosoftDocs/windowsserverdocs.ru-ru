---
title: SMBv1 не устанавливается по умолчанию в Windows 10 версии 1709, Windows Server версии 1709 и более поздних версиях.
description: Обсуждается поведение протокола SMBv1 в Windows 10 для дизайнеров Update и Windows Server версии 1709 и более поздних версий.
author: Deland-Han
manager: dcscontentpm
ms.topic: article
ms.author: delhan
ms.date: 07/01/2020
ms.openlocfilehash: 18c315a8b3562c25b5fe1c537a8922fc148e444b
ms.sourcegitcommit: c40c29683d25ed75b439451d7fa8eda9d8d9e441
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2020
ms.locfileid: "85833290"
---
# <a name="smbv1-is-not-installed-by-default-in-windows-10-version-1709-windows-server-version-1709-and-later-versions"></a>SMBv1 не устанавливается по умолчанию в Windows 10 версии 1709, Windows Server версии 1709 и более поздних версиях.

## <a name="summary"></a>Сводка

В Windows 10 с обновлением и Windows Server версии 1709 (RS3) и более поздних версий сетевой протокол SMB Server Block версии 1 (SMBv1) больше не устанавливается по умолчанию. Он был заменен на протоколы SMB 2.0 и более поздних версий, начиная с 2007. Корпорацией Майкрософт общедоступный протокол SMBv1 не рекомендуется в 2014. 

SMBv1 имеет следующее поведение в Windows 10 и Windows Server, начиная с версии 1709 (RS3): 
 
- В SMBv1 теперь есть и клиентские, и серверные функции, которые можно удалить отдельно.    
- Windows 10 Корпоративная, Windows 10 для образовательных учреждений и Windows 10 Pro для рабочих станций больше не содержат клиент или сервер SMBv1 по умолчанию после чистой установки.    
- Windows Server 2016 больше не содержит клиент или сервер SMBv1 по умолчанию после чистой установки.    
- Windows 10 Домашняя и Windows 10 Pro больше не содержат сервер SMBv1 по умолчанию после чистой установки.    
- Windows 10 Домашняя и Windows 10 Pro по умолчанию по-прежнему содержат клиент SMBv1 после чистой установки. Если клиент SMBv1 не используется в течение 15 дней (без выключения компьютера), он автоматически удаляется.    
- Обновления на месте и предварительные выпуски Windows 10 Home и Windows 10 Pro не удаляют автоматически SMBv1 изначально. Если клиент или сервер SMBv1 не используется в течение 15 дней (за исключением времени, в течение которого компьютер отключен), каждый из них автоматически удаляется.     
- Обновления на месте и Insider Preview в выпусках Windows 10 Корпоративная, Windows 10 для образовательных учреждений и Windows 10 Pro для рабочих станций не удаляются автоматически SMBv1. Администратор должен решить удалить SMBv1 в этих управляемых средах. 
- Автоматическое удаление SMBv1 через 15 дней является одноразовой операцией. Если администратор повторно устанавливает SMBv1, дальнейшие попытки его удаления не будут предприняты.
- Функции SMB версии 2,02, 2,1, 3,0, 3,02 и 3.1.1 по-прежнему полностью поддерживаются и включены по умолчанию в составе двоичных файлов SMB.    
- Поскольку служба обозревателя компьютеров использует SMBv1, служба удаляется, если клиент SMBv1 или сервер удаляются. Это означает, что сеть обозревателя больше не может отображать компьютеры Windows с помощью устаревшего метода просмотра датаграмм NetBIOS.    
- SMBv1 можно по-прежнему переустанавливать во всех выпусках Windows 10 и Windows Server 2016.    

SMBv1 имеет следующие дополнительные поведения в Windows 10, начиная с версии 1809 (RS5). Все остальные поведения версии 1709 по-прежнему применимы:

- Windows 10 Pro больше не содержит клиент SMBv1 по умолчанию после чистой установки.
- В Windows 10 Корпоративная, Windows 10 для образовательных учреждений и Windows 10 Pro для рабочих станций администратор может активировать автоматическое удаление SMBv1, включив функцию "SMB 1.0/CIFS Automatic reremoval".

  > [!NOTE]
  > Windows 10 версии 1803 (RS4) Pro обрабатывает SMBv1 так же, как Windows 10, версия 1703 (RS2) и Windows 10, версия 1607 (RS1). Эта проблема была исправлена в Windows 10 версии 1809 (RS5). Вы по-прежнему можете удалить SMBv1 вручную. Однако Windows не будет автоматически удалять SMBv1 через 15 дней в следующих сценариях: 

-  Вы выполняете чистую установку Windows 10, версия 1803.     
-  Обновление Windows 10, версии 1607 или Windows 10, версии 1703 до Windows 10 версии 1803 напрямую без предварительного обновления до Windows 10, версия 1709.     
 
При попытке подключения к устройствам, поддерживающим только SMBv1, или если эти устройства пытаются подключиться к вам, может появиться одно из следующих сообщений об ошибке:     

```
You can't connect to the file share because it's not secure. This share requires the obsolete SMB1 protocol, which is unsafe and could expose your system to attack.
Your system requires SMB2 or higher. For more info on resolving this issue, see: https://go.microsoft.com/fwlink/?linkid=852747  
```

```
The specified network name is no longer available.
```

```
Unspecified error 0x80004005
```

```
System Error 64
```

```
The specified server cannot perform the requested operation.
```

```
Error 58
```    

Следующие события появляются, когда удаленному серверу требуется подключение SMBv1 от этого клиента, но SMBv1 удалено или отключено на клиенте.

```
Log Name:      Microsoft-Windows-SmbClient/Security
 Source:        Microsoft-Windows-SMBClient
 Date:          Date/Time
 Event ID:      32002
 Task Category: None
 Level:         Info
 Keywords:      (128)
 User:          NETWORK SERVICE
 Computer:      junkle.contoso.com
 Description:
 The local computer received an SMB1 negotiate response. 

Dialect: 
SecurityMode 
Server name: 

Guidance: 
SMB1 is deprecated and should not be installed nor enabled. For more information, see https://go.microsoft.com/fwlink/?linkid=852747.
```

```
Log Name:      Microsoft-Windows-SmbClient/Security
 Source:        Microsoft-Windows-SMBClient
 Date:          Date/Time
 Event ID:      32000
 Task Category: None
 Level:         Info
 Keywords:      (128)
 User:          NETWORK SERVICE
 Computer:      junkle.contoso.com
 Description: 
SMB1 negotiate response received from remote device when SMB1 cannot be negotiated by the local computer. 
Dialect: 
Server name: 

Guidance: 
The client has SMB1 disabled or uninstalled. For more information: https://go.microsoft.com/fwlink/?linkid=852747.     
```

Эти устройства, скорее всего, не работают под Windows.Более вероятно, что они используют более старые версии Linux, Samba или других типов сторонних программ для предоставления служб SMB. Часто эти версии Linux и Samba, в свою очередь, больше не поддерживаются. 

> [!NOTE]
> Windows 10, версия 1709 также называется «обновлением источников обновления».   

## <a name="more-information"></a>Дополнительные сведения

Чтобы обойти эту ошибку, обратитесь к изготовителю продукта, который поддерживает только SMBv1, и запросите обновление программного обеспечения или встроенного по, которое поддерживает Смбв 2.02 или более позднюю версию. Текущий список известных поставщиков и их требования к SMBv1 см. в статье блог группы по проектированию хранилища Windows и Windows Server: 

[SMBv1ная палата продукта](https://techcommunity.microsoft.com/t5/Storage-at-Microsoft/SMB1-Product-Clearinghouse/ba-p/426008) 
#### <a name="leasing-mode"></a>Режим аренды

Если SMBv1 требуется для обеспечения совместимости приложений для поведения устаревшего программного обеспечения, например для отключения операционные блокировки, Windows предоставляет новый флаг общего ресурса SMB, известный как режим аренды. Этот флаг указывает, отключает ли общий ресурс современные семантики SMB, такие как аренда и операционные блокировки.

Вы можете указать общий ресурс без использования операционные блокировки или аренды, чтобы разрешить устаревшему приложению работать с SMB 2.0 или более поздней версией. Для этого используйте командлеты PowerShell **New-модуль SMBshare** или **Set-модуль SMBshare** вместе с параметром **-леасингмоде None**   .

> [!NOTE]
> Этот параметр следует использовать только для общих папок, которые требуются сторонним приложениям для поддержки устаревшей версии, если поставщик сообщает о необходимости. Не указывайте режим аренды для общих папок данных пользователя или общих ресурсов ЦС, которые используются масштабируемыми файловыми серверами. Это обусловлено тем, что удаление операционные блокировки и аренд приводит к нестабильной работе и повреждению данных в большинстве приложений. Режим аренды работает только в режиме совместного использования. Он может использоваться любой клиентской операционной системой.

#### <a name="explorer-network-browsing"></a>Обозреватель сети обозревателя

Служба обозревателя компьютеров использует протокол SMBv1 для заполнения сетевого узла проводника Windows (также называемого «сетевое окружение»). Этот устаревший протокол является устаревшим, не направляется в маршрут и имеет ограниченный уровень безопасности. Так как служба не может работать без SMBv1, она удаляется в то же время.

Однако если вам по-прежнему нужно использовать Explorer Входящий сетевой трафик домашних и малых рабочих сред Рабочей группы для нахождение компьютеров под управлением Windows, можно выполнить следующие действия на компьютерах под управлением Windows, которые больше не используют SMBv1: 
 
1. Запустите службы "узел поставщика обнаружения функций" и "Публикация ресурсов обнаружения функций", а затем установите для них значение **автоматически (отложенный запуск)**.

2. При открытии обозревателя сети включите обнаружение сети при появлении соответствующего запроса.    
 
Все устройства Windows в этой подсети с этими параметрами теперь будут отображаться в сети для обзора. В этом случае используется протокол WS-DISCOVERY. Обратитесь к другим поставщикам и производителям, если их устройства по-прежнему не отображаются в списке просмотра после появления устройств Windows. Возможно, этот протокол отключен или поддерживает только SMBv1.

> [!NOTE]
> Рекомендуется подключать диски и принтеры вместо включения этой функции, которая по-прежнему требует поиска и обзора устройств. Сопоставленные ресурсы проще в поиске, нуждаются в меньшем объеме обучения и более безопасны для использования. Это особенно верно, если эти ресурсы предоставляются автоматически с помощью групповая политика.Администратор может настроить принтеры для расположения с помощью методов, отличных от устаревшей службы браузера компьютеров, используя IP-адреса, домен Active Directory службы (AD DS), Bonjour, MDN, uPnP и т. д.

Если вы не можете использовать какие-либо из этих обходных путей или если производитель приложения не может предоставить Поддерживаемые версии SMB, можно повторно включить SMBv1 вручную, выполнив действия, описанные в статье [обнаружение, включение и отключение SMBv1, SMB и SMBv3 в Windows](detect-enable-and-disable-smbv1-v2-v3.md).

> [!IMPORTANT]
> Настоятельно рекомендуется не переустанавливать SMBv1. Это связано с тем, что этот старый протокол имеет известные проблемы безопасности, связанные с программой-шантажистом и другими вредоносными программами.  

#### <a name="windows-server-best-practices-analyzer-messaging"></a>Обмен сообщениями с анализатором соответствия рекомендациям Windows Server

Серверные системы Windows Server 2012 и более поздних версий содержат анализатор соответствия рекомендациям (BPA) для файловых серверов. Если вы выполнили правильное онлайн-руководство по удалению SMB1, при запуске этого анализатора соответствия рекомендациям будет возвращено несовместимое сообщение с предупреждением:

    Title: The SMB 1.0 file sharing protocol should be enabled
    Severity: Warning
    Date: 3/25/2020 12:38:47 PM
    Category: Configuration
    Problem: The Server Message Block 1.0 (SMB 1.0) file sharing protocol is disabled on this file server.
    Impact: SMB not in a default configuration, which could lead to less than optimal behavior.
    Resolution: Use Registry Editor to enable the SMB 1.0 protocol.

Следует игнорировать это конкретное руководство по правилу анализатора соответствия рекомендациям, оно не рекомендуется к использованию. Мы повторим: не включайте SMB 1,0.

## <a name="references"></a>Ссылки

[Отключить с помощью SMB1](https://aka.ms/stopusingsmb1)
