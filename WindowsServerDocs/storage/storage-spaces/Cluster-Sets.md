---
title: Наборы кластеров
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 01/30/2019
description: В этой статье описан сценарий наборы кластера
ms.localizationpriority: medium
ms.openlocfilehash: 2deeb6968f910e80bacb2354ad2e575060a7797a
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59833955"
---
# <a name="cluster-sets"></a>Наборы кластеров

> Область применения. Сборки Windows Server Insider Preview 17650 и более поздние версии

Наборы кластера — новая технология горизонтального масштабирования облака в этой предварительной версии, увеличивающий количество узлов кластера в одной облачной Center определенных данных (SDDC) программного обеспечения порядков. Кластер набора — это слабо связанная группа несколькими отказоустойчивыми кластерами: вычислений, служба хранилища или гиперконвергентная. Кластера задает включает технологию текучесть виртуальной машины между кластерами член в рамках набора кластера и пространство имен объединенного хранения по всему набору для поддержки текучесть виртуальной машины. 

Во время сохранения существующего отказоустойчивого кластера действия по управлению пользователями в кластерах член, в экземпляре набора кластера, кроме того, предлагает основные варианты использования решения управления жизненным циклом в агрегатной функции. Это предварительная версия сценария оценки руководство по Windows Server предоставляет необходимые сведения, а также пошаговые инструкции для оценки технологии наборов кластера с помощью PowerShell. 

## <a name="technology-introduction"></a>Общие сведения о технологии

Технологии кластеров наборы разработана для удовлетворения запросов конкретного клиента, эксплуатации программного обеспечения определенный центр обработки данных (SDDC) облаков в нужном масштабе. Ценностное предложение наборы кластера в этой предварительной версии можно сводить следующим образом:  

- Значительно увеличьте SDDC cloud масштабирования, поддерживаемые для запуска виртуальных машин высокой надежности, объединяя несколько небольших кластеров в одной большой структуре, даже сохраняя граница сбоя программного обеспечения для одного кластера
- Управление весь жизненный цикл отказоустойчивого кластера, включая адаптации и снятия с учета кластеров под управлением Windows, не влияя на доступность виртуальных машин клиента, с помощью гибкого миграция виртуальных машин по этой большой структуры
- Легко изменить соотношение вычислений в хранилище в вашей гиперконвергентной я
- Преимущества [стиле Azure домены сбоя и группы доступности](htttps://docs.microsoft.com/azure/virtual-machines/windows/manage-availability) между кластерами в расположение исходной виртуальной машины Linux и перенос последующих виртуальной машины
- Сопоставлять и совмещать различные поколения ЦП в одном кластере задать fabric, даже сохраняя домены сбоя отдельных однородные для достижения максимальной эффективности.  Обратите внимание на то, что рекомендация такое же оборудование по-прежнему присутствует в пределах каждого отдельного кластера, а также набор всего кластера.

Представление высокого уровня это кластер, какие наборы может выглядеть следующим образом.

![Кластер задает представление решения](media\Cluster-sets-Overview\Cluster-sets-solution-View.png)

Ниже представлен краткая сводка по каждому элементу в приведенном выше рисунке.

**Кластер управления**

Кластер управления в наборе кластера — отказоустойчивый кластер, на котором размещена плоскости управления с высоким уровнем доступности набора весь кластер и ссылки пространства имен (пространство имен задать кластера) объединенного хранения масштабируемого файлового сервера (SOFS). Кластер управления логически отделена от члена кластеров, которые выполняют рабочие нагрузки виртуальных машин. Это делает кластере, плоскость управления устойчивым к любой локальных сбоев на уровне кластера, например отключения питания члена кластера.   

**Член кластера**

Член кластера в наборе кластера обычно является традиционного гиперконвергентного кластера под управлением виртуальной машины и дисковых рабочих нагрузок. Несколько кластеров для члена участвуют в развертывании набора один кластер, формирование большего размера фабрики данных облака SDDC. Член кластеры отличаются от управления кластера в два ключевых аспекта: член кластеров участвовать в домене сбоя и конструкций, группа доступности кластеров для члена также имеют размер узла виртуальной машины и дисковых рабочих нагрузок. Кластер набора виртуальных машин, перемещения за границы кластеров в наборе кластера, не должны размещаться в кластере управления по этой причине.

**Кластер задать пространство имен ссылок масштабируемого файлового сервера**

Ссылка пространства имен набора кластера (кластер задать пространство имен) SOFS-это масштабируемого файлового сервера, при котором каждый общий ресурс SMB на масштабируемом файловом СЕРВЕРЕ кластера задать пространство имен является общим ссылок — типа SimpleReferral впервые представлена в этой предварительной версии.  Такая ссылка позволяет клиентам Server Message Block (SMB), доступ к целевому общий ресурс SMB, размещенную в кластере член масштабируемого файлового сервера. Кластер задать пространство имен ссылок масштабируемого файлового сервера — это механизм, упрощенная ссылок и таким образом, не участвует в пути ввода-вывода. SMB продолжительности кэширования ссылки постоянно для каждого из клиентских узлов и пространство имен наборов кластер динамически обновляется автоматически этих ссылок при необходимости.

**Задайте главного кластера**

В наборе кластера обмен данными между кластерами член слабосвязанной и, принимает новый ресурс кластера «Cluster задать Master» (CS-Master). Как и любого другого ресурса кластера CS-Master является высокая доступность и устойчивость к сбоев отдельных членов кластера и/или сбои узлов кластера управления. Через новый поставщик WMI задать кластера CS-Master предоставляет конечную точку управления для всех взаимодействий управляемости задать кластера.

**Рабочий набор кластера**

При развертывании кластера задайте CS-Master взаимодействует с ресурса кластера в элементе кластеров, называемый кластера задайте» рабочая роль «(CS-рабочих процессов). CS-Worker выступает в качестве только звеном в кластере для координации взаимодействия локального кластера по запросу CS-Master. Такие взаимодействия примеры размещения виртуальных машин и Инвентаризация ресурсов локального кластера. Есть только один экземпляр CS-Worker для каждого члена кластеров в кластере набора. 

**домен сбоя**

Домен сбоя — группирование программного обеспечения и оборудования артефакты, которые администратор определяет, удалось отрабатывают при возникновении сбоя.  Хотя администратор может назначить один или несколько кластеров друг с другом домене сбоя, каждый узел может участвовать в домене сбоя в группе доступности. Кластера задает, оставляет разработки решение определение границ домена сбоя для администраторов, которые отлично осведомлены аспекты топологии центра данных — например PDU сети – что член кластеры используют. 

**Группа доступности**

Группа доступности позволяет администратору настроить требуемый избыточность кластерных рабочих нагрузок между доменами сбоя, организации их в группу доступности и развертывании рабочих нагрузок в этой группе доступности. Предположим, при развертывании 2 уровневого приложения, мы рекомендуем настроить по крайней мере две виртуальные машины в группу доступности для каждого уровня, это даст гарантию, что при одном домене сбоя в этой группе доступности выходит из строя, приложение по крайней мере будет иметь одна виртуальная машина на каждом уровне, размещенного в домене сбоя, одну группу доступности.

## <a name="why-use-cluster-sets"></a>Зачем использовать наборы кластера

Наборы кластера предоставляет преимущества масштабируемости без ущерба для обеспечения устойчивости.  

Наборы кластера для кластеризации нескольких кластеров позволяет вместе для создания больших fabric, хотя каждый кластер остается независимой для обеспечения устойчивости.  Например, у вас есть несколько HCI четырьмя узлами кластеров, работающих виртуальных машин.  Каждый кластер обеспечивает устойчивость, необходимые для себя.  Если хранилище или памяти, заканчивается, допустимо следующий шаг.  При масштабировании, существует несколько вариантов и соображений.

1. Добавьте дополнительный объем хранилища для текущего кластера.  С дисковыми пространствами это может быть непростой задачей как точное же модель и встроенного по дисков могут быть недоступны.  Также необходимо принимать во внимание то самое время перестроения.
2. Добавьте дополнительную память.  Что делать, если вы максимальном числе в памяти, который может обрабатывать компьютеров?  Что делать, если все слоты доступной памяти полны?
3. Добавление дополнительных вычислительных узлов с дисками в текущем кластере.  Это приводит нас обратно вариант 1 нужно считать.
4. Приобрести совершенно нового кластера

Это где наборы кластера обеспечивает преимущества масштабирования.  Если добавить моих кластеров в кластере набор, можно воспользоваться хранилища или памяти, которое может быть доступно в другой кластер без все дополнительные покупки.  С точки зрения обеспечения устойчивости Добавление дополнительных узлов Storage Spaces Direct не будет для предоставления дополнительных голосов для кворума.  Как уже упоминалось [здесь](drive-symmetry-considerations.md), кластер прямой пробелы хранилища может выдержать потерю 2 узла, прежде чем прибегать.  Если у вас есть кластер с 4 узлами HCI, 3 узлов будут выключены займет всего кластера.  Если у вас есть кластер из 8 узлов, 3 узлов будут выключены займет всего кластера.  При использовании кластера наборов, которые содержит два кластера HCI 4 узлов в наборе 2 узлов в один HCI будут выключены и один узел в других HCI вышли из строя, непрерывно оба кластера.  Что лучше создать один большой кластер с локальными дисковыми пространствами 16 узлов или разбить его на четыре четырьмя узлами кластера и использовать наборы кластера?  Наличие четыре четырьмя узлами кластеров с кластера предоставляет наборы той же шкале, но лучшую устойчивость, в том, что несколько вычислительных узлов можно перейти (неожиданно или обслуживания) и остается в рабочей среде.

## <a name="considerations-for-deploying-cluster-sets"></a>Основные моменты при развертывании кластера наборов

При рассмотрении, если наборы кластера является то, что вам нужно использовать, задайте себе следующие вопросы:

- Вам нужно выйти за пределы текущей HCI вычислений и хранения ограничения на масштабирование?
- Все вычислительные ресурсы и хранилище не совпадают одинаково?
- Динамической миграции виртуальных машин между кластерами?
- Следует включить группы доступности на компьютере Azure и доменов сбоя между несколькими кластерами.
- Требуется выделить время для просмотра всех кластеров, чтобы определить, где необходимо разместить новых виртуальных машин?

Если ваш ответ «Да», затем наборы кластера вам нужен.

Существует несколько других элементов, которые следует учитывать, где большего размера SDDC должны измениться стратегии центра данных в целом.  SQL Server представляет собой хороший пример.  Перемещение виртуальных машин SQL Server между кластерами требует лицензирования SQL для запуска на дополнительных узлах?  

## <a name="scale-out-file-server-and-cluster-sets"></a>Масштабируемый файловый сервер и задает кластера

В Windows Server 2019 имеется новую роль масштабируемого файлового сервера вызывается инфраструктуры масштабируемого файлового сервера (SOFS). 

Роль масштабируемого файлового сервера инфраструктуры в следующие соображения.

1.  Может существовать только одна роль кластера масштабируемых файловых СЕРВЕРОВ инфраструктуры в отказоустойчивом кластере. Инфраструктурную роль масштабируемого файлового сервера создается с помощью указания "**-инфраструктуры**" Переключение параметра **ClusterScaleOutFileServerRole добавить** командлета.  Пример:

        Add-ClusterScaleoutFileServerRole -Name "my_infra_sofs_name" -Infrastructure

2.  Каждый том CSV, создается автоматически в отработке отказа инициирует создание общей папки SMB с автоматически созданным именем на основе имени тома CSV. Администратор не может непосредственного создания или изменения общих ресурсов SMB в рамках роли масштабируемого файлового сервера, отличные от посредством операций Создание и изменение тома CSV.

3.  В гиперконвергентных конфигурациях масштабируемом файловом СЕРВЕРЕ инфраструктуры позволяет SMB-клиент (узел Hyper-V) для взаимодействия с гарантированной непрерывной доступности (ЦС) для инфраструктуры масштабируемого файлового сервера SMB-сервере. Этот гиперконвергентной SMB замыкания на себя ЦС осуществляется через виртуальные машины, обращается к их файлам виртуального диска (VHDx), пересылаются владельца удостоверения виртуальной машины между клиентом и сервером. Такой способ пересылки identity позволяет ACL-ing vhdx-файлы, как в стандартных гиперконвергированного кластера конфигурациями, что перед.

После создания кластера набора имен набора кластера полагается на масштабируемом файловом СЕРВЕРЕ инфраструктуры на каждом из кластеров для члена, кроме инфраструктуры масштабируемом файловом СЕРВЕРЕ в кластере управления.

Во время член кластера добавляется в набор кластера администратор указывает имя SOFS инфраструктуры в этом кластере, если таковая имеется. Если масштабируемых файловых СЕРВЕРОВ инфраструктуры не существует, новая роль масштабируемого файлового сервера инфраструктуры в новом кластере члена создается этой операцией. Если роль масштабируемого файлового сервера инфраструктуры, уже существует в кластере член, операции добавления неявно переименовывает его указанному имени при необходимости. Все существующие серверы SMB одноэлементный или SOFS, отличных от инфраструктуры роли в члене кластеров остаются неиспользуемую набором кластера. 

Во время создания кластера набора администратор имеет возможность использования объекта компьютера AD уже существующие в корневом пространстве имен в кластере управления. Операции по созданию кластера набора создайте роль кластера масштабируемых файловых СЕРВЕРОВ инфраструктуры в кластере управления или переименовывает существующую роль масштабируемого файлового сервера инфраструктуры, так же как описано выше для кластеров для члена. Масштабируемых файловых СЕРВЕРОВ инфраструктуры в кластере управления используется как кластер набора ссылок на пространства имен (кластера задать пространство имен) масштабируемого файлового сервера. Это просто означает, что каждый общий ресурс SMB в кластере задано пространство имен, которое масштабируемого файлового сервера является общим ссылок — из типа «SimpleReferral» - впервые представлена в этой предварительной версии.  Такая ссылка позволяет SMB клиентам доступ к целевому объекту, общая папка SMB, размещенной на член кластера масштабируемых файловых СЕРВЕРОВ. Кластер задать пространство имен ссылок масштабируемого файлового сервера — это механизм, упрощенная ссылок и таким образом, не участвует в пути ввода-вывода. SMB продолжительности кэширования ссылки постоянно для каждого из клиентских узлов и пространство имен наборов кластер динамически обновляется автоматически этих ссылок при необходимости

## <a name="creating-a-cluster-set"></a>Создание набора кластера

### <a name="prerequisites"></a>Предварительные требования

При создании кластера набора следующие предварительные требования, рекомендуется:

1. Настройте клиент управления под управлением последний выпуск программы предварительной оценки Windows Server.
2. Установите средства отказоустойчивого кластера на этом сервере управления.
3. Создание членов кластера (по крайней мере двумя кластерами с по крайней мере два общих томов кластера на каждом кластере)
4. Создайте кластер управления (физический или гостя), который служит связующим звеном кластеров для члена.  Такой подход гарантирует, что наборы кластера, которые плоскость управления продолжает работать независимо от сбоев возможных члена кластера.

### <a name="steps"></a>Действия

1. Создание нового кластера набор из трех кластеров, как указано в предварительных требованиях.  Под диаграммой приведен пример создания кластеров.  Имя кластера, задать в этом примере будет **CSMASTER**.

   | Имя кластера               | Имя масштабируемого файлового сервера инфраструктуры для использования в будущем | 
   |----------------------------|-------------------------------------------|
   | КЛАСТЕР НАБОРА                | CLUSTERSET МАСШТАБИРУЕМОГО ФАЙЛОВОГО СЕРВЕРА                           |
   | CLUSTER1                   | CLUSTER1 МАСШТАБИРУЕМОГО ФАЙЛОВОГО СЕРВЕРА                             |
   | CLUSTER2                   | CLUSTER2 МАСШТАБИРУЕМОГО ФАЙЛОВОГО СЕРВЕРА                             |

2. После создания всех кластера, используйте следующие команды для создания набора главного кластера.

        New-ClusterSet -Name CSMASTER -NamespaceRoot SOFS-CLUSTERSET -CimSession SET-CLUSTER

3. Добавление сервера кластера в наборе кластера ниже будет использоваться.

        Add-ClusterSetMember -ClusterName CLUSTER1 -CimSession CSMASTER -InfraSOFSName SOFS-CLUSTER1
        Add-ClusterSetMember -ClusterName CLUSTER2 -CimSession CSMASTER -InfraSOFSName SOFS-CLUSTER2

   > [!NOTE]
   > Если вы используете схему статический IP-адрес, необходимо включить *x.x.x.x - StaticAddress* на **New ClusterSet** команды.

4. После создания кластере, из состава кластера, можно перечислить набор узлов и его свойства.  Для перечисления всех кластеров элемента в наборе кластера:

        Get-ClusterSetMember -CimSession CSMASTER

5. Для перечисления всех кластеров в кластере, включая узлы кластера управления члена:

        Get-ClusterSet -CimSession CSMASTER | Get-Cluster | Get-ClusterNode

6. Чтобы получить список всех узлов из кластеров члена:

        Get-ClusterSetNode -CimSession CSMASTER

7. Чтобы получить список всех групп ресурсов по всему набору кластера:

        Get-ClusterSet -CimSession CSMASTER | Get-Cluster | Get-ClusterGroup 

8. Проверка кластера набора создан один общий ресурс SMB (определенный как Volume1 или любую папку CSV помечается ScopeName, из которых является именем инфраструктуры файлового сервера и путь, что и аргументы) процесс создания масштабируемого файлового сервера инфраструктуры для каждого члена кластера Тома CSV:

        Get-SmbShare -CimSession CSMASTER

8. Наборы кластера имеет журналы отладки, которые могут быть собраны для проверки.  Установки кластера и журналы отладки кластера собираются для всех элементов и кластера управления.

        Get-ClusterSetLog -ClusterSetCimSession CSMASTER -IncludeClusterLog -IncludeManagementClusterLog -DestinationFolderPath <path>

9. Настройка Kerberos [ограниченное делегирование](https://blogs.technet.microsoft.com/virtualization/2017/02/01/live-migration-via-constrained-delegation-with-kerberos-in-windows-server-2016/) между все кластера задайте элементов.

10. Настройте тип проверки подлинности динамической миграции виртуальной машины между кластерами, Kerberos на каждом узле в кластере.

        foreach($h in $hosts){ Set-VMHost -VirtualMachineMigrationAuthenticationType Kerberos -ComputerName $h }

11. Добавьте кластер управления в группу локальных администраторов на каждом узле в наборе кластера.

        foreach($h in $hosts){ Invoke-Command -ComputerName $h -ScriptBlock {Net localgroup administrators /add <management_cluster_name>$} }

## <a name="creating-new-virtual-machines-and-adding-to-cluster-sets"></a>Создание новых виртуальных машин и добавление к наборам кластера

После создания кластера, следующим шагом является создание новых виртуальных машин.  Как правило когда пора создавать виртуальные машины и добавление их в кластер, вам нужно некоторые проверки на кластерах также просмотреть, какие оптимальным для выполнения на.  Эти проверки могут включать:

- Какой объем памяти, доступной на узлах кластера?
- Объем дискового пространства на узлах кластера?
- Требуется ли виртуальная машина особые требования хранению (т. е. я хочу, чтобы Мои виртуальные машины SQL Server, чтобы перейти на кластер под управлением более быстрые диски; или, моя инфраструктура виртуальная машина не такой критический, которое может работать в более медленных дисков).

После этого ответы, созданием виртуальной машины в кластере, необходимо быть.  Из преимуществ использования наборов кластера существует сделать этих проверок для вас наборов кластера и разместить виртуальную машину на узле, самый оптимальный.

Следующие команды будут оба определения оптимальной кластера и развернуть виртуальную машину к нему.  В следующем примере создается виртуальную машину указания, что по крайней мере 4 ГБ памяти для виртуальной машины и что ему придется использовать 1 виртуальный процессор.

- Убедитесь, что доступно 4 ГБ для виртуальной машины
- Задайте виртуальный процессор, используемый на 1
- Убедитесь, что имеется по крайней мере 10% ресурсов ЦП, доступных для виртуальной машины

   ```PowerShell
   # Identify the optimal node to create a new virtual machine
   $memoryinMB=4096
   $vpcount = 1
   $targetnode = Get-ClusterSetOptimalNodeForVM -CimSession CSMASTER -VMMemory $memoryinMB -VMVirtualCoreCount $vpcount -VMCpuReservation 10
   $secure_string_pwd = convertto-securestring "<password>" -asplaintext -force
   $cred = new-object -typename System.Management.Automation.PSCredential ("<domain\account>",$secure_string_pwd)

   # Deploy the virtual machine on the optimal node
   Invoke-Command -ComputerName $targetnode.name -scriptblock { param([String]$storagepath); New-VM CSVM1 -MemoryStartupBytes 3072MB -path $storagepath -NewVHDPath CSVM.vhdx -NewVHDSizeBytes 4194304 } -ArgumentList @("\\SOFS-CLUSTER1\VOLUME1") -Credential $cred | Out-Null
   
   Start-VM CSVM1 -ComputerName $targetnode.name | Out-Null
   Get-VM CSVM1 -ComputerName $targetnode.name | fl State, ComputerName
   ```

После завершения вы получите сведения о виртуальной машине и где он был помещен.  В приведенном выше примере он отображается как:

        State         : Running
        ComputerName  : 1-S2D2

Если вы не имеют достаточно памяти, ЦП или места на диске для добавления виртуальной машины, вы получите ошибку:

      Get-ClusterSetOptimalNodeForVM : A cluster node is not available for this operation.  

После создания виртуальной машины, она будет отображаться в диспетчере Hyper-V на конкретном узле, который указан.  Чтобы добавить его как кластер виртуальных машин и в кластер с помощью команды ниже.  

        Register-ClusterSetVM -CimSession CSMASTER -MemberName $targetnode.Member -VMName CSVM1

После завершения будет выходные данные:

         Id  VMName  State  MemberName  PSComputerName
         --  ------  -----  ----------  --------------
          1  CSVM1      On  CLUSTER1    CSMASTER

Если вы добавили кластер с существующими виртуальными машинами, виртуальные машины будет также должны быть зарегистрированы с кластером, наборы поэтому регистрация всех виртуальных машин за один раз, чтобы использовался является:

        Get-ClusterSetMember -name CLUSTER3 -CimSession CSMASTER | Register-ClusterSetVM -RegisterAll -CimSession CSMASTER

Тем не менее процесс не завершен, как путь к виртуальной машине должен быть добавлен в пространство имен набора кластера.

Так, например, кластер будет добавлен и имеет предварительно настроенных виртуальных машин расположенные на локальные Общие тома кластера (CSV) путь для VHDX будет иметь примерно такой результат «C:\ClusterStorage\Volume1\MYVM\Virtual жестких Disks\MYVM.vhdx.  Миграцию хранилища необходимо выполнить как CSV пути являются по своей природе локальный кластер одного элемента. Таким образом будут недоступны для виртуальной машины после динамической миграции между кластерами члена. 

В этом примере CLUSTER3 был добавлен в кластер, заданные с помощью Add-ClusterSetMember с файловым сервером горизонтального масштабирования инфраструктуры как CLUSTER3 масштабируемого файлового сервера.  Чтобы переместить конфигурацию виртуальной машины и хранилища, используется следующая команда:

        Move-VMStorage -DestinationStoragePath \\SOFS-CLUSTER3\Volume1 -Name MYVM

После завершения вы получите предупреждение:

        WARNING: There were issues updating the virtual machine configuration that may prevent the virtual machine from running.  For more information view the report file below.
        WARNING: Report file location: C:\Windows\Cluster\Reports\Update-ClusterVirtualMachineConfiguration '' on date at time.htm.

Это предупреждение можно проигнорировать это предупреждение относится «изменения в конфигурации хранилища для роли виртуальной машины не обнаружены».  Причина предупреждение фактическое физическое расположение не изменяется; только пути конфигурации. 

Дополнительные сведения о Move-VMStorage, см. в статье это [ссылку](https://docs.microsoft.com/powershell/module/hyper-v/move-vmstorage?view=win10-ps). 

Динамической миграция виртуальной машины между кластерами набора в другой кластер не так же, как и в прошлом. В сценарии набора не входит в кластер будет иметь действия:

1. Удаление роли виртуальной машины из кластера.
2. Динамическая миграция виртуальной машины на узел члена с другим кластером.
3. Добавьте виртуальную машину в кластер как новую роль виртуальной машины.

С наборами кластера эти шаги не обязательны, и только одна команда требуется.  Например я хочу переместить виртуальной машины значение кластера CLUSTER1 NODE2 CL3 на CLUSTER3.  Одной команды будет следующим:

        Move-ClusterSetVM -CimSession CSMASTER -VMName CSVM1 -Node NODE2-CL3

Обратите внимание на то, что это не перемещает файлы хранилища или конфигурации виртуальной машины.  Это не является обязательным, так как путь к виртуальной машине по-прежнему соответствует \\CLUSTER1\VOLUME1 масштабируемого файлового сервера.  После регистрации виртуальной машины с наборами кластера имеет путь к общей папке инфраструктуры файлового сервера, дисков и виртуальных машин не требуется, на том же компьютере, что и виртуальная машина.

## <a name="creating-availability-sets-fault-domains"></a>Создание доступности задает домены сбоя

Как описано во введении, домены сбоя по принципу Azure и группы доступности можно настроить в наборе кластера.  Это полезно для размещения на исходной виртуальной машины Linux и миграция между кластерами.  

В следующем примере показаны четыре кластера, участвующих в наборе кластера.  В наборе логического домена создается с помощью двух кластеров и домен сбоя, созданных с помощью двух других кластеров.  Входящие в набор доступности этих доменах. 

В приведенном ниже примере CLUSTER1 и CLUSTER2 будут в домен сбоя вызывается **FD1** хотя CLUSTER3 и CLUSTER4 будет находиться в домене сбоя вызывается **FD2**.  Группа доступности будет вызываться **CSMASTER-AS** и состоять из этих доменах.

Чтобы создать в доменах сбоя, команды являются:

        New-ClusterSetFaultDomain -Name FD1 -FdType Logical -CimSession CSMASTER -MemberCluster CLUSTER1,CLUSTER2 -Description "This is my first fault domain"

        New-ClusterSetFaultDomain -Name FD2 -FdType Logical -CimSession CSMASTER -MemberCluster CLUSTER3,CLUSTER4 -Description "This is my second fault domain"

Чтобы убедиться, что они были созданы успешно, Get-ClusterSetFaultDomain может выполняться с его выходных данных показано.

        PS C:\> Get-ClusterSetFaultDomain -CimSession CSMASTER -FdName FD1 | fl *

        PSShowComputerName    : True
        FaultDomainType       : Logical
        ClusterName           : {CLUSTER1, CLUSTER2}
        Description           : This is my first fault domain
        FDName                : FD1
        Id                    : 1
        PSComputerName        : CSMASTER

Теперь, когда были созданы в доменах сбоя, необходимо создать группу доступности.

        New-ClusterSetAvailabilitySet -Name CSMASTER-AS -FdType Logical -CimSession CSMASTER -ParticipantName FD1,FD2

Для проверки, он будет создан, затем с помощью:

        Get-ClusterSetAvailabilitySet -AvailabilitySetName CSMASTER-AS -CimSession CSMASTER

При создании новых виртуальных машин, затем необходимо использовать параметр - AvailabilitySet как часть определения оптимальной узла.  Поэтому он будет выглядеть примерно так:

        # Identify the optimal node to create a new virtual machine
        $memoryinMB=4096
        $vpcount = 1
        $av = Get-ClusterSetAvailabilitySet -Name CSMASTER-AS -CimSession CSMASTER
        $targetnode = Get-ClusterSetOptimalNodeForVM -CimSession CSMASTER -VMMemory $memoryinMB -VMVirtualCoreCount $vpcount -VMCpuReservation 10 -AvailabilitySet $av
        $secure_string_pwd = convertto-securestring "<password>" -asplaintext -force
        $cred = new-object -typename System.Management.Automation.PSCredential ("<domain\account>",$secure_string_pwd)

Удаление кластера из кластера задает из-за различные жизненные циклы. Бывают случаи, когда кластер должен быть удален из набора для кластера. Рекомендуется все виртуальные машины кластера набора должны быть перенесены из кластера. Это можно сделать с помощью **перемещения ClusterSetVM** и **Move-VMStorage** команды.

Тем не менее если виртуальные машины не будут также перемещены, наборы кластера выполняет последовательность действий, которые предоставляют интуитивно понятный результат администратору.  Когда кластер удаляется из набора, все оставшиеся кластера набора виртуальных машин, размещенных в кластере удаления просто станет высокодоступные виртуальные машины, связанный с этим кластером, при условии, что они имеют доступ к их хранилищу.  Наборы кластера также автоматически обновит его инвентаризации по:

- Больше не отслеживает работоспособность кластера сейчас удален и виртуальных машин, запущенных на нем
- Удаляет из кластера набор имен и все ссылки на общие папки, размещенные в кластере теперь удалены

Например команда для удаления кластера CLUSTER1 из наборов кластера будет:

        Remove-ClusterSetMember -ClusterName CLUSTER1 -CimSession CSMASTER

## <a name="frequently-asked-questions-faq"></a>Вопросы и ответы

**Вопрос.** В наборе кластера действует ли ограничение только с помощью гиперконвергентной кластеров? <br>
**Ответ:** Нет.  Дисковыми пространствами можно комбинировать с помощью традиционных кластеров.

**Вопрос.** Можно ли управлять Мой кластер задать с помощью System Center Virtual Machine Manager? <br>
**Ответ:** System Center Virtual Machine Manager в настоящее время не поддерживает наборы для кластера <br><br> **Вопрос.** Могут Windows Server 2012 R2 или 2016 кластеров сосуществовать в одной группе кластера? <br>
**Вопрос.** Можно ли перенести рабочие нагрузки из системы Windows Server 2012 R2 или 2016 кластеров простого наличия этих кластерах присоединиться к одной группе кластера? <br>
**Ответ:** Наборы кластера — это новая технология, представленные в предварительной версии Windows Server сборок, поэтому таким образом, не существует в предыдущих выпусках. Кластеров под управлением ОС нижнего уровня не могут присоединяться к набора кластера. Тем не менее последовательного обновления технологии кластера операционной системы должен предоставить функции миграции, которые вы ищете путем обновления до Windows Server 2019 эти кластеры.

**Вопрос.** Можно наборы кластера разрешает вычислений (отдельно) или масштабируйте хранилище? <br>
**Ответ:** Да, просто добавляя пространства дисковыми или традиционного кластера Hyper-V. С наборами кластера это просто изменение коэффициента вычислений в хранилище даже в наборе гиперконвергированного кластера.

**Вопрос.** Что такое инструментарий управления для наборов кластера <br>
**Ответ:** PowerShell или WMI в этом выпуске.

**Вопрос.** Как будет работать Динамическая миграция между кластерами с процессорами разных поколений  <br>
**Ответ:** Кластер наборов не обойти различия процессоров и замена, что в настоящее время поддерживает Hyper-V.  Таким образом необходимо использовать режим совместимости процессоров с помощью быстрого переноса.  Для наборов кластера рекомендуется использовать одно и то же оборудование процессора в пределах каждого отдельного кластера, а также всего кластера, задайте для динамической миграции между кластерами возникает.

**Вопрос.** Можно мой набор кластера виртуальных машин автоматически отработки отказа при сбое кластера?  <br>
**Ответ:** В этом выпуске виртуальных машин кластера набора может быть только вручную live миграции между кластерами; но не может автоматически отработки отказа. 

**Вопрос.** Как обеспечить, чтобы хранилища устойчив к сбоям кластера? <br>
**Ответ:** Решение реплики хранилища (SR) между кластерами всех кластеров для члена можно используйте для реализации устойчивость хранилища к.

**Вопрос.** Я использую реплики хранилища (SR) для репликации всех кластеров для члена. Кластера хранилища пространство имен набора изменений пути UNC при отработке отказа SR кластер дисковых целевой реплики? <br>
**Ответ:** В этом выпуске такого кластера набор имен ссылок изменения не происходит с SR отработки отказа. Сообщите об этом Майкрософт выяснить, важных для вас, и как вы планируете использовать этот сценарий.

**Вопрос.** Существует возможность отработки отказа виртуальные машины между доменами сбоев в случае аварийного восстановления (скажем, домен сбоя всего вышли из строя)? <br>
**Ответ:** Нет, обратите внимание, что отработка отказа между кластерами в логический сбой домена еще не поддерживается. 

**Вопрос.** Мой кластер задать span кластеров в нескольких узлов (или DNS-доменах) <br> 
**Ответ:** Это непроверенное и не сразу же планируется поддержка в рабочей среде. Сообщите об этом Майкрософт выяснить, важных для вас, и как вы планируете использовать этот сценарий.

**Вопрос.** Работает кластер набора с поддержкой IPv6? <br>
**Ответ:** IPv4 и IPv6 поддерживаются с наборами кластера, как и в случае с отказоустойчивыми кластерами.

**Вопрос.** Каковы требования к лесу Active Directory для кластера задает <br>
**Ответ:** Все кластеры член должен быть в одном лесу AD.

**Вопрос.** Сколько кластеров узлов могут быть частью одного кластера установлены или? <br>
**Ответ:** В предварительной версии кластера наборы были протестированы и поддерживаются до 64 узлов всего кластера. Однако кластер задает архитектура масштабируется для гораздо более широкие границы и не является то, что жестко запрограммирован для ограничения. Сообщите об этом Майкрософт выяснить большего масштаба, важных для вас, и как вы планируете использовать его.

**Вопрос.** Все кластеры дисковыми пространствами в наборе кластера образуют один пул носителей? <br>
**Ответ:** Нет. Прямые дисковые пространства технологии хранения по-прежнему работает внутри одного кластера, а не для всех кластеров элемента в наборе кластера.

**Вопрос.** Кластер задано пространство имен высокой доступности? <br>
**Ответ:** Да, пространство имен набора кластера обеспечивается через сервер пространства имен постоянно доступные (CA) ссылок масштабируемых файловых СЕРВЕРОВ в кластере управления. Корпорация Майкрософт рекомендует достаточного числа виртуальных машин из кластеров член сопротивляемость для локальных сбоев на уровне кластера. Тем не менее с учетом непредвиденных сбоев — например всех виртуальных машин в кластере управления, выходят из строя в то же время — сведения о ссылках Кроме того, постоянно кэшируется в каждом узле кластера набора, даже между перезагрузками.
 
**Вопрос.** Кластера задает замедлить производительность хранилища доступа хранилища на основе пространства имен в наборе кластера? <br>
**Ответ:** Нет. Пространство имен кластера набор предлагает пространство имен ссылок наложения в пределах набора кластера — по существу как распределенных файлов системы пространств имен (DFSN). И, в отличие от DFSN, все метаданные ссылки пространства имен кластера набора заполняется автоматически и автоматического обновления на всех узлах без вмешательства администратора, поэтому нет практически никаких издержек в пути доступа к хранилищу. 

**Вопрос.** Как выполнить резервное копирование метаданных набора кластера? <br>
**Ответ:** Это руководство предназначено так же, как и для отказоустойчивого кластера. Архивация состояния системы будут созданы резервные копии также состояние кластера.  Через архивации данных Windows Server, можно сделать восстановление только узла кластера базы данных (которая никогда не требуется каких из-за изрядно логики самовосстановления, у нас есть) или выполните принудительное восстановление выполнить откат базы данных кластера на всех узлах. В случае кластера наборов Корпорация Майкрософт рекомендует сделать полномочного восстановления сначала на член кластера, а затем в кластере управления, при необходимости. 
