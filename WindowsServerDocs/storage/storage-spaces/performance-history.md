---
title: Журнал производительности для локальных дисковых пространств
ms.author: cosdar
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: cosmosdarwin
ms.date: 09/07/2018
Keywords: Storage Spaces Direct
ms.localizationpriority: medium
ms.openlocfilehash: 828a3265c9770bab0158067c4f856866d03e3d42
ms.sourcegitcommit: d31e266130b3b082372f7af4024e6089cb347d74
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/28/2018
ms.locfileid: "4239261"
---
# Журнал производительности для локальных дисковых пространств

> Область применения: Windows Server 2019 г.

Журнал производительности — это новый компонент, который предоставляет [Локальных дисковых пространств](storage-spaces-direct-overview.md) Администраторы удобный доступ к истории вычислений, памяти, сети и хранилища измерения на хост-серверы, диски, тома, виртуальных машин и многое другое. Журнал производительности автоматически собираются и хранятся в кластере для до одного года.

   > [!IMPORTANT]
   > Эта функция в Windows Server 2019. Не поддерживается в Windows Server 2016.

## Начало работы

По умолчанию с помощью локальных дисковых пространств в Windows Server 2019 заносятся в журнал производительности. Установка, Настройка и начала ничего не нужно. Подключение к Интернету не является обязательным, System Center не является обязательным и внешней базы данных не является обязательным.

Чтобы оценить эффективность вашей кластера журнал графически: использовать [Windows Admin Center](../../manage/windows-admin-center/understand/windows-admin-center.md):

![Производительность журнала в Windows Admin Center](media/performance-history/perf-history-in-wac.png)

Для запроса и обработать его программным способом, используйте новый `Get-ClusterPerf` командлет. См. в разделе [об использовании в PowerShell](#usage-in-powershell).

## Какие собираются

Журнал производительности собираются для 7 типов объектов:

![Типы объектов](media/performance-history/types-of-object.png)

Каждый тип объекта имеет множество серии: например, `ClusterNode.Cpu.Usage` собираемых для каждого сервера.

Сведения какие собираются для каждого типа объекта и как их интерпретировать см. в этих разделах:

| Объект             | Серия                                                                               |
|--------------------|--------------------------------------------------------------------------------------|
| Диски             | [Какие собираются дисков](performance-history-for-drives.md)                     |
| Сетевые адаптеры   | [Какие собираются для сетевых адаптеров](performance-history-for-network-adapters.md) |
| Серверы            | [Какие собираются для серверов](performance-history-for-servers.md)                   |
| Виртуальные жесткие диски | [Какие собираются для виртуальных жестких дисков](performance-history-for-vhds.md)           |
| Виртуальные машины   | [Какие собираются для виртуальных машин](performance-history-for-vms.md)              |
| Тома            | [Какие собираются для томов](performance-history-for-volumes.md)                   |
| Кластеры           | [Какие собираются кластеров](performance-history-for-clusters.md)                 |

Многие серии объединяются для одноранговых объектов для родительского элемента: например, `NetAdapter.Bandwidth.Inbound` собираются отдельно для каждого сетевого адаптера и объединяются на общий сервер; Аналогичным образом `ClusterNode.Cpu.Usage` объединяются в целом кластера; и т. д.

## Сроки оплаты

Журнал производительности сохраняется для до одного года, с прожекторным детализации. Последний час измерения доступны каждые 10 секунд. Таким образом, они интеллектуального объединяются (среднего или суммирование, как в соответствующих) в менее детальный серии, занимать больше времени. Последний день показатели доступны каждые 5 минут; для последних недели, каждые 15 минут; и т. д.

В Windows Admin Center можно выбрать период времени в правом верхнем углу выше диаграммы.

![Сроки оплаты в Windows Admin Center](media/performance-history/timeframes-in-honolulu.png)

В PowerShell, используйте `-TimeFrame` параметра.

Ниже приведены доступные сроки оплаты.

| Период времени   | Частота измерения | Сохраняться |
|-------------|-----------------------|--------------|
| `LastHour`  | Каждые 10 секунд         | 1 ч       |
| `LastDay`   | Каждые 5 минут       | 25 часов     |
| `LastWeek`  | Каждые 15 минут      | 8 дней       |
| `LastMonth` | Каждый час          | до 35 дней      |
| `LastYear`  | Каждый 1 день           | 400 дней     |

## Использование в PowerShell

Используйте `Get-ClusterPerformanceHistory` командлет запросов и процесс журнал производительности в PowerShell.

```PowerShell
Get-ClusterPerformanceHistory
```

   > [!TIP]
   > Используйте **Get-ClusterPerf** псевдоним для сохранения некоторых нажатия клавиш.

### Пример.

Получите ЦП виртуальной машины *MyVM* за последний час:

```PowerShell
Get-VM "MyVM" | Get-ClusterPerf -VMSeriesName "VM.Cpu.Usage" -TimeFrame LastHour
```

Более сложные примеры см. в разделе опубликованной [образцы сценариев](performance-history-scripting.md) предоставленного начальный код, чтобы найти пиковые значения, вычисления среднего, построения линии тренда, запустите выбросов обнаружения и многое другое.

### Укажите объект

Вы можете указать объект, который вы хотите конвейером. Это работает с 7 типов объектов:

| Объект из конвейера | Пример.     |
|----------------------|-------------|
| `Get-PhysicalDisk`   | <code>Get-PhysicalDisk -SerialNumber "XYZ456" &#124; Get-ClusterPerf</code>         |
| `Get-NetAdapter`     | <code>Get-NetAdapter "Ethernet" &#124; Get-ClusterPerf</code>                       |
| `Get-ClusterNode`    | <code>Get-ClusterNode "Server123" &#124; Get-ClusterPerf</code>                     |
| `Get-VHD`            | <code>Get-VHD "C:\ClusterStorage\MyVolume\MyVHD.vhdx" &#124; Get-ClusterPerf</code> |
| `Get-VM`             | <code>Get-VM "MyVM" &#124; Get-ClusterPerf</code>                                   |
| `Get-Volume`         | <code>Get-Volume -FriendlyName "MyVolume"  &#124; Get-ClusterPerf</code>            |
| `Get-Cluster`        | <code>Get-Cluster "MyCluster" &#124; Get-ClusterPerf</code>                         |

Если вы не укажете, возвращается журнал производительности для общего кластера.

### Указать серии

Вы можете указать серию, которую вы хотите, чтобы с помощью этих параметров:


| Параметр                 | Пример.                       | Список                                                                                 |
|---------------------------|-------------------------------|--------------------------------------------------------------------------------------|
| `-PhysicalDiskSeriesName` | `"PhysicalDisk.Iops.Read"`    | [Какие собираются дисков](performance-history-for-drives.md)                     |
| `-NetAdapterSeriesName`   | `"NetAdapter.Bandwidth.Outbound"` | [Какие собираются для сетевых адаптеров](performance-history-for-network-adapters.md) |
| `-ClusterNodeSeriesName`  | `"ClusterNode.Cpu.Usage"`     | [Какие собираются для серверов](performance-history-for-servers.md)                   |
| `-VHDSeriesName`          | `"Vhd.Size.Current"`          | [Какие собираются для виртуальных жестких дисков](performance-history-for-vhds.md)           |
| `-VMSeriesName`           | `"Vm.Memory.Assigned"`        | [Какие собираются для виртуальных машин](performance-history-for-vms.md)              |
| `-VolumeSeriesName`       | `"Volume.Latency.Write"`      | [Какие собираются для томов](performance-history-for-volumes.md)                   |
| `-ClusterSeriesName`      | `"PhysicalDisk.Size.Total"`   | [Какие собираются кластеров](performance-history-for-clusters.md)                 |


   > [!TIP]
   > Используйте завершение вкладки для обнаружения доступных серии.

Если вы не укажете, возвращается каждый серии, доступные для указанного объекта.

### Укажите интервал времени

Вы можете указать период времени, журнал, вы хотите, чтобы с помощью `-TimeFrame` параметра.

   > [!TIP]
   > Используйте завершение вкладки для обнаружения доступных сроки оплаты.

Если вы не укажете, `MostRecent` возвращается показателей.

## Принцип работы

### Производительность журнала хранилища

Вскоре после включения локальных дисковых пространств для приблизительно 10 ГБ тома с именем `ClusterPerformanceHistory` создается и имеется подготовлена экземпляр расширяемая система хранения данных (также известная как Microsoft JET). Это упрощенная база данных сохраняет историю производительности без участия администратора или управления.

![Тома для хранения данных журнала производительности](media/performance-history/perf-history-volume.png)

Том создается резервная копия, дисковые пространства и использует простой, двухстороннее зеркало или трехстороннее зеркало устойчивости, в зависимости от количества узлов в кластере. Он будет восстановлена после сбоев дисков или серверов, так же, как любые другие тома в локальных дисковых пространств.

Том ReFS использует, но не общего тома кластера (CSV), поэтому оно отображается только на узле владельца группы кластера. Помимо автоматически создаваемого, нет ничего специальные об этом томе: его можно увидеть его, найдите его, изменить его размер или удалить (не рекомендуется). [Если что-то пойдет не так, см.](#troubleshooting) 

### Объект обнаружения и сбора данных

Журнал производительности автоматически обнаруживает подходящих объектов, таких как виртуальные машины, в любом месте в кластере и начинает потоковую счетчиками производительности. Счетчики объединяются, синхронизированы и добавляемого в базе данных. Потоковая передача работает непрерывно и оптимизирован для влияние минимальными системными.

Коллекции осуществляется с помощью службы работоспособности, который высокодоступные: Если узел, где выполняется отключается, он будет возобновлен минут позже на другом узле в кластере. Производительность журнала может прекращаются кратко, но он автоматически продолжит получать. Вы можете увидеть служба работоспособности и его владельца узла, выполнив `Get-ClusterResource Health` в PowerShell.

### Обработка измерения пробелы

Когда измерения объединяются в менее детальный серии, занимать больше времени, как описано в [сроки оплаты](#Timeframes), периоды отсутствующих данных исключаются. Например, если сервер был вниз для 30 минут, затем запустить в 50% времени ЦП в течение следующих 30 минут, `ClusterNode.Cpu.Usage` Средняя для час будут записаны правильно 50% (не 25%).

### Расширяемость и настройка

Журнал производительности — подходящий для сценариев. Использование PowerShell для извлечения все доступные журнал непосредственно из базы данных для создания автоматических отчетов или оповещение, экспортировать журнал расположении, выпуск собственные зрительные образы и т. д. См. в разделе опубликованной [образцы сценариев](performance-history-scripting.md) для полезный начальный код.

Сбор данных журнала для дополнительных объектов, сроки оплаты или серии невозможна.

Частота измерения и период сохранения не настраиваются в данный момент.

## Запустить или остановить журнал производительности

### Как включить эту функцию?

Если вы `Stop-ClusterPerformanceHistory`, журнал производительности включена по умолчанию.

Чтобы повторно включить его, выполните этот командлет PowerShell от имени администратора:

```PowerShell
Start-ClusterPerformanceHistory
```

### Как отключить эту функцию?

Остановка сбора журнал производительности, запустите этот командлет PowerShell от имени администратора:

```PowerShell
Stop-ClusterPerformanceHistory
```

Чтобы удалить существующие измерения, используйте `-DeleteHistory` флаг:

```PowerShell
Stop-ClusterPerformanceHistory -DeleteHistory
```

   > [!TIP]
   > Во время начального развертывания, вы можете запретить журнал производительности начиная, установив `-CollectPerformanceHistory` параметр `Enable-ClusterStorageSpacesDirect` для `$False`.

## Устранение неполадок

### Командлет не работает

Сообщение об ошибке, как «*термин «Get-ClusterPerf» не распознается как имя командлета*» означает, что компонент не доступен или установки. Убедитесь, что у вас есть предварительной оценки Windows Server сборки 17692 или более поздней версии, что вы установили отказоустойчивой кластеризации, и что вы используете локальных дисковых пространств.

   > [!NOTE]
   > Эта возможность не доступны в Windows Server 2016 или более ранних версий.

### Нет доступных данных 

Если диаграмма «*Нет доступных данных*», как приведенному на изображении, вот как устранять.

![Нет доступных данных](media/performance-history/no-data-available.png)

1. Если объект был добавленные или создания, дождаться быть обнаружены (до 15 минут).

2. Обновите страницу или дождаться следующего обновления фона (до 30 секунд).

3. Некоторые специальные объекты исключаются из истории производительности — например, виртуальные машины, которые не объединены в кластеры и томов, не использующих файловую систему общего тома кластера (CSV). Проверьте подраздел для типа объекта, например [Журнал производительности для тома](performance-history-for-volumes.md), для мелкий шрифт.

4. Если проблема сохраняется, откройте PowerShell от имени администратора и выполните `Get-ClusterPerf` командлет. Командлет, устранение неполадок логику для определения распространенных проблем, например, когда отсутствует ClusterPerformanceHistory тома, а также инструкции исправления.

5. Если ничего не возвращает команды на предыдущем шаге, попробуйте перезапустить службу работоспособности (который анализирует журнал производительности), запустив `Stop-ClusterResource Health ; Start-ClusterResource Health` в PowerShell.

## См. также

- [Обзор локальных дисковых пространств](storage-spaces-direct-overview.md)
