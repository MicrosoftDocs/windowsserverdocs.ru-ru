---
title: Журнал производительности для дисковых пространств
ms.author: cosdar
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: cosmosdarwin
ms.date: 09/07/2018
Keywords: Локальные дисковые пространства
ms.localizationpriority: medium
ms.openlocfilehash: 828a3265c9770bab0158067c4f856866d03e3d42
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59870865"
---
# <a name="performance-history-for-storage-spaces-direct"></a>Журнал производительности для дисковых пространств

> Область применения. Windows Server 2019

Журнал производительности — это новая функция, которая предоставляет [Storage Spaces Direct](storage-spaces-direct-overview.md) администраторам удобный доступ к исторических измерения вычислений, памяти, сети и хранилища на серверах узлов, диски, тома, виртуальные машины и многое другое. Журнал производительности собираются автоматически и сохраненной в кластере на один год.

   > [!IMPORTANT]
   > Этот компонент впервые появился в Windows Server 2019. Она недоступна в Windows Server 2016.

## <a name="get-started"></a>Начало работы

Журнал производительности собираются по умолчанию с помощью дисковых пространств в Windows Server 2019. Установить, настроить или запустить ничего не нужно. Подключение к Интернету не требуется, System Center не является обязательным и внешней базы данных не является обязательным.

Чтобы просмотреть журнал производительности кластера графически, используйте [Windows Admin Center](../../manage/windows-admin-center/understand/windows-admin-center.md):

![Журнал производительности в Windows Admin Center](media/performance-history/perf-history-in-wac.png)

Для запроса и обработать его программными средствами, используйте новый `Get-ClusterPerf` командлета. См. в разделе [использования в PowerShell](#usage-in-powershell).

## <a name="whats-collected"></a>Что именно должна собирать

Журнал производительности собираются для 7 типов объектов:

![Типы объектов](media/performance-history/types-of-object.png)

Каждый тип объекта имеет много рядов: например, `ClusterNode.Cpu.Usage` собираются для каждого сервера.

Сведения, собираемые для каждого типа объекта и их назначение см. в этих подразделах:

| Объект             | серии                                                                               |
|--------------------|--------------------------------------------------------------------------------------|
| Накопители             | [Что именно должна собирать для дисков](performance-history-for-drives.md)                     |
| Сетевые адаптеры   | [Что именно должна собирать для сетевых адаптеров](performance-history-for-network-adapters.md) |
| Серверы            | [Что именно должна собирать для серверов](performance-history-for-servers.md)                   |
| Виртуальные жесткие диски | [Что именно должна собирать для виртуальных жестких дисков](performance-history-for-vhds.md)           |
| Виртуальные машины   | [Что именно должна собирать для виртуальных машин](performance-history-for-vms.md)              |
| Тома            | [Что именно должна собирать для томов](performance-history-for-volumes.md)                   |
| Кластеры           | [Что именно должна собирать для кластеров](performance-history-for-clusters.md)                 |

Много рядов объединяются по одноранговые объекты к родительскому: например, `NetAdapter.Bandwidth.Inbound` отдельно собираются для каждого сетевого адаптера и объединяются для общего сервера; аналогичным образом `ClusterNode.Cpu.Usage` агрегируются для кластера в целом; и т. д.

## <a name="timeframes"></a>Временные интервалы

Журнал производительности хранится на один год с детализацией по сокращает количество. Последний час измерения доступны каждые десять секунд. После этого они интеллектуально объединяются (вычисление среднего значения или суммирование, в соответствии с потребностями) в менее подробных ряду и занимать больше времени. Для последнего дня измерения, доступные каждые пять минут; в течение последней недели, каждые пятнадцать минут; и т. д.

В Windows Admin Center можно выбрать период времени в верхнем правом углу над диаграммой.

![Временные интервалы в Windows Admin Center](media/performance-history/timeframes-in-honolulu.png)

В PowerShell, используйте `-TimeFrame` параметра.

Ниже приведены доступные временных интервалов.

| Период времени   | Измерения частоты | Можно сохранить для |
|-------------|-----------------------|--------------|
| `LastHour`  | Каждые 10 сек         | 1 ч       |
| `LastDay`   | Каждые 5 минут       | 25 часов     |
| `LastWeek`  | Каждые 15 минут      | 8 дней       |
| `LastMonth` | Каждый час          | 35 дней      |
| `LastYear`  | 1 день           | 400 дней     |

## <a name="usage-in-powershell"></a>Использование в PowerShell

Используйте `Get-ClusterPerformanceHistory` командлет, чтобы журнал производительности запросов и обработки в PowerShell.

```PowerShell
Get-ClusterPerformanceHistory
```

   > [!TIP]
   > Используйте **Get ClusterPerf** псевдоним, который нужно сохранить некоторые нажатий клавиш.

### <a name="example"></a>Пример

Получение сведений об использовании ЦП виртуальной машины *MyVM* за последний час:

```PowerShell
Get-VM "MyVM" | Get-ClusterPerf -VMSeriesName "VM.Cpu.Usage" -TimeFrame LastHour
```

Более сложные примеры см. в разделе опубликованных [примеры сценариев](performance-history-scripting.md) , которые предоставляют начальный код, чтобы найти пиковые значения, вычисления средних значений, отображения линии тренда, запустите выбросов, обнаружения и многое другое.

### <a name="specify-the-object"></a>Укажите объект

Можно указать объект, который вы хотите конвейером. Это работает с 7 типов объектов:

| Объект из конвейера | Пример     |
|----------------------|-------------|
| `Get-PhysicalDisk`   | <code>Get-PhysicalDisk -SerialNumber "XYZ456" &#124; Get-ClusterPerf</code>         |
| `Get-NetAdapter`     | <code>Get-NetAdapter "Ethernet" &#124; Get-ClusterPerf</code>                       |
| `Get-ClusterNode`    | <code>Get-ClusterNode "Server123" &#124; Get-ClusterPerf</code>                     |
| `Get-VHD`            | <code>Get-VHD "C:\ClusterStorage\MyVolume\MyVHD.vhdx" &#124; Get-ClusterPerf</code> |
| `Get-VM`             | <code>Get-VM "MyVM" &#124; Get-ClusterPerf</code>                                   |
| `Get-Volume`         | <code>Get-Volume -FriendlyName "MyVolume"  &#124; Get-ClusterPerf</code>            |
| `Get-Cluster`        | <code>Get-Cluster "MyCluster" &#124; Get-ClusterPerf</code>                         |

Если не указан, возвращается журнал производительности для кластера в целом.

### <a name="specify-the-series"></a>Укажите ряд

Можно указать нужный ряд со следующими параметрами:


| Параметр                 | Пример                       | List                                                                                 |
|---------------------------|-------------------------------|--------------------------------------------------------------------------------------|
| `-PhysicalDiskSeriesName` | `"PhysicalDisk.Iops.Read"`    | [Что именно должна собирать для дисков](performance-history-for-drives.md)                     |
| `-NetAdapterSeriesName`   | `"NetAdapter.Bandwidth.Outbound"` | [Что именно должна собирать для сетевых адаптеров](performance-history-for-network-adapters.md) |
| `-ClusterNodeSeriesName`  | `"ClusterNode.Cpu.Usage"`     | [Что именно должна собирать для серверов](performance-history-for-servers.md)                   |
| `-VHDSeriesName`          | `"Vhd.Size.Current"`          | [Что именно должна собирать для виртуальных жестких дисков](performance-history-for-vhds.md)           |
| `-VMSeriesName`           | `"Vm.Memory.Assigned"`        | [Что именно должна собирать для виртуальных машин](performance-history-for-vms.md)              |
| `-VolumeSeriesName`       | `"Volume.Latency.Write"`      | [Что именно должна собирать для томов](performance-history-for-volumes.md)                   |
| `-ClusterSeriesName`      | `"PhysicalDisk.Size.Total"`   | [Что именно должна собирать для кластеров](performance-history-for-clusters.md)                 |


   > [!TIP]
   > Использование заполнения нажатием клавиши tab для обнаружения доступных рядов.

Если не указан, возвращается каждого ряда, доступные для указанного объекта.

### <a name="specify-the-timeframe"></a>Указать период времени

Можно указать период времени с помощью журнала `-TimeFrame` параметра.

   > [!TIP]
   > Использование заполнения нажатием клавиши tab для обнаружения доступных временных интервалов.

Если вы не укажете, `MostRecent` возвращается измерения.

## <a name="how-it-works"></a>Принцип работы

### <a name="performance-history-storage"></a>Объем данных журнала производительности

Вскоре после включения дисковых томе примерно 10 ГБ с именем `ClusterPerformanceHistory` создается и экземпляр подсистемы ESE (также известный как Microsoft JET) подготавливается существует. Это облегченная версия СУБД хранит историю производительности без вмешательства администратора или управления.

![Том для хранения журнала производительности](media/performance-history/perf-history-volume.png)

Том поддерживаемый дисковых пространств и использует простой двухстороннего зеркала или устойчивость трехстороннее зеркало, в зависимости от количества узлов в кластере. Его восстановления после сбоев диска или сервера, так же, как другие тома в дисковых пространств.

Тома ReFS использует, но не общего тома кластера (CSV), поэтому он доступен только на узел владельца кластерной группы. Помимо автоматически создаваемой, нет ничего особенного в отношении этого тома: можно увидеть его, просмотреть его, измените его размер или удалить его (не рекомендуется). Если что-то пойдет не так, см. в разделе [Устранение неполадок](#troubleshooting). 

### <a name="object-discovery-and-data-collection"></a>Объект обнаружения и сбора данных

Журнал производительности автоматически обнаруживает подходящих объектов, таких как виртуальные машины, где угодно в кластере и начинает потоковую счетчиками производительности. Счетчики собираются, синхронизации и вставляются в базу данных. Потоковая передача работает непрерывно и оптимизирован для влияния на систему с минимальным.

Коллекции обрабатывается службой работоспособности, которая отличается высокой доступностью: Если узел, где оно запущено выходит из строя, он будет возобновлена секунд позже на другой узел в кластере. Журнал производительности может ненадолго прекращаются, но он начнется автоматически. Служба работоспособности и узла-владельца можно увидеть, выполнив `Get-ClusterResource Health` в PowerShell.

### <a name="handling-measurement-gaps"></a>Обработка измерения промежутков

Когда измерения объединяются в менее подробных ряду и занимать больше времени, как описано в разделе [временных интервалов](#Timeframes), исключенные периоды отсутствующих данных. Например, если сервер находился на 30 минут, то запущена на 50% использовании ЦП в течение 30 минут, `ClusterNode.Cpu.Usage` среднее значение для часа будут записаны правильно и составляет 50% (не 25%).

### <a name="extensibility-and-customization"></a>Расширяемость и настройка

Журнал производительности — с поддержкой сценариев. Используйте PowerShell, чтобы извлечь все доступные журналы непосредственно из базы данных для создания автоматических отчетов или оповещений, экспортировать журнал для длительного хранения, разверните свои собственные визуализации и т. д. Ознакомьтесь с опубликованным [примеры сценариев](performance-history-scripting.md) для полезные начальный код.

Ведет журнал дополнительных объектов, временных рамок или серии невозможна.

Измерения частоту и срок хранения не настраиваются в настоящее время.

## <a name="start-or-stop-performance-history"></a>Запуск или остановка журнал производительности

### <a name="how-do-i-enable-this-feature"></a>Как включить эту функцию?

Если вы `Stop-ClusterPerformanceHistory`, журнал производительности включена по умолчанию.

Чтобы снова включить его, запустите командлет PowerShell от имени администратора:

```PowerShell
Start-ClusterPerformanceHistory
```

### <a name="how-do-i-disable-this-feature"></a>Как отключить эту функцию?

Чтобы остановить сбор журнала производительности, запустите командлет PowerShell от имени администратора:

```PowerShell
Stop-ClusterPerformanceHistory
```

Чтобы удалить существующие измерения, используйте `-DeleteHistory` флаг:

```PowerShell
Stop-ClusterPerformanceHistory -DeleteHistory
```

   > [!TIP]
   > Во время первоначального развертывания, можно предотвратить журнал производительности запуск, задав `-CollectPerformanceHistory` параметр `Enable-ClusterStorageSpacesDirect` для `$False`.

## <a name="troubleshooting"></a>Устранение неполадок

### <a name="the-cmdlet-doesnt-work"></a>Командлет не работает

Сообщение об ошибке, например "*термин «Get-ClusterPerf» не распознан как имя командлета*" означает, что функция не доступных или установленных. Убедитесь, что у вас есть сборки Windows Server Insider Preview 17692 или более поздней версии, что вы установили отказоустойчивой кластеризации, и что вы используете дисковые пространства.

   > [!NOTE]
   > Эта функция не доступна в Windows Server 2016 или более ранней версии.

### <a name="no-data-available"></a>Нет доступных данных 

Если в диаграмме отображается "*нет доступных данных*" как на рисунке, вот способы устранения неполадок:

![Нет доступных данных](media/performance-history/no-data-available.png)

1. Если объект был только что добавлен или создан, дождитесь его необходимо обнаружить (до 15 минут).

2. Обновите страницу или дождитесь следующего фонового обновления (до 30 секунд).

3. Некоторые специальные объекты были исключены из журнал производительности — например, виртуальные машины, которые не являются clustered и томов, которые не используют файловая система общего тома кластера (CSV). Проверьте подраздел для типа объекта, например [журнал производительности для тома](performance-history-for-volumes.md), для мелкий шрифт.

4. Если проблема повторится, откройте PowerShell от имени администратора и выполните `Get-ClusterPerf` командлета. Командлет включает в себя устранение неполадок логики для выявления распространенных проблем, например, если отсутствует ClusterPerformanceHistory тома, а также инструкции по исправлению.

5. Если в предыдущем шаге команда возвращает значение nothing, попробуйте перезапустить службу работоспособности (которая получает историю производительности), выполнив `Stop-ClusterResource Health ; Start-ClusterResource Health` в PowerShell.

## <a name="see-also"></a>См. также

- [Общие сведения о дисковых хранилища](storage-spaces-direct-overview.md)
