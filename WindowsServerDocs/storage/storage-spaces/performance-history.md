---
title: Журнал производительности для Локальные дисковые пространства
ms.author: cosdar
manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: cosmosdarwin
ms.date: 09/07/2018
ms.localizationpriority: medium
ms.openlocfilehash: ab9b6016d49725b7f25d2ad3c40bd6265ac811a9
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80856157"
---
# <a name="performance-history-for-storage-spaces-direct"></a>Журнал производительности для Локальные дисковые пространства

> Область применения: Windows Server 2019

Журнал производительности — это новая функция, которая дает [Локальные дисковые пространства](storage-spaces-direct-overview.md) администраторам простой доступ к историческим расчетам, объемам памяти, сети и хранилищам на серверах узлов, дисках, томах, виртуальных машинах и многом другом. Журнал производительности собирается автоматически и хранится в кластере в течение одного года.

   > [!IMPORTANT]
   > Эта функция впервые реализована в Windows Server 2019. Она недоступна в Windows Server 2016.

## <a name="get-started"></a>Начало работы

Журнал производительности собирается по умолчанию с Локальные дисковые пространства в Windows Server 2019. Нет необходимости в установке, настройке или запуске каких-либо действий. Подключение к Интернету не требуется, System Center не требуется, а внешняя база данных не требуется.

Чтобы просмотреть журнал производительности кластера в графическом виде, используйте [центр администрирования Windows](../../manage/windows-admin-center/understand/windows-admin-center.md).

![Журнал производительности в центре администрирования Windows](media/performance-history/perf-history-in-wac.png)

Чтобы запросить и обработать его программно, используйте командлет New `Get-ClusterPerf`. См. раздел [использование в PowerShell](#usage-in-powershell).

## <a name="whats-collected"></a>Собираемые данные

Журнал производительности собирается для 7 типов объектов:

![Типы объектов](media/performance-history/types-of-object.png)

Каждый тип объекта имеет много рядов: например, `ClusterNode.Cpu.Usage` собираются для каждого сервера.

Сведения о том, что собирается для каждого типа объектов и как их интерпретировать, см. в следующих разделах:

| Объект             | Ряд                                                                               |
|--------------------|--------------------------------------------------------------------------------------|
| Накопители             | [Собранные сведения о дисках](performance-history-for-drives.md)                     |
| Сетевые адаптеры   | [Сведения, собираемые для сетевых адаптеров](performance-history-for-network-adapters.md) |
| Серверы            | [Собираемые для серверов](performance-history-for-servers.md)                   |
| Виртуальные жесткие диски | [Собираемые данные для виртуальных жестких дисков](performance-history-for-vhds.md)           |
| Виртуальные машины   | [Собранные сведения о виртуальных машинах](performance-history-for-vms.md)              |
| Тома            | [Собираемые данные для томов](performance-history-for-volumes.md)                   |
| Кластеры           | [Собираемые для кластеров](performance-history-for-clusters.md)                 |

Многие ряды объединяются между одноранговыми объектами и их родительскими: например, `NetAdapter.Bandwidth.Inbound` собираются отдельно для каждого сетевого адаптера и объединяются в общий сервер. Аналогичным образом `ClusterNode.Cpu.Usage` вычисляются в целом кластере. и т. д.

## <a name="timeframes"></a>Сроки

Журнал производительности хранится в течение одного года с снижением гранулярности. Для последнего часа измерения доступны каждые десять секунд. После этого они являются интеллектуальным слиянием (путем усреднения или суммирования по мере необходимости) на менее детализированный ряд, охватывающий больше времени. В течение последнего дня измерения доступны каждые пять минут; за последнюю неделю каждые пятнадцать минут; и т. д.

В центре администрирования Windows можно выбрать период времени в верхнем правом углу диаграммы.

![Временные рамки в центре администрирования Windows](media/performance-history/timeframes-in-honolulu.png)

В PowerShell используйте параметр `-TimeFrame`.

Ниже приведены доступные временные рамки.

| Рамок   | Частота измерения | Хранить для |
|-------------|-----------------------|--------------|
| `LastHour`  | Каждые 10 секунд         | 1 час       |
| `LastDay`   | Каждые 5 минут       | 25 часов     |
| `LastWeek`  | Каждые 15 минут      | 8 дней       |
| `LastMonth` | Каждые 1 час          | 35 дней      |
| `LastYear`  | Каждые 1 день           | 400 дней     |

## <a name="usage-in-powershell"></a>Использование в PowerShell

Используйте командлет `Get-ClusterPerformanceHistory` для запроса и обработки журнала производительности в PowerShell.

```PowerShell
Get-ClusterPerformanceHistory
```

   > [!TIP]
   > Используйте псевдоним **Get-клустерперф** , чтобы сохранить несколько нажатий клавиш.

### <a name="example"></a>Пример

Получение сведений о загрузке ЦП виртуальной машины *MyVM* за последний час:

```PowerShell
Get-VM "MyVM" | Get-ClusterPerf -VMSeriesName "VM.Cpu.Usage" -TimeFrame LastHour
```

Более сложные примеры см. в опубликованных [примерах сценариев](performance-history-scripting.md) , предоставляющих начальный код для поиска пиковых значений, вычисления среднего значения, построения линий тенденций, выполнения обнаружения выбросов и многого другого.

### <a name="specify-the-object"></a>Укажите объект

Можно указать объект, который будет использоваться конвейером. Это работает с 7 типами объектов:

| Объект из конвейера | Пример     |
|----------------------|-------------|
| `Get-PhysicalDisk`   | <code>Get-PhysicalDisk -SerialNumber "XYZ456" &#124; Get-ClusterPerf</code>         |
| `Get-NetAdapter`     | <code>Get-NetAdapter "Ethernet" &#124; Get-ClusterPerf</code>                       |
| `Get-ClusterNode`    | <code>Get-ClusterNode "Server123" &#124; Get-ClusterPerf</code>                     |
| `Get-VHD`            | <code>Get-VHD "C:\ClusterStorage\MyVolume\MyVHD.vhdx" &#124; Get-ClusterPerf</code> |
| `Get-VM`             | <code>Get-VM "MyVM" &#124; Get-ClusterPerf</code>                                   |
| `Get-Volume`         | <code>Get-Volume -FriendlyName "MyVolume"  &#124; Get-ClusterPerf</code>            |
| `Get-Cluster`        | <code>Get-Cluster "MyCluster" &#124; Get-ClusterPerf</code>                         |

Если не указать, будет возвращен журнал производительности для всего кластера.

### <a name="specify-the-series"></a>Укажите ряд

Вы можете указать требуемый ряд с помощью следующих параметров:


| Параметр                 | Пример                       | List                                                                                 |
|---------------------------|-------------------------------|--------------------------------------------------------------------------------------|
| `-PhysicalDiskSeriesName` | `"PhysicalDisk.Iops.Read"`    | [Собранные сведения о дисках](performance-history-for-drives.md)                     |
| `-NetAdapterSeriesName`   | `"NetAdapter.Bandwidth.Outbound"` | [Сведения, собираемые для сетевых адаптеров](performance-history-for-network-adapters.md) |
| `-ClusterNodeSeriesName`  | `"ClusterNode.Cpu.Usage"`     | [Собираемые для серверов](performance-history-for-servers.md)                   |
| `-VHDSeriesName`          | `"Vhd.Size.Current"`          | [Собираемые данные для виртуальных жестких дисков](performance-history-for-vhds.md)           |
| `-VMSeriesName`           | `"Vm.Memory.Assigned"`        | [Собранные сведения о виртуальных машинах](performance-history-for-vms.md)              |
| `-VolumeSeriesName`       | `"Volume.Latency.Write"`      | [Собираемые данные для томов](performance-history-for-volumes.md)                   |
| `-ClusterSeriesName`      | `"PhysicalDisk.Size.Total"`   | [Собираемые для кластеров](performance-history-for-clusters.md)                 |


   > [!TIP]
   > Для обнаружения доступных рядов используйте функцию заполнения нажатием клавиши TAB.

Если не указать, то возвращается каждый ряд, доступный для указанного объекта.

### <a name="specify-the-timeframe"></a>Укажите период времени

С помощью параметра `-TimeFrame` можно указать временные рамки журнала.

   > [!TIP]
   > Для обнаружения доступных временных рамок используйте функцию заполнения нажатием клавиши TAB.

Если не указать, будет возвращено `MostRecent` измерения.

## <a name="how-it-works"></a>Принцип работы

### <a name="performance-history-storage"></a>Хранилище журнала производительности

Вскоре после включения Локальные дисковые пространства создается примерно 10 ГБ тома с именем `ClusterPerformanceHistory`, а экземпляр расширяемого механизма хранилища (также известный как Microsoft JET) подготавливается. Эта упрощенная база данных хранит журнал производительности без участия администратора или управления.

![Том для хранилища журнала производительности](media/performance-history/perf-history-volume.png)

Этот том поддерживается дисковыми пространствами и использует простую, двустороннюю зеркальную или трехстороннее зеркальное отражение в зависимости от числа узлов в кластере. Она будет исправлена после сбоев диска или сервера, как и любой другой том в Локальные дисковые пространства.

Том использует ReFS, но не общий том кластера (CSV), поэтому он отображается только в узле владелец группы кластеров. Кроме того, в этом томе нет ничего особенного: вы можете увидеть его, просмотреть, изменить его размер или удалить (не рекомендуется). Если что-то пойдет не так, см. раздел [Устранение неполадок](#troubleshooting).

### <a name="object-discovery-and-data-collection"></a>Обнаружение объектов и сбор данных

Журнал производительности автоматически обнаруживает соответствующие объекты, такие как виртуальные машины, в любом месте в кластере и начинает потоковую передачу своих счетчиков производительности. Счетчики объединяются, синхронизируются и вставляются в базу данных. Потоковая передача выполняется непрерывно и оптимизирована для минимального воздействия на систему.

Коллекция обрабатывается служба работоспособности, который является высокодоступным: Если узел, на котором она выполняется, выходит из строя, он возобновится позже на другом узле в кластере. Журнал производительности может ненадолго истечет, но возобновить его автоматически. Чтобы просмотреть служба работоспособности и узел владельца, запустите `Get-ClusterResource Health` в PowerShell.

### <a name="handling-measurement-gaps"></a>Обработка пропусков измерений

Если измерения объединяются в менее детализированные ряды, которые охватывают больше времени, как описано в разделе [временные рамки](#timeframes), периоды отсутствующих данных исключаются. Например, если сервер находился в течение 30 минут, а затем работает на 50% ЦП в течение следующих 30 минут, `ClusterNode.Cpu.Usage` среднее значение часа будет правильно записано как 50% (не 25%).

### <a name="extensibility-and-customization"></a>Расширяемость и настройка

Журнал производительности является понятным для сценариев. Используйте PowerShell для извлечения любого доступного журнала непосредственно из базы данных для создания автоматизированных отчетов или предупреждений, экспорта журнала для хранения, подготовки собственных визуализаций и т. д. Для получения полезного начального кода см. опубликованные [примеры сценариев](performance-history-scripting.md) .

Невозможно выполнить накопление журнала для дополнительных объектов, временных интервалов или ряда.

Частота и срок хранения в настоящее время не настраиваются.

## <a name="start-or-stop-performance-history"></a>Запуск или завершение журнала производительности

### <a name="how-do-i-enable-this-feature"></a>Разделы справки включить эту функцию?

Если вы не `Stop-ClusterPerformanceHistory`, журнал производительности включен по умолчанию.

Чтобы повторно включить его, запустите этот командлет PowerShell от имени администратора:

```PowerShell
Start-ClusterPerformanceHistory
```

### <a name="how-do-i-disable-this-feature"></a>Разделы справки отключить эту функцию?

Чтобы отключить сбор данных журнала производительности, запустите этот командлет PowerShell от имени администратора:

```PowerShell
Stop-ClusterPerformanceHistory
```

Чтобы удалить существующие измерения, используйте флаг `-DeleteHistory`.

```PowerShell
Stop-ClusterPerformanceHistory -DeleteHistory
```

   > [!TIP]
   > Во время первоначального развертывания можно предотвратить запуск журнала производительности, присвоив параметру `-CollectPerformanceHistory` `Enable-ClusterStorageSpacesDirect` значение `$False`.

## <a name="troubleshooting"></a>Диагностика

### <a name="the-cmdlet-doesnt-work"></a>Командлет не работает

Сообщение об ошибке, например "*Get-клустерперф", не распознается как имя командлета*", означает, что эта функция недоступна или не установлена. Убедитесь в наличии предварительной версии Windows Server Insider Build 17692 или более поздней, что вы установили отказоустойчивую кластеризацию и используете Локальные дисковые пространства.

   > [!NOTE]
   > Эта функция недоступна в Windows Server 2016 или более ранней версии.

### <a name="no-data-available"></a>Нет данных 

Если на диаграмме отображается текст "*нет доступных данных*", см. статью Устранение неполадок:

![Нет данных](media/performance-history/no-data-available.png)

1. Если объект был только что добавлен или создан, дождитесь его обнаружения (до 15 минут).

2. Обновите страницу или дождитесь следующего фонового обновления (до 30 секунд).

3. Некоторые специальные объекты исключаются из журнала производительности, например виртуальные машины, которые не являются кластеризованными, и тома, которые не используют файловую систему общий том кластера (CSV). Для точной печати проверьте подраздел для типа объекта, например [Журнал производительности для томов](performance-history-for-volumes.md).

4. Если проблема не исчезнет, откройте PowerShell от имени администратора и выполните командлет `Get-ClusterPerf`. Командлет включает логику устранения неполадок для выявления распространенных проблем, например, если том Клустерперформанцехистори отсутствует, и предоставляет инструкции по исправлению.

5. Если команда на предыдущем шаге возвращает значение Nothing, можно попытаться перезапустить служба работоспособности (который собирает журнал производительности), запустив `Stop-ClusterResource Health ; Start-ClusterResource Health` в PowerShell.

## <a name="see-also"></a>См. также:

- [Обзор Локальные дисковые пространства](storage-spaces-direct-overview.md)
