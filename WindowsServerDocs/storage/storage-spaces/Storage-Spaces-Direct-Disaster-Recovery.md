---
title: Сценарии аварийного восстановления для Гиперконвергентная инфраструктура
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: В этой статье описаны сценарии, сегодня доступны для аварийного восстановления Microsoft HCI (дисковых)
ms.localizationpriority: medium
ms.openlocfilehash: 32bbf02ca78d5c6a2147162768c984d0e0b27e36
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59879595"
---
# <a name="disaster-recovery-with-storage-spaces-direct"></a>Аварийное восстановление с дисковыми пространствами

> Относится к: Windows Server 2019, Windows Server 2016

В этом разделе приводятся сценарии, в том, как гиперконвергентная инфраструктура (HCI) можно настроить для аварийного восстановления.

Множество компаний работают гиперконвергентного решения и планирования к аварии дает возможность оставаться в или в рабочей среде быстро получить в случае аварии. Существует несколько способов настройки HCI для аварийного восстановления и в этом документе описываются параметры, доступные для вас сегодня.

При обсуждении восстановления доступности в случае аварии решают, известного как время восстановления (RTO). Это продолжительность времени, целевые, где службы должен быть восстановлен до избежать неприемлемо последствий для бизнеса. В некоторых случаях этот процесс может произойти автоматически с производством, почти сразу же восстановлен. В других случаях вмешательства вручную администратора необходимо сделать для восстановления службы.

Аварийного восстановления с гиперконвергентной сегодня доступны следующие параметры.

1. Несколько кластеров, используя реплики хранилища
2. Реплика Hyper-V между кластерами
3. Резервное копирование и восстановление

## <a name="multiple-clusters-utilizing-storage-replica"></a>Несколько кластеров, используя реплики хранилища

[Реплика хранилища](../storage-replica/storage-replica-overview.md) позволяет репликации томов и поддерживает синхронную или асинхронную репликацию. При выборе между использованием синхронной или асинхронной репликации, следует целевой точки восстановления (RPO). Целевая точка восстановления — это объем возможной потери данных, которые влечет за собой дополнительные, прежде чем она считается потерю. При переходе с синхронной репликации, он будет последовательно записывать к обоим концам в то же время. При переходе с асинхронной, операций записи будет реплицировать очень быстро, но по-прежнему могут быть потеряны. Рассмотрите возможность использования приложения или файла к см. в разделе, который лучше всего подходит вам.

Реплика хранилища — это механизм копирования уровня блока и уровень файла; Это означает, что не важно, какие виды реплицируемые данные. Это делает является популярной гиперконвергентная инфраструктура. Реплика хранилища также могут использовать различные типы дисков между партнерами репликации, так что наличие вся память одного типа на один HCI и другой тип хранилища на другой, считается совершенно нормальной. 

Одной из важных возможностей реплики хранилища — что она может выполняться в Azure, а также на предприятии. Можно настроить локально локально, в Azure, или даже локально в Azure (или наоборот).

В этом случае существует два отдельных независимых кластеров. Для настройки реплики хранилища между HCI, необходимо выполнить действия, описанные в [-межкластерная репликация хранилища](../storage-replica/cluster-to-cluster-storage-replication.md).

![Схема репликации службы хранилища](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure1.png)

При развертывании реплики хранилища следует принимать во внимание следующие соображения. 

1.  Настройка репликации выполняется за пределами отказоустойчивой кластеризации. 
2.  Выбор метода репликации будет зависеть от задержки в сети и требований к RPO. Синхронная реплицирует данные в сетях с низкой задержкой с отказоустойчивость, чтобы не допустить потери данных во время сбоя. Асинхронные реплицирует данные по сетям с большей задержкой, но каждый сайт может не иметь одинаковых копий во время сбоя. 
3.  В случае аварии отработки отказа между кластерами не автоматическое и должны быть скомпонованы вручную через командлеты PowerShell реплики хранилища. В приведенной выше схеме ClusterA — сервер-источник и ClusterB является сервером-получателем. Если ClusterA выходит из строя, необходимо вручную задать ClusterB как первичный, прежде чем вы можете открыть ресурсы. Когда ClusterA резервного копирования, необходимо сделать его получатель. После копирования синхронизированное все данные, внести изменения и переключения ролей, как они были первоначально установлены в.
4.  Так как реплика хранилища реплицирует только данные, новой виртуальной машины или Scale Out файлового сервера (SOFS) использование этих данных будет должны быть созданы в диспетчере отказоустойчивости кластеров на партнера репликации.

Реплики хранилища можно использовать, если у вас есть виртуальные машины или масштабируемого файлового сервера, выполняющихся в кластере. Переносит реплика HCI ресурсов к сети может быть ручным или автоматизированным при помощи скриптов PowerShell.

## <a name="hyper-v-replica"></a>реплика Hyper-V;

[Реплика Hyper-V](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica) гиперконвергентной инфраструктуры, посвященная репликации на уровне виртуальной машины для аварийного восстановления. Реплика Hyper-V, которые можно сделать — получить виртуальную машину и реплицировать ее в Azure (реплика) или вторичный сайт. Затем на дополнительном сайте реплики Hyper-V можно реплицировать виртуальную машину в третьем (реплику расширенной репликации).

![Схема репликации Hyper-V](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure2.png)

С помощью реплики Hyper-V репликация сконцентрирована Hyper-v. При первом включении виртуальной машины для репликации, имеется три варианта как пространственной начальной копии отправки на соответствующих кластеров с реплики.

1.  Отправить исходную копию по сети
2.  Отправить исходную копию на внешний носитель, таким образом, чтобы его можно было скопировать на сервер вручную
3.  Использование существующей виртуальной машины уже создана на сервере узлов реплики

Другой вариант — для при необходимости этот начальной репликации должна быть выполнена.

1.  Сразу же начать репликацию
2.  Запланируйте время, когда выполняется начальная репликация. 

Ниже приведены дополнительные рекомендации, которые необходимо будет.

- Какие VHD/VHDX нужно реплицировать. Вы можете реплицировать все из них или только один из них.
- Количество точек восстановления, которую вы хотите сохранить. Если вы хотите есть несколько вариантов о во времени, которую вы хотите восстановить, нужно указать, сколько требуется. Если требуется только одну точку восстановления, можно, а также.
- Как часто вы хотите иметь тома службы теневого копирования (VSS) репликация добавочных теневого копирования.
- Как часто репликация изменений (30 секунд, 5 минут, 15 минут).

Если HCI участвовать в реплики Hyper-V, вам потребуется [брокера реплики Hyper-V](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/) ресурс, созданный в каждом кластере. Этот ресурс выполняет ряд задач.

1.  Предоставляет одно пространство имен для каждого кластера для реплики Hyper-V для подключения к.
2.  Определяет, какой из узлов в пределах этого кластера реплики (или реплику расширенной репликации), располагаются в когда он впервые получает копию.
3.  Следит за какой узел является владельцем реплики (или расширенной реплики) в случае, если виртуальная машина перемещается на другой узел. Он должен отслеживать их, чтобы при репликации выполняется, его можно отправить сведения об узле правильный.

## <a name="backup-and-restore"></a>Резервное копирование и восстановление

Один вариант традиционных аварийного восстановления, не затрагивали в большей степени, но не менее важна является сбой всего кластера или узла в кластере. Любой из вариантов в этом сценарии используются Windows NT Backup. 

Это всегда рекомендацию, чтобы иметь гиперконвергентная инфраструктура периодического резервного копирования. Пока выполняется служба кластеров, если резервная копия состояния системы, базы данных реестра кластера будет присутствовать часть этой резервной копии. Восстановление кластера или базы данных поддерживает два метода (Non-доверенный и принудительные).

### <a name="non-authoritative"></a>Недостоверный

Недостоверный восстановление может выполняться с помощью Windows NT Backup и указывает на полное восстановление только самого узла кластера. Если требуется только восстановление узла кластера (и базы данных реестра кластера) и все текущие кластера сведения хорошо, восстанавливается с помощью не заслуживающего доверия. Недостоверный восстановление можно с помощью интерфейса Windows NT Backup или из командной строки WBADMIN. EXE-ФАЙЛА.

После восстановления узла, разрешите его присоединения к кластеру. Что произойдет, — что он будет передан к уже запущенному кластеру и обновить все его данные с использованием актуальных сведений существует.

### <a name="authoritative"></a>Заслуживающие доверия

Полномочное восстановление настройки кластера, с другой стороны, использует конфигурацию кластера назад во времени. Этот тип восстановления должна быть выполнена только в том случае, непосредственно в кластер сведения были потеряны, а требуется восстановить. Например кто-то случайно удалил файловый сервер, который содержит более 1000 общих папок, и они понадобятся снова. Выполнение полномочного восстановления кластера включает в себя выполнение резервного копирования из командной строки.

Полномочное восстановление будет запущена на узле кластера, служба кластера останавливается на всех узлах в представлении кластера и конфигурации кластера заморожен. Именно поэтому крайне важно, что сначала запустить службу кластеров на узле, на котором был выполнен восстановления, формируется кластер, используя новую копию конфигурации кластера.

Чтобы выполнить Полномочное восстановление, можно выполнить следующие действия.

1.  Запустите WBADMIN. EXE-файла из административной командной строки, чтобы получить последнюю версию резервные копии, которые вы хотите установить и убедитесь, что состояние системы — один из компонентов можно восстановить.

    ```powershell
    Wbadmin get versions
    ```

2.  Определите, если резервную копию версии, которую у вас есть имеет данные реестра кластера, в качестве компонента. Существует несколько элементов, которые вам необходимо в эту команду, версии и приложение или компонент для использования на шаге 3. Версию, например резервное копирование было выполнено 3 января 2018 г. в 02:04:00 и это является то, что нужно восстановить.

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  Запуск принудительного восстановления для восстановления только версии реестра кластера, необходимые. 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

После восстановления было выполнено, этот узел должен быть его необходимо сначала запустить службу кластеров и формирования кластера. Затем все остальные узлы должны запускаться и присоединения к кластеру.

## <a name="summary"></a>Сводка 

Проделана вся сумма это, гиперконвергентной аварийного восстановления является то, что следует тщательно планировать, out. Существует несколько сценариев, которые можно ваших требований и следует тщательно протестировать. Обратите внимание, что является то, что если вы знакомы с отказоустойчивыми кластерами в прошлом, растянутых кластеров, не является очень популярной годами. Возникла немного изменение макета с гиперконвергентного решения, и он основан на устойчивость. Если вы потеряете два узла в гиперконвергированный кластер, весь кластер завершает работу. С этой Учитывая это, в среде гиперконвергентной stretch сценарий не поддерживается.


