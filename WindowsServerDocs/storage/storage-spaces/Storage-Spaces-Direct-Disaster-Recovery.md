---
title: Аварийного восстановления для Гиперконвергентной инфраструктурой
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: В этой статье описывается сценариев, доступны для аварийного восстановления Microsoft HCI (локальные дисковые пространства)
ms.localizationpriority: medium
ms.openlocfilehash: 32bbf02ca78d5c6a2147162768c984d0e0b27e36
ms.sourcegitcommit: dfd25348ea3587e09ea8c2224237a3e8078422ae
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2018
ms.locfileid: "4678613"
---
# Аварийное восстановление с локальными дисковыми пространствами

> Область применения: Windows Server 2016, Windows Server 2019 г.

В этом разделе содержатся сценарии как гиперконвергентной инфраструктурой (HCI) можно настроить для аварийного восстановления.

Многочисленные компаний запущены гиперконвергентной решения и планирование аварийного дает возможность оставаться в или в рабочей среде быстро получить в случае сбоя. Существует несколько способов настройки HCI для аварийного восстановления, и в этом документе объясняется, параметры, которые будут доступны пользователю уже сегодня.

Когда обсуждения в случае аварийного восстановления доступность решают то, что известно как восстановления время Целевое значение. Это время, целевые, где необходимо восстановить службы во избежание становился последствия для бизнеса. В некоторых случаях этот процесс может произойти автоматически, в рабочей среде, восстановить практически немедленно. В других случаях вмешательства вручную администратора должен выполняться для восстановления служб.

Аварийного восстановления с гиперконвергентной сегодня это следующие параметры.

1. Несколько кластеры созданной реплики хранилища
2. Реплика Hyper-V между кластерами
3. Архивация и восстановление

## Несколько кластеры созданной реплики хранилища

[Реплика хранилища](../storage-replica/storage-replica-overview.md) позволяет репликации томов и поддерживает синхронную или асинхронную репликацию. При выборе между использованием синхронной или асинхронной репликации, следует учитывать цель точки восстановления (RPO). Цель точка восстановления — объем потери данных, которые вы готовы взиматься, прежде чем он будет считаться основных потери. При переходе с синхронной репликации, он будет последовательно записывать для обеих сторон в то же время. При переходе с асинхронной, записи будут реплицированы очень быстро, но по-прежнему могут быть потеряны. Рассмотрите возможность использования приложения или файла для просмотра, который лучше всего работает на вас.

Реплика хранилища — это механизм копию уровня блоков и уровня файла; Это означает, что он не имеет значения, типы реплицируемых данных. Это облегчает популярным вариантом для гиперконвергентной инфраструктурой. Реплика хранилища также могут использовать различные типы дисков между партнерами репликации, так что наличие все одного типа хранилища на один HCI и другого типа хранилища на другом идеально подходит. 

Одной из важных возможностей реплика хранилища — она могла выполняться в Azure, а также локальный. Можно настроить локальные к локальным, Azure для Azure, или даже в локальной Azure (или наоборот).

В этом случае существует два отдельных кластера независимо. Для настройки реплики хранилища между HCI, выполните действия, описанные в [репликация хранилища в межкластерной](../storage-replica/cluster-to-cluster-storage-replication.md).

![Схема репликация хранилища](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure1.png)

При развертывании реплики хранилища следует принимать во внимание следующие соображения. 

1.  Настройка репликации выполняется вне отказоустойчивой кластеризации. 
2.  Выбор метода репликации будет зависеть задержка передачи по сети и RPO требования. Синхронная репликацию данных в сетях с низкой задержкой на случай сбоя для обеспечения без потери данных во время сбоя. Асинхронные реплицирует данные по сети с помощью соединения, но каждый узел не содержать одинаковых копий во время сбоя. 
3.  В случае сбоя переходы между кластерами не автоматического и должны быть скомпонованы вручную через командлеты PowerShell реплики хранилища. На схеме выше, ClusterA — это основной он ClusterB получателя. Если ClusterA отключается, вам потребуется вручную задать ClusterB как основной, прежде чем вы можете открыть ресурсы. Когда ClusterA резервное копирование, вам потребуется сделать его вспомогательных. После всех данных были синхронизированы вверх, внести изменения и местами роли, способом, которым они были изначально установлены.
4.  Так как реплика хранилища реплицирует только данные, новой виртуальной машины или масштабирования, файловый сервер (SOFS) использования этих данных необходимо будет создаваться внутри диспетчера отказоустойчивости кластеров в партнера репликации.

Реплики хранилища можно использовать, если у вас есть виртуальные машины или SOFS, запущенных в кластере. Перенос ресурсы в оперативный режим в реплике HCI можно вручную или автоматически с помощью сценариев PowerShell.

## Реплика Hyper-V

[Реплика Hyper-V](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica) обеспечивает виртуальной машины уровня репликацию для аварийного восстановления на гиперконвергентной инфраструктурой. Реплика Hyper-V и возможности — взять на виртуальной машине и реплицировать дополнительный сайт или Azure (реплики). Затем на сайте вспомогательных реплики Hyper-V могут реплицировать виртуальную машину с третий (расширенный реплики).

![Схема репликации Hyper-V](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure2.png)

С помощью реплики Hyper-V репликации — это решает, с помощью Hyper-V. При первом включении виртуальной машины для репликации, существует один из трех вариантов как требуется начальной копии должны быть отправлены соответствующие кластеров с реплики.

1.  Отправить начальной копию по сети
2.  Отправка начальной копирования на съемный носитель, таким образом, чтобы он может быть скопирован на сервер вручную
3.  Использование существующей виртуальной машины уже создан на узлах реплики

Другой вариант — для, когда вы хотите этой начальной репликации должен происходить.

1.  Немедленно начать репликации
2.  Запланируйте время, когда происходит начальной репликации. 

Вопросы, что вам нужно — это:

- Какие VHD или vhdx-нужно реплицировать. Вы можете выполнить репликацию все из них или только один из них.
- Количество точек восстановления, которые вы хотите сохранить. Если вы хотите доступно несколько вариантов о том, что на момент времени, который вы хотите восстановить, нужно указать, сколько требуется. Если требуется только одну точку восстановления, вы можете выбрать, а также.
- Как часто вы хотите иметь тома службы теневого копирования (VSS) реплицировать добавочной теневое копирование.
- Как часто изменения реплицируются (30 секунд, 5 минут, 15 минут).

Когда HCI участвовать в реплике Hyper-V, должен быть ресурс [Брокер реплики Hyper-V](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/) , созданный в каждом кластере. Этот ресурс выполняет следующие действия:

1.  Предоставляет единое пространство имен для каждого кластера для реплики Hyper-V для подключения.
2.  Определяет, какой из узлов в кластер реплики (или расширенный реплики) будет находиться в при первом получении копии.
3.  Сохраняет сведения о узла, владеющего реплики (или расширенный реплики) на случай, если перемещения виртуальной машины на другой узел. Он должен отслеживать эти таким образом, чтобы при репликации занимает место, он может отправить информацию подтверждает узлов.

## Архивация и восстановление

Одним из вариантов традиционных аварийного восстановления, которые не говорили о в значительной степени, но так же важен, является всего кластера или узла в кластере. Оба варианта в этом случае использует Windows NT Backup. 

Это всегда рекомендация иметь периодические резервные копии гиперконвергентной инфраструктурой. Во время работы службы кластеров, если взять резервной копии состояния системы, реестра базу данных кластера будет частью этой резервной копии. Восстановление кластера или базы данных имеет два разных методов (Non-Authoritative и Authoritative).

### Неавторизованного

Неавторизованного восстановления может осуществляться с помощью резервной копии Windows NT и указывает на полное восстановление только самого узла кластера. Если потребуется восстановить узле кластера (и базы данных реестра кластера) и все текущие кластера сведения хорошо, следует восстановить с помощью, не являющегося доверенным. Неавторизованного восстановления можно выполнить с помощью интерфейса Windows NT Backup или из командной строки WBADMIN. EXE-ФАЙЛ.

После восстановления узла, дополнениям присоединения к кластеру. Что произойдет является будет начнутся к существующему кластеру под управлением и обновить все его данные с помощью что есть в настоящее время.

### Принудительное

Восстановление конфигурации кластера, с другой стороны, принимает конфигурации кластера назад во времени. Этот тип восстановления следует добиться только в том случае, когда непосредственно в кластере сведения отказ и требуется восстановить. Например кто-то случайно удалена файловом сервере, который содержит более 1000 общих ресурсов и их потребуется снова. Завершение работы принудительное восстановление кластера требуется выполнение резервного копирования из командной строки.

При инициации принудительного восстановления на узле кластера служба кластера останавливается на всех узлах в представлении кластера и зафиксировать конфигурацию кластера. Именно поэтому крайне важно, что сначала запустить службу кластера на узле, на котором было выполнено восстановление поэтому кластера сформирован с помощью новой копии конфигурации кластера.

Для выполнения принудительного восстановления, можно выполнить указанные ниже действия.

1.  Запустите WBADMIN. EXE-файла из командной строки с правами администратора, чтобы получить последнюю версию резервные копии, которые вы хотите установить и убедитесь, что состояние системы один из компонентов можно восстановить.

    ```powershell
    Wbadmin get versions
    ```

2.  Определите, имеется ли у вас есть резервной копии версии данные реестра кластера в нем как компонент. Существует несколько элементов, которые необходимо будет от этой команды, версия и приложения или компонент для использования в шаге 3. Для версии, например резервное копирование было выполнено 3 января 2018 г. в 2:04:00, и это тот, который требуется восстановить.

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  Запустите принудительное восстановление восстановление только кластера реестра версию, которую требуется. 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

После восстановления было выполнено, этот узел, должен быть сначала запустить службу кластеров и формирует кластер. Затем, все остальные узлы необходимо запустить и присоединения к кластеру.

## Краткий обзор 

Для всех до оплачиваемым это, гиперконвергентной аварийного восстановления является то, что следует тщательно планировать, см. Существует несколько сценариев, которые могут наилучшим образом соответствует вашим потребностям и необходимо тщательно проверить. Один элемент отметить — это, если вы знакомы с отказоустойчивыми кластерами в прошлом, растянутых кластеров, не очень популярным вариантом с годами. Возникла немного смены проектирования с гиперконвергентное решение и она основана на устойчивости. Если вы потеряете двумя узлами в гиперконвергентном кластере, весь кластер будет неработоспособным. Со этот случай, в среде гиперконвергентной растяжения сценарий не поддерживается.


