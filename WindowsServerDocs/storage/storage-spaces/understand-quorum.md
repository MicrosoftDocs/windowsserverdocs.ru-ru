---
title: Общие сведения о кворума кластера и пул
description: Общие сведения о кластера и кворума пула с конкретных примеров проходить через структуры.
keywords: Локальные дисковые пространства, кворума, ресурс-свидетель, S2D, кластера кворума, пул кворума, кластера, пул
ms.prod: windows-server-threshold
ms.author: adagashe
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: adagashe
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 24890b191db8bc6934132857e830d4f77c394b02
ms.sourcegitcommit: 28dc7c7f1e44fee7ab2112228af329a9ce0e02ba
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/22/2019
ms.locfileid: "9024142"
---
# Общие сведения о кворума кластера и пул

>Область применения: Windows Server 2016, Windows Server 2019 г.

[Отказоустойчивой кластеризации Windows Server](../../failover-clustering/failover-clustering-overview.md) обеспечивает высокую доступность для рабочих нагрузок. Эти ресурсы считаются высокодоступные, если узлы, которые размещения ресурсов. Тем не менее кластера обычно требуется более половины узлов для работы, который называется наличие *кворума*.

Кворума предназначена для предотвращения *Разделение вычислительных мощностей* сценариев, что может случиться, если раздел в сети, и подмножества узлы не могут взаимодействовать друг с другом. Это может привести к обоих подмножества узлов для владеть рабочей нагрузки и записи в том же диске, что может привести к множество проблем. Тем не менее это осуществляется с помощью отказоустойчивой кластеризации концепция кворума, благодаря чему только один из этих групп узлов продолжать работу, чтобы только один из этих групп останутся доступными.

Кворума определяет количество сбоев, сохраняя по-прежнему может выдерживать кластера. Кворума предназначено для обработки сценария при наличии проблем со связью между подмножества узлов кластера, таким образом, чтобы несколько серверов не пытайтесь одновременно размещения группы ресурсов и записи на диск в то же время. Когда эта концепция кворума, кластера заставит службы кластеров для остановки в одном из подмножества узлы, чтобы убедиться, что существует только один true владельцем группы конкретного ресурса. После узлов, которые были остановлены снова может взаимодействовать с основной группы узлов, они будут автоматически повторное присоединение к кластеру и начать их службой кластеров.

В Windows Server 2016 существует два компонента системы, которые имеют собственные механизмы кворума.

- <strong>Кворума кластера</strong>: Эта функция работает на уровне кластера (т. е. Вы можете потерять узлов и кластера остаются вверх)
- <strong>Пула кворума</strong>: Эта функция работает на уровне пула, при включении локальных дисковых пространств (т. е. Вы можете потерять узлов и дисков и пуле остается вверх). Пулы устройств хранения данных были разработаны для использования в сценариях кластеризованных и некластеризованные, именно поэтому они имеют разные кворума механизм.

## Обзор кворума кластера

В следующей таблице представлен обзор результатов кворума кластера каждого сценария:

| Узлы сервера | Продолжают работать несколько сбоев узел сервера | Продолжают работать отказ одного сервера узла, а затем другой | Продолжают работать сбоев узлов два одновременных сервера |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | 50/50                               | Нет                                                | Нет                                                 |
| 2 + ресурс-свидетель  | Да                                 | Нет                                                | Нет                                                 |
| 3            | Да                                 | 50/50                                             | Нет                                                 |
| 3 + ресурс-свидетель  | Да                                 | Да                                               | Нет                                                 |
| 4            | Да                                 | Да                                               | 50/50                                              |
| 4 + ресурс-свидетель  | Да                                 | Да                                               | Да                                                |
| 5 и более поздние  | Да                                 | Да                                               | Да                                                |

### Рекомендации по кворума кластера

- Если у вас есть два узла,-свидетель — <strong>требуется</strong>.
- Если у вас есть три-четыре узлов,-свидетель — <strong>настоятельно рекомендуется</strong>.
- Если у вас есть доступ к Интернету, используйте <strong> [облако-свидетель](../../failover-clustering/deploy-cloud-witness.md)</strong>
- Если вы в ИТ-среде с помощью других компьютеров и файловые ресурсы, используйте файловый ресурс-свидетель

## Как работает кворума кластера

При сбое узлов или когда некоторое подмножество узлов теряет контакт с другой подмножество, оставшихся узлов необходимо убедиться, что они составляют *большинство* кластера останутся в интерактивном режиме. Если они не может проверить, они будут переходить в автономный режим.

Но концепцию *большинство* работает только четко при общее число узлов в кластере нечетным (например, трех узлов в кластере из пяти узлов). Таким образом как насчет кластеров с четным числом узлов (скажем, четыре узла кластера)?

Существует два способа, которые кластер можно сделать — *Общее количество голосов* нечетным:

1. Во-первых он может переходить *вверх* один, добавив *ресурс-свидетель* с помощью дополнительного проголосовать. Это требуется настройка пользователя.
2.  Или его можно перейти *вниз* один, обнуления голос одного unlucky узла (происходит автоматически, при необходимости).

Всякий раз, когда оставшихся узлов успешно убедиться, что они являются *большинство*, определение *большинство* обновляется включать очень просто уничтожены ранее. Это позволяет кластеру потеряете одного узла, а затем другой, а затем другой и т. д. Это понятие адаптации *Общее количество голосов* после последовательных сбоев называется <strong> *динамическое кворума*</strong>.  

### Динамический ресурс-свидетель

Динамический ресурс-свидетель переключает голоса свидетеля убедитесь, что *Общее число голосов* нечетным. Если число голосов, ресурс-свидетель не имеет право голоса. Если четное количество голосов, ресурс-свидетель имеет право голоса. Динамический ресурс-свидетель значительно снижает риск того, что кластер будет неработоспособным из-за сбоя ресурс-свидетель. Кластера решает, следует ли использовать ресурс-свидетель голоса, соответствующая номеру голосование узлов, которые доступны в кластере.

Динамическое кворума работает с динамический ресурс-свидетель в так, как описано ниже.

### Поведение динамических кворума

- Если у вас есть <strong>даже</strong> число узлов и не ресурс-свидетель, *один узел получает его проголосовать нулями*. Например только три из четырех узлах получить голосов, поэтому *Общее количество голосов* имеет три, а два уничтожены ранее с помощью голоса считаются большинства.
- Если у вас есть <strong>некоторых</strong> число узлов и не ресурс-свидетель, *все они получение голосов*.
- Если у вас есть <strong>даже</strong> число узлов, а также ресурс-свидетель, *санкционируется ресурс-свидетель*, чтобы общее количество нечетным.
- Если у вас есть <strong>некоторых</strong> число узлов, а также ресурс-свидетель, *не проголосовать ресурс-свидетель*.

Динамическое кворума обеспечивает возможность назначать голос в узел динамически во избежание потери большинство голосов и разрешить работы кластера с одного узла (известной как положение последнего man). В качестве примера рассмотрим четырех узлов кластера. Предполагается, что этот кворума требуется 3 голосов. 

В этом случае кластера бы последовали потерян два узла.

![Схема показывает, четыре узла кластера, каждый из которых получает голос](media/understand-quorum/dynamic-quorum-base.png)

Тем не менее динамические кворума запрещает это такую операцию. *Общее количество голосов* , необходимый для кворума теперь определяется в зависимости от числа доступных узлов. Поэтому с динамической кворума кластера останутся вверх, даже если вы потеряете трех узлов.

![Схема, показывающая четырех узлах кластера, с узлами, сбой один раз и количество необходимых голосов, регулируя после каждого сбоя.](media/understand-quorum/dynamic-quorum-step-through.png)

Описанный выше сценарий относится к общего кластера, у которого нет локальными дисковыми пространствами включена. Тем не менее при включении локальных дисковых пространств, кластера поддерживает только два сбоев узлов. Это описано более в [разделе кворума пул](#poolQuorum).

### Примеры:

#### Два узла без него. 
Нулями голос одного узла, поэтому *большинство* голоса определяется из общего числа <strong>1 проголосовать</strong>. Если узел не голосование отключается неожиданно, остаться в живых имеет 1/1 и сохраняется кластера. Если узел голосование отключается неожиданно, остаться в живых имеет 0 или 1 и происходит кластера. Если голосование узел корректно завершит работу, голоса переносится на другой узел и сохраняется кластера. *<strong>Именно поэтому крайне важно, чтобы настроить свидетель.</strong>*

![Подробно описана в случае с двумя узлами без свидетеля кворума](media/understand-quorum/2-node-no-witness.png)

- Продолжают работать сбоя одного сервера: <strong>вероятность 50%</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>нет</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>нет</strong>. 

#### Два узла с свидетель. 
Обоих узлов проголосовать, плюс голосов ресурс-свидетель, поэтому *большинство* определяется из общего числа <strong>3 голосов</strong>. Если из узлов отключается, остаться в живых имеет 2/3 и сохраняется кластера.

![Подробно описана в случае с двумя узлами с свидетеля кворума](media/understand-quorum/2-node-witness.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>нет</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>нет</strong>. 

#### Трех узлов без него.
Проголосовать всех узлов, поэтому *большинство* определяется из общего числа <strong>3 голосов</strong>. Если любой узел отключается, уничтожены ранее, 2/3 и сохраняется кластера. Кластер становится двумя узлами без следящего — на данном этапе вы работаете в сценарий 1.

![Подробно описана в случае с трех узлов без свидетеля кворума](media/understand-quorum/3-node-no-witness.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>вероятность 50%</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>нет</strong>. 

#### Трех узлов с свидетель.
Проголосовать всех узлов, поэтому ресурс-свидетель не проголосовать изначально. *Большинство* определяется из общего числа <strong>3 голосов</strong>. После несколько сбоев кластера содержит два узла с следящего — вернулось в сценарии 2. Таким образом теперь два узла и следящего голосовать.

![Подробно описана в случае с трех узлов с свидетеля кворума](media/understand-quorum/3-node-witness.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>Да</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>нет</strong>. 

#### Четырех узлах без него
Нулями голос одного узла, поэтому *большинство* определяется из общего числа <strong>3 голосов</strong>. После сбоя одного кластера становится трех узлов, а вы работаете в сценарии 3.

![Подробно описана в случае с четырех узлах без свидетеля кворума](media/understand-quorum/4-node-no-witness.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>Да</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>вероятность 50%</strong>. 

#### Четырех узлах с свидетель.
Все узлы голоса и ресурс-свидетель голосов, поэтому *большинство* определяется из общего числа <strong>5 голосов</strong>. После сбоя одного вы работаете в сценарий 4. После двух одновременных сбоев можно пропустить до сценарий 2.

![Подробно описана в случае с четырех узлах с свидетеля кворума](media/understand-quorum/4-node-witness.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>Да</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>Да</strong>. 

#### Пять узлов и более.
Проголосовать всех узлов, или только один голос, независимо от делает нечетным итог. Локальные дисковые пространства не может обработать более двух узлов вниз в любом случае, поэтому на данном этапе не ресурс-свидетель не требуется или полезны.

![В случае с пятью узлами и так далее описано кворума](media/understand-quorum/5-nodes.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>Да</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>Да</strong>. 

Теперь, когда мы понимаем, как работает кворума, давайте рассмотрим типы свидетелей кворума.

### Типы свидетеля кворума

Отказоустойчивая кластеризация поддерживает три типа свидетелей кворума.

- <strong>[Облако ресурс-свидетель](../../failover-clustering\deploy-cloud-witness.md) </strong> -хранилище в Azure доступны двоичных объектов всех узлов кластера. Он хранит сведения о кластеризации в файл witness.log, но не сохранить копию базы данных кластера.
- <strong>Файл ресурса-свидетеля</strong> — файлового ресурса SMB, который настроен на файловом сервере под управлением Windows Server. Он хранит сведения о кластеризации в файл witness.log, но не сохранить копию базы данных кластера.
- <strong>На диске ресурс-свидетель</strong> -небольшой диск кластера в группе доступных хранилищ кластера. Этот диск уровнем доступности и можно отработать между узлами. Он содержит копию базы данных кластера.  <strong>*Диск-свидетель не поддерживается в локальных дисковых пространств*</strong>.

## <a id="poolQuorum"></a>Обзор кворума пула

Мы просто говорили о кворума кластера, который работает на уровне кластера. Теперь рассмотрим пула кворума, который работает на уровне пула (т. е. Вы может привести к потере узлов и диски с данными и пуле остается вверх). Пулы устройств хранения данных были разработаны для использования в сценариях кластеризованных и некластеризованные, именно поэтому они имеют разные кворума механизм.

В следующей таблице представлен обзор результатов кворума пула каждого сценария:

| Узлы сервера | Продолжают работать несколько сбоев узел сервера | Продолжают работать отказ одного сервера узла, а затем другой | Продолжают работать сбоев узлов два одновременных сервера |
|--------------|-------------------------------------|---------------------------------------------------|----------------------------------------------------|
| 2            | Нет                                  | Нет                                                | Нет                                                 |
| 2 + ресурс-свидетель  | Да                                 | Нет                                                | Нет                                                 |
| 3            | Да                                 | Нет                                                | Нет                                                 |
| 3 + ресурс-свидетель  | Да                                 | Нет                                                | Нет                                                 |
| 4            | Да                                 | Нет                                                | Нет                                                 |
| 4 + ресурс-свидетель  | Да                                 | Да                                               | Да                                                |
| 5 и более поздние  | Да                                 | Да                                               | Да                                                |

## Как работает кворума пул

После сбоя дисков или когда некоторое подмножество диски теряет контакт с другой подмножество, оставшихся дисков необходимо убедиться, что они составляют *большинство* пула, чтобы оставаться в оперативном режиме. Если они не может проверить, они будут переходить в автономный режим. Пул это объект, который переходит в автономный режим или сохраняет функциональность в зависимости от того, является ли он имеет достаточное количество дисков для кворума (50% + 1). Владелец ресурса пула (узел active кластера) может быть + 1.

Однако пул кворума по-разному работает с кворума кластера следующим образом:

- пул использует одного узла в кластере как ресурс-свидетель как разрывателя пережившие половину все диски (этот узел, который является владельцем пула ресурсов)
- пул не имеет динамического кворума
- пул не реализовать собственную версию удалить право голоса

### Примеры:

#### Четырех узлах с симметричные макета. 
У каждого из 16 диски одного голоса и узел двумя также имеет одного голоса (так как она является владельцем пула ресурсов). *Большинство* определяется из общего числа <strong>16 голосов</strong>. Если узлы 3 и 4 неработоспособным, оставшихся подмножество состоит из 8 дисков и владельца ресурсов пула, являющийся 9/16 голосов. Таким образом пул сохраняется.

![Пул кворума 1](media/understand-quorum/pool-1.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>Да</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>Да</strong>. 

#### Четырех узлах с симметричные макета и сбоя жесткого диска. 
У каждого из 16 диски одного голоса и узел 2 также имеет одного голоса (так как она является владельцем пула ресурсов). *Большинство* определяется из общего числа <strong>16 голосов</strong>. Во-первых диск 7 отключается. Если узлы 3 и 4 неработоспособным, оставшихся подмножество состоит из 7 дисков и владельца ресурсов пула, являющийся 8 и 16 голосов. Таким образом пул не имеет большинство и отключается.

![Пул кворума 2](media/understand-quorum/pool-2.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>нет</strong>.
- Продолжают работать два сбои сервера одновременно: <strong>нет</strong>. 

#### Четырех узлах с не симметричные макета. 
У каждого из 24 дисках одного голоса и узел двумя также имеет одного голоса (так как она является владельцем пула ресурсов). *Большинство* определяется из общего числа <strong>24 голосов</strong>. Если узлы 3 и 4 неработоспособным, оставшихся подмножество состоит из 8 дисков и владельца ресурсов пула, являющийся 9/24 голосов. Таким образом пул не имеет большинство и отключается.

![Пул кворума 3](media/understand-quorum/pool-3.png)

- Продолжают работать сбоя одного сервера: <strong>Да</strong>.
- Продолжают работать сбоя одного сервера, а затем другой: <strong>определяется </strong>(не выдерживать обоих узлов 3 и 4 неработоспособным, но продолжают работать во всех остальных сценариях.
- Продолжают работать два сбои сервера одновременно: <strong>определяется </strong>(не выдерживать обоих узлов 3 и 4 неработоспособным, но продолжают работать во всех остальных сценариях.

### Рекомендации по кворума пул

- Убедитесь, что каждого узла в кластере симметричные (каждый узел имеет одинаковое число дисков)
- Включите трехстороннее зеркало или двойной четности может допустить сбоев узлов и сохранения виртуальных дисков через Интернет. См. в разделе [Страница "инструкции" тома](plan-volumes.md) для получения дополнительных сведений.
- При более чем двух узлов, вниз или двух узлов и диск на другой узел вниз, тома могут не иметь доступа на все три копии данных и таким образом станет недоступным и окажется недоступным. Рекомендуется вернуть серверы или заменить дисков быстро, чтобы обеспечить большинство устойчивость для всех данных в томе.

## Дополнительные сведения

- [Настройка кворума и управление им](../../failover-clustering/manage-cluster-quorum.md)
- [Развертывание облака-свидетеля](../../failover-clustering/deploy-cloud-witness.md)
