---
title: Вложенные устойчивости для дисковых пространств
ms.prod: windows-server-threshold
ms.author: jgerend
ms.manager: dansimp
ms.technology: storagespaces
ms.topic: article
author: cosmosdarwin
ms.date: 11/06/2018
ms.openlocfilehash: 206d5d19ec55774f9055e7265d4c87d276c60590
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59879575"
---
# <a name="nested-resiliency-for-storage-spaces-direct"></a>Вложенные устойчивости для дисковых пространств

> Относится к: Windows Server 2019

Вложенные устойчивость — это новая возможность [Storage Spaces Direct](storage-spaces-direct-overview.md) в 2019 Windows Server, позволяющий двумя серверами кластера противостоять несколько сбоев оборудования в то же время, без потери доступности хранилища, так что пользователи, приложения, и виртуальные машины продолжают работать без перебоев в работе. В этом разделе объясняется, как это работает, приводятся пошаговые инструкции, чтобы приступить к работе, а также ответы на часто задаваемые вопросы.

## <a name="prerequisites"></a>предварительные требования

### <a name="green-checkmark-iconmedianested-resiliencysupportedpng-consider-nested-resiliency-if"></a>![Значок с зеленой галочкой.](media/nested-resiliency/supported.png) Рекомендуется использовать вложенные устойчивость в случае, если:

- Кластер работает Windows Server 2019; и
- Кластер содержит ровно 2 узлов сервера

### <a name="red-x-iconmedianested-resiliencyunsupportedpng-you-cant-use-nested-resiliency-if"></a>![Значок красного значка X.](media/nested-resiliency/unsupported.png) Нельзя использовать вложенные устойчивость, если:

- Кластер работает Windows Server 2016; или
- Кластер содержит 3 или более узлов сервера

## <a name="why-nested-resiliency"></a>Почему вложенных устойчивости

Тома, использующие вложенных устойчивости можно **оставаться сети и доступны, даже если произойти несколько сбоев оборудования, в то же время**, в отличие от классической [двустороннего зеркального отображения](storage-spaces-fault-tolerance.md) устойчивости. Например при сбое двух дисков, в то же время, или если сервер выйдет из строя, и в случае сбоя диска, тома, использующие вложенных устойчивости оставаться сети и доступен. Для гиперконвергентной инфраструктуры это увеличивает время бесперебойной работы для приложения и виртуальные машины; для рабочих нагрузок сервера файл это означает, что пользователи имеют непрерывный доступ к своим файлам.

![Доступность хранилища](media/nested-resiliency/storage-availability.png)

Компромисс заключается в этой вложенной устойчивости имеет **снизить эффективность емкости по сравнению с классической двухстороннего зеркалирования**, то есть вы получаете немного меньше места, можно использовать. Дополнительные сведения см. в разделе [эффективность емкость](#capacity-efficiency) разделе ниже.

## <a name="how-it-works"></a>Принцип работы

### <a name="inspiration-raid-51"></a>Вдохновение: RAID 5 + 1

RAID 5 + 1 является установленным формой устойчивости распределенного хранилища, предоставляющий полезную справочную для обеспечения устойчивости вложенных понимание. В режиме RAID 5 + 1, на каждом сервере, локальный устойчивости обеспечивается RAID-5, или *единый четности*, для защиты от потери любой одного диска. Затем дальнейшей устойчивости обеспечивается RAID-1, или *зеркалировании*, между двумя серверами для защиты от потери либо сервер.

![RAID 5 + 1](media/nested-resiliency/raid-51.png)

### <a name="two-new-resiliency-options"></a>Два новых параметра устойчивости

Дисковых пространств в Windows Server 2019 предлагает два новых параметра устойчивости, реализован в программном обеспечении, без необходимости специализированного оборудования RAID:

- **Вложенные двустороннего зеркала.** На каждом сервере локального устойчивости предоставляется двустороннее зеркальное отображение, и затем дальнейшей устойчивости обеспечивается двустороннее зеркальное отображение между двумя серверами. Это по сути зеркале, с помощью двух копий на каждом сервере. Вложенные двустороннее зеркальное отображение абсолютной производительности: запись производится на все копии и операции чтения поступать из любой копии.

  ![Вложенные двухстороннее зеркало](media/nested-resiliency/nested-two-way-mirror.png)

- **Вложенные четность ускорением на зеркальный.** Объединение вложенных двустороннее зеркальное отображение, выше, с помощью вложенных четности. На каждом сервере локального устойчивости для большинства данных обеспечивается одним [побитовое четности арифметические](storage-spaces-fault-tolerance.md#parity), за исключением новых последних операций записи, которые используете двустороннее зеркальное отображение. Затем дальнейшей устойчивости для всех данных обеспечивается двустороннее зеркальное отображение между серверами. Дополнительные сведения об ускоренной зеркальной works четности, см. в разделе [ускорением зеркальной четности](https://docs.microsoft.com/windows-server/storage/refs/mirror-accelerated-parity).

  ![Вложенные четности зеркальной аппаратным ускорением](media/nested-resiliency/nested-mirror-accelerated-parity.png)

### <a name="capacity-efficiency"></a>Эффективность емкости

Емкости эффективности — это отношение свободного места для [объем тома](plan-volumes.md#choosing-the-size-of-volumes). Здесь описаны затраты на емкость, относящиеся к устойчивости и зависит от выбранного параметра устойчивости. В качестве простого примера хранение данных без устойчивость — это эффективный 100% емкости (1 ТБ данных занимает 1 ТБ емкости физического хранилища), одновременно двустороннего зеркального отображения — 50% эффективный (1 ТБ данных занимает 2 ТБ емкости физического хранилища).

- **Вложенные двустороннее зеркало** записывает четыре копии всего содержимого, то есть для хранения 1 ТБ данных, требуется 4 ТБ емкости физического хранилища. Несмотря на то, что его простоте привлекательными, эффективность емкости вложенных двустороннее зеркало 25% являются самыми низкими среди любого параметра устойчивость в дисковых пространств.

- **Вложенные ускорением зеркальной четности** достигает повышения эффективности емкости, около 35 – 40%, которая зависит от двух факторов: число емкость дисков в каждый сервер и сочетание зеркала и четности, укажите для тома. В этой таблице представлены уточняющего запроса для стандартных конфигураций:

  | Емкость жестких дисков на сервере | зеркальный 10% | зеркальный 20% | зеркальный 30% |
  |----------------------------|------------|------------|------------|
  | 4                          | 35.7%      | 34.1%      | 32.6%      |
  | 5                          | 37.7%      | 35.7%      | 33.9%      |
  | 6                          | 39.1%      | 36.8%      | 34.7%      |
  | 7+                         | 40.0%      | 37.5%      | 35.3%      |

  > [!NOTE]
  > **Если вам интересно, ниже приведен пример полного вычисления.** Предположим, что у нас есть шесть емкость дисков в каждом из двух серверов, и мы хотим создать один том 100 ГБ, состоящего из 10 ГБ зеркального отображения и 90 ГБ четности. Двухстороннее зеркало локального сервера эффективный 50,0%, то есть 10 ГБ данных зеркальной передается 20 ГБ для хранения на каждом сервере. На обоих серверах в зеркальном отображении, его общее занимаемое место — 40 ГБ. Server local одинарной четности, в данном случае является 5/6 = 83.3% эффективным, то есть 90 ГБ для хранения данных четности принимает 108 ГБ для хранения на каждом сервере. На обоих серверах в зеркальном отображении, его общий объем составляет 216 ГБ. Таким образом, общий объем [(10 ГБ/50,0%) + (90 ГБ / 83.3%)] × 2 = 256 ГБ, для % 39.1 общую эффективность емкости.

Обратите внимание, что эффективность емкости классического двустороннее зеркальное отображение (около 50%) и вложенные ускорением зеркальной четности (до 40%) не сильно отличаются. В зависимости от требований предусматривающее более низкую эффективность емкости возможно, стоит в значительном увеличении доступности хранилища. Вы выбираете устойчивости каждого тома, поэтому вложенные устойчивости тома и тома классической двустороннее зеркало в одном кластере можно комбинировать.

![Компромисс](media/nested-resiliency/tradeoff.png)

## <a name="usage-in-powershell"></a>Использование в PowerShell

Можно использовать командлеты знакомы хранилища в PowerShell для создания томов с вложенной устойчивости.

### <a name="step-1-create-storage-tier-templates"></a>Шаг 1. Создание шаблонов уровня хранилища

Во-первых, создание новых шаблонов уровня хранилища, с помощью `New-StorageTier` командлета. Требуется только однократно и затем ссылаться на эти шаблона для каждого нового тома, созданные. Укажите `-MediaType` емкости дисков и, возможно, `-FriendlyName` по своему усмотрению. Не изменяйте другие параметры.

Если ваши диски емкостью жестких дисков (HDD), запустите PowerShell от имени администратора и выполните:

```PowerShell 
# For mirror
New-StorageTier -StoragePoolFriendlyName S2D* -FriendlyName NestedMirror -ResiliencySettingName Mirror -MediaType HDD -NumberOfDataCopies 4

# For parity
New-StorageTier -StoragePoolFriendlyName S2D* -FriendlyName NestedParity -ResiliencySettingName Parity -MediaType HDD -NumberOfDataCopies 2 -PhysicalDiskRedundancy 1 -NumberOfGroups 1 -FaultDomainAwareness StorageScaleUnit -ColumnIsolation PhysicalDisk 
``` 

Если емкость дисков твердотельных накопителей (SSD), набор `-MediaType` для `SSD` вместо этого. Не изменяйте другие параметры.

> [!TIP]
> Проверка успешно создана с уровнями `Get-StorageTier`.

### <a name="step-2-create-volumes"></a>Шаг 2. Создание томов

Затем создайте новые тома с помощью `New-Volume` командлета.

#### <a name="nested-two-way-mirror"></a>Вложенные двухстороннее зеркало

Чтобы использовать вложенные двустороннее зеркало, ссылаться `NestedMirror` уровня шаблон и укажите размер. Пример:

```PowerShell
New-Volume -StoragePoolFriendlyName S2D* -FriendlyName Volume01 -StorageTierFriendlyNames NestedMirror -StorageTierSizes 500GB
```

#### <a name="nested-mirror-accelerated-parity"></a>Вложенные четности зеркальной аппаратным ускорением

Использование вложенных четности зеркальной аппаратным ускорением, ссылаться на оба `NestedMirror` и `NestedParity` уровня шаблонов и укажите двух размеров, по одному для каждой части тома (зеркальные во-первых, четности во-вторых). Например чтобы создать один том 500 ГБ, 20% вложенных двустороннего зеркала и 80% вложенных четности, выполните:

```PowerShell
New-Volume -StoragePoolFriendlyName S2D* -FriendlyName Volume02 -StorageTierFriendlyNames NestedMirror, NestedParity -StorageTierSizes 100GB, 400GB
```

### <a name="step-3-continue-in-windows-admin-center"></a>Шаг 3. По-прежнему в Windows Admin Center

Тома, использующие вложенных устойчивости [Windows Admin Center](https://docs.microsoft.com/windows-server/manage/windows-admin-center/understand/windows-admin-center) с очистить обозначениями, как показано на следующем снимке экрана. Как только они созданы, можно управлять и отслеживать их с помощью Windows Admin Center так же, как и любого другого тома в дисковых пространств.

![](media/nested-resiliency/windows-admin-center.png)

### <a name="optional-extend-to-cache-drives"></a>Дополнительно Расширение в кэш-дисках

С настройками по умолчанию вложенные устойчивости обеспечивает защиту от потери нескольких дисков емкость, в то же время, или один сервер и один диск емкостью в то же время. Расширить эту защиту, чтобы [кэширования дисков](understand-the-cache.md) имеет дополнительное замечание: так как кэш-дисках, часто предоставляет разрешение на чтение *и записи* кэширование для *несколько* емкости дисков , единственный способ обеспечить нормальную потери кэша диска, когда другой сервер не работает — просто не кэшируют операции записи, но который влияет на производительность.

Для решения данной проблемы, Storage Spaces Direct предоставляет возможность автоматически отключить кэширование записи, если один сервер в кластере с двумя серверами не работает, а затем повторно включить кэширование записи после установки сервера резервного копирования. Для обеспечения рутинных перезапуска не влияет на производительность, записи кэширование не отключено, пока сервер не работает для 30 минут.

Чтобы задать это поведение (необязательно), запустите PowerShell от имени администратора и выполните:

```PowerShell
Get-StorageSubSystem Cluster* | Set-StorageHealthSetting -Name "System.Storage.NestedResiliency.DisableWriteCacheOnNodeDown.Enabled" -Value "True"
```

После загрузки установить `True`, поведение кэша:

| Ситуация                       | Поведение кэша                           | Можно допустить потерю кэша диска? |
|---------------------------------|------------------------------------------|--------------------------------|
| Настройки обоих серверов                 | Чтения и записи, полной производительности кэша | Да                            |
| Сервер отключен, первые 30 минут   | Чтения и записи, полной производительности кэша | Нет (временно)               |
| После первых 30 минут          | Чтений кэша, влияет на производительность   | Да                            |

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="can-i-convert-an-existing-volume-between-two-way-mirror-and-nested-resiliency"></a>Можно ли преобразовать существующий том между двустороннего зеркала и вложенных устойчивости?

Нет, тома нельзя преобразовать между типами устойчивости. Для новых развертываний на Windows Server 2019 необходимо указать заранее, какой тип устойчивости наиболее соответствует вашим требованиям. При обновлении с Windows Server 2016, можно создать новые тома с вложенной устойчивостью, перенос данных и затем удалите старые тома.

### <a name="can-i-use-nested-resiliency-with-multiple-types-of-capacity-drives"></a>Можно использовать вложенные устойчивости с несколькими типами емкости дисков?

Да, просто укажите `-MediaType` каждого уровня соответствующим образом во время [шаг 1](#step-1-create-storage-tier-templates) выше. Например, с NVMe SSD и HDD, в том же кластере, NVMe предоставляет кэш во время два предоставляют емкость: задать `NestedMirror` уровням в `-MediaType SSD` и `NestedParity` уровень `-MediaType HDD`. В этом случае Обратите внимание, что эффективность емкости четности зависит от количества дисков HDD только вам потребуется по крайней мере 4 из них на каждом сервере.

### <a name="can-i-use-nested-resiliency-with-3-or-more-servers"></a>Можно использовать вложенные устойчивости с 3 или более серверами?

Нет, только использовать вложенные устойчивость, если кластер содержит ровно 2 серверов.

### <a name="how-many-drives-do-i-need-to-use-nested-resiliency"></a>Какое количество дисков нужно ли использовать вложенные устойчивости?

Минимальное число дисков, необходимые для дисковых пространств — 4 емкости жестких дисков на узел сервера, а также 2 кэш жестких дисков на узле сервера (если таковые имеются). Это изменились по сравнению с Windows Server 2016. Нет дополнительных требований к для обеспечения устойчивости вложенные и рекомендации для резервной мощности слишком без изменений.

### <a name="does-nested-resiliency-change-how-drive-replacement-works"></a>Вложенные устойчивости изменяется как работает замены диска?

Нет.

### <a name="does-nested-resiliency-change-how-server-node-replacement-works"></a>Вложенные устойчивости изменяется как замена узла сервера работает?

Нет. Чтобы заменить узел сервера и его диски, выполняйте в указанном порядке:

1. Прекращение использования дисков в сервер исходящей
2. Добавьте новый сервер, с ее дисков в кластер
3. Выполнит повторную балансировку пула носителей
4. Удаление сервера исходящей и его диски

Дополнительные сведения см. [удалять серверы](remove-servers.md) раздела.

## <a name="see-also"></a>См. также

- [Общие сведения о дисковых хранилища](storage-spaces-direct-overview.md)
- [Понять, устойчивость к сбоям в Storage Spaces Direct](storage-spaces-fault-tolerance.md)
- [Планирование томов в дисковых пространств](plan-volumes.md)
- [Создайте тома в дисковых пространств](create-volumes.md)
