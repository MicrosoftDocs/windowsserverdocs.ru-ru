---
title: Развертывание дисковых пространств на автономном сервере
description: В этой статье описывается развертывание дисковых пространств на автономном сервере под управлением Windows Server 2012.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-spaces
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: f9b5d2b0d5acfcbde52131c29704e38d835d048e
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66447548"
---
# <a name="deploy-storage-spaces-on-a-stand-alone-server"></a>Развертывание дисковых пространств на автономном сервере

>Относится к: Windows Server 2019 г., Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описывается развертывание дисковых пространств на изолированном сервере. Сведения о создании кластерных дисковых пространств, см. в разделе [развертывание кластера дисковых пространств в Windows Server 2012 R2](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>).

Перед тем как создать дисковое пространство, сначала нужно создать один или несколько пулов носителей. Пул носителей — это набор физических дисков. Пулы обеспечивают агрегирование хранилища, гибкое наращивание емкости и делегирование административных функций.

Из пула носителей можно создавать один или несколько виртуальных дисков. Такие виртуальные диски также называются *дисковыми пространствами*. Дисковое пространство в операционной системе Windows представлено как обычный диск, на котором можно создавать форматированные тома. При создании виртуального диска через пользовательский интерфейс файловых служб и служб хранилища можно задать тип устойчивости (простая, зеркальное отображение или контроль четности), тип подготовки (тонкая или фиксированная) и размер. С помощью Windows PowerShell можно задать дополнительные параметры, такие как число столбцов, значение чередования и используемые физические диски в пуле. Сведения об этих дополнительных параметрах см. в разделе [New-VirtualDisk](https://docs.microsoft.com/powershell/module/storage/new-virtualdisk?view=win10-ps) и [что такое столбцы и как дисковые пространства определяет, сколько использовать?](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx%23what_are_columns_and_how_does_storage_spaces_decide_how_many_to_use) в хранилище пробелы часто задаваемые вопросы и.

>[!NOTE]
>Не удается использовать дисковое пространство для размещения операционной системы Windows.

На виртуальном диске можно создать один или несколько томов. При создании тома можно настроить размер, буква диска или папка, файловая система (NTFS или Resilient File System (ReFS)), размер кластера и необязательная метка тома.

На следующем рисунке показан процесс работы с дисковыми пространствами.

![Рабочий процесс дисковых пространств](media/deploy-standalone-storage-spaces/storage-spaces-workflow.png)

**Рис. 1. Рабочий процесс дисковых пространств хранения**

>[!NOTE]
>В этом разделе приводятся примеры командлетов Windows PowerShell, которые можно использовать для автоматизации некоторых описанных процедур. Дополнительные сведения см. в разделе [PowerShell](https://docs.microsoft.com/powershell/scripting/powershell-scripting?view=powershell-6).

## <a name="prerequisites"></a>предварительные требования

Для использования дисковых пространств на изолированном сервере 2012−based Windows Server, убедитесь, что физические диски, которые вы хотите использовать выполнить следующие условия.

> [!IMPORTANT]
> Если вы хотите узнать, как развертывать дисковые пространства в отказоустойчивом кластере, см. в разделе [развертывание кластера дисковых пространств в Windows Server 2012 R2](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>). При развертывании отказоустойчивого кластера действуют другие обязательные условия, такие как типы шин поддерживаемых дисков, поддерживаемые типы устойчивости и минимальное необходимое количество дисков.

|Область|Требование|Примечания|
|---|---|---|
|Типы дисковых шин|-Serial Attached SCSI (SAS)<br>-Серийный Advanced Technology Attachment (SATA)<br>-iSCSI и Fibre Channel контроллеров. |Также можно использовать USB-диски. Тем не менее не является оптимальным, чтобы использовать USB-диски в серверной среде.<br>Дисковые пространства поддерживается в iSCSI и Fibre Channel (FC) контроллерами, до тех пор, пока не становится отказоустойчивым (простое с любым количеством столбцов), виртуальные диски, созданные на их основе.<br>|
|Конфигурация дисков|-Физические диски должны иметь по крайней мере 4 ГБ<br>-Диски должны быть пустыми и неформатированными. Не создавайте тома.||
|Замечания по поводу адаптера шины|— Рекомендуется использовать простая адаптеров шины (HBA), не поддерживающие RAID<br>— Если RAID с поддержкой, адаптеров шины должен быть в режиме RAID отключены все функции RAID<br>-Адаптеры не должны абстрагировать физические диски, кэшировать данные или скрывать любой подключенные устройства. Это относится и к службам, предоставляемым подключенными устройствами JBOD. |Дисковые пространства совместимы только с адаптерами шины, в которых можно полностью отключить все функции RAID.|
|Массивы JBOD|-Массивы JBOD необязательны.<br>— Рекомендуется использовать дисковые пространства certified корпуса, перечисленные в каталоге Windows Server<br>— Если вы используете вложению JBOD, уточните поставщику хранилища, что корпус поддерживает дисковых пространств для обеспечения полной функциональности<br>-Чтобы определить, поддерживает ли корпуса JBOD идентификацию массива и слотов, выполните следующий командлет Windows PowerShell:<br><br>`Get-PhysicalDisk \| ? {$_.BusType –eq "SAS"} \| fc`<br><br>Если **EnclosureNumber** и **SlotNumber** поля содержат значения, то массив поддерживает эти функции.||

Для планирования числа физических дисков и нужного типа устойчивости для автономной серверной среды используйте следующие рекомендации.

|Тип устойчивости|Требования к диску|Время использования|
|---|---|---|
|**Простая**<br><br>-Данные чередуются между физическими дисками<br>-Обеспечивает максимальную емкость и повышает пропускную способность<br>— Должен отсутствовать устойчивости (не защищает от сбоя диска)<br><br><br><br><br><br><br>|Требуется по крайней мере один физический диск.|Не используйте его для размещения невосстановимых данных. Простой пробелы не защищает от сбоев дисков.<br><br>Используйте для размещения временных или легко восстановимых данных за небольшую стоимость.<br><br>Подходит для высокопроизводительных рабочих нагрузок, где устойчивость не требуется или уже предоставленных приложением.|
|**Зеркальное отображение**<br><br>-Сохраняет два или три копии данных на набор физических дисков<br>-Повышает надежность, но снижает доступную емкость. При каждой записи возникает дублирование. В зеркальном дисковом пространстве данные также распределяются по нескольким физическим дискам.<br>-Более высокую пропускную способность данных и меньшую задержку доступа, чем четности<br>-Использует "грязный" Отслеживание областей (DRT) для отслеживания изменений на дисках в пуле. Когда система возобновляет работу после незапланированного выключения, и восстанавливается доступ к пространствам, DRT осуществляет согласование дисков в пуле друг с другом.|Требует по крайней мере два физических диска для защиты от одного отказа диска.<br><br>Требует по крайней мере пять физических дисков для защиты от двух одновременных отказов дисков.|Рекомендуется использовать в большинстве сред. Например, зеркальные пространства подходят для файлового ресурса общего назначения или библиотеки виртуальных жестких дисков.|
|**Четность**<br><br>-Разделяются данные и информация о четности распределяются физических дисков<br>-Повышает надежность, когда он сравнивается с простой устойчивостью, но несколько снижает емкость<br>-Повышает устойчивость за счет ведения журнала. Это помогает предотвратить повреждение данных при возникновении незапланированных выключений.|Требует по крайней мере три физических диска для защиты от одного отказа диска.|Рекомендуется использовать для строго последовательных рабочих нагрузок, таких как архивация или резервное копирование.|

## <a name="step-1-create-a-storage-pool"></a>Шаг 1. Создание пула носителей

Сначала необходимо сгруппировать доступные физические диски в один или несколько пулов носителей.

1. В области навигации диспетчера серверов выберите **файловых служб и служб хранилища**.

2. В области навигации выберите **пулы носителей** страницы.
    
    По умолчанию доступные диски включаются в пул под названием *primordial*. Если в разделе **ПУЛЫ НОСИТЕЛЕЙ** нет пула primordial, это значит, что хранилище не соответствует требованиям к дисковым пространствам. Убедитесь, что диски соответствуют требованиям, перечисленным в разделе "Предварительные условия".
    
    >[!TIP]
    >Если выбрать пул носителей **Primordial**, доступные физические диски будут представлены в разделе **ФИЗИЧЕСКИЕ ДИСКИ**.

3. В разделе **ПУЛЫ НОСИТЕЛЕЙ**выберите **ЗАДАЧИ** , а затем выберите **новый пул носителей**. Откроется мастер создания пула носителей.

4. На **перед началом** выберите **Далее**.

5. На **укажите имя пула носителей и подсистемы** странице, введите имя и необязательное описание пула носителей, выберите группу доступных физических дисков, которые вы хотите использовать, а затем выберите **Далее**.

6. На **Выбор физических дисков для пула носителей** странице, выполните следующие действия, а затем выберите **Далее**:
    
    1. Установите флажок рядом с каждым физическим диском, который нужно включить в пул носителей.
    
    2. Если вы хотите назначить один или несколько дисков в качестве горячего резерва, в разделе **выделения**, щелкните стрелку раскрывающегося списка, а затем выберите **горячий резерв**.

7. На **подтверждение выбранных элементов** странице, убедитесь, что параметры указаны правильно, а затем выберите **создать**.

8. На **просмотреть результаты** странице, убедитесь, что все задачи завершения, а затем выберите **закрыть**.
    
    >[!NOTE]
    >Либо, чтобы перейти непосредственно к следующему шагу, можно установить флажок **Создать виртуальный диск при закрытии мастера**.

9. Убедитесь, что новый пул носителей представлен в списке **ПУЛЫ НОСИТЕЛЕЙ**.

### <a name="windows-powershell-equivalent-commands-for-creating-storage-pools"></a>Эквивалентные команды Windows PowerShell для создания пулов носителей

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

В следующем примере показано, какие физические диски доступны в пуле primordial.

```PowerShell
Get-StoragePool -IsPrimordial $true | Get-PhysicalDisk | Where-Object CanPool -eq $True
```

В следующем примере создается новый пул носителей с именем *StoragePool1* , используются все доступные диски.

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk –CanPool $True)
```

В следующем примере создается новый пул носителей, *StoragePool1*, который использует четыре из доступных дисков.

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk PhysicalDisk1, PhysicalDisk2, PhysicalDisk3, PhysicalDisk4)
```

Следующая серия командлетов демонстрирует, как добавить доступный физический диск *PhysicalDisk5* в горячий резерв для пула носителей *StoragePool1*.

```PowerShell
$PDToAdd = Get-PhysicalDisk –FriendlyName PhysicalDisk5
Add-PhysicalDisk –StoragePoolFriendlyName StoragePool1 –PhysicalDisks $PDToAdd –Usage HotSpare
```

## <a name="step-2-create-a-virtual-disk"></a>Шаг 2. Создание виртуального диска

Затем необходимо создать один или несколько виртуальных дисков из пула носителей. При создании виртуального диска можно выбрать способ размещения данных на физических дисках. Это влияет как на надежность, так и на производительность. Также можно выбрать, создавать ли диски с тонкой или фиксированной подготовкой.

1. Если мастер создания виртуального диска еще не открыт, на странице **Пулы носителей** в диспетчере серверов в разделе **ПУЛЫ НОСИТЕЛЕЙ** выберите нужный пул носителей.

2. В разделе **виртуальные ДИСКИ**выберите **ЗАДАЧИ** , а затем выберите **новый виртуальный диск**. Откроется мастер создания виртуального диска.

3. На **перед началом** выберите **Далее**.

4. На **выберите пул носителей** странице, выберите нужный пул носителей, а затем выберите **Далее**.

5. На **укажите имя виртуального диска** странице, введите имя и необязательное описание, а затем выберите **Далее**.

6. На **Выбор структуры хранилища** странице, выберите нужную структуру, а затем **Далее**.
    
    >[!NOTE]
    >Если выбран макет, где у вас нет достаточного количества физических дисков, вы получите сообщение об ошибке, при выборе **Далее**. Сведения о какой макет следует использовать и на диске, см. в разделе [предварительные требования](#prerequisites)).

7. Если вы выбрали **зеркальный** как структура хранилища и имеется пять или более дисков в пуле, **настроить параметры устойчивости** страницы будет отображаться. Выберите один из следующих вариантов:
    
      - **Двухстороннее зеркало**
      - **Трехстороннее зеркало**

8. На **укажите тип подготовки** странице, выберите один из следующих параметров, а затем выберите **Далее**.
    
   - **Тонкая**
        
     При тонкой подготовке пространство выделяется по необходимости. Это оптимизирует использование доступного хранилища. Однако поскольку такой вариант делает возможным чрезмерное выделение пространства хранения, необходимо внимательно следить за доступным дисковым пространством.
    
   - **Фиксированная**
        
     При фиксированной подготовке емкость хранилища выделяется немедленно в момент создания виртуального диска. Таким образом, при фиксированной подготовке используется пространство из пула носителей, эквивалентное размеру виртуального диска.
    
     >[!TIP]
     >Для дисковых пространств можно создавать виртуальные диски с тонкой и фиксированной подготовкой в одном пуле носителей. Например, можно использовать виртуальный диск с тонкой подготовкой для размещения базы данных, а виртуальный диск с фиксированной подготовкой для размещения связанных файлов журнала.

9. На странице **Указание размера виртуального диска** выполните следующие действия.
    
    Если выбрана тонкая подготовка на предыдущем шаге, в **размер виртуального диска** введите размер виртуального диска, укажите единицы измерения (**МБ**, **ГБ**, или **ТБ** ), а затем выберите **Далее**.
    
    Если выбрана Фиксированная Подготовка на предыдущем шаге, выберите один из следующих:
    
      - **Задать размер**
        
        Чтобы задать размер, введите значение в **размер виртуального диска** , а затем укажите единицы измерения (**МБ**, **ГБ**, или **ТБ**).
        
        Если используется структура хранилища, отличная от простой, виртуальный диск использует больше свободного пространства, чем будет указано. Во избежание возможной ошибки, когда размер тома превышает свободное пространство пула носителей, можно установить флажок **Создать максимально большой виртуальный диск вплоть до указанного размера**.
    
      - **Максимальный размер**
        
        Выберите этот вариант, чтобы создать виртуальный диск, который использует максимальную емкость пула носителей.

10. На **подтверждение выбранных элементов** странице, убедитесь, что параметры указаны правильно, а затем выберите **создать**.

11. На **просмотреть результаты** странице, убедитесь, что все задачи завершения, а затем выберите **закрыть**.
    
    >[!TIP]
    >По умолчанию флажок **Создать том при закрытии мастера** установлен. После этого вы перейдете сразу же к следующему шагу.

### <a name="windows-powershell-equivalent-commands-for-creating-virtual-disks"></a>Эквивалентные команды Windows PowerShell для создания виртуальных дисков

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

В следующем примере создается виртуальный диск 50 ГБ с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*.

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB)
```

В следующем примере создается зеркальный виртуальный диск с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*. Максимальная емкость пула носителей используется на диске.

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –ResiliencySettingName Mirror –UseMaximumSize
```

В следующем примере создается виртуальный диск 50 ГБ с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*. Для диска используется тонкая подготовка.

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB) –ProvisioningType Thin
```

В следующем примере создается виртуальный диск с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*. Для диска используется трехстороннее зеркальное отображение, а его размер фиксирован и равен 20 ГБ.

>[!NOTE]
>Для работы этого командлета в пуле носителей должно быть по крайней мере пять физических дисков. (Сюда не относятся диски, выделенные для горячего резерва.)

```PowerShell
New-VirtualDisk -StoragePoolFriendlyName StoragePool1 -FriendlyName VirtualDisk1 -ResiliencySettingName Mirror -NumberOfDataCopies 3 -Size 20GB -ProvisioningType Fixed
```

## <a name="step-3-create-a-volume"></a>Шаг 3. Создание тома

Затем в виртуальном диске нужно создать том. Можно назначить необязательную букву диска или папки, а затем отформатировать том с файловой системой.

1. Если мастер создания томов еще не открыто, откройте **пулы носителей** странице в диспетчере серверов в разделе **виртуальные ДИСКИ**, щелкните правой кнопкой мыши нужный виртуальный диск и затем выберите **новый том**.
    
    Откроется мастер создания томов.

2. На **перед началом** выберите **Далее**.

3. На **выберите сервер и диск** странице, выполните следующие действия, а затем выберите **Далее**.
    
    1. В **Server** области, выберите сервер, на котором вы хотите подготовить том.
    
    2. В **диска** области, выберите виртуальный диск, на котором вы хотите создать том.

4. На **укажите размер тома** введите размер тома, укажите единицы измерения (**МБ**, **ГБ**, или **ТБ**), а затем выберите **Далее**.

5. На **назначать букву диска или папке** странице, задайте нужный вариант, а затем выберите **Далее**.

6. На **Выбор параметров файловой системы** странице, выполните следующие действия, а затем выберите **Далее**.
    
    1. В **файловая система** выберите пункт **NTFS** или **ReFS**.
    
    2. В списке **Размер кластера** оставьте значение **По умолчанию** или задайте размер кластера.
        
        >[!NOTE]
        >Дополнительные сведения о размере, см. в разделе [размер кластера по умолчанию для NTFS, FAT и exFAT](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat).

    
    3. Также можно в поле **Метка тома** ввести метку для тома, например **HR Data**.

7. На **подтверждение выбранных элементов** странице, убедитесь, что параметры указаны правильно, а затем выберите **создать**.

8. На **просмотреть результаты** странице, убедитесь, что все задачи завершения, а затем выберите **закрыть**.

9. Чтобы убедиться, что том был создан, в диспетчере серверов выберите **тома** страницы. Том будет указан в разделе сервера, где он был создан. Создание тома также можно проверить в проводнике Windows.

### <a name="windows-powershell-equivalent-commands-for-creating-volumes"></a>Эквивалентные команды Windows PowerShell для создания тома

Следующий командлет Windows PowerShell выполняет ту же функцию, как в предыдущей процедуре. Введите команду в одну строку.

В следующем примере инициализируются диски для виртуального диска *VirtualDisk1*, создается раздел с назначенной буквой диска, а затем том форматируется с использованием файловой системы NTFS по умолчанию.

```PowerShell
Get-VirtualDisk –FriendlyName VirtualDisk1 | Get-Disk | Initialize-Disk –Passthru | New-Partition –AssignDriveLetter –UseMaximumSize | Format-Volume
```

## <a name="additional-information"></a>Дополнительные сведения

- [Дисковые пространства](overview.md)
- [Командлеты хранилища в Windows PowerShell](https://docs.microsoft.com/powershell/module/storage/index?view=win10-ps)
- [Развертывание кластерных дисковых пространств](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11))
- [Часто задаваемые вопросы (FAQ) дисковых пространств](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx)
