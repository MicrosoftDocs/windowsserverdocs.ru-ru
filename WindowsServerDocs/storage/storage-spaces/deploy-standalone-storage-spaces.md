---
title: Развертывание дисковых пространств на автономном сервере
description: Описывает развертывание дисковых пространств на изолированном сервере под управлением Windows Server 2012.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-spaces
ms.date: 07/09/2018
ms.localizationpriority: medium
ms.openlocfilehash: 52e6a4d53271a73bc0913e2ac500c4328f2e7009
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71393728"
---
# <a name="deploy-storage-spaces-on-a-stand-alone-server"></a>Развертывание дисковых пространств на автономном сервере

>Относится к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описывается развертывание дисковых пространств на изолированном сервере. Сведения о создании кластерного дискового пространства см. в статье [развертывание кластера дисковых пространств в Windows Server 2012 R2](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>).

Перед тем как создать дисковое пространство, сначала нужно создать один или несколько пулов носителей. Пул носителей — это набор физических дисков. Пулы обеспечивают агрегирование хранилища, гибкое наращивание емкости и делегирование административных функций.

Из пула носителей можно создавать один или несколько виртуальных дисков. Такие виртуальные диски также называются *дисковыми пространствами*. Дисковое пространство в операционной системе Windows представлено как обычный диск, на котором можно создавать форматированные тома. При создании виртуального диска через пользовательский интерфейс файловых служб и служб хранилища можно задать тип устойчивости (простая, зеркальное отображение или контроль четности), тип подготовки (тонкая или фиксированная) и размер. С помощью Windows PowerShell можно задать дополнительные параметры, такие как число столбцов, значение чередования и используемые физические диски в пуле. Дополнительные сведения об этих дополнительных параметрах см. в статьях [New-VirtualDisk](https://docs.microsoft.com/powershell/module/storage/new-virtualdisk?view=win10-ps) и [что такое столбцы, а как дисковые пространства определяют, сколько следует использовать?](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx%23what_are_columns_and_how_does_storage_spaces_decide_how_many_to_use) в разделе часто задаваемые вопросы о дисковых пространствах.

>[!NOTE]
>Для размещения операционной системы Windows нельзя использовать дисковое пространство.

На виртуальном диске можно создать один или несколько томов. При создании тома можно настроить размер, букву диска или папку, файловую систему (файловую систему NTFS или отказоустойчивую файловую систему (ReFS)), размер единицы размещения и необязательную метку тома.

На следующем рисунке показан процесс работы с дисковыми пространствами.

![Рабочий процесс дисковых пространств](media/deploy-standalone-storage-spaces/storage-spaces-workflow.png)

**Рис. 1. Рабочий процесс дисковых пространств @ no__t-0

>[!NOTE]
>В этом разделе приводятся примеры командлетов Windows PowerShell, которые можно использовать для автоматизации некоторых описанных процедур. Дополнительные сведения см. в статье [PowerShell](https://docs.microsoft.com/powershell/scripting/powershell-scripting?view=powershell-6).

## <a name="prerequisites"></a>Предварительные требования

Чтобы использовать дисковые пространства на изолированном сервере под управлением Windows Server 2012, убедитесь, что физические диски, которые вы хотите использовать, соответствуют следующим предварительным требованиям.

> [!IMPORTANT]
> Сведения о развертывании дисковых пространств в отказоустойчивом кластере см. в статье [развертывание кластера дисковых пространств в Windows Server 2012 R2](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt270997(v%3dws.11)>). Развертывание отказоустойчивого кластера имеет другие предварительные требования, такие как поддерживаемые типы дисковых шин, Поддерживаемые типы устойчивости и необходимое минимальное количество дисков.

|Область|Требование|Примечания|
|---|---|---|
|Типы дисковых шин|— Последовательный подключенный SCSI (SAS)<br>— Последовательное приложение для работы с последовательными технологиями (SATA)<br>— Контроллеры iSCSI и Fibre Channel. |Также можно использовать USB-диски. Однако неоптимально использовать USB-накопители в серверной среде.<br>Дисковые пространства поддерживаются на контроллерах iSCSI и Fibre Channel (FC) при условии, что виртуальные диски, созданные на их основе, являются неустойчивыми (просто с любым числом столбцов).<br>|
|Конфигурация дисков|— Физические диски должны иметь объем не менее 4 ГБ.<br>— Диски должны быть пустыми и не отформатированы. Не создавайте тома.||
|Замечания по поводу адаптера шины|— Рекомендуются простые адаптеры шины (HBA), не поддерживающие функциональность RAID.<br>— Если поддержка RAID, HBA должна находиться в режиме, отличном от RAID, при этом все функции RAID отключены.<br>-Адаптеры не должны быть абстрактными для физических дисков, кэширования данных или скрытия всех подключенных устройств. Это относится и к службам, предоставляемым подключенными устройствами JBOD. |Дисковые пространства совместимы только с адаптерами шины, в которых можно полностью отключить все функции RAID.|
|Массивы JBOD|— Корпусы JBOD являются необязательными.<br>— Рекомендуется использовать вложенные дисковые пространства, перечисленные в каталоге Windows Server.<br>Если вы используете корпус JBOD, уточните у поставщика хранилища, что корпус поддерживает дисковые пространства, чтобы обеспечить полную функциональность.<br>— Чтобы определить, поддерживает ли корпус JBOD идентификацию корпуса и разъема, выполните следующий командлет Windows PowerShell:<br><br>`Get-PhysicalDisk \| ? {$_.BusType –eq "SAS"} \| fc`<br><br>Если поля **енклосуренумбер** и **слотнумбер** содержат значения, то корпус поддерживает эти функции.||

Для планирования числа физических дисков и нужного типа устойчивости для автономной серверной среды используйте следующие рекомендации.

|Тип устойчивости|Требования к диску|Время использования|
|---|---|---|
|**Простая**<br><br>— Перераспределяет данные между физическими дисками;<br>— Увеличивает емкость диска и повышает пропускную способность<br>— Без устойчивости (не защищается от сбоев диска);<br><br><br><br><br><br><br>|Требуется по крайней мере один физический диск.|Не используйте его для размещения невосстановимых данных. Простые пробелы не защищаются от сбоев диска.<br><br>Используйте для размещения временных или легко восстановимых данных за небольшую стоимость.<br><br>Подходит для высокопроизводительных рабочих нагрузок, в которых устойчивость не требуется или уже предоставлена приложением.|
|**Зеркальное отображение**<br><br>— Хранит две или три копии данных в наборе физических дисков;<br>— Повышает надежность, но сокращает емкость. При каждой записи возникает дублирование. В зеркальном дисковом пространстве данные также распределяются по нескольким физическим дискам.<br>— Повышенная пропускная способность данных и более низкая задержка доступа, чем четность<br>— Использует "грязное" Отслеживание региона (DRT) для отслеживания изменений дисков в пуле. Когда система возобновляет работу после незапланированного выключения, и восстанавливается доступ к пространствам, DRT осуществляет согласование дисков в пуле друг с другом.|Требует по крайней мере два физических диска для защиты от одного отказа диска.<br><br>Требует по крайней мере пять физических дисков для защиты от двух одновременных отказов дисков.|Рекомендуется использовать в большинстве сред. Например, зеркальные пространства подходят для файлового ресурса общего назначения или библиотеки виртуальных жестких дисков.|
|**Суммы**<br><br>— Данные и сведения о четности на физических дисках<br>— Повышает надежность при сравнении с простым пространством, но несколько снижает емкость<br>— Повышение устойчивости посредством ведения журнала. Это помогает предотвратить повреждение данных при возникновении незапланированных выключений.|Требует по крайней мере три физических диска для защиты от одного отказа диска.|Рекомендуется использовать для строго последовательных рабочих нагрузок, таких как архивация или резервное копирование.|

## <a name="step-1-create-a-storage-pool"></a>Шаг 1. Создание пула носителей

Сначала необходимо сгруппировать доступные физические диски в один или несколько пулов носителей.

1. В области навигации диспетчер сервера выберите **файл и службы хранилища**.

2. В области навигации выберите страницу **Пулы носителей** .
    
    По умолчанию доступные диски включаются в пул под названием *primordial*. Если в разделе **ПУЛЫ НОСИТЕЛЕЙ** нет пула primordial, это значит, что хранилище не соответствует требованиям к дисковым пространствам. Убедитесь, что диски соответствуют требованиям, перечисленным в разделе "Предварительные условия".
    
    >[!TIP]
    >Если выбрать пул носителей **Primordial**, доступные физические диски будут представлены в разделе **ФИЗИЧЕСКИЕ ДИСКИ**.

3. В разделе **Пулы носителей**выберите список **задачи** , а затем выберите **новый пул носителей**. Откроется мастер создания пула носителей.

4. На странице **перед началом** выполнения нажмите кнопку **Далее**.

5. На странице **Укажите имя и подсистему пула носителей** введите имя и необязательное описание пула носителей, выберите группу доступных физических дисков, которую вы хотите использовать, а затем нажмите кнопку **Далее**.

6. На странице **Выбор физических дисков для пула носителей** выполните следующие действия, а затем нажмите кнопку **Далее**.
    
    1. Установите флажок рядом с каждым физическим диском, который нужно включить в пул носителей.
    
    2. Если вы хотите назначить один или несколько дисков в качестве горячего резервирования, в разделе **выделение**щелкните стрелку раскрывающегося списка и выберите **горячий запас**.

7. На странице **Подтверждение выбора** Проверьте правильность параметров и нажмите кнопку **создать**.

8. На странице **Просмотр результатов** убедитесь, что все задачи завершены, а затем нажмите кнопку **Закрыть**.
    
    >[!NOTE]
    >Либо, чтобы перейти непосредственно к следующему шагу, можно установить флажок **Создать виртуальный диск при закрытии мастера**.

9. Убедитесь, что новый пул носителей представлен в списке **ПУЛЫ НОСИТЕЛЕЙ**.

### <a name="windows-powershell-equivalent-commands-for-creating-storage-pools"></a>Эквивалентные команды Windows PowerShell для создания пулов носителей

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

В следующем примере показано, какие физические диски доступны в пуле primordial.

```PowerShell
Get-StoragePool -IsPrimordial $true | Get-PhysicalDisk | Where-Object CanPool -eq $True
```

В следующем примере создается новый пул носителей с именем *StoragePool1* , который использует все доступные диски.

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk –CanPool $True)
```

В следующем примере создается новый пул носителей *StoragePool1*, который использует четыре доступных диска.

```PowerShell
New-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName “Storage Spaces*” –PhysicalDisks (Get-PhysicalDisk PhysicalDisk1, PhysicalDisk2, PhysicalDisk3, PhysicalDisk4)
```

Следующая серия командлетов демонстрирует, как добавить доступный физический диск *PhysicalDisk5* в горячий резерв для пула носителей *StoragePool1*.

```PowerShell
$PDToAdd = Get-PhysicalDisk –FriendlyName PhysicalDisk5
Add-PhysicalDisk –StoragePoolFriendlyName StoragePool1 –PhysicalDisks $PDToAdd –Usage HotSpare
```

## <a name="step-2-create-a-virtual-disk"></a>Шаг 2. Создание виртуального диска

Затем необходимо создать один или несколько виртуальных дисков из пула носителей. При создании виртуального диска можно выбрать способ размещения данных на физических дисках. Это влияет как на надежность, так и на производительность. Также можно выбрать, создавать ли диски с тонкой или фиксированной подготовкой.

1. Если мастер создания виртуального диска еще не открыт, на странице **Пулы носителей** в диспетчере серверов в разделе **ПУЛЫ НОСИТЕЛЕЙ** выберите нужный пул носителей.

2. В разделе **Виртуальные диски**выберите список **задачи** , а затем выберите **новый виртуальный диск**. Откроется мастер создания виртуальных дисков.

3. На странице **перед началом** выполнения нажмите кнопку **Далее**.

4. На странице **Выбор пула носителей** выберите нужный пул носителей и нажмите кнопку **Далее**.

5. На странице **Указание имени виртуального диска** введите имя и описание (необязательно), а затем нажмите кнопку **Далее**.

6. На странице **Выбор макета хранилища** выберите нужный макет, а затем нажмите кнопку **Далее**.
    
    >[!NOTE]
    >При выборе макета, в котором недостаточно физических дисков, при нажатии на кнопку **Далее**появится сообщение об ошибке. Сведения о том, какой макет следует использовать, а также требования к диску, см. в разделе [необходимые условия](#prerequisites).

7. Если в качестве структуры хранилища выбрано **зеркало** , а в пуле имеется пять или более дисков, появится страница **Настройка параметров устойчивости** . Выберите один из следующих вариантов:
    
      - **Двухстороннее зеркало**
      - **Трехстороннее зеркало**

8. На странице **Укажите тип подготовки** выберите один из следующих параметров, а затем нажмите кнопку **Далее**.
    
   - **Тонкая**
        
     При тонкой подготовке пространство выделяется по необходимости. Это оптимизирует использование доступного хранилища. Однако поскольку такой вариант делает возможным чрезмерное выделение пространства хранения, необходимо внимательно следить за доступным дисковым пространством.
    
   - **Фиксированная**
        
     При фиксированной подготовке емкость хранилища выделяется немедленно в момент создания виртуального диска. Таким образом, при фиксированной подготовке используется пространство из пула носителей, эквивалентное размеру виртуального диска.
    
     >[!TIP]
     >Для дисковых пространств можно создавать виртуальные диски с тонкой и фиксированной подготовкой в одном пуле носителей. Например, можно использовать виртуальный диск с тонкой подготовкой для размещения базы данных, а виртуальный диск с фиксированной подготовкой для размещения связанных файлов журнала.

9. На странице **Указание размера виртуального диска** выполните следующие действия.
    
    Если на предыдущем шаге выбрана тонкая подготовка, в поле **размер виртуального диска** введите размер виртуального диска, выберите единицы измерения (**МБ**, **ГБ**или **ТБ**), а затем нажмите кнопку **Далее**.
    
    Если на предыдущем шаге вы выбрали фиксированную подготовку, выберите один из следующих элементов:
    
      - **Задать размер**
        
        Чтобы указать размер, введите значение в поле **размер виртуального диска** , а затем выберите единицы измерения (**МБ**, **ГБ**или **ТБ**).
        
        Если используется структура хранилища, отличная от простой, виртуальный диск использует больше свободного пространства, чем будет указано. Во избежание возможной ошибки, когда размер тома превышает свободное пространство пула носителей, можно установить флажок **Создать максимально большой виртуальный диск вплоть до указанного размера**.
    
      - **Максимальный размер**
        
        Выберите этот вариант, чтобы создать виртуальный диск, который использует максимальную емкость пула носителей.

10. На странице **Подтверждение выбора** Проверьте правильность параметров и нажмите кнопку **создать**.

11. На странице **Просмотр результатов** убедитесь, что все задачи завершены, а затем нажмите кнопку **Закрыть**.
    
    >[!TIP]
    >По умолчанию флажок **Создать том при закрытии мастера** установлен. После этого вы перейдете сразу же к следующему шагу.

### <a name="windows-powershell-equivalent-commands-for-creating-virtual-disks"></a>Эквивалентные команды Windows PowerShell для создания виртуальных дисков

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

В следующем примере создается виртуальный диск 50 ГБ с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*.

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB)
```

В следующем примере создается зеркальный виртуальный диск с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*. Диск использует максимальный объем хранилища для пула носителей.

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –ResiliencySettingName Mirror –UseMaximumSize
```

В следующем примере создается виртуальный диск 50 ГБ с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*. Для диска используется тонкая подготовка.

```PowerShell
New-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (50GB) –ProvisioningType Thin
```

В следующем примере создается виртуальный диск с именем *VirtualDisk1* в пуле носителей с именем *StoragePool1*. Для диска используется трехстороннее зеркальное отображение, а его размер фиксирован и равен 20 ГБ.

>[!NOTE]
>Для работы этого командлета в пуле носителей должно быть по крайней мере пять физических дисков. (Сюда не относятся диски, выделенные для горячего резерва.)

```PowerShell
New-VirtualDisk -StoragePoolFriendlyName StoragePool1 -FriendlyName VirtualDisk1 -ResiliencySettingName Mirror -NumberOfDataCopies 3 -Size 20GB -ProvisioningType Fixed
```

## <a name="step-3-create-a-volume"></a>Шаг 3. Создание тома

Затем в виртуальном диске нужно создать том. Можно назначить необязательную букву диска или папку, а затем отформатировать том с помощью файловой системы.

1. Если мастер создания тома еще не открыт, на странице **Пулы носителей** в Диспетчер сервера в разделе **Виртуальные диски**щелкните правой кнопкой мыши нужный виртуальный диск и выберите пункт **создать том**.
    
    Откроется мастер создания томов.

2. На странице **перед началом** выполнения нажмите кнопку **Далее**.

3. На странице **Выбор сервера и диска** выполните следующие действия, а затем нажмите кнопку **Далее**.
    
    1. В области **сервер** выберите сервер, на котором нужно создать том.
    
    2. В области **диск** выберите виртуальный диск, на котором нужно создать том.

4. На странице **Укажите размер тома** введите размер тома, укажите единицы (**МБ**, **ГБ**или **ТБ**), а затем нажмите кнопку **Далее**.

5. На странице **назначить букве диска или папке** настройте нужный параметр, а затем нажмите кнопку **Далее**.

6. На странице **Выбор параметров файловой системы** выполните следующие действия, а затем нажмите кнопку **Далее**.
    
    1. В списке **Файловая система** выберите **NTFS** или **ReFS**.
    
    2. В списке **Размер кластера** оставьте значение **По умолчанию** или задайте размер кластера.
        
        >[!NOTE]
        >Дополнительные сведения о размере единицы распределения см. в разделе [Размер кластера по умолчанию для NTFS, FAT и exFAT](https://support.microsoft.com/help/140365/default-cluster-size-for-ntfs-fat-and-exfat).

    
    3. Также можно в поле **Метка тома** ввести метку для тома, например **HR Data**.

7. На странице **Подтверждение выбора** Проверьте правильность параметров и нажмите кнопку **создать**.

8. На странице **Просмотр результатов** убедитесь, что все задачи завершены, а затем нажмите кнопку **Закрыть**.

9. Чтобы убедиться, что том был создан, в диспетчер сервера выберите страницу **тома** . Том будет указан в разделе сервера, где он был создан. Создание тома также можно проверить в проводнике Windows.

### <a name="windows-powershell-equivalent-commands-for-creating-volumes"></a>Эквивалентные команды Windows PowerShell для создания томов

Следующий командлет Windows PowerShell выполняет ту же функцию, что и предыдущая процедура. Введите команду в одну строку.

В следующем примере инициализируются диски для виртуального диска *VirtualDisk1*, создается раздел с назначенной буквой диска, а затем том форматируется с использованием файловой системы NTFS по умолчанию.

```PowerShell
Get-VirtualDisk –FriendlyName VirtualDisk1 | Get-Disk | Initialize-Disk –Passthru | New-Partition –AssignDriveLetter –UseMaximumSize | Format-Volume
```

## <a name="additional-information"></a>Дополнительные сведения

- [Дисковые пространства](overview.md)
- [Командлеты хранилища в Windows PowerShell](https://docs.microsoft.com/powershell/module/storage/index?view=win10-ps)
- [Развертывание кластерных дисковых пространств](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11))
- [Часто задаваемые вопросы о дисковых пространствах](https://social.technet.microsoft.com/wiki/contents/articles/11382.storage-spaces-frequently-asked-questions-faq.aspx)
