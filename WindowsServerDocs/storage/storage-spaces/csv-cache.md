---
title: Локальные дисковые пространства кэш чтения в памяти
ms.prod: windows-server
ms.author: eldenc
manager: siroy
ms.technology: storage-spaces
ms.topic: article
author: eldenchristensen
ms.date: 02/20/2019
ms.localizationpriority: medium
ms.openlocfilehash: d9ebc40b69373dafbebdb87f2abe624a5a7a4375
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80858957"
---
# <a name="using-storage-spaces-direct-with-the-csv-in-memory-read-cache"></a>Использование Локальные дисковые пространства с кэшем чтения в памяти CSV
> Область применения: Windows Server 2016, Windows Server 2019

В этом разделе описывается использование системной памяти для повышения производительности [Локальные дисковые пространства](storage-spaces-direct-overview.md).

Локальные дисковые пространства совместим с кэшем чтения в памяти общий том кластера (CSV). Использование памяти системы для кэширования операций чтения может повысить производительность таких приложений, как Hyper-V, использующих операции ввода-вывода без буферизации для доступа к файлам VHD или VHDX. (Небуферизованные IOs — это любые операции, которые не кэшируются диспетчером кэша Windows.)

Так как кэш в памяти является локальным сервером, он повышает локальность данных для Локальные дисковые пространства развертываний с помощью Hyper-in. последние операции чтения кэшируются в памяти на том же узле, где работает виртуальная машина, уменьшая частоту считывания по сети. Это приводит к снижению задержки и повышению производительности хранилища.

## <a name="planning-considerations"></a>Факторы, которые следует учесть при планировании

Кэш чтения в памяти наиболее эффективен для рабочих нагрузок с интенсивным чтением, таких как инфраструктура виртуальных рабочих столов (VDI). И наоборот, если Рабочая нагрузка очень интенсивно записывается, кэш может ввести больше ресурсов, чем значение, и его следует отключить.

Можно использовать до 80% общего объема физической памяти для кэша чтения в памяти CSV.

  > [!TIP]
  > Для развертываний с поддержкой Hyper-in, где расчеты и хранилище выполняются на одних и тех же серверах, будьте внимательны, чтобы оставить достаточно памяти для виртуальных машин. Для развертываний масштабируемый файловый сервер (SoFS) с меньшей конкуренцией за память это не относится.

  > [!NOTE]
  > Некоторые средства микротестирования, такие как DISKSPD и [парк виртуальных машин](https://github.com/Microsoft/diskspd/tree/master/Frameworks/VMFleet) , могут привести к серьезным результатам с включенным кэшем чтения в памяти CSV, чем без него. По умолчанию при создании виртуальной машины создается 1 10 гиб VHDX на виртуальную машину — приблизительно 1 Тиба для 100 виртуальных машин, а затем выполняет *единообразное случайное* чтение и запись в них. В отличие от реальных рабочих нагрузок, операции чтения не подчиняются ни одному из прогнозируемых или повторяющихся шаблонов, поэтому кэш в памяти не действует и требует просто нагрузки.

## <a name="configuring-the-in-memory-read-cache"></a>Настройка кэша чтения в памяти

Кэш чтения в памяти CSV доступен как в Windows Server 2016, так и в Windows Server 2019 с теми же функциональными возможностями. В Windows Server 2016 она отключена по умолчанию. В Windows Server 2019 он включен по умолчанию с выделенным 1 ГБ.

| Версия ОС          | Размер кэша CSV по умолчанию |
|---------------------|------------------------|
| Windows Server 2016 | 0 (отключено)           |
| Windows Server 2019 | 1 гиб                   |

Чтобы узнать, сколько памяти выделено с помощью PowerShell, выполните:

```PowerShell
(Get-Cluster).BlockCacheSize
```

Возвращаемое значение находится в мебибитес (MiB) на сервер. Например, `1024` представляет 1 гибибайт (гиб).

Чтобы изменить объем выделяемой памяти, измените это значение с помощью PowerShell. Например, чтобы выделить 2 гиб для каждого сервера, выполните:

```PowerShell
(Get-Cluster).BlockCacheSize = 2048
```

Чтобы изменения вступили в силу немедленно, приостановите и возобновите тома CSV или переместите их между серверами. Например, этот фрагмент PowerShell используется для перемещения каждого CSV-файла на другой узел сервера и обратно:

```PowerShell
Get-ClusterSharedVolume | ForEach {
    $Owner = $_.OwnerNode
    $_ | Move-ClusterSharedVolume
    $_ | Move-ClusterSharedVolume -Node $Owner
}
```

## <a name="see-also"></a>См. также:

- [Обзор Локальные дисковые пространства](storage-spaces-direct-overview.md)
