---
title: Обновить кластер дисковых пространств в Windows Server 2019
description: Как обновить кластер дисковых пространств в Windows Server 2019 — либо сохраняя виртуальных машин под управлением, или при их остановке.
author: robhindman
ms.author: robhind
manager: eldenc
ms.date: 03/06/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage-spaces
ms.openlocfilehash: 54be649cc1753fe07c94105a31a0b738fb030ee0
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67284366"
---
# <a name="upgrade-a-storage-spaces-direct-cluster-to-windows-server-2019"></a>Обновить кластер дисковых пространств в Windows Server 2019

В этом разделе описывается обновление дисковых кластера до Windows Server 2019. Существует четыре подхода к обновлению кластера дисковых из Windows Server 2016 на Windows Server 2019 г., с помощью [кластерной ОС, процесс последовательного обновления](../../failover-clustering/Cluster-Operating-System-Rolling-Upgrade.md) — две подразумевают сохранение виртуальных машин, запущенных, а два, включающих Остановка всех виртуальных машин. Каждый подход имеет свои сильные стороны и слабые стороны, поэтому выберите том, что один, который наилучшим образом соответствует потребностям вашей организации:

- **Обновление на месте пока виртуальные машины запущены** на каждом сервере в кластере — этот параметр приводит к простою виртуальных Машин, но вам потребуется дождаться завершения после обновления каждого сервера заданий хранилища (зеркальный восстановления).

- **Установка чистой операционной системы во время запуска виртуальных машин** на каждом сервере в кластере — этот параметр приводит к простою виртуальных Машин, но вам потребуется дождаться завершения заданий хранилища (зеркальный восстановить) для выполнения после обновления каждого сервера, и вам придется установить каждый сервер и все приложения и роли еще раз.

- **Обновление на месте при остановке виртуальных машин** на каждом сервере в кластере — этого параметра влечет за собой простои виртуального компьютера, но не требуется ожидание хранилища заданий (зеркальный восстановления), так что это быстрее.

- **Очистить ОС установить во время остановки виртуальных машин** на каждом сервере в кластере — этого параметра влечет за собой простои виртуального компьютера, но не нужно ждать для хранилища заданиях (зеркальный восстановления), чтобы быстрее.

## <a name="prerequisites-and-limitations"></a>Предварительные условия и ограничения

Прежде чем продолжать обновление:

- Проверьте, что у вас есть резервные копии можно использовать в случае возникновения проблем во время обновления.

- Проверьте у поставщика оборудования BIOS, встроенного по и драйверы для серверов, которые они будут поддерживать на Windows Server 2019.

Существует ряд ограничений на процесс обновления, которые следует учитывать:

- Чтобы включить Storage Spaces Direct со сборками Windows Server 2019 более ранних, чем 176693.292, клиентам может потребоваться для раздела реестра для включения функциональных возможностей дисковых пространств и программно-Конфигурируемую сеть в службу поддержки Майкрософт. Дополнительные сведения см. в статье базы знаний Майкрософт [статьи 4464776](https://support.microsoft.com/help/4464776/software-defined-data-center-and-software-defined-networking).

- При обновлении кластера для томов ReFS, существует несколько ограничений:

- Обновление полностью поддерживается на томах ReFS, однако обновленные тома не выигрывают от ReFS усовершенствования в Windows Server 2019. Эти преимущества, такие как повысить производительность при ускорением зеркальной четности, требуют только что созданный том Windows Server 2019 ReFS. Другими словами, необходимо создать новые тома с помощью `New-Volume` командлета или диспетчера серверов. Ниже приведены некоторые усовершенствования ReFS, получить новые тома.

    - **Журнал обхода КАРТЫ**: повышение производительности в ReFS, применяется только к кластеризованных системах (дисковых) и не применяется к пулам изолированного хранилища.

    - **Сжатие** повышение эффективности в Windows Server 2019, характерные для нескольких устойчивых тома.

- Перед обновлением сервера кластера Windows Server 2016 Storage Spaces Direct, рекомендуется поместить сервер в режим обслуживания хранилища. Дополнительные сведения см. в разделе событий 5120 [Устранение неполадок с дисковыми пространствами](troubleshooting-storage-spaces.md). Несмотря на то, что эта проблема была устранена в Windows Server 2016, рекомендуется поместить каждый сервер дисковыми пространствами в режима обслуживания хранилища во время обновления рекомендуется.

- Имеется известная проблема с программно-Конфигурируемую сеть средах, использующих НАБОР переключателей. Это включает в себя динамической миграции виртуальной Машины Hyper-V из Windows Server 2019 до Windows Server 2016 (Динамическая миграция в более ранних операционных систем). Чтобы обеспечить успешное динамической миграции, рекомендуется изменить параметр сети виртуальных Машин на виртуальных машинах, которые live перенесены из Windows Server 2019 в Windows Server 2016. Эта проблема исправлена для Windows Server 2019 в накопительный пакет исправлений 2019-01D, также Называемые сборки 17763.292. Дополнительные сведения см. в статье базы знаний Майкрософт [статьи 4476976](https://support.microsoft.com/help/4476976/windows-10-update-kb4476976).

Из-за известных проблем, выше некоторые клиенты можно рассмотреть возможность создания нового кластера Windows Server 2019 и копирование данных из старого кластера, вместо обновления свои кластеры Windows Server 2016, с помощью одного из четырех процессов, описанных ниже.

## <a name="performing-an-in-place-upgrade-while-vms-are-running"></a>Выполнение обновления на месте, пока виртуальные машины запущены

Этот параметр приводит к простою виртуальных Машин, но вам потребуется дождаться завершения после обновления каждого сервера заданий хранилища (зеркальный восстановления). Несмотря на то, что в процессе обновления будет перезапущен отдельных серверов последовательно, оставшиеся серверы в кластере, а также все виртуальные машины, будет работать.

1. Проверьте, что все серверы в кластере установить последние обновления Windows. Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2016](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history). Как минимум, следует установить Microsoft Knowledge Base [статьи 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) (19 февраля 2019 г.). Номер сборки (см. в разделе `ver` команда) должна быть 14393.2828 или выше.

2. Если вы используете программно-Конфигурируемую сеть с параметрами SET, откройте сеанс PowerShell с повышенными привилегиями и выполните следующую команду, чтобы отключить проверки динамической миграции виртуальной Машины на всех виртуальных машинах в кластере:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" |
   Set-ClusterParameter -Create SkipMigrationDestinationCheck -Value 1
   ```

3. Выполните следующие действия на одном сервере кластера за раз.

   1. Использование динамической миграции виртуальной Машины Hyper-V перемещение работающих виртуальных машин с сервера, который вы хотите обновить.

   2. Приостановка работы сервера кластера, выполните следующую команду PowerShell, обратите внимание на то, что некоторые внутренние группы скрыты. Мы рекомендуем этот шаг, чтобы соблюдать осторожность, если вы уже не живете перенос виртуальных машин с сервера, этот командлет будет делать, поэтому можно пропустить это при желании.

        ```PowerShell
       Suspend-ClusterNode -Drain
       ```

   3. Поместите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Enable-StorageMaintenanceMode
       ```

   4. Выполните следующий командлет, чтобы убедиться, что **OperationalStatus** значение **в режиме обслуживания**:

       ```PowerShell
       Get-PhysicalDisk
       ```

   5. Выполнить Windows Server 2019 для установки обновления на сервере, запустив **setup.exe** и с использованием параметра «Сохранить личные файлы и приложения». По завершении установки сервер останется в кластере и кластере запуске службы автоматически.

   6. Проверьте, что только что обновленный сервер имеет последние обновления Windows Server 2019. Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2019](https://support.microsoft.com/help/4464619/windows-10-update-history). Номер сборки (см. в разделе `ver` команда) должна быть 17763.292 или выше.

   7. Удаление сервера из режима обслуживания хранилища с помощью следующей команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   8. Возобновить работу сервера с помощью следующей команды PowerShell:

       ```PowerShell
       Resume-ClusterNode
       ```

   9. Дождитесь завершение заданий восстановления хранилища и для всех дисков, чтобы вернуться в работоспособное состояние. Это может занять значительное время, в зависимости от количества виртуальных машин во время обновления сервера. Ниже приведены команды для выполнения.

       ```PowerShell
       Get-StorageJob
       Get-VirtualDisk
       ```

4. Обновите следующий сервер в кластере.

5. После обновления всех серверов Windows Server 2019 используйте следующий командлет PowerShell для обновления режима работы кластера.

   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   > Рекомендуется обновить функциональный уровень кластера как можно скорее, хотя технически у вас есть до четырех недель для этого.

6. После обновления режима работы кластера, используйте следующий командлет, чтобы обновить пуле носителей. На этом этапе, новые командлеты, такие как `Get-ClusterPerf` будет полностью работать на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. При необходимости обновления уровней конфигурации виртуальной Машины, останавливая работу каждой виртуальной Машины с помощью `Update-VMVersion` командлета и затем снова запустить виртуальные машины.

8. Если вы используете программно-Конфигурируемую сеть с параметрами SET, и отключенные проверки динамической миграции виртуальной Машины так, как указано в инструкциях выше, используйте следующий командлет для повторного включения виртуальной Машины Live проверки:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" |
   Set-ClusterParameter  SkipMigrationDestinationCheck -Value 0
   ```

9. Убедитесь, что обновленные кластера работает ожидаемым образом. Роли следует отработки отказа правильно и при использовании динамической миграции виртуальной Машины в кластере виртуальных машин должен успешно динамическую миграцию.

10. Проверить кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.

## <a name="performing-a-clean-os-installation-while-vms-are-running"></a>Выполнение чистой установки операционной системы во время запуска виртуальных машин

Этот параметр приводит к простою виртуальных Машин, но вам потребуется дождаться завершения после обновления каждого сервера заданий хранилища (зеркальный восстановления). Несмотря на то, что в процессе обновления будет перезапущен отдельных серверов последовательно, оставшиеся серверы в кластере, а также все виртуальные машины, будет работать.

1. Проверьте, что все серверы в кластере работают последние обновления. Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2016](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history). Как минимум, следует установить Microsoft Knowledge Base [статьи 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) (19 февраля 2019 г.). Номер сборки (см. в разделе `ver` команда) должна быть 14393.2828 или выше.

2. Если вы используете программно-Конфигурируемую сеть с параметрами SET, откройте сеанс PowerShell с повышенными привилегиями и выполните следующую команду, чтобы отключить проверки динамической миграции виртуальной Машины на всех виртуальных машинах в кластере:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" |
   Set-ClusterParameter -Create SkipMigrationDestinationCheck -Value 1
   ```

3. Выполните следующие действия на одном сервере кластера за раз.

   1. Использование динамической миграции виртуальной Машины Hyper-V перемещение работающих виртуальных машин с сервера, который вы хотите обновить.

   2. Приостановка работы сервера кластера, выполните следующую команду PowerShell, обратите внимание на то, что некоторые внутренние группы скрыты. Мы рекомендуем этот шаг, чтобы соблюдать осторожность, если вы уже не живете перенос виртуальных машин с сервера, этот командлет будет делать, поэтому можно пропустить это при желании.

        ```PowerShell
       Suspend-ClusterNode -Drain
       ```

   3. Поместите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Enable-StorageMaintenanceMode
       ```

   4. Выполните следующий командлет, чтобы убедиться, что **OperationalStatus** значение **в режиме обслуживания**:

       ```PowerShell
       Get-PhysicalDisk
       ```

   3.  Исключите сервер из кластера, выполнив следующую команду PowerShell:  

       ```PowerShell
       Remove-ClusterNode <ServerName>
       ```

   4. Выполните чистую установку Windows Server 2019 на сервере: формат системный диск, запустите **setup.exe** и использовать «Пустое» параметр. Необходимо будет настроить удостоверение сервера, роли, компоненты и приложений после завершения установки и перезагрузки сервера.

   5. Установка роли Hyper-V и компонент отказоустойчивой кластеризации на сервере (можно использовать `Install-WindowsFeature` командлет).

   6. Установите последние хранилища и сетевые драйверы для оборудования, утвержденные производителем сервера для использования с дисковыми пространствами.

   7. Проверьте, что только что обновленный сервер имеет последние обновления Windows Server 2019. Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2019](https://support.microsoft.com/help/4464619/windows-10-update-history). Номер сборки (см. в разделе `ver` команда) должна быть 17763.292 или выше.

   8. Повторно присоедините сервер к кластеру с помощью следующей команды PowerShell:

       ```PowerShell
       Add-ClusterNode
       ```

   9. Удаление сервера из режима обслуживания хранилища с помощью следующих команд PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   10. Дождитесь завершение заданий восстановления хранилища и для всех дисков, чтобы вернуться в работоспособное состояние. Это может занять значительное время, в зависимости от количества виртуальных машин во время обновления сервера. Ниже приведены команды для выполнения.

        ```PowerShell
        Get-StorageJob
        Get-VirtualDisk
        ```

4. Обновите следующий сервер в кластере.

5. После обновления всех серверов Windows Server 2019 используйте следующий командлет PowerShell для обновления режима работы кластера.
    
   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   > Рекомендуется обновить функциональный уровень кластера как можно скорее, хотя технически у вас есть до четырех недель для этого.

6. После обновления режима работы кластера, используйте следующий командлет, чтобы обновить пуле носителей. На этом этапе, новые командлеты, такие как `Get-ClusterPerf` будет полностью работать на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. При необходимости обновления уровней конфигурации виртуальной Машины, остановив каждой виртуальной Машине и с помощью `Update-VMVersion` командлета, а затем снова запустить виртуальные машины.

8. Если вы используете программно-Конфигурируемую сеть с параметрами SET, и отключенные проверки динамической миграции виртуальной Машины так, как указано в инструкциях выше, используйте следующий командлет для повторного включения виртуальной Машины Live проверки:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" | 
   Set-ClusterParameter SkipMigrationDestinationCheck -Value 0
   ```

9. Убедитесь, что обновленные кластера работает ожидаемым образом. Роли следует отработки отказа правильно и при использовании динамической миграции виртуальной Машины в кластере виртуальных машин должен успешно динамическую миграцию.

10. Проверить кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.

## <a name="performing-an-in-place-upgrade-while-vms-are-stopped"></a>Выполнение обновления на месте при остановке виртуальных машин

Этот параметр влечет за собой простои виртуального компьютера, но может занять меньше времени, чем Если оставлено виртуальных машин, запущенных во время обновления, избавляя от необходимости ожидания для заданий хранилища (зеркальный восстановить) для завершения после обновления каждого сервера. Несмотря на то, что в процессе обновления будет перезапущен отдельных серверов последовательно, оставшиеся серверы в кластере продолжать работу.

1. Проверьте, что все серверы в кластере работают последние обновления. Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2016](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history). Как минимум, следует установить Microsoft Knowledge Base [статьи 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) (19 февраля 2019 г.). Номер сборки (см. в разделе `ver` команда) должна быть 14393.2828 или выше.

2. Остановка виртуальных машин, запущенных в кластере.

3. Выполните следующие действия на одном сервере кластера за раз.

   1. Приостановка работы сервера кластера, выполните следующую команду PowerShell, обратите внимание на то, что некоторые внутренние группы скрыты. Мы рекомендуем использовать этот шаг, чтобы соблюдать осторожность.

        ```PowerShell
       Suspend-ClusterNode -Drain
       ```

   2. Поместите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Enable-StorageMaintenanceMode
       ```

   3. Выполните следующий командлет, чтобы убедиться, что **OperationalStatus** значение **в режиме обслуживания**:

       ```PowerShell
       Get-PhysicalDisk
       ```

   4. Выполнить Windows Server 2019 для установки обновления на сервере, запустив **setup.exe** и с использованием параметра «Сохранить личные файлы и приложения».  
   По завершении установки сервер останется в кластере и кластере запуске службы автоматически.

   5.  Проверьте, что только что обновленный сервер имеет последние обновления Windows Server 2019.  
   Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2019](https://support.microsoft.com/help/4464619/windows-10-update-history).
   Номер сборки (см. в разделе `ver` команда) должна быть 17763.292 или выше.

   6.  Удаление сервера из режима обслуживания хранилища с помощью следующих команд PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   7.  Возобновить работу сервера с помощью следующей команды PowerShell:

       ```PowerShell
       Resume-ClusterNode
       ```

   8.  Дождитесь завершение заданий восстановления хранилища и для всех дисков, чтобы вернуться в работоспособное состояние.  
   Это должен быть относительно быстро, так как не запущены виртуальные машины. Ниже приведены команды для выполнения.

       ```PowerShell
       Get-StorageJob
       Get-VirtualDisk
       ```

4. Обновите следующий сервер в кластере.
5. После обновления всех серверов Windows Server 2019 используйте следующий командлет PowerShell для обновления режима работы кластера.
    
   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   >   Рекомендуется обновить функциональный уровень кластера как можно скорее, хотя технически у вас есть до четырех недель для этого.

6. После обновления режима работы кластера, используйте следующий командлет, чтобы обновить пуле носителей.  
   На этом этапе, новые командлеты, такие как `Get-ClusterPerf` будет полностью работать на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. Запустите виртуальные машины в кластере и проверьте, что они работают должным образом.

8. При необходимости обновления уровней конфигурации виртуальной Машины, остановив каждой виртуальной Машине и с помощью `Update-VMVersion` командлета, а затем снова запустить виртуальные машины.

9. Убедитесь, что обновленные кластера работает ожидаемым образом.  
   Роли следует отработки отказа правильно и при использовании динамической миграции виртуальной Машины в кластере виртуальных машин должен успешно динамическую миграцию.

10. Проверить кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.

## <a name="performing-a-clean-os-installation-while-vms-are-stopped"></a>Выполняя чистой установки операционной системы, когда останавливаются виртуальных машин

Этот параметр влечет за собой простои виртуального компьютера, но может занять меньше времени, чем Если оставлено виртуальных машин, запущенных во время обновления, избавляя от необходимости ожидания для заданий хранилища (зеркальный восстановить) для завершения после обновления каждого сервера. Несмотря на то, что в процессе обновления будет перезапущен отдельных серверов последовательно, оставшиеся серверы в кластере продолжать работу.

1. Проверьте, что все серверы в кластере работают последние обновления.  
   Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2016](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history).
   Как минимум, следует установить Microsoft Knowledge Base [статьи 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) (19 февраля 2019 г.). Номер сборки (см. в разделе `ver` команда) должна быть 14393.2828 или выше.

2. Остановка виртуальных машин, запущенных в кластере.

3. Выполните следующие действия на одном сервере кластера за раз.

   2. Приостановка работы сервера кластера, выполните следующую команду PowerShell, обратите внимание на то, что некоторые внутренние группы скрыты.  
      Мы рекомендуем использовать этот шаг, чтобы соблюдать осторожность.

       ```PowerShell
      Suspend-ClusterNode -Drain
      ```

   3. Поместите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

      ```PowerShell
      Get-StorageFaultDomain -type StorageScaleUnit | 
      Where FriendlyName -Eq <ServerName> | 
      Enable-StorageMaintenanceMode
      ```

   4. Выполните следующий командлет, чтобы убедиться, что **OperationalStatus** значение **в режиме обслуживания**:

      ```PowerShell
      Get-PhysicalDisk
      ```

   5. Исключите сервер из кластера, выполнив следующую команду PowerShell:  
    
      ```PowerShell
      Remove-ClusterNode <ServerName>
      ```

   6. Выполните чистую установку Windows Server 2019 на сервере: формат системный диск, запустите **setup.exe** и использовать «Пустое» параметр.  
      Необходимо будет настроить удостоверение сервера, роли, компоненты и приложений после завершения установки и перезагрузки сервера.

   7. Установка роли Hyper-V и компонент отказоустойчивой кластеризации на сервере (можно использовать `Install-WindowsFeature` командлет).

   8. Установите последние хранилища и сетевые драйверы для оборудования, утвержденные производителем сервера для использования с дисковыми пространствами.

   9. Проверьте, что только что обновленный сервер имеет последние обновления Windows Server 2019.  
      Дополнительные сведения см. в разделе [Журнал обновлений Windows 10 и Windows Server 2019](https://support.microsoft.com/help/4464619/windows-10-update-history).
      Номер сборки (см. в разделе `ver` команда) должна быть 17763.292 или выше.

   10. Повторно присоедините сервер к кластеру с помощью следующей команды PowerShell:

      ```PowerShell
      Add-ClusterNode
      ```

   11. Удаление сервера из режима обслуживания хранилища с помощью следующей команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   12. Дождитесь завершение заданий восстановления хранилища и для всех дисков, чтобы вернуться в работоспособное состояние.  
       Это может занять значительное время, в зависимости от количества виртуальных машин во время обновления сервера. Ниже приведены команды для выполнения.

       ```PowerShell
       Get-StorageJob
       Get-VirtualDisk
       ```

4. Обновите следующий сервер в кластере.

5. После обновления всех серверов Windows Server 2019 используйте следующий командлет PowerShell для обновления режима работы кластера.
    
   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   >   Рекомендуется обновить функциональный уровень кластера как можно скорее, хотя технически у вас есть до четырех недель для этого.

6. После обновления режима работы кластера, используйте следующий командлет, чтобы обновить пуле носителей.  
   На этом этапе, новые командлеты, такие как `Get-ClusterPerf` будет полностью работать на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. Запустите виртуальные машины в кластере и проверьте, что они работают должным образом.

8. При необходимости обновления уровней конфигурации виртуальной Машины, остановив каждой виртуальной Машине и с помощью `Update-VMVersion` командлета, а затем снова запустить виртуальные машины.

9. Убедитесь, что обновленные кластера работает ожидаемым образом.  
   Роли следует отработки отказа правильно и при использовании динамической миграции виртуальной Машины в кластере виртуальных машин должен успешно динамическую миграцию.

10. Проверить кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.
