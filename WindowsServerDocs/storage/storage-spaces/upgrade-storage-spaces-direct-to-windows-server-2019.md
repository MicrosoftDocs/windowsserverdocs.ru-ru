---
title: Обновление кластера Локальные дисковые пространства до Windows Server 2019
description: Обновление кластера Локальные дисковые пространства до Windows Server 2019-либо с сохранением работоспособности виртуальных машин, либо при их остановке.
author: robhindman
ms.author: robhind
manager: eldenc
ms.date: 03/06/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage-spaces
ms.openlocfilehash: 9966ee0fd3c0a2d1df0180bf177dec03343efc14
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70867188"
---
# <a name="upgrade-a-storage-spaces-direct-cluster-to-windows-server-2019"></a>Обновление кластера Локальные дисковые пространства до Windows Server 2019

В этом разделе описывается обновление кластера Локальные дисковые пространства до Windows Server 2019. Существует четыре подхода к обновлению кластера Локальные дисковые пространства с Windows Server 2016 до Windows Server 2019 с помощью [процесса последовательного обновления ОС кластера](../../failover-clustering/Cluster-Operating-System-Rolling-Upgrade.md) , который включает в себя поддержание работоспособности виртуальных машин и две из них, включая остановку всех виртуальных машин. Каждый подход имеет разные сильные и слабые стороны, поэтому выбирайте тот, который наилучшим образом соответствует потребностям вашей организации:

- **Обновление на месте, в то время как виртуальные машины выполняются** на каждом сервере в кластере. при использовании этого параметра не происходит ПРОСТОЯ виртуальной машины, но после обновления каждого сервера потребуется подождать, пока не будут выполнены задания хранилища (зеркальное восстановление).

- **Установка чистых ОС при выполнении виртуальных машин** на каждом сервере в кластере. при использовании этого параметра не происходит ПРОСТОЯ виртуальных машин, но необходимо подождать, пока задания хранилища (зеркальное восстановление) не будут выполнены после обновления каждого сервера, и потребуется настроить каждый сервер и все его приложения и роли.

- **Обновление на месте, в то время как виртуальные машины остановлены** на каждом сервере в кластере. в этом случае время ПРОСТОЯ виртуальной машины снижается, но нет необходимости ждать задания хранилища (зеркальное восстановление), поэтому оно выполняется быстрее.

- **Установка чистых ОС при остановке виртуальных машин** на каждом сервере в кластере — в этом случае время ПРОСТОЯ виртуальной машины снижается, но вам не нужно ждать задания хранилища (зеркальное восстановление), чтобы оно было быстрее.

## <a name="prerequisites-and-limitations"></a>Предварительные условия и ограничения

Прежде чем продолжить обновление:

- Убедитесь, что у вас есть пригодные для использования резервные копии, если во время обновления возникнут какие либо проблемы.

- Убедитесь, что у поставщика оборудования есть BIOS, встроенное по и драйверы для серверов, которые они будут поддерживать в Windows Server 2019.

Существует ряд ограничений, которые необходимо учитывать при обновлении процесса обновления.

- Чтобы включить Локальные дисковые пространства с сборками Windows Server 2019, предшествующими 176693,292, клиентам может потребоваться обратиться в службу поддержки Майкрософт для получения разделов реестра, которые позволяют Локальные дисковые пространства и программно определяемые сетевые функции. Дополнительные сведения см. в [статье 4464776](https://support.microsoft.com/help/4464776/software-defined-data-center-and-software-defined-networking)базы знаний Майкрософт.

- При обновлении кластера с томами ReFS существует ряд ограничений.

- Обновление полностью поддерживается на томах ReFS, однако обновленные тома не будут использовать улучшенные возможности ReFS в Windows Server 2019. Эти преимущества, такие как повышение производительности при четности с зеркальным отображением, потребовали только что созданного тома ReFS Windows Server 2019. Иными словами, вам пришлось бы создавать новые тома с помощью `New-Volume` командлета или диспетчер сервера. Ниже приведены некоторые усовершенствования ReFS, которые могут получить следующие новые тома:

    - **Преобразование журнала карт**: улучшение производительности в ReFS, применимое только к кластеризованным (Локальные дисковые пространства) системам и не применимо к изолированным пулам носителей.

    - Улучшения эффективности **сжатия** в Windows Server 2019, связанные с несколькими отказоустойчивыми томами.

- Перед обновлением сервера кластера Windows Server 2016 Локальные дисковые пространства рекомендуется перевести сервер в режим обслуживания хранилища. Дополнительные сведения см. в разделе о событии 5120 статьи [Устранение неполадок Локальные дисковые пространства](troubleshooting-storage-spaces.md). Хотя эта проблема исправлена в Windows Server 2016, рекомендуется перевести каждый сервер Локальные дисковые пространства в режим обслуживания хранилища во время обновления, как рекомендуется.

- Существует известная ситуация с программно-определяемыми сетевыми средами, использующими параметры SET. Эта проблема связана с динамической миграцией виртуальных машин Hyper-V с Windows Server 2019 на Windows Server 2016 (динамическая миграция в более раннюю операционную систему). Чтобы обеспечить успешную динамическую миграцию, мы рекомендуем изменить параметр сети виртуальной машины на виртуальных машинах, которые динамически переносятся с Windows Server 2019 на Windows Server 2016. Эта проблема исправлена для Windows Server 2019 в накопительном пакете исправлений 2019-01D, а также для сборки 17763,292. Дополнительные сведения см. в [статье 4476976](https://support.microsoft.com/help/4476976/windows-10-update-kb4476976)базы знаний Майкрософт.

Из-за известных проблем некоторые клиенты могут подумать о создании нового кластера Windows Server 2019 и копировании данных из старого кластера вместо обновления своих кластеров Windows Server 2016 с помощью одного из четырех описанных ниже процессов.

## <a name="performing-an-in-place-upgrade-while-vms-are-running"></a>Выполнение обновления на месте во время работы виртуальных машин

При выборе этого варианта не происходит простоя виртуальной машины, но после обновления каждого сервера потребуется подождать, пока не будут выполнены задания хранилища (зеркальное восстановление). Хотя отдельные серверы будут перезапущены последовательно во время процесса обновления, остальные серверы в кластере, а также все виртуальные машины будут работать.

1. Убедитесь, что на всех серверах в кластере установлены последние обновления Windows. Дополнительные сведения см. в [статье Windows 10 и Windows Server 2016 Обновление журнала](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history). Установите как минимум [статью 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) базы знаний Майкрософт (Фев 19, 2019). Номер сборки (см `ver` . команду) должен быть 14393,2828 или выше.

2. Если вы используете программно определенную сеть с параметрами SET, откройте сеанс PowerShell с повышенными привилегиями и выполните следующую команду, чтобы отключить проверки динамической миграции виртуальной машины на всех виртуальных машинах в кластере:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" |
   Set-ClusterParameter -Create SkipMigrationDestinationCheck -Value 1
   ```

3. Выполните следующие действия на одном сервере кластера за раз:

   1. Используйте динамическую миграцию виртуальной машины Hyper-V, чтобы переместить запущенные виртуальные машины с сервера, который вы собираетесь обновить.

   2. Приостановите работу сервера кластера с помощью следующей команды PowerShell — Обратите внимание, что некоторые внутренние группы скрыты. Этот шаг следует проявлять с осторожностью. Если вы еще не перепустили миграцию виртуальных машин с сервера, этот командлет сделает это самостоятельно, поэтому вы можете пропустить предыдущий шаг при желании.

        ```PowerShell
       Suspend-ClusterNode -Drain
       ```

   3. Переведите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Enable-StorageMaintenanceMode
       ```

   4. Выполните следующий командлет, чтобы убедиться, что значение **OperationalStatus** находится **в режиме обслуживания**:

       ```PowerShell
       Get-PhysicalDisk
       ```

   5. Выполните обновление установки Windows Server 2019 на сервере, запустив **программу Setup. exe** и выбрав параметр "не использовать личные файлы и приложения". После завершения установки сервер остается в кластере, а служба кластеров запускается автоматически.

   6. Убедитесь, что на недавно обновленном сервере установлены последние обновления для Windows Server 2019. Дополнительные сведения см. в [статье Windows 10 и Windows Server 2019 Обновление журнала](https://support.microsoft.com/help/4464619/windows-10-update-history). Номер сборки (см `ver` . команду) должен быть 17763,292 или выше.

   7. Удалите сервер из режима обслуживания хранилища с помощью следующей команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   8. Возобновите работу сервера с помощью следующей команды PowerShell:

       ```PowerShell
       Resume-ClusterNode
       ```

   9. Дождитесь завершения заданий восстановления хранилища и, чтобы все диски возвращались в работоспособное состояние. Это может занять значительное время в зависимости от количества виртуальных машин, выполняемых во время обновления сервера. Ниже приведены команды для выполнения.

       ```PowerShell
       Get-StorageJob
       Get-VirtualDisk
       ```

4. Обновите следующий сервер в кластере.

5. После обновления всех серверов до Windows Server 2019 используйте следующий командлет PowerShell для обновления функционального уровня кластера.

   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   > Рекомендуется как можно скорее обновить функциональный уровень кластера, но технически для этого у вас может быть до четырех недель.

6. После обновления функционального уровня кластера используйте следующий командлет для обновления пула носителей. На этом этапе новые командлеты, такие `Get-ClusterPerf` как, будут полностью работоспособны на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. При необходимости можно обновить уровни конфигурации виртуальных машин, остановите каждую виртуальную машину с помощью `Update-VMVersion` командлета, а затем снова запустите виртуальные машины.

8. Если вы используете программно определенную сеть с параметрами SET и отключенные проверки динамической миграции виртуальной машины, как описано выше, используйте следующий командлет для повторного включения проверки динамической проверки виртуальной машины:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" |
   Set-ClusterParameter  SkipMigrationDestinationCheck -Value 0
   ```

9. Убедитесь, что обновленный кластер работает должным образом. Роли должны быть правильно отработки отказа. Если в кластере используется динамическая миграция виртуальной машины, виртуальные машины должны успешно переноситься в активное перемещение.

10. Проверьте кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.

## <a name="performing-a-clean-os-installation-while-vms-are-running"></a>Выполнение чистой установки ОС во время работы виртуальных машин

При выборе этого варианта не происходит простоя виртуальной машины, но после обновления каждого сервера потребуется подождать, пока не будут выполнены задания хранилища (зеркальное восстановление). Хотя отдельные серверы будут перезапущены последовательно во время процесса обновления, остальные серверы в кластере, а также все виртуальные машины будут работать.

1. Убедитесь, что все серверы в кластере работают с последними обновлениями. Дополнительные сведения см. в [статье Windows 10 и Windows Server 2016 Обновление журнала](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history). Установите как минимум [статью 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) базы знаний Майкрософт (Фев 19, 2019). Номер сборки (см `ver` . команду) должен быть 14393,2828 или выше.

2. Если вы используете программно определенную сеть с параметрами SET, откройте сеанс PowerShell с повышенными привилегиями и выполните следующую команду, чтобы отключить проверки динамической миграции виртуальной машины на всех виртуальных машинах в кластере:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" |
   Set-ClusterParameter -Create SkipMigrationDestinationCheck -Value 1
   ```

3. Выполните следующие действия на одном сервере кластера за раз:

   1. Используйте динамическую миграцию виртуальной машины Hyper-V, чтобы переместить запущенные виртуальные машины с сервера, который вы собираетесь обновить.

   2. Приостановите работу сервера кластера с помощью следующей команды PowerShell — Обратите внимание, что некоторые внутренние группы скрыты. Этот шаг следует проявлять с осторожностью. Если вы еще не перепустили миграцию виртуальных машин с сервера, этот командлет сделает это самостоятельно, поэтому вы можете пропустить предыдущий шаг при желании.

        ```PowerShell
       Suspend-ClusterNode -Drain
       ```

   3. Переведите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Enable-StorageMaintenanceMode
       ```

   4. Выполните следующий командлет, чтобы убедиться, что значение **OperationalStatus** находится **в режиме обслуживания**:

       ```PowerShell
       Get-PhysicalDisk
       ```

   3.  Исключите сервер из кластера, выполнив следующую команду PowerShell:  

       ```PowerShell
       Remove-ClusterNode <ServerName>
       ```

   4. Выполните чистую установку Windows Server 2019 на сервере: отформатируйте системный диск, запустите **файл Setup. exe** и используйте параметр «Nothing». После завершения установки необходимо настроить удостоверение сервера, роли, компоненты и приложения, после чего сервер будет перезагружен.

   5. Установите на сервере роль Hyper-V и функцию кластеризации с отработкой отказа (можно использовать `Install-WindowsFeature` командлет).

   6. Установите последние драйверы хранилища и сети для оборудования, утвержденные производителем сервера, для использования с Локальные дисковые пространства.

   7. Убедитесь, что на недавно обновленном сервере установлены последние обновления для Windows Server 2019. Дополнительные сведения см. в [статье Windows 10 и Windows Server 2019 Обновление журнала](https://support.microsoft.com/help/4464619/windows-10-update-history). Номер сборки (см `ver` . команду) должен быть 17763,292 или выше.

   8. Повторно присоедините сервер к кластеру с помощью следующей команды PowerShell:

       ```PowerShell
       Add-ClusterNode
       ```

   9. Удалите сервер из режима обслуживания хранилища, используя следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   10. Дождитесь завершения заданий восстановления хранилища и, чтобы все диски возвращались в работоспособное состояние. Это может занять значительное время в зависимости от количества виртуальных машин, выполняемых во время обновления сервера. Ниже приведены команды для выполнения.

        ```PowerShell
        Get-StorageJob
        Get-VirtualDisk
        ```

4. Обновите следующий сервер в кластере.

5. После обновления всех серверов до Windows Server 2019 используйте следующий командлет PowerShell для обновления функционального уровня кластера.
    
   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   > Рекомендуется как можно скорее обновить функциональный уровень кластера, но технически для этого у вас может быть до четырех недель.

6. После обновления функционального уровня кластера используйте следующий командлет для обновления пула носителей. На этом этапе новые командлеты, такие `Get-ClusterPerf` как, будут полностью работоспособны на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. При необходимости можно обновить уровни конфигурации виртуальных машин, остановите каждую виртуальную машину и используя `Update-VMVersion` командлет, а затем снова запустите виртуальные машины.

8. Если вы используете программно определенную сеть с параметрами SET и отключенные проверки динамической миграции виртуальной машины, как описано выше, используйте следующий командлет для повторного включения проверки динамической проверки виртуальной машины:

   ```PowerShell
   Get-ClusterResourceType -Cluster {clusterName} -Name "Virtual Machine" | 
   Set-ClusterParameter SkipMigrationDestinationCheck -Value 0
   ```

9. Убедитесь, что обновленный кластер работает должным образом. Роли должны быть правильно отработки отказа. Если в кластере используется динамическая миграция виртуальной машины, виртуальные машины должны успешно переноситься в активное перемещение.

10. Проверьте кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.

## <a name="performing-an-in-place-upgrade-while-vms-are-stopped"></a>Выполнение обновления на месте при остановке виртуальных машин

Этот параметр приводит к простою виртуальной машины, но может занять меньше времени, чем если бы вы сохранили виртуальные машины, выполняющиеся во время обновления, поскольку вам не нужно ждать завершения заданий хранилища (зеркальное восстановление) после обновления каждого сервера. Хотя отдельные серверы будут перезапущены последовательно во время процесса обновления, остальные серверы в кластере остаются работающими.

1. Убедитесь, что все серверы в кластере работают с последними обновлениями. Дополнительные сведения см. в [статье Windows 10 и Windows Server 2016 Обновление журнала](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history). Установите как минимум [статью 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) базы знаний Майкрософт (Фев 19, 2019). Номер сборки (см `ver` . команду) должен быть 14393,2828 или выше.

2. Завершите работу виртуальных машин в кластере.

3. Выполните следующие действия на одном сервере кластера за раз:

   1. Приостановите работу сервера кластера с помощью следующей команды PowerShell — Обратите внимание, что некоторые внутренние группы скрыты. Мы рекомендуем соблюдать этот шаг.

        ```PowerShell
       Suspend-ClusterNode -Drain
       ```

   2. Переведите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Enable-StorageMaintenanceMode
       ```

   3. Выполните следующий командлет, чтобы убедиться, что значение **OperationalStatus** находится **в режиме обслуживания**:

       ```PowerShell
       Get-PhysicalDisk
       ```

   4. Выполните обновление установки Windows Server 2019 на сервере, запустив **программу Setup. exe** и выбрав параметр "не использовать личные файлы и приложения".  
   После завершения установки сервер остается в кластере, а служба кластеров запускается автоматически.

   5.  Убедитесь, что на недавно обновленном сервере установлены последние обновления для Windows Server 2019.  
   Дополнительные сведения см. в [статье Windows 10 и Windows Server 2019 Обновление журнала](https://support.microsoft.com/help/4464619/windows-10-update-history).
   Номер сборки (см `ver` . команду) должен быть 17763,292 или выше.

   6.  Удалите сервер из режима обслуживания хранилища, используя следующие команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   7.  Возобновите работу сервера с помощью следующей команды PowerShell:

       ```PowerShell
       Resume-ClusterNode
       ```

   8.  Дождитесь завершения заданий восстановления хранилища и, чтобы все диски возвращались в работоспособное состояние.  
   Это должно быть относительно быстро, так как виртуальные машины не работают. Ниже приведены команды для выполнения.

       ```PowerShell
       Get-StorageJob
       Get-VirtualDisk
       ```

4. Обновите следующий сервер в кластере.
5. После обновления всех серверов до Windows Server 2019 используйте следующий командлет PowerShell для обновления функционального уровня кластера.
    
   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   >   Рекомендуется как можно скорее обновить функциональный уровень кластера, но технически для этого у вас может быть до четырех недель.

6. После обновления функционального уровня кластера используйте следующий командлет для обновления пула носителей.  
   На этом этапе новые командлеты, такие `Get-ClusterPerf` как, будут полностью работоспособны на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. Запустите виртуальные машины в кластере и убедитесь, что они работают правильно.

8. При необходимости можно обновить уровни конфигурации виртуальных машин, остановите каждую виртуальную машину и используя `Update-VMVersion` командлет, а затем снова запустите виртуальные машины.

9. Убедитесь, что обновленный кластер работает должным образом.  
   Роли должны быть правильно отработки отказа. Если в кластере используется динамическая миграция виртуальной машины, виртуальные машины должны успешно переноситься в активное перемещение.

10. Проверьте кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.

## <a name="performing-a-clean-os-installation-while-vms-are-stopped"></a>Выполнение чистой установки ОС при остановке виртуальных машин

Этот параметр приводит к простою виртуальной машины, но может занять меньше времени, чем если бы вы сохранили виртуальные машины, выполняющиеся во время обновления, поскольку вам не нужно ждать завершения заданий хранилища (зеркальное восстановление) после обновления каждого сервера. Хотя отдельные серверы будут перезапущены последовательно во время процесса обновления, остальные серверы в кластере остаются работающими.

1. Убедитесь, что все серверы в кластере работают с последними обновлениями.  
   Дополнительные сведения см. в [статье Windows 10 и Windows Server 2016 Обновление журнала](https://support.microsoft.com/help/4000825/windows-10-windows-server-2016-update-history).
   Установите как минимум [статью 4487006](https://support.microsoft.com/help/4487006/windows-10-update-kb4487006) базы знаний Майкрософт (Фев 19, 2019). Номер сборки (см `ver` . команду) должен быть 14393,2828 или выше.

2. Завершите работу виртуальных машин в кластере.

3. Выполните следующие действия на одном сервере кластера за раз:

   2. Приостановите работу сервера кластера с помощью следующей команды PowerShell — Обратите внимание, что некоторые внутренние группы скрыты.  
      Мы рекомендуем соблюдать этот шаг.

       ```PowerShell
      Suspend-ClusterNode -Drain
      ```

   3. Переведите сервер в режим обслуживания хранилища, выполнив следующие команды PowerShell:

      ```PowerShell
      Get-StorageFaultDomain -type StorageScaleUnit | 
      Where FriendlyName -Eq <ServerName> | 
      Enable-StorageMaintenanceMode
      ```

   4. Выполните следующий командлет, чтобы убедиться, что значение **OperationalStatus** находится **в режиме обслуживания**:

      ```PowerShell
      Get-PhysicalDisk
      ```

   5. Исключите сервер из кластера, выполнив следующую команду PowerShell:  
    
      ```PowerShell
      Remove-ClusterNode <ServerName>
      ```

   6. Выполните чистую установку Windows Server 2019 на сервере: отформатируйте системный диск, запустите **файл Setup. exe** и используйте параметр «Nothing».  
      После завершения установки необходимо настроить удостоверение сервера, роли, компоненты и приложения, после чего сервер будет перезагружен.

   7. Установите на сервере роль Hyper-V и функцию кластеризации с отработкой отказа (можно использовать `Install-WindowsFeature` командлет).

   8. Установите последние драйверы хранилища и сети для оборудования, утвержденные производителем сервера, для использования с Локальные дисковые пространства.

   9. Убедитесь, что на недавно обновленном сервере установлены последние обновления для Windows Server 2019.  
      Дополнительные сведения см. в [статье Windows 10 и Windows Server 2019 Обновление журнала](https://support.microsoft.com/help/4464619/windows-10-update-history).
      Номер сборки (см `ver` . команду) должен быть 17763,292 или выше.

   10. Повторно присоедините сервер к кластеру с помощью следующей команды PowerShell:

      ```PowerShell
      Add-ClusterNode
      ```

   11. Удалите сервер из режима обслуживания хранилища с помощью следующей команды PowerShell:

       ```PowerShell
       Get-StorageFaultDomain -type StorageScaleUnit | 
       Where FriendlyName -Eq <ServerName> | 
       Disable-StorageMaintenanceMode
       ```

   12. Дождитесь завершения заданий восстановления хранилища и, чтобы все диски возвращались в работоспособное состояние.  
       Это может занять значительное время в зависимости от количества виртуальных машин, выполняемых во время обновления сервера. Ниже приведены команды для выполнения.

       ```PowerShell
       Get-StorageJob
       Get-VirtualDisk
       ```

4. Обновите следующий сервер в кластере.

5. После обновления всех серверов до Windows Server 2019 используйте следующий командлет PowerShell для обновления функционального уровня кластера.
    
   ```PowerShell
   Update-ClusterFunctionalLevel
   ```

   > [!NOTE]
   >   Рекомендуется как можно скорее обновить функциональный уровень кластера, но технически для этого у вас может быть до четырех недель.

6. После обновления функционального уровня кластера используйте следующий командлет для обновления пула носителей.  
   На этом этапе новые командлеты, такие `Get-ClusterPerf` как, будут полностью работоспособны на любом сервере в кластере.

   ```PowerShell
   Update-StoragePool
   ```

7. Запустите виртуальные машины в кластере и убедитесь, что они работают правильно.

8. При необходимости можно обновить уровни конфигурации виртуальных машин, остановите каждую виртуальную машину и используя `Update-VMVersion` командлет, а затем снова запустите виртуальные машины.

9. Убедитесь, что обновленный кластер работает должным образом.  
   Роли должны быть правильно отработки отказа. Если в кластере используется динамическая миграция виртуальной машины, виртуальные машины должны успешно переноситься в активное перемещение.

10. Проверьте кластер, выполнив проверку кластера (`Test-Cluster`) и изучив отчет о проверке кластера.
