---
title: На виртуальной машине с помощью дисковых пространств
ms.prod: windows-server-threshold
ms.author: eldenc
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: eldenchristensen
ms.date: 10/25/2017
description: Как развернуть дисковых пространств в гостевой кластер виртуальных машин, — например, в Microsoft Azure.
ms.localizationpriority: medium
ms.openlocfilehash: d05afb5ee564b866dcd15ec6aa473cee608dbd8f
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67284407"
---
# <a name="using-storage-spaces-direct-in-guest-virtual-machine-clusters"></a>С помощью дисковых пространств в кластеров гостевых виртуальных машин

> Относится к: Windows Server 2019, Windows Server 2016

Можно развернуть дисковые пространства в кластере из физических серверов или кластерах гостевой виртуальной машины, как описано в этом разделе. Этот тип развертывания обеспечивает виртуальное общее хранилище на разных набора виртуальных машин на основе частного или общедоступного облака, чтобы решения высокого уровня доступности приложения, которые можно использовать для повышения доступности приложений.

![](media/storage-spaces-direct-in-vm/storage-spaces-direct-in-vm.png)

## <a name="deploying-in-azure-iaas-vm-guest-clusters"></a>Развертывание кластеров гостевых виртуальных Машин Azure Iaas

[Шаблоны Azure](https://github.com/robotechredmond/301-storage-spaces-direct-md) были опубликованных Уменьшение сложности, настройте лучшие рекомендации, а также скорости работы дисковых развертываний на виртуальной Машине Iaas Azure. Это рекомендуемое решение для развертывания в Azure.

<iframe src="https://channel9.msdn.com/Series/Microsoft-Hybrid-Cloud-Best-Practices-for-IT-Pros/Step-by-Step-Deploy-Windows-Server-2016-Storage-Spaces-Direct-S2D-Cluster-in-Microsoft-Azure/player" width="960" height="540" allowfullscreen></iframe>

## <a name="requirements"></a>Требования

При развертывании дисковыми пространствами в виртуальной среде следует принимать во внимание следующие соображения.

> [!TIP]
> Шаблоны Azure автоматически настраивает ниже рекомендации для вас и являются рекомендуемым решением при развертывании на виртуальных машинах IaaS Azure.

-   Не менее 2 узлов и до 3 узлов

-   развертывания на узле 2 необходимо настроить следящий сервер (облако-свидетель или файловый ресурс-свидетель)

-   Развертывание 3-узловой может выдержать 1 узел вниз и потери 1 или несколько дисков, на другом узле.  2 узла в случае завершения работы затем виртуальные диски мы быть вне сети до возвращения одного из узлов.  

-   Настройка виртуальных машин для развертывания в доменах сбоя

    -   Azure — настроить группу доступности

    -   Hyper-V — Настройка AntiAffinityClassNames на виртуальных машинах для разделения виртуальных машин между узлами

    -   VMware — правило близости Виртуальных Машинах Настройка путем создания правила DRS типа "отдельных виртуальных машинах» размещение виртуальных машин на узлах ESX. Адаптер Paravirtual SCSI (PVSCSI) следует использовать диски, представленные для использования с дисковыми пространствами. Для поддержки PVSCSI с Windows Server, обратитесь к https://kb.vmware.com/s/article/1010398.

-   Использовать высокоскоростной / высокопроизводительного хранилища — хранилище Azure класса Premium управляемые диски являются обязательными

-   Планирование развертывания плоского хранилища с помощью кэширования устройства не настроены

-   Минимум 2 данных виртуального диска, для каждой виртуальной Машины (VHD / VHDX / VMDK)

    Это число отличается от развертывания без операционной системы, так как виртуальные диски могут быть реализованы как файлы, которые не подвержены влиянию сбоев физического.

-   Отключение возможности замены автоматического диска в службе работоспособности, выполнив следующий командлет PowerShell:

    ```powershell
    Get-storagesubsystem clus* | set-storagehealthsetting -name “System.Storage.PhysicalDisk.AutoReplace.Enabled” -value “False”
    ```

-   Не поддерживаются: Моментальных снимков виртуальных дисков на уровне узла и восстановления

    Вместо этого используйте традиционные гостевого уровня решения для резервного копирования резервного копирования и восстановления данных на дисковых томах.

-   Предоставить большую устойчивость к возможных VHD / VHDX / задержка хранилища VMDK в гостевых кластеров, увеличивать значение времени ожидания ввода-вывода хранилища пробелов:

    `HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\spaceport\\Parameters\\HwTimeout`

    `dword: 00007530`

    Десятичный эквивалент шестнадцатеричное 7530 — 30000, составляет 30 секунд. Обратите внимание на то, что значение по умолчанию — 1770 шестнадцатеричном или 6000 десятичное число, которое составляет 6 секунд.

## <a name="see-also"></a>См. также

[Дополнительные шаблоны виртуальных Машин Azure Iaas для развертывания дисковых пространств, видео и пошаговые руководства](https://techcommunity.microsoft.com/t5/Failover-Clustering/Deploying-IaaS-VM-Guest-Clusters-in-Microsoft-Azure/ba-p/372126).

[Дополнительное хранилище локальных дисковых пространств Обзор](https://docs.microsoft.com/windows-server/storage/storage-spaces/storage-spaces-direct-overview)
