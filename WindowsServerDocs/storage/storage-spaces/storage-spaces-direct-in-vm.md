---
title: С помощью локальных дисковых пространств на виртуальной машине
ms.prod: windows-server-threshold
ms.author: eldenc
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: eldenchristensen
ms.date: 10/25/2017
description: Инструкции по развертыванию локальных дисковых пространств в кластере гостевой виртуальной машины, — например, в Microsoft Azure.
ms.localizationpriority: medium
ms.openlocfilehash: a741475d09ab7f7ab29f158ef55378ca9a37beac
ms.sourcegitcommit: 52883945fd6e6bb5c24bd81944ca4bc0c5e6a216
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2018
ms.locfileid: "8964616"
---
# В кластерах гостевой виртуальной машины с помощью локальных дисковых пространств

> Область применения: Windows Server 2016, Windows Server 2019 г.

Вы можете развернуть локальных дисковых пространств, в кластере физических серверов, или в кластерах гостевой виртуальной машины, как описано в этом разделе. Этот тип развертывания обеспечивает виртуального общего хранилища на разных набора виртуальных машин на основе облака частной или общедоступной, чтобы решения высокой доступности приложения можно использовать для повышения доступности приложений.

![](media/storage-spaces-direct-in-vm/storage-spaces-direct-in-vm.png)

## Развертывание в кластерах гостевых виртуальных Машин Azure Iaas

[Azure шаблоны](https://github.com/robotechredmond/301-storage-spaces-direct-md) уже опубликованных Уменьшение сложности, Настройка лучшие рекомендации и скорости развертывании локальных дисковых пространств на виртуальной Машине Azure Iaas. Это является рекомендуемым решением для развертывания в Azure.

<iframe src="https://channel9.msdn.com/Series/Microsoft-Hybrid-Cloud-Best-Practices-for-IT-Pros/Step-by-Step-Deploy-Windows-Server-2016-Storage-Spaces-Direct-S2D-Cluster-in-Microsoft-Azure/player" width="960" height="540" allowfullscreen></iframe>

## Требования

При развертывании локальных дисковых пространств в виртуализированной среде следует принимать во внимание следующие соображения.

> [!TIP]
> Azure шаблоны автоматически настроит ниже рекомендации для вас и приведены рекомендуемые решения при развертывании на виртуальных машинах Azure IaaS.

-   Не менее 2 узлами и не более 3 узлов

-   Развертывание двух узлов необходимо настроить свидетель (облако-свидетель или файлового ресурса-свидетеля)

-   развертывание трех узлов допускает 1 узел вниз и потери 1 или несколько дисков на другой узел.  При завершении работы двух узлов виртуальных дисков мы будет автономных до момента один из узлов.  

-   Настройка виртуальных машин для развертывания на разных доменов сбоя

    -   Azure — настроить доступность набор

    -   Hyper-V — Настройка AntiAffinityClassNames на виртуальных машинах для разделения виртуальные машины между узлами

    -   VMware — сходство защита виртуальной Машины виртуальную Машину настроить правило, создав правило DRS типа "отдельных виртуальных машин» для разделения виртуальные машины между ЭТИМ компьютерам. Диски, представленном для использования с локальными дисковыми пространствами следует использовать адаптер SCSI Paravirtual (PVSCSI). Для поддержки PVSCSI с Windows Server, обратитесь к https://kb.vmware.com/s/article/1010398.

-   Использование низкой задержкой / управляемые высокую производительность хранилища - хранилища Azure Premium диски являются обязательными

-   Развертывание проектирование плоский хранилища с помощью кэширования устройства не настроена

-   Минимальный 2 дисков виртуальный данных, отображаются для каждой виртуальной Машины (виртуальный жесткий ДИСК или VHDX / VMDK)

    Это число отличается от чистого развертывания, так как виртуальные диски будет реализована в виде файлов, которые не являются уязвимыми для физических сбоев.

-   Отключите возможности замены автоматического диска в служба работоспособности, выполнив следующий командлет PowerShell:

    ```powershell
    Get-storagesubsystem clus* | set-storagehealthsetting -name “System.Storage.PhysicalDisk.AutoReplace.Enabled” -value “False”
    ```

-   Не поддерживается: размещение моментального снимка уровня виртуального диска и восстановления

    Вместо этого используйте традиционные гостевой уровня резервной копии решения для резервного копирования и восстановления данных на локальные дисковые пространства тома.

-   Для предоставления более устойчивости к возможных VHD или VHDX / VMDK хранилища задержку в гостевых кластеров увеличить время ожидания операций ввода-вывода для локальных дисковых:

    `HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\spaceport\\Parameters\\HwTimeout`

    `dword: 00007530`

    Десятичный эквивалент шестнадцатеричное 7530 — 30000, составляет 30 секунд. Обратите внимание, что значение по умолчанию 1770 шестнадцатеричном или 6000 десятичных чисел, который является 6 секунд.

## См. также

[Шаблоны дополнительных виртуальных Машин Azure Iaas развертывание локальных дисковых пространств, видео и пошаговые руководства](https://blogs.msdn.microsoft.com/clustering/2017/02/14/deploying-an-iaas-vm-guest-clusters-in-microsoft-azure/).

[Дополнительные локальные дисковые пространства Обзор] (https://docs.microsoft.com/en-us/windows-server/storage/storage-spaces/storage-spaces-direct-overview)
