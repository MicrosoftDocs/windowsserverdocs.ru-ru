---
title: Отказоустойчивость и экономичность хранения данных в локальных дисковых пространствах
manager: eldenc
ms.topic: article
author: cosmosdarwin
ms.author: cosdar
ms.date: 10/11/2017
ms.assetid: 5e1d7ecc-e22e-467f-8142-bad6d82fc5d0
description: Описание типов устойчивости в локальных дисковых пространствах, в том числе зеркального отображения и четности.
ms.localizationpriority: medium
ms.openlocfilehash: c6ef53927a1c6ed4e5275bc2412faa97510c024e
ms.sourcegitcommit: 7cacfc38982c6006bee4eb756bcda353c4d3dd75
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/14/2020
ms.locfileid: "90078511"
---
# <a name="fault-tolerance-and-storage-efficiency-in-storage-spaces-direct"></a>Отказоустойчивость и экономичность хранения данных в локальных дисковых пространствах

>Применяется к: Windows Server 2016

В этом разделе представлены параметры устойчивости, доступные в [локальных дисковых пространствах](storage-spaces-direct-overview.md), и описаны требования к масштабированию, экономичность хранения и общие преимущества и недостатки каждого из них. Кроме того, в разделе приводятся некоторые инструкции по использованию, которые помогут вам приступить к работе, и ссылки на полезные документы, блоги и дополнительные материалы.

Если вы уже знакомы с дисковыми пространствами, можно сразу перейти к разделу [Сводка](#summary).

## <a name="overview"></a>Обзор

По сути, дисковые пространства предназначены для обеспечения отказоустойчивости («устойчивости») ваших данных. Их реализация в чем-то схожа с RAID, однако она распределена между серверами и реализована на программном уровне.

Как и с RAID, существует несколько сценариев функционирования дисковых пространств, различающихся уровнем отказоустойчивости, экономичности хранения и сложности вычислений. В общем и целом можно выделить две категории: "зеркальное отображение" и "четность". Последнюю иногда называют "помехоустойчивым кодированием".

## <a name="mirroring"></a>Зеркальное отображение

Зеркальное отображение обеспечивает отказоустойчивость, сохраняя несколько копий всех данных. Это наиболее напоминает RAID-1. Как эти данные чередуются и помещены в нетривиальный (см. [этот блог](https://techcommunity.microsoft.com/t5/storage-at-microsoft/deep-dive-the-storage-pool-in-storage-spaces-direct/ba-p/425959) , чтобы получить дополнительные сведения), но совершенно верно сказать, что все данные, хранящиеся с помощью зеркального отображения, записываются целиком в несколько раз. Каждая копия записывается на разное физическое оборудование (разные диски на разных серверах), которые, как предполагается, выходят из строя независимо друг от друга.

В Windows Server 2016 дисковые пространства позволяют выполнять зеркальное отображение двух типов: двухстороннее и трехстороннее.

### <a name="two-way-mirror"></a>Двухстороннее зеркало

При двухстороннем зеркальном отображении записываются два экземпляра всех данных. Экономичность хранения составляет 50%: для записи 1 ТБ данных требуется не менее 2 ТБ физической памяти. Аналогично требуется по крайней мере два [аппаратных домена сбоя](../../failover-clustering/fault-domains.md) с локальными дисковыми пространствами, то есть два сервера.

![two-way-mirror](media/Storage-Spaces-Fault-Tolerance/two-way-mirror-180px.png)

   >[!WARNING]
   > Если у вас больше двух серверов, рекомендуем использовать трехстороннее зеркальное отображение.

### <a name="three-way-mirror"></a>Трехстороннее зеркало

При трехстороннем зеркальном отображении записывается три экземпляра всех данных. Экономичность хранения составляет 33.3 %: для записи 1 ТБ данных требуется не менее 3 ТБ физической памяти. Аналогично требуется по крайней мере три аппаратных домена сбоя с локальными дисковыми пространствами, то есть три сервера.

Трехстороннее зеркальное отображение может безопасно допускать не менее [двух проблем с оборудованием (диск или сервер) за раз](#examples). Например, в случае перезагрузки одного сервера при внезапном сбое другого диска или сервера все данные остаются в целостности и постоянно доступными.

![three-way-mirror](media/Storage-Spaces-Fault-Tolerance/three-way-mirror-180px.png)

## <a name="parity"></a>Parity

Кодировка четности, которую часто называют "помехоустойчивым кодированием", обеспечивает защиту от сбоев с помощью битовой арифметики, которая может становиться [весьма сложной](https://www.microsoft.com/research/wp-content/uploads/2016/02/LRC12-cheng20webpage.pdf). Принцип работы этой схемы менее понятен, чем зеркальное отражение, однако в Интернете множество материалов на эту тему (например, стороннее издание [Руководство по помехоустойчивому кодированию для чайников](http://smahesh.com/blog/2012/07/01/dummies-guide-to-erasure-coding/)). Преимуществом такой схемы является повышенная экономичность хранения данных без ущерба для отказоустойчивости.

В Windows Server 2016 дисковые пространства обеспечивают два типа четности: одинарную и двойную. Для реализации последней используется продвинутая техника «локальных кодов реконструкции» в крупных масштабах.

> [!IMPORTANT]
> Мы рекомендуем использовать зеркалирование для большинства требовательных к производительности рабочих нагрузок. Дополнительные сведения о том, как обеспечить баланс производительности и емкости в зависимости от рабочей нагрузки, см. в разделе [Планирование томов](plan-volumes.md#choosing-the-resiliency-type).

### <a name="single-parity"></a>Одинарная четность
Одинарная четность сохраняет только один битовый символ четности, что обеспечивает отработку только одного отказа за раз. Этот сценарий наиболее схож с RAID-5. Чтобы использовать одинарную четность, требуется по крайней мере три аппаратных домена сбоя с локальными дисковыми пространствами, то есть три сервера. Поскольку трехстороннее зеркальное отражение обеспечивает лучшую отработку отказа в тех же масштабах, использовать одинарную четность не рекомендуется. Однако при желании вы можете воспользоваться этим способом, он полностью поддерживается.

   >[!WARNING]
   > Не рекомендуем использовать одинарную четность, так как она не выдерживает сразу несколько сбоев оборудования. Если во время перезагрузки одного сервера внезапно откажет другой диск или сервер, данные станут недоступны. Если у вас только три сервера, рекомендуется использовать трехстороннее зеркальное отображение. Если у вас четыре и более серверов, см. следующий раздел.

### <a name="dual-parity"></a>Двойная четность

Двойная четность реализует коды исправления ошибок Рида-Соломона, чтобы сохранить два битовых символа четности и обеспечить такой же уровень отказоустойчивости, что и при трехстороннем зеркалировании (т. е. до двух сбоев за раз), но с большей экономичностью хранения. Этот сценарий наиболее схож с RAID-6. Чтобы использовать двойную четность, требуется по крайней мере четыре аппаратных домена сбоя с локальными дисковыми пространствами, то есть четыре сервера. В таких масштабах экономичность хранения данных равна 50 %, то есть для хранения 2 ТБ данных необходимо 4 ТБ физической памяти.

![dual-parity](media/Storage-Spaces-Fault-Tolerance/dual-parity-180px.png)

Экономичность хранения данных в сценарии с двойной четностью увеличивается по мере увеличения аппаратных доменов сбоя с 50 % до 80 %. Например, при наличии семи доменов (с локальными дисковыми пространствами то есть семью серверами) экономичность повышается до 66,7 %: для хранения 4 ТБ данных необходимо всего 6 ТБ физической памяти.

![dual-parity-wide](media/Storage-Spaces-Fault-Tolerance/dual-parity-wide-180px.png)

Сведения об экономичности двойной четности и локальных кодах реконструкции для всех масштабов см. в разделе [Сводка](#summary).

### <a name="local-reconstruction-codes"></a>Локальные коды реконструкции

Дисковые пространства в Windows Server 2016 предоставляют продвинутую технику, разработанную Microsoft Research, которая называется «локальные коды реконструкции» (или LRC). В крупных системах при использовании двойной четности LRC служат для разделения операций кодирования и декодирования на более мелкие группы, чтобы снизить нагрузку на систему в связи с записью данных или восстановлением после сбоя.

При использовании жестких дисков размер группы обозначается четырьмя символами, при использовании твердотельных накопителей — шестью символами. Например, так выглядит структура с жесткими дисками и 12 аппаратными доменами сбоя (т. е. 12 серверами): две группы по четыре символа данных. Это обеспечивает экономичность хранения данных 72,7 %.

![local-reconstruction-codes](media/Storage-Spaces-Fault-Tolerance/local-reconstruction-codes-180px.png)

Мы рекомендуем ознакомиться с подробными [сведениями о том, как коды локальных преобразований обрабатывали различные сценарии сбоев, и почему они являются привлекательными](https://techcommunity.microsoft.com/t5/storage-at-microsoft/bg-p/FileCAB), наш собственный [оператор жоерженсен](https://twitter.com/clausjor).

## <a name="mirror-accelerated-parity"></a>Четность с зеркальным ускорением

Начиная с Windows Server 2016 том локальных дисковых пространств может одновременно использоваться и в зеркалировании, и в четности. Записанные данные сначала оказываются в зеркально отображаемом разделе, а затем постепенно перемещаются в раздел четности. Фактически, это [использование зеркального отображения для ускорения помехоустойчивого кодирования](https://techcommunity.microsoft.com/t5/storage-at-microsoft/bg-p/FileCAB).

Чтобы одновременно использовать трехстороннее зеркало и двойную четность, необходимо по меньшей мере четыре домена сбоя, то есть четыре сервера.

Экономичность хранения четности с зеркальным ускорением представляет собой нечто среднее между использованием исключительно зеркал или исключительно четности (все зависит от выбираемых пропорций). Например, демонстрации на 37-й минуте этой презентации показывает [различные сочетания, обеспечивающие экономичность на уровне 46%, 54% и 65%](https://www.youtube.com/watch?v=-LK2ViRGbWs&t=36m55s) с 12 серверами.

> [!IMPORTANT]
> Мы рекомендуем использовать зеркалирование для большинства требовательных к производительности рабочих нагрузок. Дополнительные сведения о том, как обеспечить баланс производительности и емкости в зависимости от рабочей нагрузки, см. в разделе [Планирование томов](plan-volumes.md#choosing-the-resiliency-type).

## <a name="summary"></a><a name="summary"></a>Сводка

В этом разделе описываются типы устойчивости, доступные в локальных дисковых пространствах, минимальные требования к масштабированию при использовании каждого из этих типов, число допустимых сбоев для каждого из этих типов и соответствующая экономичность хранения.

### <a name="resiliency-types"></a>Типы устойчивости

|    Устойчивость          |    Отказоустойчивость       |    Экономичность хранения      |
|------------------------|----------------------------|----------------------------|
|    Двухстороннее зеркало      |    1                       |    50.0%                   |
|    Трехстороннее зеркало    |    2                       |    33,3 %                   |
|    Двойная четность         |    2                       |    50,0–80,0 %           |
|    Смешанный               |    2                       |    33,3–80,0 %           |

### <a name="minimum-scale-requirements"></a>Минимальные требования к масштабированию

|    Устойчивость          |    Минимальное количество доменов сбоя   |
|------------------------|-------------------------------------|
|    Двухстороннее зеркало      |    2                                |
|    Трехстороннее зеркало    |    3                                |
|    Двойная четность         |    4                                |
|    Смешанный               |    4                                |

   >[!TIP]
   > Если вы не используете [отказоустойчивость на уровне корпуса или стоек](../../failover-clustering/fault-domains.md), количество доменов сбоя соответствует количеству серверов. Число накопителей в каждом сервере не влияет на то, какие типы устойчивости можно использовать, если выполняются минимальные требования для локальных дисковых пространств.

### <a name="dual-parity-efficiency-for-hybrid-deployments"></a>Эффективность двойной четности для гибридных развертываний

В этой таблице показана экономичность хранения данных при использовании двойной четности и локальных кодов реконструкции в каждом масштабе для гибридных развертываний с применением жестких дисков (HDD) и твердотельных накопителей (SSD).

|    Домены сбоя      |    Макет           |    Эффективность   |
|-----------------------|---------------------|-----------------|
|    2                  |    –                |    –            |
|    3                  |    –                |    –            |
|    4                  |    RS 2+2           |    50.0%        |
|    5                  |    RS 2+2           |    50.0%        |
|    6                  |    RS 2+2           |    50.0%        |
|    7                  |    RS 4+2           |    66,7 %        |
|    8                  |    RS 4+2           |    66,7 %        |
|    9                  |    RS 4+2           |    66,7 %        |
|    10                 |    RS 4+2           |    66,7 %        |
|    11                 |    RS 4+2           |    66,7 %        |
|    12                 |    LRC (8, 2, 1)    |    72,7 %        |
|    13                 |    LRC (8, 2, 1)    |    72,7 %        |
|    14                 |    LRC (8, 2, 1)    |    72,7 %        |
|    15                 |    LRC (8, 2, 1)    |    72,7 %        |
|    16                 |    LRC (8, 2, 1)    |    72,7 %        |

### <a name="dual-parity-efficiency-for-all-flash-deployments"></a>Эффективность двойной четности для развертываний с применением только флэш-накопителей

В этой таблице показана экономичность хранения данных при использовании двойной четности и локальных кодов реконструкции в каждом масштабе для развертываний с применением только флэш-накопителей, в которых используются только твердотельные накопители (SSD). Структура с контролем четности может использовать более крупные размеры групп и обеспечивать лучшую экономичность хранения в конфигурации с применением только флэш-накопителей.

|    Домены сбоя      |    Макет           |    Эффективность   |
|-----------------------|---------------------|-----------------|
|    2                  |    –                |    –            |
|    3                  |    –                |    –            |
|    4                  |    RS 2+2           |    50.0%        |
|    5                  |    RS 2+2           |    50.0%        |
|    6                  |    RS 2+2           |    50.0%        |
|    7                  |    RS 4+2           |    66,7 %        |
|    8                  |    RS 4+2           |    66,7 %        |
|    9                  |    RS 6+2           |    75.0%        |
|    10                 |    RS 6+2           |    75.0%        |
|    11                 |    RS 6+2           |    75.0%        |
|    12                 |    RS 6+2           |    75.0%        |
|    13                 |    RS 6+2           |    75.0%        |
|    14                 |    RS 6+2           |    75.0%        |
|    15                 |    RS 6+2           |    75.0%        |
|    16                 |    LRC (12, 2, 1)   |    80 %        |

## <a name="examples"></a><a name="examples"></a>Примеров

Если у вас больше двух серверов, рекомендуется использовать трехстороннее зеркалирование и (или) двойную четность, так как эти варианты обеспечивают лучшую отказоустойчивость. В частности, они обеспечивают безопасность и постоянную доступность всех данных даже в случае одновременного отказа двух доменов сбоя (т. е. двух серверов в случае локальных дисковых пространств).

### <a name="examples-where-everything-stays-online"></a>Примеры, в которых вся система сохраняет функциональность

Следующие шесть примеров показывают, какие ситуации **допустимы** при использовании трехстороннего зеркалирования и (или) двойной четности.

- **1.** Отказ одного накопителя (в том числе кэш-накопителя).
- **2.** Отказ одного сервера.

![fault-tolerance-examples-1-and-2](media/Storage-Spaces-Fault-Tolerance/Fault-Tolerance-Example-12.png)

- **3.** Отказ одного сервера и одного накопителя.
- **4.** Отказ двух накопителей на разных серверах.

![fault-tolerance-examples-3-and-4](media/Storage-Spaces-Fault-Tolerance/Fault-Tolerance-Example-34.png)

- **5.** Отказ более чем двух накопителей, при условии что отказом затронуты не более двух серверов.
- **6.** Отказ двух серверов.

![fault-tolerance-examples-5-and-6](media/Storage-Spaces-Fault-Tolerance/Fault-Tolerance-Example-56.png)

...в каждой из этих ситуаций все тома останутся доступными. (Убедитесь, что кластер обеспечивает кворум.)

### <a name="examples-where-everything-goes-offline"></a>Примеры, в которых вся система отключается

На протяжении жизненного цикла дисковые пространства могут обработать любое количество сбоев, потому что после каждого сбоя восстанавливается полная устойчивость системы (при наличии достаточного времени). При этом в любой момент времени безопасно переносить отказы могут не более двух доменов сбоя. Ниже приведены примеры ситуаций, с которыми **не могут** справиться трехстороннее зеркалирование и (или) двойная четность.

- **7.** Одновременный отказ накопителей на трех и более серверах.
- **8.** Одновременный отказ трех и более серверов.

![fault-tolerance-examples-7-and-8](media/Storage-Spaces-Fault-Tolerance/Fault-Tolerance-Example-78.png)

## <a name="usage"></a>Использование

Просмотрите статью [Создание томов в локальных дисковых пространствах](create-volumes.md).

## <a name="additional-references"></a>Дополнительные ссылки

Каждая ссылка ниже упоминается в тексте этого раздела.

- [Локальные дисковые пространства в Windows Server 2016](storage-spaces-direct-overview.md)
- [Поддержка домена сбоя в Windows Server 2016](../../failover-clustering/fault-domains.md)
- [Помехоустойчивое кодирование в Azure, Microsoft Research](https://www.microsoft.com/research/publication/erasure-coding-in-windows-azure-storage/)
- [Локальные коды реконструкции и ускорение томов четности](https://techcommunity.microsoft.com/t5/storage-at-microsoft/bg-p/FileCAB)
- [Тома в API управления хранением](https://techcommunity.microsoft.com/t5/storage-at-microsoft/bg-p/FileCAB)
- [Демонстрация экономичности хранения на Microsoft Ignite 2016](https://www.youtube.com/watch?v=-LK2ViRGbWs&t=36m55s)
- [Калькулятор емкости для локальных дисковых пространств (предварительная версия)](https://aka.ms/s2dcalc)
