---
ms.assetid: 342173ca-4e10-44f4-b2c9-02a6c26f7a4a
title: Планирование томов в локальных дисковых пространствах
ms.author: cosdar
manager: eldenc
ms.topic: article
author: cosmosdarwin
ms.date: 06/28/2019
ms.localizationpriority: medium
ms.openlocfilehash: dcc98fba7194da322f9fc97b67eb43d481f50133
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87971151"
---
# <a name="planning-volumes-in-storage-spaces-direct"></a>Планирование томов в локальных дисковых пространствах

> Применяется к: Windows Server 2019, Windows Server 2016

Эта статья содержит рекомендации по планированию томов в локальных дисковых пространствах в соответствии с потребностями рабочих нагрузок, касающимися производительности и мощности, в том числе по выбору их файловой системы, типа устойчивости и размера.

## <a name="review-what-are-volumes"></a>Краткие сведения: что такое тома

Тома — это место размещения файлов, необходимых рабочим нагрузкам, например VHD-или VHDX-файлы для виртуальных машин Hyper-V. Тома объединяют диски в пул хранения, чтобы обеспечить отказоустойчивость, масштабируемость и производительность локальных дисковых пространств.

   >[!NOTE]
   > В документации по локальным дисковым пространствам мы используем термин "том" как суммарное обозначение тома и базового виртуального диска, а также других встроенных функций Windows, таких как общие тома кластера (CSV) и ReFS. Для успешного планирования и развертывания локальных дисковых пространств понимать эти различия необязательно.

![what-are-volumes](media/plan-volumes/what-are-volumes.png)

Все тома доступны всем серверам в кластере одновременно. После создания они отображаются в **C:\ClusterStorage \\ ** на всех серверах.

![csv-folder-screenshot](media/plan-volumes/csv-folder-screenshot.png)

## <a name="choosing-how-many-volumes-to-create"></a>Выбор количества томов

Рекомендуем использовать количество томов, кратное количеству серверов в кластере. Например, при наличии 4 серверов вы получите более устойчивую производительность с 4 общими томами, чем с 3 или 5. Это позволяет кластеру распределять "принадлежность" тома равномерно между серверами (один сервер выполняет оркестрацию метаданных для каждого тома).

Рекомендуем ограничить общее число томов следующим образом:

| Windows Server 2016          | Windows Server 2019          |
|------------------------------|------------------------------|
| До 32 томов на кластер | До 64 томов на кластер |

## <a name="choosing-the-filesystem"></a>Выбор файловой системы

Рекомендуем использовать новую файловую систему [Resilient File System (ReFS)](../refs/refs-overview.md) для локальных дисковых пространств. ReFS — это основная файловая система для виртуализации, которая обеспечивает множество преимуществ, в том числе существенное ускорение работы и встроенную защиту от повреждения данных. Он поддерживает почти все ключевые функции NTFS, включая дедупликацию данных в Windows Server версии 1709 и более поздних. Дополнительные сведения см. в [таблице сравнение возможностей](../refs/refs-overview.md#feature-comparison) ReFS.

Если рабочей нагрузке требуется функция, которую еще не поддерживает ReFS, можете использовать NTFS.

   > [!TIP]
   > В одном кластере могут сосуществовать тома с разными файловыми системами.

## <a name="choosing-the-resiliency-type"></a>Выбор типа устойчивости

Тома в локальных дисковых пространствах обеспечивают отказоустойчивость для защиты от проблем с оборудованием, таких как сбои дисков или серверов, и для обеспечения постоянной доступности в течение всего времени обслуживания сервера, например во время обновления программного обеспечения.

   > [!NOTE]
   > Доступные типы устойчивости не зависят от используемых типов дисков.

### <a name="with-two-servers"></a>С двумя серверами

С двумя серверами в кластере можно использовать двустороннее зеркальное отображение. Если вы используете Windows Server 2019, можно также использовать вложенную устойчивость.

Двухстороннее зеркальное отображение сохраняет две копии всех данных — одну копию на дисках на каждом сервере. Эффективность хранения составляет 50% — для записи 1 ТБ данных требуется по крайней мере 2 ТБ физического объема хранилища в пуле носителей. Двустороннее зеркальное отображение может безопасно допускать один сбой оборудования за раз (один сервер или диск).

![two-way-mirror](media/plan-volumes/two-way-mirror.png)

Вложенная устойчивость (доступна только в Windows Server 2019) обеспечивает устойчивость данных между серверами с двусторонним зеркальным отображением, а затем повышает устойчивость на сервере с двусторонним зеркальным отображением или контролем четности с зеркальным отображением. Вложенность обеспечивает устойчивость данных, даже если один сервер перезапускается или недоступен. Эффективность хранения составляет 25% с вложенным двусторонним зеркальным отображением и около 35-40% для вложенной контрольной суммы с зеркальным ускорением. Вложенная устойчивость может безопасно допускать два сбоя оборудования за раз (два диска, сервер и диск на оставшемся сервере). Из-за этой дополнительной устойчивости данных мы рекомендуем использовать вложенную устойчивость в рабочих развертываниях кластеров из двух серверов, если вы используете Windows Server 2019. Дополнительные сведения см. в разделе [Вложенная устойчивость](nested-resiliency.md).

![Вложенная четность с ускорением зеркального отображения](media/nested-resiliency/nested-mirror-accelerated-parity.png)

### <a name="with-three-servers"></a>С тремя серверами

С тремя серверами следует использовать трехстороннее зеркальное отображение, чтобы обеспечить более высокую отказоустойчивость и производительность. В этом случае хранятся три копии всех данных, по одной копии на каждом сервере. Экономичность хранения составляет 33,3 %: для записи 1 ТБ данных требуется не менее 3 ТБ физической памяти в пуле носителей. Трехстороннее зеркальное отображение может безопасно допускать не [менее двух проблем с оборудованием (диск или сервер) за раз](storage-spaces-fault-tolerance.md#examples). Если 2 узла станут недоступными, пул носителей потеряет кворум, так как 2/3 дисков недоступны, и виртуальные диски будут недоступны. Однако узел может быть отключен, и один или несколько дисков на другом узле могут завершиться сбоем, а виртуальные диски останутся в сети. Например, в случае перезагрузки одного сервера при внезапном сбое другого диска или сервера все данные остаются в целостности и постоянно доступными.

![three-way-mirror](media/plan-volumes/three-way-mirror.png)

### <a name="with-four-or-more-servers"></a>С четырьмя или более серверами

При наличии четырех или более серверов можно выбрать для каждого из них использование трехуровневой зеркального отображения, двойной контроль четности (часто именуемый очистки-кодированием) или сочетание этих двух вариантов с контролем четности с зеркальным отображением.

Двойная четность обеспечивает ту же отказоустойчивость, что и трехстороннее зеркальное отображение, но лучшую экономичность хранения. При использовании четырех серверов эффективность хранения составляет 50.0% — для хранения 2 ТБ данных требуется 4 ТБ физической емкости хранилища в пуле носителей. Экономичность хранения увеличивается до 66,7 % при использовании семи серверов и достигает 80,0 %. Кодирование четности требует большего объема вычислений, что может ограничивать его производительность.

![dual-parity](media/plan-volumes/dual-parity.png)

Выбор типа устойчивости зависит от требований рабочей нагрузки. Ниже приведена таблица с кратким описанием рабочих нагрузок, которые подходят для каждого типа устойчивости, а также производительности и эффективности хранения каждого типа устойчивости.

| Тип устойчивости | Эффективность использования емкости | Speed | Рабочие нагрузки |
| ------------------- | ----------------------  | --------- | ------------- |
| **Зеркальное отображение**         | ![Эффективность хранения, в которой отображается 33%](media/plan-volumes/3-way-mirror-storage-efficiency.png)<br>Трехстороннее зеркало: 33% <br>Двухстороннее зеркало: 50%     |![Производительность, показывающая 100%](media/plan-volumes/three-way-mirror-perf.png)<br> Высокая производительность  | Виртуализированные рабочие нагрузки<br> Базы данных<br>Другие высокопроизводительные рабочие нагрузки |
| **Четность с зеркальным ускорением** |![Эффективность хранения, в которой отображается около 50%](media/plan-volumes/mirror-accelerated-parity-storage-efficiency.png)<br> Зависит от доли зеркала и четности | ![Производительность, показывающая около 20%](media/plan-volumes/mirror-accelerated-parity-perf.png)<br>Намного медленнее, чем зеркальный, но вдвое быстрее, чем двойная четность<br> Лучше для больших последовательных операций записи и чтения | Архивация и резервное копирование<br> Виртуализированная инфраструктура настольных систем     |
| **Двойной контроль четности**               | ![Эффективность хранения, в которой отображается около 80%](media/plan-volumes/dual-parity-storage-efficiency.png)<br>4 сервера: 50% <br>16 серверов: до 80% | ![Производительность, показывающая около 10%](media/plan-volumes/dual-parity-perf.png)<br>Наибольшая задержка ввода-вывода & загрузка ЦП при записи<br> Лучше для больших последовательных операций записи и чтения | Архивация и резервное копирование<br> Виртуализированная инфраструктура настольных систем  |

#### <a name="when-performance-matters-most"></a>Когда важнее всего производительность

Рабочие нагрузки, у которых жесткие требования к задержке, а также рабочие нагрузки с большим количеством смешанных случайных операций ввода-вывода в секунду, например связанные с базами данных SQL Server или требовательными к производительности виртуальными машинами Hyper-V, необходимо запускать на томах с зеркальным отображением для повышения производительности.

   >[!TIP]
   > Зеркальное отображение работает быстрее, чем любой другой тип устойчивости. Мы используем зеркальное отображение почти для всех примеров производительности.

#### <a name="when-capacity-matters-most"></a>Когда важнее всего емкость

Рабочие нагрузки, которые выполняют запись редко, например связанные с хранилищами данных или автономным неструктурированным защищенным хранилищем, необходимо запускать на томах с двойной четностью для повышения экономичности хранения. Для рабочих нагрузок, связанных с традиционными файловыми серверами, инфраструктурой виртуальных рабочих столов (VDI), а также других рабочих нагрузок, которые не создают много плавающих случайных операций ввода-вывода и/или не требуют наилучшей производительности, также можно использовать двойную четность. Четность неизбежно увеличивает загрузку ЦП и задержку ввода-вывода, особенно при записи, если сравнивать ее с зеркальным отображением.

#### <a name="when-data-is-written-in-bulk"></a>При массовой записи данных

Рабочие нагрузки, которые последовательно записывают большие объемы данных, например предназначенные для архивации или резервного копирования, в Windows Server 2016 можно запускать на томах, для которых используются и зеркальное отображение, и двойная четность. Записанные данные сначала оказываются в зеркально отображаемом разделе, а затем постепенно перемещаются в раздел четности. Это ускоряет прием больших объемов данных и снижает использование ресурсов при этом, так как ресурсоемкое кодирование четности может выполняться в течение более длительного времени. Объем данных, записываемых за раз (например, ежедневная резервная копия) должен свободно помещаться в раздел зеркала. Например, если 100 ГБ принимаются один раз в день, рекомендуем использовать зеркальное отображение для объема 150–200 ГБ и двойную четность для остального объема.

Итоговая экономичность хранения зависит от выбранных пропорций. Примеры см. в [этом ролике](https://www.youtube.com/watch?v=-LK2ViRGbWs&t=36m55s).

   > [!TIP]
   > Если наблюдать за резкой производительностью записи, попадете при приеме данных, это может означать, что зеркальная часть недостаточно велика или что контрольные данные с зеркальным отображением не подходят для вашего варианта использования. Например, если производительность записи уменьшилась с 400 МБ/с до 40 МБ/с, рассмотрите возможность расширения зеркальной части или переключения на трехстороннее зеркало.

### <a name="about-deployments-with-nvme-ssd-and-hdd"></a>О развертываниях с NVMe, SSD и HDD

В развертываниях с дисками двух типов более быстрые диски обеспечивают кэширование, а более медленные — емкость. Это происходит автоматически. Дополнительные сведения см. в статье [Общие сведения о кэше в локальных дисковых пространствах](understand-the-cache.md). В таких развертываниях все тома в конечном итоге располагаются на дисках одного типа — дисках хранения.

В развертываниях с дисками трех типов только самые быстрые диски (NVMe) обеспечивают кэширование, а другие диски (SSD и HDD) обеспечивают емкость. Вы можете выбрать, где будет располагаться каждый том: полностью на уровне SSD, полностью на уровне HDD или и там, и там.

   > [!IMPORTANT]
   > Рекомендуем использовать уровень SSD для размещения самых требовательных к производительности рабочих нагрузок в системе только с флэш-накопителями.

## <a name="choosing-the-size-of-volumes"></a>Выбор размера томов

Рекомендуем ограничить размер каждого тома следующим образом:

| Windows Server 2016 | Windows Server 2019 |
| ------------------- | ------------------- |
| До 32 ТБ         | До 64 ТБ         |

   > [!TIP]
   > Если вы используете решение для резервного копирования, основанное на службе теневого копирования томов (VSS) и в поставщике программного обеспечения Volsnap, как и в случае с рабочими нагрузками файлового сервера, ограничение размера тома до 10 ТБ повысит производительность и надежность. Системы резервного копирования, которые используют новые API RCT Hyper-V, клонирование блоков ReFS или нативные API резервного копирования SQL, хорошо работают на томах размером 32 ТБ и более.

### <a name="footprint"></a>Занимаемое место

Размер тома — это объем данных, которые могут в нем храниться. Он указывается с помощью параметра **-Size** командлета **New-Volume**, а затем отображается в свойстве **Size** при запуске командлета **Get-Volume**.

Размер отличается от *занимаемого места* тома — общего объема физической памяти, который он занимает в пуле носителей. Занимаемое место зависит от его типа устойчивости. Например, место, которое занимают тома, использующие трехстороннее зеркальное отображение, в три раза больше их размера.

В пуле носителей должно быть достаточно места для томов.

![size-versus-footprint](media/plan-volumes/size-versus-footprint.png)

### <a name="reserve-capacity"></a>Резервирование емкости

Нераспределенное пространство в пуле носителей повышает производительность и безопасность данных, так как тома могут восстанавливаться "на месте" после сбоя дисков. Если емкости достаточно, тома могут восстановиться "на месте" до состояния полной устойчивости даже до замены отказавших дисков. Это происходит автоматически.

Рекомендуем зарезервировать эквивалент одного диска хранения на сервер (до 4 дисков). Вы можете зарезервировать больше, но эта минимальная емкость гарантирует немедленное параллельное восстановление "на месте" после сбоя любого диска.

![reserve](media/plan-volumes/reserve.png)

Например, если у вас 2 сервера и диски хранения по 1 ТБ, зарезервируйте 2 ТБ в пуле (2 x 1 = 2). Если у вас 3 сервера и диски хранения по 1 ТБ, зарезервируйте 3 ТБ (3 x 1 = 3). Если у вас 4 или больше серверов и диски хранения по 1 ТБ, зарезервируйте 4 ТБ (4 x 1 = 4).

   >[!NOTE]
   > В кластерах с дисками всех трех типов (NVMe + SSD + HDD) рекомендуем зарезервировать место, равное суммарному размеру одного SSD и одного HDD на сервер (до 4 дисков в каждом случае).

## <a name="example-capacity-planning"></a>Пример. Планирование емкости

Рассмотрим один кластер с четырьмя серверами. У каждого сервера есть кэш-диски, а также 16 дисков хранения по 2 ТБ.

```
4 servers x 16 drives each x 2 TB each = 128 TB
```

Из этих 128 ТБ в пуле носителей мы резервируем четыре диска (8 ТБ), чтобы диски после сбоя могли восстанавливаться "на месте" без какой-либо спешки. После этого в пуле остается 120 ТБ физической памяти, с помощью которой можно создать тома.

```
128 TB – (4 x 2 TB) = 120 TB
```

Предположим, нам нужно разместить в развертывании высокоактивные виртуальные машины Hyper-V, но нам также нужно хранить много старых файлов и резервных копий. Так как у нас четыре сервера, создадим четыре тома.

Поместим виртуальные машины на первые два тома (*Volume1* и *Volume2*). Мы выбираем файловую систему ReFS (для быстрого создания и контрольных точек) и трехстороннее зеркальное отображение для максимальной производительности. Поместим автономное неструктурированное защищенное хранилище на другие два тома (*Volume 3* и *Volume 4*). Мы выбираем файловую систему NTFS (для дедупликации данных) и двойную четность для максимальной емкости.

Необязательно делать все тома одного размера, но для простоты можем сделать все тома по 12 ТБ.

*Volume1* и *Volume2* займут по 36 ТБ физической памяти (12 ТБ x 33,3 % экономичности = 36 ТБ).

*Volume3* и *Volume4* займут по 24 ТБ физической памяти (12 ТБ x 50,0 % экономичности = 24 ТБ).

```
36 TB + 36 TB + 24 TB + 24 TB = 120 TB
```

Физической памяти, доступной в нашем пуле, как раз достаточно для четырех томов. Идеально!

![пример](media/plan-volumes/example.png)

   >[!TIP]
   > Необязательно создавать все тома сразу. Вы всегда можете расширить или создать тома позже.

Для простоты в этом примере используются десятичные единицы (с основанием 10), то есть 1 ТБ = 1 000 000 000 000 байтов. Однако размеры хранилищ в Windows отображаются в двоичных единицах (с основанием 2). Например, диски по 2 ТБ будут отображаться в Windows как диски по 1,82 ТиБ. Для пула носителей размером 128 ТБ будет отображаться 116,41 ТиБ. Это ожидаемое поведение.

## <a name="usage"></a>Использование

См. статью [Создание томов в локальных дисковых пространствах](create-volumes.md).

### <a name="additional-references"></a>Дополнительные ссылки

- [Обзор Локальные дисковые пространства](storage-spaces-direct-overview.md)
- [Выбор дисков для локальных дисковых пространств](choosing-drives.md)
- [Отказоустойчивость и эффективность хранения](storage-spaces-fault-tolerance.md)
