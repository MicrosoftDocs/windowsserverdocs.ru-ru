---
ms.assetid: 342173ca-4e10-44f4-b2c9-02a6c26f7a4a
title: Планирование томов в локальных дисковых пространствах
ms.prod: windows-server-threshold
ms.author: cosdar
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: cosmosdarwin
ms.date: 01/10/2019
ms.localizationpriority: medium
ms.openlocfilehash: e2d9e6828584f4027aa32cec26572c2290098ab6
ms.sourcegitcommit: 6f5bd789e165baf2b399033dae3eb958d16bc988
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/10/2019
ms.locfileid: "9000236"
---
# Планирование томов в локальных дисковых пространствах

> Область применения: Windows Server 2016, Windows Server 2019 г.

Эта статья содержит рекомендации по планированию томов в локальных дисковых пространствах в соответствии с потребностями рабочих нагрузок, касающимися производительности и мощности, в том числе по выбору их файловой системы, типа устойчивости и размера.

## Краткие сведения: что такое тома

Тома — это хранилища файлов для рабочих нагрузок, например VHD- или VHDX-файлов для виртуальных машин Hyper-V. Тома объединяют диски в пул носителей, чтобы вы могли воспользоваться преимуществами локальных дисковых пространств (отказоустойчивость, масштабируемость и производительность).

   >[!NOTE]
   > В документации по локальным дисковым пространствам мы используем термин "том" как суммарное обозначение тома и базового виртуального диска, а также других встроенных функций Windows, таких как общие тома кластера (CSV) и ReFS. Для успешного планирования и развертывания локальных дисковых пространств понимать эти различия необязательно.

![what-are-volumes](media/plan-volumes/what-are-volumes.png)

Все тома доступны всем серверам в кластере одновременно. После создания они отображаются в папке **C:\ClusterStorage\** на всех серверах.

![csv-folder-screenshot](media/plan-volumes/csv-folder-screenshot.png)

## Выбор количества томов

Рекомендуем использовать количество томов, кратное количеству серверов в кластере. Например при наличии четырех серверов, вам будет стабильнее с 4 всего тома, чем с 3 или 5. Это позволяет кластеру распределять "принадлежность" тома равномерно между серверами (один сервер выполняет оркестрацию метаданных для каждого тома).

Мы рекомендуем ограничить общее количество томов:

| WindowsServer2016          | WindowsServer2019          |
|------------------------------|------------------------------|
| До 32 томов на кластер | До 64 томов на кластер |

## Выбор файловой системы

Рекомендуем использовать новую файловую систему [Resilient File System (ReFS)](../refs/refs-overview.md) для локальных дисковых пространств. ReFS — это основная файловая система для виртуализации, которая обеспечивает множество преимуществ, в том числе существенное ускорение работы и встроенную защиту от повреждения данных. Он поддерживает почти все основные функции NTFS, включая дедупликации данных в Windows Server версии 1709 и более поздних версиях. Подробности см. ReFS [Таблица сравнение функций](../refs/refs-overview.md#feature-comparison) .

Если рабочей нагрузке требуется функция, которую еще не поддерживает ReFS, можете использовать NTFS.

   >[!TIP]
   > В одном кластере могут сосуществовать тома с разными файловыми системами.

## Выбор типа устойчивости

Тома в локальных дисковых пространствах обеспечивают устойчивость для защиты от сбоев дисков или серверов и постоянную доступность во время обслуживания сервера, например при обновлении программного обеспечения.

   >[!NOTE]
   > Доступные типы устойчивости не зависят от используемых типов дисков.

### С двумя серверами

Для кластеров с двумя серверами доступно только двустороннее зеркальное отображение. В этом случае хранятся две копии всех данных, по одной на каждом сервере. Экономичность хранения составляет 50%: для записи 1ТБ данных требуется не менее 2ТБ физической памяти в пуле носителей. При двустороннем зеркальном отображении допускается один сбой оборудования (диска или сервера) в один момент времени.

![two-way-mirror](media/plan-volumes/two-way-mirror.png)

Если у вас несколько серверов, рекомендуем использовать один из указанных ниже типов устойчивости.

### С тремя серверами

С тремя серверами следует использовать трехстороннее зеркальное отображение, чтобы обеспечить более высокую отказоустойчивость и производительность. В этом случае хранятся три копии всех данных, по одной копии на каждом сервере. Экономичность хранения составляет 33,3%: для записи 1ТБ данных требуется не менее 3ТБ физической памяти в пуле носителей. При трехстороннем зеркальном отображении допускаются [по крайней мере два одновременных сбоя оборудования (диска или сервера)](storage-spaces-fault-tolerance.md#examples). Если двух узлов становятся недоступными пул носителей будут потеряны кворума, так как 2/3 дисков недоступны, и виртуальных дисков будет недоступный. Тем не менее узел может быть вниз и один или несколько дисков на другой узел может завершиться с ошибкой и виртуальные диски останется в оперативном режиме. Например, если при перезагрузке одного сервера внезапно происходит сбой другого диска или сервера, все данные сохраняются и остаются доступны.

![three-way-mirror](media/plan-volumes/three-way-mirror.png)

### С четырьмя или более серверами

С четырьмя или более серверами для каждого тома можно использовать трехстороннее зеркальное отображение, двойную четность (часто называется "помехоустойчивое кодирование") или и то, и другое.

Двойная четность обеспечивает ту же отказоустойчивость, что и трехстороннее зеркальное отображение, но лучшую экономичность хранения. С четырьмя серверами экономичность хранения составляет 50,0% (для хранения 2 ТБ данных требуется 4 ТБ физической памяти в пуле носителей). Экономичность хранения увеличивается до 66,7% при использовании семи серверов и достигает 80,0%. Кодирование четности требует большего объема вычислений, что может ограничивать его производительность.

![dual-parity](media/plan-volumes/dual-parity.png)

Выбор типа устойчивости зависит от требований рабочей нагрузки. Ниже приведена таблица с, кратко описывает, какие рабочие нагрузки — это подходит для каждого типа устойчивости, а также производительности и экономичность хранения каждого типа устойчивости.

| **Тип устойчивости**| **Емкость эффективность**| **Скорость**| **Рабочие нагрузки**
|--------------------|--------------------------------|--------------------------------|--------------------------
| **Отражение (Mirror)**         | ![Отображение эффективность хранения 33%](media\plan-volumes\3-way-mirror-storage-efficiency.png)<br>Трехстороннее зеркало: 33% <br>Зеркальный two односторонние: 50%     |![Отображение производительности 100%](media\plan-volumes\three-way-mirror-perf.png)<br> Высокая производительность  | Виртуализированных рабочих нагрузок<br> Базы данных<br>Другие высокопроизводительные рабочие нагрузки |
| **Четность с зеркальным ускорением** |![Отображение около 50% экономичности хранения](media\plan-volumes\mirror-accelerated-parity-storage-efficiency.png)<br> Зависит от доля зеркалированием и контролем четности | ![Отображение около 20% производительности](media\plan-volumes\mirror-accelerated-parity-perf.png)<br>Гораздо медленнее, чем зеркальное отображение, но вверх в два раза как двойной четности<br> Лучше всего подходит для больших последовательные операции записи и чтения | Архивирование и резервного копирования<br> Инфраструктуры виртуальных рабочих столов     |
| **Двойной четности**               | ![Отображение примерно 80% экономичности хранения](media\plan-volumes\dual-parity-storage-efficiency.png)<br>четырех серверов: 50% <br>16 серверов: до 80% | ![Производительность, отображение около 10%](media\plan-volumes\dual-parity-perf.png)<br>Наибольшая задержка ввода-вывода и ЦП на операции записи<br> Лучше всего подходит для больших последовательные операции записи и чтения | Архивирование и резервного копирования<br> Инфраструктуры виртуальных рабочих столов  |

#### Когда важнее всего производительность

Рабочие нагрузки, у которых жесткие требования к задержке, а также рабочие нагрузки с большим количеством смешанных случайных операций ввода-вывода в секунду, например связанные с базами данных SQL Server или требовательными к производительности виртуальными машинами Hyper-V, необходимо запускать на томах с зеркальным отображением для повышения производительности.

   >[!TIP]
   > Зеркальное отображение работает быстрее, чем любой другой тип устойчивости. Мы используем зеркальное отображение почти для всех примеров производительности.

#### Когда важнее всего емкость

Рабочие нагрузки, которые выполняют запись редко, например связанные с хранилищами данных или автономным неструктурированным защищенным хранилищем, необходимо запускать на томах с двойной четностью для повышения экономичности хранения. Для рабочих нагрузок, связанных с традиционными файловыми серверами, инфраструктурой виртуальных рабочих столов (VDI), а также других рабочих нагрузок, которые не создают много плавающих случайных операций ввода-вывода и/или не требуют наилучшей производительности, также можно использовать двойную четность. Четность неизбежно увеличивает загрузку ЦП и задержку ввода-вывода, особенно при записи, если сравнивать ее с зеркальным отображением.

#### При массовой записи данных

Рабочие нагрузки, которые последовательно записывают большие объемы данных, например предназначенные для архивации или резервного копирования, в Windows Server 2016 можно запускать на томах, для которых используются и зеркальное отображение, и двойная четность. Записанные данные сначала оказываются в зеркально отображаемом разделе, а затем постепенно перемещаются в раздел четности. Это ускоряет прием больших объемов данных и снижает использование ресурсов при этом, так как ресурсоемкое кодирование четности может выполняться в течение более длительного времени. Объем данных, записываемых за раз (например, ежедневная резервная копия) должен свободно помещаться в раздел зеркала. Например, если 100 ГБ принимаются один раз в день, рекомендуем использовать зеркальное отображение для объема 150–200 ГБ и двойную четность для остального объема.

Итоговая экономичность хранения зависит от выбранных пропорций. Примеры см. в [этом ролике](https://www.youtube.com/watch?v=-LK2ViRGbWs&t=36m55s).

   >[!TIP]
   > Если вы заметили резким снижение производительности записи расчетного через injestion данных, это может означать, что зеркала недостаточен или что четность с зеркальным ускорением не подходит для вашей. Например если записи снижается производительность с 400 МБ/s 40 МБ/с, рассмотрите возможность расширения зеркала или переход на трехстороннее зеркало.

### О развертываниях с NVMe, SSD и HDD

В развертываниях с дисками двух типов более быстрые диски обеспечивают кэширование, а более медленные — емкость. Это происходит автоматически. Дополнительные сведения см. в статье [Общие сведения о кэше в локальных дисковых пространствах](understand-the-cache.md). В таких развертываниях все тома в конечном итоге располагаются на дисках одного типа — дисках хранения.

В развертываниях с дисками трех типов только самые быстрые диски (NVMe) обеспечивают кэширование, а другие диски (SSD и HDD) обеспечивают емкость. Вы можете выбрать, где будет располагаться каждый том: полностью на уровне SSD, полностью на уровне HDD или и там, и там.

   >[!IMPORTANT]
   > Рекомендуем использовать уровень SSD для размещения самых требовательных к производительности рабочих нагрузок в системе только с флэш-накопителями.

## Выбор размера томов

Мы рекомендуем ограничить размер каждого тома:

| WindowsServer2016 | WindowsServer2019 |
|---------------------|---------------------|
| До 32 ТБ         | До 64 ТБ         |

   >[!TIP]
   > Если для резервного копирования используется служба теневого копирования томов (VSS) и поставщик программного обеспечения Volsnap, как принято на файловом сервере, уменьшите размер тома до 10 ТБ, чтобы повысить производительность и надежность. Системы резервного копирования, которые используют новые API RCT Hyper-V, клонирование блоков ReFS или нативные API резервного копирования SQL, хорошо работают на томах размером 32 ТБ и более.

### Занимаемое место

Размер тома — это объем данных, которые могут в нем храниться. Он указывается с помощью параметра **-Size** командлета **New-Volume**, а затем отображается в свойстве **Size** при запуске командлета **Get-Volume**.

Размер отличается от *занимаемого места* тома — общего объема физической памяти, который он занимает в пуле носителей. Занимаемое место зависит от его типа устойчивости. Например, место, которое занимают тома, использующие трехстороннее зеркальное отображение, в три раза больше их размера.

В пуле носителей должно быть достаточно места для томов.

![size-versus-footprint](media/plan-volumes/size-versus-footprint.png)

### Резервирование емкости

Нераспределенное пространство в пуле носителей повышает производительность и безопасность данных, так как тома могут восстанавливаться "на месте" после сбоя дисков. Если емкости достаточно, тома могут восстановиться "на месте" до состояния полной устойчивости даже до замены отказавших дисков. Это происходит автоматически.

Рекомендуем зарезервировать эквивалент одного диска хранения на сервер (до 4 дисков). Вы можете зарезервировать больше, но эта минимальная емкость гарантирует немедленное параллельное восстановление "на месте" после сбоя любого диска.

![reserve](media/plan-volumes/reserve.png)

Например, если у вас 2 сервера и диски хранения по 1 ТБ, зарезервируйте 2 ТБ в пуле (2 x 1 = 2). Если у вас 3 сервера и диски хранения по 1 ТБ, зарезервируйте 3 ТБ (3 x 1 = 3). Если у вас 4 или больше серверов и диски хранения по 1 ТБ, зарезервируйте 4 ТБ (4 x 1 = 4).

   >[!NOTE]
   > В кластерах с дисками всех трех типов (NVMe + SSD + HDD) рекомендуем зарезервировать место, равное суммарному размеру одного SSD и одного HDD на сервер (до 4 дисков в каждом случае).

## Пример. Планирование емкости

Рассмотрим один кластер с четырьмя серверами. У каждого сервера есть кэш-диски, а также 16 дисков хранения по 2 ТБ.

```
4 servers x 16 drives each x 2 TB each = 128 TB
```

Из этих 128 ТБ в пуле носителей мы резервируем четыре диска (8 ТБ), чтобы диски после сбоя могли восстанавливаться "на месте" без какой-либо спешки. После этого в пуле остается 120 ТБ физической памяти, с помощью которой можно создать тома.

```
128 TB – (4 x 2 TB) = 120 TB
```

Предположим, нам нужно разместить в развертывании высокоактивные виртуальные машины Hyper-V, но нам также нужно хранить много старых файлов и резервных копий. Так как у нас четыре сервера, создадим четыре тома.

Поместим виртуальные машины на первые два тома (*Volume1* и *Volume2*). Мы выбираем файловую систему ReFS (для быстрого создания и контрольных точек) и трехстороннее зеркальное отображение для максимальной производительности. Поместим автономное неструктурированное защищенное хранилище на другие два тома (*Volume 3* и *Volume 4*). Мы выбираем файловую систему NTFS (для дедупликации данных) и двойную четность для максимальной емкости.

Необязательно делать все тома одного размера, но для простоты можем сделать все тома по 12 ТБ.

*Volume1* и *Volume2* займут по 36 ТБ физической памяти (12 ТБ x 33,3% экономичности = 36 ТБ).

*Volume3* и *Volume4* займут по 24 ТБ физической памяти (12 ТБ x 50,0% экономичности = 24 ТБ).

```
36 TB + 36 TB + 24 TB + 24 TB = 120 TB
```

Физической памяти, доступной в нашем пуле, как раз достаточно для четырех томов. Идеально!

![Пример](media/plan-volumes/example.png)

   >[!TIP]
   > Необязательно создавать все тома сразу. Вы всегда можете расширить или создать тома позже.

Для простоты в этом примере используются десятичные единицы (с основанием 10), то есть 1 ТБ = 1000000000000 байтов. Однако размеры хранилищ в Windows отображаются в двоичных единицах (с основанием 2). Например, диски по 2 ТБ будут отображаться в Windows как диски по 1,82 ТиБ. Для пула носителей размером 128 ТБ будет отображаться 116,41 ТиБ. Это нормально.

## Использование

См. статью [Создание томов в локальных дисковых пространствах](create-volumes.md).

### См. также

- [Обзор локальных дисковых пространств](storage-spaces-direct-overview.md)
- [Выбор дисков для локальных дисковых пространств](choosing-drives.md)
- [Отказоустойчивость и экономичность хранения](storage-spaces-fault-tolerance.md)
