---
title: Удаление серверов в локальных дисковых пространствах
ms.assetid: 9d8499a7-1307-473d-9f00-8a051164fad2
ms.prod: windows-server
ms.author: cosdar
manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: cosmosdarwin
description: Сведения о том, как удалить серверы из кластера локальных дисковых пространств в Windows Server.
ms.date: 2/5/2017
ms.localizationpriority: medium
ms.openlocfilehash: 4fa3fe64cb5d7448a7e71eb344309ecb9990ebcd
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "86960026"
---
# <a name="removing-servers-in-storage-spaces-direct"></a>Удаление серверов в локальных дисковых пространствах

>Применяется к: Windows Server 2019, Windows Server 2016

В этой статье описано, как удалить серверы в [локальных дисковых пространствах](storage-spaces-direct-overview.md) с помощью PowerShell.

## <a name="remove-a-server-but-leave-its-drives"></a>Удаление сервера без удаления дисков

Если вы планируете вскоре вернуть сервер в кластер или переместить его диски на другой сервер, вы можете удалить сервер из кластера, *не* удаляя его диски из пула носителей (вариант по умолчанию при удалении сервера с помощью диспетчера отказоустойчивости кластеров).

Используйте командлет [Remove-ClusterNode](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831694(v=ws.11)) в PowerShell:

```PowerShell
Remove-ClusterNode <Name>
```

Этот командлет выполняется быстро независимо от реализованной мощности, так как пул носителей "запоминает" недостающие диски и ожидает их возвращения. Данные с недостающих дисков не перемещаются. У параметра **OperationalStatus** для недостающих дисков будет значение "Связь утеряна", а состояние томов будет отображаться как "Неполный".

Когда диски возвращаются, они автоматически обнаруживаются и повторно связываются с пулом, даже если они находятся на новом сервере.

   >[!WARNING]
   > Не перемещайте диски с данными пула с одного сервера на несколько других серверов. Например, в случае сбоя одного сервера с десятью дисками (например, из-за сбоя системной платы или загрузочного диска) вы **можете** переместить все десять дисков на один новый сервер, но **не** перемещайте их по отдельности на разные серверы.

## <a name="remove-a-server-and-its-drives"></a>Удаление сервера и его дисков

Если вы хотите окончательно удалить сервер из кластера (это называется свертыванием), можете удалить как сам сервер из кластера, так *и* его диски из пула носителей.

Используйте командлет **Remove-ClusterNode** с необязательным флагом **-CleanUpDisks**:

```PowerShell
Remove-ClusterNode <Name> -CleanUpDisks
```

Выполнение этого командлета может длиться долго (иногда много часов), так как Windows должна переместить все данные с этого сервера на другие серверы в кластере. После выполнения этого командлета диски окончательно удаляются из пула носителей, а тома возвращаются в работоспособное состояние.

### <a name="requirements"></a>Требования

Чтобы можно было окончательно удалить сервер *и* его диски, кластер должен соответствовать двум требованиям, указанным ниже. В противном случае командлет **Remove-ClusterNode -CleanUpDisks** сразу вернет ошибку и не будет перемещать данные, чтобы не допустить дополнительных сбоев.

#### <a name="enough-capacity"></a>Достаточно памяти

Во первых, необходимо иметь достаточно места на оставшихся серверах для размещения всех томов.

Например, если у вас четыре сервера, каждый из которых состоит из 10 дисков по 1 ТБ, у вас есть 40 ТБ физической памяти. После удаления одного сервера и всех его дисков у вас останется 30 ТБ места. Если ваши тома занимают более 30 ТБ места, они не поместятся на остающихся серверах, поэтому командлет вернет ошибку и не будет перемещать данные.

#### <a name="enough-fault-domains"></a>Достаточно доменов сбоя

Во-вторых, у вас должно быть достаточно доменов сбоя (как правило, серверов) для обеспечения устойчивости томов.

Например, если тома используют трехстороннее зеркальное отображение на уровне сервера, для обеспечения их полной работоспособности необходимо по крайней мере три сервера. Если попытаетесь удалить один из трех серверов и все его диски, командлет вернет ошибку и не будет перемещать данные.

В этой таблице показано минимальное количество доменов сбоя, необходимых для каждого типа устойчивости.

|    Устойчивость          |    Минимальное количество доменов сбоя   |
|------------------------|-------------------------------------|
|    Двухстороннее зеркало      |    2                                |
|    Трехстороннее зеркало    |    3                                |
|    Двойная четность         |    4                                |

   >[!NOTE]
   > Ничего страшного, если в течение короткого периода у вас будет меньше серверов (например, во время сбоев или обслуживания). Но чтобы тома вернулись в полностью работоспособное состояние, необходимо минимальное количество серверов, указанное выше.

## <a name="additional-references"></a>Дополнительные ссылки

- [Обзор Локальные дисковые пространства](storage-spaces-direct-overview.md)
