---
title: Развертывание локальных дисковых пространств
ms.prod: windows-server-threshold
manager: eldenc
ms.author: stevenek
ms.technology: storage-spaces
ms.topic: get-started-article
ms.assetid: 20fee213-8ba5-4cd3-87a6-e77359e82bc0
author: stevenek
ms.date: 8/16/2018
description: Пошаговые инструкции для развертывания программно определяемого хранилища с помощью локальных дисковых пространств в Windows Server в качестве гиперконвергентной инфраструктурой или стойке инфраструктуры (также известной как подразделяется).
ms.localizationpriority: medium
ms.openlocfilehash: 55cfa0e066506d7174f9e5b1e61cc0aa290706d7
ms.sourcegitcommit: 65e4f760be73104e67847f77e834e7b5e065211b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2018
ms.locfileid: "5429046"
---
# Развертывание локальных дисковых пространств

> Область применения: Windows Server 2016, Windows Server 2019 г.

Этот раздел содержит пошаговые инструкции для развертывания [Локальных дисковых пространств](storage-spaces-direct-overview.md).

> [!Tip]
> Необходимо приобрести инфраструктуры гиперконвергированном? Корпорация Майкрософт рекомендует эти решения [Windows Server Software-Defined](https://microsoft.com/wssd) от наших партнеров. Они разработаны, собраны и проверяется наших Эталонная архитектура для обеспечения совместимости и надежности, чтобы получить и быстро.

> [!Tip]
> Можно использовать виртуальные машины Hyper-V, включая в Microsoft Azure, чтобы [оценить локальные дисковые пространства без оборудования](storage-spaces-direct-in-vm.md). Можно также просмотреть удобных [сценарии развертывания быстрое лаборатории Windows Server](https://aka.ms/wslab), используется в целях обучения.

## Перед началом работы

Обзор [локальных дисковых пространств требования к оборудованию](Storage-Spaces-Direct-Hardware-Requirements.md) и просмотреть этот документ, чтобы ознакомиться с общим и важных примечаний, связанных с некоторыми действиями.

Соберите следующую информацию:

- **Вариант развертывания.** Локальные дисковые пространства поддерживает [два варианта развертывания: гиперконвергентной и гиперконвергентном](storage-spaces-direct-overview.md#deployment-options), также известной как подразделяется. Ознакомьтесь с преимущества каждого решить, какие именно вам. Шаги 1 – 3 ниже применяются к оба варианта развертывания. Шаг 4 только необходимые для развертывании.

- **Имена серверов.** Познакомьтесь с политиками именования вашей организации для компьютеров, файлов, путей и другие ресурсы. Вам потребуется подготовить несколько серверов, каждый из которых уникальные имена.

- **Имя домена.** Познакомьтесь с политиками вашей организации для доменных имен и присоединение к домену.  Вы будете присоединять серверов к домену, и вам потребуется указать имя домена. 

- **Сети RDMA.** Существует два типа протоколов RDMA: iWarp и RoCE. Обратите внимание, какие из них использование сетевых адаптеров, и если RoCE, также Примечание версии (v1 или v2). RoCE также Обратите внимание, модель коммутатора верхнего элемента.

- **ИДЕНТИФИКАТОР ВИРТУАЛЬНОЙ ЛОКАЛЬНОЙ СЕТИ.** Обратите внимание идентификатор VLAN для сетевых адаптеров управления операционной системы на серверах, если таковые имеются. Его можно получить у администратора сети.

## Шаг1. Развертывание Windows Server

### Шаг 1.1: Установка операционной системы

Первым шагом является установка Windows Server на каждом сервере, который находится в кластере. Локальные дисковые пространства требуется Windows Server 2016 Datacenter Edition. Можно использовать вариант установки Server Core или сервера с возможностями рабочего стола.

При установке Windows Server с помощью мастера установки можно выбрать между *Windows Server* (со ссылкой на Server Core) и *Windows Server (сервер с рабочим столом)*, что эквивалентно *Полный* вариант установки доступно в Windows Server 2012 R2. Если вы не выбрали, вы получите вариант установки Server Core. Дополнительные сведения см. в разделе [варианты установки для Windows Server 2016](../../get-started/Windows-Server-2016.md).

### Шаг 1.2: Подключаться к серверам

В этом руководстве рассматриваются вариант установки Server Core и развертывание и управление удаленно из системы отдельный управления, который должен иметь:

- Windows Server 2016 с теми же обновлениями, которым он управляет
- Сетевое подключение к управляемым серверам
- Присоединен к тому же или полностью доверенному домену
- На нем должны быть установлены средства удаленного администрирования сервера (RSAT) и модули PowerShell для Hyper-V и отказоустойчивой кластеризации. Средства RSAT и модули PowerShell доступны в Windows Server и могут быть установлены без устанавливая другие компоненты. Также можно установить [Средства удаленного администрирования сервера](https://www.microsoft.com/download/details.aspx?id=45520) в Windows 10 управления ПК.

В системе управления установите отказоустойчивый кластер и средства управления Hyper-V. Это можно сделать в диспетчере сервера с помощью мастера **добавления ролей и компонентов**. На странице **Компоненты** щелкните **Средства удаленного администрирования сервера** и выберите средства, которые требуется установить.

Войдите в сеанс PowerShell и используйте имя сервера или IP-адрес узла, к которому хотите подключиться. Вам будет предложено ввести пароль после выполнения этой команды, введите пароль администратора, указанного при настройке Windows.

   ```PowerShell
   Enter-PSSession -ComputerName <myComputerName> -Credential LocalHost\Administrator
   ```

   Вот пример таким же способом, который лучше подходит для сценариев, на случай, если вам необходимо сделать несколько раз.

   ```PowerShell
   $myServer1 = "myServer-1"
   $user = "$myServer1\Administrator"

   Enter-PSSession -ComputerName $myServer1 -Credential $user
   ```

> [!TIP]
> Если вы развертываете удаленно из системы управления, может возникнуть ошибка как *WinRM не может обработать запрос.* Чтобы устранить эту проблему, используйте Windows PowerShell для добавления каждый сервер в список доверенных узлов на ваш компьютер управления:  
>   
> `Set-Item WSMAN:\Localhost\Client\TrustedHosts -Value Server01 -Force`
>  
> Примечание: в список доверенных узлов поддерживает подстановочные знаки, например `Server*`.
>
> Чтобы просмотреть список доверенных узлов, введите `Get-Item WSMAN:\Localhost\Client\TrustedHosts`.  
>   
> Чтобы очистить список, введите `Clear-Item WSMAN:\Localhost\Client\TrustedHost`.  

### Шаг 1.3: Присоединиться к домену и добавление учетных записей домена

На данный момент настройки отдельных серверов с помощью учетной записи локального администратора, `<ComputerName>\Administrator`.

Для управления локальными дисковыми пространствами, необходимо присоединиться к серверам к домену и использовать учетную запись домена доменных служб Active Directory, входящую в группу администраторов на каждом сервере.

Из системы управления откройте консоль PowerShell с правами администратора. Используйте `Enter-PSSession` подключиться к каждому серверу и выполните следующий командлет, указав имя компьютера, имя домена и учетных данных домена:

```PowerShell  
Add-Computer -NewName "Server01" -DomainName "contoso.com" -Credential "CONTOSO\User" -Restart -Force  
```

Если учетная запись администратора хранилища не является членом группы администраторов домена, добавить учетную запись администратора хранилища в группу локальных администраторов на каждом узле - или еще лучше, добавьте группу, которую вы используете для локальных администраторов. Можно использовать следующую команду (или написать функцию Windows PowerShell для этого — Дополнительные сведения см. в разделе [Использовать PowerShell, чтобы добавить пользователей домена к локальной группы](http://blogs.technet.com/b/heyscriptingguy/archive/2010/08/19/use-powershell-to-add-domain-users-to-a-local-group.aspx) ):

```
Net localgroup Administrators <Domain\Account> /add
```

### Шаг 1.4: Установка ролей и компонентов

Следующим шагом является установка ролей сервера на каждом сервере. Можно сделать с помощью [Windows Admin Center](../../manage/windows-admin-center/use/manage-servers.md), [Диспетчер серверов](../../administration/server-manager/install-or-uninstall-roles-role-services-or-features.md)), или PowerShell. Ниже приведены ролей, которые необходимо установить.

- Отказоустойчивая кластеризация
- Hyper-V
- Файловый сервер (Если вы хотите разместить все файловые ресурсы, например прогноз стойке развертывания)
- Мост для центра обработки данных (если вы используете RoCEv2 вместо сетевых адаптеров iWARP)
- PowerShell для кластеризации RSAT
- PowerShell для Hyper-V

Чтобы установить его через PowerShell, используйте командлет [Install-WindowsFeature](https://docs.microsoft.com/powershell/module/microsoft.windows.servermanager.migration/install-windowsfeature) . Его можно использовать на одном сервере следующим образом:

```PowerShell
Install-WindowsFeature -Name "Hyper-V", "Failover-Clustering", "Data-Center-Bridging", "RSAT-Clustering-PowerShell", "Hyper-V-PowerShell", "FS-FileServer"
```

Чтобы выполнить команду на всех серверах в кластере, как и то же время, используйте этой небольшой сценарий, изменения в список переменных в начале сценария для конкретной среды.

```PowerShell
# Fill in these variables with your values
$ServerList = "Server01", "Server02", "Server03", "Server04"
$FeatureList = "Hyper-V", "Failover-Clustering", "Data-Center-Bridging", "RSAT-Clustering-PowerShell", "Hyper-V-PowerShell", "FS-FileServer"

# This part runs the Install-WindowsFeature cmdlet on all servers in $ServerList, passing the list of features into the scriptblock with the "Using" scope modifier so you don't have to hard-code them here.
Invoke-Command ($ServerList) {
    Install-WindowsFeature -Name $Using:Featurelist
}
```

## Шаг2. Настройка сети

Если вы развертываете локальные дисковые пространства виртуальных машинах, пропустите этот раздел.

Локальные дисковые пространства требует высокой пропускной способностью, сеть между серверами в кластере низкой задержкой. Требуется по крайней мере 10 сетевые компоненты Gigabit Ethernet и удаленного прямого доступа к памяти (RDMA) рекомендуется. При условии наличия логотипа Windows Server 2016, но iWARP обычно проще, Настройка, можно использовать iWARP или RoCE.

> [!Important]
> В зависимости от сетевого оборудования и особенно с RoCE v2, некоторые коммутатора верхнего может потребоваться выполнить настройку. Конфигурация правильный коммутатора важен для обеспечения надежности и производительности локальных дисковых пространств.

Windows Server 2016 появилась внедренных коммутаторов (SET) в виртуальный коммутатор Hyper-V. Это позволяет использовать для весь сетевой трафик при использовании RDMA, уменьшая количество физических портов сетевой КАРТЫ, которые требуется же физические порты сетевых КАРТ. Объединение внедренных коммутаторов рекомендуется для локальных дисковых пространств.

Инструкции для настройки сети для локальных дисковых пространств см. в разделе [Сетевых Гиперконвергентном Windows Server 2016 и руководства по развертыванию гостевой RDMA](https://github.com/Microsoft/SDN/blob/master/Diagnostics/S2D%20WS2016_ConvergedNIC_Configuration.docx).

## Шаг3. Настройка локальных дисковых пространств

Следующие действия выполняются в системе управления, версия которой совпадает с версией настраиваемых серверов. Указанные ниже действия следует не будет выполнять удаленно с помощью сеанса PowerShell, но вместо этого выполните их в локальном сеансе PowerShell в системе управления с правами администратора.

### Шаг 3.1: Чистой дисков

Прежде чем разрешить локальных дисковых пространств, для обеспечения дисков пустой: без старый разделов или других данных. Выполните следующий сценарий, заменив имена компьютеров, чтобы удалить все старые разделы или других данных.

> [!Warning]
> Этот сценарий окончательно удалит все данные на дисках, отличных от загрузочного диска операционной системы!

```PowerShell
# Fill in these variables with your values
$ServerList = "Server01", "Server02", "Server03", "Server04"

Invoke-Command ($ServerList) {
    Update-StorageProviderCache
    Get-StoragePool | ? IsPrimordial -eq $false | Set-StoragePool -IsReadOnly:$false -ErrorAction SilentlyContinue
    Get-StoragePool | ? IsPrimordial -eq $false | Get-VirtualDisk | Remove-VirtualDisk -Confirm:$false -ErrorAction SilentlyContinue
    Get-StoragePool | ? IsPrimordial -eq $false | Remove-StoragePool -Confirm:$false -ErrorAction SilentlyContinue
    Get-PhysicalDisk | Reset-PhysicalDisk -ErrorAction SilentlyContinue
    Get-Disk | ? Number -ne $null | ? IsBoot -ne $true | ? IsSystem -ne $true | ? PartitionStyle -ne RAW | % {
        $_ | Set-Disk -isoffline:$false
        $_ | Set-Disk -isreadonly:$false
        $_ | Clear-Disk -RemoveData -RemoveOEM -Confirm:$false
        $_ | Set-Disk -isreadonly:$true
        $_ | Set-Disk -isoffline:$true
    }
    Get-Disk | Where Number -Ne $Null | Where IsBoot -Ne $True | Where IsSystem -Ne $True | Where PartitionStyle -Eq RAW | Group -NoElement -Property FriendlyName
} | Sort -Property PsComputerName, Count
```

Результат будет выглядеть следующим образом, где **число** — это число дисков каждой модели на каждом сервере:

```
Count Name                          PSComputerName
----- ----                          --------------
4     ATA SSDSC2BA800G4n            Server01
10    ATA ST4000NM0033              Server01
4     ATA SSDSC2BA800G4n            Server02
10    ATA ST4000NM0033              Server02
4     ATA SSDSC2BA800G4n            Server03
10    ATA ST4000NM0033              Server03
4     ATA SSDSC2BA800G4n            Server04
10    ATA ST4000NM0033              Server04
```

### Шаг 3.2: Проверка кластера

На этом этапе необходимо запустить средство проверки кластеров, чтобы убедиться в правильности настройки узлов сервера для создания кластера с использованием локальных дисковых пространств. Когда кластера проверки (`Test-Cluster`) — это запустить до его создания, будут выполняться тесты, проверяющие, подходит для успешной работы отказоустойчивого кластера, конфигурации. В примере ниже используется `-Include` параметра, за которым следуют определенные категории тестов. Таким образом, в проверку будут включены тесты локальных дисковых пространств.

Используйте следующую команду PowerShell, чтобы проверить набор серверов для использования в качестве кластера локальных дисковых пространств.

```PowerShell
Test-Cluster –Node <MachineName1, MachineName2, MachineName3, MachineName4> –Include "Storage Spaces Direct", "Inventory", "Network", "System Configuration"
```

### Шаг 3.3: Создание кластера

На этом шаге вы создадите кластер с узлами, специально проверенными на предыдущем шаге, с помощью следующего командлета PowerShell.

При создании кластера отобразится предупреждение с текстом: «произошли во время создания кластерные роли, который может предотвратить запуск. Для получения подробной информации просмотрите файл отчета ниже". Это предупреждение можно игнорировать. Оно появляется из-за того, что нет доступных дисков для кворума кластера. Рекомендуется настраивать файловый ресурс-свидетель или облако-свидетель после создания кластера.

> [!Note]
> Если для серверов используются статические IP-адреса, измените приведенную ниже команду, чтобы отразить статический IP-адрес. Для этого добавьте следующий параметр и укажите IP-адрес: –StaticAddress &lt;X.X.X.X&gt;.
> В следующей команде заполнитель ClusterName необходимо заменить на уникальное имя NetBIOS длиной до 15символов.
> ```PowerShell
> New-Cluster –Name <ClusterName> –Node <MachineName1,MachineName2,MachineName3,MachineName4> –NoStorage
> ```

После создания кластера репликация записи DNS для имени кластера может занять некоторое время. Продолжительность времени зависит от среды и конфигурации репликации DNS. Если разрешение кластера не удалось выполнить, в большинстве случаев вместо имени кластера можно использовать имя компьютера узла, который является активным участником кластера.

### Шаг 3.4: Настройка следящего кластера

Рекомендуется настроить свидетель для кластера, поэтому кластеров с трех и более серверов могут выдерживать двух серверов или их переход в автономном режиме. Развертывание двумя серверами требует следящего кластера, в противном случае вызывает любого сервера, переход в автономный режим другой также становится недоступным. В этих системах в качестве свидетеля можно использовать файловый ресурс или облако-свидетель. 

См. также следующие разделы:

- [Настройка кворума и управление им](../../failover-clustering/manage-cluster-quorum.md)
- [Развертывание облака-свидетеля для отказоустойчивого кластера](../../failover-clustering/deploy-cloud-witness.md)

### Шаг3.5. Включение локальных дисковых пространств

После создания кластера используйте `Enable-ClusterStorageSpacesDirect` командлета PowerShell, это поместить систему хранения в режим локальных дисковых пространств и автоматически сделает следующее:

-   **Создаст пул:** создаст один большой пул с именем, похожим на "S2D на Cluster1".

-   **Настроит кэши локальных дисковых пространств:** если для использования локальными дисковыми пространствами доступно более одного типа носителя (диска), он задает самые быстрые из них в качестве устройств кэша (в большинстве случаев для чтения и записи).

-   **Уровни:** Создает двумя уровнями в качестве уровней по умолчанию. Один из них называется "Емкость", а другой— "Производительность". Командлет анализирует устройства и настраивает каждый уровень на основе типов устройств и устойчивости.

Из системы управления откройте командное окно PowerShell с правами администратора и запустите следующую команду. Нужно указать имя кластера, созданного при выполнении предыдущих действий. Если эта команда выполняется локально на одном из узлов, параметр -CimSession не требуется.

```PowerShell
Enable-ClusterStorageSpacesDirect –CimSession <ClusterName>
```

Чтобы включить локальные дисковые пространства с помощью указанной выше команды, вместо имени кластера можно использовать имя узла. Это может быть более надежным, так как при использовании имени только что созданного кластера могут возникнуть задержки репликации DNS.

После выполнения этой команды, которое может занять несколько минут, система будет готова для создания томов.

### Шаг3.6. Создание томов

Мы рекомендуем использовать `New-Volume` командлет как он предоставляет самый простой и быстрый способ. Этот командлет автоматически создает виртуальный диск, разбивает и форматирует его, создает том с соответствующим именем и добавляет его в общие тома кластера — и все это за один шаг.

Подробнее см. в разделе [Создание томов в локальных дисковых пространствах](create-volumes.md).

### Шаг 3.7: При необходимости Включение кэша CSV-файла

При необходимости можно включить кэш кластера Общие тома (CSV) для использования системной памяти (ОЗУ) в качестве сквозной уровне блоков кэш операций чтения, которые еще не кэшируются диспетчером кэша Windows. Это может повысить производительность для приложений, таких как Hyper-V. Кэш CSV может повысить производительность запросов на чтение, а также используется для сценариев масштабируемого файлового сервера.

Включение кэша CSV уменьшает объем памяти, доступной для запуска виртуальных машин на гиперконвергентного кластера, поэтому вам необходимо найти правильный баланс между производительность устройств хранения данных в памяти, доступной для виртуальных жестких дисков.

Чтобы задать размер кэша CSV-файла, откройте сеанс PowerShell в системе управления с учетной записью с разрешениями администратора в кластере хранилища и затем использовать этот сценарий, изменяя `$ClusterName` и `$CSVCacheSize` переменные соответствующим образом (в данном примере устанавливается 2 ГБ CSV кэш на сервер):

```PowerShell
$ClusterName = "StorageSpacesDirect1"
$CSVCacheSize = 2048 #Size in MB

Write-Output "Setting the CSV cache..."
(Get-Cluster $ClusterName).BlockCacheSize = $CSVCacheSize

$CSVCurrentCacheSize = (Get-Cluster $ClusterName).BlockCacheSize
Write-Output "$ClusterName CSV cache size: $CSVCurrentCacheSize MB"
```

Дополнительные сведения см. в разделе [с помощью CSV-файла в памяти кэш чтения](csv-cache.md).

### Шаг 3.8: Развертывание виртуальных машин для гиперконвергентных развертываний

Если вы развертываете гиперконвергентного кластера, последним шагом является подготовить виртуальные машины в кластере локальных дисковых пространств.

Файлы виртуальных машин необходимо хранить в пространстве имен CSV систем (например, C:\\ClusterStorage\\Volume1) так же, как и кластерные виртуальные машины в отказоустойчивом кластере.

Можно использовать встроенных или других средств управления хранилища и виртуальных машин, таких как диспетчер виртуальных машин System Center.

## Шаг 4: Развертывание масштабируемого файлового сервера стойке решения

Если вы развертываете стойке решение, следующий шаг — создать экземпляр масштабируемого файлового сервера и настройки некоторые файловые ресурсы. Если вы развертываете гиперконвергентного кластера - закончите и не требуется этого раздела.

### Шаг 4.1: Создание роль масштабируемого файлового сервера

Следующий шаг в настройке службы кластера для файлового сервера является создание кластеризованных роль файлового сервера, являющийся при создании экземпляра масштабируемого файлового сервера, на котором размещены вашего непрерывной доступности файловых ресурсов общего доступа.

#### Чтобы создать роль масштабируемого файлового сервера с помощью диспетчера сервера

1.  В диспетчере отказоустойчивости кластеров выберите кластер, перейдите к **роли**и нажмите кнопку **Настройка роли**.<br>Откроется мастер высокой доступности.
2.  На странице **Выберите роли** щелкните **Файлового сервера**.
3.  На странице **Файла тип сервера** щелкните **Масштабируемого файлового сервера для данных приложения**.
4.  На странице **Точки доступа клиента** введите имя для масштабируемого файлового сервера.
5.  Убедитесь, что роль успешной настройки, перейдя к **ролям** и подтверждения того, что в столбце **состояние** отображается **под управлением** рядом с роли кластерного файлового сервера вы создали, как показано на рисунке 1.

    ![Снимок экрана диспетчера отказоустойчивости кластеров, в отображение масштабируемого файлового сервера](media\Hyper-converged-solution-using-Storage-Spaces-Direct-in-Windows-Server-2016\SOFS_in_FCM.png "Failover Cluster Manager showing the Scale-Out File Server")

     **Рисунок 1** Отображение масштабируемого файлового сервера с помощью состояния выполнения диспетчера отказоустойчивости кластеров

> [!NOTE]
>  После создания кластерные роли, может существовать какой-либо сети распространения задержки, которые может предотвратить создание общих файловых ресурсов на нем несколько минут или потенциально больше времени.  
  
#### Чтобы создать роль масштабируемого файлового сервера с помощью Windows PowerShell

 В сеансе Windows PowerShell, подключенном к кластер файловых серверов, введите следующие команды, чтобы создать роль масштабируемого файлового сервера, изменение *FSCLUSTER* должно соответствовать имени кластера и *SOFS* должно соответствовать имени вы хотите предоставить Роль масштабируемого файлового сервера:

```PowerShell
Add-ClusterScaleOutFileServerRole -Name SOFS -Cluster FSCLUSTER
```

> [!NOTE]
>  После создания кластерные роли, может существовать какой-либо сети распространения задержки, которые может предотвратить создание общих файловых ресурсов на нем несколько минут или потенциально больше времени. Если роль SOFS сразу же происходит сбой и не запускается, он, возможно, объект компьютера кластера нет разрешения, чтобы создать учетную запись компьютера для роли SOFS. Для упрощения этого, см. в этой записи блога: [масштабируемого файл сервера роль сбоя в меню "Пуск" With событие идентификаторы 1205, 1069 и 1194](http://www.aidanfinn.com/?p=14142).

### . 4.2 шаг файловые ресурсы

После создания виртуальных дисков и их добавлении CSV, пришло время создать файловые ресурсы для них — один файловый ресурс в CSV-файла каждого виртуального диска. Диспетчер виртуальных машин System Center (VMM) — это, скорее всего, handiest способ сделать это, так как он обрабатывает разрешения для вас, но если у вас нет его в вашей среде, можно использовать Windows PowerShell для частично автоматизировать развертывание.

Используйте сценарии, включенные в сценарий [Настройки общей папки SMB для рабочих нагрузок Hyper-V](http://gallery.technet.microsoft.com/SMB-Share-Configuration-4a36272a) , который частично автоматизирует процесс создания групп и общих ресурсов. Он предназначен для рабочих нагрузок Hyper-V, поэтому если вы развертываете других рабочих нагрузок, может потребоваться изменить параметры или выполнить дополнительные действия, после создания общих ресурсов. Например если вы используете Microsoft SQL Server, учетной записи службы SQL Server должен предоставить полный контроль общего ресурса и в файловой системе.

> [!NOTE]
>  Необходимо обновить членство в группе при добавлении узлов кластера, если вы не используете диспетчера виртуальных машин System Center для создания вашего общих ресурсов.

Для создания общих ресурсов с помощью сценариев PowerShell, выполните следующие действия.

1. Скачайте сценарии, включенные в [Конфигурации общей папки SMB для рабочих нагрузок Hyper-V](http://gallery.technet.microsoft.com/SMB-Share-Configuration-4a36272a) для одного из узлов кластер файловых серверов.
2. Откройте сеанс Windows PowerShell с учетными данными администратора домена в системе управления и затем использовать следующий сценарий для создания группы Active Directory объекты компьютера Hyper-V, изменяя значения для переменных в зависимости от вашей Среда:

    ```PowerShell
    # Replace the values of these variables
    $HyperVClusterName = "Compute01"
    $HyperVObjectADGroupSamName = "Hyper-VServerComputerAccounts" <#No spaces#>
    $ScriptFolder = "C:\Scripts\SetupSMBSharesWithHyperV"

    # Start of script itself
    CD $ScriptFolder
    .\ADGroupSetup.ps1 -HyperVObjectADGroupSamName $HyperVObjectADGroupSamName -HyperVClusterName $HyperVClusterName
    ```
3. Откройте сеанс Windows PowerShell с учетными данными администратора на одном из узлов хранилища и затем используйте следующий сценарий для создания общих ресурсов для каждого CSV и предоставить права администратора для общих папок для группы администраторов домена и вычислительный кластер.

    ```PowerShell
    # Replace the values of these variables
    $StorageClusterName = "StorageSpacesDirect1"
    $HyperVObjectADGroupSamName = "Hyper-VServerComputerAccounts" <#No spaces#>
    $SOFSName = "SOFS"
    $SharePrefix = "Share"
    $ScriptFolder = "C:\Scripts\SetupSMBSharesWithHyperV"

    # Start of the script itself
    CD $ScriptFolder
    Get-ClusterSharedVolume -Cluster $StorageClusterName | ForEach-Object
    {
        $ShareName = $SharePrefix + $_.SharedVolumeInfo.friendlyvolumename.trimstart("C:\ClusterStorage\Volume")
        Write-host "Creating share $ShareName on "$_.name "on Volume: " $_.SharedVolumeInfo.friendlyvolumename
        .\FileShareSetup.ps1 -HyperVClusterName $StorageClusterName -CSVVolumeNumber $_.SharedVolumeInfo.friendlyvolumename.trimstart("C:\ClusterStorage\Volume") -ScaleOutFSName $SOFSName -ShareName $ShareName -HyperVObjectADGroupSamName $HyperVObjectADGroupSamName
    }
    ```

### Ограниченное делегирование Kerberos включить шаг 4.3

Для настройки ограниченное делегирование Kerberos для управления удаленного сценария и повышенную безопасность динамической миграции, один из узлов кластера хранилища, используйте сценарий KCDSetup.ps1 в [Конфигурации общей папки SMB для рабочих нагрузок Hyper-V](http://gallery.technet.microsoft.com/SMB-Share-Configuration-4a36272a). Вот небольшой оболочкой для сценария.

```PowerShell
$HyperVClusterName = "Compute01"
$ScaleOutFSName = "SOFS"
$ScriptFolder = "C:\Scripts\SetupSMBSharesWithHyperV"

CD $ScriptFolder
.\KCDSetup.ps1 -HyperVClusterName $HyperVClusterName -ScaleOutFSName $ScaleOutFSName -EnableLM
```

## Дальнейшие действия

После развертывания кластерного файлового сервера, рекомендуется тестирование производительности решения с помощью искусственных рабочих нагрузок до вызове любого реальных рабочих нагрузок. Это позволяет убедиться, что выполняет решения и разработать возникнут проблемы с устаревших перед добавлением сложность рабочих нагрузок. Дополнительные сведения см. в разделе [Тестирование локальных дисковых пространств производительности с помощью искусственных рабочих нагрузок](https://technet.microsoft.com/library/dn894707.aspx).

## См. также

-   [Локальные дисковые пространства в Windows Server2016](storage-spaces-direct-overview.md)
-   [Общие сведения о кэше локальных дисковых пространств](understand-the-cache.md)
-   [Планирование томов в локальных дисковых пространствах](plan-volumes.md)
-   [Отказоустойчивость дисковых пространств](storage-spaces-fault-tolerance.md)
-   [Требования к оборудованию для локальных дисковых пространств](Storage-Spaces-Direct-Hardware-Requirements.md)
-   [В RDMA или не в RDMA — вот в чем вопрос](https://blogs.technet.microsoft.com/filecab/2017/03/27/to-rdma-or-not-to-rdma-that-is-the-question/) (блог TechNet)
