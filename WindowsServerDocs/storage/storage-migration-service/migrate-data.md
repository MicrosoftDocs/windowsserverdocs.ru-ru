---
title: Перенос файлового сервера с помощью службы миграции хранилища
description: Краткое описание раздела, посвященного результатам поисковой системы
author: jasongerend
ms.author: jgerend
manager: elizapo
ms.date: 02/13/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: 7cec2a9c805208baceff8a8afe22a20fd2859edd
ms.sourcegitcommit: e2b565ce85a97c0c51f6dfe7041f875a265b35dd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2019
ms.locfileid: "69584839"
---
# <a name="use-storage-migration-service-to-migrate-a-server"></a>Использование службы миграции хранилища для миграции сервера

В этом разделе рассматривается миграция сервера, включая его файлы и конфигурацию, на другой сервер с помощью [службы миграции хранилища](overview.md) и центра администрирования Windows. Миграция занимает три шага после установки службы и открытия всех необходимых портов брандмауэра: Инвентаризация серверов, перенос данных и перерезание на новые серверы.

## <a name="step-0-install-storage-migration-service-and-check-firewall-ports"></a>Шаг 0. Установка службы миграции хранилища и проверка портов брандмауэра

Прежде чем приступить к работе, установите службу миграции хранилища и убедитесь, что нужные порты брандмауэра открыты.

1. Проверьте [требования к службе миграции хранилища](overview.md#requirements) и установите [центр администрирования Windows](../../manage/windows-admin-center/understand/windows-admin-center.md) на компьютере или сервере управления, если вы этого еще не сделали.
2. В центре администрирования Windows подключитесь к серверу Orchestrator под Windows Server 2019. <br>Это сервер, на котором вы устанавливаете службу миграции хранилища на и используете для управления миграцией. Если выполняется миграция только одного сервера, можно использовать целевой сервер, если он работает под Windows Server 2019. Для миграции с несколькими серверами рекомендуется использовать отдельный сервер оркестрации.
1. Перейдите в **Диспетчер сервера** (в центре администрирования Windows) > **Служба миграции хранилища** и выберите **установить** , чтобы установить службу миграции хранилища и ее обязательные компоненты (показаны на рис. 1).
    ![Снимок экрана со страницей "Служба миграции хранилища",](media/migrate/install.png) на которой отображается кнопка "установить" **рис. 1. Установка службы миграции хранилища**
1. Установите прокси-сервер службы миграции хранилища на всех целевых серверах под Windows Server 2019. Это удваивает скорость передачи при установке на целевых серверах. <br>Для этого подключитесь к целевому серверу в центре администрирования Windows, а затем перейдите в **Диспетчер сервера** (в центре администрирования windows) > **роли и компоненты**, выберите **прокси-служба миграции хранилища**и нажмите кнопку **установить**.
1. На всех исходных серверах и на всех целевых серверах под Windows Server 2012 R2 или Windows Server 2016 в центре администрирования Windows подключитесь к каждому серверу, перейдите в **Диспетчер сервера** (в центре администрирования windows) > брандмауэре.  >   **Правила для входящих**сообщений, а затем проверьте, включены ли следующие правила:
    - Общий доступ к файлам и принтерам (входящий трафик SMB)
    - Служба Netlogon (NP-in)
    - Инструментарий управления Windows (WMI) (DCOM-in)
    - Инструментарий управления Windows (WMI-In)

   > [!NOTE]
   > Если вы используете брандмауэры сторонних производителей, диапазоны входящих портов для открытия — это TCP/445 (SMB), TCP/135 (сопоставитель конечной точки RPC/DCOM) и TCP 1025-65535 (временные порты RPC/DCOM). Порты службы миграции хранилища — это TCP/28940 (Orchestrator) и TCP/28941 (прокси).

1. Если вы используете сервер Orchestrator для управления миграцией и хотите скачать события или журнал передаваемых данных, убедитесь, что на этом сервере включено правило брандмауэра для общего доступа к файлам и принтерам (SMB-in).

## <a name="step-1-create-a-job-and-inventory-your-servers-to-figure-out-what-to-migrate"></a>Шаг 1. Создайте задание и выполните инвентаризацию серверов, чтобы определить, что нужно перенести.

На этом шаге вы укажете, какие серверы нужно перенести, а затем проверите их, чтобы получить сведения о своих файлах и конфигурациях.

1. Выберите **создать задание**, укажите имя задания и нажмите кнопку **ОК**.
1. На странице **Ввод учетных данных** введите учетные данные администратора, которые работают на серверах, с которых требуется выполнить миграцию, а затем нажмите кнопку **Далее**.
1. Выберите **Добавить устройство**, введите имя исходного сервера и нажмите кнопку **ОК**. <br>Повторите эти действия для всех серверов, для которых требуется выполнить инвентаризацию.
1. Выберите **начать сканирование**.<br>Страница обновляется для отображения после завершения проверки.
    ![Снимок экрана, показывающий сервер,](media/migrate/inventory.png) готовый к сканированию **рис. 2: Инвентаризация серверов**
1. Выберите каждый сервер, чтобы проверить общие папки, конфигурацию, сетевые адаптеры и тома, которые были внесены в опись. <br><br>Служба миграции хранилища не переносит файлы или папки, которые могут мешать работе Windows, поэтому в этом выпуске будут отображаться предупреждения для всех общих папок, расположенных в системной папке Windows. Эти общие ресурсы необходимо пропустить на этапе перемещения. Дополнительные сведения см. [в разделе какие файлы и папки исключаются из передачи](faq.md#what-files-and-folders-are-excluded-from-transfers).
1. Нажмите кнопку **Далее** , чтобы перейти к передаче данных.

## <a name="step-2-transfer-data-from-your-old-servers-to-the-destination-servers"></a>Шаг 2. Перенос данных со старых серверов на целевые серверы

На этом шаге вы перенесите данные после указания места размещения на целевых серверах.

1. На странице **Перемещение данных** > **введите учетные** данные введите учетные данные администратора, которые работают на целевых серверах, на которые требуется выполнить миграцию, а затем нажмите кнопку **Далее**.
2. На странице **Добавление целевого устройства и** сопоставлений отображается первый исходный сервер. Введите имя сервера, на который требуется выполнить миграцию, а затем выберите **сканировать устройство**.
3. Сопоставьте исходные тома с томами назначения, снимите флажок **включить** для всех общих ресурсов, которые вы не хотите передавать (включая все административные общие папки, расположенные в системной папке Windows), а затем нажмите кнопку **Далее**.
   ![Снимок экрана, показывающий исходный сервер и его тома и общие папки, а также место, куда](media/migrate/transfer.png) они будут переданы на целевом **рисунке 3: Исходный сервер и место, куда будет передаваться хранилище**
4. Добавьте целевой сервер и сопоставления для дополнительных исходных серверов, а затем нажмите кнопку **Далее**.
5. При необходимости настройте параметры перемещения, а затем нажмите кнопку **Далее**.
6. Выберите **проверить** , а затем нажмите кнопку **Далее**.
7. Выберите **начать перемещение** , чтобы начать передачу данных.<br>При первом переносе все существующие файлы в папке назначения будут перемещены в папку резервного копирования. При последующих передачах по умолчанию мы будем обновлять назначение, не создавая сначала резервную копию. <br>Кроме того, служба миграции хранилища достаточно интеллектуальна для работы с перекрывающимися общими ресурсами — мы не будем копировать одни и те же папки дважды в одном задании.
8. После завершения передачи проверьте сервер назначения, чтобы убедиться, что все передано правильно. Выберите **журнал ошибок только** в том случае, если вы хотите скачать журнал всех файлов, которые не были переданы.

   > [!NOTE]
   > Если вы хотите сохранить журнал аудита или планируете выполнять несколько операций передачи в задании, щелкните **Журнал переноса** , чтобы сохранить копию в формате CSV. При каждом последующем переносе перезаписываются сведения о базе данных предыдущего запуска. 

На этом этапе у вас есть три варианта:

- **Перейдите к следующему шагу**, обрезанием, чтобы целевые серверы применялись к идентификаторам исходных серверов.
- **Рассмотрим перенос завершенным,** не принимая во внимание удостоверения исходных серверов.
- **Снова перенесите**, копируя только те файлы, которые были обновлены с момента последнего перемещения.

Если ваша цель — синхронизировать файлы с Azure, можно настроить целевые серверы с Синхронизация файлов Azure после передачи файлов или после перехода на целевые серверы (см. раздел [Планирование развертывания Синхронизация файлов Azure](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning)).

## <a name="step-3-optionally-cut-over-to-the-new-servers"></a>Шаг 3. При необходимости вырежьте на новые серверы

На этом шаге вы перейдете с исходных серверов на целевые серверы, переместив IP-адреса и имена компьютеров на целевые серверы. После завершения этого шага приложения и пользователи получают доступ к новым серверам с помощью имен и адресов серверов, которые были перенесены из.

 1. Если вы перешли от задания миграции, в центре администрирования Windows перейдите в раздел **Диспетчер сервера** > **Служба миграции хранилища** , а затем выберите задание, которое требуется завершить. 
 1. На странице "Вырезание **на новые серверы** > "**введите учетные данные** нажмите кнопку " **Далее** ", чтобы использовать введенные ранее учетные данные.
 1. На странице **Настройка прямую миграцию** укажите, какие сетевые адаптеры следует использовать для каждого из параметров исходного устройства. При этом IP-адрес перемещается из источника в место назначения в составе прямую миграцию.
 1. Укажите, какой IP-адрес следует использовать для сервера-источника после того, как прямую миграцию переместит свой адрес в место назначения. Можно использовать DHCP или статический адрес. Если используется статический адрес, новая подсеть должна быть такой же, как и старая подсеть, иначе прямую миграцию завершится ошибкой.
    ![Снимок экрана, показывающий исходный сервер и его IP-адреса и имена компьютеров, и что они будут заменены после прямую миграцию](media/migrate/cutover.png)
    **рис. 4: Исходный сервер и способ перемещения его конфигурации сети в место назначения**
 1. Укажите, как переименовать исходный сервер после того, как на целевом сервере будет достигнуто имя. Можно использовать произвольно созданное имя или тип. Затем нажмите кнопку **Далее**.
 1. На странице **Настройка параметров прямую миграцию** нажмите кнопку **Далее** .
 1. На странице **Проверка исходного и целевого устройства** выберите **проверить** , а затем нажмите кнопку **Далее**.
 1. Когда вы будете готовы выполнить прямую миграцию, нажмите кнопку **запустить прямую миграцию**. <br>Пользователи и приложения могут столкнуться с прерыванием, когда адреса и имена перемещаются, а серверы перезапускаются несколько раз, но в противном случае миграция не затрагивается. Время выполнения прямую миграцию зависит от того, насколько быстро перезапускаются серверы, а также Active Directory и репликация DNS.

## <a name="see-also"></a>См. также

- [Обзор службы миграции хранилища](overview.md)
- [Часто задаваемые вопросы о службах миграции хранилища](faq.md)
- [Планирование развертывания Синхронизация файлов Azure](https://docs.microsoft.com/azure/storage/files/storage-sync-files-planning)
