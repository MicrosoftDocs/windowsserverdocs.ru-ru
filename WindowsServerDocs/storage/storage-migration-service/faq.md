---
title: 'Служба миграции хранилища: часто задаваемые вопросы'
description: Часто задаваемые вопросы о службе миграции хранилища, например о том, какие файлы исключаются из передачи при переходе с одного сервера на другой.
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 08/19/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: f086143ae2e02a2d049189ff248e02fc44fe3cb2
ms.sourcegitcommit: e2b565ce85a97c0c51f6dfe7041f875a265b35dd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/19/2019
ms.locfileid: "69584799"
---
# <a name="storage-migration-service-frequently-asked-questions-faq"></a>Служба миграции хранилища: часто задаваемые вопросы

Этот раздел содержит ответы на часто задаваемые вопросы об использовании [службы миграции хранилища](overview.md) для миграции серверов.

## <a name="what-files-and-folders-are-excluded-from-transfers"></a>Какие файлы и папки исключаются из передачи?

Служба миграции хранилища не переносит файлы или папки, которые могут помешать работе Windows. В частности, мы не будем переносить и перемещать в папку Приксистингдата в месте назначения:

- Windows, Program Files, Program Files (x86), Program Data, Users
- $Recycle. bin, Recycle, очистки, сведения о системном томе, $UpgDrv $, $SysReset, $Windows. ~ BT, $Windows. ~ LS, Windows. old, Загрузка, восстановление, документы и параметры
- pagefile. sys, hiberfil. sys, файл подкачки. sys, винпепже. sys, config. sys, bootsect. bak, bootmgr, бутнкст
- Любые файлы или папки на исходном сервере, которые конфликтуют с исключенными папками в назначении. <br>Например, если в источнике есть папка Н:\виндовс и она сопоставлена с папкой C:\ том в месте назначения, он не переносится, независимо от того, что он содержит, так как он повлияет на системную папку C:\Windows в месте назначения.

## <a name="are-domain-migrations-supported"></a>Поддерживаются ли миграция доменов?

Служба миграции хранилища не допускает миграцию между доменами Active Directory. Миграция между серверами всегда будет присоединять целевой сервер к тому же домену. Учетные данные миграции можно использовать из разных доменов в Active Directory лесу. Служба миграции хранилища поддерживает миграцию между рабочими группами.  

## <a name="are-clusters-supported-as-sources-or-destinations"></a>Поддерживаются ли кластеры как источники или назначения?

Сейчас служба миграции хранилища не выполняет миграцию между кластерами в Windows Server 2019. Мы планируем добавить поддержку кластеров в будущий выпуск службы миграции хранилища.

## <a name="do-local-groups-and-local-users-migrate"></a>Переносятся ли локальные группы и локальные пользователи?

В настоящее время служба миграции хранилища не выполняет миграцию локальных пользователей или локальных групп в Windows Server 2019. Мы планируем добавить поддержку миграции локальных пользователей и локальных групп в следующем выпуске службы миграции хранилища.

## <a name="is-domain-controller-migration-supported"></a>Поддерживается ли миграция контроллера домена?

В настоящее время служба миграции хранилища не выполняет миграцию контроллеров домена в Windows Server 2019. В качестве обходного решения при условии, что в домене Active Directory несколько контроллеров домена, понизьте контроллер домена перед переносом, а затем перенесите назначение после вырезания по завершении. Мы планируем добавить поддержку миграции контроллера домена в будущий выпуск службы миграции хранилища.

## <a name="what-attributes-are-migrated-by-the-storage-migration-service"></a>Какие атрибуты переносятся службой миграции хранилища?

Служба миграции хранилища переносит все флаги, параметры и безопасность общих ресурсов SMB. Этот список флагов, переносимых службой миграции хранилища, включает:

    - Общее состояние
    - Тип доступности
    - Тип общего ресурса
    - Режим перечисления папок *(перечисление на основе доступа или ABE)*
    - Режим кэширования
    - Режим аренды
    - Экземпляр SMB
    - Время ожидания ЦС
    - Ограничение одновременных пользователей
    - Постоянно доступно
    - Описание           
    - Шифрование данных
    - Удаленное взаимодействие удостоверений
    - Инфраструктура
    - Имя
    - Path
    - Области
    - Имя области
    - Дескриптор безопасности
    - Теневое копирование
    - Предложения
    - Сохраненные

## <a name="can-i-consolidate-multiple-servers-into-one-server"></a>Можно ли объединить несколько серверов в один сервер?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, не поддерживает консолидацию нескольких серверов в одном сервере. Примером консолидации будет перенос трех отдельных исходных серверов, которые могут иметь одни и те же имена и пути к локальным файлам, на один новый сервер, виртуализованный этими путями и общими папками, чтобы предотвратить перекрытие или конфликт, а затем ответить на все три имена и IP-адреса предыдущих серверов. Мы можем добавить эту функцию в будущую версию службы миграции хранилища. 

## <a name="can-i-migrate-from-sources-other-than-windows-server"></a>Можно ли выполнить миграцию из источников, отличных от Windows Server?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, поддерживает миграцию с операционных систем Windows Server 2003 и более поздних версий. Кроме того, можно перенести хранилище с сервера или устройства Linux, использующего Samba; для этого запустите службу миграции хранилища на сервере под управлением Windows Server версии 1903 или более поздней.

## <a name="can-i-migrate-previous-file-versions"></a>Можно ли перенести предыдущие версии файлов?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, не поддерживает миграцию предыдущих версий (сделанных со службой теневого копирования томов) файлов. Будет перенесена только текущая версия. 

## <a name="optimizing-inventory-and-transfer-performance"></a>Оптимизация инвентаризации и производительности при переносе

Служба переноса хранилища содержит многопоточное средство чтения и копирования, которое называется службой прокси-службы миграции хранилища, которая предназначена для быстрого и значительного анализа данных, недостаточных для копирования файлов. Хотя конфигурация по умолчанию будет оптимальной для многих клиентов, существуют способы повышения производительности SMS во время инвентаризации и перемещения.

- **Используйте Windows Server 2019 для целевой операционной системы.** Windows Server 2019 содержит прокси-службу службы миграции хранилища. При установке этого компонента и переходе на узел назначения Windows Server 2019 все операции передачи работают как прямая линия анализа между источником и назначением. Эта служба выполняется в Orchestrator во время передачи, если конечные компьютеры — Windows Server 2012 R2 или Windows Server 2016, то есть передача данных в два прыжка и будет значительно ниже. Если на компьютерах назначения Windows Server 2012 R2 или Windows Server 2016 имеется несколько заданий, то Orchestrator станет узким местом. 

- **Изменение потоков перемещения по умолчанию.** Служба прокси-сервера службы миграции хранилища копирует 8 файлов одновременно в заданном задании. Количество одновременных потоков копирования можно увеличить, изменив следующее имя значения REG_DWORD в реестре на каждом узле, на котором выполняется прокси-сервер SMS:

    HKEY_Local_Machine\Software\Microsoft\SMSProxy Филетрансферсреадкаунт

   Допустимый диапазон — от 1 до 128 в Windows Server 2019. После изменения необходимо перезапустить прокси-службу службы миграции хранилища на всех компьютерах, участвующих в миграции. Будьте внимательны с этим параметром. Установка этого параметра может потребовать дополнительных ядер, производительности хранилища и пропускной способности сети. Слишком большое значение может привести к снижению производительности по сравнению с параметрами по умолчанию. Возможность эвристического изменения параметров потоков на основе ЦП, памяти, сети и хранилища планируется для более поздней версии SMS.

- **Добавление ядер и памяти.**  Настоятельно рекомендуется, чтобы на исходном, Orchestrator и конечном компьютерах имелось по крайней мере два ядра процессора или два виртуальных ЦП, и многие из них могут значительно повысить производительность инвентаризации и перемещения, особенно при объединении с Филетрансферсреадкаунт (выше). При передаче файлов, размер которых превышает стандартную производительность передачи для форматов Office (гигабайт или больше), будет выгоднее использовать больше памяти, чем минимум 2 ГБ.

- **Создайте несколько заданий.** При создании задания с несколькими источниками серверов к каждому серверу применяется последовательная связь для инвентаризации, передачи и прямую миграцию. Это означает, что каждый сервер должен завершить свой этап перед запуском другого сервера. Чтобы параллельно запустить больше серверов, просто создайте несколько заданий, каждый из которых содержит только один сервер. SMS поддерживает до 100 одновременно выполняющихся заданий, то есть одна Orchestrator может параллельно использовать множество конечных компьютеров Windows Server 2019. Не рекомендуется запускать несколько параллельных заданий, если конечные компьютеры работают под управлением Windows Server 2016 или Windows Server 2012 R2, как если бы служба прокси-сервера SMS не была запущена на целевом объекте, Orchestrator должна выполнить все передачи и стать местом. Возможность параллельного выполнения серверов внутри одного задания — это функция, которую планируется добавить в более поздней версии SMS.

- **Используйте SMB 3 с сетями RDMA.** При передаче с компьютера с ОС Windows Server 2012 или более поздней версии SMB 3. x поддерживает режим SMB Direct и сети RDMA. RDMA перемещает большую часть ресурсов ЦП на передачу процессоров материнской платы в интегрированные сетевые адаптеры, уменьшая задержку и загрузку ЦП сервера. Кроме того, сети RDMA, такие как РОЦЕ и iWARP, обычно имеют значительно большую пропускную способность, чем обычно TCP/Ethernet, включая 25, 50 и 100 ГБ на интерфейс. Использование SMB Direct обычно перемещает ограничение скорости передачи из сети в само хранилище.   

- **Используйте многоканальный протокол SMB 3.** При передаче с компьютера с ОС Windows Server 2012 или более поздней версии SMB 3. x поддерживает многоканальные копии, что может значительно повысить производительность копирования файлов. Эта функция работает автоматически при условии, что у источника и назначения есть:

   - несколько сетевых адаптеров;
   - Один или несколько сетевых адаптеров, поддерживающих масштабирование на стороне приема (RSS)
   - Один или несколько сетевых адаптеров, настроенных с помощью объединения сетевых карт
   - один или несколько сетевых адаптеров с поддержкой RDMA.

- **Обновление драйверов.** При необходимости установите последние версии встроенного по и драйверов для хранилища и микропрограммного обеспечения поставщика, последние драйверы HBA поставщика, последнюю версию встроенного по для производителей BIOS/UEFI, последние драйверы сети поставщика и последние драйверы микросхем для материнских плат в исходном, целевом и Orchestrator. серверах. Перезапустите узлы при необходимости. Для настройки общих хранилищ и сетевого оборудования обратитесь к документации поставщика оборудования.

- **Включить высокопроизводительную обработку.** Убедитесь, что для параметров BIOS или UEFI настроена высокая производительность, например отключено C-состояние, установлена скорость QPI, включена архитектура NUMA и установлена максимально возможная частота памяти. Убедитесь, что для параметра Управление питанием в Windows Server установлено значение Высокая производительность. При необходимости перезагрузите компьютер. Не забудьте вернуть их в соответствующие состояния после завершения миграции. 

- **Настройка оборудования** Ознакомьтесь с [рекомендациями по настройке производительности для Windows server 2016](https://docs.microsoft.com/windows-server/administration/performance-tuning/) для настройки Orchestrator и конечных компьютеров под управлением windows Server 2019 и windows Server 2016. Раздел " [Настройка производительности сетевой подсистемы](https://docs.microsoft.com/windows-server/networking/technologies/network-subsystem/net-sub-performance-tuning-nics) " содержит особенно ценные сведения.

- **Используйте более быстрое хранилище.** В то время как может быть трудно обновить скорость хранения исходного компьютера, следует обеспечить, чтобы целевое хранилище было как можно быстрее при операции записи ввода-вывода, так как источником является производительность чтения ввода-вывода, чтобы гарантировать отсутствие ненужных узких мест при передаче. Если назначением является виртуальная машина, убедитесь, что по крайней мере в целях миграции она выполняется на наиболее быстром уровне хранилища на узлах гипервизора, например на уровне Flash или с Локальные дисковые пространства кластерах ХЦИ, использующих зеркальные все Flash-или гибридные пространства. После завершения миграции SMS можно выполнить динамическую миграцию виртуальной машины на более медленный уровень или узел.

- **Обновление антивирусной программы.** Всегда проследите за тем, чтобы на исходном и целевом компьютерах выполнялась последняя исправленная версия антивирусной программы, чтобы обеспечить минимальные затраты на производительность. В качестве теста можно *временно* исключить проверку папок, которые вы выполняете инвентаризацию или миграцию на исходном и целевом серверах. Если скорость перемещения улучшена, обратитесь к поставщику антивирусного по, чтобы получить инструкции или обновленную версию антивирусной программы или объяснение ожидаемого снижения производительности.

## <a name="can-i-migrate-from-ntfs-to-refs"></a>Можно ли выполнить миграцию из NTFS в REFS?

Версия службы миграции хранилища, поставляемая в составе Windows Server 2019, не поддерживает миграцию с файловой системы NTFS на REFS. Можно выполнить миграцию из NTFS в NTFS и REFS в ReFS. Это связано с множеством различий в функциональности, метаданных и других аспектах, которые ReFS не дублируют из NTFS. ReFS предназначено как файловая система рабочей нагрузки приложения, а не Общая файловая система. Дополнительные сведения см. в разделе [Общие сведения о отказоустойчивой файловой системе (ReFS)](../refs/refs-overview.md) . 

## <a name="can-i-move-the-storage-migration-service-database"></a>Можно ли переместить базу данных службы миграции хранилища?

Служба миграции хранилища использует базу данных модуля расширенного хранилища (ESE), которая устанавливается по умолчанию в скрытой папке к:\програмдата\микрософт\сторажемигратионсервице. Эта база данных будет расти по мере добавления заданий и завершения передачи и может потреблять значительное дисковое пространство после переноса миллионов файлов, если не удалить задания. Если необходимо переместить базу данных, выполните следующие действия.

1. На компьютере Orchestrator следует отключить службу "Служба миграции хранилища".
2. Стать владельцем `%programdata%/Microsoft/StorageMigrationService` папки
3. Добавьте учетную запись пользователя, чтобы полностью контролировать этот общий ресурс и все его файлы и вложенные папки.
4. Переместите папку на другой диск на компьютере Orchestrator.
5. Задайте значение REG_SZ для следующего реестра:

    HKEY_Local_Machine\Software\Microsoft\SMS DatabasePath = *путь к новой папке базы данных на другом томе* . 
6. Убедитесь, что система имеет полный доступ ко всем файлам и вложенным папкам этой папки.
7. Удалите разрешения собственных учетных записей.
8. Запустите службу "Служба миграции хранилища".

## <a name="give-feedback"></a>Какие варианты можно оставить для отправки отзыва, ошибок в файлах или получения поддержки?

Чтобы отправить отзыв о службе миграции хранилища, сделайте следующее:

- Используйте средство "центр обратной связи", включенное в Windows 10, щелкнув "предложить функцию" и указав категорию "Windows Server" и подкатегорию "миграция хранилища".
- Использование сайта [Windows Server UserVoice](https://windowsserver.uservoice.com)
- Отправить по электронной почтеsmsfeed@microsoft.com

Для файлов ошибок:

- Используйте средство "центр обратной связи", входящее в Windows 10, щелкнув "сообщить о проблеме" и указав категорию "Windows Server" и подкатегорию "миграция хранилища".
- Откройте обращение в службу поддержки через [Служба поддержки Майкрософт](https://support.microsoft.com)

Для получения поддержки:

 - Публикация вопроса в техническом [сообществе Windows Server](https://techcommunity.microsoft.com/t5/Windows-Server/ct-p/Windows-Server)
 - Публикация на [форуме TechNet по Windows Server 2019](https://social.technet.microsoft.com/Forums/en-US/home?forum=ws2019&filter=alltypes&sort=lastpostdesc) 
 - Откройте обращение в службу поддержки через [Служба поддержки Майкрософт](https://support.microsoft.com)

## <a name="see-also"></a>См. также

- [Обзор службы миграции хранилища](overview.md)
