---
title: Часто задаваемые вопросы (FAQ) службы миграции хранилища
description: Часто задаваемые вопросы о службе миграции хранилища, такие как файлы, которые исключаются из передач при переходе с одного сервера на другой.
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 06/04/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: 258f25a7e1ec5c796c15450625397e96db25d693
ms.sourcegitcommit: cd12ace92e7251daaa4e9fabf1d8418632879d38
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66501523"
---
# <a name="storage-migration-service-frequently-asked-questions-faq"></a>Часто задаваемые вопросы (FAQ) службы миграции хранилища

В этом разделе содержатся ответы на часто задаваемые вопросы (FAQ) об использовании [миграции службы хранилища](overview.md) к миграции серверов.

## <a name="excluded-files"></a> Какие файлы и папки исключаются из передачи?

Служба миграции хранилища не передачи файлов или папок, мы знаем, что может помешать выполнению операции Windows. В частности Вот что мы не будем передачи или переместить в папку PreExistingData в месте назначения.

- Windows, Program Files, Program Files (x86), программные данные, пользователи
- $Recycle.bin, recycler, Recycled, System Volume Information $UpgDrv$ $SysReset, $Windows. ~ BT $Windows. ~ LS, Windows.old, загрузки, восстановления, документы и параметры
- Pagefile.sys, hiberfil.sys, swapfile.sys, winpepge.sys, config.sys, bootsect.bak, bootmgr, bootnxt
- Все файлы и папки на исходном сервере, который конфликтует с исключенные папки на сервере назначения. <br>Например, если есть папка N:\Windows в источнике, и он получает сопоставлен C:\ тома в месте назначения, он не будут переданы — независимо от того, он содержит, так как он может повлиять на папке C:\Windows системы на сервере назначения.

## <a name="domain-migration"></a> Миграция домена поддерживаются?

Служба миграции хранилища не допускает переход между доменами Active Directory. Миграция между серверами всегда будет присоединение конечного сервера к тому же домену. Можно использовать учетные данные для миграции из разных доменов в лесу Active Directory. Служба миграции хранилища поддерживает перенос между рабочих групп.  

## <a name="cluster-support"></a> Поддерживаются в качестве источников и назначений кластеров?

Служба миграции хранилища в настоящее время перенос между кластерами в Windows Server 2019. Мы планируем добавить поддержку кластера в будущих версиях службы миграции хранилища.

## <a name="local-principals"></a> Сделать локальные группы и перенос локальных пользователей?

Служба миграции хранилища в настоящее время перенос локальных пользователей или локальных групп в Windows Server 2019. Мы планируем добавить поддержку локальных пользователей и переноса локальных групп в будущих версиях службы миграции хранилища.

## <a name="domain-controller"></a> Поддерживается ли миграция контроллера домена?

Службы миграции хранилища в настоящее время перенос контроллеры домена в Windows Server 2019. Обойти это ограничение, до тех пор, пока имеется более одного контроллера домена в домене Active Directory, понизить роль контроллера домена до миграции, затем повысить уровень назначения после завершения перехода на новую платформу. Мы планируем добавить поддержку миграции контроллера домена в будущих версиях службы миграции хранилища.

## <a name="share-attributes"></a> Какие атрибуты переносятся службой миграции хранилища?

Служба хранилища миграции переносит все флаги, параметры и безопасность общих ресурсов SMB. Список флагов, которые переносит службы миграции хранилища включает в себя:

    - Общее состояние
    - Тип доступности
    - Тип общего ресурса
    - Режим перечисления папки *(также называемые на основе доступа перечисления или ABE)*
    - Режим кэширования
    - Режим сдачи в аренду
    - Экземпляр SMB
    - Время ожидания ЦС
    - Предельное число одновременных пользователей
    - Непрерывно доступные
    - Описание           
    - Шифрование данных
    - Удаленное взаимодействие удостоверений
    - Инфраструктура
    - Имя
    - `Path`
    - Областью действия
    - Имя области
    - Дескриптор безопасности
    - Теневая копия
    - Специальные
    - Временный

## <a name="move-db"></a> Можно ли переместить службу миграции хранилища базы данных?

Служба миграции хранилища использует базу данных ядра (ESE) расширяемого хранилища, устанавливается по умолчанию в папке скрытые c:\programdata\microsoft\storagemigrationservice. Эта база данных будет увеличиваться по мере добавления задания и передачи завершены и могут потреблять значительные места на диске после миграции миллионы файлов, если вы не удалите заданий. Если требуется переместить базу данных, выполните следующие действия:

1. Остановите службу «Служба миграции хранилища» на компьютере orchestrator.
2. Присваивает владение `%programdata%/Microsoft/StorageMigrationService` папки
3. Добавление учетной записи пользователя требуется полный контроль над, совместно использовать и все ее файлы и вложенные папки.
4. Переместите на другой диск на компьютере orchestrator.
5. Задайте следующие значение REG_SZ в реестре:

    HKEY_Local_Machine\Software\Microsoft\SMS DatabasePath = *путь к папке базы данных на другой том* . 
6. Убедитесь, что система имеет полный доступ ко всем файлам и вложенные папки, папки
7. Удалите свои собственные разрешения учетных записей.
8. Запустите службу «Служба миграции хранилища».

## <a name="non-windows"></a> Можно ли перенести из источников, отличных от Windows Server?

Версия службы хранилища миграции, поставляемая вместе в Windows Server 2019 поддерживает переход с Windows Server 2003 и более поздних операционных системах. Невозможно выполнить ее миграцию в настоящее время из Linux, Samba, NetApp, EMC или другие устройства хранения SAN и NAS. Мы планируем разрешить это в будущих версиях службы миграции хранилища, начиная с поддержкой Linux Samba.

## <a name="previous-versions"></a> Можно ли перенести предыдущих версий файлов?

Версия службы миграции хранилища, в Windows Server 2019 не поддерживает перенос предыдущих версий (сделано с помощью службы теневого копирования томов) файлов. Выполняет миграцию только текущей версии. 

## <a name="ntfs-refs"></a> Можно ли перенести из файловой системы NTFS в REFS?

Версия службы хранилища миграции, поставляемая вместе в Windows Server 2019 не поддерживает переход с NTFS на файловые системы REFS. Можно перенести из файловой системы NTFS для NTFS и REFS в ReFS. Это сделано намеренно, из-за различий в функциональности, метаданных и других аспектах, которые не дублируют ReFS из файловой системы NTFS. ReFS предназначен в качестве системы файл рабочей нагрузки приложения, не общей файловой системе. Дополнительные сведения см. в разделе [Обзор Resilient File System (ReFS)](../refs/refs-overview.md)

## <a name="consolidate-servers"></a> Можно объединить несколько серверов в одном сервере?

Версия службы хранилища миграции, поставляемая вместе в Windows Server 2019 не поддерживает объединение нескольких серверов в одном сервере. Пример консолидации бы миграция три отдельных исходных серверах - которые могут иметь одинаковые имена общего ресурса и локальные пути к файлам — в рамках одного нового сервера, которую виртуализировать этих путей и общих папок, чтобы предотвратить перекрытие ни один конфликт, затем ответы на все три предыдущие имена серверов и IP-адрес. Корпорация Майкрософт может расширить эту функцию в будущих версиях службы миграции хранилища.  

## <a name="optimize"></a> Оптимизация производительности инвентаризации и передачи

Служба миграции хранилища содержит несколькими потоками чтения и механизм копирования файлов при вызове службы прокси службы миграции хранилища, которое мы разработали как быстрый, а также перенести идеальной данных fidelity, хватает во многих средств копирования файлов. При конфигурации по умолчанию будет оптимальным выбором для многих клиентов, существуют способы повысить производительность SMS во время инвентаризации и передачи.

- **Используйте Windows Server 2019 для целевой операционной системы.** Windows Server 2019 содержит службы прокси службы миграции хранилища. Если установить этот компонент и перенести в Windows Server 2019 назначения, все передачи работают как прямой видимости между источником и назначением. Эта служба выполняется на оркестратора во время передачи Если на конечные компьютеры Windows Server 2012 R2 или Windows Server 2016, что означает передачу двойного прыжка и будет работать намного медленнее. Если несколько заданий, выполняемых с помощью Windows Server 2012 R2 или Windows Server 2016 назначения, оркестратор станет узким местом. 

- **ALTER потоков передачи по умолчанию.** Служба прокси-сервера службы миграции хранилища копирует 8 файлов одновременно в данное задание. Перемещая приведенное ниже имя параметра реестра REG_DWORD в десятичном формате на каждом узле под управлением прокси-сервер SMS можно увеличить количество одновременных копирования потоков:

    HKEY_Local_Machine\Software\Microsoft\SMSProxy   FileTransferThreadCount

   Допустимый диапазон — от 1 до 128 в Windows Server 2019. После изменения необходимо перезапустить службы прокси службы миграции хранилища на всех компьютерах, участвующих в миграции. Будьте осторожны с этим параметром; установить большее значение, может потребоваться дополнительные ядра, производительность хранилища и пропускной способности сети. Задание слишком высокого уровня может привести к снижению производительности по сравнению с параметрами по умолчанию. Возможность эвристически менять параметры потока в зависимости от ЦП, памяти, сети и хранилища запланирована на более позднюю версию SMS.

- **Добавьте ядра и память.**  Мы настоятельно рекомендуем источника, orchestrator и конечный компьютеры имеют по крайней мере два ядра процессора или два виртуальных ЦП, что значительно сведения могут помочь инвентаризации и передачи производительность, особенно в сочетании с FileTransferThreadCount (см. выше). При передаче файлов, размер которых больше, чем обычные форматы Office (гигабайт или более поздней версии) с объемом памяти, чем менее 2 ГБ по умолчанию выигрыш производительности передачи.

- **Создайте несколько заданий.** При создании задания с несколькими источниками server, каждый сервер связаться с последовательным образом для инвентаризации, передачу и перехода. Это означает, что каждый сервер необходимо выполнить стадии его перед запуском другой сервер. Для параллельного выполнения дополнительные серверы, просто создайте несколько заданий, с каждым заданием, содержащая только одно серверов. SMS поддерживает до 100 одновременно работающих заданий, это означает, что один orchestrator можно распараллеливать несколько конечных компьютеров Windows Server 2019. Мы не рекомендуем под управлением нескольких параллельных заданий, если на конечные компьютеры Windows Server 2016 или Windows Server 2012 R2 как без SMS прокси-службе, работающей на сервере назначения, оркестратора должен выполнять все передает самого и может стать узкое место. Возможность серверов для параллельного выполнения в рамках одного задания — это функция, которую мы планируем добавить в более поздней версии сервера SMS.

- **Используйте SMB 3 с сетями RDMA.** Перенос с Windows Server 2012 или более поздней версии исходного компьютера, SMB 3.x поддерживает SMB Direct режим и работы в сети RDMA. RDMA перемещает большинство ЦП стоимость передачи, с системной платы процессоров, обработчикам подключить сетевой Адаптер, сокращающей задержки и сервера использование ЦП. Кроме того сети RDMA, таких как ROCE и iWARP обычно имеют значительно более высокой пропускной способностью, чем типичный TCP/ethernet, включая 25, 50 и 100 ГБ скорости каждого интерфейса. Обычно с помощью SMB Direct перемещает предела скорости передачи по сети до самого хранилища.   

- **Используйте SMB 3 multichannel.** Перенос с Windows Server 2012 или более поздней версии исходного компьютера, SMB 3.x поддерживает многоканальный копии, которые может значительно повысить файла производительность копирования. Эта функция работает автоматически, до тех пор, пока источника и назначения имеют:

   - несколько сетевых адаптеров;
   - Один или несколько сетевых адаптеров, поддерживающих на стороне приема масштабирование (RSS)
   - Один из нескольких сетевых адаптеров, настроенных с помощью объединения Сетевых карт
   - один или несколько сетевых адаптеров с поддержкой RDMA.

- **Обновления драйверов.** При необходимости установите последнюю поставщика хранилища и корпуса встроенного по и драйверы, драйверы HBA поставщика, последняя версия встроенного по BIOS или UEFI поставщика, последние версии драйверов сети поставщика и последние версии драйверов для набора микросхем материнской платы на источника, назначения и orchestrator серверы. Перезапустите узлы при необходимости. Для настройки общих хранилищ и сетевого оборудования обратитесь к документации поставщика оборудования.

- **Включите обработку высокой производительности.** Убедитесь, что для параметров BIOS или UEFI настроена высокая производительность, например отключено C-состояние, установлена скорость QPI, включена архитектура NUMA и установлена максимально возможная частота памяти. Убедитесь, что управление питанием в Windows Server имеет значение для высокой производительности. При необходимости перезагрузите компьютер. Не забудьте вернуть их в соответствующие состояния после завершения миграции. 

- **Настройка оборудования** проверки [производительности настройке рекомендации для Windows Server 2016](https://docs.microsoft.com/en-us/windows-server/administration/performance-tuning/) по настройке orchestrator и конечных компьютерах под управлением Windows Server 2019 г. и Windows Server 2016. [Настройка производительности сетевой подсистемы](https://docs.microsoft.com/en-us/windows-server/networking/technologies/network-subsystem/net-sub-performance-tuning-nics) раздел содержит особенно полезные сведения.

- **Используйте более быстрое хранилище.** Хотя он может быть сложным, скорость хранилища компьютера источника, следует убедиться, что целевое хранилище составляет не менее, как быстро в производительности операций записи ввода-ВЫВОДА, как источником является на производительность операций чтения ввода-ВЫВОДА, чтобы убедитесь, что без лишних узких мест в передаче. Если целевой виртуальной Машины, убедитесь, что, по крайней мере в рамках миграции, оно запускается в наиболее быстрый уровень хранилища узлах гипервизора, такие как на уровне флэш-памяти или с кластерами прямой HCI пространств хранения зеркальных флэш-памяти или гибридных пробелы. После завершения миграции SMS виртуальной Машины можно выполнить динамическую миграцию к узлу или уровня медленнее.

- **Обновление антивирусного.** Необходимо всегда проверять источника и назначения выполняются последнюю исправленную версию антивирусного программного обеспечения для обеспечения минимальных затрат ресурсов. Для проверки вы можете *временно* исключить сканирование папок Инвентаризация или миграции на исходном и конечном серверах. Если повышена производительность передачи, обратитесь к поставщику антивирусного программного обеспечения для инструкции или обновленную версию антивирусного программного обеспечения и объяснение снижение ожидаемую производительность.

## <a name="give-feedback"></a> Каковы Мои возможности, чтобы оставить отзыв, регистрация ошибок, или получить поддержку?

Чтобы оставить отзыв о миграции службы хранилища:

- Используйте средство Центр отзывов, включенные в Windows 10, щелкнув «Предложить функцию» и указав категорию «Windows Server» и «Подкатегория», «Хранилища миграции»
- Используйте [Windows Server UserVoice](https://windowsserver.uservoice.com) сайта
- Отправить по электронной почте smsfeed@microsoft.com

Чтобы отправить сведения об ошибке:

- Используйте средство Центр отзывов, включенные в Windows 10, нажав кнопку «Сообщить о проблеме» и указав категорию «Windows Server» и «Подкатегория», «Хранилища миграции»
- Обратиться в службу поддержки через [технической поддержки Майкрософт](https://support.microsoft.com)

Получение поддержки:

 - Опубликуйте вопрос на [техническое сообщество Windows Server](https://techcommunity.microsoft.com/t5/Windows-Server/ct-p/Windows-Server)
 - Опубликовать на [форум Technet для Windows Server 2019 г.](https://social.technet.microsoft.com/Forums/en-US/home?forum=ws2019&filter=alltypes&sort=lastpostdesc) 
 - Обратиться в службу поддержки через [технической поддержки Майкрософт](https://support.microsoft.com)


## <a name="see-also"></a>См. также

- [Общие сведения о миграции службы хранилища](overview.md)
