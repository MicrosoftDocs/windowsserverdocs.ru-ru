---
title: Известные проблемы со службой миграции хранилища
description: Известные проблемы и устранение неполадок службы миграции хранилища, например получение журналов для служба поддержки Майкрософт.
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 07/09/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: d8437e0e33a370ab698d25f25b43fbbcbae97792
ms.sourcegitcommit: 45415ba58907d650cfda45f4c57f6ddf1255dcbf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2019
ms.locfileid: "71206920"
---
# <a name="storage-migration-service-known-issues"></a>Известные проблемы со службой миграции хранилища

Этот раздел содержит ответы на известные проблемы, возникающие при использовании [службы миграции хранилища](overview.md) для миграции серверов.

Служба миграции хранилища выпускается в два этапа: служба в Windows Server и пользовательский интерфейс в центре администрирования Windows. Служба доступна в Windows Server, долгосрочном канале обслуживания, а также на Windows Server, полугодовой канал; Хотя центр администрирования Windows доступен для загрузки отдельно. Мы также периодически включаем изменения в накопительные обновления для Windows Server, выпущенные с помощью Центр обновления Windows. 

Например, Windows Server версии 1903 включает новые функции и исправления для службы миграции хранилища, которые также доступны для Windows Server 2019 и Windows Server версии 1809 путем установки [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534).

## <a name="collecting-logs"></a>Как получать файлы журналов при работе с служба поддержки Майкрософт

Служба миграции хранилища содержит журналы событий для службы Orchestrator и прокси-службы. Сервер урчестратор всегда содержит оба журнала событий, а целевые серверы с установленной службой прокси содержат журналы прокси-сервера. Эти журналы находятся в папке:

- Журналы приложений и служб \ Microsoft \ Windows \ Сторажемигратионсервице
- Журналы приложений и служб \ Microsoft \ Windows \ Сторажемигратионсервице-proxy

Если необходимо собрать эти журналы для просмотра в автономном режиме или для отправки в служба поддержки Майкрософт, в GitHub доступен сценарий PowerShell с открытым исходным кодом:

 [Вспомогательная служба службы миграции хранилища](https://aka.ms/smslogs) 

Ознакомьтесь с ФАЙЛОМ README для использования.

## <a name="storage-migration-service-doesnt-show-up-in-windows-admin-center-unless-managing-windows-server-2019"></a>Служба миграции хранилища не отображается в центре администрирования Windows, если управление Windows Server 2019 не выполняется.

При использовании версии 1809 центра администрирования Windows для управления Windows Server 2019 Orchestrator не отображается параметр средства для службы миграции хранилища. 

Расширение "Служба миграции хранилища центра администрирования Windows" привязано к версии только для Windows Server 2019 версии 1809 или более поздних операционных систем. Если вы используете ее для управления более старыми операционными системами Windows Server или предварительными версиями Insider Preview, это средство не будет отображаться. Это поведение реализовано намеренно. 

Чтобы разрешить, используйте или обновите до Windows Server 2019 Build 1809 или более поздней версии.

## <a name="storage-migration-service-doesnt-let-you-choose-static-ip-on-cutover"></a>Служба миграции хранилища не позволяет выбрать статический IP-адрес в прямую миграцию

При использовании версии 0,57 расширения службы "миграция хранилища" в центре администрирования Windows и достижении этапа прямую миграцию нельзя выбрать статический IP-адрес для адреса. Вы вынуждены использовать DHCP.

Чтобы устранить эту проблему, в центре администрирования Windows в разделе " **Параметры** > **расширений** " найдите Оповещение о том, что для установки доступна обновленная версия службы миграции хранилища версий 0.57.2. Может потребоваться перезапустить вкладку браузера для центра администрирования Windows.

## <a name="storage-migration-service-cutover-validation-fails-with-error-access-is-denied-for-the-token-filter-policy-on-destination-computer"></a>Сбой проверки прямую миграцию службы миграции хранилища с ошибкой "отказано в доступе для политики фильтрации токенов на конечном компьютере"

При выполнении проверки прямую миграцию появляется сообщение об ошибке «Fail: Отказано в доступе к политике фильтрации токенов на конечном компьютере ". Это происходит даже в том случае, если указаны правильные учетные данные локального администратора для исходного и конечного компьютеров.

Эта проблема вызвана дефектом кода в Windows Server 2019. Эта ошибка возникает при использовании конечного компьютера в качестве службы миграции хранилища Orchestrator.

Чтобы обойти эту ошибку, установите службу миграции хранилища на компьютер под Windows Server 2019, который не является целевым местом миграции, а затем подключитесь к этому серверу с помощью центра администрирования Windows и выполните миграцию.

Мы устранили это в более позднем выпуске Windows Server. Откройте обращение в службу поддержки через [Служба поддержки Майкрософт](https://support.microsoft.com) , чтобы запросить создание порта для этого исправления.

## <a name="storage-migration-service-isnt-included-in-windows-server-2019-evaluation-or-windows-server-2019-essentials-edition"></a>Служба переноса хранилища не входит в ознакомительную версию Windows Server 2019 или Windows Server 2019 Essentials

При использовании центра администрирования Windows для подключения к [ознакомительному выпуску Windows server 2019](https://www.microsoft.com/evalcenter/evaluate-windows-server-2019) или windows Server 2019 Essentials нет возможности управлять службой миграции хранилища. Служба миграции хранилища также не входит в роли и компоненты.

Эта проблема вызвана проблемой обслуживания в ознакомительной версии Windows Server 2019 и Windows Server 2019 Essentials. 

Чтобы обойти эту ошибку для ознакомительной версии, установите розничную, MSDN, OEM или корпоративную лицензию Windows Server 2019 и не активируйте ее. Без активации все выпуски Windows Server работают в режиме оценки 180 дней. 

Мы устранили эту ошибку в более позднем выпуске Windows Server.  

## <a name="storage-migration-service-times-out-downloading-the-transfer-error-csv"></a>Истекло время ожидания для службы миграции хранилища при скачивании CSV-файла ошибки переноса

При использовании Windows Admin Center или PowerShell для загрузки подробных сведений об ошибках операций перемещения — только журнал CSV, появляется сообщение об ошибке:

 >   Журнал перемещений. Убедитесь, что в брандмауэре разрешен общий доступ к файлам. : Операция запроса, отправленная в NET. TCP://localhost: 28940/SMS/Service/1/Send, не получила ответ в течение заданного времени ожидания (00:01:00). Время, выделенное для выполнения этой операции, может быть составной частью более длительного времени ожидания. Это может быть вызвано тем, что служба все еще обрабатывает операцию или потому, что службе не удалось отправить ответное сообщение. Попробуйте увеличить время ожидания операции (путем приведения канала или прокси-сервера к адрес IContextChannel и установки свойства OperationTimeout) и убедитесь, что служба может подключиться к клиенту.

Эта проблема вызвана очень большим количеством переданных файлов, которые не могут быть отфильтрованы по умолчанию в течение минуты времени ожидания, разрешенного службой миграции хранилища. 

Чтобы обойти эту ошибку, сделайте следующее:

1. На компьютере Orchestrator измените файл *%системрут%\смс\микрософт.сторажемигратион.сервице.ЕКСЕ.конфиг* с помощью программы Notepad. exe, чтобы изменить значение "SendTimeout" с 1 минуты по умолчанию на 10 минут.

   ```
     <bindings>
      <netTcpBinding>
        <binding name="NetTcpBindingSms"
                 sendTimeout="00:01:00"
   ```

2. Перезапустите службу "Служба миграции хранилища" на компьютере Orchestrator. 
3. На компьютере Orchestrator запустите программу regedit. exe.
4. Найдите и выберите следующий подраздел реестра. 

   `HKEY_LOCAL_MACHINE\Software\Microsoft\SMSPowershell`

5. В меню "Правка" выберите пункт "Создать", а затем выберите "Значение DWORD". 
6. Введите "Вкфоператионтимеаутинминутес" в качестве имени DWORD и нажмите клавишу ВВОД.
7. Щелкните правой кнопкой мыши "Вкфоператионтимеаутинминутес" и выберите команду "Изменить". 
8. В поле Базовые данные щелкните "десятичное число"
9. В поле данные значения введите "10", а затем нажмите кнопку ОК.
10. Закройте редактор реестра.
11. Попытайтесь снова скачать CSV-файл с ошибками. 

Мы планируем изменить это поведение в более позднем выпуске Windows Server 2019.  

## <a name="cutover-fails-when-migrating-between-networks"></a>Сбой прямую миграцию при миграции между сетями

При переходе на конечный компьютер, работающий в сети, отличной от той, что и источник, например экземпляр Azure IaaS, прямую миграцию не может завершиться, если источник использует статический IP-адрес. 

Это поведение предназначено для предотвращения проблем с подключением после миграции пользователей, приложений и сценариев, подключающихся через IP-адрес. Когда IP-адрес перемещается с старого исходного компьютера на новый целевой объект, он не будет соответствовать новым данным сетевой подсети и, возможно, DNS и WINS.

Чтобы решить эту проблему, выполните миграцию на компьютер в той же сети. Затем переместите этот компьютер в новую сеть и переназначьте сведения об IP-адресе. Например, если миграция выполняется в Azure IaaS, сначала выполните миграцию на локальную виртуальную машину, а затем используйте службу "миграция Azure", чтобы переместить виртуальную машину в Azure.  

Эта проблема исправлена в последующем выпуске центра администрирования Windows. Теперь вы можете указать миграции, которые не изменяют параметры сети целевого сервера. Обновленное расширение будет указано здесь после выпуска. 

## <a name="validation-warnings-for-destination-proxy-and-credential-administrative-privileges"></a>Предупреждения проверки для прокси-сервера назначения и права администратора учетных данных

При проверке задания перемещения отображаются следующие предупреждения.

 > **Учетные данные имеют права администратора.**
 > Предупреждение: Действие недоступно для удаленного доступа.
 > **Целевой прокси-сервер зарегистрирован.**
 > Предупреждение: Целевой прокси-сервер не найден.

Если вы не установили прокси-службу службы миграции хранилища на конечный компьютер с Windows Server 2019, или на целевом компьютере установлена ОС Windows Server 2016 или Windows Server 2012 R2, это поведение предназначено для разработки. Мы рекомендуем перейти на компьютер под Windows Server 2019 с установленным прокси-сервером, чтобы значительно повысить производительность переноса.  

## <a name="certain-files-do-not-inventory-or-transfer-error-5-access-is-denied"></a>Некоторые файлы не передаются или переносятся, ошибка 5 "доступ запрещен"

При инвентаризации или передаче файлов из источника на конечные компьютеры файлы, из которых пользователь удалил разрешения группы администраторов, не смогут выполнить миграцию. Проверка службы миграции хранилища — Отладка прокси показывает:

  Имя журнала:      Microsoft-Windows-Сторажемигратионсервице-прокси/источник отладки:        Microsoft-Windows-Сторажемигратионсервице-Дата прокси-сервера:          Идентификатор события 2/26/2019 9:00:04 AM:      10000 Категория задачи: Уровень None:         Ключевые слова ошибок:      
  Пользователь:          Компьютер сетевой службы: описание srv1.contoso.com:

  02/26/2019-09:00:04.860 [Ошибка] ошибка при переносе для \\SRV1. contoso. ком\публик\инди.ПНГ: (5) отказано в доступе.
Трассировка стека: в Microsoft. Сторажемигратион. Proxy. Service. Trace. Филедирутилс. OpenFile (строковое имя файла, Десиредакцесс Десиредакцесс, Шаремоде Шаремоде, CreationDisposition creationDisposition, Флагсандаттрибутес flagsAndAttributes) в Microsoft. Сторажемигратион. Proxy. Service. Перемещение. Филедирутилс. Жеттаржетфиле (строковый путь) в Microsoft. Сторажемигратион. Proxy. Service. Re. Филедирутилс. Жеттаржетфиле (FileInfo-файл) в Microsoft. Сторажемигратион. Proxy. Service. передает. Филетрансфер. Инитиализесаурцефилеинфо () в Microsoft. Сторажемигратион. Proxy. Service. Re. Филетрансфер. reby () в Microsoft. Сторажемигратион. Proxy. Service. Перемещение. Филетрансфер. Тритрансфер () [Д:\ос\срк\басе\дмс\прокси\трансфер\трансферпрокси\филетрансфер.КС:: TryTransfer:: 55]


Эта проблема вызвана дефектом кода в службе миграции хранилища, в котором не были вызваны права на резервное копирование. 

Чтобы устранить эту проблему, установите [Центр обновления Windows 2 апреля 2019 г. — KB4490481 (сборка ос 17763,404)](https://support.microsoft.com/help/4490481/windows-10-update-kb4490481) на компьютере Orchestrator и конечном компьютере, если прокси-служба установлена там. Убедитесь, что исходная учетная запись миграции пользователя является локальным администратором на исходном компьютере и службой миграции хранилища Orchestrator. Убедитесь, что учетная запись миграции конечного пользователя является локальным администратором на конечном компьютере и службой миграции хранилища Orchestrator. 

## <a name="dfsr-hashes-mismatch-when-using-storage-migration-service-to-preseed-data"></a>Несоответствие хэшей DFSR при использовании службы миграции хранилища для предзаполнения данных

Когда вы используете службу миграции хранилища для переноса файлов в новое место назначения, а затем настраиваете репликация DFS (DFSR) для репликации этих данных с имеющимся сервером DFSR через предварительно заполненную репликацию или клонирование базы данных DFSR, все файлы експериемце хэш-код несоответствие и повторно реплицируются. Все потоки данных, потоки безопасности, размеры и атрибуты полностью совпадают после использования SMS для их перемещения. При проверке файлов с помощью ICACLS или журнала отладки клонирования базы данных DFSR выясняется следующее:

Исходный файл:

  icacls Д:\тест\саурце:

  icacls д:\тест\сатчер.ПНГ/Save out. txt/t Сатчер. png Д:АИ (A;; ОС;;; BA) (A;; 0 x1200a9;;;D D) (A;; 0 x1301bf;;;D U) (A; ИДЕНТИФИКАТОР; ОС;;; BA) (A; ИДЕНТИФИКАТОР; ОС;;; SY) (A; ID; 0x1200a9;;; BU

Конечный файл:

  icacls д:\тест\сатчер.ПНГ/Save out. txt/t Сатчер. png Д:АИ (A;; ОС;;; BA) (A;; 0 x1301bf;;;D U) (A;; 0 x1200a9;;;D D) (A; ИДЕНТИФИКАТОР; ОС;;; BA) (A; ИДЕНТИФИКАТОР; ОС;;; SY) (A; ID; 0x1200a9;;; BU)**S:PAINO_ACCESS_CONTROL**

Журнал отладки DFSR:

  20190308 10:18:53.116 3948 ДБКЛ 4045 [WARN] Дбклоне:: не удалось найти запись о несоответствии Идтаблеимпортупдате. 

  Локальный хэш ACL: 1BCDFE03-A18BCE01-D1AE9859-23A0A5F6 LastWriteTime: 20190308 18:09:44.876 Филесизелов: 1131654 Филесизехигх: 0 Атрибуты: 32 

  Клонировать хэш ACL:**DDC4FCE4-DDF329C4-977CED6D-F4D72A5B** LastWriteTime: 20190308 18:09:44.876 филесизелов: 1131654 филесизехигх: 0 Атрибуты: 32 

Эта проблема вызвана дефектом кода библиотеки, используемой службой миграции хранилища для настройки списков управления доступом (SACL) аудита безопасности. Список SACL, не равный null, непреднамеренно задан, когда список SACL пуст, что приводит к правильному обнаружению несоответствия хэша. 

Чтобы решить эту проблему, продолжайте использовать Robocopy для [предварительного заполнения DFSR и операций клонирования базы данных DFSR](../dfs-replication/preseed-dfsr-with-robocopy.md) вместо службы миграции хранилища. Мы изучаем эту проблему и планируем устранить ее в более поздней версии Windows Server и, возможно, в Центр обновления Windows с незаполненным портом. 

## <a name="error-404-when-downloading-csv-logs"></a>Ошибка 404 при скачивании журналов CSV

При попытке загрузить журналы пересылки или ошибок в конце операции перемещения появляется сообщение об ошибке:

  $jobname: Журнал перемещения: ошибка AJAX 404

Эта ошибка возникает, если вы не включили правило брандмауэра "общий доступ к файлам и принтерам (SMB-in)" на сервере Orchestrator. Для загрузки файлов центра администрирования Windows требуется порт TCP/445 (SMB) на подключенных компьютерах.  

## <a name="error-couldnt-transfer-storage-on-any-of-the-endpoints-when-transferring-from-windows-server-2008-r2"></a>Ошибка "не удалось передать хранилище на любую из конечных точек" при передаче из Windows Server 2008 R2

При попытке передачи данных с исходного компьютера Windows Server 2008 R2 передача данных не происходит и возникает ошибка:  

  Не удалось переместить хранилище на любую из конечных точек.
0x9044

Эта ошибка возникает, если на компьютере под Windows Server 2008 R2 не установлено полное обновление со всеми критически важными и важными обновлениями Центр обновления Windows. Независимо от службы миграции хранилища, мы всегда рекомендуем установить исправление для безопасности компьютера под управлением Windows Server 2008 R2, так как эта операционная система не содержит улучшений безопасности более новых версий Windows Server.

## <a name="error-couldnt-transfer-storage-on-any-of-the-endpoints-and-check-if-the-source-device-is-online---we-couldnt-access-it"></a>Ошибка "не удалось переместить хранилище на любую из конечных точек" и "проверить, подключено ли исходное устройство к сети."

При попытке переместить данные с исходного компьютера некоторые или все общие папки не передаются, со сводной ошибкой:

   Не удалось переместить хранилище на любую из конечных точек.
0x9044

При проверке сведений о переносе SMB отображается ошибка:

   Проверьте, подключено ли исходное устройство к сети. не удалось получить к нему доступ.

Просмотр журнала событий Сторажемигратионсервице/Admin показывает:

   Не удалось переместить хранилище.

   Должно Идентификатор Job1:  
   Область: Ошибка сбоя: Сообщение об ошибке 36931: 

   Руководство по Проверьте подробные сведения об ошибке и убедитесь, что выполнены требования к переносу. Заданию перемещения не удалось переместить исходные и конечные компьютеры. Это может быть вызвано тем, что компьютеру Orchestrator не удалось достичь доступа к исходным или конечным компьютерам, возможно, из-за правила брандмауэра или отсутствия разрешений.

При проверке журнала Сторажемигратионсервице-proxy/Debug отображаются следующие сведения:

   07/02/2019-13:35:57.231 [Ошибка] сбой проверки перемещения. Код ошибки: 40961, конечная точка источника недоступна или не существует, либо исходные учетные данные недопустимы, или у пользователя, прошедшего проверку, недостаточно разрешений для доступа к нему.
в Microsoft. Сторажемигратион. Proxy. Service. reby. Трансфероператион. Validate () в Microsoft. Сторажемигратион. Proxy. Service. Re. Трансферрекуессандлер. ProcessRequest (Филетрансферрекуест fileTransferRequest, идентификатор GUID)    [Д:\ос\срк\басе\дмс\прокси\трансфер\трансферпрокси\трансферрекуессандлер.КС::

Эта ошибка возникает, если учетная запись миграции не имеет разрешений на чтение для общих ресурсов SMB. Чтобы устранить эту ошибку, добавьте группу безопасности, содержащую учетную запись миграции источника, в общие папки SMB на исходном компьютере и предоставьте ей право на чтение, изменение или полный доступ. После завершения миграции эту группу можно удалить.

## <a name="error-0x80005000-when-running-inventory"></a>Ошибка 0x80005000 при выполнении инвентаризации

После установки [KB4512534](https://support.microsoft.com/en-us/help/4512534/windows-10-update-kb4512534) и попытки запустить инвентаризацию происходит сбой инвентаризации с ошибками:

  ИСКЛЮЧЕНИЕ ИЗ HRESULT: 0x80005000
  
  Имя журнала:      Источник Microsoft-Windows-Сторажемигратионсервице/Admin:        Microsoft-Windows-Сторажемигратионсервице Дата:          9/9/2019 5:21:42. ИД события PM:      2503 Категория задачи: Уровень None:         Ключевые слова ошибок:      
  Пользователь:          Компьютер сетевой службы:      FS02. Описание TailwindTraders.net: Не удалось выполнить инвентаризацию компьютеров.
Задание: идентификатор Foo2: Состояние 20ac3f75-4945-41d1-9a79-d11dbb57798b: Ошибка сбоя: Сообщение об ошибке 36934: Не удалось выполнить инвентаризацию для всех устройств: Проверьте подробные сведения об ошибке и убедитесь, что выполнены требования к инвентаризации. Заданию не удалось выполнить инвентаризацию указанных исходных компьютеров. Это может быть вызвано тем, что компьютеру Orchestrator не удалось связаться с ним по сети, возможно, из-за правила брандмауэра или отсутствия разрешений.
  
  Имя журнала:      Источник Microsoft-Windows-Сторажемигратионсервице/Admin:        Microsoft-Windows-Сторажемигратионсервице Дата:          9/9/2019 5:21:42. ИД события PM:      2509 Категория задачи: Уровень None:         Ключевые слова ошибок:      
  Пользователь:          Компьютер сетевой службы:      FS02. Описание TailwindTraders.net: Не удалось выполнить инвентаризацию компьютера.
Задание: Foo2 компьютер: FS01. Состояние TailwindTraders.net: Ошибка сбоя:-2147463168 сообщение об ошибке: Руководство по Проверьте подробные сведения об ошибке и убедитесь, что выполнены требования к инвентаризации. Инвентаризации не удалось определить какие бы то ни было аспекты указанного исходного компьютера. Это может быть вызвано отсутствием разрешений или привилегиями в источнике или заблокированным портом брандмауэра.
  
Эта ошибка вызвана дефектом кода в службе миграции хранилища при предоставлении учетных данных миграции в виде имени участника-пользователя (UPN), например "meghan@contoso.com". Службе Orchestrator Migration Service не удается правильно проанализировать этот формат, что приводит к сбою уточняющего запроса домена, добавленного для поддержки миграции кластера в KB4512534 и 19H1.

Чтобы обойти эту проблему, укажите учетные данные в формате домен \ пользователь, например "Контосо\мегхан".

## <a name="error-serviceerror0x9006-or-the-proxy-isnt-currently-available-when-migrating-to-a-windows-server-failover-cluster"></a>Ошибка "ServiceError0x9006" или "прокси-сервер в настоящее время недоступен". При переходе на отказоустойчивый кластер Windows Server

При попытке перемещения данных на кластеризованный файловый сервер появляются следующие ошибки: 

   Убедитесь, что прокси-служба установлена и запущена, и повторите попытку. Прокси-сервер в настоящее время недоступен.
0x9006 ServiceError0x9006, Microsoft. Сторажемигратион. Commands. Унрегистерсмспроксикомманд

Эта ошибка возникает, если ресурс файлового сервера перемещен с исходного узла владельца кластера Windows Server 2019 на новый узел, а функция прокси-сервера службы миграции хранилища не установлена на этом узле.

Чтобы избежать этого, переместите целевой ресурс файлового сервера обратно на исходный узел кластера владельца, который использовался при первой настройке пар передачи.

В качестве альтернативного решения:

1. Установите компонент прокси-сервера службы миграции хранилища на всех узлах кластера.
2. Выполните следующую команду PowerShell для службы миграции хранилища на компьютере Orchestrator: 

   ```PowerShell
   Register-SMSProxy -ComputerName *destination server* -Force
   ```
## <a name="error-dll-was-not-found-when-running-inventory-from-a-cluster-node"></a>Ошибка "DLL не найдена" при выполнении инвентаризации с узла кластера

При попытке запустить инвентаризацию с помощью службы миграции хранилища Orchestrator, установленной на узле отказоустойчивого кластера Windows Server 2019 и нацеливания на общий источник файлового сервера отказоустойчивого кластера Windows Server, появляется следующее сообщение об ошибке:

    DLL not found
    [Error] Failed device discovery stage VolumeInfo with error: (0x80131524) Unable to load DLL 'Microsoft.FailoverClusters.FrameworkSupport.dll': The specified module could not be found. (Exception from HRESULT: 0x8007007E)   

Чтобы решить эту проблему, установите "средства управления отказоустойчивыми кластерами" (RSAT-Cluster-Management) на сервере, на котором запущена служба миграции хранилища Orchestrator. 


## <a name="see-also"></a>См. также

- [Обзор службы миграции хранилища](overview.md)
