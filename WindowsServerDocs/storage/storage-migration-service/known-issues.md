---
title: Известные проблемы службы миграции хранилища
description: Известные проблемы и устранения неполадок поддержка миграции службы хранилища, таких как сбор журналов поддержки Майкрософт.
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 05/14/2019
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.openlocfilehash: e1cfd2b0ea3bc4d7802cb4a6d2a8c1493d5511a1
ms.sourcegitcommit: 0099873d69bd23495d275d7bcb464594de09ee3c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/15/2019
ms.locfileid: "65699699"
---
# <a name="storage-migration-service-known-issues"></a>Известные проблемы службы миграции хранилища

В этом разделе содержатся ответы на известные проблемы при использовании [миграции службы хранилища](overview.md) к миграции серверов.

## <a name="collecting-logs"></a> Как собирать файлы журналов, при работе со службой поддержки Майкрософт

Служба миграции хранилища содержит журналы событий для службы Orchestrator и прокси-сервера. Urchestrator server всегда содержит оба журналы событий, и конечные серверы с установленной службой прокси-сервера содержат журналы прокси-сервера. Эти журналы расположены в разделе:

- Журналы приложений и служб \ Microsoft \ Windows \ StorageMigrationService
- Журналы приложений и служб \ Microsoft \ Windows \ StorageMigrationService для прокси-сервера

Если требуется для сбора этих журналов для автономного просмотра или для отправки в службу поддержки Майкрософт, есть открытый код сценария PowerShell, доступные на сайте GitHub:

 [Вспомогательный модуль службы хранилища миграции](https://aka.ms/smslogs) 

Просмотрите файл сведений об использовании.

## <a name="storage-migration-service-doesnt-show-up-in-windows-admin-center-unless-managing-windows-server-2019"></a>Служба миграции хранилища не отображается в Windows Admin Center Если управление Windows Server 2019

При использовании версии 1809 Windows Admin Center для управления orchestrator Windows Server 2019, вы не видите параметр средства для миграции службы хранилища. 

Расширение Windows Admin Center хранилища миграции службы связан с версии для управления только версии Windows Server 2019 1809 или более поздних операционных системах. Если вы используете для управления старые операционные системы Windows Server или предварительные версии программы предварительной оценки, средство будет отсутствовать. Это поведение реализовано намеренно. 

Чтобы решить, использовать или обновление до Windows Server 2019 сборки 1809 или более поздней версии.

## <a name="storage-migration-service-doesnt-let-you-choose-static-ip-on-cutover"></a>Служба миграции хранилища не позволяют выбрать один статический IP-адрес на прямую миграцию

При использовании 0.57 версию службы хранилища миграции, расширения в Windows Admin Center и доступа к прямой этап, нельзя выбрать статический IP-адрес для адреса. Вам придется использовать DHCP.

Чтобы устранить эту проблему, в Windows Admin Center, найдите его в разделе **параметры** > **расширения** для предупреждения о том, что обновленная версия службы миграции хранилища 0.57.2 доступно для установки. Может потребоваться перезапустить на вкладке браузера для центра администрирования Windows.

## <a name="storage-migration-service-cutover-validation-fails-with-error-access-is-denied-for-the-token-filter-policy-on-destination-computer"></a>Проверка прямой миграции службы хранилища происходит сбой с ошибкой «Доступ запрещен для токена фильтра политики на конечном компьютере.»

При запуске прямой проверки, возникает ошибка «сбой: Доступ запрещен для токена фильтра политики на конечном компьютере.» Это происходит, даже если вы указали учетные данные правильные локального администратора на исходном и конечном компьютерах.

Это проблема вызвана ошибкой в коде Windows Server 2019. Проблема возникает в том случае, когда конечный компьютер при использовании в качестве оркестратора службы миграции хранилища.

Чтобы обойти эту проблему, установить службу миграции хранилища на компьютере Windows Server 2019, который не является конечным предполагаемого миграции, а затем подключитесь к этим сервером с помощью Windows Admin Center и выполнения миграции.

Мы исправили это в более позднем выпуске Windows Server. Обратитесь в службу поддержки через [поддержки Майкрософт](https://support.microsoft.com) чтобы запросить бэкпортировать данного исправления.

## <a name="storage-migration-service-isnt-included-in-windows-server-2019-evaluation-edition"></a>Служба миграции хранилища не включена в выпуск Windows Server 2019 Evaluation

При использовании для подключения к Windows Admin Center [Windows Server 2019 ознакомительный выпуск](https://www.microsoft.com/evalcenter/evaluate-windows-server-2019) не существует возможность управлять службой хранилища миграции. Служба миграции хранилища также не включена в роли и компоненты.

Эта проблема вызвана проблемы обслуживания в Windows Server 2019 носитель для оценки. 

Чтобы обойти эту проблему, установите розничной торговли, MSDN, OEM или корпоративной лицензии версии Windows Server 2019 и не активировать его. Без активации все выпуски Windows Server работают в режиме оценки в 180 дней. 

Мы исправили эту ошибку в более позднем выпуске Windows Server 2019.  

## <a name="storage-migration-service-times-out-downloading-the-transfer-error-csv"></a>Время ожидания загрузки ошибки передачи CSV миграции службы хранилища

При использовании Windows Admin Center или PowerShell для загрузки передачи операций подробные ошибки журналов только для CSV, возникает ошибка:

 >   Перемещение журнала - убедитесь в том, общий доступ к файлам допускается в брандмауэре. : Эта операция запроса, отправленных к NET.TCP://localhost: 28940/sms/service/1/передача не получил ответ в течение настроенного времени ожидания (00: 01:00). Время, выделенное для выполнения этой операции может составной частью более длительного времени ожидания. Это может быть, поскольку служба по-прежнему обрабатывает операцию или службе не удалось отправить ответное сообщение. Попробуйте увеличить время ожидания операции (путем приведения канала/прокси к IContextChannel и изменения свойства OperationTimeout) и убедитесь, что служба является возможность подключения к клиенту.

Эта проблема вызвана очень большое число переданных файлов, которые не могут быть отфильтрованы в одну минуту время ожидания по умолчанию, допустимый для службы хранилища миграции. 

Чтобы обойти эту проблему:

1. На компьютере orchestrator, внесите *%SYSTEMROOT%\SMS\Microsoft.StorageMigration.Service.exe.config* файлов с помощью Notepad.exe для изменения «sendTimeout» по умолчанию 1 минуты до 10 минут

   ```
     <bindings>
      <netTcpBinding>
        <binding name="NetTcpBindingSms"
                 sendTimeout="00:01:00"
   ```

2. Перезапустите службу «Служба миграции хранилища» на компьютере orchestrator. 
3. На компьютере orchestrator запустите Regedit.exe
4. Найдите и выберите следующий подраздел реестра. 

   `HKEY_LOCAL_MACHINE\\Software\\Microsoft\\SMSPowershell`

5. В меню "Правка" выберите пункт "Создать", а затем выберите "Значение DWORD". 
6. Введите «WcfOperationTimeoutInMinutes» для имени ПАРАМЕТРА и нажмите клавишу ВВОД.
7. Щелкните правой кнопкой мыши «WcfOperationTimeoutInMinutes» и выберите команду Изменить. 
8. В окне базовых данных нажмите кнопку «Decimal»
9. В поле "значение" введите «10» и нажмите кнопку ОК.
10. Закройте редактор реестра.
11. Попытка повторно загрузить CSV-файл только для ошибок. 

Мы собираемся изменить это поведение в более позднем выпуске Windows Server 2019.  

## <a name="cutover-fails-when-migrating-between-networks"></a>Прямая миграция завершается ошибкой при переносе между сетями

При миграции на конечный компьютер под управлением в другой сети, чем исходный, например в экземпляре Azure IaaS, прямая миграция не удается завершить используя источник был статический IP-адрес. 

Это сделано намеренно, чтобы предотвратить проблемы с подключением после миграции из пользователей, приложений и скриптов, подключение по IP-адресу. При перемещении IP-адрес со старого компьютера источника новый целевой объект назначения, она не будет соответствовать новые сведения о подсети сети и возможно DNS и WINS.

Чтобы решить эту проблему, выполнить миграцию на компьютер в одной сети. Затем переместите этого компьютера к новой сети и переназначить его сведения IP-адрес. К примеру Если Миграция в Azure IaaS, сначала перейти на локальной виртуальной Машине, а затем использовать "Миграция Azure", чтобы переместить виртуальную Машину Azure.  

Мы исправили эту ошибку в более поздних версиях Windows Admin Center. Мы будем теперь позволяют пользователю указать миграций, которые не изменяют параметры сети конечного сервера. Обновленные расширения отображаются здесь при выпуске. 

## <a name="validation-warnings-for-destination-proxy-and-credential-administrative-privileges"></a>Предупреждения проверки для назначения прокси-сервера и учетные данные администратора

При проверке задание передачи, см. следующие предупреждения:

 > **Учетные данные с правами администратора.**
 > Предупреждение: Действие недоступно удаленно.
 > **Регистрируется на прокси-сервер назначения.**
 > Предупреждение: Прокси-сервер назначения не найден.

Если вы не установили службы прокси-сервера для службы хранилища миграции на конечном компьютере Windows Server 2019 или является означает компьютер Windows Server 2016 или Windows Server 2012 R2, это сделано намеренно. Мы рекомендуем переход на компьютере Windows Server 2019 с прокси-сервер для передачи были существенно улучшены производительность.  

## <a name="certain-files-do-not-inventory-or-transfer-error-5-access-is-denied"></a>Не проводить инвентаризацию и передачи определенных файлов, ошибка 5 «доступ запрещен»

При инвентаризации или передачу файлов из источника в конечных компьютеров, файлов, из которых пользователь удалены разрешения группы администраторов не перенести. Проверка миграции хранилища службы-прокси отладки показано:

  Имя журнала:      Microsoft-Windows-StorageMigrationService-Proxy/Debug Source:        Microsoft-Windows-StorageMigrationService-Proxy Date:          2/26/2019 г., 9:00:04 по ИД события:      Категория 10000 задачи: Ни один уровень:         Ключевые слова ошибки:      
  Пользователь:          : СЕТЕВОЙ службы srv1.contoso.com Описание:

  Ошибки передачи 02/26/2019-09:00:04.860 [ошибка] для \\srv1.contoso.com\public\indy.png: (5) в доступе.
Трассировка стека: В Microsoft.StorageMigration.Proxy.Service.Transfer.FileDirUtils.OpenFile (строка fileName, DesiredAccess desiredAccess, ShareMode shareMode, CreationDisposition creationDisposition, FlagsAndAttributes flagsAndAttributes) в Microsoft.StorageMigration.Proxy.Service.Transfer.FileDirUtils.GetTargetFile (строка путь) в Microsoft.StorageMigration.Proxy.Service.Transfer.FileDirUtils.GetTargetFile (FileInfo файл) в Microsoft.StorageMigration.Proxy.Service.Transfer.FileTransfer.InitializeSourceFileInfo() в Microsoft.StorageMigration.Proxy.Service.Transfer.FileTransfer.Transfer() в Microsoft.StorageMigration.Proxy.Service.Transfer.FileTransfer.TryTransfer() [d:\os\src\base\dms\proxy\transfer\transferproxy\FileTransfer.cs::TryTransfer::55]


Эта проблема вызвана миграции службы хранилища, где резервного копирования привилегии вызвана ошибкой в коде. 

Чтобы устранить эту проблему, установите [Windows Update 2 апреля 2019 г. — KB4490481 (ОС сборки 17763.404)](https://support.microsoft.com/help/4490481/windows-10-update-kb4490481) на компьютере orchestrator и конечном компьютере, если установлена служба прокси-сервера. Убедитесь, что учетная запись пользователя миграции исходного локального администратора на исходном компьютере и оркестратор миграции службы хранилища. Убедитесь, что пользователь миграции целевой учетной записи локального администратора на целевом компьютере, а также оркестратор миграции службы хранилища. 

## <a name="dfsr-hashes-mismatch-when-using-storage-migration-service-to-preseed-data"></a>Несоответствие хэши DFSR при использовании миграции службы хранилища для предварительно заполнить данные

При использовании миграции службы хранилища для передачи файлов в новое место назначения, Настройка репликации DFS (DFSR) для репликации данных с существующего сервера DFSR через presseded репликации или DFSR клонирование базы данных, все файлы experiemce хэша Несоответствие и являются повторно реплицировано. Потоки данных, потоки безопасности, размеры и атрибуты, которые относятся к вполне совпадать после их передачи с помощью SMS. Проверке файлы с ICACLS или журнале отладки базы данных DFSR для клонирования раскрывает:

Исходный файл:

  icacls d:\test\Source:

  icacls d:\test\thatcher.png/сохранение out.txt /t thatcher.png D:AI(A;; ОС;; BA) (A; 0 x1200a9;; D (Г) (A; 0 x1301bf;; D U) (A; ИДЕНТИФИКАТОР; ОС;; BA) (A; ИДЕНТИФИКАТОР; ОС;; SY) (A; ИДЕНТИФИКАТОР; 0X1200A9;; BU)

Конечный файл:

  icacls d:\test\thatcher.png /save out.txt /t thatcher.png D:AI(A;;FA;;;BA)(A;;0x1301bf;;;DU)(A;;0x1200a9;;;DD)(A;ID;FA;;;BA)(A;ID;FA;;;SY)(A;ID;0x1200a9;;;BU)**S:PAINO_ACCESS_CONTROL**

Журнал отладки DFSR:

  Найдено 3948 записи несоответствие DBClone::IDTableImportUpdate DBCL 4045 [предупреждение] 20190308 10:18:53.116. 

  Локальный ACL хэш: 1BCDFE03-A18BCE01-D1AE9859-18:09:44.876 LastWriteTime:20190308 23A0A5F6 FileSizeLow:1131654 FileSizeHigh:0 Атрибуты: 32 

  Клонировать хэш ACL:**DDC4FCE4 DDF329C4-977CED6D F4D72A5B** LastWriteTime:20190308 18:09:44.876 FileSizeLow:1131654 FileSizeHigh:0 Атрибуты: 32 

Эта проблема вызвана дефект кода в библиотеке, используемый службой миграции хранилища для задания аудит безопасности списки управления доступом (SACL). Непреднамеренно имеет значение SACL отличное от null, если системный список управления ДОСТУПОМ был пуст, начальные DFSR, чтобы правильно определить несоответствие хэша. 

Чтобы решить эту проблему, продолжить использование Robocopy для [DFSR с предварительным заполнением и базы данных DFSR операций клонирования](../dfs-replication/preseed-dfsr-with-robocopy.md) вместо миграции службы хранилища. Мы изучаем эту проблему и планируется устранить эту проблему в более поздней версии, Windows Server и, возможно, дистрибутивы Windows Update. 

## <a name="error-404-when-downloading-csv-logs"></a>Журналы ошибок 404 при загрузке CSV-ФАЙЛ

При попытке загрузить журналы передачи или ошибки в конце операции передачи, возникает ошибка:

  $jobname: Перенос журнала: ajax ошибка 404

Эта ошибка возникает в том случае, если правило брандмауэра «Файла и общим доступом принтерам (SMB-In)» на сервере orchestrator не включен. Загрузка файлов Windows Admin Center требуется порт TCP/445 (SMB) на подключенных компьютерах.  

## <a name="error-couldnt-transfer-storage-on-any-of-the-endpoints-when-transfering-from-windows-server-2008-r2"></a>Ошибка «не удалось перенести хранилище на любой конечной точке» при передаче из Windows Server 2008 R2

При попытке передачи данных с исходного компьютера Windows Server 2008 R2, не trasnfers данных и возникает ошибка:  

  Не удалось перенести хранилище на любой из конечных точек.
0x9044

Эта ошибка возникает в том случае, если компьютер Windows Server 2008 R2 не полностью обновить все критические и важные обновления из центра обновления Windows. Независимо от миграции службы хранилища мы рекомендуем всегда исправления компьютера Windows Server 2008 R2 в целях безопасности как для этой операционной системы не содержит усовершенствования системы безопасности, более новых версиях Windows Server.

## <a name="see-also"></a>См. также

- [Общие сведения о миграции службы хранилища](overview.md)
