---
title: Известные проблемы со службой миграции хранилища
description: Известные проблемы и устранение неполадок службы миграции хранилища, например получение журналов для служба поддержки Майкрософт.
author: nedpyle
ms.author: nedpyle
manager: siroy
ms.date: 10/09/2019
ms.topic: article
ms.prod: windows-server
ms.technology: storage
ms.openlocfilehash: 9abe199399e577eb06044377c30d5a2dc0e35dd1
ms.sourcegitcommit: e817a130c2ed9caaddd1def1b2edac0c798a6aa2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/09/2019
ms.locfileid: "74945231"
---
# <a name="storage-migration-service-known-issues"></a>Известные проблемы со службой миграции хранилища

Этот раздел содержит ответы на известные проблемы, возникающие при использовании [службы миграции хранилища](overview.md) для миграции серверов.

Служба миграции хранилища выпускается в два этапа: служба в Windows Server и пользовательский интерфейс в центре администрирования Windows. Служба доступна в Windows Server, долгосрочном канале обслуживания, а также на Windows Server, полугодовой канал; Хотя центр администрирования Windows доступен для загрузки отдельно. Мы также периодически включаем изменения в накопительные обновления для Windows Server, выпущенные с помощью Центр обновления Windows. 

Например, Windows Server версии 1903 включает новые функции и исправления для службы миграции хранилища, которые также доступны для Windows Server 2019 и Windows Server версии 1809 путем установки [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534).

## <a name="collecting-logs"></a>Как получать файлы журналов при работе с служба поддержки Майкрософт

Служба миграции хранилища содержит журналы событий для службы Orchestrator и прокси-службы. Сервер урчестратор всегда содержит оба журнала событий, а целевые серверы с установленной службой прокси содержат журналы прокси-сервера. Эти журналы находятся в папке:

- Журналы приложений и служб \ Microsoft \ Windows \ Сторажемигратионсервице
- Журналы приложений и служб \ Microsoft \ Windows \ Сторажемигратионсервице-proxy

Если необходимо собрать эти журналы для просмотра в автономном режиме или для отправки в служба поддержки Майкрософт, в GitHub доступен сценарий PowerShell с открытым исходным кодом:

 [Вспомогательная служба службы миграции хранилища](https://aka.ms/smslogs) 

Ознакомьтесь с ФАЙЛОМ README для использования.

## <a name="storage-migration-service-doesnt-show-up-in-windows-admin-center-unless-managing-windows-server-2019"></a>Служба миграции хранилища не отображается в центре администрирования Windows, если управление Windows Server 2019 не выполняется.

При использовании версии 1809 центра администрирования Windows для управления Windows Server 2019 Orchestrator не отображается параметр средства для службы миграции хранилища. 

Расширение "Служба миграции хранилища центра администрирования Windows" привязано к версии только для Windows Server 2019 версии 1809 или более поздних операционных систем. Если вы используете ее для управления более старыми операционными системами Windows Server или предварительными версиями Insider Preview, это средство не будет отображаться. Это поведение реализовано намеренно. 

Чтобы разрешить, используйте или обновите до Windows Server 2019 Build 1809 или более поздней версии.

## <a name="storage-migration-service-cutover-validation-fails-with-error-access-is-denied-for-the-token-filter-policy-on-destination-computer"></a>Сбой проверки прямую миграцию службы миграции хранилища с ошибкой "отказано в доступе для политики фильтрации токенов на конечном компьютере"

При выполнении проверки прямую миграцию появляется сообщение об ошибке "ошибка: доступ запрещен для политики фильтрации маркеров на конечном компьютере". Это происходит даже в том случае, если указаны правильные учетные данные локального администратора для исходного и конечного компьютеров.

Эта проблема была исправлена в обновлении [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) . 

## <a name="storage-migration-service-isnt-included-in-windows-server-2019-evaluation-or-windows-server-2019-essentials-edition"></a>Служба переноса хранилища не входит в ознакомительную версию Windows Server 2019 или Windows Server 2019 Essentials

При использовании центра администрирования Windows для подключения к [ознакомительному выпуску Windows server 2019](https://www.microsoft.com/evalcenter/evaluate-windows-server-2019) или windows Server 2019 Essentials нет возможности управлять службой миграции хранилища. Служба миграции хранилища также не входит в роли и компоненты.

Эта проблема вызвана проблемой обслуживания в ознакомительной версии Windows Server 2019 и Windows Server 2019 Essentials. 

Чтобы обойти эту ошибку для ознакомительной версии, установите розничную, MSDN, OEM или корпоративную лицензию Windows Server 2019 и не активируйте ее. Без активации все выпуски Windows Server работают в режиме оценки 180 дней. 

Мы устранили эту ошибку в более позднем выпуске Windows Server.  

## <a name="storage-migration-service-times-out-downloading-the-transfer-error-csv"></a>Истекло время ожидания для службы миграции хранилища при скачивании CSV-файла ошибки переноса

При использовании Windows Admin Center или PowerShell для загрузки подробных сведений об ошибках операций перемещения — только журнал CSV, появляется сообщение об ошибке:

 >   Журнал перемещений. Убедитесь, что в брандмауэре разрешен общий доступ к файлам. : Эта операция запроса, отправленная в NET. TCP://localhost: 28940/SMS/Service/1/Send, не получила ответ в течение заданного времени ожидания (00:01:00). Возможно, выделенное для этой операции время было частью более длительного времени ожидания. Это может быть связано с тем, что служба продолжает обрабатывать операцию, или что службе не удалось отправить ответное сообщение. Попробуйте увеличить время ожидания операции (путем приведения канала или прокси-сервера к адрес IContextChannel и установки свойства OperationTimeout) и убедитесь, что служба может подключиться к клиенту.

Эта проблема вызвана очень большим количеством переданных файлов, которые не могут быть отфильтрованы по умолчанию в течение минуты времени ожидания, разрешенного службой миграции хранилища. 

Для разрешения этой проблемы необходимо выполнить следующие действия.

1. На компьютере Orchestrator измените файл *%системрут%\смс\микрософт.сторажемигратион.сервице.ЕКСЕ.конфиг* с помощью программы Notepad. exe, чтобы изменить значение "SendTimeout" с 1 минуты по умолчанию на 10 минут.

   ```
     <bindings>
      <netTcpBinding>
        <binding name="NetTcpBindingSms"
                 sendTimeout="00:01:00"
   ```

2. Перезапустите службу "Служба миграции хранилища" на компьютере Orchestrator. 
3. На компьютере Orchestrator запустите программу regedit. exe.
4. Найдите и выберите следующий подраздел реестра. 

   `HKEY_LOCAL_MACHINE\Software\Microsoft\SMSPowershell`

5. В меню "Правка" выберите пункт "Создать", а затем выберите "Значение DWORD". 
6. Введите "Вкфоператионтимеаутинминутес" в качестве имени DWORD и нажмите клавишу ВВОД.
7. Щелкните правой кнопкой мыши "Вкфоператионтимеаутинминутес" и выберите команду "Изменить". 
8. В поле Базовые данные щелкните "десятичное число"
9. В поле данные значения введите "10", а затем нажмите кнопку ОК.
10. Закройте редактор реестра.
11. Попытайтесь снова скачать CSV-файл с ошибками. 

Мы планируем изменить это поведение в более позднем выпуске Windows Server 2019.  

## <a name="validation-warnings-for-destination-proxy-and-credential-administrative-privileges"></a>Предупреждения проверки для прокси-сервера назначения и права администратора учетных данных

При проверке задания перемещения отображаются следующие предупреждения.

 > **Учетные данные имеют права администратора.**
 > Предупреждение: действие удаленно недоступно.
 > **Целевой прокси-сервер зарегистрирован.**
 > Предупреждение: целевой прокси-сервер не найден.

Если вы не установили прокси-службу службы миграции хранилища на конечный компьютер с Windows Server 2019, или на целевом компьютере установлена ОС Windows Server 2016 или Windows Server 2012 R2, это поведение предназначено для разработки. Мы рекомендуем перейти на компьютер под Windows Server 2019 с установленным прокси-сервером, чтобы значительно повысить производительность переноса.  

## <a name="certain-files-do-not-inventory-or-transfer-error-5-access-is-denied"></a>Некоторые файлы не передаются или переносятся, ошибка 5 "доступ запрещен"

При инвентаризации или передаче файлов из источника на конечные компьютеры файлы, из которых пользователь удалил разрешения группы администраторов, не смогут выполнить миграцию. Проверка службы миграции хранилища — Отладка прокси показывает:

  Имя журнала: Microsoft-Windows-Сторажемигратионсервице-proxy/Debug Source: Microsoft-Windows-Сторажемигратионсервице-proxy Дата: 2/26/2019 9:00:04 AM ИД события: 10000 Категория задачи: нет уровня: ключевые слова ошибок:      
  Пользователь: компьютер сетевой службы: srv1.contoso.com Описание:

  02/26/2019-09:00:04.860 [Ошибка] ошибка при переносе для \\SRV1. contoso. ком\публик\инди.ПНГ: (5) отказано в доступе.
Трассировка стека: в Microsoft. Сторажемигратион. Proxy. Service. Trace. Филедирутилс. OpenFile (строковое имя файла, Десиредакцесс Десиредакцесс, Шаремоде Шаремоде, CreationDisposition creationDisposition, Флагсандаттрибутес flagsAndAttributes) в Microsoft. Сторажемигратион. Proxy. Service. Перемещение. Филедирутилс. Жеттаржетфиле (строковый путь) в Microsoft. Сторажемигратион. Proxy. Service. Re. Филедирутилс. Жеттаржетфиле (FileInfo-файл) в Microsoft. Сторажемигратион. Proxy. Service. передает. Филетрансфер. Инитиализесаурцефилеинфо () в Microsoft. Сторажемигратион. Proxy. Service. Re. Филетрансфер. reby () в Microsoft. Сторажемигратион. Proxy. Service. Перемещение. Филетрансфер. Тритрансфер () [Д:\ос\срк\басе\дмс\прокси\трансфер\трансферпрокси\филетрансфер.КС:: TryTransfer:: 55]


Эта проблема вызвана дефектом кода в службе миграции хранилища, в котором не были вызваны права на резервное копирование. 

Чтобы устранить эту проблему, установите [Центр обновления Windows 2 апреля 2019 г. — KB4490481 (сборка ос 17763,404)](https://support.microsoft.com/help/4490481/windows-10-update-kb4490481) на компьютере Orchestrator и конечном компьютере, если прокси-служба установлена там. Убедитесь, что исходная учетная запись миграции пользователя является локальным администратором на исходном компьютере и службой миграции хранилища Orchestrator. Убедитесь, что учетная запись миграции конечного пользователя является локальным администратором на конечном компьютере и службой миграции хранилища Orchestrator. 

## <a name="dfsr-hashes-mismatch-when-using-storage-migration-service-to-preseed-data"></a>Несоответствие хэшей DFSR при использовании службы миграции хранилища для предзаполнения данных

Когда вы используете службу миграции хранилища для переноса файлов в новое место назначения, а затем настраиваете репликация DFS (DFSR) для репликации этих данных с имеющимся сервером DFSR через предварительно заполненную репликацию или клонирование базы данных DFSR, все файлы експериемце хэш-код несоответствие и повторно реплицируются. Все потоки данных, потоки безопасности, размеры и атрибуты полностью совпадают после использования SMS для их перемещения. При проверке файлов с помощью ICACLS или журнала отладки клонирования базы данных DFSR выясняется следующее:

Исходный файл:

  icacls Д:\тест\саурце:

  icacls д:\тест\сатчер.ПНГ/Save out. txt/t Сатчер. png Д:АИ (A;; ОС;;; BA) (A;; 0 x1200a9;;;D D) (A;; 0 x1301bf;;;D U) (A; ИДЕНТИФИКАТОР; ОС;;; BA) (A; ИДЕНТИФИКАТОР; ОС;;; SY) (A; ID; 0x1200a9;;; BU

Конечный файл:

  icacls д:\тест\сатчер.ПНГ/Save out. txt/t Сатчер. png Д:АИ (A;; ОС;;; BA) (A;; 0 x1301bf;;;D U) (A;; 0 x1200a9;;;D D) (A; ИДЕНТИФИКАТОР; ОС;;; BA) (A; ИДЕНТИФИКАТОР; ОС;;; SY) (A; ID; 0x1200a9;;; BU)**S: PAINO_ACCESS_CONTROL**

Журнал отладки DFSR:

  20190308 10:18:53.116 3948 ДБКЛ 4045 [WARN] Дбклоне:: не удалось найти запись о несоответствии Идтаблеимпортупдате. 

  Локальный хэш ACL: 1BCDFE03-A18BCE01-D1AE9859-23A0A5F6 LastWriteTime: 20190308 18:09:44.876 Филесизелов: 1131654 Филесизехигх: 0 Атрибуты: 32 

  Клонировать хэш ACL:**DDC4FCE4-DDF329C4-977CED6D-F4D72A5B** LastWriteTime: 20190308 18:09:44.876 филесизелов: 1131654 филесизехигх: 0 Атрибуты: 32 

Эта проблема устранена с помощью обновления [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534)

## <a name="error-couldnt-transfer-storage-on-any-of-the-endpoints-when-transferring-from-windows-server-2008-r2"></a>Ошибка "не удалось передать хранилище на любую из конечных точек" при передаче из Windows Server 2008 R2

При попытке передачи данных с исходного компьютера Windows Server 2008 R2 передача данных не происходит и возникает ошибка:  

  Не удалось переместить хранилище на любую из конечных точек.
0x9044

Эта ошибка возникает, если на компьютере под Windows Server 2008 R2 не установлено полное обновление со всеми критически важными и важными обновлениями Центр обновления Windows. Независимо от службы миграции хранилища, мы всегда рекомендуем установить исправление для безопасности компьютера под управлением Windows Server 2008 R2, так как эта операционная система не содержит улучшений безопасности более новых версий Windows Server.

## <a name="error-couldnt-transfer-storage-on-any-of-the-endpoints-and-check-if-the-source-device-is-online---we-couldnt-access-it"></a>Ошибка "не удалось переместить хранилище на любую из конечных точек" и "проверить, подключено ли исходное устройство к сети."

При попытке переместить данные с исходного компьютера некоторые или все общие папки не передаются, со сводной ошибкой:

   Не удалось переместить хранилище на любую из конечных точек.
0x9044

При проверке сведений о переносе SMB отображается ошибка:

   Проверьте, подключено ли исходное устройство к сети. не удалось получить к нему доступ.

Просмотр журнала событий Сторажемигратионсервице/Admin показывает:

   Не удалось переместить хранилище.

   Задание: идентификатор Job1:  
   Состояние: ошибка "сбой": 36931 сообщение об ошибке: 

   Руководство. Проверьте подробные сведения об ошибке и убедитесь, что выполнены требования к переносу. Заданию перемещения не удалось переместить исходные и конечные компьютеры. Это может быть вызвано тем, что компьютеру Orchestrator не удалось достичь доступа к исходным или конечным компьютерам, возможно, из-за правила брандмауэра или отсутствия разрешений.

При проверке журнала Сторажемигратионсервице-proxy/Debug отображаются следующие сведения:

   07/02/2019-13:35:57.231 [Ошибка] сбой проверки перемещения. ErrorCode: 40961, конечная точка источника недоступна или не существует, либо исходные учетные данные недопустимы, или у пользователя, прошедшего проверку, недостаточно разрешений для доступа к нему.
в Microsoft. Сторажемигратион. Proxy. Service. reby. Трансфероператион. Validate () в Microsoft. Сторажемигратион. Proxy. Service. Re. Трансферрекуессандлер. ProcessRequest (Филетрансферрекуест fileTransferRequest, идентификатор GUID)    [Д:\ос\срк\басе\дмс\прокси\трансфер\трансферпрокси\трансферрекуессандлер.КС::

Это был дефект кода, который был бы манифестом, если у учетной записи миграции нет разрешений по крайней мере на чтение для общих ресурсов SMB. Эта проблема была впервые исправлена в накопительном обновлении [4520062](https://support.microsoft.com/help/4520062/windows-10-update-kb4520062). 

## <a name="error-0x80005000-when-running-inventory"></a>Ошибка 0x80005000 при выполнении инвентаризации

После установки [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) и попытки запустить инвентаризацию происходит сбой инвентаризации с ошибками:

  ИСКЛЮЧЕНИЕ из HRESULT: 0x80005000
  
  Имя журнала: Microsoft-Windows-Сторажемигратионсервице/Admin Source: Microsoft-Windows-Сторажемигратионсервице Дата: 9/9/2019 5:21:42 PM ИД события: 2503 Категория задачи: нет уровня: ключевые слова ошибок:      
  Пользователь: компьютер сетевой службы: FS02. Описание TailwindTraders.net: не удалось выполнить инвентаризацию компьютеров.
Задание: Foo2 ID: 20ac3f75-4945-41d1-9a79-d11dbb57798b State: Failed Error: 36934 сообщение об ошибке: не удалось выполнить инвентаризацию для всех устройств. Ознакомьтесь с подробными сведениями об ошибке и убедитесь, что соблюдены требования к инвентаризации. Заданию не удалось выполнить инвентаризацию указанных исходных компьютеров. Это может быть вызвано тем, что компьютеру Orchestrator не удалось связаться с ним по сети, возможно, из-за правила брандмауэра или отсутствия разрешений.
  
  Имя журнала: Microsoft-Windows-Сторажемигратионсервице/Admin Source: Microsoft-Windows-Сторажемигратионсервице Дата: 9/9/2019 5:21:42 PM ИД события: 2509 Категория задачи: нет уровня: ключевые слова ошибок:      
  Пользователь: компьютер сетевой службы: FS02. Описание TailwindTraders.net: не удалось выполнить инвентаризацию компьютера.
Задание: Foo2 Computer: FS01. TailwindTraders.net State: Failed Error:-2147463168 сообщение об ошибке: см. инструкции по проверке подробной ошибки и соблюдению требований к инвентаризации. Инвентаризации не удалось определить какие бы то ни было аспекты указанного исходного компьютера. Это может быть вызвано отсутствием разрешений или привилегиями в источнике или заблокированным портом брандмауэра.
  
Эта ошибка вызвана дефектом кода в службе миграции хранилища при предоставлении учетных данных миграции в виде имени участника-пользователя (UPN), например "meghan@contoso.com". Службе Orchestrator Migration Service не удается правильно проанализировать этот формат, что приводит к сбою уточняющего запроса домена, добавленного для поддержки миграции кластера в KB4512534 и 19H1.

Чтобы обойти эту проблему, укажите учетные данные в формате домен \ пользователь, например "Контосо\мегхан".

## <a name="error-serviceerror0x9006-or-the-proxy-isnt-currently-available-when-migrating-to-a-windows-server-failover-cluster"></a>Ошибка "ServiceError0x9006" или "прокси-сервер в настоящее время недоступен". При переходе на отказоустойчивый кластер Windows Server

При попытке перемещения данных на кластеризованный файловый сервер появляются следующие ошибки: 

   Убедитесь, что прокси-служба установлена и запущена, и повторите попытку. Прокси-сервер в настоящее время недоступен.
0x9006 ServiceError0x9006, Microsoft. Сторажемигратион. Commands. Унрегистерсмспроксикомманд

Эта ошибка возникает, если ресурс файлового сервера перемещен с исходного узла владельца кластера Windows Server 2019 на новый узел, а функция прокси-сервера службы миграции хранилища не установлена на этом узле.

Чтобы избежать этого, переместите целевой ресурс файлового сервера обратно на исходный узел кластера владельца, который использовался при первой настройке пар передачи.

В качестве альтернативного решения:

1. Установите компонент прокси-сервера службы миграции хранилища на всех узлах кластера.
2. Выполните следующую команду PowerShell для службы миграции хранилища на компьютере Orchestrator: 

   ```PowerShell
   Register-SMSProxy -ComputerName *destination server* -Force
   ```
## <a name="error-dll-was-not-found-when-running-inventory-from-a-cluster-node"></a>Ошибка "DLL не найдена" при выполнении инвентаризации с узла кластера

При попытке запустить инвентаризацию с помощью службы миграции хранилища Orchestrator, установленной на узле отказоустойчивого кластера Windows Server 2019 и нацеливания на общий источник файлового сервера отказоустойчивого кластера Windows Server, появляется следующее сообщение об ошибке:

    DLL not found
    [Error] Failed device discovery stage VolumeInfo with error: (0x80131524) Unable to load DLL 'Microsoft.FailoverClusters.FrameworkSupport.dll': The specified module could not be found. (Exception from HRESULT: 0x8007007E)   

Чтобы решить эту проблему, установите "средства управления отказоустойчивыми кластерами" (RSAT-Cluster-Management) на сервере, на котором запущена служба миграции хранилища Orchestrator. 

## <a name="error-there-are-no-more-endpoints-available-from-the-endpoint-mapper-when-running-inventory-against-a-windows-server-2003-source-computer"></a>Ошибка "при выполнении инвентаризации с исходным компьютером Windows Server 2003 больше нет доступных конечных точек"

При попытке запустить инвентаризацию с помощью накопительного пакета обновления для службы миграции хранилища, исправленного в [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) или более поздней версии, появляется следующее сообщение об ошибке:

    There are no more endpoints available from the endpoint mapper  

Чтобы решить эту проблему, временно удалите накопительный пакет обновления KB4512534 (и все его заменяющие) с компьютера Orchestrator службы миграции хранилища. После завершения миграции переустановите Последнее накопительное обновление.  

Обратите внимание, что в некоторых обстоятельствах удаление KB4512534 или заменяющих обновлений может привести к тому, что служба миграции хранилища больше не будет запущена. Чтобы устранить эту проблему, можно создать резервную копию и удалить базу данных службы миграции хранилища:

1.  Откройте командную строку с повышенными привилегиями, в которой вы являетесь членом группы администраторов на сервере Orchestrator службы миграции хранилища, и выполните следующую команду:

     ```
     TAKEOWN /d y /a /r /f c:\ProgramData\Microsoft\StorageMigrationService
     
     MD c:\ProgramData\Microsoft\StorageMigrationService\backup

     ICACLS c:\ProgramData\Microsoft\StorageMigrationService\* /grant Administrators:(GA)

     XCOPY c:\ProgramData\Microsoft\StorageMigrationService\* .\backup\*

     DEL c:\ProgramData\Microsoft\StorageMigrationService\* /q

     ICACLS c:\ProgramData\Microsoft\StorageMigrationService  /GRANT networkservice:F /T /C

     ICACLS c:\ProgramData\Microsoft\StorageMigrationService /GRANT networkservice:(GA) /T /C
     ```
   
2.  Запустите службу миграции хранилища, которая создаст новую базу данных.

## <a name="error-clusctl_resource_netname_repair_vco-failed-against-netname-resource-and-windows-server-2008-r2-cluster-cutover-fails"></a>Ошибка "сбой CLUSCTL_RESOURCE_NETNAME_REPAIR_VCO для ресурса netName" и кластера Windows Server 2008 R2, сбой прямую миграцию

При попытке выполнить операцию вырезания источника кластера Windows Server 2008 R2 на этапе "Переименование исходного компьютера" зависает. появится следующая ошибка:

    Log Name:      Microsoft-Windows-StorageMigrationService-Proxy/Debug
    Source:        Microsoft-Windows-StorageMigrationService-Proxy
    Date:          10/17/2019 6:44:48 PM
    Event ID:      10000
    Task Category: None
    Level:         Error
    Keywords:      
    User:          NETWORK SERVICE
    Computer:      WIN-RNS0D0PMPJH.contoso.com
    Description:
    10/17/2019-18:44:48.727 [Erro] Exception error: 0x1. Message: Control code CLUSCTL_RESOURCE_NETNAME_REPAIR_VCO failed against netName resource 2008r2FS., stackTrace:    at Microsoft.FailoverClusters.Framework.ClusterUtils.NetnameRepairVCO(SafeClusterResourceHandle netNameResourceHandle, String netName)
       at Microsoft.FailoverClusters.Framework.ClusterUtils.RenameFSNetName(SafeClusterHandle ClusterHandle, String clusterName, String FsResourceId, String NetNameResourceId, String newDnsName, CancellationToken ct)
       at Microsoft.StorageMigration.Proxy.Cutover.CutoverUtils.RenameFSNetName(NetworkCredential networkCredential, Boolean isLocal, String clusterName, String fsResourceId, String nnResourceId, String newDnsName, CancellationToken ct)    [d:\os\src\base\dms\proxy\cutover\cutoverproxy\CutoverUtils.cs::RenameFSNetName::1510]

Эта проблема вызвана отсутствием API в более ранних версиях Windows Server. В настоящее время невозможно перенести кластеры Windows Server 2008 и Windows Server 2003. Вы можете выполнять инвентаризацию и перенос без проблем в кластерах Windows Server 2008 R2, а затем вручную выполнять прямую миграцию, вручную изменяя и IP-адрес исходного файлового сервера в кластере, а затем изменяя NetName и IP-адреса конечного кластера. адрес, соответствующий исходному источнику. 

## <a name="cutover-hangs-on-38-mapping-network-interfaces-on-the-source-computer"></a>Прямую миграцию зависает на "38% сопоставлении сетевых интерфейсов на исходном компьютере..." 

При попытке выполнить вырезание с исходного компьютера с установленным исходным компьютером на использование нового статического (не DHCP) IP-адреса в одном или нескольких сетевых интерфейсах на этапе «вырезание на уровне "38% сопоставлений сетевых интерфейсов на источнике комнпутер..." в журнале событий SMS появится следующая ошибка:

    Log Name:      Microsoft-Windows-StorageMigrationService-Proxy/Admin
    Source:        Microsoft-Windows-StorageMigrationService-Proxy
    Date:          11/13/2019 3:47:06 PM
    Event ID:      20494
    Task Category: None
    Level:         Error
    Keywords:      
    User:          NETWORK SERVICE
    Computer:      orc2019-rtm.corp.contoso.com
    Description:
    Couldn't set the IP address on the network adapter.

    Computer: fs12.corp.contoso.com
    Adapter: microsoft hyper-v network adapter
    IP address: 10.0.0.99
    Network mask: 16
    Error: 40970
    Error Message: Unknown error (0xa00a)

    Guidance: Confirm that the Netlogon service on the computer is reachable through RPC and that the credentials provided are correct.

Проверка исходного компьютера показывает, что исходный IP-адрес не меняется. 

Эта проблема не возникает, если выбран параметр "использовать DHCP" на экране "Настройка прямую миграцию" центра администрирования Windows, только если указан новый статический IP-адрес, подсеть и шлюз. 

Эта проблема вызвана регрессией обновления [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) . В настоящее время существует два способа решения этой проблемы:

  - Перед вырезанием: вместо установки нового статического IP-адреса на прямую миграцию выберите "использовать DHCP" и убедитесь, что область DHCP охватывает эту подсеть. Сервер SMS настроит исходный компьютер на использование DHCP на исходных компьютерах и выполнит переработку, как обычно. 
  
  - Если вырезание уже остановлено: Войдите на исходный компьютер и включите DHCP для сетевых интерфейсов, убедившись, что область DHCP охватывает эту подсеть. Когда исходный компьютер получает IP-адрес, предоставленный службой DHCP, сервер SMS продолжит работу с вырезанием в обычном режиме.
  
В обоих обходных решениях после вырезания по завершении можно установить статический IP-адрес на старом исходном компьютере в соответствии с последующим отображением и остановкой использования DHCP.   

## <a name="slower-than-expected-re-transfer-performance"></a>Медленнее, чем ожидаемая производительность повторной пересылки

После завершения перемещения и последующей повторной пересылки одних и тех же данных вы можете не заметить значительного улучшения времени на перемещение, даже если на исходном сервере изменились небольшие данные.

Это ожидаемое поведение при передаче очень большого количества файлов и вложенных папок. Размер данных не важен. Мы сначала внесли улучшения в это поведение в [KB4512534](https://support.microsoft.com/help/4512534/windows-10-update-kb4512534) и продолжаем оптимизировать производительность обмена. Чтобы еще больше настроить производительность, ознакомьтесь с [оптимизацией инвентаризации и производительности перемещения](https://docs.microsoft.com/windows-server/storage/storage-migration-service/faq#optimizing-inventory-and-transfer-performance).


## <a name="see-also"></a>См. также

- [Обзор службы миграции хранилища](overview.md)
