---
title: Как работает прямую миграцию в службе миграции хранилища
description: Сводка и подробные сведения о стадиях прямую миграцию в службе миграции хранилища
author: t-chrche
ms.author: t-chrche
manager: nedpyle
ms.date: 08/31/2020
ms.topic: article
ms.openlocfilehash: 1e886c505435976b6495e0460705821086781a62
ms.sourcegitcommit: 5344adcf9c0462561a4f9d47d80afc1d095a5b13
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2020
ms.locfileid: "90766907"
---
# <a name="how-cutover-works-in-storage-migration-service"></a>Как работает прямую миграцию в службе миграции хранилища

Прямую миграцию — это этап миграции, который перемещает сетевую идентификацию исходного компьютера на конечный компьютер. После прямую миграцию исходный компьютер по-прежнему будет содержать те же файлы, что и ранее, но не будет доступен пользователям и приложениям.

## <a name="summary"></a>Сводка

![Снимок экрана конфигурации прямую миграцию ](media/cutover/cutover_configuration.png)
 __. 1. Конфигурация прямую миграцию для службы миграции хранилища__

Перед запуском прямую миграцию укажите сведения о конфигурации сети, необходимые для перерезания с исходного компьютера на конечный. Можно также выбрать новое уникальное имя для исходного компьютера или позволить службе миграции хранилища создать случайную.

Затем служба миграции хранилища выполняет следующие действия для вырезания исходного компьютера на конечный компьютер:

1. Мы подключаемся к исходному и целевому компьютерам. В них должны быть включены следующие правила брандмауэра с включенными входящими:
    * Общий доступ к файлам и принтерам (входящий трафик SMB), TCP-порт 445
    * Служба входа в сеть (NP), TCP-порт 445
    * Инструментарий управления Windows (WMI) (DCOM в), TCP-порт 135
    * Инструментарий управления Windows (WMI) (WMI-in), TCP, любой порт

2. Мы устанавливаем разрешения безопасности на конечном компьютере в домен Active Directory Services в соответствии с разрешениями исходного компьютера.

3. Мы создадим временную локальную учетную запись пользователя на исходном компьютере. Если компьютер присоединен к домену, именем пользователя учетной записи будет «Мсфтсмсстормигратсвк». Мы отключим [политику фильтрации маркера локальной учетной записи](https://support.microsoft.com/help/951016/description-of-user-account-control-and-remote-restrictions-in-windows) на исходном компьютере, чтобы разрешить учетную запись, а затем подключаться к исходному компьютеру. Мы делаем эту временную учетную запись, чтобы при последующем перезапуске и удалении исходного компьютера из домена можно было по-прежнему получить доступ к исходному компьютеру.

4. Мы повторим предыдущий шаг на конечном компьютере.

5. Мы удалим исходный компьютер из домена, чтобы освободить учетную запись Active Directory, которая позже будет занимать конечный компьютер.

6. Мы сопоставлены сетевые интерфейсы на исходном компьютере и переименовали исходный компьютер.

7. Исходный компьютер добавляется обратно в домен. Исходный компьютер теперь имеет новое удостоверение и доступен для администраторов, но не для пользователей и приложений.

8. На исходном компьютере мы удалим все устаревшие имена других компьютеров, удалите временную локальную учетную запись, которую мы создали, и повторно включите политику фильтрации маркеров локальной учетной записи.

9. Конечный компьютер удаляется из домена.

10. Мы заменяем IP-адреса на конечном компьютере сведениями об IP-адресах, предоставленными источником, а затем переименование конечного компьютера в исходное имя исходного компьютера.

11. Мы присоединяем конечный компьютер к домену. При присоединении он использует исходную учетную запись Active Directory компьютера исходного компьютера. Это сохраняет членство в группах и ACL безопасности. Конечный компьютер теперь имеет удостоверение исходного компьютера.

12. На конечном компьютере мы удалим все устаревшие имена других компьютеров, удалите временную локальную учетную запись, которую мы создали, и повторно включите политику фильтрации маркеров локальной учетной записи, выполнив прямую миграцию.

После завершения прямую миграцию конечный компьютер потратил удостоверение исходного компьютера, а затем можно списать исходный компьютер.

## <a name="detailed-stages"></a>Подробные этапы

![Снимок экрана описания этапа прямую миграцию ](media/cutover/cutover_stage_description.png)
 __рис. 2: служба миграции хранилища, отображающая описание этапа прямую миграцию__

Вы можете отслеживать ход выполнения прямую миграцию с помощью описаний каждого этапа, как показано на рисунке выше. В следующей таблице показаны все возможные этапы вместе с его ходом выполнения, описанием и всеми уточненными примечаниями.

|  Ход выполнения | Описание                                                                                               |  Примечания |
|:-----|:--------------------------------------------------------------------------------------------------------------------|:---|
|  0 % | Прямую миграцию бездействует. |   |
| 2 %  | Подключение к исходному компьютеру... |   Убедитесь, что выполнены [требования для исходного и конечного компьютеров](./overview.md#security-requirements-the-storage-migration-service-proxy-service-and-firewall-ports) .|
| 5 %  | Подключение к конечному компьютеру... |   |
| 6 %  | Установка разрешений безопасности для объекта компьютера в Active Directory... |   Реплицирует разрешения безопасности объекта Active Directory исходного компьютера на конечный компьютер.|
| 8 %  | Убедитесь, что созданная временная учетная запись успешно удалена на исходном компьютере... |   Убедитесь, что можно создать временную учетную запись с тем же именем.|
| 11% | Создание временной учетной записи локального пользователя на исходном компьютере... |   Если исходный компьютер присоединен к домену, имя пользователя временной учетной записи — «Мсфтсмсстормигратсвк». Пароль состоит из 127 случайных двухбайтовых символов Юникода с буквами, числами, символами и изменениями регистра. Если исходный компьютер входит в рабочую группу, используются исходные учетные данные источника.|
| 13 % | Настройка политики фильтрации токенов локальной учетной записи на исходном компьютере... |   Отключает политику, чтобы можно было подключиться к источнику, если он не присоединен к домену. Дополнительные сведения о политике фильтрации маркеров локальной учетной записи см. [здесь](https://support.microsoft.com/help/951016/description-of-user-account-control-and-remote-restrictions-in-windows).|
| 16 % | Подключение к исходному компьютеру с использованием временной локальной учетной записи пользователя... |   |
| 19 % | Убедитесь, что созданная временная учетная запись успешно удалена на конечном компьютере... |   |
| 22 % | Создание временной учетной записи локального пользователя на конечном компьютере... | Если конечный компьютер присоединен к домену, имя пользователя временной учетной записи будет «Мсфтсмсстормигратсвк». Пароль состоит из 127 случайных двухбайтовых символов Юникода с буквами, числами, символами и изменениями регистра. Если конечный компьютер входит в рабочую группу, используются исходные учетные данные назначения. |
| 25 % | Настройка политики фильтрации токенов локальной учетной записи на конечном компьютере... | Отключает политику, чтобы можно было подключиться к назначению, если оно не присоединено к домену. Дополнительные сведения о политике фильтрации маркеров локальной учетной записи см. [здесь](https://support.microsoft.com/help/951016/description-of-user-account-control-and-remote-restrictions-in-windows).   |
| 27 % | Подключение к конечному компьютеру с использованием временной локальной учетной записи пользователя... |   |
| 30 % | Удаление исходного компьютера из домена... |   |
| 1-31 | Сбор IP-адресов исходного компьютера. |   Применяется только к исходным компьютерам Linux. |
| 33% | Перезагрузка исходного компьютера... (первый перезапуск) |   |
| 36% | Ожидание ответа исходного компьютера после первого перезапуска... |   Скорее всего, перестанет отвечать, если исходный компьютер не охватывается подсетью DHCP, но вы выбрали DHCP во время настройки сети.|
| 38% | Сопоставление сетевых интерфейсов на исходном компьютере... |   |
| 41 % | Переименование исходного компьютера... |   |
| 42% | Перезагрузка исходного компьютера... (первый перезапуск) |   Применяется только к исходным компьютерам Linux.|
| 43% | Перезагрузка исходного компьютера... (2-й перезапуск) |   Применяется только к присоединенным к домену исходным компьютерам Windows Server 2003.|
| 43% | Ожидание ответа исходного компьютера после первого перезапуска... |   |
| 43% | Ожидание ответа исходного компьютера после второго перезапуска... |   |
| 44% | Добавление исходного компьютера в домен... |   |
| 47 % | Перезагрузка исходного компьютера... (первый перезапуск) |   |
| 50 % | Перезагрузка исходного компьютера... (2-й перезапуск) |   |
| 51% | Перезагрузка исходного компьютера... (3-й перезапуск) |   Применяется только к исходным компьютерам Windows Server 2003.|
| 52% | Ожидание ответа исходного компьютера... |   |
| 52% | Ожидание ответа исходного компьютера после первого перезапуска... |   |
| 55% | Ожидание ответа исходного компьютера после второго перезапуска... |   |
| 56% | Ожидание ответа исходного компьютера после 3-го перезапуска... |   |
| 57% | Удаление альтернативных имен компьютеров в источнике... |   Гарантирует, что источник будет недоступен другим пользователям и приложениям. Дополнительные сведения см. в разделе [netdom ComputerName](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc835082(v=ws.11)). |
| 58 % | Удаление временной локальной учетной записи, созданной на исходном компьютере... |   |
| 61 % | Сброс политики фильтрации токенов локальной учетной записи на исходном компьютере... |   Включает политику.|
| 63% | Удаление конечного компьютера из домена... |   |
| 66% | Перезапуск конечного компьютера... (первый перезапуск) |   |
| 69% | Ожидание ответа конечного компьютера после первого перезапуска... |   |
| 72% | Сопоставление сетевых интерфейсов на конечном компьютере... |  Сопоставляет каждый сетевой адаптер и IP-адрес с исходного компьютера на конечный компьютер, заменяя сведения о сети назначения.   |
| 75 % | Переименование конечного компьютера... |   |
| 77 % | Добавление конечного компьютера в домен... |  Конечный компьютер принимает объект Active Directory старого исходного компьютера. Это может привести к сбою, если конечный пользователь не является членом группы "Администраторы домена" или не имеет прав администратора на исходном компьютере Active Directory объекта. Можно указать альтернативные конечные учетные данные на шаге "ввод учетных данных" перед запуском прямую миграцию.|
| 80 % | Перезапуск конечного компьютера... (первый перезапуск) |   |
| 83 % | Перезапуск конечного компьютера... (2-й перезапуск) |   |
| 84% | Ожидание ответа конечного компьютера... |   |
| 86% | Ожидание ответа конечного компьютера после первого перезапуска... |   |
| 88% | Ожидание ответа конечного компьютера после второго перезапуска... |   |
| 91% | Ожидание ответа конечного компьютера с новым именем... |  Может занять много времени из-за Active Directory и репликации DNS. |
| 93 % | Удаление альтернативных имен компьютеров в месте назначения... |   Гарантирует, что имя назначения было заменено.|
| 94 % | Удаление временной локальной учетной записи, созданной на конечном компьютере...|   |
| 97% | Сброс политики фильтрации токенов локальной учетной записи на конечном компьютере... |   Включает политику.|
| (100%) | Успешно |   |

## <a name="faq"></a>ВОПРОСЫ И ОТВЕТЫ

### <a name="__is-domain-controller-migration-supported__"></a>__Поддерживается ли миграция контроллера домена?__

В настоящее время нет, но на [странице часто задаваемых вопросов](./faq.md#is-domain-controller-migration-supported) вы найдете обходной путь.


## <a name="known-issues"></a>Известные проблемы
>Убедитесь, что вы выполнили требования из [обзора службы миграции хранилища](overview.md) и установили Последнее обновление Windows на компьютере, на котором выполняется служба миграции хранилища.

Дополнительные сведения о следующих проблемах см. на [странице известные проблемы](./known-issues.md) .
* [__Сбой проверки прямую миграцию службы миграции хранилища с ошибкой "отказано в доступе для политики фильтрации токенов на конечном компьютере"__](./known-issues.md#storage-migration-service-cutover-validation-fails-with-error-access-is-denied-for-the-token-filter-policy-on-destination-computer)

* [__Ошибка "сбой CLUSCTL_RESOURCE_NETNAME_REPAIR_VCO для ресурса netName" и кластера Windows Server 2008 R2, сбой прямую миграцию__](./known-issues.md#error-clusctl_resource_netname_repair_vco-failed-against-netname-resource-and-windows-server-2008-r2-cluster-cutover-fails)

* [__Прямую миграцию зависает на "38% сопоставлении сетевых интерфейсов на исходном компьютере..." При использовании статических IP-адресов__](./known-issues.md#cutover-hangs-on-38-mapping-network-interfaces-on-the-source-computer-when-using-static-ips)

* [__Прямую миграцию зависает на "38% сопоставлении сетевых интерфейсов на исходном компьютере..."__](./known-issues.md#cutover-hangs-on-38-mapping-network-interfaces-on-the-source-computer)

## <a name="additional-references"></a>Дополнительные ссылки

- [Обзор службы миграции хранилища](overview.md)
- [Перенос файлового сервера с помощью службы миграции хранилища](migrate-data.md)
- [Часто задаваемые вопросы о службах миграции хранилища](faq.md)
- [Известные проблемы со службой миграции хранилища](known-issues.md)