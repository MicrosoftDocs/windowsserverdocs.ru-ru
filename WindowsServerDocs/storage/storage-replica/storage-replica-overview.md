---
title: "Общие сведения о реплике хранилища"
ms.prod: windows-server-threshold
manager: siroy
ms.author: nedpyle
ms.technology: storage-replica
ms.topic: get-started-article
author: nedpyle
ms.date: 10/11/2016
ms.assetid: e9b18e14-e692-458a-a39f-d5b569ae76c5
ms.openlocfilehash: a1ed4627928cebd3aa1fa2b54ccd5f3f6a65a2d1
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="storage-replica-overview"></a>Общие сведения о реплике хранилища

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Реплика хранилища— это технология Windows Server, обеспечивающая репликацию томов между серверами или кластерами в целях аварийного восстановления. Она также позволяет создавать отказоустойчивые кластеры, охватывающие два сайта, с синхронизацией всех узлов.

Реплика хранилища поддерживает синхронную и асинхронную репликацию:

* **Синхронная репликация** зеркально отображает данные на сетевом сайте, обладающем небольшой задержкой, с отказоустойчивыми томами, что полностью предотвращает потерю данных на уровне файловой системы в случае сбоя.
* **Асинхронная репликация** зеркально отображает данные на сайтах за пределами городской сети через соединения с большей задержкой, но не гарантирует наличие одинаковых копий данных на обоих сайтах во время сбоя.

В этом руководстве описаны преимущества новой возможности для организаций, а также приведены примеры разных сценариев репликации, поддерживаемых репликой хранилища. Предполагается, что у читателя есть практические навыки работы с Windows Server, отказоустойчивой кластеризацией, файловыми серверами и Hyper-V, чтобы выполнять базовые задачи администрирования.  

## <a name="why-use-storage-replica"></a>В чем преимущества реплики хранилища?  
Репликация хранилища предоставляет новые возможности аварийного восстановления, а также повышает готовность к возможным аварийным ситуациям в выпуске Windows Server2016 Datacenter. Впервые Windows Server обеспечивает полную защиту от потери данных и позволяет организовать синхронную защиту данных, расположенных в разных стойках, на разных этажах, в разных зданиях, филиалах, городах и странах. После сбоя все данные без потерь будут сохранены в другом расположении. Кроме того, с помощью реплики хранилища при обнаружении определенных неполадок пользователи могут переместить рабочие нагрузки в безопасное расположение *до* сбоя, опять-таки без потери данных.  

Реплика хранилища обеспечивает более эффективное использование нескольких центров обработки данных. Благодаря растягиванию и репликации кластеров рабочие нагрузки можно распределять по нескольким центрам обработки данных, что, в свою очередь, обеспечивает более быстрый доступ к данным локальных пользователей и приложениям, а также оптимизирует распределение нагрузки и использование вычислительных ресурсов. Если центр обработки данных выйдет из строя, его обычные рабочие нагрузки можно временно переместить на другой сайт.  

Реплика хранилища позволяет списать текущие системы репликации файлов, такие как репликация DFS, которые считаются низкопроизводительными решениями аварийного восстановления. Система репликации DFS хорошо работает в сетях с очень низкой пропускной способностью, но ее задержка слишком высокая. Часто она измеряется в часах или днях. Это связано с тем, что выполняется репликация только закрытых файлов, а также с искусственным механизмом регулирования, направленным на предотвращение перегрузки сети. Из-за этих особенностей проектирования репликация самых новых и часто используемых файлов в системе репликации DFS не выполняется. Репликация хранилища выполняется ниже уровня файла и не имеет этих ограничений.  

Кроме того, реплика хранилища поддерживает асинхронную репликацию, которая подходит для сетей с более длительными задержками и большим диапазоном номеров. Так как эта возможность не зависит от контрольной точки и обеспечивает постоянную реплицикацию, изменения происходят не на уровне продуктов, основанных на моментальных снимках, а значительно ниже. Кроме того, реплика хранилища действует на уровне раздела, а значит, реплицируются все моментальные снимки службы теневого копирования томов, созданные с помощью WindowsServer или программного обеспечения для архивации. Это позволяет использовать моментальные снимки данных приложения, чтобы выполнять восстановление на определенный момент времени. В частности, неструктурированные данные пользователя реплицируются асинхронно.  

## <a name="BKMK_SRSupportedScenarios"></a>Поддерживаемые конфигурации

Используя это руководство, можно развернуть репликацию хранилища в Windows Server2016 Datacenter в растянутом кластере, между кластерами и между серверами (см. рисунки 1–3).

**Растянутый кластер** позволяет выполнять настройку компьютеров и хранилища в одном кластере, где некоторые узлы используют один общий набор асимметричного хранилища, а остальные— другой, после чего выполняется синхронная или асинхронная репликация с функцией доступности информации о сайте. В этом сценарии можно использовать дисковые пространства с общим хранилищем SAS, SAN и присоединенные к iSCSI номера LUN. Для управления используется PowerShell и графическое средство диспетчера отказоустойчивости кластеров. Отработку отказа рабочей нагрузки можно выполнять автоматически.  

![Схема показывает, как два узла кластера в Нью-Йорке используют реплику хранилища, чтобы реплицировать хранилище с двумя узлами в Нью-Джерси](./media/Storage-Replica-Overview/Storage_SR_StretchCluster.png)  

**Рис.1. Репликация хранилища в растянутом кластере с помощью реплики хранилища**  

**Межкластерная репликация** позволяет выполнять синхронную или асинхронную репликацию между двумя отдельными кластерами. В этом сценарии можно использовать локальные дисковые пространства, дисковые пространства с общим хранилищем SAS, SAN и присоединенные к iSCSI номера LUN. Для управления используется PowerShell, а отработка отказа выполняется вручную. Поддержка Azure Site Recovery в этом сценарии будет реализована в дальнейшем.

![Схема, на которой показан кластер в Лос-Анджелесе, использующий реплику хранилища, чтобы реплицировать хранилище с другим кластером в Лас-Вегасе](./media/Storage-Replica-Overview/Storage_SR_ClustertoCluster.png)  

**Рис.2. Межкластерная репликация хранилища с помощью реплики хранилища**  

**Межсерверная репликация** позволяет выполнять синхронную или асинхронную репликацию между двумя изолированными серверами, используя дисковые пространства с общим хранилищем SAS, SAN, присоединенные к iSCSI номера LUN, а также локальные диски. Для управления используется PowerShell и средство управления сервером Server Manager Tool, а отработка отказа выполняется вручную.  

![Схема, показывающая репликацию сервера в строении5 с сервером в строении9](./media/Storage-Replica-Overview/Storage_SR_ServertoServer.png)  

**Рис.3. Межсерверная репликация хранилища с помощью реплики хранилища**  

> [!NOTE]
> Кроме того, репликацию можно настроить между четырьмя отдельными томами. Но в этом руководстве такой сценарий не рассматривается.  

## <a name="BKMK_SR2"> </a> Возможности реплики хранилища  

* **Полная защита от потери данных, репликация на уровне блоков.** Синхронная репликация обеспечивает полную защиту от потери данных, а репликация на уровне блоков исключает возможность блокировки файлов.  

* **Удобное развертывание и управление.** Реплика хранилища предназначена для простоты использования. Чтобы создать связь репликации между двумя серверами, необходимо выполнить только одну команду PowerShell. Развертывание растянутых кластеров осуществляется с помощью интуитивно понятного мастера в знакомом диспетчере отказоустойчивости кластеров.   

* **Гость и узел.** Все возможности реплики хранилища можно использовать и в виртуализированных гостевых развертываниях, и в развертываниях на основе узла. Это означает, что даже гостевые ОС, работающие на платформах виртуализации не под управлением Windows или в общедоступных облаках, могут реплицировать свои тома данных при условии использования Windows Server2016 Datacenter.  

* **Репликация на основе SMB3.** Реплика хранилища использует проверенную и отработанную технологию SMB3, впервые представленную в Windows Server2012. Это означает, что в реплике хранилища доступны все расширенные возможности SMB, такие как непосредственная поддержка нескольких каналов и SMB в сетевых RDMA-адаптерах RoCE, iWARP и InfiniBand.   

* **Безопасность.** В отличие от продуктов множества поставщиков в реплике хранилища реализована ведущая в отрасли технология безопасности. Сюда входит подписывание пакетов, полное шифрование данных AES-128-GCM, поддержка ускорения шифрования Intel AES-NI и предварительной проверки подлинности с целью предотвращения атак "злоумышленник внутри". Для проверки подлинности между узлами реплика хранилища использует KerberosAES256.  

* **Высокопроизводительная начальная синхронизация**. Реплика хранилища поддерживает заполненную начальную синхронизацию, где в целевой объект уже добавлено подмножество данных из старых копий, резервных копий или поставляемых дисков. В процессе начальной репликации копируются только новые блоки, что позволяет сократить время начальной синхронизации и предотвратить использование ограниченной пропускной способности при передаче данных. Агрегирование и расчет контрольной суммы блока реплики хранилища показывает, что производительность начальной синхронизации зависит только от скорости хранилища и сети.  

* **Группы согласованности.** Порядок записи гарантирует, что приложения, такие как Microsoft SQL Server, могут записывать данные на несколько реплицированных томов, а также обеспечивает последовательную запись данных на конечный сервер.  

* **Делегирование пользователя.** Пользователям могут предоставляться права на управление репликацией. При этом им не обязательно быть участниками встроенной группы администраторов на реплицированных узлах. Доступ этих пользователей к несвязанным областям ограничен.  

* **Ограничение сети.** Чтобы обеспечить достаточную пропускную способность для приложения, ПО для резервного копирования и управления, серверы и реплицированные тома могут позволять использование реплики хранилища лишь в отдельных сетях.  

* **Тонкая подготовка.** В дисковых пространствах и устройствах SAN поддерживается тонкая подготовка. Эта возможность при разных условиях позволяет обеспечить почти мгновенную начальную репликацию.  

Windows Server2016 реализует в реплике хранилища следующие функции:  

|Функция|Подробности|  
|-----------|-----------|  
|Type|На основе узла|  
|Синхронный|Да|  
|Асинхронная репликация|Да|  
|Независимость от оборудования для хранения данных|Да|  
|Единица репликации|Том (раздел)|  
|Создание растянутого кластера Windows Server|Да|  
|Межсерверная репликация|Да|  
|Межкластерная репликация|Да|  
|Транспорт|SMB3|  
|Network (Сеть)|TCP/IP или RDMA|
|Поддержка ограничения сети|Да|  
|RDMA*|iWARP, InfiniBand, RoCE v2|  
|Требования к брандмауэру сетевого порта репликации|Один порт IANA (TCP445 или TCP5445)|  
|Поддержка нескольких путей или каналов|Да (SMB3)|  
|Поддержка Kerberos|Да (SMB3)|  
|Шифрование и подписывание Over-the-Wire|Да (SMB3)|  
|Отработка отказа для каждого тома|Да|
|Поддержка хранилища с тонкой подготовкой|Да|
|Встроенный пользовательский интерфейс управления|PowerShell, диспетчер отказоустойчивости кластеров|  

*Может потребоваться оборудование для работы на длинных расстояниях и кабели.  

## <a name="BKMK_SR3"></a> Необходимые компоненты для поддержки реплики хранилища  

* Лес доменных служб Active Directory.  
* Дисковые пространства с JBOD SAS, локальные дисковые пространства, сеть SAN Fibre Channel, общий VHDX, конечный объект iSCSI или локальное хранилище SAS/SCSI/SATA. SSD или более быстрый накопитель для хранения журналов репликации. Майкрософт рекомендует, чтобы хранилище журналов работало так же быстро или быстрее, чем хранилище данных. Томы журнала никогда не должны использоваться для других задач. 
* На каждом сервере должно быть создано по меньшей мере одно подключение Ethernet/TCP для синхронной репликации, но желательно использовать RDMA.   
* По крайней мере 2ГБ ОЗУ и два ядра на каждый сервер.  
* Сеть между серверами должна иметь достаточную пропускную способность для ваших рабочих нагрузок ввода-вывода, а средняя задержка приема-передачи должна составлять 5мс или менее для синхронной репликации. Для асинхронной репликации рекомендации по задержке приема и передачи отсутствуют.  

##  <a name="BKMK_SR4"> </a> История  
Этот раздел содержит сведения о высокоуровневой отраслевой терминологии, синхронной и асинхронной репликации, а также основных вариантах поведения.
### <a name="high-level-industry-terms"></a>Высокоуровневая отраслевая терминология  
Аварийное восстановление— способ восстановления работоспособности после сбоя сайта для продолжения работы бизнес-процессов. Такой метод предусматривает сохранение нескольких копий рабочих данных в отдельных физических расположениях. Примером может выступать растянутый кластер, где половина узлов расположена на одном сайте, а остальные — на другом. Готовность к аварийным ситуациям— план заблаговременного переноса рабочих нагрузок в другое расположение до возникновения чрезвычайного происшествия, например урагана.  

Соглашения об уровне обслуживания (SLA)— определяют доступность бизнес-приложений, а также допустимое время простоя и потерю данных в рамках планированных и незапланированных простоев. Целевое время восстановления (RTO)— определяет допустимое общее время недоступности бизнес-данных. Целевая точка восстановления— определяет допустимый объем потерь бизнес-данных.  

### <a name="synchronous-replication"></a>Синхронная репликация  
Синхронная репликация обеспечивает запись данных приложением сразу в два расположения до завершения операции ввода–вывода. Этот тип репликации более подходит для критически важных данных, так как этот процесс связан с определенными затратами на сеть и хранилище, а также может снизить производительность приложения.  

Когда приложение выполняет операции записи в исходную копию данных, то исходное хранилище подтверждает операции ввода–вывода не сразу. Вместо этого измененные данные реплицируются в удаленную конечную копию и возвращают подтверждение. Только после этого приложение получает подтверждение операции ввода–вывода. Это гарантирует постоянную синхронизацию удаленного и исходного сайтов, в результате чего в сети расширяются операции ввода–вывода для хранилища. В случае сбоя исходного сайта приложения могут выполнить отработку отказа на удаленный сайт и возобновить работу без потери данных.  

|Режим|Схема|Действия|  
|--------|-----------|---------|  
|**Синхронный**<br /><br />Полная защита от потери данных<br /><br />Целевая точка восстановления|![Схема показывает, как реплика хранилища записывает данные в рамках синхронной репликации](./media/Storage-Replica-Overview/Storage_SR_SynchronousV2.png)|1.  Приложение записывает данные.<br />2.  Данные журнала записываются и реплицируются на удаленный сайт.<br />3.  Данные журнала записываются на удаленный сайт.<br />4.  Подтверждение от удаленного сайта.<br />5.  Подтверждение операции записи приложения.<br /><br />Данные записываются в том, для журналов применяется сквозная запись.|  

### <a name="asynchronous-replication"></a>Асинхронная репликация  
В процессе асинхронной репликации записанные приложением данные реплицируются на удаленный сайт без каких-либо гарантий немедленного подтверждения. Этот режим позволяет сократить время ответа приложения. Кроме того, его можно использовать для решения аварийного восстановления, работающего по географическому признаку.  

Когда приложение записывает данные, модуль репликации получает данные и немедленно отправляет подтверждение в приложение. Полученные данные затем реплицируются в удаленное расположение. Удаленный узел обрабатывает копию данных и "лениво" подтверждает исходную копию. Так как производительность репликации больше не зависит от пути операции ввода–вывода приложения, скорость реагирования и расстояние удаленного сайта не столь важны. Если исходные данные потеряны, а конечная копия данных находилась в буфере и не покидала источник, существует риск потери данных.  

За счет того, что значение целевой точки восстановления асинхронной репликации больше нуля, этот процесс менее подходит для решений с высокой доступностью, например для отказоустойчивых кластеров. Эти решения предназначены для непрерывного выполнения операций с избыточностью и без потери данных.  

|Режим|Схема|Действия|  
|--------|-----------|---------|  
|**Асинхронная репликация**<br /><br />Практически нулевая потеря данных<br /><br />(зависит от нескольких факторов)<br /><br />Целевая точка восстановления|![Схема показывает, как реплика хранилища записывает данные в рамках асинхронной репликации](./media/Storage-Replica-Overview/Storage_SR_AsynchronousV2.png)|1.  Приложение записывает данные.<br />2.  Запись данных журнала.<br />3.  Подтверждение операции записи приложения.<br />4.  Данные реплицируются на удаленный сайт.<br />5.  Данные журнала записываются на удаленный сайт.<br />6.  Подтверждение от удаленного сайта.<br /><br />Данные записываются в том, для журналов применяется сквозная запись.|  

### <a name="key-evaluation-points-and-behaviors"></a>Основные особенности оценки и поведение  

-   Пропускная способность и задержка при использовании самого быстрого хранилища. Синхронная репликация сопряжена с определенными физическими ограничениями. Так как за счет журналов и требуемых полных обходов сети реплика хранилища реализует механизм фильтрации операций ввода-вывода, при синхронной репликации приложение записывает данные медленнее. Чтобы оптимизировать производительность, можно использовать сети с низкой задержкой и высокой пропускной способностью, а также дисковые подсистемы с высокой пропускной способностью для хранения журналов.  

-   Во время репликации конечный том недоступен в Windows Server 2016. При настройке репликации конечный том отключается, в результате чего пользователи не могут выполнять никакие операции чтения с него или записи на него. Соответствующая ему буква диска может отображаться в обычных интерфейсах, таких как проводник, но получить доступ к самому тому приложения не могут. Технология репликации на уровне блоков несовместима с системами, разрешающими доступ к установленной файловой системе конечного целевого объекта в томе. Файловые системы NTFS и ReFS не поддерживают запись пользовательских данных на тома до изменения входящих в них блоков. 

В Windows Server версии 1709 добавлена новая возможность тестовой отработки отказа. Теперь поддерживается временное подключение моментального снимка чтения и записи целевого тома для резервного копирования, тестирования и прочих целей. Дополнительные сведения см. по ссылке https://aka.ms/srfaq.

-   Реализация асинхронной репликации Microsoft отличается от остальных. Большинство отраслевых реализаций асинхронной репликации основаны на моментальных снимках, где периодические разностные операции обмена данными перемещаются на узел и объединяются. Асинхронная репликация реплики хранилища выполняется подобно синхронной репликации. Разница заключается в том, что для этого типа репликации не требуется последовательное синхронное подтверждение от цели. Таким образом, за счет непрерывной репликации реплика хранилища теоретически имеет более низкое значение целевой точки восстановления. Это также означает, что она основана на внутренних гарантиях согласованности приложения, а не на использовании моментальных снимков для инициации согласованности в файлах приложения. Реплика хранилища обеспечивает отказоустойчивость во всех режимах репликации.  

-   Многие клиенты используют систему репликации DFS в качестве решения для аварийного восстановления, хотя зачастую это нецелесообразно. Система репликации DFS не выполняет репликацию открытых файлов. Она предназначена для минимизации использования пропускной способности в ущерб производительности, что ведет к значительным разностным изменениям точки восстановления. Реплика хранилища позволяет снять некоторые обязанности по аварийному восстановлению с системы репликации DFS.  

-   Реплика хранилища не выполняет резервное копирование. Некоторые ИТ-среды развертывают системы репликации в качестве решений резервного копирования. Это связано с тем, что системы репликации обеспечивают полную защиту от потери данных по сравнению с ежедневным резервным копированием. Вне зависимости от типа изменений реплика хранилища реплицирует все изменения во все блоки данных на томе. Если пользователь удаляет все данные из тома, реплика хранилища мгновенно реплицирует эту операцию на другой том, безвозвратно удаляя данные с обоих серверов. Не используйте реплику хранилища в качестве решения для резервного копирования "на момент времени".  

-   Реплика хранилища— это не реплика Hyper-V или группы доступности AlwaysOn Microsoft SQL. Реплика хранилища— это независимый от хранилища модуль общего назначения. По своему определению реплика хранилища не может настроить поведение приложения так же хорошо, как это можно сделать с помощью репликации на уровне приложения. В результате вы не сможете выполнять определенные возможности, что вынудит вас развернуть или продолжить использовать определенные технологии репликации приложения.  

> [!NOTE]
> В этом документе содержится список [известных проблем](storage-replica-known-issues.md) и ожидаемого поведения, а также [приведены ответы на часто задаваемые вопросы](storage-replica-frequently-asked-questions.md).
 
### <a name="storage-replica-terminology"></a>Терминология по реплике хранилища  
В этом руководстве часто используются следующие термины:  

-   Источник— том на компьютере, позволяющий выполнять локальные операции записи и репликацию исходящих данных (также называется "первичным").  

-   Цель— том на компьютере, не позволяющий выполнять локальные операции записи и репликацию входящих данных (также называется "вторичным").   

-   Связь репликации— связь синхронизации между исходным и конечным компьютерами для одного или нескольких томов, при которой используется один журнал.  

-   Группа репликации— группа томов и соответствующая конфигурация репликации в рамках связи на каждом сервере. Группа может состоять из одного или нескольких томов.  

## <a name="see-also"></a>См. также:
- [Репликация растянутого кластера с помощью общего хранилища](stretch-cluster-replication-using-shared-storage.md)  
- [Репликация с сервера в хранилище сервера](server-to-server-storage-replication.md)  
- [Межкластерная репликация хранилища](cluster-to-cluster-storage-replication.md)  
- [Известные проблемы с репликой хранилища](storage-replica-known-issues.md)  
- [Часто задаваемые вопросы о реплике хранилища](storage-replica-frequently-asked-questions.md)  
- [Локальные дисковые пространства в Windows Server2016](../storage-spaces/storage-spaces-direct-overview.md)  
