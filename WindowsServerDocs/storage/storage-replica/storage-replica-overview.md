---
title: Общие сведения о реплике хранилища
ms.prod: windows-server-threshold
manager: siroy
ms.author: nedpyle
ms.technology: storage-replica
ms.topic: get-started-article
author: nedpyle
ms.date: 4/26/2019
ms.assetid: e9b18e14-e692-458a-a39f-d5b569ae76c5
ms.openlocfilehash: 1897b57e1f4cf05d222732278835483791f1109b
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66812646"
---
# <a name="storage-replica-overview"></a>Общие сведения о реплике хранилища

>Относится к: Windows Server 2019 г., Windows Server 2016, Windows Server (Semi-Annual Channel)

Реплика хранилища — это технология Windows Server, обеспечивающая репликацию томов между серверами или кластерами в целях аварийного восстановления. Она также позволяет создавать отказоустойчивые кластеры, охватывающие два сайта, с синхронизацией всех узлов.

Реплика хранилища поддерживает синхронную и асинхронную репликацию:

* **Синхронная репликация** зеркально отображает данные на сетевом сайте, обладающем небольшой задержкой, с отказоустойчивыми томами, что полностью предотвращает потерю данных на уровне файловой системы в случае сбоя.
* **Асинхронная репликация** зеркально отображает данные на сайтах за пределами городской сети через соединения с большей задержкой, но не гарантирует наличие одинаковых копий данных на обоих сайтах во время сбоя.

## <a name="why-use-storage-replica"></a>В чем преимущества реплики хранилища?

Репликация хранилища предоставляет аварийного восстановления и готовности возможности в Windows Server. Windows Server обеспечивает полную защиту от потери данных и возможность синхронную защиту данных на разных стойках, пол, здания, кампусах университетов, округа и города. После аварии, все данные находится в другом месте без потерь. Кроме того, с помощью реплики хранилища при обнаружении определенных неполадок пользователи могут переместить рабочие нагрузки в безопасное расположение *до* сбоя, опять-таки без потери данных.  

Реплика хранилища обеспечивает более эффективное использование нескольких центров обработки данных. Благодаря растягиванию и репликации кластеров рабочие нагрузки можно распределять по нескольким центрам обработки данных, что, в свою очередь, обеспечивает более быстрый доступ к данным локальных пользователей и приложениям, а также оптимизирует распределение нагрузки и использование вычислительных ресурсов. Если центр обработки данных выйдет из строя, его обычные рабочие нагрузки можно временно переместить на другой сайт.  

Реплика хранилища позволяет списать текущие системы репликации файлов, такие как репликация DFS, которые считаются низкопроизводительными решениями аварийного восстановления. Система репликации DFS хорошо работает в сетях с очень низкой пропускной способностью, но ее задержка слишком высокая. Часто она измеряется в часах или днях. Это связано с тем, что выполняется репликация только закрытых файлов, а также с искусственным механизмом регулирования, направленным на предотвращение перегрузки сети. Из-за этих особенностей проектирования репликация самых новых и часто используемых файлов в системе репликации DFS не выполняется. Репликация хранилища выполняется ниже уровня файла и не имеет этих ограничений.  

Кроме того, реплика хранилища поддерживает асинхронную репликацию, которая подходит для сетей с более длительными задержками и большим диапазоном номеров. Так как он не основана на контрольную точку и постоянную реплицикацию, изменения, как правило, значительно ниже, чем продукты на основе моментального снимка. Кроме того, реплика хранилища действует на уровне раздела, а значит, реплицируются все моментальные снимки службы теневого копирования томов, созданные с помощью Windows Server или программного обеспечения для архивации. Это позволяет использовать моментальные снимки данных приложения, чтобы выполнять восстановление на определенный момент времени. В частности, неструктурированные данные пользователя реплицируются асинхронно.  

## <a name="BKMK_SRSupportedScenarios"></a>Поддерживаемые конфигурации

Вы можете развернуть реплику хранилища в растянутом кластере, между кластер кластер и сервер сервер (см. рисунки 1 – 3).

**Растянутый кластер** позволяет выполнять настройку компьютеров и хранилища в одном кластере, где некоторые узлы используют один общий набор асимметричного хранилища, а остальные — другой, после чего выполняется синхронная или асинхронная репликация с функцией доступности информации о сайте. В этом сценарии можно использовать дисковые пространства с общим хранилищем SAS, SAN и присоединенные к iSCSI номера LUN. Для управления используется PowerShell и графическое средство диспетчера отказоустойчивости кластеров. Отработку отказа рабочей нагрузки можно выполнять автоматически.  

![Схема показывает, как два узла кластера в Нью-Йорке используют реплику хранилища, чтобы реплицировать хранилище с двумя узлами в Нью-Джерси](./media/Storage-Replica-Overview/Storage_SR_StretchCluster.png)  

**РИС. 1. Репликация хранилища в растянутом кластере с помощью реплики хранилища**  

**Межкластерная репликация** позволяет выполнять синхронную или асинхронную репликацию между двумя отдельными кластерами. В этом сценарии можно использовать локальные дисковые пространства, дисковые пространства с общим хранилищем SAS, SAN и присоединенные к iSCSI номера LUN. Он управляется с помощью Windows Admin Center и PowerShell и требуется ручное вмешательство для отработки отказа. 

![Схема показывает кластер в Лос-Анджелесе, использующий реплику хранилища, чтобы реплицировать хранилище с другим кластером в Лас-Вегасе](./media/Storage-Replica-Overview/Storage_SR_ClustertoCluster.png)  

**РИС. 2. Репликация хранилища кластера для кластера с помощью реплики хранилища**  

**Межсерверная репликация** позволяет выполнять синхронную или асинхронную репликацию между двумя изолированными серверами, используя дисковые пространства с общим хранилищем SAS, SAN, присоединенные к iSCSI номера LUN, а также локальные диски. Он управляется с помощью Windows Admin Center и PowerShell и требуется ручное вмешательство для отработки отказа.  

![Схема, показывающая репликацию сервера в строении 5 с сервером в строении 9](./media/Storage-Replica-Overview/Storage_SR_ServertoServer.png)  

**РИС. 3. Репликация хранилища сервера на сервер с помощью реплики хранилища**  

> [!NOTE]
> Кроме того, репликацию можно настроить между четырьмя отдельными томами. Но в этом руководстве такой сценарий не рассматривается.  

## <a name="BKMK_SR2"> </a> Возможности реплики хранилища  

* **Полная защита от потери данных, репликация на уровне блоков.** Синхронная репликация обеспечивает полную защиту от потери данных, а репликация на уровне блоков исключает возможность блокировки файлов.  

* **Удобное развертывание и управление.** Реплика хранилища предназначена для простоты использования. Создание партнерства репликации между двумя серверами можно использовать Windows Admin Center. Развертывание растянутых кластеров осуществляется с помощью интуитивно понятного мастера в знакомом диспетчере отказоустойчивости кластеров.   

* **Гость и узел.** Все возможности реплики хранилища можно использовать и в виртуализированных гостевых развертываниях, и в развертываниях на основе узла. Это означает, что гости могут реплицировать свои тома данных даже если выполняется на платформах виртуализации, отличных от Windows или в общедоступных облаках, до тех пор, пока в гостевой ОС Windows Server.  

* **Репликация на основе SMB 3.** Реплика хранилища использует проверенную и отработанную технологию SMB 3, впервые представленную в Windows Server 2012. Это означает, что в реплике хранилища доступны все расширенные возможности SMB, такие как непосредственная поддержка нескольких каналов и SMB в сетевых RDMA-адаптерах RoCE, iWARP и InfiniBand.   

* **Безопасность.** В отличие от продуктов множества поставщиков в реплике хранилища реализована ведущая в отрасли технология безопасности. Сюда входит подписывание пакетов, полное шифрование данных AES-128-GCM, поддержка ускорения шифрования Intel AES-NI и предварительной проверки подлинности с целью предотвращения атак "злоумышленник внутри". Для проверки подлинности между узлами реплика хранилища использует Kerberos AES256.  

* **Высокопроизводительная начальная синхронизация.** Реплика хранилища поддерживает заполненную начальную синхронизацию, где в целевой объект уже добавлено подмножество данных из старых копий, резервных копий или поставляемых дисков. Начальная репликация копирует только новые блоки, потенциально сократить время начальной синхронизации и предотвратить использование ограниченной пропускной способности данных. Агрегирование и расчет контрольной суммы блока реплики хранилища показывает, что производительность начальной синхронизации зависит только от скорости хранилища и сети.  

* **Группы согласованности.** Порядок записи гарантирует, что приложения, такие как Microsoft SQL Server может записывать данные на несколько реплицированных томов, а также знать, данные записываются на конечном сервере последовательно.  

* **Делегирование пользователя.** Пользователям могут предоставляться права на управление репликацией. При этом им не обязательно быть участниками встроенной группы администраторов на реплицированных узлах. Доступ этих пользователей к несвязанным областям ограничен.  

* **Ограничение сети.** Чтобы обеспечить достаточную пропускную способность для приложения, ПО для резервного копирования и управления, серверы и реплицированные тома могут позволять использование реплики хранилища лишь в отдельных сетях.  

* **Тонкая подготовка.** В дисковых пространствах и устройствах SAN поддерживается тонкая подготовка. Эта возможность при разных условиях позволяет обеспечить почти мгновенную начальную репликацию.  

Реплика хранилища включает следующие компоненты:  

| Компонент | Подробности |
| ----------- | ----------- |  
| Тип | На основе узла |
| Синхронный | Да |
| Асинхронная репликация | Да |
| Независимость от оборудования для хранения данных | Да |
| Единица репликации | Том (раздел) |
| Windows Server растянуть создания кластера | Да |
| Межсерверная репликация | Да |
| Межкластерная репликация | Да |
| Транспорт | SMB 3 |
| Network | TCP/IP или RDMA |
| Поддержка ограничения сети | Да |
| RDMA* | iWARP, InfiniBand, RoCE v2 |
| Требования к брандмауэру сетевого порта репликации | Один порт IANA (TCP 445 или TCP 5445) |
| Поддержка нескольких путей или каналов | Да (SMB 3) |
| Поддержка Kerberos | Да (SMB 3) |
| Шифрование и подписывание Over-the-Wire|Да (SMB 3) |
| Отработка отказа для каждого тома | Да |
| Поддержка хранилища с тонкой подготовкой | Да |
| Встроенный пользовательский интерфейс управления | PowerShell, диспетчер отказоустойчивости кластеров |

* Может потребоваться оборудование для работы на длинных расстояниях и кабели.  

## <a name="BKMK_SR3"></a> Необходимые условия для реплики хранилища

* Лес доменных служб Active Directory.
* Дисковые пространства с JBOD SAS, локальные дисковые пространства, сеть SAN Fibre Channel, общий VHDX, конечный объект iSCSI или локальное хранилище SAS/SCSI/SATA. SSD или более быстрый накопитель для хранения журналов репликации. Майкрософт рекомендует, чтобы хранилище журналов работало так же быстро или быстрее, чем хранилище данных. Томы журнала никогда не должны использоваться для других задач.
* На каждом сервере должно быть создано по меньшей мере одно подключение Ethernet/TCP для синхронной репликации, но желательно использовать RDMA.
* По крайней мере 2ГБ ОЗУ и два ядра на каждый сервер.
* Сеть между серверами должна иметь достаточную пропускную способность для ваших рабочих нагрузок ввода-вывода, а средняя задержка приема-передачи должна составлять 5 мс или менее для синхронной репликации. Для асинхронной репликации рекомендации по задержке приема и передачи отсутствуют.
* Windows Server Datacenter Edition и Windows Server Standard Edition. Реплика хранилища под управлением Windows Server, Standard Edition имеет следующие ограничения:

  * Необходимо использовать Windows Server 2019 или более поздней версии
  * Реплика хранилища реплицирует отдельного тома вместо неограниченное число томов.
  * Тома могут иметь размер до 2 ТБ, вместо неограниченного размера.

##  <a name="BKMK_SR4"> </a> Фон

Этот раздел содержит сведения о высокоуровневой отраслевой терминологии, синхронной и асинхронной репликации, а также основных вариантах поведения.

### <a name="high-level-industry-terms"></a>Высокоуровневая Отраслевая терминология

Аварийное восстановление — способ восстановления работоспособности после сбоя сайта для продолжения работы бизнес-процессов. Такой метод предусматривает сохранение нескольких копий рабочих данных в отдельных физических расположениях. Примером может выступать растянутый кластер, где половина узлов расположена на одном сайте, а остальные — на другом. Готовность к аварийным ситуациям — план заблаговременного переноса рабочих нагрузок в другое расположение до возникновения чрезвычайного происшествия, например урагана.  

Соглашения об уровне обслуживания (SLA) — определяют доступность бизнес-приложений, а также допустимое время простоя и потерю данных в рамках планированных и незапланированных простоев. Целевое время восстановления (RTO) — определяет допустимое общее время недоступности бизнес-данных. Целевая точка восстановления — определяет допустимый объем потерь бизнес-данных.  

### <a name="synchronous-replication"></a>Синхронная репликация

Синхронная репликация обеспечивает запись данных приложением сразу в два расположения до завершения операции ввода–вывода. Этот тип репликации более подходит для критически важных данных, так как этот процесс связан с определенными затратами на сеть и хранилище, а также может снизить производительность приложения.  

Когда приложение выполняет операции записи в исходную копию данных, то исходное хранилище подтверждает операции ввода–вывода не сразу. Вместо этого измененные данные реплицируются в удаленную конечную копию и возвращают подтверждение. Только после этого приложение получает подтверждение операции ввода–вывода. Это гарантирует постоянную синхронизацию удаленного и исходного сайтов, в результате чего в сети расширяются операции ввода–вывода для хранилища. В случае сбоя исходного сайта приложения могут выполнить отработку отказа на удаленный сайт и возобновить работу без потери данных.  

| Режим | Схема | Действия |
| -------- | ----------- | --------- |
| **Синхронный**<br /><br />Полная защита от потери данных<br /><br />Целевая точка восстановления | ![Схема показывает, как реплика хранилища записывает данные в рамках синхронной репликации](./media/Storage-Replica-Overview/Storage_SR_SynchronousV2.png) | 1.  Приложение записывает данные.<br />2.  Данные журнала записываются и реплицируются на удаленный сайт.<br />3.  Данные журнала записываются на удаленный сайт.<br />4.  Подтверждение от удаленного сайта.<br />5.  Подтверждение операции записи приложения.<br /><br />t & t1: Данные сброшены в том, сквозная запись журналов |

### <a name="asynchronous-replication"></a>Асинхронная репликация

В процессе асинхронной репликации записанные приложением данные реплицируются на удаленный сайт без каких-либо гарантий немедленного подтверждения. Этот режим позволяет сократить время ответа приложения. Кроме того, его можно использовать для решения аварийного восстановления, работающего по географическому признаку.  

Когда приложение записывает данные, модуль репликации получает данные и немедленно отправляет подтверждение в приложение. Полученные данные затем реплицируются в удаленное расположение. Удаленный узел обрабатывает копию данных и "лениво" подтверждает исходную копию. Так как производительность репликации больше не зависит от пути операции ввода–вывода приложения, скорость реагирования и расстояние удаленного сайта не столь важны. Если исходные данные потеряны, а конечная копия данных находилась в буфере и не покидала источник, существует риск потери данных.  

За счет того, что значение целевой точки восстановления асинхронной репликации больше нуля, этот процесс менее подходит для решений с высокой доступностью, например для отказоустойчивых кластеров. Эти решения предназначены для непрерывного выполнения операций с избыточностью и без потери данных.  

| Режим | Схема | Действия |
| -------- | ----------- | --------- |
| **Асинхронный**<br /><br />Практически нулевая потеря данных<br /><br />(зависит от нескольких факторов)<br /><br />Целевая точка восстановления | ![Схема показывает, как реплика хранилища записывает данные в рамках асинхронной репликации](./media/Storage-Replica-Overview/Storage_SR_AsynchronousV2.png)|1.  Приложение записывает данные.<br />2.  Запись данных журнала.<br />3.  Подтверждение операции записи приложения.<br />4.  Данные реплицируются на удаленный сайт.<br />5.  Данные журнала записываются на удаленный сайт.<br />6.  Подтверждение от удаленного сайта.<br /><br />t & t1: Данные сброшены в том, сквозная запись журналов |

### <a name="key-evaluation-points-and-behaviors"></a>Особенности ключа оценки и поведение  

-   Пропускная способность и задержка при использовании самого быстрого хранилища. Синхронная репликация сопряжена с определенными физическими ограничениями. Так как за счет журналов и требуемых полных обходов сети реплика хранилища реализует механизм фильтрации операций ввода-вывода, при синхронной репликации приложение записывает данные медленнее. С помощью низкой задержкой, высокой пропускной способностью сети, а также дисковые высокой пропускной способности подсистемы для журналов, можно свести к минимуму снижение производительности.  

-   Во время репликации конечный том недоступен в Windows Server 2016. При настройке репликации конечный том отключается, в результате чего пользователи не могут выполнять никакие операции чтения с него или записи на него. Соответствующая ему буква диска может отображаться в обычных интерфейсах, таких как проводник, но получить доступ к самому тому приложения не могут. Технология репликации на уровне блоков несовместима с системами, разрешающими доступ к установленной файловой системе конечного целевого объекта в томе. Файловые системы NTFS и ReFS не поддерживают запись пользовательских данных на тома до изменения входящих в них блоков. 

**Теста отработки отказа** командлет впервые появилась в Windows Server версии 1709 и была включена в Windows Server 2019. Теперь поддерживает временно монтирования моментальный снимок чтения и записи для конечного тома для резервных копий, тестирование, и т.д. См. в разделе https://aka.ms/srfaq Дополнительные сведения.

-   Реализация асинхронной репликации Microsoft отличается от остальных. Большинство отраслевых реализаций асинхронной репликации основаны на моментальных снимках, где периодические разностные операции обмена данными перемещаются на узел и объединяются. Асинхронная репликация реплики хранилища выполняется подобно синхронной репликации. Разница заключается в том, что для этого типа репликации не требуется последовательное синхронное подтверждение от цели. Таким образом, за счет непрерывной репликации реплика хранилища теоретически имеет более низкое значение целевой точки восстановления. Это также означает, что она основана на внутренних гарантиях согласованности приложения, а не на использовании моментальных снимков для инициации согласованности в файлах приложения. Реплика хранилища обеспечивает отказоустойчивость во всех режимах репликации.  

-   Многие клиенты используют систему репликации DFS в качестве решения для аварийного восстановления, хотя зачастую это нецелесообразно. Система репликации DFS не выполняет репликацию открытых файлов. Она предназначена для минимизации использования пропускной способности в ущерб производительности, что ведет к значительным разностным изменениям точки восстановления. Реплика хранилища позволяет снять некоторые обязанности по аварийному восстановлению с системы репликации DFS.  

-   Реплика хранилища не решение для резервного копирования. Некоторые ИТ-среды развертывают системы репликации в качестве решений резервного копирования. Это связано с тем, что системы репликации обеспечивают полную защиту от потери данных по сравнению с ежедневным резервным копированием. Вне зависимости от типа изменений реплика хранилища реплицирует все изменения во все блоки данных на томе. Если пользователь удаляет все данные из тома, реплика хранилища реплицирует удаление мгновенно на другой том, безвозвратно удаляя данные с обоих серверов. Не используйте реплику хранилища в качестве решения для резервного копирования "на момент времени".  

-   Реплика хранилища — это не реплика Hyper-V или группы доступности AlwaysOn Microsoft SQL. Реплика хранилища — это независимый от хранилища модуль общего назначения. По своему определению реплика хранилища не может настроить поведение приложения так же хорошо, как это можно сделать с помощью репликации на уровне приложения. В результате вы не сможете выполнять определенные возможности, что вынудит вас развернуть или продолжить использовать определенные технологии репликации приложения.  

> [!NOTE]
> В этом документе содержится список [известных проблем](storage-replica-known-issues.md) и ожидаемого поведения, а также [приведены ответы на часто задаваемые вопросы](storage-replica-frequently-asked-questions.md).
 
### <a name="storage-replica-terminology"></a>Терминология по реплике хранилища  
В этом руководстве часто используются следующие термины:  

-   Источник — том на компьютере, позволяющий выполнять локальные операции записи и репликацию исходящих данных (также называется "первичным").  

-   Цель — том на компьютере, не позволяющий выполнять локальные операции записи и репликацию входящих данных (также называется "вторичным").   

-   Связь репликации — связь синхронизации между исходным и конечным компьютерами для одного или нескольких томов, при которой используется один журнал.  

-   Группа репликации — группа томов и соответствующая конфигурация репликации в рамках связи на каждом сервере. Группа может состоять из одного или нескольких томов.  

### <a name="whats-new-for-storage-replica"></a>Новые возможности для реплики хранилища

Список новых возможностей в реплике хранилища в Windows Server 2019, см. в разделе [новые возможности в хранилище](../whats-new-in-storage.md#storage-replica2019)

## <a name="see-also"></a>См. также

- [Репликация растянутого кластера с помощью общего хранилища](stretch-cluster-replication-using-shared-storage.md)  
- [Репликация сервера на сервер хранилища](server-to-server-storage-replication.md)  
- [Межкластерная репликация](cluster-to-cluster-storage-replication.md)  
- [Реплика хранилища: Известные проблемы](storage-replica-known-issues.md)  
- [Реплика хранилища: вопросы и ответы](storage-replica-frequently-asked-questions.md)  
- [Дисковые пространства в Windows Server 2016](../storage-spaces/storage-spaces-direct-overview.md)
- [Windows ИТ-специалистов поддержки](https://www.microsoft.com/itpro/windows/support)
