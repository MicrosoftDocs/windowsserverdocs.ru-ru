---
title: "Межкластерная репликация хранилища"
ms.prod: windows-server-threshold
manager: siroy
ms.author: nedpyle
ms.technology: storage-replica
ms.topic: get-started-article
ms.assetid: 834e8542-a67a-4ba0-9841-8a57727ef876
author: nedpyle
ms.date: 10/11/2016
description: "Использование реплики хранилища для репликации томов из одного кластера в другой кластер под управлением Windows Server 2016 Datacenter."
ms.openlocfilehash: 0681f6495390fda9b0c4564bf5516a48652b2c71
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="cluster-to-cluster-storage-replication"></a>Межкластерная репликация хранилища

> Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

В Windows Server2016 Datacenter теперь доступна межкластерная репликация, в том числе репликация кластеров с помощью локальных дисковых пространств (т.е. непосредственно подключенное хранилище в режиме "shared nothing" (ничего общего)). Применяются те же управление и настройка, что и для межсерверной репликации.  

Здесь вы настроите компьютеры и хранилища в межкластерной конфигурации, которая обеспечивает репликацию набора хранилищ кластера на другой кластер со своим набором хранилищ. Эти узлы и соответствующие хранилища желательно расположить на различных физических сайтах, но это не является обязательным требованием.  

В Windows Server2016 Datacenter нет графических средств, позволяющих настроить реплики хранилища для межкластерной репликации, хотя в будущем такую настройку сможет обеспечить Azure Site Recovery.

> [!IMPORTANT]
> В этом тесте для примера используются четыре сервера. Можно использовать любое количество серверов, поддерживаемых корпорацией Майкрософт в каждом из кластеров. Сейчас это значение равно 16 для кластера локальных дисковых пространств и 64 для общего кластера хранилища.  
>   
> В этом руководстве не рассматривается настройка локальных дисковых пространств. Сведения о настройке локальных дисковых пространств см. в статье [Локальные дисковые пространства в Windows Server2016](../storage-spaces/storage-spaces-direct-overview.md).  

В этом руководстве в качестве примера используется следующая среда:  

-   два рядовых сервера с именами **SR-SRV01** и **SR-SRV02**, позже объединенные в один кластер с именем **SR-SRVCLUSA**;  

-   два рядовых сервера с именами **SR-SRV03** и **SR-SRV04**, позже объединенные в один кластер с именем **SR-SRVCLUSB**;  

-   два логических расположения, которые представляют два разных центра обработки данных: **Redmond** и **Bellevue**.  

![Схема, показывающая пример среды с кластером на сайте в Редмонде, который реплицируется с кластером на сайте в Белвью](./media/Cluster-to-Cluster-Storage-Replication/SR_ClustertoCluster.png)  

**РИС1. Межкластерная репликация**  

## <a name="prerequisites"></a>Предварительные условия  

* Лес доменных служб Active Directory (не обязательно под управлением Windows Server2016).  
* Не менее четырех серверов (по два сервера в двух кластерах) с Windows Server 2016 Datacenter. Поддержка до двух кластеров, содержащих по 64 узла.  
* Два набора хранилищ, использующие SAS JBOD, сеть SAN стандарта Fibre Channel, общие VHDX-файлы, локальные дисковые пространства или цель iSCSI. Хранилище должно содержать сочетание жестких дисков и твердотельных накопителей. Каждый набор хранилищ должен быть доступен только одному из этих кластеров без общего доступа между кластерами.  
* Каждый набор хранилищ должен допускать создание по меньшей мере двух виртуальных дисков: один для реплицируемых данных и один для журналов. На всех дисках данных в физическом хранилище необходимо использовать одинаковый размер секторов. На всех дисках с журналами в физическом хранилище необходимо использовать одинаковый размер секторов.  
* На каждом сервере должно быть создано по меньшей мере одно подключение Ethernet/TCP для синхронной репликации, но желательно использовать RDMA.   
* Правила соответствующих брандмауэров и маршрутизаторов должны разрешать двунаправленный трафик ICMP, SMB (порт 445, а также 5445 для SMB Direct) и WS-MAN (порт 5985) между всеми узлами.  
* Сеть между серверами должна иметь достаточную пропускную способность для ваших рабочих нагрузок ввода-вывода, а средняя задержка приема-передачи должна составлять 5мс для синхронной репликации. Для асинхронной репликации рекомендации по задержке приема и передачи отсутствуют.  
* Реплицируемое хранилище не может находиться на диске с папкой операционной системы Windows.

Многие из этих требований можно определить с помощью командлета `Test-SRTopology`. Это средство будет доступно, если установить реплику хранилища или средства управления репликой хранилища хотя бы на один сервер. Настраивать реплику хранилища не нужно. Для использования инструмента достаточно только установить командлет. Дополнительная информация приведена ниже.  

## <a name="step-1-provision-operating-system-features-roles-storage-and-network"></a>Шаг 1. Подготовка операционной системы, функций, ролей, хранилища и сети

1.  Установите Windows Server2016 на всех четырех узлах серверов, указав тип установки Windows Server2016 Datacenter **(возможности рабочего стола)**. Если доступен выпуск Standard, не выбирайте его, так как он не содержит реплику хранилища.  

2.  Добавьте сведения о сети и присоедините узлы к домену, а затем перезапустите их.  

    > [!IMPORTANT]  
    > С этого момента вход в систему всегда нужно выполнять от имени пользователя домена, входящего в группу встроенной учетной записи администратора на всех серверах. Не забывайте повысить полномочия командных строк Windows PowerShell и CMD, запуская их через графический интерфейс на компьютере с ОС Windows 10.  

3.  Подключите первый набор массивов JBOD, целей iSCSI, SAN на основе Fibre Channel и (или) хранилища на локальном жестком диске (DAS) к серверу в расположении **Redmond**.  

4.  Подключите второй набор хранилищ к серверу в расположении **Bellevue**.  

5.  При необходимости установите на всех четырех узлах последнюю версию хранилища поставщика и встроенного ПО и драйверов, а также последние версии драйверов адаптера шины поставщика, встроенного ПО BIOS/UEFI поставщика, драйверов сети поставщика и драйверов набора микросхем материнской платы. Перезапустите узлы при необходимости.  

    > [!NOTE]  
    > Для настройки общих хранилищ и сетевого оборудования обратитесь к документации поставщика оборудования.  

6.  Убедитесь, что для параметров BIOS или UEFI настроена высокая производительность, например отключено C-состояние, установлена скорость QPI, включена архитектура NUMA и установлена максимально возможная частота памяти. Убедитесь, что для управления питанием в Windows Server выбрана схема высокой производительности. При необходимости перезагрузите компьютер.  

7.  Настройте роли следующим образом.  

    -   **Графический метод**  

        1.  Запустите **ServerManager.exe** и создайте группу серверов, добавив в нее все узлы серверов.  

        2.  Установите роли и компоненты **файлового сервера** и **реплики хранилища** на всех узлах и перезапустите их.  

    -   **Метод для Windows PowerShell**  

        На компьютере SR-SRV04 или на компьютере удаленного управления выполните следующую команду в консоли Windows PowerShell, которая установит все необходимые компоненты и роли растянутого кластера на четырех узлах и перезапустит их:  

        ```PowerShell
        $Servers = 'SR-SRV01','SR-SRV02','SR-SRV03','SR-SRV04'  

        $Servers | ForEach { Install-WindowsFeature -ComputerName $_ -Name Storage-Replica,Failover-Clustering,FS-FileServer -IncludeManagementTools -restart }  
        ```  

        Дополнительные сведения об этих действиях см. в статье [Установка и удаление ролей, служб ролей и компонентов](http://technet.microsoft.com/library/hh831809.aspx)  

9. Настройте хранилище следующим образом:  

    > [!IMPORTANT]  
    > -   Необходимо создать два тома на каждой полке: один для данных и один для журналов.  
    > -   Диски журналов и данных следует инициализировать как **GPT**, а не **MBR**.  
    > -   Два тома данных должны иметь одинаковый размер.  
    > -   Два тома журналов должны иметь одинаковый размер.  
    > -   Все реплицируемые диски данных должны иметь одинаковый размер сектора.  
    > -   Все диски журналов должны иметь одинаковый размер сектора.  
    > -   Тома журнала следует располагать на твердотельных накопителях.  Майкрософт рекомендует, чтобы хранилище журналов работало быстрее, чем хранилище данных. Томы журнала никогда не должны использоваться для других задач.
    > -   В качестве дисков данных можно использовать жесткие диски, твердотельные накопители или их многоуровневое сочетание. Диски можно организовать как зеркальные массивы, массивы с контролем четности, RAID1 или 10, RAID5 или RAID50.  
    > -   Том журнала должен иметь размер по умолчанию не менее 9ГБ, но может отличаться как в большую, так и в меньшую сторону в зависимости от требований к ведению журнала.  

    -   **Для дисковых полок JBOD:**  

        1.  Убедитесь, что каждый кластер может видеть только полки дисков своего сайта и что подключения SAS правильно сконфигурированы.  

        2.  Подготовьте хранилище с помощью дисковых пространств, выполнив **шаги 1–3** из статьи [Развертывание дисковых пространств на автономном сервере](http://technet.microsoft.com/library/jj822938.aspx) с помощью Windows PowerShell или диспетчера сервера.  

    -   **Хранилище цели iSCSI**  

        1.  Убедитесь, что каждый кластер может видеть только полки дисков своего сайта. При работе с iSCSI следует использовать несколько сетевых адаптеров.  

        2.  Подготовьте хранилище в соответствии с документацией поставщика. При использовании целей iSCSI для Windows изучите статью [Блочное хранилище конечного сервера iSCSI, краткое руководство](http://technet.microsoft.com/library/hh848268.aspx).  

    -   **Для хранилища Fibre Channel в сети SAN:**  

        1.  Убедитесь, что каждый кластер можно видеть только полки дисков своего расположения, и что правильно выбраны зоны узлов.  

        2.  Подготовьте хранилище в соответствии с документацией поставщика.  

    -   **Для локальных дисковых пространств:**  

        1.  Убедитесь, что каждый кластер может видеть дисковые полки своего сайта только путем развертывания локальных дисковых пространств. (https://docs.microsoft.com/ru-ru/windows-server/storage/storage-spaces/hyper-converged-solution-using-storage-spaces-direct) 

        2.  Убедитесь, что тома журналов SR всегда будут находиться на самых быстрых флэш-накопителях, а тома данных— на более медленных накопителях высокой емкости.

10. Запустите Windows PowerShell и используйте командлет `Test-SRTopology`, чтобы определить, все ли требования для реплики хранилища выполнены. Этот командлет можно запустить в режиме быстрой проверки требований или в режиме длительной оценки производительности.  
Например:  

   ```PowerShell
   MD c:\temp

   Test-SRTopology -SourceComputerName SR-SRV01 -SourceVolumeName f: -SourceLogVolumeName g: -DestinationComputerName SR-SRV03 -DestinationVolumeName f: -DestinationLogVolumeName g: -DurationInMinutes 30 -ResultPath c:\temp        
   ```

      > [!IMPORTANT]
      > Если вы используете тестовый сервер, на котором в период оценки не создается нагрузка ввода-вывода на выбранный том источника, попробуйте добавить рабочую нагрузку, иначе отчет будет бесполезным. Чтобы получить фактические результаты и рекомендованные размеры журнала, тестовая нагрузка должна соответствовать ожидаемой рабочей нагрузке. Как вариант, во время теста просто скопируйте некоторые файлы на исходный том или загрузите и запустите средство [DISKSPD](https://gallery.technet.microsoft.com/DiskSpd-a-robust-storage-6cd2f223) для создания операций ввода-вывода на запись. Этот пример команды создает низкую рабочую нагрузку операций записи на диск D в течение пяти минут:  
      > `Diskspd.exe -c1g -d300 -W5 -C5 -b8k -t2 -o2 -r -w5 -h d:\test.dat`  

11. Изучите отчет **TestSrTopologyReport.html**, чтобы убедиться в выполнении всех требований к реплике хранилища.  

    ![Экран с результатами отчета о топологии репликации](./media/Cluster-to-Cluster-Storage-Replication/SRTestSRTopologyReport.png)      

## <a name="step-2-configure-two-scale-out-file-server-failover-clusters"></a>Шаг 2. Настройка двух отказоустойчивых кластеров масштабируемого файлового сервера  
Теперь создадим два обычных отказоустойчивых кластера. После настройки, проверки и тестирования они будут реплицированы с помощью реплики хранилища. Все описанные ниже шаги можно выполнять на узлах кластера непосредственно или с помощью компьютера удаленного управления, на котором установлены средства удаленного администрирования сервера Windows Server2016.  

### <a name="graphical-method"></a>Графический интерфейс  

1.  Запустите **cluadmin.msc** для узла на каждом сайте.  

2.  Проверьте предложенный кластер и проанализируйте результаты, чтобы убедиться, что можно продолжить. В примере ниже рассматриваются **SR-SRVCLUSA** и **SR-SRVCLUSB**.  

3.  Создайте два кластера. Убедитесь, что имена кластеров содержат не более 15 символов.  

4.  Настройте файловый ресурс-свидетель или облачный свидетель.  

    > [!NOTE]  
    > Windows Server2016 теперь предоставляет возможность использования облака-свидетеля Azure. Можно выбрать этот вариант кворума вместо файлового ресурса-свидетеля.  

    > [!WARNING]  
    > Дополнительные сведения о конфигурации кворума см. в разделе **Настройка свидетеля** статьи о [настройке и управлении кворумом в отказоустойчивом кластере Windows Server 2012](http://technet.microsoft.com/library/jj612870.aspx). Дополнительные сведения о командлете `Set-ClusterQuorum` см. в разделе [Set-ClusterQuorum](http://technet.microsoft.com/library/hh847275.aspx).  

5.  Добавьте один диск сайта **Redmond** в кластер CSV. Для этого щелкните правой кнопкой мыши исходный диск в узле **Disks** (Диски) раздела **Storage** (Хранилище) и нажмите кнопку **Add to Cluster Shared Volumes** (Добавить к общим томам кластера).  

6.  Создайте масштабируемые файловые серверы в обоих кластерах, следуя инструкциям в разделе [Настройка масштабируемого файлового сервера](http://technet.microsoft.com/library/hh831718.aspx)  

### <a name="windows-powershell-method"></a>Метод для Windows PowerShell  

1.  Протестируйте предложенный кластер и проанализируйте результаты, чтобы убедиться, что можно продолжить.  

    ```PowerShell
    Test-Cluster SR-SRV01,SR-SRV02  
    Test-Cluster SR-SRV03,SR-SRV04  
    ```  

2.  Создайте кластеры (необходимо указать свои собственные статические IP-адреса для кластеров). Убедитесь, что имя каждого кластера содержит не более15 символов.  

    ```PowerShell
    New-Cluster -Name SR-SRVCLUSA -Node SR-SRV01,SR-SRV02 -StaticAddress <your IP here>  
    New-Cluster -Name SR-SRVCLUSB -Node SR-SRV03,SR-SRV04 -StaticAddress <your IP here>  
    ```  

3.  Настройте файловый ресурс-свидетель или облачный свидетель (Azure) в каждом кластере, который указывает на общий ресурс, размещенный на контроллере домена или другом независимом сервере. Например:  

    ```PowerShell  
    Set-ClusterQuorum -FileShareWitness \\someserver\someshare  
    ```  

    > [!NOTE]  
    > Windows Server2016 теперь предоставляет возможность использования облака-свидетеля Azure. Можно выбрать этот вариант кворума вместо файлового ресурса-свидетеля.  

    > [!WARNING]  
    > Дополнительные сведения о конфигурации кворума см. в разделе **Настройка свидетеля** статьи о [настройке и управлении кворумом в отказоустойчивом кластере Windows Server 2012](http://technet.microsoft.com/library/jj612870.aspx). Дополнительные сведения о командлете `Set-ClusterQuorum` см. в разделе [Set-ClusterQuorum](http://technet.microsoft.com/library/hh847275.aspx).  

4.  Создайте масштабируемые файловые серверы в обоих кластерах, следуя инструкциям в разделе [Настройка масштабируемого файлового сервера](https://technet.microsoft.com/library/hh831718.aspx)  

## <a name="step-3-set-up-cluster-to-cluster-replication-using-windows-powershell"></a>Шаг 3. Настройка межкластерной репликации с помощью Windows PowerShell  
Теперь перейдем к настройке межкластерной репликации с помощью PowerShell. Все описанные ниже шаги можно выполнять на узлах непосредственно или с помощью компьютера удаленного управления, на котором установлены средства удаленного администрирования сервера Windows Server2016.  

1.  Предоставьте первому кластеру полный доступ к другому кластеру, выполнив командлет **Grant-ClusterAccess** на любом узле в первом кластере или удаленно.  

    ```PowerShell
    Grant-SRAccess -ComputerName SR-SRV01 -Cluster SR-SRVCLUSB  
    ```  

2.  Предоставьте второму кластеру полный доступ к другому кластеру, выполнив командлет **Grant-ClusterAccess** на любом узле во втором кластере или удаленно.  

    ```PowerShell
    Grant-SRAccess -ComputerName SR-SRV03 -Cluster SR-SRVCLUSA  
    ```  

3.  Настройте межкластерную репликацию, указав исходный и целевой диски, исходный и целевой журналы, имена исходного и целевого кластеров, а также размер журнала. Эту команду можно выполнить локально на сервере или на компьютере удаленного управления.  

    ```powershell  
    New-SRPartnership -SourceComputerName SR-SRVCLUSA -SourceRGName rg01 -SourceVolumeName c:\ClusterStorage\Volume2 -SourceLogVolumeName f: -DestinationComputerName SR-SRVCLUSB -DestinationRGName rg02 -DestinationVolumeName c:\ClusterStorage\Volume2 -DestinationLogVolumeName f:  
    ```  

    > [!WARNING]  
    > По умолчанию размер журнала составляет 8 ГБ. В зависимости от результатов работы командлета **Test-SRTopology** иногда целесообразно использовать журнал большего или меньшего размера (параметр **-LogSizeInBytes**).  

4.  Чтобы получить сведения о состоянии источника и назначения репликации, используйте командлеты **Get-SRGroup** и **Get-SRPartnership**, как описано ниже.  

    ```powershell
    Get-SRGroup  
    Get-SRPartnership  
    (Get-SRGroup).replicas  
    ```  

5.  Ход репликации можно отслеживать следующим образом.  

    1.  На исходном сервере введите следующую команду и изучите события 5015, 5002, 5004, 1237, 5001 и 2200.
        
        ```PowerShell
        Get-WinEvent -ProviderName Microsoft-Windows-StorageReplica -max 20
        ```
    2.  На конечном сервере выполните следующую команду для просмотра событий реплики хранилища, которые показывают создание партнерства. Это событие сообщает количество скопированных байтов и время выполнения. Пример:  
        
        ```powershell
        Get-WinEvent -ProviderName Microsoft-Windows-StorageReplica | Where-Object {$_.ID -eq "1215"} | Format-List
        ```
        Ниже приведен пример выходных данных.
        
        ```
        TimeCreated  : 4/8/2016 4:12:37 PM  
        ProviderName : Microsoft-Windows-StorageReplica  
        Id           : 1215  
        Message      : Block copy completed for replica.  
            ReplicationGroupName: rg02  
            ReplicationGroupId:  
            {616F1E00-5A68-4447-830F-B0B0EFBD359C}  
            ReplicaName: f:\  
            ReplicaId: {00000000-0000-0000-0000-000000000000}  
            End LSN in bitmap:  
            LogGeneration: {00000000-0000-0000-0000-000000000000}  
            LogFileId: 0  
            CLSFLsn: 0xFFFFFFFF  
            Number of Bytes Recovered: 68583161856  
            Elapsed Time (seconds): 117  
        ```
    3. Кроме того, группа целевых серверов для реплики постоянно сообщает количество оставшихся байтов для копирования и эти сведения можно запрашивать с помощью PowerShell. Например:

       ```PowerShell
       (Get-SRGroup).Replicas | Select-Object numofbytesremaining
       ```

       Пример контроля выполнения (не завершается самостоятельно):  

       ```PowerShell
         while($true) {  
         $v = (Get-SRGroup -Name "Replication 2").replicas | Select-Object numofbytesremaining  
         [System.Console]::Write("Number of bytes remaining: {0}`r", $v.numofbytesremaining)  
         Start-Sleep -s 5  
        }
        ```

6. На целевом сервере в целевом кластере выполните следующую команду и проверьте события 5009, 1237, 5001, 5015, 5005 и 2200 для отслеживания хода обработки события. В этой последовательности не должно быть предупреждений или ошибок. Будет много событий 1237, которые указывают ход выполнения.  
    
   ```PowerShell
   Get-WinEvent -ProviderName Microsoft-Windows-StorageReplica | FL  
   ```
   > [!NOTE]  
        > Во время репликации целевого диска кластера всегда отображается значение **Online (No Access)** (В сети (нет доступа)).  

## <a name="step-4-manage-replication"></a>Шаг 4. Управление репликацией

Теперь приступим к управлению межкластерной репликацией и работе с ней. Все описанные ниже шаги можно выполнять на узлах кластера непосредственно или с помощью компьютера удаленного управления, на котором установлены средства удаленного администрирования сервера Windows Server2016.  

1.  Используйте командлет **Get-ClusterGroup** или **диспетчер отказоустойчивости кластеров**, чтобы определить источник и цель репликации и их текущее состояние.  

2.  Для измерения производительности репликации выполните командлет **Get-Counter** на исходном и целевом узлах. Ниже перечислены имена счетчиков.  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Количество раз приостановки записи на диск  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Количество вводов-выводов записи на диск в ожидании  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Количество запросов для последней записи в журнал  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Средняя длина очереди записи на диск  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Текущая длина очереди записи на диск  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Количество запросов записи приложения  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Среднее число запросов в операции записи в журнал  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Средняя задержка записи приложения  

    -   \Статистика ввода-вывода раздела реплики хранилища(*)\Средняя задержка чтения приложения  

    -   \Статистика реплики хранилища(*)\Целевая RPO  

    -   \Статистика реплики хранилища(*)\Текущая RPO  

    -   \Статистика реплики хранилища(*)\Средняя длина очереди журнала  

    -   \Статистика реплики хранилища(*)\Длина очереди текущего журнала  

    -   \Статистика реплики хранилища(*)\Всего байтов получено  

    -   \Статистика реплики хранилища(*)\Всего байтов отправлено  

    -   \Статистика реплики хранилища(*)\Средняя время задержки исходящих данных в сети  

    -   \Статистика реплики хранилища(*)\Состояние репликации  

    -   \Статистика реплики хранилища(*)\Средняя задержка приема-передачи сообщения  

    -   \Статистика реплики хранилища(*)\Время, затраченное на последнее восстановление  

    -   \Статистика реплики хранилища(*)\Количество транзакций восстановления, записанных на диск  

    -   \Статистика реплики хранилища(*)\Количество транзакций восстановления  

    -   \Статистика реплики хранилища(*)\Количество транзакций репликации, записанных на диск  

    -   \Статистика реплики хранилища(*)\Количество транзакций репликации  

    -   \Статистика реплики хранилища(*)\Максимальный порядковый номер журнала  

    -   \Статистика реплики хранилища(*)\Количество полученных сообщений  

    -   \Статистика реплики хранилища(*)\Количество отправленных сообщений  

    Дополнительные сведения о счетчиках производительности, доступных в Windows PowerShell, есть в описании командлета [Get-Counter](https://technet.microsoft.com/library/hh849685.aspx).  

3.  Чтобы изменить направление репликации с одного сайта, используйте командлет **Set-SRPartnership**.  

    ```PowerShell
    Set-SRPartnership -NewSourceComputerName SR-SRVCLUSB -SourceRGName rg02 -DestinationComputerName SR-SRVCLUSA -DestinationRGName rg01  
    ```  

    > [!NOTE]  
    > Windows Server2016 блокирует изменение ролей в процессе начальной синхронизации, так как попытка переключения до завершения начальной синхронизации может привести к потере данных. Не осуществляйте принудительное переключение направления до завершения начальной синхронизации.

    Проверьте журналы событий и убедитесь, что направление репликации изменено и режим восстановления установлен, а затем выполните согласование. Теперь операции записи смогут использовать хранилище, принадлежащее новому исходному серверу. Изменение направления репликации блокирует операции записи на компьютере, который ранее был исходным.  

    > [!NOTE]  
    > Во время репликации целевого диска кластера всегда отображается значение **Online (No Access)** (В сети (нет доступа)).  

4.  Чтобы изменить размер журнала (8ГБ по умолчанию) в Windows Server2016, используйте командлет **Set-SRGroup** в группах реплик хранилищ источника и назначения.  

    > [!IMPORTANT]  
    > По умолчанию размер журнала составляет 8ГБ. В зависимости от результатов работы командлета **Test-SRTopology** иногда целесообразно использовать журнал большего или меньшего размера (параметр -LogSizeInBytes).  

5.  Чтобы удалить репликацию, используйте командлеты **Get-SRGroup**, **Get-SRPartnership**, **Remove-SRGroup** и **Remove-SRPartnership** в каждом кластере.  

    ```powershell
    Get-SRPartnership | Remove-SRPartnership  
    Get-SRGroup | Remove-SRGroup  
    ```  

    > [!NOTE]  
    > Реплика хранилища отключает конечные тома. Это сделано намеренно.

## <a name="see-also"></a>См. также:

-   [Общие сведения о реплике хранилища](storage-replica-overview.md) 
-   [Репликация растянутого кластера с помощью общего хранилища](stretch-cluster-replication-using-shared-storage.md)  
-   [Репликация с сервера в хранилище сервера](server-to-server-storage-replication.md)  
-   [Известные проблемы с репликой хранилища](storage-replica-known-issues.md)  
-   [Часто задаваемые вопросы о реплике хранилища](storage-replica-frequently-asked-questions.md)  
-   [Локальные дисковые пространства в Windows Server2016](../storage-spaces/storage-spaces-direct-overview.md)  
