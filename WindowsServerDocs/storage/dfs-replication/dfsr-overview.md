---
title: Обзор репликация DFS
ms.date: 03/08/2019
ms.prod: windows-server-threshold
ms.technology: storage
author: JasonGerend
manager: elizapo
ms.author: jgerend
ms.openlocfilehash: 7c092547688bed01d3d588116badf6191e87b1ed
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70871960"
---
# <a name="dfs-replication-overview"></a>Обзор репликация DFS

> Относится к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008, Windows Server (половина ежегодного канала)

Репликация DFS — это служба роли в Windows Server, которая позволяет эффективно реплицировать папки (включая те, которые называются путем пространства имен DFS) на нескольких серверах и сайтах. Репликация DFS — это эффективный механизм репликации с несколькими хозяевами, который можно использовать для синхронизации папок между серверами через ограниченную пропускную способность сетевых подключений. Он заменяет службу репликации файлов (FRS) в качестве механизма репликации для пространств имен DFS, а также для репликации папки SYSVOL домен Active Directory Services (AD DS) в доменах, использующих режим работы домена Windows Server 2008 или более поздней версии.

Репликация DFS использует алгоритм сжатия, называемый удаленным разностным сжатием (remote differential compression — RDC). RDC обнаруживает изменения в данных в файле и позволяет репликация DFS реплицировать только измененные блоки файлов, а не весь файл.

Дополнительные сведения о репликации SYSVOL с помощью репликация DFS см. [в статье миграция репликации SYSVOL в репликация DFS](migrate-sysvol-to-dfsr.md).

Чтобы использовать репликация DFS, необходимо создать группы репликации и добавить в группы реплицированные папки. На следующем рисунке показаны группы репликации, реплицированные папки и элементы.

![Группа репликации, содержащая соединение между двумя членами, в каждой из которых имеется несколько реплицируемых папок](media/dfsr-overview.gif)

На этом рисунке показано, что группа репликации — это набор серверов, называемых членами, которые участвуют в репликации одной или нескольких реплицированных папок. Реплицированная папка — это папка, которая остается синхронизированной для каждого элемента. На рисунке есть две реплицируемые папки: Проекты и предложения. По мере изменения данных в каждой реплицированной папке изменения реплицируются по соединениям между членами группы репликации. Подключения между всеми членами формируют топологию репликации.
Создание нескольких реплицируемых папок в одной группе репликации упрощает процесс развертывания реплицированных папок, так как топология, расписание и регулирование полосы пропускания для группы репликации применяются к каждой реплицированной папке. Для развертывания дополнительных реплицированных папок можно использовать программу Dfsradmin. exe или следовать инструкциям мастера, чтобы определить локальный путь и разрешения для новой реплицированной папки.

Каждая реплицированная папка имеет уникальные параметры, такие как фильтры файлов и вложенных папок, чтобы можно было отфильтровать разные файлы и вложенные папки для каждой реплицированной папки.

Реплицированные папки, хранящиеся на каждом элементе, могут находиться на разных томах в члене, а реплицированные папки не должны быть общими папками или частью пространства имен. Однако оснастка управления DFS упрощает совместное использование реплицированных папок и при необходимости публикует их в существующем пространстве имен.

Можно администрировать репликация DFS с помощью управления DFS, команд DfsrAdmin и Dfsrdiag, а также сценариев, вызывающих WMI.

## <a name="requirements"></a>Требования

До начала развертывания репликации распределенной файловой системы (DFS) необходимо настроить серверы следующим образом.

- Обновите схему домен Active Directory Services (AD DS), включив в нее дополнения к схеме Windows Server 2003 R2 или более поздней версии. Нельзя использовать реплицированные папки только для чтения с дополнениями схемы Windows Server 2003 R2 или более ранней версии.
- Убедитесь, что все серверы в группе репликации находятся в одном и том же лесу. Репликация на серверах, находящихся в разных лесах, недоступна.
- Установите репликацию DFS на все серверы, которые будут членами группы репликации.
- Чтобы проверить совместимость антивирусного программного обеспечения с репликацией распределенной файловой системы (DFS), свяжитесь с поставщиком антивирусного программного обеспечения.
- Найдите все папки, которые требуется реплицировать, на томах, форматированных в файловой системе NTFS. Репликация DFS не поддерживает файловые системы ReFS (Resilient File System) и FAT. Также репликация DFS не поддерживает репликацию содержимого общих томов кластера.

## <a name="interoperability-with-azure-virtual-machines"></a>Взаимодействие с виртуальными машинами Azure

Использование репликация DFS на виртуальной машине в Azure было протестировано с Windows Server; Однако существуют некоторые ограничения и требования, которые необходимо выполнить.

- Использование снимков или сохраненных состояний для восстановления сервера, выполняющего репликацию DFS с целью реплицирования любых данных, кроме папки SYSVOL, приводит к отказу репликации DFS, что требует особых действий по восстановлению базы данных. Аналогичным образом, не следует экспортировать, клонировать или копировать виртуальные машины. Дополнительные сведения см. в статье [2517913](http://support.microsoft.com/kb/2517913) базы знаний Майкрософт и в разделе [Безопасная виртуализация DFSR](https://blogs.technet.microsoft.com/filecab/2013/04/05/safely-virtualizing-dfsr/).
- При резервном копировании данных в реплицированной папке, размещенной на виртуальной машине, необходимо использовать программы резервного копирования из гостевой виртуальной машины.
- Репликация DFS требуется доступ к физическим или виртуальным контроллерам домена — он не может напрямую взаимодействовать с Azure AD.
- Репликации DFS требуется VPN-подключение между локальными членами группы репликации и другими элементами, размещенными на виртуальных машинах Azure. Необходимо также настроить локальный маршрутизатор (например, Microsoft Forefront Threat Management Gateway) для разрешения сопоставителя конечных точек RPC (порт 135) и назначения случайным образом порта между 49152 и 65535 для передачи через VPN-подключение. Для указания статического порта вместо произвольного порта можно использовать командлет Set-Дфсрмачинеконфигуратион или программу командной строки Dfsrdiag. Дополнительные сведения о способах указания статического порта для репликации DFS см. в разделе [Set-DfsrMachineConfiguration](https://docs.microsoft.com/powershell/module/dfsr/set-dfsrserviceconfiguration). Сведения о связанных портах, используемых для управления Windows Server, см. в статье [832017](http://support.microsoft.com/kb/832017) в базе знаний Майкрософт.

Дополнительные сведения о начале работы с виртуальными машинами Azure см. на [веб-сайте Microsoft Azure](https://docs.microsoft.com/azure/virtual-machines/).

## <a name="installing-dfs-replication"></a>Установка репликация DFS

Репликация DFS является частью роли файлов и служб хранилища. Средства управления для DFS (Управление DFS, модуль репликация DFS для Windows PowerShell и средства командной строки) устанавливаются отдельно в составе средства удаленного администрирования сервера.

Установите репликация DFS с помощью [центра администрирования Windows](../../manage/windows-admin-center/understand/windows-admin-center.md), диспетчер сервера или PowerShell, как описано в следующих разделах.

### <a name="to-install-dfs-by-using-server-manager"></a>Чтобы установить DFS с помощью диспетчера серверов

1. Откройте диспетчер серверов, щелкните **Управление**, а затем нажмите кнопку **Добавить роли и компоненты**. Откроется мастер добавления ролей и компонентов.

2. На странице **Выбор сервера** выберите сервер или виртуальный жесткий диск автономной виртуальной машины, на который требуется установить DFS.

3. Выберите службы ролей и компоненты, которые следует установить.

    - Чтобы установить службу репликация DFS, на странице **роли сервера** выберите **репликация DFS**.

    - Чтобы установить только средства управления DFS, на странице **Компоненты** разверните узлы **Средства администрирования удаленного сервера**, **Средства администрирования ролей**, **Средства файловых служб**, а затем выберите **Средства управления DFS**.

         **Средства управления DFS** устанавливают оснастку «Управление DFS», модули пространств имен РЕПЛИКАЦИЯ DFS и DFS для Windows PowerShell, а также программы командной строки, но не устанавливают службы DFS на сервере.

### <a name="to-install-dfs-replication-by-using-windows-powershell"></a>Установка репликация DFS с помощью Windows PowerShell

Откройте сеанс Windows PowerShell с повышенными правами пользователя, а затем введите следующую команду, где < Name\> — это служба роли или компонент, который требуется установить (в следующей таблице приведен список релевантных служб ролей или компонентов).

```PowerShell
Install-WindowsFeature <name>
```

|Служба роли или компонент|Имя|
|---|---|
|Репликация DFS|`FS-DFS-Replication`|
|Средства управления DFS|`RSAT-DFS-Mgmt-Con`|

Например, для установки средств распределенной файловой системы, включенных в компонент средств удаленного администрирования сервера, введите:

```PowerShell
Install-WindowsFeature "RSAT-DFS-Mgmt-Con"
```

Чтобы установить репликация DFS и компоненты распределенная файловая система Tools компонента средства удаленного администрирования сервера, введите:

```PowerShell
Install-WindowsFeature "FS-DFS-Replication", "RSAT-DFS-Mgmt-Con"
```

## <a name="see-also"></a>См. также

- [Общие сведения о пространствах имен и репликация DFS DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127250(v%3dws.11))
- [Контрольный список. Развертывание репликация DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc772201(v%3dws.11))
- [Контрольный список. Управление репликация DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc755035(v%3dws.11))
- [Развертывание репликация DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770925(v%3dws.11))
- [Управление репликация DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770925(v%3dws.11))
- [Устранение неполадок репликация DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732802(v%3dws.11))
