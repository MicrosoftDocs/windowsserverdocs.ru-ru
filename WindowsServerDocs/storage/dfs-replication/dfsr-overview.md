---
title: Обзор репликации DFS
ms.date: 03/08/2019
ms.prod: windows-server
ms.technology: storage
author: JasonGerend
manager: elizapo
ms.author: jgerend
ms.openlocfilehash: c17fd78a2cf726ab156d3eda09b9c0e2d4ed6a75
ms.sourcegitcommit: aaae95cb05c44232099ec46b04a127c77a3f486e
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/20/2020
ms.locfileid: "77520360"
---
# <a name="dfs-replication-overview"></a>Обзор репликации DFS

> Применяется к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008, Windows Server (Semi-Annual Channel)

Репликация DFS представляет собой службу роли в Windows Server, которая позволяет эффективно реплицировать папки (включая те, ссылка на которые указывается по пути пространства имен DFS) между разными серверами и сайтами. Репликация DFS предоставляет эффективный механизм репликации между несколькими источниками, который поддерживает синхронизацию папок между серверами, соединенными сетевыми подключениями с ограниченной пропускной способностью. Она заменяет собой службу репликации файлов (FRS) в роли подсистемы репликации для пространств имен DFS, а также для репликации папки SYSVOL доменных служб Active Directory (AD DS) в доменах с Windows Server 2008 или более поздним функциональным уровнем.

Репликация DFS использует алгоритм сжатия, называемый удаленным разностным сжатием (remote differential compression — RDC). Алгоритм удаленного разностного сжатия определяет изменение данных в файле, что позволяет репликации DFS реплицировать только измененные блоки файла, а не весь файл.

Дополнительные сведения о переходе с репликации SYSVOL на репликацию DFS см. в [этой статье](migrate-sysvol-to-dfsr.md).

Чтобы использовать репликацию DFS, следует создать группы репликации и добавить в них реплицируемые папки. На следующем рисунке представлены группы репликации, реплицируемые папки и элементы.

![Группа репликации с подключением между двумя элементами, в каждом из которых есть несколько реплицируемых папок](media/dfsr-overview.gif)

На этом рисунке видно, что группа репликации представляет собой набор серверов (элементов), между которыми выполняется репликация одной или нескольких папок. Реплицируемая папка — это папка, содержимое которой постоянно синхронизируется между всеми элементами. На рисунке есть две реплицируемые папки: Projects и Proposals. При любом изменении данных в каждой реплицируемой папке все такие изменения реплицируются между элементами группы репликации по установленным подключениям. Подключения между всеми элементами формируют топологию репликации.
Создание нескольких реплицируемых папок в одной группе репликации упрощает процесс развертывания реплицируемых папок, так как топология, расписание и регулирование пропускной способности для группы репликации автоматически применяются к каждой реплицируемой папке. Чтобы развернуть дополнительные реплицируемые папки, нужно с помощью программы Dfsradmin.exe или по инструкциям мастера определить локальный путь и разрешения для новой реплицируемой папки.

Каждая реплицируемая папка имеет уникальные параметры, в том числе фильтры файлов и вложенных папок, что позволяет исключать разные файлы и вложенные папки для каждой реплицируемой папки.

Реплицируемые папки, которые хранятся в каждом элементе, могут находиться на разных томах, и их не обязательно делать общими папками или включать в пространства имен. Но оснастка управления DFS позволяет легко предоставить общий доступ к реплицируемым папкам, а при желании — опубликовать их в существующем пространстве имен.

Для управления репликацией DFS можно использовать оснастку управления DFS, команды DfsrAdmin и Dfsrdiag, а также скрипты с вызовом WMI.

## <a name="requirements"></a>Требования

До начала развертывания репликации распределенной файловой системы (DFS) необходимо настроить серверы следующим образом.

- Обновите схему доменных служб Active Directory (AD DS), чтобы включить в нее дополнения для Windows Server 2003 R2 или более поздней версии. Нельзя использовать реплицируемые папки, доступные только для чтения, с дополнениями схемы для Windows Server 2003 R2 или более ранних версий.
- Убедитесь, что все серверы в группе репликации находятся в одном и том же лесу. Репликация на серверах, находящихся в разных лесах, недоступна.
- Установите репликацию DFS на все серверы, которые будут членами группы репликации.
- Чтобы проверить совместимость антивирусного программного обеспечения с репликацией распределенной файловой системы (DFS), свяжитесь с поставщиком антивирусного программного обеспечения.
- Найдите все папки, которые требуется реплицировать, на томах, форматированных в файловой системе NTFS. Репликация DFS не поддерживает файловые системы ReFS (Resilient File System) и FAT. Также репликация DFS не поддерживает репликацию содержимого общих томов кластера.

## <a name="interoperability-with-azure-virtual-machines"></a>Взаимодействие с виртуальными машинами Azure

Использование репликации DFS на виртуальной машине в Azure протестировано для Windows Server. Однако существуют некоторые ограничения и требования, которые необходимо соблюдать.

- Использование снимков или сохраненных состояний для восстановления сервера, выполняющего репликацию DFS с целью реплицирования любых данных, кроме папки SYSVOL, приводит к отказу репликации DFS, что требует особых действий по восстановлению базы данных. Точно так же нельзя экспортировать, клонировать или копировать виртуальные машины. Дополнительные сведения см. в статье [2517913](https://support.microsoft.com/kb/2517913) базы знаний Майкрософт и в разделе [Безопасная виртуализация DFSR](https://blogs.technet.microsoft.com/filecab/2013/04/05/safely-virtualizing-dfsr/).
- При резервном копировании данных в реплицированной папке, размещенной на виртуальной машине, необходимо использовать программы резервного копирования из гостевой виртуальной машины.
- Службе репликации DFS требуется доступ к физическим или виртуализованным контроллерам домена, так как она не может взаимодействовать непосредственно с AAD.
- Для репликации DFS требуется VPN-подключение между локальными членами группы репликации и другими элементами, размещенными на виртуальных машинах Azure. Необходимо также настроить локальный маршрутизатор (например, Forefront Threat Management Gateway), чтобы разрешить сопоставителю конечных точек RPC (порт 135) и случайным образом назначенному порту в диапазоне между 49152 и 65535 передачу через VPN-подключение. Лучше использовать статический, а не случайный порт, указав его с помощью командлета Set-DfsrMachineConfiguration или средства командной строки Dfsrdiag. Дополнительные сведения о способах указания статического порта для репликации DFS см. в разделе [Set-DfsrMachineConfiguration](https://docs.microsoft.com/powershell/module/dfsr/set-dfsrserviceconfiguration). Сведения о связанных портах, используемых для управления Windows Server, см. в статье [832017](https://support.microsoft.com/kb/832017) в базе знаний Майкрософт.

Дополнительные сведения о начале работы с виртуальными машинами Azure см. на [веб-сайте Microsoft Azure](https://docs.microsoft.com/azure/virtual-machines/).

## <a name="installing-dfs-replication"></a>Установка репликации DFS

Репликация DFS входит в роль "Файловые службы и службы хранилища". Средства управления для DFS ("Управление DFS", модуль репликации DFS для Windows PowerShell, а также средства командной строки) устанавливаются отдельно в составе средств администрирования удаленного сервера.

Репликацию DFS можно установить с помощью [Windows Admin Center](../../manage/windows-admin-center/understand/windows-admin-center.md), диспетчера сервера или PowerShell, как описано в следующих разделах.

### <a name="to-install-dfs-by-using-server-manager"></a>Чтобы установить DFS с помощью диспетчера серверов

1. Откройте диспетчер серверов, щелкните **Управление**, а затем нажмите кнопку **Добавить роли и компоненты**. Откроется мастер добавления ролей и компонентов.

2. На странице **Выбор сервера** выберите сервер или виртуальный жесткий диск автономной виртуальной машины, на который требуется установить DFS.

3. Выберите службы ролей и компоненты, которые следует установить.

    - Чтобы установить службу репликации DFS", на странице **Роли сервера** выберите **Репликация DFS**.

    - Чтобы установить только средства управления DFS, на странице **Компоненты** разверните узлы **Средства администрирования удаленного сервера**, **Средства администрирования ролей**, **Средства файловых служб**, а затем выберите **Средства управления DFS**.

         Компонент **Средства управления DFS** устанавливает оснастку "Управление DFS", модули "Пространства имен DFS" и "Репликация DFS" для Windows PowerShell, а также средства командной строки, но не устанавливает на сервер никаких служб DFS.

### <a name="to-install-dfs-replication-by-using-windows-powershell"></a>Установка репликации DFS с помощью Windows PowerShell

Откройте сеанс Windows PowerShell с правами привилегированного пользователя, после чего введите указанную ниже команду, где <name\> обозначает службу роли или компонент, которые требуется установить (см. следующую таблицу со списком соответствующих имен служб ролей или компонентов).

```PowerShell
Install-WindowsFeature <name>
```

|Служба роли или компонент|Название|
|---|---|
|Репликация DFS|`FS-DFS-Replication`|
|Средства управления DFS|`RSAT-DFS-Mgmt-Con`|

Например, для установки средств распределенной файловой системы, включенных в компонент средств удаленного администрирования сервера, введите:

```PowerShell
Install-WindowsFeature "RSAT-DFS-Mgmt-Con"
```

Для установки таких частей компонента средств удаленного администрирования сервера, как "Репликация DFS" и "Средства распределенной файловой системы", введите:

```PowerShell
Install-WindowsFeature "FS-DFS-Replication", "RSAT-DFS-Mgmt-Con"
```

## <a name="see-also"></a>См. также статью

- [Общие сведения о пространствах имен DFS и репликации DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127250(v%3dws.11))
- [Контрольный список. Развертывание репликации DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc772201(v%3dws.11))
- [Контрольный список. Управление репликацией DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc755035(v%3dws.11))
- [Развертывание репликации DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770925(v%3dws.11))
- [Управление репликацией DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770925(v%3dws.11))
- [Устранение неполадок при репликации DFS](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732802(v%3dws.11))
