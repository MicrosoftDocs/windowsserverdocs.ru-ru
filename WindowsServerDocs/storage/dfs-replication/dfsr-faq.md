---
title: Репликация DFS. Вопросы и ответы
ms.date: 06/18/2014
ms.prod: windows-server
ms.technology: storage
author: JasonGerend
manager: elizapo
ms.author: jgerend
ms.openlocfilehash: 1e11f6c596d7e5eb0bdf379adcf47d21e74e9f6b
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80815627"
---
# <a name="dfs-replication-frequently-asked-questions-faq"></a>Репликация DFS. Вопросы и ответы


Обновлено: 30 апреля 2019 г.

Область применения. Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008

В этой статье содержатся ответы на вопросы о репликации распределенной файловой системы (DFS) (также известной как DFS-R или DFSR) для Windows Server.

Дополнительные сведения о пространствах имен DFS см. в разделе [Пространства имен DFS: Вопросы и ответы](https://technet.microsoft.com/library/ee404780).

Сведения о новых возможностях репликации DFS см. в следующих разделах:

  - [Обзор пространств имен DFS и репликации DFS](https://technet.microsoft.com/library/jj127250) (в Windows Server 2012)  
      
  - [Новые возможности распределенной файловой системы](https://technet.microsoft.com/library/ee307957) в статье [Изменения функциональных возможностей от Windows Server 2008 до Windows Server 2008 R2](https://technet.microsoft.com/library/dd391932)  
      
  - [Распределенная файловая система](https://technet.microsoft.com/library/cc753479) в статье [Изменения функциональных возможностей от Windows Server 2003 с пакетом обновления 1 (SP1) до Windows Server 2008](https://technet.microsoft.com/library/cc753208)  
      

Список последних изменений раздела см. в подразделе [История изменений](#change-history) этого раздела.

      

## <a name="interoperability"></a>Взаимодействие

### <a name="can-dfs-replication-communicate-with-frs"></a>Может ли репликация DFS взаимодействовать с FRS?

Нет. Репликация DFS не взаимодействует со службой репликации файлов (FRS). Репликации DFS и FRS могут выполняться на одном сервере одновременно, но они не должны быть настроены для репликации одних и тех же папок или вложенных папок, так как это может привести к потере данных.

### <a name="can-dfs-replication-replace-frs-for-sysvol-replication"></a>Можно ли для репликации SYSVOL заменить FRS репликацией DFS

Да, репликация DFS может заменить FRS для репликации SYSVOL на серверах под Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008. Серверы под управлением Windows Server 2003 R2 не поддерживают использование репликации DFS для репликации папки SYSVOL.

Дополнительные сведения о репликации SYSVOL с помощью репликации DFS см. в статье [Руководство по миграции репликации SYSVOL: FRS to DFS Replication](https://technet.microsoft.com/library/dd640019) (Руководство по переносу репликации папки SYSVOL: репликация FRS в DFS).

### <a name="can-i-upgrade-from-frs-to-dfs-replication-without-losing-configuration-settings"></a>Можно ли выполнить обновление с репликации FRS на репликацию DFS без потери параметров конфигурации?

Да. Чтобы заменить репликацию FRS на репликацию DFS, см. следующие документы:

  - Сведения о миграции репликации папок, отличных от папки SYSVOL, см. в разделе [Руководство по операциям DFS: миграция с FRS на DFS](https://go.microsoft.com/fwlink/?linkid=192776) и [FRS2DFSR — An FRS to DFSR Migration Utility](https://go.microsoft.com/fwlink/?linkid=195437) (FRS2DFSR — средство миграции с FRS на DFSR) (https://go.microsoft.com/fwlink/?LinkID=195437).  
      
  - Чтобы начать репликацию папки SYSVOL с помощью репликации DFS, см. [Руководство по миграции репликации SYSVOL: FRS to DFS Replication](https://technet.microsoft.com/library/dd640019) (Руководство по переносу репликации папки SYSVOL: репликация FRS в DFS).  
      

### <a name="can-i-use-dfs-replication-in-a-mixed-windowsunix-environment"></a>Можно ли использовать репликацию DFS в смешанной среде Windows и UNIX?

Да. Хотя репликация DFS поддерживает только репликацию содержимого между серверами под управлением Windows Server, клиенты UNIX могут получать доступ к общим папкам на серверах Windows. Для этого установите службы для сетевых файловых систем (NFS) на сервере репликации DFS.

Вы также можете использовать функциональность клиента SMB/CIFS, доступную во многих клиентах UNIX, для прямого доступа к общим папкам Windows, хотя эта функциональность зачастую ограничена или требует внесения изменений в среду Windows (например, отключить подписывание SMB с помощью групповой политики).

Репликация DFS взаимодействует с NFS на сервере под управлением операционной системы Windows Server, но точку подключения NFS реплицировать нельзя.

### <a name="can-i-use-the-volume-shadow-copy-service-with-dfs-replication"></a>Можно ли использовать службу теневого копирования томов совместно с репликацией DFS?

Да. Репликация DFS на томах со службой теневого копирования томов (VSS) поддерживается и предыдущие моментальные снимки можно успешно восстановить с помощью клиента предыдущих версий.

### <a name="can-i-use-windowsbackup-ntbackupexe-to-remotely-back-up-a-replicated-folder"></a>Можно ли использовать программу архивации Windows Backup (Ntbackup.exe) для удаленного резервного копирования реплицированной папки?

Нет, использование программы архивации Windows Backup (Ntbackup.exe) на компьютере под управлением Windows Server 2003 или более ранней версии для резервного копирования содержимого реплицированной папки на компьютере под управлением Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008 не поддерживается.

Для резервного копирования файлов, хранящихся в реплицированной папке, используйте систему архивации данных Windows Server или Microsoft&reg; System Center Data Protection Manager. Сведения о функциях резервного копирования и восстановления в Windows Server 2008 R2 и Windows Server 2008 см. в разделе [Резервное копирование и восстановление](https://technet.microsoft.com/library/Cc754097). Дополнительные сведения см. в разделе [System Center Data Protection Manager](https://go.microsoft.com/fwlink/?linkid=182261) (https://go.microsoft.com/fwlink/?LinkId=182261).

### <a name="do-file-system-policies-impact-dfs-replication"></a>Влияют ли политики файловой системы на репликацию DFS?

Да. Не настраивайте политики файловой системы на реплицированных папках. Политика файловой системы повторно применяет разрешения NTFS после каждого интервала обновления групповой политики. Это может привести к нарушениям совместного доступа, так как открытый файл не реплицируется, пока он не будет закрыт.

### <a name="does-dfs-replication-replicate-mailboxes-hosted-on-microsoft-exchange-server"></a>Может ли репликация DFS выполняться на почтовых ящиках, размещенных на сервере Microsoft Exchange Server?

Нет. Репликацию DFS нельзя использовать для репликации почтовых ящиков, размещенных на сервере Microsoft Exchange Server.

### <a name="does-dfs-replication-support-file-screens-created-by-file-server-resource-manager"></a>Поддерживает ли репликация DFS фильтры блокировки файлов, созданные диспетчером ресурсов файлового сервера?

Да. Однако параметры фильтра блокировки файлов диспетчера ресурсов файлового сервера (FSRM) должны совпадать на обеих сторонах репликации. Кроме того, репликация DFS имеет собственный механизм фильтрации для файлов и папок, которые можно использовать для исключения определенных файлов и типов файлов из репликации.

Ниже приведены рекомендации по применению фильтров блокировки файлов или файловых квот.

  - К скрытой папке DfsrPrivate не должны применяться квоты или фильтры блокировки файлов.  
      
  - Перед включением блокировки в реплицированной папке не должно быть файлов, к которым применяются фильтры блокировки.  
      
  - Папки не должны превысить свои квоты до включения квот.  
      
  - Жесткие квоты необходимо использовать с осторожностью. Отдельные члены группы репликации могут оставаться в пределах квоты до репликации, но при этом превысить ее при репликации файлов. Например, если пользователь копирует файл размером 10 мегабайт (Мбайт) на сервер A (который имеет жесткие ограничения), а другой пользователь копирует файл размером 5 Мбайт на сервер B, и при следующей репликации оба сервера превышают квоту на 5 мегабайт. Это может привести к тому, что репликация DFS будет постоянно пытаться повторять репликацию файлов, вызывая бреши в векторе версий и создавая возможные проблемы с производительностью.  
      

### <a name="is-dfs-replication-cluster-aware"></a>Поддерживает ли репликация DFS кластеры?

Да, репликация DFS в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2008 R2 допускает возможность добавления отказоустойчивого кластера в состав группы репликации. Дополнительные сведения см. в разделе [Добавление отказоустойчивого кластера в группу репликации](https://go.microsoft.com/fwlink/?linkid=155085) (https://go.microsoft.com/fwlink/?LinkId=155085). Служба репликация DFS в версиях Windows, предшествовавших Windows Server 2008 R2, не предназначена для работы с отказоустойчивым кластером, и служба не будет отрабатывать отказ на другой узел.


> [!NOTE]
> Репликация DFS не поддерживает репликацию файлов на общих томах кластера. 
<br>


### <a name="is-dfs-replication-compatible-with-data-deduplication"></a>Репликация DFS совместима с дедупликацией данных?

Да, репликация DFS может реплицировать папки на томах, использующих дедупликацию данных в среде Windows Server.

### <a name="is-dfs-replication-compatible-with-ris-and-wds"></a>Совместима ли репликация DFS со службами RIS и WDS?

Да. Репликация DFS реплицирует тома, на которых включено хранилище единственных копий (SIS). SIS используется службами удаленной установки (RIS), службами развертывания Windows (WDS) и сервером Windows Storage Server.

### <a name="is-it-possible-to-use-dfs-replication-with-offline-files"></a>Можно ли использовать репликацию DFS с автономными файлами?

Вы можете безопасно использовать одновременно репликацию DFS и автономные файлы в сценариях, когда в любой момент времени есть только один пользователь, который выполняет запись в файлы. Это удобно в случае пользователей, которые перемещаются между двумя филиалами и хотят иметь доступ к своим файлам из филиала или при работе в автономном режиме. Служба автономных файлов кэширует файлы локально для автономного использования и репликация DFS реплицирует данные между всеми филиалами.

Не используйте репликацию DFS с автономными файлами в среде с несколькими пользователями, так как репликация DFS не предоставляет ни одного механизма распределенной блокировки или возможности извлечения файлов. Если два пользователя одновременно изменяют один и тот же файл на разных серверах, репликация DFS перемещает старый файл в папку DfsrPrivate\\ConflictandDeleted (которая находится по локальному пути реплицированной папки) во время следующей репликации.

### <a name="what-antivirus-applications-are-compatible-with-dfs-replication"></a>Какие антивирусные приложения совместимы с репликацией DFS?

Антивирусные приложения могут вызвать избыточную репликацию, если при сканировании они изменяют файлы в реплицированной папке. Дополнительные сведения см. в статье [Testing Antivirus Application Interoperability with DFS Replication](https://go.microsoft.com/fwlink/?linkid=73990) (Проверка взаимодействия антивирусных приложений с репликацией DFS) (https://go.microsoft.com/fwlink/?LinkId=73990).

### <a name="what-are-the-benefits-of-using-dfs-replication-instead-of-windows-sharepoint-services"></a>Каковы преимущества использования репликации DFS вместо служб Windows SharePoint Services?

Службы Windows&reg; SharePoint&reg; Services обеспечивают согласованную работу благодаря функции извлечения файлов, которая в репликации DFS не поддерживается. Если одновременное изменение одного и того же файла несколькими людьми имеет значение, рекомендуется использовать службы Windows SharePoint Services. Windows SharePoint Services 2.0 с пакетом обновления 2 (SP2) доступна в составе Windows Server 2003 R2. Windows SharePoint Services можно загрузить с веб-сайта корпорации Майкрософт. Он исключен из состава более новых версий Windows Server. Однако если репликация данных выполняется на нескольких сайтах и пользователи не будут одновременно изменять одни и те же файлы, репликация DFS обеспечивает большую пропускную способность и упрощает управление.

## <a name="limitations-and-requirements"></a>Ограничения и требования

### <a name="can-dfs-replication-replicate-between-branch-offices-without-a-vpn-connection"></a>Позволяет ли репликация DFS реплицировать файлы между филиалами без VPN-подключения?

Да — при условии, что имеется ссылка на частную глобальную сеть (WAN) (не Интернет), соединяющую филиалы. Однако необходимо открыть соответствующие порты во внешних брандмауэрах. Репликация DFS использует сопоставитель конечных точек RPC (порт 135) и случайным образом назначенный временный порт выше порта 1024. Для указания статического порта вместо временного можно использовать средство командной строки **Dfsrdiag**. Дополнительные сведения об указании сопоставителя конечных точек RPC см. [в статье 154596](https://go.microsoft.com/fwlink/?linkid=73991) базы знаний Майкрософт (https://go.microsoft.com/fwlink/?LinkId=73991).

### <a name="can-dfs-replication-replicate-files-encrypted-with-the-encrypting-file-system"></a>Позволяет ли репликация DFS реплицировать файлы, зашифрованные с помощью шифрованной файловой системы (EFS)?

Нет. Репликация DFS не будет реплицировать файлы или папки, зашифрованные с помощью шифрованной файловой системы (EFS). Если пользователь шифрует файл, который ранее был реплицирован, репликация DFS удаляет его со всех остальных членов группы репликации. Это гарантирует, что единственной доступной копией файла будет только зашифрованная версия на сервере.

### <a name="can-dfs-replication-replicate-outlook-pst-or-microsoft-office-access-database-files"></a>Может ли репликация DFS реплицировать PST-файлы Outlook или базы данных Microsoft Office Access?

Репликация DFS может безопасно реплицировать файлы личных папок Microsoft Outlook (PST) и файлы Microsoft Access только если они хранятся в архивных целях и недоступны по сети с помощью клиента, например Outlook или Access (для открытия PST-файла или файлов Access сначала скопируйте их в локальное хранилище). Причины этого перечислены ниже.

  - Открытие PST-файлов по сети может привести к повреждению данных в PST-файлах. Дополнительные сведения о том, почему невозможно безопасно получать доступ к PST-файлам по сети, см. в статье [KB 297019](https://go.microsoft.com/fwlink/?linkid=125363) базы знаний Майкрософт (https://go.microsoft.com/fwlink/?LinkId=125363).  
      
  - PST-файлы и файлы Access, как правило, остаются открытыми в течение длительного времени при доступе с помощью клиента, например Outlook или Office Access. Это не позволяет репликации DFS выполнить репликацию этих файлов, пока они не будут закрыты.  
      

### <a name="can-i-use-dfs-replication-in-a-workgroup"></a>Можно ли использовать репликацию DFS в рабочей группе?

Нет. Настройка репликации DFS зависит от доменных служб Active Directory&reg;. Она будет работать только в домене.

### <a name="can-more-than-one-folder-be-replicated-on-a-single-server"></a>Может ли более одной папки реплицироваться на одном сервере?

Да. Репликация DFS может реплицировать между серверами множество папок. Убедитесь, что каждая реплицированная папка имеет уникальный корневой путь, и что они не перекрываются. Например, D:\\Sales и D:\\Accounting могут быть корневыми путями для двух реплицируемых папок, но D:\\Sales и D:\\Sales\\Reports не могут быть корневыми путями для двух реплицируемых папок.

### <a name="does-dfs-replication-require-dfs-namespaces"></a>Требуется ли для репликации DFS пространства имен DFS?

Нет. Репликация DFS и пространство имен DFS можно использовать отдельно или вместе. Кроме того, репликацию DFS можно использовать для репликации изолированных пространств имен DFS, что было невозможно с FRS.

### <a name="does-dfs-replication-require-time-synchronization-between-servers"></a>Требуется ли для репликации DFS синхронизация времени между серверами?

Нет. Репликация DFS не требует явной синхронизации времени между серверами. Однако репликация DFS требует тщательного соответствия серверных часов. Для правильной работы проверки подлинности Kerberos необходимо установить серверные часы в пределах пяти минут друг от друга (по умолчанию). Например, репликация DFS использует метки времени, чтобы при возникновении конфликта определить, какой файл имеет приоритет. Точные значения времени также важны для сбора мусора, следования расписанию и других функций.

### <a name="does-dfs-replication-support-replicating-an-entire-volume"></a>Поддерживает ли репликация DFS репликацию всего тома?

Да. Однако сначала необходимо установить Windows Server 2003 с пакетом обновления 2 (SP2) или исправление. Дополнительные сведения см. в [статье 920335](https://go.microsoft.com/fwlink/?linkid=76776) базы знаний Майкрософт (https://go.microsoft.com/fwlink/?LinkId=76776). Кроме того, репликация всего тома может привести к следующим проблемам:

  - Если том содержит файл подкачки Windows, происходит сбой репликации и регистрируется событие DFSR 4312 в журнале системных событий.  
      
  - Репликация DFS задает системные и скрытые атрибуты реплицированной папки на целевых серверах. Это происходит потому, что Windows по умолчанию применяет атрибуты "Системная" и "Скрытая" к корневой папке тома. Если локальный путь реплицированной папки на целевых серверах также является корневой папкой тома, дальнейшие изменения в атрибуты папки не вносятся.  
      
  - При репликации тома, содержащего системную папку Windows, репликация DFS распознает папку %WINDIR% и не реплицирует ее. Однако репликация DFS выполняет репликацию папок, используемых приложениями сторонних производителей, что может привести к сбою приложений на целевых серверах, если приложения имеют проблемы взаимодействия с репликацией DFS.  
      

### <a name="does-dfs-replication-support-rpc-over-http"></a>Поддерживает ли репликация DFS механизм передачи RPC через HTTP?

Нет.

### <a name="does-dfs-replication-work-across-wireless-networks"></a>Работает ли репликация DFS в беспроводных сетях?

Да. Репликация DFS не зависит от типа соединения.

### <a name="does-dfs-replication-work-on-refs-or-fat-volumes"></a>Работает ли репликация DFS на томах ReFS или FAT?

Нет. Тем не менее, репликация DFS поддерживает тома, форматированные только в файловой системе NTFS, системы ReFS и FAT не поддерживаются. Для репликации DFS требуется NTFS, так как она использует журнал изменений NTFS и другие функции файловой системы NTFS.

### <a name="does-dfs-replication-work-with-sparse-files"></a>Работает ли репликация DFS с разреженными файлами?

Да. Вы можете реплицировать разреженные файлы. Атрибут **Разреженный** сохраняется на принимающем участнике.

### <a name="do-i-need-to-log-in-as-administrator-to-replicate-files"></a>Нужно ли для репликации файлов выполнять вход от имени администратора?

Нет. Репликация DFS — это служба, которая работает под локальной системной учетной записью, поэтому для репликации не нужно выполнять вход от имени администратора. Однако для внесения изменений в конфигурацию репликации DFS необходимо быть администратором домена или локальным администратором для файловых серверов, участвующих в репликации.

Дополнительные сведения см. в разделе "DFS Replication security requirements and delegation" (Требования к безопасности и делегирование в репликации DFS) в статье [Delegate the Ability to Manage DFS Replication](https://go.microsoft.com/fwlink/?linkid=182294) (Делегирование возможности управления репликацией DFS) (https://go.microsoft.com/fwlink/?LinkId=182294).

### <a name="how-can-i-upgrade-or-replace-a-dfs-replication-member"></a>Как обновить или заменить участника репликации DFS?

Чтобы обновить или заменить участника репликации DFS, см. эту запись в блоге команды разработчиков служб каталогов: [Replacing DFSR Member Hardware or OS](https://blogs.technet.com/b/askds/archive/2010/09/10/series-wrap-up-and-downloads-replacing-dfsr-member-hardware-or-os.aspx) (Замена оборудования или ОС участника DFSR).

### <a name="is-dfs-replication-suitable-for-replicating-roaming-profiles"></a>Подходит ли репликация DFS для репликации перемещаемых профилей?

Да. При репликации перемещаемых профилей пользователей поддерживаются определенные сценарии. Дополнительные сведения о поддерживаемых сценариях см. в разделе [Microsoft's Support Statement Around Replicated User Profile Data](https://go.microsoft.com/fwlink/?linkid=201282) (Заявление корпорации Майкрософт о поддержке реплицированных данных профилей пользователей) (https://go.microsoft.com/fwlink/?LinkId=201282).

### <a name="is-there-a-file-character-limit-or-limit-to-the-folder-depth"></a>Существует ли ограничение на число символов в имени файла или ограничение на глубину папки?

Windows и репликация DFS поддерживают пути к папкам длиной до 32 000 символов. Репликация DFS не имеет ограничений на пути к папкам в 260 символов.

### <a name="must-members-of-a-replication-group-reside-in-the-same-domain"></a>Должны ли члены группы репликации находиться в одном домене?

Нет. Группы репликации могут охватывать несколько доменов в пределах одного леса, но не в разных лесах.

### <a name="what-are-the-supported-limits-of-dfs-replication"></a>Каковы поддерживаемые ограничения репликации DFS?

Список ниже содержит набор рекомендаций по масштабируемости, которые были проверены корпорацией Майкрософт и применимы к Windows Server 2012 R2, Windows Server 2016 и Windows Server 2019

  - Размер всех реплицированных файлов на сервере: 100 Тбайт.  
      
  - Количество реплицированных файлов в томе: 70 млн.  
      
  - Максимальный размер файла: 250 Гбайт.  
      


> [!IMPORTANT]
> При создании групп репликации с большим числом или размером файлов рекомендуется экспортировать клон базы данных и использовать методы предварительного заполнения, чтобы максимально сократить длительность начальной репликации. Дополнительные сведения см. в статье [DFS Replication Initial Sync in Windows Server 2012 R2: Attack of the Clones](https://techcommunity.microsoft.com/t5/Storage-at-Microsoft/DFS-Replication-Initial-Sync-in-Windows-Server-2012-R2-Attack-of/ba-p/424877) (Начальная синхронизация репликации DFS в Windows Server 2012 R2: атака клонов). 
<br>


Список ниже содержит набор рекомендаций по масштабируемости, протестированных корпорацией Майкрософт в Windows Server 2012, Windows Server 2008 R2 и Windows Server 2008.

  - Размер всех реплицированных файлов на сервере: 10 Тбайт.  
      
  - Количество реплицированных файлов в томе: 11 млн.  
      
  - Максимальный размер файла: 64 Гбайт.  
      


> [!NOTE]
> Ограничений на количество групп репликации, реплицированных папок, подключений или членов группы репликации больше не существует. 
<br>


Список рекомендаций по масштабируемости, протестированных корпорацией Майкрософт для Windows Server 2003 R2, см. в разделе [DFS Replication scalability guidelines](https://go.microsoft.com/fwlink/?linkid=75043) (Рекомендации по масштабируемости репликации DFS) (https://go.microsoft.com/fwlink/?LinkId=75043).

### <a name="when-should-i-not-use-dfs-replication"></a>Когда не следует использовать репликацию DFS?

Не используйте репликацию DFS в среде, где несколько пользователей одновременно обновляют или изменяют одни и те же файлы на разных серверах. Это может привести к тому, что репликация DFS переместит конфликтующие копии файлов в скрытую папку DfsrPrivate\\ConflictandDeleted.

Если нескольким пользователям необходимо одновременно изменять одни и те же файлы на разных серверах, используйте функцию извлечения файлов в Windows SharePoint Services, чтобы гарантировать, что с файлом работает только один пользователь. Windows SharePoint Services 2.0 с пакетом обновления 2 (SP2) доступна в составе Windows Server 2003 R2. Windows SharePoint Services можно загрузить с веб-сайта корпорации Майкрософт. Он исключен из состава более новых версий Windows Server.

### <a name="why-is-a-schema-update-required-for-dfs-replication"></a>Зачем для репликации DFS требуется обновление схемы?

Репликация DFS использует новые объекты в контексте именования в доменных службах Active Directory Services для хранения сведений о конфигурации. Эти объекты создаются при обновлении схемы доменных служб Active Directory. Дополнительные сведения см. в статье [Review Requirements for DFS Replication](https://go.microsoft.com/fwlink/?linkid=182264) (Проверка требований для репликации DFS) (https://go.microsoft.com/fwlink/?LinkId=182264).

## <a name="monitoring-and-management-tools"></a>Средства наблюдения и управления

### <a name="can-i-automate-the-health-report-to-receive-warnings"></a>Можно ли автоматизировать отчет о работоспособности для получения предупреждений?

Да. Существует три способа автоматизации отчетов о работоспособности, которые перечислены ниже.

  - Использовать модуль DFSR Windows PowerShell, входящий в состав Windows Server 2012 R2 или DfsrAdmin.exe в сочетании с запланированными задачами, чтобы регулярно создавать отчеты о работоспособности. Дополнительные сведения см. в разделе [Automating DFS Replication Health Reports](https://go.microsoft.com/fwlink/?linkid=74010) (Автоматизация отчетов о работоспособности репликации DFS) (https://go.microsoft.com/fwlink/?LinkId=74010).  
      
  - Использовать пакет управления репликации DFS для System Center Operations Manager, чтобы создавать оповещения, основанные на указанных условиях.  
      
  - Использовать поставщик WMI репликации DFS для создания оповещений сценариев.  
      

### <a name="can-i-use-microsoft-system-center-operations-manager-to-monitor-dfs-replication"></a>Можно ли использовать Microsoft System Center Operations Manager для отслеживания репликации DFS?

Да. Дополнительные сведения см. в статье [DFS Replication Management Pack for System Center Operations Manager 2007](https://go.microsoft.com/fwlink/?linkid=182265) (Пакет управления репликации DFS для System Center Operations Manager 2007) в Центре загрузки Майкрософт (https://go.microsoft.com/fwlink/?LinkId=182265).

### <a name="does-dfs-replication-support-remote-management"></a>Поддерживает ли репликация DFS удаленное управление?

Да. Репликация DFS поддерживает удаленное управление с помощью консоли управления DFS и команды **Add Replication Group**. Например, на сервере A можно подключиться к группе репликации, определенной в лесу с серверами A и B в качестве членов.

Управление DFS входит в состав Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008 и Windows Server 2003 R2. Для управления репликацией DFS из других версий Windows используйте удаленный рабочий стол или [средства удаленного администрирования сервера для Windows 7](https://technet.microsoft.com/library/Ee449475).


> [!IMPORTANT]
> Для просмотра и управления группами репликации, содержащими доступные только для чтения реплицированные папки или члены, которые являются отказоустойчивыми кластерами, необходимо использовать версию оснастки управления DFS, входящую в состав Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, <a href="https://go.microsoft.com/fwlink/p/?linkid=238560">средств удаленного администрирования сервера для Windows 8</a> или <a href="https://technet.microsoft.com/library/ee449475">средств удаленного администрирования сервера для Windows 7</a>. 
<br>


### <a name="do-ultrasound-and-sonar-work-with-dfs-replication"></a>Работают ли средства Ultrasound и Sonar с репликацией DFS?

Нет. Репликация DFS имеет собственный набор средств мониторинга и диагностики. Средства Ultrasound и Sonar поддерживают только мониторинг FRS.

### <a name="how-can-files-be-recovered-from-the-conflictanddeleted-or-preexisting-folders"></a>Как можно восстановить файлы из папок ConflictAndDeleted или PreExisting?

Чтобы восстановить утерянные файлы, восстановите файлы из папки в файловой системе или из общей папки с помощью журнала файлов, команды **Restore previous versions** (Восстановить предыдущие версии) в проводнике или путем восстановления файлов из резервной копии. Чтобы восстановить файлы непосредственно из папки ConflictAndDeleted или PreExisting, используйте командлеты Windows PowerShell `Get-DfsrPreservedFiles` и `Restore-DfsrPreservedFiles` (входящие в состав модуля DFSR в Windows Server 2012 R2) или пример сценария [RestoreDFSR](https://code.msdn.microsoft.com/restoredfsr) из коллекции кода MSDN. Этот сценарий предназначен только для аварийного восстановления и предоставляется как есть, без гарантии.

### <a name="is-there-a-way-to-know-the-state-of-replication"></a>Есть ли способ выяснить состояние репликации?

Да. Существует несколько способов мониторинга репликации.

  - Репликация DFS содержит пакет управления для System Center Operations Manager, который обеспечивает активный мониторинг.  
      
  - Управление DFS содержит встроенный диагностический отчет, в котором регистрируется невыполненная репликация, эффективность репликации и количество файлов и папок в данной группе репликации.  
      
  - Модуль DFSR Windows PowerShell в Windows Server 2012 R2 содержит командлеты для запуска тестов распространения и записи отчетов о состоянии распространения и работоспособности. Дополнительные сведения см. в разделе [Distributed File System Replication Cmdlets in Windows PowerShell](https://technet.microsoft.com/library/dn296601.aspx) (Командлеты репликации DFS в Windows PowerShell).  
      
  - Dfsrdiag.exe — это программа командной строки, которая может формировать счетчик невыполненной работы или запускать тест распространения. В обоих случаях отображается состояние репликации. Распространение показывает, выполняется ли репликация файлов на все узлы. Невыполненная работа показывает, сколько файлов все еще необходимо реплицировать, прежде чем два компьютера будут синхронизированы. Количество невыполненных работ — это количество обновлений, которые не обрабатывались членом группы репликации. На компьютерах, работающих под управлением Windows Server 2012 R2, Windows Server 2012 или Windows Server 2008 R2, программа Dfsrdiag.exe также может отображать обновления, которые репликация DFS реплицирует в данный момент.  
      
  - Сценарии могут использовать инструментарий WMI для получения сведений о невыполненной работе — вручную или с помощью MOM.  
      

## <a name="performance"></a>Производительность

### <a name="does-dfs-replication-support-dial-up-connections"></a>Поддерживает ли репликация DFS подключения удаленного доступа?

Несмотря на то, что репликация DFS будет работать при коммутируемом вызове, она может получить невыполненный журнал при наличии большого количества изменений для репликации. Если в существующие файлы вносятся небольшие изменения, репликация DFS с удаленным разностным сжатием (RDC) обеспечит более высокую производительность, чем копирование файла напрямую.

### <a name="does-dfs-replication-perform-bandwidth-sensing"></a>Делает ли репликация DFS проверку пропускной способности?

Нет. Репликация DFS не выполняет проверку пропускной способности. Можно настроить репликацию DFS для использования ограниченной пропускной способности для каждого подключения (регулирование полосы пропускания). Однако репликация DFS не сокращает использование пропускной способности, если сетевой интерфейс перестает быть загруженным, и репликация DFS на короткое время может перегрузить канал. Регулирование пропускной способности в репликации DFS не является полностью точным, поскольку репликация DFS меняет пропускную способность путем регулирования вызовов RPC. В результате различные буферы на более низких уровнях сетевого стека (включая RPC) могут повлиять на трафик сети.

### <a name="does-dfs-replication-throttle-bandwidth-per-schedule-per-server-or-per-connection"></a>Репликация DFS регулирует пропускную способность по расписанию, по серверам или по подключениям?

При настройке регулирования пропускной способности при указании расписания все соединения для этой группы репликации будут использовать этот параметр для регулирования полосы пропускания. Регулирование пропускной способности также можно задать в качестве параметра уровня соединения, используя оснастку управления DFS.

### <a name="does-dfs-replication-use-active-directory-domain-services-to-calculate-site-links-and-connection-costs"></a>Использует ли репликация DFS доменные службы Active Directory для вычисления расходов на связи и подключения сайтов?

Нет. Репликация DFS использует топологию, определенную администратором, и которая не зависит от стоимости сайта доменных служб Active Directory Services.

### <a name="how-can-i-improve-replication-performance"></a>Как можно повысить производительность репликации?

Дополнительные сведения о различных методах настройки производительности репликации см. в разделе [Tuning Replication Performance in DFSR](https://blogs.technet.com/b/askds/archive/2010/03/31/tuning-replication-performance-in-dfsr-especially-on-win2008-r2.aspx) (Настройка производительности репликации в DFSR) в блоге [Ask the Directory Services Team](https://blogs.technet.com/b/askds/) (Вопросы группе разработчиков службы каталогов).

### <a name="how-does-dfs-replication-avoid-saturating-a-connection"></a>Как при репликации DFS избегают перегрузки подключения?

В репликации DFS вы устанавливаете максимальную пропускную способность, которую нужно использовать для подключения, и служба поддерживает этот уровень загрузки сети. Это отличается от фоновой интеллектуальной службы передачи (BITS), и репликация DFS не настраивает подключение, если задано соответствующее значение.

Тем не менее, регулирование пропускной способности не превышает 100%, а репликация DFS в течение короткого периода времени может перегружать канал. Это обусловлено тем, что репликация DFS меняет пропускную способность путем регулирования вызовов RPC. Поскольку этот процесс зависит от различных буферов на более низких уровнях сетевого стека, включая RPC, трафик репликации стремится к образованию пакетов, что иногда может привести к перегрузке сетевых соединений.

Репликация DFS в Windows Server 2008 содержит несколько улучшений производительности, как описано в разделе [Distributed File System](https://technet.microsoft.com/library/Cc753479) (Распределенная файловая система) в статье [Changes in Functionality from Windows Server 2003 with SP1 to Windows Server 2008](https://technet.microsoft.com/library/cc753208) (Изменения функциональности от Windows Server 2003 (SP1) до Windows Server 2008).

### <a name="how-does-dfs-replication-performance-compare-with-frs"></a>Насколько репликация DFS производительнее по сравнению с FRS?

Репликация DFS работает гораздо быстрее, чем FRS, особенно если небольшие изменения вносятся в большие файлы, а служба RDC включена. Например, при использовании RDC незначительное изменение презентации PowerPoint&reg; размером 2 МБ может привести к тому, что по сети будет передано только 60 килобайт (КБ) данных — в байтовом выражении достигается экономия порядка 97 %.

Служба RDC не используется для файлов размером менее 64 КБ и она может не приносить пользу в высокоскоростных ЛВС, в которых пропускная способность сети не используется полностью. Службу RDC можно отключить для каждого подключения отдельно, используя оснастку управления DFS.

### <a name="how-frequently-does-dfs-replication-replicate-data"></a>Как часто репликация DFS реплицирует данные?

Данные реплицируются в соответствии с заданным расписанием. Например, в расписании можно задать 15-минутные интервалы семь дней в неделю. В течение этих интервалов репликация включена. Репликация начнется вскоре после обнаружения изменения файла (обычно в течение нескольких секунд).

Для расписания группы репликации может быть задано значение время UTC, в то время как для расписания подключения задано местное время принимающего участника. Учтите это, если группа репликации охватывает несколько часовых поясов. Местное время означает время участника, на котором размещается входящее подключение. Показанное расписание входящего подключения и соответствующее исходящее подключение отражает разницу часовых поясов, если для расписания задано местное время.

### <a name="how-much-of-my-servers-system-resources-will-dfs-replication-consume"></a>Какой объем системных ресурсов сервера будет использовать репликация DFS?

Ресурсы диска, памяти и ЦП, используемые репликацией DFS, зависят от ряда факторов, включая число и размер файлов, скорость изменения, число членов группы репликации и количество реплицированных папок. Кроме того, некоторые ресурсы сложно оценить. Например, технология расширяемого хранилища (ESE), используемая для базы данных репликация DFS, может использовать значительный процент доступной памяти, которую она освобождает по запросу. Приложения, отличные от репликация DFS, могут размещаться на одном сервере в зависимости от конфигурации сервера. Однако при размещении нескольких приложений или ролей сервера на одном сервере важно проверить эту конфигурацию перед ее реализацией в рабочей среде.

### <a name="what-happens-if-a-wan-link-fails-during-replication"></a>Что происходит при сбое WAN-канала во время репликации?

Если соединение прервется, репликация DFS будет пытаться выполнить репликацию, пока открыто окно расписания. В журнале событий репликации DFS также будут отображаться ошибки подключения, которые можно собирать с помощью MOM (заранее с помощью оповещений) и отчета о работоспособности репликации DFS (по факту, например, после запуска администратором).

## <a name="remote-differential-compression-details"></a>Сведения об удаленном разностном сжатии

### <a name="are-changes-compressed-before-being-replicated"></a>Выполняется ли сжатие изменений перед их репликацией?

Да. Измененные фрагменты файлов сжимаются перед отправкой для всех типов файлов, за исключением следующих (которые уже сжаты): .wma, .wmv, .zip, .jpg, .mpg, .mpeg, .m1v, .mp2, .mp3, .mpa, .cab, .wav, .snd, .au, .asf, .wm, .avi, .z, .gz, .tgz и .frx. Параметры сжатия для этих типов файлов нельзя настроить в Windows Server 2003 R2.

### <a name="can-an-administrator-turn-off-rdc-or-change-the-threshold"></a>Может ли администратор отключить RDC или изменить пороговое значение?

Да. Вы можете отключить службу RDC на странице свойств данного соединения. Отключение RDC может снизить загрузку ЦП и задержку репликации в быстрых каналах в локальной сети, не имеющих ограничений пропускной способности, или для групп репликации, которые состоят в основном из файлов размером менее 64 КБ. Если вы решили отключить RDC для подключения, протестируйте эффективность репликации до и после изменения, чтобы убедиться в повышении производительности репликации.

Вы можете изменить пороговое значение размера RDC, используя команду **Dfsradmin Connection Set**, поставщик WMI репликации DFS или вручную изменить XML-файл конфигурации.

### <a name="does-rdc-work-on-all-file-types"></a>Работает ли RDC с файлами всех типов?

Да. RDC рассчитывает различия на уровне блоков независимо от типа данных файла. Однако RDC работает более эффективно для определенных типов файлов, таких как документы Word, PST-файлы и образы VHD.

### <a name="how-does-rdc-work-on-a-compressed-file"></a>Как работает RDC на сжатом файле?

Репликация DFS использует RDC, которая выполняет вычисление блоков в файле, которые были изменены, и отправляет только эти блоки по сети. Репликации DFS не нужно ничего знать о содержимом файла — только о том, какие блоки были изменены.

### <a name="is-cross-file-rdc-enabled-when-upgrading-to-windows-server-enterprise-edition-or-datacenter-edition"></a>Включено ли перекрестное RDC при обновлении до выпуска Windows Server Enterprise Edition или Datacenter?

Стандартные выпуски Windows Server не поддерживают перекрестное RDC. Однако оно автоматически включается при обновлении до выпуска, поддерживающего перекрестное RDC, или в случае, если участник подключения репликации работает под управлением поддерживаемого выпуска. Список выпусков, поддерживающих межфайловое перекрестное разностное сжатие (RDC), см. в статье "Which editions of the Windows operating system support cross-file RDC?" (Какие выпуски ОС Windows поддерживают перекрестное разностное сжатие файлов?)

### <a name="is-rdc-true-block-level-replication"></a>Действительно ли RDC работает на уровне блока?

Нет. RDC — это протокол общего назначения для сжатия при переносе файлов. Репликация DFS использует RDC в блоках на уровне файлов, а не на уровне блоков диска. RDC разделяет файл на блоки. Для каждого блока в файле вычисляется подпись, которая представляет собой небольшое число байтов, которое может представлять большой блок. Набор подписей передается с сервера на клиент. Клиент сравнивает подписи сервера со своими собственными. Затем клиент запрашивает на сервере отправку только данных для подписей, которые еще не находятся на клиенте.

### <a name="what-happens-if-i-rename-a-file"></a>Что произойдет, если я переименую файл?

Репликация DFS переименовывает файл на всех остальных членах группы репликации во время следующей репликации. Файлы отправляются с использованием уникального идентификатора, поэтому переименование файла и перемещение файла в реплике не влияют на возможность репликации файла репликацией DFS.

### <a name="what-is-cross-file-rdc"></a>Что такое перекрестное RDC?

Перекрестное разностное сжатие (RDC) позволяет репликации DFS использовать RDC, даже если на стороне клиента не существует файла с таким же именем. Перекрестное разностное сжатие (RDC) использует эвристику для определения файлов, которые похожи на файл, который необходимо реплицировать, и использует блоки аналогичных файлов, которые идентичны файлу репликации, чтобы максимально сокращать объем данных, передаваемых по глобальной сети. В этом процессе перекрестное разностное сжатие (RDC) может использовать блоки до пяти подобных файлов.

Чтобы использовать перекрестное RDC, на одном из участников подключения репликации должен быть установлен выпуск Windows, поддерживающий перекрестное RDC. Список выпусков, поддерживающих межфайловое перекрестное разностное сжатие (RDC), см. в статье "Which editions of the Windows operating system support cross-file RDC?" (Какие выпуски ОС Windows поддерживают перекрестное разностное сжатие файлов?)

### <a name="what-is-rdc"></a>Что такое RDC?

Удаленное разностное сжатие (RDC) — это клиент-серверный протокол, который можно использовать для эффективного обновления файлов по сети с ограниченной пропускной способностью. RDC обнаруживает операции вставки, удаления и переупорядочения данных в файлах, что позволяет репликации DFS при обновлении файлов реплицировать только эти изменения. RDC используется только для файлов размером 64 КБ или больше по умолчанию. RDC может использовать более старую версию файла с тем же именем в реплицированной папке или в папке DfsrPrivate\\ConflictandDeleted (расположенной по локальному пути реплицированной папки).

### <a name="when-is-rdc-used-for-replication"></a>Когда для репликации используется RDC?

RDC используется, когда файл превышает пороговое значение минимального размера. По умолчанию этот пороговый размер равен 64 КБ. После репликации файла, превышающего это пороговое значение, обновленные версии файла всегда используют RDC, если только не изменяется большая часть файла или RDC отключено.

### <a name="which-editions-of-the-windows-operating-system-support-cross-file-rdc"></a>Какие выпуски операционной системы Windows поддерживают перекрестное RDC?

Чтобы использовать перекрестное RDC, на одном из участников подключения репликации должен быть установлен выпуск ОС Windows, поддерживающий перекрестное RDC. В следующей таблице показано, какие выпуски операционной системы Windows поддерживают перекрестное RDC.

### <a name="cross-file-rdc-availability-in-editions-of-the-windows-operating-system"></a>Доступность перекрестного RDC в выпусках операционной системы Windows

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Версия операционной системы</th>
<th>Standard Edition</th>
<th>Выпуск Enterprise</th>
<th>Datacenter Edition</th>
</tr>
</thead>
<tbody>
<tr class="even">
<td><p>Windows Server 2012 R2</p></td>
<td><p>Да<em></p></td>
<td><p>Отсутствует</p></td>
<td><p>Да</em></p></td>
</tr>
<tr class="odd">
<td><p>Windows Server 2012</p></td>
<td><p>Да</p></td>
<td><p>Отсутствует</p></td>
<td><p>Да</p></td>
</tr>
<tr class="even">
<td><p>Windows Server 2008 R2</p></td>
<td><p>Нет</p></td>
<td><p>Да</p></td>
<td><p>Да</p></td>
</tr>
<tr class="odd">
<td><p>Windows Server 2008</p></td>
<td><p>Нет</p></td>
<td><p>Да</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="even">
<td><p>Windows Server 2003 R2</p></td>
<td><p>Нет</p></td>
<td><p>Да</p></td>
<td><p>Нет</p></td>
</tr>
</tbody>
</table>

\* При необходимости в Windows Server 2012 R2 можно отключить перекрестное RDC.

## <a name="replication-details"></a>Сведения о репликации

### <a name="can-i-change-the-path-for-a-replicated-folder-after-it-is-created"></a>Можно ли изменить путь к реплицированной папке после ее создания?

Нет. Если необходимо изменить путь к реплицированной папке, необходимо удалить ее в оснастке "Управление DFS" и добавить ее в качестве новой реплицированной папки. Затем репликация DFS использует удаленное разностное сжатие (RDC) для выполнения синхронизации, которая определяет, совпадают ли данные на отправляющем и принимающем участниках. При этом все данные в папке не реплицируются повторно.

### <a name="can-i-configure-which-file-attributes-are-replicated"></a>Можно ли настроить, какие атрибуты файлов будут реплицироваться?

Нет, то, какие атрибуты файлов будут реплицироваться, настроить нельзя.

Список значений атрибутов и их описание см. в разделе [Атрибуты файлов](https://go.microsoft.com/fwlink/?linkid=182268) на сайте MSDN (https://go.microsoft.com/fwlink/?LinkId=182268).

Следующие значения атрибутов задаются с помощью функции `SetFileAttributes dwFileAttributes` и реплицируются с помощью репликации DFS. Изменения этих значений атрибутов активируют репликацию атрибутов. Содержимое файла не реплицируется, пока не изменяется его содержимое. Дополнительные сведения см. в статье [Функция SetFileAttributes](https://go.microsoft.com/fwlink/?linkid=182269) в библиотеке MSDN (https://go.microsoft.com/fwlink/?LinkId=182269).

  - FILE\_ATTRIBUTE\_HIDDEN  
      
  - FILE\_ATTRIBUTE\_READONLY  
      
  - FILE\_ATTRIBUTE\_SYSTEM  
      
  - FILE\_ATTRIBUTE\_NOT\_CONTENT\_INDEXED  
      
  - FILE\_ATTRIBUTE\_OFFLINE  
      

Следующие значения атрибутов реплицируются с помощью репликации DFS, но они не активируют репликацию.

  - FILE\_ATTRIBUTE\_ARCHIVE  
      
  - FILE\_ATTRIBUTE\_NORMAL  
      

Следующие значения атрибутов файлов также активируют репликацию, хотя они не могут быть заданы с помощью функции `SetFileAttributes` (для просмотра значений атрибутов используется функция `GetFileAttributes`).

  - FILE\_ATTRIBUTE\_REPARSE\_POINT  
      

> [!NOTE]
> Репликация DFS не реплицирует значения атрибутов точки повторного анализа, пока тег повторного анализа не будет иметь значение IO_REPARSE_TAG_SYMLINK. Файлы с тегами повторного анализа IO_REPARSE_TAG_DEDUP, IO_REPARSE_TAG_SIS и IO_REPARSE_TAG_HSM реплицируются как обычные файлы. Тем не менее, тег повторного анализа и буферы данных повторного анализа не реплицируются на другие серверы, так как точка повторного анализа работает только в локальной системе. 
<br>

  - FILE\_ATTRIBUTE\_COMPRESSED  
      
  - FILE\_ATTRIBUTE\_ENCRYPTED  
      

> [!NOTE]
> Репликация DFS не реплицирует файлы, зашифрованные с помощью шифрованной файловой системы (EFS). Репликация DFS выполняет репликацию файлов, зашифрованных с помощью программного обеспечения сторонних разработчиков, но только в том случае, если значение атрибута FILE_ATTRIBUTE_ENCRYPTED для файла не задается. 
<br>

  - FILE\_ATTRIBUTE\_SPARSE\_FILE  
      
  - FILE\_ATTRIBUTE\_DIRECTORY  
      

Репликация DFS не реплицирует значение FILE\_ATTRIBUTE\_TEMPORARY.

### <a name="can-i-control-which-member-is-replicated"></a>Можно ли контролировать реплицируемого участника?

Да. При создании группы репликации можно выбрать топологию. Также можно выбрать параметр **Без топологии** и вручную настроить подключения после создания группы репликации.

### <a name="can-i-seed-a-replication-group-member-with-data-prior-to-the-initial-replication"></a>Можно ли заполнить участника группы репликации данными до начальной репликации?

Да. Репликация DFS поддерживает копирование файлов на участника группы репликации перед начальной репликацией. Эта "предварительная подготовка" может значительно сократить объем данных, реплицируемых во время начальной репликации.

Начальной репликации не требуется реплицировать содержимое, если файлы отличаются только реальными атрибутами или метками времени. Реальный атрибут — это атрибут, который можно задать с помощью функции Win32 `SetFileAttributes`. Дополнительные сведения см. в статье [Функция SetFileAttributes](https://go.microsoft.com/fwlink/?linkid=182269) в библиотеке MSDN (https://go.microsoft.com/fwlink/?LinkId=182269). Если два файла отличаются другими атрибутами, такими как сжатие, то содержимое файла реплицируется.

Чтобы выполнить предварительную настройку участника группы репликации, скопируйте файлы в соответствующую папку на целевых серверах, создайте группу репликации, а затем выберите основного участника. Выберите участника, содержащего самые актуальные файлы, которые необходимо реплицировать, так как содержимое основного участника считается полномочным. Это означает, что во время начальной репликации файлы основного участника всегда будут перезаписывать другие версии файлов на других участниках группы репликации.

Дополнительные сведения о предварительном заполнении и клонировании базы данных DFSR см. в разделе [DFS Replication Initial Sync in Windows Server 2012 R2: Attack of the Clones](https://blogs.technet.com/b/filecab/archive/2013/08/21/dfs-replication-initial-sync-in-windows-server-2012-r2-attack-of-the-clones.aspx) (Начальная синхронизация репликации DFS в Windows Server 2012 R2: атака клонов).

Дополнительные сведения о начальной репликации см. в разделе [Создание группы репликации](https://technet.microsoft.com/library/cc725893).

### <a name="does-dfs-replication-overcome-common-file-replication-service-issues"></a>Позволяет ли репликация DFS преодолеть распространенные проблемы в службе репликации файлов?

Да. Репликация DFS решает три распространенные проблемы FRS:

  - Переносы журнала. Репликация DFS восстанавливает переносы журнала на ходу. Каждый существующий файл или папка будут помечены как journalWrap и проверены в файловой системе перед повторным включением репликации. Во время восстановления этот том недоступен для репликации в любом направлении.  
      
  - Избыточная репликация: Чтобы предотвратить избыточную репликацию, репликация DFS использует систему кредитов.  
      
  - Преобразованные папки. Чтобы избежать появления преобразованных папок, репликация DFS сохраняет конфликтующие данные в скрытой папке DfsrPrivate\\ConflictandDeleted (расположенной по локальному пути к реплицированной папке). Например, одновременное создание нескольких папок с одинаковыми именами на разных серверах, реплицированных с помощью FRS, приводит к тому, что FRS переименовывает старые папки. Вместо этого репликация DFS перемещает старые папки в локальную папку конфликтов и удалений.  
      

### <a name="does-dfs-replication-replicate-files-in-chronological-order"></a>Репликация DFS реплицирует файлы в хронологическом порядке?

Нет. Файлы могут реплицироваться не по порядку.

### <a name="does-dfs-replication-replicate-files-that-are-being-used-by-another-application"></a>Реплицирует ли репликация DFS файлы, используемые другим приложением?

Если приложение открывает файл и блокирует файл (предотвращая его использование другими приложениями, пока он открыт), репликация DFS не реплицирует файл, пока он не будет закрыт. Если приложение открывает файл с доступом для чтения и общего доступа, он по-прежнему может быть реплицирован.

### <a name="does-dfs-replication-replicate-ntfs-file-permissions-alternate-data-streams-hard-links-and-reparse-points"></a>Реплицирует ли репликация DFS разрешения для файлов NTFS, альтернативные потоки данных, жесткие связи и точки повторного анализа?

  - Репликация DFS реплицирует разрешения для файлов NTFS и альтернативные потоки данных.  
      
  - Корпорация Майкрософт не поддерживает создание жестких ссылок NTFS на файлы в реплицированной папке и из нее. Это может привести к проблемам репликации таких файлов. Файлы жестких ссылок игнорируются репликацией DFS и не реплицируются. Точки соединения также не реплицируются, а репликация DFS регистрирует событие 4406 для каждой точки соединения, которую она встречает.  
      
  - Единственными точками повторного анализа, реплицируемыми с помощью репликации DFS, являются те, которые используют тег IO\_REPARSE\_TAG\_SYMLINK. Однако репликация DFS не гарантирует, что целевой объект символьной ссылки также реплицируется. Дополнительные сведения см. в статье [Задайте вопрос в блоге команды разработчиков служб каталогов](https://blogs.technet.com/b/askds/archive/2011/09/30/friday-mail-sack-super-slo-mo-edition.aspx).  
      
  - Файлы с тегами повторного анализа IO\_REPARSE\_TAG\_DEDUP, IO\_REPARSE\_TAG\_SIS или IO\_REPARSE\_TAG\_HSM реплицируются как обычные файлы. Тег повторного анализа и буферы данных повторного анализа не реплицируются на другие серверы, так как точка повторного анализа работает только в локальной системе. Таким образом, репликация DFS может реплицировать папки на томах, использующих дедупликацию данных в Windows Server 2012 или хранилище единственных копий, однако сведения о дедупликации данных обслуживаются отдельно на каждом сервере, на котором включена служба роли.  
      

### <a name="does-dfs-replication-replicate-timestamp-changes-if-no-other-changes-are-made-to-the-file"></a>Реплицирует ли репликация DFS изменения метки времени, если в файл не внесены другие изменения?

Нет, репликация DFS не реплицирует файлы, для которых единственным изменением является изменение метки времени. Кроме того, измененная метка времени не реплицируется на другие члены группы репликации, если в файл не внесены другие изменения.

### <a name="does-dfs-replication-replicate-updated-permissions-on-a-file-or-folder"></a>Реплицирует ли репликация DFS обновленные разрешения на файле или папке?

Да. Репликация DFS реплицирует изменения разрешений для файлов и папок. Реплицируется только часть файла, связанная со списком управления доступом (ACL), хотя репликация DFS по-прежнему должна считывать весь файл в области промежуточного хранения.


> [!NOTE]
> Изменение списков управления доступом на большом числе файлов может повлиять на производительность репликации. Однако при использовании RDC объем передаваемых данных пропорционален размеру ACL, а не размеру всего файла. Объем дискового трафика по-прежнему пропорционален размеру файлов, так как файлы должны быть считаны в промежуточную папку и из нее. 
<br>


### <a name="does-dfs-replication-support-merging-text-files-in-the-event-of-a-conflict"></a>Поддерживает ли репликация DFS слияние текстовых файлов в случае конфликта?

Репликация DFS не выполняет слияние файлов при возникновении конфликта. Однако она пытается сохранить старую версию файла в скрытой папке DfsrPrivate\\ConflictandDeleted на компьютере, где обнаружен конфликт.

### <a name="does-dfs-replication-use-encryption-when-transmitting-data"></a>Репликация DFS использует шифрование при передаче данных?

Да. Репликация DFS использует подключения удаленного вызова процедур (RPC) с шифрованием.

### <a name="is-it-possible-to-disable-the-use-of-encrypted-rpc"></a>Можно ли отключить использование зашифрованного RPC?

Нет. Служба репликация DFS для репликации данных использует удаленные вызовы процедур (RPC) через TCP. Для защиты передачи данных через Интернет служба репликации DFS разработана так, чтобы всегда использовалась константа уровня проверки подлинности, `RPC_C_AUTHN_LEVEL_PKT_PRIVACY`. Это гарантирует, что связь RPC через Интернет всегда будет шифроваться. Таким образом, невозможно отключить использование зашифрованного RPC службой репликации DFS.

Дополнительные сведения см. на следующем веб-узле корпорации Майкрософт:

  - [Технический справочник RPC](https://go.microsoft.com/fwlink/?linkid=182278)  
      
  - [Об удаленном разностном сжатии](https://go.microsoft.com/fwlink/?linkid=182279)  
      
  - [Константы уровня проверки подлинности](https://go.microsoft.com/fwlink/?linkid=182280)  
      

### <a name="how-are-simultaneous-replications-handled"></a>Как обрабатываются одновременные репликации?

Для каждой реплицированной папки существует один диспетчер обновлений. Диспетчеры обновлений работают независимо друг от друга.

По умолчанию всеми подключениями и группами репликации совместно используется одновременно максимум 16 (4 в Windows Server 2003 R2) загрузок. Так как подключения и обновления групп репликации не сериализуются, нет особого порядка, в котором происходит получение обновлений. Если открыто два расписания, то обновления обычно получаются и устанавливаются из обоих подключений одновременно.

### <a name="how-do-i-force-replication-or-polling"></a>Как можно принудительно выполнить репликацию или опрос?

Выполнить репликацию принудительно можно непосредственно с помощью оснастки управления DFS, как описано в разделе [Изменение расписаний репликации](https://technet.microsoft.com/library/Cc732278). Репликацию можно также принудительно выполнить с помощью командлета `Sync-DfsReplicationGroup`, входящего в состав модуля DFSR PowerShell, представленного в Windows Server 2012 R2, или командой **Dfsrdiag SyncNow**. Принудительный опрос можно выполнить с помощью командлета `Update-DfsrConfigurationFromAD` или команды **Dfsrdiag PollAD**.

### <a name="is-it-possible-to-configure-a-quiet-time-between-replications-for-files-that-change-frequently"></a>Можно ли настроить интервал моратория между репликациями для файлов, которые часто меняются?

Нет. Если расписание открыто, репликация DFS реплицирует изменения по мере их обнаружения. Не существует способа настройки моратория для репликации файлов.

### <a name="is-it-possible-to-configure-one-way-replication-with-dfs-replication"></a>Можно ли настроить одностороннюю репликацию с помощью репликации DFS?

Да. Если используется Windows Server 2012 или Windows Server 2008 R2, можно создать реплицированную папку только для чтения, которая реплицирует содержимое с помощью одностороннего подключения. Дополнительные сведения см. в разделе [Make a Replicated Folder Read-Only on a Particular Member](https://go.microsoft.com/fwlink/?linkid=156740) (Создание реплицированной папки только для чтения на определенном участнике) (https://go.microsoft.com/fwlink/?LinkId=156740).

Мы не поддерживаем создание одностороннего подключения репликации с помощью репликации DFS в Windows Server 2008 и Windows Server 2003 R2. Это может вызвать многочисленные проблемы, включая ошибки топологии проверки работоспособности, промежуточные проблемы и проблемы с базой данных репликации DFS.

При использовании Windows Server 2008 или Windows Server 2003 R2 можно имитировать одностороннее подключение, выполнив следующие действия.

  - Обучите администраторов вносить изменения только на серверы, которые необходимо назначить основным сервером. Затем разрешите репликацию изменений на целевые серверы.  
      
  - Настройте разрешения для общей папки на целевых серверах, чтобы конечные пользователи не имели разрешения на запись. Если на серверах филиалов не разрешены никакие изменения, то нет никакой необходимости выполнять повторную репликацию, имитируя одностороннее подключение и обеспечивая низкий уровень использования глобальной сети.  
      

### <a name="is-there-a-way-to-force-a-complete-replication-of-all-files-including-unchanged-files"></a>Есть ли способ принудительно выполнить полную репликацию всех файлов, включая неизмененные файлы?

Нет. Если репликация DFS считает файлы идентичными, они не будут реплицированы. Если измененные файлы не были реплицированы, репликация DFS будет автоматически реплицировать их при соответствующей настройке. Чтобы перезаписать настроенное расписание, используйте метод WMI **ForceReplicate()** . Однако это только перезапись расписания, а не принудительная репликация неизмененных или идентичных файлов.

### <a name="what-happens-if-the-primary-member-suffers-a-database-loss-during-initial-replication"></a>Что произойдет, если на основном участнике происходит утрата базы данных во время начальной репликации?

Во время начальной репликации файлы основного участника всегда имеют приоритет при разрешении конфликтов, которое происходит, если у принимающих участников разные версии файлов, содержащихся на основном участнике. Целевой основной участник хранится в доменных службах Active Directory, и после того как основной участник будет готов к репликации, он удаляется, но до начала репликации всех участников группы репликации.

В случае сбоя начальной репликации или перезапуска службы репликация DFS во время репликации основной участник видит целевое расположение основного участника в локальной базе данных репликации DFS и повторяет начальную репликацию. Если база данных репликации DFS основного участника утеряна после очистки целевого пути основного участника в доменных службах Active Directory, но до того, как все члены группы репликации завершают начальную репликацию, все члены группы репликации не смогут выполнить репликацию папки, так как не указан сервер в качестве основного участника. В этом случае для восстановления основного участника вручную используйте команду **Dfsradmin membership /set /isprimary:true** на основном сервере.

Дополнительные сведения о начальной репликации см. в разделе [Создание группы репликации](https://technet.microsoft.com/library/cc725893).


> [!WARNING]
> Целевой путь основного участника используется только в процессе начальной репликации. При использовании команды <STRONG>Dfsradmin</STRONG> для указания основного участника для реплицированной папки после завершения репликации репликация DFS не назначает сервер в качестве основного участника в службах домен Active Directory. Однако если в базе данных репликации DFS на сервере происходит необратимое повреждение или потеря данных, сервер пытается выполнить начальную репликацию в качестве основного участника, а не восстанавливать данные с другого участника группы репликации. По сути, сервер станет фальшивым основным сервером, что может вызвать конфликты. По этой причине основного участника следует указывать вручную, только если вы уверены, что при начальной репликации произошел неустранимый сбой. 
<br>


### <a name="what-happens-if-the-replication-schedule-closes-while-a-file-is-being-replicated"></a>Что происходит, если расписание репликации закрывается во время репликации файла?

Если для подключения включено удаленное разностное сжатие (RDC), входящая репликация файла размером более 64 КБ, репликация которого началась непосредственно перед закрытием окна расписания (или изменением параметра **No bandwidth** (Не оптимизировать)), будет продолжаться при открытии расписания (или при переходе на другой уровень, за исключением режима **No bandwidth** (Не оптимизировать)). Репликация продолжится из состояния, в котором она находилась в момент остановки репликации.

Если RDC отключено, репликация DFS полностью перезапускает перенос файлов. Это может произойти с задержкой, если файл доступен на принимающем участнике.

### <a name="what-happens-when-two-users-simultaneously-update-the-same-file-on-different-servers"></a>Что происходит, когда два пользователя одновременно обновляют один и тот же файл на разных серверах?

Когда репликация DFS обнаруживает конфликт, она использует версию файла, который был сохранен последним. Она перемещает другой файл в папку DfsrPrivate\\ConflictandDeleted (по локальному пути к реплицированной папке на компьютере, который разрешил конфликт). Он остается там до очистки папки конфликтов и удалений, что происходит, когда размер папки конфликтов и удалений превышает заданное значение или репликация DFS обнаруживает ошибку нехватки места на диске. Папка конфликтов и удалений не реплицируется, и этот метод устранения конфликтов позволяет избежать проблемы с преобразованными каталогами, что было возможно в службе FRS.

При возникновении конфликта репликация DFS регистрирует информационное событие в журнале событий репликации DFS. Это событие не требует действий пользователя по следующим причинам.

  - Оно невидимо для пользователей (оно видимо только администраторам сервера).  
      
  - Репликация DFS рассматривает папку конфликтов и удалений как кэш. При достижении порогового значения квоты она очищает некоторые из этих файлов. Нет никакой гарантии, что конфликтующие файлы будут сохранены.  
      
  - Конфликт может происходить на сервере, отличном от источника конфликта.  
      

## <a name="staging"></a>Поэтапное создание

### <a name="does-dfs-replication-continue-staging-files-when-replication-is-disabled-by-a-schedule-or-bandwidth-throttling-quota-or-when-a-connection-is-manually-disabled"></a>Репликация DFS продолжает осуществлять промежуточное хранение файлов, если репликация отключена расписанием или квотой регулирования пропускной способности или если подключение отключено вручную?

Нет. Репликация DFS не выполняет промежуточное хранение файлов за пределами запланированной репликации при превышении квоты на регулирование пропускной способности или при отключенных подключениях.

### <a name="does-dfs-replication-prevent-other-applications-from-accessing-a-file-during-staging"></a>Репликация DFS предотвращает доступ других приложений к файлу во время промежуточного хранения?

Нет. Репликация DFS открывает файлы таким способом, который не блокирует открытие файлов пользователями или приложениями в папке репликации. Этот метод известен как "оппортунистическая блокировка".

### <a name="is-it-possible-to-change-the-location-of-the-staging-folder-with-the-dfs-management-tool"></a>Можно ли изменить расположение промежуточной папки с помощью средства управления DFS?

Да. Расположение промежуточной папки настраивается на вкладке **Дополнительно** диалогового окна **Свойства** для каждого участника группы репликации.

### <a name="when-are-files-staged"></a>Когда файлы помещаются в промежуточное хранилище?

Файлы помещаются в промежуточное хранилище на отправляющем участнике, когда принимающий участник запрашивает файл (если размер файла составляет 64 КБ или меньше), как показано в таблице ниже. Если в соединении отключено удаленное разностное сжатие (RDC), файл помещается в промежуточное хранилище, если его размер не превышает 256 КБ. Файлы также помещаются в промежуточное хранилище на принимающем участнике, если их размер менее 64 КБ, хотя этот параметр можно настроить в пределах от 16 КБ до 1 МБ. Если расписание закрыто, файлы не будут помещены в промежуточное хранилище.

### <a name="the-minimum-file-sizes-for-staging-files"></a>Минимальный размер файлов для промежуточного хранения

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th> </th>
<th>RDC включено</th>
<th>RDC отключено</th>
</tr>
</thead>
<tbody>
<tr class="even">
<td><p>Отправляющий участник</p></td>
<td><p>64 КБ</p></td>
<td><p>256 КБ</p></td>
</tr>
<tr class="odd">
<td><p>Принимающий участник</p></td>
<td><p>64 КБ по умолчанию</p></td>
<td><p>64 КБ по умолчанию</p></td>
</tr>
</tbody>
</table>

### <a name="what-happens-if-a-file-is-changed-after-it-is-staged-but-before-it-is-completely-transmitted-to-the-remote-site"></a>Что происходит, если файл изменяется после его помещения на промежуточное хранение, но перед полной передачей на удаленный сайт?

Если какая-либо часть файла уже передается, репликация DFS возобновляет передачу. Если файл был изменен до того, как репликация DFS начнет передачу файла, будет отправлена новая версия файла.

## <a name="change-history"></a>История изменений


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Дата</th>
<th>Описание</th>
<th>Причина</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>15 ноября 2018 г.</p></td>
<td><p>Обновлено для Windows Server 2019.</p></td>
<td><p>Новая операционная система.</p></td>
</tr>
<tr class="even">
<td><p>9 октября 2013 г.</p></td>
<td><p>Обновлен раздел "Каковы поддерживаемые ограничения репликации DFS?" с результатами тестов для Windows Server 2012 R2.</p></td>
<td><p>Обновления для последней версии Windows Server</p></td>
</tr>
<tr class="odd">
<td><p>30 января, 2013 г.</p></td>
<td><p>Добавлена запись "Репликация DFS продолжает осуществлять промежуточное хранение файлов, если репликация отключена расписанием или квотой регулирования пропускной способности или если подключение отключено вручную?".</p></td>
<td><p>Вопросы пользователей</p></td>
</tr>
<tr class="even">
<td><p>31 октября 2012 г.</p></td>
<td><p>Изменена запись "Каковы поддерживаемые ограничения репликации DFS?" для увеличения проверенного количества реплицированных файлов на томе.</p></td>
<td><p>Отзывы клиентов</p></td>
</tr>
<tr class="odd">
<td><p>15 августа 2012 г.</p></td>
<td><p>Изменена запись "Реплицирует ли репликация DFS разрешения для файлов NTFS, альтернативные потоки данных, жесткие связи и точки повторного анализа?", поясняющая, как репликация DFS обрабатывает жесткие ссылки и точки повторного анализа.</p></td>
<td><p>Отзывы службы поддержки пользователей</p></td>
</tr>
<tr class="even">
<td><p>13 июня 2012 г.</p></td>
<td><p>Изменена запись "Работает ли репликация DFS на томах ReFS или FAT?" для добавления обсуждения ReFS.</p></td>
<td><p>Отзывы клиентов</p></td>
</tr>
<tr class="odd">
<td><p>25 апреля 2012 г.</p></td>
<td><p>Изменена запись "Реплицирует ли репликация DFS разрешения для файлов NTFS, альтернативные потоки данных, жесткие связи и точки повторного анализа?", поясняющая, как репликация DFS обрабатывает жесткие ссылки.</p></td>
<td><p>Уменьшение потенциальной путаницы</p></td>
</tr>
<tr class="even">
<td><p>30 марта 2011 г.</p></td>
<td><p>Изменена запись "Может ли репликация DFS реплицировать PST-файлы Outlook или базы данных Microsoft Office Access?" для исправления потенциально негативного воздействия на использование репликации DFS с файлами PST и Access.</p>
<p>Добавлен раздел "Как можно повысить производительность репликации?"</p></td>
<td><p>Вопросы пользователей о предыдущей записи, в которой неправильно указано, что репликация PST-файлов или файлов Access может повредить базу данных репликации DFS.</p></td>
</tr>
<tr class="odd">
<td><p>26 января 2011 г.</p></td>
<td><p>Добавлен раздел "Как можно восстановить файлы из папок ConflictAndDeleted или PreExisting?"</p></td>
<td><p>Отзывы клиентов</p></td>
</tr>
<tr class="even">
<td><p>20 октября 2010 г.</p></td>
<td><p>Добавлен раздел "Как обновить или заменить участника репликации DFS?"</p></td>
<td><p>Отзывы клиентов</p></td>
</tr>
</tbody>
</table>

