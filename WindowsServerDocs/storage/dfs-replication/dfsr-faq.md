---
title: Репликация DFS. Вопросы и ответы
ms.date: 06/18/2014
ms.prod: windows-server
ms.technology: storage
author: JasonGerend
manager: elizapo
ms.author: jgerend
ms.openlocfilehash: 92fe505c3ae7d76f7a8d5bd9d2ed0ce845159fde
ms.sourcegitcommit: de71970be7d81b95610a0977c12d456c3917c331
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2019
ms.locfileid: "71940760"
---
# <a name="dfs-replication-frequently-asked-questions-faq"></a>Репликация DFS. Вопросы и ответы


Обновлено: 30 апреля 2019 г.

Область применения. Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008

В этой статье содержатся ответы на вопросы о репликации распределенная файловая система (DFS) (также известной как DFS-R или DFSR) для Windows Server.

Дополнительные сведения о пространствах имен DFS см [. в разделе пространства имен DFS: Часто задаваемые](https://technet.microsoft.com/library/ee404780)вопросы.

Сведения о новых возможностях репликация DFS см. в следующих разделах:

  - [Общие сведения о пространствах имен и репликация DFS DFS](https://technet.microsoft.com/library/jj127250) (в Windows Server 2012)  
      
  - [Новые возможности распределенная файловая система](https://technet.microsoft.com/library/ee307957) разделе [изменения функциональных возможностей Windows Server 2008 до Windows Server 2008 R2](https://technet.microsoft.com/library/dd391932)  
      
  - [Распределенная файловая система](https://technet.microsoft.com/library/cc753479) статье [изменения функциональных возможностей Windows Server 2003 с пакетом обновления 1 (SP1) до Windows Server 2008](https://technet.microsoft.com/library/cc753208)  
      

Список последних изменений раздела см. в подразделе [Журнал изменений](#change-history) этого раздела.

      

## <a name="interoperability"></a>Взаимодействие

### <a name="can-dfs-replication-communicate-with-frs"></a>Может репликация DFS взаимодействовать с FRS?

Нет. Репликация DFS не взаимодействует со службой репликации файлов (FRS). Репликация DFS и FRS могут выполняться на одном сервере одновременно, но они не должны быть настроены для репликации одних и тех же папок или вложенных папок, так как это может привести к потере данных.

### <a name="can-dfs-replication-replace-frs-for-sysvol-replication"></a>Можно репликация DFS заменить FRS для репликации SYSVOL

Да, репликация DFS может заменить FRS для репликации SYSVOL на серверах под Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008. Серверы под Windows Server 2003 R2 не поддерживают использование репликация DFS для репликации папки SYSVOL.

Дополнительные сведения о репликации SYSVOL с помощью репликация DFS см. в статье Руководство [по миграции репликации SYSVOL: Репликация DFS](https://technet.microsoft.com/library/dd640019)FRS.

### <a name="can-i-upgrade-from-frs-to-dfs-replication-without-losing-configuration-settings"></a>Можно ли выполнить обновление с FRS на репликация DFS без потери параметров конфигурации?

Да. Чтобы перенести репликацию из FRS в репликация DFS, см. следующие документы:

  - Сведения о миграции репликации папок, отличных от папки SYSVOL, [см. в разделе Руководство по работе с DFS. Миграция с FRS на](http://go.microsoft.com/fwlink/?linkid=192776) репликация DFS и [FRS2DFSR — служебную программу миграции FRS в DFSR](http://go.microsoft.com/fwlink/?linkid=195437) (http://go.microsoft.com/fwlink/?LinkID=195437).  
      
  - Чтобы перенести репликацию папки SYSVOL в репликация DFS, см [. Руководство по миграции репликации SYSVOL: Репликация DFS](https://technet.microsoft.com/library/dd640019)FRS.  
      

### <a name="can-i-use-dfs-replication-in-a-mixed-windowsunix-environment"></a>Можно ли использовать репликация DFS в смешанной среде Windows или UNIX?

Да. Хотя репликация DFS поддерживает только репликацию содержимого между серверами под управлением Windows Server, клиенты UNIX могут получать доступ к общим папкам на серверах Windows. Для этого установите службы для сетевых файловых систем (NFS) на репликация DFS сервере.

Вы также можете использовать клиентские функции SMB/CIFS, включенные во многие клиенты UNIX, для прямого доступа к общим файловым ресурсам Windows, хотя эта функция часто ограничена или требует внесения изменений в среду Windows (например, Отключение подписывания SMB с помощью Групповая политика).

Репликация DFS взаимодействует с NFS на сервере под управлением операционной системы Windows Server, но нельзя реплицировать точку подключения NFS.

### <a name="can-i-use-the-volume-shadow-copy-service-with-dfs-replication"></a>Можно ли использовать служба теневого копирования томов с репликация DFS?

Да. Репликация DFS поддерживается на томах служба теневого копирования томов (VSS) и предыдущих моментальных снимках, их можно успешно восстановить с помощью клиента предыдущих версий.

### <a name="can-i-use-windowsbackup-ntbackupexe-to-remotely-back-up-a-replicated-folder"></a>Можно ли использовать программу архивации Windows (Ntbackup. exe) для удаленного резервного копирования реплицированной папки?

Нет, использование программы архивации Windows (Ntbackup. exe) на компьютере под Windows Server 2003 или более ранней версии для резервного копирования содержимого реплицированной папки на компьютере под Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008 не поддерживается.

Для резервного копирования файлов, хранящихся в реплицированной папке, используйте cистема архивации данных Windows Server или Microsoft® System Center Data Protection Manager. Сведения о функциях резервного копирования и восстановления в Windows Server 2008 R2 и Windows Server 2008 см. в разделе [резервное копирование и восстановление](https://technet.microsoft.com/library/Cc754097). Дополнительные сведения см. в разделе [System Center Data Protection Manager](http://go.microsoft.com/fwlink/?linkid=182261) (http://go.microsoft.com/fwlink/?LinkId=182261).

### <a name="do-file-system-policies-impact-dfs-replication"></a>Влияют ли политики файловой системы репликация DFS?

Да. Не настраивайте политики файловой системы в реплицированных папках. Политика файловой системы повторно применяет разрешения NTFS при каждом интервале обновления групповая политика. Это может привести к нарушениям совместного доступа, так как открытый файл не реплицируется до закрытия файла.

### <a name="does-dfs-replication-replicate-mailboxes-hosted-on-microsoft-exchange-server"></a>Репликация DFS ли реплицировать почтовые ящики, размещенные на сервере Microsoft Exchange Server?

Нет. Репликация DFS нельзя использовать для репликации почтовых ящиков, размещенных на сервере Microsoft Exchange Server.

### <a name="does-dfs-replication-support-file-screens-created-by-file-server-resource-manager"></a>Поддерживает ли репликация DFS экраны файлов, созданные диспетчер ресурсов файлового сервера?

Да. Однако параметры фильтрации файлов диспетчер ресурсов файлового сервера (FSRM) должны совпадать на обоих концах репликации. Кроме того, репликация DFS имеет собственный механизм фильтрации для файлов и папок, которые можно использовать для исключения определенных файлов и типов файлов из репликации.

Ниже приведены рекомендации по реализации экранов или квот файлов.

  - Скрытая папка Дфсрпривате не должна подвергаться квотам или экранам файлов.  
      
  - Файлы с экраном не должны существовать в реплицированной папке перед включением блокировки.  
      
  - Ни одна из папок не может превысить квоту до включения квоты.  
      
  - Необходимо использовать жесткие квоты с осторожностью. Отдельные члены группы репликации могут оставаться в пределах квоты до репликации, но при этом превысить их размер при репликации файлов. Например, если пользователь копирует файл размером 10 мегабайт (МБ) на сервер A (который затем имеет жесткие ограничения), а другой пользователь копирует файл размером 5 МБ на сервер B, то при следующей репликации оба сервера будут превысить квоту на 5 мегабайт. Это может привести к тому, что репликация DFS постоянно повторять репликацию файлов, вызывая бреши в векторе версий и возможные проблемы с производительностью.  
      

### <a name="is-dfs-replication-cluster-aware"></a>Поддерживает ли кластер репликация DFS?

Да, репликация DFS в Windows Server 2012 R2, Windows Server 2012 и Windows Server 2008 R2 включает возможность добавления отказоустойчивого кластера в состав группы репликации. Дополнительные сведения см. в разделе [Добавление отказоустойчивого кластера в группу репликации](http://go.microsoft.com/fwlink/?linkid=155085) (http://go.microsoft.com/fwlink/?LinkId=155085). Служба репликация DFS в версиях Windows, предшествовавших Windows Server 2008 R2, не предназначена для координации с отказоустойчивым кластером, и служба не будет отработкой отказа на другой узел.


> [!NOTE]
> Репликация DFS не поддерживает репликацию файлов на общих томах кластера. 
<br>


### <a name="is-dfs-replication-compatible-with-data-deduplication"></a>Репликация DFS совместима с дедупликацией данных?

Да, репликация DFS может реплицировать папки на томах, использующих дедупликацию данных в Windows Server.

### <a name="is-dfs-replication-compatible-with-ris-and-wds"></a>Совместима ли репликация DFS с RIS и WDS?

Да. Репликация DFS реплицирует тома, на которых включено хранилище единственных копий (SIS). SIS используется службами удаленной установки (RIS), службами развертывания Windows (WDS) и сервером Windows Storage Server.

### <a name="is-it-possible-to-use-dfs-replication-with-offline-files"></a>Можно ли использовать репликация DFS с автономные файлы?

Вы можете безопасно использовать репликация DFS и автономные файлы в сценариях, когда в каждый момент времени на запись в файлы помещается только один пользователь. Это полезно для пользователей, которые перемещаются между двумя филиалами и хотят иметь доступ к своим файлам в филиале или вне сети. Автономные файлы кэширует файлы локально для автономного использования и репликация DFS реплицирует данные между филиалами.

Не используйте репликация DFS с автономные файлы в среде с несколькими пользователями, так как репликация DFS не предоставляет ни одного механизма распределенной блокировки или возможности извлечения файлов. Если два пользователя одновременно изменяют один и тот же файл на разных серверах, репликация DFS перемещает старый файл в папку\\дфсрпривате конфликтандделетед (расположенную по локальному пути реплицированной папки) во время следующей репликации.

### <a name="what-antivirus-applications-are-compatible-with-dfs-replication"></a>Какие антивирусные приложения совместимы с репликация DFS?

Антивирусные приложения могут вызвать чрезмерную репликацию, если их действия по сканированию изменяют файлы в реплицированной папке. Дополнительные сведения см. [в тестировании взаимодействия антивирусных приложений с репликация DFS](http://go.microsoft.com/fwlink/?linkid=73990) (http://go.microsoft.com/fwlink/?LinkId=73990).

### <a name="what-are-the-benefits-of-using-dfs-replication-instead-of-windows-sharepoint-services"></a>Каковы преимущества использования репликация DFS вместо служб Windows SharePoint Services?

Windows® SharePoint® Services обеспечивает тесную согласованность в виде функций извлечения файлов, которые в репликация DFS не поддерживаются. Если вы беспокоитесь об изменении одного и того же файла несколькими людьми, рекомендуется использовать службы Windows SharePoint Services. Windows SharePoint Services 2,0 с пакетом обновления 2 (SP2) доступна в составе Windows Server 2003 R2. Службы Windows SharePoint Services можно загрузить с веб-сайта корпорации Майкрософт. она не включена в более новые версии Windows Server. Однако если репликация данных выполняется на нескольких сайтах и пользователи не будут одновременно изменять одни и те же файлы, репликация DFS обеспечивает большую пропускную способность и упрощает управление.

## <a name="limitations-and-requirements"></a>Ограничения и требования

### <a name="can-dfs-replication-replicate-between-branch-offices-without-a-vpn-connection"></a>Можно ли репликация DFS реплицировать между филиалами без VPN-подключения?

Да — при условии, что имеется частная ссылка на глобальную сеть (WAN) (не Интернет), соединяющая офисы филиалов. Однако необходимо открыть соответствующие порты во внешних брандмауэрах. Репликация DFS использует сопоставитель конечных точек RPC (порт 135) и случайным образом назначенный временный порт выше 1024. Для указания статического порта вместо временного порта можно использовать программу командной строки **Dfsrdiag** . Дополнительные сведения об указании сопоставителя конечных точек RPC см. в [статье 154596](http://go.microsoft.com/fwlink/?linkid=73991) базы знаний Майкрософт (http://go.microsoft.com/fwlink/?LinkId=73991).

### <a name="can-dfs-replication-replicate-files-encrypted-with-the-encrypting-file-system"></a>Можно ли репликация DFS реплицировать файлы, зашифрованные с помощью шифрованная файловая система (EFS)?

Нет. Репликация DFS не будет реплицировать файлы или папки, зашифрованные с помощью шифрованная файловая система (EFS) (EFS). Если пользователь шифрует файл, который ранее был реплицирован, репликация DFS удаляет его из всех остальных членов группы репликации. Это гарантирует, что единственной доступной копией файла будет только зашифрованная версия на сервере.

### <a name="can-dfs-replication-replicate-outlook-pst-or-microsoft-office-access-database-files"></a>Может репликация DFS реплицировать файлы Outlook. pst или базы данных Microsoft Office Access?

Репликация DFS может безопасно реплицировать файлы личных папок Microsoft Outlook (PST) и файлы Microsoft Access, только если они хранятся в архивных целях и не доступны по сети с помощью клиента, например Outlook или Access (для открытия PST-файла или доступа файлы, сначала скопируйте их на локальное запоминающее устройство). Для этого используются следующие причины.

  - Открытие PST-файлов через сетевые подключения может привести к повреждению данных в PST-файлах. Дополнительные сведения о том, почему PST-файлы не могут безопасно получать доступ из сети, см. в [статье 297019](http://go.microsoft.com/fwlink/?linkid=125363) базы знаний Майкрософт (http://go.microsoft.com/fwlink/?LinkId=125363).  
      
  - файлы PST и Access, как правило, остаются открытыми в течение длительного периода времени при доступе клиента, например Outlook или Office Access. Это предотвращает репликация DFS репликации этих файлов, пока они не будут закрыты.  
      

### <a name="can-i-use-dfs-replication-in-a-workgroup"></a>Можно ли использовать репликация DFS в Рабочей группе?

Нет. Для настройки репликация DFS полагается на Active Directory® доменных служб. Он будет работать только в домене.

### <a name="can-more-than-one-folder-be-replicated-on-a-single-server"></a>Может ли реплицироваться более одной папки на одном сервере?

Да. Репликация DFS может реплицировать многочисленные папки между серверами. Убедитесь, что Каждая реплицированная папка имеет уникальный корневой путь, и что они не перекрываются. Например, d:\\Sales и d:\\Accounting может быть корневыми путями для двух реплицируемых папок, но d\\: Sales и d\\:\\Sales Reports не могут быть корневыми путями для двух реплицируемых папок.

### <a name="does-dfs-replication-require-dfs-namespaces"></a>Требуются ли репликация DFS пространства имен DFS?

Нет. Репликация DFS и пространства имен DFS можно использовать отдельно или вместе. Кроме того, репликация DFS можно использовать для репликации изолированных пространств имен DFS, что было невозможно с FRS.

### <a name="does-dfs-replication-require-time-synchronization-between-servers"></a>Требуется ли репликация DFS синхронизации времени между серверами?

Нет. Репликация DFS не требует явной синхронизации времени между серверами. Однако репликация DFS требует тщательного соответствия серверных часов. Для правильной работы проверки подлинности Kerberos необходимо установить часы сервера в течение пяти минут (по умолчанию). Например, репликация DFS использует метки времени, чтобы определить, какой файл имеет приоритет при возникновении конфликта. Точные значения времени также важны для сбора мусора, расписаний и других функций.

### <a name="does-dfs-replication-support-replicating-an-entire-volume"></a>Поддерживает ли репликация DFS репликацию всего тома?

Да. Однако сначала необходимо установить пакет обновления 2 (SP2) для Windows Server 2003 или исправление. Дополнительные сведения см. в [статье 920335](http://go.microsoft.com/fwlink/?linkid=76776) базы знаний Майкрософт (http://go.microsoft.com/fwlink/?LinkId=76776). Кроме того, репликация всего тома может привести к следующим проблемам:

  - Если том содержит файл подкачки Windows, происходит сбой репликации и регистрируется событие DFSR 4312 в журнале системных событий.  
      
  - Репликация DFS задает системные и скрытые атрибуты реплицированной папки на целевых серверах. Это происходит потому, что Windows по умолчанию применяет системные и скрытые атрибуты к корневой папке тома. Если локальный путь реплицированной папки на целевых серверах также является корнем тома, дальнейшие изменения в атрибутах папки не вносятся.  
      
  - При репликации тома, содержащего системную папку Windows, репликация DFS распознает папку% WINDIR% и не реплицирует ее. Однако репликация DFS выполняет репликацию папок, используемых приложениями сторонних производителей, что может привести к сбою приложений на целевых серверах, если приложения имеют проблемы взаимодействия с репликация DFS.  
      

### <a name="does-dfs-replication-support-rpc-over-http"></a>Поддерживает ли репликация DFS RPC через HTTP?

Нет.

### <a name="does-dfs-replication-work-across-wireless-networks"></a>Работает ли репликация DFS в беспроводных сетях?

Да. Репликация DFS не зависит от типа соединения.

### <a name="does-dfs-replication-work-on-refs-or-fat-volumes"></a>Работает ли репликация DFS на томах ReFS или FAT?

Нет. Репликация DFS поддерживает тома, отформатированные только в файловой системе NTFS; Отказоустойчивая файловая система (ReFS) и файловая система FAT не поддерживаются. Для репликация DFS требуется NTFS, так как он использует журнал изменений NTFS и другие функции файловой системы NTFS.

### <a name="does-dfs-replication-work-with-sparse-files"></a>Репликация DFS работать с разреженными файлами?

Да. Вы можете реплицировать разреженные файлы. **Разреженный** атрибут сохраняется в принимающем элементе.

### <a name="do-i-need-to-log-in-as-administrator-to-replicate-files"></a>Нужно ли выполнять вход от имени администратора для репликации файлов?

Нет. Репликация DFS — это служба, которая работает под локальной системной учетной записью, поэтому для репликации не нужно выполнять вход от имени администратора. Однако для внесения изменений в конфигурацию репликация DFS необходимо быть администратором домена или локальным администратором затронутых файловых серверов.

Дополнительные сведения см. в разделе "требования к безопасности репликация DFS и делегирование" в [делегировании возможности управления репликация DFS](http://go.microsoft.com/fwlink/?linkid=182294) (http://go.microsoft.com/fwlink/?LinkId=182294).

### <a name="how-can-i-upgrade-or-replace-a-dfs-replication-member"></a>Как обновить или заменить элемент репликация DFS?

Чтобы обновить или заменить элемент репликация DFS, см. эту запись блога в блоге группы разработчиков служб каталогов: [Замена оборудования или ОС члена DFSR](http://blogs.technet.com/b/askds/archive/2010/09/10/series-wrap-up-and-downloads-replacing-dfsr-member-hardware-or-os.aspx).

### <a name="is-dfs-replication-suitable-for-replicating-roaming-profiles"></a>Подрепликация DFS подходит для репликации перемещаемых профилей?

Да. При репликации перемещаемых профилей пользователей поддерживаются определенные сценарии. Сведения о поддерживаемых сценариях см. в [статье Microsoft Support для реплицированных данных профиля пользователя](http://go.microsoft.com/fwlink/?linkid=201282) (http://go.microsoft.com/fwlink/?LinkId=201282).

### <a name="is-there-a-file-character-limit-or-limit-to-the-folder-depth"></a>Существует ли ограничение на число символов в файле или ограничение на глубину папки?

Windows и репликация DFS поддерживают пути к папкам длиной до 32000 символов. Репликация DFS не ограничены путями к папке в 260 символов.

### <a name="must-members-of-a-replication-group-reside-in-the-same-domain"></a>Должны ли члены группы репликации находиться в одном домене?

Нет. Группы репликации могут охватывать несколько доменов в пределах одного леса, но не в разных лесах.

### <a name="what-are-the-supported-limits-of-dfs-replication"></a>Каковы поддерживаемые ограничения репликация DFS?

Следующий список содержит набор рекомендаций по масштабируемости, которые были проверены корпорацией Майкрософт и применимы к Windows Server 2012 R2, Windows Server 2016 и Windows Server 2019

  - Размер всех реплицированных файлов на сервере: 100 терабайтов.  
      
  - Количество реплицированных файлов на томе: 70 000 000.  
      
  - Максимальный размер файла: 250 ГБ.  
      


> [!IMPORTANT]
> При создании групп репликации с большим числом или размером файлов рекомендуется экспортировать клон базы данных и использовать методы предварительного заполнения, чтобы максимально сокращать длительность начальной репликации. Дополнительные сведения см [. в статье Репликация DFS начальной синхронизации в Windows Server 2012 R2: Атаки на клоны](https://techcommunity.microsoft.com/t5/Storage-at-Microsoft/DFS-Replication-Initial-Sync-in-Windows-Server-2012-R2-Attack-of/ba-p/424877). 
<br>


Следующий список содержит набор рекомендаций по масштабируемости, протестированных корпорацией Майкрософт в Windows Server 2012, Windows Server 2008 R2 и Windows Server 2008.

  - Размер всех реплицированных файлов на сервере: 10 терабайт.  
      
  - Количество реплицированных файлов на томе: 11 000 000.  
      
  - Максимальный размер файла: 64 ГБ.  
      


> [!NOTE]
> Ограничения на количество групп репликации, реплицированных папок, подключений или членов группы репликации больше не существует. 
<br>


Список рекомендаций по масштабируемости, протестированных корпорацией Майкрософт для Windows Server 2003 R2, см. в разделе [рекомендации по масштабируемости репликация DFS](http://go.microsoft.com/fwlink/?linkid=75043) (http://go.microsoft.com/fwlink/?LinkId=75043).

### <a name="when-should-i-not-use-dfs-replication"></a>Когда следует использовать репликация DFS?

Не используйте репликация DFS в среде, где несколько пользователей одновременно обновляют или изменяют одни и те же файлы на разных серверах. Это может привести к тому, что репликация DFS переместить конфликтующие копии файлов в скрытую папку дфсрпривате\\конфликтандделетед.

Если несколько пользователей должны одновременно изменить одни и те же файлы на разных серверах, используйте функцию извлечения файлов в Windows SharePoint Services, чтобы убедиться, что только один пользователь работает с файлом. Windows SharePoint Services 2,0 с пакетом обновления 2 (SP2) доступна в составе Windows Server 2003 R2. Службы Windows SharePoint Services можно загрузить с веб-сайта корпорации Майкрософт. она не включена в более новые версии Windows Server.

### <a name="why-is-a-schema-update-required-for-dfs-replication"></a>Зачем требуется обновление схемы для репликация DFS?

Репликация DFS использует новые объекты в контексте именования домена служб домен Active Directory Services для хранения сведений о конфигурации. Эти объекты создаются при обновлении схемы служб домен Active Directory. Дополнительные сведения см. в разделе [требования к проверке для репликация DFS](http://go.microsoft.com/fwlink/?linkid=182264) (http://go.microsoft.com/fwlink/?LinkId=182264).

## <a name="monitoring-and-management-tools"></a>Средства мониторинга и управления

### <a name="can-i-automate-the-health-report-to-receive-warnings"></a>Можно ли автоматизировать отчет о работоспособности для получения предупреждений?

Да. Существует три способа автоматизации отчетов о работоспособности:

  - Используйте модуль DFSR Windows PowerShell, входящий в состав Windows Server 2012 R2 или DfsrAdmin. exe в сочетании с запланированными задачами, чтобы регулярно создавать отчеты о работоспособности. Дополнительные сведения см. в разделе [Автоматизация отчетов о работоспособности репликация DFS](http://go.microsoft.com/fwlink/?linkid=74010) (http://go.microsoft.com/fwlink/?LinkId=74010).  
      
  - Используйте пакет управления репликация DFS для System Center Operations Manager, чтобы создавать оповещения, основанные на указанных условиях.  
      
  - Используйте поставщик WMI репликация DFS для создания сценариев предупреждений.  
      

### <a name="can-i-use-microsoft-system-center-operations-manager-to-monitor-dfs-replication"></a>Можно ли использовать Microsoft System Center Operations Manager для отслеживания репликация DFS?

Да. Дополнительные сведения см. в разделе [пакет управления репликация DFS для System Center Operations Manager 2007](http://go.microsoft.com/fwlink/?linkid=182265) в центре загрузки Майкрософт (http://go.microsoft.com/fwlink/?LinkId=182265).

### <a name="does-dfs-replication-support-remote-management"></a>Поддерживает ли репликация DFS удаленное управление?

Да. Репликация DFS поддерживает удаленное управление с помощью консоли управления DFS и команды **Добавить группу репликации** . Например, на сервере A можно подключиться к группе репликации, определенной в лесу, с серверами A и B в качестве членов.

Управление DFS входит в состав Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008 и Windows Server 2003 R2. Для управления репликация DFS из других версий Windows используйте удаленный рабочий стол или [средства удаленного администрирования сервера для Windows 7](https://technet.microsoft.com/library/Ee449475).


> [!IMPORTANT]
> Для просмотра и управления группами репликации, содержащими реплицированные папки или члены, доступные только для чтения, которые являются отказоустойчивыми кластерами, необходимо использовать версию оснастки управления DFS, которая входит в состав Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, <a href="http://go.microsoft.com/fwlink/p/?linkid=238560">удаленного Средства администрирования сервера для Windows 8</a>или <a href="https://technet.microsoft.com/library/ee449475">средства удаленного администрирования сервера для Windows 7</a>. 
<br>


### <a name="do-ultrasound-and-sonar-work-with-dfs-replication"></a>Работает ли средство Ultrasound и Sonar с репликация DFS?

Нет. Репликация DFS имеет собственный набор средств мониторинга и диагностики. Средства Ultrasound и Sonar поддерживают только мониторинг FRS.

### <a name="how-can-files-be-recovered-from-the-conflictanddeleted-or-preexisting-folders"></a>Как можно восстановить файлы из Конфликтандделетед или существующих папок?

Чтобы восстановить потерянные файлы, восстановите файлы из папки файловой системы или общей папки с помощью журнала файлов, команды **восстановить предыдущие версии** в проводнике или путем восстановления файлов из резервной копии. Чтобы восстановить файлы непосредственно из папки конфликтандделетед или существовавшей ранее, используйте `Get-DfsrPreservedFiles` командлеты и `Restore-DfsrPreservedFiles` Windows PowerShell (входящие в состав модуля DFSR в Windows Server 2012 R2) или пример сценария [ресторедфср](http://code.msdn.microsoft.com/restoredfsr) из MSDN. Коллекция кода. Этот сценарий предназначен только для аварийного восстановления и предоставляется без гарантии.

### <a name="is-there-a-way-to-know-the-state-of-replication"></a>Есть ли способ выяснить состояние репликации?

Да. Существует несколько способов наблюдения за репликацией.

  - Репликация DFS содержит пакет управления для System Center Operations Manager, который обеспечивает упреждающий мониторинг.  
      
  - Оснастка «Управление DFS» имеет встроенный диагностический отчет для невыполненной работы репликации, эффективности репликации и количества файлов и папок в данной группе репликации.  
      
  - Модуль DFSR Windows PowerShell в Windows Server 2012 R2 содержит командлеты для запуска тестов распространения и записи отчетов о состоянии распространения и работоспособности. Дополнительные сведения см. [в разделе командлеты распределенная файловая система Replication в Windows PowerShell](https://technet.microsoft.com/library/dn296601.aspx).  
      
  - Dfsrdiag. exe — это программа командной строки, которая может формировать счетчик невыполненной работы или запускать тест распространения. В обоих случаях отображается состояние репликации. Распространение показывает, выполняется ли репликация файлов на все узлы. Невыполненная работа показывает, сколько файлов все еще необходимо реплицировать, прежде чем два компьютера будут синхронизированы. Количество невыполненных работ — это количество обновлений, которые не обрабатывались членом группы репликации. На компьютерах, работающих под управлением Windows Server 2012 R2, Windows Server 2012 или Windows Server 2008 R2, программа Dfsrdiag. exe также может отображать обновления, репликация DFS реплицируются в данный момент.  
      
  - Сценарии могут использовать инструментарий WMI для получения сведений о невыполненной работе — вручную или с помощью MOM.  
      

## <a name="performance"></a>Производительность

### <a name="does-dfs-replication-support-dial-up-connections"></a>Поддерживает ли репликация DFS подключения удаленного доступа?

Несмотря на то, что репликация DFS будет работать при коммутируемом вызове, она может получить невыполненный журнал при наличии большого количества изменений для репликации. Если в существующие файлы вносятся небольшие изменения, репликация DFS с удаленным разностным сжатием (RDC) обеспечит более высокую производительность, чем копирование файла напрямую.

### <a name="does-dfs-replication-perform-bandwidth-sensing"></a>Прорепликация DFS пропускания пропускной способности?

Нет. Репликация DFS не выполняет проверки пропускной способности. Можно настроить репликация DFS для использования ограниченного объема пропускной способности для каждого подключения (регулирование полосы пропускания). Однако репликация DFS не сокращает использование пропускной способности, если сетевой интерфейс перестает быть насыщенным, а репликация DFS может перегрузить ссылку на короткие периоды. Регулирование пропускной способности с репликация DFS не является полностью точным, поскольку репликация DFS регулирует пропускную способность путем регулирования вызовов RPC. В результате различные буферы на более низких уровнях сетевого стека (включая RPC) могут повлиять на трафик сети.

### <a name="does-dfs-replication-throttle-bandwidth-per-schedule-per-server-or-per-connection"></a>Репликация DFS регулировать пропускную способность по расписанию, на сервер или на подключение?

При настройке регулирования пропускной способности при указании расписания все соединения для этой группы репликации будут использовать этот параметр для регулирования полосы пропускания. Регулирование пропускной способности также можно задать в качестве параметра уровня соединения с помощью оснастки управления DFS.

### <a name="does-dfs-replication-use-active-directory-domain-services-to-calculate-site-links-and-connection-costs"></a>Репликация DFS использовать службы домен Active Directory для вычисления связей сайтов и расходов на подключения?

Нет. Репликация DFS использует топологию, определенную администратором, которая не зависит от стоимости сайта служб домен Active Directory Services.

### <a name="how-can-i-improve-replication-performance"></a>Как можно повысить производительность репликации?

Дополнительные сведения о различных методах настройки производительности репликации см. в статье [Настройка производительности репликации в службе DFSR](http://blogs.technet.com/b/askds/archive/2010/03/31/tuning-replication-performance-in-dfsr-especially-on-win2008-r2.aspx) в [блоге группы разработчиков служб каталогов](http://blogs.technet.com/b/askds/).

### <a name="how-does-dfs-replication-avoid-saturating-a-connection"></a>Как репликация DFS избежать насыщенности подключения?

В репликация DFS вы устанавливаете максимальную пропускную способность, которую вы хотите использовать для подключения, и служба поддерживает этот уровень использования сети. Это отличается от фоновая интеллектуальная служба передачи (бит), и репликация DFS не настраивает подключение, если задано соответствующее значение.

Тем не менее, регулирование пропускной способности не превышает 100%, а репликация DFS может быть перегружена по ссылке в течение короткого периода времени. Это обусловлено тем, что репликация DFS регулирует пропускную способность путем регулирования вызовов RPC. Поскольку этот процесс полагается на различные буферы на более низких уровнях сетевого стека, включая RPC, трафик репликации, как правило, перемещается в пакеты, что иногда может быть перегружено сетевыми соединениями.

Репликация DFS в Windows Server 2008 включает несколько улучшений производительности, как описано в разделе [Распределенная файловая система](https://technet.microsoft.com/library/Cc753479), в статье [изменения функциональных возможностей Windows Server 2003 с пакетом обновления 1 (SP1) до Windows Server 2008](https://technet.microsoft.com/library/cc753208).

### <a name="how-does-dfs-replication-performance-compare-with-frs"></a>Как репликация DFS сравнение производительности с FRS?

Репликация DFS работает гораздо быстрее, чем FRS, особенно если небольшие изменения вносятся в большие файлы, а RDC включен. Например, при использовании RDC незначительное изменение презентации PowerPoint® в 2 МБ может привести к тому, что по сети будет отправлено только 60 килобайт (КБ) — в байтах передано значение 97%.

RDC не используется для файлов размером менее 64 КБ и может не быть полезным в высокоскоростных ЛВС, в которых пропускная способность сети не является максимальной. RDC можно отключить для каждого подключения отдельно, используя оснастку управления DFS.

### <a name="how-frequently-does-dfs-replication-replicate-data"></a>Как часто репликация DFS реплицирует данные?

Данные реплицируются в соответствии с заданным расписанием. Например, для расписания можно задать 15-минутные интервалы, семь дней в неделю. В течение этих интервалов репликация включена. Репликация начнется вскоре после обнаружения изменения файла (обычно в течение нескольких секунд).

Для расписания группы репликации может быть задано значение универсальной координаты времени (UTC), в то время как для расписания подключения задано местное время принимающего участника. Примите это в учетную запись, если группа репликации охватывает несколько часовых поясов. Местное время означает время участника, на котором размещается входящее подключение. Отображаемое расписание входящего подключения и соответствующее исходящее подключение отражает разницу часовых поясов, если для расписания задано местное время.

### <a name="how-much-of-my-servers-system-resources-will-dfs-replication-consume"></a>Какой объем системных ресурсов сервера будет репликация DFS использовать?

Ресурсы диска, памяти и ЦП, используемые репликация DFS, зависят от ряда факторов, включая число и размер файлов, скорость изменения, число членов группы репликации и количество реплицированных папок. Кроме того, некоторые ресурсы сложнее оценить. Например, технология расширяемого хранилища (ESE), используемая для базы данных репликация DFS, может использовать большой процент доступной памяти, которую она освобождает по запросу. Приложения, отличные от репликация DFS, могут размещаться на одном сервере в зависимости от конфигурации сервера. Однако при размещении нескольких приложений или ролей сервера на одном сервере важно проверить эту конфигурацию перед ее реализацией в рабочей среде.

### <a name="what-happens-if-a-wan-link-fails-during-replication"></a>Что происходит при сбое связи WAN во время репликации?

Если соединение выйдет из строя, репликация DFS будет пытаться выполнить репликацию, пока открыто расписание. В репликация DFS журнале событий также будут отображаться ошибки подключения, которые можно собирать с помощью MOM (упреждающего оповещения) и отчета о работоспособности репликация DFS (в активном виде, например, когда администратор запускает его).

## <a name="remote-differential-compression-details"></a>Сведения об удаленном разностном сжатии

### <a name="are-changes-compressed-before-being-replicated"></a>Сжаты ли изменения перед их репликацией?

Да. Измененные фрагменты файлов сжимаются перед отправкой для всех типов файлов, за исключением следующих (которые уже сжаты):. файлы WMA, WMV, ZIP, JPG,. mpg,. MPEG,. m1v,. MP2,. mp3,. MPA,. cab,. wav,. snd,. au,. ASF,. WM,. AVI,. z,. gz,. tgz и. FRX. Параметры сжатия для этих типов файлов нельзя настроить в Windows Server 2003 R2.

### <a name="can-an-administrator-turn-off-rdc-or-change-the-threshold"></a>Может ли администратор отключить RDC или изменить пороговое значение?

Да. Вы можете отключить подключение к удаленному рабочему столу через страницу свойств данного соединения. Отключение RDC может снизить загрузку ЦП и задержку репликации в быстрых ссылках на локальную сеть, не имеющих ограничений пропускной способности, или для групп репликации, которые состоят в основном из файлов размером менее 64 КБ. Если вы решили отключить RDC для подключения, протестируйте эффективность репликации до и после изменения, чтобы убедиться в повышении производительности репликации.

Пороговое значение размера RDC можно изменить с помощью команды **Dfsradmin Connection Set** , РЕПЛИКАЦИЯ DFS поставщика WMI или путем изменения XML-файла конфигурации вручную.

### <a name="does-rdc-work-on-all-file-types"></a>Работает ли RDC с файлами всех типов?

Да. RDC рассчитывает различия на уровне блоков независимо от типа данных файла. Однако RDC работает более эффективно для определенных типов файлов, таких как документы Word, PST-файлы и образы VHD.

### <a name="how-does-rdc-work-on-a-compressed-file"></a>Как работает RDC в сжатом файле?

Репликация DFS использует RDC, который выполняет вычисление блоков в файле, которые были изменены, и отправляет только блоки по сети. Репликация DFS не нужно ничего знать о содержимом файла — только о том, какие блоки были изменены.

### <a name="is-cross-file-rdc-enabled-when-upgrading-to-windows-server-enterprise-edition-or-datacenter-edition"></a>Включен ли межфайловый протокол RDC при обновлении до выпуска Windows Server Enterprise Edition или Datacenter?

Стандартные выпуски Windows Server не поддерживают межфайловый протокол RDC. Однако он автоматически включается при обновлении до выпуска, поддерживающего межфайловый протокол RDC, или в случае, если член репликации работает под управлением поддерживаемого выпуска. Список выпусков, поддерживающих межфайловый протокол RDC, см. в разделе какие выпуски операционной системы Windows поддерживают перекрестные файлы RDC?

### <a name="is-rdc-true-block-level-replication"></a>Является ли репликация на уровне блока RDC действительной?

Нет. RDC — это протокол общего назначения для сжатия при переносе файлов. Репликация DFS использует RDC в блоках на уровне файлов, а не на уровне блоков диска. RDC разделяет файл на блоки. Для каждого блока в файле вычисляется подпись, которая представляет собой небольшое число байтов, которое может представлять большой блок. Набор подписей передается с сервера на клиент. Клиент сравнивает сигнатуры сервера со своими собственными. Затем клиент запрашивает сервер, отправляют только данные для подписей, которые еще не находятся на клиенте.

### <a name="what-happens-if-i-rename-a-file"></a>Что произойдет, если переименовать файл?

Репликация DFS переименовывает файл во всех остальных элементах группы репликации во время следующей репликации. Файлы отправляются с использованием уникального идентификатора, поэтому переименование файла и перемещение файла в реплике не влияют на возможность репликация DFS репликации файла.

### <a name="what-is-cross-file-rdc"></a>Что такое Cross-File RDC?

Межфайловый протокол RDC позволяет репликация DFS использовать RDC, даже если на стороне клиента не существует файла с таким же именем. Межфайловый протокол RDC использует эвристику для определения файлов, которые похожи на файл, который необходимо реплицировать, и использует блоки аналогичных файлов, которые идентичны файлу репликации, чтобы максимально сокращать объем данных, передаваемых по глобальной сети. В этом процессе между файлами RDC могут использоваться блоки размером до пяти подобных файлов.

Чтобы использовать межфайловый протокол RDC, на одном из элементов подключения репликации должен быть установлен выпуск Windows, поддерживающий межфайловый сервер RDC. Список выпусков, поддерживающих межфайловый протокол RDC, см. в разделе какие выпуски операционной системы Windows поддерживают перекрестные файлы RDC?

### <a name="what-is-rdc"></a>Что такое RDC?

Удаленное разностное сжатие (RDC) — это протокол клиент-сервер, который можно использовать для эффективного обновления файлов по сети с ограниченной пропускной способностью. RDC обнаруживает операции вставки, удаления и переупорядочения данных в файлах, что позволяет репликация DFS реплицировать только изменения при обновлении файлов. RDC используется только для файлов размером 64 КБ или больше по умолчанию. RDC может использовать более старую версию файла с тем же именем в реплицированной папке или в папке дфсрпривате\\конфликтандделетед (расположенной по локальному пути реплицированной папки).

### <a name="when-is-rdc-used-for-replication"></a>Когда используется RDC для репликации?

RDC используется, когда файл превышает пороговое значение минимального размера. По умолчанию этот порог размера равен 64 КБ. После репликации файла, превышающего это пороговое значение, обновленные версии файла всегда используют RDC, если только не изменяется большая часть файла или отключено подключение к удаленному рабочему столу.

### <a name="which-editions-of-the-windows-operating-system-support-cross-file-rdc"></a>Какие выпуски операционной системы Windows поддерживают перекрестные файлы RDC?

Чтобы использовать межфайловый протокол RDC, на одном члене соединения репликации должен быть установлен выпуск операционной системы Windows, поддерживающий межфайловый сервер RDC. В следующей таблице показано, какие выпуски операционной системы Windows поддерживают перекрестные файлы RDC.

### <a name="cross-file-rdc-availability-in-editions-of-the-windows-operating-system"></a>Доступность межфайлового подключения к удаленному рабочему столу в выпусках операционной системы Windows

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>Версия операционной системы</th>
<th>Standard Edition</th>
<th>Выпуск Enterprise</th>
<th>Выпуск Datacenter</th>
</tr>
</thead>
<tbody>
<tr class="even">
<td><p>Windows Server 2012 R2</p></td>
<td><p>Да<em></p></td>
<td><p>Недоступно</p></td>
<td><p>Да</em></p></td>
</tr>
<tr class="odd">
<td><p>Windows Server 2012</p></td>
<td><p>Да</p></td>
<td><p>Недоступно</p></td>
<td><p>Да</p></td>
</tr>
<tr class="even">
<td><p>Windows Server 2008 R2</p></td>
<td><p>Нет</p></td>
<td><p>Да</p></td>
<td><p>Да</p></td>
</tr>
<tr class="odd">
<td><p>Windows Server 2008</p></td>
<td><p>Нет</p></td>
<td><p>Да</p></td>
<td><p>Нет</p></td>
</tr>
<tr class="even">
<td><p>Windows Server 2003 R2</p></td>
<td><p>Нет</p></td>
<td><p>Да</p></td>
<td><p>Нет</p></td>
</tr>
</tbody>
</table>

\*При необходимости можно отключить межфайловый сервер RDC в Windows Server 2012 R2.

## <a name="replication-details"></a>Сведения о репликации

### <a name="can-i-change-the-path-for-a-replicated-folder-after-it-is-created"></a>Можно ли изменить путь к реплицированной папке после ее создания?

Нет. Если необходимо изменить путь к реплицированной папке, необходимо удалить ее в оснастке «Управление DFS» и добавить ее в качестве новой реплицированной папки. Затем репликация DFS использует удаленное разностное сжатие (RDC) для выполнения синхронизации, которая определяет, совпадают ли данные на отправляющем и принимающем членах. Она не реплицирует все данные в папке повторно.

### <a name="can-i-configure-which-file-attributes-are-replicated"></a>Можно ли настроить, какие атрибуты файлов реплицируются?

Нет, нельзя настроить, какие атрибуты файлов репликация DFS реплицируются.

Список значений атрибутов и их описание см. в разделе [атрибуты файлов](http://go.microsoft.com/fwlink/?linkid=182268) на сайте MSDN (http://go.microsoft.com/fwlink/?LinkId=182268).

Следующие значения атрибутов задаются с помощью `SetFileAttributes dwFileAttributes` функции и реплицируются с помощью репликация DFS. Изменения этих значений атрибутов активируют репликацию атрибутов. Содержимое файла не реплицируется, если только содержимое не изменяется. Дополнительные сведения см. в разделе [функция сетфилеаттрибутес](http://go.microsoft.com/fwlink/?linkid=182269) в библиотеке MSDN (http://go.microsoft.com/fwlink/?LinkId=182269).

  - \_АТРИБУТ\_ФАЙЛА СКРЫТ  
      
  - \_АТРИБУТ\_ФАЙЛА READONLY  
      
  - СИСТЕМА\_АТРИБУТОВ\_ФАЙЛОВ  
      
  - АТРИБУТ\_ФАЙЛА\_\_НЕИНДЕКСИРОВАНОВСОДЕРЖИМОМ\_  
      
  - АВТОНОМНЫЙ\_АТРИБУТ ФАЙЛА\_  
      

Следующие значения атрибутов реплицируются с помощью репликация DFS, но они не активируют репликацию.

  - АРХИВ\_АТРИБУТОВ\_ФАЙЛОВ  
      
  - \_АТРИБУТ\_ФАЙЛА ЯВЛЯЕТСЯ НОРМАЛЬНЫМ  
      

Следующие значения атрибутов файлов также активируют репликацию, хотя они не могут быть заданы с `SetFileAttributes` помощью функции (для `GetFileAttributes` просмотра значений атрибутов используется функция).

  - ТОЧКА ПОВТОРНОГО АНАЛИЗА\_\_АТРИБУТА ФАЙЛА\_  
      

> [!NOTE]
> Репликация DFS не реплицирует значения атрибутов точки повторного анализа, если только тег повторного анализа не IO_REPARSE_TAG_SYMLINK. Файлы с тегами повторного анализа IO_REPARSE_TAG_DEDUP, IO_REPARSE_TAG_SIS или IO_REPARSE_TAG_HSM реплицируются как обычные файлы. Тем не менее, тег повторного анализа и буферы данных повторного анализа не реплицируются на другие серверы, так как точка повторного анализа работает только в локальной системе. 
<br>

  - СЖАТЫЙ\_АТРИБУТ\_ФАЙЛА  
      
  - \_АТРИБУТ\_ФАЙЛА ЗАШИФРОВАН  
      

> [!NOTE]
> Репликация DFS не реплицирует файлы, зашифрованные с помощью шифрованная файловая система (EFS) (EFS). Репликация DFS выполняет репликацию файлов, зашифрованных с помощью программного обеспечения сторонних разработчиков, но только в том случае, если не устанавливает значение атрибута FILE_ATTRIBUTE_ENCRYPTED в файле. 
<br>

  - РАЗРЕЖЕННЫЙ\_\_ФАЙЛАТРИБУТА\_ФАЙЛА  
      
  - КАТАЛОГ\_АТРИБУТОВ\_ФАЙЛА  
      

Репликация DFS не реплицирует временное значение\_атрибута\_файла.

### <a name="can-i-control-which-member-is-replicated"></a>Можно ли контролировать реплицируемый элемент?

Да. Топологию можно выбрать при создании группы репликации. Или можно выбрать вариант **без топологии** и настроить подключения вручную после создания группы репликации.

### <a name="can-i-seed-a-replication-group-member-with-data-prior-to-the-initial-replication"></a>Можно ли заполнить член группы репликации данными до начальной репликации?

Да. Репликация DFS поддерживает копирование файлов в член группы репликации перед начальной репликацией. Это «предварительная подготовка» может значительно сократить объем данных, реплицируемых во время начальной репликации.

Начальной репликации не требуется реплицировать содержимое, если файлы отличаются только реальными атрибутами или штампами времени. Реальный атрибут — это атрибут, который может быть задан функцией `SetFileAttributes`Win32. Дополнительные сведения см. в разделе [функция сетфилеаттрибутес](http://go.microsoft.com/fwlink/?linkid=182269) в библиотеке MSDN (http://go.microsoft.com/fwlink/?LinkId=182269). Если два файла отличаются другими атрибутами, такими как сжатие, то содержимое файла реплицируется.

Чтобы выполнить предварительную настройку члена группы репликации, скопируйте файлы в соответствующую папку на целевых серверах, создайте группу репликации, а затем выберите основной член. Выберите элемент, имеющий самые актуальные файлы, которые необходимо реплицировать, так как содержимое основного участника считается полномочным. Это означает, что во время начальной репликации файлы основного участника всегда будут перезаписывать другие версии файлов на других членах группы репликации.

Сведения о предварительном заполнении и клонировании базы данных DFSR см. в [разделе Репликация DFS начальной синхронизации в Windows Server 2012 R2: Атаки на клоны](http://blogs.technet.com/b/filecab/archive/2013/08/21/dfs-replication-initial-sync-in-windows-server-2012-r2-attack-of-the-clones.aspx).

Дополнительные сведения о начальной репликации см. в разделе [Создание группы репликации](https://technet.microsoft.com/library/cc725893).

### <a name="does-dfs-replication-overcome-common-file-replication-service-issues"></a>Репликация DFS преодолеть распространенные проблемы службы репликации файлов?

Да. Репликация DFS возникать три распространенные проблемы FRS:

  - Перенос журнала: Репликация DFS восстановления из журнала переносится на ходу. Каждый существующий файл или папка будут помечены как Жаурналврап и проверены в файловой системе перед повторной включением репликации. Во время восстановления этот том недоступен для репликации в любом направлении.  
      
  - Чрезмерная репликация: Чтобы предотвратить чрезмерную репликацию, репликация DFS использует систему кредитов.  
      
  - Произимеющие трансформации папки: Чтобы предотвратить появление переименованных папок, репликация DFS сохраняет конфликтующие данные в скрытой папке дфсрпривате\\конфликтандделетед (расположенной по локальному пути реплицированной папки). Например, создание нескольких папок одновременно с одинаковыми именами на разных серверах, реплицированных с помощью FRS, приводит к тому, что FRS переименовывает старые папки. Вместо этого репликация DFS перемещает старые папки в локальную папку конфликтов и удалений.  
      

### <a name="does-dfs-replication-replicate-files-in-chronological-order"></a>Репликация DFS реплицировать файлы в хронологическом порядке?

Нет. Файлы могут реплицироваться не по порядку.

### <a name="does-dfs-replication-replicate-files-that-are-being-used-by-another-application"></a>Репликация DFS ли реплицировать файлы, используемые другим приложением?

Если приложение открывает файл и создает на нем блокировку файла (предотвращая его использование другими приложениями, когда оно открыто), репликация DFS не реплицирует файл, пока он не будет закрыт. Если приложение открывает файл с доступом для чтения и общего доступа, он по-прежнему может быть реплицирован.

### <a name="does-dfs-replication-replicate-ntfs-file-permissions-alternate-data-streams-hard-links-and-reparse-points"></a>Репликация DFS ли реплицировать разрешения для файлов NTFS, альтернативные потоки данных, жесткие связи и точки повторного анализа?

  - Репликация DFS реплицирует разрешения для файлов NTFS и альтернативные потоки данных.  
      
  - Корпорация Майкрософт не поддерживает создание жестких связей NTFS с файлами в реплицированной папке. это может привести к проблемам репликации с затронутыми файлами. Файлы жесткой связи игнорируются репликация DFS и не реплицируются. Точки соединения также не реплицируются, а репликация DFS регистрирует событие 4406 для каждой точки соединения, которую она встречает.  
      
  - Только точки повторного анализа, реплицируемые с помощью репликация DFS, — это те,\_которые используют тег\_\_символьную ссылку для повторного анализа. Однако репликация DFS не гарантирует, что целевой объект символьную ссылку также реплицируется. Дополнительные сведения см. в [блоге группы разработчиков служб каталогов](http://blogs.technet.com/b/askds/archive/2011/09/30/friday-mail-sack-super-slo-mo-edition.aspx).  
      
  - Файлы с тегами\_\_повторного анализа\_ввода-вывода тег дедупликации,\_маркер\_повторного анализа ввода-\_вывода\_или\_тег\_повторного анализа ввода-вывода реплицируют Теги повторного анализа. как обычные файлы. Тег повторного анализа и буферы данных повторного анализа не реплицируются на другие серверы, так как точка повторного анализа работает только в локальной системе. Таким образом, репликация DFS может реплицировать папки на томах, использующих дедупликацию данных в Windows Server 2012 или хранилище единственных копий, однако сведения о дедупликации данных обслуживаются отдельно на каждом сервере, на котором включена служба роли.  
      

### <a name="does-dfs-replication-replicate-timestamp-changes-if-no-other-changes-are-made-to-the-file"></a>Репликация DFS реплицировать изменения метки времени, если в файл не внесены другие изменения?

Нет, репликация DFS не реплицирует файлы, для которых единственным изменением является изменение метки времени. Кроме того, измененная метка времени не реплицируется на другие члены группы репликации, если в файл не внесены другие изменения.

### <a name="does-dfs-replication-replicate-updated-permissions-on-a-file-or-folder"></a>Репликация DFS ли реплицировать обновленные разрешения на файл или папку?

Да. Репликация DFS реплицирует изменения разрешений для файлов и папок. Реплицируется только часть файла, связанная с списком управления доступом (ACL), хотя репликация DFS должен по-прежнему считывать весь файл в промежуточной области.


> [!NOTE]
> Изменение списков управления доступом на большом числе файлов может повлиять на производительность репликации. Однако при использовании RDC объем передаваемых данных пропорционально размеру ACL, а не к размеру всего файла. Объем трафика на диске по-прежнему пропорционален размеру файлов, так как файлы должны быть считаны в промежуточную папку и из нее. 
<br>


### <a name="does-dfs-replication-support-merging-text-files-in-the-event-of-a-conflict"></a>Поддерживает ли репликация DFS слияние текстовых файлов в случае конфликта?

Репликация DFS не выполняет слияние файлов при возникновении конфликта. Однако он пытается сохранить старую версию файла в скрытой папке дфсрпривате\\конфликтандделетед на компьютере, где обнаружен конфликт.

### <a name="does-dfs-replication-use-encryption-when-transmitting-data"></a>Репликация DFS использовать шифрование при передаче данных?

Да. Репликация DFS использует подключения удаленного вызова процедур (RPC) с шифрованием.

### <a name="is-it-possible-to-disable-the-use-of-encrypted-rpc"></a>Можно ли отключить использование зашифрованного RPC?

Нет. Служба репликация DFS использует удаленные вызовы процедур (RPC) по протоколу TCP для репликации данных. Для защиты передачи данных через Интернет служба репликация DFS разработана таким образом, `RPC_C_AUTHN_LEVEL_PKT_PRIVACY`чтобы всегда использовалась константа уровня проверки подлинности. Это гарантирует, что связь RPC через Интернет всегда шифруется. Таким образом, невозможно отключить использование зашифрованного RPC службой репликация DFS.

Дополнительные сведения см. на следующих веб-сайтах корпорации Майкрософт:

  - [Технический справочник по RPC](http://go.microsoft.com/fwlink/?linkid=182278)  
      
  - [Об удаленном разностном сжатии](http://go.microsoft.com/fwlink/?linkid=182279)  
      
  - [Константы уровня проверки подлинности](http://go.microsoft.com/fwlink/?linkid=182280)  
      

### <a name="how-are-simultaneous-replications-handled"></a>Как обрабатываются одновременные репликации?

Для каждой реплицированной папки существует один диспетчер обновлений. Диспетчеры обновлений работают независимо друг от друга.

По умолчанию максимальное число одновременных Скачиваний в 16 (4 в Windows Server 2003 R2) совместно используется всеми подключениями и группами репликации. Так как подключения и обновления групп репликации не сериализуются, нет особого порядка, в котором происходит получение обновлений. Если открыто два расписания, то обновления обычно получаются и устанавливаются из обоих подключений одновременно.

### <a name="how-do-i-force-replication-or-polling"></a>Разделы справки выполнить принудительную репликацию или опрос?

Можно немедленно принудительно выполнить репликацию с помощью оснастки управления DFS, как описано в разделе [изменение расписаний репликации](https://technet.microsoft.com/library/Cc732278). Можно также выполнить принудительную репликацию с `Sync-DfsReplicationGroup` помощью командлета, включенного в модуль DFSR PowerShell, появившийся в Windows Server 2012 R2, или команду **Dfsrdiag синкнов** . Принудительный опрос можно выполнить с помощью `Update-DfsrConfigurationFromAD` командлета или команды **Dfsrdiag поллад** .

### <a name="is-it-possible-to-configure-a-quiet-time-between-replications-for-files-that-change-frequently"></a>Можно ли настроить тихий интервал между репликациями для файлов, которые часто меняются?

Нет. Если расписание открыто, репликация DFS реплицирует изменения по мере их уведомления. Не существует способа настройки времени для файлов в тихом режиме.

### <a name="is-it-possible-to-configure-one-way-replication-with-dfs-replication"></a>Можно ли настроить одностороннюю репликацию с репликация DFS?

Да. Если используется Windows Server 2012 или Windows Server 2008 R2, можно создать реплицированную папку только для чтения, которая реплицирует содержимое с помощью одностороннего подключения. Дополнительные сведения см. в разделе [Создание реплицированной папки только для чтения на определенном члене](http://go.microsoft.com/fwlink/?linkid=156740) (http://go.microsoft.com/fwlink/?LinkId=156740).

Мы не поддерживаем создание одностороннего подключения репликации с репликация DFS в Windows Server 2008 или Windows Server 2003 R2. Это может вызвать многочисленные проблемы, включая ошибки топологии проверки работоспособности, промежуточные проблемы и проблемы с базой данных репликация DFS.

При использовании Windows Server 2008 или Windows Server 2003 R2 можно имитировать одностороннее подключение, выполнив следующие действия.

  - Обучить администраторов вносить изменения только на серверы, которые необходимо назначить основным сервером. Затем разрешите репликацию изменений на целевые серверы.  
      
  - Настройте разрешения для общего ресурса на целевых серверах, чтобы конечные пользователи не имели разрешения на запись. Если на серверах филиалов не разрешено никаких изменений, то нет никакой необходимости выполнять повторную репликацию, имитируя одностороннее подключение и обеспечивая низкий уровень использования глобальной сети.  
      

### <a name="is-there-a-way-to-force-a-complete-replication-of-all-files-including-unchanged-files"></a>Есть ли способ принудительно выполнить полную репликацию всех файлов, включая неизмененные файлы?

Нет. Если репликация DFS считает файлы идентичными, они не будут реплицированы. Если измененные файлы не были реплицированы, репликация DFS будут автоматически реплицировать их при настройке. Чтобы перезаписать настроенное расписание, используйте метод WMI **форцерепликате ()** . Однако это только Переопределение расписания и не выполняет принудительную репликацию неизмененных или идентичных файлов.

### <a name="what-happens-if-the-primary-member-suffers-a-database-loss-during-initial-replication"></a>Что произойдет, если основной член прибывает к утрате базы данных во время начальной репликации?

Во время начальной репликации файлы основного участника всегда имеют приоритет при разрешении конфликтов, которое происходит, если у принимающих участников разные версии файлов на основном члене. Первичный член хранится в службах домен Active Directory, и после того как основной член будет готов к репликации, он удаляется, но до репликации всех элементов группы репликации.

В случае сбоя начальной репликации или перезапуска службы репликация DFS во время репликации основной член видит первичный член в локальной базе данных репликация DFS и повторяет начальную репликацию. Если репликация DFS база данных основного участника теряется после очистки основного дизайна в службах домен Active Directory, но до того, как все члены группы репликации завершают начальную репликацию, все члены группы репликации не будут Репликация папки, так как в качестве основного участника не указан сервер. В этом случае для восстановления основного члена вручную используйте команду **DfsrAdmin Membership/Set/испримари: true** на основном сервере.

Дополнительные сведения о начальной репликации см. [в разделе Создание группы репликации](https://technet.microsoft.com/library/cc725893).


> [!WARNING]
> Основная схема элемента используется только в процессе начальной репликации. При использовании команды <STRONG>DfsrAdmin</STRONG> для указания основного члена реплицированной папки после завершения репликации репликация DFS не назначает сервер в качестве основного участника в службах домен Active Directory Services. Однако если в репликация DFSной базе данных на сервере происходит необратимое повреждение или потеря данных, сервер пытается выполнить начальную репликацию в качестве основного члена, а не восстанавливать данные с другого участника репликации. сгруппировать. По сути, сервер станет фальшивым сервером-источником, что может вызвать конфликты. По этой причине основной элемент следует указывать вручную, только если вы уверены, что в начальной репликации поврежденный полностью сбой. 
<br>


### <a name="what-happens-if-the-replication-schedule-closes-while-a-file-is-being-replicated"></a>Что происходит, если расписание репликации закрывается во время репликации файла?

Если для подключения включено удаленное разностное сжатие (RDC), входящая репликация файла размером более 64 КБ, который начал реплицировать немедленно до закрытия расписания (или смены **пропускной способности**), будет продолжаться при открытии расписания (или изменения **не пропускной способности**. Репликация продолжится из состояния, в котором она находилась в момент остановки репликации.

Если подключение к удаленному рабочему столу отключено, репликация DFS полностью перезапускает перенос файлов. Это может задержаться, когда файл будет доступен на принимающем участнике.

### <a name="what-happens-when-two-users-simultaneously-update-the-same-file-on-different-servers"></a>Что происходит, когда два пользователя одновременно обновляют один и тот же файл на разных серверах?

Когда репликация DFS обнаруживает конфликт, он использует версию файла, который был сохранен последним. Он перемещает другой файл в папку дфсрпривате\\конфликтандделетед (под локальным путем к реплицированной папке на компьютере, который разрешил конфликт). Он остается там до очистки папки конфликтов и удалений, что происходит, когда папка конфликтов и удалений превышает заданный размер или репликация DFS обнаруживает ошибку нехватки места на диске. Папка конфликтов и удалений не реплицируется, и этот метод устранения конфликтов позволяет избежать проблемы с переданными каталогами, которые были доступны в службе FRS.

При возникновении конфликта репликация DFS регистрирует информационное событие в репликация DFS журнале событий. Это событие не требует действий пользователя по следующим причинам:

  - Он невидим для пользователей (он виден только администраторам сервера).  
      
  - Репликация DFS рассматривает папку конфликтов и удалений как кэш. При достижении порога квоты он очищает некоторые из этих файлов. Нет никакой гарантии, что конфликтующие файлы будут сохранены.  
      
  - Конфликт может находиться на сервере, отличном от источника конфликта.  
      

## <a name="staging"></a>Поэтапное создание

### <a name="does-dfs-replication-continue-staging-files-when-replication-is-disabled-by-a-schedule-or-bandwidth-throttling-quota-or-when-a-connection-is-manually-disabled"></a>Репликация DFS продолжить промежуточное хранение файлов, если репликация отключена по расписанию или квоте регулирования пропускной способности или если подключение отключено вручную?

Нет. Репликация DFS не выполняет промежуточное хранение файлов за пределами запланированной репликации, при превышении квоты на регулирование пропускной способности или при отключенных подключениях.

### <a name="does-dfs-replication-prevent-other-applications-from-accessing-a-file-during-staging"></a>Репликация DFS предотвратить доступ других приложений к файлу во время промежуточного хранения?

Нет. Репликация DFS открывает файлы таким способом, который не блокирует открытие файлов пользователями или приложениями в папке репликации. Этот метод известен как «оппортунистической блокировки».

### <a name="is-it-possible-to-change-the-location-of-the-staging-folder-with-the-dfs-management-tool"></a>Можно ли изменить расположение промежуточной папки с помощью средства управления DFS?

Да. Расположение промежуточной папки настраивается на вкладке **Дополнительно** диалогового окна **свойства** для каждого члена группы репликации.

### <a name="when-are-files-staged"></a>Когда размещаются файлы в промежуточном виде?

Файлы размещаются на отправляющем члене, когда принимающий участник запрашивает файл (если файл не равен 64 КБ или меньше), как показано в следующей таблице. Если в соединении отключено удаленное разностное сжатие (RDC), файл помещается в промежуточное состояние, если его размер не превышает 256 КБ. Файлы также помещаются на получающем участнике, если они имеют размер менее 64 КБ, хотя этот параметр можно настроить от 16 КБ до 1 МБ. Если расписание закрыто, файлы не будут помещены в промежуточное состояние.

### <a name="the-minimum-file-sizes-for-staging-files"></a>Минимальный размер файлов для промежуточных файлов

<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th> </th>
<th>RDC включено</th>
<th>RDC отключен</th>
</tr>
</thead>
<tbody>
<tr class="even">
<td><p>Отправляющий элемент</p></td>
<td><p>64 КБ</p></td>
<td><p>256 КБ</p></td>
</tr>
<tr class="odd">
<td><p>Принимающий элемент</p></td>
<td><p>64 КБ по умолчанию</p></td>
<td><p>64 КБ по умолчанию</p></td>
</tr>
</tbody>
</table>

### <a name="what-happens-if-a-file-is-changed-after-it-is-staged-but-before-it-is-completely-transmitted-to-the-remote-site"></a>Что происходит, если файл изменяется после его промежуточного размещения, но перед его полной передачей на удаленный сайт?

Если какая-либо часть файла уже передается, репликация DFS возобновляет передачу. Если файл был изменен до того, как репликация DFS начнет передачу файла, будет отправлена новая версия файла.

## <a name="change-history"></a>История изменений


<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Описание</th>
<th>`Reason`</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>15 ноября 2018 г.</p></td>
<td><p>Обновлено для Windows Server 2019.</p></td>
<td><p>Новая операционная система.</p></td>
</tr>
<tr class="even">
<td><p>9 октября 2013 г.</p></td>
<td><p>Обновлены ли ограничения репликация DFS? с результатами тестов в Windows Server 2012 R2.</p></td>
<td><p>Обновления для последней версии Windows Server</p></td>
</tr>
<tr class="odd">
<td><p>30 января, 2013</p></td>
<td><p>Добавлен репликация DFS продолжить промежуточное хранение файлов, если репликация отключена по расписанию или квоте регулирования пропускной способности или если подключение отключено вручную? операции.</p></td>
<td><p>Вопросы пользователей</p></td>
</tr>
<tr class="even">
<td><p>31 октября 2012 г.</p></td>
<td><p>Изменились ли ограничения, поддерживаемые репликация DFS? запись для увеличения проверенного количества реплицированных файлов на томе.</p></td>
<td><p>Отзывы пользователей</p></td>
</tr>
<tr class="odd">
<td><p>15 августа 2012 г.</p></td>
<td><p>Изменено репликация DFS реплицировать разрешения для файлов NTFS, альтернативные потоки данных, жесткие связи и точки повторного анализа? запись, поясняющая, как репликация DFS обрабатывает жесткие связи и точки повторного анализа.</p></td>
<td><p>Отзывы от службы поддержки пользователей</p></td>
</tr>
<tr class="even">
<td><p>13 июня 2012 г.</p></td>
<td><p>Изменено репликация DFS работает на томах ReFS или FAT? запись для добавления обсуждения ReFS.</p></td>
<td><p>Отзывы пользователей</p></td>
</tr>
<tr class="odd">
<td><p>25 апреля 2012 г.</p></td>
<td><p>Изменено репликация DFS реплицировать разрешения для файлов NTFS, альтернативные потоки данных, жесткие связи и точки повторного анализа? запись, поясняющая, как репликация DFS обрабатывает жесткие связи.</p></td>
<td><p>Уменьшение потенциальной путаницы</p></td>
</tr>
<tr class="even">
<td><p>30 марта 2011 г.</p></td>
<td><p>После изменения репликация DFS может реплицировать файлы Outlook. pst или базы данных Microsoft Office Access? запись для исправления потенциального воздействия на использование репликация DFS с файлами PST и Access.</p>
<p>Добавлено, как можно повысить производительность репликации?</p></td>
<td><p>Вопросы пользователей о предыдущей записи, которые неправильно указали, что репликация PST или файлов Access может повредить базу данных репликация DFS.</p></td>
</tr>
<tr class="odd">
<td><p>26 января 2011 г.</p></td>
<td><p>Добавлены сведения о том, как можно восстановить файлы из Конфликтандделетед или существующих папок?</p></td>
<td><p>Отзывы пользователей</p></td>
</tr>
<tr class="even">
<td><p>20 октября 2010 г.</p></td>
<td><p>Добавлены инструкции по обновлению или замене члена репликация DFS?</p></td>
<td><p>Отзывы пользователей</p></td>
</tr>
</tbody>
</table>

