---
title: Используйте Robocopy для предварительно заполнив файлов для репликации DFS
description: Как использовать Robocopy.exe для предварительно заполнив файлов для репликации DFS.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 05/18/2018
ms.localizationpriority: medium
ms.openlocfilehash: eaec563157a77fd4e782842a81e5b59e49a5ea09
ms.sourcegitcommit: 7cb939320fa2613b7582163a19727d7b77debe4b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2019
ms.locfileid: "65621299"
---
# <a name="use-robocopy-to-preseed-files-for-dfs-replication"></a>Используйте Robocopy для предварительно заполнив файлов для репликации DFS

>Относится к: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2, Windows Server 2008

В этом разделе объясняется, как использовать средство командной строки **Robocopy.exe**, чтобы предварительно заполнив файлы при настройке репликации для репликации распределенной файловой системы (DFS) (также известный как DFSR или DFS-R) в Windows Server. Перед настройкой репликации DFS предварительно указать начальные значения файлов, Добавление нового партнера репликации, или заменить сервер, можно ускорить начальную синхронизацию, а также включить клонирование базы данных репликации DFS в Windows Server 2012 R2. Метод Robocopy — один из методов preseeding; Дополнительные сведения см. в разделе [шаг 1: предварительно заполнив файлов для репликации DFS](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn495046(v%3dws.11)>).

Служебную программу командной строки Robocopy (надежные копирования файлов) входит в состав Windows Server. Служебная программа предоставляет расширенные возможности, которые включают копирование безопасности, резервного копирования API поддержки, возможностей повторных попыток и ведения журнала. Более поздние версии поддерживают многопоточность и без буферизации ввода-вывода.

>[!IMPORTANT]
>Robocopy исключительно заблокированные файлы не копируются. Если пользователи часто заблокировать много файлов для длительных периодов на файловых серверах, рассмотрите возможность использования другого метода preseeding. Предварительно указать начальные значения не требует прекрасным решением между списками файл на исходном и конечном серверах, но имеет дополнительные файлы, которые не существуют, когда выполняется начальная синхронизация для репликации DFS, менее эффективно, предварительно указать начальные значения. Чтобы свести к минимуму конфликты блокировки, используйте Robocopy во время непиковых часов для вашей организации. Всегда в журналах Robocopy после предварительно указать начальные значения, чтобы убедиться, что вы понимаете, какие файлы были пропущены из-за монопольные блокировки.

С помощью Robocopy предварительно заполнив файлов для репликации DFS, выполните следующие действия:

1. [Скачайте и установите последнюю версию Robocopy.](#step-1-download-and-install-the-latest-version-of-robocopy)
2. [Стабилизация файлы, которые будут реплицированы.](#step-2-stabilize-files-that-will-be-replicated)
3. [Скопируйте реплицируемых файлов на целевой сервер.](#step-3-copy-the-replicated-files-to-the-destination-server)

## <a name="prerequisites"></a>Предварительные требования

Так как предварительно указать начальные значения непосредственно не входит служба репликации DFS, достаточно для соответствия требованиям для выполнения копирования файлов с помощью Robocopy.

- Необходима учетная запись, которая является членом локальной группы администраторов на исходном и конечном серверах.

- Установите последнюю версию Robocopy на сервере, который будет использоваться для копирования файлов, исходного сервера или конечного сервера; необходимо будет установить самую последнюю версию для версии операционной системы. Инструкции см. в разделе [шаг 2: Стабилизация файлы, которые будут реплицированы](#step-2-stabilize-files-that-will-be-replicated). Если не предварительно указать начальные значения файлов с сервера под управлением Windows Server 2003 R2, можно запустить Robocopy на исходном или конечном сервере. На целевой сервер, который обычно имеет более поздней версии операционной системы, предоставляет доступ к самой последней версии Robocopy.

- Убедитесь, что недостаточно места на диске назначения. Не создавайте по пути, который вы планируете Копировать в папку: Robocopy необходимо создать в корневой папке.
    
    >[!NOTE]
    >Когда вы решите, какой объем дискового пространства, выделяемого для preseeded файлов, учитывайте ожидаемый рост данных по времени и хранения требований для репликации DFS. Справка по планированию [изменение размера квот промежуточной папки и папки конфликтов и удалены](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754229(v=ws.11)) в [управление репликации DFS](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754771(v=ws.11)>).

- На исходном сервере при необходимости установите Process Monitor или Process Explorer, который можно использовать для поиска для приложений, блокирующих файлы. Сведения о загрузке см. в разделе [Process Monitor](https://docs.microsoft.com/sysinternals/downloads/procmon) и [Process Explorer](https://docs.microsoft.com/sysinternals/downloads/process-explorer).

## <a name="step-1-download-and-install-the-latest-version-of-robocopy"></a>Шаг 1. Скачайте и установите последнюю версию Robocopy

Перед использованием Robocopy для предварительно заполнив файлы, необходимо загрузить и установить последнюю версию **Robocopy.exe**. Это гарантирует, что служба репликации DFS не пропустить файлы, из-за проблем в версии доставки Robocopy.

Источник для последней версии совместимый Robocopy, зависит от версии Windows Server, на котором выполняется на сервере. Сведения о загрузке исправление с самой последней версией Robocopy для Windows Server 2008 R2 или Windows Server 2008, см. в разделе [список доступных в настоящее время исправлений для технологии распределенной файловой системы (DFS) в Windows Server 2008 и в Windows Server 2008 R2](https://support.microsoft.com/help/968429/list-of-currently-available-hotfixes-for-distributed-file-system-dfs-t).

В качестве альтернативы можно найти и установить последние исправления для операционной системы, выполнив следующие действия.

### <a name="locate-and-install-the-latest-version-of-robocopy-for-a-specific-version-of-windows-server"></a>Найдите и установите последнюю версию Robocopy для определенной версии Windows Server

1. Откройте в веб-браузер, [ https://support.microsoft.com ](https://support.microsoft.com/).

2. В **поддержку поиска**, введите следующую строку, заменив `<operating system version>` с соответствующей операционной системой, затем нажмите клавишу ВВОД:
    
    ```robocopy.exe kbqfe "<operating system version>"```
    
    Например, введите **robocopy.exe kbqfe «Windows Server 2008 R2»** .

3. Найдите и загрузите исправление с наибольшим номером идентификатор (то есть последняя версия).

4. Установите исправление на сервере.

## <a name="step-2-stabilize-files-that-will-be-replicated"></a>Шаг 2. Стабилизация файлы, которые будут реплицированы

Установив последнюю версию Robocopy на сервере, вам следует запретить заблокированные файлы блокировки Копировать с помощью методов, описанных в следующей таблице. Большинство приложений исключительно не блокировать файлы. Тем не менее во время обычной работы небольшой процент файлов может быть заблокирован на файловых серверах.

|Источник блокировки|Объяснение|Решение|
|---|---|---|
|Пользователи удаленно открывать файлы в общих папках.|Сотрудники соединиться с сервером стандартный файл и редактировать документы, мультимедиа или другие файлы. Иногда называют традиционных домашней папки или общих данных рабочих нагрузок.|Выполнять только операции Robocopy во время наименьшей нагрузки, нерабочего времени. Это сводит к минимуму количество файлов, которые необходимо пропустить Robocopy во время предварительно указать начальные значения.<br><br>Рассмотрите возможность временно установки только для чтения доступ к общим файловым ресурсам, которые будут реплицированы с помощью Windows PowerShell **Grant SmbShareAccess** и **SmbSession закрыть** командлетов. Если вы задаете разрешения для общей группы, например всех пользователей или пользователи, прошедшие проверку для чтения, обычных пользователей может быть менее вероятно, для открытия файлов с монопольными блокировками (если их приложения определять доступ только для чтения, при открытии файлов).<br><br>Можно также подумать о настройке правила брандмауэра временный для SMB-порт 445 входящего трафика к этому серверу, чтобы заблокировать доступ к файлам или использовать **SmbShareAccess блок** командлета. Тем не менее оба метода являются очень нарушать выполнение других операций пользователя.|
|Приложения откройте локальные файлы.|Приложение рабочих нагрузок, выполняющихся на файловом сервере, иногда блокировки файлов.|Временно отключите или удалите приложений, блокирующих файлы. Чтобы определить, какие приложения блокируют файлы, можно использовать Process Monitor или Process Explorer. Чтобы загрузить Process Monitor или Process Explorer, посетите [Process Monitor](https://docs.microsoft.com/sysinternals/downloads/procmon) и [Process Explorer](https://docs.microsoft.com/sysinternals/downloads/process-explorer) страниц.|

## <a name="step-3-copy-the-replicated-files-to-the-destination-server"></a>Шаг 3. Копирование реплицируемых файлов на конечный сервер

После можно свести к минимуму блокировки на файлы, которые будут реплицированы, можно предварительно заполнить файлы с исходного сервера на целевой сервер.

>[!NOTE]
>Robocopy можно запустить на конечном компьютере либо на исходном компьютере. Следующая процедура описывает выполнение Robocopy на конечном сервере, который обычно выполняется более поздней операционной системы, чтобы воспользоваться преимуществами любые дополнительные возможности Robocopy, которые могут предоставить более новой операционной системы.

### <a name="preseed-the-replicated-files-onto-the-destination-server-with-robocopy"></a>Предварительно заполнить реплицированные файлы на сервер назначения с помощью Robocopy

1. Войдите на целевой сервер с учетной записью, которая является членом локальной группы администраторов на исходном и конечном серверах.

2. Откройте командную строку с повышенными привилегиями.

3. Чтобы предварительно заполнив файлы из источника, целевой сервер, выполните следующую команду, заменив источника, назначения и пути к файлам журнала для значения в квадратных скобках:
    
    ```PowerShell
    robocopy "<source replicated folder path>" "<destination replicated folder path>" /e /b /copyall /r:6 /w:5 /MT:64 /xd DfsrPrivate /tee /log:<log file path> /v
    ```
    
    Эта команда копирует все содержимое папки исходных файлов в папке назначения, со следующими параметрами:
    
    |Параметр|Описание|
    |---|---|
    |"\<источника репликации путь к папке\>"|Указывает исходную папку для предварительно заполнив на целевом сервере.|
    |"\<назначения репликации путь к папке\>"|Указывает путь к папке, в которой будут храниться файлы preseeded.<br><br>Папка назначения не должен существовать на целевом сервере. Чтобы получить соответствующий хэши файлов, Robocopy необходимо создать корневую папку его preseeds файлы.|
    |/e|Копирует подкаталоги и их файлы, а также пустые подкаталоги.|
    |/b|Копирование файлов в режиме резервного копирования.|
    |/ COPYALL|Копирует все сведения о файлах, включая данные, атрибуты, отметки времени, список управления доступом NTFS (ACL), информация о владельце и информации аудита.|
    |/r:6|Повторяет операцию шесть раз, когда происходит ошибка.|
    |/w:5|Ожидает в течение 5 секунд между повторными попытками.|
    |MT:64|Копирует 64 файлов одновременно.|
    |/xd DfsrPrivate|Исключает папке DfsrPrivate.|
    |/TEE|Записывает выходные данные о состоянии, в окне консоли, а также в файл журнала.|
    |/ log \<путь к файлу журнала >|Определяет файл журнала для записи. Перезаписывает существующее содержимое файла. (Для добавления записи в существующий файл журнала, рекомендуется использовать `/log+ <log file path>`.)|
    |/v|Создает подробный вывод, который включает в себя пропущенные файлы.|
    
    Например, следующая команда реплицирует файлы из папки источника репликации, E:\\RF01 на диск данных D на конечном сервере:
    
    ```PowerShell
    robocopy.exe "\\srv01\e$\rf01" "d:\rf01" /e /b /copyall /r:6 /w:5 /MT:64 /xd DfsrPrivate /tee /log:c:\temp\preseedsrv02.log
    ```
    
    >[!NOTE]
    >Мы рекомендуем использовать параметры, описанные выше, при использовании Robocopy для предварительно заполнив файлов для репликации DFS. Тем не менее можно изменить некоторые из их значения или добавить дополнительные параметры. Например, вы может узнать через тестирование при наличии места, чтобы задать более высокое значение (число потоков) */MT* параметра. Кроме того, если в первую очередь будет происходить репликация файлы большего размера, можно повысить производительность копирования, добавив **/j** вариант для операций ввода-вывода без буферизации. Дополнительные сведения о параметрах Robocopy см. в разделе [Robocopy](https://docs.microsoft.com/windows-server/administration/windows-commands/robocopy) Справочник по командной строке.

    >[!WARNING]
    >Чтобы избежать возможной потери данных при использовании Robocopy для предварительно заполнив файлов для репликации DFS, не следует вносить следующие изменения в рекомендуемые параметры:
    >- Не используйте */MIR* параметра (, отражающую дереве папок) или */mov* параметра (который перемещает файлы, а затем удаляет их из источника).
    >-  Не удаляйте **/e**, **/b**, и **/COPYALL** параметры.

4. После завершения копирования, проверьте журнал на наличие ошибок и пропущенных файлов. Используйте Robocopy, чтобы скопировать все пропущенные файлы по отдельности, а не повторно копирует весь набор файлов. Если файлы были пропущены из-за монопольные блокировки, попробуйте скопировать отдельные файлы, с помощью Robocopy более поздней версии либо принять, что эти файлы требуются репликации по сети с помощью репликации DFS во время начальной синхронизации.

## <a name="next-step"></a>Дальнейшие действия

После завершения начальной копии и используйте Robocopy для устранения проблем с число пропущенных файлов максимально, будет использоваться **Get-DfsrFileHash** в Windows PowerShell или **Dfsrdiag** команды Проверьте preseeded файлы, сравнивая хэши файлов на исходном и конечном серверах. Подробные инструкции см. в разделе [шаг 2: Проверка Preseeded файлов для репликации DFS](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn495042(v%3dws.11)>).
