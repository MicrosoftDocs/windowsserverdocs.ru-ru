---
ms.assetid: 07d6b251-c492-4d9f-bcc4-031023695b24
title: Установка и включение дедупликации данных
ms.technology: storage-deduplication
ms.prod: windows-server
ms.topic: article
author: wmgries
manager: klaasl
ms.author: wgries
ms.date: 05/09/2017
description: Как установить компонент дедупликации данных в Windows Server, определить, подходит ли рабочая нагрузка для дедупликации и включить дедупликацию на томах.
ms.openlocfilehash: 82c55c12e7b5d5f60be7569ee2d7885daa6b6339
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "86953626"
---
# <a name="install-and-enable-data-deduplication"></a>Установка и включение дедупликации данных
> Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

В этой статье описано, как установить [дедупликацию данных](overview.md), оценить рабочие нагрузки для дедупликации, а также включить дедупликацию данных для отдельных томов.

> [!Note]  
> Если вы планируете использовать дедупликацию данных в отказоустойчивом кластере, на каждом узле кластера должна быть установлена роль сервера дедупликации данных.

## <a name="install-data-deduplication"></a><a id="install-dedup"></a>Установка дедупликации данных
> [!Important]  
> Обновление [KB4025334](https://support.microsoft.com/kb/4025334) содержит накопительный пакет исправлений, в том числе обеспечивающих надежность системы. Мы настоятельно рекомендуем установить его при использовании дедупликации данных в Windows Server 2016.

### <a name="install-data-deduplication-by-using-server-manager"></a><a id="install-dedup-via-server-manager"></a>Установка дедупликации данных с помощью диспетчера сервера
1. В мастере добавления ролей и компонентов выберите **Роли сервера**, а затем **Дедупликация данных**.  
![Установка дедупликации данных с помощью диспетчер сервера: выбор дедупликации данных из ролей сервера](media/install-dedup-via-server-manager-1.png)
2. Нажимайте кнопку **Далее**, пока не будет активирована кнопка **Установить**, а затем щелкните **Установить**.  
![Установка дедупликации данных с помощью диспетчер сервера. Нажмите кнопку "установить".](media/install-dedup-via-server-manager-2.png)

### <a name="install-data-deduplication-by-using-powershell"></a><a id="install-dedup-via-powershell"></a>Установка дедупликации данных с помощью PowerShell
Чтобы установить дедупликацию данных, выполните следующую команду PowerShell с правами администратора:  
`Install-WindowsFeature -Name FS-Data-Deduplication`

Чтобы установить дедупликацию данных на Nano Server:

1. Создайте установку Nano Server с установленным хранилищем, как описано в руководстве [Приступая к работе с сервером Nano Server](../../get-started/getting-started-with-nano-server.md).
2. На сервере под управлением Windows Server 2016 в любом режиме, отличном от Nano Server, или на персональном компьютере Windows с установленным пакетом [средств удаленного администрирования сервера](https://www.microsoft.com/download/details.aspx?id=45520) (RSAT) установите дедупликацию данных с явной ссылкой на экземпляр Nano Server (замените текст "MyNanoServer" реальным именем экземпляра Nano Server):  
    ```PowerShell
    Install-WindowsFeature -ComputerName <MyNanoServer> -Name FS-Data-Deduplication
    ```  
    <br />
    <strong>--ИЛИ--</strong>
    <br />
    Подключитесь к экземпляру Nano Server через систему удаленного взаимодействия PowerShell и установите дедупликацию данных с помощью DISM:  
    
    ```PowerShell
    Enter-PSSession -ComputerName MyNanoServer 
    dism /online /enable-feature /featurename:dedup-core /all
    ```

## <a name="enable-data-deduplication"></a><a id="enable-dedup"></a>Включение дедупликации данных
### <a name="determine-which-workloads-are-candidates-for-data-deduplication"></a><a id="enable-dedup-candidate-workloads"></a>Определение рабочих нагрузок для дедупликации
Дедупликация данных может очень эффективно снизить затраты, связанные с потреблением данных серверного приложения, уменьшая объем, занимаемый избыточными данными на дисках. Прежде чем включать дедупликацию, очень важно определить характеристики рабочей нагрузки. Это позволит добиться максимальной производительности хранилища. Существует два класса рабочих нагрузок, для которых стоит применять дедупликацию.

* *Рекомендуемые рабочие нагрузки* — используют наборы данных, для которых дедупликация крайне эффективна. Такие нагрузки также используют схемы потребления ресурсов, которые совместимы с моделью постобработки, применяемой при дедупликации данных. Для следующих рабочих нагрузок [включать дедупликацию данных](install-enable.md#enable-dedup-lights-on) рекомендуется всегда:
    * файловые серверы общего назначения (GPFS) с такими общими ресурсами, как общие групповые папки, домашние папки пользователей, рабочие папки и общие ресурсы для разработки программного обеспечения;
    * серверы инфраструктуры виртуальных рабочих столов (VDI);
    * Виртуализированные приложения резервного копирования, такие как [Microsoft Data Protection Manager (DPM)](/previous-versions/system-center/system-center-2012-R2/hh758173(v=sc.12)).
* Рабочие нагрузки, для которых дедупликация может дать преимущества, но только при соблюдении некоторых условий. При работе с такими нагрузками необходимо сначала оценить применимость и эффективность дедупликации. Примеры таких нагрузок:
    * узлы Hyper-V общего назначения;
    * Серверы SQL Server
    * производственные серверы.

### <a name="evaluate-workloads-for-data-deduplication"></a><a id="enable-dedup-evaluating-sometimes-workloads"></a>Оценка дедупликации данных для рабочих нагрузок
> [!Important]  
> Если вы используете рекомендуемые рабочие нагрузки, можно пропустить этот раздел и сразу [включить дедупликацию данных](install-enable.md#enable-dedup-lights-on).

Чтобы определить, применимость дедупликации для рабочей нагрузки, ответьте на следующие вопросы. Если вы не уверены в характеристиках рабочей нагрузки, можно выполнить пилотное развертывание дедупликации данных на тестовом наборе данных этой рабочей нагрузки.

1. **Есть ли в наборе данных рабочей нагрузки достаточный объем дублирующихся данных, чтобы включение дедупликации дало ощутимый эффект?**  
    Прежде чем включать дедупликацию данных для рабочей нагрузки, оцените объем дублирующихся данных в наборе данных, используя средство оценки экономии от дедупликации данных (DDPEval). После установки дедупликации данных это средство можно найти здесь: `C:\Windows\System32\DDPEval.exe`. DDPEval поможет вам оценить потенциальный эффект оптимизации для непосредственно подключенных томов (включая локальные диски или общие тома кластера), а также для сопоставленных или несопоставленных сетевых папок.  
    &nbsp;   
    При выполнении DDPEval.exe вы получите выходные данные следующего вида:  
    &nbsp;  
    `Data Deduplication Savings Evaluation Tool`  
    `Copyright 2011-2012 Microsoft Corporation.  All Rights Reserved.`    
    &nbsp;   
    `Evaluated folder: E:\Test`     
    `Processed files: 34`  
    `Processed files size: 12.03MB`  
    `Optimized files size: 4.02MB`  
    `Space savings: 8.01MB`  
    `Space savings percent: 66`  
    `Optimized files size (no compression): 11.47MB`  
    `Space savings (no compression): 571.53KB`  
    `Space savings percent (no compression): 4`  
    `Files with duplication: 2`  
    `Files excluded by policy: 20`  
    `Files excluded by error: 0`  

2. **Как выглядят шаблоны ввода-вывода рабочей нагрузки в наборе данных? Какова производительность для моей рабочей нагрузки?**  
     Дедупликация данных оптимизирует файлы, выполняя периодическое задание, а не во время сохранения файла на диск. В связи с этим сначала следует оценить ожидаемые шаблоны рабочей нагрузки на чтение из дедуплицированного тома. Поскольку дедупликация данных перемещает содержимое файла в хранилище блоков и пытается как можно плотнее заполнять его файлами, более эффективно будут выполняться операции чтения из последовательных диапазонов файла.  

    Рабочие нагрузки баз данных обычно имеют более случайный характер операций чтения, так как база данных не гарантирует оптимальную структуру данных для всех возможных выполняемых запросов. Данные из одного раздела хранилища блоков могут располагаться в разных частях тома, поэтому обращение к хранилищу данных может приводить к дополнительным задержкам. Высокопроизводительные рабочие нагрузки особенно чувствительны к таким задержкам, но это справедливо не для всех баз данных.

    > [!Note]  
    > Эти проблемы особенно важны для рабочих нагрузок, которые хранят данные на томах, состоящих из традиционных носителей с вращающимися дисками (жесткие диски или HDD). Любая инфраструктура флэш-памяти (твердотельные накопители или SSD) менее подвержена проблемам случайных операций ввода-вывода, так как флэш-память обеспечивает одинаковое время доступа ко всем расположениям на носителе. Таким образом, дедупликация будет сопряжена с разной величиной задержки при операциях чтения в зависимости от того, где хранятся наборы данных рабочей нагрузки: на носителях на основе флэш-памяти или на традиционных вращающихся дисках.

3. **Какие требования к ресурсам сервера предъявляет рабочая нагрузка?**  
    Так как дедупликация данных использует модель постобработки, она предполагает периодическое выделение значительных системных ресурсов для выполнения [оптимизации и других заданий](understand.md#job-info). Это означает, что рабочие нагрузки с определенными периодами простоя (например, в вечернее время или выходные дни) прекрасно подходят для дедупликации, в отличие от рабочих нагрузок, выполняемых круглосуточно изо дня в день. Но при этом дедупликацию можно успешно применить и для рабочих нагрузок без периодов простоя, если такие нагрузки не имеют высоких требований к ресурсам сервера.

### <a name="enable-data-deduplication"></a><a id="enable-dedup-lights-on"></a>Включение дедупликации данных
Перед включением дедупликации данных следует выбрать [тип использования](understand.md#usage-type), который соответствует вашей рабочей нагрузке. Существует три типа использования для дедупликации данных:

* [По умолчанию](understand.md#usage-type-default) — оптимальные настройки для файлового сервера общего назначения.
* [Hyper-V](understand.md#usage-type-hyperv) — настройки специально для серверов VDI.
* [Резервное копирование](understand.md#usage-type-backup) — оптимальные настройки для виртуализированных приложений резервного копирования, таких как [Microsoft DPM](/previous-versions/system-center/system-center-2012-R2/hh758173(v=sc.12)).

#### <a name="enable-data-deduplication-by-using-server-manager"></a><a id="enable-dedup-via-server-manager"></a>Включение дедупликации данных с помощью диспетчера сервера
1. Выберите **службы файлов и хранилища** в Диспетчер сервера.  
![Щелкните "Файловые службы и службы хранилища".](media/enable-dedup-via-server-manager-1.PNG)
2. Во всплывающем меню **Файловые службы и службы хранилища** выберите **Тома**.  
![Выбор "Тома"](media/enable-dedup-via-server-manager-2.png)
3. Щелкните правой кнопкой мыши нужный том и выберите пункт **Настройка дедупликации данных**.  
![Выберите пункт "Настройка дедупликации данных".](media/enable-dedup-via-server-manager-3.png)
4. Выберите в раскрывающемся списке нужный **тип использования** и нажмите **ОК**.  
![Выберите нужный тип использования в раскрывающемся списке.](media/enable-dedup-via-server-manager-4.png)
5. Если вы используете рекомендуемую рабочую нагрузку, на этом процесс окончен. Для других рабочих нагрузок изучите раздел [Дополнительные вопросы](#enable-dedup-sometimes-considerations).

> [!Note]  
> Дополнительные сведения об исключении определенных расширений файлов или папок, а также о создании расписания дедупликации (включая описание причин этих изменений), см. на странице [Настройка дедупликации данных](advanced-settings.md).

#### <a name="enable-data-deduplication-by-using-powershell"></a><a id="enable-dedup-via-powershell"></a>Включение дедупликации данных с помощью PowerShell
1. Выполните следующую команду PowerShell с правами администратора:  
    ```PowerShell
    Enable-DedupVolume -Volume <Volume-Path> -UsageType <Selected-Usage-Type>
    ```

2. Если вы используете рекомендуемую рабочую нагрузку, на этом процесс окончен. Для других рабочих нагрузок изучите раздел [Дополнительные вопросы](#enable-dedup-sometimes-considerations).

> [!Note]  
> Командлеты PowerShell для дедупликации данных, включая [`Enable-DedupVolume`](/previous-versions/system-center/system-center-2012-R2/hh758173(v=sc.12)) , можно запустить удаленно, добавив `-CimSession` параметр в сеанс CIM. Это особенно полезно для удаленного выполнения командлетов PowerShell на экземпляре Nano Server. Чтобы создать новый сеанс CIM, выполните команду [`New-CimSession`](/previous-versions/system-center/system-center-2012-R2/hh758173(v=sc.12)) .

#### <a name="other-considerations"></a><a id="enable-dedup-sometimes-considerations"></a>Дополнительные рекомендации
> [!Important]  
> Если ваша рабочая нагрузка относится к категории рекомендуемых, этот раздел можно пропустить.

* Типы использования, доступные при дедупликации данных, предусматривают практические стандартные значения для рекомендуемых рабочих нагрузок, а также используются в качестве отправной точки для остальных рабочих нагрузок. Для рабочих нагрузок, не входящих в категорию рекомендуемых, вы можете изменить [дополнительные параметры дедупликации данных](advanced-settings.md), чтобы повысить ее эффективность.
* Если рабочая нагрузка характеризуется высокими требованиями к ресурсам сервера, задания дедупликации данных [следует запланировать на период ожидаемого простоя рабочей нагрузки](advanced-settings.md#modifying-job-schedules-change-schedule). Это особенно важно, если дедупликация выполняется на гиперконвергированном узле, ведь в рабочее время процессы дедупликации могут истощить ресурсы виртуальных машин.
* Если рабочая нагрузка не особо требовательна к ресурсам или быстрое выполнение заданий оптимизации важнее, чем обслуживание запросов рабочей нагрузки, [вы можете настроить параметры выделения памяти, ЦП и приоритета для заданий дедупликации](advanced-settings.md#modifying-job-schedules).

## <a name="frequently-asked-questions-faq"></a><a id="faq"></a>Часто задаваемые вопросы
**Я хочу выполнить дедупликацию данных в наборе данных для рабочей нагрузки X. Поддерживается ли это?**  
Мы полностью гарантируем целостность данных при применении дедупликации данных с любой рабочей нагрузкой, кроме включенных в [список несовместимых с дедупликацией](interop.md). Для рекомендуемых рабочих нагрузок корпорация Майкрософт также гарантирует повышение производительности. Производительность других рабочих нагрузок в значительной мере зависит от того, какие действия они выполняют на сервере. Необходимо определить, каким образом дедупликация данных повлияла на вашу рабочую нагрузку и допустимо ли такое влияние для этой нагрузки.

**Каковы требования к размеру тома для дедуплицированных томов?**  
В Windows Server 2012 и Windows Server 2012 R2 размер тома следует выбирать осторожно, чтобы дедупликация данных выполнялась в соответствии со скоростью обновления данных в томе. В большинстве случаев максимальный размер дедуплицированного тома для рабочей нагрузки с высокой скоростью обновления данных составляет 1–2 ТБ. Мы рекомендуем в любом случае не превышать размер 10 ТБ. Эти ограничения устранены в Windows Server 2016. Дополнительные сведения см. в статье [Новые возможности функции дедупликации данных](whats-new.md#large-volume-support).

**Нужно ли изменять расписание или другие параметры дедупликации данных для рекомендуемых рабочих нагрузок?**  
Нет, предоставленные [типы использования](understand.md#usage-type) были созданы для предоставления разумных значений по умолчанию для рекомендуемых рабочих нагрузок.

**Каковы требования к памяти для дедупликации данных?**  
При дедупликации данных следует выделить по меньшей мере 300 МБ, а также дополнительно 50 МБ на каждый терабайт логических данных. Например, если вы оптимизируете том размером 10 ТБ, для дедупликации следует выделить не менее 800 МБ памяти (`300 MB + 50 MB * 10 = 300 MB + 500 MB = 800 MB`). Дедупликация данных может выполняться и с меньшим объемом памяти, но такое ограничение ресурсов замедлит выполнение заданий этой функции.

Лучше всего, если для дедупликации данных будет выделено по 1 ГБ памяти на каждый 1 ТБ логических данных. Например, если вы оптимизируете том размером 10 ТБ, оптимальный объем памяти для дедупликации составит 10 ГБ (`1 GB * 10`). Такое соотношение обеспечит максимальную производительность для заданий дедупликации данных.

**Каковы требования к объему хранилища для дедупликации данных?**  
В Windows Server 2016 дедупликация данных может поддерживать тома размером до 64 ТБ. Дополнительные сведения см. в статье [What's new in Data Deduplication](whats-new.md#large-volume-support) (Новые возможности функции дедупликации данных).
