---
title: Развертывание перенаправления папок с помощью автономных файлов
description: Использование Windows Server для развертывания перенаправления папок с помощью автономных файлов на клиентских компьютерах Windows.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: e8e6e5a29c75c117f6faa3c1d1b3f288582d81a2
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "80855887"
---
# <a name="deploy-folder-redirection-with-offline-files"></a>Развертывание перенаправления папок с помощью автономных файлов

>Применяется к: Windows 10, Windows 7, Windows 8, Windows 8.1, Windows Vista, Windows Server 2019, Windows Server 2016, Windows Server 2012, Windows Server 2012 R2, Windows Server 2008 R2, Windows Server (Semi-annual Channel).

В этой статье описывается, как использовать Windows Server для развертывания перенаправления папок с помощью автономных файлов на клиентских компьютерах Windows.

Список последних изменений для этой статьи см. в разделе [Журнал изменений](#change-history).

> [!IMPORTANT]
> Из-за изменений в системе безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016), мы обновили [Шаг 3. Создание объекта групповой политики (GPO) для перенаправления папок](#step-3-create-a-gpo-for-folder-redirection) этой статьи, чтобы Windows правильно применила политику перенаправления папок (не отменяя перенаправленные папки на затронутых компьютерах).

## <a name="prerequisites"></a>Предварительные условия

### <a name="hardware-requirements"></a>Требования к оборудованию

Для использования перенаправления папок требуется компьютер с процессором на базе архитектуры x64 или x86. Эта функция не поддерживается в Windows&reg; RT.

### <a name="software-requirements"></a>Требования к программному обеспечению

Для использования перенаправления папок действуют следующие программные требования.

- Для администрирования перенаправления папок вам потребуется войти в систему в качестве члена группы безопасности "Администраторы домена", "Администраторы предприятия" или "Владельцы-создатели групповой политики".
- Клиентские компьютеры должны работать под управлением Windows 10, Windows 8.1, Windows 8, Windows 7, Windows Server 2019, Windows Server 2016, Windows Server (Semi-annual Channel), Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008.
- Компьютеры клиентов должны быть присоединены к доменным службам Active Directory (AD DS), которыми вы управляете.
- На компьютере должны быть установлены компоненты "Управление групповой политикой" и "Центр администрирования Active Directory".
- Файловый сервер должен поддерживать перенаправленные папки.
    - Если общая папка использует пространства имен DFS, у папок DFS (ссылок) должен быть один целевой объект, чтобы избежать конфликтов серверов при изменении настроек пользователем.
    - Если общая папка использует репликацию DFS для копирования данных на другой сервер, пользователи должны иметь доступ лишь к исходному серверу, чтобы избежать конфликтов при изменении параметров серверов.
    - При использовании кластеризованной общей папки устраните непрерывную доступность в общей папке, чтобы избежать проблем с производительностью при перенаправлении папок и использовании автономных файлов. Кроме того, автономные файлы могут не переходить в автономный режим 3–6 минут после того, как пользователь утратит доступ к непрерывно доступной общей папке, что может запутать пользователей, еще не использующих постоянный автономный режим для автономных файлов.

> [!NOTE]
> Некоторые новые возможности перенаправления папок предусматривают дополнительные требования к клиентскому компьютеру и Active Directory. Дополнительные сведения см. в статьях [Deploy primary computers](deploy-primary-computers.md) (Развертывание основных компьютеров), [Disable Offline Files on folders](disable-offline-files-on-folders.md) (Отключение функции "Автономные файлы" в папках), [Enable Always Offline mode](enable-always-offline.md) (Включение постоянного автономного режима) и [Enable optimized folder moving](enable-optimized-moving.md) (Включение оптимизированного перемещения папок).

## <a name="step-1-create-a-folder-redirection-security-group"></a>Шаг 1. Создание группы безопасности перенаправления папок

Если в вашей среде еще не настроено перенаправление папок, в первую очередь необходимо создать группу безопасности, включающую всех пользователей, для которых вы хотите применить настройки политики перенаправления папок.

Вот как создать группу безопасности для перенаправления папок.

1. Откройте диспетчер сервера на компьютере с установленным Центром администрирования Active Directory.
2. В меню **Инструменты** щелкните **Active Directory Administration Center** (Центр администрирования Active Directory). Отобразится центр администрирования Active Directory.
3. Щелкните правой кнопкой мыши необходимый домен или подразделение и последовательно выберите элементы **Создать**, **Группа**.
4. В окне **Создание группы** в разделе **Группа** укажите следующие параметры.
    - В поле **Имя группы** введите имя группы безопасности, например **Пользователи перенаправления папок**.
    - В разделе **Область действия группы** щелкните элемент **Безопасность**, а затем элемент **Глобальная**.
5. В разделе **Участники** щелкните элемент **Добавить**. Откроется диалоговое окно "Выбор пользователей, контактов, компьютеров, учетных записей служб или групп".
6. Укажите имена пользователей или групп, для которых хотите развернуть перенаправление папок, щелкните **ОК**, после чего еще раз щелкните **ОК**.

## <a name="step-2-create-a-file-share-for-redirected-folders"></a>Шаг 2. Создание общей папки для перенаправляемых папок

Если у вас еще нет такой папки, чтобы создать ее на сервере Windows Server 2012, выполните действия ниже.

> [!NOTE]
> Если вы создаете общую папку на сервере под управлением другой версии Windows Server, некоторые функции могут отличаться или быть недоступны.

Вот как создать общую папку на сервере Windows Server 2019, Windows Server 2016 или Windows Server 2012.

1. В области навигации диспетчера серверов щелкните элемент **Файловые службы и службы хранилища**, а затем элемент **Общие папки**, чтобы перейти на страницу общих папок.
2. На плитке **Общие папки** щелкните элемент **Задачи**, а затем — **Новая общая папка**. Откроется мастер создания общих ресурсов.
3. На странице **Выберите профиль** щелкните **SMB Share – Quick** (Общая папка SMB — быстрый профиль). Если у вас установлен диспетчер ресурсов файлового сервера и вы используете свойства управления папками, вместо этого выберите пункт **Общая папка SMB — дополнительные**.
4. На странице **Расположение общего ресурса** выберите сервер и том, в котором хотите создать общий ресурс.
5. На странице **Имя общей папки** укажите имя (например, **Users$** ) в поле **Имя общей папки**.
    >[!TIP]
    >При создании общей папки необходимо скрыть ее, добавив после имени символ ```$```. Это предотвратит доступ к нему случайных веб-обозревателей.
6. На странице **Другие параметры** снимите флажок параметра Enable continuous availability (Включить постоянную доступность на этом клиенте), если он установлен, и при необходимости установите флажки **Включить перечисление на основе доступа** и **Encrypt data access** (Шифровать доступ к данным).
7. На странице **Разрешения** щелкните элемент **Настройка разрешений доступа…** . Отобразится диалоговое окно с расширенными параметрами безопасности.
8. Нажмите кнопку **Отключение наследования**, а затем щелкните элемент **Convert inherited permissions into explicit permission on this object** (Преобразовать наследуемые разрешения для объекта в явные).
9. Установите разрешения, как описано в таблице 1 и показано на рисунке 1: удалите разрешения для неуказанных групп и учетных записей, а также добавьте специальные разрешения для группы пользователей перенаправления папок, созданной на шаге 1.
    
    ![Установка разрешений для общих перенаправленных папок](media/deploy-folder-redirection/setting-the-permissions-for-the-redirected-folders-share.png)
    
    **Рисунок 1.** Установка разрешений для общих перенаправленных папок
10. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Свойства управления** установите для параметра "Использование папки" значение **Файлы пользователя** .
11. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Квота** вы можете при необходимости выбрать квоту, которая будет распространяться на пользователей общего ресурса.
12. На странице **Подтверждение** щелкните элемент **Создать**.

### <a name="required-permissions-for-the-file-share-hosting-redirected-folders"></a>Необходимые разрешения для общей папки, в которой размещены перенаправленные папки

| Учетная запись пользователя  | Доступ  | Область применения  |
| --------- | --------- | --------- |
| Учетная запись пользователя | Доступ | Область применения |
| Система     | Полный доступ        |    Данная папка, вложенные папки и файлы     |
| Администраторы     | Полный доступ       | Только эта папка        |
| Создатель/владелец     |   Полный доступ      |   Только вложенные папки и файлы      |
| Группа безопасности пользователей, которым требуется обеспечить общий доступ к данным (пользователи перенаправления папок)     |   Содержание папки, чтение данных *(Дополнительные разрешения)* <p>Создание папок, добавление данных *(Дополнительные разрешения)* <p>Чтение атрибутов *(Дополнительные разрешения)* <p>Чтение дополнительных атрибутов *(Дополнительные разрешения)* <p>Разрешения на чтение *(Дополнительные разрешения)*      |  Только эта папка       |
| Прочие группы и учетные записи     |  Нет (удаление)       |         |

## <a name="step-3-create-a-gpo-for-folder-redirection"></a>Шаг 3. Создание GPO для перенаправления папок

Если у вас еще нет GPO для параметров перенаправления папок, выполните описанные ниже действия.

Вот как создать GPO для перенаправления папок.

1. Откройте диспетчер сервера на компьютере с установленным компонентом управления групповой политикой.
2. В меню **Средства** щелкните элемент **Управление групповой политикой**.
3. Правой кнопкой мыши щелкните домен или организационное подразделение, в котором необходимо настроить перенаправление папок, затем нажмите **Create a GPO in this domain, and Link it here** (Создать объект групповой политики в этом домене и связать его).
4. В диалоговом окне **Новый объект групповой политики** укажите имя (например, **Настройки перенаправления папок**) и нажмите кнопку **OК**.
5. Щелкните правой кнопкой мыши по новому объекту групповой политики и уберите флажок **Связь включена** . Это исключит применение GPO до завершения его настройки.
6. Выберите GPO. В разделе **Фильтрация ограничений безопасности** на вкладке **Область** выберите пункт **Прошедшие проверку** и нажмите кнопку **Удалить**, чтобы исключить применение GPO ко всем пользователям.
7. В разделе **Фильтрация ограничений безопасности** щелкните элемент **Добавить**.
8. В диалоговом окне **Select User, Computer, or Group** (Выбор пользователей, компьютеров или групп) укажите имя группы безопасности, которую вы создали на шаге 1 (например, **Пользователи перенаправления папок**), а затем нажмите кнопку **OК**.
9. Перейдите на вкладку **Делегирование**, намите кнопку **Добавить**, введите **Прошедшие проверку**, нажмите кнопку **ОК**, а затем снова нажмите **ОК**, чтобы применить разрешения на чтение по умолчанию.
    
    Этот шаг необходим из-за изменений в системе безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016).

> [!IMPORTANT]
> В связи с этим необходимо предоставить группе [Прошедшие проверку](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016) делегированные разрешения на чтение GPO перенаправления папок. В противном случае GPO не будет применен к пользователям или, если уже применен, GPO будет удален, а перенаправленные папки вернутся на локальный компьютер. Дополнительные сведения об изменениях в развертывании GPO, внесенных в MS16-072, см. [здесь](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/).

## <a name="step-4-configure-folder-redirection-with-offline-files"></a>Шаг 4. Настройка перенаправления папок с помощью автономных файлов

После создания GPO для параметров перенаправления папок измените параметры групповой политики, включив и настроив перенаправление папок, как описано ниже.

> [!NOTE]
> Функция "Автономные файлы" включена по умолчанию для перенаправленных папок на клиентских компьютерах Windows и отключена на компьютерах под управлением Windows Server, если пользователь не вносил изменения. Чтобы использовать групповую политику для управления включением функции "Автономные файлы", задействуйте параметр политики **Разрешить или запретить использование автономных файлов**.
> Дополнительные сведения о некоторых других параметрах групповой политики для автономных файлов см. в статьях [Enable Advanced Offline Files Functionality](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn270369(v%3dws.11)>) (Включение расширенных функциональных возможностей автономных файлов) и [Configuring Group Policy for Offline Files](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc759721(v%3dws.10)>) (Настройка групповой политики для автономных файлов).

Вот как настроить перенаправление папок в групповой политике.

1. В компоненте "Управление групповыми политиками" щелкните правой кнопкой мыши GPO, который вы создали (например, **Настройки перенаправления папок**), затем выберите команду **Изменить**.
2. В окне редактора "Управление групповыми политиками" выберите **Конфигурация пользователя**, **Политики**, **Параметры Windows**, **Перенаправление папок**.
3. Щелкните правой кнопкой мыши папку, которую требуется перенаправить (например, **Документы**), а затем выберите пункт **Свойства**.
4. В диалоговом окне **Свойства** в поле **Настройка** выберите значение **Перенаправлять папки всех пользователей в одно расположение (простая)** .

    > [!NOTE]
    > Чтобы применить перенаправление папок к клиентским компьютерам под управлением Windows XP или Windows Server 2003, перейдите на вкладку **Настройка** и установите флажок **Также применить политику перенаправления для операционных систем Windows 2000, Windows 2000 Server, Windows XP и Windows Server 2003**.

5. В разделе **Расположение целевой папки** щелкните **Создать папку для каждого пользователя на корневом пути**, а затем в поле **Корневой путь** введите путь к общей папке, в которой хранятся перенаправленные папки, например: **\\\\fs1.corp.contoso.com\\users$** .
6. Перейдите на вкладку **Параметры** и в разделе **Удаление политики** при необходимости выберите элемент **После удаления политики перенаправить папку обратно в локальный профиль пользователя** (это сделает перенаправление папок более предсказуемым для администраторов и пользователей).
7. Нажмите кнопку **OК**, а затем в диалоговом окне предупреждения нажмите кнопку **Да**.

## <a name="step-5-enable-the-folder-redirection-gpo"></a>Шаг 5. Включение GPO перенаправления папок

Когда вы завершите настройку групповой политики перенаправления папок, следующим шагом будет включение GPO и его применение к затрагиваемым пользователям.

> [!TIP]
> Если вы планируете задействовать поддержку основного компьютера или другие настройки политики, это следует сделать до включения GPO, чтобы предотвратить копирование данных пользователя на неосновные компьютеры до включения поддержки основного компьютера.

Вот как включить GPO перенаправления папок.

1. Откройте "Управление групповой политикой".
2. Щелкните правой кнопкой мыши созданный вами GPO и выберите пункт **Связь включена**. Рядом с соответствующим пунктом меню появится флажок.

## <a name="step-6-test-folder-redirection"></a>Шаг 6. Тестирование перенаправления папок

Чтобы проверить перенаправление папок, войдите на компьютер, используя учетную запись пользователя, для которого настроено перенаправление папок. После этого убедитесь, что папки и профили перенаправляются.

Вот как проверить перенаправление папок.

1. Войдите в систему на основном компьютере (если вы включили поддержку основного компьютера) при помощи учетной записи пользователя, для которого вы настроили перенаправление папок.
2. Если пользователь уже вошел в систему, откройте командную строку с повышенными привилегиями и введите нижеприведенную команду, чтобы убедиться, что на компьютере используются последние настройки групповой политики.
    
    ```PowerShell
    gpupdate /force
    ```
3. Откройте проводник.
4. Щелкните правой кнопкой мыши перенаправленную папку (например, "Мои документы" в библиотеке документов) и выберите пункт **Свойства**.
5. Перейдите на вкладку **Местоположение** и убедитесь, что отображается путь к указанной общей папке, а не локальный путь.

## <a name="appendix-a-checklist-for-deploying-folder-redirection"></a>Приложение A. Контрольный список для развертывания перенаправления папок

| Состояние           | Действие |
| ---              | ---    |
| ☐<br>☐<br>☐    | 1. Подготовка домена<br>— Присоединение компьютеров к домену<br>— Создание учетных записей пользователей |
| ☐<br><br><br>   | 2. Создание группы безопасности для перенаправления папок<br>— Имя группы:<br>— Члены: |
| ☐<br><br>       | 3. Создание общей папки для перенаправляемых папок<br>— Имя общей папки: |
| ☐<br><br>       | 4. Создание GPO для перенаправления папок<br>— Имя GPO: |
| ☐<br><br>☐<br>☐<br>☐<br>☐<br>☐ | 5. Настройка параметров политики для перенаправления папок и автономных файлов<br>— Перенаправленные папки:<br>— Включена ли поддержка Windows 2000, Windows XP и Windows Server 2003?<br>— Включена ли функция "Автономные файлы"? (по умолчанию включена на клиентских компьютерах Windows)<br>— Включен ли постоянный автономный режим?<br>— Включена ли фоновая синхронизация файлов?<br>— Включено ли оптимизированное перемещение перенаправленных папок? |
| ☐<br><br>☐<br><br>☐<br>☐ | 6. Включение поддержки основного компьютера (необязательно)<br>— На основе компьютеров или на основе пользователей?<br>— Назначение основных компьютеров для пользователей<br>— Расположение сопоставлений пользователей и основных компьютеров:<br>— Включение поддержки основного компьютера для переназначения папок (необязательно)<br>— Включение поддержки основного компьютера для перемещаемых профилей пользователей (необязательно) |
| ☐         | 7. Включение GPO перенаправления папок |
| ☐         | 8. Тестирование перенаправления папок |

## <a name="change-history"></a>Журнал изменений

В следующей таблице представлены наиболее важные изменения этого раздела.

| Дата | Описание | Причина|
| --- | --- | --- |
| 18 января 2017 г. | Добавлен [Шаг 3. Создание объекта групповой политики для перенаправления папок](#step-3-create-a-gpo-for-folder-redirection), чтобы делегировать разрешения на чтение пользователям, прошедшим проверку подлинности, что необходимо из-за изменений в безопасности для групповой политики. | Отзывы клиентов |

## <a name="more-information"></a>Дополнительные сведения

* [Folder Redirection, Offline Files, and Roaming User Profiles](folder-redirection-rup-overview.md) (Общие сведения о перенаправлении папок, автономных файлах и перемещаемых профилях пользователей)
* [Развертывание основных компьютеров для перенаправления папок и использования перемещаемых профилей пользователей](deploy-primary-computers.md)
* [Enable Advanced Offline Files Functionality](enable-always-offline.md) (Включение расширенных функциональных возможностей автономных файлов)
* [Microsoft's Support Statement Around Replicated User Profile Data](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/) (Заявление корпорации Майкрософт о поддержке реплицированных данных профилей пользователей)
* [Sideload Apps with DISM](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>) (Загрузка неопубликованных приложений с помощью DISM)
* [Troubleshooting packaging, deployment, and query of Windows Runtime-based apps](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx) (Устранение проблем с упаковкой, развертыванием и запросами приложений среды выполнения Windows)
