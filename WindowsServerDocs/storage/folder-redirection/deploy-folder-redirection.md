---
title: Развертывание перенаправления папок с помощью автономные файлы
description: Использование Windows Server для развертывания перенаправления папок с автономные файлы на клиентские компьютеры Windows.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: 90b3e3d0b5030f8c0140e54c8b0bf55317437427
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70867313"
---
# <a name="deploy-folder-redirection-with-offline-files"></a>Развертывание перенаправления папок с помощью автономные файлы

>Относится к: Windows 10, Windows 7, Windows 8, Windows 8.1, Windows Vista, Windows Server 2019, Windows Server 2016, Windows Server 2012, Windows Server 2012 R2, Windows Server 2008 R2, Windows Server (половина ежегодного канала)

В этом разделе описывается, как использовать Windows Server для развертывания перенаправления папок с автономные файлы на клиентские компьютеры Windows.

Список недавних изменений этого раздела см. в разделе [Журнал изменений](#change-history).

> [!IMPORTANT]
> Из-за изменений в системе безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016), мы обновили [шаг 3. Создайте объект групповой политики для перенаправления](#step-3-create-a-gpo-for-folder-redirection) папок этого раздела, чтобы операционная система Windows могла правильно применить политику перенаправления папок (а не восстановить перенаправленные папки на затронутых компьютерах).

## <a name="prerequisites"></a>Предварительные требования

### <a name="hardware-requirements"></a>Требования к оборудованию

Для перенаправления папок требуется компьютер на базе x64 или x86. она не поддерживается Windows® RT.

### <a name="software-requirements"></a>Требования к программному обеспечению

Перенаправление папок имеет следующие требования к программному обеспечению.

- Для администрирования перенаправления папок необходимо войти в систему от имени члена группы безопасности Администраторы домена, группы безопасности Администраторы предприятия или группы безопасности создателей групповая политика.
- Клиентские компьютеры должны работать под управлением Windows 10, Windows 8.1, Windows 8, Windows 7, Windows Server 2019, Windows Server 2016, Windows Server (половина ежегодного канала), Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008.
- Компьютеры клиентов должны быть присоединены к доменным службам Active Directory (AD DS), которыми вы управляете.
- На компьютере должны быть установлены компоненты "Управление групповой политикой" и "Центр администрирования Active Directory".
- Файловый сервер должен быть доступен для перенаправленных папок узла.
    - Если общая папка использует пространства имен DFS, у папок DFS (ссылок) должен быть один целевой объект, чтобы избежать конфликтов серверов при изменении настроек пользователем.
    - Если общая папка использует репликацию DFS для копирования данных на другой сервер, пользователи должны иметь доступ лишь к исходному серверу, чтобы избежать конфликтов при изменении параметров серверов.
    - При использовании кластеризованного файлового ресурса Отключите постоянную доступность в общей папке, чтобы избежать проблем с производительностью при перенаправлении папок и автономные файлы. Кроме того, автономные файлы может не переходить в автономный режим в течение 3-6 минут после того, как пользователь теряет доступ к постоянно доступной общей папке, что может привести к невозможности использовать режим "всегда автономный" автономные файлы.

> [!NOTE]
> Некоторые новые функции перенаправления папок имеют дополнительные требования к клиентскому компьютеру и Active Directory схеме. Дополнительные сведения см. в статьях [Развертывание основных компьютеров](deploy-primary-computers.md), [Отключение автономные файлы в папках](disable-offline-files-on-folders.md), [Включение режима "всегда автономный режим](enable-always-offline.md)" и [Включение оптимизированного перемещения папок](enable-optimized-moving.md).

## <a name="step-1-create-a-folder-redirection-security-group"></a>Шаг 1. Создание группы безопасности перенаправления папок

Если в вашей среде еще не настроено перенаправление папок, сначала необходимо создать группу безопасности, содержащую всех пользователей, к которым необходимо применить параметры политики перенаправления папок.

Вот как можно создать группу безопасности для перенаправления папок:

1. Откройте диспетчер сервера на компьютере с установленным центром администрирования Active Directory.
2. В меню **Сервис** выберите **Active Directory центр администрирования**. Отобразится центр администрирования Active Directory.
3. Щелкните правой кнопкой мыши соответствующий домен или подразделение, выберите **создать**, а затем выберите **Группа**.
4. В окне **Создание группы** в разделе **Группа** укажите следующие параметры.
    - В поле **Имя группы** введите имя группы безопасности, например **Пользователи перенаправления папок**.
    - В **области групп**выберите **Безопасность**, а затем выберите **Глобальная**.
5. В разделе **члены** выберите **Добавить**. Откроется диалоговое окно "Выбор пользователей, контактов, компьютеров, учетных записей служб или групп".
6. Введите имена пользователей или групп, для которых требуется развернуть перенаправление папок, нажмите кнопку **ОК**, а затем еще раз нажмите кнопку **ОК** .

## <a name="step-2-create-a-file-share-for-redirected-folders"></a>Шаг 2. Создание общей папки для перенаправленных папок

Если у вас еще нет общей папки для перенаправленных папок, используйте следующую процедуру, чтобы создать общую папку на сервере под Windows Server 2012.

> [!NOTE]
> Если вы создаете файловый ресурс на сервере под управлением другой версии Windows Server, некоторые функции могут отличаться или быть недоступны.

Вот как можно создать общую папку на Windows Server 2019, Windows Server 2016 и Windows Server 2012:

1. В области навигации диспетчер сервера выберите **файл и службы хранилища**, а затем щелкните **Общие папки** , чтобы отобразить страницу Общие ресурсы.
2. На плитке **Общие ресурсы** выберите **задачи**, а затем щелкните **создать общую папку**. Откроется мастер создания общих ресурсов.
3. На странице **Выбор профиля** выберите **общий ресурс SMB — Быстрая**. Если файловый сервер диспетчер ресурсов установлен и использует свойства управления папками, выберите **общий ресурс SMB — дополнительно**.
4. На странице **Расположение общего ресурса** выберите сервер и том, в котором хотите создать общий ресурс.
5. На странице **имя общего ресурса** введите имя общей папки (например, **Users $** ) в поле **имя общего ресурса** .
    >[!TIP]
    >При создании общего ресурса скройте его, поместив ```$``` после имени общего ресурса. Это приведет к скрытию общей папки от обычных браузеров.
6. На странице **другие параметры** снимите флажок Включить постоянную доступность, если он есть, и при необходимости установите флажки **включить перечисление на основе доступа** и **шифровать доступ к данным** .
7. На странице **разрешения** выберите **Настройка разрешений...** . Отобразится диалоговое окно с расширенными параметрами безопасности.
8. Выберите **отключить наследование**, а затем выберите **преобразовать унаследованные разрешения в явное разрешение для этого объекта**.
9. Задайте разрешения, как описано в таблице 1 и показано на рис. 1, удаление разрешений для групп и учетных записей, а также добавление специальных разрешений для группы Пользователи перенаправления папок, созданной на шаге 1.
    
    ![Настройка разрешений для общей папки перенаправленных папок](media/deploy-folder-redirection/setting-the-permissions-for-the-redirected-folders-share.png)
    
    **Рис. 1** Настройка разрешений для общей папки перенаправленных папок
10. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Свойства управления** установите для параметра "Использование папки" значение **Файлы пользователя** .
11. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Квота** вы можете при необходимости выбрать квоту, которая будет распространяться на пользователей общего ресурса.
12. На странице **Подтверждение** нажмите кнопку **создать.**

### <a name="required-permissions-for-the-file-share-hosting-redirected-folders"></a>Необходимые разрешения для файлового ресурса, на котором размещены перенаправленные папки

| Учетная запись пользователя  | Access  | Применение  |
| --------- | --------- | --------- |
| Учетная запись пользователя | Access | Применение |
| Система     | Полный доступ        |    Данная папка, вложенные папки и файлы     |
| Администраторы     | Полный доступ       | Только эта папка        |
| Создатель/владелец     |   Полный доступ      |   Только вложенные папки и файлы      |
| Группа безопасности пользователей, которым необходимо разместить данные общего ресурса (пользователи перенаправления папок)     |   Список папок/чтение данных *(дополнительные разрешения)* <br /><br />Создание папок/Добавление данных *(дополнительные разрешения)* <br /><br />Чтение атрибутов *(дополнительные разрешения)* <br /><br />Чтение расширенных атрибутов *(дополнительные разрешения)* <br /><br />Разрешения на чтение *(дополнительные разрешения)*      |  Только эта папка       |
| Прочие группы и учетные записи     |  Нет (удаление)       |         |

## <a name="step-3-create-a-gpo-for-folder-redirection"></a>Шаг 3. Создание объекта групповой политики для перенаправления папок

Если у вас еще нет объекта групповой политики, созданного для параметров перенаправления папок, используйте следующую процедуру, чтобы создать ее.

Вот как создать объект групповой политики для перенаправления папок:

1. Откройте диспетчер сервера на компьютере с установленным компонентом управления групповой политикой.
2. В меню **Сервис** выберите пункт **Управление Групповая политика**.
3. Щелкните правой кнопкой мыши домен или подразделение, в котором нужно настроить перенаправление папок, а затем выберите **создать объект GPO в этом домене и свяжите его**.
4. В диалоговом окне **Создание объекта групповой политики** введите имя объекта групповой политики (например, **Параметры перенаправления папок**), а затем нажмите кнопку **ОК**.
5. Щелкните правой кнопкой мыши по новому объекту групповой политики и уберите флажок **Связь включена** . Это исключит применение GPO до завершения его настройки.
6. Выберите GPO. В разделе **Фильтрация безопасности** на вкладке **область** выберите **прошедшие проверку пользователи**и нажмите кнопку **Удалить** , чтобы объект групповой политики не применялся ко всем.
7. В разделе **Фильтрация безопасности** выберите **Добавить**.
8. В диалоговом окне **Выбор пользователя, компьютера или группы** введите имя группы безопасности, созданной на шаге 1 (например, **Пользователи перенаправления папок**), и нажмите кнопку **ОК**.
9. Перейдите на вкладку **Делегирование** , выберите **Добавить**, введите **прошедшие проверку пользователи**, нажмите кнопку **ОК**, а затем еще раз нажмите кнопку **ОК** , чтобы принять разрешения на чтение по умолчанию.
    
    Этот шаг необходим из-за изменений в безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016).

> [!IMPORTANT]
> Из-за изменений в системе безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14-2016), необходимо предоставить группе аутентифицированные пользователи делегированные разрешения на чтение объекту групповой политики перенаправления папок. в противном случае объект групповой политики не будет применен к пользователям или, если он уже применен, объект групповой политики будет удален, перенаправлен обратно на локальный компьютер. Дополнительные сведения см. в разделе [deploying групповая политика Security Update MS16-072](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/).

## <a name="step-4-configure-folder-redirection-with-offline-files"></a>Шаг 4. Настройка перенаправления папок с помощью автономные файлы

После создания объекта групповой политики для параметров перенаправления папок измените параметры групповая политика, чтобы включить и настроить перенаправление папок, как описано в следующей процедуре.

> [!NOTE]
> Автономные файлы включен по умолчанию для перенаправленных папок на клиентских компьютерах Windows и отключен на компьютерах под управлением Windows Server, если пользователь не изменил их. Чтобы использовать групповая политика для управления включением автономные файлы, используйте параметр **Разрешить или запретить использование параметра политики автономные файлы компонентов** .
> Дополнительные сведения о других параметрах групповая политика автономные файлы см. в разделе [Включение расширенных функций автономные файлы](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn270369(v%3dws.11)>)и [настройка групповая политика для автономные файлы](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc759721(v%3dws.10)>).

Вот как можно настроить перенаправление папок в групповая политика:

1. В групповая политика управления щелкните правой кнопкой мыши созданный объект групповой политики (например, **Параметры перенаправления папок**), а затем выберите **изменить**.
2. В окне редактор "Управление групповыми политиками" перейдите в раздел **Конфигурация пользователя**, затем **политики**, **Параметры Windows**и **Перенаправление папок**.
3. Щелкните правой кнопкой мыши папку, которую требуется перенаправить (например, **документы**), и выберите пункт **свойства**.
4. В диалоговом окне **Свойства** в поле **параметр** выберите **базовый — перенаправить папку всех пользователей в то же расположение**.

    > [!NOTE]
    > Чтобы применить перенаправление папок к клиентским компьютерам под управлением Windows XP или Windows Server 2003, перейдите на вкладку **Параметры** и установите флажок **также применить политику перенаправления для Windows 2000, Windows 2000 Server, Windows XP и Windows Server 2003.** флажок "системы".

5. В разделе **расположение целевой папки** выберите **создать папку для каждого пользователя в корневом** каталоге, а затем в поле **корневой путь** введите путь к общей папке, в которой хранятся перенаправленные папки, например:  **\\ \\ Пользователи\\FS1.Corp.contoso.com $**
6. Перейдите на вкладку **Параметры** и в разделе **Удаление политики** при необходимости установите флажок **перенаправлять папку обратно в локальный профиль пользователя при удалении политики** (этот параметр может помочь сделать перенаправление папок более Прогнозируемый для админиситраторс и пользователей).
7. Нажмите кнопку **ОК**, а затем в диалоговом окне Предупреждение выберите **Да** .

## <a name="step-5-enable-the-folder-redirection-gpo"></a>Шаг 5. Включение объекта групповой политики перенаправления папок

После того как вы закончите настройку перенаправления папок групповая политика, следующим шагом является включение объекта групповой политики, позволяющего применить его к затронутым пользователям.

> [!TIP]
> Если вы планируете задействовать поддержку основного компьютера или другие настройки политики, это следует сделать до включения GPO, чтобы предотвратить копирование данных пользователя на неосновные компьютеры до включения поддержки основного компьютера.

Вот как можно включить объект групповой политики перенаправления папок:

1. Откройте "Управление групповой политикой".
2. Щелкните созданный объект групповой политики правой кнопкой мыши и выберите пункт **связь включена**. Рядом с пунктом меню появится флажок.

## <a name="step-6-test-folder-redirection"></a>Шаг 6. Тестирование перенаправления папок

Чтобы проверить перенаправление папок, войдите на компьютер с учетной записью пользователя, настроенной для перенаправления папок. Затем убедитесь, что папки и профили перенаправляются.

Вот как можно проверить перенаправление папок:

1. Войдите на основной компьютер (если включена поддержка основного компьютера) с учетной записью пользователя, для которой включено перенаправление папок.
2. Если пользователь уже вошел в систему, откройте командную строку с повышенными привилегиями и введите нижеприведенную команду, чтобы убедиться, что на компьютере используются последние настройки групповой политики.
    
    ```PowerShell
    gpupdate /force
    ```
3. Откройте проводник.
4. Щелкните правой кнопкой мыши перенаправленную папку (например, папку Мои документы в библиотеке документов) и выберите пункт **Свойства**.
5. Перейдите на вкладку **Расположение** и убедитесь, что в пути отображается указанная общая папка вместо локального пути.

## <a name="appendix-a-checklist-for-deploying-folder-redirection"></a>Приложение A. Контрольный список для развертывания перенаправления папок

| Status           | Action |
| ---              | ---    |
| ☐<br>☐<br>☐    | 1. Подготовка домена<br>— Присоединение компьютеров к домену<br>— Создание учетных записей пользователей |
| ☐<br><br><br>   | 2. Создание группы безопасности для перенаправления папок<br>-Имя группы:<br>Участниками |
| ☐<br><br>       | 3. Создание общей папки для перенаправленных папок<br>— Имя файлового ресурса: |
| ☐<br><br>       | 4. Создание объекта групповой политики для перенаправления папок<br>-Имя объекта групповой политики: |
| ☐<br><br>☐<br>☐<br>☐<br>☐<br>☐ | 5. Настройка параметров перенаправления папок и политики автономные файлы<br>— Перенаправленные папки:<br>— Поддержка Windows 2000, Windows XP и Windows Server 2003 включена?<br>-Автономные файлы включено? (включено по умолчанию на клиентских компьютерах Windows)<br>— Включен ли режим "всегда автономно"?<br>— Фоновая синхронизация файлов включена?<br>-Оптимизировано Перемещение перенаправленных папок? |
| ☐<br><br>☐<br><br>☐<br>☐ | 6. Используемых Включить поддержку основного компьютера<br>-Компьютер или на основе пользователя?<br>— Назначение основных компьютеров пользователям;<br>— Расположение сопоставлений пользователя и основного компьютера:<br>-(Необязательно) Включение поддержки основного компьютера для перенаправления папок<br>-(Необязательно) Включение поддержки основного компьютера для перемещаемых профилей пользователей |
| ☐         | 7. Включение объекта групповой политики перенаправления папок |
| ☐         | 8. Тестирование перенаправления папок |

## <a name="change-history"></a>Журнал изменений

В следующей таблице представлены наиболее важные изменения этого раздела.

| Date | Описание | `Reason`|
| --- | --- | --- |
| 18 января 2017 г. | Добавлен шаг [3. Создайте объект групповой политики для перенаправления](#step-3-create-a-gpo-for-folder-redirection) папок, чтобы делегировать разрешения на чтение пользователям, прошедшим проверку подлинности, что теперь требуется из-за групповая политика обновления безопасности. | Отзывы пользователей |

## <a name="more-information"></a>Дополнительные сведения

* [Перенаправление папок, автономные файлы и перемещаемые профили пользователей](folder-redirection-rup-overview.md)
* [Развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md)
* [Включение расширенных функций автономные файлы](enable-always-offline.md)
* [Инструкция Microsoft Support для реплицированных данных профиля пользователя](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/)
* [Загружать неопубликованные приложения с помощью DISM](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
* [Устранение неполадок упаковки, развертывания и запроса приложений на основе среда выполнения Windows](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx)