---
Title: Развертывание перемещаемых профилей пользователей
TOCTitle: Deploying Roaming User Profiles
ms.prod: windows-server-threshold
ms.technology: storage
ms.topic: article
author: JasonGerend
manager: brianlic
ms.date: 06/07/2019
ms.author: jgerend
ms.openlocfilehash: e6e2e32ff9aeb1b3bcfc8fed9027c7e92e13b118
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66812483"
---
# <a name="deploying-roaming-user-profiles"></a>Развертывание перемещаемых профилей пользователей

>Относится к: Windows 10, Windows 8.1, Windows 8, Windows 7, Windows Server 2019 г., Windows Server 2016, Windows Server (полугодовой канал), Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2

В этом разделе описывается, как использовать Windows Server для развертывания [перемещаемых профилей пользователей](folder-redirection-rup-overview.md) на клиентских компьютерах Windows. Перемещаемые профили пользователей перенаправлять профили пользователей для общей папки, чтобы обеспечить получение одинаковых операционной системы и настройки приложений на нескольких компьютерах.

Список последних изменений раздела см. в разделе [журнал изменений](#change-history) этого раздела.

> [!IMPORTANT]
> Из-за изменений безопасности в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016), мы обновили [Step 4: При необходимости создать объект GPO для перемещаемых профилей пользователей](#step-4-optionally-create-a-gpo-for-roaming-user-profiles) в этом разделе, что Windows правильно применять политику перемещаемых профилей пользователей (а не вернется к локальные политики на затронутых компьютерах).

> [!IMPORTANT]
>  Настройки пользователя для начала будет потеряна после обновления на месте операционной системы в следующей конфигурации.
> - Пользователи приложения настроены для перемещаемого профиля
> - Пользователям разрешено вносить изменения в начало
>
> Таким образом меню "Пуск" сбрасывается до новой версии операционной системы по умолчанию после ОС обновление на месте. Обойти это ограничение, см. в разделе [приложение в: Рабочий около Сброс макетов меню Пуск после обновления](#appendix-c-working-around-reset-start-menu-layouts-after-upgrades).

## <a name="prerequisites"></a>предварительные требования

### <a name="hardware-requirements"></a>Требования к оборудованию

Перемещаемые профили пользователей требуется компьютер с x64 или x86; Эта операция не поддерживается в Windows RT.

### <a name="software-requirements"></a>Требования к программному обеспечению

Для использования перемещаемых профилей пользователей действуют следующие программные требования.

- Если вы выполняете развертывание перемещаемые профили пользователей с перенаправлением папок в среде с существующими локальными профилями пользователей, сначала настройте перенаправление папок, а затем — перемещаемые профили пользователей, чтобы минимизировать размер перемещаемых профилей. После успешного перенаправления существующих пользовательских папок вы можете развернуть перемещаемые профили пользователей.
- Для администрирования перемещаемых профилей пользователей вам потребуется войти в систему в качестве члена группы безопасности "Администраторы домена", "Администраторы предприятия" или "Владельцы-создатели групповой политики".
- Клиентские компьютеры должны работать в Windows 10, Windows 8.1, Windows 8, Windows 7, Windows Vista, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008.
- Компьютеры клиентов должны быть присоединены к доменным службам Active Directory (AD DS), которыми вы управляете.
- На компьютере должны быть установлены компоненты "Управление групповой политикой" и "Центр администрирования Active Directory".
- Файловый сервер должен поддерживать перемещаемые профили пользователей.

    - Если общая папка использует пространства имен DFS, у папок DFS (ссылок) должен быть один целевой объект, чтобы избежать конфликтов серверов при изменении настроек пользователем.
    - Если общая папка использует репликацию DFS для копирования данных на другой сервер, пользователи должны иметь доступ лишь к исходному серверу, чтобы избежать конфликтов при изменении параметров серверов.
    - Если общая папка кластеризована, отключите непрерывную доступность в общей папке, чтобы избежать проблем с производительностью.
- Чтобы использовать поддержку основного компьютера в перемещаемых профилей пользователей, являются дополнительным клиентским компьютерам и требования к схеме Active Directory. Дополнительные сведения см. в разделе [развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md).
- Макет меню не будет перемещаться в Windows 10, Windows Server 2019 или Windows Server 2016, если они используют более одного ПК, узла сеансов удаленных рабочих столов или инфраструктуры виртуальных рабочих столов (VDI) сервера начала пользователя. Обойти это ограничение можно указать макет начального, как описано в этом разделе. Либо можно использовать дисков профилей пользователей, которые правильно перемещения параметров меню Пуск, при использовании серверов узла сеансов удаленных рабочих столов или серверов VDI. Дополнительные сведения см. в разделе [упрощает управление пользователями данных с помощью дисков профилей пользователей в Windows Server 2012](https://blogs.technet.microsoft.com/enterprisemobility/2012/11/13/easier-user-data-management-with-user-profile-disks-in-windows-server-2012/).

### <a name="considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows"></a>Рекомендации по использованию перемещаемых профилей пользователей в нескольких версиях Windows

Если вы собираетесь использовать перемещаемые профили пользователей в нескольких версиях Windows, рекомендуется выполнить следующие действия.

- Настройте каждую версию Windows для хранения отдельных версий профилей. Это позволит избежать нежелательных и неожиданных проблем, таких как повреждение профилей.
- Используйте перенаправление папок, чтобы хранить пользовательские файлы, такие как документы и изображения, вне профилей пользователей. Это сделает файлы доступными для пользователей всех версий ОС, а также позволит уменьшить размер профилей и ускорить вход.
- Выделите достаточно дискового пространства для перемещаемых профилей пользователей. Если вы работаете с двумя версиями ОС, количество профилей (а также занимаемое ими место) удвоится, поскольку отдельные профили хранятся в разных версиях системы.
- Не используйте перемещаемые профили пользователей на компьютерах под управлением Windows Vista или Windows Server 2008 и Windows 7 и Windows Server 2008 R2. Перемещение между этими версиями ОС не поддерживается из-за несовместимости версий профилей.
- Оповестите пользователей, что изменения, сделанные в одной ОС, не будут распространяться на другую версию системы.
- При перемещении вашей среды до версии Windows, который использует другой профиль версии (например, из Windows 10 для Windows 10 версии 1607, см. в разделе [приложении б: Справочная информация о версиях профилей](#appendix-b-profile-version-reference-information) список), пользователи получают новый, пустой перемещаемого профиля пользователя. Можно свести к минимуму влияние получение профиля с помощью перенаправления папок для перенаправления общих папок. Не поддерживается миграция перемещаемых профилей пользователей с одним профилем версии на другой.

## <a name="step-1-enable-the-use-of-separate-profile-versions"></a>Шаг 1. Включение отдельных профилей

Если вы развертываете перемещаемых профилей пользователей на компьютерах под управлением Windows 8.1, Windows 8, Windows Server 2012 R2 или Windows Server 2012, мы рекомендуем внести несколько изменений в вашу среду Windows перед развертыванием. Эти изменения обеспечат безотказное обновление ОС в будущем, а также облегчат одновременное использование нескольких версий Windows с перемещаемыми профилями пользователей.

Чтобы внести эти изменения, выполните нижеописанные действия.

1. Скачайте и установите необходимые программные обновления на всех компьютерах, на которых планируете использовать перемещаемые, обязательные или сверх-обязательные профили, а также учетные записи домена по умолчанию.

    - Windows 8.1 или Windows Server 2012 R2: установите обновление, описанное в статье [2887595](http://support.microsoft.com/kb/2887595) в базе знаний Майкрософт (после выпуска).
    - Windows 8 или Windows Server 2012: установите обновление, описанное в статье [2887239](http://support.microsoft.com/kb/2887239) базы знаний Майкрософт.

2. На всех компьютерах под управлением Windows 8.1, Windows 8, Windows Server 2012 R2 или Windows Server 2012, на которых планируете задействовать перемещаемые профили пользователей, используйте редактор реестра или групповой политики, чтобы создать в реестре DWORD и установить его, чтобы `1`. Подробную информацию о создании разделов реестра с помощью групповой политики см. в статье [Настройка элемента реестра](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753092(v=ws.11)>).

    ```
    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ProfSvc\Parameters\UseProfilePathExtensionVersion
    ```

    > [!WARNING]
    > Неправильное изменение реестра может серьезно повредить систему. Перед внесением изменений следует сделать резервную копию всех ценных данных на компьютере.
3. Перезагрузите компьютеры.

## <a name="step-2-create-a-roaming-user-profiles-security-group"></a>Шаг 2. Создание группы безопасности перемещаемых профилей пользователей

Если в вашей среде еще не настроены перемещаемые профили пользователей, в первую очередь необходимо создать группу безопасности, включающую всех пользователей и/или все компьютеры, для которых вы хотите применить настройки политики перемещаемых профилей пользователей.

- Администраторы развертываний перемещаемых профилей пользователей общего назначения обычно создают группу безопасности для пользователей.
- Администраторы служб удаленных рабочих столов или развертываний виртуальных рабочих столов обычно используют группу безопасности для пользователей и общих компьютеров.

Вот как можно создать группу безопасности для перемещаемых профилей пользователей:

1. Откройте диспетчер сервера на компьютере с центром администрирования Active Directory установлен.
2. На **средства** меню, выберите **Центр администрирования Active Directory**. Отобразится центр администрирования Active Directory.
3. Щелкните правой кнопкой мыши соответствующий домен или Подразделение, выберите **New**, а затем выберите **группы**.
4. В окне **Создание группы** в разделе **Группа** укажите следующие параметры.

    - В поле **Имя группы** введите имя группы безопасности, например **Пользователи перемещаемых профилей и компьютеры**.
    - В **область действия группы**выберите **безопасности**, а затем выберите **Global**.

5. В **члены** выберите **добавить**. Откроется диалоговое окно "Выбор пользователей, контактов, компьютеров, учетных записей служб или групп".
6. Если вы хотите включить учетные записи компьютеров в группу безопасности, выберите **типы объектов**выберите **компьютеров** установите флажок, а затем выберите **ОК**.
7. Введите имена пользователей, групп и/или компьютеров, к которым вы хотите развернуть перемещаемые профили пользователей, выберите **ОК**, а затем выберите **ОК** еще раз.

## <a name="step-3-create-a-file-share-for-roaming-user-profiles"></a>Шаг 3. Создание файлового ресурса для перемещаемых профилей пользователей

Если у вас еще нет отдельного файлового ресурса для перемещаемых профилей пользователей (независимой от любых общих ресурсов для перенаправляемых папок, чтобы предотвратить ненамеренное кэширование папки перемещаемого профиля), используйте следующую процедуру для создания общей папки на сервере под управлением Windows Сервер.

> [!NOTE]
> Некоторые функциональные возможности могут отличаться или недоступен в зависимости от версии Windows Server, вы используете.

Вот как можно создать общую папку на сервере Windows Server:

1. В области навигации диспетчера серверов выберите **файловых служб и служб хранилища**, а затем выберите **общих папок** на страницу общих ресурсов.
2. На странице общих ресурсов, выберите **задачи**, а затем выберите **новую общую папку**. Откроется мастер создания общих ресурсов.
3. На **выберите профиль** выберите **общий ресурс SMB — быстрый**. Если у диспетчера ресурсов файлового сервера и используете свойства управления папками, вместо этого выберите **общий ресурс SMB — дополнительные**.
4. На странице **Расположение общего ресурса** выберите сервер и том, в котором хотите создать общий ресурс.
5. На странице **Имя общего ресурса** укажите имя (например, **User Profiles$** ) в поле **Имя общего ресурса** .

    > [!TIP]
    > При создании общего ресурса необходимо скрыть его, поместив ```$``` после имени общего ресурса. Это предотвратит доступ к нему случайных веб-обозревателей.

6. На странице **Другие параметры** снимите флажок **Включить постоянную доступность на этом клиенте**, если он показан, и при необходимости установите флажки **Включить перечисление на основе доступа** и **Шифровать доступ к данным**.
7. На **разрешения** выберите **Настройка разрешений доступа...** . Отобразится диалоговое окно с расширенными параметрами безопасности.
8. Выберите **отключение наследования**, а затем выберите **преобразовать наследуемые разрешения для этого объекта в явные**.
9. Задайте разрешения, как описано в разделе [необходимые разрешения для файла папки, которой перемещаемых профилей пользователей](#required-permissions-for-the-file-share-hosting-roaming-user-profiles) и показано на следующем снимке экрана, удаляя разрешения для неуказанных групп и учетных записей и добавление специальных разрешения в группу Пользователи перемещаемых профилей и компьютеры, созданный на шаге 1.
    
    ![Дополнительные параметры безопасности окно, отображающее разрешения, как описано в таблице 1](media/advanced-security-user-profiles.jpg)
    
    **Рисунок 1** . Установка разрешений для общего ресурса перемещаемых профилей пользователей
10. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Свойства управления** установите для параметра "Использование папки" значение **Файлы пользователя** .
11. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Квота** вы можете при необходимости выбрать квоту, которая будет распространяться на пользователей общего ресурса.
12. На **Подтверждение** выберите **Create.**

### <a name="required-permissions-for-the-file-share-hosting-roaming-user-profiles"></a>Разрешения, необходимые для файла ресурса размещения перемещаемых профилей пользователей

| Учетная запись пользователя | Доступ | Применение |
|   -   |   -   |   -   |
|   Система    |  Полный доступ     |  Данная папка, вложенные папки и файлы     |
|  Администраторы     |  Полный доступ     |  Только эта папка     |
|  Создатель/владелец     |  Полный доступ     |  Только вложенные папки и файлы     |
| Группа безопасности пользователей, которым требуется обеспечить общий доступ к данным (пользователи перемещаемых профилей и компьютеры)      |  Содержимое папки / Чтение данных *(разрешения «Дополнительно»)* <br />Создание папок / Добавление данных *(разрешения «Дополнительно»)* |  Только эта папка     |
| Прочие группы и учетные записи   |  Нет (удаление)     |       |

## <a name="step-4-optionally-create-a-gpo-for-roaming-user-profiles"></a>Шаг 4. Создание GPO для перемещаемых профилей пользователей (при необходимости)

Если у вас еще нет объекта групповой политики для параметров перемещаемых профилей пользователей, выполните нижеописанные действия, чтобы создать для этой цели пустой GPO. Этот объект групповой политики позволит вам установить параметры перемещаемых профилей пользователей (такие, как поддержка основного компьютера, обсуждаемая отдельно), а также могут использоваться для задействования перемещаемых профилей пользователей на компьютерах, как, например, при развертывании в средах виртуальных рабочих столов или со службами удаленных рабочих столов.

Вот как можно создать объект GPO для перемещаемых профилей пользователей:

1. Откройте диспетчер сервера на компьютере с установленным компонентом управления групповой политикой.
2. Из **средства** меню выберите **Управление групповой политикой**. Появится окно управления групповыми политиками.
3. Щелкните правой кнопкой мыши домен или Подразделение, в котором вы хотите настроить перемещаемые профили пользователей, а затем выберите **создать объект групповой Политики в этом домене и связать его**.
4. В **новый объект групповой Политики** диалоговом окне введите имя объекта групповой политики (например, **настройки перемещаемого профиля пользователя**), а затем выберите **ОК**.
5. Щелкните правой кнопкой мыши по новому объекту групповой политики и уберите флажок **Связь включена** . Это исключит применение GPO до завершения его настройки.
6. Выберите GPO. В **Фильтрация ограничений безопасности** раздел **область** выберите **Authenticated Users**и выберите **удалить** во избежание объект групповой Политики применить для всех пользователей.
7. В **Фильтрация ограничений безопасности** выберите **добавить**.
8. В **Выбор пользователя, компьютер или группу** диалоговом окне имя безопасности группы, которую вы создали на шаге 1 (например, **пользователи перемещаемых профилей и компьютеры**), а затем выберите **ОК** .
9. Выберите **делегирования** выберите **добавить**, тип **Authenticated Users**выберите **ОК**, а затем выберите **ОК** снова к примите имя по умолчанию разрешения на чтение.
    
    Этот шаг необходим из-за изменений безопасности в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016).

>[!IMPORTANT]
>Из-за изменений безопасности в [MS16-072A](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016)вы теперь необходимо предоставить разрешения на чтение делегированные группы Authenticated Users в объект групповой политики — в противном случае объект групповой Политики не применяются к пользователям, или если он уже применен, удаляется объект групповой Политики, перенаправление профилей пользователей к локальным Компьютером. Дополнительные сведения см. в разделе [развертывание групповой политики безопасности обновления MS16-072](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/).

## <a name="step-5-optionally-set-up-roaming-user-profiles-on-user-accounts"></a>Шаг 5. Настройка перемещаемых профилей в учетных записях пользователей (при необходимости)

Если вы производите развертывание перемещаемых профилей для учетных записей пользователей, выполните нижеописанные действия, чтобы указать перемещаемые профили пользователей для учетных записей в доменных службах Active Directory. Если вы развертываете перемещаемых профилей пользователей на компьютерах, как это делается для служб удаленных рабочих столов или развертываний виртуальных рабочих столов, вместо этого используйте процедуры, задокументированные в [шаг 6: (Необязательно) Настройка перемещаемых профилей пользователей на компьютерах](#step-6-optionally-set-up-roaming-user-profiles-on-computers).

> [!NOTE]
> Если вы настраиваете перемещаемые профили для учетных записей пользователей, используя Active Directory, или для компьютеров, используя групповую политику, приоритет отдается настройке политики на компьютере.

Вот как настроить перемещаемые профили пользователей для учетных записей пользователей:

1. В центре администрирования Active Directory перейдите в контейнер **Пользователи** (или в контейнер подразделений) в соответствующем домене.
2. Выберите всех пользователей, к которым вы хотите использовать перемещаемые профили, щелкните правой кнопкой мыши пользователей, а затем выберите **свойства**.
3. В **профиль** выберите **путь к профилю:** флажок и введите путь к общей папке место для хранения пользователя с перемещаемый профиль пользователя, за которым следует `%username%` (то есть автоматически заменится на пользователя имя первого, пользователь выполняет вход). Пример:
    
    `\\fs1.corp.contoso.com\User Profiles$\%username%`
    
    Чтобы указать обязательный перемещаемый профиль пользователя, укажите путь к файлу NTuser.man, который вы создали ранее, например, `fs1.corp.contoso.comUser Profiles$default`. Дополнительные сведения см. в разделе [создать обязательные профили пользователей](https://docs.microsoft.com/windows/client-management/mandatory-user-profile).
4. Нажмите кнопку **ОК**.

> [!NOTE]
> По умолчанию при использовании перемещаемых профилей пользователей разрешается развертывание всех приложений на основе среды выполнения Windows® (Магазин Windows). Однако при использовании специальных профилей приложения не развертываются по умолчанию. Специальный статус имеют профили, изменения в которых сбрасываются после выхода пользователя.
> <br><br>Чтобы убрать ограничения на развертывание приложений для специальных профилей, включите параметр политики **Разрешить операции развертывания для специальных профилей** (расположен по следующему адресу: Конфигурация компьютера\Политики\Административные шаблоны\Компоненты Windows\Развертывание пакетов приложений). Однако при таком сценарии развернутые приложения будут хранить на компьютере определенные данные, которые могут накапливаться, например, если с одним ПК работают сотни пользователей. Чтобы очистить приложения, найдите или создайте средство, которое использует [CleanupPackageForUserAsync](https://msdn.microsoft.com/library/windows/apps/windows.management.deployment.packagemanager.cleanuppackageforuserasync.aspx) API, чтобы очистить пакеты приложений для пользователей, у которых больше нет профиля на компьютере.
> <br><br>Подробную информацию о приложениях Магазина Windows см. в разделе [Управление клиентским доступом к Магазину Windows](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh832040(v=ws.11)>).

## <a name="step-6-optionally-set-up-roaming-user-profiles-on-computers"></a>Шаг 6. Настройка перемещаемых профилей пользователей на компьютерах (при необходимости)

Если вы выполняете развертывание перемещаемых профилей пользователей для компьютеров, как, например, при использовании служб удаленных рабочих столов или развертывании виртуальных рабочих столов, выполните нижеописанные действия. Если вы развертываете перемещаемых профилей пользователей для учетных записей пользователей, вместо этого используйте процедуру, описанную в [Step 5: (Необязательно) Настройка перемещаемых профилей пользователей в учетных записях пользователей](#step-5-optionally-set-up-roaming-user-profiles-on-user-accounts).

Можно использовать групповую политику, чтобы применить перемещаемые профили пользователей на компьютерах под управлением Windows 8.1, Windows 8, Windows 7, Windows Vista, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008.

> [!NOTE]
> Если вы настраиваете перемещаемые профили пользователей для компьютеров, используя групповую политику, и для учетных записей пользователей, используя Active Directory, приоритет отдается настройке политики на компьютере.

Вот как настроить перемещаемые профили пользователей на компьютерах:

1. Откройте диспетчер сервера на компьютере с установленным компонентом управления групповой политикой.
2. Из **средства** меню, выберите **Управление групповой политикой**. Управление групповой политикой будет отображаться.
3. В управлении групповыми политиками, щелкните правой кнопкой мыши объект групповой Политики, созданный на шаге 3 (например, **настройки перемещаемых профилей пользователей**), а затем выберите **изменить**.
4. В окне редактора управления групповыми политиками перейдите к разделу **Конфигурация компьютера** > **Политики** > **Административные шаблоны** > **Система** > **Профили пользователей**.
5. Щелкните правой кнопкой мыши **задать путь к перемещаемым профилям для всех пользователей, входящих в систему на этом компьютере** , а затем выберите **изменить**.
    > [!TIP]
    > Такие программы, как Windows PowerShell, по умолчанию используют домашнюю папку пользователя, если она настроена. Вы можете настроить альтернативное локальное или сетевое расположение для каждого пользователя в разделе **Домашняя папка** параметров учетной записи пользователя в доменных службах Active Directory. Чтобы настроить расположение домашней папки для всех пользователей компьютера под управлением Windows 8.1, Windows 8, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2 или Windows Server 2012 в среде виртуального рабочего стола, включите **установить домашнюю папку пользователя**  параметр политики, а затем укажите файл общую папку и букву диска для сопоставления (или локальную папку). Не используйте переменные среды или многоточия. В конце пути, указанного при входе пользователя, следует добавить пользовательский псевдоним.
6. В **свойства** выберите **включено**
7. В **пользователей, входящих в систему на этом компьютере следует использовать путь для перемещаемых профилей** введите путь к общей папке, где вы хотите сохранить пользователя с перемещаемый профиль пользователя, за которым следует `%username%` (который заменяется автоматически со временем имя первого пользователя пользователь выполняет вход). Пример:

    `\\fs1.corp.contoso.com\User Profiles$\%username%`

    Чтобы указать обязательный перемещаемый профиль пользователя, которая является предварительно настроенного профиля, к которому пользователи не может внести постоянные изменения (изменения сбрасываются, когда пользователь выходит из системы), укажите путь к файлу NTuser.man, который вы создали ранее, например, `\\fs1.corp.contoso.com\User Profiles$\default`. Дополнительные сведения см. в разделе [Создание обязательного профиля пользователя](https://docs.microsoft.com/windows/client-management/mandatory-user-profile).
8. Нажмите кнопку **ОК**.

## <a name="step-7-optionally-specify-a-start-layout-for-windows-10-pcs"></a>Шаг 7. При необходимости укажите макет начального для компьютеров с Windows 10

Можно использовать групповую политику для применения определенного макета меню Пуск, таким образом, чтобы пользователи видят один и тот же макет начала на всех компьютерах. Если пользователи входят в более чем на одном Компьютере, и вы хотите запретить ему согласованного макета Start для компьютеров, убедитесь, что объект групповой Политики применяется ко всем ПК.

Чтобы указать макет начального, сделайте следующее:

1. Обновление компьютеров под управлением Windows 10 до Windows 10 версии 1607 (также известный как Юбилейное обновление) или более поздней версии и установить накопительный пакет обновления 14 марта 2017 г. ([KB4013429](https://support.microsoft.com/kb/4013429)) или более поздней версии.
2. Создайте полный или частичный начала меню макета файл XML. Чтобы сделать это, см. в разделе [Настройка и экспорт макет начального](https://docs.microsoft.com/windows/configuration/customize-and-export-start-layout).
    * Если указать *полный* макет начального, пользователь не может настроить любую часть меню "Пуск". Если указать *частичного* макет начального, пользователи могут настраивать все, кроме заблокированные группы вами плиток. Тем не менее с помощью частичного макета Start, настройки пользователя в меню "Пуск" не будут распространяться на другие компьютеры.
3. Используйте групповую политику, чтобы применить настраиваемый макет начального объекта групповой политики, созданные для перемещаемых профилей пользователей. Чтобы сделать это, см. в разделе [использования групповой политики, чтобы применить настраиваемый макет Start в домене](https://docs.microsoft.com/windows/configuration/customize-windows-10-start-screens-by-using-group-policy#bkmk-domaingpodeployment).
4. Используйте групповую политику, чтобы задать следующий параметр реестра на компьютерах Windows 10. Чтобы сделать это, см. в разделе [Настройка элемента реестра](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753092(v=ws.11)>).

| **Действие**   | **Update**                  |
| ------------ | ------------                |
| Hive         | **HKEY_LOCAL_MACHINE**      |
| Путь к ключу     | **Software\Microsoft\Windows\CurrentVersion\Explorer** |
| Значение   | **SpecialRoamingOverrideAllowed** |
| Тип значения   | **REG_DWORD**               |
| «Значение»   | **1** (или **0** отключение) |
| Base         | **Decimal**                 |

5. (Необязательно) Включите оптимизацию входа в систему первый раз ускорить вход для пользователей. Чтобы сделать это, см. в разделе [применение политик для сокращения времени входа в систему](https://docs.microsoft.com/windows/client-management/mandatory-user-profile#apply-policies-to-improve-sign-in-time).
6. (Необязательно) Дополнительно сокращают время входа в систему, удалив ненужные приложения из базовый образ Windows 10, который используется для развертывания на клиентских компьютерах. Windows Server 2019 и Windows Server 2016 нет любого предварительно подготовленные приложения, поэтому вы можете пропустить этот шаг в образах сервера.
    - Чтобы удалить приложения, используйте [Remove-AppxProvisionedPackage](https://docs.microsoft.com/powershell/module/dism/remove-appxprovisionedpackage?view=win10-ps) командлет в Windows PowerShell, чтобы удалить следующие приложения. Если компьютеры уже развернуты можно создать скрипт для удаления этих приложений с помощью [Remove-AppxPackage](https://docs.microsoft.com/powershell/module/appx/remove-appxpackage?view=win10-ps).
    
      - Microsoft.windowscommunicationsapps\_8wekyb3d8bbwe
      - Microsoft.BingWeather\_8wekyb3d8bbwe
      - Microsoft.DesktopAppInstaller\_8wekyb3d8bbwe
      - Microsoft.Getstarted\_8wekyb3d8bbwe
      - Microsoft.Windows.Photos\_8wekyb3d8bbwe
      - Microsoft.WindowsCamera\_8wekyb3d8bbwe
      - Microsoft.WindowsFeedbackHub\_8wekyb3d8bbwe
      - Microsoft.WindowsStore\_8wekyb3d8bbwe
      - Microsoft.XboxApp\_8wekyb3d8bbwe
      - Microsoft.XboxIdentityProvider\_8wekyb3d8bbwe
      - Microsoft.ZuneMusic\_8wekyb3d8bbwe

>[!NOTE]
>Удалив эти приложения уменьшается время входа в систему, но вы можете оставить их установки, если развертывание должно любой из них.

## <a name="step-8-enable-the-roaming-user-profiles-gpo"></a>Шаг 8. Включение GPO перемещаемых профилей пользователей

Если вы настраиваете перемещаемые профили пользователей на компьютерах с помощью групповой политики, или изменили другие параметры перемещаемых профилей пользователей с помощью групповой политики, выполните нижеописанные действия, чтобы включить GPO и применить его к затронутым пользователям.

>[!TIP]
>Если вы планируете задействовать поддержку основного компьютера, сделайте это, прежде чем включать объект групповой Политики. предотвратить копирование данных пользователя на неосновные компьютеры до включения поддержки основного компьютера. Параметры политики, см. в разделе [развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md).

Ниже приведен Включение GPO перемещаемого профиля пользователя.

1. Откройте "Управление групповой политикой".
2. Щелкните правой кнопкой мыши созданный объект групповой Политики, а затем выберите **связь включена**. Рядом с соответствующим пунктом меню появится флажок.

## <a name="step-9-test-roaming-user-profiles"></a>Шаг 9. Проверка перемещаемых профилей пользователей

Для проверки перемещаемых профилей пользователей войдите в учетную запись компьютера, на котором имеется настроенная для работы с перемещаемыми профилями пользователей учетная запись, или войдите в систему на компьютере, настроенном для работы с перемещаемыми профилями пользователей. После этого убедитесь, что профиль перенаправляется.

Вот как можно протестировать перемещаемых профилей пользователей:

1. Войдите в систему на основном компьютере (если вы включили поддержку основного компьютера) при помощи учетной записи пользователя, для которого вы активировали перемещаемые профили пользователей. Если вы включили перемещаемые профили пользователей на определенных компьютерах, войдите в систему на одном из них.
2. Если пользователь уже вошел в систему, откройте командную строку с повышенными привилегиями и введите нижеприведенную команду, чтобы убедиться, что на компьютере используются последние настройки групповой политики.
    
    ```PowerShell
    GpUpdate /Force
    ```
3. Чтобы убедиться, что профиль пользователя перемещается, откройте **панели управления**выберите **система и безопасность**выберите **системы**выберите **Дополнительные параметры системы** выберите **параметры** в профили пользователей разделе и выполните поиск **перемещаемых** в **тип** столбца.

## <a name="appendix-a-checklist-for-deploying-roaming-user-profiles"></a>Приложение A. Контрольный список для развертывания перемещаемых профилей пользователей

| Состояние                     | Действие                                                |
| ---                        | ------                                                |
| ☐<br>☐<br>☐<br>☐<br>☐   | 1. Подготовка домена<br>— Присоединение компьютеров к домену<br>-Включить использование отдельных профилей<br>-Создание учетных записей пользователей<br>— (Необязательно) Настройте перенаправление папок |
| ☐<br><br><br>             | 2. Создание группы безопасности для перемещаемых профилей пользователей<br>-Имя группы:<br>-Члены: |
| ☐<br><br>                 | 3. Создание файлового ресурса для перемещаемых профилей пользователей<br>— Имя общей папки: |
| ☐<br><br>                 | 4. Создание GPO для перемещаемых профилей пользователей<br>-Имя объект групповой Политики:|
| ☐                         | 5. Настройка параметров политики перемещаемых профилей пользователей    |
| ☐<br>☐<br>☐              | 6. Включение перемещаемых профилей пользователей<br>— С помощью AD DS для учетных записей пользователей?<br>-Включен в групповой политике для учетных записей компьютеров?<br> |
| ☐                         | 7. (Необязательно) Укажите обязательные макет начального для компьютеров с Windows 10 |
| ☐<br>☐<br><br>☐<br><br>☐ | 8. (Необязательно) Включение поддержки основного компьютера<br>-Назначение основных компьютеров для пользователей<br>— Расположение пользователя и сопоставления основного компьютера:<br>— (Необязательно) Включение поддержки основного компьютера для перенаправления папок<br>-На компьютере или на основе пользователя?<br>— (Необязательно) Включение поддержки основного компьютера для перемещаемых профилей пользователей |
| ☐                        | 9. Включение GPO перемещаемых профилей пользователей                |
| ☐                        | 10. Проверка перемещаемых профилей пользователей                         |

## <a name="appendix-b-profile-version-reference-information"></a>Приложение B. Справочная информация о версиях профилей

Каждый профиль имеет версию профиля, приблизительно соответствующую версию Windows, в которой используется профиль. Например, Windows 10, версия 1703 и версии 1607, используют. Версия профиля v6. Корпорация Майкрософт создает новую версию профиля только при необходимости для обеспечения совместимости, который является, почему бы не каждая версия Windows включает в себя новую версию профиля.

В следующей таблице указан список расположений перемещаемых профилей пользователей в разных версиях Windows.

| Версия операционной системы | Расположение перемещаемого профиля пользователя |
| --- | --- |
| Windows XP и Windows Server 2003 | ```\\<servername>\<fileshare>\<username>``` |
| Windows Vista и Windows Server 2008 | ```\\<servername>\<fileshare>\<username>.V2``` |
| Windows 7 и Windows Server 2008 R2 | ```\\<servername>\<fileshare>\<username>.V2``` |
| Windows 8 и Windows Server 2012 | ```\\<servername>\<fileshare>\<username>.V3``` (после применения программного обеспечения обновления и раздела реестра)<br>```\\<servername>\<fileshare>\<username>.V2``` (до программного обеспечения применения обновления и раздела реестра) |
| Windows 8.1 и Windows Server 2012 R2 | ```\\<servername>\<fileshare>\<username>.V4``` (после применения программного обеспечения обновления и раздела реестра)<br>```\\<servername>\<fileshare>\<username>.V2``` (до программного обеспечения применения обновления и раздела реестра) |
| Windows 10 | ```\\<servername>\<fileshare>\<username>.V5``` |
| Windows 10, версия 1703 и версии 1607 | ```\\<servername>\<fileshare>\<username>.V6``` |

## <a name="appendix-c-working-around-reset-start-menu-layouts-after-upgrades"></a>Приложение В. Рабочий около Сброс макетов меню Пуск после обновления

Ниже приведены некоторые способы обойти макеты меню Пуск, Начало сброса после обновления на месте:

- Если только один пользователь никогда не использует устройство и ИТ-администратор использует управляемых стратегии развертывания операционной системы, например SCCM их можно сделать следующее:
    
  1. Экспортировать макет меню Пуск с Export-Startlayout до обновления 
  2. Импорт макет меню "Пуск" с Import-StartLayout после OOBE, но до входа пользователя  
 
     > [!NOTE] 
     > Импорт StartLayout изменяет профиль пользователя по умолчанию. Все профили пользователей, созданные после импортирования получит импортированных макет начального.
 
- Можно выбрать ИТ-администраторам управлять макетом начального элемента с помощью групповой политики. Благодаря использованию групповой политики предоставляет централизованное управление решение будет распространяться стандартизованной компоновке, запустите на пользователей. Существует 2 режима в режимах, чтобы с помощью групповой политики для управления Start. Блокировки полного и частичного блокировки. В сценарии полной блокировки пользователю вносить любые изменения в макет начального элемента. В сценарии частичного блокировки дает пользователю возможность вносить изменения в определенную область Start. Дополнительные сведения см. в разделе [Настройка и экспорт макет начального](https://docs.microsoft.com/windows/configuration/customize-and-export-start-layout).
        
   > [!NOTE]
   > Внесения пользователем изменений в сценарии частичного блокировки, по-прежнему будут потеряны во время обновления.

- Позвольте начала сброса макета произойти и разрешить конечным пользователям для изменения конфигурации запуска. Уведомление по электронной почте или другие уведомления могут отправляться конечным пользователям следует ожидать их начала макеты для сброса после обновления операционной системы для свернутого влияние. 

# <a name="change-history"></a>Журнал изменений

В следующей таблице представлены наиболее важные изменения этого раздела.

| Date | Описание |`Reason`|
| --- | ---         | ---   |
| 1 мая 2019 г. | Добавлены обновления для Windows Server 2019 |
| 10 апреля 2018 г. | Добавлено обсуждение теряются при настройки пользователя для запуска после обновления на месте операционной системы|Известная проблема выноски. |
| 13 марта 2018 г. | Обновления для Windows Server 2016 | Перемещены из предыдущих версий библиотеки и обновлены для текущей версии Windows Server. |
| 13 апреля 2017 г. | Добавлены сведения о профиле для Windows 10 версии 1703 и уточнено рабочих версий как перемещаемый профиль, при обновлении операционных систем, см. в разделе [рекомендации по использованию перемещаемых профилей пользователей в нескольких версиях Windows](#considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows). | Отзывы пользователей. |
| 14 марта 2017 г. | Добавлен необязательный шаг для указания обязательных макет начального для компьютеров с Windows 10 в [приложении a. Контрольный список для развертывания перемещаемых профилей пользователей](#appendix-a-checklist-for-deploying-roaming-user-profiles). |Функция изменения в последнем обновлении Windows. |
| 23 января 2017 г. | Добавлен шаг для [Step 4: При необходимости создать объект GPO для перемещаемых профилей пользователей](#step-4-optionally-create-a-gpo-for-roaming-user-profiles) делегировать разрешения на чтение для Authenticated Users, теперь требуется из-за обновления групповой политики.|Изменения системы безопасности для обработки групповой политики. |
| 29 декабря 2016 г. | Добавлена ссылка в [шаг 8: Включение GPO перемещаемых профилей пользователя](#step-8-enable-the-roaming-user-profiles-gpo) для упрощения получения сведений о настройке групповой политики для основных компьютеров. Также исправлено несколько ссылок на шаги 5 и 6, для номера Неизвестная ошибка.|Отзывы пользователей. |
| 5 декабря 2016 г. | Добавлены сведения, объясняя, настроек меню Пуск, перемещаемых проблему. | Отзывы пользователей. |
| 6 июля 2016 г. | Добавлены суффиксов версий профилей Windows 10 в [приложении б: Профилирование справочная информация о версиях](#appendix-b-profile-version-reference-information). Также удаляется из списка поддерживаемых операционных систем Windows XP и Windows Server 2003. | Обновления для новых версий Windows и удалены сведения о версиях Windows, которые больше не поддерживаются. |
| 7 июля 2015 г. | Добавлены требования и последовательность действий для отключения постоянной доступности при использовании кластеризованного файлового сервера. | Кластеризованные общие папки производительнее для небольших операций записи (которые типичны для перемещаемых профилей пользователей), если постоянная доступность отключена. |
| 19 марта 2014 г. | Капитализация суффиксов версий профилей (. ВЕРСИИ 2. V3. Версия 4) в [приложение б. Профилирование справочная информация о версиях](#appendix-b-profile-version-reference-information). | Несмотря на то, что Windows регистр не учитывается, если вы используете NFS с файловым ресурсом, важно иметь правильный регистр (в верхнем регистре) для суффикса профиля. |
| 9 октября 2013 г. | Пересмотрено для Windows Server 2012 R2 и Windows 8.1, Прояснены некоторые вопросы и добавлены [рекомендации по использованию перемещаемых профилей пользователей в нескольких версиях Windows](#considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows) и [приложении б: Справочная информация о версиях профилей](#appendix-b-profile-version-reference-information) разделы. | Обновления для новой версии. отзывы пользователей. |

## <a name="more-information"></a>Дополнительные сведения

- [Развертывание перенаправления папок, автономных файлов и перемещаемых профилей пользователей](deploy-folder-redirection.md)
- [Развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md)
- [Реализация управления состоянием пользователя](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc784645(v=ws.10)>)
- [Заявление о поддержке корпорации Майкрософт вокруг реплицированных данных профилей пользователей](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/)
- [Загрузка неопубликованных приложений с помощью DISM](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
- [Устранение неполадок упаковки, развертывания и запросов приложений на основе среды выполнения Windows](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx)