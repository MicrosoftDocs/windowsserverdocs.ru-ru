---
title: Развертывание перемещаемых профилей пользователей
TOCTitle: Deploying Roaming User Profiles
ms.prod: windows-server-threshold
ms.technology: storage
ms.topic: article
author: JasonGerend
manager: brianlic
ms.date: 06/07/2019
ms.author: jgerend
ms.openlocfilehash: 1fcabf890c0c54e12c1650c31a072d17a33e292f
ms.sourcegitcommit: 23a6e83b688119c9357262b6815c9402c2965472
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2019
ms.locfileid: "69560550"
---
# <a name="deploying-roaming-user-profiles"></a>Развертывание перемещаемых профилей пользователей

>Относится к: Windows 10, Windows 8.1, Windows 8, Windows 7, Windows Server 2019, Windows Server 2016, Windows Server (половина ежегодного канала), Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2

В этом разделе описывается, как использовать Windows Server для развертывания [перемещаемых профилей пользователей](folder-redirection-rup-overview.md) на клиентских компьютерах Windows. Перемещаемые профили пользователей перенаправляют профили пользователей в общую папку, чтобы пользователи получали одинаковые параметры операционной системы и приложения на нескольких компьютерах.

Список недавних изменений этого раздела см. в разделе [Журнал изменений](#change-history) этой статьи.

> [!IMPORTANT]
> Из-за изменений в системе безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016), мы обновили [шаг 4. При необходимости создайте объект групповой политики для перемещаемых](#step-4-optionally-create-a-gpo-for-roaming-user-profiles) профилей пользователей в этом разделе, чтобы Windows могла правильно применить политику перемещаемых профилей пользователей (а не вернуться к локальным политикам на затронутых компьютерах).

> [!IMPORTANT]
>  Пользовательские настройки для запуска теряются после обновления операционной системы на месте в следующей конфигурации:
> - Пользователи настроены для перемещаемого профиля
> - Пользователям разрешено вносить изменения в начало
>
> В результате при обновлении операционной системы на месте меню "Пуск" сбрасывается до значения по умолчанию новой версии ОС. Обходные пути см [. в приложении C: Идет обход макетов меню "Пуск"](#appendix-c-working-around-reset-start-menu-layouts-after-upgrades)после обновления.

## <a name="prerequisites"></a>Предварительные требования

### <a name="hardware-requirements"></a>Требования к оборудованию

Для перемещаемых профилей пользователей требуется компьютер на базе x64 или x86. она не поддерживается в Windows RT.

### <a name="software-requirements"></a>Требования к программному обеспечению

Для использования перемещаемых профилей пользователей действуют следующие программные требования.

- Если вы выполняете развертывание перемещаемые профили пользователей с перенаправлением папок в среде с существующими локальными профилями пользователей, сначала настройте перенаправление папок, а затем — перемещаемые профили пользователей, чтобы минимизировать размер перемещаемых профилей. После успешного перенаправления существующих пользовательских папок вы можете развернуть перемещаемые профили пользователей.
- Для администрирования перемещаемых профилей пользователей вам потребуется войти в систему в качестве члена группы безопасности "Администраторы домена", "Администраторы предприятия" или "Владельцы-создатели групповой политики".
- Клиентские компьютеры должны работать под управлением Windows 10, Windows 8.1, Windows 8, Windows 7, Windows Vista, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008.
- Компьютеры клиентов должны быть присоединены к доменным службам Active Directory (AD DS), которыми вы управляете.
- На компьютере должны быть установлены компоненты "Управление групповой политикой" и "Центр администрирования Active Directory".
- Файловый сервер должен поддерживать перемещаемые профили пользователей.

    - Если общая папка использует пространства имен DFS, у папок DFS (ссылок) должен быть один целевой объект, чтобы избежать конфликтов серверов при изменении настроек пользователем.
    - Если общая папка использует репликацию DFS для копирования данных на другой сервер, пользователи должны иметь доступ лишь к исходному серверу, чтобы избежать конфликтов при изменении параметров серверов.
    - Если общая папка кластеризована, отключите непрерывную доступность в общей папке, чтобы избежать проблем с производительностью.
- Для использования поддержки основного компьютера в перемещаемых профилях пользователей предъявляются дополнительные требования к клиентскому компьютеру и Active Directory схеме. Дополнительные сведения см. в статье [Развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md).
- Макет меню "Пуск" пользователя не будет перемещаться на Windows 10, Windows Server 2019 или Windows Server 2016, если на них используется несколько компьютеров, удаленный рабочий стол узел сеансов или сервер инфраструктуры виртуализованных рабочих столов (VDI). В качестве обходного решения можно указать начальный макет, как описано в этом разделе. Также можно использовать диски профилей пользователей, которые должны правильно перемещать параметры меню "Пуск" при использовании с удаленный рабочий стол серверами узлов сеансов или серверами VDI. Дополнительные сведения см. в разделе более [Простые пользовательские управление данными с дисками профилей пользователей в Windows Server 2012](https://blogs.technet.microsoft.com/enterprisemobility/2012/11/13/easier-user-data-management-with-user-profile-disks-in-windows-server-2012/).

### <a name="considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows"></a>Рекомендации по использованию перемещаемых профилей пользователей в нескольких версиях Windows

Если вы собираетесь использовать перемещаемые профили пользователей в нескольких версиях Windows, рекомендуется выполнить следующие действия.

- Настройте каждую версию Windows для хранения отдельных версий профилей. Это позволит избежать нежелательных и неожиданных проблем, таких как повреждение профилей.
- Используйте перенаправление папок, чтобы хранить пользовательские файлы, такие как документы и изображения, вне профилей пользователей. Это сделает файлы доступными для пользователей всех версий ОС, а также позволит уменьшить размер профилей и ускорить вход.
- Выделите достаточно дискового пространства для перемещаемых профилей пользователей. Если вы работаете с двумя версиями ОС, количество профилей (а также занимаемое ими место) удвоится, поскольку отдельные профили хранятся в разных версиях системы.
- Не используйте перемещаемые профили пользователей на компьютерах под управлением Windows Vista, Windows Server 2008 и Windows 7 или Windows Server 2008 R2. Перемещение между этими версиями операционных систем не поддерживается из-за несовместимости в их версиях профиля.
- Оповестите пользователей, что изменения, сделанные в одной ОС, не будут распространяться на другую версию системы.
- При перемещении среды в версию Windows, использующую другую версию профиля (например, из Windows 10 в Windows 10, версия 1607), см [. приложение б. Сведения о](#appendix-b-profile-version-reference-information) версии профиля для списка. пользователи получают новый пустой перемещаемый профиль пользователя. Вы можете уменьшить влияние получения нового профиля с помощью перенаправления папок для перенаправления общих папок. Нет поддерживаемого метода миграции перемещаемых профилей пользователей из одной версии профиля в другую.

## <a name="step-1-enable-the-use-of-separate-profile-versions"></a>Шаг 1. Включение отдельных профилей

При развертывании перемещаемых профилей пользователей на компьютерах под управлением Windows 8.1, Windows 8, Windows Server 2012 R2 или Windows Server 2012 рекомендуется внести несколько изменений в среду Windows перед развертыванием. Эти изменения обеспечат безотказное обновление ОС в будущем, а также облегчат одновременное использование нескольких версий Windows с перемещаемыми профилями пользователей.

Чтобы внести эти изменения, выполните нижеописанные действия.

1. Скачайте и установите необходимые программные обновления на всех компьютерах, на которых планируете использовать перемещаемые, обязательные или сверх-обязательные профили, а также учетные записи домена по умолчанию.

    - Windows 8.1 или Windows Server 2012 R2: Установите обновление программного обеспечения, описанное в статье [2887595](http://support.microsoft.com/kb/2887595) базы знаний Майкрософт (когда выпущено).
    - Windows 8 или Windows Server 2012: установите обновление, описанное в статье [2887239](http://support.microsoft.com/kb/2887239) базы знаний Майкрософт.

2. На всех компьютерах под управлением Windows 8.1, Windows 8, Windows Server 2012 R2 или Windows Server 2012, на которых будут использоваться перемещаемые профили пользователей, используйте редактор реестра или групповая политика, чтобы создать следующий параметр DWORD раздела реестра и присвоить ему `1`значение. Подробную информацию о создании разделов реестра с помощью групповой политики см. в статье [Настройка элемента реестра](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753092(v=ws.11)>).

    ```
    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ProfSvc\Parameters\UseProfilePathExtensionVersion
    ```

    > [!WARNING]
    > Неправильное изменение реестра может серьезно повредить систему. Перед внесением изменений следует сделать резервную копию всех ценных данных на компьютере.
3. Перезагрузите компьютеры.

## <a name="step-2-create-a-roaming-user-profiles-security-group"></a>Шаг 2. Создание группы безопасности перемещаемых профилей пользователей

Если в вашей среде еще не настроены перемещаемые профили пользователей, в первую очередь необходимо создать группу безопасности, включающую всех пользователей и/или все компьютеры, для которых вы хотите применить настройки политики перемещаемых профилей пользователей.

- Администраторы развертываний перемещаемых профилей пользователей общего назначения обычно создают группу безопасности для пользователей.
- Администраторы служб удаленных рабочих столов или развертываний виртуальных рабочих столов обычно используют группу безопасности для пользователей и общих компьютеров.

Вот как можно создать группу безопасности для перемещаемых профилей пользователей:

1. Откройте диспетчер сервера на компьютере с установленным центром администрирования Active Directory.
2. В меню **Сервис** выберите **Active Directory центр администрирования**. Отобразится центр администрирования Active Directory.
3. Щелкните правой кнопкой мыши соответствующий домен или подразделение, выберите **создать**, а затем выберите **Группа**.
4. В окне **Создание группы** в разделе **Группа** укажите следующие параметры.

    - В поле **Имя группы** введите имя группы безопасности, например **Пользователи перемещаемых профилей и компьютеры**.
    - В **области групп**выберите **Безопасность**, а затем выберите **Глобальная**.

5. В разделе **члены** выберите **Добавить**. Откроется диалоговое окно "Выбор пользователей, контактов, компьютеров, учетных записей служб или групп".
6. Если требуется включить учетные записи компьютеров в группу безопасности, выберите **типы объектов**, установите флажок **Компьютеры** и нажмите кнопку **ОК**.
7. Введите имена пользователей, групп и (или) компьютеров, для которых требуется развернуть перемещаемые профили пользователей, нажмите кнопку **ОК**, а затем еще раз нажмите кнопку **ОК** .

## <a name="step-3-create-a-file-share-for-roaming-user-profiles"></a>Шаг 3. Создание файлового ресурса для перемещаемых профилей пользователей

Если у вас еще нет отдельной общей папки для перемещаемых профилей пользователей (независимо от общих ресурсов для перенаправленных папок, чтобы предотвратить случайное кэширование папки перемещаемого профиля), используйте следующую процедуру для создания общей папки на сервере под Windows. Сервером.

> [!NOTE]
> Некоторые функциональные возможности могут отличаться или быть недоступными в зависимости от используемой версии Windows Server.

Вот как можно создать общую папку на сервере Windows Server:

1. В области навигации диспетчер сервера выберите **файл и службы хранилища**, а затем щелкните **Общие папки** , чтобы отобразить страницу Общие ресурсы.
2. На плитке общие ресурсы выберите **задачи**, а затем щелкните **создать общую папку**. Откроется мастер создания общих ресурсов.
3. На странице **Выбор профиля** выберите **общий ресурс SMB — Быстрая**. Если файловый сервер диспетчер ресурсов установлен и использует свойства управления папками, выберите **общий ресурс SMB — дополнительно**.
4. На странице **Расположение общего ресурса** выберите сервер и том, в котором хотите создать общий ресурс.
5. На странице **Имя общего ресурса** укажите имя (например, **User Profiles$** ) в поле **Имя общего ресурса** .

    > [!TIP]
    > При создании общего ресурса скройте его, поместив ```$``` после имени общего ресурса. Это предотвратит доступ к нему случайных веб-обозревателей.

6. На странице **Другие параметры** снимите флажок **Включить постоянную доступность на этом клиенте**, если он показан, и при необходимости установите флажки **Включить перечисление на основе доступа** и **Шифровать доступ к данным**.
7. На странице **разрешения** выберите **Настройка разрешений...** . Отобразится диалоговое окно с расширенными параметрами безопасности.
8. Выберите **отключить наследование**, а затем выберите **преобразовать унаследованные разрешения в явное разрешение для этого объекта**.
9. Задайте разрешения, как описано в разделе [необходимые разрешения для файлового ресурса, размещающего перемещаемые профили пользователей](#required-permissions-for-the-file-share-hosting-roaming-user-profiles) и показанные на следующем снимке экрана: удаление разрешений для групп и учетных записей, а также добавление специальных разрешений для перемещаемого пользователя. Профили пользователей и компьютеров, созданные на шаге 1.
    
    ![Окно "Дополнительные параметры безопасности", в котором отображаются разрешения, описанные в таблице 1](media/advanced-security-user-profiles.jpg)
    
    **Рисунок 1** . Установка разрешений для общего ресурса перемещаемых профилей пользователей
10. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Свойства управления** установите для параметра "Использование папки" значение **Файлы пользователя** .
11. Если вы выбрали профиль **Общий ресурс SMB — дополнительные** , на странице **Квота** вы можете при необходимости выбрать квоту, которая будет распространяться на пользователей общего ресурса.
12. На странице **Подтверждение** нажмите кнопку **создать.**

### <a name="required-permissions-for-the-file-share-hosting-roaming-user-profiles"></a>Необходимые разрешения для общей папки, в которой размещены перемещаемые профили пользователей

| Учетная запись пользователя | Access | Применение |
|   -   |   -   |   -   |
|   Система    |  Полный доступ     |  Данная папка, вложенные папки и файлы     |
|  Администраторы     |  Полный доступ     |  Только эта папка     |
|  Создатель/владелец     |  Полный доступ     |  Только вложенные папки и файлы     |
| Группа безопасности пользователей, которым требуется обеспечить общий доступ к данным (пользователи перемещаемых профилей и компьютеры)      |  Список папок/чтение данных *(дополнительные разрешения)* <br />Создание папок/Добавление данных *(дополнительные разрешения)* |  Только эта папка     |
| Прочие группы и учетные записи   |  Нет (удаление)     |       |

## <a name="step-4-optionally-create-a-gpo-for-roaming-user-profiles"></a>Шаг 4. Создание GPO для перемещаемых профилей пользователей (при необходимости)

Если у вас еще нет объекта групповой политики для параметров перемещаемых профилей пользователей, выполните нижеописанные действия, чтобы создать для этой цели пустой GPO. Этот объект групповой политики позволит вам установить параметры перемещаемых профилей пользователей (такие, как поддержка основного компьютера, обсуждаемая отдельно), а также могут использоваться для задействования перемещаемых профилей пользователей на компьютерах, как, например, при развертывании в средах виртуальных рабочих столов или со службами удаленных рабочих столов.

Вот как создать объект групповой политики для перемещаемых профилей пользователей:

1. Откройте диспетчер сервера на компьютере с установленным компонентом управления групповой политикой.
2. В меню **Сервис** выберите **Управление Групповая политика**. Появится окно управления групповыми политиками.
3. Щелкните правой кнопкой мыши домен или подразделение, в котором нужно настроить перемещаемые профили пользователей, а затем выберите **создать объект GPO в этом домене и свяжите его**.
4. В диалоговом окне **Создание объекта групповой политики** введите имя объекта групповой политики (например, **Параметры перемещаемого профиля пользователя**), а затем нажмите кнопку **ОК**.
5. Щелкните правой кнопкой мыши по новому объекту групповой политики и уберите флажок **Связь включена** . Это исключит применение GPO до завершения его настройки.
6. Выберите GPO. В разделе **Фильтрация безопасности** на вкладке **область** выберите **прошедшие проверку пользователи**и нажмите кнопку **Удалить** , чтобы объект групповой политики не применялся ко всем.
7. В разделе **Фильтрация безопасности** выберите **Добавить**.
8. В диалоговом окне **Выбор пользователя, компьютера или группы** введите имя группы безопасности, созданной на шаге 1 (например, **перемещаемые профили пользователей и компьютеры**), а затем нажмите кнопку **ОК**.
9. Перейдите на вкладку Делегирование, выберите **Добавить**, введите **прошедшие проверку пользователи**, нажмите кнопку **ОК**, а затем еще раз нажмите кнопку **ОК** , чтобы принять разрешения на чтение по умолчанию.
    
    Этот шаг необходим из-за изменений в безопасности, внесенных в [MS16-072](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016).

>[!IMPORTANT]
>Из-за изменений в системе безопасности, внесенных в [MS16-072A](https://support.microsoft.com/help/3163622/ms16-072-security-update-for-group-policy-june-14%2c-2016), необходимо предоставить группе аутентифицированных пользователей делегированные разрешения на чтение GPO. в противном случае объект GPO не будет применен к пользователям или уже ПРИМЕНЕН, GPO будет удален, перенаправлен профили пользователей обратно на локальный компьютер. Дополнительные сведения см. в разделе [deploying групповая политика Security Update MS16-072](https://blogs.technet.microsoft.com/askds/2016/06/22/deploying-group-policy-security-update-ms16-072-kb3163622/).

## <a name="step-5-optionally-set-up-roaming-user-profiles-on-user-accounts"></a>Шаг 5. Настройка перемещаемых профилей в учетных записях пользователей (при необходимости)

Если вы производите развертывание перемещаемых профилей для учетных записей пользователей, выполните нижеописанные действия, чтобы указать перемещаемые профили пользователей для учетных записей в доменных службах Active Directory. При развертывании перемещаемых профилей пользователей на компьютерах, как правило, это выполняется для службы удаленных рабочих столов или виртуализованных развертываний настольных систем, вместо [этого используйте процедуру, описанную в шаге 6. При необходимости настройте перемещаемые профили пользователей на компьютерах](#step-6-optionally-set-up-roaming-user-profiles-on-computers).

> [!NOTE]
> Если вы настраиваете перемещаемые профили для учетных записей пользователей, используя Active Directory, или для компьютеров, используя групповую политику, приоритет отдается настройке политики на компьютере.

Вот как можно настроить перемещаемые профили пользователей для учетных записей пользователей:

1. В центре администрирования Active Directory перейдите в контейнер **Пользователи** (или в контейнер подразделений) в соответствующем домене.
2. Выберите все пользователи, которым необходимо назначить перемещаемый профиль пользователя, щелкните правой кнопкой мыши пользователей и выберите пункт **Свойства**.
3. В разделе **профиль** установите флажок **путь к профилю:** , а затем введите путь к общей папке `%username%` , в которой вы хотите сохранить перемещаемый профиль пользователя, а затем (которая автоматически заменяется именем пользователя в первом время входа пользователя в систему). Пример:
    
    `\\fs1.corp.contoso.com\User Profiles$\%username%`
    
    Чтобы указать обязательный перемещаемый профиль пользователя, укажите путь к файлу NTuser. Man, созданному ранее, `fs1.corp.contoso.comUser Profiles$default`например. Дополнительные сведения см. в статье [создание обязательных профилей пользователей](https://docs.microsoft.com/windows/client-management/mandatory-user-profile).
4. Нажмите кнопку **ОК**.

> [!NOTE]
> По умолчанию при использовании перемещаемых профилей пользователей разрешается развертывание всех приложений на основе среды выполнения Windows® (Магазин Windows). Однако при использовании специальных профилей приложения не развертываются по умолчанию. Специальный статус имеют профили, изменения в которых сбрасываются после выхода пользователя.
> <br><br>Чтобы убрать ограничения на развертывание приложений для специальных профилей, включите параметр политики **Разрешить операции развертывания для специальных профилей** (расположен по следующему адресу: Конфигурация компьютера\Политики\Административные шаблоны\Компоненты Windows\Развертывание пакетов приложений). Однако при таком сценарии развернутые приложения будут хранить на компьютере определенные данные, которые могут накапливаться, например, если с одним ПК работают сотни пользователей. Чтобы очистить приложения, выберите или разработайте средство, использующее API [клеануппаккажефорусерасинк](https://msdn.microsoft.com/library/windows/apps/windows.management.deployment.packagemanager.cleanuppackageforuserasync.aspx) для очистки пакетов приложений для пользователей, у которых больше нет профиля на компьютере.
> <br><br>Подробную информацию о приложениях Магазина Windows см. в разделе [Управление клиентским доступом к Магазину Windows](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh832040(v=ws.11)>).

## <a name="step-6-optionally-set-up-roaming-user-profiles-on-computers"></a>Шаг 6. Настройка перемещаемых профилей пользователей на компьютерах (при необходимости)

Если вы выполняете развертывание перемещаемых профилей пользователей для компьютеров, как, например, при использовании служб удаленных рабочих столов или развертывании виртуальных рабочих столов, выполните нижеописанные действия. При развертывании перемещаемых профилей пользователей для учетных записей пользователей используйте процедуру, описанную [в шаге 5. При необходимости настройте перемещаемые профили пользователей в учетных](#step-5-optionally-set-up-roaming-user-profiles-on-user-accounts)записях пользователей.

Групповая политика можно использовать для применения перемещаемых профилей пользователей к компьютерам под управлением Windows 8.1, Windows 8, Windows 7, Windows Vista, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008.

> [!NOTE]
> Если вы настраиваете перемещаемые профили пользователей для компьютеров, используя групповую политику, и для учетных записей пользователей, используя Active Directory, приоритет отдается настройке политики на компьютере.

Вот как можно настроить перемещаемые профили пользователей на компьютерах:

1. Откройте диспетчер сервера на компьютере с установленным компонентом управления групповой политикой.
2. В меню **Сервис** выберите пункт **Управление Групповая политика**. Появится групповая политика управления.
3. В групповая политика управления щелкните правой кнопкой мыши объект групповой политики, созданный на шаге 3 (например, **параметры перемещаемых профилей пользователей**), и выберите **изменить**.
4. В окне редактора управления групповыми политиками перейдите к разделу **Конфигурация компьютера** > **Политики** > **Административные шаблоны** > **Система** > **Профили пользователей**.
5. Щелкните правой кнопкой мыши **параметр задать путь к перемещаемому профилю для всех пользователей, которые подписывается на этот компьютер** , и выберите **изменить**.
    > [!TIP]
    > Такие программы, как Windows PowerShell, по умолчанию используют домашнюю папку пользователя, если она настроена. Вы можете настроить альтернативное локальное или сетевое расположение для каждого пользователя в разделе **Домашняя папка** параметров учетной записи пользователя в доменных службах Active Directory. Чтобы настроить расположение домашней папки для всех пользователей компьютера, работающего под Windows 8.1, Windows 8, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2 или Windows Server 2012 в среде виртуальных рабочих столов, включите **домашнюю папку пользователя** . параметр политики, а затем укажите общую папку и букву диска для сопоставлений (или укажите локальную). Не используйте переменные среды или многоточия. В конце пути, указанного при входе пользователя, следует добавить пользовательский псевдоним.
6. В диалоговом окне **Свойства** выберите **включено** .
7. В поле "Пользователи, выполнившие **Вход на этот компьютер" должен использовать этот путь** к перемещаемому профилю, введите путь к общей папке, в которой вы хотите сохранить перемещаемый профиль пользователя `%username%` , а затем (которая автоматически заменяется именем пользователя, При первом входе пользователь выполняет вход. Пример:

    `\\fs1.corp.contoso.com\User Profiles$\%username%`

    Чтобы указать обязательный перемещаемый профиль пользователя, который является предварительно настроенным профилем, в котором пользователи не могут вносить постоянные изменения (изменения сбрасываются после выхода пользователя), укажите путь к файлу NTuser. Man, созданному ранее, `\\fs1.corp.contoso.com\User Profiles$\default`например. Дополнительные сведения см. в разделе [Создание обязательного профиля пользователя](https://docs.microsoft.com/windows/client-management/mandatory-user-profile).
8. Нажмите кнопку **ОК**.

## <a name="step-7-optionally-specify-a-start-layout-for-windows-10-pcs"></a>Шаг 7. При необходимости укажите начальный макет для компьютеров с Windows 10

С помощью групповая политика можно применить определенную структуру меню "Пуск", чтобы пользователи могли видеть тот же начальный макет на всех ПК. Если пользователи входят на несколько компьютеров и вы хотите, чтобы они имели согласованный начальный макет на разных компьютерах, убедитесь, что объект групповой политики применяется ко всем компьютерам.

Чтобы указать начальный макет, выполните следующие действия.

1. Обновите компьютеры с Windows 10 до Windows 10 версии 1607 (также известной как годовщина обновления) или более поздних версий и установите пакет обновления Март 14, 2017 ([KB4013429](https://support.microsoft.com/kb/4013429)) или более поздняя версия.
2. Создайте XML-файл макета полного или частичного меню "Пуск". Дополнительные сведения см. в разделе [Настройка и экспорт начального макета](https://docs.microsoft.com/windows/configuration/customize-and-export-start-layout).
    * При указании *полного* начального макета пользователь не может настраивать какую-либо часть меню "Пуск". При указании макета *частичного* запуска пользователи могут настраивать все зафиксированные группы плиток, кроме указанных. Однако при частичном начальном макете пользовательские настройки меню Пуск не будут перемещаться на другие компьютеры.
3. Используйте групповая политика, чтобы применить настроенный начальный макет к объекту групповой политики, созданному для перемещаемых профилей пользователей. Дополнительные сведения см. в разделе [использование групповая политика для применения настраиваемого макета начала в домене](https://docs.microsoft.com/windows/configuration/customize-windows-10-start-screens-by-using-group-policy#bkmk-domaingpodeployment).
4. Используйте групповая политика для установки следующего значения реестра на компьютерах с Windows 10. Дополнительные сведения см. в разделе [Настройка элемента реестра](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753092(v=ws.11)>).

| **Действие**   | **Update**                  |
| ------------ | ------------                |
| Hive         | **РАЗДЕЛА**      |
| Путь к ключу     | **софтваре\микрософт\виндовс\куррентверсион\експлорер** |
| Значение   | **спеЦиалроаминговерридеалловед** |
| Тип значения   | **REG_DWORD**               |
| «Значение»   | **1** (или **0** для отключения) |
| Base         | **Decimal**                 |

5. Используемых Включите оптимизацию первого входа, чтобы быстрее выполнять вход для пользователей. Сведения о том, как это сделать, см. в разделе [применение политик для улучшения времени входа](https://docs.microsoft.com/windows/client-management/mandatory-user-profile#apply-policies-to-improve-sign-in-time).
6. Используемых Сократите время входа, удалив ненужные приложения из базового образа Windows 10, который используется для развертывания клиентских компьютеров. В Windows Server 2019 и Windows Server 2016 отсутствуют предварительно подготовленные приложения, поэтому этот шаг можно пропустить на образах сервера.
    - Чтобы удалить приложения, используйте командлет [Remove-аппкспровисионедпаккаже](https://docs.microsoft.com/powershell/module/dism/remove-appxprovisionedpackage?view=win10-ps) в Windows PowerShell, чтобы удалить следующие приложения. Если компьютеры уже развернуты, вы можете создать скрипты для удаления этих приложений с помощью команды [Remove-AppxPackage](https://docs.microsoft.com/powershell/module/appx/remove-appxpackage?view=win10-ps).
    
      - 8wekyb3d8bbwe Microsoft.\_виндовскоммуникатионсаппс
      - 8wekyb3d8bbwe Microsoft.\_бингвеасер
      - 8wekyb3d8bbwe Microsoft.\_десктопаппинсталлер
      - \_8wekyb3d8bbwe Microsoft.
      - Microsoft. Windows. Photos\_8wekyb3d8bbwe
      - 8wekyb3d8bbwe Microsoft.\_виндовскамера
      - 8wekyb3d8bbwe Microsoft.\_виндовсфидбаккхуб
      - 8wekyb3d8bbwe Microsoft.\_виндовссторе
      - 8wekyb3d8bbwe Microsoft.\_ксбоксапп
      - 8wekyb3d8bbwe Microsoft.\_ксбоксидентитипровидер
      - 8wekyb3d8bbwe Microsoft.\_зунемусик

>[!NOTE]
>Удаление этих приложений сокращает время входа, но вы можете оставить их установленными, если в развертывании требуются какие-либо из них.

## <a name="step-8-enable-the-roaming-user-profiles-gpo"></a>Шаг 8. Включение GPO перемещаемых профилей пользователей

Если вы настраиваете перемещаемые профили пользователей на компьютерах с помощью групповой политики, или изменили другие параметры перемещаемых профилей пользователей с помощью групповой политики, выполните нижеописанные действия, чтобы включить GPO и применить его к затронутым пользователям.

>[!TIP]
>Если вы планируете реализовать поддержку основных компьютеров, сделайте это сейчас, прежде чем включать объект групповой политики. предотвратить копирование данных пользователя на неосновные компьютеры до включения поддержки основного компьютера. Сведения о конкретных параметрах политики см. в разделе [Развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md).

Вот как можно включить объект групповой политики перемещаемого профиля пользователя:

1. Откройте "Управление групповой политикой".
2. Щелкните созданный объект групповой политики правой кнопкой мыши и выберите пункт **связь включена**. Рядом с соответствующим пунктом меню появится флажок.

## <a name="step-9-test-roaming-user-profiles"></a>Шаг 9. Проверка перемещаемых профилей пользователей

Для проверки перемещаемых профилей пользователей войдите в учетную запись компьютера, на котором имеется настроенная для работы с перемещаемыми профилями пользователей учетная запись, или войдите в систему на компьютере, настроенном для работы с перемещаемыми профилями пользователей. После этого убедитесь, что профиль перенаправляется.

Вот как можно протестировать перемещаемые профили пользователей:

1. Войдите в систему на основном компьютере (если вы включили поддержку основного компьютера) при помощи учетной записи пользователя, для которого вы активировали перемещаемые профили пользователей. Если вы включили перемещаемые профили пользователей на определенных компьютерах, войдите в систему на одном из них.
2. Если пользователь уже вошел в систему, откройте командную строку с повышенными привилегиями и введите нижеприведенную команду, чтобы убедиться, что на компьютере используются последние настройки групповой политики.
    
    ```PowerShell
    GpUpdate /Force
    ```
3. Чтобы убедиться, что профиль пользователя является перемещаемым, откройте **Панель управления**, **выберите система и безопасность**, выберите **система**, выберите **Дополнительные параметры системы**, в разделе Профили пользователей выберите **Параметры** , а затем найдите  **Перемещение** в столбце **тип** .

## <a name="appendix-a-checklist-for-deploying-roaming-user-profiles"></a>Приложение A. Контрольный список для развертывания перемещаемых профилей пользователей

| Status                     | Action                                                |
| ---                        | ------                                                |
| ☐<br>☐<br>☐<br>☐<br>☐   | 1. Подготовка домена<br>— Присоединение компьютеров к домену<br>-Включить использование отдельных версий профиля<br>— Создание учетных записей пользователей<br>— (Необязательно) развертывание перенаправления папок |
| ☐<br><br><br>             | 2. Создание группы безопасности для перемещаемых профилей пользователей<br>-Имя группы:<br>Участниками |
| ☐<br><br>                 | 3. Создание файлового ресурса для перемещаемых профилей пользователей<br>— Имя файлового ресурса: |
| ☐<br><br>                 | 4. Создание GPO для перемещаемых профилей пользователей<br>-Имя объекта групповой политики:|
| ☐                         | 5. Настройка параметров политики перемещаемых профилей пользователей    |
| ☐<br>☐<br>☐              | 6. Включить перемещаемые профили пользователей<br>— Включено в AD DS учетных записей пользователей?<br>— Включено в групповая политика для учетных записей компьютеров?<br> |
| ☐                         | 7. Используемых Укажите обязательный макет начала для компьютеров с Windows 10 |
| ☐<br>☐<br><br>☐<br><br>☐ | 8. Используемых Включить поддержку основного компьютера<br>— Назначение основных компьютеров пользователям;<br>— Расположение сопоставлений пользователя и основного компьютера:<br>-(Необязательно) Включение поддержки основного компьютера для перенаправления папок<br>-Компьютер или на основе пользователя?<br>-(Необязательно) Включение поддержки основного компьютера для перемещаемых профилей пользователей |
| ☐                        | 9. Включение GPO перемещаемых профилей пользователей                |
| ☐                        | 10. Проверка перемещаемых профилей пользователей                         |

## <a name="appendix-b-profile-version-reference-information"></a>Приложение B. Справочная информация о версиях профилей

У каждого профиля есть версия профиля, приблизительно соответствующая версии Windows, в которой используется профиль. Например, Windows 10, версия 1703 и версия 1607 используют. Версия профиля V6. Корпорация Майкрософт создает новую версию профиля только при необходимости для обеспечения совместимости, поэтому не каждая версия Windows включает новую версию профиля.

В следующей таблице указан список расположений перемещаемых профилей пользователей в разных версиях Windows.

| Версия операционной системы | Расположение перемещаемого профиля пользователя |
| --- | --- |
| Windows XP и Windows Server 2003 | ```\\<servername>\<fileshare>\<username>``` |
| Windows Vista и Windows Server 2008 | ```\\<servername>\<fileshare>\<username>.V2``` |
| Windows 7 и Windows Server 2008 R2 | ```\\<servername>\<fileshare>\<username>.V2``` |
| Windows 8 и Windows Server 2012 | ```\\<servername>\<fileshare>\<username>.V3```(после применения обновления программного обеспечения и раздела реестра)<br>```\\<servername>\<fileshare>\<username>.V2```(перед применением обновления программного обеспечения и раздела реестра) |
| Windows 8.1 и Windows Server 2012 R2 | ```\\<servername>\<fileshare>\<username>.V4```(после применения обновления программного обеспечения и раздела реестра)<br>```\\<servername>\<fileshare>\<username>.V2```(перед применением обновления программного обеспечения и раздела реестра) |
| Windows 10 | ```\\<servername>\<fileshare>\<username>.V5``` |
| Windows 10, версия 1703 и 1607 | ```\\<servername>\<fileshare>\<username>.V6``` |

## <a name="appendix-c-working-around-reset-start-menu-layouts-after-upgrades"></a>Приложение В. Идет обход макетов меню "Пуск" после обновления

Ниже приведены некоторые способы обхода макетов меню "Пуск" после обновления на месте.

- Если только один пользователь когда-либо использует устройство, а ИТ-администратор использует управляемую стратегию развертывания ОС, например SCCM, они могут сделать следующее:
    
  1. Экспорт макета меню "Пуск" с помощью Export-Startlayout перед обновлением 
  2. Импорт макета меню "Пуск" с помощью команды Import-StartLayout после OOBE, но перед входом пользователя  
 
     > [!NOTE] 
     > При импорте StartLayout изменяется профиль пользователя по умолчанию. Все профили пользователей, созданные после импорта, получит импортированный начальный макет.
 
- ИТ – администраторы могут использовать для управления макетом запуска групповая политика. Использование групповая политика предоставляет централизованное решение для управления для применения стандартизированного макета запуска для пользователей. Существует два режима использования групповая политика для управления запуском. Полное блокирование и частичное блокирование. Сценарий полного блокировки не позволяет пользователю вносить изменения в макет начала. Сценарий частичного блокирования позволяет пользователю вносить изменения в определенную область запуска. Дополнительные сведения см. в разделе [Настройка и экспорт начального макета](https://docs.microsoft.com/windows/configuration/customize-and-export-start-layout).
        
   > [!NOTE]
   > Пользователь, внесющий изменения в сценарий частичного блокирования, по-прежнему будет потерян во время обновления.

- Разрешить сброс макета начала и разрешить пользователям перенастроить запуск. Конечным пользователям может быть отправлено уведомление по электронной почте или другое уведомление, чтобы после обновления операционной системы до минимального воздействия вы могли выполнить сброс их начальных макетов. 

# <a name="change-history"></a>Журнал изменений

В следующей таблице представлены наиболее важные изменения этого раздела.

| Date | Описание |`Reason`|
| --- | ---         | ---   |
| 1 мая, 2019 | Добавлены обновления для Windows Server 2019 |
| 10 апреля, 2018 | Добавлено обсуждение, когда пользовательские настройки для запуска теряются после обновления операционной системы на месте|Известная ошибка выноски. |
| 13 марта, 2018 | Обновлено для Windows Server 2016 | Перемещен из библиотеки предыдущих версий и обновлен для текущей версии Windows Server. |
| 13 апреля, 2017 | Добавлены сведения о профиле для Windows 10, версия 1703 и пояснения о том, как работают версии перемещаемого профиля при обновлении операционных систем — см. [рекомендации при использовании перемещаемых профилей пользователей в нескольких версиях Windows](#considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows). | Отзывы пользователей. |
| Март 14, 2017 | Добавлен необязательный шаг для указания обязательного начального макета для компьютеров Windows [10 в приложении а. Контрольный список для развертывания перемещаемых профилей](#appendix-a-checklist-for-deploying-roaming-user-profiles)пользователей. |Изменения функций в последнем обновлении Windows. |
| 23 января 2017 г. | Добавлен шаг [4. При необходимости создайте объект групповой политики для перемещаемых](#step-4-optionally-create-a-gpo-for-roaming-user-profiles) профилей пользователей, чтобы делегировать разрешения на чтение пользователям, прошедшим проверку подлинности, что теперь требуется из-за групповая политика обновления безопасности.|Изменения безопасности для обработки групповая политика. |
| 29 декабря, 2016 | Добавлена ссылка на [шаге 8. Включите объект групповой политики](#step-8-enable-the-roaming-user-profiles-gpo) перемещаемых профилей пользователей, чтобы упростить получение сведений о настройке групповая политика для основных компьютеров. Также исправлено несколько ссылок на шаги 5 и 6, которые имели неверные номера.|Отзывы пользователей. |
| 5 декабря 2016 г. | Добавлены сведения о настройке меню "Пуск" проблемы роуминга. | Отзывы пользователей. |
| 6 июля, 2016 | Добавлены суффиксы версии профиля Windows 10 в [приложении б: Справочные сведения о](#appendix-b-profile-version-reference-information)версии профиля. Также удалены Windows XP и Windows Server 2003 из списка поддерживаемых операционных систем. | Обновления для новых версий Windows и удаленные сведения о версиях Windows, которые больше не поддерживаются. |
| 7 июля 2015 г. | Добавлены требования и последовательность действий для отключения постоянной доступности при использовании кластеризованного файлового сервера. | Кластеризованные общие папки производительнее для небольших операций записи (которые типичны для перемещаемых профилей пользователей), если постоянная доступность отключена. |
| 19 марта 2014 г. | Суффиксы версии профиля с прописными буквами (. V2,. V3,. V4) в [приложении б: Справочные сведения о](#appendix-b-profile-version-reference-information)версии профиля. | Несмотря на то, что в Windows регистр не учитывается, при использовании NFS с файловым ресурсом важно, чтобы суффикс профиля был правильным регистром. |
| 9 октября 2013 г. | Пересмотрено для Windows Server 2012 R2 и Windows 8.1, были разъяснены некоторые вещи и добавлены [рекомендации по использованию перемещаемых профилей пользователей в нескольких версиях Windows](#considerations-when-using-roaming-user-profiles-on-multiple-versions-of-windows) и [приложении б: Разделы сведений о](#appendix-b-profile-version-reference-information) версии профиля. | Обновления для новой версии; Отзывы пользователей. |

## <a name="more-information"></a>Дополнительные сведения

- [Развертывание перенаправления папок, автономные файлы и перемещаемых профилей пользователей](deploy-folder-redirection.md)
- [Развертывание основных компьютеров для перенаправления папок и перемещаемых профилей пользователей](deploy-primary-computers.md)
- [Реализация управления пользовательской областью](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc784645(v=ws.10)>)
- [Инструкция Microsoft Support для реплицированных данных профиля пользователя](https://blogs.technet.microsoft.com/askds/2010/09/01/microsofts-support-statement-around-replicated-user-profile-data/)
- [Загружать неопубликованные приложения с помощью DISM](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-8.1-and-8/hh852635(v=win.10)>)
- [Устранение неполадок упаковки, развертывания и запроса приложений на основе среда выполнения Windows](https://msdn.microsoft.com/library/windows/desktop/hh973484.aspx)