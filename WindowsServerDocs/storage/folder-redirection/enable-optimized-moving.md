---
title: Включить оптимизированные перемещения перенаправленных папок
description: Как выполнить оптимизированное Перемещение перенаправленных папок в новый файловый ресурс.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 09/10/2018
ms.localizationpriority: medium
ms.openlocfilehash: 6c54fee98247b1ce0aa3ef3a2502cf18f314e763
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71394369"
---
# <a name="enable-optimized-moves-of-redirected-folders"></a>Включить оптимизированные перемещения перенаправленных папок

>Относится к: Windows 10, Windows 8, Windows 8.1, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server (половина ежегодного канала)

В этом разделе описывается, как выполнить оптимизированное Перемещение перенаправленных папок (перенаправление папок) в новую общую папку. Если этот параметр политики включен, то когда администратор перемещает общую папку с перенаправленными папками и обновляет целевой путь перенаправленных папок в групповая политика, кэшированное содержимое просто переименовывается в локальном кэше автономные файлы без задержек или потенциальная потеря данных для пользователя.

Ранее администраторы могли изменить целевой путь к перенаправленным папкам в групповая политика и позволить клиентским компьютерам копировать файлы при следующем входе в систему соответствующего пользователя, что приводит к отложенному входу. Кроме того, администраторы могут переместить общую папку и обновить целевой путь перенаправленных папок в групповая политика. Однако все изменения, внесенные локально на клиентских компьютерах между началом перемещения и первой синхронизацией после перемещения, будут потеряны.

## <a name="prerequisites"></a>Предварительные требования

Для оптимизированного перемещения предъявляются следующие требования.

- Необходимо настроить перенаправление папок. Дополнительные сведения см. [в статье Развертывание перенаправления папок с помощью автономные файлы](deploy-folder-redirection.md).
- Клиентские компьютеры должны работать под управлением Windows 10, Windows 8.1, Windows 8, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012 или Windows Server (половина ежегодного канала).

## <a name="step-1-enable-optimized-move-in-group-policy"></a>Шаг 1. Включить оптимизированное перемещение в групповая политика

Чтобы оптимизировать перемещение данных перенаправления папок, используйте групповая политика для включения **оптимизированного перемещения содержимого в кэше автономные файлы для параметра политики изменения пути сервера перенаправления папок** для соответствующего объекта Групповая политика (GPO). Если настроить этот параметр политики в значение " **отключено** " или " **не настроено** ", клиент скопирует все содержимое перенаправления папок в новое расположение, а затем удалит содержимое из старого расположения при изменении пути к серверу.

Вот как можно включить оптимизированное Перемещение перенаправленных папок:

1. В групповая политика управления щелкните правой кнопкой мыши объект групповой политики, созданный для параметров перенаправления папок (например, " **Перенаправление папок" и "параметры перемещаемых профилей пользователей**"), а затем выберите **изменить**.
2. В разделе **Конфигурация пользователя**перейдите к разделу **политики**, затем **Административные шаблоны**, затем **система**и **Перенаправление папок**.
3. Щелкните правой кнопкой мыши **параметр Включить оптимизированное перемещение содержимого в кэше автономные файлы, чтобы изменить путь к серверу перенаправления папок**, а затем выберите **изменить**.
4. Выберите **включено**и нажмите кнопку **ОК**.

## <a name="step-2-relocate-the-file-share-for-redirected-folders"></a>Шаг 2. Перемещение общей папки для перенаправленных папок

При перемещении общего файлового ресурса, содержащего перенаправленные папки пользователей, выполняется импорт, чтобы принять меры предосторожности, чтобы обеспечить правильное расположение папок.

>[!IMPORTANT]
>Если файлы пользователей используются или если полное состояние файла не сохраняется в перемещении, пользователи могут испытывать низкую производительность по мере копирования файлов по сети, конфликтов синхронизации, созданных автономные файлы, или даже потери данных.

1. Заранее уведомлять пользователей о том, что сервер, на котором размещены перенаправленные папки, изменится и порекомендует выполнить следующие действия:

      - Синхронизируйте содержимое кэша автономные файлы и устраните конфликты.
      - Откройте командную строку с повышенными привилегиями, введите **GpUpdate/target: User/Force**, а затем выйдите и снова войдите, чтобы убедиться, что на клиентский компьютер применяются последние параметры групповая политика.

        >[!NOTE]
        >По умолчанию клиентские компьютеры обновляют групповая политика каждые 90 минут, поэтому при наличии достаточного времени для получения обновленной политики клиентскими компьютерами не требуется спрашивать пользователей об использовании **GpUpdate**.
2. Удалите общую папку с сервера, чтобы убедиться, что файлы в общей папке не используются. Чтобы сделать это в диспетчер сервера, на странице **Общие ресурсы** служб файлов и хранилища щелкните правой кнопкой мыши соответствующую общую папку, а затем выберите **Удалить**.

    Пользователи будут работать в автономном режиме, используя автономные файлы до тех пор, пока перемещение не будет завершено и они получат обновленные параметры перенаправления папок из групповая политика.

3. Используя учетную запись с правами на резервное копирование, переместите содержимое файлового ресурса в новое расположение с помощью метода, который сохраняет метки времени файла, такие как программа резервного копирования и восстановления. Чтобы использовать команду **Robocopy** , откройте командную строку с повышенными привилегиями и введите следующую команду, где ```<Source>``` — текущее расположение общей папки, а ```<Destination>``` — новое расположение:

    ```PowerShell
    Robocopy /B <Source> <Destination> /Copyall /MIR /EFSRAW
    ```

    >[!NOTE]
    >Команда **xcopy** не сохраняет все состояние файла.
4. Измените параметры политики перенаправления папок, обновив целевое расположение папки для каждой перенаправляемой папки, которую требуется перенести. Дополнительные сведения см. в разделе Шаг 4 из процедуры [Развертывание перенаправления папок с помощью автономные файлы](deploy-folder-redirection.md).
5. Уведомлять пользователей о том, что сервер, на котором размещены перенаправленные папки, изменился и должен использовать команду **GpUpdate/target: User/Force** , а затем выйти и снова войти, чтобы получить обновленную конфигурацию и возобновить правильную синхронизацию файлов.

    Пользователи должны входить на все компьютеры по крайней мере один раз, чтобы обеспечить правильное расположение данных в каждом кэше автономные файлы.

## <a name="more-information"></a>Дополнительные сведения

* [Развертывание перенаправления папок с помощью автономные файлы](deploy-folder-redirection.md)
* [Развертывание перемещаемых профилей пользователя](deploy-roaming-user-profiles.md)
* [Общие сведения о перенаправлении папок, автономные файлы и перемещаемых профилях пользователей](folder-redirection-rup-overview.md)