---
title: Включение оптимизированного перемещения перенаправленных папок
description: Выполнение оптимизированного перемещения перенаправленных папок в новую общую папку.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 09/10/2018
ms.localizationpriority: medium
ms.openlocfilehash: edf714bc0d6b39dbe7c5e800e953d7820fe9abc5
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "75352610"
---
# <a name="enable-optimized-moves-of-redirected-folders"></a>Включение оптимизированного перемещения перенаправленных папок

>Применяется к: Windows 10, Windows 8, Windows 8.1, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server (Semi-annual Channel)

В этой статье описывается, как выполнить оптимизированное перемещение перенаправленных папок (перенаправление папок) в новую общую папку. Если этот параметр политики включен, то когда администратор перемещает общую папку с перенаправленными папками и обновляет целевой путь перенаправленных папок в групповой политике, кэшированное содержимое просто переименовывается в локальном кэше автономных файлов без каких-либо задержек или возможной потери данных для пользователя.

Ранее администраторы могли изменять целевой путь к перенаправленным папкам в групповой политике и позволять клиентским компьютерам копировать файлы при следующем входе соответствующего пользователя, что приводило к задержке входа. Кроме того, администраторы могут переместить общую папку и обновить целевой путь к перенаправленным папкам в групповой политике. Однако все изменения, внесенные локально на клиентских компьютерах между началом перемещения и первой синхронизацией после перемещения, будут потеряны.

## <a name="prerequisites"></a>Предварительные условия

Для оптимизированного перемещения требуется выполнить следующие условия:

- Необходимо настроить перенаправление папок. Дополнительные сведения см в статье [Развертывание перенаправления папок с помощью автономных файлов](deploy-folder-redirection.md).
- Клиентские компьютеры должны работать под управлением Windows 10, Windows 8.1, Windows 8, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012 или Windows Server (Semi-annual Channel).

## <a name="step-1-enable-optimized-move-in-group-policy"></a>Шаг 1. Оптимизация перемещения в групповой политике

Чтобы оптимизировать перемещение данных перенаправления папок, используйте параметр групповой политики **Включить оптимизированное перемещение содержимого кэша автономных файлов в случае изменения пути сервера для перенаправления папок** для соответствующего объекта групповой политики (GPO). Если задать для этого параметра политики значение **Отключено** или **Не настроено**, клиент скопирует все содержимое перенаправления папок в новое расположение, а затем удалит содержимое из старого расположения, если изменяется путь к серверу.

Чтобы включить оптимизированное перемещение перенаправленных папок, выполните следующие действия:

1. В средстве "Управление групповыми политиками" щелкните правой кнопкой мыши GPO, который вы создали для параметров перенаправления папок (например, **Folder Redirection and Roaming User Profiles Settings** (Параметры перенаправления папок и перемещаемых профилей пользователей)), а затем выберите **Изменить**.
2. В разделе **Конфигурация пользователя** перейдите к элементу **Политики**, затем выберите **Административные шаблоны**, **Система**, а затем — **Перенаправление папок**.
3. Щелкните правой кнопкой мыши **Включить оптимизированное перемещение содержимого кэша автономных файлов в случае изменения пути сервера для перенаправления папок**, а затем выберите **Изменить**.
4. Выберите **Включено**, а затем нажмите кнопку **ОК**.

## <a name="step-2-relocate-the-file-share-for-redirected-folders"></a>Шаг 2. Перемещение общей папки для перенаправляемых папок

При перемещении общей папки, содержащей перенаправленные папки пользователей, важно принять меры предосторожности, чтобы обеспечить правильное перемещение папок.

>[!IMPORTANT]
>Если файлы пользователей используются или полное состояние файла не сохраняется при перемещении, пользователи могут столкнуться с низкой производительностью при копировании файлов по сети, конфликтами синхронизации, вызванными автономными файлами, или даже потерей данных.

1. Заранее уведомите пользователей о том, что сервер, на котором размещены их перенаправленные папки, изменится, и порекомендуйте им выполнить следующие действия:

      - Синхронизировать содержимое кэша автономных файлов и устранить конфликты.
      - Открыть командную строку с повышенными привилегиями, ввести **GpUpdate /Target:User /Force**, а затем выполнить выход и повторный вход, чтобы убедиться, что к клиентскому компьютеру применены последние параметры групповой политики.

        >[!NOTE]
        >По умолчанию клиентские компьютеры обновляют групповую политику каждые 90 минут, поэтому при наличии достаточного количества времени для получения обновленной политики клиентскими компьютерами, пользователям не нужно выполнять операцию **GpUpdate**.
2. Удалите общую папку с сервера, чтобы убедиться, что в ней нет используемых файлов. Для этого в диспетчере серверов на странице **Общие папки** в разделе "Файловые службы и службы хранилища" щелкните правой кнопкой мыши соответствующую общую папку и выберите **Удалить**.

    Пользователи будут работать в автономном режиме, используя автономные файлы до тех пор, пока перемещение не будет завершено и они получат обновленные параметры перенаправления папок из групповой политики.

3. Используя учетную запись с правами резервного копирования, переместите содержимое общей папки в новое расположение с помощью метода, который позволяет сохранить временные метки файлов, например программы резервного копирования и восстановления. Чтобы воспользоваться командой **Robocopy**, откройте командную строку с повышенными привилегиями и введите указанную ниже команду, где ```<Source>``` — это текущее расположение общей папки, а ```<Destination>``` — новое расположение:

    ```PowerShell
    Robocopy /B <Source> <Destination> /Copyall /MIR /EFSRAW
    ```

    >[!NOTE]
    >Команда **Xcopy** не сохраняет все состояние файла.
4. Измените параметры политики перенаправления папок, обновив целевое расположение каждой перенаправленной папки, которую требуется перенести. Дополнительные сведения см. в разделе "Шаг 4. Настройка перенаправления папок с помощью автономных файлов" статьи [Развертывание перенаправления папок с помощью автономных файлов](deploy-folder-redirection.md).
5. Сообщите пользователям о том, что сервер, на котором размещены их перенаправленные папки, изменился и что они должны выполнить команду **GpUpdate /Target:User /Force**, а затем выйти и повторно войти, чтобы обновить конфигурацию и возобновить правильную синхронизацию файлов.

    Пользователи должны выполнить вход на каждом компьютере по крайней мере один раз, чтобы обеспечить правильное расположение данных в каждом кэше автономных файлов.

## <a name="more-information"></a>Дополнительные сведения

* [Развертывание перенаправления папок с помощью автономных файлов](deploy-folder-redirection.md)
* [Развертывание перемещаемых профилей пользователя](deploy-roaming-user-profiles.md)
* [Общие сведения о перенаправлении папок, автономных файлах и перемещаемых профилях пользователей](folder-redirection-rup-overview.md).