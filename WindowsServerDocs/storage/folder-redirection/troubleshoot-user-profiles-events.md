---
title: Устранение неполадок профилей пользователей с событиями
description: Устранение неполадок при загрузке и выгрузке профилей пользователей с помощью событий и журналов трассировки.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: 9e927a77627e786015a928d798aafee13a2cc34b
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71394380"
---
# <a name="troubleshoot-user-profiles-with-events"></a>Устранение неполадок профилей пользователей с событиями

>Относится к: Windows 10, Windows 8, Windows 8.1, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012 и Windows Server (половина ежегодного канала).

В этом разделе описывается устранение проблем с загрузкой и выгрузкой профилей пользователей с помощью событий и журналов трассировки. В следующих разделах описано, как использовать три журнала событий, в которые записываются сведения о профиле пользователя.

## <a name="step-1-checking-events-in-the-application-log"></a>Шаг 1. Проверка событий в журнале приложений

Первый шаг в устранении неполадок, связанных с загрузкой и выгрузкой профилей пользователей (включая перемещаемые профили пользователей), заключается в использовании Просмотр событий для проверки всех событий предупреждений и ошибок, которые записываются службой профилей пользователей в журнал приложений.

Вот как можно просмотреть события служб профилей пользователей в журнале приложений:

1. Запустите Просмотр событий. Для этого откройте **Панель управления**, выберите **система и безопасность**, а затем **в разделе Администрирование** выберите **Просмотреть журналы событий**. Откроется окно Просмотр событий.
2. В дереве консоли сначала перейдите в раздел **журналы Windows**, а затем — **приложение**.
3. На панели действия выберите пункт **Фильтровать текущий журнал**. Откроется диалоговое окно Фильтрация текущего журнала.
4. В поле **источники событий** установите флажок **Служба профилей пользователей** и нажмите кнопку **ОК**.
5. Ознакомьтесь с перечнем событий, обращая особое внимание на события ошибок.
6. При обнаружении значимых событий выберите ссылку "Справка в Интернете" журнала событий, чтобы отобразить дополнительные сведения и процедуры устранения неполадок.
7. Чтобы выполнить дальнейшие действия по устранению неполадок, обратите внимание на дату и время событий, а затем изучите операционный журнал (как описано в шаге 2), чтобы просмотреть сведения о том, что делает служба профиля пользователя в течение всего времени событий ошибок или предупреждений.

>[!NOTE]
>Можно спокойно проигнорировать событие службы профилей пользователей 1530 "Windows обнаружила, что файл реестра все еще используется другими приложениями или службами".

## <a name="step-2-view-the-operational-log-for-the-user-profile-service"></a>Шаг 2. Просмотр журнала операций для службы профиля пользователя

Если проблему нельзя устранить с помощью журнала приложений, используйте следующую процедуру для просмотра событий службы профиля пользователя в журнале операций. В этом журнале показаны некоторые внутренние действия службы, которые могут помочь точно определить, где в процессе загрузки или выгрузки профиля возникает проблема.

Журнал приложений Windows и операционный журнал службы профилей пользователей включены по умолчанию во всех установках Windows.

Вот как можно просмотреть операционный журнал для службы профиля пользователя:

1. В дереве консоли Просмотр событий перейдите к **журналам приложения и службы**, затем **Microsoft**, затем **Windows**, **служба профиля пользователя**и **работоспособность**.
2. Изучите события, произошедшие в течение времени событий ошибок или предупреждений, записанных в журнале приложений.

## <a name="step-3-enable-and-view-analytic-and-debug-logs"></a>Шаг 3. Включение и просмотр журналов аналитики и отладки

Если требуется больше сведений, чем в операционном журнале, можно включить журналы аналитики и отладки на затронутом компьютере. Этот уровень ведения журнала является гораздо более подробным и должен быть отключен, за исключением случаев, когда вы пытаетесь устранить проблему.

Вот как можно включить и просмотреть аналитические и отладочные журналы:

1. В области **действия** Просмотр событий выберите **вид**, а затем **Показать журналы аналитики и отладки**.
2. Перейдите в раздел **журналы приложений и служб**, затем **Microsoft**, затем **Windows**, **служба профиля пользователя**, а затем щелкните **Диагностика**.
3. Выберите **Включить журнал** и нажмите кнопку **Да**. Это позволяет вести журнал диагностики, который запустит ведение журнала.
4. Дополнительные сведения см. в разделе [Step 4. Создание и декодирование трассировки @ no__t-0 для получения дополнительных сведений о создании журнала трассировки.
5. По завершении устранения проблемы перейдите к журналу **диагностики** , выберите пункт **Отключить журнал**, выберите **представление** , а затем снимите флажок **Показать журналы аналитики и отладки** , чтобы скрыть ведение журнала аналитики и отладки.

## <a name="step-4-creating-and-decoding-a-trace"></a>Шаг 4. Создание и декодирование трассировки

Если не удается разрешить проблему с помощью событий, можно создать журнал трассировки (ETL-файл) при воспроизведении проблемы, а затем декодировать его с помощью общедоступных символов с сервера символов Майкрософт. Журналы трассировки предоставляют подробную информацию о том, что делает служба профиля пользователя, и может помочь выявить место возникновения сбоя.

Оптимальной стратегией использования трассировки ETL является предварительная запись минимально возможного журнала. После декодирования журнала выполните поиск ошибок в журнале.

Вот как можно создать и декодировать трассировку для службы профиля пользователя:

1. Войдите на компьютер, на котором возникают проблемы с пользователем, используя учетную запись, которая является членом локальной группы администраторов.
2. В командной строке с повышенными привилегиями введите следующие команды, где *\<Path @ no__t-2* — путь к локальной папке, созданной ранее, например, C: \\logs:
        
    ```PowerShell
    logman create trace -n RUP -o <Path>\RUP.etl -ets
    logman update RUP -p {eb7428f5-ab1f-4322-a4cc-1f1a9b2c5e98} 0x7FFFFFFF 0x7 -ets
    ```
3. На начальном экране выберите имя пользователя, а затем выберите **параметр Учетная запись**, чтобы не выходить из системы администратора. Если вы используете удаленный рабочий стол, закройте сеанс администратора, чтобы установить сеанс пользователя.
4. Воспроизведите проблему. Процедура воспроизведения проблемы обычно заключается в входе в систему по мере того, как пользователь столкнулся с проблемой, подписывает пользователя в автономный режим или и то, и другое.
5. После повторного создания проблемы войдите в систему с правами локального администратора.
6. В командной строке с повышенными привилегиями выполните следующую команду, чтобы сохранить журнал в ETL-файл:
  
    ```PowerShell
    logman stop -n RUP -ets
    ```
7. Введите следующую команду, чтобы экспортировать ETL-файл в файл, доступный для чтения, в текущем каталоге (возможно, в домашней папке или папке% WINDIR% \\System32):
    
    ```PowerShell
    Tracerpt <path>\RUP.etl
    ```
8. Откройте файл **Summary. txt** и файл **DumpFile (. XML** (их можно открыть в Microsoft Excel, чтобы упростить просмотр подробных сведений о журнале). Ищите события, которые включают **сбой** или **сбой**; можно спокойно пропускать строки, содержащие **неизвестное** имя события.

## <a name="more-information"></a>Дополнительные сведения

* [Развертывание перемещаемых профилей пользователя](deploy-roaming-user-profiles.md)