---
title: Потоки целостности ReFS
description: ''
author: gawatu
ms.author: jgerend
manager: dmoss
ms.date: 10/16/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: storage
ms.assetid: 1f1215cd-404f-42f2-b55f-3888294d8a1f
ms.openlocfilehash: 11f0a696fb843f5cd8b4a7ff3318c28d6c1adeb8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59871345"
---
# <a name="refs-integrity-streams"></a>Потоки целостности ReFS
>Относится к: Windows Server 2019 г., Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows Server (полугодовой канал), Windows 10

Потоки целостности — это дополнительная функция ReFS, которая проверяет и поддерживает целостность данных с помощью контрольных сумм. Хотя ReFS всегда применяет контрольные суммы для метаданных, по умолчанию ReFS не создает и не проверяет контрольные суммы для данных файлов. Потоки целостности — это необязательный компонент, который позволяет пользователям использовать контрольные суммы для данных файлов. Когда потоки целостности включены, ReFS может точно определить, являются ли данные допустимыми или они повреждены. Кроме того, ReFS и дисковые пространства могут совместно исправлять поврежденные метаданные и данные.

## <a name="how-it-works"></a>Принцип работы 

Потоки целостности можно включить для отдельных файлов, каталогов или всего тома, а параметры потока целостности можно изменить в любое время. Кроме того, параметры потока целостности для файлов и каталогов наследуются от родительских каталогов. 

После включения потоков целостности ReFS создает и поддерживает контрольную сумму для указанных файлов в метаданных этих файлов. Эта контрольная сумма позволяет ReFS проверить целостность данных перед доступом к ним. Перед возвратом любых данных, для которых включены потоки целостности, ReFS сначала вычисляет их контрольную сумму:

![Вычислить контрольную сумму для файла данных](media/compute-checksum.gif)

Затем эта сумма сравнивается с контрольной суммой в метаданных файла. Если контрольные суммы совпадают, данные помечается как допустимые и возвращаются пользователю. Если суммы не совпадают, данные повреждены. Устойчивость тома определяет, как ReFS реагирует на повреждения.

- Если ReFS подключена к неустойчивому пространству или обычному диску, ReFS возвращает пользователю ошибку без поврежденных данных. 
- Если ReFS подключена к устойчивому зеркалу или пространству с контролем четности, ReFS попытается исправить повреждение. 
    - Если попытка будет выполнена успешно, ReFS применяет корректирующую запись для восстановления целостности данных и возвращает приложению допустимые данные. Приложение так и не узнает о повреждениях.
    - Если попытка оказалась неудачной, ReFS возвращает ошибку. 

ReFS записывает все повреждения в системный журнал событий, в котором также указывается, были ли повреждения исправлены. 

![Корректирующие записи восстанавливает целостность данных](media/corrective-write.gif)

## <a name="performance"></a>Производительность 

Хотя потоки целостности улучшают целостность данных системы, они также снижают производительность. Это вызвано несколькими причинами.
- Если потоки целостности включены, все операции записи становятся операциями типа «выделить при записи». Несмотря на то что это позволяет избежать ограничений с чтением, изменением и записью, так как ReFS не требуется считывать или изменять какие-либо имеющиеся данные, файловые данные часто будут фрагментированными, что замедляет операции чтения. 
- В зависимости от рабочей нагрузки и базового хранилища системы вычислительная стоимость расчета и проверки контрольной суммы может привести к увеличению задержки ввода-вывода. 

Поскольку потоки целостности снижают производительность, мы рекомендуем не включать их в требовательных к производительности системах. 

## <a name="integrity-scrubber"></a>Проверка целостности

Как описано выше, ReFS автоматически проверяет целостность данных перед осуществлением к ним доступа. ReFS также использует фоновое средство очистки, которое позволяет ReFS проверять редко запрашиваемые данные. Оно периодически сканирует том, пытаясь выявить скрытые повреждения и профилактически запуская процесс восстановления любых поврежденных данных.

  >[!NOTE]
  >Сканер целостности данных может проверять файловые данные только тех файлов, для которых включены потоки целостности.

По умолчанию сканер запускается каждые четыре недели, однако этот интервал можно настроить в планировщике заданий в разделе "Майкрософт > Windows> Проверка целостности данных". 

## <a name="examples"></a>Примеры
Для отслеживания и изменения параметров целостности данных файлов ReFS использует командлеты **Get-FileIntegrity** и **Set-FileIntegrity**.

### <a name="get-fileintegrity"></a>Get-FileIntegrity
Чтобы узнать, включены ли потоки целостности для данных файлов, используйте командлет **Get-FileIntegrity**. 

```PowerShell
PS C:\> Get-FileIntegrity -FileName 'C:\Docs\TextDocument.txt'
```

Вы также можете использовать командлет **Get-Item** для получения параметров потоков целостности для всех файлов в указанном каталоге. 

```PowerShell
PS C:\> Get-Item -Path 'C:\Docs\*' | Get-FileIntegrity
```

### <a name="set-fileintegrity"></a>Set-FileIntegrity
Чтобы включить или отключить потоки целостности для данных файлов, используйте командлет **Set-FileIntegrity**. 

```PowerShell
PS C:\> Set-FileIntegrity -FileName 'H:\Docs\TextDocument.txt' -Enable $True
```

Вы также можете использовать командлет **Get-Item** для установки параметров потоков целостности для всех файлов в указанном каталоге. 

```PowerShell
PS C:\> Get-Item -Path 'H\Docs\*' | Set-FileIntegrity -Enable $True 
```

Командлет **Set-FileIntegrity** также можно напрямую использовать для томов и каталогов. 

```PowerShell
PS C:\> Set-FileIntegrity H:\ -Enable $True
PS C:\> Set-FileIntegrity H:\Docs -Enable $True
```

## <a name="see-also"></a>См. также

-   [Общие сведения о reFS](refs-overview.md)
-   [Клонирование блоков reFS](block-cloning.md)
-   [Общие сведения о дисковых хранилища](../storage-spaces/storage-spaces-direct-overview.md)
