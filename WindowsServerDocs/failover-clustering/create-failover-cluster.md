---
title: создание отказоустойчивого кластера
description: Как создать отказоустойчивый кластер для Windows Server 2012 R2, Windows Server 2012, Windows Server 2016 и Windows Server 2019.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: b36f707edc08a4a8b2bc55a87c9db168e19a5487
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66810977"
---
# <a name="create-a-failover-cluster"></a>создание отказоустойчивого кластера

>Относится к: Windows Server 2019 г., Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012

В этом разделе описывается, как создать отказоустойчивый кластер с помощью оснастки диспетчера отказоустойчивости кластеров или Windows PowerShell. В нем рассматривается типичное развертывание, при котором объекты-компьютеры для кластера и связанные с ним кластерные роли создаются в доменных службах Active Directory (AD DS). Если вы развертываете кластер дисковых пространств, вместо этого см. в разделе [развертывание дисковых пространств](../storage/storage-spaces/deploy-storage-spaces-direct.md).

Можно также развернуть кластер, отсоединенный от Active Directory. Этот метод развертывания позволяет создать отказоустойчивый кластер без разрешений на создание объектов-компьютеров в AD DS или необходимости запрашивать эти объекты-компьютеры в AD DS. Он возможен только посредством Windows PowerShell и рекомендуется только в определенных сценариях. Дополнительные сведения см. в разделе о [развертывании отсоединенного от Active Directory кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

#### <a name="checklist-create-a-failover-cluster"></a>Контрольный список: создание отказоустойчивого кластера

| Состояние | Задача | Ссылка |
| ---    | ---  | ---       |
| ☐    | Проверка предварительных требований | [Проверка предварительных требований](#verify-the-prerequisites) |
| ☐    | Установка средства отказоустойчивости кластеров на всех серверах, которые необходимо добавить как узлы кластера | [Установите компонент отказоустойчивой кластеризации](#install-the-failover-clustering-feature) |
| ☐    | Запуск мастера проверки кластеров для проверки конфигурации | [Проверка конфигурации](#validate-the-configuration) |
| ☐ | Запуск мастера создания кластера для создания отказоустойчивого кластера | [Создание отказоустойчивого кластера](#create-the-failover-cluster) |
| ☐ | Создание кластерных ролей для размещения рабочих нагрузок кластера | [Создание кластерных ролей](#create-clustered-roles) |

## <a name="verify-the-prerequisites"></a>Проверка предварительных требований

Перед тем как начать, проверьте указанные ниже предварительные требования.

- Убедитесь в том, что все серверы, которые нужно добавить в качестве узлов кластера, работают под управлением одной и той же версии Windows Server.
- Изучите требования к оборудованию, чтобы убедиться в том, что ваша конфигурация поддерживается. Дополнительные сведения см. в разделе [Failover Clustering Hardware Requirements and Storage Options](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj612869(v%3dws.11)). Если вы создаете кластер с локальными дисковыми пространствами, см. в разделе [дисковые требования к оборудованию](../storage/storage-spaces/storage-spaces-direct-hardware-requirements.md).
- Чтобы добавить кластерное хранилище во время создания кластера, убедитесь, что все серверы доступа к хранилищу. (Кластерное хранилище можно добавить и после создания кластера.)
- Убедитесь в том, что все серверы, которые нужно добавить в качестве узлов кластера, присоединены к одному и тому же домену Active Directory.
- (Необязательно.) Создайте подразделение и переместите в него учетные записи компьютеров для серверов, которые нужно добавить в качестве узлов кластера. Мы рекомендуем размещать отказоустойчивые кластеры в собственном подразделении в AD DS. Это позволит лучше контролировать параметры групповой политики и шаблона безопасности, применяемые к узлам кластера. Изоляция кластеров в собственном подразделении также помогает предотвратить случайное удаление объектов-компьютеров кластера.

Кроме того, проверьте выполнение указанных ниже требований к учетным записям.

- Убедитесь в том, что учетная запись, которую вы хотите использовать для создания кластера, принадлежит пользователю домена с правами администратора на всех серверах, которые нужно добавить в качестве узлов кластера.
- Убедитесь в том, что выполняется одно из указанных ниже условий.
    - У пользователя, создающего кластер, есть разрешение на **создание объектов-компьютеров** для подразделения или контейнера, в котором размещаются серверы, которые войдут в кластер.
    - Если у пользователя нет разрешения на **создание объектов-компьютеров**, попросите администратора домена предварительно подготовить объект-компьютер кластера. Подробнее см. в разделе [Подготовка кластерных объектов-компьютеров в доменных службах Active Directory](prestage-cluster-adds.md).

> [!NOTE]
> Это требование не применяется, если вы хотите создать кластер, отсоединенный от Active Directory в Windows Server 2012 R2. Дополнительные сведения см. в разделе о [развертывании отсоединенного от Active Directory кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

## <a name="install-the-failover-clustering-feature"></a>Установка средства отказоустойчивости кластеров

Средство отказоустойчивости кластеров необходимо установить на всех серверах, которые будут добавлены как узлы отказоустойчивого кластера.

### <a name="install-the-failover-clustering-feature"></a>Установка средства отказоустойчивости кластеров

1. Запустите диспетчер сервера.
2. На **управление** меню, выберите **Добавить роли и компоненты**.
3. На **перед началом** выберите **Далее**.
4. На **Выбор типа установки** выберите **Установка ролей или компонентов**, а затем выберите **Далее**.
5. На **Выбор целевого сервера** выберите сервер, где требуется установить компонент, а затем выберите **Далее**.
6. На **Выбор ролей сервера** выберите **Далее**.
7. На странице **Выбор компонентов** установите флажок **Отказоустойчивая кластеризация**.
8. Чтобы установить средства управления отказоустойчивыми кластерами, выберите **добавить компоненты**, а затем выберите **Далее**.
9. На **подтверждение выбранных параметров установки** выберите **установить**.
<br>После установки средства отказоустойчивости кластеров не нужно перезапускать сервер.

10. По завершении установки выберите **закрыть**.
11. Повторите эту процедуру на каждом сервере, который необходимо добавить как узел отказоустойчивого кластера.

> [!NOTE]
> После установки средства отказоустойчивости кластеров рекомендуется применить последние обновления из Центра обновления Windows. Кроме того, для кластера отработки отказа на основе Windows Server 2012, просмотрите [Рекомендуемые исправления и обновления для кластеров отработки отказа на основе Windows Server 2012](https://support.microsoft.com/help/2784261/recommended-hotfixes-and-updates-for-windows-server-2012-based-failove) поддержки Майкрософт статьи и установите все соответствующие обновления.

## <a name="validate-the-configuration"></a>Проверка конфигурации

Перед созданием отказоустойчивого кластера настоятельно рекомендуется проверить конфигурацию, чтобы убедиться в том, что оборудование и его настройки совместимы с отказоустойчивой кластеризацией. Корпорация Майкрософт поддерживает кластерное решение, только если конфигурация прошла все проверочные тесты и все оборудование сертифицировано для версии Windows Server, под управлением которой работают узлы кластера.

> [!NOTE]
> Для выполнения всех тестов необходимы по крайней мере два узла. Если имеется только один узел, выполнение многих важных тестов хранилища невозможно.

### <a name="run-cluster-validation-tests"></a>Выполнить проверку кластера

1. На компьютере, на котором установлены средства управления отказоустойчивыми кластерами из средств удаленного администрирования сервера, или на сервере, на котором установлено средство отказоустойчивости кластеров, запустите диспетчер отказоустойчивости кластеров. Чтобы выполнить это действие на сервере, откройте диспетчер сервера, а затем на **средства** меню, выберите **Диспетчер отказоустойчивости кластеров**.
2. В **Диспетчер отказоустойчивости кластеров** панели в разделе **управления**выберите **проверить конфигурацию**.
3. На **перед началом работы** выберите **Далее**.
4. На **Выбор серверов или кластера** странице **введите имя** введите имя NetBIOS или полное доменное имя сервера, который планируется добавить как узел отказоустойчивого кластера и затем выберите **Добавить**. Повторите этот шаг для каждого сервера, который нужно добавить. Чтобы добавить несколько серверов одновременно, разделяйте их имена запятой или точкой с запятой. Например, введите имена в формате `server1.contoso.com, server2.contoso.com`. Когда вы закончите настройку, выберите **Далее**.
5. На **параметры тестирования** выберите **выполнить все тесты (рекомендуется)** , а затем выберите **Далее**.
6. На **Подтверждение** выберите **Далее**.

    На странице "Проверка" показано состояние выполняющихся тестов.
7. На странице **Сводка** выполните одно из указанных ниже действий.
    
      - Если результаты показывают, что тесты были пройдены успешно и конфигурация подходит для кластеризации, и вы хотите создать кластер немедленно, убедитесь, что **создать кластер, используя проверенные узлы** проверки поле, а затем выберите **Готово**. Затем перейдите к шагу 4 процедуры [Создание отказоустойчивого кластера](#create-the-failover-cluster).
      - Если в результатах есть предупреждения или сбои, выберите **отчет** для просмотра сведений и определить, какие неполадки необходимо исправить. Имейте в виду, что предупреждение в результатах определенного проверочного теста указывает на то, что данный аспект отказоустойчивого кластера поддерживается, но может не соответствовать рекомендациям.
        
        > [!NOTE]
        > Если получено предупреждение для теста «Проверка постоянного резервирования дисковых пространств», дополнительную информацию см. в записи блога [Предупреждение при проверке отказоустойчивого кластера Windows указывает на то, что диски не поддерживают постоянное резервирование дисковых пространств](https://blogs.msdn.microsoft.com/clustering/2013/05/24/validate-storage-spaces-persistent-reservation-test-results-with-warning/) .

Дополнительные сведения о тестах проверки оборудования см. в разделе [Validate Hardware for a Failover Cluster](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>).

## <a name="create-the-failover-cluster"></a>Создание отказоустойчивого кластера

Чтобы выполнить это действие, убедитесь в том, что учетная запись пользователя, с помощью которой вы вошли в систему, соответствует требованиям, указанным в подразделе [Проверка предварительных требований](#verify-the-prerequisites) этого раздела.

1. Запустите диспетчер сервера.
2. На **средства** меню, выберите **Диспетчер отказоустойчивости кластеров**.
3. В **Диспетчер отказоустойчивости кластеров** панели в разделе **управления**выберите **создания кластеров**.
    
    Откроется мастер создания кластеров.
4. На **перед началом работы** выберите **Далее**.
5. Если **Выбор серверов** откроется страница, в **введите имя** введите имя NetBIOS или полное доменное имя сервера, который планируется добавить как узел отказоустойчивого кластера и затем выберите **Добавить**. Повторите этот шаг для каждого сервера, который нужно добавить. Чтобы добавить несколько серверов одновременно, разделяйте их имена запятой или точкой с запятой. Например, введите имена в формате *server1.contoso.com; server2.contoso.com*. Когда вы закончите настройку, выберите **Далее**.
    
    > [!NOTE]
    > Если вы решили создать кластер немедленно после выполнения проверки в [конфигурации проверка процедуры](#validate-the-configuration), вы не увидите **Выбор серверов** страницы. Проверенные узлы автоматически добавляются в мастер создания кластеров, так что вводить их еще раз не нужно.
6. Если ранее вы пропустили проверку, появится страница **Предупреждение проверки** . Настоятельно рекомендуется выполнить проверку кластера. Корпорация Майкрософт поддерживает только те кластеры, которые прошли все проверочные тесты. Чтобы выполнить проверочные тесты, выберите **Да**, а затем выберите **Далее**. Выполните мастер проверки конфигурации, как описано в [проверить конфигурацию](#validate-the-configuration).
7. На странице **Точка доступа для администрирования кластера** выполните указанные ниже действия.
    
    1. В поле **Имя кластера** введите имя, которое необходимо использовать для администрирования кластера. Перед этим изучите приведенную ниже информацию.
        
          - В процессе создания кластера это имя регистрируется в качестве объекта-компьютера кластера (также известного как *объект имени кластера* или *CNO*) в доменных службах Active Directory. Если для кластера указано имя NetBIOS, объект CNO создается в том же расположении, в котором находятся объекты-компьютеры узлов кластера. Это может быть контейнер "Компьютеры" (по умолчанию) или подразделение.
          - Чтобы указать другое расположение для CNO, можно ввести различающееся имя подразделения в поле **Имя кластера** . Пример: *CN=ClusterName, OU=Clusters, DC=Contoso, DC=com*.
          - Если администратор домена предварительно подготовил CNO в подразделении, отличном от того, в котором размещаются узлы кластера, укажите различающееся имя, предоставленное администратором домена.
    2. Если на сервере нет сетевого адаптера, настроенного на использование DHCP, для отказоустойчивого кластера необходимо настроить один или несколько статических IP-адресов. Установите флажок напротив каждой сети, которую необходимо использовать для управления кластером. Выберите **адрес** поле рядом с выбранной сетью, а затем введите IP-адрес, который вы хотите назначить кластеру. Этот IP-адрес (или адреса) будет связан с именем кластера в службе доменных имен (DNS).
    3. Когда вы закончите настройку, выберите **Далее**.
8. Просмотрите параметры на странице **Подтверждение**. По умолчанию установлен флажок **Добавление всех допустимых хранилищ в кластер** . Снимите его в указанных ниже случаях.
    
      - Хранилище следует настроить позднее.
      - Вы планируете создать кластерные дисковые пространства с помощью диспетчера отказоустойчивости кластеров или командлетов отказоустойчивой кластеризации Windows PowerShell, но еще не создали дисковые пространства в файловых службах и службах хранилища. Подробнее см. в разделе [Развертывание кластерных дисковых пространств](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11)>).
9. Выберите **Далее** для создания отказоустойчивого кластера.
10. На странице **Сводка** убедитесь в том, что отказоустойчивый кластер успешно создан. Если есть предупреждения или ошибки, просмотрите сводные выходные данные или выберите **отчет** для просмотра полного отчета. Выберите **Готово**.
11. Чтобы убедиться в том, что кластер создан, проверьте, указано ли его имя в разделе **Диспетчер отказоустойчивости кластеров** в дереве навигации. Разверните имя кластера и выбрать элементы в разделе **узлы**, **хранения** или **сетей** Чтобы просмотреть связанные ресурсы.
    
    Имейте в виду, что на успешную репликацию имени кластера в службе DNS может потребоваться некоторое время. После успешной регистрации DNS и репликации, при выборе **все серверы** в диспетчере серверов имя кластера должен быть указан как сервер с **управляемости** состояние **Online** .

После создания кластера можно выполнить такие действия, как проверка конфигурации кворума кластера и создание общих томов кластера — CSV (необязательно). Дополнительные сведения см. в разделе [понимание кворума в Storage Spaces Direct](../storage/storage-spaces/understand-quorum.md) и [использование общих томов кластера в отказоустойчивом кластере](failover-cluster-csvs.md).

## <a name="create-clustered-roles"></a>Создание кластерных ролей

После создания отказоустойчивого кластера можно создать кластерные роли для размещения кластерных рабочих нагрузок.

>[!NOTE]
>Для кластерных ролей, требующих точки доступа клиента, в доменных службах Active Directory создается виртуальный объект-компьютер (VCO). По умолчанию все объекты VCO для кластера создаются в том же контейнере или подразделении, что и объект CNO. Имейте в виду, что после создания кластера объект CNO можно переместить в любое подразделение.

Вот как для создания кластерной роли:

1. Чтобы на каждом узле отказоустойчивого кластера установить роль или компонент, необходимый для кластерной роли, используйте диспетчер сервера или Windows PowerShell. Например, чтобы создать кластерный файловый сервер, установите роль файлового сервера на всех узлах кластера.
    
    В таблице ниже приведены кластерные роли, которые можно настроить в мастере высокой доступности, и соответствующие роли или компоненты сервера, которые необходимо установить.

   | Кластерная роль  | Необходимая роль или компонент  |
   | ---------       | ---------                    |
   | Сервер пространства имен     |   Пространства имен (часть роли файлового сервера)       |
   | Сервер пространства имен DFS     |  Роль DHCP-сервера       |
   | Координатор распределенных транзакций (DTC)     | Нет        |
   | Файловый сервер     |  Роль файлового сервера       |
   | Универсальное приложение     |  Не применяются       |
   | Универсальный сценарий     |   Не применяются      |
   | Универсальная служба     |   Не применяются      |
   | Брокер реплики Hyper-V     |   Роль Hyper-V      |
   | Целевой сервер iSCSI     |    Сервер цели iSCSI (часть роли файлового сервера)     |
   | iSNS-сервер     |  Компоненты службы iSNS-сервера       |
   | служба очередей сообщений     |  Компонент службы очереди сообщений       |
   | Другой сервер     |  Нет       |
   | Виртуальная машина     |  Роль Hyper-V       |
   | WINS-сервер     |   Компонент WINS-сервера      |

2. Щелкните правой кнопкой мыши в диспетчере отказоустойчивости кластеров разверните имя кластера **ролей**, а затем выберите **настроить роль**.
3. Для создания кластерной роли выполните последовательность действий, предлагаемую мастером высокой доступности.
4. Чтобы проверить, создана ли кластерная роль, на панели **Роли** убедитесь в том, что роль имеет состояние **Выполняется**. На панели "Роли" также указан узел владельца. Тестирование отработки отказа, щелкните правой кнопкой мыши роль, выберите пункт **переместить**, а затем выберите **выбрать узел**. В **переместить кластерную роль** диалоговом окне выберите необходимый узел кластера, а затем выберите **ОК**. В столбце **Узел владельца** убедитесь в том, что узел владельца изменился.

## <a name="create-a-failover-cluster-by-using-windows-powershell"></a>Создание отказоустойчивого кластера с помощью Windows PowerShell

Следующие командлеты Windows PowerShell выполните те же функции, что и выше процедур этого раздела. Введите каждый командлет в отдельной строке, даже если кажется, что из-за ограничения возможностей форматирования они переносятся по словам на другую строку.

> [!NOTE]
> Чтобы создать кластер, отсоединенный от Active Directory в Windows Server 2012 R2, необходимо использовать Windows PowerShell. Сведения о синтаксисе см. в разделе [Deploy an Active Directory-Detached Cluster](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

В приведенном ниже примере устанавливается средство отказоустойчивости кластеров.

```PowerShell
Install-WindowsFeature –Name Failover-Clustering –IncludeManagementTools
```

В приведенном ниже примере запускаются все проверочные тесты кластера на компьютерах с именами *Server1* и *Server2*.

```PowerShell
Test-Cluster –Node Server1, Server2
```

> [!NOTE]
> **Test-Cluster** командлет выводит результаты в файл журнала в текущем рабочем каталоге. Пример: C:\Users\<имя_пользователя > \AppData\Local\Temp.

В приведенном ниже примере создается отказоустойчивый кластер с именем *MyCluster* и узлами *Server1* и *Server2*; ему присваивается статический IP-адрес *192.168.1.12*, и в него добавляются все подходящие дисковые пространства.

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12
```

В приведенном ниже примере создается такой же отказоустойчивый кластер, что и в предыдущем примере, но в него не добавляются подходящие дисковые пространства.

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12 -NoStorage
```

В приведенном ниже примере создается кластер с именем *MyCluster* в подразделении *Cluster* домена *Contoso.com*.

```PowerShell
New-Cluster -Name CN=MyCluster,OU=Cluster,DC=Contoso,DC=com -Node Server1, Server2
```

Примеры добавления кластерных ролей см. в разделах [Add-ClusterFileServerRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clusterfileserverrole?view=win10-ps) и [Add-ClusterGenericApplicationRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clustergenericapplicationrole?view=win10-ps).

## <a name="more-information"></a>Дополнительные сведения

  - [Отказоустойчивая кластеризация](failover-clustering.md)
  - [Развертывание кластера Hyper-V](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj863389(v%3dws.11)>)
  - [Масштабируемый файловый сервер для данных приложений](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831349(v%3dws.11)>)
  - [Развертывание Active Directory отсоединенного кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))
  - [Использование гостевой кластеризации для высокой доступности](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn440540(v%3dws.11)>)
  - [Кластерное обновление](cluster-aware-updating.md)
  - [Новый кластер](https://docs.microsoft.com/powershell/module/failoverclusters/new-cluster?view=win10-ps)
  - [Test-Cluster](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps)
