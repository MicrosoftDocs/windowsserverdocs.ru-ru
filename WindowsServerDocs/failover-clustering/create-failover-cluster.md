---
title: создание отказоустойчивого кластера
description: Как создать отказоустойчивый кластер для Windows Server 2012 R2, Windows Server 2012, Windows Server 2016 и Windows Server 2019.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 06/06/2019
ms.localizationpriority: medium
ms.openlocfilehash: d85866284272d80727d3fdb21c6e6447bd3ded2f
ms.sourcegitcommit: 0a0a45bec6583162ba5e4b17979f0b5a0c179ab2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79322816"
---
# <a name="create-a-failover-cluster"></a>создание отказоустойчивого кластера

>Область применения: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012

В этом разделе описывается, как создать отказоустойчивый кластер с помощью оснастки диспетчера отказоустойчивости кластеров или Windows PowerShell. В нем рассматривается типичное развертывание, при котором объекты-компьютеры для кластера и связанные с ним кластерные роли создаются в доменных службах Active Directory (AD DS). Если вы развертываете кластер Локальные дисковые пространства, см. раздел [развертывание Локальные дисковые пространства](../storage/storage-spaces/deploy-storage-spaces-direct.md).

Также можно развернуть кластер, отсоединенный Active Directory. Этот метод развертывания позволяет создать отказоустойчивый кластер без разрешений на создание объектов-компьютеров в AD DS или необходимости запрашивать эти объекты-компьютеры в AD DS. Он возможен только посредством Windows PowerShell и рекомендуется только в определенных сценариях. Дополнительные сведения см. в разделе о [развертывании отсоединенного от Active Directory кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

#### <a name="checklist-create-a-failover-cluster"></a>Контрольный список: Создание отказоустойчивого кластера

| Состояние | Задача | Ссылки |
| ---    | ---  | ---       |
| ☐    | Проверка предварительных требований | [Проверка предварительных требований](#verify-the-prerequisites) |
| ☐    | Установка средства отказоустойчивости кластеров на всех серверах, которые необходимо добавить как узлы кластера | [Установка компонента отказоустойчивой кластеризации](#install-the-failover-clustering-feature) |
| ☐    | Запуск мастера проверки кластеров для проверки конфигурации | [Проверка конфигурации](#validate-the-configuration) |
| ☐ | Запуск мастера создания кластера для создания отказоустойчивого кластера | [Создание отказоустойчивого кластера](#create-the-failover-cluster) |
| ☐ | Создание кластерных ролей для размещения рабочих нагрузок кластера | [Создание кластерных ролей](#create-clustered-roles) |

## <a name="verify-the-prerequisites"></a>Проверка предварительных требований

Перед тем как начать, проверьте указанные ниже предварительные требования.

- Убедитесь в том, что все серверы, которые нужно добавить в качестве узлов кластера, работают под управлением одной и той же версии Windows Server.
- Изучите требования к оборудованию, чтобы убедиться в том, что ваша конфигурация поддерживается. Подробнее см. в разделе [Требования к оборудованию для отказоустойчивой кластеризации и варианты хранилища](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj612869(v%3dws.11)). Если вы создаете кластер Локальные дисковые пространства, см. статью [Локальные дисковые пространства требования к оборудованию](../storage/storage-spaces/storage-spaces-direct-hardware-requirements.md).
- Чтобы добавить кластерное хранилище во время создания кластера, убедитесь, что все серверы имеют доступ к хранилищу. (Кластерное хранилище можно добавить и после создания кластера.)
- Убедитесь в том, что все серверы, которые нужно добавить в качестве узлов кластера, присоединены к одному и тому же домену Active Directory.
- (Необязательно.) Создайте подразделение и переместите в него учетные записи компьютеров для серверов, которые нужно добавить в качестве узлов кластера. Мы рекомендуем размещать отказоустойчивые кластеры в собственном подразделении в AD DS. Это позволит лучше контролировать параметры групповой политики и шаблона безопасности, применяемые к узлам кластера. Изоляция кластеров в собственном подразделении также помогает предотвратить случайное удаление объектов-компьютеров кластера.

Кроме того, проверьте выполнение указанных ниже требований к учетным записям.

- Убедитесь в том, что учетная запись, которую вы хотите использовать для создания кластера, принадлежит пользователю домена с правами администратора на всех серверах, которые нужно добавить в качестве узлов кластера.
- Убедитесь в том, что выполняется одно из указанных ниже условий.
    - У пользователя, создающего кластер, есть разрешение на **создание объектов-компьютеров** для подразделения или контейнера, в котором размещаются серверы, которые войдут в кластер.
    - Если у пользователя нет разрешения на **создание объектов-компьютеров**, попросите администратора домена предварительно подготовить объект-компьютер кластера. Подробнее см. в разделе [Подготовка кластерных объектов-компьютеров в доменных службах Active Directory](prestage-cluster-adds.md).

> [!NOTE]
> Это требование не применяется, если требуется создать Active Directory отсоединенный кластер в Windows Server 2012 R2. Дополнительные сведения см. в разделе о [развертывании отсоединенного от Active Directory кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

## <a name="install-the-failover-clustering-feature"></a>Установка средства отказоустойчивости кластеров

Средство отказоустойчивости кластеров необходимо установить на всех серверах, которые будут добавлены как узлы отказоустойчивого кластера.

### <a name="install-the-failover-clustering-feature"></a>Установка средства отказоустойчивости кластеров

1. Запустите диспетчер сервера.
2. В меню **Управление** выберите команду **Добавить роли и компоненты**.
3. На странице **перед началом** выполнения нажмите кнопку **Далее**.
4. На странице **Выбор типа установки** выберите Установка на **основе ролей или компонентов**, а затем нажмите кнопку **Далее**.
5. На странице **Выбор целевого сервера** выберите сервер, на котором требуется установить компонент, и нажмите кнопку **Далее**.
6. На странице **Выбор ролей сервера** щелкните **Далее**.
7. На странице **Выбор компонентов** установите флажок **Отказоустойчивая кластеризация**.
8. Чтобы установить средства управления отказоустойчивыми кластерами, выберите **Добавить компоненты**, а затем нажмите кнопку **Далее**.
9. На странице **Подтверждение выбранных вариантов установки** нажмите кнопку **установить**.
<br>После установки средства отказоустойчивости кластеров не нужно перезапускать сервер.

10. После завершения установки нажмите кнопку **Закрыть**.
11. Повторите эту процедуру на каждом сервере, который необходимо добавить как узел отказоустойчивого кластера.

> [!NOTE]
> После установки средства отказоустойчивости кластеров рекомендуется применить последние обновления из Центра обновления Windows. Кроме того, для отказоустойчивого кластера на базе Windows Server 2012 ознакомьтесь с [рекомендуемыми исправлениями и обновлениями для отказоустойчивых кластеров на основе Windows server 2012](https://support.microsoft.com/help/2784261/recommended-hotfixes-and-updates-for-windows-server-2012-based-failove) служба поддержки Майкрософт статье и установите все применимые обновления.

## <a name="validate-the-configuration"></a>Проверка конфигурации

Перед созданием отказоустойчивого кластера настоятельно рекомендуется проверить конфигурацию, чтобы убедиться в том, что оборудование и его настройки совместимы с отказоустойчивой кластеризацией. Корпорация Майкрософт поддерживает кластерное решение, только если конфигурация прошла все проверочные тесты и все оборудование сертифицировано для версии Windows Server, под управлением которой работают узлы кластера.

> [!NOTE]
> Для выполнения всех тестов необходимы по крайней мере два узла. Если имеется только один узел, выполнение многих важных тестов хранилища невозможно.

### <a name="run-cluster-validation-tests"></a>Выполнение тестов проверки кластера

1. На компьютере, на котором установлены средства управления отказоустойчивыми кластерами из средств удаленного администрирования сервера, или на сервере, на котором установлено средство отказоустойчивости кластеров, запустите диспетчер отказоустойчивости кластеров. Чтобы сделать это на сервере, запустите диспетчер сервера, а затем в меню **Сервис** выберите **Диспетчер отказоустойчивости кластеров**.
2. В области **Диспетчер отказоустойчивости кластеров** в разделе **Управление**выберите **проверить конфигурацию**.
3. На странице **перед началом** выполнения нажмите кнопку **Далее**.
4. На странице **Выбор серверов или кластера** в поле **введите имя** введите NetBIOS-имя или полное доменное имя сервера, который планируется добавить в качестве узла отказоустойчивого кластера, а затем нажмите кнопку **добавить**. Повторите этот шаг для каждого сервера, который нужно добавить. Чтобы добавить несколько серверов одновременно, разделяйте их имена запятой или точкой с запятой. Например, введите имена в формате `server1.contoso.com, server2.contoso.com`. По завершении нажмите кнопку **Далее**.
5. На странице **Параметры тестирования** выберите **выполнить все тесты (рекомендуется)** , а затем нажмите кнопку **Далее**.
6. На странице **Подтверждение** нажмите кнопку **Далее**.

    На странице "Проверка" показано состояние выполняющихся тестов.
7. На странице **Сводка** выполните одно из указанных ниже действий.
    
      - Если результаты показывают, что тесты успешно завершены и конфигурация подходит для кластеризации, и вы хотите создать кластер немедленно, убедитесь, что установлен флажок **создать кластер, использующий проверенные узлы** , и нажмите кнопку **Готово**. Затем перейдите к шагу 4 процедуры [Создание отказоустойчивого кластера](#create-the-failover-cluster).
      - Если результаты указывают на наличие предупреждений или сбоев, выберите **Просмотреть отчет** , чтобы просмотреть сведения и определить, какие проблемы необходимо исправить. Имейте в виду, что предупреждение в результатах определенного проверочного теста указывает на то, что данный аспект отказоустойчивого кластера поддерживается, но может не соответствовать рекомендациям.
        
        > [!NOTE]
        > Если получено предупреждение для теста «Проверка постоянного резервирования дисковых пространств», дополнительную информацию см. в записи блога [Предупреждение при проверке отказоустойчивого кластера Windows указывает на то, что диски не поддерживают постоянное резервирование дисковых пространств](https://blogs.msdn.microsoft.com/clustering/2013/05/24/validate-storage-spaces-persistent-reservation-test-results-with-warning/) .

Подробнее о проверочных тестах оборудования см. в разделе [Проверка оборудования для отказоустойчивого кластера](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>).

## <a name="create-the-failover-cluster"></a>Создание отказоустойчивого кластера

Чтобы выполнить это действие, убедитесь в том, что учетная запись пользователя, с помощью которой вы вошли в систему, соответствует требованиям, указанным в подразделе [Проверка предварительных требований](#verify-the-prerequisites) этого раздела.

1. Запустите диспетчер сервера.
2. В меню **Сервис** выберите **Диспетчер отказоустойчивости кластеров**.
3. В области **Диспетчер отказоустойчивости кластеров** в разделе **Управление**выберите **создать кластер**.
    
    Откроется мастер создания кластеров.
4. На странице **перед началом** выполнения нажмите кнопку **Далее**.
5. Если появится страница **Выбор серверов** , в поле **введите имя** введите NetBIOS-имя или полное доменное имя сервера, который планируется добавить в качестве узла отказоустойчивого кластера, а затем нажмите кнопку **добавить**. Повторите этот шаг для каждого сервера, который нужно добавить. Чтобы добавить несколько серверов одновременно, разделяйте их имена запятой или точкой с запятой. Например, введите имена в формате *server1.contoso.com; server2.contoso.com*. По завершении нажмите кнопку **Далее**.
    
    > [!NOTE]
    > Если вы решили создать кластер сразу после выполнения проверки в [процедуре Проверка конфигурации](#validate-the-configuration), страница **Выбор серверов** не отображается. Проверенные узлы автоматически добавляются в мастер создания кластеров, так что вводить их еще раз не нужно.
6. Если ранее вы пропустили проверку, появится страница **Предупреждение проверки**. Настоятельно рекомендуется выполнить проверку кластера. Корпорация Майкрософт поддерживает только те кластеры, которые прошли все проверочные тесты. Чтобы выполнить проверочные тесты, выберите **Да**, а затем нажмите кнопку **Далее**. Завершите работу мастера проверки конфигурации, как описано в разделе [Проверка конфигурации](#validate-the-configuration).
7. На странице **Точка доступа для администрирования кластера** выполните указанные ниже действия.
    
    1. В поле **Имя кластера** введите имя, которое необходимо использовать для администрирования кластера. Перед этим изучите приведенную ниже информацию.
        
          - В процессе создания кластера это имя регистрируется в качестве объекта-компьютера кластера (также известного как *объект имени кластера* или *CNO*) в доменных службах Active Directory. Если для кластера указано имя NetBIOS, объект CNO создается в том же расположении, в котором находятся объекты-компьютеры узлов кластера. Это может быть контейнер "Компьютеры" (по умолчанию) или подразделение.
          - Чтобы указать другое расположение для CNO, можно ввести различающееся имя подразделения в поле **Имя кластера**. Например: *CN=ClusterName, OU=Clusters, DC=Contoso, DC=com*.
          - Если администратор домена предварительно подготовил CNO в подразделении, отличном от того, в котором размещаются узлы кластера, укажите различающееся имя, предоставленное администратором домена.
    2. Если на сервере нет сетевого адаптера, настроенного на использование DHCP, для отказоустойчивого кластера необходимо настроить один или несколько статических IP-адресов. Установите флажок напротив каждой сети, которую необходимо использовать для управления кластером. Выберите поле **адреса** рядом с выбранной сетью, а затем введите IP-адрес, который нужно назначить кластеру. Этот IP-адрес (или адреса) будет связан с именем кластера в службе доменных имен (DNS).
    
      >[!NOTE]
      > Если вы используете Windows Server 2019, у вас есть возможность использовать имя распределенной сети для кластера. Имя распределенной сети использует IP-адреса рядовых серверов вместо использования выделенного IP-адреса для кластера. По умолчанию Windows использует имя распределенной сети, если обнаруживает, что вы создаете кластер в Azure (поэтому вам не нужно создавать внутренний балансировщик нагрузки для кластера) или обычный статический или IP-адрес, если вы работаете в локальной среде. Дополнительные сведения см. в разделе [имя распределенной сети](https://blogs.windows.com/windowsexperience/2018/08/14/announcing-windows-server-2019-insider-preview-build-17733/#W0YAxO8BfwBRbkzG.97).
    
    3. По завершении нажмите кнопку **Далее**.
8. Просмотрите параметры на странице **Подтверждение**. По умолчанию установлен флажок **Добавление всех допустимых хранилищ в кластер**. Снимите его в указанных ниже случаях.
    
      - Хранилище следует настроить позднее.
      - Вы планируете создать кластерные дисковые пространства с помощью диспетчера отказоустойчивости кластеров или командлетов отказоустойчивой кластеризации Windows PowerShell, но еще не создали дисковые пространства в файловых службах и службах хранилища. Подробнее см. в разделе [Развертывание кластерных дисковых пространств](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11)>).
9. Нажмите кнопку **Далее** , чтобы создать отказоустойчивый кластер.
10. На странице **Сводка** убедитесь в том, что отказоустойчивый кластер успешно создан. Если возникли какие либо предупреждения или ошибки, просмотрите сводный вывод или выберите **Просмотреть отчет** , чтобы просмотреть весь отчет. Нажмите кнопку **Готово**.
11. Чтобы убедиться в том, что кластер создан, проверьте, указано ли его имя в разделе **Диспетчер отказоустойчивости кластеров** в дереве навигации. Можно развернуть имя кластера, а затем выбрать элементы в разделе **узлы**, **хранилище** или **сети** , чтобы просмотреть связанные ресурсы.
    
    Имейте в виду, что на успешную репликацию имени кластера в службе DNS может потребоваться некоторое время. После успешной регистрации и репликации DNS при выборе **всех серверов** в Диспетчер сервера имя кластера должно быть указано как сервер с состоянием **управляемости** в **сети**.

После создания кластера можно выполнить такие действия, как проверка конфигурации кворума кластера и создание общих томов кластера — CSV (необязательно). Дополнительные сведения см. в статьях [сведения о кворуме в Локальные дисковые пространства](../storage/storage-spaces/understand-quorum.md) и [использование общих томов кластера в отказоустойчивом кластере](failover-cluster-csvs.md).

## <a name="create-clustered-roles"></a>Создание кластерных ролей

После создания отказоустойчивого кластера можно создать кластерные роли для размещения кластерных рабочих нагрузок.

>[!NOTE]
>Для кластерных ролей, требующих точки доступа клиента, в доменных службах Active Directory создается виртуальный объект-компьютер (VCO). По умолчанию все объекты VCO для кластера создаются в том же контейнере или подразделении, что и объект CNO. Имейте в виду, что после создания кластера объект CNO можно переместить в любое подразделение.

Вот как можно создать кластерную роль:

1. Чтобы на каждом узле отказоустойчивого кластера установить роль или компонент, необходимый для кластерной роли, используйте диспетчер сервера или Windows PowerShell. Например, чтобы создать кластерный файловый сервер, установите роль файлового сервера на всех узлах кластера.
    
    В таблице ниже приведены кластерные роли, которые можно настроить в мастере высокой доступности, и соответствующие роли или компоненты сервера, которые необходимо установить.

   | Кластерная роль  | Необходимая роль или компонент  |
   | ---------       | ---------                    |
   | Сервер пространства имен     |   Пространства имен (часть роли файлового сервера)       |
   | Сервер пространства имен DFS     |  Роль DHCP-сервера       |
   | Координатор распределенных транзакций (DTC)     | Нет        |
   | Файловый сервер     |  Роль файлового сервера       |
   | Универсальное приложение     |  Не применяются       |
   | Универсальный сценарий     |   Не применяются      |
   | Универсальная служба     |   Не применяются      |
   | Брокер реплики Hyper-V     |   роль Hyper-V.      |
   | Целевой сервер iSCSI     |    Сервер цели iSCSI (часть роли файлового сервера)     |
   | iSNS-сервер     |  Компоненты службы iSNS-сервера       |
   | Очередь сообщений     |  Компонент службы очереди сообщений       |
   | Другой сервер     |  Нет       |
   | Virtual Machine     |  роль Hyper-V.       |
   | WINS-сервер     |   Компонент WINS-сервера      |

2. В диспетчер отказоустойчивости кластеров разверните узел имя кластера, щелкните правой кнопкой мыши элемент **роли**и выберите пункт **настроить роль**.
3. Для создания кластерной роли выполните последовательность действий, предлагаемую мастером высокой доступности.
4. Чтобы проверить, создана ли кластерная роль, на панели **Роли** убедитесь в том, что роль имеет состояние **Выполняется**. На панели "Роли" также указан узел владельца. Чтобы протестировать отработку отказа, щелкните правой кнопкой мыши роль, выберите пункт **переместить**, а затем выберите **пункт выбрать узел**. В диалоговом окне **Перемещение кластерной роли** выберите нужный узел кластера и нажмите кнопку **ОК**. В столбце **Узел владельца** убедитесь в том, что узел владельца изменился.

## <a name="create-a-failover-cluster-by-using-windows-powershell"></a>Создание отказоустойчивого кластера с помощью Windows PowerShell

Следующие командлеты Windows PowerShell выполняют те же функции, что и предыдущие процедуры, описанные в этом разделе. Введите каждый командлет в отдельной строке, даже если кажется, что из-за ограничения возможностей форматирования они переносятся по словам на другую строку.

> [!NOTE]
> Для создания отсоединенного Active Directory кластера в Windows Server 2012 R2 необходимо использовать Windows PowerShell. Информацию о синтаксисе см. в разделе [Развертывание отсоединенного от Active Directory кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

В приведенном ниже примере устанавливается средство отказоустойчивости кластеров.

```PowerShell
Install-WindowsFeature –Name Failover-Clustering –IncludeManagementTools
```

В приведенном ниже примере запускаются все проверочные тесты кластера на компьютерах с именами *Server1* и *Server2*.

```PowerShell
Test-Cluster –Node Server1, Server2
```

> [!NOTE]
> Командлет **Test-Cluster** выводит результаты в файл журнала в текущем рабочем каталоге. Например: C:\Users\<username > \AppData\Local\Temp.

В приведенном ниже примере создается отказоустойчивый кластер с именем *MyCluster* и узлами *Server1* и *Server2*; ему присваивается статический IP-адрес *192.168.1.12*, и в него добавляются все подходящие дисковые пространства.

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12
```

В приведенном ниже примере создается такой же отказоустойчивый кластер, что и в предыдущем примере, но в него не добавляются подходящие дисковые пространства.

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12 -NoStorage
```

В приведенном ниже примере создается кластер с именем *MyCluster* в подразделении *Cluster* домена *Contoso.com*.

```PowerShell
New-Cluster -Name CN=MyCluster,OU=Cluster,DC=Contoso,DC=com -Node Server1, Server2
```

Примеры добавления кластерных ролей см. в разделах [Add-ClusterFileServerRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clusterfileserverrole?view=win10-ps) и [Add-ClusterGenericApplicationRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clustergenericapplicationrole?view=win10-ps).

## <a name="more-information"></a>Дополнительные сведения

  - [Отказоустойчивая кластеризация](failover-clustering.md)
  - [Развертывание кластера Hyper-V](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj863389(v%3dws.11)>)
  - [Scale-Out File Server for Application Data](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831349(v%3dws.11)>) (Масштабируемый файловый сервер для данных приложений)
  - [Развертывание Active Directory отключенного кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))
  - [Использование гостевой кластеризации для обеспечения высокой доступности](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn440540(v%3dws.11)>)
  - [Кластерное обновление](cluster-aware-updating.md)
  - [Создать-кластер](https://docs.microsoft.com/powershell/module/failoverclusters/new-cluster?view=win10-ps)
  - [Тест — кластер](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps)
