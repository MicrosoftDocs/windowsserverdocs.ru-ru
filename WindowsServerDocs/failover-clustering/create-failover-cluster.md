---
title: Создание отказоустойчивого кластера
description: Инструкции по созданию отказоустойчивом кластере Windows Server 2012 R2, Windows Server 2012 и Windows Server 2016.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 11/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: f919e69488c4f2272ddd07e535ba4e2248ddf79c
ms.sourcegitcommit: 5cbaca9685720f11d896c4ca167c86e74c032feb
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/06/2018
ms.locfileid: "6068982"
---
# Создание отказоустойчивого кластера

>Область применения: Windows Server 2012 R2, Windows Server 2012, Windows Server 2016

В этом разделе показано, как создать отказоустойчивый кластер с помощью оснастки диспетчера отказоустойчивости кластеров или Windows PowerShell. В разделе описаны как правило, в котором создан объектов-компьютеров для кластера и его связанных кластерных ролей в доменных службах Active Directory (AD DS). Если вы выполняете развертывание кластера локальных дисковых пространств, вместо этого см. в разделе [Развертывания локальных дисковых пространств](../storage/storage-spaces/deploy-storage-spaces-direct.md).

Можно также развернуть кластер отсоединенной Active Directory. Этот метод развертывания позволяет создавать отказоустойчивого кластера без разрешения на создание объектов-компьютеров в Доменных службах Active Directory или при необходимости запрашивать, предварительно настроены в Доменных службах Active Directory объекты компьютера. Этот параметр доступен только через Windows PowerShell и рекомендуется использовать только для конкретных сценариев. Дополнительные сведения см. в разделе [Развертывание кластера Active Directory-Detached](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

#### Контрольный список: Создание отказоустойчивого кластера

|Состояние|Задача|Справочник|
|:---:|---|---|
|☐|Проверка необходимых компонентов|[Проверка необходимых компонентов](#verify-the-prerequisites)|
|☐|Установка функции отказоустойчивой кластеризации на каждом сервере, который вы хотите добавить в качестве узла кластера|[Установка функции отказоустойчивой кластеризации](#install-the-failover-clustering-feature)|
|☐|Запустите мастер проверки кластера для проверки конфигурации|[Проверка конфигурации](#validate-the-configuration)|
|☐|Запустите мастер создания кластера для создания отказоустойчивого кластера|[Создание отказоустойчивого кластера](#create-the-failover-cluster)|
|☐|Создание кластерных ролей на узле кластера нагрузки|[Создание кластерных ролей](#create-clustered-roles)|

## Проверка необходимых компонентов

Прежде чем начать, проверьте следующие компоненты:

- Убедитесь, что все серверы, которые вы хотите добавить в качестве узлов кластера под управлением той же версии Windows Server.
- Просмотрите требования к оборудованию, чтобы убедиться в том, что ваша конфигурация поддерживается. Дополнительные сведения см. в разделе [аппаратные требования к отказоустойчивой кластеризации и варианты хранилища](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj612869(v%3dws.11)). Если вы создаете кластера локальных дисковых пространств, см. в разделе [локальных дисковых пространств требования к оборудованию](../storage/storage-spaces/storage-spaces-direct-hardware-requirements.md).
- Добавление кластеризованных хранилища при создании кластера, убедитесь, что на всех серверах доступ к хранилищу. (Вы также можете добавить кластерные хранилища после создания кластера.)
- Убедитесь, что все серверы, которые вы хотите добавить в качестве узлов кластера присоединены к одному домену Active Directory.
- (Необязательно) Создайте подразделение (OU) и перемещения учетных записей компьютеров для серверов, которые вы хотите добавить в качестве узлов кластера в Подразделении. Рекомендуется рекомендуется поместить отказоустойчивых кластеров в отдельном Подразделении в AD DS. Это может помочь вам лучше контролировать, какие параметры групповой политики или параметров шаблона безопасности влияют на узлах кластера. Благодаря изоляции кластеры в отдельном Подразделении, он также позволяет предотвратить от случайного удаления объектов-компьютеров.

Кроме того проверьте следующие требования к учетной записи:

- Убедитесь, что учетную запись, которую вы хотите использовать для создания кластера домена пользователя, имеющего права администратора на всех серверах, которые вы хотите добавить в качестве узлов кластера.
- Убедитесь, что одно из следующих имеет значение true.
    - Пользователь, создавший кластера имеет разрешение **объектов-компьютеров создайте** Подразделением или контейнеру, где находятся серверы, образующие кластера.
    - Если пользователь не имеет разрешения **объектов-компьютеров, создать** , обратиться к администратору домена, чтобы предварительно настроить объект компьютера кластера для кластера. Дополнительные сведения см. в разделе [Prestage объектов-компьютеров в доменных службах Active Directory](prestage-cluster-adds.md).

>[!NOTE]
>Это требование не применяется, если вы хотите создать кластер отсоединенной Active Directory в Windows Server 2012 R2. Дополнительные сведения см. в разделе [Развертывание кластера Active Directory-Detached](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

## Установка функции отказоустойчивой кластеризации

Необходимо установить функции отказоустойчивой кластеризации на каждом сервере, который вы хотите добавить в качестве узла отказоустойчивого кластера.

### Установка функции отказоустойчивой кластеризации

1. Запустите Диспетчер серверов.
2. В меню " **Управление** " выберите **добавления ролей и компонентов**.
3. На странице " **перед началом** " нажмите кнопку " **Далее**".
4. На странице " **Выбор типа установки** " выберите **Установка ролей или компонентов**и нажмите кнопку **Далее**.
5. На странице " **Выбор целевого сервера** " выберите сервер, где вы хотите установить компонент и нажмите кнопку **Далее**.
6. На странице " **Выбор ролей сервера** " нажмите кнопку " **Далее**".
7. На странице " **Выбор компонентов** " установите флажок **Отказоустойчивой кластеризации** .
8. Чтобы установить средства управления отказоустойчивого кластера, выберите **Добавить компоненты**и выберите **Далее**.
9. На странице **параметров установки подтвердить** Выбор **установки**.
<br>Перезапуск сервера не является обязательным для функции отказоустойчивой кластеризации.

10. По завершении установки выберите **Закрыть**.
11. Повторите эту процедуру на каждом сервере, который вы хотите добавить в качестве узла отказоустойчивого кластера.

>[!NOTE]
>После установки функции отказоустойчивой кластеризации, рекомендуется применять последние обновления из центра обновления Windows. Кроме того для под управлением Windows Server 2012 отказоустойчивого кластера, ознакомьтесь со статьей [Рекомендуемые исправлений и обновлений для под управлением Windows Server 2012 отказоустойчивых кластеров](https://support.microsoft.com/help/2784261/recommended-hotfixes-and-updates-for-windows-server-2012-based-failove) службы поддержки Майкрософт и установить все обновления, которые применяются.

## Проверка конфигурации

Перед созданием отказоустойчивого кластера, настоятельно рекомендуется проверить конфигурацию, чтобы убедиться, что оборудовании и параметрах совместимы с отказоустойчивой кластеризации. Корпорация Майкрософт поддерживает кластерного решения только в том случае, если вся конфигурация проходит проверку все тесты, если все аппаратные сертифицированные для версии Windows Server, которая выполняется узлов кластера.

>[!NOTE]
>Необходимо иметь хотя бы два узла для выполнения всех тестов. Если у вас есть только один узел, многие из тестов, критические хранилища не будут выполняться.

### Запустить проверочные тесты кластера

1. На компьютере, который содержит средства управления отказоустойчивого кластера установлено из средства удаленного администрирования сервера или на сервере, где вы установили функции отказоустойчивой кластеризации запустите диспетчер отказоустойчивости кластеров. Для этого на сервере, запустите диспетчер серверов и выберите в меню " **Сервис** " **Диспетчер отказоустойчивости кластеров**.
2. В окне **Диспетчера отказоустойчивости кластеров** в области **управления**выберите **Проверить конфигурацию**.
3. На странице " **Приступая к работе** " нажмите кнопку " **Далее**".
4. На странице " **Выбор серверов или кластер** " в диалоговом окне **Введите имя** введите имя NetBIOS или полное доменное имя сервера, на котором вы планируете добавить в качестве узла отказоустойчивого кластера и выберите **Добавить**. Повторите это действие для каждого сервера, который вы хотите добавить. Чтобы добавить несколько серверов в то же время, имена разделяются запятыми или точками с запятой. Например введите имена в формате *server1.contoso.com, server2.contoso.com*. Когда вы закончите, нажмите кнопку **Далее**.
5. На странице **Параметров тестирования** выберите **выполнить все тесты (рекомендуется)** и нажмите кнопку **Далее**.
6. На странице **подтверждения** нажмите кнопку " **Далее**".

    На странице Проверка отображается состояние выполнения тестов.
7. На странице " **Сводка** " выполните одно из следующих действий.
    
      - Если результаты свидетельствуют об успешном завершении проверки и конфигурации подходит для кластеризации, что вы хотите создать кластер немедленно, убедитесь, что установлен флажок **Создать кластер, использующих проверенный узлы** , а затем Выберите **Готово**. Перейдите к шагу 4 процедуры [создания отказоустойчивого кластера](#create-the-failover-cluster) .
      - Если результаты показывают, что было предупреждения и ошибки, выберите **Просмотр отчета** для просмотра сведений и определить, какие проблемы должны быть исправлены. Понять, что предупреждение для конкретного проверку означает, что этот аспект отказоустойчивого кластера могут поддерживаться, но может не соответствует рекомендациям.
        
        >[!NOTE]
        >Если появляется предупреждение, и тест проверки постоянное резервирование пробелы хранилища, см. в разделе в записи блога [Предупреждение проверки отказоустойчивого кластера Windows означает, что на дисках не поддерживают постоянное резервирование для дисковых пространств](https://blogs.msdn.microsoft.com/clustering/2013/05/24/validate-storage-spaces-persistent-reservation-test-results-with-warning/) Дополнительные сведения.

Дополнительные сведения о оборудования проверочные тесты см. в разделе [Проверка оборудования для отказоустойчивого кластера](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>).

## Создание отказоустойчивого кластера

Для выполнения этого шага, убедитесь, что вход в качестве учетной записи пользователя соответствует требованиям, описанным в разделе [Проверка необходимых компонентов](#verify-the-prerequisites) в этом разделе.

1. Запустите Диспетчер серверов.
2. В меню " **Сервис** " выберите **Диспетчера отказоустойчивости кластеров**.
3. В окне **Диспетчера отказоустойчивости кластеров** в области **управления**выберите **Создать кластер**.
    
    Откроется мастер создания кластера.
4. На странице " **Приступая к работе** " нажмите кнопку " **Далее**".
5. Если откроется страница **Выберите серверы** , в поле **Введите имя** , введите имя NetBIOS или полное доменное имя сервера, на котором вы планируете добавить в качестве узла отказоустойчивого кластера и выберите **Добавить**. Повторите это действие для каждого сервера, который вы хотите добавить. Чтобы добавить несколько серверов в то же время, разделяйте имена запятыми или точкой с запятой. Например введите имена в формате *server1.contoso.com; server2.contoso.com*. Когда вы закончите, нажмите кнопку **Далее**.
    
    >[!NOTE]
    >Если вы решили создать кластер сразу после запуска проверки в [процедуру проверки конфигурации](#validate-the-configuration), вы не увидите странице **Выбор серверов** . Узлы, которые были проверены автоматически добавляются в мастере создания кластера таким образом, чтобы у вас нет их повторного ввода.
6. Если вы не выполнили проверки ранее, откроется страница **Предупреждение проверки** . Мы настоятельно рекомендуем выполнить проверку кластера. Только кластеры, которые проходят все проверочные тесты поддерживаются корпорацией Майкрософт. Чтобы запустить проверочные тесты, выбрать " **Да**" и нажмите кнопку **Далее**. Завершите мастер проверки конфигурации, как описано в [Проверка конфигурации](#validate-the-configuration).
7. На странице **Точки доступа для администрирования кластера** выполните следующее:
    
    1. В поле **Имени кластера** введите имя, которое вы хотите использовать для администрирования кластера. Прежде чем сделать, ознакомьтесь со следующими сведениями:
        
          - При создании кластера это имя регистрируется как кластера объект компьютера (также известной как *объект имя кластера* или *CNO*) в AD DS. Если указать имя NetBIOS для кластера CNO создается в той же папке, где находятся объектов-компьютеров для узлов кластера. Это может быть контейнера компьютеров по умолчанию или Подразделение.
          - Чтобы указать другое расположение для CNO, можно ввести различающееся имя Подразделение в поле **Имени кластера** . Например: *CN = ClusterName, OU = кластеры, DC = Contoso, DC = com*.
          - Если администратор домена предварительно настроен CNO в различные Подразделения чем где находятся узлах кластера, укажите различающееся имя, которое предоставляет администратор домена.
    2. Если сервер не использует сетевой адаптер, который настроен на использование DHCP, необходимо настроить одну или несколько статических IP-адресов для отказоустойчивого кластера. Установите флажок рядом с каждой сети, которой вы хотите использовать для управления кластером. Выберите поле **адреса** рядом с выбранной сети, а затем введите IP-адрес, который требуется назначить к кластеру. Этот IP-адрес (или адреса) будут связаны с именем кластера в доменных имен (DNS).
    3. Когда вы закончите, нажмите кнопку **Далее**.
8. На странице **подтверждения** ознакомьтесь с параметрами. По умолчанию установлен флажок **Добавить все хранилища требованиям к кластеру** . Снимите этот флажок, если одно из следующих действий:
    
      - Необходимо настроить хранилища позже.
      - Вы собираетесь создать кластерных дисковых через диспетчер отказоустойчивости кластеров или с помощью командлетов отказоустойчивой кластеризации Windows PowerShell и еще не создали дисковые пространства в файловые службы и службы хранилища. Дополнительные сведения см. в разделе [Развертывание кластеры дисковых пространств](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11)>).
9. Выберите **Далее** для создания отказоустойчивого кластера.
10. На странице " **Сводка** " Убедитесь, что отказоустойчивый кластер успешно создан. Если есть все предупреждения и ошибки, Просмотр сводки выходные данные, или выберите **Просмотреть отчет** , чтобы просмотреть полный отчет. Выберите **Готово**.
11. Чтобы убедиться, что кластера был создан, убедитесь, что имя кластера находится в списке **Диспетчера отказоустойчивости кластеров** в дереве переходов. Можно развернуть имя кластера и затем выбрать элементы в области **узлы**, **хранилища** или **сети** , чтобы просмотреть связанные ресурсы.
    
    Понять, что может занять некоторое время для имени кластера для успешной репликации в DNS. После успешной регистрации DNS и репликации при выборе **Всех серверов** в диспетчер серверов, имя кластера должны быть указаны как сервер с **просмотрев** состояние **сети**.

После создания кластера можно выполнить действия такие как проверка конфигурации кворума кластера и при необходимости создания общими томами кластера (CSV). Дополнительные сведения см. в разделе [Кворума Общие сведения о локальных дисковых пространств](../storage/storage-spaces/understand-quorum.md) и [Использование общих томов кластера в отказоустойчивом кластере](failover-cluster-csvs.md).

## Создание кластерных ролей

После создания отказоустойчивого кластера, можно создать кластерных ролей на узле кластера нагрузки.

>[!NOTE]
>Для кластерных ролей, которые требуют точки доступа клиента объект виртуального компьютера (VCO) создается в Доменных службах Active Directory. По умолчанию все VCO для кластера создаются в том же контейнера или Подразделения как CNO. Понимать, что после создания кластера можно переместить CNO любым Подразделением.

Ниже приведен пример создания кластерные роли:

1. Используйте диспетчер серверов или Windows PowerShell, чтобы установить роль или компонент, который необходим для кластерных ролей на каждом узле отказоустойчивого кластера. Например если вы хотите создать кластерный файловый сервер, установите роль файлового сервера на всех узлах кластера.
    
    В следующей таблице показаны кластерных ролей, которые можно настроить в мастере высокой доступности и связанные сервера роли или компонент, который необходимо установить в качестве обязательного компонента.
    
    <table>
    <thead>
    <tr class="header">
    <th>Кластерные роли</th>
    <th>Роль или компонент необходимым условием</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>Сервер пространства имен DFS</td>
    <td>Пространства имен DFS (входит роль файлового сервера)</td>
    </tr>
    <tr class="even">
    <td>DHCP-сервер</td>
    <td>Роли DHCP-сервера</td>
    </tr>
    <tr class="odd">
    <td>Координатор распределенных транзакций (DTC)</td>
    <td>Нет</td>
    </tr>
    <tr class="even">
    <td>Файловый сервер</td>
    <td>Роль файлового сервера</td>
    </tr>
    <tr class="odd">
    <td>Универсальное приложение</td>
    <td>Неприменимо</td>
    </tr>
    <tr class="even">
    <td>Универсальный сценарий</td>
    <td>Неприменимо</td>
    </tr>
    <tr class="odd">
    <td>Универсальная служба</td>
    <td>Неприменимо</td>
    </tr>
    <tr class="even">
    <td>Брокер реплика Hyper-V</td>
    <td>Роль Hyper-V</td>
    </tr>
    <tr class="odd">
    <td>Целевой сервер iSCSI</td>
    <td>Целевой сервер (входит роль файлового сервера) iSCSI</td>
    </tr>
    <tr class="even">
    <td>Сервер iSNS</td>
    <td>функция сервера службы iSNS</td>
    </tr>
    <tr class="odd">
    <td>Очередь сообщений</td>
    <td>Функции службы очереди сообщений</td>
    </tr>
    <tr class="even">
    <td>Другой сервер</td>
    <td>Нет</td>
    </tr>
    <tr class="odd">
    <td>Виртуальная машина</td>
    <td>Роль Hyper-V</td>
    </tr>
    <tr class="even">
    <td>WINS-сервер</td>
    <td>Средство сервера WINS</td>
    </tr>
    </tbody>
    </table>
2. В диспетчере отказоустойчивости кластеров, разверните узел с именем кластера, щелкните правой кнопкой мыши **роли**и выберите **Настройка роли**.
3. Следуйте инструкциям в мастере высокой доступности для создания кластерные роли.
4. Чтобы проверить, была создана кластерные роли, в области **ролей** убедитесь, что роль имеет состояние **выполнения**. На панели роли также указывает узел владельца. Чтобы протестировать отработки отказа, щелкните правой кнопкой мыши роль, наведите курсор на **Перемещение**и выберите **Выбрать узел**. В диалоговом окне **Переместить роль кластерного** выберите узел нужного кластера и нажмите кнопку **ОК**. В столбце " **Узел владельца** " Убедитесь, что узел владельца изменен.

## Создание отказоустойчивого кластера с помощью Windows PowerShell

Следующие командлеты Windows PowerShell выполните те же функции, как предыдущие процедуры в этом разделе. Введите каждый командлет в одной строке, несмотря на то, что они могут отображаться словам по нескольким строкам из-за ограничений форматирования.

>[!NOTE]
>Чтобы создать кластер отсоединенной Active Directory в Windows Server 2012 R2, необходимо использовать Windows PowerShell. Сведения о синтаксисе см. в разделе [Развертывание кластера Active Directory-Detached](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11)).

Следующий пример устанавливает функции отказоустойчивой кластеризации.

```PowerShell
Install-WindowsFeature –Name Failover-Clustering –IncludeManagementTools
```

Следующий пример запускает все проверочные тесты кластера на компьютерах, которые называются *Server1* и *Server2*.

```PowerShell
Test-Cluster –Node Server1, Server2
```

>[!NOTE]
>Командлет **Test-Cluster** результат записывается в файл журнала в текущий рабочий каталог. Например: C:\Users\ < имя пользователя > \AppData\Local\Temp.

В следующем примере создается отказоустойчивого кластера, который называется *MyCluster* с узлами *Server1* и *Server2*, присваивает адрес статический IP-адрес *192.168.1.12*и добавляет все подходящие хранилища в отказоустойчивом кластере.

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12
```

В следующем примере создается же отказоустойчивого кластера, как в предыдущем примере, но не добавляет право хранилища в отказоустойчивом кластере.

```PowerShell
New-Cluster –Name MyCluster –Node Server1, Server2 –StaticAddress 192.168.1.12 -NoStorage
```

В следующем примере создается кластер с именем *MyCluster* в *кластере* OU домена *Contoso.com*.

```PowerShell
New-Cluster -Name CN=MyCluster,OU=Cluster,DC=Contoso,DC=com -Node Server1, Server2
```

Примеры для добавления кластерных ролей см. в разделе темы, такие как [Добавить ClusterFileServerRole](https://docs.microsoft.com/powershell/module/failoverclusters/add-clusterfileserverrole?view=win10-ps) [ClusterGenericApplicationRole добавить](https://docs.microsoft.com/powershell/module/failoverclusters/add-clustergenericapplicationrole?view=win10-ps).

## Дополнительные сведения

  - [Отказоустойчивая кластеризация](failover-clustering.md)
  - [Развертывание кластера Hyper-V](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj863389(v%3dws.11)>)
  - [Масштабируемый файловый сервер для данных приложения](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831349(v%3dws.11)>)
  - [Развертывание Active Directory отсоединенной кластера](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265970(v=ws.11))
  - [Использование кластеризации гостевых систем для обеспечения высокой доступности](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn440540(v%3dws.11)>)
  - [Кластерное обновление](cluster-aware-updating.md)
  - [Новый кластер](https://docs.microsoft.com/powershell/module/failoverclusters/new-cluster?view=win10-ps)
  - [Test-Cluster](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps)
