---
title: Масштабируемый файловый сервер для обзора данных приложения
description: Масштабируемый файловый сервер предназначен для предоставления масштабируемых файловых ресурсов, которые постоянно доступны для хранилища серверных приложений на основе файлов. Масштабируемые файловые ресурсы обеспечивают возможность совместного использования папок различными узлами одного кластера. Этот сценарий фокусируется на планировании и развертывании масштабируемого файлового сервера.
ms.topic: article
author: JasonGerend
ms.author: jgerend
manager: lizross
ms.date: 09/29/2020
ms.localizationpriority: medium
ms.openlocfilehash: 5aca126d036dffc9b7463edd07e70a3dd02b7dbd
ms.sourcegitcommit: f89639d3861c61620275c69f31f4b02fd48327ab
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/29/2020
ms.locfileid: "91517490"
---
# <a name="scale-out-file-server-for-application-data-overview"></a>Масштабируемый файловый сервер для обзора данных приложения

>Применяется к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Масштабируемый файловый сервер предназначен для предоставления масштабируемых файловых ресурсов, которые постоянно доступны для хранилища серверных приложений на основе файлов. Масштабируемые файловые ресурсы обеспечивают возможность совместного использования папок различными узлами одного кластера. Этот сценарий фокусируется на планировании и развертывании масштабируемого файлового сервера.

Вы можете развернуть и настроить кластерный файловый сервер с помощью любого из следующих методов.

- **Масштабируемый файловый сервер для данных приложения** Этот компонент кластеризованного файлового сервера появился в Windows Server 2012 и позволяет хранить данные серверных приложений, такие как файлы виртуальных машин Hyper-V, в общих файловых ресурсах, а также иметь аналогичные уровни надежности, доступности, управляемости и высокой производительности, которые могут быть получены из сети хранения данных. Все файловые ресурсы одновременно подключены к сети на всех узлах. Общие файловые ресурсы, связанные с кластерным файловым сервером такого типа, называются масштабируемыми файловыми ресурсами. Такая конфигурация иногда называется "активный-активный". Это рекомендуемый тип файлового сервера при развертывании Hyper-V через Server Message Block (SMB) или Microsoft SQL Server через SMB.
- **Файловый сервер для общего использования** Это продолжение кластеризованного файлового сервера, который поддерживался в Windows Server с момента появления отказоустойчивой кластеризации. Это разновидность кластерного файлового сервера, поэтому все общие папки, связанные с кластерным файловым сервером, не могут быть подключены к сети на нескольких узлах одновременно. Такая конфигурация иногда называется "активный-пассивный" или "двойной активный". Общие файловые ресурсы, связанные с кластерным файловым сервером такого типа, называются кластерными файловыми ресурсами. Это рекомендуемый тип файлового сервера при развертывании сценариев информационных работников.

## <a name="scenario-description"></a>Описание сценария

Масштабируемые файловые ресурсы обеспечивают возможность совместного использования папок несколькими узлами одного кластера. Например, при наличии кластера файлового сервера с четырьмя узлами, использующего горизонтальное масштабирование SMB, компьютер под управлением Windows Server 2012 R2 или Windows Server 2012 может получить доступ к общим папкам с любого из четырех узлов. Это достигается за счет использования новых компонентов отказоустойчивой кластеризации в Windows Server и возможностей протокола файловых серверов Windows — SMB 3.0. Администраторы файловых серверов могут предоставлять масштабируемые файловые ресурсы и постоянно доступные файловые службы серверным приложениям, а также быстро реагировать на увеличение потребностей путем простого подключения к сети дополнительных серверов. Все это можно осуществлять в рабочей среде абсолютно прозрачно для серверного приложения.

Основные преимущества масштабируемого файлового сервера включают следующее.

- **Активные общие файловые ресурсы**. Все узлы кластера могут принимать и обслуживать клиентские запросы SMB. Благодаря одновременной доступности содержимого файловых ресурсов для всех узлов кластера взаимодействие кластеров и клиентов SMB 3.0 обеспечивает прозрачную отработку отказа на альтернативные узлы кластера во время планового обслуживания или внезапных сбоев с нарушением работы служб.
- **Увеличенная пропускная способность**. Максимальная пропускная способность общего доступа — это общая пропускная способность всех узлов кластера файлового сервера. В отличие от предыдущих версий Windows Server, общая пропускная способность более не ограничивается пропускной способностью одного узла кластера, а определяется возможностями резервной системы хранения, которая задает ограничения. Увеличить общую пропускную способность можно путем добавления узлов.
- **Chkdsk с нулевым временем простоя**. CHKDSK в Windows Server 2012 значительно улучшена, чтобы значительно сократить время, в течение которого файловая система находится в автономном режиме для восстановления. Общие тома кластера (CSV) позволяют вообще исключить этап отключения от сети. Файловая система CSV (CSVFS) может использовать операцию CHKDSK, не затрагивая приложения с открытыми дескрипторами в файловой системе.
- **Кластеризованный кэш общего тома**. CSV в Windows Server 2012 предоставляет поддержку кэша чтения, что может значительно повысить производительность в определенных сценариях, например в инфраструктуре виртуальных рабочих столов (VDI).
- **Упрощенное управление**. С масштабируемый файловый сервер создайте масштабируемые файловые серверы, а затем добавьте необходимые CSV и общие файловые ресурсы. Теперь нет необходимости создавать несколько кластерных файловых серверов с отдельными дисками кластера, а затем разрабатывать политики размещения, чтобы обеспечить работу каждого узла кластера.
- **Автоматическая ребалансировка Масштабируемый файловый сервер клиентов**. В Windows Server 2012 R2 автоматическое перераспределение улучшает масштабируемость и управляемость масштабируемых файловых серверов. Клиентские подключения SMB отслеживаются для каждого общего файлового ресурса (а не для каждого сервера), после чего клиенты перенаправляются в узел кластера с оптимальным доступом к тому, используемому общим файловым ресурсом. Это повышает производительность, снижая трафик перенаправления между узлами файлового сервера. Клиенты перенаправляются после начального подключения при перенастройке системы хранения данных кластера.

## <a name="in-this-scenario"></a>Содержание сценария

Следующие разделы помогут вам развернуть масштабируемый файловый сервер.

- [План для масштабируемого файлового сервера](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134258(v%3dws.11)>)

  - [Шаг 1. Планирование хранилища на масштабируемом файловом сервере](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134181%28v%3dws.11%29>)
  - [Step 2: Plan for Networking in Scale-Out File Server](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134253%28v%3dws.11%29>)

- [Deploy Scale-Out File Server](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831359%28v%3dws.11%29>)

  - [Шаг 1. Установка необходимых компонентов для масштабируемого файлового сервера](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831478%28v%3dws.11%29>)
  - [Шаг 2. Настройка масштабируемого файлового сервера](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831718%28v%3dws.11%29>)
  - [Шаг 3. Настройка Hyper-V для использования масштабируемого файлового сервера](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831463%28v%3dws.11%29>)
  - [Шаг 4. Настройка Microsoft SQL Server для использования масштабируемого файлового сервера](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831815%28v%3dws.11%29>)

## <a name="when-to-use-scale-out-file-server"></a>Когда использовать масштабируемый файловый сервер

Масштабируемый файловый сервер не следует использовать, если рабочая нагрузка создает большое количество операций с метаданными, например открытие и закрытие файлов, создание новых файлов или переименование существующих. Типичный пользователь, работающий с информацией, создает множество операций с метаданными. Масштабируемый файловый сервер рекомендуется использовать, если важны масштабируемость и простота и требуются только те технологии, которые поддерживает масштабируемый файловый сервер.

В следующей таблице перечислены возможности SMB 3.0, общие файловые системы Windows, технологии управления данными файловых серверов и общие рабочие нагрузки. Вы можете увидеть, поддерживается ли технология масштабируемым файловым сервером, или требуется традиционный кластерный файловый сервер (также известный как файловый сервер общего назначения).

<table>
<thead>
<tr class="header">
<th>Область технологий</th>
<th>Признак</th>
<th>Кластер файлового сервера общего назначения</th>
<th>Масштабируемый файловый сервер</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>SMB</td>
<td>Непрерывная доступность SMB (*)</td>
<td>Да</td>
<td>Да</td>
</tr>
<tr class="even">
<td>SMB</td>
<td>Технология SMB Multichannel</td>
<td>Да</td>
<td>Да</td>
</tr>
<tr class="odd">
<td>SMB</td>
<td>SMB Direct</td>
<td>Да</td>
<td>Да</td>
</tr>
<tr class="even">
<td>SMB</td>
<td>Шифрование SMB</td>
<td>Да</td>
<td>Да</td>
</tr>
<tr class="odd">
<td>SMB</td>
<td>Прозрачная отработка отказа SMB</td>
<td>Да (если включена постоянная доступность)</td>
<td>Да</td>
</tr>
<tr class="even">
<td>Файловая система</td>
<td>NTFS</td>
<td>Да</td>
<td>Н/Д</td>
</tr>
<tr class="odd">
<td>Файловая система</td>
<td>Отказоустойчивая файловая система (<a href="/windows-server/storage/refs/refs-overview">ReFS</a>)</td>
<td>Рекомендуется с Локальные дисковые пространства</td>
<td>Рекомендуется с Локальные дисковые пространства</td>
</tr>
<tr class="even">
<td>Файловая система</td>
<td>Файловая система общего тома кластера (CSV)</td>
<td>Н/Д</td>
<td>Да</td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>BranchCache</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>Дедупликация данных (Windows Server 2012)</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>Дедупликация данных (Windows Server 2012 R2)</td>
<td>Да</td>
<td>Да (только VDI)</td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>Корень корневого сервера пространства имен DFS (DFSN)</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>Целевой сервер папки пространства имен DFS (DFSN)</td>
<td>Да</td>
<td>Да</td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>Репликация DFS (DFSR)</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>Диспетчер ресурсов файлового сервера (экраны и квоты)</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>Инфраструктура классификации файлов</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>Динамический контроль доступа (доступ на основе утверждений, CAP)</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>Перенаправление папок</td>
<td>Да</td>
<td>Не рекомендуется<em></td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>Автономные файлы (кэширование на стороне клиента)</td>
<td>Да</td>
<td>Не рекомендуется</em></td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>Проверка перемещаемых профилей пользователей</td>
<td>Да</td>
<td>Не рекомендуется<em></td>
</tr>
<tr class="odd">
<td>Управление файлами</td>
<td>Домашние каталоги</td>
<td>Да</td>
<td>Не рекомендуется</em></td>
</tr>
<tr class="even">
<td>Управление файлами</td>
<td>рабочие папки</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="odd">
<td>NFS</td>
<td>Сервер NFS</td>
<td>Да</td>
<td>Нет</td>
</tr>
<tr class="even">
<td>Приложения</td>
<td>Hyper-V</td>
<td>Не рекомендуется</td>
<td>Да</td>
</tr>
<tr class="odd">
<td>Приложения</td>
<td>Microsoft SQL Server</td>
<td>Не рекомендуется</td>
<td>Да</td>
</tr>
</tbody>
</table>

\*<a href="https://docs.microsoft.com/windows-server/storage/storage-spaces/cluster-sets#scale-out-file-server-and-cluster-sets">Постоянная доступность SMB с замыканием на себя в конфигурациях с согласованием (CA)</a> — курсора в Windows Server 2019. 

>[!NOTE]
>Перенаправление папок, автономные файлы, перемещаемые профили пользователей или домашние каталоги создают большое количество операций записи, которые должны немедленно записываться на диск (без буферизации) при использовании постоянно доступных файловых ресурсов, что снижает производительность по сравнению с общими файловыми ресурсами общего назначения. Постоянно доступные файловые ресурсы также несовместимы с диспетчером ресурсов файлового сервера и ПК под управлением Windows XP. Кроме того, автономные файлы может не переходить в режим «вне сети» на 3-6 минут после того, как пользователь теряет доступ к общей папке, что может привести к невозможности использовать режим «всегда автономный» автономные файлы.

## <a name="practical-applications"></a>Практическое применение

Масштабируемые файловые серверы идеально подходят для хранилища серверных приложений. Ниже перечислены некоторые примеры серверных приложений, которые могут хранить свои данные в масштабируемом файловом ресурсе.

- Веб-сервер IIS может хранить конфигурацию и данные для веб-сайтов в масштабируемом файловом ресурсе. Дополнительные сведения см. в разделе [Общая конфигурация](https://www.iis.net/learn/manage/managing-your-configuration-settings/shared-configuration_264).
- Hyper-V может хранить конфигурацию и динамические виртуальные диски в масштабируемом файловом ресурсе. Дополнительные сведения см. в разделе [Развертывание Hyper-V через SMB](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134187(v%3dws.11)>).
- SQL Server может хранить динамические файлы базы данных в масштабируемом файловом ресурсе. Дополнительные сведения см. в разделе [Установка SQL Server с файловым ресурсом SMB в качестве хранилища](/sql/database-engine/install-windows/install-sql-server-with-smb-fileshare-as-a-storage-option).
- Диспетчер виртуальных машин (VMM) может хранить общую папку библиотеки (содержащую шаблоны виртуальных машин и связанные файлы) в масштабируемом файловом ресурсе. Однако сам сервер библиотеки не может быть масштабируемый файловый сервер — он должен находиться на изолированном сервере или отказоустойчивом кластере, который не использует роль кластера масштабируемый файловый сервер.

При использовании масштабируемого файлового ресурса в качестве общей папки библиотеки можно применять только те технологии, которые совместимы с масштабируемым файловым сервером. Например, репликация DFS нельзя использовать для репликации общей папки библиотеки, размещенной в масштабируемом файловом ресурсе. Также важно наличие на масштабируемом файловом сервере установленных последних обновлений программного обеспечения.

Чтобы использовать масштабируемый файловый ресурс в качестве общей папки библиотеки, сначала добавьте сервер библиотеки (скорее всего, это виртуальная машина) с локальной общей папкой или вообще без общих папок. Затем при добавлении общей папки библиотеки выберите общую папку, размещенную на масштабируемом файловом сервере. Этот ресурс должен быть управляемым VMM и созданным исключительно для использования сервером библиотеки. Также не забудьте установить последние обновления на масштабируемом файловом сервере. Дополнительные сведения о добавлении серверов библиотек VMM и общих папок библиотек см. в статье [Добавление профилей в БИБЛИОТЕКУ VMM](/system-center/vmm/library-profiles?view=sc-vmm-1801). Список доступных в настоящее время исправлений для файловых служб и служб хранилища см. в [статье базы знаний Майкрософт 2899011](https://support.microsoft.com/help/2899011/list-of-currently-available-hotfixes-for-the-file-services-technologie).

>[!NOTE]
>Некоторые пользователи, например информационные работники, имеют рабочие нагрузки, которые значительно влияют на производительность. Например, если такие операции, как открытие и закрытие файлов, создание новых файлов и переименование существующих файлов, выполняются несколькими пользователями, они оказывают влияние на производительность. Если файловый ресурс включен с непрерывной доступностью, он обеспечивает целостность данных, но также влияет на общую производительность. Для постоянной доступности требуется сквозная запись данных на диск, чтобы обеспечить целостность в случае сбоя узла кластера на масштабируемом файловом сервере. Таким образом, пользователь, который копирует несколько больших файлов на файловый сервер, может ожидать значительно более низкую производительность на постоянно доступном файловом ресурсе.

## <a name="features-included-in-this-scenario"></a>Компоненты, используемые в данном сценарии

В следующей таблице перечислены компоненты, являющиеся частью данного сценария, и описано, как они поддерживают его.

<table>
<thead>
<tr class="header">
<th>Признак</th>
<th>Способ поддержки сценария</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="/windows-server/failover-clustering/failover-clustering-overview">Отказоустойчивая кластеризация</a></td>
<td>Отказоустойчивые кластеры добавили следующие функции в Windows Server 2012 для поддержки масштабируемого файлового сервера: имя распределенной сети, масштабируемый файловый сервер тип ресурса, общие тома кластера (CSV) 2 и роль высокой доступности масштабируемый файловый сервер. Дополнительные сведения об этих функциях см. в разделе новые <a href="/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265972(v%3dws.11)">&#39;в отказоустойчивой кластеризации в Windows Server 2012 [перенаправлено]</a>.</td>
</tr>
<tr class="even">
<td><a href="/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831795(v%3dws.11)">Server Message Block Overview</a> (Общие сведения об SMB)</td>
<td>SMB 3,0 добавила следующие функции в Windows Server 2012 для поддержки масштабируемого файлового сервера: прозрачная отработка отказа SMB, многоканальная и SMB Direct.<br />
<br />
Дополнительные сведения о новых и измененных возможностях SMB в Windows Server 2012 R2 см. в разделе <a href="/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831474(v%3dws.11)">новые&#39;в SMB в Windows Server</a>.</td>
</tr>
</tbody>
</table>

## <a name="more-information"></a>Дополнительные сведения

- [Руководство по вопросам проектирования программно определяемого хранилища](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/mt243829(v%3dws.11)>)
- [Increasing Server, Storage, and Network Availability](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831437(v%3dws.11)>)
- [Deploy Hyper-V over SMB](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134187(v%3dws.11)>) (Развертывание Hyper-V поверх SMB)
- [Deploying Fast and Efficient File Servers for Server Applications](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831723(v%3dws.11)>) (Развертывание быстрых и производительных файловых серверов для серверных приложений)
- [Масштабировать или нет, вот в чем вопрос](https://blogs.technet.com/b/filecab/archive/2013/12/05/to-scale-out-or-not-to-scale-out-that-is-the-question.aspx) (запись блога)
- [Folder Redirection, Offline Files, and Roaming User Profiles](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh848267(v%3dws.11)>) (Общие сведения о перенаправлении папок, автономных файлах и перемещаемых профилях пользователей)
