---
title: Настройка кворума и управление им в отказоустойчивом кластере
description: Подробные сведения об управлении кворума кластера в отказоустойчивом кластере Windows Server.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 01/18/2019
ms.localizationpriority: medium
ms.openlocfilehash: 21f99362205e0a6aa90ebd26cef8f3a779bdc1dc
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59836495"
---
# <a name="configure-and-manage-quorum"></a>Настройка кворума и управление им

>Относится к: Windows Server 2019 г., Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Этот раздел содержит общие сведения и инструкции для настройки и управления кворумом в отказоустойчивом кластере Windows Server.

## <a name="understanding-quorum"></a>Основные сведения о кворума

Кворум кластера определяется числом голосующих элементов, являющихся активными членами кластера, которое необходимо для запуска кластера и его правильной работы. Более подробное объяснение, см. в разделе [doc кворума кластера и пул понимание](../storage/storage-spaces/understand-quorum.md).

## <a name="quorum-configuration-options"></a>Параметры конфигурации кворума

Модель кворума в Windows Server является гибким. Если необходимо изменить конфигурацию кворума для кластера, воспользуйтесь мастером настройки кворума кластера или командлеты PowerShell Windows кластеров отработки отказа. Инструкции и рекомендации по настройке кворума см. в подразделе [Настройка кворума кластера](#configure-the-cluster-quorum) далее в этом разделе.

В таблице ниже перечислены три параметра конфигурации кворума, доступные в мастере настройки кворума кластера.

<table>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Использовать обычные параметры</td>
<td>Кластер автоматически назначает голос каждому узлу и динамически управляет голосами узлов. Если это возможно в случае с вашим кластером и доступно общее хранилище кластера, кластер выбирает диск-свидетель. Это рекомендуется в большинстве случаев, поскольку автоматический выбор конфигурации кворума и свидетеля обеспечивает максимальную доступность кластера.</td>
</tr>
<tr class="even">
<td>Добавить или изменить свидетеля кворума</td>
<td>Вы можете добавить, изменить или удалить ресурс свидетеля. Можно настроить общий файловый ресурс или диск-свидетель. Кластер автоматически назначает голос каждому узлу и динамически управляет голосами узлов.</td>
</tr>
<tr class="odd">
<td>Расширенная конфигурация кворума и выбор свидетеля</td>
<td>Этот параметр следует выбирать только при специфических для приложения или сайта требованиях к конфигурации кворума. Вы можете изменить свидетеля кворума, добавить или удалить голоса узлов, а также указать, должен ли кластер динамически управлять голосами узлов. По умолчанию голоса назначаются всем узлам, а управление голосами узлов осуществляется автоматически.</td>
</tr>
</tbody>
</table>

В зависимости от выбранного варианта конфигурации кворума и заданных параметров для кластера настраивается один из указанных ниже режимов кворума.

<table>
<thead>
<tr class="header">
<th>Режим</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Большинство узлов (без свидетеля)</td>
<td>Голоса имеют только узлы. Свидетель кворума не настраивается. Кворум кластера определяется большинством голосующих узлов, являющихся активными членами кластера.</td>
</tr>
<tr class="even">
<td>Большинство узлов со свидетелем (диск или файловый ресурс)</td>
<td>Узлы имеют голоса. Кроме того, голос имеет свидетель кворума. Кворум кластера определяется большинством голосующих узлов, являющихся активными членами кластера, а также голосом свидетеля.<br />
<br />
Свидетелем кворума может быть свидетель на выделенном диске или свидетель на общем файловом ресурсе.</td>
</tr>
<tr class="odd">
<td>Без большинства (только диск-свидетель)</td>
<td>Узлы не имеют голосов. Голос имеет только диск-свидетель. Кворум кластера определяется состоянием диска-свидетеля.<br />
<br />
В кластере есть кворум, если хотя бы один узел доступен и имеет соединение с определенным диском в хранилище кластера. Как правило, использовать этот режим не рекомендуется, так как в кластере возникает единая точка отказа.</td>
</tr>
</tbody>
</table>

Следующие подразделы предоставит дополнительные сведения о дополнительных параметрах настройки кворума.

### <a name="witness-configuration"></a>Настройка свидетеля

Как правило, при настройке кворума число голосующих элементов в кластере должно быть нечетным. Поэтому, если кластер содержит четное число голосующих узлов, следует настроить диск-свидетель или файловый ресурс-свидетель. Кластер сможет продолжать работу при отключении одного дополнительного узла. Кроме того, добавление голоса свидетеля позволяет кластеру продолжать работу в том случае, если половина его узлов одновременно прекращает работу или отключается.

Использовать диск-свидетель обычно рекомендуется, если диск доступен всем узлам. Файловый ресурс-свидетель рекомендуется в том случае, если необходимо реализовать аварийное восстановление нескольких сайтов с реплицированным хранилищем. Настройка диска-свидетеля с реплицированным хранилищем возможна только в том случае, если поставщик хранилища поддерживает доступ для чтения и записи к реплицированному хранилищу со всех сайтов. <strong>*Диск-свидетель не поддерживается с дисковыми пространствами*</strong>.

В таблице ниже приводится дополнительная информация и рекомендации касательно типов свидетеля кворума.

<table>
<thead>
<tr class="header">
<th>Тип свидетеля</th>
<th>Описание</th>
<th>Требования и рекомендации</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Диск-свидетель</td>
<td>- Выделенный LUN, в котором хранится копия базы данных кластера<br />
- Оптимальный вариант для кластеров с общим (не реплицированным) хранилищем</td>
<td>- Размер LUN должен быть не менее 512 МБ<br />
- Должен быть выделен для кластера и не назначен кластерной роли<br />
- Должны быть включены в кластеризованных хранилище и пройти проверочные тесты хранилища<br />
- Не может быть диск общего тома кластера (CSV)<br />
- Базовый диск с одним томом<br />
- Не требуется буква диска<br />
- Можно форматировать в NTFS или ReFS<br />
- Можно также настроить аппаратную конфигурацию RAID для отказоустойчивости<br />
- Следует исключить из резервных копий и антивирусное сканирование на<br />
- Диск-свидетель не поддерживается с дисковыми пространствами</td>
</tr>
<tr class="even">
<td>Файловый ресурс-свидетель</td>
<td>- Общая папка SMB, настроенный на файловом сервере под управлением Windows Server<br />
- Не храните копию базы данных кластера<br />
- Информация о кластере только в файле witness.log<br />
- Наиболее полезна для кластеров с несколькими сайтами Реплицируемое хранилище</td>
<td>- Должно быть не менее 5 МБ свободного места<br />
- Должен быть выделен для одного кластера и не используется для хранения данных пользователя или приложения<br />
- Должны включены разрешения на запись для объекта-компьютера для имени кластера<br />
<br />
Ниже приведены дополнительные рекомендации касательно файлового сервера, на котором размещается файловый ресурс-свидетель.<br />
<br />
- Один файловый сервер можно настроить с помощью файла-свидетели для нескольких кластеров.<br />
- Файловый сервер должен находиться на узле, который отделен от рабочей нагрузкой кластера. Это дает всем сайтам кластера равные возможности по сохранению работоспособности в случае, если сетевое соединение между сайтами утеряно. Если файловый сервер находится на том же сайте, этот сайт становится основным и единственным сайтом, который имеет доступ к файловому ресурсу.<br />
- На файловом сервере можно запустить на виртуальной машине, если виртуальная машина не размещена на том же кластере, который использует файловый ресурс-свидетель.<br />
- Для обеспечения высокой доступности файловый сервер можно настроить на отдельном отказоустойчивом кластере.</td>
</tr>

<tr class-"odd">
<td>Облако-свидетель</td>
<td>- Следящий сервер файла, хранящегося в хранилище больших двоичных объектов<br>
— Рекомендуется использовать на всех серверах в кластере быть надежным подключением к Интернету.</td>
<td>См. в разделе <a href="https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness">развертывание облака-свидетеля</a>.</td>
<td>
</td>
</tr>

</tbody>
</table>

### <a name="node-vote-assignment"></a>Назначение голосов узлов

В качестве дополнительных параметров настройки кворума вы можете назначить или удалить голоса отдельным узлам. По умолчанию голоса назначены всем узлам. Вне зависимости от назначения голосов, все узлы продолжают работать в кластере, получать обновления из базы данных кластера и использоваться для размещения приложений.

В некоторых конфигурациях аварийного восстановления может потребоваться удалить голоса, назначенные узлам. Например, в кластере с несколькими сайтами можно удалить голоса узлов на сайте резервного копирования, чтобы они не оказывали влияния на подсчет кворума. Такая конфигурация рекомендуется только при отработке отказа между сайтами вручную. Подробнее см. в подразделе [Рекомендации касательно кворума для конфигураций аварийного восстановления](#quorum-considerations-for-disaster-recovery-configurations) далее в этом разделе.

Голос узла можно проверить, посмотрев на **NodeWeight** общего свойства узла кластера с помощью [Get-ClusterNode](http://technet.microsoft.com/library/hh847268.aspx)командлета Windows PowerShell. Значение 0 указывает на то, что для узла не настроен голос кворума. Значение 1 указывает на то, что узлу назначен голос кворума и управление им осуществляется кластером. Дополнительные сведения об управлении голосами узлов см. в подразделе [Динамическое управление кворумом](#dynamic-quorum-management) далее в этом разделе.

Назначение голосов всем узлам кластера можно проверить с помощью теста **Проверка кворума кластера**.

#### <a name="additional-considerations-for-node-vote-assignment"></a>Дополнительные замечания по назначение голосов узлов

  - Не рекомендуется назначать голоса нечетному числу узлов. Вместо этого следует настроить диск-свидетель или файловый ресурс-свидетель. Дополнительные сведения см. в разделе [Настройка свидетеля](#witness-configuration) далее в этом разделе.
  - Если включено динамическое управление кворумом, голоса могут динамически назначаться и удаляться только для тех узлов, для которых настроено назначение голосов. Подробнее см. в подразделе [Динамическое управление кворумом](#dynamic-quorum-management) далее в этом разделе.

### <a name="dynamic-quorum-management"></a>Динамическое управление кворумом

В Windows Server 2012 в качестве дополнительных параметров настройки кворума, вы можете включить динамическое управление кворумом осуществляется кластером. Дополнительные сведения о динамических works кворума, см. в разделе [объяснение](../storage/storage-spaces/understand-quorum.md#dynamic-quorum-behavior).

Благодаря динамическому управлению кворумом кластер также может продолжать работать на последнем оставшемся узле. Благодаря динамическому изменению требований к большинству кворума кластер может сохранять работоспособность после последовательного отключения всех узлов, кроме последнего.

Назначенный кластером динамический голос узла можно проверить с помощью **DynamicWeight** общего свойства узла кластера с помощью [Get-ClusterNode](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusternode?view=win10-ps) командлета Windows PowerShell. Значение 0 указывает на то, что у узла нет голоса кворума. Значение 1 указывает на то, что у узла есть голос кворума.

Назначение голосов всем узлам кластера можно проверить с помощью теста **Проверка кворума кластера**.

#### <a name="additional-considerations-for-dynamic-quorum-management"></a>Дополнительные замечания по динамическое управление кворумом

- Динамическое управление кворумом не позволяет кластеру сохранять работоспособность при одновременном сбое большинства голосующих членов. Для продолжения работы в кластере должно быть большинство кворума на момент завершения работы или сбоя узла.

- Если вы явно удалили голос узла, кластер не сможет динамически добавить или удалить его.
- При включении Storage Spaces Direct, кластер может поддерживать только двух сбоев узлов. Это объясняется более [пула разделе кворума](../storage/storage-spaces/understand-quorum.md#poolQuorum)

## <a name="general-recommendations-for-quorum-configuration"></a>Общие рекомендации по настройке кворума

Программное обеспечение кластера автоматически настраивает кворум для нового кластера в соответствии с числом настроенных узлов и доступностью общего хранилища. Обычно это оптимальная конфигурация кворума для данного кластера. Однако рекомендуется проверить конфигурацию кворума после создания кластера и перед его запуском. Для просмотра подробной конфигурации кворума кластера, вы можете использовать мастер проверки конфигурации, или [Test-Cluster](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps) командлета Windows PowerShell для запуска **Проверка конфигурации кворума** тестирования. В диспетчере отказоустойчивости кластеров базовая конфигурация кворума содержится в сводной информации о выбранном кластере, также можно просмотреть информацию о ресурсах кворума, которая выводится при запуске [Get-ClusterQuorum](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusterquorum?view=win10-ps) Командлет Windows PowerShell.

В любой момент можно выполнить тест **Проверка конфигурации кворума**, чтобы проверить, является ли конфигурация кворума оптимальной для кластера. В результатах теста приводятся рекомендации по изменению конфигурации кворума и информация об оптимальных параметрах. Если рекомендуется внести изменение, применить нужные параметры можно с помощью мастера настройки кворума кластера.

После запуска кластера изменять конфигурацию кворума следует только в том случае, если вы уверены, что это изменение необходимо. Изменение конфигурации кворума может потребоваться в следующих ситуациях:

- добавление или исключение узлов;
- добавление или удаление хранилища;
- длительный сбой узла или свидетеля;
- восстановление кластера в сценарии аварийного восстановления на основе нескольких сайтов.

Подробнее о проверке отказоустойчивого кластера см. в разделе [Проверка оборудования для отказоустойчивого кластера](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>).

## <a name="configure-the-cluster-quorum"></a>Настройка кворума кластера

Можно настроить параметры кворума кластера с помощью диспетчера отказоустойчивости кластеров или командлеты PowerShell Windows для кластеров отработки отказа.

>[!IMPORTANT]
>Как правило, лучше использовать конфигурацию кворума, рекомендованную мастером настройки кворума кластера. Изменять конфигурацию кворума рекомендуется только в том случае, если решено, что изменение соответствует данному кластеру. Дополнительные сведения см. в разделе [Общие рекомендации по настройке кворума](#general-recommendations-for-quorum-configuration) этой статьи.

### <a name="configure-the-cluster-quorum-settings"></a>Настройка параметров кворума кластера

Для выполнения этой процедуры необходимо быть как минимум участником локальной группы **Администраторы** на каждом кластерном сервере или иметь равнозначные права. Кроме того, используемая учетная запись должна быть учетной записью пользователя домена.

>[!NOTE]
>Изменять конфигурацию кворума кластера можно без остановки кластера и без отключения его ресурсов.

### <a name="change-the-quorum-configuration-in-a-failover-cluster-by-using-failover-cluster-manager"></a>Изменять конфигурацию кворума в отказоустойчивом кластере с помощью диспетчера отказоустойчивости кластеров

1. В диспетчере отказоустойчивости кластеров выберите или укажите кластер, который нужно изменить.
2. Выбрав кластер, в разделе **действия**выберите **дополнительные действия**, а затем выберите **настроить параметры кворума кластера**. Появится мастер настройки кворума кластера. Выберите **Далее**.
3. На странице **Выбор параметра конфигурации кворума** выберите один из трех параметров конфигурации и выполните необходимые для него действия. Перед настройкой параметров кворума можно изучить возможные варианты. Дополнительные сведения о параметрах см. в разделе [Обзор кворума в отказоустойчивом кластере](#overview-of-the-quorum-in-a-failover-cluster)ранее в этом разделе.

    - Чтобы разрешить кластеру автоматически установить параметры кворума, оптимальные для текущей конфигурации кластера, выберите **использовать типичные параметры** и завершите работу мастера.
    - Чтобы добавить или изменить свидетель кворума, выберите **добавить или изменить свидетель кворума**, а затем выполните следующие действия. Информацию и рекомендации по настройке свидетеля кворума см. в подразделе [Настройка свидетеля](#witness-configuration) ранее в этом разделе.

      1. На странице **Выбор свидетеля кворума** выберите, нужно ли настроить диск-свидетель или файловый ресурс-свидетель. В мастере будут показаны параметры выбора свидетеля, рекомендованные для вашего кластера.

          >[!NOTE]
          >Также можно выбрать параметр **Не настраивать свидетель кворума** и завершить работу мастера. Если число голосующих узлов в кластере четное, такая конфигурация не рекомендуется.

      2. Если вы выбрали настройку диска-свидетеля, на странице **Настройка хранилища** выберите том хранилища, который нужно назначить диском-свидетелем, а затем завершите работу мастера.
      3. Если вы выбрали настройку файлового ресурса-свидетеля, на странице **Настройка файлового ресурса-свидетеля** введите имя файлового ресурса, который будет использоваться в качестве ресурса-свидетеля, или выберите его, а затем завершите работу мастера.

    - Для настройки параметры управления кворумом, а также добавить или изменить свидетель кворума, выберите **Advanced выбора конфигурации и следящего сервера кворума**, а затем выполните следующие действия. Информацию и рекомендации по дополнительным параметрам конфигурации кворума см. в подразделах [Назначение голосов узлов](#node-vote-assignment) и [Динамическое управление кворумом](#dynamic-quorum-management) ранее в этом разделе.

      1. На странице **Выбор конфигурации голосования** выберите вариант назначения голосов узлам. По умолчанию голоса назначены всем узлам. Однако в некоторых сценариях можно назначить голоса только подмножеству узлов.

          >[!NOTE]
          >Также можно выбрать вариант **Нет узлов**. Обычно делать это не рекомендуется, так как узлам при этом не разрешено принимать участие в голосовании в кворуме, и необходимо настроить диск-свидетель. Диск-свидетель становится единой точкой отказа в кластере.

      2. На странице **Настройка управления кворумом** можно включить или отключить параметр **Разрешить кластеру динамически управлять назначением голосов узлов**. Выбор этого параметра, как правило, повышает доступность кластера. По умолчанию он включен, и настоятельно не рекомендуется его отключать. Этот параметр позволяет кластеру продолжать работу в таких сценариях сбоя, в которых его функционирование невозможно, если параметр отключен.
      3. На странице **Выбор свидетеля кворума** выберите, нужно ли настроить диск-свидетель или файловый ресурс-свидетель. В мастере будут показаны параметры выбора свидетеля, рекомендованные для вашего кластера.

          >[!NOTE]
          >Также можно выбрать параметр **Не настраивать свидетель кворума**и завершить работу мастера. Если число голосующих узлов в кластере четное, такая конфигурация не рекомендуется.

      4. Если вы выбрали настройку диска-свидетеля, на странице **Настройка хранилища** выберите том хранилища, который нужно назначить диском-свидетелем, а затем завершите работу мастера.
      5. Если вы выбрали настройку файлового ресурса-свидетеля, на странице **Настройка файлового ресурса-свидетеля** введите имя файлового ресурса, который будет использоваться в качестве ресурса-свидетеля, или выберите его, а затем завершите работу мастера.

4. Выберите **Далее**. Подтвердите свой выбор на странице подтверждения, который отображается, а затем выберите **Далее**.

После выполнения мастера и **Сводка** откроется страница, если вы хотите просмотреть отчет о задачах, выполненных мастером, выберите **отчет**. Последний отчет останется в *systemroot ***\\кластера\\отчеты** папка с именем **QuorumConfiguration.mht**.

>[!NOTE]
>После настройки кворума кластера рекомендуем выполнить тест **Проверка конфигурации кворума** , чтобы проверить обновленные параметры кворума.

### <a name="windows-powershell-equivalent-commands"></a>Эквивалентные команды Windows PowerShell

Следующие примеры показывают, как использовать [Set-ClusterQuorum](https://docs.microsoft.com/powershell/module/failoverclusters/set-clusterquorum?view=win10-ps) командлета и другие командлеты Windows PowerShell для настройки кворума кластера.

В следующем примере конфигурация кворума в кластере *CONTOSO-FC1* меняется на простую конфигурацию с большинством узлов и без свидетеля кворума.

```PowerShell
Set-ClusterQuorum –Cluster CONTOSO-FC1 -NodeMajority
```

В следующем примере конфигурация кворума в локальном кластере меняется на конфигурацию с большинством узлов и свидетелем. Дисковый ресурс с именем *Cluster Disk 2* настраивается как диск-свидетель.

```PowerShell
Set-ClusterQuorum -NodeAndDiskMajority "Cluster Disk 2"
```

В следующем примере конфигурация кворума в локальном кластере меняется на конфигурацию с большинством узлов и свидетелем. Файловый ресурс с именем  *\\ \\CONTOSO-FS\\fsw* настроен как файловый ресурс-свидетель.

```PowerShell
Set-ClusterQuorum -NodeAndFileShareMajority "\\fileserver\fsw"
```

В следующем примере узел *ContosoFCNode1* в локальном кластере лишается голоса кворума.

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=0
```

В следующем примере узлу *ContosoFCNode1* в локальном кластере назначается голос кворума.

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=1
```

В следующем примере включается свойство **DynamicQuorum** кластера *CONTOSO-FC1* (если оно было отключено).

```PowerShell
(Get-Cluster CONTOSO-FC1).DynamicQuorum=1
```

## <a name="recover-a-cluster-by-starting-without-quorum"></a>Восстановление кластера путем запуска без кворума

Кластер, в котором недостаточно голосов кворума, не запустится. В первую очередь необходимо проверить конфигурацию кворума кластера и выяснить, почему в кластере больше нет кворума. Это может произойти из-за того, что узлы перестали отвечать на запросы, или из-за того, что основной сайт в кластере с несколькими сайтами стал недоступен. Установив основную причину сбоя кластера, вы можете выполнить инструкции по восстановлению, приведенные в этом разделе.

>[!NOTE]
> * Если служба кластера была остановлена из-за отсутствия кворума, в системном журнале появляется событие с кодом 1177.
> * Всегда необходимо выяснить, почему в кластере больше нет кворума.
> * В любом случае предпочтительнее восстановить работоспособность узла или свидетеля кворума (присоединить их к кластеру), чем запускать кластер без кворума.

### <a name="force-start-cluster-nodes"></a>Принудительный запуск узлов кластера

Если вы установили, что восстановить кластер путем приведения узлов или свидетеля кворума в работоспособное состояние невозможно, то необходимо принудительно запустить кластер. При принудительном запуске параметры конфигурации кворума кластера переопределяются, и кластер запускается в режиме **ForceQuorum**.

Принудительный запуск кластера без кворума может быть особенно полезен в случае с кластером с несколькими сайтами. Рассмотрим сценарий аварийного восстановления, в котором кластер содержит расположенные отдельно основной и резервный сайты (*СайтА* и *СайтБ*). Если с сайтом *СайтА* произошла серьезная авария, то на его восстановление может потребоваться значительное количество времени. Скорее всего, вы захотите принудительно включить *СайтБ*, даже если у него нет кворума.

Если кластер был запущен в режиме **ForceQuorum**, то после восстановления достаточного количества голосов для кворума он автоматически переходит из состояния принудительного запуска в обычное состояние. Поэтому перезапускать кластер в обычном режиме не нужно. Если после этого в результате отключения узла кворум утрачивается, кластер снова перестает работать, так как он больше не находится в состоянии принудительного запуска. Чтобы снова подключить его, если он не имеет кворума требует принудительного запуска кластера без кворума.

>[!IMPORTANT]
>* При принудительном запуске кластера администратор получает полный контроль над ним.
>* Кластер использует конфигурацию узла, на котором он принудительно запускается, и реплицирует ее на все остальные доступные узлы.
>* При принудительном запуске кластера без кворума все параметры конфигурации кворума игнорируются, пока кластер находится в режиме **ForceQuorum**. Сюда относятся назначенные конкретным узлам голоса и параметры управления кворумом.

### <a name="prevent-quorum-on-remaining-cluster-nodes"></a>Блокирование кворума на оставшихся узлах кластера

Принудительно запустив кластер на одном из узлов, необходимо запустить оставшиеся узлы кластера с блокировкой кворума. При запуске узла с блокировкой кворума он указывает службе кластера, что его необходимо присоединить к уже запущенному кластеру вместо создания нового экземпляра кластера. Это позволяет предотвратить образование оставшимися узлами расщепленного кластера, содержащего два конкурирующих экземпляра.

Это может потребоваться при восстановлении кластера в некоторых сценариях аварийного восстановления на основе нескольких сайтов, после того как вы принудительно запустили кластер на резервном сайте ( *СайтБ*). Для присоединения к принудительно запущенному кластеру на сайте *СайтБ* узлы на основном сайте, *СайтА*, должны быть запущены с блокировкой кворума.

>[!IMPORTANT]
>После принудительного запуска кластера на одном из узлов рекомендуется всегда запускать остальные узлы с блокировкой кворума.

Вот как можно восстановить кластер с помощью диспетчера отказоустойчивости кластеров:

1. В диспетчере отказоустойчивости кластеров выберите или укажите кластер, который нужно восстановить.
2. Выбрав кластер, в разделе **действия**выберите **принудительный запуск кластера**.

    Диспетчер отказоустойчивости кластеров принудительно запустит кластер на всех доступных узлах. При запуске кластера используется текущая конфигурация.

>[!NOTE]
>* Чтобы принудительно запустить кластер на определенном узле, содержащем конфигурацию кластера, который вы хотите использовать, необходимо использовать командлеты Windows PowerShell или эквивалентными средствами командной строки, представленный после этой процедуры. 
> * Если вы используете диспетчер отказоустойчивости кластеров для подключения к принудительно запущенному кластеру и выбираете действие **Запустить службу кластеров** для запуска узла, узел автоматически запускается с блокировкой кворума.

#### <a name="windows-powershell-equivalent-commands-start-clusternode"></a>Эквивалентные команды Windows PowerShell (Start-Clusternode)

В приведенных ниже примерах показано, как использовать командлет **Start-ClusterNode** для принудительного запуска кластера на узле *ContosoFCNode1*.

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –FQ
```

Вы также можете выполнить следующую команду локально на узле.

```PowerShell
Net Start ClusSvc /FQ
```

В следующем примере показано, как с помощью командлета **Start-ClusterNode** запустить службу кластеров с блокировкой кворума на узле *ContosoFCNode1*.

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –PQ
```

Вы также можете выполнить следующую команду локально на узле.

```PowerShell
Net Start ClusSvc /PQ
```

## <a name="quorum-considerations-for-disaster-recovery-configurations"></a>Рекомендации касательно кворума для конфигураций аварийного восстановления

В этом разделе кратко описываются характеристики и конфигурации кворума для двух сценариев развертывания кластера на основе нескольких сайтов для обеспечения аварийного восстановления. Рекомендации по настройке кворума зависят от того, должна ли отработка отказа между сайтами выполняться для рабочих нагрузок автоматически или вручную. Конфигурация, как правило, зависит от принятых в организации соглашений об уровне обслуживания (SLA), которые должны обеспечивать выполнение кластерных рабочих нагрузок в случае сбоя или аварии сайта.

### <a name="automatic-failover"></a>Автоматическая отработка отказа

В этой конфигурации кластер состоит из двух или нескольких сайтов, на которых могут размещаться кластерные роли. Если на каком-либо сайте происходит сбой, кластерные роли должны автоматически переноситься на оставшиеся сайты. Поэтому кворум кластера должен быть настроен так, чтобы любой сайт мог сохранять работоспособность в случае полного отказа другого сайта.

В таблице ниже кратко описываются рекомендации для этой конфигурации.

<table>
<thead>
<tr class="header">
<th>Элемент</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Число голосов узлов на сайт</td>
<td>Должно быть одинаковым</td>
</tr>
<tr class="even">
<td>Назначение голосов узлов</td>
<td>Голоса узлов нельзя удалять, так как все узлы важны в одинаковой степени</td>
</tr>
<tr class="odd">
<td>Динамическое управление кворумом</td>
<td>Должно быть включено</td>
</tr>
<tr class="even">
<td>Настройка свидетеля</td>
<td>Рекомендуется использовать файловый ресурс-свидетель, настроенный на отдельном сайте (не на сайтах кластера)</td>
</tr>
<tr class="odd">
<td>Рабочие нагрузки</td>
<td>Рабочие нагрузки можно настроить на любых сайтах</td>
</tr>
</tbody>
</table>

#### <a name="additional-considerations-for-automatic-failover"></a>Дополнительные замечания по автоматической отработки отказа

- Настраивать файловый ресурс-свидетель на отдельном сайте необходимо для того, чтобы дать всем сайтам одинаковые возможности по сохранению работоспособности. Подробнее см. в подразделе [Настройка свидетеля](#witness-configuration) ранее в этом разделе.

### <a name="manual-failover"></a>Отработка отказа вручную

В этой конфигурации кластер состоит из основного сайта ( *СайтА*) и резервного сайта ( *СайтБ*). Кластерные роли размещаются на сайте *СайтА*. Из-за конфигурации кворума кластера в случае сбоя всех узлов на сайте *СайтА* кластер прекращает работу. В этом сценарии администратор должен вручную перенести службы кластеров на *СайтБ* и выполнить дополнительные действия по восстановлению кластера.

В таблице ниже кратко описываются рекомендации для этой конфигурации.

<table>
<thead>
<tr class="header">
<th>Элемент</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Число голосов узлов на сайт</td>
<td>Может быть разным</td>
</tr>
<tr class="even">
<td>Назначение голосов узлов</td>
<td>- Голоса узлов не следует удалять из узлов на первичном сайте, <em>сайта</em><br />
- Голоса узлов должны быть удалены из узлов на резервном сайте <em>Сайтб</em><br />
- Если длительный простой <em>SiteA</em>, голоса необходимо назначить узлам на <em>Сайтб</em> включить большинство участников кворума на этом сайте как часть процесса восстановления</td>
</tr>
<tr class="odd">
<td>Динамическое управление кворумом</td>
<td>Должно быть включено</td>
</tr>
<tr class="even">
<td>Настройка свидетеля</td>
<td>- Настройте свидетель при четном числе узлов в <em>сайта</em><br />
- Если необходим свидетель, настройте файловый ресурс-свидетель или диск-свидетель, доступный только для узлов на <em>SiteA</em> (иногда называется асимметричным диском-свидетелем)</td>
</tr>
<tr class="odd">
<td>Рабочие нагрузки</td>
<td>Используйте предпочтительных владельцев для выполнения рабочих нагрузок на узлах сайта <em>СайтА</em></td>
</tr>
</tbody>
</table>

#### <a name="additional-considerations-for-manual-failover"></a>Дополнительные замечания по на другой ресурс вручную

- Голоса кворума изначально настраиваются только для узлов на сайте *СайтА* . Это необходимо для того, чтобы состояние узлов на сайте *СайтБ* не влияло на кворум кластера.
- Инструкции по восстановлению могут быть разными в зависимости от того, испытывает ли *СайтА* временный или длительный сбой.

## <a name="more-information"></a>Дополнительные сведения

* [Отказоустойчивая кластеризация](failover-clustering.md)
* [Командлеты отказоустойчивого кластеров Windows PowerShell](https://docs.microsoft.com/powershell/module/failoverclusters/?view=win10-ps)
* [Основные сведения о кластере и кворума пула](../storage/storage-spaces/understand-quorum.md)