---
title: Настройка кворума и управление им в отказоустойчивом кластере
description: Подробные сведения об управлении кворумом кластера в отказоустойчивом кластере Windows Server.
ms.prod: windows-server
ms.topic: article
author: JasonGerend
ms.author: jgerend
manager: lizross
ms.technology: storage-failover-clustering
ms.date: 06/07/2019
ms.localizationpriority: medium
ms.openlocfilehash: 2847b9268207155efc181c97c58a91c1d51eac6d
ms.sourcegitcommit: d99bc78524f1ca287b3e8fc06dba3c915a6e7a24
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/27/2020
ms.locfileid: "87177820"
---
# <a name="configure-and-manage-quorum"></a>Настройка кворума и управление им

> Применяется к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Этот раздел содержит общие сведения о настройке кворума и управлении им в отказоустойчивом кластере Windows Server.

## <a name="understanding-quorum"></a>Основные сведения о кворуме

Кворум кластера определяется числом голосующих элементов, являющихся активными членами кластера, которое необходимо для запуска кластера и его правильной работы. Более подробное описание см. в разделе [Общие сведения о кластере и документе кворума пула](../storage/storage-spaces/understand-quorum.md).

## <a name="quorum-configuration-options"></a>Параметры конфигурации кворума

Модель кворума в Windows Server является гибкой. Если необходимо изменить конфигурацию кворума для кластера, можно использовать мастер настройки кворума кластера или командлеты Windows PowerShell для отказоустойчивых кластеров. Инструкции и рекомендации по настройке кворума см. в подразделе [Настройка кворума кластера](#configure-the-cluster-quorum) далее в этом разделе.

В таблице ниже перечислены три параметра конфигурации кворума, доступные в мастере настройки кворума кластера.

| Параметр  |Описание  |
| --------- | ---------|
| Использовать обычные параметры     |  Кластер автоматически назначает голос каждому узлу и динамически управляет голосами узлов. Если это возможно в случае с вашим кластером и доступно общее хранилище кластера, кластер выбирает диск-свидетель. Это рекомендуется в большинстве случаев, поскольку автоматический выбор конфигурации кворума и свидетеля обеспечивает максимальную доступность кластера.       |
| Добавить или изменить свидетеля кворума     |   Вы можете добавить, изменить или удалить ресурс свидетеля. Можно настроить общий файловый ресурс или диск-свидетель. Кластер автоматически назначает голос каждому узлу и динамически управляет голосами узлов.      |
| Расширенная конфигурация кворума и выбор свидетеля     | Этот параметр следует выбирать только при специфических для приложения или сайта требованиях к конфигурации кворума. Вы можете изменить свидетеля кворума, добавить или удалить голоса узлов, а также указать, должен ли кластер динамически управлять голосами узлов. По умолчанию голоса назначаются всем узлам, а управление голосами узлов осуществляется автоматически.        |

В зависимости от выбранного варианта конфигурации кворума и заданных параметров для кластера настраивается один из указанных ниже режимов кворума.

| Режим  | Описание  |
| --------- | ---------|
| Большинство узлов (без свидетеля)     |   Голоса имеют только узлы. Свидетель кворума не настраивается. Кворум кластера определяется большинством голосующих узлов, являющихся активными членами кластера.      |
| Большинство узлов со свидетелем (диск или файловый ресурс)     |   Узлы имеют голоса. Кроме того, голос имеет свидетель кворума. Кворум кластера определяется большинством голосующих узлов, являющихся активными членами кластера, а также голосом свидетеля. Свидетелем кворума может быть свидетель на выделенном диске или свидетель на общем файловом ресурсе.
| Без большинства (только диск-свидетель)     | Узлы не имеют голосов. Голос имеет только диск-свидетель. <br>Кворум кластера определяется состоянием диска-свидетеля. Как правило, использовать этот режим не рекомендуется, так как в кластере возникает единая точка отказа.       |

В следующих подразделах приведены дополнительные сведения о дополнительных параметрах конфигурации кворума.

### <a name="witness-configuration"></a>Настройка свидетеля

Как правило, при настройке кворума число голосующих элементов в кластере должно быть нечетным. Поэтому, если кластер содержит четное число голосующих узлов, следует настроить диск-свидетель или файловый ресурс-свидетель. Кластер сможет продолжать работу при отключении одного дополнительного узла. Кроме того, добавление голоса свидетеля позволяет кластеру продолжать работу в том случае, если половина его узлов одновременно прекращает работу или отключается.

Использовать диск-свидетель обычно рекомендуется, если диск доступен всем узлам. Файловый ресурс-свидетель рекомендуется в том случае, если необходимо реализовать аварийное восстановление нескольких сайтов с реплицированным хранилищем. Настройка диска-свидетеля с реплицированным хранилищем возможна только в том случае, если поставщик хранилища поддерживает доступ для чтения и записи к реплицированному хранилищу со всех сайтов. <strong>*С Локальные дисковые пространства не поддерживается диск-свидетель*</strong>.

В таблице ниже приводится дополнительная информация и рекомендации касательно типов свидетеля кворума.

| Тип свидетеля  | Описание  | Требования и рекомендации  |
| ---------    |---------        |---------                        |
| Диск-свидетель     |  <ul><li> Выделенный LUN, в котором хранится копия базы данных кластера</li><li> Оптимальный вариант для кластеров с общим (не реплицированным) хранилищем</li>       |  <ul><li>Размер LUN должен быть не меньше 512 МБ</li><li> Должен быть выделен для кластера и не назначаться кластерной роли</li><li> Должен быть включен в кластерное хранилище и пройти проверочные тесты хранилища</li><li> Не может быть общим томом кластера (CSV)</li><li> Базовый диск с одним томом</li><li> Не нуждается в букве диска</li><li> Может иметь файловую систему NTFS или ReFS</li><li> Можно настроить аппаратную конфигурацию RAID для отказоустойчивости</li><li> Должен быть исключен из резервного копирования и антивирусного сканирования</li><li> Диск-свидетель не поддерживается с Локальные дисковые пространства</li>|
| Файловый ресурс-свидетель     | <ul><li>Файловый ресурс SMB, настроенный на файловом сервере с ОС Windows Server</li><li> Копия базы данных кластера не хранится</li><li> Информация о кластере хранится только в файле witness.log</li><li> Оптимальный вариант для кластеров с несколькими сайтами и реплицированным хранилищем </li>       |  <ul><li>Свободное пространство должно быть не меньше 5 МБ</li><li> Должен быть выделен для одного кластера и не использоваться для хранения данных пользователей или приложений</li><li> Для объекта-компьютера имени кластера должны быть включены разрешения на запись</li></ul><br>Ниже приведены дополнительные рекомендации касательно файлового сервера, на котором размещается файловый ресурс-свидетель.<ul><li>На одном файловом сервере можно настроить файловые ресурсы-свидетели для нескольких кластеров.</li><li> Файловый сервер должен относиться к сайту, на котором не выполняется рабочая нагрузка кластера. Это дает всем сайтам кластера равные возможности по сохранению работоспособности в случае, если сетевое соединение между сайтами утеряно. Если файловый сервер находится на том же сайте, этот сайт становится основным и единственным сайтом, который имеет доступ к файловому ресурсу.</li><li> Файловый сервер может выполняться на виртуальной машине, если она размещена в кластере, отличном от того, который использует файловый ресурс-свидетель.</li><li> Для обеспечения высокой доступности файловый сервер можно настроить в отдельном отказоустойчивом кластере. </li>      |
| Облако-свидетель     |  <ul><li>Файл следящего сервера, хранящийся в хранилище BLOB-объектов Azure</li><li> Рекомендуется, если все серверы в кластере имеют надежное подключение к Интернету.</li>      |  См. раздел [развертывание свидетеля облака](https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness).       |

### <a name="node-vote-assignment"></a>Назначение голосов узлов

В качестве дополнительного параметра конфигурации кворума можно назначить или удалить голоса кворума для каждого узла. По умолчанию голоса назначены всем узлам. Вне зависимости от назначения голосов, все узлы продолжают работать в кластере, получать обновления из базы данных кластера и использоваться для размещения приложений.

В некоторых конфигурациях аварийного восстановления может потребоваться удалить голоса, назначенные узлам. Например, в кластере с несколькими сайтами можно удалить голоса узлов на сайте резервного копирования, чтобы они не оказывали влияния на подсчет кворума. Такая конфигурация рекомендуется только при отработке отказа между сайтами вручную. Подробнее см. в подразделе [Рекомендации касательно кворума для конфигураций аварийного восстановления](#quorum-considerations-for-disaster-recovery-configurations) далее в этом разделе.

Настроенный голос узла можно проверить, выполнив поиск общего свойства **NodeWeight** узла кластера с помощью командлета Windows PowerShell [Get-ClusterNode](https://technet.microsoft.com/library/hh847268.aspx). Значение 0 указывает на то, что для узла не настроен голос кворума. Значение 1 указывает на то, что узлу назначен голос кворума и управление им осуществляется кластером. Подробнее об управлении голосами узлов см. в подразделе [Динамическое управление кворумом](#dynamic-quorum-management) далее в этом разделе.

Назначение голосов всем узлам кластера можно проверить с помощью теста **Проверка кворума кластера**.

#### <a name="additional-considerations-for-node-vote-assignment"></a>Дополнительные рекомендации по назначению голосования в узле

  - Не рекомендуется назначать голоса нечетному числу узлов. Вместо этого следует настроить диск-свидетель или файловый ресурс-свидетель. Дополнительные сведения см. в подразделе [Конфигурация следящего сервера](#witness-configuration) далее в этой статье.
  - Если включено динамическое управление кворумом, голоса могут динамически назначаться и удаляться только для тех узлов, для которых настроено назначение голосов. Подробнее см. в подразделе [Динамическое управление кворумом](#dynamic-quorum-management) далее в этом разделе.

### <a name="dynamic-quorum-management"></a>Динамическое управление кворумом

В Windows Server 2012 в качестве дополнительного параметра конфигурации кворума можно включить динамическое управление кворумом в кластере. Дополнительные сведения о работе динамического кворума см. в [этом объяснении](../storage/storage-spaces/understand-quorum.md#dynamic-quorum-behavior).

Благодаря динамическому управлению кворумом кластер также может продолжать работать на последнем оставшемся узле. Благодаря динамическому изменению требований к большинству кворума кластер может сохранять работоспособность после последовательного отключения всех узлов, кроме последнего.

Динамический голос, назначенный кластеру узла, можно проверить с помощью общего свойства **динамиквеигхт** узла кластера, используя командлет Windows PowerShell [Get-ClusterNode](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusternode?view=win10-ps) . Значение 0 указывает на то, что у узла нет голоса кворума. Значение 1 указывает на то, что у узла есть голос кворума.

Назначение голосов всем узлам кластера можно проверить с помощью теста **Проверка кворума кластера**.

#### <a name="additional-considerations-for-dynamic-quorum-management"></a>Дополнительные рекомендации по управлению динамическими кворумами

- Динамическое управление кворумом не позволяет кластеру сохранять работоспособность при одновременном сбое большинства голосующих членов. Для продолжения работы в кластере должно быть большинство кворума на момент завершения работы или сбоя узла.

- Если вы явно удалили голос узла, кластер не сможет динамически добавить или удалить его.
- Если Локальные дисковые пространства включен, кластер может поддерживать только два сбоя узла. Это объясняется в [разделе кворум пула](../storage/storage-spaces/understand-quorum.md) .

## <a name="general-recommendations-for-quorum-configuration"></a>Общие рекомендации по настройке кворума

Программное обеспечение кластера автоматически настраивает кворум для нового кластера в соответствии с числом настроенных узлов и доступностью общего хранилища. Обычно это оптимальная конфигурация кворума для данного кластера. Однако рекомендуется проверить конфигурацию кворума после создания кластера и перед его запуском. Чтобы просмотреть подробную конфигурацию кворума кластера, можно воспользоваться мастером проверки конфигурации или командлетом Windows PowerShell [Test-Cluster](https://docs.microsoft.com/powershell/module/failoverclusters/test-cluster?view=win10-ps) , чтобы выполнить проверку **конфигурации кворума** . В диспетчер отказоустойчивости кластеров базовая конфигурация кворума отображается в сводных данных для выбранного кластера, или можно просмотреть сведения о ресурсах кворума, которые возвращаются при выполнении командлета Windows PowerShell [Get-клустеркуорум](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusterquorum?view=win10-ps) .

В любой момент можно выполнить тест **Проверка конфигурации кворума**, чтобы проверить, является ли конфигурация кворума оптимальной для кластера. В результатах теста приводятся рекомендации по изменению конфигурации кворума и информация об оптимальных параметрах. Если рекомендуется внести изменение, применить нужные параметры можно с помощью мастера настройки кворума кластера.

После запуска кластера изменять конфигурацию кворума следует только в том случае, если вы уверены, что это изменение необходимо. Изменение конфигурации кворума может потребоваться в следующих ситуациях:

- добавление или исключение узлов;
- добавление или удаление хранилища;
- длительный сбой узла или свидетеля;
- восстановление кластера в сценарии аварийного восстановления на основе нескольких сайтов.

Подробнее о проверке отказоустойчивого кластера см. в разделе [Проверка оборудования для отказоустойчивого кластера](</previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v%3dws.11)>).

## <a name="configure-the-cluster-quorum"></a>Настройка кворума кластера

Параметры кворума кластера можно настроить с помощью диспетчер отказоустойчивости кластеров или командлетов Windows PowerShell для отказоустойчивых кластеров.

> [!IMPORTANT]
> Как правило, лучше использовать конфигурацию кворума, рекомендованную мастером настройки кворума кластера. Изменять конфигурацию кворума рекомендуется только в том случае, если решено, что изменение соответствует данному кластеру. Подробнее см. в подразделе [Общие рекомендации по настройке кворума](#general-recommendations-for-quorum-configuration).

### <a name="configure-the-cluster-quorum-settings"></a>Настройка параметров кворума кластера

Для выполнения этой процедуры необходимо быть как минимум участником локальной группы **Администраторы** на каждом кластерном сервере или иметь равнозначные права. Кроме того, используемая учетная запись должна быть учетной записью пользователя домена.

> [!NOTE]
> Изменять конфигурацию кворума кластера можно без остановки кластера и без отключения его ресурсов.

### <a name="change-the-quorum-configuration-in-a-failover-cluster-by-using-failover-cluster-manager"></a>Измените конфигурацию кворума в отказоустойчивом кластере с помощью диспетчер отказоустойчивости кластеров

1. В диспетчере отказоустойчивости кластеров выберите или укажите кластер, который нужно изменить.
2. Выбрав кластер, в разделе **действия**выберите **Дополнительные действия**, а затем щелкните **Настройка параметров кворума кластера**. Появится мастер настройки кворума кластера. Выберите **Далее**.
3. На странице **Выбор параметра конфигурации кворума** выберите один из трех параметров конфигурации и выполните необходимые для него действия. Перед настройкой параметров кворума можно изучить возможные варианты. Дополнительные сведения о параметрах см. в разделе Основные сведения о [кворуме](#understanding-quorum)ранее в этой статье.

    - Чтобы разрешить кластеру автоматически сбрасывать параметры кворума, оптимальные для текущей конфигурации кластера, выберите **параметр использовать типичные параметры** , а затем завершите работу мастера.
    - Чтобы добавить или изменить следящий сервер кворума, выберите **Добавить или изменить следящий сервер кворума**, а затем выполните следующие действия. Информацию и рекомендации по настройке свидетеля кворума см. в подразделе [Настройка свидетеля](#witness-configuration) ранее в этом разделе.

      1. На странице **Выбор свидетеля кворума** выберите, нужно ли настроить диск-свидетель или файловый ресурс-свидетель. В мастере будут показаны параметры выбора свидетеля, рекомендованные для вашего кластера.

          > [!NOTE]
          > Также можно выбрать параметр **Не настраивать свидетель кворума** и завершить работу мастера. Если число голосующих узлов в кластере четное, такая конфигурация не рекомендуется.

      2. Если вы выбрали настройку диска-свидетеля, на странице **Настройка хранилища** выберите том хранилища, который нужно назначить диском-свидетелем, а затем завершите работу мастера.
      3. Если вы выбрали настройку файлового ресурса-свидетеля, на странице **Настройка файлового ресурса-свидетеля** введите имя файлового ресурса, который будет использоваться в качестве ресурса-свидетеля, или выберите его, а затем завершите работу мастера.

    - Чтобы настроить параметры управления кворумом и добавить или изменить следящий сервер кворума, выберите **Дополнительные настройки кворума и выбор следящего сервера**, а затем выполните следующие действия. Информацию и рекомендации по дополнительным параметрам конфигурации кворума см. в подразделах [Назначение голосов узлов](#node-vote-assignment) и [Динамическое управление кворумом](#dynamic-quorum-management) ранее в этом разделе.

      1. На странице **Выбор конфигурации голосования** выберите вариант назначения голосов узлам. По умолчанию голоса назначены всем узлам. Однако в некоторых сценариях можно назначить голоса только подмножеству узлов.

          > [!NOTE]
          > Также можно выбрать вариант **Нет узлов**. Обычно делать это не рекомендуется, так как узлам при этом не разрешено принимать участие в голосовании в кворуме, и необходимо настроить диск-свидетель. Диск-свидетель становится единой точкой отказа в кластере.

      2. На странице **Настройка управления кворумом** можно включить или отключить параметр **Разрешить кластеру динамически управлять назначением голосов узлов**. Выбор этого параметра, как правило, повышает доступность кластера. По умолчанию он включен, и настоятельно не рекомендуется его отключать. Этот параметр позволяет кластеру продолжать работу в таких сценариях сбоя, в которых его функционирование невозможно, если параметр отключен.
      3. На странице **Выбор свидетеля кворума** выберите, нужно ли настроить диск-свидетель или файловый ресурс-свидетель. В мастере будут показаны параметры выбора свидетеля, рекомендованные для вашего кластера.

          > [!NOTE]
          > Также можно выбрать параметр **Не настраивать свидетель кворума** и завершить работу мастера. Если число голосующих узлов в кластере четное, такая конфигурация не рекомендуется.

      4. Если вы выбрали настройку диска-свидетеля, на странице **Настройка хранилища** выберите том хранилища, который нужно назначить диском-свидетелем, а затем завершите работу мастера.
      5. Если вы выбрали настройку файлового ресурса-свидетеля, на странице **Настройка файлового ресурса-свидетеля** введите имя файлового ресурса, который будет использоваться в качестве ресурса-свидетеля, или выберите его, а затем завершите работу мастера.

4. Выберите **Далее**. Подтвердите выбранные параметры на странице подтверждения, а затем нажмите кнопку **Далее**.

После запуска мастера и появления страницы **Сводка** , если требуется просмотреть отчет о задачах, выполненных мастером, выберите **Просмотреть отчет**. Самый последний отчет останется в папке "** \\ \\ отчеты кластера** <em>systemroot</em>" с именем **куорумконфигуратион. MHT**.

> [!NOTE]
> После настройки кворума кластера рекомендуем выполнить тест **Проверка конфигурации кворума**, чтобы проверить обновленные параметры кворума.

### <a name="windows-powershell-equivalent-commands"></a>Эквивалентные команды Windows PowerShell

В следующих примерах показано, как использовать командлет [Set-клустеркуорум](https://docs.microsoft.com/powershell/module/failoverclusters/set-clusterquorum?view=win10-ps) и другие командлеты Windows PowerShell для настройки кворума кластера.

В следующем примере конфигурация кворума в кластере *CONTOSO-FC1* меняется на простую конфигурацию с большинством узлов и без свидетеля кворума.

```PowerShell
Set-ClusterQuorum –Cluster CONTOSO-FC1 -NodeMajority
```

В следующем примере конфигурация кворума в локальном кластере меняется на конфигурацию с большинством узлов и свидетелем. Дисковый ресурс с именем *Cluster Disk 2* настраивается как диск-свидетель.

```PowerShell
Set-ClusterQuorum -NodeAndDiskMajority "Cluster Disk 2"
```

В следующем примере конфигурация кворума в локальном кластере меняется на конфигурацию с большинством узлов и свидетелем. Ресурс общей папки с именем * \\ \\ contoso-FS \\ FSW* настроен в качестве файлового ресурса-свидетеля.

```PowerShell
Set-ClusterQuorum -NodeAndFileShareMajority "\\fileserver\fsw"
```

В следующем примере узел *ContosoFCNode1* в локальном кластере лишается голоса кворума.

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=0
```

В следующем примере узлу *ContosoFCNode1* в локальном кластере назначается голос кворума.

```PowerShell
(Get-ClusterNode ContosoFCNode1).NodeWeight=1
```

В следующем примере включается свойство **DynamicQuorum** кластера *CONTOSO-FC1* (если оно было отключено).

```PowerShell
(Get-Cluster CONTOSO-FC1).DynamicQuorum=1
```

## <a name="recover-a-cluster-by-starting-without-quorum"></a>Восстановление кластера путем запуска без кворума

Кластер, в котором недостаточно голосов кворума, не запустится. В первую очередь необходимо проверить конфигурацию кворума кластера и выяснить, почему в кластере больше нет кворума. Это может произойти из-за того, что узлы перестали отвечать на запросы, или из-за того, что основной сайт в кластере с несколькими сайтами стал недоступен. Установив основную причину сбоя кластера, вы можете выполнить инструкции по восстановлению, приведенные в этом разделе.

> [!NOTE]
> * Если служба кластера была остановлена из-за отсутствия кворума, в системном журнале появляется событие с кодом 1177.
> * Всегда необходимо выяснить, почему в кластере больше нет кворума.
> * В любом случае предпочтительнее восстановить работоспособность узла или свидетеля кворума (присоединить их к кластеру), чем запускать кластер без кворума.

### <a name="force-start-cluster-nodes"></a>Принудительный запуск узлов кластера

Если вы установили, что восстановить кластер путем приведения узлов или свидетеля кворума в работоспособное состояние невозможно, то необходимо принудительно запустить кластер. При принудительном запуске параметры конфигурации кворума кластера переопределяются, и кластер запускается в режиме **ForceQuorum**.

Принудительный запуск кластера без кворума может быть особенно полезен в случае с кластером с несколькими сайтами. Рассмотрим сценарий аварийного восстановления, в котором кластер содержит расположенные отдельно основной и резервный сайты (*СайтА* и *СайтБ*). Если с сайтом *СайтА* произошла серьезная авария, то на его восстановление может потребоваться значительное количество времени. Скорее всего, вы захотите принудительно включить *СайтБ*, даже если у него нет кворума.

Если кластер был запущен в режиме **ForceQuorum**, то после восстановления достаточного количества голосов для кворума он автоматически переходит из состояния принудительного запуска в обычное состояние. Поэтому перезапускать кластер в обычном режиме не нужно. Если после этого в результате отключения узла кворум утрачивается, кластер снова перестает работать, так как он больше не находится в состоянии принудительного запуска. Чтобы вернуть его в режим «в сети», если он не имеет кворума, необходимо принудительно запустить кластер без кворума.

> [!IMPORTANT]
> * При принудительном запуске кластера администратор получает полный контроль над ним.
> * Кластер использует конфигурацию узла, на котором он принудительно запускается, и реплицирует ее на все остальные доступные узлы.
> * При принудительном запуске кластера без кворума все параметры конфигурации кворума игнорируются, пока кластер находится в режиме **ForceQuorum**. Сюда относятся назначенные конкретным узлам голоса и параметры управления кворумом.

### <a name="prevent-quorum-on-remaining-cluster-nodes"></a>Блокирование кворума на оставшихся узлах кластера

Принудительно запустив кластер на одном из узлов, необходимо запустить оставшиеся узлы кластера с блокировкой кворума. При запуске узла с блокировкой кворума он указывает службе кластера, что его необходимо присоединить к уже запущенному кластеру вместо создания нового экземпляра кластера. Это позволяет предотвратить образование оставшимися узлами расщепленного кластера, содержащего два конкурирующих экземпляра.

Это может потребоваться при восстановлении кластера в некоторых сценариях аварийного восстановления на основе нескольких сайтов, после того как вы принудительно запустили кластер на резервном сайте (*СайтБ*). Для присоединения к принудительно запущенному кластеру на сайте *СайтБ* узлы на основном сайте, *СайтА*, должны быть запущены с блокировкой кворума.

> [!IMPORTANT]
> После принудительного запуска кластера на одном из узлов рекомендуется всегда запускать остальные узлы с блокировкой кворума.

Вот как можно восстановить кластер с диспетчер отказоустойчивости кластеров:

1. В диспетчере отказоустойчивости кластеров выберите или укажите кластер, который нужно восстановить.
2. Выбрав кластер, в разделе **действия**выберите **Принудительное начало работы кластера**.

    Диспетчер отказоустойчивости кластеров принудительно запустит кластер на всех доступных узлах. При запуске кластера используется текущая конфигурация.

> [!NOTE]
> * Чтобы принудительно запустить кластер на определенном узле, содержащем конфигурацию кластера, которую необходимо использовать, необходимо использовать командлеты Windows PowerShell или эквивалентные средства командной строки, как указано в этой процедуре.
> * Если вы используете диспетчер отказоустойчивости кластеров для подключения к принудительно запущенному кластеру и выбираете действие **Запустить службу кластеров** для запуска узла, узел автоматически запускается с блокировкой кворума.

#### <a name="windows-powershell-equivalent-commands-start-clusternode"></a>Эквивалентные команды Windows PowerShell (Start-ClusterNode)

В приведенных ниже примерах показано, как использовать командлет **Start-ClusterNode** для принудительного запуска кластера на узле *ContosoFCNode1*.

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –FQ
```

Вы также можете выполнить следующую команду локально на узле.

```PowerShell
Net Start ClusSvc /FQ
```

В следующем примере показано, как  с помощью командлета **Start-ClusterNode** запустить службу кластеров с блокировкой кворума на узле *ContosoFCNode1*.

```PowerShell
Start-ClusterNode –Node ContosoFCNode1 –PQ
```

Вы также можете выполнить следующую команду локально на узле.

```PowerShell
Net Start ClusSvc /PQ
```

## <a name="quorum-considerations-for-disaster-recovery-configurations"></a>Рекомендации касательно кворума для конфигураций аварийного восстановления

В этом разделе кратко описываются характеристики и конфигурации кворума для двух сценариев развертывания кластера на основе нескольких сайтов для обеспечения аварийного восстановления. Рекомендации по настройке кворума зависят от того, должна ли отработка отказа между сайтами выполняться для рабочих нагрузок автоматически или вручную. Конфигурация, как правило, зависит от принятых в организации соглашений об уровне обслуживания (SLA), которые должны обеспечивать выполнение кластерных рабочих нагрузок в случае сбоя или аварии сайта.

### <a name="automatic-failover"></a>автоматический переход на другой ресурс

В этой конфигурации кластер состоит из двух или нескольких сайтов, на которых могут размещаться кластерные роли. Если на каком-либо сайте происходит сбой, кластерные роли должны автоматически переноситься на оставшиеся сайты. Поэтому кворум кластера должен быть настроен так, чтобы любой сайт мог сохранять работоспособность в случае полного отказа другого сайта.

В таблице ниже кратко описываются рекомендации для этой конфигурации.

| Элемент  | Описание  |
| ---------| ---------|
| Число голосов узлов на сайт     | Должно быть одинаковым       |
| Назначение голосов узлов     |  Голоса узлов нельзя удалять, так как все узлы важны в одинаковой степени       |
| Динамическое управление кворумом     |   Должно быть включено      |
| Настройка свидетеля     |  Рекомендуется использовать файловый ресурс-свидетель, настроенный на отдельном сайте (не на сайтах кластера)       |
| Рабочие нагрузки     |  Рабочие нагрузки можно настроить на любых сайтах       |

#### <a name="additional-considerations-for-automatic-failover"></a>Дополнительные рекомендации по автоматическому переходу на другой ресурс

- Настраивать файловый ресурс-свидетель на отдельном сайте необходимо для того, чтобы дать всем сайтам одинаковые возможности по сохранению работоспособности. Подробнее см. в подразделе [Настройка свидетеля](#witness-configuration) ранее в этом разделе.

### <a name="manual-failover"></a>Переход на другой ресурс вручную

В этой конфигурации кластер состоит из основного сайта (*СайтА*) и резервного сайта (*СайтБ*). Кластерные роли размещаются на сайте *СайтА*. Из-за конфигурации кворума кластера в случае сбоя всех узлов на сайте *СайтА* кластер прекращает работу. В этом сценарии администратор должен вручную перенести службы кластеров на *СайтБ* и выполнить дополнительные действия по восстановлению кластера.

В таблице ниже кратко описываются рекомендации для этой конфигурации.

| Элемент   |Описание  |
| ---------| ---------|
| Число голосов узлов на сайт     |  <ul><li> Голоса узлов нельзя удалять на основном сайте (**СайтА**)</li><li>Голоса узлов следует удалить на резервном сайте (**СайтБ**)</li><li>Если **СайтА** испытывает длительный простой, голоса необходимо назначить узлам на сайте **СайтБ**, чтобы обеспечить на нем большинство кворума для восстановления</li>       |
| Динамическое управление кворумом     |  Должно быть включено       |
| Настройка свидетеля     |  <ul><li>Настройте свидетель, если на сайте **СайтА** число узлов четное</li><li>Если необходим свидетель, настройте файловый ресурс-свидетель или диск-свидетель, доступный только узлам на сайте **СайтА** (иногда такой диск называется асимметричным диском-свидетелем)</li>       |
| Рабочие нагрузки     |  Используйте предпочтительных владельцев для выполнения рабочих нагрузок на узлах сайта **СайтА**       |

#### <a name="additional-considerations-for-manual-failover"></a>Дополнительные рекомендации по отработке отказа вручную

- Голоса кворума изначально настраиваются только для узлов на сайте *СайтА*. Это необходимо для того, чтобы состояние узлов на сайте *СайтБ* не влияло на кворум кластера.
- Инструкции по восстановлению могут быть разными в зависимости от того, испытывает ли *СайтА* временный или длительный сбой.

## <a name="more-information"></a>Дополнительные сведения

* [Отказоустойчивая кластеризация](failover-clustering.md)
* [Командлеты Windows PowerShell для работы с отказоустойчивыми кластерами](https://docs.microsoft.com/powershell/module/failoverclusters/?view=win10-ps)
* [Общие сведения о кворуме кластера и пула](../storage/storage-spaces/understand-quorum.md)