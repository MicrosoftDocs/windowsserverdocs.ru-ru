---
title: Миграция кластера домена в Windows Server 2016/2019 между
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: failover-clustering
ms.topic: article
author: johnmarlin-msft
ms.date: 01/18/2019
description: В этой статье описывается перемещение кластера Windows Server 2019 из одного домена в другой
ms.localizationpriority: medium
ms.openlocfilehash: bcfd458c94d33820f434cde3313dc069fc42ffd9
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59875945"
---
# <a name="failover-cluster-domain-migration"></a>Миграция домена отказоустойчивого кластера

> Область применения. Windows Server 2019, Windows Server 2016

Этот раздел содержит общие сведения о перемещении отработки отказа Windows Server кластеры из одного домена в другой.

## <a name="why-migrate-between-domains"></a>Зачем выполнять переход между доменами

Существует несколько сценариев, где необходим перенос кластера из одного doamin в другой.

- Выполняет слияние с CompanyB CompanyA и необходимо переместить все кластеры в домен CompanyA
- Создаются в главный центр обработки данных и отправлены в удаленные расположения кластеров
- Кластер разработана таким образом кластер рабочей группы и теперь должен быть частью домена
- Кластер был создан в качестве кластера домена и теперь должен быть частью рабочей группы
- Кластер перемещается к одной области в другой компании и представляет собой другой поддомен

Майкрософт не предоставляет поддержку для администраторов, попробуйте переместить ресурсы из одного домена в другой, если базовые операции приложения не поддерживается. Например Майкрософт не предоставляет поддержку для администраторов, попробуйте переместить Microsoft Exchange server из одного домена в другой.

   > [!WARNING]
   > Рекомендуется выполнить полное резервное копирование всего общего хранилища в кластере, прежде чем перевести кластер.

## <a name="windows-server-2016-and-earlier"></a>Windows Server 2016 и более ранних версий

В Windows Server 2016 и более ранних версиях службы кластеров не имеют возможность перемещения из одного домена в другой.  Это было вызвано Повышенная зависимость от доменных служб Active Directory и созданные виртуальные имена.   

## <a name="options"></a>Параметры

Чтобы сделать это решение, есть два варианта.

Первый вариант предполагает удаление кластера и перестроить его в новом домене.

![Удалите и перестройте](media\Cross-Domain-Cluster-Migration\Cross-Cluster-Domain-Migration-1.gif)

Как показано в анимации, этот параметр является необратимым действия выполняется:

1. Удалите кластер.
2. Измените членство в домене из узлов в новый домен.
3. Повторно создайте кластер как новый обновленный домен.  Это повлечет за собой повторного создания всех ресурсов.

Второй вариант является менее необратимым, но требуется дополнительное оборудование, как кластер будет необходимо построить в новом домене.  После перевода кластера в новом домене, запустите мастер миграции кластера для переноса ресурсов. Обратите внимание, что это не переноса данных необходимо использовать другое средство для переноса данных, таких как [миграции службы хранилища](../storage/storage-migration-service/overview.md)(после добавления поддержки кластера).

![Построение и миграция](media\Cross-Domain-Cluster-Migration\Cross-Cluster-Domain-Migration-2.gif)

Как показано в анимации, этот параметр не является необратимым, но требуется другое оборудование или узел из существующего кластера, не был удален.

1. Создайте новый clusterin нового домена и при этом иметь доступные старого кластера.
2. Используйте [мастера миграции кластера](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754481(v=ws.10)) для переноса всех ресурсов в новый кластер. Напоминание, это не копирует данные, поэтому необходимо будет выполняться отдельно.
3. Вывод из эксплуатации или удалите старый кластер.

В обоих случаях необходимо иметь все новому кластеру [кластерными приложениями](https://technet.microsoft.com/aa369082(v=vs.90)) драйверы, устарели, и возможно тестирование, чтобы убедитесь, что все будет выполняться правильно.  Это много времени, если также нужно переместить данные.

## <a name="windows-server-2019"></a>Windows Server 2019

В Windows Server 2019 года мы представили возможности миграции кластера перекрестного домена.  Итак перечисленных выше сценариях можно легко сделать, и необходимость перестроения, больше не используется.  

Перенос кластера из одного домена является сложной задачей. Для этого есть две новые командлеты PowerShell.

**Новый ClusterNameAccount** — создает учетную запись имени кластера в Active Directory **Remove-ClusterNameAccount** — удаляет учетные записи имени кластера из Active Directory

Процесс для выполнения этой задачи является изменение кластер из одного домена в рабочую группу и обратно в новом домене.  Необходимость уничтожить кластер, перестроить кластер, установить приложения и т. д не требуется. Например оно выглядело следующим образом:

![Перенос](media\Cross-Domain-Cluster-Migration\Cross-Cluster-Domain-Migration-3.gif)

## <a name="migrating-a-cluster-to-a-new-domain"></a>Миграция кластера в новый домен

В следующих шагах кластер перемещается из домена Contoso.com в новый домен Fabrikam.com.  Имя кластера не *CLUSCLUS* и с ролью файлового сервера называется *FS CLUSCLUS*.

1. Создание учетной записи локального администратора с тем же именем и паролем на всех серверах в кластере.  Это может потребоваться выполнить вход, пока серверы при перемещении между доменами.
2. Подписаться на первом сервере пользователь или администратор учетной записи домена, имеющую разрешения Active Directory для кластера имя объекта (CNO), виртуальный компьютер объектов (VCO), имеет доступ к кластеру и откройте PowerShell.
3. Убедитесь, все ресурсы сетевого имени кластера в автономный режим, состояния и выполнения следующей команды.  Эта команда приведет к удалению объектов Active Directory, которые могут иметь кластера.

   ```PowerShell
   Remove-ClusterNameAccount -Cluster CLUSCLUS -DeleteComputerObjects
   ```
4. Используйте Active Directory — пользователи и компьютеры для обеспечения компьютера CNO и VCO, объекты, связанные с именами всех кластеризованных были удалены.

   > [!NOTE]
   > Рекомендуется остановить службу кластеров на всех серверах в кластере и ручная установка типа запуска службы таким образом, чтобы служба кластеров не запускается при перезагрузке серверов при изменении доменов.

   ```PowerShell
   Stop-Service -Name ClusSvc

   Set-Service -Name ClusSvc -StartupType Manual
   ```

5. Изменить членство в домене сервера в рабочую группу, перезапустите серверы, присоединение серверов к новому домену и перезапуска.
6. После серверы размещены в новом домене, войдите на сервер пользователь или администратор учетной записи домена, имеет разрешения Active Directory для создания объектов, доступ к кластеру и откройте PowerShell. Запустите службу кластеров и снова задайте для нее автоматически.

   ```PowerShell
   Start-Service -Name ClusSvc

   Set-Service -Name ClusSvc -StartupType Automatic
   ```
7. Переведите имя кластера и всех других кластера ресурсы сетевого имени в оперативное состояние.

   ```PowerShell
   Start-ClusterResource -Name "Cluster Name"

   Start-ClusterResource -Name FS-CLUSCLUS
   ```

8. Изменение кластера для включения в новый домен с объектами связанный каталог active directory. Чтобы сделать это, команда является ниже и ресурсов сетевого имени должен быть в состоянии online.  Эта команда будет делать —, повторно создать именования объектов в Active Directory.

   ```PowerShell
   New-ClusterNameAccount -Name CLUSTERNAME -Domain NEWDOMAINNAME.com -UpgradeVCOs
   ```

    ПРИМЕЧАНИЕ. Если у вас все дополнительные группы с именами сети (т. е. кластер Hyper-V с помощью только виртуальные машины), этот параметр параметром - UpgradeVCOs не требуется.

9. Используйте Active Directory — пользователи и компьютеры для проверки нового домена и убедитесь, что были созданы связанные объекты. Если они имеют перевести оставшихся ресурсов в группах через Интернет.

   ```PowerShell
   Start-ClusterGroup -Name "Cluster Group"

   Start-ClusterGroup -Name FS-CLUSCLUS
   ```

## <a name="known-issues"></a>Известные проблемы

При использовании новой функции USB следящий сервер, будет невозможно добавить в кластер новый домен.  Обоснованием является то, что тип общей папки следящего сервера должны использовать Kerberos для проверки подлинности.  Измените свидетель нет перед добавлением кластера к домену.  После ее завершения, повторно создайте USB следящий сервер.  — Вы увидите сообщение об ошибке:

```
New-ClusternameAccount : Cluster name account cannot be created.  This cluster contains a file share witness with invalid permissions for a cluster of type AdministrativeAccesssPoint ActiveDirectoryAndDns. To proceed, delete the file share witness.  After this you can create the cluster name account and recreate the file share witness.  The new file share witness will be automatically created with valid permissions.
```

