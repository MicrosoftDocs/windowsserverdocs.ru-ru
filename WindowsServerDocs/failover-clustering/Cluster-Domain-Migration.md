---
title: Кросс-домена миграции кластера в Windows Server 2016 или 2019 г.
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: failover-clustering
ms.topic: article
author: johnmarlin-msft
ms.date: 01/18/2019
description: В этой статье описывается перенос кластера Windows Server 2019 из одного домена в другой
ms.localizationpriority: medium
ms.openlocfilehash: bcfd458c94d33820f434cde3313dc069fc42ffd9
ms.sourcegitcommit: 21677706eb85cb1396c1f40bf443146c09ef1b0d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/31/2019
ms.locfileid: "9042038"
---
# Миграция доменов отказоустойчивого кластера

> Область применения: Windows Server 2019, Windows Server 2016

В этом разделе содержатся общие сведения о перемещении отказа Windows Server кластеры из одного домена в другой.

## Для чего нужен переход между доменами

Существует несколько сценариев, где необходим миграции кластер из одного doamin в другой.

- CompanyA объединяет с CompanyB и необходимо переместить все кластеры в домен CompanyA
- Создаются основного центра обработки данных и удаленных расположениях, отправленного кластеров
- Был создан как кластер рабочей группы и теперь должен быть частью домена
- Был создан как кластер домена и теперь должен быть частью рабочей группы
- Перемещается к одной области компании на другой и является другой поддомена

Корпорация Майкрософт не предоставляет поддержку для администраторов, попробуйте переместить ресурсы из одного домена в другой, если базовое приложение операция не поддерживается. Например Корпорация Майкрософт не предоставляет поддержку для администраторов, попробуйте переместить Microsoft Exchange server из одного домена в другой.

   > [!WARNING]
   > Рекомендуется выполнить резервное копирование всех общего хранилища в кластере, перед перемещением кластера.

## Windows Server 2016 и более ранних версий

В Windows Server 2016 и более ранних версий служба кластера нет возможности перемещения из одного домена в другой.  Это было из-за повышенной зависимость от доменных служб Active Directory и создания виртуального имена.   

## Параметры

Чтобы сделать это решение, существует два варианта.

Первый вариант предусматривает уничтожение кластера и перестроить его в новом домене.

![А затем снова выполните сборку](media\Cross-Domain-Cluster-Migration\Cross-Cluster-Domain-Migration-1.gif)

Как показано в анимации, этот вариант лучше деструктивных действий:

1. Ликвидировать кластера.
2. Измените членство в домене узлов в этом домене.
3. Заново создайте кластер как новый в домене, обновленные.  Это вызовет повторного создания всех ресурсов.

Второй вариант менее появится, но требуют дополнительного оборудования как новый кластер должен быть встроены в новый домен.  После добавления кластера в новый домен, запустите мастер миграции кластера для переноса ресурсов. Обратите внимание, что это не переноса данных — вам потребуется использовать другое средство для переноса данных, например [Хранилища миграции служб](../storage/storage-migration-service/overview.md)(после добавления поддержки кластера).

![Создание и перенос](media\Cross-Domain-Cluster-Migration\Cross-Cluster-Domain-Migration-2.gif)

Как показано в анимации, этот параметр не появится, но требуют различного оборудования или узел в существующий кластер, не была удалена.

1. Создайте новый clusterin новый домен сохраняя старый кластер доступны.
2. Перенос всех ресурсов в новый кластер с помощью [Мастера миграции кластера](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc754481(v=ws.10)) . Напоминание, это не копировать данные, поэтому необходимо будет осуществляться отдельно.
3. Списать или уничтожить старого кластера.

В обоих вариантов новый кластер потребуется установлены все [кластерное приложений](https://technet.microsoft.com/aa369082(v=vs.90)) , драйверов все, и возможно тестирование, чтобы убедиться, все будет работать надлежащим образом.  Это много времени, если также нужно переместить данные.

## WindowsServer2019

В Windows Server 2019 г. Мы представили возможности миграции домена подключение между кластера.  Итак перечисленных выше сценариях можно легко выполнить и требуется перестраивать больше не используется.  

Перенос кластера из одного домена является сложной задачей. Для этого существует два новых командлета PowerShell.

**New-ClusterNameAccount** — создает учетную запись имя кластера в Active Directory **Remove-ClusterNameAccount** — удаляет учетные записи имя кластера из Active Directory

Процесс для выполнения этой задачи можно кластера из одного домена к рабочей группе и обратно в новый домен.  Необходимость их уничтожения кластера, перестроить кластера, установки приложений и т. д не является обязательным. Например оно будет выглядеть следующим образом:

![Перенос](media\Cross-Domain-Cluster-Migration\Cross-Cluster-Domain-Migration-3.gif)

## Перенос кластера в новый домен

На следующих этапах кластера перемещается из домена Contoso.com новый домен Fabrikam.com.  Имя кластера содержит не *CLUSCLUS* и с именем *FS CLUSCLUS*роль файлового сервера.

1. Создайте учетную запись локального администратора с тем же именем и пароль на всех серверах в кластере.  Это может потребоваться выполнить вход при перемещении между доменами серверы.
2. Войдите в первый сервер с помощью пользователь или администратор учетную запись домена с разрешениями Active Directory для кластера имя объекта (CNO), виртуальный компьютер объектов (VCO), имеет доступ к кластеру и откройте PowerShell.
3. Для обеспечения все ресурсы сетевого имени кластера в автономный состояний и выполнения ниже команду.  Эта команда удалит Active Directory объекты, которые могут иметь кластера.

   ```PowerShell
   Remove-ClusterNameAccount -Cluster CLUSCLUS -DeleteComputerObjects
   ```
4. Используйте Active Directory — пользователи и компьютеры в CNO и VCO компьютере, который объектов, связанных с все кластерные имена будут удалены.

   > [!NOTE]
   > Это бывает нужно остановить службу кластера на всех серверах в кластере и ручная установка типа запуска службы таким образом, чтобы служба кластеров не запускается после перезапуску серверов при изменении доменов.

   ```PowerShell
   Stop-Service -Name ClusSvc

   Set-Service -Name ClusSvc -StartupType Manual
   ```

5. Изменения членства в домене серверов к рабочей группе, перезапустите серверы, присоединиться к серверам в новый домен и повторить попытку.
6. После находились на новый домен, вход на сервер с пользователь или администратор учетной записи домена, имеет разрешения Active Directory для создания объектов, имеет доступ к кластеру и откройте PowerShell. Запустите службу кластеров и его снова установить автоматический.

   ```PowerShell
   Start-Service -Name ClusSvc

   Set-Service -Name ClusSvc -StartupType Automatic
   ```
7. Переведите имя кластера и другому кластеру ресурсы имя сети в Интернет-состояние.

   ```PowerShell
   Start-ClusterResource -Name "Cluster Name"

   Start-ClusterResource -Name FS-CLUSCLUS
   ```

8. Измените могли входить в новый домен с объектами связанные active directory. Чтобы сделать это, команда будет ниже и ресурсы имя сети должны находиться в состоянии online.  Эта команда будет выполнять будет создавать объекты имя в Active Directory.

   ```PowerShell
   New-ClusterNameAccount -Name CLUSTERNAME -Domain NEWDOMAINNAME.com -UpgradeVCOs
   ```

    Примечание: Если у вас нет любые дополнительные группы с именами сети (т. е. кластер Hyper-V с помощью только виртуальные машины), параметр параметр - UpgradeVCOs не требуется.

9. Используйте Active Directory — пользователи и компьютеры для проверки нового домена и убедиться, что созданные объекты связанного компьютера. При наличии, затем перевести оставшиеся ресурсы в группы по сети.

   ```PowerShell
   Start-ClusterGroup -Name "Cluster Group"

   Start-ClusterGroup -Name FS-CLUSCLUS
   ```

## Известные проблемы

При использовании новая функция ресурс-свидетель USB, вы не сможете добавить новый домен кластера.  Почему —, что тип файла общего ресурса ресурс-свидетель должны использовать для проверки подлинности Kerberos.  Измените ресурс-свидетель нет перед добавлением кластера к домену.  После завершения его работы, повторно создайте ресурс-свидетель USB.  Ошибка, которое вы увидите — это:

```
New-ClusternameAccount : Cluster name account cannot be created.  This cluster contains a file share witness with invalid permissions for a cluster of type AdministrativeAccesssPoint ActiveDirectoryAndDns. To proceed, delete the file share witness.  After this you can create the cluster name account and recreate the file share witness.  The new file share witness will be automatically created with valid permissions.
```

