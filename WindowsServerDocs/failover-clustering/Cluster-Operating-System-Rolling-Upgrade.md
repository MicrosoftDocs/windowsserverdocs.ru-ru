---
title: Последовательное обновление ОС кластера
ms.prod: windows-server-threshold
ms.technology: storage-failover-clustering
ms.topic: get-started-article
ms.assetid: 6e102c1f-df26-4eaa-bc7a-d0d55d3b82d5
author: jasongerend
ms.author: jgerend
ms.date: 03/27/2018
ms.openlocfilehash: f56c036768de7c1afcf3327135a7ff7d7a690a8b
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66440144"
---
# <a name="cluster-operating-system-rolling-upgrade"></a>Последовательное обновление ОС кластера

> Относится к: Windows Server 2019, Windows Server 2016

Последовательного обновления кластерной ОС позволяет администратору обновлять ОС узлов кластера, не останавливая рабочие нагрузки Scale-Out File Server или Hyper-V. Благодаря этой функции можно избежать штрафов за простои, которые полагаются согласно соглашениям об уровне обслуживания.

Последовательного обновления кластерной ОС обеспечивает следующие преимущества:

- Отказоустойчивые кластеры под управлением виртуальной машины Hyper-V и масштабируемого файлового сервера (SOFS) рабочих нагрузок можно обновить с Windows Server 2012 R2 (на всех узлах в кластере под управлением) до Windows Server 2016 (выполняются на всех узлах кластера кластера) без простоев. Другие рабочие нагрузки кластера, например SQL Server, будет недоступна во время (обычно менее чем за пять минут), необходимое для отработки отказа в Windows Server 2016.  
- Он не требует дополнительного оборудования. Хотя вы можете добавить дополнительные узлы кластера временно для небольших кластеров для повышения уровня доступности кластера во время последовательного обновления кластерной ОС обработать.  
- Кластер не нужно остановить или перезапустить.  
- Новый кластер не является обязательным. Существующий кластер обновляется. Кроме того используются существующие объекты кластера, хранящихся в Active Directory.  
- Процесс обновления будет необратимой, пока балл клиента «точка объекта невозвратный», при всех узлов кластера работают под управлением Windows Server 2016, а в том случае, когда выполняется командлет PowerShell Update-ClusterFunctionalLevel.  
- Кластер может поддерживать обновление и обслуживание операций при работе в режиме смешанного операционной системы.  
- Он поддерживает автоматизации с помощью PowerShell, WMI.  
- Открытое свойство кластера **ClusterFunctionalLevel** свойство указывает состояние кластера на узлах кластера Windows Server 2016. Это свойство можно запросить с помощью командлета PowerShell с узла кластера Windows Server 2016, который входит в кластер отработки отказа:  
    ```PowerShell
    Get-Cluster | Select ClusterFunctionalLevel  
    ```  

    Значение **8** указывает, что кластер работает в режиме Windows Server 2012 R2. Значение **9** указывает, что кластер работает в режиме Windows Server 2016.  

Это руководство описывает различные этапы процесса последовательного обновления кластерной ОС, действия по установке, ограничения и часто задаваемые вопросы (FAQ) и применяется к следующим сценариям последовательного обновления кластерной ОС в Windows Server 2016:  
- Кластеры Hyper-V  
- Кластеров масштабируемых файловых серверов  

Следующий сценарий не поддерживается в Windows Server 2016:  
-  Последовательное обновление ОС гостевых кластеров с помощью виртуального жесткого диска (vhdx-файл) в качестве общего хранилища кластера  

Последовательного обновления кластерной ОС полностью поддерживается по System Center Virtual Machine Manager (SCVMM) 2016. Если вы используете SCVMM 2016, см. в разделе [выполнение последовательного обновления кластера узлов Hyper-V до Windows Server 2016 в VMM](https://docs.microsoft.com/system-center/vmm/hyper-v-rolling-upgrade?view=sc-vmm-1807) рекомендации по обновлению кластеров и автоматизации шагов, описанных в этом документе.  

## <a name="requirements"></a>Требования  
Перед началом процесса последовательного обновления кластерной ОС, выполните следующие требования:

- Начните с отказоустойчивый кластер под управлением Windows Server (полугодовой канал), Windows Server 2016 или Windows Server 2012 R2.
- Кластер Storage Spaces Direct обновляется до версии Windows Server, версия 1709 не поддерживается.
- Если рабочая нагрузка кластера виртуальных машин Hyper-V или масштабируемого файлового сервера, можно ожидать обновления без простоя.
- Убедитесь, что узлы Hyper-V процессоров, поддерживающих второго уровня адресации таблицы (SLAT) с помощью одного из следующих методов.  
        -Обзор [совместимы вы SLAT? 01 совет WP8 SDK](http://blogs.msdn.com/b/devfish/archive/2012/11/06/are-you-slat-compatible-wp8-sdk-tip-01.aspx) статья, в которой описаны два метода, чтобы проверить, поддерживает ли Процессор SLATs  
        -Скачайте [Coreinfo v3.31](https://technet.microsoft.com/sysinternals/cc835722) средство, чтобы определить, если ЦП поддерживает SLAT.

## <a name="cluster-transition-states-during-cluster-os-rolling-upgrade"></a>Переходные состояния кластера во время последовательного обновления кластерной ОС

В этом разделе описываются различные состояния перехода кластера Windows Server 2012 R2, которая обновляется до Windows Server 2016 с помощью последовательного обновления кластерной ОС.  

Для сохранения рабочих нагрузок кластера, во время последовательного обновления кластерной ОС, перенос рабочей нагрузки кластера из узла Windows Server 2012 R2 до Windows Server 2016 узел работает, как если бы оба узла работает операционная система Windows Server 2012 R2. При добавлении узлов Windows Server 2016 в кластер, они работают в режиме совместимости с Windows Server 2012 R2. Новый режим концептуальной кластера, называется «Режим смешанного ОС», позволяет узлам разных версий должно существовать в том же кластере (см. рис. 1).  

![Иллюстрация, показывающая три этапа, последовательное обновление ОС кластера: все узлы Windows Server 2012 R2, режим смешанного ОС и все узлы Windows Server 2016](media/Cluster-Operating-System-Rolling-Upgrade/Clustering_RollingUpgrade_Overview.png)  
**Рис. 1. Переходы состояния операционной системы кластера**  

Кластер Windows Server 2012 R2 входит в режим смешанного ОС при добавлении кластера узлов Windows Server 2016. Процесс полностью обратить - узлы Windows Server 2016 можно удалить из кластера, и узлы Windows Server 2012 R2 можно добавить в кластер, в этом режиме. «Точки необратимости» возникает при запуске командлета Update-ClusterFunctionalLevel PowerShell в кластере. Чтобы этот командлет для успешного выполнения все узлы должны быть Windows Server 2016 и все узлы, необходимо подключиться к Интернету.  

## <a name="transition-states-of-a-four-node-cluster-while-performing-rolling-os-upgrade"></a>Состояния перехода для четырех узлов кластера при выполнении последовательного обновления ОС

В этом разделе показано и описываются четыре разных этапов кластер с общим хранилищем, узлы которых обновляются с Windows Server 2012 R2 до Windows Server 2016.  

«Этап 1» является исходным состоянием — мы начнем с кластером Windows Server 2012 R2.  

![Иллюстрация, показывающая начальное состояние: все узлы Windows Server 2012 R2](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_Stage1.png)  
**Рис. 2. Начальное состояние: Отказоустойчивого кластера Windows Server 2012 R2 (этап 1)**  

В «этап 2», два узла был приостановлен, останавливаются, удаления, переформатированы и устанавливается вместе с Windows Server 2016.  

![Иллюстрация, показывающая кластера в режиме смешанного ОС: из примера 4 узлов кластера, два узлы работают под управлением Windows Server 2016 и два узлы работают под управлением Windows Server 2012 R2](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_Stage2.png)  
**Рис. 3. Промежуточное состояние: Режим смешанного ОС: Windows Server 2012 R2 и Windows Server 2016 отказоустойчивого кластера (этап 2)**  

В «этап 3.», все узлы в кластере будут обновлены до Windows Server 2016 и кластер будет готов к обновлению с помощью командлета PowerShell Update-ClusterFunctionalLevel.  

> [!NOTE]  
> На этом этапе процесс полностью могли быть отменены, и в этот кластер можно добавлять узлы Windows Server 2012 R2.  

![Рисунок, показывающий, что кластера будет полностью обновлен до версии Windows Server 2016 и готов для командлета Update-ClusterFunctionalLevel перевести функциональный уровень кластера до Windows Server 2016](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_Stage3.png)  
**Рис. 4. Промежуточное состояние: Все узлы, обновления до Windows Server 2016, все готово для Update-ClusterFunctionalLevel (этап 3)**  

После выполнения обновления-ClusterFunctionalLevelcmdlet кластер переходит «Этап 4», где можно использовать новые функции кластера Windows Server 2016.  

![Рисунок, показывающий, что последовательное обновление ОС кластера успешно завершена; все узлы будут обновлены до Windows Server 2016, а кластер работает на функциональном уровне кластера Windows Server 2016](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_Stage4.png)  
**Рис. 5. Конечное состояние: Отказоустойчивый кластер Windows Server 2016 (этап 4)**  

## <a name="cluster-os-rolling-upgrade-process"></a>Процесс последовательного обновления кластерной ОС

В этом разделе описывается рабочий процесс для выполнения последовательного обновления кластерной ОС.  

![Иллюстрация, показывающая рабочий процесс для обновления кластера](media/Cluster-Operating-System-Rolling-Upgrade/Clustering_RollingUpgrade_Workflow.png)  
**Рис. 6. Последовательное рабочий процесс обновления ОС кластера**  

ОС последовательное обновление кластера включает следующие шаги:  

1. Подготовьте кластер для обновления операционной системы, следующим образом.  
    1. Последовательного обновления кластерной ОС требуется, удалить один узел за раз из кластера. Проверьте, если вы имеете достаточную емкость в кластере для обеспечения высокого уровня ДОСТУПНОСТИ соглашения об уровне обслуживания, когда один из узлов кластера удаляется из кластера для обновления операционной системы. Другими словами требуется возможность отработки отказа рабочих нагрузок на другой узел при удалении одного узла из кластера во время последовательного обновления кластерной ОС? Есть ли у кластера емкости для запуска рабочих нагрузок, когда один узел удаляется из кластера для последовательного обновления кластерной ОС?  
    2. Для рабочих нагрузок Hyper-V убедитесь, что все узлы Windows Server 2016 Hyper-V ЦП поддерживает таблицу адресов второго уровня (SLAT). Только с возможностями SLAT компьютеры могут использовать роль Hyper-V в Windows Server 2016.  
    3. Убедитесь, что все резервные копии рабочей нагрузки завершена и рассмотрим резервное копирование кластера. При добавлении узлов в кластер Stop операций резервного копирования.  
    4. Проверьте, что все узлы кластера подключены к сети/выполнение/вверх с помощью [ `Get-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Get-ClusterNode?view=win10-ps) командлет (см. рис. 7).  

        ![Снимке экрана, показывающий результаты выполнения командлета Get-ClusterNode](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_GetClusterNode.png)  
        **Рис. 7. Определение состояния узла, с помощью командлета Get-ClusterNode**  

    5. При выполнении кластерного обновления кластера (CAU), проверьте, если кластерное обновление выполняется в данный момент с помощью **обновление кластера-Aware** пользовательского интерфейса, или [ `Get-CauRun` ](https://docs.microsoft.com/powershell/module/clusterawareupdating/Get-CauRun?view=win10-ps) командлет (см. рис. 8). Прекратить использование CAU [ `Disable-CauClusterRole` ](https://docs.microsoft.com/powershell/module/clusterawareupdating/Disable-CauClusterRole?view=win10-ps) командлет (см. рис. 9) для предотвращения все узлы, приостановки и постепенно завершается, кластерное обновление во время последовательного обновления кластерной ОС.  

        ![Отображает выходные данные командлета Get-CauRun снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_GetCAU.png)  
        **Рис. 8. С помощью [ `Get-CauRun` ](https://docs.microsoft.com/powershell/module/clusterawareupdating/Get-CauRun?view=win10-ps) командлет, чтобы определить, запущена ли кластерных обновлений в кластере**  

        ![Отображает выходные данные командлета Disable-CauClusterRole снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_DisableCAU.png)  
        **Рис. 9. Отключение роли кластерных обновлений с помощью [ `Disable-CauClusterRole` ](https://docs.microsoft.com/powershell/module/clusterawareupdating/Disable-CauClusterRole?view=win10-ps) командлета**  

2. Для каждого узла в кластере выполните следующие действия:  
    1. С помощью пользовательского интерфейса диспетчера кластера, выберите имя узла и использовать **Пауза | Очистите** пункт меню, чтобы выполнить сток узла (см. рис. 10) или использовать [ `Suspend-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Suspend-ClusterNode?view=win10-ps) командлет (см. рис. 11).  

        ![Снимке экрана, показывающий, как очистите роли с помощью пользовательского интерфейса диспетчера кластеров](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_FCM_DrainRoles.png)  
        **Рис. 10. Сток роли из узла с помощью диспетчера отказоустойчивости кластеров**  

        ![Отображает выходные данные командлета Suspend-ClusterNode снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_SuspendNode.png)  
        **Рис. 11. Сток роли из узла с помощью [ `Suspend-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Suspend-ClusterNode?view=win10-ps) командлета**  

    2.  С помощью интерфейса диспетчера кластеров **исключить** приостановленного узла из кластера, или используйте [ `Remove-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Remove-ClusterNode?view=win10-ps) командлета.  

        ![Отображает выходные данные командлета Remove-ClusterNode снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_RemoveNode.png)  
        **Рис. 12. Удаление узла из кластера с помощью [ `Remove-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Remove-ClusterNode?view=win10-ps) командлета**  

    3.  Переформатировать системного диска и выполнять «чистой установки операционной системы» Windows Server 2016 на узел с помощью **Custom: Только установка Windows (Дополнительно)** вариант установки (см. рис. 13) в setup.exe. Не выбирайте **обновления: Установка Windows и сохранить файлы, параметры и приложения** параметр, так как последовательного обновления кластерной ОС не поддерживается обновление на месте.  

        ![Снимок экрана мастера установки Windows Server 2016, показывающий выбран параметр выборочной установки](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_InstallOption.png)  
        **Рис. 13. Доступных параметров установки для Windows Server 2016**  

    4.  Добавление узла к соответствующему домену Active Directory.  
    5.  Добавьте пользователей в группу администраторов.  
    6.  С помощью пользовательского интерфейса диспетчера сервера или Install-WindowsFeature командлет PowerShell, установите любой роли сервера, которые необходимы, таких как Hyper-V.  

        ```PowerShell
        Install-WindowsFeature -Name Hyper-V  
        ```  

    7.  С помощью пользовательского интерфейса диспетчера сервера или PowerShell Install-WindowsFeature командлета, установите компонент отказоустойчивой кластеризации.  

        ```PowerShell
        Install-WindowsFeature -Name Failover-Clustering  
        ```  

    8.  Установите дополнительные компоненты, необходимые для рабочих нагрузок кластера.  
    9. Проверьте параметры подключения к сети и хранилища с помощью пользовательского интерфейса диспетчера отказоустойчивости кластеров.  
    10. Если используется брандмауэр Windows, проверьте правильность настройки брандмауэра для кластера. Например кластер кластерного обновления (CAU) включено кластерами может потребоваться настройка брандмауэра.  
    11. Для рабочих нагрузок Hyper-V, использовать пользовательский Интерфейс диспетчера Hyper-V, чтобы открыть диалоговое окно Диспетчер виртуальных коммутаторов (см. рис. 14).  

        Проверьте, что имя виртуального Switch(s) используется идентичны для всех узлов Hyper-V в кластере.  

        ![Снимке экрана, показывающий расположение диалогового окна Диспетчер виртуальных коммутаторов Hyper-V](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_VMSwitch.png)  
        **Рис. 14. Диспетчер виртуальных коммутаторов**  

    12. На узле Windows Server 2016 (не использовать узел Windows Server 2012 R2), используйте диспетчер отказоустойчивого кластера (см. рис. 15) для подключения к кластеру.  

        ![Отображение диалогового окна выберите кластер снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_AddNode.png)  
        **Рис. 15. Добавление узла к кластеру с помощью диспетчера отказоустойчивости кластеров**  

    13. Использовать пользовательский Интерфейс диспетчера отказоустойчивости кластеров или [ `Add-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Add-ClusterNode?view=win10-ps) командлет (см. рис. 16) для добавления узла в кластер.  

        ![Отображает выходные данные командлета Add-ClusterNode снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_AddNode3.png)  
        **Рис. 16. Добавление узла к кластеру с помощью [ `Add-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Add-ClusterNode?view=win10-ps) командлета**  

        > [!NOTE]  
        > При первом узле Windows Server 2016 присоединится к кластеру, кластер переходит в режим «Mixed-ОС», и основные ресурсы кластера, перемещаются на узел Windows Server 2016. Кластер в режиме «Mixed-ОС» — это полнофункциональная кластер, где новые узлы будут выполняться в режиме совместимости с узлами старой. Режим «Смешанный ОС» — это преходящая режим для кластера. Он не является постоянным, и клиенты должны обновить все узлы кластера, их в течение четырех недель.  

    14. После Windows Server 2016 успешно добавляется узел к кластеру, можно (необязательно) переместить некоторые из рабочей нагрузкой кластера вновь добавленный узел для балансирования рабочей нагрузки в кластере следующим образом:

        ![Отображает выходные данные командлета Move-ClusterVirtualMachineRole снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_MoveVMRole.png)  
        **Рис. 17. Перемещение рабочей нагрузки (роли кластера виртуальной Машины) кластера с помощью [ `Move-ClusterVirtualMachineRole` ](https://docs.microsoft.com/powershell/module/failoverclusters/Move-ClusterVirtualMachineRole?view=win10-ps) командлета**  

        1. Используйте **динамической миграции** из диспетчера отказоустойчивости кластеров для виртуальных машин или [ `Move-ClusterVirtualMachineRole` ](https://docs.microsoft.com/powershell/module/failoverclusters/Move-ClusterVirtualMachineRole?view=win10-ps) командлет (см. рис. 17) для выполнения динамической миграции виртуальных машин.  

            ```PowerShell
            Move-ClusterVirtualMachineRole -Name VM1 -Node robhind-host3  
            ```  

        2. Используйте **переместить** из диспетчера отказоустойчивости кластеров или [ `Move-ClusterGroup` ](https://docs.microsoft.com/powershell/module/failoverclusters/Move-ClusterGroup?view=win10-ps) командлет для других рабочих нагрузок кластера.  

3. Когда каждый узел обновлен до версии Windows Server 2016 и добавлены в кластер, или исключении оставшиеся узлы Windows Server 2012 R2, сделайте следующее:  

    > [!IMPORTANT]  
    > -   После обновления режима работы кластера, вы не сможете вернуться назад, функциональный уровень Windows Server 2012 R2 и узлы Windows Server 2012 R2 нельзя добавить в кластер.
    > -   Пока [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps) выполнения командлета, процесс полностью обратить и узлы Windows Server 2012 R2 можно добавить к этому кластеру, и узлы Windows Server 2016 могут быть удалены.  
    > -   После [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps) выполнения командлета, новые функции будут доступны.  

    1.  С помощью пользовательского интерфейса диспетчера отказоустойчивости кластеров или [ `Get-ClusterGroup` ](https://docs.microsoft.com/powershell/module/failoverclusters/Get-ClusterGroup?view=win10-ps) командлет, убедитесь, что все кластерные роли выполняются в кластере правильно. В следующем примере доступное хранилище не используется, вместо этого используется CSV, следовательно, отображает доступное хранилище **Offline** состояние (см. рис. 18).  

        ![Отображает выходные данные командлета Get-ClusterGroup снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_GetClusterGroup.png)  
        **Рис. 18. Проверка того, что все кластера групп (кластерных ролей) с использованием [ `Get-ClusterGroup` ](https://docs.microsoft.com/powershell/module/failoverclusters/Get-ClusterGroup?view=win10-ps) командлета**  

    2.  Проверьте, что все узлы кластера подключены к сети и запуск с помощью [ `Get-ClusterNode` ](https://docs.microsoft.com/powershell/module/failoverclusters/Get-ClusterNode?view=win10-ps) командлета.  
    3.  Запустите [ `Update-ClusterFunctionalLevel` ](https://technet.microsoft.com/library/mt589702.aspx) командлет - ошибки не должны быть возвращены (см. рис. 19).  

        ![Отображает выходные данные командлета Update-ClusterFunctionalLevel снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_SelectFunctionalLevel.png)  
        **Рис. 19. Обновление режима работы кластера с помощью PowerShell**  

    4.  После [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps) выполнения командлета, доступны новые функции.  

4. Windows Server 2016 — возобновить обычный кластер обновлений и резервных копий:  

    1. Если ранее была запущена кластерное обновление, перезапустите его в пользовательском интерфейсе CAU или использовать [ `Enable-CauClusterRole` ](https://docs.microsoft.com/powershell/module/clusterawareupdating/Enable-CauClusterRole?view=win10-ps) командлет (см. рис. 20).  

        ![Отображает выходные данные Enable-CauClusterRole снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_EnableCAUClusterRole.png)  
        **Рис. 20. Включение роли кластерных обновлений с помощью [ `Enable-CauClusterRole` ](https://docs.microsoft.com/powershell/module/clusterawareupdating/Enable-CauClusterRole?view=win10-ps) командлета**  

    2. Возобновить операции резервного копирования.  

5. Включить и использовать функции Windows Server 2016 на виртуальных машинах Hyper-V.  

    1. После обновления кластера функциональный уровень Windows Server 2016 многих рабочих нагрузок, таких как виртуальные машины Hyper-V будет иметь новые возможности. Список новых возможностей Hyper-V. см. в разделе [миграции и обновления виртуальных машин](https://msdn.microsoft.com/virtualization/hyperv_on_windows/user_guide/migrating_vms)  

    2. На каждом узле узла Hyper-V в кластере, используйте [ `Get-VMHostSupportedVersion` ](https://docs.microsoft.com/powershell/module/hyper-v/Get-VMHostSupportedVersion?view=win10-ps) командлет, чтобы просмотреть версии конфигурации виртуальной Машины Hyper-V, которые поддерживаются приложением.  

        ![Отображает выходные данные командлета Get-VMHostSupportedVersion снимке экрана](media/Cluster-Operating-System-Rolling-Upgrade/Clustering_GetVMHostSupportVersion.png)  
        **Рис. 21. Просмотр версии конфигурации виртуальной Машины Hyper-V, поддерживаемые основным приложением**  

   3. На каждом узле узла Hyper-V в кластере, можно обновить версии конфигурации виртуальной Машины Hyper-V с запланировать период обслуживания, краткое с пользователями, резервное копирование, если выключить виртуальные машины и запустить [ `Update-VMVersion` ](https://docs.microsoft.com/powershell/module/hyper-v/Update-VMVersion?view=win10-ps) командлет (см. Рис. 22). Это обновление версии виртуальной машины и включение новых функций Hyper-V, устраняя необходимость в будущие обновления компонентов интеграции Hyper-V (IC). Этот командлет можно запускать из узла Hyper-V, на котором размещается на виртуальной Машине или `-ComputerName` параметра можно удаленно обновить версию виртуальной Машины. В этом примере здесь мы обновить версию конфигурации VM1 из 5.0 до 7.0, чтобы воспользоваться преимуществами множество новых функций Hyper-V, связанный с этой версии конфигурации виртуальной Машины, такие как рабочие контрольные точки (согласованные приложений резервные копии) и двоичные виртуальной Машины файл конфигурации.  

       ![Снимке экрана, показывающий командлет Update-VMVersion в действии](media/Cluster-Operating-System-Rolling-Upgrade/Cluster_RollingUpgrade_StopVM.png)  
       **Рис. 22. Обновление версии виртуальной Машины с помощью командлета PowerShell Update-VMVersion**  

6. Пулы носителей можно обновить с помощью [Update-StoragePool](https://docs.microsoft.com/powershell/module/storage/Update-StoragePool?view=win10-ps) командлет PowerShell: Эта операция выполняется в сети.  

Несмотря на то, что мы ожидаем от сценарии частного облака, в частности Hyper-V и кластеров масштабируемого файлового сервера, которые могут обновляться без простоев, процесс последовательного обновления кластерной ОС можно использовать для любой роли кластера.  

## <a name="restrictions--limitations"></a>Ограничения и ограничения  
- Эта функция работает только для Windows Server 2012 R2 до версии Windows Server 2016. Эта функция не может обновить более ранние версии Windows Server, например Windows Server 2008, Windows Server 2008 R2 или Windows Server 2012 до Windows Server 2016.  
- Каждый узел Windows Server 2016 следует только переформатированы или новой установки. «На месте» или «обновление» тип установки, не рекомендуется.  
- Узел Windows Server 2016 необходимо использовать для добавления узлов Windows Server 2016 в кластер.  
- При управлении кластер в режиме смешанного операционной системы, всегда выполняйте задачи управления из узла верхнего уровня, на котором работает Windows Server 2016. Узлы нижнего уровня Windows Server 2012 R2 нельзя использовать средства пользовательского интерфейса или управления для Windows Server 2016.  
- Мы рекомендуем клиентам перемещать через процесс обновления кластера, быстро, так как некоторые возможности кластера не оптимизированы для режима смешанный операционной системы.  
- Избегайте создания или изменения размера хранилища на узлах Windows Server 2016, во время кластер работает в режиме смешанного операционной системы из-за несовместимости при отработке отказа с узла Windows Server 2016 на Windows Server 2012 R2 узлы нижнего уровня.  

## <a name="frequently-asked-questions"></a>Вопросы и ответы  
**Как долго может отказоустойчивого кластера выполняться в режиме смешанного ОС?**  
    Мы советуем клиентам, чтобы завершить обновление в течение четырех недель. Существует множество оптимизаций в Windows Server 2016. Успешно обновили Hyper-V и масштабируемого файлового сервера кластеров с нулевым временем простоя в общее меньше четырех часов.  

**Будет ли переносить эта функция Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008?**  
    У нас есть не планируется ли порт эту функцию снова с предыдущими версиями. Последовательного обновления кластерной ОС — это наша концепция, для обновления кластеров Windows Server 2012 R2 до Windows Server 2016 и больше.  

**Необходимо установить все обновления программного обеспечения прежде чем начать процесс последовательного обновления кластерной ОС кластера Windows Server 2012 R2?**  
    Да, прежде чем начать процесс последовательного обновления кластерной ОС, убедитесь, что все узлы кластера обновляются с последними обновлениями программного обеспечения.  

**Можно ли запускать [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps) командлет, хотя узлы отключены или приостановлена?**  
    Нет. Все узлы кластера должно находиться в и в активное членство для [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps) работы командлета.  

**Последовательного обновления кластерной ОС работает для любой рабочей нагрузки кластера? Это работает для SQL Server?**  
    Да, последовательного обновления кластерной ОС работает для любой рабочей нагрузки кластера. Тем не менее это только без простоя для Hyper-V и кластеров масштабируемых файловых серверов. Большинство других рабочих нагрузок взимается некоторое время простоя (обычно за несколько минут), когда они отработки отказа и отработки отказа не требуется по крайней мере один раз во время последовательного обновления кластерной ОС.  

**Можно ли автоматизировать этот процесс, с помощью PowerShell?**  
    Да, мы предусмотрели последовательного обновления кластерной ОС для автоматизации с помощью PowerShell.  

**Для большого кластера с дополнительной рабочей нагрузки и отработки отказа емкостью можно ли обновить несколько узлов одновременно?**  
    Да. Когда один узел удаляется из кластера для обновления ОС, кластер будет иметь меньше одного узла для отработки отказа, таким образом, будет иметь емкость ограниченной отработки отказа. Для больших кластеров с достаточно рабочей нагрузки и отказоустойчивость на несколько узлов могут быть обновлены одновременно. Можно временно добавить узлы кластера к кластеру, чтобы предоставить улучшенный рабочей нагрузки и отработки отказа емкость во время последовательного обновления кластерной ОС.  

**Что делать, если я обнаружения проблемы в кластере после [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps) будет выполнено успешно?**  
    Если вы резервных копий базы данных кластера с помощью резервной копии состояния системы перед запуском [ `Update-ClusterFunctionalLevel` ](https://docs.microsoft.com/powershell/module/failoverclusters/Update-ClusterFunctionalLevel?view=win10-ps), вы должны иметь возможность выполнять доверенный восстановления на узле кластера Windows Server 2012 R2 и восстановление исходного кластера базы данных и конфигурации.  

**Можно ли использовать обновление на месте для каждого узла, вместо использования Установка чистой операционной системы при помощи переформатирования системного диска?**  
    Не рекомендуется использовать обновление на месте Windows Server, но нам известно, что оно работает в некоторых случаях, в которых используются стандартные драйверы. Внимательно прочитайте все предупреждающие сообщения отображаются во время обновления на месте узла кластера.  

**Если я использую репликации Hyper-V для виртуальной Машины Hyper-V на мой кластер Hyper-V, репликация останется без изменений во время и после процесса последовательного обновления кластерной ОС?**  
    Да, реплики Hyper-V не изменяется во время и после процесса последовательного обновления кластерной ОС.  

**Можно ли использовать System Center 2016 Virtual Machine Manager (SCVMM) для автоматизации процесса последовательного обновления кластерной ОС?**  
    Да, можно автоматизировать процесс последовательного обновления кластерной ОС, с помощью VMM в System Center 2016.  

## <a name="see-also"></a>См. также  
-   [Заметки о выпуске. Важные проблемы в Windows Server 2016](../get-started/Release-Notes--Important-Issues-in-Windows-Server-2016-Technical-Preview.md)  
-   [Что нового в Windows Server 2016?](../get-started/What-s-New-in-windows-server-2016.md)  
-   [Новые возможности отказоустойчивой кластеризации в Windows Server](whats-new-in-failover-clustering.md)  
