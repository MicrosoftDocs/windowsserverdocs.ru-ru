---
ms.assetid: 56fc7f80-9558-467e-a6e9-a04c9abbee33
title: "Информация о домене сбоя"
ms.prod: windows-server-threshold
ms.author: cosdar
ms.manager: eldenc
ms.technology: storage-failover-clustering
ms.topic: article
author: cosmosdarwin
ms.date: 09/16/2016
ms.openlocfilehash: f5c64bb8f8b7d4b8d13c76c4e94cfcf52ee32c30
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="fault-domain-awareness-in-windows-server-2016"></a>Информация о домене сбоя в Windows Server 2016

> Применяется к: Windows Server 2016

Отказоустойчивая кластеризация позволяет нескольким серверам работать вместе для обеспечения высокой доступности или, другими словами, отказоустойчивости узла. Современные предприятия выдвигают все больше требований доступности своей инфраструктуры. Для достижения бесперебойной облаке, даже от таких маловероятных событий, как поломки корпуса, простои стойки или стихийные бедствия необходимо настроить защиту. Именно поэтому отказоустойчивой кластеризации в Windows Server 2016 обеспечивает корпуса, стойки или сайта отказоустойчивость также.

Домены сбоя и отказоустойчивость, тесно связанных понятиях. Домен сбоя — это набор аппаратных компонентов, которые совместно используют одну точку сбоя. Чтобы достичь отказоустойчивости конкретного уровня, требуется несколько доменов сбоя на этом уровне. Например чтобы обеспечить отказоустойчивость стоек, серверы и данные необходимо распределить среди нескольких стоек.

Этот короткий видеоролик представляет обзор доменов сбоя в Windows Server 2016.  
[![Щелкните этот образ, чтобы смотреть Обзор доменов сбоя в Windows Server 2016](media/Fault-Domains-in-Windows-Server-2016/Part-1-Fault-Domains-Overview.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-1-Overview)

## <a name="benefits"></a>Преимущества
- **Дисковые пространства, включая локальные дисковые пространства, используют домены сбоя для повышения уровня безопасности данных.**  
    Устойчивость в дисковых пространствах в принципе аналогична распределенной программного обеспечения определяемой системе RAID. Несколько копий всех данных синхронизируются. в случае сбоя оборудования и потери одной копии, другие копируются повторно для восстановления устойчивости. Для достижения максимальной устойчивости, копии следует хранить в отдельных доменах сбоя.

- **[Службы работоспособности](health-service-overview.md) использует отказоустойчивость доменов, чтобы предоставлять более информативные оповещения.**  
    Каждый домен сбоя можно связать с метаданными расположения, которые будут автоматически включаться в любые последующие оповещения. Эти дескрипторы может упростить или обслуживающий персонал и уменьшить количество ошибок при устранении неоднозначности оборудования.  

- **В растянутой кластеризации домены сбоя используются для сопоставления хранилища.** Растянутой кластеризации позволяет можно присоединить к общему кластеру отдаленные серверы. Для обеспечения максимальной производительности приложения или виртуальные машины следует запускать на серверах, которые расположены недалеко, в которых хранятся. Информация о домене сбоя позволяет это сопоставление хранилища.   

## <a name="levels-of-fault-domains"></a>Уровни доменов сбоя  
Существует четыре классических уровня доменов сбоя: сайта, стойка, корпус и узел. Узлы обнаруживаются автоматически. Каждый дополнительный уровень не является обязательным. Например если в развертывании не используются стоечные серверы, учитывать уровень корпуса не имеет смысла для вас.  

![Схема разные уровни доменов сбоя](media/Fault-Domains-in-Windows-Server-2016/levels-of-fault-domains.png)

## <a name="usage"></a>Использование  
Можно использовать PowerShell или XML-разметки для определения доменов сбоев. Оба подхода эквивалентны и полнофункциональны.

>[!IMPORTANT]
> Перед включением локальных дисковых пространств по возможности укажите домены сбоя. Это позволяет автоматической конфигурации подготовить пул, уровни и такие параметры, как устойчивость и число столбцов для обеспечения отказоустойчивости корпуса или стойки. После создания пула и томов данные не будут перемещены обратно в ответ на изменения топологии домена сбоя. Чтобы переместить узлы между корпусами или стойками после включения локальных дисковых пространств, сначала следует исключить узел и его диски из пула с помощью `Remove-ClusterNode -CleanUpDisks`.

### <a name="defining-fault-domains-with-powershell"></a>Определение доменов сбоя с помощью PowerShell
Windows Server 2016 предоставляет следующие командлеты для работы с доменов сбоя:
* `Get-ClusterFaultDomain`
* `Set-ClusterFaultDomain`
* `New-ClusterFaultDomain` 
* `Remove-ClusterFaultDomain`

Этот короткий видеоролик демонстрирует использование указанных командлетов.
[![Щелкните это изображение для Посмотрите короткое видео, на использование командлетов домен сбоя кластера](media/Fault-Domains-in-Windows-Server-2016/Part-2-Using-PowerShell.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-2-Using-PowerShell)

Используйте `Get-ClusterFaultDomain`для просмотра текущей топологии домена сбоя. Появится список всех узлах кластера, плюс любой корпусов, стоек или сайтов, созданных вами. Можно отфильтровать с помощью таких параметров, как **-типа** или **-имя**, но они не являются обязательными.

```PowerShell
Get-ClusterFaultDomain
Get-ClusterFaultDomain -Type Rack
Get-ClusterFaultDomain -Name "server01.contoso.com"
```

Используйте `New-ClusterFaultDomain`для создания нового корпусов, стоек или сайтов. `-Type`И `-Name`параметров не требуется. Возможные значения `-Type`, `Chassis`, `Rack`, и `Site`. `-Name`Может быть любая строка. (Для `Node`доменов сбоя типа, имя должно быть фактическим именем узла, как набор автоматическими).

```PowerShell
New-ClusterFaultDomain -Type Chassis -Name "Chassis 007"
New-ClusterFaultDomain -Type Rack -Name "Rack A"
New-ClusterFaultDomain -Type Site -Name "Shanghai"
```

> [!IMPORTANT]  
> Windows Server не может и не проверяет, что любой созданный вами домен сбоя соответствует реальному физическому объекту. (Это может показаться очевидным, но важно понимать). Если в реальном мире, на все узлы размещены в одной стойке, создав два `-Type Rack`доменах сбоя в программного обеспечения не обеспечите волшебным образом отказоустойчивость стойки. Вы несете ответственность за обеспечение соответствия топологии, созданной с помощью этих командлетов фактическому расположению оборудования.

Используйте `Set-ClusterFaultDomain`для перемещения одного домена сбоя в другой. Обычно для описания этого отношения вложенности используются термины «родительской» и «дочерний». `-Name`И `-Parent`параметров не требуется. В `-Name`, укажите имя домена сбоя, который перемещает; в `-Parent`, укажите имя целевого. Чтобы переместить сразу несколько доменов сбоя, перечислите их имена.

```PowerShell
Set-ClusterFaultDomain -Name "server01.contoso.com" -Parent "Rack A"
Set-ClusterFaultDomain -Name "Rack A", "Rack B", "Rack C", "Rack D" -Parent "Shanghai"
```

> [!IMPORTANT]  
> При перемещении доменов сбоев их дочерние элементы перемещаются вместе с ними. В приведенном выше примере стойка A является родительским для server01.contoso.com, последний не нужно отдельно перемещать на сайт Shanghai – это уже уже там находится его родительский элемент, так же, как в реальном мире.

Вы увидите родительско дочерних отношениях в выходных данных `Get-ClusterFaultDomain`в `ParentName`и `ChildrenNames`столбцов.

Можно также использовать `Set-ClusterFaultDomain`для изменения других определенных свойств доменов сбоя. Например, вы можете указать необязательные `-Location`или `-Description`метаданные для любого домена сбоя. Если указан, эти сведения будут включены в оповещения службы работоспособности оборудования. Вы также можете переименовать домен сбоя с помощью `-NewName`параметра. Не переименовывайте `Node`домены сбоев типа.

```PowerShell
Set-ClusterFaultDomain -Name "Rack A" -Location "Building 34, Room 4010"
Set-ClusterFaultDomain -Type Node -Description "Contoso XYZ Server"
Set-ClusterFaultDomain -Name "Shanghai" -NewName "China Region"
```

Используйте `Remove-ClusterFaultDomain`удаление корпусов, стоек или сайтов, которые вы создали. `-Name`Параметр является обязательным. Нельзя удалять домен сбоя, который содержит дочерние элементы – сначала либо удалите дочерние элементы или переместите их за пределы с помощью `Set-ClusterFaultDomain`. Чтобы переместить домен сбоя за пределы всех других доменов сбоя, задайте его `-Parent`в пустую строку (»»). Не удается удалить `Node`домены сбоев типа. Чтобы удалить сразу несколько доменов сбоя, перечислите их имена.

```PowerShell
Set-ClusterFaultDomain -Name "server01.contoso.com" -Parent ""
Remove-ClusterFaultDomain -Name "Rack A"
```

### <a name="defining-fault-domains-with-xml-markup"></a>Определение доменов сбоя с помощью XML-разметки
Домены сбоя можно указать при помощи синтаксиса на основе XML. Мы рекомендуем с помощью любого текстового редактора, например Visual Studio Code (доступны бесплатно *[здесь](https://code.visualstudio.com/)*) или "Блокнот", чтобы создать XML-документ, который можно сохранить и использовать повторно.  

Этот короткий видеоролик демонстрирует использование XML-разметки для определения доменов сбоев.

[![Cелкните этот образ к Посмотрите короткое видео о том, как использовать XML-ФАЙЛ для определения доменов сбоев](media/Fault-Domains-in-Windows-Server-2016/Part-3-Using-XML-Markup.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-3-Using-XML)

В PowerShell, запустите следующий командлет:`Get-ClusterFaultDomainXML`. Эта команда возвращает текущая спецификация домена сбоя, для кластера, в формате XML. Это отражает Каждый обнаруженный `<Node>`заключен в открывающие и закрывающие `<Topology>`теги.  

Выполните следующую команду, чтобы сохранить эти выходные данные в файл.  

```PowerShell
Get-ClusterFaultDomainXML | Out-File <Path>  
```

Откройте файл и добавить `<Site>`, `<Rack>`, и `<Chassis>`тегами, чтобы указать способ распределения этих узлов между сайтами, стойками и корпусами. Каждый тег должен быть идентифицирован уникальным **имя **. Для узлов необходимо сохранить имена заданные по умолчанию.  

> [!IMPORTANT]  
> Хотя все дополнительные теги являются необязательными, они должны соответствовать транзитивное сайта &gt;стойке &gt;корпуса &gt;иерархии узла и должны быть правильно закрыты.  
Кроме имени, свободный `Location="..."`и `Description="..."`к любому тегу можно добавить дескрипторов.  

#### <a name="example-two-sites-one-rack-each"></a>Пример: Два сайта, с одной стойке  

```XML
<Topology>  
  <Site Name="SEA" Location="Contoso HQ, 123 Example St, Room 4010, Seattle">  
    <Rack Name="A01" Location="Aisle A, Rack 01">  
      <Node Name="Server01" Location="Rack Unit 33" />  
      <Node Name="Server02" Location="Rack Unit 35" />  
      <Node Name="Server03" Location="Rack Unit 37" />  
    </Rack>  
  </Site>  
  <Site Name="NYC" Location="Regional Datacenter, 456 Example Ave, New York City">  
    <Rack Name="B07" Location="Aisle B, Rack 07">  
      <Node Name="Server04" Location="Rack Unit 20" />  
      <Node Name="Server05" Location="Rack Unit 22" />  
      <Node Name="Server06" Location="Rack Unit 24" />  
    </Rack>  
  </Site>  
</Topology> 
``` 

#### <a name="example-two-chassis-blade-servers"></a>Пример: два корпуса, стоечные серверы  
```XML
<Topology>  
  <Rack Name="A01" Location="Contoso HQ, Room 4010, Aisle A, Rack 01">  
    <Chassis Name="Chassis01" Location="Rack Unit 2 (Upper)" >  
      <Node Name="Server01" Location="Left" />  
      <Node Name="Server02" Location="Right" />  
    </Chassis>  
    <Chassis Name="Chassis02" Location="Rack Unit 6 (Lower)" >  
      <Node Name="Server03" Location="Left" />  
      <Node Name="Server04" Location="Right" />  
    </Chassis>  
  </Rack>  
</Topology>  
```

Чтобы задать новую спецификацию домена сбоя, сохраните XML-код и выполните следующие действия в PowerShell.  

```PowerShell
$xml = Get-Content <Path> | Out-String  
Set-ClusterFaultDomainXML -XML $xml
```

В этом руководстве представлены только два примера, но `<Site>`, `<Rack>`, `<Chassis>`, и `<Node>`можно комбинировать и сопоставлять по-разному в соответствии с физической топологией развертывания, тегов того, что, возможно. Мы надеемся, что приведенные примеры иллюстрируют гибкость этих тегов и значение произвольных дескрипторов расположения для их однозначного определения.  

### <a name="optional-location-and-description-metadata"></a>(Необязательно) Метаданные расположение и описание

Вы можете указать необязательные **расположение** или **описание** метаданные для любого домена сбоя. Если указан, эти сведения будут включены в оповещения службы работоспособности оборудования. Этот короткий видеоролик демонстрирует значение добавления дескрипторов таких.

[![CЩелкните значок короткий видеоролик, демонстрирующий значение добавления дескрипторов расположения к доменам сбоев](media/Fault-Domains-in-Windows-Server-2016/part-4-location-description.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-4-Location-Description)

## <a name="see-also"></a>См. также:  
-   [В Windows Server 2016](../get-started/windows-server-2016.md)  
-   [Локальные дисковые пространства в Windows Server 2016](../storage/storage-spaces/storage-spaces-direct-overview.md) 
