---
ms.assetid: 56fc7f80-9558-467e-a6e9-a04c9abbee33
title: Служба сведений о домене сбоя
ms.prod: windows-server
ms.author: cosdar
ms.manager: eldenc
ms.technology: storage-failover-clustering
ms.topic: article
author: cosmosdarwin
ms.date: 09/16/2016
ms.openlocfilehash: 439f898b7c96ecc3d2f380509fe86d528aa737c5
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71361145"
---
# <a name="fault-domain-awareness"></a>Служба сведений о домене сбоя

> Область применения: Windows Server 2019 и Windows Server 2016

Отказоустойчивая кластеризация позволяет нескольким серверам работать вместе с целью обеспечения высокого уровня доступности или, другими словами, отказоустойчивости узла. Но современные предприятия стремятся к постоянному доступу из своей инфраструктуры. Для обеспечения бесперебойной работы, свойственной облачной среде, необходимо настроить защиту даже от таких маловероятных событий, как поломки корпуса, простои стойки или стихийные бедствия. Именно по этой причине отказоустойчивая кластеризация в Windows Server 2016 предоставила бы также защиту корпуса, стойки и отказоустойчивости сайта.

## <a name="fault-domain-awareness"></a>Служба сведений о домене сбоя

Домены сбоя и отказоустойчивость — тесно связанные понятия. Домен сбоя — это набор аппаратных компонентов, которые совместно используют единственную точку сбоя. Чтобы достичь отказоустойчивости конкретного уровня, необходимо использовать на нем несколько доменов сбоя. Например, чтобы обеспечить отказоустойчивость стоек, серверы и данные необходимо распределить среди нескольких стоек.

В этом коротком видео представлен обзор доменов сбоя в Windows Server 2016:  
[![щелкните это изображение, чтобы просмотреть общие сведения о доменах сбоя в Windows Server 2016.](media/Fault-Domains-in-Windows-Server-2016/Part-1-Fault-Domains-Overview.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-1-Overview)

### <a name="fault-domain-awareness-in-windows-server-2019"></a>Поддержка домена сбоя в Windows Server 2019

Служба "поддержка домена сбоя" доступна в Windows Server 2019, но по умолчанию отключена и должна быть включена в реестре Windows.

Чтобы включить поддержку домена сбоя в Windows Server 2019, перейдите в реестр Windows и установите (Get-Cluster). Для раздела реестра Аутоассигннодесите значение 1.

```Registry
    (Get-Cluster).AutoAssignNodeSite=1
```

Чтобы отключить осведомленность о домене сбоя в Windows 2019, перейдите в реестр Windows и установите (Get-Cluster). Для раздела реестра Аутоассигннодесите значение 0.

```Registry
    (Get-Cluster).AutoAssignNodeSite=0
```

## <a name="benefits"></a>Преимущества
- **Дисковые пространства, в том числе Локальные дисковые пространства, используют домены сбоя для повышения безопасности данных.**  
    Устойчивость в дисковых пространствах в принципе аналогична распределенной программно определяемой системе RAID. Несколько копий всех данных синхронизируются. В случае сбоя оборудования и потери одной копии другие копируются повторно для восстановления устойчивости. Для достижения максимальной устойчивости копии следует хранить в отдельных доменах сбоя.

- **[Служба работоспособности](health-service-overview.md) использует домены сбоя для предоставления более полезных оповещений.**  
    Каждый домен сбоя можно связать с метаданными расположения, которые будут автоматически включаться в любые последующие оповещения. Используя эти дескрипторы, рабочий или обслуживающий персонал могут различать оборудование, что поможет уменьшить количество ошибок.  

- **Кластеризация с растяжением использует домены сбоя для сходства хранилища.** В растянутой кластеризации можно присоединить к общему кластеру отдаленные серверы. Для повышения производительности приложения или виртуальные машины следует запускать на серверах, которые расположены недалеко от серверов, на которых хранятся данные. Служба "осведомленность о доменах сбоя" обеспечивает соответствие этого хранилища.   

## <a name="levels-of-fault-domains"></a>Уровни доменов сбоя  
Существует четыре классических уровня доменов сбоя: сайт, стойка, корпус и узел. Узлы обнаруживаются автоматически. Каждый дополнительный уровень не является обязательным. Например, если в развертывании не используются стоечные серверы, учитывать уровень корпуса не имеет смысла.  

![Схема различных уровней доменов сбоя](media/Fault-Domains-in-Windows-Server-2016/levels-of-fault-domains.png)

## <a name="usage"></a>Использование  
Для указания доменов сбоя можно использовать разметку PowerShell или XML. Оба подхода эквивалентны и полнофункциональны.

>[!IMPORTANT]
> Перед включением локальных дисковых пространств по возможности укажите домены сбоя. Это позволяет автоматической конфигурации подготовить пул, уровни и такие параметры, как устойчивость и число столбцов для обеспечения отказоустойчивости корпуса или стойки. После создания пула и томов данные не будут перемещены обратно после изменения топологии домена сбоя. Чтобы переместить узлы между корпусами или стойками после включения локальных дисковых пространств, сначала следует исключить узел и его диски из пула с помощью `Remove-ClusterNode -CleanUpDisks`.

### <a name="defining-fault-domains-with-powershell"></a>Определение доменов сбоя с помощью PowerShell
В Windows Server 2016 представлены следующие командлеты для работы с доменами сбоя.
* `Get-ClusterFaultDomain`
* `Set-ClusterFaultDomain`
* `New-ClusterFaultDomain` 
* `Remove-ClusterFaultDomain`

Этот короткий видеоролик демонстрирует использование указанных командлетов.
[![щелкните этот образ, чтобы просмотреть короткое видео об использовании командлетов домена сбоя кластера.](media/Fault-Domains-in-Windows-Server-2016/Part-2-Using-PowerShell.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-2-Using-PowerShell)

Используйте `Get-ClusterFaultDomain`, чтобы просмотреть текущую топологию домена сбоя. Появится список всех узлов в кластере, а также любых созданных корпусов, стоек или сайтов. Вы можете отфильтровать результаты с помощью таких параметров, как **-Type** или **-Name**, но это не обязательно.

```PowerShell
Get-ClusterFaultDomain
Get-ClusterFaultDomain -Type Rack
Get-ClusterFaultDomain -Name "server01.contoso.com"
```

Используйте `New-ClusterFaultDomain`, чтобы создать новый корпус, стойки или сайты. Параметры `-Type` и `-Name` являются обязательными. Возможные значения для `-Type`: `Chassis`, `Rack`и `Site`. `-Name` может быть любой строкой. (Для доменов сбоя типа `Node` имя должно быть фактическим именем узла, как задано автоматически).

```PowerShell
New-ClusterFaultDomain -Type Chassis -Name "Chassis 007"
New-ClusterFaultDomain -Type Rack -Name "Rack A"
New-ClusterFaultDomain -Type Site -Name "Shanghai"
```

> [!IMPORTANT]  
> Windows Server не может и не проверяет, соответствуют ли создаваемые домены сбоя каким-либо данным в реальном мире. (Это может показаться очевидным, но важно понимать.) Если, в физическом мире, все узлы находятся в одной стойке, то создание двух доменов сбоя `-Type Rack` в программном обеспечении не позволяет волшебно обеспечить отказоустойчивость стойки. Вы отвечаете за обеспечение соответствия топологии, созданной с помощью этих командлетов, фактическому расположению оборудования.

Используйте `Set-ClusterFaultDomain`, чтобы переместить один домен сбоя в другой. Обычно для описания этого отношения вложенности используются термины "родительской" и "дочерний". Параметры `-Name` и `-Parent` являются обязательными. В `-Name`укажите имя перемещаемого домена сбоя. в `-Parent`укажите имя назначения. Чтобы переместить сразу несколько доменов сбоя, перечислите их имена.

```PowerShell
Set-ClusterFaultDomain -Name "server01.contoso.com" -Parent "Rack A"
Set-ClusterFaultDomain -Name "Rack A", "Rack B", "Rack C", "Rack D" -Parent "Shanghai"
```

> [!IMPORTANT]  
> При перемещении доменов сбоев их дочерние элементы перемещаются вместе с ними. Если в приведенном выше примере стойка A является родительским элементом для server01.contoso.com, этот домен не нужно отдельно перемещать на сайт Shanghai. Это уже сделано, поскольку там находится его родительский элемент: все так же, как и в реальном мире.

Отношения "родители-потомки" можно просмотреть в выходных данных `Get-ClusterFaultDomain`, в столбцах `ParentName` и `ChildrenNames`.

`Set-ClusterFaultDomain` также можно использовать для изменения некоторых других свойств доменов сбоя. Например, можно указать дополнительные `-Location` или `-Description` метаданные для любого домена сбоя. Эти сведения будут включены в оповещения службы работоспособности, касающиеся оборудования. Домены сбоя также можно переименовывать с помощью параметра `-NewName`. Не переименовывайте домены сбоя типа `Node`.

```PowerShell
Set-ClusterFaultDomain -Name "Rack A" -Location "Building 34, Room 4010"
Set-ClusterFaultDomain -Type Node -Description "Contoso XYZ Server"
Set-ClusterFaultDomain -Name "Shanghai" -NewName "China Region"
```

Используйте `Remove-ClusterFaultDomain` для удаления созданного корпуса, стоек или сайтов. Параметр `-Name` обязательный. Невозможно удалить домен сбоя, содержащий дочерние элементы — сначала удалите дочерние элементы или переместите их за пределы использования `Set-ClusterFaultDomain`. Чтобы переместить домен сбоя за пределы всех остальных доменов сбоя, задайте для его `-Parent` пустую строку (""). Невозможно удалить домены сбоя типа `Node`. Чтобы удалить сразу несколько доменов сбоя, перечислите их имена.

```PowerShell
Set-ClusterFaultDomain -Name "server01.contoso.com" -Parent ""
Remove-ClusterFaultDomain -Name "Rack A"
```

### <a name="defining-fault-domains-with-xml-markup"></a>Определение доменов сбоя с помощью XML-разметки
Домены сбоя можно указать при помощи синтаксиса на основе XML. Мы рекомендуем с помощью любого текстового редактора создать XML-документ, который вы сможете сохранить и использовать потом. Например, можно использовать Visual Studio Code (загрузите его бесплатно *[отсюда](https://code.visualstudio.com/)* ) или Блокнот.  

Этот короткий видеоролик демонстрирует использование XML-разметки для определения доменов сбоев.

[![щелкните этот образ, чтобы просмотреть короткий видеоролик об использовании XML для указания доменов сбоя](media/Fault-Domains-in-Windows-Server-2016/Part-3-Using-XML-Markup.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-3-Using-XML)

В PowerShell выполните следующий командлет: `Get-ClusterFaultDomainXML`. Будет выведена текущая спецификация домена сбоя для кластера в виде XML-кода. Это отражает все обнаруженные `<Node>`, заключенные в открывающие и закрывающие теги `<Topology>`.  

Чтобы сохранить эти выходные данные в файл, выполните следующую команду.  

```PowerShell
Get-ClusterFaultDomainXML | Out-File <Path>  
```

Откройте файл и добавьте теги `<Site>`, `<Rack>`и `<Chassis>`, чтобы указать, как эти узлы распределяются между сайтами, стойками и шасси. Каждый тег должен быть идентифицирован уникальным **именем**. Для узлов необходимо сохранить имена, заданные по умолчанию.  

> [!IMPORTANT]  
> Хотя все дополнительные теги являются необязательными, они должны соответствовать транзитивной иерархии Site &gt; Rack &gt; Chassis &gt; Node и должны быть правильно закрыты.  
Помимо имени, в любой тег можно добавить `Location="..."` дескрипторы полилиний и `Description="..."`.  

#### <a name="example-two-sites-one-rack-each"></a>Пример: два сайта, на каждом по одной стойке  

```XML
<Topology>  
  <Site Name="SEA" Location="Contoso HQ, 123 Example St, Room 4010, Seattle">  
    <Rack Name="A01" Location="Aisle A, Rack 01">  
      <Node Name="Server01" Location="Rack Unit 33" />  
      <Node Name="Server02" Location="Rack Unit 35" />  
      <Node Name="Server03" Location="Rack Unit 37" />  
    </Rack>  
  </Site>  
  <Site Name="NYC" Location="Regional Datacenter, 456 Example Ave, New York City">  
    <Rack Name="B07" Location="Aisle B, Rack 07">  
      <Node Name="Server04" Location="Rack Unit 20" />  
      <Node Name="Server05" Location="Rack Unit 22" />  
      <Node Name="Server06" Location="Rack Unit 24" />  
    </Rack>  
  </Site>  
</Topology> 
``` 

#### <a name="example-two-chassis-blade-servers"></a>Пример: два корпуса, стоечные серверы  
```XML
<Topology>  
  <Rack Name="A01" Location="Contoso HQ, Room 4010, Aisle A, Rack 01">  
    <Chassis Name="Chassis01" Location="Rack Unit 2 (Upper)" >  
      <Node Name="Server01" Location="Left" />  
      <Node Name="Server02" Location="Right" />  
    </Chassis>  
    <Chassis Name="Chassis02" Location="Rack Unit 6 (Lower)" >  
      <Node Name="Server03" Location="Left" />  
      <Node Name="Server04" Location="Right" />  
    </Chassis>  
  </Rack>  
</Topology>  
```

Чтобы задать новую спецификацию домена сбоя, сохраните XML-файл и выполните в PowerShell следующую команду.  

```PowerShell
$xml = Get-Content <Path> | Out-String  
Set-ClusterFaultDomainXML -XML $xml
```

В этом руководством представлены только два примера, но Теги `<Site>`, `<Rack>`, `<Chassis>`и `<Node>` могут быть смешанными и сопоставлены во многих дополнительных способах отражения физической топологии развертывания, что может быть. Мы надеемся, что приведенные примеры иллюстрируют гибкость этих тегов и значение произвольных дескрипторов расположения для их однозначного определения.  

### <a name="optional-location-and-description-metadata"></a>Необязательно: метаданные расположения и описания

Можно указать необязательное **Расположение** или метаданные **описания** для любого домена сбоя. Эти сведения будут включены в оповещения службы работоспособности, касающиеся оборудования. В этом коротком видео показано значение добавления таких дескрипторов.

[![щелкните, чтобы просмотреть короткое видео с демонстрацией добавления дескрипторов расположения в домены сбоя.](media/Fault-Domains-in-Windows-Server-2016/part-4-location-description.jpg)](https://channel9.msdn.com/Blogs/windowsserver/Fault-Domain-Awareness-in-WS2016-Part-4-Location-Description)

## <a name="see-also"></a>См. также  
- [Начало работы с Windows Server 2019](https://docs.microsoft.com/windows-server/get-started-19/get-started-19)  
- [Приступая к работе с Windows Server 2016](https://docs.microsoft.com/windows-server/get-started/server-basics)  
-   [Обзор Локальные дисковые пространства](../storage/storage-spaces/storage-spaces-direct-overview.md) 
