---
title: Развертывание файлового ресурса-свидетеля в Windows Server 2019
description: Файловый ресурс следящих серверов позволяет использовать общую папку для голосования в кворуме кластера. В этом разделе описывается общая папка следящих серверов и новые функциональные возможности, включая использование USB-накопителя, подключенного к маршрутизатору, в качестве файлового ресурса следящего сервера.
manager: eldenc
ms.topic: article
author: johnmarlin-msft
ms.author: johnmar
ms.date: 01/24/2019
ms.localizationpriority: medium
ms.openlocfilehash: ea9dd3f79576048a57c85e879daf86567d325046
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87945837"
---
# <a name="deploy-a-file-share-witness"></a>Развертывание файлового ресурса-свидетеля

> Применяется к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Файловый ресурс-свидетель — это общая папка SMB, которую отказоустойчивый кластер использует в качестве голоса в кворуме кластера. В этом разделе приводятся общие сведения о технологии и новых функциях Windows Server 2019, включая использование USB-накопителя, подключенного к маршрутизатору, в качестве файлового ресурса следящего сервера.

Общая папка следящих серверов удобна в следующих случаях:

- Невозможно использовать облако-свидетель, так как не все серверы в кластере имеют надежное подключение к Интернету
- Невозможно использовать диск-свидетель, так как для диска-свидетеля нет общих дисков. Это может быть Локальные дисковые пространства кластера, SQL Server Always On группы доступности (AG), Группа доступности базы данных Exchange (DAG) и т. д.  Ни один из этих типов кластеров не использует общие диски.

## <a name="file-share-witness-requirements"></a>Требования к файловому ресурсу-свидетелю

Файловый ресурс-свидетель можно разместить на присоединенном к домену сервере Windows Server или в кластере под управлением Windows Server 2019, на котором может размещаться файловый ресурс SMB 2 или более поздней версии.

|Тип файлового сервера                 | Поддерживаемые кластеры |
|---------------------------------|--------------------|
|Любое устройство с общей папкой SMB 2 | Windows Server 2019|
|Присоединенный к домену сервер Windows Server     | Windows Server 2008 и более поздних версий.|

Если кластер работает под Windows Server 2019, необходимо выполнить следующие требования.

- Файловый ресурс SMB *на любом устройстве, использующем протокол SMB 2 или более поздней версии*, включая следующие:
    - Устройства хранения данных, подключенные к сети (NAS)
    - Компьютеры Windows, присоединенные к Рабочей группе
    - Маршрутизаторы с локально подключенным USB-хранилищем
- Локальная учетная запись на устройстве для проверки подлинности кластера
- Если вы используете Active Directory для проверки подлинности кластера в общей папке, объект имени кластера (CNO) должен иметь разрешения на запись в общую папку, а сервер должен находиться в том же лесу Active Directory, что и кластер.
- Общая папка содержит не менее 5 МБ свободного места

Если кластер работает под Windows Server 2016 или более ранней версии, необходимо выполнить следующие требования.

- Файловый ресурс SMB *на сервере Windows, присоединенном к тому же лесу Active Directory, что и кластер*
- Объект имени кластера (CNO) должен иметь разрешения на запись в общую папку
- Общая папка содержит не менее 5 МБ свободного места

Другие примечания:
- Чтобы использовать файловый ресурс-свидетель, размещенный не присоединенным к домену серверу Windows Server, в настоящее время необходимо использовать командлет PowerShell **Set-клустеркуорум-Credential** , как описано далее в этом разделе.
- Для обеспечения высокой доступности можно использовать файловый ресурс-свидетель в отдельном отказоустойчивом кластере.
- Файловый ресурс может использоваться несколькими кластерами.
- Использование общего ресурса распределенная файловая система (DFS) или реплицированного хранилища не поддерживается ни в одной из версий отказоустойчивой кластеризации.  Это может привести к ситуации разделенного мозгового случая, когда кластеризованные серверы работают независимо друг от друга и могут привести к потере данных.

## <a name="creating-a-file-share-witness-on-a-router-with-a-usb-device"></a>Создание файлового ресурса-свидетеля на маршрутизаторе с устройством USB

В [Microsoft Ignite 2018](https://azure.microsoft.com/ignite/) [хранилище датаон](http://www.dataonstorage.com/) имело Локальные дисковые пространства кластер в своей области киоска.  Этот кластер был подключен к маршрутизатору WiFi [нетжеар](https://www.netgear.com) нигхсавк X4S, используя порт USB в качестве файлового ресурса-свидетеля, как показано на этом.

![Следящий сервер Нетжеар](media/File-Share-Witness/FSW1.png)

Ниже перечислены действия по созданию файлового ресурса-свидетеля с помощью устройства USB на этом конкретном маршрутизаторе.  Обратите внимание, что действия на других маршрутизаторах и устройствах NAS будут отличаться и должны быть выполнены с помощью предоставленных поставщиком направлений.


1. Войдите в маршрутизатор с подключенным USB-устройством.

   ![Интерфейс Нетжеар](media/File-Share-Witness/FSW2.png)

2. В списке параметров выберите Реадишаре, где можно создать общие ресурсы.

   ![Нетжеар Реадишаре](media/File-Share-Witness/FSW3.png)

3. Для файлового ресурса-свидетеля требуется только базовый общий ресурс.  При нажатии кнопки "Изменить" появится диалоговое окно, в котором можно создать общую папку на USB-устройстве.

   ![Интерфейс общего доступа Нетжеар](media/File-Share-Witness/FSW4.png)

4. После нажатия кнопки Применить создается общий ресурс, который можно увидеть в списке.

   ![Нетжеар общие ресурсы](media/File-Share-Witness/FSW5.png)

5. После создания общего ресурса Создание файлового ресурса-свидетеля для кластера выполняется с помощью PowerShell.

   ```PowerShell
   Set-ClusterQuorum -FileShareWitness \\readyshare\Witness -Credential (Get-Credential)
   ```

   Откроется диалоговое окно для ввода локальной учетной записи на устройстве.

Аналогичные действия можно выполнить на других маршрутизаторах с возможностями USB, устройствами NAS или другими устройствами Windows.
