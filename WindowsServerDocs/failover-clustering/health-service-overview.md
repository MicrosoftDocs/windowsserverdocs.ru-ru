---
title: служба работоспособности в Windows Server
ms.prod: windows-server
manager: eldenc
ms.author: cosdar
ms.technology: storage-health-service
ms.topic: article
ms.assetid: 5bc71e71-920e-454f-8195-afebd2a23725
author: cosmosdarwin
ms.date: 02/09/2018
ms.openlocfilehash: 158681e2038e3d8015933771d06d3bfb24d31586
ms.sourcegitcommit: b5c12007b4c8fdad56076d4827790a79686596af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/06/2020
ms.locfileid: "78865403"
---
# <a name="health-service-in-windows-server"></a>служба работоспособности в Windows Server

> Область применения: Windows Server 2019, Windows Server 2016

Служба работоспособности — это новая функция Windows Server 2016, которая улучшает повседневный мониторинг и рабочую среду для кластеров под управлением Локальные дисковые пространства.

## <a name="prerequisites"></a>Предварительные требования  

Служба работоспособности включена по умолчанию для локальных дисковых пространств. Не требуется никаких дополнительных действий для ее настройки и запуска. Дополнительные сведения о Локальные дисковые пространства см. в разделе [Локальные дисковые пространства в Windows Server 2016](../storage/storage-spaces/storage-spaces-direct-overview.md).  

## <a name="reports"></a>Отчеты

См. [Служба работоспособности отчеты](health-service-reports.md).

## <a name="faults"></a>Неисправности

См. [Служба работоспособности ошибок](health-service-faults.md).

## <a name="actions"></a>Действия

См. раздел [действия Служба работоспособности](health-service-actions.md).

## <a name="automation"></a>Автоматизация  

В следующем разделе описываются рабочие процессы жизненного цикла диска, которые автоматизирует служба работоспособности.  

### <a name="disk-lifecycle"></a>Жизненный цикл диска   

Служба работоспособности автоматизирует практически все этапы жизненного цикла физического диска. Предположим, что изначально развертывание находится в идеальном состоянии, то есть все физические диски работают должным образом.  

#### <a name="retirement"></a>Снятие диска с учета  

Физические диски автоматически снимаются с учета, если их невозможно использовать. При этом создается соответствующее сообщение об ошибке. Причины этого могут быть разные:  

-   Сбой носителя: несомненный сбой или поломка физического диска, требуется замена диска.  

-   Потеря связи: физический диск теряет подключение более чем на 15 минут подряд.  

-   Отсутствие ответа: ответ от физического диска задерживался более чем на 5 секунд как минимум 3 раза за час.  

>[!NOTE]
> Если утрачено соединение одновременно с несколькими физическими дисками, со всем узлом или дисковой полкой, служба работоспособности *не* снимает диски с учета, так как, скорее всего, они не являются главной проблемой.  

Если снятый с учета диск выполнял функции кэша для нескольких других физических дисков, то для них автоматически назначается новый диск кэша (если он доступен). Никаких действий со стороны пользователя не требуется.  

#### <a name="restoring-resiliency"></a>Восстановление устойчивости  

После снятия с учета физического диска служба работоспособности немедленно начинает копировать данные на оставшиеся физические диски, чтобы восстановить полную устойчивость. После завершения этой операции данные снова полностью защищены и отказоустойчивы.  

>[!NOTE]
> Для такого немедленного восстановления требуется наличие достаточной емкости на оставшихся физических дисках.  

#### <a name="blinking-the-indicator-light"></a>Мигающий световой индикатор  

Если возможно, служба работоспособности активирует мигание светового индикатора на снятом с учета физическом диске или на его слоте. Мигание продолжается неограниченно долго, вплоть до замены снятого с учета диска.  

>[!NOTE]
> При некоторых сбоях, например при полной потере питания, становится невозможным даже мигание индикатора.  

#### <a name="physical-replacement"></a>Физическая замена  

Снятый с учета физический диск следует заменить как можно быстрее. Чаще всего это относится к горячей замене, т. е. выключение питания узла или корпуса хранилища не требуется. В описании ошибки представлена полезная информация о проблемной детали и ее расположении.  

#### <a name="verification"></a>Проверка

При вставке диска для замены он будет проверен на соответствие документу Поддерживаемые компоненты (см. следующий раздел).

#### <a name="pooling"></a>Пулы  

Если новый диск признается допустимым, он автоматически занимает место своего предшественника в пуле и берет на себя его функции. На этом этапе система возвращается в исходное состояние идеальной работоспособности и ошибка исчезает.  

## <a name="supported-components-document"></a>Документ о поддерживаемых компонентах  

Служба работоспособности предоставляет механизм принудительного применения для ограничения компонентов, используемых Локальные дисковые пространства, на поддерживаемые компоненты, предоставленные администратором или поставщиком решений. Благодаря этому можно предотвратить случайное использование неподдерживаемого оборудования, что помогает соблюсти условия гарантии или договора. В настоящее время эта функция ограничена физическими дисками, включая твердотельные накопители, жесткие диски и устройства NVMe. Документ Поддерживаемые компоненты может ограничивать модель, производителя (необязательно) и версию встроенного по (необязательно).

### <a name="usage"></a>Использование  

В документе Поддерживаемые компоненты используется синтаксис, основанный на XML. Для создания XML-документа, который можно сохранить и повторно использовать, рекомендуется использовать любой текстовый редактор, например бесплатный [Visual Studio Code](https://code.visualstudio.com/) или Блокнот.

#### <a name="sections"></a>Священ

Документ содержит два независимых раздела: `Disks` и `Cache`.

Если указан раздел `Disks`, то для объединения пулов разрешены только перечисленные диски (как `Disk`). Все непоставленные диски не могут присоединяться к пулам, что эффективно исключает их использование в рабочей среде. Если этот раздел оставлен пустым, то всем дискам будет разрешено присоединяться к пулам.

Если указан раздел `Cache`, для кэширования используются только перечисленные диски (как `CacheDisk`). Если этот раздел оставлен пустым, Локальные дисковые пространства пытается [угадать на основе типа носителя и типа шины](../storage/storage-spaces/understand-the-cache.md#cache-drives-are-selected-automatically). Перечисленные здесь диски также должны быть перечислены в `Disks`.

>[!IMPORTANT]
> Документ Поддерживаемые компоненты не применяет задним числом к дискам, которые уже помещены в пул и используются.  

#### <a name="example"></a>Пример

```XML
<Components>

  <Disks>
    <Disk>
      <Manufacturer>Contoso</Manufacturer>
      <Model>XYZ9000</Model>
      <AllowedFirmware>
        <Version>2.0</Version>
        <Version>2.1</Version>
        <Version>2.2</Version>
      </AllowedFirmware>
      <TargetFirmware>
        <Version>2.1</Version>
        <BinaryPath>C:\ClusterStorage\path\to\image.bin</BinaryPath>
      </TargetFirmware>
    </Disk>
    <Disk>
      <Manufacturer>Fabrikam</Manufacturer>
      <Model>QRSTUV</Model>
    </Disk>
  </Disks>

  <Cache>
    <CacheDisk>
      <Manufacturer>Fabrikam</Manufacturer>
      <Model>QRSTUV</Model>
    </CacheDisk>
  </Cache>

</Components>

```

Чтобы получить список нескольких дисков, просто добавьте дополнительные `<Disk>` или теги `<CacheDisk>`.

Чтобы внедрить этот XML-код при развертывании Локальные дисковые пространства, используйте параметр `-XML`:

```PowerShell
$MyXML = Get-Content <Filepath> | Out-String  
Enable-ClusterS2D -XML $MyXML
```

Чтобы задать или изменить документ поддерживаемых компонентов после развертывания Локальные дисковые пространства, выполните следующие действия.

```PowerShell
$MyXML = Get-Content <Filepath> | Out-String  
Get-StorageSubSystem Cluster* | Set-StorageHealthSetting -Name "System.Storage.SupportedComponents.Document" -Value $MyXML  
```

>[!NOTE]
>Модель, изготовитель и версия встроенного ПО должны полностью совпадать с теми значениями, которые возвращает командлет **Get-PhysicalDisk**. В некоторых случаях эти значения отличаются от того, что подсказывает здравый смысл. Например, производитель может быть обозначен как "CONTOSO-LTD" вместо "Contoso", или это поле остается пустым, зато для модели указывается значение "Contoso-XZY9000".  

Эти данные можно проверить с помощью командлета PowerShell:  

```PowerShell
Get-PhysicalDisk | Select Model, Manufacturer, FirmwareVersion  
```

## <a name="settings"></a>Настройки

См. раздел [параметры служба работоспособности](health-service-settings.md).

## <a name="see-also"></a>См. также:

- [Отчеты служба работоспособности](health-service-reports.md)
- [Ошибки служба работоспособности](health-service-faults.md)
- [служба работоспособности действия](health-service-actions.md)
- [Параметры служба работоспособности](health-service-settings.md)
- [Локальные дисковые пространства в Windows Server 2016](../storage/storage-spaces/storage-spaces-direct-overview.md)
