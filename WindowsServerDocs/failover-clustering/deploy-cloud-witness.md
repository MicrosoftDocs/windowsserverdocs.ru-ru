---
ms.assetid: 0cd1ac70-532c-416d-9de6-6f920a300a45
title: Развертывание облака-свидетеля для отказоустойчивого кластера
ms.prod: windows-server-threshold
manager: eldenc
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.topic: article
author: JasonGerend
ms.date: 01/18/2019
description: Как использовать Microsoft Azure для размещения следящего сервера для отказоустойчивого кластера Windows Server в облаке — так называемый Практическое развертывание облака-свидетеля.
ms.openlocfilehash: 64fd39a37c63d24f8fc0eb4f45c8a7e9f6089013
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66439780"
---
# <a name="deploy-a-cloud-witness-for-a-failover-cluster"></a>Развертывание облака-свидетеля для отказоустойчивого кластера

> Относится к: Windows Server 2019, Windows Server 2016

Облако-свидетель — это тип свидетеля кворума отказоустойчивого кластера, использующего Microsoft Azure для предоставления голос в кворуме кластера. Здесь представлен обзор компонентов облако-свидетель, поддерживаемых им сценариях и инструкции о настройке облака-свидетеля для отказоустойчивого кластера.

## <a name="CloudWitnessOverview"></a>Обзор следящий сервер в облаке

Рис. 1 показана конфигурация кворума многосайтового растянутой отказоустойчивого кластера с Windows Server 2016. В этом примере конфигурации (рис. 1) существует 2 узла в 2 центрах обработки данных (которые называют сайтов). Обратите внимание на то, возможно, для кластера охватывать более двух центров обработки данных. Кроме того центрами обработки данных может иметь более двух узлов. Конфигурации кворума кластера обычно в такой конфигурации (автоматическая отработка отказа соглашение об уровне ОБСЛУЖИВАНИЯ) дает каждому узлу голос. Один дополнительный голос назначается свидетель кворума позволяет кластеру сохранять работает даже в том случае, если один из одного центра обработки данных возникает из-за сбоя питания. Математические прост — есть 5 всего голосов и требуется 3 голосов для кластера для обеспечения его функционирования.  

![Файловый ресурс-свидетель в отдельном третий узел с 2 узлами в 2 других сайтов](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_1.png "файлового ресурса-свидетеля")  
**Рис. 1. С помощью файлового ресурса-свидетеля в качестве свидетеля кворума**  

В случае отключения питания в одном центре обработки данных чтобы предоставить равные возможности для кластера в другом ЦОД, чтобы оставить ее для работы, рекомендуется для размещения следящего сервера кворума в расположение, отличное от двумя центрами обработки данных. Это обычно означает, что требуется третий разделения центра обработки данных (узла) для размещения файлового сервера, резервную файловый ресурс, который используется в качестве свидетеля кворума (файловый ресурс-свидетель).  

Большинство организаций нет третий разделения центра обработки данных, в котором будет размещена резервного файловый ресурс-свидетель файлового сервера. Это означает, что организаций в первую очередь размещения файлового сервера в одном из двух центрах обработки данных, которые по расширению, делает этот центр обработки данных в основном центре обработки данных. В сценарии в случае отключения питания в основном центре обработки данных, кластер будет из строя как в другом ЦОД бы только 2 голосов, в которых ниже большинство кворума 3 голоса при необходимости. Для клиентов, имеющих третий отдельный центр обработки данных для размещения файлового сервера окажется для обеспечения высокой доступности файлового сервера, резервном файловый ресурс-свидетель. Размещение виртуальных машин в общедоступном облаке, имеющих файловый сервер для файлового ресурса-свидетеля в гостевой ОС — значительную нагрузку с точки зрения настройки и обслуживания.  

Облако-свидетель — это новый тип свидетеля кворума отказоустойчивого кластера, который использует Microsoft Azure в качестве точки арбитража (рис. 2). Он использует хранилище BLOB-объектов для файла большого двоичного объекта, который затем используется в качестве точки арбитража случай дроблением разрешения чтения и записи.  

Существуют значительные преимущества, что этот подход:
1. Использует Microsoft Azure (устраняет потребность в третьем отдельном центре обработки данных).  
2. Использует стандартные доступные хранилища больших двоичных объектов (без дополнительных дополнительной нагрузки от виртуальных машин, размещенных в общедоступном облаке).  
3. Учетную запись хранения Azure можно использовать для нескольких кластеров (файл одного большого двоичного объекта для каждого кластера; уникальный идентификатор кластера используется в качестве имени файла BLOB-объектов).  
4. Очень низкий $cost выполняющуюся в учетную запись хранения (очень мало данные, записанные на файл большого двоичного объекта обновлен файл большого двоичного объекта только в том случае, когда при изменении состояния узлов кластера).  
5. Встроенный тип ресурсов облака-свидетеля.  

![Схема, иллюстрирующая растянутого кластера с несколькими сайтами с помощью облака-свидетеля в качестве свидетеля кворума](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_2.png)  
**Рис. 2. Растянутых кластерах несколькими сайтами с помощью облака-свидетеля в качестве свидетеля кворума**  

Как показано на рис. 2, нет не третий отдельный сайт, который необходим. Облако-свидетель, как и любой другой свидетель кворума, получает голос и может участвовать в подсчет кворума.  

## <a name="CloudWitnessSupportedScenarios"></a>Облако-свидетель: Поддерживаемые сценарии для типа единого следящего сервера
Если имеется развертывание отказоустойчивого кластера, где все узлы могут получить доступ к Интернету (с расширением Azure), рекомендуется настроить облако-свидетель как вашего ресурса-свидетеля кворума.  

Некоторые сценарии, которые поддерживаются используют облако-свидетель как свидетель кворума, следующим образом:  
- Аварийное восстановление растягивается кластерах с несколькими узлами (см. рис. 2).  
- Отказоустойчивые кластеры без общего хранилища данных (SQL всегда в т. д.).  
- Отказоустойчивые кластеры под управлением в гостевой ОС, размещенного в роли виртуальной машины Microsoft Azure (или любого другого общедоступного облака).  
- Отказоустойчивые кластеры под управлением внутри гостевой ОС для виртуальных машин, размещенных в частных облаках.
- Хранилище кластеров с или без общего хранилища данных, таких как кластеры масштабируемых файловых серверов.  
- Кластеры малого офиса (кластеры даже 2 узла)  

Начиная с Windows Server 2012 R2, рекомендуется всегда настройте следящий сервер, как кластер автоматически управляет голоса свидетеля и узлы голосования с кворумом.  

## <a name="CloudWitnessSetUp"></a> Настройка облака-свидетеля для кластера
Чтобы настроить облака-свидетеля в качестве свидетеля кворума для кластера, выполните следующие действия:
1. Создайте учетную запись хранилища Azure для использования в качестве облака-свидетеля
2. Настройка облака-свидетеля в качестве свидетеля кворума для кластера.

## <a name="create-an-azure-storage-account-to-use-as-a-cloud-witness"></a>Создайте учетную запись хранилища Azure для использования в качестве облака-свидетеля

В этом разделе описывается создание конечной точки хранилища учетной записи и просмотр и копирование URL-адреса и ключи доступа для этой учетной записи.

Чтобы настроить облако-свидетель, необходимо иметь допустимый учетной записи хранения Azure, который может использоваться для хранения файла BLOB-объектов (используется для арбитража). Облако-свидетель создает контейнер хорошо известных **msft облако свидетель** под учетной записью хранения Microsoft. Уникальный идентификатор, используемый как имя файла, файла большого двоичного объекта в этом в облаке и следящий сервер записывает файл один большой двоичный объект с соответствующим кластера **msft облако свидетель** контейнера. Это означает, что же учетной записи хранения Microsoft Azure можно использовать для настройки облака-свидетеля для нескольких различных кластеров.

При использовании учетной записи хранения Azure для настройки облака-свидетеля для нескольких различных кластеров, один **msft облако свидетель** автоматически создается контейнер. Этот контейнер будет содержать blob один файл для каждого кластера.

### <a name="to-create-an-azure-storage-account"></a>Чтобы создать учетную запись хранилища Azure

1. Войдите в [портала Azure](http://portal.azure.com).
2. В главном меню выберите Создать -> данные + хранилище "->" учетная запись хранения.
3. В Создание страницы в учетную запись хранения сделайте следующее:
    1. Введите имя для вашей учетной записи хранения.
    <br>Имена учетных записей хранения должны находиться в диапазоне от 3 до 24 символов и может содержать только цифры и строчные буквы. Имя учетной записи хранения также должно быть уникальным в пределах Azure.
        
    2. Для **тип учетной записи**выберите **общего назначения**.
    <br>Нельзя использовать учетную запись хранения BLOB-объектов для облака-свидетеля.
    3. Для **производительности**выберите **стандартный**.
    <br>Нельзя использовать хранилище Azure класса Premium для облака-свидетеля.
    2. Для **репликации**выберите **локально избыточное хранилище (LRS)** .
    <br>Отказоустойчивая кластеризация использует файл большого двоичного объекта в качестве точки арбитража, требующий некоторые гарантии согласованности при чтении данных. Поэтому необходимо выбрать **локально избыточное хранилище** для **репликации** типа.

### <a name="view-and-copy-storage-access-keys-for-your-azure-storage-account"></a>Просмотр и копирование ключей доступа к хранилищу для учетной записи хранения Azure

При создании учетной записи хранения Microsoft Azure, он связан с двумя ключами доступа, которые автоматически создаются — первичный ключ доступа и вторичный ключ доступа. Для создания первого облака-свидетеля, используйте **первичный ключ доступа**. Нет никаких ограничений относительно какой ключ следует использовать для облака-свидетеля.  

#### <a name="to-view-and-copy-storage-access-keys"></a>Просмотр и копирование ключей доступа к хранилищу

На портале Azure перейдите к своей учетной записи хранения, щелкните **все параметры** и нажмите кнопку **ключи доступа** Просмотр, копирование и повторное создание ключей доступа к учетной записи. Колонка "ключи доступа" также включает в себя предварительно настроенные строки подключения с помощью первичного и вторичного ключей, которые можно скопировать для использования в приложениях (см. рис. 4).

![Снимок диалогового окна Управление ключами доступа в Microsoft Azure](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_4.png)  
**Рис. 4. Ключи доступа к хранилищу**

### <a name="view-and-copy-endpoint-url-links"></a>Просмотр и копирование URL-адрес ссылки конечной точки  
При создании учетной записи хранения, следующие URL-адреса создаются с использованием формата: `https://<Storage Account Name>.<Storage Type>.<Endpoint>`  

Облако-свидетель всегда использует **BLOB-объектов** как тип хранилища. Azure использует **. core.windows.net** как конечную точку. При настройке облака-свидетеля, можно настроить его с другой конечной точке в соответствии с вашей сценарием (например центра обработки данных Microsoft Azure в Китае имеет другой конечной точке).  

> [!NOTE]  
> URL-адрес конечной точки автоматически созданного ресурса-свидетеля в облаке и для URL-адрес необходим нет дополнительный шаг по конфигурации.  

#### <a name="to-view-and-copy-endpoint-url-links"></a>Для просмотра и скопируйте URL-адрес ссылки конечной точки
На портале Azure перейдите к своей учетной записи хранения, щелкните **все параметры** и нажмите кнопку **свойства** для просмотра и скопируйте URL-адреса конечной точки (см. рис. 5).  

![Моментальный снимок ссылки конечной точки облака-свидетеля](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_5.png)  
**Рис. 5. Облако ссылок URL-адрес конечной точки следящего сервера**

Дополнительные сведения о создании и управлении учетными записями хранения Azure см. в разделе [об учетных записях хранения Azure](https://azure.microsoft.com/documentation/articles/storage-create-storage-account/)

## <a name="configure-cloud-witness-as-a-quorum-witness-for-your-cluster"></a>Настройка облака-свидетеля в качестве свидетеля кворума для кластера
Настройка свидетеля Cloud хорошо интегрируется в существующие мастера настройки кворума, встроенные в Диспетчер отказоустойчивости кластеров.  

### <a name="to-configure-cloud-witness-as-a-quorum-witness"></a>Настройка облака-свидетеля в качестве свидетеля кворума
1. Запустите Диспетчер отказоустойчивости кластеров.
2. Щелкните правой кнопкой мыши кластер "->" **дополнительные действия** -> **настроить параметры кворума кластера** (см. рис. 6). Запустится мастер настройки кворума кластера.  
    ![Моментальный снимок меню пути к Настройка параметров кворума кластера в пользовательском Интерфейсе диспетчера отказоустойчивости кластеров](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_7.png) **рис. 6. Параметры кворума кластера**

3. На **Выбор различных конфигураций кворума** выберите **выбрать свидетель кворума** (см. рис. 7).  

    ![Моментальный снимок «выбрать свидетель quotrum» переключатель в мастере кворума кластера](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_8.png)  
    **Рис. 7. Выберите конфигурацию кворума**

4. На **Выбор свидетеля кворума** выберите **настроить облако-свидетель** (см. рис. 8).  

    ![Моментальный снимок соответствующий переключатель, чтобы выбрать облако-свидетель](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_9.png)  
    **Рис. 8. Выбрать свидетель кворума**  

5. На **настроить облако-свидетель** введите следующие сведения:  
   1. (Обязательный параметр) Имя учетной записи хранения Azure.  
   2. (Обязательный параметр) Доступ к ключу, соответствующий учетной записи хранения.  
       1. При создании в первый раз используйте первичный ключ доступа (см. рис. 5)  
       2. При смене первичного ключа доступа, используйте ключ доступа получателя (см. рис. 5)  
   3. (Необязательный параметр) Если вы планируете использовать конечную точку различные службы Azure (например, служба Microsoft Azure в Китае), необходимо обновите имя конечной точки сервера.  

      ![Моментальный снимок области конфигурации облака-свидетеля в мастере кворума кластера](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_10.png)  
      **Рис. 9. Настройка вашего облака-свидетеля**

6. После успешной настройки облака-свидетеля, может просмотреть в диспетчере отказоустойчивости кластеров ресурса-свидетеля только что созданный оснастки (см. рис. 10).

    ![Успешная Конфигурация облака-свидетеля](media/Deploy-a-Cloud-Witness-for-a-Failover-Cluster/CloudWitness_11.png)  
    **Рис. 10. Успешная Конфигурация облака-свидетеля**

### <a name="configuring-cloud-witness-using-powershell"></a>Настройка облака-свидетеля с помощью PowerShell  
Существующей команды PowerShell Set-ClusterQuorum имеет новые дополнительные параметры, соответствующие облако-свидетель.  

Можно настроить с помощью облака-свидетеля [ `Set-ClusterQuorum` ](https://technet.microsoft.com/library/ee461013.aspx) следующую команду PowerShell:  

```PowerShell
Set-ClusterQuorum -CloudWitness -AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey>
```

В случае вам потребуется использовать другой конечной точке (такие случаи редки).  

```PowerShell
Set-ClusterQuorum -CloudWitness -AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey> -Endpoint <servername>  
```

### <a name="azure-storage-account-considerations-with-cloud-witness"></a>Рекомендации по Azure учетной записи хранения с помощью облака-свидетеля  
При настройке облака-свидетеля в качестве свидетеля кворума для отказоустойчивого кластера, учитывайте следующее:
* Вместо сохранения ключ доступа, в отказоустойчивом кластере создаст и безопасно хранить маркер безопасности доступа (SAS).  
* Созданный маркер SAS действителен до тех пор, пока ключ доступа остается допустимым. При смене первичного ключа доступа, важно сначала обновить облако-свидетель (на всех кластеров, использующих эту учетную запись хранения) с использованием вторичного ключа доступа, прежде чем повторно создать первичный ключ доступа.  
* Облако-свидетель использует интерфейс HTTPS REST службы учетной записи хранения Azure. Это означает, что он требует HTTPS-порт, необходимо открыть на всех узлах кластера.

### <a name="proxy-considerations-with-cloud-witness"></a>Рекомендации по прокси-сервера с помощью облака-свидетеля  
Облако-свидетель использует протокол HTTPS (порт по умолчанию 443) для установления связи со службой BLOB-объектов Azure. Убедитесь, что HTTPS-порт доступен через сеть прокси-сервера.

## <a name="see-also"></a>См. также
- [Новые возможности отказоустойчивой кластеризации в Windows Server](whats-new-in-failover-clustering.md)
