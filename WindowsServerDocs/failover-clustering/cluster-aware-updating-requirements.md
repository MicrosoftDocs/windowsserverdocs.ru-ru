---
ms.assetid: 75cc1d24-fa2f-45bd-8f3b-1bbd4a1aead0
title: Требования и рекомендации по обновлению с учетом кластера
ms.prod: windows-server
ms.topic: article
ms.manager: dongill
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 08/06/2018
description: Требования к использованию кластерного обновления для установки обновлений в кластерах под управлением Windows Server.
ms.openlocfilehash: 58538b38db2ddec693d32328a7fb802dcb1c871b
ms.sourcegitcommit: 07c9d4ea72528401314e2789e3bc2e688fc96001
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/29/2020
ms.locfileid: "76822067"
---
# <a name="cluster-aware-updating-requirements-and-best-practices"></a>Требования и рекомендации по обновлению с учетом кластера

>Область применения: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описываются требования и зависимости, необходимые для применения обновлений к отказоустойчивому кластеру под управлением Windows Server с помощью [кластерного обновления](cluster-aware-updating.md) (Cau).

> [!NOTE]  
> Может потребоваться независимое подтверждение того, что среда кластера готова к применению обновлений, если используется подключаемый\-, отличный от **Microsoft. виндовсупдатеплугин**. Если вы используете не\-Microsoft Plug\-в, обратитесь к издателю за дополнительными сведениями. Дополнительные сведения о подключаемых модулях\-см. в разделе [работа\-модулей](cluster-aware-updating-plug-ins.md).   

## <a name="BKMK_REQ_CLUS"></a>Установка компонента отказоустойчивой кластеризации и средств отказоустойчивой кластеризации  
Для использования CAU необходимо установить компонент отказоустойчивости кластеров и средства отказоустойчивости кластеров. Средства отказоустойчивой кластеризации включают в себя средства CAU \(клустеравареупдатинг. dll\), командлеты отказоустойчивой кластеризации и другие компоненты, необходимые для операций CAU. Инструкции по установке компонента отказоустойчивости кластеров см. в записи блога [Установка компонента отказоустойчивости кластеров и средств отказоустойчивости кластеров](create-failover-cluster.md#install-the-failover-clustering-feature).  

Точные требования к установке средств отказоустойчивой кластеризации зависят от того, обновляются ли координаты CAU в виде кластерной роли в отказоустойчивом кластере \(с помощью режима обновления само\-\) или с удаленного компьютера. В режиме само\-обновления для CAU дополнительно требуется установка кластерной роли CAU в отказоустойчивом кластере с помощью средств CAU.    

В таблице ниже кратко описываются требования для установки компонента CAU в двух режимах обновления CAU.  

|Установленный компонент|Режим обновления само\-|Режим обновления удаленного\-|  
|-----------------------|-----------------------|-------------------------|  
|Средство отказоустойчивости кластеров|Требуется во всех узлах кластера|Требуется во всех узлах кластера|  
|Средства отказоустойчивости кластеров|Требуется во всех узлах кластера|— Требуется на удаленном\-обновлении компьютера<br />— Требуется на всех узлах кластера для выполнения командлета [Save-каудебугтраце](https://docs.microsoft.com/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps)|  
|Кластерная роль CAU|Обязательный|Не требуется|  

## <a name="obtain-an-administrator-account"></a>Получение учетной записи администратора  
Для использования компонентов CAU требуются указанные ниже разрешения администратора.  

-   Для предварительного просмотра или применения действий обновления с помощью пользовательского интерфейса CAU \(\) пользовательского интерфейса или командлетов обновления, поддерживающих кластер, необходимо использовать учетную запись домена с правами локального администратора и разрешениями на всех узлах кластера. Если учетная запись не имеет достаточных привилегий на каждом узле, при выполнении этих действий появится запрос в окне кластерного обновления, чтобы предоставить необходимые учетные данные. Чтобы использовать командлеты [обновления с поддержкой кластера](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps) , можно указать необходимые учетные данные в качестве параметра командлета.  

-   При использовании CAU в режиме удаленного\-обновления при входе в систему с учетной записью, которая не имеет прав локального администратора и разрешений на узлах кластера, необходимо запускать средства CAU от имени администратора с помощью учетной записи локального администратора на компьютере координатора обновлений или с помощью учетной записи, которая имеет права **impersonate клиента после проверки подлинности** пользователя. 

-   Чтобы запустить анализатор соответствия рекомендациям CAU, необходимо использовать учетную запись с правами администратора на узлах кластера и права локального администратора на компьютере, который используется для запуска командлета [Test-каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) , или для анализа готовности к обновлению кластера с помощью окна кластерного обновления. Дополнительные сведения см. в разделе [Проверка готовности к обновлению кластера](#BKMK_BPA).  

## <a name="verify-the-cluster-configuration"></a>Проверка конфигурации кластера  
Ниже приведены общие требования, которые должны выполняться, чтобы отказоустойчивый кластер поддерживал обновление с помощью CAU. Дополнительные требования к конфигурации для удаленного управления на узлах приведены в подразделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) далее в этом разделе.  

-   Должно быть доступно достаточное число узлов кластера, чтобы в кластере был кворум.  

-   Все узлы кластера должны быть в одном домене Active Directory.  

-   Имя кластера должно разрешаться в сети с помощью DNS.  

-   Если CAU используется в режиме удаленного обновления\-, компьютер координатора обновлений должен иметь сетевое подключение к узлам отказоустойчивого кластера и находиться в том же домене Active Directory, что и отказоустойчивый кластер.  

-   Служба кластеров должна быть запущена во всех узлах кластера. По умолчанию эта служба устанавливается во всех узлах кластера, и для нее настраивается автоматический запуск.  

-   Чтобы использовать PowerShell предварительно\-обновления или после\-скриптов обновления во время прогона обновления CAU, убедитесь, что сценарии установлены на всех узлах кластера или доступны для всех узлов, например, в сетевой общей папке высокой доступности. Если сценарии сохранены в сетевой папке, настройте для нее разрешение на чтение для группы "Все".  

## <a name="BKMK_NODE_CONFIG"></a>Настройка узлов для удаленного управления  
Для использования кластерного обновления все узлы кластера должны быть настроены для удаленного управления. По умолчанию единственной задачей, которую необходимо выполнить для настройки узлов для удаленного управления, является [Включение правила брандмауэра, разрешающего автоматический перезапуск](#BKMK_FW). 

В следующей таблице перечислены все требования удаленного управления, если среда отличается от параметров по умолчанию.

Эти требования дополняют требования раздела [Установка компонента отказоустойчивости кластеров и средств отказоустойчивости кластеров](#BKMK_REQ_CLUS) , а также общие требования для использования кластеризации, которые описаны в предыдущих подразделах этого раздела.  

|Требование|Состояние по умолчанию|Режим обновления само\-|Режим обновления удаленного\-|  
|---------------|---|-----------------------|-------------------------|  
|[Включение автоматического перезапуска для правила брандмауэра](#BKMK_FW)|Отключен|Требуется во всех узлах кластера, если используется брандмауэр|Требуется во всех узлах кластера, если используется брандмауэр|  
|[Включить инструментарий управления Windows (WMI)](#BKMK_WMI)|Включен|Требуется во всех узлах кластера|Требуется во всех узлах кластера|  
|[Включение Windows PowerShell 3,0 или 4,0 и удаленного взаимодействия Windows PowerShell](#BKMK_PS)|Включен|Требуется во всех узлах кластера|Требуется во всех узлах кластера для выполнения следующих компонентов:<br /><br />— Командлет [Save-каудебугтраце](https://docs.microsoft.com/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps) .<br />-PowerShell предварительно\-обновления и после\-сценариев обновления во время прогона обновления<br />— Тестирование готовности к обновлению кластера с помощью окна "обновление с поддержкой кластера" или командлета [Test\-каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) Windows PowerShell.|  
|[Установка .NET Framework 4,6 или 4,5](#BKMK_NET)|Включен|Требуется во всех узлах кластера|Требуется во всех узлах кластера для выполнения следующих компонентов:<br /><br />— Командлет [Save-каудебугтраце](https://docs.microsoft.com/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps) .<br />-PowerShell предварительно\-обновления и после\-сценариев обновления во время прогона обновления<br />— Тестирование готовности к обновлению кластера с помощью окна "обновление с поддержкой кластера" или командлета [Test\-каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) Windows PowerShell.|  

### <a name="BKMK_FW"></a>Включение автоматического перезапуска для правила брандмауэра  
Чтобы разрешить автоматическое перезагрузку после применения обновлений \(если установка обновления требует перезагрузки\)если на узлах кластера используется брандмауэр Windows или брандмауэр Microsoft, не\-, на каждом узле должно быть включено правило брандмауэра, разрешающее следующий трафик:  

-   Протокол: TCP  

-   Направление: входящий  

-   Программа: wininit.exe  

-   Порты: динамические RPC-порты  

-   Профиль: домен  

Если в узлах кластера используется брандмауэр Windows, сделать это можно путем включения группы правил брандмауэра Windows **Удаленное завершение работы** в каждом узле кластера. При использовании окна Обновление с поддержкой кластера для применения обновлений и настройки параметров\-самостоятельного обновления группа правил брандмауэра Windows для **удаленного завершения работы** автоматически включается на каждом узле кластера.  

> [!NOTE]  
> Группу правил брандмауэра Windows **Remote Shutdown** нельзя включить, если она вступит в конфликт с параметрами групповой политики, настроенными для брандмауэра Windows.    

Группу правил брандмауэра для **удаленного завершения работы** также можно включить, указав параметр **– енаблефиреваллрулес** при выполнении следующих командлетов Cau: [Add-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Add-CauClusterRole?view=win10-ps), [Invoke-каурун](https://docs.microsoft.com/powershell/module/clusterawareupdating/Invoke-CauRun?view=win10-ps)и [сеткауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Set-CauClusterRole?view=win10-ps).  

В следующем примере PowerShell показан дополнительный метод включения автоматического перезапуска на узле кластера.  

```PowerShell  
Set-NetFirewallRule -Group "@firewallapi.dll,-36751" -Profile Domain -Enabled true  
```  

### <a name="BKMK_WMI"></a>Включение инструментарий управления Windows (WMI) (WMI) 
Все узлы кластера должны быть настроены для удаленного управления с помощью инструментарий управления Windows (WMI) \(WMI\). Она включена по умолчанию.  

Чтобы включить удаленное управление вручную, выполните указанные ниже действия.  

1.  В консоли "Службы" запустите службу **Удаленное управление Windows** и задайте для нее тип запуска **Автоматически**.  

2.  Выполните командлет [Set-WSManQuickConfig](https://docs.microsoft.com/powershell/module/Microsoft.WsMan.Management/Set-WSManQuickConfig?view=powershell-6) или выполните следующую команду в командной строке с повышенными привилегиями:  

    ```PowerShell  
    winrm quickconfig -q  
    ```  

Для поддержки удаленного взаимодействия инструментария WMI, если на узлах кластера используется брандмауэр Windows, правило брандмауэра для входящего трафика для **служба удаленного управления Windows \(HTTP\-в\)** должно быть включено на каждом узле.  По умолчанию это правило включено.  

### <a name="BKMK_PS"></a>Включение удаленного взаимодействия Windows PowerShell и Windows PowerShell  
Чтобы включить режим обновления Self\-и некоторые функции CAU в режиме удаленного\-обновления, необходимо установить PowerShell и включить выполнение удаленных команд на всех узлах кластера. По умолчанию PowerShell устанавливается и включается для удаленного взаимодействия.  

Чтобы включить удаленное взаимодействие PowerShell, используйте один из следующих методов.  

-   Выполните командлет [Enable-PSRemoting](https://docs.microsoft.com/powershell/module/Microsoft.PowerShell.Core/Enable-PSRemoting) .  

-   Настройте параметр групповая политика\-уровня домена для служба удаленного управления Windows \(WinRM\).  

Дополнительные сведения о включении удаленного взаимодействия PowerShell см. в статье [об удаленных требованиях](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_remote_requirements?view=powershell-6).  

### <a name="BKMK_NET"></a>Установка .NET Framework 4,6 или 4,5  
Чтобы включить режим обновления само\-и некоторые функции CAU в удаленном\-ном режиме обновления, .NET Framework 4,6 или .NET Framework 4,5 (на Windows Server 2012 R2) должны быть установлены на всех узлах кластера. По умолчанию установлено значение NET Framework.  

Чтобы установить .NET Framework 4,6 (или 4,5) с помощью PowerShell, если он еще не установлен, используйте следующую команду:

```PowerShell
Install-WindowsFeature -Name NET-Framework-45-Core
```

## <a name="BKMK_BEST_PRAC"></a>Рекомендации по использованию кластерного обновления 

### <a name="BKMK_BP_WUA"></a>Рекомендации по применению обновлений Майкрософт

Если вы приступите к использованию CAU для применения обновлений с\-подключаемым модулем **Microsoft. виндовсупдатеплугин** по умолчанию в кластере, то вы прекращаете использовать другие методы для установки обновлений программного обеспечения из корпорации Майкрософт на узлах кластера.  

> [!CAUTION]  
> Объединение CAU с методами, которые автоматически обновляют отдельные узлы \(по фиксированному расписанию\) может привести к непредсказуемым результатам, включая прерывания в обслуживании и незапланированные простои.  

Рекомендуется придерживаться следующего плана действий.  

-   Для получения оптимальных результатов рекомендуется отключить параметры автоматического обновления в узлах кластера, например параметры автоматического обновления на панели управления или параметры, настроенные с помощью групповой политики.  

    > [!CAUTION]  
    > Автоматическая установка обновлений в узлах кластера может помешать установке обновлений с помощью CAU и привести к сбоям CAU.  

    При необходимости можно использовать следующие параметры автоматического обновления, которые совместимы с CAU, так как администратор может управлять временем установки обновлений:  

    -   параметры, в соответствии с которыми перед загрузкой и установкой обновлений выводятся уведомления;  

    -   параметры, в соответствии с которыми обновления загружаются автоматически, но перед их установкой выводятся уведомления.  

    Однако, если служба автоматического обновления загружает обновления одновременно с прогоном обновления CAU, на выполнение прогона может потребоваться больше времени.  

-   Не настраивайте систему обновления, например Windows Server Update Services \(WSUS\) автоматически применять обновления \(в фиксированном расписании\) на узлы кластера.  

-   Во всех узлах кластера должно быть настроено использование одного и того же источника обновлений, например сервера служб WSUS, Центра обновления Windows или Центра обновления Майкрософт.  

-   При использовании системы управления конфигурацией для обновления программного обеспечения на компьютерах в сети отмените все обязательные и автоматические обновления для узлов кластера. Примеры систем управления конфигурацией включают в себя Microsoft Endpoint Configuration Manager и Microsoft System Center Virtual Machine Manager 2008.  

-   Если внутренние серверы распространения программного обеспечения \(например, серверы WSUS\) используются для хранения и развертывания обновлений, убедитесь, что эти серверы правильно определяют утвержденные обновления для узлов кластера.  

#### <a name="BKMK_PROXY"></a>Применение обновлений Майкрософт в сценариях филиалов  
Для загрузки обновлений Майкрософт из Центра обновления Майкрософт или Центра обновления Windows на узлы кластера в филиале в некоторых случаях может потребоваться настроить параметры прокси-сервера для учетной записи Local System в каждом узле. Например, это может быть необходимо сделать в случае, если кластеры в филиалах получают доступ к Центру обновления Майкрософт или Центру обновления Windows для загрузки обновлений через локальный прокси-сервер.  

При необходимости настройте параметры прокси-сервера WinHTTP на каждом узле, чтобы указать локальный прокси-сервер и настроить исключения локального адреса \(то есть список обхода для локальных адресов\). Для этого можно выполнить следующую команду в каждом узле кластера из командной строки с повышенными привилегиями.  

```  
netsh winhttp set proxy <ProxyServerFQDN >:<port> "<local>"  
```  

где <*проксисерверфкдн*> — полное доменное имя для прокси-сервера, а <*порт*> — порт, через который осуществляется обмен данными (обычно это порт 443).  

Например, чтобы настроить параметры прокси-сервера WinHTTP для учетной записи локальной системы, указывающей прокси-сервер *MyProxy.contoso.com*с исключениями портов 443 и локального адреса, введите следующую команду:  

```  
netsh winhttp set proxy MyProxy.CONTOSO.com:443 "<local>"  
```  

### <a name="BKMK_BP_HF"></a>Рекомендации по использованию Microsoft. Хотфиксплугин  

-   Мы рекомендуем настроить разрешения для корневой папки исправлений и файла конфигурации исправлений, предоставив доступ для записи только локальным администраторам компьютеров, на которых хранятся эти файлы. Это поможет предотвратить несанкционированный доступ к этим файлам, который может нарушить функционирование отказоустойчивого кластера при применении исправлений.  

-   Чтобы обеспечить целостность данных для блока сообщений сервера \(подключениях SMB\), которые используются для доступа к корневой папке исправления, необходимо настроить шифрование SMB в общей папке SMB, если это возможно. Подключаемый модуль **Microsoft.HotfixPlugin** требует настройки подписания SMB или шифрования SMB для обеспечения целостности данных, передаваемых через подключения SMB. 

    Дополнительные сведения см. в разделе [ограничение доступа к корневой папке исправления и файлу конфигурации исправления](cluster-aware-updating-plug-ins.md#BKMK_ACL).

### <a name="additional-recommendations"></a>Дополнительные рекомендации  

-   Чтобы не помешать выполнению пробега обновления CAU, который может быть запланирован на то же время, не планируйте изменение паролей для объектов имен кластеров и виртуальных объектов-компьютеров на периоды запланированного обслуживания.  

-   Необходимо задать соответствующие разрешения на предварительное\-обновление и после\-скриптов обновления, которые сохраняются в общих сетевых папках, чтобы предотвратить потенциальное несанкционированную фальсификацию этих файлов неавторизованными пользователями.  

-   Чтобы настроить CAU в режиме обновления Self\-, объект виртуального компьютера \(\) VCO для кластерной роли CAU необходимо создать в Active Directory. Компонент CAU может создать этот объект автоматически при добавлении кластерной роли CAU, если у отказоустойчивого кластера достаточно разрешений. Однако из-за политик безопасности в некоторых организациях может быть необходимо предварительно подготовить этот объект в Active Directory. Описание этой процедуры см. в разделе [Действия по предварительной настройке учетной записи для кластерной роли](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731002\(v=ws.10\)#steps-for-prestaging-the-cluster-name-account).  

-   Чтобы сохранить параметры прогона обновления, а затем использовать их повторно применительно к отказоустойчивым кластерам с аналогичными потребностями в обновлении, можно создать профили прогона обновления. Кроме того, в зависимости от режима обновления можно сохранить профили прогона обновления и управлять ими в общей папке, доступной всем удаленным компьютерам координатора обновлений или отказоустойчивым кластерам. Дополнительные сведения см. в разделе [Дополнительные параметры и обновление профилей выполнения для Cau](cluster-aware-updating-options.md).  

## <a name="BKMK_BPA"></a>Проверка готовности к обновлению кластера  
Для проверки того, удовлетворяет ли отказоустойчивый кластер и сетевая среда, в соответствии с требованиями к обновлениям программного обеспечения, примененным с помощью CAU, можно запустить модель анализатор соответствия рекомендациям CAU \(BPA\). Многие тесты проверяют окружение на предмет готовности к применению обновлений Майкрософт с использованием\-по умолчанию Plug and in, **Microsoft. виндовсупдатеплугин**.  

> [!NOTE]  
> Может потребоваться независимое подтверждение того, что среда кластера готова к применению обновлений программного обеспечения с помощью подключаемого\-, отличного от **Microsoft. виндовсупдатеплугин**. Если используется не\-Microsoft Plug\-в, например, предоставленное производителем оборудования, обратитесь к издателю за дополнительными сведениями.  

Анализатор соответствия рекомендациям можно запустить двумя способами.  

1.  В консоли CAU выберите **Проанализировать готовность кластера к обновлению** . После того как анализатор соответствия рекомендациям завершит тесты готовности, отобразится тестовый отчет. В нем можно просмотреть информацию о выявленных неполадках и соответствующих узлах, чтобы принять меры по устранению этих неполадок. Выполнение тестов может занять несколько минут.  

2.  Выполните командлет [Test-каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup) . Командлет можно запустить на локальном или удаленном компьютере, на котором установлен модуль отказоустойчивого кластера для Windows PowerShell (часть средств отказоустойчивой кластеризации). Его также можно выполнить в узле отказоустойчивого кластера.  

> [!NOTE]  
> -   Необходимо использовать учетную запись с правами администратора на узлах кластера и права локального администратора на компьютере, который используется для запуска командлета **Test\-каусетуп** или для анализа готовности к обновлению кластера с помощью окна кластерного обновления. Для выполнения тестов с помощью окна "кластерное обновление" необходимо войти в систему на компьютере с необходимыми учетными данными.  
> -   При проведении тестов предполагается, что средства CAU, используемые для просмотра и применения обновлений ПО, запускаются с того же компьютера и с теми же учетными данными, которые используются для проверки готовности к обновлению кластера.  

> [!IMPORTANT]  
> Настоятельно рекомендуем проверить кластер на готовность к обновлению в следующих ситуациях:  
>   
> -   перед первым использованием кластерного обновления для применения обновлений ПО;  
> -   после добавления узла в кластер или внесения других изменений в оборудование кластера, требующих запуска мастера проверки кластера;  
> -   После изменения источника обновления или изменения параметров или конфигураций обновления \(, отличных от\) CAU, которые могут повлиять на применение обновлений на узлах.  

### <a name="tests-for-cluster-updating-readiness"></a>Тесты готовности к обновлению кластера  
В таблице ниже перечислены тесты готовности к обновлению кластера, некоторые распространенные проблемы и действия по их устранению.  


|                                                      Тестирование                                                      |                                                                                                                                               Возможные проблемы и их последствия                                                                                                                                               |                                                                                                                                                                                         Инструкции по устранению                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                     Должен быть доступен отказоустойчивый кластер                                     |                                                                                       Не удается разрешить имя отказоустойчивого кластера, либо невозможно получить доступ к одному или нескольким узлам кластера. Анализатор соответствия рекомендациям не может выполнить тесты готовности кластера.                                                                                        |                                                                   — Проверьте правильность написания имени кластера, указанного во время выполнения BPA.<br />— Убедитесь, что все узлы кластера находятся в сети и работают.<br />— Убедитесь, что мастер проверки конфигурации может успешно работать в отказоустойчивом кластере.                                                                    |
|                    На узлах отказоустойчивого кластера должно быть включено удаленное управление через WMI                    |                                                Один или несколько узлов отказоустойчивого кластера не включены для удаленного управления с помощью инструментарий управления Windows (WMI) \(WMI\). Компонент CAU не может обновить узлы кластера, если для них не настроено удаленное управление.                                                 |                                                                                                  Убедитесь в том, что для узлов отказоустойчивого кластера включено удаленное управление через WMI. Дополнительные сведения см. в разделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) этой статьи.                                                                                                   |
|                      Удаленное взаимодействие PowerShell должно быть включено на каждом узле отказоустойчивого кластера.                       |                                                           PowerShell не установлен или не включен для удаленного взаимодействия на одном или нескольких узлах отказоустойчивого кластера. Невозможно настроить CAU для режима обновления\-или использовать определенные функции в режиме удаленного\-обновления.                                                            |                                                                                             Убедитесь, что PowerShell установлен на всех узлах кластера и включен для удаленного взаимодействия.<br /><br />Дополнительные сведения см. в разделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) этой статьи.                                                                                             |
|                                            Версия отказоустойчивого кластера                                            |                                                                            Один или несколько узлов отказоустойчивого кластера не работают под управлением Windows Server 2016, Windows Server 2012 R2 или Windows Server 2012. Компонент CAU не может обновить отказоустойчивый кластер.                                                                             |                                                                   Убедитесь, что отказоустойчивый кластер, указанный во время выполнения BPA, работает под управлением Windows Server 2016, Windows Server 2012 R2 или Windows Server 2012.<br /><br />Дополнительные сведения см. в разделе [Проверка конфигурации кластера](#BKMK_REQ_CLUS) этой статьи.                                                                   |
| На всех узлах отказоустойчивого кластера должны быть установлены требуемые версии .NET Framework и Windows PowerShell |                                                                                              .NET Framework 4,6, 4,5 или Windows PowerShell не установлены на одном или нескольких узлах кластера. Некоторые функции CAU могут не работать.                                                                                              |                                                                            Убедитесь, что .NET Framework 4,6 или 4,5 и Windows PowerShell установлены на всех узлах кластера, если они необходимы.<br /><br />Дополнительные сведения см. в разделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) этой статьи.                                                                             |
|                           Служба кластеров должна работать на всех узлах кластера                           |                                                                                                            Служба кластеров не работает на одном или нескольких узлах. Компонент CAU не может обновить отказоустойчивый кластер.                                                                                                             |                        — Убедитесь, что служба кластеров \(ClusSvc\) запущен на всех узлах кластера и настроен на автоматический запуск.<br />— Убедитесь, что мастер проверки конфигурации может успешно работать в отказоустойчивом кластере.<br /><br />Дополнительные сведения см. в разделе [Проверка конфигурации кластера](#BKMK_REQ_CLUS) этой статьи.                         |
|     Службу автоматического обновления не следует настраивать для автоматической установки обновлений на узлы отказоустойчивого кластера     |                                           По крайней мере на одном узле отказоустойчивого кластера служба автоматического обновления настроена на автоматическую установку обновлений Майкрософт. Использование CAU в сочетании с другими способами обновления может привести к незапланированным простоям или непредвиденным результатам.                                            |                                                     Если на одном или нескольких кластерах настроено автоматическое обновление с помощью Центра обновления Windows, убедитесь в том, что служба автоматического обновления не настроена на автоматическую установку обновлений.<br /><br />Дополнительные сведения см. в разделе [Рекомендации по применению обновлений Майкрософт](#BKMK_BP_WUA).                                                     |
|                          Узлы отказоустойчивого кластера должны использовать один и тот же источник обновления                          |                                                    Для одного или нескольких узлов отказоустойчивого кластера настроено использование источника обновлений Майкрософт, отличного то указанного для остальных узлов. Компонент CAU не может обеспечить единообразное применение обновлений к узлам кластера.                                                    |                                                                        Убедитесь в том, что для всех узлов кластера настроено использование одного и того же источника обновлений, например сервера служб WSUS, Центра обновления Windows или Центра обновления Майкрософт.<br /><br />Дополнительные сведения см. в разделе [Рекомендации по применению обновлений Майкрософт](#BKMK_BP_WUA).                                                                         |
|       На каждом узле отказоустойчивого кластера должно быть включено правило брандмауэра, разрешающее удаленное выключение       |                 На одном или нескольких узлах отказоустойчивого кластера не включено правило брандмауэра, разрешающее удаленное выключение, либо включение этого правила запрещено параметром групповой политики. Прогоны обновления, требующие автоматической перезагрузки узлов, могут быть применены неверно.                  |                                                                    Если на узлах кластера используется брандмауэр Windows или брандмауэр (не\-), настройте правило брандмауэра, разрешающее удаленное завершение работы.<br /><br />Дополнительные сведения см. в разделе [Включение правила брандмауэра для обеспечения автоматического перезапуска](#BKMK_FW) этой статьи.                                                                    |
|          В качестве прокси-сервера на каждом узле отказоустойчивого кластера должен быть задан локальный прокси-сервер          |                             На одном или нескольких узлах отказоустойчивого кластера неправильно настроен прокси-сервер.<br /><br />Если используется локальный прокси-сервер, параметр прокси-сервера на каждом узле должен быть настроен правильно, чтобы кластер мог получать доступ к Центру обновления Майкрософт или Центру обновления Windows.                              |                                            Убедитесь в том, что в качестве прокси-сервера WinHTTP на каждом узле кластера задан локальный прокси-сервер, если он необходим. Если в вашей среде прокси-сервер не используется, это предупреждение можно игнорировать.<br /><br />Дополнительные сведения см. в разделе [Apply updates in branch office scenarios](#BKMK_PROXY) этой статьи.                                            |
|        Кластерная роль CAU должна быть установлена в отказоустойчивом кластере для включения режима обновления само\-        |                                                                                                   Кластерная роль CAU не установлена на этом отказоустойчивом кластере. Эта роль необходима для обновления самостоятельного\-кластера.                                                                                                   |      Чтобы использовать CAU в режиме самостоятельного обновления\-, добавьте кластерную роль CAU в отказоустойчивый кластер одним из следующих способов:<br /><br />— Выполните командлет PowerShell [Add-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Add-CauClusterRole) .<br />— Выберите действие **Настройка параметров обновления самостоятельно\-обновить** в окне Обновление с поддержкой кластера.      |
|         В отказоустойчивом кластере должна быть включена кластерная роль CAU для включения режима обновления само\-         | Кластерная роль CAU отключена. Например, кластерная роль CAU не установлена или отключена с помощью командлета PowerShell [Disable\-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Disable-CauClusterRole) . Эта роль необходима для обновления самостоятельного\-кластера. | Чтобы использовать CAU в режиме самостоятельного обновления\-, включите кластерную роль CAU в этом отказоустойчивом кластере одним из следующих способов:<br /><br />— Запустите командлет PowerShell [Enable-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Enable-CauClusterRole) .<br />— Выберите действие **Настройка параметров обновления самостоятельно\-обновить** в окне Обновление с поддержкой кластера. |
|      Настроенный\-подключаемых модулей CAU в для режима обновления Self\-должен быть зарегистрирован на всех узлах отказоустойчивого кластера.      |                                                              Кластерная роль CAU на одном или нескольких узлах этого отказоустойчивого кластера не может получить доступ к подключаемому модулю CAU\-в модуле, настроенном в параметрах обновления само\-. Выполнение само\-ного обновления может завершиться ошибкой.                                                              |           — Убедитесь, что настроенный\-подключаемый модуль CAU в установлен на всех узлах кластера, следуя процедуре установки продукта, предоставляющего подключаемый модуль CAU\-в.<br />— Выполните командлет [register\-кауплугин](https://docs.microsoft.com/powershell/module/clusterawareupdating/Register-CauPlugin) PowerShell, чтобы зарегистрировать подключаемый модуль\-в на требуемых узлах кластера.           |
|                Все узлы отказоустойчивого кластера должны иметь один и тот же набор зарегистрированных\-плагинов CAU.                 |                                                                             Выполнение само\-ного обновления может завершиться ошибкой, если подключаемый\-в, настроенный для использования в прогоне обновления, изменен на другой, недоступный на всех узлах кластера.                                                                              |           — Убедитесь, что настроенный\-подключаемый модуль CAU в установлен на всех узлах кластера, следуя процедуре установки продукта, предоставляющего подключаемый модуль CAU\-в.<br />— Выполните командлет [register\-кауплугин](https://docs.microsoft.com/powershell/module/clusterawareupdating/Register-CauPlugin) PowerShell, чтобы зарегистрировать подключаемый модуль\-в на требуемых узлах кластера.           |
|                               Должны быть настроены допустимые параметры прогона обновления                                |                                                                          Расписание обновления само\-и параметры прогона обновления, настроенные для этого отказоустойчивого кластера, неполные или являются недопустимыми. Выполнение само\-ного обновления может завершиться ошибкой.                                                                           |                                                            Настройте допустимое расписание обновления самостоятельного\-и набор параметров прогона обновления. Например, с помощью командлета PowerShell [Set\-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Set-CauClusterRole) можно настроить кластерную роль Cau.                                                            |
|                  По крайней мере два узла отказоустойчивого кластера должны быть владельцами кластерной роли CAU                  |                                                                                        Прогон обновления, запущенный в режиме само\-обновления, завершится ошибкой, так как у кластерной роли CAU нет возможных узлов-владельцев для перемещения.                                                                                         |                                                                                                                С помощью средств отказоустойчивости кластеров настройте все узлы кластера в качестве потенциальных владельцев кластерной роли CAU. Это конфигурация по умолчанию.                                                                                                                |
|                  Все узлы отказоустойчивого кластера должны иметь доступ к сценариям Windows PowerShell                  |                                                                        Не все возможные узлы, являющиеся владельцами кластерной роли CAU, имеют доступ к настроенным\-обновлениям Windows PowerShell и после\-скриптов обновления. Выполнение само\-ного обновления завершится ошибкой.                                                                        |                                                                                                                    Убедитесь, что все возможные узлы, являющиеся владельцами кластерной роли CAU, имеют разрешения на доступ к настроенным\-обновлениям PowerShell, а также скриптам обновления после\-.                                                                                                                     |
|                   На всех узлах отказоустойчивого кластера должны использоваться идентичные сценарии Windows PowerShell                   |                                                     Не все возможные узлы, являющиеся владельцами кластерной роли CAU, используют ту же копию указанной ранее\-обновления Windows PowerShell и скрипты обновления после\-. Выполнение само\-ного обновления может завершиться ошибкой или отобразить непредвиденное поведение.                                                     |                                                                                                                                   Убедитесь, что все возможные узлы, являющиеся владельцами кластерной роли CAU, используют те же самые\-обновления PowerShell и скрипты обновления после\-.                                                                                                                                   |
|         Значение параметра WarnAfter, заданное для прогона обновления, должно быть меньше значения параметра StopAfter         |                                                                           Указанные значения времени ожидания прогона обновления CAU делают время ожидания предупреждения недействительным. Прогон обновления может быть отменен до регистрации предупреждения в журнале событий.                                                                            |                                                                                                                                      В параметрах прогона обновления задайте значение параметра **WarnAfter** так, чтобы оно было меньше значения параметра **StopAfter** .                                                                                                                                       |

## <a name="see-also"></a>См. также статью  

-   [Обзор обновления с поддержкой кластера](cluster-aware-updating.md)