---
ms.assetid: 75cc1d24-fa2f-45bd-8f3b-1bbd4a1aead0
title: Требования и рекомендации для кластерного обновления
ms.prod: windows-server
ms.topic: article
manager: lizross
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 08/06/2018
description: Требования к использованию кластерного обновления для установки обновлений в кластерах под управлением Windows Server.
ms.openlocfilehash: 066aca3adb2ceec19663653a7bc2f0f8cd42da16
ms.sourcegitcommit: 771db070a3a924c8265944e21bf9bd85350dd93c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2020
ms.locfileid: "85473311"
---
# <a name="cluster-aware-updating-requirements-and-best-practices"></a>Требования и рекомендации для кластерного обновления

> Применяется к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описываются требования и зависимости, необходимые для применения обновлений к отказоустойчивому кластеру под управлением Windows Server с помощью [кластерного обновления](cluster-aware-updating.md) (Cau).

> [!NOTE]
> Может потребоваться независимое подтверждение того, что среда кластера готова к применению обновлений, если используется подключаемый модуль, отличный \- от **Microsoft. виндовсупдатеплугин**. Если используется не \- подключаемый модуль Microsoft \- , обратитесь к издателю за дополнительными сведениями. Дополнительные сведения о подключаемых модулях \- см. в статье [как \- работают подключаемые](cluster-aware-updating-plug-ins.md)модули.

## <a name="install-the-failover-clustering-feature-and-the-failover-clustering-tools"></a><a name="BKMK_REQ_CLUS"></a>Установка компонента отказоустойчивости кластеров и средств отказоустойчивости кластеров
Для использования CAU необходимо установить компонент отказоустойчивости кластеров и средства отказоустойчивости кластеров. Средства отказоустойчивой кластеризации включают в себя средства CAU \(clusterawareupdating.dll\) , командлеты отказоустойчивой кластеризации и другие компоненты, необходимые для операций Cau. Инструкции по установке компонента отказоустойчивости кластеров см. в записи блога [Установка компонента отказоустойчивости кластеров и средств отказоустойчивости кластеров](create-failover-cluster.md#install-the-failover-clustering-feature).

Точные требования к установке средств отказоустойчивой кластеризации зависят от того, обновляются ли координаты CAU в виде кластерной роли в отказоустойчивом кластере с \( помощью \- режима самообновления \) или с удаленного компьютера. \-Режим самообновления для Cau дополнительно требует установки кластерной роли Cau в отказоустойчивом кластере с помощью средств Cau.

В таблице ниже кратко описываются требования для установки компонента CAU в двух режимах обновления CAU.

|Установленный компонент|\-Режим самообновления|\-Режим удаленного обновления|
|-----------------------|-----------------------|-------------------------|
|Средство отказоустойчивости кластеров|Требуется во всех узлах кластера|Требуется во всех узлах кластера|
|Средства отказоустойчивости кластеров|Требуется во всех узлах кластера|— Требуется на удаленно \- обновляемом компьютере<br />— Требуется на всех узлах кластера для выполнения командлета [Save-каудебугтраце](https://docs.microsoft.com/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps)|
|Кластерная роль CAU|Обязательно|Не требуется|

## <a name="obtain-an-administrator-account"></a>Получение учетной записи администратора
Для использования компонентов CAU требуются указанные ниже разрешения администратора.

-   Чтобы просмотреть или применить действия обновления с помощью пользовательского интерфейса CAU \( \) или командлетов для кластерного обновления, необходимо использовать учетную запись домена с правами локального администратора и разрешениями на всех узлах кластера. Если учетная запись не имеет достаточных привилегий на каждом узле, при выполнении этих действий появится запрос в окне кластерного обновления, чтобы предоставить необходимые учетные данные. Чтобы использовать командлеты [обновления с поддержкой кластера](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps) , можно указать необходимые учетные данные в качестве параметра командлета.

-   При использовании CAU в режиме удаленного \- обновления при входе в систему с учетной записью, которая не имеет прав локального администратора и разрешений на узлах кластера, необходимо запускать средства Cau от имени администратора с помощью учетной записи локального администратора на компьютере координатора обновлений или с помощью учетной записи, которая имеет права **Олицетворять клиента после проверки подлинности** пользователя.

-   Чтобы запустить анализатор соответствия рекомендациям CAU, необходимо использовать учетную запись с правами администратора на узлах кластера и права локального администратора на компьютере, который используется для запуска командлета [Test-каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) , или для анализа готовности к обновлению кластера с помощью окна кластерного обновления. Подробнее см. в подразделе [Проверка готовности к обновлению кластера](#BKMK_BPA).

## <a name="verify-the-cluster-configuration"></a>Проверка конфигурации кластера
Ниже приведены общие требования, которые должны выполняться, чтобы отказоустойчивый кластер поддерживал обновление с помощью CAU. Дополнительные требования к конфигурации для удаленного управления в узлах приведены в подразделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) далее в этом разделе.

-   Должно быть доступно достаточное число узлов кластера, чтобы в кластере был кворум.

-   Все узлы кластера должны быть в одном домене Active Directory.

-   Имя кластера должно разрешаться в сети с помощью DNS.

-   Если в режиме удаленного обновления используется CAU \- , компьютер координатора обновлений должен иметь сетевое подключение к узлам отказоустойчивого кластера и находиться в том же домене Active Directory, что и отказоустойчивый кластер.

-   Служба кластеров должна быть запущена во всех узлах кластера. По умолчанию эта служба устанавливается во всех узлах кластера, и для нее настраивается автоматический запуск.

-   Чтобы использовать \- скрипты предварительного обновления или \- обновления PowerShell во время прогона обновления Cau, убедитесь, что скрипты установлены на всех узлах кластера или доступны для всех узлов, например, в сетевой общей папке высокой доступности. Если сценарии сохранены в сетевой папке, настройте для нее разрешение на чтение для группы "Все".

## <a name="configure-the-nodes-for-remote-management"></a><a name="BKMK_NODE_CONFIG"></a>Настройка узлов для удаленного управления
Для использования кластерного обновления все узлы кластера должны быть настроены для удаленного управления. По умолчанию единственной задачей, которую необходимо выполнить для настройки узлов для удаленного управления, является [Включение правила брандмауэра, разрешающего автоматический перезапуск](#BKMK_FW).

В следующей таблице перечислены все требования удаленного управления, если среда отличается от параметров по умолчанию.

Эти требования дополняют требования для [установки компонента отказоустойчивости кластеров и средств отказоустойчивости кластеров](#BKMK_REQ_CLUS), а также общие требования для использования кластеризации, которые описаны в предыдущих подразделах этого раздела.

|Требование|Состояние по умолчанию|\-Режим самообновления|\-Режим удаленного обновления|
|---------------|---|-----------------------|-------------------------|
|[Включение правила брандмауэра для обеспечения автоматического перезапуска](#BKMK_FW)|Выключено|Требуется во всех узлах кластера, если используется брандмауэр|Требуется во всех узлах кластера, если используется брандмауэр|
|[Включение инструментария управления Windows (WMI)](#BKMK_WMI)|Активировано|Требуется во всех узлах кластера|Требуется во всех узлах кластера|
|[Включение Windows PowerShell 3.0 или 4.0 и удаленного взаимодействия Windows PowerShell](#BKMK_PS)|Активировано|Требуется во всех узлах кластера|Требуется во всех узлах кластера для выполнения следующих компонентов:<p>— Командлет [Save-каудебугтраце](https://docs.microsoft.com/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps) .<br />— Предварительное \- Обновление PowerShell и \- выполнение скриптов после обновления во время прогона обновления<br />— Тестирование готовности к обновлению кластера с помощью окна "обновление с поддержкой кластера" или командлета [Test \- Каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) Windows PowerShell.|
|[Установка .NET Framework 4,6 или 4,5](#BKMK_NET)|Активировано|Требуется во всех узлах кластера|Требуется во всех узлах кластера для выполнения следующих компонентов:<p>— Командлет [Save-каудебугтраце](https://docs.microsoft.com/powershell/module/clusterawareupdating/Save-CauDebugTrace?view=win10-ps) .<br />— Предварительное \- Обновление PowerShell и \- выполнение скриптов после обновления во время прогона обновления<br />— Тестирование готовности к обновлению кластера с помощью окна "обновление с поддержкой кластера" или командлета [Test \- Каусетуп](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup?view=win10-ps) Windows PowerShell.|

### <a name="enable-a-firewall-rule-to-allow-automatic-restarts"></a><a name="BKMK_FW"></a>Включение правила брандмауэра для обеспечения автоматического перезапуска
Чтобы разрешить автоматическое перезагрузку после применения обновлений \( , если установка обновления требует перезагрузки \) , если \- на узлах кластера используется брандмауэр Windows или брандмауэр, отличный от Майкрософт, на каждом узле, который разрешает следующий трафик, необходимо включить правило брандмауэра.

-   Протокол: TCP

-   Направление: входящий

-   Программа: wininit.exe

-   Порты: динамические RPC-порты

-   Профиль: домен

Если в узлах кластера используется брандмауэр Windows, сделать это можно путем включения группы правил брандмауэра Windows **Удаленное завершение работы** в каждом узле кластера. При использовании окна "кластерное обновление" для применения обновлений и настройки \- параметров автоматического обновления группа правил брандмауэра Windows для **удаленного завершения работы** автоматически включается на каждом узле кластера.

> [!NOTE]
> Группу правил брандмауэра Windows **Remote Shutdown** нельзя включить, если она вступит в конфликт с параметрами групповой политики, настроенными для брандмауэра Windows.

Группу правил брандмауэра для **удаленного завершения работы** также можно включить, указав параметр **– енаблефиреваллрулес** при выполнении следующих командлетов Cau: [Add-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Add-CauClusterRole?view=win10-ps), [Invoke-каурун](https://docs.microsoft.com/powershell/module/clusterawareupdating/Invoke-CauRun?view=win10-ps)и [сеткауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Set-CauClusterRole?view=win10-ps).

В следующем примере PowerShell показан дополнительный метод включения автоматического перезапуска на узле кластера.

```PowerShell
Set-NetFirewallRule -Group "@firewallapi.dll,-36751" -Profile Domain -Enabled true
```

### <a name="enable-windows-management-instrumentation-wmi"></a><a name="BKMK_WMI"></a>Включение инструментарий управления Windows (WMI) (WMI)
Все узлы кластера должны быть настроены для удаленного управления с помощью инструментарий управления Windows (WMI) \( WMI \) . Эта функция включена по умолчанию.

Чтобы включить удаленное управление вручную, выполните указанные ниже действия.

1.  В консоли "Службы" запустите службу **Удаленное управление Windows** и задайте для нее тип запуска **Автоматически**.

2.  Выполните командлет [Set-WSManQuickConfig](https://docs.microsoft.com/powershell/module/Microsoft.WsMan.Management/Set-WSManQuickConfig?view=powershell-6) или следующую команду из командной строки с повышенными привилегиями.

    ```PowerShell
    winrm quickconfig -q
    ```

Для поддержки удаленного взаимодействия инструментария WMI, если на узлах кластера используется брандмауэр Windows, правило брандмауэра для входящего трафика для **Служба удаленного управления Windows \( HTTP \- в \) ** должно быть включено на каждом узле.  По умолчанию это правило включено.

### <a name="enable-windows-powershell-and-windows-powershell-remoting"></a><a name="BKMK_PS"></a>Включение Windows PowerShell и удаленного взаимодействия Windows PowerShell
Чтобы включить \- режим самообновления и некоторые функции Cau в удаленном \- режиме обновления, необходимо установить PowerShell и включить выполнение удаленных команд на всех узлах кластера. По умолчанию PowerShell устанавливается и включается для удаленного взаимодействия.

Чтобы включить удаленное взаимодействие PowerShell, используйте один из следующих методов.

-   Выполните командлет [Enable-PSRemoting](https://docs.microsoft.com/powershell/module/Microsoft.PowerShell.Core/Enable-PSRemoting) .

-   Настройте \- параметр Групповая политика уровня домена для служба удаленного управления Windows \( WinRM \) .

Дополнительные сведения о включении удаленного взаимодействия PowerShell см. в статье [об удаленных требованиях](https://docs.microsoft.com/powershell/module/microsoft.powershell.core/about/about_remote_requirements?view=powershell-6).

### <a name="install-net-framework-46-or-45"></a><a name="BKMK_NET"></a>Установка .NET Framework 4,6 или 4,5
Чтобы включить \- режим самообновления и некоторые функции Cau в удаленном \- режиме обновления, .net Framework 4,6 или .NET Framework 4,5 (на Windows Server 2012 R2) должны быть установлены на всех узлах кластера. По умолчанию установлено значение NET Framework.

Чтобы установить .NET Framework 4,6 (или 4,5) с помощью PowerShell, если он еще не установлен, используйте следующую команду:

```PowerShell
Install-WindowsFeature -Name NET-Framework-45-Core
```

## <a name="best-practices-recommendations-for-using-cluster-aware-updating"></a><a name="BKMK_BEST_PRAC"></a>Рекомендации по использованию кластерного обновления

### <a name="recommendations-for-applying-microsoft-updates"></a><a name="BKMK_BP_WUA"></a>Рекомендации по применению обновлений Майкрософт

Если вы приступите к использованию CAU для установки обновлений с помощью модуля **Microsoft. виндовсупдатеплугин** по умолчанию \- в кластере, то вы прекращаете использовать другие методы, чтобы устанавливать обновления программного обеспечения из корпорации Майкрософт на узлах кластера.

> [!CAUTION]
> Объединение CAU с методами, которые автоматически обновляют отдельные узлы \( по фиксированному расписанию \) , может привести к непредсказуемым результатам, включая прерывания в обслуживании и незапланированные простои.

Рекомендуется придерживаться следующего плана действий.

-   Для получения оптимальных результатов рекомендуется отключить параметры автоматического обновления в узлах кластера, например параметры автоматического обновления на панели управления или параметры, настроенные с помощью групповой политики.

    > [!CAUTION]
    > Автоматическая установка обновлений в узлах кластера может помешать установке обновлений с помощью CAU и привести к сбоям CAU.

    При необходимости можно использовать следующие параметры автоматического обновления, которые совместимы с CAU, так как администратор может управлять временем установки обновлений:

    -   параметры, в соответствии с которыми перед загрузкой и установкой обновлений выводятся уведомления;

    -   параметры, в соответствии с которыми обновления загружаются автоматически, но перед их установкой выводятся уведомления.

    Однако, если служба автоматического обновления загружает обновления одновременно с прогоном обновления CAU, на выполнение прогона может потребоваться больше времени.

-   Не настраивайте систему обновления, например Windows Server Update Services \( WSUS \) , для автоматического применения обновлений \( по фиксированному расписанию \) с узлами кластера.

-   Во всех узлах кластера должно быть настроено использование одного и того же источника обновлений, например сервера служб WSUS, Центра обновления Windows или Центра обновления Майкрософт.

-   При использовании системы управления конфигурацией для обновления программного обеспечения на компьютерах в сети отмените все обязательные и автоматические обновления для узлов кластера. Примеры систем управления конфигурацией включают в себя Microsoft Endpoint Configuration Manager и Microsoft System Center Virtual Machine Manager 2008.

-   Если, например, серверы распространения программного обеспечения \( \) используются для хранения и развертывания обновлений, убедитесь, что эти серверы правильно определяют утвержденные обновления для узлов кластера.

#### <a name="apply-microsoft-updates-in-branch-office-scenarios"></a><a name="BKMK_PROXY"></a>Применение обновлений Майкрософт в филиалах
Для загрузки обновлений Майкрософт из Центра обновления Майкрософт или Центра обновления Windows на узлы кластера в филиале в некоторых случаях может потребоваться настроить параметры прокси-сервера для учетной записи Local System в каждом узле. Например, это может быть необходимо сделать в случае, если кластеры в филиалах получают доступ к Центру обновления Майкрософт или Центру обновления Windows для загрузки обновлений через локальный прокси-сервер.

При необходимости настройте параметры прокси-сервера WinHTTP на каждом узле, чтобы указать локальный прокси-сервер и настроить исключения локального адреса, \( т. е. список обхода для локальных адресов \) . Для этого можно выполнить следующую команду в каждом узле кластера из командной строки с повышенными привилегиями.

```
netsh winhttp set proxy <ProxyServerFQDN >:<port> "<local>"
```

где <*проксисерверфкдн*> — полное доменное имя для прокси-сервера, а <*порт*> — порт, через который осуществляется обмен данными (обычно это порт 443).

Например, чтобы настроить параметры прокси-сервера WinHTTP для учетной записи локальной системы, указывающей прокси-сервер *MyProxy.contoso.com*с исключениями портов 443 и локального адреса, введите следующую команду:

```
netsh winhttp set proxy MyProxy.CONTOSO.com:443 "<local>"
```

### <a name="recommendations-for-using-the-microsofthotfixplugin"></a><a name="BKMK_BP_HF"></a>Рекомендации по использованию подключаемого модуля Microsoft.HotfixPlugin

-   Мы рекомендуем настроить разрешения для корневой папки исправлений и файла конфигурации исправлений, предоставив доступ для записи только локальным администраторам компьютеров, на которых хранятся эти файлы. Это поможет предотвратить несанкционированный доступ к этим файлам, который может нарушить функционирование отказоустойчивого кластера при применении исправлений.

-   Чтобы обеспечить целостность данных для SMB-подключений в блоке сообщений сервера \( \) , которые используются для доступа к корневой папке исправления, необходимо настроить шифрование SMB в общей папке SMB, если ее можно настроить. Подключаемый модуль **Microsoft.HotfixPlugin** требует настройки подписания SMB или шифрования SMB для обеспечения целостности данных, передаваемых через подключения SMB.

    Дополнительные сведения см. в разделе [ограничение доступа к корневой папке исправления и файлу конфигурации исправления](cluster-aware-updating-plug-ins.md#BKMK_ACL).

### <a name="additional-recommendations"></a>Дополнительные рекомендации

-   Чтобы не помешать выполнению пробега обновления CAU, который может быть запланирован на то же время, не планируйте изменение паролей для объектов имен кластеров и виртуальных объектов-компьютеров на периоды запланированного обслуживания.

-   Необходимо задать соответствующие разрешения на предварительное \- обновление и выполнить \- скрипты обновления, сохраненные в общих сетевых папках, чтобы предотвратить потенциальное несанкционированные изменения этих файлов неавторизованными пользователями.

-   Чтобы настроить CAU в \- режиме автоматического обновления, необходимо создать объект VCO объекта виртуального компьютера \( \) для кластерной роли Cau в Active Directory. Компонент CAU может создать этот объект автоматически при добавлении кластерной роли CAU, если у отказоустойчивого кластера достаточно разрешений. Однако из-за политик безопасности в некоторых организациях может быть необходимо предварительно подготовить этот объект в Active Directory. Описание этой процедуры см. в разделе [Действия по предварительной настройке учетной записи для кластерной роли](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731002\(v=ws.10\)#steps-for-prestaging-the-cluster-name-account).

-   Чтобы сохранить параметры прогона обновления, а затем использовать их повторно применительно к отказоустойчивым кластерам с аналогичными потребностями в обновлении, можно создать профили прогона обновления. Кроме того, в зависимости от режима обновления можно сохранить профили прогона обновления и управлять ими в общей папке, доступной всем удаленным компьютерам координатора обновлений или отказоустойчивым кластерам. Дополнительные сведения см. в разделе [Дополнительные параметры и обновление профилей выполнения для Cau](cluster-aware-updating-options.md).

## <a name="test-cluster-updating-readiness"></a><a name="BKMK_BPA"></a>Проверка готовности к обновлению кластера
Можно запустить модель CAU анализатор соответствия рекомендациям \( BPA, \) чтобы проверить, удовлетворяет ли отказоустойчивый кластер и сетевая среда многим требованиям, чтобы обновления программного обеспечения были применены с помощью Cau. Многие тесты проверяют окружение на предмет готовности к применению обновлений Майкрософт с помощью подключаемого модуля по умолчанию \- **Microsoft. виндовсупдатеплугин**.

> [!NOTE]
> Может потребоваться независимое подтверждение того, что среда кластера готова к применению обновлений программного обеспечения с помощью подключаемого модуля, отличного \- от **Microsoft. виндовсупдатеплугин**. Если вы используете \- подключаемый модуль, отличный от Microsoft \- , например, предоставленный производителем оборудования, обратитесь к издателю за дополнительными сведениями.

Анализатор соответствия рекомендациям можно запустить двумя способами.

1.  В консоли CAU выберите **Проанализировать готовность кластера к обновлению**. После того как анализатор соответствия рекомендациям завершит тесты готовности, отобразится тестовый отчет. В нем можно просмотреть информацию о выявленных неполадках и соответствующих узлах, чтобы принять меры по устранению этих неполадок. Выполнение тестов может занять несколько минут.

2.  Выполните командлет [Test-CauSetup](https://docs.microsoft.com/powershell/module/clusterawareupdating/Test-CauSetup) . Командлет можно запустить на локальном или удаленном компьютере, на котором установлен модуль отказоустойчивого кластера для Windows PowerShell (часть средств отказоустойчивой кластеризации). Его также можно выполнить в узле отказоустойчивого кластера.

> [!NOTE]
> -   Необходимо использовать учетную запись с правами администратора на узлах кластера и права локального администратора на компьютере, который используется для запуска командлета **Test \- каусетуп** или для анализа готовности к обновлению кластера с помощью окна "кластерное обновление". Для выполнения тестов с помощью окна "кластерное обновление" необходимо войти в систему на компьютере с необходимыми учетными данными.
> -   При проведении тестов предполагается, что средства CAU, используемые для просмотра и применения обновлений ПО, запускаются с того же компьютера и с теми же учетными данными, которые используются для проверки готовности к обновлению кластера.

> [!IMPORTANT]
> Настоятельно рекомендуем проверить кластер на готовность к обновлению в следующих ситуациях:
>
> -   перед первым использованием кластерного обновления для применения обновлений ПО;
> -   после добавления узла в кластер или внесения других изменений в оборудование кластера, требующих запуска мастера проверки кластера;
> -   После изменения источника обновления или изменения параметров обновления или конфигураций, отличных \( от Cau \) , которые могут повлиять на применение обновлений на узлах.

### <a name="tests-for-cluster-updating-readiness"></a>Тесты готовности к обновлению кластера
В таблице ниже перечислены тесты готовности к обновлению кластера, некоторые распространенные проблемы и действия по их устранению.


|                                                      Тест                                                      |                                                                                                                                               Возможные проблемы и их последствия                                                                                                                                               |                                                                                                                                                                                         Способы устранения                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                     Должен быть доступен отказоустойчивый кластер                                     |                                                                                       Не удается разрешить имя отказоустойчивого кластера, либо невозможно получить доступ к одному или нескольким узлам кластера. Анализатор соответствия рекомендациям не может выполнить тесты готовности кластера.                                                                                        |                                                                   — Проверьте правильность написания имени кластера, указанного во время выполнения BPA.<br />— Убедитесь, что все узлы кластера находятся в сети и работают.<br />— Убедитесь, что мастер проверки конфигурации может успешно работать в отказоустойчивом кластере.                                                                    |
|                    На узлах отказоустойчивого кластера должно быть включено удаленное управление через WMI                    |                                                Один или несколько узлов отказоустойчивого кластера не включены для удаленного управления с помощью инструментарий управления Windows (WMI) \( WMI \) . Компонент CAU не может обновить узлы кластера, если для них не настроено удаленное управление.                                                 |                                                                                                  Убедитесь в том, что для узлов отказоустойчивого кластера включено удаленное управление через WMI. Подробнее см. в подразделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) этого раздела.                                                                                                   |
|                      Удаленное взаимодействие PowerShell должно быть включено на каждом узле отказоустойчивого кластера.                       |                                                           PowerShell не установлен или не включен для удаленного взаимодействия на одном или нескольких узлах отказоустойчивого кластера. Невозможно настроить CAU для \- режима самообновления или использовать определенные функции в удаленном \- режиме обновления.                                                            |                                                                                             Убедитесь, что PowerShell установлен на всех узлах кластера и включен для удаленного взаимодействия.<p>Подробнее см. в подразделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) этого раздела.                                                                                             |
|                                            Версия отказоустойчивого кластера                                            |                                                                            Один или несколько узлов отказоустойчивого кластера не работают под управлением Windows Server 2016, Windows Server 2012 R2 или Windows Server 2012. Компонент CAU не может обновить отказоустойчивый кластер.                                                                             |                                                                   Убедитесь, что отказоустойчивый кластер, указанный во время выполнения BPA, работает под управлением Windows Server 2016, Windows Server 2012 R2 или Windows Server 2012.<p>Подробнее см. в подразделе [Проверка конфигурации кластера](#BKMK_REQ_CLUS) этого раздела.                                                                   |
| На всех узлах отказоустойчивого кластера должны быть установлены требуемые версии .NET Framework и Windows PowerShell |                                                                                              .NET Framework 4,6, 4,5 или Windows PowerShell не установлены на одном или нескольких узлах кластера. Некоторые функции CAU могут не работать.                                                                                              |                                                                            Убедитесь, что .NET Framework 4,6 или 4,5 и Windows PowerShell установлены на всех узлах кластера, если они необходимы.<p>Подробнее см. в подразделе [Настройка узлов для удаленного управления](#BKMK_NODE_CONFIG) этого раздела.                                                                             |
|                           Служба кластеров должна работать на всех узлах кластера                           |                                                                                                            Служба кластеров не работает на одном или нескольких узлах. Компонент CAU не может обновить отказоустойчивый кластер.                                                                                                             |                        — Убедитесь, что служба кластеров \( ClusSvc \) запущен на всех узлах в кластере и настроен на автоматический запуск.<br />— Убедитесь, что мастер проверки конфигурации может успешно работать в отказоустойчивом кластере.<p>Подробнее см. в подразделе [Проверка конфигурации кластера](#BKMK_REQ_CLUS) этого раздела.                         |
|     Службу автоматического обновления не следует настраивать для автоматической установки обновлений на узлы отказоустойчивого кластера     |                                           По крайней мере на одном узле отказоустойчивого кластера служба автоматического обновления настроена на автоматическую установку обновлений Майкрософт. Использование CAU в сочетании с другими способами обновления может привести к незапланированным простоям или непредвиденным результатам.                                            |                                                     Если на одном или нескольких кластерах настроено автоматическое обновление с помощью Центра обновления Windows, убедитесь в том, что служба автоматического обновления не настроена на автоматическую установку обновлений.<p>Подробнее см. в подразделе [Рекомендации по применению обновлений Майкрософт](#BKMK_BP_WUA).                                                     |
|                          Узлы отказоустойчивого кластера должны использовать один и тот же источник обновления                          |                                                    Для одного или нескольких узлов отказоустойчивого кластера настроено использование источника обновлений Майкрософт, отличного то указанного для остальных узлов. Компонент CAU не может обеспечить единообразное применение обновлений к узлам кластера.                                                    |                                                                        Убедитесь в том, что для всех узлов кластера настроено использование одного и того же источника обновлений, например сервера служб WSUS, Центра обновления Windows или Центра обновления Майкрософт.<p>Подробнее см. в подразделе [Рекомендации по применению обновлений Майкрософт](#BKMK_BP_WUA).                                                                         |
|       На каждом узле отказоустойчивого кластера должно быть включено правило брандмауэра, разрешающее удаленное выключение       |                 На одном или нескольких узлах отказоустойчивого кластера не включено правило брандмауэра, разрешающее удаленное выключение, либо включение этого правила запрещено параметром групповой политики. Прогоны обновления, требующие автоматической перезагрузки узлов, могут быть применены неверно.                  |                                                                    Если \- на узлах кластера используется брандмауэр Windows или брандмауэр, отличный от брандмауэра Майкрософт, настройте правило брандмауэра, разрешающее удаленное завершение работы.<p>Подробнее см. в подразделе [Включение правила брандмауэра для обеспечения автоматического перезапуска](#BKMK_FW) этого раздела.                                                                    |
|          В качестве прокси-сервера на каждом узле отказоустойчивого кластера должен быть задан локальный прокси-сервер          |                             На одном или нескольких узлах отказоустойчивого кластера неправильно настроен прокси-сервер.<p>Если используется локальный прокси-сервер, параметр прокси-сервера на каждом узле должен быть настроен правильно, чтобы кластер мог получать доступ к Центру обновления Майкрософт или Центру обновления Windows.                              |                                            Убедитесь в том, что в качестве прокси-сервера WinHTTP на каждом узле кластера задан локальный прокси-сервер, если он необходим. Если в вашей среде прокси-сервер не используется, это предупреждение можно игнорировать.<p>Подробнее см. в подразделе [Применение обновлений Майкрософт в филиалах](#BKMK_PROXY) этого раздела.                                            |
|        Для включения режима автоматического обновления на отказоустойчивом кластере должна быть установлена кластерная роль CAU. \-        |                                                                                                   Кластерная роль CAU не установлена на этом отказоустойчивом кластере. Эта роль необходима для самостоятельного \- обновления кластера.                                                                                                   |      Чтобы использовать CAU в \- режиме автоматического обновления, добавьте кластерную роль Cau в отказоустойчивый кластер одним из следующих способов:<p>— Выполните командлет PowerShell [Add-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Add-CauClusterRole) .<br />— Выберите действие **Настройка параметров самостоятельного \- обновления кластера** в окне Обновление с поддержкой кластера.      |
|         Для включения режима автоматического обновления на отказоустойчивом кластере должна быть включена кластерная роль CAU. \-         | Кластерная роль CAU отключена. Например, кластерная роль CAU не установлена или отключена с помощью командлета PowerShell [disable \- кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Disable-CauClusterRole) . Эта роль необходима для самостоятельного \- обновления кластера. | Чтобы использовать CAU в \- режиме автоматического обновления, включите кластерную роль Cau в этом отказоустойчивом кластере одним из следующих способов:<p>— Запустите командлет PowerShell [Enable-кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Enable-CauClusterRole) .<br />— Выберите действие **Настройка параметров самостоятельного \- обновления кластера** в окне Обновление с поддержкой кластера. |
|      Настроенный подключаемый модуль CAU \- для \- режима самообновления должен быть зарегистрирован на всех узлах отказоустойчивого кластера      |                                                              Кластерная роль CAU на одном или нескольких узлах этого отказоустойчивого кластера не может получить доступ к \- модулю Cau Plug in, настроенному в \- параметрах автоматического обновления. \-Выполнение самообновления может завершиться ошибкой.                                                              |           — Убедитесь, что настроенный подключаемый модуль CAU \- установлен на всех узлах кластера, следуя процедуре установки продукта, предоставляющего подключаемый модуль Cau \- .<br />— Выполните командлет [Register \- кауплугин](https://docs.microsoft.com/powershell/module/clusterawareupdating/Register-CauPlugin) PowerShell, чтобы зарегистрировать подключаемый модуль \- на требуемых узлах кластера.           |
|                Все узлы отказоустойчивого кластера должны иметь одинаковый набор \- зарегистрированных подключаемых модулей Cau                 |                                                                             \-Выполнение самообновления может завершиться ошибкой, если подключаемый модуль \- , настроенный для использования в прогоне обновления, изменен на другой, недоступный на всех узлах кластера.                                                                              |           — Убедитесь, что настроенный подключаемый модуль CAU \- установлен на всех узлах кластера, следуя процедуре установки продукта, предоставляющего подключаемый модуль Cau \- .<br />— Выполните командлет [Register \- кауплугин](https://docs.microsoft.com/powershell/module/clusterawareupdating/Register-CauPlugin) PowerShell, чтобы зарегистрировать подключаемый модуль \- на требуемых узлах кластера.           |
|                               Должны быть настроены допустимые параметры прогона обновления                                |                                                                          \-Расписание самообновления и параметры прогона обновления, настроенные для этого отказоустойчивого кластера, неполные или являются недопустимыми. \-Выполнение самообновления может завершиться ошибкой.                                                                           |                                                            Настройте допустимое \- расписание автоматического обновления и набор параметров прогона обновления. Например, командлет [Set \- кауклустерроле](https://docs.microsoft.com/powershell/module/clusterawareupdating/Set-CauClusterRole) PowerShell можно использовать для настройки кластерной роли Cau.                                                            |
|                  По крайней мере два узла отказоустойчивого кластера должны быть владельцами кластерной роли CAU                  |                                                                                        Прогон обновления, запущенный в \- режиме самообновления, завершится ошибкой, так как у кластерной роли Cau нет возможных узлов-владельцев для перемещения.                                                                                         |                                                                                                                С помощью средств отказоустойчивости кластеров настройте все узлы кластера в качестве потенциальных владельцев кластерной роли CAU. Это конфигурация по умолчанию.                                                                                                                |
|                  Все узлы отказоустойчивого кластера должны иметь доступ к сценариям Windows PowerShell                  |                                                                        Не все возможные узлы, являющиеся владельцами кластерной роли CAU, могут получить доступ к настроенным \- сценариям предварительного обновления Windows PowerShell и \- скриптов после обновления. \-Выполнение самообновления завершится ошибкой.                                                                        |                                                                                                                    Убедитесь, что все возможные узлы, являющиеся владельцами кластерной роли CAU, имеют разрешения на доступ к настроенным \- сценариям предварительного обновления и после обновления PowerShell \- .                                                                                                                     |
|                   На всех узлах отказоустойчивого кластера должны использоваться идентичные сценарии Windows PowerShell                   |                                                     Не все возможные узлы, являющиеся владельцами кластерной роли CAU, используют одну и ту же копию указанных ранее сценариев Windows PowerShell \- и \- скриптов после обновления. \-Выполнение самообновления может завершиться ошибкой или отобразить непредвиденное поведение.                                                     |                                                                                                                                   Убедитесь, что все возможные узлы, являющиеся владельцами кластерной роли CAU, используют то же самое \- Обновление PowerShell и \- скрипты после обновления.                                                                                                                                   |
|         Значение параметра WarnAfter, заданное для прогона обновления, должно быть меньше значения параметра StopAfter         |                                                                           Указанные значения времени ожидания прогона обновления CAU делают время ожидания предупреждения недействительным. Прогон обновления может быть отменен до регистрации предупреждения в журнале событий.                                                                            |                                                                                                                                      В параметрах прогона обновления задайте значение параметра **WarnAfter** так, чтобы оно было меньше значения параметра **StopAfter**.                                                                                                                                       |

## <a name="additional-references"></a>Дополнительные ссылки

-   [Общие сведения о кластерном обновлении](cluster-aware-updating.md)