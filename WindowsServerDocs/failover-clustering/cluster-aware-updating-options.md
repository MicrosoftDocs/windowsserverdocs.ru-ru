---
ms.assetid: 2f4b6641-0ec2-4b1c-85fb-a1f1d16685c8
title: Расширенные параметры и обновление профилей выполнения с поддержкой кластера
ms.topic: article
ms.prod: windows-server
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 08/06/2018
description: Настройка дополнительных параметров и обновление профилей выполнения для обновления с поддержкой кластера (CAU)
ms.openlocfilehash: 500eb4d9affe38fe5f22f3720893b7960190948e
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71361310"
---
# <a name="cluster-aware-updating-advanced-options-and-updating-run-profiles"></a>Расширенные параметры и обновление профилей выполнения с поддержкой кластера

>Относится к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012.

В этом разделе описывается обновление параметров выполнения, которые можно настроить для прогона обновления с [поддержкой кластера](cluster-aware-updating.md) (Cau). Эти дополнительные параметры можно настроить при использовании пользовательского интерфейса CAU или командлетов Windows PowerShell для установки обновлений или для настройки параметров самостоятельного обновления.

Большинство параметров конфигурации можно сохранить в XML-файле, который называется профилем прогона обновления, и использовать для следующих прогонов. Значения по умолчанию, заданные CAU для параметров прогона обновления, также можно использовать во множестве кластерных сред.

Сведения о дополнительных параметрах, которые можно задавать для каждого прогона обновления, и о профилях прогона обновления см. далее в следующих разделах.

Параметры, указываемые при запросе прогона обновления использовать параметры обновления профилей выполнения, которые можно задать в профиле прогона обновления

В следующей таблице перечислены параметры, которые можно настроить в профиле прогона обновления CAU. 

> [!NOTE] 
> Чтобы установить параметр Преупдатескрипт или Поступдатескрипт, убедитесь, что установлены Windows PowerShell и .NET Framework 4,6 или 4,5 и что удаленное взаимодействие PowerShell включено на каждом узле в кластере. Дополнительные сведения см. в статьях Настройка узлов для удаленного управления в [требованиях и рекомендации по обновлению с поддержкой кластера](cluster-aware-updating-requirements.md).


|Параметр|Значение по умолчанию|Подробности|  
|------------|-------------------|-------------|  
|**стопафтер**|Неограниченное время|Время (в минутах), по истечении которого незавершенный прогон обновления будет остановлен. **Примечание.**  При указании сценария PowerShell, выполняемого перед обновлением или после обновления, весь процесс выполнения скриптов и выполнения обновлений должен быть завершен в пределах **стопафтер** времени.|  
|**варнафтер**|По умолчанию предупреждение не выводится|Время (в минутах), по истечении которого появится предупреждение, если выполнение обновления (включая сценарии, выполняемые перед обновлением и после него, если они настроены) не было завершено.|  
|**максретриесперноде**|3|Максимальное число попыток обновления на один узел (включая сценарии, выполняемые перед обновлением и после него, если они настроены). Максимальное значение равно 64.|  
|**максфаиледнодес**|Для большинства кластеров — целое число, примерно равное трети от количества узлов кластера|Максимальное количество узлов, на которых обновление может завершиться ошибкой из-за отказа узла или остановки службы кластеров. Если данное число превышено, то прогон обновления останавливается.<br /><br /> Диапазон допустимых значений: от 0 до числа узлов кластеров, уменьшенного на 1.|  
|**рекуиреаллнодесонлине**|Нет|Указывает, что все узлы должны находиться в сети и быть достижимыми перед началом обновления.|  
|**ребуттимеаутминутес**|15|Время (в минутах), отводимое CAU на перезагрузку узла (если она необходима) и запуск всех служб автоматического запуска. Если процесс перезапуска не завершается в течение этого времени, прогон обновления на этом узле помечается как неудачный.|  
|**преупдатескрипт**|Нет|Путь и имя файла для сценария PowerShell, выполняемого на каждом узле перед началом обновления, и до перевода узла в режим обслуживания. Расширение имени файла должно быть **PS1**, а общая длина пути и имени файла не должна превышать 260 символов. Чтобы сценарий был всегда доступен для всех узлов кластера, рекомендуется размещать его на диске в системе хранения данных кластера или в сетевой папке высокой доступности. Если сценарий находится в сетевой папке, убедитесь, что группа "Все" имеет для нее разрешение "Чтение", и запретите доступ к папке, чтобы исключить несанкционированное изменение файлов.<br /><br /> При указании сценария, выполняемого перед обновлением, убедитесь, что настройка таких параметров, как ограничения по времени (например, параметр **StopAfter**), обеспечивает успешное выполнение сценария. Эти ограничения задают временной интервал для всего процесса выполнения сценариев и установки обновлений.|  
|**поступдатескрипт**|Нет|Путь и имя файла для скрипта PowerShell, выполняемого после обновления (после выхода узла из режима обслуживания). Расширение имени файла должно быть **PS1** , а общая длина пути и имени файла не должна превышать 260 символов. Чтобы сценарий был всегда доступен для всех узлов кластера, рекомендуется размещать его на диске в системе хранения данных кластера или в сетевой папке высокой доступности. Если сценарий находится в сетевой папке, убедитесь, что группа "Все" имеет для нее разрешение "Чтение", и запретите доступ к папке, чтобы исключить несанкционированное изменение файлов.<br /><br /> При указании сценария, выполняемого после обновления, убедитесь, что настройка таких параметров, как ограничения по времени (например, параметр **StopAfter**), обеспечивает успешное выполнение сценария. Эти ограничения задают временной интервал для всего процесса выполнения сценариев и установки обновлений.|  
|**Указав**|Данный параметр действует только при выполнении сценариев.<br /><br /> Если указан скрипт, выполняемый перед обновлением или после него, но не задано **configurationName**, используется конфигурация сеанса по умолчанию для PowerShell (Microsoft. PowerShell).|Указывает конфигурацию сеанса PowerShell, определяющую сеанс, в котором выполняются скрипты (заданные **преупдатескрипт** и **поступдатескрипт**), и может ограничивать количество команд, которые могут быть выполнены.|  
|**кауплугиннаме**|**Microsoft. Виндовсупдатеплугин**|Подключаемый модуль, который используется кластерным обновлением для просмотра обновлений или выполнения прогона обновления. Дополнительные сведения см. в статье [как работают подключаемые модули обновления с поддержкой кластера](cluster-aware-updating-plug-ins.md).|  
|**кауплугинаргументс**|Нет|Набор пар *имя=значение* (аргументов), которые используются подключаемым модулем обновления, например:<br /><br /> **Домен = домен. локальный**<br /><br /> Такие пары *имя=значение* должны распознаваться подключаемым модулем, заданным в параметре **CauPluginName**.<br /><br /> Чтобы задать аргумент в пользовательском интерфейсе CAU, введите *имя*, нажмите клавишу TAB, а затем введите соответствующее *значение*. Чтобы задать следующий аргумент, снова нажмите клавишу TAB. Каждое *имя* и *значение* автоматически отделяются друг от друга знаком равенства (=). Пары автоматически отделяются друг от друга точкой с запятой.<br /><br /> Для подключаемого модуля **Microsoft. виндовсупдатеплугин** по умолчанию аргументы не требуются. При этом можно задать необязательный аргумент, например чтобы указать стандартную строку запроса для агента Центра обновления Windows, фильтрующую набор обновлений, которые применяются подключаемым модулем. Для *имени*используйте **строку запроса**, а для *значения*заключите полный запрос в кавычки.<br /><br /> Дополнительные сведения см. в статье [как работают подключаемые модули обновления с поддержкой кластера](cluster-aware-updating-plug-ins.md).|  
  
##  <a name="BKMK_runtime"></a>Параметры, указываемые при запросе прогона обновления  
 В следующей таблице перечислены параметры (отличные от параметров в профиле прогона обновления), которые указываются при запросе прогона обновления. Сведения о параметрах, задаваемых в профиле прогона обновления, см. в предыдущей таблице.  
  
|Параметр|Значение по умолчанию|Подробности|  
|------------|-------------------|-------------|  
|**Имя_кластера**|Нет <br>**Примечание.**  Этот параметр необходимо задавать, только если пользовательский интерфейс CAU не запущен на узле отказоустойчивого кластера или если нужно сослаться на отказоустойчивый кластер, отличный от того, на котором запущен пользовательский интерфейс CAU.|NetBIOS-имя кластера, на котором следует выполнить прогон обновления.|  
|**Записям**|Учетные данные текущей учетной записи|Учетные данные администратора для целевого кластера, на котором будет выполнен прогон обновления. Возможно, у вас уже есть необходимые учетные данные, если запустить пользовательский интерфейс CAU (или открыть сеанс PowerShell, если вы используете командлеты PowerShell CAU) из учетной записи, обладающей правами администратора и разрешениями в кластере.|  
|**нодеордер**|По умолчанию CAU начинает работу с узла с наименьшим количеством кластерных ролей, а затем переходит на следующие узлы в порядке возрастания числа кластерных ролей.|Имена узлов кластера в том порядке, в каком их следует обновить (если возможно).|  
  
##  <a name="BKMK_profile"></a>Использовать обновление профилей выполнения  
 Каждый прогон обновления можно связать с особым профилем прогона обновления. Профиль прогона обновления по умолчанию хранится в папке *%виндир%\клустер* Если вы используете пользовательский интерфейс CAU в режиме удаленного обновления, можно указать профиль прогона обновления во время применения обновлений или использовать профиль прогона обновления по умолчанию. Если вы используете CAU в режиме самообновления, можно импортировать параметры из указанного профиля прогона обновления при настройке параметров самостоятельного обновления. В обоих случаях можно переопределить значения, отображаемые для параметров прогона обновления, в соответствии с актуальными потребностями. Параметры прогона обновления можно сохранить в виде профиля прогона обновления с тем же или с другим именем файла. В следующий раз при применении обновлений или настройке параметров самообновления CAU автоматически выберет ранее выбранный профиль прогона обновления.  
  
 Можно изменить существующий профиль прогона обновления или создать новый, выбрав **создать или изменить профиль прогона обновления** в пользовательском интерфейсе Cau.

Ниже приведены некоторые важные замечания об использовании обновления профилей выполнения.

* В профиле прогона обновления не хранятся сведения, относящиеся к конкретному кластеру, например учетные данные администратора. Если вы используете CAU в режиме самообновления, то профиль прогона обновления также не хранит сведения о расписании автоматического обновления. Это позволяет использовать один профиль прогона обновления во всех отказоустойчивых кластерах определенного класса.
* Если настроить параметры самостоятельного обновления с помощью профиля прогона обновления и позже изменить профиль с разными значениями параметров прогона обновления, автоматическая конфигурация не изменится автоматически. Чтобы применить новые параметры прогона обновления, необходимо снова настроить параметры самообновления.
* Редактор профилей выполнения, к сожалению, не поддерживает пути к файлам, содержащие пробелы, например *C:\Program Files*. В качестве обходного решения Храните скрипты до и после обновления в пути, который не содержит пробелов, или используйте только PowerShell для управления профилями выполнения, замещая кавычки по пути при выполнении **командлета Invoke-каурун**.

### <a name="windows-powershell-equivalent-commands"></a>Эквивалентные команды Windows PowerShell
  
 Вы можете импортировать параметры из профиля прогона обновления при выполнении командлета **Invoke-каурун**, **Add-кауклустерроле**или **Set-кауклустерроле** .  
  
 В следующем примере выполняется проверка и полный прогон обновления в кластере с именем *CONTOSO-FC1* с использованием параметров прогона обновления, заданных в файле *C:\Windows\Cluster\DefaultParameters.xml*. Для остальных параметров командлета используются значения по умолчанию.  
  
```powershell  
$MyRunProfile = Import-Clixml C:\Windows\Cluster\DefaultParameters.xml  
Invoke-CauRun –ClusterName CONTOSO-FC1 @MyRunProfile   
```  
  
 С помощью профиля прогона обновления можно повторять операции обновления отказоустойчивого кластера с одинаковыми параметрами для обработки исключений, ограничений по времени и других рабочих показателей. Поскольку такие параметры обычно связаны с некоторым классом отказоустойчивых кластеров, например "Все кластеры Microsoft SQL Server" или "Важнейшие кластеры организации", можно задать для каждого профиля прогона обновления имя, соответствующее классу отказоустойчивых кластеров, с которым он будет использоваться. Кроме того, можно организовать профиль прогона обновления для сетевой папки, которая доступна всем отказоустойчивым кластерам определенного класса в ИТ-организации.  
  
  
  
## <a name="see-also"></a>См. также

-   [Кластерное обновление](cluster-aware-updating.md)
  
-   [Командлеты обновления с поддержкой кластера в Windows PowerShell](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps)