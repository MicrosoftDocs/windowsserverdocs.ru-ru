---
ms.assetid: 2f4b6641-0ec2-4b1c-85fb-a1f1d16685c8
title: Расширенные параметры и обновление профилей выполнения с поддержкой кластера
description: Настройка дополнительных параметров и обновление профилей выполнения для обновления с поддержкой кластера (CAU)
ms.topic: article
ms.prod: windows-server
manager: lizross
ms.author: jgerend
author: JasonGerend
ms.date: 08/06/2018
ms.openlocfilehash: b6a5b51b0942685334c79d9523fffa5ba4eabc5f
ms.sourcegitcommit: ab64dc83fca28039416c26226815502d0193500c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2020
ms.locfileid: "82720602"
---
# <a name="cluster-aware-updating-advanced-options-and-updating-run-profiles"></a>Расширенные параметры и обновление профилей выполнения с поддержкой кластера

> Область применения: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012.

В этом разделе описывается обновление параметров выполнения, которые можно настроить для прогона обновления с [поддержкой кластера](cluster-aware-updating.md) (Cau). Эти дополнительные параметры можно настроить при использовании пользовательского интерфейса CAU или командлетов Windows PowerShell для установки обновлений или для настройки параметров самостоятельного обновления.

Большинство параметров конфигурации можно сохранить в XML-файле, который называется профилем прогона обновления, и использовать для следующих прогонов. Значения по умолчанию, заданные CAU для параметров прогона обновления, также можно использовать во множестве кластерных сред.

Сведения о дополнительных параметрах, которые можно задавать для каждого прогона обновления, и о профилях прогона обновления см. далее в следующих разделах.

Параметры, указываемые при запросе прогона обновления использовать параметры обновления профилей выполнения, которые можно задать в профиле прогона обновления

В следующей таблице перечислены параметры, которые можно настроить в профиле прогона обновления CAU. 

> [!NOTE] 
> Чтобы установить параметр Преупдатескрипт или Поступдатескрипт, убедитесь, что установлены Windows PowerShell и .NET Framework 4,6 или 4,5 и что удаленное взаимодействие PowerShell включено на каждом узле в кластере. Дополнительные сведения см. в статьях Настройка узлов для удаленного управления в [требованиях и рекомендации по обновлению с поддержкой кластера](cluster-aware-updating-requirements.md).


|Параметр|Значение по умолчанию|Подробнее|  
|------------|-------------------|-------------|  
|**StopAfter**|Неограниченное время|Время (в минутах), по истечении которого незавершенное выполнение обновления будет остановлено. **Примечание.**  При указании сценария PowerShell, выполняемого перед обновлением или после обновления, весь процесс выполнения скриптов и выполнения обновлений должен быть завершен в пределах **стопафтер** времени.|  
|**WarnAfter**|По умолчанию предупреждение не выводится|Время (в минутах), по истечении которого появится предупреждение, если выполнение обновления (включая сценарии pre-update и post-update, если они настроены) не было завершено.|  
|**MaxRetriesPerNode**|3|Максимальное число попыток обновлений на один узел (включая сценарии pre-update и post-update, если они настроены). Максимальное значение равно 64.|  
|**MaxFailedNodes**|Для большинства кластеров — целое число, примерно равное трети от количества узлов кластера|Максимальное количество узлов, на которых обновление может завершиться ошибкой из-за отказа узла или остановки службы кластеров. Если данное число превышено, выполнение обновления прекращается.<p>Диапазон допустимых значений: от 0 до числа узлов кластеров, уменьшенного на 1.|  
|**RequireAllNodesOnline**|None|Указывает, что все узлы должны находиться в сети и быть достижимыми перед началом обновления.|  
|**RebootTimeoutMinutes**|15|Время (в минутах), отводимое CAU на перезагрузку узла (если она необходима) и запуск всех служб автоматического запуска. Если процесс перезапуска не завершается в течение этого времени, прогон обновления на этом узле помечается как неудачный.|  
|**PreUpdateScript**|None|Путь и имя файла для сценария PowerShell, выполняемого на каждом узле перед началом обновления, и до перевода узла в режим обслуживания. Расширение имени файла должно быть **PS1**, а общая длина пути и имени файла не должна превышать 260 символов. Чтобы сценарий был всегда доступен для всех узлов кластера, рекомендуется размещать его на диске в системе хранения данных кластера или в сетевой папке высокой доступности. Если сценарий находится в сетевой папке, убедитесь, что группа "Все" имеет для нее разрешение "Чтение", и запретите доступ к папке, чтобы исключить несанкционированное изменение файлов.<p> При указании сценария pre-update убедитесь, что настройка такие параметров, как ограничения по времени (например, параметр **StopAfter**), обеспечивает успешное выполнение сценария. Эти ограничения задают временной интервал для всего процесса выполнения сценариев и установки обновлений.|  
|**PostUpdateScript**|None|Путь и имя файла для скрипта PowerShell, выполняемого после обновления (после выхода узла из режима обслуживания). Расширение имени файла должно быть **PS1** , а общая длина пути и имени файла не должна превышать 260 символов. Чтобы сценарий был всегда доступен для всех узлов кластера, рекомендуется размещать его на диске в системе хранения данных кластера или в сетевой папке высокой доступности. Если сценарий находится в сетевой папке, убедитесь, что группа "Все" имеет для нее разрешение "Чтение", и запретите доступ к папке, чтобы исключить несанкционированное изменение файлов.<p> При указании сценария post-update убедитесь, что настройка таких параметров, как ограничения по времени (например, параметр **StopAfter**), обеспечивает успешное выполнение сценария. Эти ограничения задают временной интервал для всего процесса выполнения сценариев и установки обновлений.|  
|**ConfigurationName**|Данный параметр действует только при выполнении сценариев.<p> Если указан скрипт, выполняемый перед обновлением или после него, но не задано **configurationName**, используется конфигурация сеанса по умолчанию для PowerShell (Microsoft. PowerShell).|Указывает конфигурацию сеанса PowerShell, определяющую сеанс, в котором выполняются скрипты (заданные **преупдатескрипт** и **поступдатескрипт**), и может ограничивать количество команд, которые могут быть выполнены.|  
|**CauPluginName**|**Microsoft.WindowsUpdatePlugin**|Данный параметр задает имя подключаемого модуля для просмотра или выполнения обновления, на использование которого настраивается обновление с поддержкой кластера. Дополнительные сведения см. в статье [как работают подключаемые модули обновления с поддержкой кластера](cluster-aware-updating-plug-ins.md).|  
|**CauPluginArguments**|None|Набор пар (аргументов) *имя=значение* для используемого подключаемого модуля обновления, например:<p>**Домен = домен. локальный**<p>Эти пары *имя=значение* должен понимать подключаемый модуль, который задан параметром **CauPluginName**.<p>Чтобы задать аргумент в пользовательском интерфейсе CAU, введите *имя*, нажмите клавишу TAB, а затем введите соответствующее *значение*. Чтобы задать следующий аргумент, снова нажмите клавишу TAB. Каждое *имя* и *значение* автоматически отделяются друг от друга знаком равенства (=). Пары автоматически отделяются друг от друга точкой с запятой.<p>Для подключаемого модуля **Microsoft. виндовсупдатеплугин** по умолчанию аргументы не требуются. При этом можно задать необязательный аргумент, например чтобы указать стандартную строку запроса для агента Центра обновления Windows, фильтрующую набор обновлений, которые применяются подключаемым модулем. Для *имени*используйте **строку запроса**, а для *значения*заключите полный запрос в кавычки.<p> Дополнительные сведения см. в статье [как работают подключаемые модули обновления с поддержкой кластера](cluster-aware-updating-plug-ins.md).|  
  
##  <a name="options-that-you-specify-when-you-request-an-updating-run"></a><a name="BKMK_runtime"></a>Параметры, указываемые при запросе прогона обновления  
 В следующей таблице перечислены параметры (отличные от параметров профиля выполнения обновления), которые указываются при запросе на выполнение обновления. Сведения о параметрах, задаваемых в профиле прогона обновления, см. в предыдущей таблице.  
  
|Параметр|Значение по умолчанию|Подробнее|  
|------------|-------------------|-------------|  
|**ClusterName**|None <br>**Примечание.**  Этот параметр должен быть задан только в том случае, если пользовательский интерфейс CAU не выполняется на узле отказоустойчивого кластера или требуется ссылка на отказоустойчивый кластер, отличный от того, где выполняется пользовательский интерфейс CAU.|NetBIOS-имя кластера, на котором следует выполнить прогон обновления.|  
|**Записям**|Учетные данные текущей учетной записи|Учетные записи администратора для целевого кластера, на котором будет выполнено обновление. Возможно, у вас уже есть необходимые учетные данные, если запустить пользовательский интерфейс CAU (или открыть сеанс PowerShell, если вы используете командлеты PowerShell CAU) из учетной записи, обладающей правами администратора и разрешениями в кластере.|  
|**NodeOrder**|По умолчанию CAU начинает работу с узла с наименьшим количеством кластерных ролей, а затем переходит на следующие узлы в порядке возрастания числа кластерных ролей.|Данный параметр задает узлы кластера в том порядке, в каком их следует обновить (если возможно).|  
  
##  <a name="use-updating-run-profiles"></a><a name="BKMK_profile"></a>Использовать обновление профилей выполнения  
 Каждый прогон обновления можно связать с особым профилем прогона обновления. Профиль прогона обновления по умолчанию хранится в папке *%виндир%\клустер* Если вы используете пользовательский интерфейс CAU в режиме удаленного обновления, можно указать профиль прогона обновления во время применения обновлений или использовать профиль прогона обновления по умолчанию. Если вы используете CAU в режиме самообновления, можно импортировать параметры из указанного профиля прогона обновления при настройке параметров самостоятельного обновления. В обоих случаях можно переопределить значения, отображаемые для параметров прогона обновления, в соответствии с актуальными потребностями. Параметры прогона обновления можно сохранить в виде профиля прогона обновления с тем же или с другим именем файла. В следующий раз при применении обновлений или настройке параметров самообновления CAU автоматически выберет ранее выбранный профиль прогона обновления.  
  
 Можно изменить существующий профиль прогона обновления или создать новый, выбрав **создать или изменить профиль прогона обновления** в пользовательском интерфейсе Cau.

Ниже приведены некоторые важные замечания об использовании обновления профилей выполнения.

* В профиле прогона обновления не хранятся сведения, относящиеся к конкретному кластеру, например учетные данные администратора. Если вы используете CAU в режиме самообновления, то профиль прогона обновления также не хранит сведения о расписании автоматического обновления. Это позволяет использовать один профиль прогона обновления во всех отказоустойчивых кластерах определенного класса.
* Если настроить параметры самостоятельного обновления с помощью профиля прогона обновления и позже изменить профиль с разными значениями параметров прогона обновления, автоматическая конфигурация не изменится автоматически. Чтобы применить новые параметры прогона обновления, необходимо снова настроить параметры самообновления.
* Редактор профилей выполнения, к сожалению, не поддерживает пути к файлам, содержащие пробелы, например *C:\Program Files*. В качестве обходного решения Храните скрипты до и после обновления в пути, который не содержит пробелов, или используйте только PowerShell для управления профилями выполнения, замещая кавычки по пути при выполнении **командлета Invoke-каурун**.

### <a name="windows-powershell-equivalent-commands"></a>Эквивалентные команды Windows PowerShell
  
 Вы можете импортировать параметры из профиля прогона обновления при выполнении командлета **Invoke-каурун**, **Add-кауклустерроле**или **Set-кауклустерроле** .  
  
 В следующем примере выполняется проверка и полный прогон обновления в кластере с именем *CONTOSO-FC1* с использованием параметров прогона обновления, заданных в файле *C:\Windows\Cluster\DefaultParameters.xml*. Для остальных параметров командлета используются значения по умолчанию.  
  
```powershell  
$MyRunProfile = Import-Clixml C:\Windows\Cluster\DefaultParameters.xml  
Invoke-CauRun –ClusterName CONTOSO-FC1 @MyRunProfile   
```  
  
 С помощью профиля прогона обновления можно повторять операции обновления отказоустойчивого кластера с одинаковыми параметрами для обработки исключений, ограничений по времени и других рабочих показателей. Так как эти параметры обычно относятся к классу отказоустойчивых кластеров (например, "все Microsoft SQL Server кластеры" или "Мои критически важные кластеры"), может потребоваться присвоить каждому профилю прогона обновления имя класса отказоустойчивых кластеров, с которым он будет использоваться. Кроме того, можно организовать профиль прогона обновления для сетевой папки, которая доступна всем отказоустойчивым кластерам определенного класса в ИТ-организации.  
  
  
  
## <a name="see-also"></a>См. также

-   [Кластерное обновление](cluster-aware-updating.md)
  
-   [Командлеты кластерного обновления в Windows PowerShell](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps)