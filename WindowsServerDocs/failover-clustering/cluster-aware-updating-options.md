---
ms.assetid: 2f4b6641-0ec2-4b1c-85fb-a1f1d16685c8
title: Дополнительные параметры и профили прогона обновления кластерного обновления
ms.topic: article
ms.prod: windows-server-threshold
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 08/06/2018
description: Как настроить дополнительные параметры и профили прогона обновления для кластерного обновления (CAU)
ms.openlocfilehash: 5fac31ad35422e623b98caaabdd9eae183e2e5d8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59830555"
---
# <a name="cluster-aware-updating-advanced-options-and-updating-run-profiles"></a>Дополнительные параметры и профили прогона обновления кластерного обновления

>Относится к: Windows Server (полугодовой канал), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описано, как выполнение обновления, которые могут быть настроены для [кластерное обновление](cluster-aware-updating.md) прогона (обновления CAU). Можно настроить эти дополнительные параметры, при использовании пользовательского интерфейса CAU или командлетов CAU Windows PowerShell для применения обновлений или настройки параметров самообновления.

Большинство параметров конфигурации можно сохранить в XML-файле, который называется профилем прогона обновления, и использовать для следующих прогонов. Значения по умолчанию, заданные CAU для параметров прогона обновления, также можно использовать во множестве кластерных сред.

Сведения о дополнительных параметрах, которые можно задавать для каждого прогона обновления, и о профилях прогона обновления см. далее в следующих разделах.

Параметры, указываемые при запросе обновления запустите используйте параметры выполнения обновления профилей, можно задать в профиле выполнения обновления

В следующей таблице перечислены параметры, которые можно настроить в профиле прогона обновления CAU. 

> [!NOTE] 
> Для задания параметра PreUpdateScript или PostUpdateScript, убедитесь, что установлены Windows PowerShell и .NET Framework 4.6 и 4.5 и что удаленное взаимодействие PowerShell включено на каждом узле в кластере. Дополнительные сведения см. в разделе Настройка узлов для удаленного управления в [требованиях и рекомендациях для кластерного обновления](cluster-aware-updating-requirements.md).


|Параметр|Значение по умолчанию|Подробности|  
|------------|-------------------|-------------|  
|**StopAfter**|Неограниченное время|Время (в минутах), по истечении которого незавершенный прогон обновления будет остановлен. **Примечание.**  Если указать перед обновлением или после обновления сценария PowerShell, весь процесс запуска сценариев и выполнения обновлений должен быть завершен в **StopAfter** предельное время.|  
|**WarnAfter**|По умолчанию предупреждение не выводится|Время (в минутах), по истечении которого появится предупреждение, если выполнение обновления (включая сценарии, выполняемые перед обновлением и после него, если они настроены) не было завершено.|  
|**MaxRetriesPerNode**|3|Максимальное число попыток обновления на один узел (включая сценарии, выполняемые перед обновлением и после него, если они настроены). Максимальное значение равно 64.|  
|**MaxFailedNodes**|Для большинства кластеров — целое число, примерно равное трети от количества узлов кластера|Максимальное количество узлов, на которых обновление может завершиться ошибкой из-за отказа узла или остановки службы кластеров. Если данное число превышено, то прогон обновления останавливается.<br /><br /> Диапазон допустимых значений: от 0 до числа узлов кластеров, уменьшенного на 1.|  
|**RequireAllNodesOnline**|Нет|Указывает, что все узлы должны находиться в сети и быть достижимыми перед началом обновления.|  
|**RebootTimeoutMinutes**|15|Время (в минутах), отводимое CAU на перезагрузку узла (если она необходима) и запуск всех служб автоматического запуска. Если процесс перезагрузки не завершается в течение этого времени, выполнение обновления на этом узле помечается как не удалось.|  
|**PreUpdateScript**|Нет|Путь к файлу и имя сценария PowerShell, выполняемого на каждом узле перед началом обновления, и перед как узел переводится в режим обслуживания. Расширение имени файла должно быть **.ps1**, и общая длина пути и имени файла не должна превышать 260 символов. Чтобы сценарий был всегда доступен для всех узлов кластера, рекомендуется размещать его на диске в системе хранения данных кластера или в сетевой папке высокой доступности. Если сценарий находится в сетевой папке, убедитесь, что группа "Все" имеет для нее разрешение "Чтение", и запретите доступ к папке, чтобы исключить несанкционированное изменение файлов.<br /><br /> При указании сценария, выполняемого перед обновлением, убедитесь, что настройка таких параметров, как ограничения по времени (например, параметр **StopAfter**), обеспечивает успешное выполнение сценария. Эти ограничения задают временной интервал для всего процесса выполнения сценариев и установки обновлений.|  
|**PostUpdateScript**|Нет|Путь к файлу и имя сценария PowerShell для выполнения после завершения обновления (после выхода узла из режима обслуживания). Расширение имени файла должно быть **.ps1** и общая длина пути и имени файла не должна превышать 260 символов. Чтобы сценарий был всегда доступен для всех узлов кластера, рекомендуется размещать его на диске в системе хранения данных кластера или в сетевой папке высокой доступности. Если сценарий находится в сетевой папке, убедитесь, что группа "Все" имеет для нее разрешение "Чтение", и запретите доступ к папке, чтобы исключить несанкционированное изменение файлов.<br /><br /> При указании сценария, выполняемого после обновления, убедитесь, что настройка таких параметров, как ограничения по времени (например, параметр **StopAfter**), обеспечивает успешное выполнение сценария. Эти ограничения задают временной интервал для всего процесса выполнения сценариев и установки обновлений.|  
|**ConfigurationName**|Данный параметр действует только при выполнении сценариев.<br /><br /> Если указать скрипт перед обновлением или после него, но вы не укажете **ConfigurationName**, сеанс по умолчанию используется конфигурация для PowerShell (Microsoft.PowerShell).|Задает конфигурацию сеанса PowerShell, которая определяет сессию, выполняющую сценарии (заданные **PreUpdateScript** и **PostUpdateScript**) выполняются и можно ограничить команды, которые могут выполняться.|  
|**CauPluginName**|**Microsoft.WindowsUpdatePlugin**|Подключаемый модуль, который используется кластерным обновлением для просмотра обновлений или выполнения прогона обновления. Дополнительные сведения см. в разделе [как кластерное обновление подключаемых модулях](cluster-aware-updating-plug-ins.md).|  
|**CauPluginArguments**|Нет|Набор пар *имя=значение* (аргументов), которые используются подключаемым модулем обновления, например:<br /><br /> **Domain=domain.Local**<br /><br /> Такие пары *имя=значение* должны распознаваться подключаемым модулем, заданным в параметре **CauPluginName**.<br /><br /> Чтобы задать аргумент в пользовательском интерфейсе CAU, введите *имя*, нажмите клавишу TAB, а затем введите соответствующее *значение*. Чтобы задать следующий аргумент, снова нажмите клавишу TAB. Каждое *имя* и *значение* автоматически отделяются друг от друга знаком равенства (=). Пары автоматически отделяются друг от друга точкой с запятой.<br /><br /> По умолчанию **Microsoft.WindowsUpdatePlugin** подключаемого модуля, аргументы не требуются. При этом можно задать необязательный аргумент, например чтобы указать стандартную строку запроса для агента Центра обновления Windows, фильтрующую набор обновлений, которые применяются подключаемым модулем. Для *имя*, использовать **QueryString**, а также для *значение*, сам запрос заключите в кавычки.<br /><br /> Дополнительные сведения см. в разделе [как кластерное обновление подключаемых модулях](cluster-aware-updating-plug-ins.md).|  
  
##  <a name="BKMK_runtime"></a> Параметры, указываемые при запросе выполнения обновления  
 В следующей таблице перечислены параметры (отличные от параметров в профиле прогона обновления), которые указываются при запросе прогона обновления. Сведения о параметрах, задаваемых в профиле прогона обновления, см. в предыдущей таблице.  
  
|Параметр|Значение по умолчанию|Подробности|  
|------------|-------------------|-------------|  
|**Имя кластера**|Нет <br>**Примечание.**  Этот параметр необходимо задавать, только если пользовательский интерфейс CAU не запущен на узле отказоустойчивого кластера или если нужно сослаться на отказоустойчивый кластер, отличный от того, на котором запущен пользовательский интерфейс CAU.|NetBIOS-имя кластера, на котором следует выполнить прогон обновления.|  
|**Учетные данные**|Учетные данные текущей учетной записи|Учетные данные администратора для целевого кластера, на котором будет выполнен прогон обновления. Вы возможно уже есть необходимые учетные данные при запуске пользовательский Интерфейс CAU (или откройте сеанс PowerShell, в том случае, если вы используете командлеты CAU PowerShell) из учетной записи с правами и разрешениями администратора в кластере.|  
|**NodeOrder**|По умолчанию CAU начинает работу с узла с наименьшим количеством кластерных ролей, а затем переходит на следующие узлы в порядке возрастания числа кластерных ролей.|Имена узлов кластера в том порядке, в каком их следует обновить (если возможно).|  
  
##  <a name="BKMK_profile"></a> Использование профилей прогона обновления  
 Каждый прогон обновления можно связать с особым профилем прогона обновления. По умолчанию, профиль прогона обновления хранятся в *%windir%\cluster* папки. Если вы используете пользовательский Интерфейс CAU в удаленное обновление режиме, вы можете указать профиля выполнения обновления в во время применения обновлений, или можно использовать профиль прогона по умолчанию. Если вы используете CAU в режиме самообновления, можно импортировать параметры из указанного профиля прогона обновления при настройке параметров самообновления. В обоих случаях можно переопределить значения, отображаемые для параметров прогона обновления, в соответствии с актуальными потребностями. Параметры прогона обновления можно сохранить в виде профиля прогона обновления с тем же или с другим именем файла. В следующий раз при применении обновлений или настройке параметров самообновления CAU автоматически выберет ранее выбранный профиль прогона обновления.  
  
 Можно изменить существующий профиль прогона обновления или создайте новую, выбрав **создать или изменить профиль прогона обновления** в пользовательском Интерфейсе CAU.

Ниже приведены некоторые важные замечания об использовании профили прогона обновления.

* Профиля выполнения обновления не хранит данные о кластере, такие как учетные данные администратора. Если вы используете CAU в режиме самообновления, профиль прогона обновления также не хранит данные о расписании самообновления. Это позволяет использовать один профиль прогона обновления во всех отказоустойчивых кластерах определенного класса.
* Если настроить параметры самообновления с помощью профиля выполнения обновления и затем изменить профиль, с разными значениями для параметров прогона, то конфигурация самообновления не изменяется автоматически. Чтобы применить новые параметры прогона обновления, необходимо снова настроить параметры самообновления.
* Редактор профиля запуска к сожалению не поддерживает пути к файлам, содержащие пробелы, такие как *C:\Program Files*. Обойти это ограничение, хранения вашей pre и post скриптов обновления в пути, который не содержит пробелов или исключительно для управления профилями запуска, поместив путь в кавычки, при выполнении с помощью PowerShell **Invoke-CauRun**.

### <a name="windows-powershell-equivalent-commands"></a>Эквивалентные команды Windows PowerShell
  
 Можно импортировать параметры из профиля выполнения обновления, при выполнении **Invoke-CauRun**, **Add-CauClusterRole**, или **Set-CauClusterRole** командлета.  
  
 В следующем примере выполняется проверка и полный прогон обновления в кластере с именем *CONTOSO-FC1* с использованием параметров прогона обновления, заданных в файле *C:\Windows\Cluster\DefaultParameters.xml*. Для остальных параметров командлета используются значения по умолчанию.  
  
```powershell  
$MyRunProfile = Import-Clixml C:\Windows\Cluster\DefaultParameters.xml  
Invoke-CauRun –ClusterName CONTOSO-FC1 @MyRunProfile   
```  
  
 С помощью профиля прогона обновления можно повторять операции обновления отказоустойчивого кластера с одинаковыми параметрами для обработки исключений, ограничений по времени и других рабочих показателей. Поскольку такие параметры обычно связаны с некоторым классом отказоустойчивых кластеров, например "Все кластеры Microsoft SQL Server" или "Важнейшие кластеры организации", можно задать для каждого профиля прогона обновления имя, соответствующее классу отказоустойчивых кластеров, с которым он будет использоваться. Кроме того, можно организовать профиль прогона обновления для сетевой папки, которая доступна всем отказоустойчивым кластерам определенного класса в ИТ-организации.  
  
  
  
## <a name="see-also"></a>См. также

-   [Кластерное обновление](cluster-aware-updating.md)
  
-   [Командлеты кластерного обновления в Windows PowerShell](https://docs.microsoft.com/powershell/module/clusterawareupdating/?view=win10-ps)