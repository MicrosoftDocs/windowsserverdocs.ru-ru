---
title: Использовать общие тома кластера в отказоустойчивом кластере
description: Инструкции по использованию общих томов кластера в отказоустойчивом кластере.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: f5bd0ad05bdc2573a5ea0abbe165de2d3e7f5c8f
ms.sourcegitcommit: 375e94dc70c76e7aa5679c32f0f4dbc26cf7dd83
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2018
ms.locfileid: "2233520"
---
# <a name="use-cluster-shared-volumes-in-a-failover-cluster"></a>Использовать общие тома кластера в отказоустойчивом кластере

>Применимо к: Windows Server 2012 R2, Windows Server 2012, Windows Server 2016

Общие тома кластера (CSV) включить несколько узлов в отказоустойчивом кластере, чтобы одновременно иметь право чтения и записи же LUN (диск), который был подготовлен как тома NTFS. (В Windows Server 2012 R2 диска можно подготовить к работе как NTFS или устойчивое файловой системы (ссылки).) С помощью CSV объединенных в кластер роли можно при сбое быстро с одного узла на другой узел без внесения изменений в владельца диска или отключение и повторном монтировании тома. CSV также упростить управление потенциально большого числа LUN в отказоустойчивом кластере.

CSV предоставления общего назначения, объединенных в кластер файловой системы, которые многоуровневые над файловой системы NTFS (или ReFS в Windows Server 2012 R2). CSV приложениям относятся следующие:

- Кластерные файлы виртуального жесткого диска (VHD) для виртуальных машин Hyper-V
- Горизонтального масштабирования общие папки для хранения данных приложения для масштабирования файл кластерные роли сервера. Данные приложения для этой роли примеры файлов виртуальной машины Hyper-V и данных Microsoft SQL Server. (Обратите внимание, что ссылки не поддерживается для масштабирования файлового сервера). Дополнительные сведения о горизонтального масштабирования файлового сервера можно [Горизонтального масштабирования файлового сервера для данных приложения](sofs-overview.md).

>[!NOTE]
>CSV не поддерживает кластерные рабочей нагрузки Microsoft SQL Server в SQL Server 2012 и более ранних версий SQL Server.

В Windows Server 2012 существенно улучшены функции CSV. Например были удалены зависимости с доменными службами Active Directory. Поддержка был добавлен для работы улучшения в **chkdsk**, для взаимодействия с приложениями защиту от вирусов и резервного копирования и для интеграции с общее хранилище компонентов, таких как зашифрованные BitLocker тома и дисковые пространства. Обзор функциональных возможностей CSV, которая была введена в Windows Server 2012, в разделе [возможности New в отказоустойчивой кластеризации в Windows Server 2012 \[redirected\]](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265972(v%3dws.11)>).

Windows Server 2012 R2 представлены дополнительные функции, такие как распределенная владельца CSV, повышение устойчивости через доступности службы сервера, более высокий уровень гибкости объема физической памяти, который можно выделить для кэша CSV, лучше diagnosibility и улучшенные возможности взаимодействия, которая включает поддержку ReFS и дедупликации. Дополнительные сведения см [в отказоустойчивой кластеризации](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265972(v%3dws.11)>).

>[!NOTE]
>Для получения сведений об использовании дедупликации данных CSV для сценариев инфраструктуры виртуальных рабочих столов (VDI) видеть публикации в блогах [дедупликации развертывание данных для хранения инфраструктуры виртуальных рабочих СТОЛОВ в Windows Server 2012 R2](https://blogs.technet.com/b/filecab/archive/2013/07/31/deploying-data-deduplication-for-vdi-storage-in-windows-server-2012-r2.aspx) и [дедупликации расширение данных для новых рабочих нагрузок Windows Server 2012 R2](https://blogs.technet.com/b/filecab/archive/2013/07/31/extending-data-deduplication-to-new-workloads-in-windows-server-2012-r2.aspx).

## <a name="review-requirements-and-considerations-for-using-csv-in-a-failover-cluster"></a>Просмотрите требования и рекомендации по использованию CSV в отказоустойчивом кластере

Перед использованием CSV в отказоустойчивом кластере, просмотрите сети, хранилища и другие требования и рекомендации в этом разделе.

### <a name="network-configuration-considerations"></a>Рекомендации по конфигурации сети

При настройке сетей, которые поддерживают CSV, учитывайте следующее.

- **Несколько сетей и несколько сетевых адаптеров**. Чтобы включить отказоустойчивости в случае сбоя сети, рекомендуется несколько сетей кластера выполнения CSV или настроить группировки сетевых адаптеров.
    
    Если узлы кластера подключены к сети, которые не должны использоваться в кластере, следует отключить их. Например рекомендуется отключить iSCSI сетей для использования кластера для предотвращения трафика CSV этих сетей. Для отключения сети в диспетчере отказоустойчивого кластера выберите **сетей**, выберите сеть, выберите действие, **Свойства** и выберите **Запретить кластеру в сети**. Кроме того можно настроить свойство **Role** сети с помощью командлета [Get-ClusterNetwork](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusternetwork?view=win10-ps) Windows PowerShell.
- **Свойства адаптера сети**. В разделе свойства для всех адаптеров, которые используются для передачи связи кластера убедитесь в том, что включены следующие параметры:

  - **Клиент для сетей Microsoft** и **файлам и принтерам общего доступа для сетей Microsoft**. Эти параметры поддержки блок SMB (Server Message) 3.0, который используется по умолчанию для выполнения CSV трафик между узлами. Чтобы включить протокол SMB, также убедитесь, что запущены службы сервера и рабочей станции и настроены для автоматического запуска на каждом узле кластера.

    >[!NOTE]
    >В Windows Server 2012 R2 существует несколько экземпляров службы сервера на одном узле отказоустойчивого кластера. Существует экземпляр по умолчанию, который обрабатывает входящий трафик от SMB клиентов, которые обращаются регулярных общие файловые ресурсы и второй экземпляр CSV, который обрабатывает только трафик между узлами CSV. Кроме того Если службы сервера на узле становится неработоспособные, CSV владельца автоматически переходит на другой узел.

    SMB 3.0 включает в себя SMB multichannel; и SMB прямое компоненты, позволяющие трафика CSV поток через несколько сетей в кластере и по использованию сетевых адаптеров, которые поддерживают удаленного прямого памяти доступа RDMA. По умолчанию SMB multichannel; используется для трафика CSV. [Протокол SMB](../storage/file-server/file-server-smb-overview.md)Дополнительные сведения см.
  - **Microsoft отказоустойчивый кластер виртуального адаптера производительности фильтра**. Этот параметр позволяет узлов для выполнения операций ввода-вывода в режиме одобрения администратором, когда это необходимо сделать доступными CSV, например, если сбой подключения не позволяет узел путем прямого подключения на диске CSV. Для получения дополнительных сведений см [синхронизации о ввода -вывода и операций ввода-вывода в режиме одобрения администратором в CSV связи](#about-i/o-synchronization-and-i/o-redirection-in-csv-communication) данного раздела.
- **Определение приоритетов сети кластера**. Как правило, рекомендуется не изменять параметры настройки кластера для сетей.
- **Конфигурация IP-адрес подсети**. Настройка не конкретной подсети необходим для узлов в сети, используйте CSV. CSV может поддерживать multisubnet кластеры.
- **На основе политики качества обслуживания (QoS)**. Мы рекомендуем настроить политики QoS приоритет и политики минимальной пропускной способностью для сетевого трафика на каждом узле при использовании CSV. Для получения дополнительных сведений см [Качества обслуживания (QoS)](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831679(v%3dws.11)>).
- **Сети хранения данных**. Рекомендации по сети хранения данных проверьте указания, предоставляемые поставщиком хранилища. Дополнительные вопросы о хранилище для CSV см в разделе [требования к конфигурации хранилища и диск](#storage-and-disk-configuration-requirements) данного раздела.

Обзор оборудованию, сети и требования к хранилищу для отказоустойчивых кластеров см в [отказоустойчивый кластер требования к аппаратному обеспечению и варианты хранения](clustering-requirements.md).

#### <a name="about-io-synchronization-and-io-redirection-in-csv-communication"></a>О синхронизации ввода-вывода и операций ввода-вывода в режиме одобрения администратором в CSV связи

- **Операции ввода-вывода синхронизации**: CSV включает несколько узлов, чтобы иметь одновременный доступ чтение запись для одного общего хранилища. Когда узел выполняет дискового ввода вывода (I/O) на томе CSV, узел взаимодействует непосредственно с хранилища, например, через сети хранения данных (SAN). Тем не менее в любое время отдельного узла (называемые Координатор узла) «несет ответственность за» физический диск, который связан с LUN. Узел координатора для тома CSV отображается в диспетчере отказоустойчивый кластер как **Узел владельца** **дисков**. Также отображается в выходных данных командлета [Get-ClusterSharedVolume](https://docs.microsoft.com/powershell/module/failoverclusters/get-clustersharedvolume?view=win10-ps) Windows PowerShell.

  >[!NOTE]
  >В Windows Server 2012 R2 владельца CSV равномерно распределенных по узлы отказоустойчивого кластера, на основе числа томов CSV, каждый узел является владельцем. Кроме того владельца автоматически Балансировка, когда при определенных условиях, таких как CSV отработки отказа, узел присоединяется к кластеру, добавить новый узел в кластер, перезапустите узла кластера или запустить отказоустойчивый кластер после завершения работы.

  При возникновении определенных небольшие изменения в файловой системе на томе CSV, метаданные должны быть синхронизированы на всех физических узлах, обращающихся к LUN, не только на узле одного координатора. К примеру при запуске, создании или удалении виртуальной машины на томе CSV или при переносе виртуальной машины, эти сведения необходимо синхронизировать на всех физических узлах, обращающихся к виртуальной машине. Эти операции обновление метаданных возникающих параллельно различных сетях кластера с помощью SMB 3.0. Эти операции не требуют физических узлов для взаимодействия с общего хранилища.

- **Операции ввода-вывода в режиме одобрения администратором**: ошибок подключения хранилища и определенные операции хранилища может препятствовать заданным узлом связи непосредственно с хранилищем. Для поддержки функции во время узел не взаимодействуют с хранения, узел перенаправляет ввод-вывод диска через сеть кластера на узел координатора, где в настоящее время подключена диска. Если на текущем узле координатор возникает сбой подключения к хранилищу, все операции ввода-вывода диска в очереди время новый узел устанавливается как узел координатора.

На сервере используется один из следующих режимов ввода-вывода в режиме одобрения администратором в зависимости от ситуации:

- **Перенаправление файлов системы** — Это перенаправление на том — например, при CSV моментальные снимки создаются с приложение резервного копирования при тома CSV вручную переводится в режим перенаправления ввода-вывода.
- **В режиме одобрения администратором блока** В режиме одобрения администратором был создан на уровне блокировки файлов — например, когда теряется подключения к хранилищу на том. В режиме одобрения администратором блока значительно быстрее, чем в режиме одобрения администратором системы файла.

В Windows Server 2012 R2 можно просмотреть состояние тома CSV на каждом узле. Например можно увидеть является ли ввода-вывода прямой или перенаправления или тома CSV недоступна. Если CSV многопользовательской перенаправления режим ввода-вывода, можно также просмотреть причину. Используйте командлет **Get-ClusterSharedVolumeState** Windows PowerShell для просмотра этих сведений.

>[!NOTE]
> * В Windows Server 2012 улучшений в CSV разработки CSV выполнить дополнительные операции в режиме прямого ввода-вывода, чем в Windows Server 2008 R2.
> * Из-за интеграцию CSV с SMB 3.0 компонентов, таких как SMB multichannel; и SMB прямое перенаправления трафика ввода-вывода можно передать в потоковом режиме через несколько сетей кластера.
> * Следует учитывать свои сети кластера о предоставлении потенциальных увеличение сетевого трафика в узел координатор во время ввода-вывода в режиме одобрения администратором.

### <a name="storage-and-disk-configuration-requirements"></a>Требования к конфигурации хранилища и диска

Чтобы использовать CSV, хранилище и диски должны удовлетворять следующим требованиям:

- **Формат файловой системы**. В Windows Server 2012 R2 диске или в хранилище пространства для тома CSV значения базового диска, разделенную с NTFS и ReFS. В Windows Server 2012 диска или хранилища пространства для тома CSV значения базового диска, разделы с файловой системой NTFS.

  CSV-ФАЙЛ содержит следующие дополнительные требования:
    
  - В Windows Server 2012 R2 нельзя использовать диска для CSV-ФАЙЛ, отформатированный с помощью FAT или FAT32.
  - В Windows Server 2012 нельзя использовать диска для CSV-ФАЙЛ, отформатированный с FAT, FAT32 или ReFS.
  - Если вы хотите использовать дискового пространства для CSV-ФАЙЛ, можно настроить простой пространства или ввода зеркального. В Windows Server 2012 R2 также можно настроить возможности пространства. (В Windows Server 2012, CSV не поддерживает возможности пробелов.)
  - CSV-ФАЙЛ не может использоваться в качестве диск-свидетель кворума. Дополнительные сведения о кворума кластера содержатся в разделе [Общие сведения о кворума в хранилище пробелы прямое](../storage/storage-spaces/understand-quorum.md).
  - После добавления диска как CSV-ФАЙЛ, назначается в формате CSVFS (для CSV файловая система). Это позволяет кластера и другое программное обеспечение для различения CSV хранилища из других NTFS или ReFS хранилища. Как правило CSVFS поддерживает функциональные возможности, аналогичные NTFS и ReFS. Тем не менее некоторые функции не поддерживаются. Например в Windows Server 2012 R2 не удается включить сжатие на CSV. В Windows Server 2012 вы не можете позволить дедупликации данных или сжатие на CSV.
- **Тип ресурса в кластере**. Для тома CSV необходимо использовать тип ресурса физического диска. По умолчанию диска или хранилища пространства, который добавляется в хранилище кластера автоматически настраивается таким образом.
- **Выбор CSV дисков или других дисках в хранилище кластера**. При выборе одного или нескольких дисков для виртуальной машины, объединенных в кластер, рассмотрите возможность использования каждого диска. Если диск будет использоваться для хранения файлов, созданных с Hyper-V, такие как файлы виртуального жесткого диска или конфигурации, можно выбрать из CSV дисков или других доступных дисков в хранилище кластера. Если диск будет физический диск, который является непосредственно подключенное в систему виртуальной машины (также называемая сквозной диска), нельзя выбрать CSV диска и необходимо выбрать из доступных дисков в хранилище кластера.
- **Имя пути для идентификации дисков**. Диски в CSV-ФАЙЛЕ, идентифицируются с именем пути. Каждый путь похоже на системном диске узла как нумерованный том в папке **\\ClusterStorage** . Этот путь — это то же, при просмотре с любого узла в кластере. При необходимости можно переименовать тома.

Требования к хранилищу для CSV просмотрите рекомендации, предоставляемые поставщиком хранилища. Вопросы планирования дополнительное хранилище CSV см [планируется использовать CSV в отказоустойчивом кластере](#plan-to-use-csv-in-a-failover-cluster) данного раздела.

### <a name="node-requirements"></a>Требования к узел

Чтобы использовать CSV, узлы должен отвечать следующим требованиям.

- **Буква диска системы**. На всех узлах буква диска для системного диска должны быть одинаковыми.
- **Протокол проверки подлинности**. Протокол NTLM необходимо включить на всех узлах. Этот параметр включен по умолчанию.

## <a name="plan-to-use-csv-in-a-failover-cluster"></a>Планирование использования CSV в отказоустойчивом кластере

В этом разделе приведены рекомендации по планированию и рекомендации по использованию CSV в отказоустойчивый кластер под управлением Windows Server 2012 R2 или Windows Server 2012.

>[!IMPORTANT]
>Попросите поставщиком хранилища рекомендации о настройке модульного конкретного хранилища для CSV. Если рекомендации от поставщика хранилища отличаются от сведения в этом разделе, используйте рекомендации от поставщика хранилища.

### <a name="arrangement-of-luns-volumes-and-vhd-files"></a>Оформление LUN, тома и файлы виртуального жесткого диска

Чтобы сделать рекомендации по использованию CSV-файлов для хранения для виртуальных машин, будет полезно рассмотреть, как бы упорядочить LUN (дисков) при настройке физических серверов. При настройке соответствующие виртуальные машины попробуйте структуризация файлы VHD аналогично.

Рассмотрим физического сервера, для которого можно организовать диски и файлы следующим образом:

- Системные файлы, включая файл подкачки на один физический диск
- Файлы данных на другой физический диск

Эквивалентный кластерные виртуальной машины следует организовывать тома и файлы подобным образом:

- Системные файлы, включая файл подкачки в файл виртуального жесткого диска на один CSV
- Файлы данных в файл виртуального жесткого диска на другой CSV

Если вы добавляете другой виртуальной машины, где это возможно, следует хранить расположение на одном виртуальные жесткие диски на этой виртуальной машине.

### <a name="number-and-size-of-luns-and-volumes"></a>Количество и размер томов и LUN

При планировании конфигурации хранилища для отказоустойчивого кластера, использующего CSV следует учитывайте следующие рекомендации:

- В том, сколько LUN для настройки, обратитесь к своему поставщику хранения. К примеру поставщиком хранилища может рекомендуется настроить каждый LUN с один раздел и помещения один том CSV.
- Нет никаких ограничений числа виртуальных машин, которые могут поддерживаться на одном томе CSV. Тем не менее необходимо учитывать число виртуальных машин, которые предполагается использовать в кластере и рабочей нагрузки (операций ввода-вывода в секунду) для каждой виртуальной машины. Рассмотрим следующие примеры:

  - Одна организация развертывание виртуальных машин, которое будет обеспечивать поддержку инфраструктуры виртуальных рабочих столов (VDI), который является относительно низкие рабочей нагрузки. Кластер использует хранилище высокой производительности. Администратор кластеров после консультации с поставщиком хранилища, решает поместить относительно большое число виртуальных машин на том CSV.
  - Другой организации развертывание большое число виртуальных машин, которые будут поддерживать приложения интенсивно используемых баз данных, который является весом рабочей нагрузки. Кластер использует выполнения нижнем хранилища. Администратор кластеров после консультации с поставщиком хранилища, решает для размещения небольшого числа виртуальных машин на том CSV.
- При планировании конфигурации хранилища для конкретной виртуальной машины, необходимо учитывайте требования к дисковому службы, приложения или роли, которая будет поддерживать виртуальной машины. Общие сведения об этих требованиях помогает избежать конфликтов диск, который может привести к снижению производительности. Конфигурации хранилища для виртуальной машины близко должен иметь вид конфигурации хранилища, которые можно использовать для физического сервера, на котором выполняется служба, приложение или роли. Для получения дополнительных сведений см [сообщений по беседам LUN, тома и файлы VHD](#arrangement-of-luns,-volumes,-and-vhd-files) ранее в этом разделе.

    Также можно снизить диска конфликтов благодаря использованию хранилища с большим числом независимой жестких дисках. Выбор устройств хранения данных, соответствующим образом и обратитесь к поставщику для оптимизации производительности хранилище.
- В зависимости от вашей кластера рабочих нагрузок и их необходимость операций ввода-вывода могут быть полезны Настройка процент виртуальных машин для доступа к каждой LUN во время других виртуальных машин, не имеют подключения и вместо этого выделенного для вычисления операции.

## <a name="add-a-disk-to-csv-on-a-failover-cluster"></a>Добавить диск в CSV в отказоустойчивом кластере

По умолчанию в отказоустойчивый кластер включается компонент CSV. Добавление диска CSV, необходимо добавить диск в группе **Доступных хранилищ** кластера (если он еще не добавлена) и затем добавить в CSV в кластере. Диспетчер отказоустойчивости кластера или командлетов Windows PowerShell отказоустойчивых кластеров можно использовать для выполнения этих процедур.

### <a name="add-a-disk-to-available-storage"></a>Добавить диск доступной памяти

1. В Диспетчер отказоустойчивости кластеров, в дереве консоли разверните имя кластера и разверните **хранилища**.
2. Щелкните правой кнопкой мыши **диски**и затем выберите **Добавить диск**. Появится список дисков, которые могут быть добавлены для использования в отказоустойчивом кластере.
3. Выберите диск или диски, которые вы хотите добавить и нажмите кнопку « **ОК»**.

    Диски теперь назначаются группе **Доступных хранилищ** .

#### <a name="windows-powershell-equivalent-commands-add-a-disk-to-available-storage"></a>Эквивалент команды Windows PowerShell (добавить диск в доступной памяти)

Следующий командлета Windows PowerShell или командлеты выполнять те же функции, что и предыдущая процедура. Введите в одной строке каждого командлета, несмотря на то, что они могут отображаться словам в нескольких строках здесь из-за ограничения форматирования.

В следующем примере определяет дисков, все готово для добавления к кластеру и добавляет их в группе **Доступных хранилищ** .

```PowerShell
Get-ClusterAvailableDisk | Add-ClusterDisk
```

### <a name="add-a-disk-in-available-storage-to-csv"></a>Добавить диск в доступной памяти в CSV

1. В Диспетчер отказоустойчивости кластеров, в дереве консоли разверните узел имени кластера, разверните **хранилища**и выберите **диски**.
2. Выберите один или несколько дисков, назначенные **Доступной памяти**, правой кнопкой мыши и выберите команду **Добавить в общие тома кластера**.

    Диски теперь назначен группе **Общий том кластера** в кластере. Диски представляются нумерованный тома (точек подключения) в папке % SystemDisk % ClusterStorage на каждом узле кластера. Тома отображаются в файловой системе CSVFS.

>[!NOTE]
>Можно переименовать тома CSV в папке % SystemDisk % ClusterStorage.

#### <a name="windows-powershell-equivalent-commands-add-a-disk-to-csv"></a>Эквивалент команды Windows PowerShell (добавить диск в CSV)

Следующий командлета Windows PowerShell или командлеты выполнять те же функции, что и предыдущая процедура. Введите в одной строке каждого командлета, несмотря на то, что они могут отображаться словам в нескольких строках здесь из-за ограничения форматирования.

В следующем примере добавляется в локальном кластере *кластера диск 1* в **Доступной памяти** CSV.

```PowerShell
Add-ClusterSharedVolume –Name "Cluster Disk 1"
```

## <a name="enable-the-csv-cache-for-read-intensive-workloads-optional"></a>Включение кэша CSV для чтения рабочих нагрузок (необязательно)

Кэш CSV обеспечивает кэширование на уровне блока только для чтения небуферизованных операций ввода-вывода, выделив Оперативной памяти системы кэширования сквозной. (Операций ввода-вывода небуферизованных не кэшируются диспетчером кэша). Это может повысить производительность для приложений, таких как Hyper-V, который выполняет небуферизованных операций ввода-вывода при доступе к виртуального жесткого диска. Кэш CSV может повысить производительность запросов на чтение без кэширования запросов на запись. Включение кэша CSV используется также для масштабирования файлового сервера сценариев.

>[!NOTE]
>Рекомендуется включить кэш CSV для всех объединенных в кластер Hyper-V и масштабирования файлового сервера развертывания.

По умолчанию в Windows Server 2012 отключена в кэше CSV. В Windows Server 2012 R2 CSV кэш включен по умолчанию. Тем не менее по-прежнему необходимо выделить размера кэша блокировки для резервирования.

В следующей таблице описываются два настройки, которые управляют кэша CSV.

<table>
<thead>
<tr class="header">
<th>Имя свойства в Windows Server 2012 R2</th>
<th>Имя свойства в Windows Server 2012 г.</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>BlockCacheSize</strong></td>
<td><strong>SharedVolumeBlockCacheSizeInMB</strong></td>
<td>Это cluster общее свойство, которое позволяет определить объем памяти (в мегабайтах) для резервирования CSV кэша на каждом узле кластера. Например если значение 512 определен, 512 МБ системной памяти резервируется на каждом узле. (В много кластеры 512 МБ используется рекомендуемое значение). Значение по умолчанию равно 0 (для отключены).</td>
</tr>
<tr class="even">
<td><strong>EnableBlockCache</strong></td>
<td><strong>CsvEnableBlockCache</strong></td>
<td>Это частное свойство кластера физический диск. Его можно включить кэш CSV на отдельном диске, который добавляется в CSV. В Windows Server 2012 значение по умолчанию равно 0 (для отключены). Чтобы включить CSV кэш на диске, настройте значения 1. Этот параметр включен по умолчанию в Windows Server 2012 R2.</td>
</tr>
</tbody>
</table>

Кэша CSV в монитора производительности можно отслеживать путем добавления счетчики в разделе **Кэш тома кластера CSV**.

#### <a name="configure-the-csv-cache"></a>Настройка кэша CSV

1. Запустите Windows PowerShell от имени администратора.
2. Чтобы определить кэш *512* МБ резервируемого на каждом узле, введите следующую команду:

    - Для Windows Server 2012 R2:

        ```PowerShell
        (Get-Cluster).BlockCacheSize = 512  
        ```

    - Для Windows Server 2012 г.:

        ```PowerShell
        (Get-Cluster).SharedVolumeBlockCacheSizeInMB = 512  
        ```
3. В Windows Server 2012 Чтобы включить кэш CSV в CSV-ФАЙЛ с именем *кластера диск 1*, введите следующие значения:

    ```PowerShell
    Get-ClusterSharedVolume "Cluster Disk 1" | Set-ClusterParameter CsvEnableBlockCache 1
    ```

>[!NOTE]
> * В Windows Server 2012 можно выделить на 20% общий объем ОЗУ в кэше CSV. В Windows Server 2012 R2 можно выделить до 80%. Поскольку горизонтального масштабирования файловые серверы не обычно ограниченной памятью, значительное увеличение производительности можно выполнить с помощью дополнительной памяти для кэша CSV.
> * Чтобы избежать конфликта ресурсов, перезапустите каждого узла в кластере после изменения объем памяти, выделяемый для кэша CSV. В Windows Server 2012 R2 перезагрузку больше не требуется.
> * После включения или отключения кэша CSV на отдельном диске, для параметра вступило в силу, необходимо перевести физический диск в автономный режим и обратно в оперативный режим. (По умолчанию в Windows Server 2012 R2 CSV кэш включен.) 
> * Дополнительные сведения о кэше CSV, который содержит сведения о счетчиках производительности можно в блоге [как включить кэш CSV](https://blogs.msdn.microsoft.com/clustering/2013/07/19/how-to-enable-csv-cache/).

## <a name="back-up-csv"></a>Резервное копирование CSV

Существует несколько методов для резервного копирования данных, хранящихся в CSV в отказоустойчивом кластере. Можно использовать приложение резервного копирования Microsoft или приложение не Майкрософт. В общем случае CSV не выдвигаются особые требования к резервному копированию превышающих кластерные хранилища, отформатированные в NTFS и ReFS. Резервные копии CSV также не нарушить других операций хранения CSV.

При выборе приложения для резервного копирования и расписание резервного копирования для CSV, необходимо учитывать следующие факторы:

- Резервное копирование на уровне тома тома CSV можно запустить с любого узла, который подключается к многопользовательской CSV.
- Ваше приложение резервного копирования можно использовать моментальные снимки программного обеспечения или оборудования моментальные снимки. В зависимости от того, возможность резервного копирования приложения их поддержка резервные копии можно использовать согласованные приложения и экспресс согласованные моментальные снимки службы теневого копирования томов (VSS).
- При резервном копировании CSV, для которого настроено несколько работающих виртуальных машин, обычно следует выбирать управления операционной системы на основе метода резервного копирования. Если ваше приложение резервного копирования поддерживает его, несколько виртуальных машин можно сделать резервные копии одновременно.
- CSV поддержки резервного копирования опросчики, работающих под управлением Windows Server 2012 R2 Backup, Windows Server 2012 Backup или Windows Server 2008 R2 Backup. Тем не менее резервного копирования Windows Server обычно содержит только основные решения для резервного копирования, который может не подходит для организаций с размером кластеров. Системы архивации данных Windows Server не поддерживает резервное копирование приложений согласованные виртуальной машины в CSV. Поддержка только экспресс согласованные архивация уровень громкости. (При восстановлении согласованные сбой резервного копирования в виртуальную машину будет в том состоянии, которое было при виртуальной машины аварийное завершение во времени, в течение, которая была создана резервная копия.) Резервное копирование на виртуальную машину на томе CSV будет успешно, но заносится сообщение об ошибке, указывающего на то, что это действие не поддерживается.
- При резервном копировании отказоустойчивого кластера, может потребоваться учетные данные администратора.

>[!IMPORTANT]
>Убедитесь, что внимательно изучите какие данные резервной копии приложения выполняется резервное копирование и восстановление компонентов CSV, которые он поддерживает и требований к ресурсам для приложения на каждом кластера узел.

>[!WARNING]
>Если нужно восстановить резервного копирования данных на том CSV, следует помнить о возможности и ограничения приложение резервного копирования для обслуживания и восстановления приложения согласованность данных между узлами кластера. Например с некоторыми приложениями, если CSV восстанавливается на узел, отличный от узла, где тома CSV была создана резервная копия, можно случайно не перезаписать важные данные о состоянии приложения на узле, где восстановление выполняется.

## <a name="more-information"></a>Дополнительные сведения

- [Отказоустойчивая кластеризация](failover-clustering.md)
- [Развертывание объединенных в кластер дисковые пространства](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11)>)