---
title: Использование общих томов кластера в отказоустойчивом кластере
description: Сведения об использовании общих томов кластера в отказоустойчивом кластере.
ms.prod: windows-server-threshold
ms.topic: article
author: JasonGerend
ms.author: jgerend
ms.technology: storage-failover-clustering
ms.date: 04/05/2018
ms.localizationpriority: medium
ms.openlocfilehash: f5bd0ad05bdc2573a5ea0abbe165de2d3e7f5c8f
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59857705"
---
# <a name="use-cluster-shared-volumes-in-a-failover-cluster"></a>Использование общих томов кластера в отказоустойчивом кластере

>Относится к: Windows Server 2012 R2, Windows Server 2012, Windows Server 2016

Общие тома кластера (CSV) позволяют нескольким узлам отказоустойчивого кластера одновременно получать доступ для чтения и записи к одному и тому же LUN (диску), предоставляемому как том NTFS. (В Windows Server 2012 R2, диск можно подготовить как NTFS или Resilient File System (ReFS).) Благодаря томам CSV возможна быстрая отработка отказа кластерных ролей путем их переноса с одного узла на другой. При этом не нужно менять владельца диска или отключать и снова подключать том. Тома CSV также помогают упростить управление большим числом LUN в отказоустойчивом кластере.

Тома CSV предоставляют общего назначения, кластеризованный файловой системы, реализуемую поверх NTFS (или ReFS в Windows Server 2012 R2). Тома CSV применяются в следующих целях:

- файлы кластерных виртуальных жестких дисков (VHD) для кластерных виртуальных машин Hyper-V;
- масштабируемые общие папки для хранения данных приложений, предназначенные для кластерной роли масштабируемого файлового сервера. К примерам данных приложений для этой роли относятся файлы виртуальных машин Hyper-V и данные Microsoft SQL Server. (Имейте в виду, что файловая система ReFS не поддерживается масштабируемым файловым сервером.) Дополнительные сведения о масштабируемого файлового сервера, см. в разделе [масштабируемого файлового сервера для данных приложений](sofs-overview.md).

>[!NOTE]
>Тома CSV не поддерживают кластерные рабочие нагрузки Microsoft SQL Server в SQL Server 2012 и более ранних версиях SQL Server.

В Windows Server 2012 функциональные возможности CSV значительно расширились. Например, были устранены элементы зависимости от доменных служб Active Directory. Добавлена поддержка функциональных улучшений в средстве **chkdsk**для взаимодействия с приложениями антивирусной защиты и службы архивации, а также для интеграции с общими компонентами хранилища, такими как зашифрованные при помощи BitLocker тома и дисковые пространства. Обзор функциональных возможностей CSV, появившихся в Windows Server 2012, см. в разделе [новые возможности отказоустойчивой кластеризации в Windows Server 2012 \[перенаправлено\]](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265972(v%3dws.11)>).

Windows Server 2012 R2 появились дополнительные функциональные возможности, такие как распределенное владение CSV, Повышенная отказоустойчивость благодаря доступности службы сервера, более гибкое физической памяти, который может быть выделен для кэша CSV, лучше Эффективная Диагностика и улучшенное взаимодействие, включая поддержку ReFS и дедупликации. Дополнительные сведения см. в разделе [новые возможности отказоустойчивой кластеризации](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/dn265972(v%3dws.11)>).

>[!NOTE]
>Со сведениями об использовании дедупликации данных в CSV в сценариях, опирающихся на инфраструктуру виртуальных рабочих столов (VDI), можно ознакомиться в сообщениях блогов [Развертывание технологии дедупликации данных в хранилище инфраструктуры виртуальных рабочих столов в среде Windows Server 2012 R2](https://blogs.technet.com/b/filecab/archive/2013/07/31/deploying-data-deduplication-for-vdi-storage-in-windows-server-2012-r2.aspx) и [Расширение функции дедупликации данных до новых рабочих нагрузок в Windows Server 2012 R2](https://blogs.technet.com/b/filecab/archive/2013/07/31/extending-data-deduplication-to-new-workloads-in-windows-server-2012-r2.aspx).

## <a name="review-requirements-and-considerations-for-using-csv-in-a-failover-cluster"></a>Требования и рекомендации по использованию CSV в отказоустойчивом кластере

Перед использованием тома CSV в отказоустойчивом кластере изучите приведенные в этом разделе рекомендации и требования к сети, хранилищу и другим компонентам.

### <a name="network-configuration-considerations"></a>Рекомендации по настройке сети

При настройке сетей для поддержки CSV примите во внимание приведенные ниже рекомендации.

- **Несколько сетей и несколько сетевых адаптеров**. Чтобы обеспечить отказоустойчивость в случае сбоя сети, рекомендуется использовать несколько сетей для передачи трафика CSV в кластере или настроить объединенные сетевые адаптеры.
    
    Если узлы кластера подключены к сетям, которые не должны использоваться кластером, их следует отключить. Например, мы рекомендуем отключить сети iSCSI для кластера, чтобы предотвратить передачу трафика CSV по ним. Чтобы отключить сеть, в диспетчере отказоустойчивости кластеров выберите **сетей**, выберите сеть, выберите **свойства** действия, а затем выберите **Запретить кластеру Эта сеть**. Кроме того, можно настроить **роли** свойства сети с помощью [Get-ClusterNetwork](https://docs.microsoft.com/powershell/module/failoverclusters/get-clusternetwork?view=win10-ps) командлета Windows PowerShell.
- **Свойства сетевого адаптера**. Убедитесь в том, что в свойствах всех адаптеров, через которые происходит обмен данными внутри кластера, включены указанные ниже параметры.

  - **Клиент для сетей Майкрософт** и **Служба доступа к файлам и принтерам сетей Майкрософт**. Эти параметры поддерживают протокол SMB 3.0, который используется по умолчанию для передачи трафика CSV между узлами. Чтобы обеспечить работу протокола SMB, также убедитесь в том, что служба сервера и служба рабочей станции выполняются и для них настроен автоматический запуск на каждом узле кластера.

    >[!NOTE]
    >В Windows Server 2012 R2 существует несколько экземпляров службы сервера каждого узла отказоустойчивого кластера. Экземпляр по умолчанию обрабатывает входящий трафик от клиентов SMB, которые обращаются к обычным общим папкам, а второй экземпляр обрабатывает только трафик CSV между узлами. Кроме того, если служба сервера на узле утрачивает работоспособность, владение CSV автоматически передается другому узлу.

    Протокол SMB 3.0 включает в себя функции SMB Multichannel и SMB Direct, которые обеспечивают потоковую передачу трафика CSV через несколько сетей в кластере и использование сетевых адаптеров, поддерживающих удаленный доступ к памяти (RDMA). По умолчанию для трафика CSV используется функция SMB Multichannel. Подробнее см. в разделе [Общие сведения о протоколе SMB](../storage/file-server/file-server-smb-overview.md).
  - **Фильтр производительности для виртуального адаптера отказоустойчивого кластера Майкрософт**. Этот параметр улучшает возможности узлов по перенаправлению операций ввода-вывода, которые должны достичь тома CSV, например, если из-за сбоя подключения узел не может подключиться к диску CSV напрямую. Дополнительные сведения см. в разделе [синхронизация ввода-вывода и перенаправление ввода-вывода, взаимодействии с CSV](#about-i/o-synchronization-and-i/o-redirection-in-csv-communication) далее в этом разделе.
- **Определение приоритетов для сетей кластера**. Как правило, не рекомендуется изменять настроенные кластером предпочтения в отношении использования сетей.
- **Конфигурация IP-подсети**. Настраивать подсети для узлов, использующих CSV, не требуется. Тома CSV поддерживают кластеры с несколькими подсетями.
- **Качество обслуживания (QoS) на основе политик**. Мы рекомендуем настроить политику приоритетов QoS и политику минимальной пропускной способности для сетевого трафика, передаваемого на каждый узел, при использовании CSV. Дополнительные сведения см. в разделе [качества обслуживания (QoS)](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/hh831679(v%3dws.11)>).
- **Сетевое хранилище**. В отношении сетевых хранилищ следует выполнять рекомендации изготовителей оборудования. Дополнительные рекомендации о хранилище для CSV см. в разделе [требования к конфигурации хранилища и дисков](#storage-and-disk-configuration-requirements) далее в этом разделе.

Общие сведения о требованиях к оборудованию, сети и хранилищу для отказоустойчивых кластеров см. в статье [Failover Clustering Hardware Requirements and Storage Options](clustering-requirements.md).

#### <a name="about-io-synchronization-and-io-redirection-in-csv-communication"></a>Синхронизация ввода-вывода и режим перенаправления ввода-вывода при взаимодействии с CSV

- **Синхронизация ввода-вывода**: CSV-ФАЙЛ позволяет нескольким узлам одновременно получать доступ к чтения и записи к тем же общему хранилищу. Когда узел выполняет дисковые операции ввода-вывода с томом CSV, он взаимодействует напрямую с хранилищем — например, через сеть хранения данных (SAN). Однако в каждый момент времени только один узел (называемый узлом-координатором) "владеет" ресурсом физического диска, связанным с LUN. Узел-координатор тома CSV отображается в диспетчере отказоустойчивости кластеров как **Узел владельца** в разделе **Диски**. Он также отображается в выходных данных [Get-ClusterSharedVolume](https://docs.microsoft.com/powershell/module/failoverclusters/get-clustersharedvolume?view=win10-ps) командлета Windows PowerShell.

  >[!NOTE]
  >В Windows Server 2012 R2 владение томами CSV распределяется равномерно между узлами отказоустойчивого кластера в соответствии с числом томов CSV, которые принадлежат каждому узлу. Кроме того, владение автоматически балансируется, если происходят такие события, как отработка отказа CSV, повторное присоединение узла к кластеру, добавление нового узла в кластер, перезапуск узла кластера или запуск отказоустойчивого кластера после того, как его работа была прекращена.

  При внесении небольших изменений в файловую систему в томе CSV эти метаданные должны синхронизироваться на каждом физическом узле, получающем доступ к LUN, а не только на узле-координаторе. Например, когда в томе CSV запускается, создается или удаляется виртуальная машина, а также когда виртуальная машина переносится, соответствующая информация должна синхронизироваться на каждом физическом узле, имеющем доступ к виртуальной машине. Эти операции обновления метаданных производятся параллельно через сети кластера по протоколу SMB 3.0. Для их выполнения не требуется, чтобы все физические узлы связывались с общим хранилищем.

- **Перенаправление ввода-вывода**: Из-за сбоев подключения к хранилищу и некоторых операций (со)хранения данных прямое взаимодействие определенного узла с хранилищем может быть невозможным. Для обеспечения функционирования такого узла его дисковые операции ввода-вывода перенаправляются через сеть кластера на узел-координатор, где в настоящее время подключен диск. Если текущий узел-координатор испытывает проблемы с подключением к хранилищу, все дисковые операции ввода-вывода временно помещаются в очередь, а узлом-координатором становится другой узел.

Сервер использует один из указанных ниже режимов перенаправления ввода-вывода в зависимости от ситуации.

- **Перенаправление файловой системы** . Перенаправление выполняется на уровне тома, например, когда приложение резервного копирования делает моментальные снимки CSV с переводом тома CSV в режим перенаправления ввода-вывода вручную.
- **Перенаправление блоков** . Перенаправление выполняется на уровне файлов и блоков, например, если потеряно подключение хранилища к тому. Перенаправление блоков значительно быстрее перенаправления файловой системы.

В Windows Server 2012 R2 можно просмотреть состояние тома CSV для каждого отдельного узла. Например, можно узнать, выполняются ли операции ввода-вывода напрямую или с перенаправлением, а также доступен ли том CSV. Если том CSV находится в режиме перенаправления ввода-вывода, можно также узнать причину. Просмотр этих сведений выполняется при помощи следующего командлета Windows PowerShell: **Get-ClusterSharedVolumeState** .

>[!NOTE]
> * В Windows Server 2012 из-за улучшений в структуре, CSV выполняется больше операций в режиме прямого ввода-вывода, чем в Windows Server 2008 R2.
> * Благодаря интеграции CSV с такими функциями SMB 3.0, как SMB Multichannel и SMB Direct, перенаправляемый трафик ввода-вывода может передаваться через несколько сетей кластера.
> * При планировании сетей кластера следует учесть возможное увеличение сетевого трафика на узел-координатор при перенаправлении ввода-вывода.

### <a name="storage-and-disk-configuration-requirements"></a>Требования к конфигурации хранилища и дисков

Для использования CSV ваше хранилище и диски должны соответствовать указанным ниже требованиям.

- **Формат файловой системы**. В Windows Server 2012 R2 диск или дисковое пространство для тома CSV должны быть собой базовый диск, разбитый на разделы NTFS или ReFS. В Windows Server 2012 диск или дисковое пространство для тома CSV должны быть собой базовый диск, разбитый на разделы NTFS.

  Кроме того, том CSV предъявляет указанные ниже требования.
    
  - В Windows Server 2012 R2 нельзя использовать диск для тома CSV, отформатированный в файловой системе FAT или FAT32.
  - В Windows Server 2012 нельзя использовать диск для тома CSV, представляется в формате FAT, FAT32 или ReFS.
  - Если вы хотите использовать дисковое пространство для тома CSV, вы можете настроить простое или зеркальное пространство. В Windows Server 2012 R2 также можно настроить пространство с контролем четности. (В Windows Server 2012, тома CSV не поддерживают пространства с контролем четности.)
  - Том CSV нельзя использовать в качестве диска-свидетеля кворума. Дополнительные сведения о кворуме кластера см. в разделе [понимание кворума в Storage Spaces Direct](../storage/storage-spaces/understand-quorum.md).
  - Когда диск добавлен в качестве тома CSV, он получает формат CSVFS (для файловой системы CSV). Это позволяет кластеру и другому программному обеспечению отличать хранилище CSV от других хранилищ NTFS и ReFS. В целом, CSVFS поддерживает те же функциональные возможности, что и NTFS или ReFS. Однако некоторые функции не поддерживаются. Например в Windows Server 2012 R2, невозможно включить сжатие в томе CSV. В Windows Server 2012 нельзя включить дедупликацию данных или сжатие в томе CSV.
- **Тип ресурса в кластере**. Для тома CSV необходимо использовать тип ресурса "Физический диск". По умолчанию диски и дисковые пространства, добавляемые в систему хранения данных кластера, автоматически настраиваются таким образом.
- **Выбор дисков CSV или других дисков в системе хранения данных кластера**. При выборе одного или нескольких дисков для кластерной виртуальной машины, учитывайте, как будет использоваться каждый диск. Если диск будет использоваться для хранения файлов, созданных Hyper-V, например файлов VHD или файлов конфигурации, вы можете выбрать диски CSV или другие доступные диски в системе хранения данных кластера. В качестве физического диска, подключаемого напрямую к виртуальной машине (то есть транзитного диска), нельзя выбрать диск CSV. В этом случае нужно выбрать другие доступные диски в системе хранения данных кластера.
- **Путь для определения диска**. Диски в томе CSV определяются по пути. Каждый путь отображается на системном диске узла как нумерованный том в папке  **\\ClusterStorage** папки. Этот путь выглядит одинаково из любого узла в кластере. При необходимости можно переименовывать тома.

Чтобы узнать требования к хранилищу для CSV, обратитесь к рекомендациям изготовителя оборудования. Дополнительные рекомендации по планированию хранилища для CSV см. в подразделе [Планирование использования CSV в отказоустойчивом кластере](#plan-to-use-csv-in-a-failover-cluster) далее в этом разделе.

### <a name="node-requirements"></a>Требования к узлам

Для использования CSV узлы должны соответствовать указанным ниже требованиям.

- **Буква системного диска**. Буква системного диска должна совпадать на всех узлах.
- **Протокол проверки подлинности**. На всех узлах должна быть включена поддержка протокола NTLM. Она включена по умолчанию.

## <a name="plan-to-use-csv-in-a-failover-cluster"></a>Планирование использования CSV в отказоустойчивом кластере

В этом разделе перечислены аспектах планирования и рекомендации по использованию CSV в отказоустойчивом кластере под управлением Windows Server 2012 R2 или Windows Server 2012.

>[!IMPORTANT]
>За рекомендациями по настройке вашей системы хранения для CSV обратитесь к ее изготовителю. Если рекомендации изготовителя системы хранения отличаются от приведенных в этом разделе, следуйте рекомендациям от изготовителя.

### <a name="arrangement-of-luns-volumes-and-vhd-files"></a>Организация LUN, томов и файлов VHD

Чтобы добиться максимальной эффективности использования хранилища CSV кластерными виртуальными машинами, полезно учесть организацию LUN (дисков) при настройке физических серверов. При настройке соответствующих виртуальных машин постарайтесь организовать файлы VHD аналогичным образом.

Рекомендуем организовать диски и файлы на физическом сервере следующим образом:

- системные файлы, включая файл подкачки, на одном физическом диске;
- файлы данных на другом физическом диске.

Для соответствующей кластерной виртуальной машины следует организовать тома и файлы аналогичным образом:

- системные файлы, включая файл подкачки, в файле VHD в одном томе CSV;
- файлы данных в файле VHD в другом томе CSV.

При добавлении виртуальных машин следует по возможности соблюдать такую же структуру файлов VHD.

### <a name="number-and-size-of-luns-and-volumes"></a>Число и размер LUN и томов

При планировании конфигурации хранилища для отказоустойчивого кластера, в котором используется том CSV, учтите приведенные ниже рекомендации.

- Чтобы решить, сколько LUN следует настроить, проконсультируйтесь с изготовителем системы хранения. Например, изготовитель может порекомендовать настроить для каждого LUN один раздел и разместить в нем один том CSV.
- Число виртуальных машин, поддерживаемых одним томом CSV, не ограничено. Однако следует продумать, сколько виртуальных машин будет добавлено в кластер и какая рабочая нагрузка (число операций ввода-вывода в секунду) будет приходиться на каждую из них. Рассмотрим следующие примеры:

  - В одной организации развертываются виртуальные машины, которые будут поддерживать инфраструктуру виртуальных рабочих столов (VDI), а это сравнительно небольшая рабочая нагрузка. В кластере используется высокопроизводительное хранилище. После консультаций с изготовителем системы хранения администратор кластера решает разместить относительно большое число виртуальных машин в каждом томе CSV.
  - Другая организация развертывает большое число виртуальных машин, которые будут поддерживать интенсивно используемое приложение баз данных, а это более значительная рабочая нагрузка. В кластере используется хранилище с низкой производительностью. После консультаций с изготовителем системы хранения администратор кластера решает разместить относительно небольшое число виртуальных машин в каждом томе CSV.
- При планировании конфигурации хранилища для определенной виртуальной машины проанализируйте требования к дискам для службы, приложения или роли, которые будет поддерживать виртуальная машина. Понимание этих требований поможет вам избежать состязания за диск, которое способно привести к снижению производительности. Конфигурация хранилища для виртуальной машины должна быть как можно более похожей на конфигурацию, которая использовалась бы для физического сервера с той же службой, приложением или ролью. Дополнительные сведения см. в разделе [упорядочение номера LUN, томов и VHD файлов](#arrangement-of-luns,-volumes,-and-vhd-files) ранее в этом разделе.

    Вы также можете минимизировать состязание за диски, используя хранилище с большим числом независимых физических жестких дисков. Подберите соответствующее оборудование для системы хранения и проконсультируйтесь с его изготовителем, чтобы оптимизировать производительность хранилища.
- В зависимости от рабочих нагрузок кластера и их потребностей в отношении операций ввода-вывода можно настроить виртуальные машины так, чтобы только определенный их процент мог получать доступ к LUN. Остальные виртуальные машины при этом не подключаются и используются только для вычислительных операций.

## <a name="add-a-disk-to-csv-on-a-failover-cluster"></a>Добавление диска в том CSV в отказоустойчивом кластере

Компонент CSV по умолчанию включен в отказоустойчивом кластере. Чтобы добавить диск в CSV, необходимо добавить его в группу **Доступное хранилище** кластера (если он еще не добавлен), а затем добавить его в том CSV в кластере. Для выполнения этих процедур можно использовать диспетчер отказоустойчивости кластеров или командлеты PowerShell Windows кластеров отработки отказа.

### <a name="add-a-disk-to-available-storage"></a>Добавьте диск в доступное хранилище

1. В диспетчере отказоустойчивости кластеров в дереве консоли разверните имя кластера, а затем разверните элемент **Хранилище**.
2. Щелкните правой кнопкой мыши **дисков**, а затем выберите **добавить диск**. Появится список дисков, которые можно добавить для использования в отказоустойчивом кластере.
3. Выберите диск или диски, которые вы хотите добавить, а затем выберите **ОК**.

    Диски будут добавлены в группу **Доступное хранилище**.

#### <a name="windows-powershell-equivalent-commands-add-a-disk-to-available-storage"></a>Эквивалентные команды Windows PowerShell (Добавление диска в доступное хранилище)

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

В приведенном ниже примере определяются диски, готовые к добавлению в кластер, после чего они добавляются в группу **Доступное хранилище**.

```PowerShell
Get-ClusterAvailableDisk | Add-ClusterDisk
```

### <a name="add-a-disk-in-available-storage-to-csv"></a>Добавьте диск в доступное хранилище в CSV-ФАЙЛ

1. В диспетчере отказоустойчивости кластеров в дереве консоли разверните имя кластера, разверните **хранения**, а затем выберите **дисков**.
2. Выберите один или несколько дисков, назначенных **доступное хранилище**, правой кнопкой мыши и выберите **добавить в общие тома кластера**.

    Диски будут добавлены в группу **Общий том кластера** в кластере. Доступ к дискам предоставляется каждому узлу кластера как к нумерованным томам (точкам подключения) в папке %SystemDisk%ClusterStorage. Тома имеют файловую систему CSVFS.

>[!NOTE]
>Тома CSV можно переименовать в папке %SystemDisk%ClusterStorage.

#### <a name="windows-powershell-equivalent-commands-add-a-disk-to-csv"></a>Эквивалентные команды Windows PowerShell (добавить диск в CSV-ФАЙЛ)

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

В приведенном ниже примере диск *Cluster Disk 1*, включенный в группу **Доступное хранилище**, добавляется в том CSV в локальном кластере.

```PowerShell
Add-ClusterSharedVolume –Name "Cluster Disk 1"
```

## <a name="enable-the-csv-cache-for-read-intensive-workloads-optional"></a>Обеспечение поддержки рабочих нагрузок с высокой интенсивностью чтения кэшем CSV (не обязательно)

Кэш CSV обеспечивает кэширование на уровне блоков для небуферизованных операций чтения путем выделения системной памяти (ОЗУ) в качестве кэша сквозной записи. (Небуферизованные операции ввода-вывода не кэшируются диспетчером кэша.) Это может повысить производительность приложений (таких как Hyper-V), которые выполняют небуферизованные операции ввода-вывода при доступе к VHD. Кэш CSV может значительно повысить производительность запросов на чтение без кэширования запросов на запись. Включение кэша CSV также полезно в случае использования масштабируемого файлового сервера.

>[!NOTE]
>Мы рекомендуем включать кэш CSV для всех кластерных развертываний Hyper-V и развертываний масштабируемого файлового сервера.

По умолчанию в Windows Server 2012 кэш CSV отключен. В Windows Server 2012 R2 кэш CSV включен по умолчанию. Однако вам необходимо указать размер памяти, выделенной под блочный кэш.

В таблице ниже описываются два параметра конфигурации, служащие для управления кэшем CSV.

<table>
<thead>
<tr class="header">
<th>Имя свойства в Windows Server 2012 R2</th>
<th>Имя свойства в Windows Server 2012</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>BlockCacheSize</strong></td>
<td><strong>SharedVolumeBlockCacheSizeInMB</strong></td>
<td>Это общее свойство кластера, которое позволяет определить размер памяти (в мегабайтах), резервируемой для кэша CSV на каждом узле кластера. Например, если задано значение 512, на каждом узле резервируется 512 МБ системной памяти (Во многих кластерах 512 МБ — Рекомендованное значение). Значение по умолчанию — 0 (отключено).</td>
</tr>
<tr class="even">
<td><strong>EnableBlockCache</strong></td>
<td><strong>CsvEnableBlockCache</strong></td>
<td>Это частное свойство ресурса физического диска в кластере. Оно позволяет включить кэш CSV на отдельном диске, добавленном в том CSV. В Windows Server 2012 параметр по умолчанию — 0 (отключено). Чтобы включить кэш CSV на диске, настройте значение 1. Этот параметр включен по умолчанию в Windows Server 2012 R2.</td>
</tr>
</tbody>
</table>

Вы можете отслеживать состояние кэша CSV в системном мониторе, добавив счетчики в категорию **Кэш тома CSV кластера**.

#### <a name="configure-the-csv-cache"></a>Настройка кэша CSV

1. Запустите Windows PowerShell с правами администратора.
2. Чтобы зарезервировать на каждом узле кэш размером *512* МБ, введите следующую команду.

    - Для Windows Server 2012 R2:

        ```PowerShell
        (Get-Cluster).BlockCacheSize = 512  
        ```

    - Для Windows Server 2012

        ```PowerShell
        (Get-Cluster).SharedVolumeBlockCacheSizeInMB = 512  
        ```
3. В Windows Server 2012, чтобы включить кэш CSV в CSV-ФАЙЛ с именем *Cluster Disk 1*, введите следующее:

    ```PowerShell
    Get-ClusterSharedVolume "Cluster Disk 1" | Set-ClusterParameter CsvEnableBlockCache 1
    ```

>[!NOTE]
> * В Windows Server 2012 можно выделить только 20% от общего размера физического ОЗУ для кэша CSV. В Windows Server 2012 R2 можно выделить до 80%. Так как масштабируемые файловые серверы обычно не испытывают недостатка памяти, можно добиться значительного роста производительности за счет использования лишней памяти для кэша CSV.
> * Чтобы избежать конфликта ресурсов, следует перезапустить каждый узел в кластере после внесения изменений в памяти, выделенной кэшу CSV. В Windows Server 2012 R2 больше не требуется перезагрузка.
> * После включения или отключения кэша CSV на отдельном диске необходимо отключить ресурс физического диска и снова подключить его, чтобы изменение вступило в силу. (По умолчанию в Windows Server 2012 R2, кэш CSV включен.) 
> * Дополнительные сведения о кэше CSV, включая сведения о счетчиках производительности см. в записи блога [Включение кэша CSV](https://blogs.msdn.microsoft.com/clustering/2013/07/19/how-to-enable-csv-cache/).

## <a name="back-up-csv"></a>Резервное копирование CSV

Есть несколько способов резервного копирования информации, хранящейся в томе CSV в отказоустойчивом кластере. Можно использовать приложение для резервного копирования от корпорации Майкрософт или стороннего поставщика. Как правило, тома CSV не предъявляют особых требований к резервному копированию, помимо общих требований для кластерных хранилищ, форматированных в NTFS или ReFS. Резервное копирование CSV не прерывает выполнение других операций с томом CSV.

При выборе приложения для резервного копирования и расписания резервного копирования для тома CSV следует учесть указанные ниже факторы.

- Резервное копирование CSV на уровне тома можно выполнять с любого узла, подключенного к тому CSV.
- Приложение резервного копирования может использовать программные или аппаратные моментальные снимки. Если ваше приложение резервного копирования поддерживает соответствующие возможности, в резервных копиях можно использовать снимки службы теневого копирования томов (VSS), согласованные на уровне приложений, и снимки на момент аварийного завершения.
- При резервном копировании тома CSV с несколькими запущенными виртуальными машинами, как правило, следует выбирать способ резервного копирования на основе операционной системы управления. Если ваше приложение резервного копирования поддерживает такую возможность, можно одновременно выполнять резервное копирование нескольких виртуальных машин.
- Тома CSV поддерживают инициаторов резервного копирования, работающих под управлением Windows Server 2012 R2 Backup, 2012 архивации данных Windows Server или Windows Server 2008 R2 Backup. Однако система архивации данных Windows Server, как правило, обеспечивает лишь базовое решение резервного копирования, которого может быть недостаточно для организаций с более крупными кластерами. Система архивации данных Windows Server не поддерживает согласованное на уровне приложений резервное копирование виртуальных машин в томе CSV. Поддерживается только резервное копирование на уровне тома на момент аварийного завершения. (При восстановлении из резервной копии на момент аварийного завершения виртуальная машина будет в том же состоянии, в каком она была бы, если бы сбой произошел в тот момент, когда делалась резервная копия.) Резервное копирование виртуальной машины в томе CSV завершится успешно, но в журнал будет записано событие, указывающее на то, что такой способ не поддерживается.
- При резервном копировании отказоустойчивого кластера могут потребоваться учетные данные администратора.

>[!IMPORTANT]
>Тщательно проверяйте, какие данные архивирует и восстанавливает ваше приложение для резервного копирования, а также какие функции CSV оно поддерживает. Кроме того, учитывайте требования к ресурсам для приложения на каждом узле кластера.

>[!WARNING]
>Если необходимо восстановить данные из резервной копии в том CSV, учитывайте возможности и ограничения приложения для резервного копирования, связанные с сохранением и восстановлением согласованных на уровне приложений данных на узлах кластера. Например, если том CSV восстанавливается не на том узле, на котором была сделана его резервная копия, то при использовании некоторых приложений можно случайно перезаписать важные данные о состоянии приложения на узле, где происходит восстановление.

## <a name="more-information"></a>Дополнительные сведения

- [Отказоустойчивая кластеризация](failover-clustering.md)
- [Развертывание кластерных дисковых пространств](<https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj822937(v%3dws.11)>)