---
ms.assetid: d44d4430-41e2-483a-9685-92610cdef32a
title: "Каким образом кластерное обновление сведения о подключаемых модулях"
ms.topic: article
ms.prod: windows-server-threshold
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 4/28/2017
ms.technology: storage-failover-clustering
description: "Способы использования подключаемых модулей для координации обновлений, при использовании кластерного обновления в Windows Server для установки обновлений в кластере."
ms.openlocfilehash: eb606dfbe6596ecabd35e6ac36624fab2b4436b9
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="how-cluster-aware-updating-plug-ins-work"></a>Каким образом кластерное обновление сведения о подключаемых модулях

>Применяется к: Windows Server (канал точками годовой), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

[Кластерное обновление](cluster-aware-updating.md) (CAU) использует подключаемых модулей, чтобы координировать установку обновлений на узлах отказоустойчивого кластера. Этот раздел содержит сведения об использовании встроенных модулей модулей CAU или других модулей модулей, которые можно установить для кластерного обновления.

## <a name="BKMK_INSTALL"></a>Установка модулей в  
Модулей в по умолчанию модулей модули, не являющиеся подключаемыми модулями CAU \ (**Microsoft.WindowsUpdatePlugin** и **Microsoft.HotfixPlugin**\) необходимо устанавливать отдельно. Если кластерное обновление используется в режим обновления многоразовый, модулей в должен устанавливаться на всех узлах кластера. Если кластерное обновление используется в режим обновления remote\, модулей в должен устанавливаться на удаленном компьютере координатора обновлений. Модулей в установить на каждом узле могут предъявляться дополнительных требований к установке.  
  
Для установки модулей в, следуйте инструкциям от издателя в модулей. Чтобы вручную зарегистрировать модулей в с помощью CAU, выполните [Register-CauPlugin](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/register-cauplugin) на каждом компьютере, на котором установлены модулей в.  
  
## <a name="specify-a-plug-in-and-plug-in-arguments"></a>Укажите в модулей и модулей в аргументов  
  
### <a name="specify-a-cau-plug-in"></a>Указание CAU модулей в

В пользовательском Интерфейсе CAU выбирается модулей в раскрывающиеся список доступных модулей модулей при использовании CAU для выполнения следующих действий:  
  
-   Применение обновлений к кластеру  
  
-   Просмотр обновлений для кластера  
  
-   Настройка параметров обновления многоразовый кластера  
  
По умолчанию кластерное обновление выбирает модулей в **Microsoft.WindowsUpdatePlugin**. Тем не менее, вы можете указать любой модулей в, установленный и зарегистрированный в CAU.

> [!TIP]  
> В пользовательском Интерфейсе CAU можно указать только один в модулей CAU, который будет использоваться для просмотра или применения обновлений во время прогона обновления. С помощью командлетов PowerShell кластерное обновление, можно указать один или несколько модулей модулей. Если необходимо установить обновления нескольких типов в кластере, это обычно лучше указать несколько модулей модулей в рамках одного прогона обновления, а не использовать отдельный прогон обновления для каждого модулей в. Например меньше узел перезагрузок.

С помощью командлетов PowerShell для кластерного обновления, перечисленные в следующей таблице, можно указать один или несколько модулей модулей для прогона обновления или проверки, передав **– CauPluginName** параметра. Можно указать несколько имен модулей, разделите их запятыми. Если вы указываете несколько модулей модулей, вы также можете контролировать, как модулей модули влияют друг на друга во время прогона обновления, указав **\-RunPluginsSerially**, **\-StopOnPluginFailure**, и **– SeparateReboots** параметров. Дополнительные сведения об использовании нескольких модулей модулей используйте приведены ссылки на документацию по командлетам в приведенной ниже таблице.  
  
|Командлет|Описание|  
|----------|---------------|  
|[Add-CauClusterRole](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/add-cauclusterrole)|Добавляет кластерную роль CAU, который обеспечивает функции обновления многоразовый для указанного кластера.|  
|[Invoke-CauRun](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/invoke-caurun)|Проверяет наличие узлов кластера для применимых обновлений и устанавливает их посредством прогона обновления в указанном кластере.|  
|[Invoke-CauScan](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/invoke-causcan)|Проверяет наличие узлов кластера для применимых обновлений и возвращает список начального набора обновлений, которые будут применены к каждому узлу указанного кластера.|  
|[Set-CauClusterRole](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/set-cauclusterrole)|Задает свойства конфигурации для кластерной роли CAU в указанном кластере.|  
  
Если параметр модулей в CAU не указан с помощью этих командлетов, по умолчанию используется модулей в **Microsoft.WindowsUpdatePlugin**.  
  
### <a name="specify-cau-plug-in-arguments"></a>Указание параметров модулей CAU  
При настройке параметров прогона обновления можно указать один или несколько *имя = значение* пар \(arguments\) для выбранного в модулей для использования. Например в пользовательском Интерфейсе CAU можно указать несколько аргументов следующим образом:  
  
**Name1\ = значение1; Name2\ = значение2; Name3\ = значение 3**  
  
Эти *имя = значение* пары должны быть понятны модулей в указанном вами. Для некоторых модулей модулей аргументы необязательны.  
  
Синтаксис аргументов кластерного обновления в модулей выполняются следующие общие правила:  
  
-   Несколько *имя = значение* пар, разделенных точкой с запятой.  
  
-   Значение, содержащее пробелы, заключается в кавычки, например: **Name1\ = «Value with Spaces»**.  
  
-   Точный синтаксис *значение* зависит от модулей в.  
  
Чтобы указать аргументы модулей в с помощью командлетов PowerShell для кластерного обновления, которые поддерживают **– CauPluginParameters** параметра, передайте этот параметр формы:  
  
**\-CauPluginArguments @{Name1\ = значение1; Name2\ = значение2; Name3\ = значение 3}**  
  
Можно также использовать предопределенные PowerShell хэш-таблицу. Чтобы указать модулей аргументы для нескольких в модулей, передайте несколько хэш-таблиц аргументов, разделив их запятыми. Передайте аргументы модулей в в модулей в порядке, указанном в **CauPluginName**.  
  
### <a name="specify-optional-plug-in-arguments"></a>Указание дополнительных аргументов модулей  
Модулей модули, устанавливаемые CAU \ (**Microsoft.WindowsUpdatePlugin** и **Microsoft.HotfixPlugin**\) предоставляют дополнительные параметры, которые можно выбрать. В пользовательском Интерфейсе CAU они отображаются на **Дополнительные параметры** страницы после настройки параметров прогона обновления для модулей в. При использовании командлетов PowerShell кластерное обновление, эти параметры настраиваются как дополнительные аргументы модулей. Дополнительные сведения см. в разделе [использование подключаемого модуля Microsoft.WindowsUpdatePlugin](#BKMK_WUP) и [использование подключаемого модуля Microsoft.HotfixPlugin](#BKMK_HFP) далее в этом разделе.  
  
## <a name="manage-plug-ins-using-windows-powershell-cmdlets"></a>Управление модулями модулей с помощью командлетов Windows PowerShell  
  
|Командлет|Описание|  
|----------|---------------|  
|[Get-CauPlugin](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/get-cauplugin)|Извлекает сведения о программном обеспечении один или несколько обновление модулей надстроек, зарегистрированных на локальном компьютере.|  
|[Register-CauPlugin]((https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/register-cauplugin))|Регистрирует программного обеспечения кластерное обновление, обновления в модулей на локальном компьютере.|  
|[Unregister-CauPlugin](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/unregister-cauplugin)|Удаление обновления в модулей из списка модулей модули, которые можно использовать для кластерного обновления программного обеспечения. **Примечание:** надстроек модулей, устанавливаемых с помощью CAU \ (**Microsoft.WindowsUpdatePlugin** и **Microsoft.HotfixPlugin**\) не может быть отменена регистрация.|  
  
## <a name="BKMK_WUP"></a>С помощью подключаемого модуля Microsoft.WindowsUpdatePlugin  

По умолчанию в модулей для кластерного обновления, **Microsoft.WindowsUpdatePlugin**, выполняет следующие действия:
- Связывается с агентом обновления Windows на каждом узле отказоустойчивого кластера, чтобы применить обновления, необходимые для продуктов Майкрософт, которые выполняются на каждом узле.
- Устанавливает кластерные обновления непосредственно из центра обновления Windows или Центра обновления Майкрософт или с сервера Windows Server Update Services \(WSUS\) on\ локального.
- Устанавливает только выбранные, общего распространения выпускать обновления \(GDR\). По умолчанию модулей в применяет только важные обновления программного обеспечения. Настройка не требуется. Конфигурация по умолчанию загружает и устанавливает важные обновления GDR в каждом узле. 

> [!NOTE]
> Чтобы применить обновления, отличающиеся от важных обновлений, которые выбираются по умолчанию \ (например, updates\ драйверов), можно настроить дополнительный параметр модулей. Дополнительные сведения см. в разделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="requirements"></a>Требования к

- Отказоустойчивый кластер и удаленный \(if used\) компьютер координатора обновлений должны соответствовать требованиям для CAU и иметь конфигурацию, необходимую для удаленного управления, перечисленные в [требования и рекомендации для кластерного обновления](cluster-aware-updating-requirements.md).
- Просмотрите [рекомендации по применению обновлений Майкрософт](cluster-aware-updating-requirements.md#BKMK_BP_WUA), а затем внесите необходимые изменения в конфигурацию центра обновления Майкрософт для узлов отказоустойчивого кластера.
- Для получения оптимальных результатов рекомендуется запустить \(BPA\) CAU анализатор соответствия рекомендациям для обеспечения того, что кластер и среда обновления правильно настроены для применения обновлений с помощью CAU. Дополнительные сведения см. в разделе [CAU тест проверки готовности к обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).

> [!NOTE]
> Обновления, требующие принятия условий лицензии Майкрософт или требуют участия пользователя, исключаются и должен быть установлен вручную.

### <a name="additional-options"></a>Дополнительные параметры

При необходимости можно указать следующие аргументы модулей в Чтобы расширить или ограничить набор обновлений, которые применяются с модулей в:
- Настройка модулей в на применение рекомендованных обновлений в дополнение к важным обновлениям в каждом узле, в пользовательском Интерфейсе CAU на **Дополнительные параметры** выберите **получать рекомендуемые обновления таким же образом, что я важные обновления** флажок.
<br>Кроме того, настроить **'IncludeRecommendedUpdates' \ = 'True'** модулей в аргумент.
- Чтобы настроить модулей в на фильтрацию типов обновлений GDR, применяемых к каждому узлу кластера, укажите строку запроса агента обновления Windows с помощью **QueryString** модулей в аргумент. Дополнительные сведения см. в разделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="BKMK_QUERY"></a>Настройка строки запроса агента обновления Windows  
Вы можете настроить аргумент в модулей по умолчанию модулей в **Microsoft.WindowsUpdatePlugin**, содержащий строку запроса агента обновления Windows \(WUA\). В этой инструкции используется WUA API для определения одного или нескольких групп обновлений Майкрософт для применения к каждому узлу, на основе критериев выбора. Вы можете объединить несколько критериев с помощью логического и или логического или. Строка запроса агента обновления Windows указывается в аргументе модулей следующим образом:  
  
**QueryString\ = «Criterion1\ = значение1 and\ или или Criterion2\ = значение2 and\ или или...»**  
  
Например **Microsoft.WindowsUpdatePlugin** автоматически выбирает важные обновления с помощью по умолчанию **QueryString** аргумент, который создается с помощью **IsInstalled**, **тип**, **IsHidden**, и **IsAssigned** условия:  
  
**QueryString\ = «IsInstalled\ = 0 и Type\ = «Программного обеспечения» и IsHidden\ = 0 и IsAssigned\ = 1»**  
  
При указании **QueryString** аргумент, он используется вместо по умолчанию **QueryString** , настроенного для модулей в.  
  
#### <a name="example-1"></a>Пример 1.
  
Чтобы настроить **QueryString** аргумент, устанавливающий определенное обновление с Идентификатором *f6ce46c1\-971c\-43f9\-a2aa\-783df125f003*:  
  
**QueryString\ = «UpdateID\ = «f6ce46c1\-971c\-43f9\-a2aa\-783df125f003» и IsInstalled\ = 0»**  
  
> [!NOTE]  
> Предыдущий пример можно использовать для применения обновлений с помощью мастера поддержкой Cluster\ обновления. Если вы хотите установить определенное обновление путем настройки параметров обновления многоразовый с помощью пользовательского интерфейса кластерного обновления или с помощью **надстройку-CauClusterRole** или **Set\-CauClusterRole**командлета PowerShell с двух одиночных кавычек значение UpdateID необходимо отформатировать:  
>   
> **QueryString\ = «UpdateID\ = «f6ce46c1\-971c\-43f9\-a2aa\-783df125f003'' и IsInstalled\ = 0»**  
  
#### <a name="example-2"></a>Пример 2
  
Чтобы настроить **QueryString** аргумент, устанавливающий только драйверы:  
  
**QueryString\ = «IsInstalled\ = 0 и Type\ = «Драйвер» и IsHidden\ = 0»**  
  
Дополнительные сведения о строках запроса для значения по умолчанию модулей в **Microsoft.WindowsUpdatePlugin**, критерии поиска \ (таких как **IsInstalled**\), и синтаксис, который можно включить в строки запроса, см. в разделе о критериях поиска в [Справочник по API агента обновления Windows (WUA)](http://go.microsoft.com/fwlink/p/?LinkId=223304).  
  
## <a name="BKMK_HFP"></a>Использование подключаемого модуля Microsoft.HotfixPlugin  
Модулей в **Microsoft.HotfixPlugin** можно использовать для применения обновлений \(LDR\) Майкрософт для ограниченного распространения \ (также называемые исправлениями и которые ранее назывались QFEs\), загружаются отдельно и предназначены для устранения конкретных неполадок программного обеспечения Майкрософт. Подключаемый модуль устанавливает обновления из корневой папки на файловом ресурсе SMB, а также можно настроить для применения отличных Майкрософт драйверов, встроенного по и обновлений BIOS.

> [!NOTE]
> Исправления иногда бывают доступны для скачивания в статьях базы знаний Майкрософт, но они также предоставляются клиентам по необходимости as\.

### <a name="requirements"></a>Требования к

- Отказоустойчивый кластер и удаленный \(if used\) компьютер координатора обновлений должны соответствовать требованиям для CAU и иметь конфигурацию, необходимую для удаленного управления, перечисленные в [требования и рекомендации для кластерного обновления](cluster-aware-updating-requirements.md).
- Просмотрите [рекомендации по использованию подключаемого модуля Microsoft.HotfixPlugin](cluster-aware-updating-requirements.md#BKMK_BP_HF).
- Для получения оптимальных результатов рекомендуется запустить модель \(BPA\) CAU анализатора соответствия рекомендациям, убедитесь, что кластер и среда обновления правильно настроены для применения обновлений с помощью CAU. Дополнительные сведения см. в разделе [CAU тест проверки готовности к обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).
- Получите обновления от издателя и скопировать их или извлеките их в общую папку \(SMB\) Server Message Block \ (исправление корневой папка), поддерживающий по крайней мере SMB 2.0 и доступен всем узлам кластера и удаленному компьютеру координатора обновлений \ (Если кластерное обновление используется в обновлении remote\ mode\). Дополнительные сведения см. в разделе [Настройка структуры корневой папки с исправлениями](#BKMK_HF_ROOT) далее в этом разделе. 

    > [!NOTE]
    > По умолчанию этот модулей в устанавливает только исправления со следующими расширениями имени файла: MSU, MSI и MSP-файл.

- Скопируйте файл DefaultHotfixConfig.xml \ (предоставленная в **%systemroot%\\System32\\WindowsPowerShell\\v1.0\\Modules\\ClusterAwareUpdating** папку на компьютере, в которых installed\ средства CAU) в корневой папке исправлений, который вы создали и в которую извлекли исправления. Например, скопируйте файл конфигурации для *\\\MyFileServer\\Hotfixes\\Root\\*. 

    > [!NOTE]
    > Для установки большинства исправлений от корпорации Майкрософт и других обновлений, файл конфигурации исправлений по умолчанию можно использовать без изменений. Если этого требует сценарий, Дополнительно можно настроить файл конфигурации. Файл конфигурации может включать настраиваемые правила, например, для обработки файлов исправлений с конкретными расширениями или для определения поведения конкретных условий выхода. Дополнительные сведения см. в разделе [настроить файл конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.

### <a name="configuration"></a>Конфигурации

Настройте следующие параметры. Дополнительные сведения см. ссылки на подразделы данного раздела.
- Путь к корневой папке исправлений общей, которая содержит применяемые обновления и содержит файл конфигурации исправлений. Вы можете ввести этот путь в пользовательском Интерфейсе CAU или настроить **HotfixRootFolderPath\ = \ < путь >** аргумент модулей PowerShell. 

   > [!NOTE]
   > Корневой папке исправлений можно указать локальный путь или UNC-путь в форме *\\\ServerName\\Share\\RootFolderName*. Можно использовать путь на основе domain\ или автономного пространства имен DFS. Тем не менее, возможности модулей, проверьте разрешения на доступ в файле конфигурации исправлений, несовместимы с пути пространства имен DFS, поэтому если вы настроили такой, необходимо отключить проверку разрешений доступа в пользовательском Интерфейсе CAU или задав **DisableAclChecks\ = 'True'** модулей в аргумент.
- Параметры на сервере, на котором размещен корневой папке исправлений, чтобы проверить наличие необходимых разрешений для доступа к папке и обеспечения целостности данных, доступных из SMB общей папке \ (подписывание SMB или SMB Encryption\). Дополнительные сведения см. в разделе [ограничить доступ к корневой папке исправлений](#BKMK_ACL).

### <a name="additional-options"></a>Дополнительные параметры

- При необходимости настройте модулей в, для применения шифрования SMB при доступе к данным из общей папки исправлений. В пользовательском Интерфейсе CAU на **Дополнительные параметры** выберите **требовать шифрования SMB при доступе к корневой папке исправлений** или настроить **RequireSMBEncryption\ = 'True'** аргумент модулей PowerShell. 
  > [!IMPORTANT]
  > На сервере SMB, чтобы включить проверку целостности данных SMB с помощью подписывания SMB или шифрования SMB, необходимо выполнить дополнительные действия по настройке. Дополнительные сведения см. в шаге 4 в [ограничить доступ к корневой папке исправлений](#BKMK_ACL). Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление будет выполнено.
- При необходимости отключите проверки по умолчанию, достаточно разрешений на доступ к корневой папке исправлений и файлу конфигурации исправлений. В пользовательском Интерфейсе CAU выберите **отключить проверку административного доступа к корневой папке и файлу конфигурации исправлений**, или настроить **DisableAclChecks\ = 'True'** модулей в аргумент.
- При необходимости настройте **HotfixInstallerTimeoutMinutes\ =<Integer>** аргумент, чтобы указать, как долго исправление, описанное в модулей ожидает завершения процесса установки исправления для возврата. \ (Значение по умолчанию — 30 минут. \) например, чтобы задать период ожидания равным двум часам, укажите **HotfixInstallerTimeoutMinutes\ = 120**.
- При необходимости настройте **HotfixConfigFileName \ = <name>**модулей аргумент для указания имени файла конфигурации исправлений, который находится в корневой папке исправлений. Если не указано, используется имя по умолчанию DefaultHotfixConfig.xml.
  
### <a name="BKMK_HF_ROOT"></a>Настройка структуры корневой папки с исправлениями

Для исправления модулей в работал, исправления должны храниться хорошо определенный структуру в файловом ресурсе SMB \ (исправление корневой папка), и необходимо настроить исправление, описанное в модулей на путь к корневой папке исправлений с помощью пользовательского интерфейса CAU или командлеты PowerShell для кластерного обновления. Этот путь передается модулей в виде **HotfixRootFolderPath** аргумент. Один из нескольких структур для корневой папки исправлений можно выбрать в соответствии с потребностями в обновлении, как показано в следующих примерах. Файлы и папки, которые не соответствуют структуре, игнорируются.  
  
#### <a name="example-1---folder-structure-used-to-apply-hotfixes-to-all-cluster-nodes"></a>Пример 1. Структура папок, используемая для применения исправлений ко всем узлам кластера
  
Чтобы применить исправления ко всем узлам кластера, скопируйте их в папку с именем **CAUHotfix\_All** в корневой папке исправлений. В этом примере **HotfixRootFolderPath** модулей в аргумента установлено значение *\\\MyFileServer\\Hotfixes\\Root\\*. **CAUHotfix\_All** папка содержит три обновления с расширениями MSU, MSI и MSP, которые будут применяться ко всем узлам кластера. Имена файлов обновлений приведены только для иллюстрации.  
  
> [!NOTE]  
> В этом и последующих примерах файл конфигурации исправлений с именем по умолчанию DefaultHotfixConfig.xml отображается в его в требуемом месте в корневой папке исправлений.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
```  
  
#### <a name="example-2---folder-structure-used-to-apply-certain-updates-only-to-a-specific-node"></a>Пример 2 - структура папок, используемая для применения определенных обновлений только к определенному узлу
  
Чтобы указать исправления, которые применяются только к определенному узлу, используйте вложенную папку в корневой папке исправлений с именем узла. Используйте NetBIOS-имя узла кластера, например, *ContosoNode1*. Затем переместите обновления, которые применяются только к этому узлу эту вложенную папку. В следующем примере **HotfixRootFolderPath** модулей в аргумента установлено значение *\\\MyFileServer\\Hotfixes\\Root\\*. Обновления в **CAUHotfix\_All** будут применены ко всем узлам кластера, и *Node1\_Specific\_Update.msu* будут применяться только к *ContosoNode1*.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
   ContosoNode1\   
      Node1_Specific_Update.msu   
      ...  
```  
  
#### <a name="example-3---folder-structure-used-to-apply-updates-other-than-msu-msi-and-msp-files"></a>Пример 3 - структура папок, используемая для применения обновлений, отличные от MSU, MSI и MSP-файл
  
По умолчанию **Microsoft.HotfixPlugin** применяет обновления только с расширениями MSU, MSI и MSP расширения. Однако некоторые обновления могут иметь другие расширения и требовать других команд для установки. Например может потребоваться применить обновление встроенного по с расширением .exe узел в кластере. Можно настроить корневой папке исправлений с вложенную папку для определенной, отличных от заданных по умолчанию тип обновления должен быть установлен. Также необходимо настроить соответствующее правило установки папки, которое определяет команду установки в `<FolderRules>`элемент в XML-файла конфигурации исправлений.  
  
В следующем примере **HotfixRootFolderPath** модулей в аргумента установлено значение *\\\MyFileServer\\Hotfixes\\Root\\*. Несколько обновлений будут применены ко всем узлам кластера, а обновление встроенного по *SpecialHotfix1.exe* будут применены к *ContosoNode1* с помощью *FolderRule1*. Дополнительные сведения о настройке *FolderRule1* в файле конфигурации исправлений см. в разделе [настроить файл конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
  
   ContosoNode1\   
      FolderRule1\  
          SpecialHotfix1.exe  
      ...  
```

### <a name="BKMK_CONFIG_FILE"></a>Настройка файла конфигурации исправлений  
Исправление конфигурации файла элементы управления как **Microsoft.HotfixPlugin** устанавливает определенные типы исправлений в отказоустойчивом кластере. Схема XML файла конфигурации определяется в HotfixConfigSchema.xsd, который находится в следующей папке на компьютере, где установлены средства кластерного обновления:  
  
**Папка %SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\Modules\\ClusterAwareUpdating**  
  
Чтобы настроить файл конфигурации исправлений, скопируйте образец файла конфигурации DefaultHotfixConfig.xml из этого расположения в корневую папку исправлений и внести соответствующие изменения для вашего сценария.  
  
> [!IMPORTANT]  
> Для применения большинства исправлений от корпорации Майкрософт и других обновлений, файл конфигурации исправлений по умолчанию можно использовать без изменений. Настройка файла конфигурации исправлений — это задача только в расширенных сценариях.  
  
По умолчанию XML-файла конфигурации исправлений определяет правила установки и условия выхода для двух категорий исправлений:  
  
-   Файлы исправлений с расширениями, которые модулей в смогут установить по умолчанию \ (files\ MSU, MSI и MSP-файл).  
  
    Они определяются как `<ExtensionRules>`элементов в `<DefaultRules>`элемента. Имеется один `<Extension>`элемента для каждого типа файлов поддерживаемых по умолчанию. Общая структура XML выглядит следующим образом:  
  
    ```xml  
    <DefaultRules>  
        <ExtensionRules>  
          <Extension name="MSI">  
            <!-- Template and ExitConditions elements for installation of .msi files follow -->  
             ...  
          </Extension>  
          <Extension name="MSU">  
            <!-- Template and ExitConditions elements for installation of .msu files follow -->  
             ...  
          </Extension>  
          <Extension name="MSP">  
            <!-- Template and ExitConditions elements for installation of .msp files follow -->  
             ...  
          </Extension>  
             ...  
       </ExtensionRules>  
    </DefaultRules>  
    ```  
  
    Если необходимо применять обновления определенных типов ко всем узлам кластера в вашей среде, можно определить дополнительные `<Extension>`элементы.  
  
-   Исправления и другие файлы обновлений, которые не являются MSI, MSU или MSP-файлы, например, отличное Майкрософт драйверов, встроенного по и BIOS обновления.  
  
    Каждый тип файлов отличных от заданных по умолчанию настраивается как `<Folder>`элемент в `<FolderRules>`элемента. Атрибут имени элемента `<Folder>`элемент должен быть совпадает с именем вложенной папки в корневой папке исправлений, в которой будут содержаться обновления соответствующего типа. Папка может находиться в **CAUHotfix\_All** папке или в папке для определенного node\. Например если *FolderRule1* находится в корневой папке исправлений настроено, настройте следующий элемент в XML-файл, чтобы определить шаблон установки и условия выхода для обновлений в этой папке:  
  
    ```xml  
    <FolderRules>  
          <Folder name="FolderRule1">  
            <!-- Template and ExitConditions elements for installation of updates in FolderRule1 follow -->  
             ...  
          </Folder>  
          ...  
    </FolderRules>  
    ```  
  
В следующих таблицах описаны `<Template>`атрибуты и возможные `<ExitConditions>`дочерние элементы.  
  
|`<Template>` атрибут|Описание|  
|--------------------------|---------------|  
|`path`|Полный путь к программе установки для типа файлов, которые определены в `<Extension name>`атрибута.<br /><br />Чтобы указать путь к файлу обновления в структуре корневой папки исправлений, используйте `$update$`.|  
|`parameters`|Строка обязательными и необязательными параметрами для программы, указанной в `path`.<br /><br />Чтобы указать параметр, который содержит путь к файлу обновления в структуре корневой папки исправлений, используйте `$update$`.|  
  
|`<ExitConditions>` дочерний элемент|Описание|  
|---------------------------------|---------------|  
|`<Success>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления. Это обязательный дочерний элемент.|  
|`<Success_RebootRequired>`|При необходимости определяет один или несколько кодов выхода, указывающих на успешное применение обновления и необходимость перезапуска узла. <br>**Примечание:** при необходимости `<Folder>`элемент может содержать `alwaysReboot`атрибута. Если этот атрибут задан, он указывает, что при возвращении исправлением, устанавливаемым этим правилом, одного из кодов выхода, которые определены в `<Success>`, он интерпретируется как `<Success_RebootRequired>`условие выхода.|  
|`<Fail_RebootRequired>`|При необходимости определяет один или несколько кодов выхода, указывающих, сбой при применении обновления и необходимость перезапуска узла.|  
|`<AlreadyInstalled>`|При необходимости определяет один или несколько кодов выхода, указывающих, что обновление не было применено, так как оно уже установлено.|  
|`<NotApplicable>`|При необходимости определяет один или несколько кодов выхода, указывающих, что обновление не было применено, так как оно не применяется к узлу кластера.|  
  
> [!IMPORTANT]  
> Все коды выхода, которые не определены явным образом в `<ExitConditions>`, интерпретируются как коды сбоя обновления, и узел не перезапускается.  
  
### <a name="BKMK_ACL"></a>Ограничьте доступ к корневой папке исправлений  
Необходимо выполнить ряд действий по настройке файлового сервера и общей папке SMB для защиты файлам в корневой папке исправлений и файлу конфигурации для доступа только в контексте **Microsoft.HotfixPlugin **. Эти действия будет включен ряд функций, позволяющих защитить от несанкционированного доступа, файлы исправлений способом, который может поставить отказоустойчивый кластер.  
  
Ниже приведены общие шаги:  
  
1.  Определите учетную запись, используемая для выполнения прогонов обновления с помощью модулей в  
  
2.  Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB  
  
3.  Настройка разрешений на доступ к корневой папке исправлений  
  
4.  Настройка параметров для обеспечения целостности данных SMB  
  
5.  Включение правила брандмауэра Windows на сервере SMB  
  
#### <a name="step-1-identify-the-user-account-that-is-used-for-updating-runs-by-using-the-hotfix-plug-in"></a>Шаг 1. Определите учетную запись, используемая для выполнения прогонов обновления с помощью исправлений в модулей
  
Учетная запись, которая используется в CAU для проверки параметров безопасности при выполнении прогона обновления с помощью **Microsoft.HotfixPlugin** зависит ли кластерное обновление используется в режим обновления remote\ или в режиме обновления многоразовый следующим образом:  
  
-   **Режим обновления Remote\** учетной записи, которая обладает правами администратора на просмотр и применение обновлений в кластере.  
  
-   **Режим обновления многоразовый** имя виртуального объекта-компьютера, настроенного в Active Directory для CAU кластерной роли. Это имя предварительно подготовленного виртуальный объект-компьютер в Active Directory для кластерной роли CAU или имя, созданное компонентом CAU для кластерной роли. Чтобы узнать имя, созданное компонентом CAU, выполните **Get\-CauClusterRole** командлета PowerShell кластерного обновления. В выходных данных **ResourceGroupName** — это имя созданной виртуальный объект учетной записи компьютера.  
  
#### <a name="step-2-configure-this-user-account-in-the-necessary-groups-on-an-smb-file-server"></a>Шаг 2. Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB
  
> [!IMPORTANT]  
> Необходимо добавить учетную запись, используемую для выполнения прогонов обновления, учетная запись локального администратора на сервере SMB. Если это запрещено политиками безопасности в вашей организации, следует настройте эту учетную запись с необходимыми разрешениями на SMB-сервере с помощью следующей процедуры.  
  
##### <a name="to-configure-a-user-account-on-the-smb-server"></a>Настройка учетной записи пользователя на сервере SMB  
  
1.  Добавление учетной записи, используемой для выполнения прогонов обновления в группу Пользователи DCOM и одной из следующих групп: опытных пользователей, работы сервера или оператор печати.  
  
2.  Чтобы включить для учетной записи необходимые разрешения WMI, запустите консоль управления WMI на сервере SMB. Запустите PowerShell и введите следующую команду:  
  
    ```  
    wmimgmt.msc  
    ```  
  
3.  В дереве консоли щелкните правой кнопкой мыши **элемент управления WMI \(Local\)**, а затем нажмите кнопку **свойства **.  
  
4.  Нажмите кнопку **безопасности**, а затем разверните **корневой **.  
  
5.  Нажмите кнопку **CIMV2**, а затем нажмите кнопку **безопасности **.  
  
6.  Добавьте учетную запись, используемая для выполнения прогонов обновления для **имена групп или пользователей** списка.  
  
7.  Предоставьте **выполнение методов** и **включить удаленно** разрешения с учетной записью, которая используется для выполнения прогонов обновления.  
  
#### <a name="step-3-configure-permissions-to-access-the-hotfix-root-folder"></a>Шаг 3. Настройка разрешений на доступ к корневой папке исправлений
  
По умолчанию при попытке применить обновления, исправление, описанное в модулей проверяет конфигурацию разрешения файловой системы NTFS для доступа к корневой папке исправлений. Разрешения на доступ к папке настроены неправильно, прогона обновления с помощью исправлений в модулей может завершиться сбоем.  
  
Если вы используете конфигурацию по умолчанию исправление, описанное в модулей, убедитесь, что права доступа к папкам отвечают следующим требованиям.  
  
-   Группа "пользователи" имеет разрешение на чтение.  
  
-   Если модулей в будет применять обновления с расширением .exe, группы "пользователи" имеет разрешение на выполнение.  
  
-   Разрешены только некоторые субъекты безопасности \ (но не required\) в записи или изменить разрешения. Субъектам относятся локальных Администраторы группы, система, Создатель-владелец и TrustedInstaller. Остальные учетные записи и группы не допускаются в записи или изменить разрешения для корневой папки исправлений.  
  
При необходимости можно отключить предварительные проверки, выполняемые модулей в по умолчанию. Этого одним из двух способов:  
  
-   При использовании командлетов CAU PowerShell, настройте **DisableAclChecks\ = 'True'** аргумент в **CauPluginArguments** исправлений в модулей.  
  
-   Если вы используете пользовательский Интерфейс CAU, выберите **отключить проверку административного доступа к корневой папке и файлу конфигурации исправлений** вариант на **Дополнительные параметры обновления** странице мастера, который используется для настройки параметров прогона обновления.  
  
Тем не менее рекомендуется в большинстве сред мы рекомендуем использовать конфигурацию по умолчанию для принудительного выполнения этих проверок.  
  
#### <a name="step-4-configure-settings-for-smb-data-integrity"></a>Шаг 4. Настройка параметров для обеспечения целостности данных SMB
  
Для проверки целостности данных, передаваемых через соединения между узлами кластера и общей папки SMB, исправление, описанное в модулей требует включения параметров в файловом ресурсе SMB для подписания SMB или шифрования SMB. Шифрование SMB, обеспечивающее улучшенную защиту и более высокую производительность во многих средах, поддерживается начиная с Windows Server 2012. Можно включить один или оба этих параметра, как показано ниже:  
  
-   Чтобы включить подписывание SMB, см. процедуру в [статья 887429](http://support.microsoft.com/kb/887429) базы знаний Майкрософт.  
  
-   Чтобы включить шифрование SMB для общей папки SMB, выполните следующий командлет PowerShell на сервере SMB:  
  
    ```PowerShell  
    Set-SmbShare <ShareName> -EncryptData $true  
    ```  
  
    Где <*Имя_общего_ресурса*> — имя общей папки SMB.  
  
Принудительное шифрование SMB для подключений к SMB-серверу, можно также выбрать **требовать шифрования SMB при доступе к корневой папке исправлений** в пользовательском Интерфейсе CAU или настроить **RequireSMBEncryption\ = 'True'** аргумент модулей с помощью командлетов PowerShell кластерного обновления.  
  
> [!IMPORTANT]  
> Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для подключений, использующих шифрование SMB, обновление будет выполнено.  
  
#### <a name="step-5-enable-a-windows-firewall-rule-on-the-smb-server"></a>Шаг 5. Включение правила брандмауэра Windows на сервере SMB
  
Необходимо включить **\(SMB\-in\) удаленное управление файловым сервером** правило брандмауэра Windows на файловом сервере SMB. Этот параметр включен по умолчанию в Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012.  
  
## <a name="see-also"></a>См. также:  
  
-   [Обзор обновления с поддержкой кластера](cluster-aware-updating.md)
  
-   [Кластерное обновление командлеты Windows PowerShell](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating)  
  
-   [Кластерное обновление Справочник по подключаемым модулям](http://msdn.microsoft.com/library/hh418084.aspx)  
  
