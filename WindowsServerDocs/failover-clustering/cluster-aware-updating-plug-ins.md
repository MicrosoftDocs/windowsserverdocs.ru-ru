---
ms.assetid: d44d4430-41e2-483a-9685-92610cdef32a
title: Как работают подключаемые модули обновления с поддержкой кластера
ms.topic: article
ms.prod: windows-server
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 04/28/2017
ms.technology: storage-failover-clustering
description: Как использовать подключаемые модули для координации обновлений при использовании кластерного обновления в Windows Server для установки обновлений в кластере.
ms.openlocfilehash: f6c572a397530704dd91d9c67c5c1758ccc085c4
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71361290"
---
# <a name="how-cluster-aware-updating-plug-ins-work"></a>Как работают подключаемые модули обновления с поддержкой кластера

>Область применения: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

[Кластерное обновление](cluster-aware-updating.md) (Cau) использует подключаемые модули для координации установки обновлений между узлами в отказоустойчивом кластере. В этом разделе приводятся сведения об использовании построенных\-в\-ах подключаемых модулей CAU или других подключаемых\-, устанавливаемых для CAU.

## <a name="BKMK_INSTALL"></a>Установка подключаемого\-в  
\-Plug\-, которые устанавливаются вместе с CAU \(**Microsoft. виндовсупдатеплугин** и **Microsoft.\) хотфиксплугин** , должны устанавливаться отдельно. Если CAU используется в режиме само\-обновления, то\-подключаемого модуля должны быть установлены на всех узлах кластера. Если в режиме удаленного обновления\-используется CAU, подключаемый модуль\-должен быть установлен на компьютере с удаленным координатором обновлений. Устанавливаемый подключаемый\-может иметь дополнительные требования к установке на каждом узле.  
  
Чтобы установить подключаемый модуль\-в, следуйте инструкциям из\-подключаемого модуля в Publisher. Чтобы вручную зарегистрировать\-подключения в с помощью CAU, выполните командлет [Register-кауплугин](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/register-cauplugin) на каждом компьютере, где установлен подключаемый модуль\-.  
  
## <a name="specify-a-plug-in-and-plug-in-arguments"></a>Укажите\-Plug and\-в аргументах  
  
### <a name="specify-a-cau-plug-in"></a>Укажите\-подключения CAU в

В пользовательском интерфейсе CAU можно выбрать подключаемый\-в\-списке доступных\-подключаемых модулей при использовании CAU для выполнения следующих действий.  
  
-   применение обновлений к кластеру;  
  
-   просмотр обновлений для кластера;  
  
-   Настройка параметров обновления самостоятельного\-кластера  
  
По умолчанию CAU выбирает подключаемый\-в **Microsoft. виндовсупдатеплугин**. Однако можно указать любой подключаемый\-в, установленный и зарегистрированный с помощью CAU.

> [!TIP]  
> В пользовательском интерфейсе CAU можно указать только один подключаемый\-в, чтобы использовать для предварительного просмотра или применять обновления во время прогона обновления. С помощью командлетов PowerShell для CAU можно указать один или несколько подключаемых\-. Если необходимо установить несколько типов обновлений в кластере, то, как правило, более эффективно указывать несколько модулей Plug\-в одном прогоне обновления, а не использовать отдельный прогон обновления для каждого подключаемого\-в. Это позволяет, к примеру, уменьшить число перезагрузок узлов.

С помощью командлетов PowerShell для CAU, перечисленных в следующей таблице, можно указать один или несколько подключаемых\-для прогона обновления или сканирования, передав параметр **– кауплугиннаме** . Можно указать несколько подключаемых\-в именах, разделяя их запятыми. Если задано несколько\-ов Plug and Play, можно также управлять влиянием подключаемых модулей\-в ходе прогона обновления, указав параметры **\-рунплугинссериалли**, **\-Стопонплугинфаилуре**и **– сепаратеребутс** . Дополнительные сведения об использовании нескольких подключаемых модулей\-см. в документации по командлетам, приведенным в следующей таблице.  
  
|Командлет|Описание|  
|----------|---------------|  
|[Add-Кауклустерроле](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/add-cauclusterrole)|Добавляет кластерную роль CAU, которая предоставляет функции обновления самостоятельного\-для указанного кластера.|  
|[Invoke-Каурун](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/invoke-caurun)|Проверяет наличие обновлений для узлов кластера и устанавливает их посредством прогона обновления в указанном кластере.|  
|[Invoke-Каускан](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/invoke-causcan)|Проверяет наличие обновлений для узлов кластера и возвращает список начального набора обновлений, которые будут применены к каждому узлу указанного кластера.|  
|[Set-Кауклустерроле](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/set-cauclusterrole)|Задает свойства конфигурации для кластерной роли CAU в указанном кластере.|  
  
Если вы не укажете в параметре командлеты CAU,\-, то по умолчанию используется подключаемый\-в **Microsoft. виндовсупдатеплугин**.  
  
### <a name="specify-cau-plug-in-arguments"></a>Указание\-подключения CAU в аргументах  
При настройке параметров прогона обновления можно указать одну или несколько пар " *имя\=значение* " \(аргументов\) для выбранного подключаемого\-в для использования. Например, в пользовательском интерфейсе CAU можно указать несколько аргументов следующим образом.  
  
**Name1\=значение1; Имя2\=value2; Имя3\=значение3**  
  
Эти пары " *имя\=значение* " должны быть осмыслены для указанного\-подключаемого модуля. Для некоторых подключаемых\-аргументы являются необязательными.  
  
Синтаксис модуля\-CAU в аргументах соответствует следующим общим правилам.  
  
-   Несколько пар " *имя\=значений* " разделяются точками с запятой.  
  
-   Значение, содержащее пробелы, заключено в кавычки, например: **Name1\="значение с пробелами"** .  
  
-   Точный синтаксис *значения* зависит от подключаемого\-в.  
  
Чтобы указать Plug\-в аргументах с помощью командлетов PowerShell CAU, поддерживающих параметр **– кауплугинпараметерс** , передайте параметр формы:  
  
**\-Кауплугинаргументс @ {name1\=value1; Имя2\=value2; Имя3\=значение3}**  
  
Можно также использовать предопределенную хэш-таблицу PowerShell. Чтобы указать в аргументах\-Plug\-для нескольких подключаемых модулей, передайте несколько хэш-таблиц аргументов, разделенных запятыми. Передайте\-Plug-in в аргументах в\-в подключаемом модуле в порядке, указанном в **кауплугиннаме**.  
  
### <a name="specify-optional-plug-in-arguments"></a>Укажите необязательный\-подключения в аргументах  
Подключаемые\-, устанавливаемые CAU \(**Microsoft. виндовсупдатеплугин** и **microsoft. хотфиксплугин**\) предоставляют дополнительные параметры, которые можно выбрать. В пользовательском интерфейсе CAU они отображаются на странице **дополнительных параметров** после настройки обновления параметров выполнения для подключаемого\-в. Если вы используете командлеты PowerShell CAU, эти параметры настраиваются как необязательные\-подключения в аргументах. Дополнительные сведения см. в разделах [Использование подключаемого модуля Microsoft.WindowsUpdatePlugin](#BKMK_WUP) и [Использование подключаемого модуля Microsoft.HotfixPlugin](#BKMK_HFP) далее в этой статье.  
  
## <a name="manage-plug-ins-using-windows-powershell-cmdlets"></a>Управление подключаемыми модулями\-с помощью командлетов Windows PowerShell  
  
|Командлет|Описание|  
|----------|---------------|  
|[Get-Кауплугин](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/get-cauplugin)|Извлекает сведения об одном или нескольких\-обновления программного обеспечения, зарегистрированных на локальном компьютере.|  
|[Register-Кауплугин]((https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/register-cauplugin))|Регистрирует\-обновления программного обеспечения CAU на локальном компьютере.|  
|[Отмена регистрации — Кауплугин](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/unregister-cauplugin)|Удаляет\-обновления программного обеспечения из списка подключаемых\-, которые могут использоваться в CAU. **Примечание.** Не удается отменить регистрацию\-подключаемых модулей, установленных с помощью CAU \(**Microsoft. виндовсупдатеплугин** и\) **Microsoft. хотфиксплугин** .|  
  
## <a name="BKMK_WUP"></a>Использование Microsoft. Виндовсупдатеплугин  

\-подключения по умолчанию в для CAU, **Microsoft. виндовсупдатеплугин**выполняет следующие действия.
- Связывается с агентом обновления Windows в каждом узле отказоустойчивого кластера, чтобы применить обновления, необходимые для продуктов Майкрософт, которые выполняются в каждом узле.
- Устанавливает обновления кластера непосредственно из Центр обновления Windows или Центр обновления Майкрософт или с\-локального Windows Server Update Services \(WSUS\) Server.
- Устанавливает только выбранные, выпуски общего распространения \(GDR\) обновления. По умолчанию\-подключаемого модуля применяет только важные обновления программного обеспечения. Настройка не требуется. Конфигурация по умолчанию загружает и устанавливает важные обновления GDR в каждом узле. 

> [!NOTE]
> Чтобы применить обновления, отличные от важных обновлений программного обеспечения, выбранных по умолчанию \(например, обновления драйверов\), можно настроить необязательный подключаемый\-в параметре. Подробнее см. в подразделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="requirements"></a>Требования

- Компьютер с отказоустойчивым кластером и координатором удаленного обновления \(, если используется\) должны соответствовать требованиям для CAU и конфигурации, необходимой для удаленного управления, перечисленные в статье [требования и рекомендации для Cau](cluster-aware-updating-requirements.md).
- Изучите [рекомендации по применению обновлений Майкрософт](cluster-aware-updating-requirements.md#BKMK_BP_WUA), а затем внесите все необходимые изменения в конфигурацию Центра обновления Майкрософт для узлов отказоустойчивого кластера.
- Для получения наилучших результатов рекомендуется запустить CAU анализатор соответствия рекомендациям \(анализатором соответствия\) рекомендациям, чтобы убедиться, что кластер и среда обновления настроены правильно для применения обновлений с помощью CAU. Подробнее см. в подразделе [Проверка готовности к кластерному обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).

> [!NOTE]
> Обновления, требующие принятия условий лицензии Майкрософт или иных действий со стороны пользователя, исключаются. Их необходимо установить вручную.

### <a name="additional-options"></a>Дополнительные параметры

При необходимости можно указать следующие аргументы Plug\-в аргументах, чтобы расширить или ограничить набор обновлений, применяемых подключаемым\-в.
- Чтобы настроить подключаемый модуль\-в для применения рекомендуемых обновлений в дополнение к важным обновлениям на каждом узле, в пользовательском интерфейсе CAU на странице **Дополнительные параметры** установите флажок **предоставить Рекомендуемые обновления так же, как я получаю важные обновления** .
<br>Кроме того, можно настроить в аргументе **"инклудерекоммендедупдатес"\="true"** Plug\-.
- Чтобы настроить подключаемый модуль\-в для фильтрации типов обновлений GDR, применяемых к каждому узлу кластера, укажите строку запроса агента Центр обновления Windows с помощью аргумента подключения **QueryString**\-in. Подробнее см. в подразделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="BKMK_QUERY"></a>Настройка строки запроса агента Центр обновления Windows  
Вы можете настроить\-Plug\-в аргументе для подключаемого модуля по умолчанию в **Microsoft. виндовсупдатеплугин**, который состоит из Центр обновления Windows агента \(WUA\) строку запроса. В этой инструкции используется API WUA для определения одной или нескольких групп обновлений Майкрософт, которые должны быть применены к каждому узлу, на основе критериев выбора. Вы можете объединить несколько критериев с помощью логического И или логического ИЛИ. Строка запроса WUA указывается в аргументе Plug\-in следующим образом:  
  
**QueryString\="Criterion1\=value1 и\/или Criterion2\=value2 и\/или..."**  
  
Например, подключаемый модуль **Microsoft.WindowsUpdatePlugin** автоматически выбирает важные обновления с помощью аргумента **QueryString** по умолчанию, который составляется с помощью критериев **IsInstalled**, **Type**, **IsHidden** и **IsAssigned**.  
  
**QueryString\="устанавливаются\=0 и Type\=" Software "и Hidden\=0 и назначены\=1"**  
  
Если указать аргумент **QueryString** , то он будет использоваться вместо **строки запроса** по умолчанию, настроенной для\-Plug and in.  
  
#### <a name="example-1"></a>Пример 1
  
Настройка аргумента **QueryString** , устанавливающего определенное обновление, ОПРЕДЕЛЯЕМое идентификатором *f6ce46c1\-971c\-43f9\-a2aa\-783df125f003*:  
  
**QueryString\="UpdateID\=" f6ce46c1\-971c\-43f9\-a2aa\-783df125f003 "и установке\=0"**  
  
> [!NOTE]  
> Предыдущий пример является допустимым для применения обновлений с помощью мастера обновления с поддержкой\-кластера. Если вы хотите установить конкретное обновление, настроив параметры само\-обновления в пользовательском интерфейсе CAU или с помощью командлета PowerShell **Add\-кауклустерроле** или **Set\-кауклустерроле**, необходимо отформатировать значение UpdateID с помощью двух одинарных\-символов кавычек:  
>   
> **QueryString\="UpdateID\=" "f6ce46c1\-971c\-43f9\-a2aa\-783df125f003" "и установке\=0"**  
  
#### <a name="example-2"></a>Пример 2
  
Чтобы настроить аргумент **QueryString**, устанавливающий только драйверы, укажите следующую строку.  
  
**QueryString\="устанавливаются\=0 и Type\=" Driver "и Hidden\=0"**  
  
Дополнительные сведения о строках запросов для\-подключения по умолчанию в, **Microsoft. виндовсупдатеплугин**, условия поиска \(такие как **установленные**\), а также синтаксис, который можно включить в строки запроса, см. в разделе о критериях поиска в [справочнике по API агента Центр обновления Windows (WUA)](https://go.microsoft.com/fwlink/p/?LinkId=223304).  
  
## <a name="BKMK_HFP"></a>Использование Microsoft. Хотфиксплугин  
\-Plug and the **Microsoft. хотфиксплугин** можно использовать для применения ограниченного дистрибутива Майкрософт \(LDR\) обновления \(также называются исправлениями, и ранее они назывались\)ми QFE, которые загружаются независимо для устранения конкретных проблем с программным обеспечением Майкрософт. Подключаемый модуль устанавливает обновления из корневой папки на общем файловом ресурсе SMB и может быть настроена для применения не\-драйвера Майкрософт, встроенного по и обновлений BIOS.

> [!NOTE]
> Исправления иногда доступны для загрузки из корпорации Майкрософт в статьях базы знаний, но они также предоставляются клиентам по мере необходимости\-.

### <a name="requirements"></a>Требования

- Компьютер с отказоустойчивым кластером и координатором удаленного обновления \(, если используется\) должны соответствовать требованиям для CAU и конфигурации, необходимой для удаленного управления, перечисленные в статье [требования и рекомендации для Cau](cluster-aware-updating-requirements.md).
- Изучите [рекомендации по использованию подключаемого модуля Microsoft.HotfixPlugin](cluster-aware-updating-requirements.md#BKMK_BP_HF).
- Для получения наилучших результатов рекомендуется запустить анализатор соответствия рекомендациям CAU \(анализатора\) BPA, чтобы обеспечить правильную настройку кластера и среды обновления для применения обновлений с помощью CAU. Подробнее см. в подразделе [Проверка готовности к кластерному обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).
- Получите обновления от издателя и скопируйте их или извлеките в блок сообщений сервера, \(SMB\) общую папку \(исправления\), которая поддерживает по меньшей мере SMB 2,0 и доступна для всех узлов кластера и компьютера координатора удаленного обновления \(, если CAU используется в режиме удаленного\-обновления\). Подробнее см. в подразделе [Настройка структуры корневой папки с исправлениями](#BKMK_HF_ROOT) далее в этом разделе. 

    > [!NOTE]
    > По умолчанию этот подключаемый\-в устанавливает только исправления со следующими расширениями имен файлов: MSU, MSI и MSP.

- Скопируйте файл Дефаулсотфиксконфиг. XML \(, который находится в папке **% systemroot%\\System32\\WindowsPowerShell\\v 1.0\\modules\\клустеравареупдатинг** , на компьютере, где установлены средства Cau\), в корневую папку исправлений, которую вы создали и в которой были извлечены исправления. Например, скопируйте файл конфигурации в *\\\\мифилесервер\\исправления\\корневой\\* . 

    > [!NOTE]
    > Для установки большинства исправлений от корпорации Майкрософт и других обновлений файл конфигурации исправлений по умолчанию можно использовать без изменений. Если этого требует сценарий, вы можете дополнительно настроить файл конфигурации. Файл конфигурации может включать настраиваемые правила, например, для обработки файлов исправлений с конкретными расширениями или для определения поведения конкретных условий выхода. Подробнее см. в подразделе [Настройка файла конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.

### <a name="configuration"></a>Конфигурация

Настройте указанные ниже параметры. Чтобы получить дополнительную информацию, воспользуйтесь ссылками на дальнейшие подразделы этого раздела.
- Путь к общей корневой папке с исправлениями, которая содержит применяемые обновления и файл конфигурации исправлений. Этот путь можно ввести в пользовательском интерфейсе CAU или настроить **хотфиксрутфолдерпас\=\<путь >** PowerShell Plug\-in. 

   > [!NOTE]
   > Корневую папку исправлений можно указать как путь к локальной папке или UNC-путь к форме *\\\\ServerName\\Share\\рутфолдернаме*. Можно использовать путь к доменному\-у или изолированному пространству имен DFS. Однако\-подключаемых модулей в компонентах, которые проверяют права доступа в файле конфигурации исправления, несовместимы с путем к пространству имен DFS, поэтому при его настройке необходимо отключить проверку разрешений на доступ с помощью пользовательского интерфейса CAU или настроить в аргументе **дисаблеаклчеккс\="true"** Plug\-.
- Параметры на сервере, на котором размещается корневая папка исправления, для проверки соответствующих разрешений на доступ к папке и обеспечения целостности данных, доступ к которым осуществляется из общей папки SMB \(подписывания SMB или\)шифрования SMB. Дополнительные сведения см. в разделе [Ограничение доступа к корневой папке с исправлениями](#BKMK_ACL).

### <a name="additional-options"></a>Дополнительные параметры

- При необходимости настройте подключаемый\-в, чтобы при доступе к данным из файлового ресурса исправления применяется шифрование SMB. В пользовательском интерфейсе CAU на странице **Дополнительные параметры** выберите параметр **требовать шифрование SMB при доступе к корневой папке исправления** или настройте в аргументе **рекуиресмбенкриптион\="true"** PowerShell Plug\-. 
  > [!IMPORTANT]
  > Чтобы включить проверку целостности данных SMB с использованием подписания или шифрования SMB, необходимо выполнить дополнительные действия по настройке на SMB-сервере. Подробнее см. в шаге 4 в подразделе [Ограничение доступа к корневой папке с исправлениями](#BKMK_ACL). Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление не будет выполнено.
- Вы можете отключить выполняющиеся по умолчанию проверки достаточности разрешений на доступ к корневой папке исправлений и файлу конфигурации исправлений. В пользовательском интерфейсе CAU установите флажок **отключить проверку доступа администратора к корневой папке исправления и файлу конфигурации**или настройте для параметра **Дисаблеаклчеккс\="True"** Plug\-in.
- Кроме того, можно настроить аргумент **хотфиксинсталлертимеаутминутес\=<Integer>** , чтобы указать, как долго подключаемые\-исправлений должны возвращать процесс установщика исправлений. \(значение по умолчанию — 30 минут.\) например, чтобы задать период ожидания в два часа, установите **хотфиксинсталлертимеаутминутес\=120**.
- При необходимости настройте параметр **хотфиксконфигфиленаме \= <name>** Plug\-in, чтобы указать имя файла конфигурации исправления, расположенного в корневой папке исправления. Если он не указан, используется имя по умолчанию DefaultHotfixConfig.xml.
  
### <a name="BKMK_HF_ROOT"></a>Настройка структуры корневых папок исправлений

Чтобы подключаемый модуль исправления\-работал, исправления должны храниться в хорошо\-определенной структуре в файловый ресурс SMB \(корневой папке исправления\). Кроме того, необходимо\-настроить подключение к корневой папке исправления с помощью пользовательского интерфейса CAU или командлетов PowerShell CAU. Этот путь передается в подключаемый\-в в качестве аргумента **хотфиксрутфолдерпас** . Для корневой папки исправлений можно выбрать одну из нескольких структур в соответствии с потребностями в обновлении, как показано в примерах ниже. Файлы и папки, которые не соответствуют структуре, игнорируются.  
  
#### <a name="example-1---folder-structure-used-to-apply-hotfixes-to-all-cluster-nodes"></a>Пример 1. Структура папок, используемая для применения исправлений ко всем узлам кластера
  
Чтобы указать, что исправления применяются ко всем узлам кластера, скопируйте их в папку с именем **каухотфикс\_все** в корневой папке исправлений. В этом примере аргумент **хотфиксрутфолдерпас** Plug\-in имеет значение *\\\\мифилесервер\\исправлений\\корневой\\* . В папке **каухотфикс\_ALL** содержатся три обновления с расширениями MSU, MSI и MSP, которые будут применяться ко всем узлам кластера. Имена файлов обновлений приведены только для иллюстрации.  
  
> [!NOTE]  
> В этом и последующих примерах файл конфигурации исправлений с именем по умолчанию DefaultHotfixConfig.xml находится в требуемом месте в корневой папке исправлений.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
```  
  
#### <a name="example-2---folder-structure-used-to-apply-certain-updates-only-to-a-specific-node"></a>Пример 2. Структура папок, используемая для применения определенных обновлений только к определенному узлу
  
Чтобы применить обновления только к определенному узлу, используйте вложенную папку с именем узла в корневой папке исправлений. Используйте NetBIOS-имя узла кластера, например *ContosoNode1*. Затем переместите в эту вложенную папку обновления, которые необходимо применить только к этому узлу. В следующем примере аргумент **хотфиксрутфолдерпас** Plug\-in имеет значение *\\\\мифилесервер\\исправлений\\корневой\\* . Обновления в папке **каухотфикс\_ALL** будут применены ко всем узлам кластера, а *Node1\_конкретно\_Update. msu* будут применяться только к *ContosoNode1*.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
   ContosoNode1\   
      Node1_Specific_Update.msu   
      ...  
```  
  
#### <a name="example-3---folder-structure-used-to-apply-updates-other-than-msu-msi-and-msp-files"></a>Пример 3. Структура папок, используемая для применения обновлений, отличных от файлов MSU, MSI и MSP
  
По умолчанию подключаемый модуль **Microsoft.HotfixPlugin** применяет обновления только с расширениями MSU, MSI и MSP. Однако некоторые обновления могут иметь другие расширения и требовать других команд для установки. Например, может потребоваться применить обновление встроенного ПО с расширением EXE к узлу кластера. Корневую папку исправлений можно настроить с помощью вложенной папки, указывающей на необходимость установки определенного типа обновления, не\-по умолчанию. Также необходимо настроить соответствующее правило установки для папки, которое определяет команду установки в элементе `<FolderRules>` XML-файла конфигурации исправлений.  
  
В следующем примере аргумент **хотфиксрутфолдерпас** Plug\-in имеет значение *\\\\мифилесервер\\исправлений\\корневой\\* . Несколько обновлений будут применены ко всем узлам кластера, а обновление встроенного ПО *SpecialHotfix1.exe* будет применено к узлу *ContosoNode1* с помощью правила *FolderRule1*. Подробнее о настройке правила *FolderRule1* в файле конфигурации исправлений см. в подразделе [Настройка файла конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
  
   ContosoNode1\   
      FolderRule1\  
          SpecialHotfix1.exe  
      ...  
```

### <a name="BKMK_CONFIG_FILE"></a>Настройка файла конфигурации исправления  
Файл конфигурации исправлений управляет тем, как подключаемый модуль **Microsoft.HotfixPlugin** устанавливает определенные типы исправлений в отказоустойчивом кластере. Схема XML файла конфигурации определяется в файле HotfixConfigSchema.xsd, который находится на компьютере с установленными средствами CAU в следующей папке:  
  
**% SystemRoot%\\system32\\WindowsPowerShell\\v 1.0\\modules\\папка Клустеравареупдатинг**  
  
Чтобы настроить файл конфигурации исправлений, скопируйте образец файла конфигурации DefaultHotfixConfig.xml из этого расположения в корневую папку исправлений и внесите в него изменения в соответствии со своим сценарием.  
  
> [!IMPORTANT]  
> Для применения большинства исправлений от корпорации Майкрософт и других обновлений файл конфигурации исправлений по умолчанию можно использовать без изменений. Настраивать файл конфигурации исправлений требуется только в особых сценариях использования.  
  
По умолчанию XML-файл конфигурации исправлений определяет правила установки и условия выхода для двух категорий исправлений.  
  
-   Файлы исправлений с расширениями, которые\-по умолчанию могут устанавливаться \(MSU, MSI и MSP\).  
  
    Они определяются как элементы `<ExtensionRules>` в элементе `<DefaultRules>`. Для каждого поддерживаемого по умолчанию типа файлов имеется один элемент `<Extension>` . Общая структура XML имеет следующий вид.  
  
    ```xml  
    <DefaultRules>  
        <ExtensionRules>  
          <Extension name="MSI">  
            <!-- Template and ExitConditions elements for installation of .msi files follow -->  
             ...  
          </Extension>  
          <Extension name="MSU">  
            <!-- Template and ExitConditions elements for installation of .msu files follow -->  
             ...  
          </Extension>  
          <Extension name="MSP">  
            <!-- Template and ExitConditions elements for installation of .msp files follow -->  
             ...  
          </Extension>  
             ...  
       </ExtensionRules>  
    </DefaultRules>  
    ```  
  
    Если необходимо применять обновления определенных типов ко всем узлам кластера в среде, можно определить дополнительные элементы `<Extension>` .  
  
-   Исправления или другие файлы обновлений, которые не являются файлами MSI, msu или MSP, например, не\-драйверы Майкрософт, встроенное по и обновления BIOS.  
  
    Каждый тип файлов, не\-по умолчанию, настраивается как элемент `<Folder>` в элементе `<FolderRules>`. Атрибут имени элемента `<Folder>` должен совпадать с именем вложенной папки в корневой папке исправлений, в которой будут содержаться обновления соответствующего типа. Папка может находиться в папке **каухотфикс\_ALL** или на узле\-конкретной папке. Например, если в корневой папке исправлений настроено правило *FolderRule1* , то, чтобы определить шаблон установки и условия выхода для обновлений в этой папке, настройте следующий элемент в XML-файле:  
  
    ```xml  
    <FolderRules>  
          <Folder name="FolderRule1">  
            <!-- Template and ExitConditions elements for installation of updates in FolderRule1 follow -->  
             ...  
          </Folder>  
          ...  
    </FolderRules>  
    ```  
  
В таблице ниже описываются атрибуты `<Template>` и возможные дочерние элементы `<ExitConditions>` .  
  
|Атрибут `<Template>`|Описание|  
|--------------------------|---------------|  
|`path`|Полный путь к программе установки для типа файлов, определенного в атрибуте `<Extension name>` .<br /><br />Чтобы указать путь к файлу обновления в структуре корневой папки исправлений, используйте элемент `$update$`.|  
|`parameters`|Строка с обязательными и необязательными параметрами для программы, указанной в атрибуте `path`.<br /><br />Чтобы задать параметр, который содержит путь к файлу обновления в структуре корневой папки исправлений, используйте элемент `$update$`.|  
  
|Дочерний элемент `<ExitConditions>`|Описание|  
|---------------------------------|---------------|  
|`<Success>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления. Это обязательный дочерний элемент.|  
|`<Success_RebootRequired>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления и необходимость перезапуска узла (необязательный дочерний элемент). <br>**Примечание.** При необходимости элемент `<Folder>` может содержать атрибут `alwaysReboot`. Если этот атрибут задан, он указывает на то, что при возвращении исправлением, устанавливаемым этим правилом, одного из кодов выхода, которые определены в дочернем элементе `<Success>`, он интерпретируется как условие выхода `<Success_RebootRequired>` .|  
|`<Fail_RebootRequired>`|Определяет один или несколько кодов выхода, указывающих на сбой при применении обновления и необходимость перезапуска узла (необязательный дочерний элемент).|  
|`<AlreadyInstalled>`|Определяет один или несколько кодов выхода, указывающих на то, что обновление не было применено, так как оно уже установлено (необязательный дочерний элемент).|  
|`<NotApplicable>`|Определяет один или несколько кодов выхода, указывающих на то, что обновление не было применено, так как оно не требуется для этого узла кластера (необязательный дочерний элемент).|  
  
> [!IMPORTANT]  
> Все коды выхода, которые не определены явным образом в элементе `<ExitConditions>` , интерпретируются как коды сбоя обновления, и узел не перезапускается.  
  
### <a name="BKMK_ACL"></a>Ограничение доступа к корневой папке исправления  
Чтобы доступ к файлам в корневой папке исправлений и файлу конфигурации исправлений был возможен только в контексте подключаемого модуля **Microsoft.HotfixPlugin**, необходимо выполнить ряд действий по настройке файлового сервера и общей папки SMB. При этом будет включен ряд функций, позволяющих защитить файлы исправлений от несанкционированного доступа, который может поставить отказоустойчивый кластер под угрозу.  
  
Общий порядок действий.  
  
1.  Укажите учетную запись пользователя, используемую для обновления запусков с помощью подключаемого\-в  
  
2.  Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB  
  
3.  Настройка разрешений на доступ к корневой папке исправлений  
  
4.  Настройка параметров для обеспечения целостности данных SMB  
  
5.  Включение правила брандмауэра Windows на сервере SMB  
  
#### <a name="step-1-identify-the-user-account-that-is-used-for-updating-runs-by-using-the-hotfix-plug-in"></a>Шаг 1. Укажите учетную запись пользователя, используемую для обновления запусков с помощью подключаемого модуля\-исправлений в
  
Учетная запись, используемая в CAU для проверки параметров безопасности во время выполнения прогона обновления с помощью **Microsoft. хотфиксплугин** , зависит от того, используется ли Cau в режиме удаленного\-обновления или в режиме само\-обновления, как показано ниже.  
  
-   **Режим обновления удаленного\-** Учетная запись с правами администратора в кластере для предварительного просмотра и применения обновлений.  
  
-   **Режим обновления само\-** Имя объекта виртуального компьютера, настроенного в Active Directory для кластерной роли CAU. Это либо имя виртуального объекта-компьютера, предварительно подготовленного в Active Directory для кластерной роли CAU, либо имя, созданное компонентом CAU для кластерной роли. Чтобы получить имя, если оно создано с помощью CAU, выполните командлет **Get\-кауклустерроле** Cau PowerShell. В выходных данных **ResourceGroupName** — это имя созданной учетной записи виртуального объекта-компьютера.  
  
#### <a name="step-2-configure-this-user-account-in-the-necessary-groups-on-an-smb-file-server"></a>Шаг 2. Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB
  
> [!IMPORTANT]  
> Необходимо добавить учетную запись, используемую для выполнения прогонов обновления, в группу локальных администраторов SMB-сервера. Если это запрещено политиками безопасности организации, настройте для этой учетной записи необходимые разрешения на SMB-сервере с помощью описанной ниже процедуры.  
  
##### <a name="to-configure-a-user-account-on-the-smb-server"></a>Настройка учетной записи пользователя на SMB-сервере  
  
1.  Добавьте учетную запись, которая используется для выполнения прогонов обновления, в группу "Пользователи DCOM" и одну из следующих групп: "Опытные пользователи", "Операторы сервера" или "Операторы печати".  
  
2.  Чтобы предоставить учетной записи необходимые разрешения WMI, запустите на SMB-сервере консоль управления WMI. Запустите PowerShell и введите следующую команду:  
  
    ```  
    wmimgmt.msc  
    ```  
  
3.  В дереве консоли щелкните правой кнопкой мыши\-**элемент управления WMI \(локальная\)** , а затем выберите пункт **свойства**.  
  
4.  Щелкните **Безопасность** и разверните элемент **Корень**.  
  
5.  Щелкните **CIMV2**, а затем выберите **Безопасность**.  
  
6.  Добавьте учетную запись, используемую для выполнения прогонов обновления, в список **Группы или пользователи**.  
  
7.  Предоставьте учетной записи, используемой для выполнения прогонов обновления, разрешения **Выполнение методов** и **Включить удаленно**.  
  
#### <a name="step-3-configure-permissions-to-access-the-hotfix-root-folder"></a>Шаг 3. Настройка разрешений на доступ к корневой папке исправлений
  
По умолчанию при попытке применить обновления\-установки исправления в проверяет настройку разрешений файловой системы NTFS для доступа к корневой папке исправления. Если разрешения на доступ к папке не настроены должным образом, прогон обновления, использующий подключаемый\-исправлений, может завершиться ошибкой.  
  
Если вы используете конфигурацию по умолчанию для\-подключаемого модуля исправления в, убедитесь, что разрешения на доступ к папке соответствуют следующим требованиям.  
  
-   Группа "Пользователи" имеет разрешение на чтение.  
  
-   Если подключаемый\-в будет применять обновления с расширением. exe, группа пользователей имеет разрешение выполнение.  
  
-   Только определенные субъекты безопасности разрешены \(но не являются обязательными\) разрешения на запись или изменение. К таким субъектам относятся группа локальных администраторов, СИСТЕМА, СОЗДАТЕЛЬ-ВЛАДЕЛЕЦ и TrustedInstaller. Остальные учетные записи и группы не могут иметь разрешения на запись и изменение для корневой папки исправлений.  
  
При необходимости можно отключить предыдущие проверки, которые по умолчанию выполняет\-Plug and in. Это можно сделать одним из двух способов:  
  
-   Если вы используете командлеты PowerShell для CAU, настройте аргумент **дисаблеаклчеккс\="true"** в параметре **кауплугинаргументс** для\-подключаемого модуля в.  
  
-   Если используется пользовательский интерфейс CAU, выберите параметр **Отключить проверку административного доступа к корневой папке и файлу конфигурации исправлений** на странице **Дополнительные параметры обновления** мастера, служащего для настройки параметров прогона обновления.  
  
Однако в большинстве сред мы рекомендуем использовать конфигурацию по умолчанию для принудительного выполнения этих проверок.  
  
#### <a name="step-4-configure-settings-for-smb-data-integrity"></a>Шаг 4. Настройка параметров для обеспечения целостности данных SMB
  
Чтобы проверить целостность данных в подключениях между узлами кластера и общим файловым ресурсом SMB, для подключения к под\-у исправления в необходимо включить параметры в файловом ресурсе SMB для подписывания SMB или шифрования SMB. Шифрование SMB, обеспечивающее повышенную безопасность и лучшую производительность во многих средах, поддерживается начиная с Windows Server 2012. Вы можете включить один или оба этих параметра, как указано ниже.  
  
-   Сведения о включении подписания SMB см. в процедуре, описанной в [статье 887429](https://support.microsoft.com/kb/887429) базы знаний Майкрософт.  
  
-   Чтобы включить шифрование SMB для общей папки SMB, выполните следующий командлет PowerShell на сервере SMB:  
  
    ```PowerShell  
    Set-SmbShare <ShareName> -EncryptData $true  
    ```  
  
    Где <*ShareName*> — это имя общей папки SMB.  
  
Кроме того, чтобы принудительно использовать шифрование SMB в подключениях к серверу SMB, выберите параметр **требовать шифрование SMB при доступе к корневой папке исправления** в пользовательском интерфейсе Cau или настройте\-**Рекуиресмбенкриптион\="true"** в аргументе с помощью командлетов PowerShell Cau.  
  
> [!IMPORTANT]  
> Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление не будет выполнено.  
  
#### <a name="step-5-enable-a-windows-firewall-rule-on-the-smb-server"></a>Шаг 5. Включение правила брандмауэра Windows на сервере SMB
  
Необходимо включить **Удаленное управление файловым сервером \(SMB\-в** правиле\)в брандмауэре Windows на файловом сервере SMB. Эта возможность включена по умолчанию в Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012.  
  
## <a name="see-also"></a>См. также  
  
-   [Обзор обновления с поддержкой кластера](cluster-aware-updating.md)
  
-   [Обновление командлетов Windows PowerShell с поддержкой кластера](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating)  
  
-   [Справочник по подключаемому модулю обновления с поддержкой кластера](https://msdn.microsoft.com/library/hh418084.aspx)  
  
