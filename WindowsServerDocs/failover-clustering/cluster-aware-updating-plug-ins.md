---
ms.assetid: d44d4430-41e2-483a-9685-92610cdef32a
title: Как работают подключаемые модули обновления с поддержкой кластера
ms.topic: article
ms.prod: windows-server
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 04/28/2017
ms.technology: storage-failover-clustering
description: Как использовать подключаемые модули для координации обновлений при использовании кластерного обновления в Windows Server для установки обновлений в кластере.
ms.openlocfilehash: f6c572a397530704dd91d9c67c5c1758ccc085c4
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71361290"
---
# <a name="how-cluster-aware-updating-plug-ins-work"></a>Как работают подключаемые модули обновления с поддержкой кластера

>Относится к: Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

[Кластерное обновление](cluster-aware-updating.md) (Cau) использует подключаемые модули для координации установки обновлений между узлами в отказоустойчивом кластере. В этом разделе содержатся сведения об использовании сборки @ no__t-0in CAU Plug @ no__t-1ins или другого подключаемого модуля @ no__t-2ins, установленного для CAU.

## <a name="BKMK_INSTALL"></a>Установка подключаемого модуля @ no__t-1in  
Подключаемый модуль @ no__t-0in, отличный от подключаемого модуля по умолчанию @ no__t-1ins, который устанавливается вместе с CAU \(**Microsoft. виндовсупдатеплугин** и **microsoft. хотфиксплугин**\), должен устанавливаться отдельно. Если CAU используется в режиме Self @ no__t-0updating, то необходимо установить Plug @ no__t-1in на всех узлах кластера. Если в удаленном режиме @ no__t-0updating используется CAU, то необходимо установить Plug @ no__t-1in на компьютере с координатором удаленного обновления. Устанавливаемый подключаемый модуль @ no__t-0in может иметь дополнительные требования к установке на каждом узле.  
  
Чтобы установить подключаемый модуль @ no__t-0in, следуйте инструкциям от издателя Plug @ no__t-1in. Чтобы вручную зарегистрировать подключаемый модуль @ no__t-0in с помощью CAU, выполните командлет [Register-кауплугин](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/register-cauplugin) на каждом компьютере, где установлена функция Plug @ no__t-2in.  
  
## <a name="specify-a-plug-in-and-plug-in-arguments"></a>Укажите аргументы "Plug @ no__t-0in" и "Plug @ no__t-1in"  
  
### <a name="specify-a-cau-plug-in"></a>Укажите подключаемый модуль CAU @ no__t-0in

В пользовательском интерфейсе CAU выберите Plug @ no__t-0in в списке Drop @ no__t-1down списка доступных подключаемых модулей @ no__t-2ins при использовании CAU для выполнения следующих действий.  
  
-   применение обновлений к кластеру;  
  
-   просмотр обновлений для кластера;  
  
-   Настройка параметров кластера Self @ no__t-0updating  
  
По умолчанию CAU выбирает подключаемый модуль @ no__t-0in **Microsoft. виндовсупдатеплугин**. Однако можно указать любой подключаемый модуль @ no__t-0in, установленный и зарегистрированный с помощью CAU.

> [!TIP]  
> В пользовательском интерфейсе CAU можно указать только один подключаемый модуль @ no__t-0in для CAU, который будет использоваться для предварительного просмотра или для применения обновлений во время прогона обновления. С помощью командлетов PowerShell для CAU можно указать один или несколько модулей Plug @ no__t-0ins. Если необходимо установить несколько типов обновлений в кластере, то, как правило, более эффективно указать несколько модулей Plug @ no__t-0ins в одном прогоне обновления, а не использовать отдельный прогон обновления для каждого из них: Plug @ no__t-1in. Это позволяет, к примеру, уменьшить число перезагрузок узлов.

С помощью командлетов PowerShell для CAU, перечисленных в следующей таблице, можно указать один или несколько параметров Plug @ no__t-0ins для прогона обновления или сканирования, передав параметр **– кауплугиннаме** . Можно указать несколько имен Plug @ no__t-0in, разделяя их запятыми. Если указать несколько модулей Plug @ no__t-0ins, можно также управлять тем, как Plug @ no__t-1ins влияет на друг друга во время прогона обновления, указав **\-RunPluginsSerially**, **\-StopOnPluginFailure**и **– сепаратеребутс** параметры. Дополнительные сведения об использовании нескольких командлетов @ no__t-0ins см. в следующей таблице.  
  
|Командлет|Описание|  
|----------|---------------|  
|[Add-Кауклустерроле](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/add-cauclusterrole)|Добавляет кластерную роль CAU, которая предоставляет функции Self @ no__t-0updating в указанный кластер.|  
|[Invoke-Каурун](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/invoke-caurun)|Проверяет наличие обновлений для узлов кластера и устанавливает их посредством прогона обновления в указанном кластере.|  
|[Invoke-Каускан](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/invoke-causcan)|Проверяет наличие обновлений для узлов кластера и возвращает список начального набора обновлений, которые будут применены к каждому узлу указанного кластера.|  
|[Set-Кауклустерроле](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/set-cauclusterrole)|Задает свойства конфигурации для кластерной роли CAU в указанном кластере.|  
  
Если вы не указали параметр Plug @ no__t-0in в CAU с помощью этих командлетов, по умолчанию используется подключаемый модуль @ no__t-1in **Microsoft. виндовсупдатеплугин**.  
  
### <a name="specify-cau-plug-in-arguments"></a>Укажите аргументы для подключаемого модуля CAU @ no__t-0in  
При настройке параметров прогона обновления можно указать одну или несколько пар " *имя @ no__t-1value* " \(arguments @ no__t-3 для использования выбранной функции Plug @ no__t-4in. Например, в пользовательском интерфейсе CAU можно указать несколько аргументов следующим образом.  
  
**Name1 @ no__t-1Value1; Имя2 @ no__t-2Value2; Имя3 @ no__t — 3Value3**  
  
Пары " *имя @ no__t-1value* " должны быть осмыслены для указанного модуля Plug @ no__t-2in. Для некоторых параметров Plug @ no__t-0ins аргументы являются необязательными.  
  
Синтаксис аргументов Plug @ no__t-0in в CAU соответствует следующим общим правилам.  
  
-   Несколько пар *Name @ no__t-1value* разделены точкой с запятой.  
  
-   Значение, содержащее пробелы, заключается в кавычки, например: **Name1 @ no__t-1 "значение с пробелами"** .  
  
-   Точный синтаксис *значения* зависит от класса Plug @ no__t-1in.  
  
Чтобы указать аргументы Plug @ no__t-0in с помощью командлетов PowerShell CAU, поддерживающих параметр **– кауплугинпараметерс** , передайте параметр формы:  
  
**\-CauPluginArguments @ {name1 @ no__t-2Value1; Имя2 @ no__t-3Value2; Имя3 @ no__t-4Value3}**  
  
Можно также использовать предопределенную хэш-таблицу PowerShell. Чтобы указать аргументы Plug @ no__t-0in для нескольких модулей Plug @ no__t-1in, передайте несколько хэш-таблиц аргументов, разделенных запятыми. Передайте аргументы Plug @ no__t-0in в порядке Plug @ no__t-1in, указанный в **кауплугиннаме**.  
  
### <a name="specify-optional-plug-in-arguments"></a>Укажите необязательные аргументы Plug @ no__t-0in  
Подключаемый модуль @ no__t-0ins, который CAU устанавливает \(**Microsoft. виндовсупдатеплугин** и **microsoft. хотфиксплугин**\), предоставляют дополнительные параметры, которые можно выбрать. В пользовательском интерфейсе CAU они отображаются на странице **Дополнительные параметры** после настройки обновления параметров выполнения для подключаемого модуля @ no__t-1in. При использовании командлетов CAU PowerShell эти параметры настраиваются как необязательные аргументы Plug @ no__t-0in. Дополнительные сведения см. в разделах [Использование подключаемого модуля Microsoft.WindowsUpdatePlugin](#BKMK_WUP) и [Использование подключаемого модуля Microsoft.HotfixPlugin](#BKMK_HFP) далее в этой статье.  
  
## <a name="manage-plug-ins-using-windows-powershell-cmdlets"></a>Управление подключаемым модулем @ no__t-0ins с помощью командлетов Windows PowerShell  
  
|Командлет|Описание|  
|----------|---------------|  
|[Get-Кауплугин](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/get-cauplugin)|Извлекает сведения об одном или нескольких обновлениях программного обеспечения, которые были зарегистрированы на локальном компьютере, с помощью подключаемого модуля @ no__t-0ins.|  
|[Register-Кауплугин]((https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/register-cauplugin))|Регистрирует программное обеспечение CAU с обновлением ключа @ no__t-0in на локальном компьютере.|  
|[Отмена регистрации — Кауплугин](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating/unregister-cauplugin)|Удаляет программное обновление Plug @ no__t-0in из списка подключаемых модулей @ no__t-1ins, которые могут использоваться в CAU. **Примечание.** Не удается отменить регистрацию командлета Plug @ no__t-0ins, устанавливаемого с CAU \(**Microsoft. виндовсупдатеплугин** и **microsoft. хотфиксплугин**\).|  
  
## <a name="BKMK_WUP"></a>Использование Microsoft. Виндовсупдатеплугин  

По умолчанию подключаемый модуль @ no__t-0in для CAU, **Microsoft. виндовсупдатеплугин**выполняет следующие действия.
- Связывается с агентом обновления Windows в каждом узле отказоустойчивого кластера, чтобы применить обновления, необходимые для продуктов Майкрософт, которые выполняются в каждом узле.
- Устанавливает обновления кластера непосредственно из Центр обновления Windows или Центр обновления Майкрософт или с сервера @ no__t-0premises Windows Server Update Services \(WSUS @ no__t-2.
- Устанавливает только выбранные, выпуски общего распространения \(GDR @ no__t-1. По умолчанию в параметре Plug @ no__t-0in применяются только важные обновления программного обеспечения. Настройка не требуется. Конфигурация по умолчанию загружает и устанавливает важные обновления GDR в каждом узле. 

> [!NOTE]
> Для применения обновлений, отличных от важных обновлений программного обеспечения, выбранных по умолчанию \(for, например, обновления драйверов @ no__t-1, можно настроить необязательный параметр Plug @ no__t-2in. Подробнее см. в подразделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="requirements"></a>Требования

- Отказоустойчивый кластер и компьютер координатора удаленного обновления \(if, используемые @ no__t-1, должны соответствовать требованиям для CAU и конфигурации, необходимой для удаленного управления в соответствии с [требованиями и рекомендациями для Cau](cluster-aware-updating-requirements.md).
- Изучите [рекомендации по применению обновлений Майкрософт](cluster-aware-updating-requirements.md#BKMK_BP_WUA), а затем внесите все необходимые изменения в конфигурацию Центра обновления Майкрософт для узлов отказоустойчивого кластера.
- Для получения наилучших результатов рекомендуется запустить CAU анализатор соответствия рекомендациям \(BPA @ no__t-1, чтобы обеспечить правильную настройку кластера и среды обновления для применения обновлений с помощью CAU. Подробнее см. в подразделе [Проверка готовности к кластерному обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).

> [!NOTE]
> Обновления, требующие принятия условий лицензии Майкрософт или иных действий со стороны пользователя, исключаются. Их необходимо установить вручную.

### <a name="additional-options"></a>Дополнительные параметры

При необходимости можно указать следующие аргументы Plug @ no__t-0in, чтобы расширить или ограничить набор обновлений, применяемых в подключаемом модуле @ no__t-1in:
- Чтобы настроить подключаемый модуль @ no__t-0in для применения рекомендуемых обновлений в дополнение к важным обновлениям на каждом узле, в пользовательском интерфейсе CAU на странице **Дополнительные параметры** установите флажок **предоставить Рекомендуемые обновления так же, как я получаю важные обновления** . Box.
<br>Кроме того, можно настроить аргумент Plug @ no__t-2in **"инклудерекоммендедупдатес" \= "true"** .
- Чтобы настроить подключаемый модуль @ no__t-0in для фильтрации типов обновлений GDR, применяемых к каждому узлу кластера, укажите строку запроса агента **Центр обновления Windows с помощью аргумента Plug @** no__t-2in. Подробнее см. в подразделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="BKMK_QUERY"></a>Настройка строки запроса агента Центр обновления Windows  
Можно настроить аргумент Plug @ no__t-0in для подключаемого модуля default @ no__t-1in, **Microsoft. виндовсупдатеплугин**, состоящего из Центр обновления Windows агента \(WUA @ no__t-4. В этой инструкции используется API WUA для определения одной или нескольких групп обновлений Майкрософт, которые должны быть применены к каждому узлу, на основе критериев выбора. Вы можете объединить несколько критериев с помощью логического И или логического ИЛИ. Строка запроса WUA задается в аргументе Plug @ no__t-0in следующим образом:  
  
**QueryString @ no__t-1 "Criterion1 @ no__t-2Value1 and @ no__t-3or Criterion2 @ no__t-4Value2 и @ no__t-5or..."**  
  
Например, подключаемый модуль **Microsoft.WindowsUpdatePlugin** автоматически выбирает важные обновления с помощью аргумента **QueryString** по умолчанию, который составляется с помощью критериев **IsInstalled**, **Type**, **IsHidden** и **IsAssigned**.  
  
**QueryString @ no__t-1 "installed @ no__t-20 и Type @ no__t-3'Software" и Hidden @ no__t-40 и присваивание @ no__t-51 "**  
  
Если указать аргумент **QueryString** , он будет использоваться вместо **строки запроса** по умолчанию, настроенной для Plug @ no__t-2in.  
  
#### <a name="example-1"></a>Пример 1
  
Настройка аргумента **QueryString** , устанавливающего определенное обновление, ОПРЕДЕЛЯЕМое идентификатором *f6ce46c1 @ no__t-2971c @ no__t-343f9 @ no__t-4a2aa @ no__t-5783df125f003*:  
  
**QueryString @ no__t-1 "UpdateID @ no__t-2'f6ce46c1 @ no__t-3971c @ no__t-443f9 @ no__t-5a2aa @ no__t-6783df125f003" и Installd @ no__t-70 "**  
  
> [!NOTE]  
> Предыдущий пример является допустимым для применения обновлений с помощью мастера обновления Cluster @ no__t-0Aware. Если вы хотите установить конкретное обновление, настроив параметры Self @ no__t-0updating в пользовательском интерфейсе CAU или с помощью командлета **Add @ no__t-2CauClusterRole** или **Set @ no__t-4CauClusterRole**PowerShell, необходимо отформатировать значение UpdateID с помощью двух один @ no__t-5quote символы:  
>   
> **QueryString @ no__t-1 "UpdateID @ no__t-2''f6ce46c1 @ no__t-3971c @ no__t-443f9 @ no__t-5a2aa @ no__t-6783df125f003" "и установке @ no__t-70"**  
  
#### <a name="example-2"></a>Пример 2
  
Чтобы настроить аргумент **QueryString**, устанавливающий только драйверы, укажите следующую строку.  
  
**QueryString @ no__t-1 "installed @ no__t-20 и Type @ no__t-3'Driver" и Hidden @ no__t-40 "**  
  
Дополнительные сведения о строках запросов для подключаемого модуля default @ no__t-0in, **Microsoft. виндовсупдатеплугин**, критерий поиска \(such **как @no__t**-4, а также синтаксис, который можно включить в строки запроса, см. в разделе. сведения о критериях поиска в [справочнике по API агента Центр обновления Windows (WUA)](https://go.microsoft.com/fwlink/p/?LinkId=223304).  
  
## <a name="BKMK_HFP"></a>Использование Microsoft. Хотфиксплугин  
Подключаемый модуль @ no__t-0in **Microsoft. хотфиксплугин** можно использовать для применения выпуска ограниченного распространения Microsoft \(LDR @ no__t-3 updates \(also, именуемых исправлениями, а ранее — QFE @ no__t-5, которые вы скачиваете независимо, чтобы устранить их. конкретные проблемы с программным обеспечением Майкрософт. Подключаемый модуль устанавливает обновления из корневой папки на файловом ресурсе SMB, а также может быть настроена для применения драйверов, отличных от @ no__t-0Microsoft, встроенного по и обновлений BIOS.

> [!NOTE]
> Исправления иногда доступны для загрузки из корпорации Майкрософт в статьях базы знаний, но они также предоставляются клиентам на базе AS @ no__t-0needed.

### <a name="requirements"></a>Требования

- Отказоустойчивый кластер и компьютер координатора удаленного обновления \(if, используемые @ no__t-1, должны соответствовать требованиям для CAU и конфигурации, необходимой для удаленного управления в соответствии с [требованиями и рекомендациями для Cau](cluster-aware-updating-requirements.md).
- Изучите [рекомендации по использованию подключаемого модуля Microsoft.HotfixPlugin](cluster-aware-updating-requirements.md#BKMK_BP_HF).
- Для получения наилучших результатов рекомендуется запустить модель CAU анализатор соответствия рекомендациям \(BPA @ no__t-1, чтобы обеспечить правильную настройку кластера и среды обновления для применения обновлений с помощью CAU. Подробнее см. в подразделе [Проверка готовности к кластерному обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).
- Получите обновления от издателя и скопируйте их или извлеките в блок сообщений сервера \(SMB @ no__t-1 файловый ресурс \(hotfix корневую папку @ no__t-3, поддерживающую по меньшей мере SMB 2,0 и доступную для всех узлов кластера и удаленного обновления. Компьютер координатора \(if CAU используется в удаленном режиме @ no__t-5updating @ no__t-6. Подробнее см. в подразделе [Настройка структуры корневой папки с исправлениями](#BKMK_HF_ROOT) далее в этом разделе. 

    > [!NOTE]
    > По умолчанию этот подключаемый модуль @ no__t-0in устанавливает только исправления со следующими расширениями имен файлов: MSU, MSI и MSP.

- Скопируйте файл Дефаулсотфиксконфиг. XML \(which в папке **% systemroot% \\System32 @ no__t-3WindowsPowerShell @ no__t-4V 1.0 @ no__t-5Modules @ no__t-** 6ClusterAwareUpdating на компьютере, где находятся средства Cau. Install @ no__t-7 в созданную корневую папку исправлений, в которой были извлечены исправления. Например, скопируйте файл конфигурации в *\\ @ no__t-2MyFileServer @ no__t-3Hotfixes @ no__t-4Root @ no__t-5*. 

    > [!NOTE]
    > Для установки большинства исправлений от корпорации Майкрософт и других обновлений файл конфигурации исправлений по умолчанию можно использовать без изменений. Если этого требует сценарий, вы можете дополнительно настроить файл конфигурации. Файл конфигурации может включать настраиваемые правила, например, для обработки файлов исправлений с конкретными расширениями или для определения поведения конкретных условий выхода. Подробнее см. в подразделе [Настройка файла конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.

### <a name="configuration"></a>Конфигурация

Настройте указанные ниже параметры. Чтобы получить дополнительную информацию, воспользуйтесь ссылками на дальнейшие подразделы этого раздела.
- Путь к общей корневой папке с исправлениями, которая содержит применяемые обновления и файл конфигурации исправлений. Этот путь можно ввести в пользовательском интерфейсе CAU или настроить аргумент **хотфиксрутфолдерпас @ no__t-1 @ no__t-2Path >** PowerShell Plug @ no__t-3in. 

   > [!NOTE]
   > Корневую папку исправлений можно указать как путь к локальной папке или путь в формате UNC к форме *\\ @ no__t-2ServerName @ no__t-3Share @ no__t-4RootFolderName*. Можно использовать путь к домену @ no__t-0based или изолированному пространству имен DFS. Однако функции Plug @ no__t-0in, которые проверяют разрешения на доступ в файле конфигурации исправления, несовместимы с путем пространства имен DFS, поэтому при его настройке необходимо отключить проверку разрешений на доступ с помощью пользовательского интерфейса CAU или настроить  **Аргумент Дисаблеаклчеккс @ no__t-2'True '** Plug @ no__t-3in.
- Параметры на сервере, на котором размещается корневая папка исправления, чтобы проверить наличие соответствующих разрешений на доступ к папке и обеспечить целостность данных, доступ к которым осуществляется из общей папки SMB \(SMB или шифрование SMB @ no__t-1. Дополнительные сведения см. в разделе [Ограничение доступа к корневой папке с исправлениями](#BKMK_ACL).

### <a name="additional-options"></a>Дополнительные параметры

- При необходимости настройте подключаемый модуль @ no__t-0in, чтобы при доступе к данным из файлового ресурса исправления принудительно применяется шифрование SMB. В пользовательском интерфейсе CAU на странице **Дополнительные параметры** выберите параметр **требовать шифрование SMB при доступе к корневой папке исправления** или настройте аргумент **рекуиресмбенкриптион @ no__t-3'True '** PowerShell Plug @ no__t-4in. 
  > [!IMPORTANT]
  > Чтобы включить проверку целостности данных SMB с использованием подписания или шифрования SMB, необходимо выполнить дополнительные действия по настройке на SMB-сервере. Подробнее см. в шаге 4 в подразделе [Ограничение доступа к корневой папке с исправлениями](#BKMK_ACL). Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление не будет выполнено.
- Вы можете отключить выполняющиеся по умолчанию проверки достаточности разрешений на доступ к корневой папке исправлений и файлу конфигурации исправлений. В пользовательском интерфейсе CAU выберите **отключить проверку доступа администратора к корневой папке исправления и файлу конфигурации**или настройте аргумент **дисаблеаклчеккс @ no__t-2'True '** Plug @ no__t-3in.
- При необходимости настройте аргумент **хотфиксинсталлертимеаутминутес @ no__t-1 @ no__t-2** , чтобы указать, как долго с помощью командлета Hotfix @ no__t-3in ожидается возврат к процессу установщика исправлений. \(The по умолчанию — 30 минут. \) Например, чтобы задать период ожидания в два часа, задайте **хотфиксинсталлертимеаутминутес @ no__t-1120**.
- При необходимости настройте аргумент **хотфиксконфигфиленаме \= <name>** Plug @ no__t-3in, чтобы указать имя файла конфигурации исправления, расположенного в корневой папке исправления. Если он не указан, используется имя по умолчанию DefaultHotfixConfig.xml.
  
### <a name="BKMK_HF_ROOT"></a>Настройка структуры корневых папок исправлений

Чтобы функция Plug and no__t-0in работала, исправления должны храниться в структуре @ no__t-1defined в файловом ресурсе SMB \(hotfix корневой папке @ no__t-3. Кроме того, необходимо настроить параметр Plug @ no__t-4in с путем к корневой папке исправлений с помощью пользовательского интерфейса CAU или командлеты PowerShell CAU. Этот путь передается в функцию Plug @ no__t-0in в качестве аргумента **хотфиксрутфолдерпас** . Для корневой папки исправлений можно выбрать одну из нескольких структур в соответствии с потребностями в обновлении, как показано в примерах ниже. Файлы и папки, которые не соответствуют структуре, игнорируются.  
  
#### <a name="example-1---folder-structure-used-to-apply-hotfixes-to-all-cluster-nodes"></a>Пример 1. Структура папок, используемая для применения исправлений ко всем узлам кластера
  
Чтобы указать, что исправления применяются ко всем узлам кластера, скопируйте их в папку с именем **каухотфикс @ no__t-1All** в корневой папке исправлений. В этом примере аргументу **хотфиксрутфолдерпас** Plug @ no__t-1in присваивается значение *\\ @ no__t-4MyFileServer @ no__t-5Hotfixes @ no__t-6Root @ no__t-7*. Папка **каухотфикс @ no__t-1All** содержит три обновления с расширениями MSU, MSI и MSP, которые будут применены ко всем узлам кластера. Имена файлов обновлений приведены только для иллюстрации.  
  
> [!NOTE]  
> В этом и последующих примерах файл конфигурации исправлений с именем по умолчанию DefaultHotfixConfig.xml находится в требуемом месте в корневой папке исправлений.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
```  
  
#### <a name="example-2---folder-structure-used-to-apply-certain-updates-only-to-a-specific-node"></a>Пример 2. Структура папок, используемая для применения определенных обновлений только к определенному узлу
  
Чтобы применить обновления только к определенному узлу, используйте вложенную папку с именем узла в корневой папке исправлений. Используйте NetBIOS-имя узла кластера, например *ContosoNode1*. Затем переместите в эту вложенную папку обновления, которые необходимо применить только к этому узлу. В следующем примере аргументу **хотфиксрутфолдерпас** Plug @ no__t-1in присваивается значение *\\ @ no__t-4MyFileServer @ no__t-5Hotfixes @ no__t-6Root @ no__t-7*. Обновления в папке **каухотфикс @ no__t-1All** будут применены ко всем узлам кластера, а *NODE1 @ no__t-3Specific\_Update.msu* будет применяться только к *ContosoNode1*.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
   ContosoNode1\   
      Node1_Specific_Update.msu   
      ...  
```  
  
#### <a name="example-3---folder-structure-used-to-apply-updates-other-than-msu-msi-and-msp-files"></a>Пример 3. Структура папок, используемая для применения обновлений, отличных от файлов MSU, MSI и MSP
  
По умолчанию подключаемый модуль **Microsoft.HotfixPlugin** применяет обновления только с расширениями MSU, MSI и MSP. Однако некоторые обновления могут иметь другие расширения и требовать других команд для установки. Например, может потребоваться применить обновление встроенного ПО с расширением EXE к узлу кластера. Корневую папку исправлений можно настроить с помощью вложенной папки, указывающей на необходимость установки определенного типа обновления, не являющегося параметром @ no__t-0default. Также необходимо настроить соответствующее правило установки для папки, которое определяет команду установки в элементе `<FolderRules>` XML-файла конфигурации исправлений.  
  
В следующем примере аргументу **хотфиксрутфолдерпас** Plug @ no__t-1in присваивается значение *\\ @ no__t-4MyFileServer @ no__t-5Hotfixes @ no__t-6Root @ no__t-7*. Несколько обновлений будут применены ко всем узлам кластера, а обновление встроенного ПО *SpecialHotfix1.exe* будет применено к узлу *ContosoNode1* с помощью правила *FolderRule1*. Подробнее о настройке правила *FolderRule1* в файле конфигурации исправлений см. в подразделе [Настройка файла конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
  
   ContosoNode1\   
      FolderRule1\  
          SpecialHotfix1.exe  
      ...  
```

### <a name="BKMK_CONFIG_FILE"></a>Настройка файла конфигурации исправления  
Файл конфигурации исправлений управляет тем, как подключаемый модуль **Microsoft.HotfixPlugin** устанавливает определенные типы исправлений в отказоустойчивом кластере. Схема XML файла конфигурации определяется в файле HotfixConfigSchema.xsd, который находится на компьютере с установленными средствами CAU в следующей папке:  
  
**% SystemRoot% \\System32 @ no__t-2WindowsPowerShell @ no__t-3V 1.0 @ no__t-4Modules @ no__t-5ClusterAwareUpdating папка**  
  
Чтобы настроить файл конфигурации исправлений, скопируйте образец файла конфигурации DefaultHotfixConfig.xml из этого расположения в корневую папку исправлений и внесите в него изменения в соответствии со своим сценарием.  
  
> [!IMPORTANT]  
> Для применения большинства исправлений от корпорации Майкрософт и других обновлений файл конфигурации исправлений по умолчанию можно использовать без изменений. Настраивать файл конфигурации исправлений требуется только в особых сценариях использования.  
  
По умолчанию XML-файл конфигурации исправлений определяет правила установки и условия выхода для двух категорий исправлений.  
  
-   Файлы исправлений с расширениями, которые Plug @ no__t-0in может установить по умолчанию @no__t -1. msu,. msi и MSP-файлы @ no__t – 2.  
  
    Они определяются как элементы `<ExtensionRules>` в элементе `<DefaultRules>`. Для каждого поддерживаемого по умолчанию типа файлов имеется один элемент `<Extension>` . Общая структура XML имеет следующий вид.  
  
    ```xml  
    <DefaultRules>  
        <ExtensionRules>  
          <Extension name="MSI">  
            <!-- Template and ExitConditions elements for installation of .msi files follow -->  
             ...  
          </Extension>  
          <Extension name="MSU">  
            <!-- Template and ExitConditions elements for installation of .msu files follow -->  
             ...  
          </Extension>  
          <Extension name="MSP">  
            <!-- Template and ExitConditions elements for installation of .msp files follow -->  
             ...  
          </Extension>  
             ...  
       </ExtensionRules>  
    </DefaultRules>  
    ```  
  
    Если необходимо применять обновления определенных типов ко всем узлам кластера в среде, можно определить дополнительные элементы `<Extension>` .  
  
-   Исправления или другие файлы обновлений, которые не являются файлами MSI, msu или MSP, например драйверы, не связанные с @ no__t-0Microsoft, встроенное по и обновления BIOS.  
  
    Каждый тип файлов, не являющихся @ no__t-0default, настраивается как элемент `<Folder>` в элементе `<FolderRules>`. Атрибут имени элемента `<Folder>` должен совпадать с именем вложенной папки в корневой папке исправлений, в которой будут содержаться обновления соответствующего типа. Папка может находиться в папке **каухотфикс @ no__t-1All** или в папке node @ no__t-2specific. Например, если в корневой папке исправлений настроено правило *FolderRule1* , то, чтобы определить шаблон установки и условия выхода для обновлений в этой папке, настройте следующий элемент в XML-файле:  
  
    ```xml  
    <FolderRules>  
          <Folder name="FolderRule1">  
            <!-- Template and ExitConditions elements for installation of updates in FolderRule1 follow -->  
             ...  
          </Folder>  
          ...  
    </FolderRules>  
    ```  
  
В таблице ниже описываются атрибуты `<Template>` и возможные дочерние элементы `<ExitConditions>` .  
  
|Атрибут `<Template>`|Описание|  
|--------------------------|---------------|  
|`path`|Полный путь к программе установки для типа файлов, определенного в атрибуте `<Extension name>` .<br /><br />Чтобы указать путь к файлу обновления в структуре корневой папки исправлений, используйте элемент `$update$`.|  
|`parameters`|Строка с обязательными и необязательными параметрами для программы, указанной в атрибуте `path`.<br /><br />Чтобы задать параметр, который содержит путь к файлу обновления в структуре корневой папки исправлений, используйте элемент `$update$`.|  
  
|Дочерний элемент `<ExitConditions>`|Описание|  
|---------------------------------|---------------|  
|`<Success>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления. Это обязательный дочерний элемент.|  
|`<Success_RebootRequired>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления и необходимость перезапуска узла (необязательный дочерний элемент). <br>**Примечание.** Элемент `<Folder>` может содержать атрибут `alwaysReboot`. Если этот атрибут задан, он указывает на то, что при возвращении исправлением, устанавливаемым этим правилом, одного из кодов выхода, которые определены в дочернем элементе `<Success>`, он интерпретируется как условие выхода `<Success_RebootRequired>` .|  
|`<Fail_RebootRequired>`|Определяет один или несколько кодов выхода, указывающих на сбой при применении обновления и необходимость перезапуска узла (необязательный дочерний элемент).|  
|`<AlreadyInstalled>`|Определяет один или несколько кодов выхода, указывающих на то, что обновление не было применено, так как оно уже установлено (необязательный дочерний элемент).|  
|`<NotApplicable>`|Определяет один или несколько кодов выхода, указывающих на то, что обновление не было применено, так как оно не требуется для этого узла кластера (необязательный дочерний элемент).|  
  
> [!IMPORTANT]  
> Все коды выхода, которые не определены явным образом в элементе `<ExitConditions>` , интерпретируются как коды сбоя обновления, и узел не перезапускается.  
  
### <a name="BKMK_ACL"></a>Ограничение доступа к корневой папке исправления  
Чтобы доступ к файлам в корневой папке исправлений и файлу конфигурации исправлений был возможен только в контексте подключаемого модуля **Microsoft.HotfixPlugin**, необходимо выполнить ряд действий по настройке файлового сервера и общей папки SMB. При этом будет включен ряд функций, позволяющих защитить файлы исправлений от несанкционированного доступа, который может поставить отказоустойчивый кластер под угрозу.  
  
Общий порядок действий.  
  
1.  Укажите учетную запись пользователя, используемую для обновления запусков с помощью функции Plug @ no__t-0in.  
  
2.  Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB  
  
3.  Настройка разрешений на доступ к корневой папке исправлений  
  
4.  Настройка параметров для обеспечения целостности данных SMB  
  
5.  Включение правила брандмауэра Windows на сервере SMB  
  
#### <a name="step-1-identify-the-user-account-that-is-used-for-updating-runs-by-using-the-hotfix-plug-in"></a>Шаг 1. Укажите учетную запись пользователя, используемую для обновления запусков с помощью пакета исправлений @ no__t-0in
  
Учетная запись, используемая в CAU для проверки параметров безопасности во время выполнения прогона обновления с помощью **Microsoft. хотфиксплугин** , зависит от того, используется ли Cau в удаленном режиме @ no__t-1updating или в режиме Self @ no__t-2updating, как показано ниже.  
  
-   **Remote @ no__t-1updating Mode** Учетная запись с правами администратора в кластере для предварительного просмотра и применения обновлений.  
  
-   **Режим Self @ no__t-1updating** Имя объекта виртуального компьютера, настроенного в Active Directory для кластерной роли CAU. Это либо имя виртуального объекта-компьютера, предварительно подготовленного в Active Directory для кластерной роли CAU, либо имя, созданное компонентом CAU для кластерной роли. Чтобы получить имя, если оно создано с помощью CAU, выполните командлет **Get @ no__t-1CauClusterRole** Cau PowerShell. В выходных данных **ResourceGroupName** — это имя созданной учетной записи виртуального объекта-компьютера.  
  
#### <a name="step-2-configure-this-user-account-in-the-necessary-groups-on-an-smb-file-server"></a>Шаг 2. Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB
  
> [!IMPORTANT]  
> Необходимо добавить учетную запись, используемую для выполнения прогонов обновления, в группу локальных администраторов SMB-сервера. Если это запрещено политиками безопасности организации, настройте для этой учетной записи необходимые разрешения на SMB-сервере с помощью описанной ниже процедуры.  
  
##### <a name="to-configure-a-user-account-on-the-smb-server"></a>Настройка учетной записи пользователя на SMB-сервере  
  
1.  Добавьте учетную запись, используемую для выполнения прогонов обновления, в группу "Пользователи DCOM" и в одну из следующих групп: "Опытные пользователи", "Операторы сервера" или "Операторы печати".  
  
2.  Чтобы предоставить учетной записи необходимые разрешения WMI, запустите на SMB-сервере консоль управления WMI. Запустите PowerShell и введите следующую команду:  
  
    ```  
    wmimgmt.msc  
    ```  
  
3.  В дереве консоли щелкните правой кнопкой мыши **элемент управления WMI no__t-0click \(Local @ no__t-3**и выберите пункт **свойства**.  
  
4.  Щелкните **Безопасность** и разверните элемент **Корень**.  
  
5.  Щелкните **CIMV2**, а затем выберите **Безопасность**.  
  
6.  Добавьте учетную запись, используемую для выполнения прогонов обновления, в список **Группы или пользователи**.  
  
7.  Предоставьте учетной записи, используемой для выполнения прогонов обновления, разрешения **Выполнение методов** и **Включить удаленно**.  
  
#### <a name="step-3-configure-permissions-to-access-the-hotfix-root-folder"></a>Шаг 3. Настройка разрешений на доступ к корневой папке исправлений
  
По умолчанию при попытке применить обновления пакет исправлений @ no__t-0in проверяет конфигурацию разрешений файловой системы NTFS для доступа к корневой папке исправления. Если разрешения на доступ к папке настроены неправильно, выполнение обновления с помощью функции Plug @ no__t-0in может завершиться ошибкой.  
  
При использовании конфигурации по умолчанию для установки исправления @ no__t-0in убедитесь, что разрешения на доступ к папке соответствуют следующим требованиям.  
  
-   Группа "Пользователи" имеет разрешение на чтение.  
  
-   Если подключаемый модуль @ no__t-0in будет применять обновления с расширением. exe, группа пользователей имеет разрешение выполнение.  
  
-   Только определенные субъекты безопасности разрешены \(but не требуются, чтобы иметь разрешение на запись или изменение. К таким субъектам относятся группа локальных администраторов, СИСТЕМА, СОЗДАТЕЛЬ-ВЛАДЕЛЕЦ и TrustedInstaller. Остальные учетные записи и группы не могут иметь разрешения на запись и изменение для корневой папки исправлений.  
  
При необходимости можно отключить предыдущие проверки, выполняемые по умолчанию для Plug @ no__t-0in. Это можно сделать одним из двух способов:  
  
-   Если вы используете командлеты PowerShell для CAU, настройте аргумент **дисаблеаклчеккс @ no__t-1'True '** в параметре **кауплугинаргументс** для параметра Plug @ no__t-3in.  
  
-   Если используется пользовательский интерфейс CAU, выберите параметр **Отключить проверку административного доступа к корневой папке и файлу конфигурации исправлений** на странице **Дополнительные параметры обновления** мастера, служащего для настройки параметров прогона обновления.  
  
Однако в большинстве сред мы рекомендуем использовать конфигурацию по умолчанию для принудительного выполнения этих проверок.  
  
#### <a name="step-4-configure-settings-for-smb-data-integrity"></a>Шаг 4. Настройка параметров для обеспечения целостности данных SMB
  
Чтобы проверить целостность данных в подключениях между узлами кластера и общей папкой SMB, для функции Plug @ no__t-0in необходимо включить параметры в файловом ресурсе SMB для подписывания SMB или шифрования SMB. Шифрование SMB, обеспечивающее повышенную безопасность и лучшую производительность во многих средах, поддерживается начиная с Windows Server 2012. Вы можете включить один или оба этих параметра, как указано ниже.  
  
-   Сведения о включении подписания SMB см. в процедуре, описанной в [статье 887429](https://support.microsoft.com/kb/887429) базы знаний Майкрософт.  
  
-   Чтобы включить шифрование SMB для общей папки SMB, выполните следующий командлет PowerShell на сервере SMB:  
  
    ```PowerShell  
    Set-SmbShare <ShareName> -EncryptData $true  
    ```  
  
    Где <*ShareName*> — это имя общей папки SMB.  
  
Кроме того, чтобы принудительно использовать шифрование SMB в подключениях к серверу SMB, выберите параметр **требовать шифрование SMB при доступе к корневой папке исправления** в пользовательском интерфейсе Cau или настройте **рекуиресмбенкриптион @ no__t-2'True '** Plug @ no__ аргумент t-3in с помощью командлетов PowerShell для CAU.  
  
> [!IMPORTANT]  
> Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление не будет выполнено.  
  
#### <a name="step-5-enable-a-windows-firewall-rule-on-the-smb-server"></a>Шаг 5. Включение правила брандмауэра Windows на сервере SMB
  
Необходимо включить правило **удаленного управления File Server \(SMB @ no__t-2in @ no__t-3** в брандмауэре Windows на файловом сервере SMB. Эта возможность включена по умолчанию в Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012.  
  
## <a name="see-also"></a>См. также  
  
-   [Обзор обновления с поддержкой кластера](cluster-aware-updating.md)
  
-   [Обновление командлетов Windows PowerShell с поддержкой кластера](https://docs.microsoft.com/en-us/powershell/module/clusterawareupdating)  
  
-   [Справочник по подключаемому модулю обновления с поддержкой кластера](https://msdn.microsoft.com/library/hh418084.aspx)  
  
