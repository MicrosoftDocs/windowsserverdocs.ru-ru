---
ms.assetid: d44d4430-41e2-483a-9685-92610cdef32a
title: Каким образом кластерное обновление сведения о подключаемых модулях
ms.topic: article
ms.prod: windows-server-threshold
manager: dongill
ms.author: jgerend
author: JasonGerend
ms.date: 04/28/2017
ms.technology: storage-failover-clustering
description: Как использовать подключаемые модули для координации обновлений, при использовании кластерного обновления в Windows Server для установки обновлений в кластере.
ms.openlocfilehash: d09addb5e6787a8386d50570c0d27640646aa587
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59854565"
---
# <a name="how-cluster-aware-updating-plug-ins-work"></a>Каким образом кластерное обновление сведения о подключаемых модулях

>Относится к: Windows Server (полугодовой канал), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

[Кластерное обновление](cluster-aware-updating.md) (CAU) использует подключаемых модулей, чтобы координировать установку обновлений на узлах в отказоустойчивом кластере. Этот раздел содержит сведения об использовании встроенных\-в подключаемого модуля CAU\-модулей или других подключаемых\-ins, устанавливаемый для кластерного обновления.

## <a name="BKMK_INSTALL"></a>Установка подключаемого модуля\-в  
Разъем\-в нестандартных подключите\-модули, являющиеся подключаемыми модулями CAU \( **Microsoft.WindowsUpdatePlugin** и **Microsoft.HotfixPlugin** \)должны устанавливаться отдельно. Если кластерное обновление используется в самостоятельно\-вилка режима обновления\-в должна быть установлена на всех узлах кластера. Если кластерное обновление используется в удаленных\-вилка режима обновления\-в должна быть установлена на удаленном компьютере координатора обновлений. Разъем\-тем, что установки могут иметь дополнительные требования на каждом узле.  
  
Чтобы установить подключаемые\-, следуйте инструкциям из вилка\-в издателе. Чтобы вручную зарегистрировать plug\-систему с помощью CAU, выполните [Register-CauPlugin](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/register-cauplugin) командлет на каждом компьютере, где вилка\-устанавливается.  
  
## <a name="specify-a-plug-in-and-plug-in-arguments"></a>Укажите разъем\-в и подключите\-в аргументах  
  
### <a name="specify-a-cau-plug-in"></a>Укажите CAU plug\-в

В пользовательском Интерфейсе CAU выберите разъем\-в раскрывающемся\-вниз список доступных подключаемых\-модули при использовании CAU для выполнения следующих действий:  
  
-   применение обновлений к кластеру;  
  
-   просмотр обновлений для кластера;  
  
-   Настройка кластера self\-параметров обновления  
  
По умолчанию CAU выбирает вилка\-в **Microsoft.WindowsUpdatePlugin**. Тем не менее, можно указать любой plug\-в том, что установлен и зарегистрирован в CAU.

> [!TIP]  
> В пользовательском Интерфейсе CAU можно указать только один разъем\-в CAU, который используется для просмотра или применения обновлений во время выполнения обновления. С помощью командлетов PowerShell для кластерного обновления, можно указать один или несколько подключаемых\-ins. Если вам нужно установить обновления нескольких типов в кластере, это обычно лучше указать несколько подключаемых\-в одного прогона, а не использовать отдельный прогон обновления для каждого подключаемые модули\-в. Это позволяет, к примеру, уменьшить число перезагрузок узлов.

С помощью командлетов PowerShell для кластерного обновления, перечисленные в следующей таблице, можно указать один или несколько подключаемых\-модулей для прогона обновления или проверки, передав **– CauPluginName** параметра. Можно указать несколько подключаемых\-в имена, разделяя их запятыми. Если указать несколько подключаемых\-модули, также можно управлять как вилка\-друг на друга во время выполнения обновления, указав  **\-RunPluginsSerially**,  **\- StopOnPluginFailure**, и **– SeparateReboots** параметров. Дополнительные сведения об использовании нескольких подключаемых\-модулей, используйте предоставленные ссылки на документацию по командлетам в следующей таблице.  
  
|Командлет|Описание|  
|----------|---------------|  
|[Добавление CauClusterRole](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/add-cauclusterrole)|Добавляет кластерную роль CAU, предоставляющий self\-обновление функциональных возможностей для указанного кластера.|  
|[Invoke-CauRun](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/invoke-caurun)|Проверяет наличие обновлений для узлов кластера и устанавливает их посредством прогона обновления в указанном кластере.|  
|[Invoke-CauScan](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/invoke-causcan)|Проверяет наличие обновлений для узлов кластера и возвращает список начального набора обновлений, которые будут применены к каждому узлу указанного кластера.|  
|[Set-CauClusterRole](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/set-cauclusterrole)|Задает свойства конфигурации для кластерной роли CAU в указанном кластере.|  
  
Если вы не укажете CAU plug\-в параметре с помощью этих командлетов, по умолчанию используется вилка\-в **Microsoft.WindowsUpdatePlugin**.  
  
### <a name="specify-cau-plug-in-arguments"></a>Укажите, подключите CAU\-в аргументах  
При настройке параметров прогона обновления, можно указать один или несколько *имя\=значение* пары \(аргументы\) для выбранного вилка\-в для использования. Например, в пользовательском интерфейсе CAU можно указать несколько аргументов следующим образом.  
  
**Name1\=значение1; Name2\=значение2; Name3\=значение3**  
  
Эти *имя\=значение* пар должны быть понятны вилка\-в котором указывается. Для некоторых подключаемых\-модулей аргументы необязательны.  
  
Синтаксис подключаемого модуля CAU\-в аргументах указанным ниже общим правилам:  
  
-   Несколько *имя\=значение* пары разделяются точками с запятой.  
  
-   Значение, содержащее пробелы, заключается в кавычки, например: **Name1\=«Value with Spaces»**.  
  
-   Точный синтаксис *значение* зависит от вилка\-в.  
  
Чтобы указать plug\-входных аргументов с помощью командлетов PowerShell для кластерного обновления, которые поддерживают **– CauPluginParameters** параметра, передайте этот параметр в форме:  
  
**\-CauPluginArguments @{Name1\=значение1; Name2\=значение2; Name3\=значение3}**  
  
Можно также использовать предопределенные хэш-таблицу PowerShell. Чтобы указать plug\-в аргументы для нескольких подключаемых\-, передайте несколько хэш-таблиц аргументов, разделенных запятыми. Передайте вилка\-в виде аргументов вилка\-, указанный в **CauPluginName**.  
  
### <a name="specify-optional-plug-in-arguments"></a>Укажите необязательное plug\-в аргументах  
Вилка\-модули, устанавливаемые CAU \( **Microsoft.WindowsUpdatePlugin** и **Microsoft.HotfixPlugin** \) предоставляют дополнительные возможности, которые можно выбрать. В пользовательском Интерфейсе CAU они отображаются на **Дополнительные параметры** странице после настройки параметров прогона обновления для вилка\-в. Если вы используете командлеты CAU PowerShell, эти параметры настраиваются как необязательный plug\-входных аргументов. Дополнительные сведения см. в разделах [Использование подключаемого модуля Microsoft.WindowsUpdatePlugin](#BKMK_WUP) и [Использование подключаемого модуля Microsoft.HotfixPlugin](#BKMK_HFP) далее в этой статье.  
  
## <a name="manage-plug-ins-using-windows-powershell-cmdlets"></a>Управление подключаемым\-модулей с помощью командлетов Windows PowerShell  
  
|Командлет|Описание|  
|----------|---------------|  
|[Get-CauPlugin](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/get-cauplugin)|Извлекает сведения о одну или несколько программ, обновление plug\-модули, зарегистрированные на локальном компьютере.|  
|[Register-CauPlugin]((https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/register-cauplugin))|Регистрирует plug обновления по CAU\-в на локальном компьютере.|  
|[Отмена регистрации CauPlugin](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating/unregister-cauplugin)|Удаляет обновления подключаемого модуля по\-в списке подключаемого модуля\-ins, который может использоваться компонентом CAU. **Примечание.** Вилка\-модули, являющиеся подключаемыми модулями CAU \( **Microsoft.WindowsUpdatePlugin** и **Microsoft.HotfixPlugin** \) невозможно отменить регистрацию.|  
  
## <a name="BKMK_WUP"></a>С помощью подключаемого модуля Microsoft.WindowsUpdatePlugin  

По умолчанию вилка\-в для кластерного обновления, **Microsoft.WindowsUpdatePlugin**, выполняет следующие действия:
- Связывается с агентом обновления Windows в каждом узле отказоустойчивого кластера, чтобы применить обновления, необходимые для продуктов Майкрософт, которые выполняются в каждом узле.
- Установка кластера обновления непосредственно из центра обновления Windows или Центра обновления Майкрософт или из на\-локального Windows Server Update Services \(WSUS\) сервера.
- Устанавливает только выбранные, выпуск для общего распространения \(GDR\) обновлений. По умолчанию вилка\-в применяет только важные обновления по. Настройка не требуется. Конфигурация по умолчанию загружает и устанавливает важные обновления GDR в каждом узле. 

> [!NOTE]
> Чтобы применить обновления, отличающиеся от важных обновлений, которые выбираются по умолчанию \(например, обновления драйверов\), можно настроить необязательные plug\-в параметре. Подробнее см. в подразделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="requirements"></a>Требования

- Отказоустойчивый кластер и удаленный компьютер координатора обновлений \(при использовании\) должен соответствовать требованиям для CAU и иметь конфигурацию, необходимую для удаленного управления, перечисленных в [требованиях и рекомендациях для кластерного обновления ](cluster-aware-updating-requirements.md).
- Изучите [рекомендации по применению обновлений Майкрософт](cluster-aware-updating-requirements.md#BKMK_BP_WUA), а затем внесите все необходимые изменения в конфигурацию Центра обновления Майкрософт для узлов отказоустойчивого кластера.
- Для получения наилучших результатов рекомендуется запустить анализатор соответствия рекомендациям для CAU \(BPA\) чтобы убедиться, что кластер и среда обновления правильно настроены для применения обновлений с помощью CAU. Подробнее см. в подразделе [Проверка готовности к кластерному обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).

> [!NOTE]
> Обновления, требующие принятия условий лицензии Майкрософт или иных действий со стороны пользователя, исключаются. Их необходимо установить вручную.

### <a name="additional-options"></a>Дополнительные параметры

Кроме того, можно указать следующие подключаемые модули\-в аргументах, чтобы расширить или ограничить набор обновлений, примененных вилка\-в:
- Настройка вилка\-в на применение рекомендованных обновлений, а также важные обновления на каждом узле, в пользовательском Интерфейсе CAU на **Дополнительные параметры** выберите **дают мне рекомендуется обновляет так же, как Я получаю важные обновления** "флажок".
<br>Кроме того, настроить **'IncludeRecommendedUpdates'\='True'** подключите\-входного аргумента.
- Чтобы настроить вилка\-в на фильтрацию типов обновлений GDR, которые применяются к каждому узлу кластера, указать, в строку запроса агента обновления Windows с помощью **QueryString** подключите\-в аргументе. Подробнее см. в подразделе [Настройка строки запроса агента обновления Windows](#BKMK_QUERY).

### <a name="BKMK_QUERY"></a>Настройка строки запроса агента обновления Windows  
Можно настроить plug\-в аргумент по умолчанию подключите\-in, **Microsoft.WindowsUpdatePlugin**, состоит из агента обновления Windows \(WUA\) строка запроса. В этой инструкции используется API WUA для определения одной или нескольких групп обновлений Майкрософт, которые должны быть применены к каждому узлу, на основе критериев выбора. Вы можете объединить несколько критериев с помощью логического И или логического ИЛИ. Строка запроса WUA указана в разъем\-в аргументе следующим образом:  
  
**Переменная строки запроса\=«критерий1\=Value1 и\/или критерий2\=Value2 и\/или...»**  
  
Например, подключаемый модуль **Microsoft.WindowsUpdatePlugin** автоматически выбирает важные обновления с помощью аргумента **QueryString** по умолчанию, который составляется с помощью критериев **IsInstalled**, **Type**, **IsHidden** и **IsAssigned**.  
  
**Переменная строки запроса\=«IsInstalled\=0 и тип\=«Программное обеспечение» и IsHidden\=0 и IsAssigned\=1»**  
  
Если указать **QueryString** аргумент, он используется вместо используемого по умолчанию **QueryString** , настроенную для вилка\-в.  
  
#### <a name="example-1"></a>Пример 1
  
Чтобы настроить **QueryString** аргумент, устанавливающий определенное обновление с Идентификатором *f6ce46c1\-971c\-43f9\-a2aa\-783df125f003*:  
  
**Переменная строки запроса\=«UpdateID\="f6ce46c1\-971c\-43f9\-a2aa\-783df125f003" и IsInstalled\=0»**  
  
> [!NOTE]  
> Предыдущий пример можно использовать для применения обновлений с помощью кластера\-виду мастера обновления. Если вы хотите установить определенное обновление путем настройки self\-обновление параметров с помощью пользовательского интерфейса CAU или с помощью **добавить\-CauClusterRole** или **задать\-CauClusterRole**Командлет PowerShell, необходимо отформатировать значение UpdateID два отдельному\-символы кавычек:  
>   
> **Переменная строки запроса\=«UpdateID\='' f6ce46c1\-971c\-43f9\-a2aa\-783df125f003'' и IsInstalled\=0"**  
  
#### <a name="example-2"></a>Пример 2
  
Чтобы настроить аргумент **QueryString**, устанавливающий только драйверы, укажите следующую строку.  
  
**Переменная строки запроса\=«IsInstalled\=0 и тип\=«Драйвер» и IsHidden\=0»**  
  
Дополнительные сведения о строках запроса для значения по умолчанию подключите\-в **Microsoft.WindowsUpdatePlugin**, критерии поиска \(например **IsInstalled**\), и синтаксис, который можно включить в строках запроса см. в разделе о критериях поиска в [Справочник по API агента обновления Windows (WUA)](https://go.microsoft.com/fwlink/p/?LinkId=223304).  
  
## <a name="BKMK_HFP"></a>Использование подключаемого модуля Microsoft.HotfixPlugin  
Вилка\-в **Microsoft.HotfixPlugin** можно использовать для применения выпуска Майкрософт для ограниченного распространения \(LDR\) обновления \(также называемые исправлениями и которые ранее назывались исправлениями QFE\) загрузить независимо друг от друга для устранения конкретных неполадок программного обеспечения Майкрософт. Подключаемый модуль устанавливает обновления из корневой папки на файловом ресурсе SMB, а также можно настроить для применения не\-Microsoft драйверов, встроенного по и обновлений BIOS.

> [!NOTE]
> Исправления иногда бывают доступны для загрузки от корпорации Майкрософт в статьях базы знаний, но они также предоставляются клиентам по мере\-необходимые основы.

### <a name="requirements"></a>Требования

- Отказоустойчивый кластер и удаленный компьютер координатора обновлений \(при использовании\) должен соответствовать требованиям для CAU и иметь конфигурацию, необходимую для удаленного управления, перечисленных в [требованиях и рекомендациях для кластерного обновления ](cluster-aware-updating-requirements.md).
- Изучите [рекомендации по использованию подключаемого модуля Microsoft.HotfixPlugin](cluster-aware-updating-requirements.md#BKMK_BP_HF).
- Для получения наилучших результатов рекомендуется запустить анализатор соответствия рекомендациям для CAU \(BPA\) модели, чтобы гарантировать, что кластер и среда обновления правильно настроены для применения обновлений с помощью CAU. Подробнее см. в подразделе [Проверка готовности к кластерному обновлению](cluster-aware-updating-requirements.md#BKMK_BPA).
- Получение обновлений на издателе и скопируйте или извлеките их в блок сообщений сервера \(SMB\) общую \(корневой папке исправлений\) , поддерживающий по крайней мере SMB 2.0 и доступен всем кластера узлы и удаленный компьютер координатора обновлений \(Если кластерное обновление используется в удаленных\-режима обновления\). Подробнее см. в подразделе [Настройка структуры корневой папки с исправлениями](#BKMK_HF_ROOT) далее в этом разделе. 

    > [!NOTE]
    > По умолчанию этот подключаемый\-в устанавливает только исправления со следующими расширениями имени файла: MSU, MSI и MSP-файлов.

- Скопируйте файл DefaultHotfixConfig.xml \(предоставляемого в **% systemroot %\\System32\\WindowsPowerShell\\v1.0\\модули\\ ClusterAwareUpdating** папку на компьютере, где установлены средства CAU\) к корневой папке исправлений, который вы создали и в которую извлекли исправления. Например, скопируйте файл конфигурации,  *\\ \\MyFileServer\\исправления\\корневой\\*. 

    > [!NOTE]
    > Для установки большинства исправлений от корпорации Майкрософт и других обновлений файл конфигурации исправлений по умолчанию можно использовать без изменений. Если этого требует сценарий, вы можете дополнительно настроить файл конфигурации. Файл конфигурации может включать настраиваемые правила, например, для обработки файлов исправлений с конкретными расширениями или для определения поведения конкретных условий выхода. Подробнее см. в подразделе [Настройка файла конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.

### <a name="configuration"></a>Конфигурация

Настройте указанные ниже параметры. Чтобы получить дополнительную информацию, воспользуйтесь ссылками на дальнейшие подразделы этого раздела.
- Путь к общей корневой папке с исправлениями, которая содержит применяемые обновления и файл конфигурации исправлений. Можно ввести этот путь в пользовательском Интерфейсе CAU или настроить **HotfixRootFolderPath\=\<путь >** PowerShell plug\-входного аргумента. 

   > [!NOTE]
   > Можно указать корневой папке исправлений, как путь к локальной папке или UNC-путь в формате  *\\ \\ServerName\\общего ресурса\\RootFolderName*. Домен\-основе или автономный по пути пространства имен DFS может использоваться. Тем не менее вилка\-в функции, которые проверяют доступа разрешения в файле конфигурации исправлений, несовместимы с пути пространства имен DFS, поэтому если вы настроили такой необходимо отключить проверку разрешений доступа в пользовательском интерфейсе CAU или задав **DisableAclChecks\='True'** подключите\-входного аргумента.
- Параметры на сервере, на котором размещается корневой папке исправлений и проверьте соответствующие разрешения для доступа к папке и обеспечения целостности данных, доступных из SMB общая папка \(подписывание SMB или шифрования SMB\). Дополнительные сведения см. в разделе [Ограничение доступа к корневой папке с исправлениями](#BKMK_ACL).

### <a name="additional-options"></a>Дополнительные параметры

- При необходимости настройте вилка\-в таким образом, принудительное использование шифрования SMB при доступе к данным из общей папки с исправлениями. В пользовательском Интерфейсе CAU на **Дополнительные параметры** выберите **требовать шифрования SMB при доступе к корневой папке исправлений** или задайте **RequireSMBEncryption\= «True»** PowerShell plug\-входного аргумента. 
  > [!IMPORTANT]
  > Чтобы включить проверку целостности данных SMB с использованием подписания или шифрования SMB, необходимо выполнить дополнительные действия по настройке на SMB-сервере. Подробнее см. в шаге 4 в подразделе [Ограничение доступа к корневой папке с исправлениями](#BKMK_ACL). Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление не будет выполнено.
- Вы можете отключить выполняющиеся по умолчанию проверки достаточности разрешений на доступ к корневой папке исправлений и файлу конфигурации исправлений. В пользовательском Интерфейсе CAU выберите **отключить проверку административного доступа к корневой папке и файлу конфигурации исправлений**, или настроить **DisableAclChecks\='True'** подключите\-в аргумент.
- При необходимости настройте **HotfixInstallerTimeoutMinutes\= <Integer>**  подключите аргумент, чтобы указать продолжительность исправление\-в ожидает процесса установки исправления для возврата. \(Значение по умолчанию — 30 минут.\) Например, чтобы задать период ожидания равным двум часам, задайте **HotfixInstallerTimeoutMinutes\=120**.
- При необходимости настройте **HotfixConfigFileName \= <name>**  подключите\-в аргумент, чтобы указать имя файла конфигурации исправлений, который находится в корневой папке исправлений. Если он не указан, используется имя по умолчанию DefaultHotfixConfig.xml.
  
### <a name="BKMK_HF_ROOT"></a>Настройка структуры корневой папки с исправлениями

Исправление подключите\-в для работы, исправления должны храниться в хорошо\-определения структуры в общей папке SMB \(корневой папке исправлений\), вы должны настроить вилка исправление\-с использованием пути к корневой папке исправлений с помощью пользовательского интерфейса CAU или командлеты PowerShell для кластерного обновления. Этот путь передается вилка\-в качестве **HotfixRootFolderPath** аргумент. Для корневой папки исправлений можно выбрать одну из нескольких структур в соответствии с потребностями в обновлении, как показано в примерах ниже. Файлы и папки, которые не соответствуют структуре, игнорируются.  
  
#### <a name="example-1---folder-structure-used-to-apply-hotfixes-to-all-cluster-nodes"></a>Пример 1 - структура папок, используемая для применения исправлений ко всем узлам кластера
  
Чтобы применить исправления ко всем узлам кластера, скопируйте их в папку с именем **CAUHotfix\_все** в корневой папке исправлений. В этом примере **HotfixRootFolderPath** подключите\-в аргумент имеет значение *\\ \\MyFileServer\\исправления\\корневой\\*. **CAUHotfix\_все** папка содержит три обновления с расширениями MSU, MSI и MSP, которые будут применяться ко всем узлам кластера. Имена файлов обновлений приведены только для иллюстрации.  
  
> [!NOTE]  
> В этом и последующих примерах файл конфигурации исправлений с именем по умолчанию DefaultHotfixConfig.xml находится в требуемом месте в корневой папке исправлений.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
```  
  
#### <a name="example-2---folder-structure-used-to-apply-certain-updates-only-to-a-specific-node"></a>Пример 2 - структура папок, используемая для применения определенных обновлений только для определенного узла
  
Чтобы применить обновления только к определенному узлу, используйте вложенную папку с именем узла в корневой папке исправлений. Используйте NetBIOS-имя узла кластера, например *ContosoNode1*. Затем переместите в эту вложенную папку обновления, которые необходимо применить только к этому узлу. В следующем примере **HotfixRootFolderPath** подключите\-в аргумент имеет значение  *\\ \\MyFileServer\\исправления\\корневой\\*. Обновления в **CAUHotfix\_все** папки, которые будут применяться ко всем узлам кластера, и *Node1\_конкретных\_Update.msu* будут применяться только к *ContosoNode1*.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
   ContosoNode1\   
      Node1_Specific_Update.msu   
      ...  
```  
  
#### <a name="example-3---folder-structure-used-to-apply-updates-other-than-msu-msi-and-msp-files"></a>Пример 3 - структура папок, использовать для применения обновлений, отличных от MSU, MSI и MSP-файлов файлов
  
По умолчанию подключаемый модуль **Microsoft.HotfixPlugin** применяет обновления только с расширениями MSU, MSI и MSP. Однако некоторые обновления могут иметь другие расширения и требовать других команд для установки. Например, может потребоваться применить обновление встроенного ПО с расширением EXE к узлу кластера. Вы можете настроить корневой папке исправлений с создать вложенную папку конкретного не\-должен быть установлен по умолчанию тип обновления. Также необходимо настроить соответствующее правило установки для папки, которое определяет команду установки в элементе `<FolderRules>` XML-файла конфигурации исправлений.  
  
В следующем примере **HotfixRootFolderPath** подключите\-в аргумент имеет значение  *\\ \\MyFileServer\\исправления\\корневой\\*. Несколько обновлений будут применены ко всем узлам кластера, а обновление встроенного ПО *SpecialHotfix1.exe* будет применено к узлу *ContosoNode1* с помощью правила *FolderRule1*. Подробнее о настройке правила *FolderRule1* в файле конфигурации исправлений см. в подразделе [Настройка файла конфигурации исправлений](#BKMK_CONFIG_FILE) далее в этом разделе.  
  
```
\\MyFileServer\Hotfixes\Root\   
   DefaultHotfixConfig.xml  
   CAUHotfix_All\   
      Update1.msu   
      Update2.msi   
      Update3.msp  
      ...  
  
   ContosoNode1\   
      FolderRule1\  
          SpecialHotfix1.exe  
      ...  
```

### <a name="BKMK_CONFIG_FILE"></a>Настройка файла конфигурации исправлений  
Файл конфигурации исправлений управляет тем, как подключаемый модуль **Microsoft.HotfixPlugin** устанавливает определенные типы исправлений в отказоустойчивом кластере. Схема XML файла конфигурации определяется в файле HotfixConfigSchema.xsd, который находится на компьютере с установленными средствами CAU в следующей папке:  
  
**% systemroot %\\System32\\WindowsPowerShell\\v1.0\\модули\\ClusterAwareUpdating папки**  
  
Чтобы настроить файл конфигурации исправлений, скопируйте образец файла конфигурации DefaultHotfixConfig.xml из этого расположения в корневую папку исправлений и внесите в него изменения в соответствии со своим сценарием.  
  
> [!IMPORTANT]  
> Для применения большинства исправлений от корпорации Майкрософт и других обновлений файл конфигурации исправлений по умолчанию можно использовать без изменений. Настраивать файл конфигурации исправлений требуется только в особых сценариях использования.  
  
По умолчанию XML-файл конфигурации исправлений определяет правила установки и условия выхода для двух категорий исправлений.  
  
-   Файлы исправлений с расширениями, вилка\-в можно установить по умолчанию \(файлы MSU, MSI и MSP-файлов\).  
  
    Они определяются как элементы `<ExtensionRules>` в элементе `<DefaultRules>`. Для каждого поддерживаемого по умолчанию типа файлов имеется один элемент `<Extension>` . Общая структура XML имеет следующий вид.  
  
    ```xml  
    <DefaultRules>  
        <ExtensionRules>  
          <Extension name="MSI">  
            <!-- Template and ExitConditions elements for installation of .msi files follow -->  
             ...  
          </Extension>  
          <Extension name="MSU">  
            <!-- Template and ExitConditions elements for installation of .msu files follow -->  
             ...  
          </Extension>  
          <Extension name="MSP">  
            <!-- Template and ExitConditions elements for installation of .msp files follow -->  
             ...  
          </Extension>  
             ...  
       </ExtensionRules>  
    </DefaultRules>  
    ```  
  
    Если необходимо применять обновления определенных типов ко всем узлам кластера в среде, можно определить дополнительные элементы `<Extension>` .  
  
-   Исправление или другие обновления файлов, которые не MSI-файл, MSU или MSP-файлы, например, не\-Microsoft драйверов, встроенного по и обновлений BIOS.  
  
    Каждый не\-тип файла по умолчанию работает в режиме `<Folder>` элемент в `<FolderRules>` элемент. Атрибут имени элемента `<Folder>` должен совпадать с именем вложенной папки в корневой папке исправлений, в которой будут содержаться обновления соответствующего типа. Папка может находиться в **CAUHotfix\_все** папку или в узле\-определенную папку. Например, если в корневой папке исправлений настроено правило *FolderRule1* , то, чтобы определить шаблон установки и условия выхода для обновлений в этой папке, настройте следующий элемент в XML-файле:  
  
    ```xml  
    <FolderRules>  
          <Folder name="FolderRule1">  
            <!-- Template and ExitConditions elements for installation of updates in FolderRule1 follow -->  
             ...  
          </Folder>  
          ...  
    </FolderRules>  
    ```  
  
В таблице ниже описываются атрибуты `<Template>` и возможные дочерние элементы `<ExitConditions>` .  
  
|Атрибут `<Template>`|Описание|  
|--------------------------|---------------|  
|`path`|Полный путь к программе установки для типа файлов, определенного в атрибуте `<Extension name>` .<br /><br />Чтобы указать путь к файлу обновления в структуре корневой папки исправлений, используйте элемент `$update$`.|  
|`parameters`|Строка с обязательными и необязательными параметрами для программы, указанной в атрибуте `path`.<br /><br />Чтобы задать параметр, который содержит путь к файлу обновления в структуре корневой папки исправлений, используйте элемент `$update$`.|  
  
|Дочерний элемент `<ExitConditions>`|Описание|  
|---------------------------------|---------------|  
|`<Success>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления. Это обязательный дочерний элемент.|  
|`<Success_RebootRequired>`|Определяет один или несколько кодов выхода, указывающих на успешное применение обновления и необходимость перезапуска узла (необязательный дочерний элемент). <br>**Примечание.** Элемент `<Folder>` может содержать атрибут `alwaysReboot`. Если этот атрибут задан, он указывает на то, что при возвращении исправлением, устанавливаемым этим правилом, одного из кодов выхода, которые определены в дочернем элементе `<Success>`, он интерпретируется как условие выхода `<Success_RebootRequired>` .|  
|`<Fail_RebootRequired>`|Определяет один или несколько кодов выхода, указывающих на сбой при применении обновления и необходимость перезапуска узла (необязательный дочерний элемент).|  
|`<AlreadyInstalled>`|Определяет один или несколько кодов выхода, указывающих на то, что обновление не было применено, так как оно уже установлено (необязательный дочерний элемент).|  
|`<NotApplicable>`|Определяет один или несколько кодов выхода, указывающих на то, что обновление не было применено, так как оно не требуется для этого узла кластера (необязательный дочерний элемент).|  
  
> [!IMPORTANT]  
> Все коды выхода, которые не определены явным образом в элементе `<ExitConditions>` , интерпретируются как коды сбоя обновления, и узел не перезапускается.  
  
### <a name="BKMK_ACL"></a>Ограничение доступа к корневой папке исправлений  
Чтобы доступ к файлам в корневой папке исправлений и файлу конфигурации исправлений был возможен только в контексте подключаемого модуля **Microsoft.HotfixPlugin**, необходимо выполнить ряд действий по настройке файлового сервера и общей папки SMB. При этом будет включен ряд функций, позволяющих защитить файлы исправлений от несанкционированного доступа, который может поставить отказоустойчивый кластер под угрозу.  
  
Общий порядок действий.  
  
1.  Учетной записи пользователя, используемый для выполнения прогонов обновления с помощью вилка\-в  
  
2.  Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB  
  
3.  Настройка разрешений на доступ к корневой папке исправлений  
  
4.  Настройка параметров для обеспечения целостности данных SMB  
  
5.  Включение правила брандмауэра Windows на сервере SMB  
  
#### <a name="step-1-identify-the-user-account-that-is-used-for-updating-runs-by-using-the-hotfix-plug-in"></a>Шаг 1. Учетной записи пользователя, используемый для выполнения прогонов обновления с помощью вилка исправление\-в
  
Учетная запись, которая используется в CAU для проверки параметров безопасности при выполнении прогона обновления с помощью **Microsoft.HotfixPlugin** зависит от того, используется ли кластерное обновление в удаленных\-обновление режима или self\-режима обновления как выглядит следующим образом:  
  
-   **Удаленный\-режима обновления** учетную запись с правами администратора в кластере для предварительного просмотра и применения обновлений.  
  
-   **SELF\-режима обновления** имя виртуального объекта-компьютера, настроенного в Active Directory для CAU кластерной роли. Это либо имя виртуального объекта-компьютера, предварительно подготовленного в Active Directory для кластерной роли CAU, либо имя, созданное компонентом CAU для кластерной роли. Чтобы узнать имя, созданное компонентом CAU, выполните **получить\-CauClusterRole** командлет PowerShell для кластерного обновления. В выходных данных **ResourceGroupName** — это имя созданной учетной записи виртуального объекта-компьютера.  
  
#### <a name="step-2-configure-this-user-account-in-the-necessary-groups-on-an-smb-file-server"></a>Шаг 2. Настройка учетной записи пользователя в необходимых группах на файловом сервере SMB
  
> [!IMPORTANT]  
> Необходимо добавить учетную запись, используемую для выполнения прогонов обновления, в группу локальных администраторов SMB-сервера. Если это запрещено политиками безопасности организации, настройте для этой учетной записи необходимые разрешения на SMB-сервере с помощью описанной ниже процедуры.  
  
##### <a name="to-configure-a-user-account-on-the-smb-server"></a>Настройка учетной записи пользователя на SMB-сервере  
  
1.  Добавьте учетную запись, используемую для выполнения прогонов обновления, в группу "Пользователи DCOM" и в одну из следующих групп: "Опытные пользователи", "Операторы сервера" или "Операторы печати".  
  
2.  Чтобы предоставить учетной записи необходимые разрешения WMI, запустите на SMB-сервере консоль управления WMI. Запустите PowerShell и введите следующую команду:  
  
    ```  
    wmimgmt.msc  
    ```  
  
3.  В дереве консоли щелкните правой кнопкой мыши\-щелкните **управляющий элемент WMI \(локального\)**, а затем нажмите кнопку **свойства**.  
  
4.  Щелкните **Безопасность** и разверните элемент **Корень**.  
  
5.  Щелкните **CIMV2**, а затем выберите **Безопасность**.  
  
6.  Добавьте учетную запись, используемую для выполнения прогонов обновления, в список **Группы или пользователи**.  
  
7.  Предоставьте учетной записи, используемой для выполнения прогонов обновления, разрешения **Выполнение методов** и **Включить удаленно**.  
  
#### <a name="step-3-configure-permissions-to-access-the-hotfix-root-folder"></a>Шаг 3. Настройка разрешений на доступ к корневой папке исправлений
  
По умолчанию, при попытке применить обновления, исправление подключите\-в проверяет конфигурацию разрешений файловой системы NTFS для доступа к корневой папке исправлений. Если права доступа к папкам не настроены надлежащим образом, выполнение обновления с помощью вилка исправление\-в может завершиться ошибкой.  
  
При использовании конфигурации по умолчанию подключаемого модуля исправлений\-, убедитесь, что права доступа к папкам отвечать следующим требованиям.  
  
-   Группа "Пользователи" имеет разрешение на чтение.  
  
-   Если вилка\-в будет применять обновления с расширением .exe, группа пользователей имеет разрешение Execute.  
  
-   Допускаются только некоторые субъекты безопасности \(, но не являются обязательными\) запись или разрешение на изменение. К таким субъектам относятся группа локальных администраторов, СИСТЕМА, СОЗДАТЕЛЬ-ВЛАДЕЛЕЦ и TrustedInstaller. Остальные учетные записи и группы не могут иметь разрешения на запись и изменение для корневой папки исправлений.  
  
При необходимости вы можете отключить предварительные проверки, вилка\-в выполняет по умолчанию. Это можно сделать одним из двух способов:  
  
-   Если вы используете командлеты PowerShell для кластерного обновления, настроить **DisableAclChecks\='True'** аргумента в **CauPluginArguments** параметр для установки исправлений\-в.  
  
-   Если используется пользовательский интерфейс CAU, выберите параметр **Отключить проверку административного доступа к корневой папке и файлу конфигурации исправлений** на странице **Дополнительные параметры обновления** мастера, служащего для настройки параметров прогона обновления.  
  
Однако в большинстве сред мы рекомендуем использовать конфигурацию по умолчанию для принудительного выполнения этих проверок.  
  
#### <a name="step-4-configure-settings-for-smb-data-integrity"></a>Шаг 4. Настройка параметров для обеспечения целостности данных SMB
  
Для проверки целостности данных для подключений между узлами кластера и общей папки SMB, подключите исправление\-в необходимо включить параметры в общей папке SMB для подписания SMB или шифрования SMB. Шифрование SMB, обеспечивающее улучшенную защиту и лучшую производительность во многих средах, поддерживается начиная с Windows Server 2012. Вы можете включить один или оба этих параметра, как указано ниже.  
  
-   Сведения о включении подписания SMB см. в процедуре, описанной в [статье 887429](https://support.microsoft.com/kb/887429) базы знаний Майкрософт.  
  
-   Чтобы включить шифрование SMB для общей папки SMB, выполните следующий командлет PowerShell на сервере SMB:  
  
    ```PowerShell  
    Set-SmbShare <ShareName> -EncryptData $true  
    ```  
  
    Где <*ShareName*> — это имя общей папки SMB.  
  
При необходимости, чтобы принудительное шифрование SMB для подключений к SMB-сервера, выберите **требовать шифрования SMB при доступе к корневой папке исправлений** в пользовательском Интерфейсе CAU или задайте **RequireSMBEncryption \='True'** подключите\-входного аргумента с помощью командлетов PowerShell для кластерного обновления.  
  
> [!IMPORTANT]  
> Если выбран вариант принудительного использования шифрования SMB, а корневая папка исправлений не настроена для доступа с применением шифрования SMB, обновление не будет выполнено.  
  
#### <a name="step-5-enable-a-windows-firewall-rule-on-the-smb-server"></a>Шаг 5. Включение правила брандмауэра Windows на сервере SMB
  
Необходимо включить **удаленное управление файловым сервером \(SMB\-в\)**  правило в брандмауэре Windows на файловом сервере SMB. Оно включено по умолчанию в Windows Server 2016, Windows Server 2012 R2 и Windows Server 2012.  
  
## <a name="see-also"></a>См. также  
  
-   [Обзор кластерного обновления](cluster-aware-updating.md)
  
-   [Командлеты кластерного обновления Windows PowerShell](https://technet.microsoft.com/itpro/powershell/windows/cluster-aware-updating)  
  
-   [Кластерное обновление подключаемого модуля ссылки](https://msdn.microsoft.com/library/hh418084.aspx)  
  
