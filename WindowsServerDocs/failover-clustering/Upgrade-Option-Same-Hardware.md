---
title: Обновление отказоустойчивых кластеров с помощью одного и того же оборудования
description: В этой статье описывается обновление отказоустойчивого кластера с двумя узлами с использованием того же оборудования.
manager: eldenc
ms.topic: article
author: johnmarlin-msft
ms.author: johnmar
ms.date: 02/28/2019
ms.localizationpriority: medium
ms.openlocfilehash: 3e25660eda2d21658f01fe1d8a01ae86a4b42116
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87990953"
---
# <a name="upgrading-failover-clusters-on-the-same-hardware"></a>Обновление отказоустойчивых кластеров на том же оборудовании

> Применяется к: Windows Server 2019, Windows Server 2016

Отказоустойчивый кластер — это группа независимых компьютеров, совместная работа которых позволяет повысить доступность приложений и служб. Кластерные серверы (называемые "узлы") соединены физическими кабелями и программным обеспечением. При сбое на одном из узлов кластера его функции немедленно передаются другому узлу (этот процесс называется отработкой отказа). В службе можно столкнуться с минимальными нарушениями.

В этом руководстве описаны действия по обновлению узлов кластера до Windows Server 2019 или Windows Server 2016 из более ранней версии с помощью одного и того же оборудования.

## <a name="overview"></a>Обзор

Обновление операционной системы в существующем отказоустойчивом кластере поддерживается только при переходе с Windows Server 2016 на Windows 2019.  Если отказоустойчивый кластер работает под управлением более ранней версии, например Windows Server 2012 R2 и более ранних версий, обновление во время работы служб кластеров не позволит объединять узлы.  При использовании одного и того же оборудования можно выполнить действия для его получения в более новую версию.

Перед обновлением отказоустойчивого кластера ознакомьтесь с [содержимым обновления Windows Server](../upgrade/upgrade-overview.md).  При обновлении Windows Server на месте вы перейдете из существующего выпуска операционной системы в более новый выпуск с тем же оборудованием. Windows Server можно обновить на месте по крайней мере на одной, а иногда на две версии вперед. Например, Windows Server 2012 R2 и Windows Server 2016 можно обновить на месте до Windows Server 2019.  Также помните, что [Мастер миграции кластера](https://blogs.msdn.microsoft.com/clustering/2012/06/25/how-to-move-highly-available-clustered-vms-to-windows-server-2012-with-the-cluster-migration-wizard/) можно использовать, но поддерживается только до двух версий. На следующем рисунке показаны варианты обновления для Windows Server. Направленные вниз стрелки представляют поддерживаемый путь обновления, перемещающийся с более ранних версий до Windows Server 2019.

![Схема обновления на месте](media/In-Place-Upgrade/In-Place-Upgrade-1.png)

Ниже приведен пример перехода с сервера отказоустойчивого кластера Windows Server 2012 на Windows Server 2019 с использованием одного и того же оборудования.

Перед началом обновления убедитесь, что текущая резервная копия, включая состояние системы, выполнена.  Также убедитесь, что все драйверы и встроенное по были обновлены до сертифицированных уровней используемой операционной системы.  Эти две заметки не будут рассматриваться здесь.

В приведенном ниже примере имя отказоустойчивого кластера — CLUSTER, а имена узлов — NODE1 и NODE2.

## <a name="step-1-evict-first-node-and-upgrade-to-windows-server-2016"></a>Шаг 1. исключение первого узла и обновление до Windows Server 2016

1. В диспетчер отказоустойчивости кластеров прервать все ресурсы из NODE1 в NODE2, щелкнув правой кнопкой мыши узел и выбрав пункт **приостановить** и **очистить роли**.  Кроме того, можно использовать команду PowerShell [Suspend-CLUSTERNODE](/powershell/module/failoverclusters/suspend-clusternode).

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-2.png)

2. Чтобы исключить NODE1 из кластера, щелкните узел правой кнопкой мыши и выберите пункт " **Дополнительные действия** " и " **исключить**".  Кроме того, можно использовать команду PowerShell [Remove-CLUSTERNODE](/powershell/module/failoverclusters/remove-clusternode).

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-3.png)

3. В качестве меры предосторожности отсоедините NODE1 от хранилища, которое вы используете.  В некоторых случаях будет достаточно отключать кабели хранилища от компьютера.  При необходимости обратитесь к поставщику хранилища за правильными шагами отсоединения.  В зависимости от хранилища это может быть необязательно.

4. Перестройте NODE1 с помощью Windows Server 2016.  Убедитесь, что добавлены все необходимые роли, компоненты, драйверы и обновления для системы безопасности.

5. Создайте новый кластер с именем CLUSTER1 и NODE1.  Откройте диспетчер отказоустойчивости кластеров и в области **управления** выберите **создать кластер** и следуйте инструкциям мастера.

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-4.png)

6. После создания кластера роли потребуется перенести из исходного кластера в этот новый кластер.  В новом кластере щелкните правой кнопкой мыши имя кластера (CLUSTER1) и выберите пункт **Дополнительные действия** и **скопируйте роли кластера**.  Следуйте указаниям мастера, чтобы перенести роли.

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-5.png)

7.  После переноса всех ресурсов выключите NODE2 (исходный кластер) и отключите хранилище, чтобы не вызывать помех.  Подключите хранилище к NODE1.  После подключения Подключите все ресурсы к сети и убедитесь, что они работают должным образом.

## <a name="step-2-rebuild-second-node-to-windows-server-2019"></a>Шаг 2. Перестроение второго узла до Windows Server 2019

Убедившись, что все работает правильно, NODE2 можно перестраивать на Windows Server 2019 и присоединить к кластеру.

1. Выполните чистую установку Windows Server 2019 на NODE2. Убедитесь, что добавлены все необходимые роли, компоненты, драйверы и обновления для системы безопасности.

2. Теперь, когда исходный кластер (кластер) утерян, можно оставить новое имя кластера CLUSTER1 или вернуться к исходному имени.  Если вы хотите вернуться к исходному имени, выполните следующие действия.

   а. В NODE1 в диспетчер отказоустойчивости кластеров правой кнопкой мыши щелкните имя кластера (CLUSTER1) и выберите **Свойства**.

   b. На вкладке **Общие** переименуйте кластер в кластер.

   c. При нажатии кнопки ОК или применить вы увидите всплывающее диалоговое окно.

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-6.png)

    d. Служба кластеров будет остановлена, и ее необходимо будет запустить снова для завершения переименования.

3. В NODE1 откройте диспетчер отказоустойчивости кластеров.  Щелкните правой кнопкой мыши **узлы** и выберите **Добавить узел**.  Пройдите через мастер, добавив NODE2 в кластер.

4. Подключите хранилище к NODE2. Это может быть повторное подключение кабелей хранилища.

5. Остановите все ресурсы из NODE1 в NODE2, щелкнув правой кнопкой мыши узел и выбрав пункт **приостановить** и **очистить роли**.  Кроме того, можно использовать команду PowerShell [Suspend-CLUSTERNODE](/powershell/module/failoverclusters/suspend-clusternode).  Убедитесь, что все ресурсы находятся в сети и работают должным образом.

## <a name="step-3-rebuild-first-node-to-windows-server-2019"></a>Шаг 3. Перестроение первого узла до Windows Server 2019

1. Исключите NODE1 из кластера и отключите хранилище от узла так, как было раньше.

2. Перестройте или обновите NODE1 до Windows Server 2019.  Убедитесь, что добавлены все необходимые роли, компоненты, драйверы и обновления для системы безопасности.

3. Повторно подключите хранилище и добавьте NODE1 обратно в кластер.

4. Переместите все ресурсы в NODE1 и убедитесь, что они переходят в режим «в сети» и работают по мере необходимости.

5. Текущий функциональный уровень кластера остается в Windows 2016.  Обновите функциональный уровень до Windows 2019 с помощью команды PowerShell [Update-клустерфунктионаллевел](/powershell/module/failoverclusters/update-clusterfunctionallevel).

Теперь вы работаете с полнофункциональным отказоустойчивым кластером Windows Server 2019.

## <a name="additional-notes"></a>Дополнительные замечания

- Как упоминалось ранее, Отключение хранилища может оказаться необязательным.  В нашей документации мы хотим относиться к ошибке с осторожностью.  Обратитесь к поставщику хранилища.
- Если начальная точка — кластеры Windows Server 2008 или 2008 R2, может потребоваться выполнить дополнительные действия.
- Если кластер работает под управлением виртуальных машин, убедитесь, что вы обновляете уровень виртуальной машины после выполнения функционального уровня кластера с помощью команды PowerShell [Update-VMVERSION](/powershell/module/hyper-v/update-vmversion).
- Обратите внимание, что если вы используете приложение, например SQL Server, Exchange Server и т. д., приложение не будет перенесено с помощью мастера копирования кластерных ролей.  Для правильного переноса приложения необходимо обратиться к поставщику приложения.