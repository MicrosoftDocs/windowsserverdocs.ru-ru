---
title: Обновление отказоустойчивых кластеров, используя то же оборудование
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: failover-clustering
ms.topic: article
author: johnmarlin-msft
ms.date: 02/28/2019
description: В этой статье описывается обновление 2 узлов отказоустойчивого кластера, используя то же оборудование
ms.localizationpriority: medium
ms.openlocfilehash: 6787d852cc5075e306373a163814135190f27fd6
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67280242"
---
# <a name="upgrading-failover-clusters-on-the-same-hardware"></a>Обновление отказоустойчивых кластеров на том же оборудовании

> Относится к: Windows Server 2019, Windows Server 2016

Отказоустойчивый кластер — это группа независимых компьютеров, которые совместно работают для повышения доступности приложений и служб. Кластерные серверы (называемые "узлы") соединены физическими кабелями и программным обеспечением. При сбое на одном из узлов кластера его функции немедленно передаются другому узлу (этот процесс называется отработкой отказа). Пользователи сталкиваются с минимальным количеством проблем в работе службы.

В этом руководстве описаны этапы обновления узлов кластера к Windows Server 2019 или Windows Server 2016 из более ранней версии, используя то же оборудование.

## <a name="overview"></a>Обзор

Обновление операционной системы с существующего отказоустойчивого кластера поддерживается только при переходе с Windows Server 2016 на Windows 2019.  Если отказоустойчивый кластер работает под управлением более ранней версии, например Windows Server 2012 R2 и более ранних версиях обновление во время работы службы кластеров не позволит объединения узлов.  Если используется такое же оборудование, можно выполнить шаги, чтобы получить ее до новой версии.  

Прежде чем любое другое обновление отказоустойчивого кластера, обратитесь к [центра обновления Windows](https://www.microsoft.com/upgradecenter).  При обновлении Windows Server на месте, переместите существующие версии операционной системы на более новый выпуск на том же оборудовании. Windows Server может быть обновленной на месте по крайней мере и иногда две версии вперед. Например, Windows Server 2012 R2 и Windows Server 2016 можно обновить на месте до Windows Server 2019.  Также имейте в виду, что [мастера миграции кластера](https://blogs.msdn.microsoft.com/clustering/2012/06/25/how-to-move-highly-available-clustered-vms-to-windows-server-2012-with-the-cluster-migration-wizard/) можно использовать, но поддерживается только до двух версий обратно. На следующем рисунке показан варианты обновления для Windows Server. Вниз указывающего стрелки обозначают поддерживаемый вариант обновления, переход от более ранних версий до Windows Server 2019.

![Диаграмма обновления на месте](media/In-Place-Upgrade/In-Place-Upgrade-1.png)

Следующие действия являются примером переход от отказоустойчивом кластерном сервере Windows Server 2012 для Windows Server 2019 оборудования.  

Перед началом обновления, убедитесь, что было сделано текущей резервной копии, включая состояние системы.  Обеспечьте наличие всех драйверов и встроенного по, были обновлены для сертифицированных уровней для операционной системы, вы будете использовать.  Эти две заметки здесь не рассматриваются здесь.

В следующем примере имеет имя отказоустойчивого КЛАСТЕРА и имена узлов являются узел1 и узел2.

## <a name="step-1-evict-first-node-and-upgrade-to-windows-server-2016"></a>Шаг 1. Первый узел исключается и выполнили обновление до Windows Server 2016

1. В диспетчере отказоустойчивости кластеров, очистите все ресурсы с узла 1 на узел NODE2, правой кнопкой мыши, нажав на узел и выбрав **Пауза** и **очищать роли**.  Кроме того, можно использовать команду PowerShell [SUSPEND-CLUSTERNODE](https://docs.microsoft.com/powershell/module/failoverclusters/suspend-clusternode).

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-2.png)

2. Исключите узел 1 из кластера, правой кнопкой мыши щелкните узел и выбрав **дополнительные действия** и **исключить**.  Кроме того, можно использовать команду PowerShell [REMOVE-CLUSTERNODE](https://docs.microsoft.com/powershell/module/failoverclusters/remove-clusternode).

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-3.png)

3. В качестве меры предосторожности отсоедините NODE1 из хранилища, которую вы используете.  В некоторых случаях отключение кабели хранилища с компьютера будет достаточно.  Обратитесь к поставщику хранилища, для правильного присоединения действия при необходимости.  В зависимости от хранилища это может не потребоваться.

4. Перестройте NODE1 с Windows Server 2016.  Убедитесь, что вы добавили все необходимые роли, компоненты, драйверы и обновления для системы безопасности.

5. Создание нового кластера с именем CLUSTER1 с узлом NODE1.  Откройте Диспетчер отказоустойчивости кластеров и в **управления** панели выберите **создания кластеров** и следуйте инструкциям в мастере.

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-4.png)

6. После создания кластера, роли необходимо перенести из исходного кластера этот новый кластер.  В новом кластере, правой кнопкой мыши щелкните имя кластера (CLUSTER1) и выбрав **дополнительные действия** и **Копировать кластерные роли**.  В мастере для переноса ролей, выполнения этой процедуры.

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-5.png)

7.  После завершения переноса все ресурсы выключить питание узел2 (исходного кластера) и отключите хранилище таким образом, чтобы не создавать помех.  Подключения хранилища NODE1.  После подключения всех переводит все ресурсы в Интернете и убедитесь, что они функционируют так же как и.

## <a name="step-2-rebuild-second-node-to-windows-server-2019"></a>Шаг 2. Перестроить второго узла к Windows Server 2019

Когда вы убедитесь, что все работает правильно, узел2 можно перестроить, чтобы Windows Server 2019 и присоединить к кластеру.

1. Выполните чистую установку Windows Server 2019 на NODE2. Убедитесь, что вы добавили все необходимые роли, компоненты, драйверы и обновления для системы безопасности.

2. Теперь, когда отсутствует исходного кластера (КЛАСТЕР), можно оставить имя нового кластера, как CLUSTER1 или вернуться к исходному имени.  Если вы хотите вернуться к исходному имени, выполните следующие действия:
   
   1\. На NODE1, в диспетчере отказоустойчивости кластеров правой кнопкой мыши щелкните имя кластера (CLUSTER1) и выберите **свойства**.
   
   2\. На **Общие** вкладке, переименуйте кластера в кластере.

   В. При выборе ОК или применить, вы увидите ниже всплывающем окне.

    ![Узел стока](media/In-Place-Upgrade/In-Place-Upgrade-6.png)

    Г. Служба кластеров будет остановлен и нужно снова запустить для переименования для завершения.

3. На узле NODE1 откройте диспетчер отказоустойчивости кластеров.  Щелкните правой кнопкой мыши **узлы** и выберите **добавить узел**.  Перейдите в мастере добавления узел2 кластера.

4. Подключите хранилища на узел NODE2. Это может включать повторное подключение кабелей хранилища. 

5. Очистите все ресурсы с узла 1 на узел NODE2, правой кнопкой мыши, нажав на узел и выбрав **Пауза** и **очищать роли**.  Кроме того, можно использовать команду PowerShell [SUSPEND-CLUSTERNODE](https://docs.microsoft.com/powershell/module/failoverclusters/suspend-clusternode).  Убедитесь, все ресурсы подключены к сети, и они функционируют так же как и.

## <a name="step-3-rebuild-first-node-to-windows-server-2019"></a>Шаг 3. Перестроить первый узел, Windows Server 2019

1. Исключите узел 1 из кластера и отключите хранилище от узла таким образом, из которого вы ранее.

2. Повторно создать или обновить до Windows Server 2019 NODE1.  Убедитесь, что вы добавили все необходимые роли, компоненты, драйверы и обновления для системы безопасности.

3. Повторно подключите хранилища и добавить NODE1 обратно в кластер.

4. Переместить все ресурсы NODE1 и убедитесь, они работают в оперативном режиме и функцию, при необходимости.

5. Текущий режим работы кластера остается в Windows 2016.  Обновить функциональный уровень на Windows 2019 с помощью команды PowerShell [UPDATE-CLUSTERFUNCTIONALLEVEL](https://docs.microsoft.com/powershell/module/failoverclusters/update-clusterfunctionallevel).

Теперь вы работаете с полнофункциональным 2019 отказоустойчивого кластера Windows Server.

## <a name="additional-notes"></a>Дополнительная информация

- Как упоминалось ранее, отключение хранилища может или не может потребоваться.  В нашей документации мы хотим допустить ошибку осторожность.  Обратитесь к поставщику хранилища.
- Если отправной точкой является Windows Server 2008 или 2008 R2 кластеров, могут быть необходимы дополнительные выполнения через действия.
- Если кластер работает виртуальные машины, убедитесь, обновить уровень виртуальной машины, после завершения функциональный уровень кластера с помощью команды PowerShell [VMVERSION обновления](https://docs.microsoft.com/powershell/module/hyper-v/update-vmversion).
- Обратите внимание на то, что если вы используете приложение, например SQL Server, Exchange Server и т. д, приложение не переносятся с помощью мастера копирования кластерных ролей.  Вам следует обратиться к поставщику приложения, для правильной миграции действия приложения.