---
title: Развертывание кластеризованного файлового сервера с двумя узлами
description: В этой статье описывается создание кластера файлового сервера с двумя узлами.
manager: eldenc
ms.topic: article
author: johnmarlin-msft
ms.author: johnmar
ms.date: 02/01/2019
ms.openlocfilehash: 56130833ca2c3de8752fb79f5acdf30a1fafae2f
ms.sourcegitcommit: 67a486b4fb3937a457eb00d21a2e33b753489fd8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/12/2020
ms.locfileid: "88149558"
---
# <a name="deploying-a-two-node-clustered-file-server"></a>Развертывание кластеризованного файлового сервера с двумя узлами

> Применяется к: Windows Server 2019, Windows Server 2016

Отказоустойчивый кластер — это группа независимых компьютеров, совместная работа которых позволяет повысить доступность приложений и служб. Кластерные серверы (называемые "узлы") соединены физическими кабелями и программным обеспечением. При сбое на одном из узлов кластера его функции немедленно передаются другому узлу (этот процесс называется отработкой отказа). В службе можно столкнуться с минимальными нарушениями.

В этом руководстве описаны шаги по установке и настройке отказоустойчивого кластера файлового сервера общего назначения с двумя узлами. Создавая конфигурацию в этом руководство, вы можете изучить отказоустойчивые кластеры и ознакомиться с интерфейсом оснастки управления отказоустойчивыми кластерами в Windows Server 2019 или Windows Server 2016.

## <a name="overview-for-a-two-node-file-server-cluster"></a>Общие сведения о кластере файлового сервера с двумя узлами

Серверы в отказоустойчивом кластере могут работать в различных ролях, включая роли файлового сервера, сервера Hyper-V или сервера базы данных, а также обеспечивают высокий уровень доступности для различных служб и приложений. В этом руководство описано, как настроить кластер файлового сервера с двумя узлами.

Отказоустойчивый кластер обычно включает в себя единицу хранения, которая физически подключена ко всем серверам в кластере, хотя каждый заданный том в хранилище доступен только одному серверу за раз. На следующей схеме показан отказоустойчивый кластер с двумя узлами, подключенный к единице хранения.

![Кластер с двумя узлами](media/Cluster-File-Server/Cluster-FS-Overview.png)

Тома хранилища или логические номера устройств (LUN), предоставляемые узлам в кластере, не должны предоставляться другим серверам, включая серверы в другом кластере. Это показано на схеме ниже.

![LUN в хранилище](media/Cluster-File-Server/Cluster-FS-LUNs.png)

Обратите внимание, что для обеспечения максимальной доступности любого сервера важно следовать рекомендациям по управлению сервером, например, тщательному управлению физической средой серверов, тестированию изменений программного обеспечения перед их полным внедрением и тщательно отслеживать обновления программного обеспечения и изменения конфигурации на всех кластеризованных серверах.

В следующем сценарии описано, как можно настроить отказоустойчивый кластер файлового сервера. Общие файлы находятся в хранилище кластера, а кластеризованный сервер может работать как файловый сервер, который их использует.

## <a name="shared-folders-in-a-failover-cluster"></a>Общие папки в отказоустойчивом кластере

В следующем списке описаны функции конфигурации общих папок, интегрированные в отказоустойчивую кластеризацию.

- Область отображения ограничена только кластеризованными общими папками (без смешивания с некластеризованными общими папками). когда пользователь просматривает общие папки, указывая путь к кластеризованному файловому серверу, на экран будут включены только общие папки, которые являются частью конкретной роли файлового сервера. Она будет исключать некластеризованные общие папки и использует часть отдельных ролей файлового сервера, которые находятся на узле кластера.

- Перечисление на основе доступа. можно использовать перечисление на основе доступа, чтобы скрыть указанную папку от представления пользователей. Вместо того чтобы разрешить пользователям просматривать папку, но не обращаться к ней, можно запретить им просматривать папку. Перечисление на основе доступа для кластеризованной общей папки можно настроить так же, как и для некластеризованной общей папки.

- Автономный доступ. можно настроить автономный доступ (кэширование) для кластеризованной общей папки таким же образом, как и для некластеризованной общей папки.

- Кластерные диски всегда распознаются как часть кластера: независимо от того, используется ли интерфейс отказоустойчивого кластера, проводник или оснастка управления хранилищем, Windows определяет, назначен ли диск в хранилище кластера. Если такой диск уже был настроен в оснастке управления отказоустойчивыми кластерами как часть кластеризованного файлового сервера, можно использовать любой из упомянутых выше интерфейсов для создания общего ресурса на диске. Если такой диск не был настроен как часть кластеризованного файлового сервера, создать на нем общую папку по ошибке невозможно. Вместо этого для предоставления общего доступа необходимо сначала настроить диск в составе кластеризованного файлового сервера.

- Интеграция служб для сетевой файловой системы. роль файлового сервера в Windows Server включает в себя дополнительную службу ролей под названием службы для NFS. Установив службу роли и настроив общие папки с помощью служб для NFS, можно создать кластеризованный файловый сервер, который поддерживает клиенты на базе UNIX.

## <a name="requirements-for-a-two-node-failover-cluster"></a>Требования к отказоустойчивому кластеру с двумя узлами

Для отказоустойчивого кластера в Windows Server 2016 или Windows Server 2019, который считается официально поддерживаемым решением корпорации Майкрософт, решение должно удовлетворять следующим критериям.

- Все компоненты оборудования и программного обеспечения должны отвечать требованиям сертификации для логотипа соответствующей ОС. Для Windows Server 2016 это логотип «сертифицировано для Windows Server 2016». Для Windows Server 2019 это логотип «сертифицировано для Windows Server 2019». Дополнительные сведения о сертифицированных оборудовании и программном обеспечении см. на веб-сайте [каталога Microsoft Windows Server](https://www.windowsservercatalog.com/default.aspx) .

- Полностью настроенное решение (серверы, сеть и хранилище) должно пройти все тесты в мастере проверки, который является частью оснастки отказоустойчивого кластера.

Для отказоустойчивого кластера с двумя узлами необходимо следующее:

- **Серверы:** Рекомендуется использовать совпадающие компьютеры с одинаковыми или аналогичными компонентами.  Серверы для отказоустойчивого кластера с двумя узлами должны работать под управлением одной и той же версии Windows Server. Они также должны иметь одинаковые обновления программного обеспечения (исправления).

- **Сетевые адаптеры и кабель:** Сетевое оборудование, как и другие компоненты решения отказоустойчивого кластера, должно быть совместимо с Windows Server 2016 или Windows Server 2019. При использовании iSCSI сетевые адаптеры должны быть выделены для сетевого взаимодействия или iSCSI, а не для обоих. Избегайте единственных точек отказа в сетевой инфраструктуре, соединяющей узлы кластера. Это достигается несколькими способами. Вы можете подключать узлы кластера к разным сетям. Можно также соединить узлы кластера в одну сеть, основанную на сгруппированных сетевых адаптерах, дублированных коммутаторах и маршрутизаторах и аналогичном оборудовании, исключающем появление единственных точек отказа.

   > [!NOTE]
   > Если узлы кластера подключены к одной сети, сеть будет передавать требование избыточности в мастере проверки конфигурации.  Однако в отчет будет включено предупреждение о том, что сеть не должна иметь единой точки отказа.

- **Контроллеры устройств или соответствующие адаптеры для хранилища:**
    - **Последовательный подключенный SCSI или Fibre Channel:** Если вы используете последовательный подключенный SCSI или Fibre Channel, во всех кластеризованных серверах все компоненты стека хранилища должны быть идентичными. Необходимо, чтобы программное обеспечение Multipath I/O (MPIO) и программные компоненты модуля для конкретных устройств (DSM) были идентичными.  Рекомендуется, чтобы контроллеры запоминающих устройств, то есть адаптер шины (HBA), драйверы HBA и встроенное ПО HBA, присоединенные к хранилищу кластера, были идентичными. При использовании различных HBA следует уточнить у поставщика хранилища, обеспечиваются ли при этом поддерживаемые или рекомендуемые конфигурации.
    - **iSCSI:** При использовании iSCSI на каждом кластерном сервере должен быть один или несколько сетевых адаптеров или адаптеров шины, выделенных для хранилища ISCSI. Сеть, используемая для iSCSI, не может использоваться для сетевого взаимодействия. На всех кластеризованных серверах сетевые адаптеры для подключения к целевому хранилищу iSCSI должны быть одинаковыми. Рекомендуется использовать адаптеры Gigabit Ethernet или с более высокой пропускной способностью.

- **Хранилище:** Необходимо использовать общее хранилище, сертифицированное для Windows Server 2016 или Windows Server 2019.

    Для отказоустойчивого кластера с двумя узлами хранилище должно содержать по крайней мере два отдельных тома (LUN), если для кворума используется диск-свидетель. Диск-свидетель — это диск в хранилище кластера, предназначенный для хранения копии базы данных конфигурации кластера. Для этого примера кластера с двумя узлами в качестве конфигурации кворума будет использоваться большинство узлов и дисков. Большинство узлов и дисков означает, что узлы и диск-свидетель содержат копии конфигурации кластера, и кластер имеет кворум, если большинство из них (два из трех) этих копий доступны. Другой том (LUN) будет содержать файлы, общие для пользователей.

    К хранилищу предъявляются следующие требования.

    - Для использования собственной поддержки дисков, включенной в компонент отказоустойчивого кластера, применяйте базовые, а не динамические диски.
    - Рекомендуется отформатировать разделы с файловой системой NTFS (для диска-свидетеля раздел должен быть NTFS).
    - Для разделения диска на разделы можно использовать основную загрузочную запись (MBR) или таблицу разделов GPT.
    - Хранилище должно правильно реагировать на определенные команды SCSI. хранилище должно соответствовать стандарту, именуемому SCSI PRIMARY Commands-3 (SPC-3). В частности, хранилище должно поддерживать постоянные резервирования, как указано в стандарте SPC-3.
    -  Драйвер минипорта, используемый для хранения данных, должен работать с драйвером хранилища Microsoft Storport.

## <a name="deploying-storage-area-networks-with-failover-clusters"></a>Развертывание сетей хранения данных с отказоустойчивыми кластерами

При развертывании сети хранения данных (SAN) с отказоустойчивым кластером следует соблюдать следующие рекомендации.

- **Подтвердите сертификацию хранилища:** С помощью сайта [каталога Windows Server](https://www.windowsservercatalog.com/default.aspx) убедитесь, что хранилище поставщика, включая драйверы, встроенное по и программное обеспечение, сертифицировано для windows Server 2016 или windows Server 2019.

- **Изоляция устройств хранения данных, один кластер на устройство:** Серверы из разных кластеров не должны иметь доступ к одним и тем же устройствам хранения. В большинстве случаев LUN, используемый для одного набора серверов кластера, должен быть изолирован от всех других серверов через маскирование или зонирование LUN.

- **Рассмотрите возможность использования программного обеспечения Multipath I/O:** В структуре хранилища высокой доступности можно развертывать отказоустойчивые кластеры с несколькими адаптерами шины с помощью программного обеспечения Multipath I/O. Это обеспечивает максимальный уровень резервирования и доступности. Многопутевое решение должно основываться на Microsoft Multipath I/O (MPIO). Поставщик оборудования хранилища может предоставить аппаратный модуль MPIO (DSM) для вашего оборудования, хотя Windows Server 2016 и Windows Server 2019 включают один или несколько DSM в составе операционной системы.

## <a name="network-infrastructure-and-domain-account-requirements"></a>Требования к сетевой инфраструктуре и учетным записям домена

Вам потребуется следующая сетевая инфраструктура для отказоустойчивого кластера с двумя узлами и учетной записи администратора со следующими разрешениями домена:

- **Сетевые параметры и IP-адреса:** При использовании одинаковых сетевых адаптеров для сети также используйте одинаковые параметры связи на этих адаптерах (например, скорость, дуплексный режим, управление потоком и тип носителя). Кроме того, сравните параметры на сетевом адаптере и коммутаторе, к которому он подключается, и убедитесь в том, что они не конфликтуют.

    Если есть частные сети, которые не маршрутизируются в остальную часть сетевой инфраструктуры, убедитесь, что для каждой из этих частных сетей используется уникальная подсеть. Это необходимо даже в том случае, если каждому сетевому адаптеру присвоен уникальный IP-адрес. Например, если в центральном офисе есть узел кластера, использующий одну физическую сеть, а в филиале есть другой узел, использующий отдельную физическую сеть, не указывайте адрес 10.0.0.0/24 для обеих сетей, даже если каждому адаптеру присвоен уникальный IP-адрес.

    Дополнительные сведения о сетевых адаптерах см. в разделе Требования к оборудованию для отказоустойчивого кластера с двумя узлами выше в этом разделе.

- **DNS:** Для разрешения имен серверы в кластере должны использовать систему доменных имен (DNS). Можно использовать протокол динамического обновления DNS.

- **Роль домена:** Все серверы в кластере должны находиться в одном домене Active Directory. Мы рекомендуем, чтобы все кластерные серверы имели одинаковую роль домена (рядовой сервер или контроллер домена). Рекомендованная роль — рядовой сервер.

- **Контроллер домена:** Рекомендуется, чтобы кластерные серверы были рядовыми серверами. Если это так, вам потребуется дополнительный сервер, который выступает в качестве контроллера домена в домене, содержащем отказоустойчивый кластер.

- **Клиенты:** По мере необходимости для тестирования можно подключить один или несколько сетевых клиентов к создаваемому отказоустойчивому кластеру и наблюдать за последствиями на клиенте при перемещении или отработке отказа кластеризованного файлового сервера с одного узла кластера на другой.

- **Учетная запись для администрирования кластера:** При первом создании кластера или добавлении в него серверов необходимо войти в домен с учетной записью, обладающей правами администратора и разрешениями на всех серверах в этом кластере. Она не обязательно должна входить в группу "Администраторы домена". Например, это может быть учетная запись пользователя домена, входящая в группу "Администраторы" на каждом кластерном сервере. Кроме того, если учетная запись не является учетной записью администраторов домена, то учетной записи (или группе, в которую входит эта учетная запись) необходимо предоставить разрешения **Создание объектов компьютеров** и **чтение всех свойств** в подразделении домена, которое будет размещаться в.

## <a name="steps-for-installing-a-two-node-file-server-cluster"></a>Действия по установке кластера файловых серверов с двумя узлами

Чтобы установить отказоустойчивый кластер файлового сервера с двумя узлами, необходимо выполнить следующие действия.

Шаг 1. Подключение серверов кластера к сетям и хранилищу

Шаг 2. Установка компонента отказоустойчивого кластера

Шаг 3. Проверка конфигурации кластера

Шаг 4. Создание кластера

Если вы уже установили узлы кластера и хотите настроить отказоустойчивый кластер файлового сервера, см. раздел действия по настройке кластера файлового сервера с двумя узлами далее в этом руководстве.

### <a name="step-1-connect-the-cluster-servers-to-the-networks-and-storage"></a>Шаг 1. Подключение серверов кластера к сетям и хранилищу

Для сети отказоустойчивого кластера Избегайте наличия единой точки отказа. Это достигается несколькими способами. Вы можете подключать узлы кластера к разным сетям. Кроме того, можно подключить узлы кластера к одной сети, созданной с помощью групповых сетевых адаптеров, избыточных коммутаторов, избыточных маршрутизаторов или аналогичного оборудования, которое удаляет единые точки отказа (если используется сеть для iSCSI, необходимо создать эту сеть в дополнение к другим сетям).

Для кластера файловых серверов с двумя узлами при подключении серверов к хранилищу кластера необходимо предоставить по крайней мере два тома (LUN). При тщательном тестировании конфигурации можно предоставить дополнительные тома. Не предоставляйте кластеризованные тома серверам, которые не находятся в кластере.

#### <a name="to-connect-the-cluster-servers-to-the-networks-and-storage"></a>Подключение серверов кластера к сетям и хранилищу

1. Ознакомьтесь с подробными сведениями о сетях в разделе Требования к оборудованию для отказоустойчивого кластера с двумя узлами, а также требований к учетной записи домена для отказоустойчивого кластера с двумя узлами, ранее в этом разделе.

2. Подключите и настройте сети, которые будут использовать серверы в кластере.

3. Если конфигурация теста включает клиенты или некластеризованный контроллер домена, убедитесь, что эти компьютеры могут подключаться к кластеризованным серверам по крайней мере с одной сетью.

4. Чтобы физически подключить серверы к хранилищу, следуйте инструкциям изготовителя.

5. Убедитесь в том, что диски (LUN), которые вы хотите использовать в кластере, доступны кластерным серверам (и только им). Для предоставления дисков или LUN можно использовать любой из следующих интерфейсов:

    - интерфейс, предоставленный изготовителем хранилища;

    - Если вы используете iSCSI, соответствующий интерфейс iSCSI.

6. Если вы приобрели программное обеспечение, которое управляет форматом или функцией диска, следуйте инструкциям поставщика о том, как использовать это программное обеспечение с Windows Server.

7. На одном из серверов, которые необходимо включить в кластер, нажмите кнопку Пуск, выберите пункт Администрирование, затем — Управление компьютером и Управление дисками. (Если отображается диалоговое окно Контроль учетных записей пользователей, убедитесь, что отображаемое действие является нужным, и нажмите кнопку продолжить.) В окне «Управление дисками» убедитесь, что диски кластера видимы.

8. Если требуется объем хранилища более 2 терабайт, а для управления форматом диска используется интерфейс Windows, преобразуйте тип разделов диска в таблицу разделов GPT. Для этого создайте резервную копию данных на диске, удалите все тома на диске, а затем в разделе "Управление дисками" щелкните правой кнопкой мыши диск (не раздел) и выберите команду Преобразовать в диск GPT.  Если объем меньше 2 терабайт, то вместо таблицы разделов GPT можно использовать тип разделов, называемый основной загрузочной записью (MBR).

9. Проверьте форматы всех предоставленных томов или LUN. Рекомендуется использовать NTFS в качестве формата (для диска-свидетеля требуется NTFS).

### <a name="step-2-install-the-file-server-role-and-failover-cluster-feature"></a>Шаг 2. Установка роли файлового сервера и компонента отказоустойчивого кластера

На этом шаге будет установлена роль файлового сервера и компонент отказоустойчивого кластера. Оба сервера должны работать под управлением Windows Server 2016 или Windows Server 2019.

#### <a name="using-server-manager"></a>Использование диспетчер сервера

1. Откройте **Диспетчер сервера** и в раскрывающемся списке **Управление** выберите **Добавить роли и компоненты**.

   ![Добавление функции](media/Cluster-File-Server/Cluster-FS-Add-Feature.png)

2. Если откроется окно **перед началом** , нажмите кнопку **Далее**.

3. Для **типа установки**выберите Установка на **основе ролей или компонентов** и **Далее**.

4. Убедитесь, что выбран параметр **выбрать сервер из пула серверов** , имя компьютера выделено и нажмите кнопку **Далее**.

5. Для роли сервера в списке ролей откройте **Файловые службы**, выберите **файловый сервер**и **Далее**.

   ![Добавление роли](media/Cluster-File-Server/Cluster-FS-Add-FS-Role-1.png)

6. Для функций в списке компонентов выберите **отказоустойчивая кластеризация**.  Всплывающее диалоговое окно содержит список средств администрирования, которые также устанавливаются.  Не заключайте все выбранные **элементы, выберите Добавить компоненты** и **Далее**.

   ![Добавление функции](media/Cluster-File-Server/Cluster-FS-Add-WSFC-1.png)

7. На странице Подтверждение щелкните Установить.

8. После завершения установки перезагрузите компьютер.

9. Повторите эти действия на втором компьютере.

#### <a name="using-powershell"></a>Использование PowerShell

1. Откройте сеанс администрирования PowerShell, щелкнув правой кнопкой мыши кнопку Пуск и выбрав пункт **Windows PowerShell (администратор)**.
2. Чтобы установить роль файлового сервера, выполните команду:

    ```PowerShell
    Install-WindowsFeature -Name FS-FileServer
    ```

3. Чтобы установить компонент отказоустойчивой кластеризации и его средства управления, выполните команду:

    ```PowerShell
    Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools
    ```

4. После завершения установки их можно проверить с помощью команд:

    ```PowerShell
    Get-WindowsFeature -Name FS-FileServer
    Get-WindowsFeature -Name Failover-Clustering
    ```

5. Убедившись, что они установлены, перезапустите компьютер с помощью команды:

    ```PowerShell
    Restart-Computer
    ```

6. Повторите эти действия на втором сервере.

### <a name="step-3-validate-the-cluster-configuration"></a>Шаг 3. Проверка конфигурации кластера

Перед созданием кластера настоятельно рекомендуется проверить конфигурацию. Проверка позволяет убедиться, что конфигурация серверов, сети и хранилища соответствует набору конкретных требований для отказоустойчивых кластеров.

#### <a name="using-failover-cluster-manager"></a>Использование диспетчера отказоустойчивого кластера.

1. В **Диспетчер сервера**выберите раскрывающийся список **сервис** и выберите **Диспетчер отказоустойчивости кластеров**.

2. В **Диспетчер отказоустойчивости кластеров**перейдите к среднему столбцу в разделе **Управление** и выберите **проверить конфигурацию**.

3. Если откроется окно **перед началом** , нажмите кнопку **Далее**.

4. В окне **Выбор серверов или кластера** добавьте имена двух компьютеров, которые будут узлами кластера.  Например, если имена являются NODE1 и NODE2, введите имя и нажмите кнопку **Добавить**.  Можно также нажать кнопку **Обзор** , чтобы найти в Active Directory имена.  Как только они будут перечислены в списке **Выбранные серверы**, нажмите кнопку **Далее**.

5. В окне " **Параметры тестирования** " выберите **выполнить все тесты (рекомендуется)** и **Далее**.

6. На странице **Подтверждение** появится список всех тестов, которые будут проверяться.  Нажмите кнопку **Далее, после** чего начнется тестирование.

7. После выполнения тестов отобразится страница **Сводка** . Чтобы просмотреть разделы справки, которые помогут вам интерпретировать результаты, щелкните **Подробнее о тестах проверки кластера**.

8. На странице Сводка щелкните пункт Просмотреть отчет, чтобы просмотреть результаты тестов. Внесите необходимые изменения в конфигурацию и повторно запустите тесты. <br>Просмотр результатов тестов после закрытия мастера см. в разделе *Системрут\клустер\репортс\валидатион Report Date and time.html*.

9. Чтобы просмотреть разделы справки о проверке кластера после закрытия мастера, в разделе Управление отказоустойчивым кластером нажмите кнопку Справка, щелкните разделы справки, перейдите на вкладку содержимое, разверните содержимое для справки по отказоустойчивому кластеру и щелкните Проверка конфигурации отказоустойчивого кластера.

#### <a name="using-powershell"></a>Использование PowerShell

1. Откройте сеанс администрирования PowerShell, щелкнув правой кнопкой мыши кнопку Пуск и выбрав пункт **Windows PowerShell (администратор)**.

2. Чтобы проверить компьютеры (например, имена компьютеров NODE1 и NODE2) для отказоустойчивой кластеризации, выполните команду:

    ```PowerShell
    Test-Cluster -Node "NODE1","NODE2"
    ```
4. Чтобы просмотреть результаты тестов после закрытия мастера, ознакомьтесь с указанным файлом (в Системрут\клустер\репортс \) , внесите необходимые изменения в конфигурацию и повторно запустите тесты.

Дополнительные сведения см. [в разделе Проверка конфигурации отказоустойчивого кластера](/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj134244(v=ws.11)).

### <a name="step-4-create-the-cluster"></a>Шаг 4. Создание кластера

Следующий пример приведет к созданию кластера из компьютеров и конфигурации.

#### <a name="using-failover-cluster-manager"></a>Использование диспетчера отказоустойчивого кластера.

1. В **Диспетчер сервера**выберите раскрывающийся список **сервис** и выберите **Диспетчер отказоустойчивости кластеров**.

2. В **Диспетчер отказоустойчивости кластеров**перейдите к среднему столбцу в разделе **Управление** и выберите **создать кластер**.

3. Если откроется окно **перед началом** , нажмите кнопку **Далее**.

4. В окне **Выбор серверов** добавьте имена двух компьютеров, которые будут узлами кластера.  Например, если имена являются NODE1 и NODE2, введите имя и нажмите кнопку **Добавить**.  Можно также нажать кнопку **Обзор** , чтобы найти в Active Directory имена.  Как только они будут перечислены в списке **Выбранные серверы**, нажмите кнопку **Далее**.

5. В **точке доступа для администрирования окна кластера** введите имя кластера, который будет использоваться.  Обратите внимание, что это не имя, которое будет использоваться для подключения к общим файловым ресурсам с помощью.  Это предназначено для простого администрирования кластера.

   > [!NOTE]
   > Если используются статические IP-адреса, необходимо выбрать сеть для использования и ввести IP-адрес, который будет использоваться для имени кластера.  Если для IP-адресов используется DHCP, IP-адрес будет настроен автоматически.

6. Нажмите кнопку **Далее**.

7. На странице **Подтверждение** проверьте, что вы настроили, и нажмите кнопку **Далее** , чтобы создать кластер.

8. На странице **Сводка** будет предоставлена созданная конфигурация.  Можно выбрать пункт Просмотреть отчет, чтобы просмотреть отчет о создании.

#### <a name="using-powershell"></a>Использование PowerShell

1. Откройте сеанс администрирования PowerShell, щелкнув правой кнопкой мыши кнопку Пуск и выбрав пункт **Windows PowerShell (администратор)**.

2. Выполните следующую команду, чтобы создать кластер, если используются статические IP-адреса.  Например, имена компьютеров — NODE1 и NODE2, имя кластера будет КЛАСТЕРом, а IP-адрес будет 1.1.1.1.

   ```PowerShell
    New-Cluster -Name CLUSTER -Node "NODE1","NODE2" -StaticAddress 1.1.1.1
   ```

3. Выполните следующую команду, чтобы создать кластер, если для IP-адресов используется DHCP.  Например, имена компьютеров — NODE1 и NODE2, а имя кластера будет КЛАСТЕРом.

   ```PowerShell
   New-Cluster -Name CLUSTER -Node "NODE1","NODE2"
   ```

### <a name="steps-for-configuring-a-file-server-failover-cluster"></a>Действия по настройке отказоустойчивого кластера файлового сервера

Чтобы настроить отказоустойчивый кластер файлового сервера, выполните следующие действия.

1. В **Диспетчер сервера**выберите раскрывающийся список **сервис** и выберите **Диспетчер отказоустойчивости кластеров**.

2. Когда диспетчер отказоустойчивости кластеров откроется, он автоматически отобразит имя созданного кластера.  Если это не так, перейдите к среднему столбцу в разделе " **Управление** " и выберите **подключиться к кластеру**.  Введите имя созданного кластера и нажмите **кнопку ОК**.

3. В дереве консоли щелкните знак ">" рядом с созданным кластером, чтобы развернуть элементы под ним.

4. Щелкните правой кнопкой мыши **роли** и выберите пункт **настроить роль**.

5. Если откроется окно **перед началом** , нажмите кнопку **Далее**.

6. В списке ролей выберите **файловый сервер** и **Далее**.

7. Для типа файлового сервера выберите **файловый сервер для общего использования** и **Далее**.<br>Сведения о масштабируемый файловый сервер см. в разделе [Общие сведения о Масштабируемый файловый сервер](sofs-overview.md).

   ![Тип файлового сервера](media/Cluster-File-Server/Cluster-FS-File-Server-Type.png)

8. В окне **точка доступа клиента** введите имя файлового сервера, который будет использоваться.  Обратите внимание, что это не имя кластера.  Это для подключения к общей папке.  Например, если я хочу подключиться к серверу, выводимое \\ имя будет «Server».

   > [!NOTE]
   > Если используются статические IP-адреса, необходимо выбрать сеть для использования и ввести IP-адрес, который будет использоваться для имени кластера.  Если для IP-адресов используется DHCP, IP-адрес будет настроен автоматически.

9. Нажмите кнопку **Далее**.

10. В окне **Выбор хранилища** выберите дополнительный диск (а не следящий сервер), в котором будут храниться общие папки, и нажмите кнопку **Далее**.

11. На странице **Подтверждение** Проверьте конфигурацию и нажмите кнопку **Далее**.

12. На странице **Сводка** будет предоставлена созданная конфигурация.  Можно выбрать пункт Просмотреть отчет, чтобы просмотреть отчет о создании роли файлового сервера.

   > [!NOTE]
   > Если роль не добавляется или не запускается должным образом, CNO (объект имени кластера) может не иметь разрешения на создание объектов в Active Directory. Роли файлового сервера требуется объект компьютера с таким же именем, как и точка доступа клиента, предоставленная на шаге 8.

13. В разделе **роли** в дереве консоли вы увидите созданную роль с именем, которое вы создали в списке.  Выделив его, на панели **действия** справа выберите **Добавить общую папку**.

14. Запустите мастер общих ресурсов, выполнив следующие действия:

    - Тип общего ресурса, который он будет
    - Расположение или путь к папке, к которой будет предоставлен общий доступ
    - Имя общего ресурса, к которому будут подключаться пользователи
    - Дополнительные параметры, такие как перечисление на основе доступа, кэширование, шифрование и т. д.
    - Разрешения на уровне файлов, если они не используются по умолчанию

15. На странице **Подтверждение** проверьте, что вы настроили, и нажмите кнопку **создать** , чтобы создать общую папку файлового сервера.

16. На странице **результаты** выберите Закрыть, если она создала общую папку.  Если не удалось создать общую папку, будут выдаваться все возникшие ошибки.

17. Нажмите кнопку **Закрыть**.

18. Повторите эту процедуру для всех дополнительных общих папок.
