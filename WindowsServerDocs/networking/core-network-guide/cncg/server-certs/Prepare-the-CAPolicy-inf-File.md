---
title: Подготовка файла CAPolicy.inf
description: Файла CAPolicy.inf содержит различные параметры, которые используются при установке службы сертификации Active Directory (AD CS), или при обновлении сертификата ЦС.
manager: alanth
ms.topic: article
ms.assetid: 65b36794-bb09-4c1b-a2e7-8fc780893d97
ms.prod: windows-server-threshold
ms.technology: networking
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 19a87df7c4f165d3b0e6c5add4bc40ff97cc87cb
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446459"
---
# <a name="capolicyinf-syntax"></a>Синтаксис файла CAPolicy.inf
>   Область применения. Windows Server (полугодовой канал), Windows Server 2016

Файла CAPolicy.inf приведен файл конфигурации, который определяет расширения, ограничения и другие параметры конфигурации, которые применяются к корневого центра сертификации и все сертификаты, выданные корневым ЦС. Файл CAPolicy.inf должны устанавливаться на сервере узла перед процедуру установки для корневого ЦС начинает использоваться. Когда изменяемые ограничения безопасности для корневого ЦС, корневой сертификат должен обновляться и обновленный файл CAPolicy.inf должны устанавливаться на сервере, перед началом процесса обновления.

— Файла CAPolicy.inf:

-   Создается и определяется вручную администратором

-   Используется во время создания корневых сертификатов и сертификатов подчиненных ЦС

-   Определенные для подписи ЦС, где для входа и выдать сертификат (не ЦС, где предоставляется запроса)

После создания файла CAPolicy.inf, необходимо скопировать его в **% systemroot %** папки сервера перед началом установки служб сертификатов AD или обновлять сертификат ЦС.

Файла CAPolicy.inf дает возможность указать и настроить разнообразными ЦС атрибуты и параметры. Ниже описываются все параметры для создания файла INF, адаптированные под конкретные потребности.

## <a name="capolicyinf-file-structure"></a>Структура файла CAPolicy.inf

Следующие термины используются для описания структуры файлов .inf:

-   _Раздел_ — представляет собой область, файла, который охватывает логической группы ключей. Имена разделов в INF-файлов определяются в квадратные скобки. Многие, но не все разделы используются для настройки расширений сертификатов.

-   _Ключ_ — имя элемента и отображается слева от знака равенства.

-   _Значение_ — является параметром, так и справа от знака равенства.

В следующем примере **[Version]** раздел, **подпись** является ключом, и **"\$Windows NT\$"** -значение.

Пример.

```PowerShell
[Version]                     #section
Signature="$Windows NT$"      #key=value
```

###  <a name="version"></a>Version

Определяет файл как INF-файл. Версия — единственный необходимый раздел и должен находиться в начале файла CAPolicy.inf.

###  <a name="policystatementextension"></a>PolicyStatementExtension

Список политик, определенных организацией, и являются ли они необязательным или обязательным. Несколько политик разделяются запятыми. Имена имеют смысл в контексте конкретного развертывания, или по отношению к пользовательских приложений, для обнаружения этих политик.

Для каждой политики, который определен должен быть раздел, который определяет параметры для этой конкретной политики. Для каждой политики необходимо указать идентификатор определяемого пользователем объекта (OID) и либо текст, который необходимо отображать в инструкции политики или URL-адрес указатель инструкции политики. URL-адрес может быть в формате HTTP, FTP или URL-адреса LDAP.

Если вы собираетесь имеют описательный текст инструкции политики, следующие три строки файла CAPolicy.inf будет выглядеть так:

```
[InternalPolicy]
OID=1.1.1.1.1.1.1
Notice=”Legal policy statement text”
```

Если вы собираетесь использовать URL-адрес для размещения ЦС инструкции политики, затем следующие три строки вместо выглядит следующим образом:

```
[InternalPolicy]
OID=1.1.1.1.1.1.2
URL=https://pki.wingtiptoys.com/policies/legalpolicy.asp
```

Дополнительно

-   Поддерживаются несколько URL-адрес и обратите внимание, что ключи.

-   Обратите внимание, что и URL-адрес ключи в один и тот же раздел политики поддерживаются.

-   URL-адреса с пробелами или текст с пробелами должно быть заключено в кавычки. Это касается **URL-адрес** ключа, независимо от того, раздел, в котором он находится.

Пример нескольких уведомлений и URL-адреса в раздел политики выглядит следующим образом:

```
[InternalPolicy]
OID=1.1.1.1.1.1.1
URL=https://pki.wingtiptoys.com/policies/legalpolicy.asp
URL=ftp://ftp.wingtiptoys.com/pki/policies/legalpolicy.asp
Notice=”Legal policy statement text”
```

### <a name="crldistributionpoint"></a>CRLDistributionPoint

Можно указать точки распространения списка отзыва Сертификатов (CRL) для корневого сертификата ЦС в файле CAPolicy.inf.  После установки ЦС, можно настроить URL-адреса CDP, включающий в каждый сертификат, выданный ЦС. Сертификат корневого ЦС показан URL-адреса, указанные в этом разделе файла CAPolicy.inf. 

```
[CRLDistributionPoint]
URL=http://pki.wingtiptoys.com/cdp/WingtipToysRootCA.crl
```

Некоторые дополнительные сведения об этом разделе:
-   поддерживает:
    - HTTP 
    - URL-адреса файла
    - URL-адреса LDAP 
    - Несколько URL-адресов
   
    >[!IMPORTANT]
    >Не поддерживает URL-адреса HTTPS.

-   Кавычки необходимо заключить URL-адреса с пробелами.

-   Если нет URL-адресов указаны — то есть если **[CRLDistributionPoint]** раздел существует в файле, но является пустым, а расширения исключается из сертификата корневого ЦС. Это обычно предпочтительнее, чем при настройке корневого ЦС. Windows не выполняет проверки сертификата корневого ЦС, поэтому CDP-расширение является излишним корневой сертификат ЦС отзыва.

-    ЦС можно опубликовать ФАЙЛ UNC-пути, например, в общую папку, представляющий папку веб-сайта, где клиент получает по протоколу HTTP.

-   Этот раздел используется только при установке корневого ЦС или продлении сертификата корневого ЦС. ЦС определяет расширения подчиненного центра сертификации CDP.
   

### <a name="authorityinformationaccess"></a>AuthorityInformationAccess

Можно указать точки доступа центра сведения в файле CAPolicy.inf для корневого центра сертификации.

```
[AuthorityInformationAccess]
URL=http://pki.wingtiptoys.com/Public/myCA.crt
```

Дополнительные замечания по информации о центрах сертификации доступа к разделу:

-   Поддерживаются несколько URL-адресов.

-   Поддерживаются протоколы HTTP, FTP, LDAP и URL-адреса файла. URL-адреса HTTPS не поддерживаются.

-   В этом разделе используется только в том случае, если при установке корневого ЦС или продлении сертификата корневого ЦС. Расширения подчиненного ЦС AIA определяются ЦС, который выдал сертификат подчиненного ЦС.

-   URL-адреса с пробелами должно быть заключено в кавычки.

-   Если нет URL-адресов указаны — то есть если **[AuthorityInformationAccess]** раздел существует в файле, но является пустым, а сертификат корневого ЦС отсутствует расширение точки распространения списка отзыва Сертификатов. Опять же это будет предпочтительным параметр в случае сертификата корневого ЦС отсутствует сертификации выше, чем с корневым ЦС, необходимо ссылаться на ссылку на свой сертификат, как.

### <a name="certsrvserver"></a>certsrv_Server

Другим необязательным разделом файла CAPolicy.inf является [certsrv_server], который используется для указания обновления длины ключа, срока и срок действия отзыва список ОТЗЫВА сертификата для ЦС, которые будут обновлены или установлены. Ни один из ключей в этом разделе необходимы. Многие из этих параметров имеют значения по умолчанию, которые достаточны для большинства задач и можно просто опустить из файла CAPolicy.inf. Кроме того многие из этих параметров можно изменить после установки ЦС.

Пример выглядит следующим образом:

```
[certsrv_server]
RenewalKeyLength=2048
RenewalValidityPeriod=Years
RenewalValidityPeriodUnits=5
CRLPeriod=Days
CRLPeriodUnits=2
CRLDeltaPeriod=Hours
CRLDeltaPeriodUnits=4
ClockSkewMinutes=20
LoadDefaultTemplates=True
AlternateSignatureAlgorithm=0
ForceUTF8=0
EnableKeyCounting=0
```

**RenewalKeyLength** задает размер ключа только для обновления. Это используется только тогда, когда новая пара ключей создается во время обновления сертификатов ЦС. Размер ключа для начального сертификата ЦС устанавливается при установке ЦС.

При обновлении сертификата ЦС с помощью новой пары ключей, длина ключа может быть либо увеличивается или уменьшается. Например если вы задали корня размер ключа ЦС 4096 байтов или более поздней версии и обнаружите, что у вас есть приложения Java или сетевых устройств, которые поддерживают только размеры ключа 2048 байтов. Ли увеличить или уменьшить размер, необходимо повторно выдать все сертификаты, выданные этим ЦС.

**RenewalValidityPeriod** и **RenewalValidityPeriodUnits** установить время существования нового сертификата корневого ЦС, при обновлении старого сертификата корневого ЦС. Он применяется только к корневому ЦС. Время жизни сертификата подчиненного ЦС, определяется его руководителя. RenewalValidityPeriod может иметь следующие значения: Часов, дней, недель, месяцев и лет.

**CRLPeriod** и **CRLPeriodUnits** задания срока для базового списка отзыва Сертификатов. **CRLPeriod** может иметь следующие значения: Часов, дней, недель, месяцев и лет.

**CRLDeltaPeriod** и **CRLDeltaPeriodUnits** задания срока разностного списка отзыва Сертификатов. **CRLDeltaPeriod** может иметь следующие значения: Часов, дней, недель, месяцев и лет.

Каждый из этих параметров можно настроить после установки ЦС:

```
Certutil -setreg CACRLPeriod Weeks
Certutil -setreg CACRLPeriodUnits 1
Certutil -setreg CACRLDeltaPeriod Days
Certutil -setreg CACRLDeltaPeriodUnits 1
```

Не забудьте перезапустить службы сертификатов Active Directory какие-либо изменения вступили в силу.

**LoadDefaultTemplates** применяется только во время установки ЦС предприятия. Этот параметр, либо значение True или False (или 1 или 0), определяет, если в ЦС настроен с любым из шаблонов по умолчанию.

При установке по умолчанию ЦС подмножество шаблоны сертификатов по умолчанию добавляется к папке шаблонов сертификатов оснастки центра сертификации. Это означает, что сразу же после запуска службы AD CS, после установки роли пользователя или компьютера с достаточными разрешениями могут немедленно зарегистрировать сертификат.

Может потребоваться выдавать сертификаты, сразу после установки ЦС, поэтому параметр LoadDefaultTemplates позволяет предотвратить добавление к ЦС предприятия шаблонов по умолчанию. Если нет шаблонов, настроенный в ЦС, он может выдавать сертификаты отсутствуют.

**AlternateSignatureAlgorithm** настраивает ЦС для поддержки PKCS\#1 формат подписи V2.1 для запросов на сертификаты и сертификат ЦС. Если установлено значение 1 для корневого ЦС сертификата ЦС будет включать PKCS\#1 формат подписи версии 2.1. Если задано значение на подчиненный ЦС, подчиненный ЦС будет создан запрос на сертификат, включающий PKCS\#1 формат подписи версии 2.1.

**ForceUTF8** меняет используемый по умолчанию кодировку относительные различающиеся имена (RDN) в субъекта и издателя различающиеся имена в UTF-8. Только эти также RDN, которые поддерживают UTF-8, например те, которые определены как каталог строковые типы, функцию RFC, затрагиваются. Например RDN для компонента домена (DC) поддерживает кодировку, что IA5 или UTF-8, а Country RDN (C) поддерживает только кодировку виде печатаемые строки. Директива ForceUTF8 таким образом повлияет на RDN контроллера домена, но не повлияет на C RDN.

**EnableKeyCounting** настраивает ЦС для увеличения значения счетчика при каждом использовании ключа подписи ЦС. Не следует включать этот параметр, если у вас есть аппаратный модуль безопасности (HSM) и поставщика связанных служб шифрования (CSP), поддерживающий ключа инвентаризации. Ни поставщике служб Шифрования со строгими Microsoft, ни поставщик хранилища ключей (KSP) программного обеспечения Майкрософт поддержка ключа подсчета.


## <a name="create-the-capolicyinf-file"></a>Создание файла CAPolicy.inf

Перед установкой AD CS, следует настроить файл CAPolicy.inf с определенными параметрами для развертывания.

**Предварительные требования.** Необходимо быть членом группы "Администраторы".

1. На компьютере, где вы планируете установить AD CS, откройте Windows PowerShell, введите **c:\CAPolicy.inf Блокнот** и нажмите клавишу ВВОД.

2. Когда появится приглашение создать новый файл, нажмите кнопку **Да**.

3. Введите в качестве содержимого файла следующее:
   ```
   [Version]  
   Signature="$Windows NT$"  
   [PolicyStatementExtension]  
   Policies=InternalPolicy  
   [InternalPolicy]  
   OID=1.2.3.4.1455.67.89.5  
   Notice="Legal Policy Statement"  
   URL=https://pki.corp.contoso.com/pki/cps.txt  
   [Certsrv_Server]  
   RenewalKeyLength=2048  
   RenewalValidityPeriod=Years  
   RenewalValidityPeriodUnits=5  
   CRLPeriod=weeks  
   CRLPeriodUnits=1  
   LoadDefaultTemplates=0  
   AlternateSignatureAlgorithm=1  
   [CRLDistributionPoint]  
   [AuthorityInformationAccess]
   ```
4. Нажмите кнопку **файл**, а затем нажмите кнопку **Сохранить как**.

5. Перейдите в папку % systemroot %.

6. Убедитесь, что:

   -   в поле **Имя файла** установлено значение **CAPolicy.inf**

   -   в поле**Тип файла** выбрано **Все файлы**;

   -   в поле **Кодировка** выбрано **ANSI**.

7. Нажмите кнопку **Сохранить**.

8. Когда появится предложение перезаписать файл, нажмите кнопку **Да**.

   ![Сохранить как расположение файла CAPolicy.inf](../../../media/Prepare-the-CAPolicy-inf-File/001-SaveCAPolicyORCA1.gif)

   > [!CAUTION]
   >   Обязательно сохраните файл CAPolicy.inf с расширением "inf". Если вы специально не укажете **.inf** в конце имени файла и выберете предложенные настройки, то файл будет сохранен как текстовый и не будет использоваться при установке ЦС.

9. Закройте Блокнот.

> [!IMPORTANT]
>   В файле CAPolicy.inf, можно увидеть, имеется строка с указанием URL-адрес https://pki.corp.contoso.com/pki/cps.txt. Раздел внутренней политики файла CAPolicy.inf показан только в качестве примера того, как вы будете указывать расположение уведомления о правилах работы с сертификатами (CPS). В этом руководстве не содержатся инструкции по созданию сертификатами (CPS).
