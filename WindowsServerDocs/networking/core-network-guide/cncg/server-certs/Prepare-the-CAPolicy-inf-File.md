---
title: Подготовка файла CAPolicy.inf
description: Файл CAPolicy. inf содержит различные параметры, которые используются при установке службы сертификации Active Directory (AD CS) или при продлении сертификата ЦС.
manager: alanth
ms.topic: article
ms.assetid: 65b36794-bb09-4c1b-a2e7-8fc780893d97
ms.prod: windows-server
ms.technology: networking
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 4df23cd64bcf3bf9c27190908fb5f2a48b30b833
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "80318290"
---
# <a name="capolicyinf-syntax"></a>Синтаксис файла CAPolicy. INF
>   Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Файл CAPolicy. inf является файлом конфигурации, который определяет расширения, ограничения и другие параметры конфигурации, применяемые к сертификату корневого ЦС и всем сертификатам, выданным корневым ЦС. Файл CAPolicy. inf должен быть установлен на сервере узла до начала процедуры установки для корневого ЦС. При изменении ограничений безопасности корневого ЦС необходимо обновить корневой сертификат, а на сервере должен быть установлен обновленный файл CAPolicy. INF, прежде чем начнется процесс обновления.

Файл CAPolicy. INF:

-   Создано и определено вручную администратором

-   Используется при создании сертификатов корневого и подчиненного ЦС

-   Определяется в ЦС для подписи и выдает сертификат (а не в центр сертификации, где предоставлен запрос).

После создания файла CAPolicy. INF его необходимо скопировать в папку **% systemroot%** сервера, прежде чем устанавливать ADCS или обновлять сертификат ЦС.

Файл CAPolicy. INF позволяет указать и настроить широкий спектр атрибутов и параметров ЦС. В следующем разделе описаны все варианты создания INF-файла, адаптированного к конкретным потребностям.

## <a name="capolicyinf-file-structure"></a>Структура файла CAPolicy. INF

Для описания структуры INF-файла используются следующие термины:

-   _Section_ — это область файла, охватывающая логическую группу ключей. Имена разделов в INF-файлах идентифицируются в квадратных скобках. Для настройки расширений сертификатов используются многие, но не все разделы.

-   _Ключ_ — имя записи, которая отображается слева от знака равенства.

-   _Значение_ — это параметр, который отображается справа от знака равенства.

В примере ниже **[Version]** — это раздел, **Signature** — ключ, а **"\$Windows NT\$"** — это значение.

Пример.

```PowerShell
[Version]                     #section
Signature="$Windows NT$"      #key=value
```

###  <a name="version"></a>Версия

Определяет файл как INF-файл. Версия — это единственный обязательный раздел, который должен находиться в начале файла CAPolicy. INF.

###  <a name="policystatementextension"></a>полицистатементекстенсион

Выводит список политик, которые были определены Организацией и являются ли они обязательными или обязательными. Несколько политик разделяются запятыми. Имена имеют значение в контексте конкретного развертывания или в отношении пользовательских приложений, которые проверяют наличие этих политик.

Для каждой определенной политики должен быть раздел, определяющий параметры этой политики. Для каждой политики необходимо указать определяемый пользователем идентификатор объекта (OID) и текст, который должен отображаться в качестве инструкции политики или указателя URL-адреса инструкции политики. URL-адрес может иметь вид URL-адреса HTTP, FTP или LDAP.

Если вы собираетесь использовать описательный текст в инструкции политики, то следующие три строки файла CAPolicy. INF будут выглядеть следующим образом:

```
[InternalPolicy]
OID=1.1.1.1.1.1.1
Notice=”Legal policy statement text”
```

Если вы собираетесь использовать URL-адрес для размещения инструкции политики ЦС, следующие три строки будут выглядеть следующим образом:

```
[InternalPolicy]
OID=1.1.1.1.1.1.2
URL=https://pki.wingtiptoys.com/policies/legalpolicy.asp
```

Дополнительно

-   Поддерживаются несколько ключей URL и уведомлений.

-   Ключи уведомлений и URL-адреса в одном разделе политики поддерживаются.

-   URL-адреса с пробелами или текстом с пробелами должны заключаться в кавычки. Это справедливо для ключа **URL-адреса** , независимо от того, в каком разделе он отображается.

Пример нескольких уведомлений и URL-адресов в разделе политики будет выглядеть следующим образом:

```
[InternalPolicy]
OID=1.1.1.1.1.1.1
URL=https://pki.wingtiptoys.com/policies/legalpolicy.asp
URL=ftp://ftp.wingtiptoys.com/pki/policies/legalpolicy.asp
Notice=”Legal policy statement text”
```

### <a name="crldistributionpoint"></a>крлдистрибутионпоинт

Можно указать точки распространения списков отзыва сертификатов (CDP) для сертификата корневого ЦС в файле CAPolicy. INF.  После установки ЦС можно настроить URL-адреса CDP, которые ЦС включает в каждый выданный сертификат. В сертификате корневого ЦС отображаются URL-адреса, указанные в этом разделе файла CAPolicy. INF. 

```
[CRLDistributionPoint]
URL=http://pki.wingtiptoys.com/cdp/WingtipToysRootCA.crl
```

Дополнительные сведения об этом разделе:
-   Принтер
    - HTTP 
    - URL-адреса файлов
    - URL-адреса LDAP 
    - Несколько URL-адресов
   
    >[!IMPORTANT]
    >Не поддерживает URL-адреса HTTPS.

-   Кавычки должны выключать URL-адреса с пробелами.

-   Если URL-адреса не указаны, то есть если раздел **[крлдистрибутионпоинт]** существует в файле, но является пустым — расширение точки распространения списка отзыва сертификатов опускается из сертификата корневого ЦС. Обычно это предпочтительно при настройке корневого ЦС. Windows не выполняет проверку отзыва сертификата корневого ЦС, поэтому расширение CDP избыточно в сертификате корневого ЦС.

-    ЦС может опубликовать файл в формате UNC, например в общей папке, которая представляет папку веб-сайта, который клиент получает по протоколу HTTP.

-   Используйте этот раздел, только если вы настраиваете корневой ЦС или обновляете сертификат корневого ЦС. ЦС определяет подчиненный ЦС с расширениями CDP.
   

### <a name="authorityinformationaccess"></a>аусоритинформатионакцесс

Можно указать точки доступа к сведениям о центрах сертификации в файле CAPolicy. INF для сертификата корневого ЦС.

```
[AuthorityInformationAccess]
URL=http://pki.wingtiptoys.com/Public/myCA.crt
```

Некоторые дополнительные примечания к разделу "доступ к сведениям о центрах сертификации":

-   Поддерживается несколько URL-адресов.

-   Поддерживаются HTTP, FTP, LDAP и URL-адреса файлов. URL-адреса HTTPS не поддерживаются.

-   Этот раздел используется только в том случае, если вы настраиваете корневой ЦС или обновляете сертификат корневого ЦС. Расширения подчиненного ЦС AIA определяются центром сертификации, который выдал сертификат подчиненного ЦС.

-   URL-адреса с пробелами должны заключаться в кавычки.

-   Если URL-адреса не указаны, то есть если раздел **[аусоритинформатионакцесс]** существует в файле, но является пустым — расширение доступа к информации о центрах пропускается из сертификата корневого ЦС. Опять же, это предпочтительно в случае с сертификатом корневого ЦС, так как центр сертификации не имеет более высокого уровня, чем корневой ЦС, на который необходимо ссылаться по ссылке на его сертификат.

### <a name="certsrv_server"></a>certsrv_Server

Другой необязательный раздел файла CAPolicy. INF — [certsrv_server], который используется для указания длины ключа продления, периода действия продления и срока действия списка отзыва сертификатов (CRL) для центра обновления или установки. Ни один из ключей в этом разделе не требуется. Многие из этих параметров имеют значения по умолчанию, достаточные для большинства нужд, и могут быть просто опущены в файле CAPolicy. INF. Кроме того, многие из этих параметров можно изменить после установки центра сертификации.

Пример будет выглядеть следующим образом:

```
[certsrv_server]
RenewalKeyLength=2048
RenewalValidityPeriod=Years
RenewalValidityPeriodUnits=5
CRLPeriod=Days
CRLPeriodUnits=2
CRLDeltaPeriod=Hours
CRLDeltaPeriodUnits=4
ClockSkewMinutes=20
LoadDefaultTemplates=True
AlternateSignatureAlgorithm=0
ForceUTF8=0
EnableKeyCounting=0
```

**Реневалкэйленгс** задает размер ключа только для обновления. Используется только в том случае, если во время продления сертификата ЦС создается новая пара ключей. Размер ключа для первоначального сертификата ЦС задается при установке центра сертификации.

При обновлении сертификата ЦС с новой парой ключей длина ключа может быть либо увеличена, либо уменьшена. Например, если вы установили размер ключа корневого ЦС 4096 байт или более, а затем обнаружите, что у вас есть приложения Java или сетевые устройства, которые поддерживают только размеры ключей 2048 байт. При увеличении или уменьшении размера необходимо повторно выполнить все сертификаты, выданные этим ЦС.

**Реневалвалидитипериод** и **реневалвалидитипериодунитс** устанавливают время существования нового сертификата корневого ЦС при продлении старого сертификата корневого ЦС. Он применяется только к корневому ЦС. Время существования сертификата подчиненного ЦС определяется его старшим. Реневалвалидитипериод может иметь следующие значения: hours, Days, weeks, months и years.

**Крлпериод** и **крлпериодунитс** устанавливают срок действия для базового списка отзыва сертификатов. **Крлпериод** может иметь следующие значения: hours, Days, weeks, months и years.

**Крлделтапериод** и **крлделтапериодунитс** устанавливают период действия разностного CRL. **Крлделтапериод** может иметь следующие значения: hours, Days, weeks, months и years.

Каждый из этих параметров можно настроить после установки центра сертификации:

```
Certutil -setreg CACRLPeriod Weeks
Certutil -setreg CACRLPeriodUnits 1
Certutil -setreg CACRLDeltaPeriod Days
Certutil -setreg CACRLDeltaPeriodUnits 1
```

Не забудьте перезапустить службы сертификатов Active Directory, чтобы изменения вступили в силу.

**Лоаддефаулттемплатес** применяется только во время установки ЦС предприятия. Этот параметр (true или false (или 1 или 0) определяет, настроен ли ЦС с использованием любого из шаблонов по умолчанию.

При установке центра сертификации по умолчанию подмножество шаблонов сертификатов по умолчанию добавляется в папку Шаблоны сертификатов оснастки "центр сертификации". Это означает, что при запуске службы AD CS после установки роли пользователь или компьютер с достаточными разрешениями могут немедленно зарегистрироваться для получения сертификата.

Вы можете не захотеть выдавать сертификаты сразу после установки центра сертификации, поэтому можно использовать параметр Лоаддефаулттемплатес, чтобы шаблоны по умолчанию не добавлялись в ЦС предприятия. Если в ЦС не настроены шаблоны, он может не выдавать сертификаты.

**Алтернатесигнатуреалгорисм** настраивает ЦС для поддержки формата подписи PKCS\#1 версии 2.1 как для сертификатов ЦС, так и для запросов сертификатов. Если для корневого ЦС задано значение 1, сертификат ЦС будет включать формат подписи PKCS\#1 версии 2.1. При установке в подчиненном ЦС подчиненный ЦС создает запрос на сертификат, который включает формат подписи PKCS\#1 версии 2.1.

**ForceUTF8** изменяет кодировку по умолчанию относительного различающегося имени (рднс) в различающихся именах субъектов и издателей в кодировке UTF-8. Затрагиваются только те Рднс, которые поддерживают UTF-8, например те, которые определены как строковые типы каталога RFC. Например, RDN для компонента домена (DC) поддерживает кодирование как IA5 или UTF-8, а RDN страны (C) поддерживает кодирование только как печатную строку. Поэтому директива ForceUTF8 влияет на RDN контроллера домена, но не влияет на RDN в C.

**Енаблекэйкаунтинг** настраивает ЦС на увеличение счетчика при каждом использовании ключа подписывания ЦС. Не включайте этот параметр, если у вас нет аппаратного модуля безопасности (HSM) и связанного с ним поставщика служб шифрования (CSP), который поддерживает подсчет ключей. Ни Microsoft Strong CSP, ни поставщик хранилища ключей Майкрософт (KSP) не поддерживают подсчет ключей.

## <a name="create-the-capolicyinf-file"></a>Создание файла CAPolicy. INF

Перед установкой служб AD CS необходимо настроить файл CAPolicy. INF с конкретными параметрами развертывания.

**Предварительные требования:** Необходимо быть членом группы администраторов.

1. На компьютере, где планируется установить AD CS, откройте Windows PowerShell, введите **Notepad к:\каполици.инф** и нажмите клавишу ВВОД.

2. В ответ на запрос о создании нового файла нажмите кнопку **Да**.

3. Введите в качестве содержимого файла следующее:
   ```
   [Version]  
   Signature="$Windows NT$"  
   [PolicyStatementExtension]  
   Policies=InternalPolicy  
   [InternalPolicy]  
   OID=1.2.3.4.1455.67.89.5  
   Notice="Legal Policy Statement"  
   URL=https://pki.corp.contoso.com/pki/cps.txt  
   [Certsrv_Server]  
   RenewalKeyLength=2048  
   RenewalValidityPeriod=Years  
   RenewalValidityPeriodUnits=5  
   CRLPeriod=weeks  
   CRLPeriodUnits=1  
   LoadDefaultTemplates=0  
   AlternateSignatureAlgorithm=1  
   [CRLDistributionPoint]  
   [AuthorityInformationAccess]
   ```
4. В меню **файл**выберите команду **Сохранить как**.

5. Перейдите в папку% systemroot%.

6. Убедитесь, что выполняются два следующих условия:

   -   в поле **Имя файла** установлено значение **CAPolicy.inf**

   -   в поле**Тип файла** выбрано **Все файлы**;

   -   в поле **Кодировка** выбрано **ANSI**.

7. Нажмите кнопку **Сохранить**.

8. При появлении запроса о перезаписи файла нажмите **Да**.

   ![Сохранить как расположение для файла CAPolicy. INF](../../../media/Prepare-the-CAPolicy-inf-File/001-SaveCAPolicyORCA1.gif)

   > [!CAUTION]
   >   Обязательно сохраните файл CAPolicy.inf с расширением "inf". Если вы специально не укажете **.inf** в конце имени файла и выберете предложенные настройки, то файл будет сохранен как текстовый и не будет использоваться при установке ЦС.

9. Закройте программу "Блокнот".

> [!IMPORTANT]
>   В файле CAPolicy. inf можно увидеть строку, указывающую URL-адрес https://pki.corp.contoso.com/pki/cps.txt. Раздел внутренней политики файла CAPolicy.inf показан только в качестве примера того, как вы будете указывать расположение уведомления о правилах работы с сертификатами (CPS). В этом разделе вы не получите инструкции по созданию заявления о практике для сертификатов (CPS).
