---
title: Подготовка файла CAPolicy.inf
description: Файл CAPolicy.inf содержит различные параметры, которые используются при установке службы сертификации Active Directory (AD CS), или при обновлении ЦС сертификат.
manager: alanth
ms.topic: article
ms.assetid: 65b36794-bb09-4c1b-a2e7-8fc780893d97
ms.prod: windows-server-threshold
ms.technology: networking
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 9618d4abe512b487f4f22ffde85a052c1c52ef22
ms.sourcegitcommit: fb4e2ace2e0a29e0f6b028f1cb945cab6aa6ee2c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="capolicyinf-syntax"></a>Синтаксис CAPolicy.inf
>   Область применения: Windows Server (канал точками годовой), Windows Server 2016

Файл CAPolicy.inf является файл конфигурации, который определяет расширения, ограничений и других параметров конфигурации, которые применяются к сертификат корневого ЦС и все сертификаты, выданные корневым ЦС. Файл CAPolicy.inf должен устанавливаться на сервере узла перед процедуру установки для корневого ЦС начинает использоваться. Когда ограничения безопасности для корневого ЦС, который необходимо изменить, необходимо обновить корневой сертификат и обновленный файл CAPolicy.inf должен быть установлен на сервере, перед началом процесса обновления.

Файл CAPolicy.inf —

-   Создается и определенные вручную администратором

-   Используются во время создания корневых сертификатов и сертификатов подчиненных ЦС

-   Определенные подписи ЦС, где вы подпишете и выдачи сертификата (не ЦС, где предоставляется запрос)

После создания файла CAPolicy.inf, необходимо скопировать его в **% systemroot %** папки сервера перед установкой службы сертификации Active Directory и обновлять сертификат ЦС.

Файл CAPolicy.inf позволяет задать и настроить разнообразные атрибуты ЦС и параметры. Ниже приведена все параметры для создания INF-файла, адаптированные для конкретных потребностей.

## <a name="capolicyinf-file-structure"></a>Структура файла CAPolicy.inf

Чтобы описать структуру файла .inf используются следующие термины:

-   _Раздел_ — область файл, который охватывает логическую группу ключей. Имена разделов в INF-файлах идентифицируются по отображаются в скобках. Многие, но не во всех разделах используются для настройки расширений сертификатов.

-   _Ключ_ — имя записи и слева от знака равенства.

-   _Значение_ — это параметр и появится справа от знака равенства.

В примере ниже **[версия]** раздел, **подписи** — это ключ, и **«\ $ Windows NT \ $»** — это значение.

Пример:

```PowerShell
[Version]                     #section
Signature="$Windows NT$"      #key=value
```

###  <a name="version"></a>Версия

Указывает файл как INF-файл. Версия — только необходимых разделов и должен находиться в начале файла CAPolicy.inf.

###  <a name="policystatementextension"></a>PolicyStatementExtension

Список политик, которые были определены в организации и, являются ли они необязательно или обязательный. Несколько политик разделяются запятыми. Имена имеют смысл в контексте конкретного развертывания, или относительно пользовательских приложений, которые проверяет наличие этих политик.

Для каждой определенные политики должен быть раздел, который определяет параметры для этой конкретной политики. Для каждой политики необходимо указать идентификатор пользовательской объекта (OID) и либо текст, который необходимо отображать в правила политики или URL-адрес указатель инструкции политики. URL-адрес может быть в формате HTTP, FTP или URL-адрес LDAP.

Если вы будете иметь текст описания в правила политики, эти три строки CAPolicy.inf будет выглядеть вот:

```
[InternalPolicy]
OID=1.1.1.1.1.1.1
Notice=”Legal policy statement text”
```

Если вы собираетесь использовать URL-адрес для размещения правила политики ЦС, затем следующие строки вместо этого будет выглядеть вот:

```
[InternalPolicy]
OID=1.1.1.1.1.1.2
URL=http://pki.wingtiptoys.com/policies/legalpolicy.asp
```

В дополнение:

-   Поддерживаются несколько ключей URL-адрес и уведомления.

-   Обратите внимание и URL-адрес ключи, в том же разделе политики поддерживаются.

-   URL-адреса с пробелами или текст с пробелами должны быть заключены в кавычки. Это справедливо для **URL-адрес** ключа, независимо от раздела, в которой он находится.

Пример нескольких уведомления и URL-адреса в разделе политика может выглядеть:

```
[InternalPolicy]
OID=1.1.1.1.1.1.1
URL=http://pki.wingtiptoys.com/policies/legalpolicy.asp
URL=ftp://ftp.wingtiptoys.com/pki/policies/legalpolicy.asp
Notice=”Legal policy statement text”
```

### <a name="crldistributionpoint"></a>CRLDistributionPoint

Для корневого сертификата ЦС в файле CAPolicy.inf можно указать точки распространения списка отзыва Сертификатов (CRL). После установки ЦС можно настроить URL-адресов CDP, включающий в каждый сертификат, выданный ЦС. URL-адреса, указанные в этом разделе файла CAPolicy.inf включены в сам сертификат корневого ЦС.

```
[CRLDistributionPoint]
URL=http://pki.wingtiptoys.com/cdp/WingtipToysRootCA.crl
```

Некоторые дополнительные сведения об этом разделе:

-   Поддерживаются несколько URL-адресов.

-   Поддерживаются HTTP, FTP и URL-адреса LDAP. URL-адреса HTTPS, не поддерживаются.

-   В этом разделе используется только в том случае, если вы настраиваете корневого ЦС или обновлении сертификата корневого ЦС. Расширения подчиненного ЦС CDP, определяются ЦС, который выпускает сертификат подчиненного ЦС.

-   URL-адреса с пробелами должны быть заключены в кавычки.

-   Если указан URL-адреса, не — то есть, если **[CRLDistributionPoint]** раздел существует в файле, но является пустым, — указано расширение точки распространения списков отзыва Сертификатов сертификат корневого ЦС. Это предпочтительнее обычно при настройке корневого ЦС. Windows не выполняется проверка отзыва на сертификат корневого ЦС, поэтому расширения CDP является избыточным в сертификат корневого ЦС.

### <a name="authorityinformationaccess"></a>AuthorityInformationAccess

Можно указать точки доступа Центр сведения в файле CAPolicy.inf для корневого сертификата ЦС.

```
[AuthorityInformationAccess]
URL=http://pki.wingtiptoys.com/Public/myCA.crt
```

Дополнительные замечания по информации о центрах сертификации получить доступ к разделу:

-   Поддерживаются несколько URL-адресов.

-   Поддерживаются HTTP, FTP, LDAP и URL-адреса файла. URL-адреса HTTPS, не поддерживаются.

-   В этом разделе используется только в том случае, если вы настраиваете корневого ЦС, или обновлении сертификата корневого ЦС. Расширения подчиненного ЦС AIA определяются ЦС, который выдал сертификат подчиненного ЦС.

-   URL-адреса с пробелами должны быть заключены в кавычки.

-   Если указан URL-адреса, не — то есть, если **[AuthorityInformationAccess]** раздел существует в файле, но является пустым, — указано расширение точки распространения списков отзыва Сертификатов сертификат корневого ЦС. Еще раз это может быть предпочитаемых параметров в случае корневого сертификата ЦС, не превышает корневого ЦС, который потребуется ссылаться по ссылке на свой сертификат центра.

### <a name="certsrvserver"></a>certsrv_Server

Другой дополнительный раздел CAPolicy.inf является [certsrv_server], который используется для указания обновления длины ключа, срока и срок действия списка ОТЗЫВА сертификатов отзыва сертификата ЦС, не был обновлен или установки. Разделы в этом разделе не требуется. Многие из этих параметров имеют значения по умолчанию, которые достаточно для удовлетворения большинства потребностей и может быть опущено просто из файла CAPolicy.inf. Кроме того многие из этих параметров можно изменить после установки ЦС.

Пример будет выглядеть:

```
[certsrv_server]
RenewalKeyLength=2048
RenewalValidityPeriod=Years
RenewalValidityPeriodUnits=5
CRLPeriod=Days
CRLPeriodUnits=2
CRLDeltaPeriod=Hours
CRLDeltaPeriodUnits=4
ClockSkewMinutes=20
LoadDefaultTemplates=True
AlternateSignatureAlgorithm=0
ForceUTF8=0
EnableKeyCounting=0
```

**RenewalKeyLength** задает размер ключа для обновления только. Используется, только когда новую пару ключей создается во время обновления сертификата ЦС. Размер ключа для начального сертификата ЦС устанавливается при установке ЦС.

При обновлении сертификата ЦС с новую пару ключей, длина ключа может быть либо увеличивается или уменьшается. Например если задано корневой ЦС ключа размер 4096 байт или более поздней версии, а затем обнаружить, у вас есть приложений Java или сетевых устройств, которые поддерживает только размеры ключа 2048 байтов. Ли увеличить или уменьшить размер, вы должны перевыдать все сертификаты, выдаваемым ЦС.

**RenewalValidityPeriod** и **RenewalValidityPeriodUnits** установить время жизни новый сертификат корневого ЦС, после обновления старый сертификат корневого ЦС. Она применяется только к корневому ЦС. Время жизни сертификата подчиненного ЦС определяется по его высшем. RenewalValidityPeriod может иметь следующие значения: часов, дней, недель, месяцев и лет.

**CRLPeriod** и **параметров CRLPeriodUnits** установить срок действия для базового CRL. **CRLPeriod** может иметь следующие значения: часов, дней, недель, месяцев и лет.

**CRLDeltaPeriod** и **CRLDeltaPeriodUnits** установить срок действия разностный список отзыва Сертификатов. **CRLDeltaPeriod** может иметь следующие значения: часов, дней, недель, месяцев и лет.

Каждый из этих параметров можно настроить после установки ЦС.

```
Certutil -setreg CACRLPeriod Weeks
Certutil -setreg CACRLPeriodUnits 1
Certutil -setreg CACRLDeltaPeriod Days
Certutil -setreg CACRLDeltaPeriodUnits 1
```

Не забудьте перезапустить службы сертификации Active Directory для изменения вступили в силу.

**LoadDefaultTemplates** применяется только во время установки ЦС предприятия. Этот параметр, либо True или False (или 1 или 0), определяет, если в ЦС настроен с любым шаблоны по умолчанию.

По умолчанию при установке ЦС подмножество шаблоны сертификатов по умолчанию добавляется в папку шаблонов сертификатов оснастки центра сертификации. Это означает, что сразу после запуска службы AD CS, после установки роли пользователя или компьютера с достаточными разрешениями можно немедленно подать заявку на сертификат.

Возможно, вы не хотите выдавать сертификаты, сразу после установки ЦС, можно использовать параметр LoadDefaultTemplates, чтобы запретить добавление для ЦС предприятия шаблоны по умолчанию. Если нет шаблонов, настроенный в ЦС, он может выдавать сертификаты отсутствуют.

**AlternateSignatureAlgorithm** настраивает ЦС для поддержки формат подписи версии 2.1 1 # PKCS\ для сертификата ЦС и запросы на сертификаты. Если задано значение 1 для корневой папки ЦС сертификат ЦС будет включать формат подписи PKCS\ #1, версии 2.1. При установке на подчиненный ЦС, подчиненный ЦС будет создан запрос на сертификат, включает в себя формат подписи PKCS\ #1, версии 2.1.

**ForceUTF8** изменяет значение по умолчанию используется кодировка относительные различающиеся имена (RDN) в субъекта и издателя различающиеся имена UTF-8. Только эти также RDN, поддерживающих UTF-8, например те, которые определены как типы строке каталога в документе RFC затрагиваются. Например RDN для компонента домена (DC) поддерживает кодировку как IA5 или UTF-8, пока Country RDN (C) поддерживает только кодировки как строка печати. Директива ForceUTF8 таким образом повлиять на RDN контроллера домена, но не повлияет на C RDN.

**EnableKeyCounting** настраивает ЦС для увеличения значения счетчика в каждом использовании ключа подписи ЦС. Не следует включать этот параметр, если у вас есть аппаратный модуль безопасности (HSM) и связанных поставщика служб шифрования (CSP) поддерживает ключа инвентаризации. Microsoft CSP строгих ни поставщика хранилища ключей (KSP) программного обеспечения Майкрософт поддержки ключа инвентаризации.


## <a name="create-the-capolicyinf-file"></a>Создание файла CAPolicy.inf

Перед установкой AD CS, Настройка файла CAPolicy.inf с определенными параметрами, для развертывания.

**Необходимое условие:** необходимо быть членом группы «Администраторы».

1.  На компьютере, где вы планируете установить AD CS, откройте Windows PowerShell, введите **c:.inf Блокнот** и нажмите клавишу ВВОД.

2.  Когда появится приглашение создать новый файл, нажмите кнопку **Да **.

3.  Как содержимое файла, введите следующую команду:
   ```
   [Version]  
    Signature="$Windows NT$"  
    [PolicyStatementExtension]  
    Policies=InternalPolicy  
    [InternalPolicy]  
    OID=1.2.3.4.1455.67.89.5  
    Notice="Legal Policy Statement"  
    URL=http://pki.corp.contoso.com/pki/cps.txt  
    [Certsrv_Server]  
    RenewalKeyLength=2048  
    RenewalValidityPeriod=Years  
    RenewalValidityPeriodUnits=5  
    CRLPeriod=weeks  
    CRLPeriodUnits=1  
    LoadDefaultTemplates=0  
    AlternateSignatureAlgorithm=1  
    [CRLDistributionPoint]  
    [AuthorityInformationAccess]
   ```
1.  Нажмите кнопку **файл**, а затем нажмите кнопку **Сохранить как **.

2.  Перейдите к папке % systemroot %.

3.  Убедитесь в следующем.

    -   **Имя файла** имеет значение **файла CAPolicy.inf**

    -   **Тип файла** имеет значение **все файлы**

    -   **Кодировка** — **ANSI**

4.  Нажмите кнопку **Сохранить**.

5.  Когда вам будет предложено перезаписать файл, нажмите кнопку **Да**.

    ![Сохранить как расположение файла CAPolicy.inf](../../../media/Prepare-the-CAPolicy-inf-File/001-SaveCAPolicyORCA1.gif)

    >   [!CAUTION]  
    >   Обязательно сохраните файл CAPolicy.inf с расширением inf. Если специально не укажете **.inf** в конце имени файла и выберете предложенные настройки, файл будет сохранен как текстовый файл и не будут использоваться во время установки ЦС.

6.  Закройте Блокнот.

>   [!IMPORTANT]  
>   В файле CAPolicy.inf, вы увидите существует строка с указанием URL-адрес http://pki.corp.contoso.com/pki/cps.txt. Раздел внутренней политики CAPolicy.inf показан только в качестве примера того, как вы будете указывать расположение уведомления о сертификатами (CPS). В этом руководстве не содержатся инструкции по созданию уведомления о сертификатами (CPS).
