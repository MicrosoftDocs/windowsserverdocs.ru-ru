---
title: Как работает политика качества обслуживания
description: В этом разделе представлен обзор политики качества обслуживания (QoS), которая позволяет использовать групповая политика для определения приоритета пропускной способности сетевого трафика для конкретных приложений и служб в Windows Server 2016.
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 25097cb8-b9b1-41c9-b3c7-3610a032e0d8
manager: brianlic
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 65d2635744e7d49e45d8f878be9a5e734dea9e6d
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "80315405"
---
# <a name="how-qos-policy-works"></a>Как работает политика качества обслуживания

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

При запуске или получении обновленной конфигурации пользователя или компьютера групповая политика параметры для QoS выполняется следующий процесс.

1. Групповая политика подсистема извлекает параметры конфигурации пользователя или компьютера групповая политика из Active Directory.

2. Обработчик групповая политика информирует клиентское расширение QoS о том, что в политиках QoS были внесены изменения.

3. Клиентское расширение QoS отправляет уведомление о событии политики качества обслуживания в модуль проверки качества обслуживания.

4. Модуль проверки качества обслуживания получает политики качества обслуживания пользователя или компьютера и сохраняет их.

При создании новой конечной точки транспортного уровня \(подключения TCP или UDP-трафика\) выполняется следующий процесс.

1. Компонент транспортного уровня в стеке TCP/IP информирует модуль проверки качества обслуживания.

2. Модуль проверки качества обслуживания сравнивает параметры конечной точки транспортного уровня с хранимыми политиками качества обслуживания.

3. Если совпадение найдено, модуль проверки качества обслуживания обращается к Pacer. sys для создания последовательности, структуры данных, содержащей значение DSCP, и параметров регулирования трафика для соответствующей политики качества обслуживания. Если имеется несколько политик QoS, соответствующих параметрам конечной точки транспортного уровня, используется наиболее конкретная политика качества обслуживания.

4. Pacer. sys сохраняет последовательность и возвращает номер последовательности, соответствующий потоку, в модуль проверки качества обслуживания.

5. Модуль проверки качества обслуживания возвращает номер потока на транспортный уровень.

6. Уровень транспорта сохраняет номер потока в конечной точке транспортного уровня.

Когда отправляется пакет, соответствующий конечной точке транспортного уровня, помеченной с помощью номера потока, выполняется следующий процесс.

1. Транспортный уровень внутренним образом помечает пакет номером потока.

2. Сетевой уровень запрашивает Pacer. sys для значения DSCP, соответствующего номеру потока пакета.

3. Pacer. sys возвращает значение DSCP в сетевой слой.

4. Сетевой уровень изменяет значение поля TOS IP-адреса IPv4 или поля класса трафика IPv6 значением DSCP, указанным в параметре Pacer. sys, а для пакетов IPv4 вычисляет окончательную контрольную сумму заголовка IPv4.

5. Сетевой уровень передает пакет на слой кадрирования.

6. Так как пакет был помечен номером последовательности, уровень кадрирования передает пакет в Pacer. sys через NDIS 6. x.

7. Pacer. sys использует номер потока пакета, чтобы определить, нужно ли регулировать пакет, и, если да, запланирует пакет для отправки.

8. Pacer. sys передает пакет либо сразу \(, если нет\) регулирования трафика, либо по расписанию \(, если для передачи данных по соответствующему сетевому адаптеру\) передается значение NDIS 6. x.

Эти процессы качества обслуживания на основе политик обеспечивают следующие преимущества.

- Проверка трафика, определяющего, применяется ли политика QoS, выполняется для каждой конечной точки транспортного уровня, а не для каждого пакета.

- Трафик, который не соответствует политике качества обслуживания, не влияет на производительность.

- Приложения не нужно изменять для использования преимуществ дифференцированной службы или регулирования трафика на основе DSCP.

- Политики качества обслуживания могут применяться к трафику, защищенному с помощью IPsec.

Следующий раздел в этом руководстве содержит сведения об [архитектуре политики качества обслуживания](qos-policy-architecture.md).

Для первого раздела в этом руководстве см. раздел [Политика качества обслуживания (QoS)](qos-policy-top.md).
