---
title: Как работает политика качества обслуживания
description: Узнайте, как работает политика QoS.
ms.topic: article
ms.assetid: 25097cb8-b9b1-41c9-b3c7-3610a032e0d8
manager: brianlic
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: c3042c6e0c6c74e76472962c4bde323e044ff1fd
ms.sourcegitcommit: d42b80f947dbfa8660d982be67d77745a28081e5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/12/2021
ms.locfileid: "98113370"
---
# <a name="how-qos-policy-works"></a>Как работает политика качества обслуживания

>Применяется к: Windows Server (Semi-Annual Channel), Windows Server 2016

При запуске или получении обновленной конфигурации пользователя или компьютера групповая политика параметры для QoS выполняется следующий процесс.

1. Групповая политика подсистема извлекает параметры конфигурации пользователя или компьютера групповая политика из Active Directory.

2. Обработчик групповая политика информирует расширение Client-Side QoS о том, что в политиках QoS были внесены изменения.

3. Расширение Client-Side QoS отправляет уведомление о событии политики качества обслуживания в модуль проверки качества по.

4. Модуль проверки качества обслуживания получает политики качества обслуживания пользователя или компьютера и сохраняет их.

При создании нового TCP-подключения конечной точки транспортного уровня \( или UDP \) -трафика происходит следующий процесс.

1. Компонент транспортного уровня в стеке TCP/IP информирует модуль проверки качества обслуживания.

2. Модуль проверки качества обслуживания сравнивает параметры конечной точки транспортного уровня с хранимыми политиками качества обслуживания.

3. Если совпадение найдено, модуль проверки качества обслуживания обращается Pacer.sys к созданию последовательности, структуры данных, содержащей значение DSCP, и параметров регулирования трафика для соответствующей политики качества обслуживания. Если имеется несколько политик QoS, соответствующих параметрам конечной точки транспортного уровня, используется наиболее конкретная политика качества обслуживания.

4. Pacer.sys сохраняет последовательность и возвращает номер потока, соответствующий потоку, в модуль проверки качества обслуживания.

5. Модуль проверки качества обслуживания возвращает номер потока на транспортный уровень.

6. Уровень транспорта сохраняет номер потока в конечной точке транспортного уровня.

Когда отправляется пакет, соответствующий конечной точке транспортного уровня, помеченной с помощью номера потока, выполняется следующий процесс.

1. Транспортный уровень внутренним образом помечает пакет номером потока.

2. Сетевой уровень запрашивает Pacer.sys для значения DSCP, соответствующего номеру потока пакета.

3. Pacer.sys возвращает значение DSCP для сетевого уровня.

4. Сетевой уровень изменяет значение поля TOS IP-адреса IPv4 или поля класса трафика IPv6 значением DSCP, заданным Pacer.sys, а для пакетов IPv4 вычисляет окончательную контрольную сумму заголовка IPv4.

5. Сетевой уровень передает пакет на слой кадрирования.

6. Так как пакет был помечен номером потока, слой кадрирования передает пакету Pacer.sys через NDIS 6. x.

7. Pacer.sys использует номер потока пакета, чтобы определить, нужно ли регулировать пакет, и, если да, запланирует пакет для отправки.

8. Pacer.sys передает пакет немедленно, \( если отсутствует регулирование трафика \) или если запланировано \( регулирование трафика \) для NDIS 6. x для передачи по соответствующему сетевому адаптеру.

Эти процессы качества обслуживания на основе политик обеспечивают следующие преимущества.

- Проверка трафика, определяющего, применяется ли политика QoS, выполняется для каждой конечной точки транспортного уровня, а не для каждого пакета.

- Трафик, который не соответствует политике качества обслуживания, не влияет на производительность.

- Приложения не нужно изменять для использования преимуществ дифференцированной службы или регулирования трафика на основе DSCP.

- Политики качества обслуживания могут применяться к трафику, защищенному с помощью IPsec.

Следующий раздел в этом руководстве содержит сведения об [архитектуре политики качества обслуживания](qos-policy-architecture.md).

Для первого раздела в этом руководстве см. раздел [Политика качества обслуживания (QoS)](qos-policy-top.md).
