---
title: Развертывание DHCP с помощью Windows PowerShell
description: Этот раздел можно использовать для развертывания DHCP-сервера Windows Server 2016 Internet Protocol (IP) версии 4, предоставляющего автоматические IP-адреса и параметры DHCP, для DHCP-клиентов IPv4, подключенных к одной или нескольким подсетям в сети.
ms.prod: windows-server
ms.technology: networking-dhcp
ms.topic: article
ms.assetid: 7110ad21-a33e-48d5-bb3c-129982913bc8
manager: brianlic
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 1e962948feaf6bb37beeb3c241d3ae3369be77dc
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80860707"
---
# <a name="deploy-dhcp-using-windows-powershell"></a>Развертывание DHCP с помощью Windows PowerShell

> Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Это руководство содержит инструкции по использованию Windows PowerShell для развертывания протокола динамической конфигурации узла протокола IP версии 4 \(DHCP-\) Server, который автоматически назначает IP-адреса и параметры DHCP клиентам IPv4 DHCP, подключенным к одной или нескольким подсетям в сети.

> [!NOTE]
> Чтобы скачать этот документ в формате Word из коллекции TechNet, см. статью [развертывание DHCP с помощью Windows PowerShell в Windows Server 2016](https://gallery.technet.microsoft.com/Deploy-DHCP-Using-Windows-246dd293).

Использование DHCP-серверов для назначения IP-адресов экономится в административных издержках, так как вам не нужно вручную настраивать параметры TCP/IP v4 для каждого сетевого адаптера на каждом компьютере в сети. При использовании DHCP конфигурация TCP/IP v4 выполняется автоматически при подключении компьютера или другого DHCP-клиента к сети.

Вы можете развернуть DHCP-сервер в Рабочей группе в качестве отдельного сервера или в составе домена Active Directory.

Данное руководство содержит следующие разделы.

- [Общие сведения о развертывании DHCP](#bkmk_overview)
- [Обзор технологий](#bkmk_technologies)
- [Планирование развертывания DHCP](#bkmk_plan)
- [Использование этого руководства в тестовой лаборатории](#bkmk_lab)
- [Развертывание DHCP](#bkmk_deploy)
- [Проверка функциональности сервера](#bkmk_verify)
- [Команды Windows PowerShell для DHCP](#bkmk_dhcpwps)
- [Список команд Windows PowerShell в этом пошаговом окне](#bkmk_list)

## <a name="dhcp-deployment-overview"></a><a name="bkmk_overview"></a>Общие сведения о развертывании DHCP

На следующем рисунке показан сценарий, который можно развернуть с помощью этого руководством. Сценарий включает один DHCP-сервер в домене Active Directory. Сервер настроен на предоставление IP-адресов клиентам DHCP в двух разных подсетях. Подсети разделяются маршрутизатором с включенной пересылкой DHCP.

![Обзор топологии сети DHCP](../../media/Core-Network-Guide/cng16_overview.jpg)

## <a name="technology-overviews"></a><a name="bkmk_technologies"></a>Обзор технологий

В следующих разделах приведены краткие обзоры DHCP и TCP/IP.

### <a name="dhcp-overview"></a>Обзор DHCP

DHCP — это стандарт IP для упрощения управления IP-конфигурацией узлов. Стандарт DHCP позволяет использовать в сети DHCP-серверы для управления динамическим выделением IP-адресов и других сведений конфигурации для клиентов, поддерживающих DHCP.

DHCP позволяет использовать DHCP-сервер для динамического назначения IP-адреса компьютеру или другому устройству, такому как принтер, в локальной сети, а не вручную настраивать каждое устройство со статическим IP-адресом.

Любой компьютер в сети TCP/IP должен иметь уникальный IP-адрес, который вместе с маской подсети однозначно определяет главный компьютер и подсеть, в которой этот компьютер находится. Используя DHCP, можно проверить, все ли компьютеры, настроенные в качестве DHCP-клиентов, получают IP-адреса, предназначенные для данной подсети и расположения в сети; такие параметры DHCP, как шлюз по умолчанию и DNS-серверы, вместе с информацией о правильной работе в сети можно автоматически передавать DHCP-клиентам.

Для сетей на основе TCP/IP DHCP сокращает сложность и объем административной работы, связанной с настройкой компьютеров.

### <a name="tcpip-overview"></a>Обзор TCP/IP

По умолчанию во всех версиях клиентских операционных систем Windows Server и Windows параметры TCP/IP для сетевых подключений IP версии 4 настроены на автоматическое получение IP-адреса и других сведений, называемых параметрами DHCP, с DHCP-сервера. По этой причине не требуется настраивать параметры TCP/IP вручную, если только компьютер не является сервером или другим устройством, для которого требуется настроенный вручную статический IP-адрес. 

Например, рекомендуется вручную настроить IP-адрес сервера DHCP, а также IP-адреса DNS-серверов и контроллеров домена, на которых выполняются службы домен Active Directory Services \(AD DS\).

Протокол TCP/IP в Windows Server 2016 является следующим:

- сетевое программное обеспечение, которое основано на сетевых протоколах, являющихся отраслевым стандартом;

- маршрутизируемый протокол корпоративных сетей, обеспечивающий подключение компьютера под управлением Windows к локальным и глобальным сетям;

- базовые технологии и служебные программы для соединения компьютеров под управлением ОС Windows с разнородными системами для обмена данными;

- Основа для получения доступа к глобальным службам Интернета, таким как серверы Web и протокол FTP (FTP).

- надежная, масштабируемая кроссплатформенная система клиент-сервер.

TCP/IP обеспечивает основные служебные программы TCP/IP, которые позволяют компьютерам под управлением Windows соединяться с другими системами, произведенными как корпорацией Майкрософт, так и другими компаниями. Ниже указаны некоторые из них.

- Windows Server 2016

- Windows 10

- Windows Server 2012 R2

- Windows 8.1

- Windows Server 2012

- Windows 8

- Windows Server 2008 R2

- Windows 7

- Windows Server 2008

- Windows Vista

- Узлы в Интернете

- Системы Apple Macintosh

- Мэйнфреймы IBM

- Системы UNIX и Linux

- Системы Open VMS

- Принтеры, готовые к работе в сети

- Планшеты и Сотовые телефоны с поддержкой технологии Wired Ethernet или Wireless 802,11

## <a name="plan-dhcp-deployment"></a><a name="bkmk_plan"></a>Планирование развертывания DHCP

Ниже приведены основные этапы планирования перед установкой роли DHCP-сервера.

### <a name="planning-dhcp-servers-and-dhcp-forwarding"></a>Планирование DHCP-серверов и пересылки DHCP

Поскольку сообщения DHCP являются широковещательными, маршрутизаторы не пересылают их между подсетями. Если имеется несколько подсетей и службу DHCP требуется обеспечить для каждой из них, необходимо выполнить одно из описанных ниже действий.

- Установите DHCP-сервер в каждой из подсетей.

- Настройте маршрутизаторы на пересылку широковещательных сообщений DHCP между подсетями, а на DHCP-сервере настройте несколько областей (по одной на подсеть).

В большинстве случаев настройка маршрутизаторов на пересылку широковещательных сообщений DHCP является более экономически эффективным решением, чем развертывание DHCP-сервера в каждом из физических сегментов сети.

### <a name="planning-ip-address-ranges"></a>Планирование диапазонов IP-адресов

У каждой подсети должен быть собственный уникальный диапазон IP-адресов. Эти диапазоны представлены на DHCP-сервере с помощью областей.

Область — это административная группа IP-адресов компьютеров в подсети, использующей службу DHCP. Администратор сначала создает область для каждой физической подсети, а затем с помощью этой области определяет параметры, используемые клиентами.

Область имеет следующие свойства:

- диапазон IP-адресов, из которого берутся адреса для предложения в аренду службой DHCP;

- Маска подсети, определяющая префикс подсети для конкретного IP-адреса.

- имя области, назначаемое при ее создании;

- значения длительности аренды, присваиваемые DHCP-клиентам, которые получают динамически выделяемые IP-адреса;

- Любые параметры области DHCP, настроенные для назначения DHCP-клиентам, такие как IP-адрес DNS-сервера и маршрутизатора или шлюза по умолчанию.

- Резервирование — дополнительная возможность, обеспечивающая постоянное получение DHCP-клиентом одного и того же IP-адреса.

Перед развертыванием серверов создайте список подсетей и диапазонов IP-адресов, которые необходимо использовать для каждой из подсетей.

### <a name="planning-subnet-masks"></a>Планирование масок подсетей

Для различения идентификаторов сетей и адресов узлов используется маска подсети. Каждая маска подсети — это 32-разрядное число, в котором группа последовательных единичных битов (1) используется для обозначения идентификатора сети, а группа последовательных нулевых битов (0) — для обозначения адреса узла в IP-адресе.

Например, с IP-адресом 131.107.16.200 обычно используется маска подсети, которая представляет собой следующее 32-разрядное двоичное число:

```
11111111 11111111 00000000 00000000
```

Номер маски подсети — 16 1 бит, за которым следует 16 нулей, указывающий, что длина идентификатора сети и кода узла этого IP-адреса равна 16 битам. Обычно маска подсети отображается в виде десятичных чисел, разделенных точками (255.255.0.0).

В таблице ниже приведены маски подсетей для классов адресов Интернета.

|Класс адреса|Количество битов для маски подсети|Маска подсети.|
|-----------------|------------------------|---------------|
|Класс А|11111111 00000000 00000000 00000000|255.0.0.0|
|Класс Б|11111111 11111111 00000000 00000000|255.255.0.0|
|Класс C|11111111 11111111 11111111 00000000|255.255.255.0|

При создании области в DHCP и вводе диапазона IP-адресов для области служба DHCP обеспечивает эти значения масок подсетей по умолчанию. Обычно значения масок подсетей по умолчанию применимы для большинства сетей, не имеющих особых требований, а также там, где каждый сегмент IP-сети соответствует одной физической сети.

В некоторых случаях для реализации IP-подсетей маски подсетей можно настраивать. При использовании IP-подсетей часть адреса узла по умолчанию можно разделить, чтобы определить подсети, которые являются подразделениями исходного идентификатора сети какого-либо класса.

Настройкой длины маски подсети можно уменьшить количество бит, необходимое для адреса узла.

Чтобы избежать проблем с адресацией и маршрутизацией, необходимо убедиться в том, что все компьютеры сегмента подсети, поддерживающие протокол TCP/IP, используют одинаковую маску подсети и что у каждого устройства имеется уникальный IP-адрес.

### <a name="planning-exclusion-ranges"></a>Планирование диапазонов исключения

При создании области на DHCP-сервере укажите диапазон IP-адресов, включающий все адреса, которые разрешено арендовать DHCP-клиентам, таким как компьютеры и другие устройства. Если вручную установить статические IP-адреса некоторым серверам и устройствам из того же диапазона адресов, который DHCP-сервер предоставляет в аренду, можно непреднамеренно создать конфликт IP-адресов, при котором вы и DHCP-сервер назначите один и тот же адрес разным устройствам.

Чтобы избежать этого, необходимо создать диапазон исключения для области DHCP. Диапазон исключения — это непрерывный диапазон IP-адресов в диапазоне IP-адресов области, который не может использоваться DHCP-сервером. DHCP-сервер не назначает адреса из созданного диапазона исключения; это позволяет вручную назначать IP-адреса, не опасаясь их конфликта.

IP-адреса можно исключить из распределения DHCP-сервером с помощью создания диапазона исключения для каждой области. Исключения необходимо использовать для всех устройств, для которых настроены статические IP-адреса. Исключаемые адреса должны включать все IP-адреса, вручную назначенные другим серверам, клиентам, не поддерживающим DHCP, бездисковым рабочим станциям или клиентам маршрутизации и удаленного доступа и PPP-клиентам.

Рекомендуется добавить в диапазоны исключения дополнительные адреса, чтобы предусмотреть рост сети в будущем. В следующей таблице приведен пример диапазона исключения для области с диапазоном IP-адресов 10.0.0.1-10.0.0.254 и маской подсети 255.255.255.0.

|Элементы конфигурации|Примеры значений|
|-----------------------|------------------|
|Начальный IP-адрес диапазона исключения|10.0.0.1|
|Конечный IP-адрес диапазона исключения|10.0.0.25|

### <a name="planning-tcpip-static-configuration"></a>Планирование статической конфигурации TCP/IP

Определенные устройства, такие как маршрутизаторы, DHCP-серверы и DNS-серверы, необходимо настраивать с использованием статических IP-адресов. Кроме того, принтерам и другим дополнительным устройствам также может потребоваться назначение постоянного IP-адреса. Создайте для каждой подсети список устройств, которые необходимо настроить статически, а затем запланируйте диапазон исключения, который необходимо использовать на DHCP-сервере, чтобы последний не сдавал в аренду IP-адреса статически настроенных устройств. Диапазон исключения — это ограниченная последовательность IP-адресов области, исключаемых из числа назначаемых службой DHCP. Сервер не назначает DHCP-клиентам сети адреса из диапазонов исключения.

Например, если для подсети используется диапазон IP-адресов 192.168.0.1–192.168.0.254 и имеется десять устройств, на которых необходимо настроить статические IP-адреса, для области 192.168.0.*x* можно создать диапазон исключения с десятью и более IP-адресами: 192.168.0.1–192.168.0.15.

В данном примере десять из числа исключаемых IP-адресов используются для настройки статических IP-адресов на серверах и других устройствах, а пять дополнительных IP-адресов оставлены про запас для статической настройки новых устройств, которые могут быть добавлены в будущем. При использовании этого диапазона исключения DHCP-серверу оставлен пул адресов 192.168.0.16–192.168.0.254.

Дополнительные примеры элементов конфигурации для AD DS и DNS приведены в следующей таблице.

|Элементы конфигурации|Примеры значений|
|-----------------------|------------------|
|Привязки сетевых подключений|Ethernet|
|Параметры DNS-сервера|DC1.corp.contoso.com|
|IP-адрес предпочитаемого DNS-сервера|10.0.0.2|
|Значения области<p>1. имя области<br />2. начальный IP-адрес<br />3. конечный IP-адрес<br />4. Маска подсети<br />5. шлюз по умолчанию (необязательно)<br />6. Длительность аренды|1. Основная подсеть<br />2.10.0.0.1<br />3.10.0.0.254<br />4.255.255.255.0<br />5.10.0.0.1<br />6.8 дней|
|Режим работы DHCP-сервера IPv6|Не включен|

## <a name="using-this-guide-in-a-test-lab"></a><a name="bkmk_lab"></a>Использование этого руководства в тестовой лаборатории

С помощью этого руководства можно развернуть DHCP в тестовой лаборатории перед развертыванием в рабочей среде. 

> [!NOTE]
> Если вы не хотите развертывать DHCP в лаборатории тестирования, можно перейти к разделу [развертывание DHCP](#bkmk_deploy).

Требования к лаборатории различаются в зависимости от того, используете ли вы физические серверы или виртуальные машины \(ВМ\)и используется ли домен Active Directory или Развертывание автономного DHCP-сервера.

Для определения минимальных ресурсов, необходимых для тестирования развертывания DHCP с помощью этого руководством, можно использовать следующие сведения.

### <a name="test-lab-requirements-with-vms"></a>Требования лаборатории тестирования с виртуальными машинами

Для развертывания DHCP в тестовой лаборатории с виртуальными машинами необходимы следующие ресурсы.

Для развертывания домена или отдельного развертывания требуется один сервер, настроенный как узел Hyper\-V.

**Развертывание домена**

Для этого развертывания требуется один физический сервер, один виртуальный коммутатор, два виртуальных сервера и один виртуальный клиент:

На физическом сервере в диспетчере Hyper-V создайте следующие элементы.

1. Один **внутренний** виртуальный коммутатор. Не создавайте **внешний** виртуальный коммутатор, так как если узел Hyper\-V находится в подсети, ВКЛЮЧАЮЩЕЙ DHCP-сервер, тестовые виртуальные машины получат IP-адрес от DHCP-сервера. Кроме того, тестовый DHCP-сервер может назначить IP-адреса другим компьютерам в подсети, где установлен узел Hyper\-V.
1. Одна виртуальная машина под Windows Server 2016 настроена в качестве контроллера домена с домен Active Directoryными службами, подключенными к созданному внутреннему виртуальному коммутатору. Для соответствия этому руководству этот сервер должен иметь статически настроенный IP-адрес 10.0.0.2. Сведения о развертывании AD DS см. в разделе **развертывание DC1** в [сетевом каталоге](https://docs.microsoft.com/windows-server/networking/core-network-guide/core-network-guide#BKMK_deployADDNS01)Windows Server 2016 Core.
1. Одна виртуальная машина под управлением Windows Server 2016, которая будет настроена в качестве DHCP-сервера с помощью этого руководством и подключена к созданному внутреннему виртуальному коммутатору. 
1. Одна виртуальная машина, работающая под управлением клиентской операционной системы Windows, подключенная к созданному внутреннему виртуальному коммутатору и используемая для проверки того, что DHCP-сервер динамически выделяет IP адреса и параметры DHCP клиентам DHCP.

**Развертывание автономного DHCP-сервера**

Для этого развертывания требуется один физический сервер, один виртуальный коммутатор, один виртуальный сервер и один виртуальный клиент:

На физическом сервере в диспетчере Hyper-V создайте следующие элементы.

1. Один **внутренний** виртуальный коммутатор. Не создавайте **внешний** виртуальный коммутатор, так как если узел Hyper\-V находится в подсети, ВКЛЮЧАЮЩЕЙ DHCP-сервер, тестовые виртуальные машины получат IP-адрес от DHCP-сервера. Кроме того, тестовый DHCP-сервер может назначить IP-адреса другим компьютерам в подсети, где установлен узел Hyper\-V.
2. Одна виртуальная машина под управлением Windows Server 2016, которая будет настроена в качестве DHCP-сервера с помощью этого руководством и подключена к созданному внутреннему виртуальному коммутатору.
3. Одна виртуальная машина, работающая под управлением клиентской операционной системы Windows, подключенная к созданному внутреннему виртуальному коммутатору и используемая для проверки того, что DHCP-сервер динамически выделяет IP адреса и параметры DHCP клиентам DHCP.

### <a name="test-lab-requirements-with-physical-servers"></a>Требования лаборатории тестирования к физическим серверам

Для развертывания DHCP в тестовой лаборатории с физическими серверами необходимы следующие ресурсы.

**Развертывание домена**

Для этого развертывания требуется один концентратор или коммутатор, два физических сервера и один физический клиент:

1. Один концентратор Ethernet или коммутатор, к которому можно подключить физические компьютеры с кабелями Ethernet.
2. Один физический компьютер под Windows Server 2016, настроенный как контроллер домена с домен Active Directoryными службами. Для соответствия этому руководству этот сервер должен иметь статически настроенный IP-адрес 10.0.0.2. Сведения о развертывании AD DS см. в разделе **развертывание DC1** в [сетевом каталоге](https://docs.microsoft.com/windows-server/networking/core-network-guide/core-network-guide#BKMK_deployADDNS01)Windows Server 2016 Core.
3. Один физический компьютер под управлением Windows Server 2016, который будет настроен в качестве DHCP-сервера с помощью этого руководством.
4. Один физический компьютер под управлением клиентской операционной системы Windows, который будет использоваться для проверки динамического выделения IP-адресов и параметров DHCP DHCP-сервером.

> [!NOTE]
> Если у вас недостаточно тестовых компьютеров для этого развертывания, можно использовать один тестовый компьютер как для AD DS, так и для DHCP-однако такая конфигурация не рекомендуется для рабочей среды.

**Развертывание автономного DHCP-сервера**

Для этого развертывания требуется один концентратор или коммутатор, один физический сервер и один физический клиент:

1. Один концентратор Ethernet или коммутатор, к которому можно подключить физические компьютеры с кабелями Ethernet.
2. Один физический компьютер под управлением Windows Server 2016, который будет настроен в качестве DHCP-сервера с помощью этого руководством.
3. Один физический компьютер под управлением клиентской операционной системы Windows, который будет использоваться для проверки динамического выделения IP-адресов и параметров DHCP DHCP-сервером.


## <a name="deploy-dhcp"></a><a name="bkmk_deploy"></a>Развертывание DHCP

В этом разделе приведены примеры команд Windows PowerShell, которые можно использовать для развертывания DHCP на одном сервере. Перед выполнением этих примеров команд на сервере необходимо изменить команды в соответствии с вашей сетью и средой. 

Например, перед выполнением команд необходимо заменить примеры значений в командах для следующих элементов:

- Имена компьютеров
- Диапазон IP-адресов для каждой области, которую требуется настроить (1 область на подсеть)
- Маска подсети для каждого диапазона IP-адресов, который вы хотите настроить.
- Имя области для каждой области
- Диапазон исключения для каждой области
- Значения параметров DHCP, такие как шлюз по умолчанию, доменное имя и DNS-серверы или WINS.
- Имена интерфейсов

> [!IMPORTANT]
> Перед выполнением команды проверьте и измените каждую команду в среде.

### <a name="where-to-install-dhcp---on-a-physical-computer-or-a-vm"></a>Где можно установить DHCP на физическом компьютере или на виртуальной машине?

Роль DHCP-сервера можно установить на физическом компьютере или на виртуальной машине \(\) ВИРТУАЛЬНОЙ машины, установленной на узле Hyper\-V. Если вы устанавливаете DHCP на виртуальной машине и хотите, чтобы DHCP-сервер предоставил назначения IP-адресов компьютерам в физической сети, к которой подключен узел Hyper-V, необходимо подключить адаптер виртуальной сети виртуальной машины к виртуальному коммутатору Hyper-V, который является **внешним**.

Дополнительные сведения см. в разделе Создание виртуального **коммутатора с помощью диспетчера Hyper-V** статьи [Создание виртуальной сети](https://docs.microsoft.com/virtualization/hyper-v-on-windows/quick-start/connect-to-network).

### <a name="run-windows-powershell-as-an-administrator"></a>Запуск Windows PowerShell от имени администратора

Для запуска Windows PowerShell с правами администратора можно использовать следующую процедуру.

1. На компьютере под управлением Windows Server 2016 нажмите кнопку **Пуск**, а затем щелкните правой кнопкой мыши значок Windows PowerShell. Появится меню.

2. В меню щелкните **Дополнительно**, а затем выберите **Запуск от имени администратора**. При появлении запроса введите учетные данные для учетной записи с правами администратора на компьютере. Если учетная запись пользователя, с которой вы вошли на компьютер, является учетной записью администратора, запрос учетных данных не будет получен.

3. Откроется Windows PowerShell с правами администратора.

### <a name="rename-the-dhcp-server-and-configure-a-static-ip-address"></a>Переименование DHCP-сервера и Настройка статического IP-адреса

Если вы еще не сделали этого, можно использовать следующие команды Windows PowerShell для переименования DHCP-сервера и настройки статического IP-адреса для сервера.

**Настройка статического IP-адреса**

Можно использовать следующие команды для назначения статического IP-адреса DHCP-серверу и настройки свойств TCP/IP DHCP-сервера с правильным IP-адресом DNS-сервера. Кроме того, в этом примере необходимо переименовать интерфейсы и сменить IP-адреса на значения, подходящие для вашего компьютера.

```
New-NetIPAddress -IPAddress 10.0.0.3 -InterfaceAlias "Ethernet" -DefaultGateway 10.0.0.1 -AddressFamily IPv4 -PrefixLength 24
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 10.0.0.2
```

Дополнительные сведения об этих командах см. в следующих разделах.

- [New-Нетипаддресс](https://docs.microsoft.com/powershell/module/nettcpip/New-NetIPAddress)
- [Set-Днсклиентсервераддресс](https://docs.microsoft.com/powershell/module/dnsclient/Set-DnsClientServerAddress)

**Переименование компьютера**

Для переименования и перезагрузки компьютера можно использовать следующие команды.

```
Rename-Computer -Name DHCP1
Restart-Computer
```

Дополнительные сведения об этих командах см. в следующих разделах.

- [Переименование компьютера](https://docs.microsoft.com/powershell/module/microsoft.powershell.management/rename-computer)
- [Restart-Computer](https://docs.microsoft.com/powershell/module/microsoft.powershell.management/restart-computer)

### <a name="join-the-computer-to-the-domain-optional"></a>Присоедините компьютер к домену \(необязательно\)

Если вы устанавливаете DHCP-сервер в доменной среде Active Directory, необходимо присоединить компьютер к домену. Откройте Windows PowerShell с правами администратора, а затем выполните следующую команду после замены NetBios-имени домена **Corp** на значение, подходящее для вашей среды.

```
Add-Computer CORP
```

При появлении запроса введите учетные данные для учетной записи пользователя домена, имеющего разрешение на присоединение компьютера к домену. 

```
Restart-Computer
```

Дополнительные сведения о команде Add-Computer см. в следующем разделе.

- [Add-Computer](https://docs.microsoft.com/powershell/module/microsoft.powershell.management/add-computer?view=powershell-5.1)

### <a name="install-dhcp"></a>Установка DHCP

После перезагрузки компьютера откройте Windows PowerShell с правами администратора, а затем установите DHCP, выполнив следующую команду.

```
Install-WindowsFeature DHCP -IncludeManagementTools
```

Дополнительные сведения об этой команде см. в следующем разделе.

- [Install-WindowsFeature](https://docs.microsoft.com/powershell/module/servermanager/install-windowsfeature)

### <a name="create-dhcp-security-groups"></a>Создание групп безопасности DHCP

Чтобы создать группы безопасности, необходимо запустить сетевую оболочку \(команду netsh\) в Windows PowerShell, а затем перезапустить службу DHCP, чтобы новые группы стали активными.

При выполнении следующей команды Netsh на DHCP-сервере группы безопасности " **Администраторы DHCP** " и " **Пользователи DHCP** " создаются в оснастке " **Локальные пользователи и группы** " на DHCP-сервере.

```
netsh dhcp add securitygroups
```

Следующая команда перезапускает службу DHCP на локальном компьютере.

```
Restart-Service dhcpserver
```

Дополнительные сведения об этих командах см. в следующих разделах.

- [Сетевая оболочка (Netsh)](../netsh/netsh.md)
- [Restart-Service](https://docs.microsoft.com/powershell/module/microsoft.powershell.management/restart-service)

### <a name="authorize-the-dhcp-server-in-active-directory-optional"></a>Авторизация DHCP-сервера в Active Directory \(необязательно\)

При установке DHCP в среде домена необходимо выполнить следующие действия, чтобы авторизовать DHCP-сервер для работы в домене.

> [!NOTE]
> Неавторизованные DHCP-серверы, установленные в доменах Active Directory, не могут функционировать должным образом и не будут выделять IP-адреса клиентам DHCP. Автоматическое отключение неавторизованных DHCP-серверов — это функция безопасности, которая не позволяет неавторизованным DHCP-серверам назначать недопустимые адреса клиентам в сети.

Чтобы добавить DHCP-сервер в список разрешенных DHCP-серверов в Active Directory, можно использовать следующую команду: 

> [!NOTE]
> Если у вас нет среды домена, не выполняйте эту команду.

```
Add-DhcpServerInDC -DnsName DHCP1.corp.contoso.com -IPAddress 10.0.0.3
```

Чтобы убедиться, что DHCP-сервер разрешен в Active Directory, можно использовать следующую команду.

```
Get-DhcpServerInDC
```

Ниже приведены примеры результатов, которые отображаются в Windows PowerShell.

```
IPAddress   DnsName
---------   -------
10.0.0.3    DHCP1.corp.contoso.com
```

Дополнительные сведения об этих командах см. в следующих разделах.

- [Add-Дхкпсервериндк](https://docs.microsoft.com/powershell/module/dhcpserver/add-dhcpserverindc)
- [Get-Дхкпсервериндк](https://docs.microsoft.com/powershell/module/dhcpserver/get-dhcpserverindc)

### <a name="notify-server-manager-that-post-install-dhcp-configuration-is-complete-optional"></a>Уведомлять диспетчер сервера о том, что после\-установки конфигурация DHCP завершена \(необязательно\)

После выполнения задач после\-установки, таких как создание групп безопасности и авторизация DHCP-сервера в Active Directory, диспетчер сервера может по-прежнему отображать предупреждение в пользовательском интерфейсе, в котором говорится, что\-после этого необходимо выполнить действия, описанные в мастере настройки DHCP после установки.

Вы можете предотвратить появление этого\-ненужного и неточного сообщения, отображаемого в диспетчер сервера, настроив следующий раздел реестра с помощью этой команды Windows PowerShell.

```
Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2
```

Дополнительные сведения об этой команде см. в следующем разделе.

- [Set-ItemProperty](https://docs.microsoft.com/powershell/module/microsoft.powershell.management/set-itemproperty)

### <a name="set-server-level-dns-dynamic-update-configuration-settings-optional"></a>Задайте параметры конфигурации динамического обновления DNS на уровне сервера \(дополнительные\)

Если требуется, чтобы DHCP-сервер выполнял динамическое обновление DNS для клиентских компьютеров DHCP, можно выполнить следующую команду, чтобы настроить этот параметр. Это параметр уровня сервера, а не параметр уровня области, поэтому он влияет на все области, настроенные на сервере. В этом примере команда также настраивает DHCP-сервер на удаление записей ресурсов DNS для клиентов по крайней мере истечения срока действия клиента.

```
Set-DhcpServerv4DnsSetting -ComputerName "DHCP1.corp.contoso.com" -DynamicUpdates "Always" -DeleteDnsRRonLeaseExpiry $True
```

Чтобы настроить учетные данные, используемые DHCP-сервером для регистрации или отмены регистрации записей клиента на DNS-сервере, можно использовать следующую команду. В этом примере сохраняются учетные данные на DHCP-сервере. Первая команда использует **Get-Credential** для создания объекта **PSCredential** , а затем сохраняет объект в переменной **$Credential** . Команда запрашивает имя пользователя и пароль, поэтому обязательно укажите учетные данные для учетной записи, имеющей разрешение на обновление записей ресурсов на DNS-сервере.
 
```
$Credential = Get-Credential
Set-DhcpServerDnsCredential -Credential $Credential -ComputerName "DHCP1.corp.contoso.com"
``` 

Дополнительные сведения об этих командах см. в следующих разделах.

- [Set-DhcpServerv4DnsSetting](https://docs.microsoft.com/powershell/module/dhcpserver/set-dhcpserverv4dnssetting)
- [Set-Дхкпсерверднскредентиал](https://docs.microsoft.com/powershell/module/dhcpserver/set-dhcpserverdnscredential)

### <a name="configure-the-corpnet-scope"></a>Настройка области корпоративной сети

После завершения установки DHCP можно использовать следующие команды для настройки и активации области корпоративной сети, создания диапазона исключения для области и настройки параметров DHCP-шлюза по умолчанию, IP-адреса DNS-сервера и доменного имени DNS.

```
Add-DhcpServerv4Scope -name "Corpnet" -StartRange 10.0.0.1 -EndRange 10.0.0.254 -SubnetMask 255.255.255.0 -State Active    
Add-DhcpServerv4ExclusionRange -ScopeID 10.0.0.0 -StartRange 10.0.0.1 -EndRange 10.0.0.15
Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.0.1 -ScopeID 10.0.0.0 -ComputerName DHCP1.corp.contoso.com
Set-DhcpServerv4OptionValue -DnsDomain corp.contoso.com -DnsServer 10.0.0.2
```

Дополнительные сведения об этих командах см. в следующих разделах.

- [Add-DhcpServerv4Scope](https://docs.microsoft.com/powershell/module/dhcpserver/Add-DhcpServerv4Scope)
- [Add-DhcpServerv4ExclusionRange](https://docs.microsoft.com/powershell/module/dhcpserver/Add-DhcpServerv4ExclusionRange)
- [Set-DhcpServerv4OptionValue](https://docs.microsoft.com/powershell/module/dhcpserver/Set-DhcpServerv4OptionValue)

### <a name="configure-the-corpnet2-scope-optional"></a>Настройка области Corpnet2 \(необязательно\)

При наличии второй подсети, подключенной к первой подсети с маршрутизатором, на котором включена пересылка DHCP, можно использовать следующие команды, чтобы добавить вторую область с именем Corpnet2 для этого примера. В этом примере также настраивается диапазон исключения и IP-адрес для шлюза по умолчанию \(IP-адрес маршрутизатора в подсети\) подсети Corpnet2.

```
Add-DhcpServerv4Scope -name "Corpnet2" -StartRange 10.0.1.1 -EndRange 10.0.1.254 -SubnetMask 255.255.255.0 -State Active
Add-DhcpServerv4ExclusionRange -ScopeID 10.0.1.0 -StartRange 10.0.1.1 -EndRange 10.0.1.15
Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.1.1 -ScopeID 10.0.1.0 -ComputerName DHCP1.corp.contoso.com
```

При наличии дополнительных подсетей, обслуживаемых этим DHCP-сервером, можно повторить эти команды, используя разные значения для всех параметров команды, чтобы добавить области для каждой подсети.

> [!IMPORTANT]
> Убедитесь, что все маршрутизаторы между DHCP-клиентами и DHCP-сервером настроены для пересылки сообщений DHCP. Сведения о настройке пересылки DHCP см. в документации по маршрутизатору.

## <a name="verify-server-functionality"></a><a name="bkmk_verify"></a>Проверка функциональности сервера

Чтобы убедиться, что сервер DHCP обеспечивает динамическое выделение IP-адресов клиентам DHCP, можно подключить другой компьютер к обслуживаемой подсети. После подключения кабеля Ethernet к сетевому адаптеру и включения питания компьютера будет запрошен IP-адрес с DHCP-сервера. Вы можете проверить успешность настройки с помощью команды **ipconfig/all** , просмотреть результаты или выполнить проверки подключения, например, попытаться получить доступ к веб-ресурсам через браузер или файловые ресурсы с помощью проводника Windows или других приложений.

Если клиент не получает IP-адрес от DHCP-сервера, выполните следующие действия по устранению неполадок.

1. Убедитесь, что кабель Ethernet подсоединен как к компьютеру, так и к коммутатору Ethernet, концентратору или маршрутизатору.
2. Если подключить клиентский компьютер к сегменту сети, отделенному от DHCP-сервера маршрутизатором, убедитесь, что маршрутизатор настроен на пересылку сообщений DHCP.
3. Убедитесь, что DHCP-сервер разрешен в Active Directory, выполнив следующую команду, чтобы получить список разрешенных DHCP-серверов из Active Directory. [Get-дхкпсервериндк](https://docs.microsoft.com/powershell/module/dhcpserver/Get-DhcpServerInDC).
4. Убедитесь, что ваши области активированы, открыв консоль DHCP \(диспетчер сервера, **средства**, **DHCP-** \), разверните дерево сервера, чтобы проверить области, а затем щелкните правой\-каждую область. Если итоговое меню включает выделение **активировать**, нажмите кнопку **активировать**. \(если область уже активирована, выбор меню считывает значение **деактивировать**.\)

## <a name="windows-powershell-commands-for-dhcp"></a><a name="bkmk_dhcpwps"></a>Команды Windows PowerShell для DHCP

Следующая ссылка содержит описания команд и синтаксис для всех команд Windows PowerShell DHCP-сервера для Windows Server 2016. В разделе перечислены команды в алфавитном порядке на основе глагола в начале команд, например **Get** или **Set**.

> [!NOTE]
> Вы не можете использовать команды Windows Server 2016 в Windows Server 2012 R2.

- [Модуль DhcpServer](https://docs.microsoft.com/powershell/module/dhcpserver/)

Следующая ссылка содержит описания команд и синтаксис для всех команд Windows PowerShell DHCP-сервера для Windows Server 2012 R2. В разделе перечислены команды в алфавитном порядке на основе глагола в начале команд, например **Get** или **Set**.

> [!NOTE]
> В Windows Server 2016 можно использовать команды Windows Server 2012 R2.

- [Командлеты DHCP-сервера в Windows PowerShell](https://docs.microsoft.com/windows-server/networking/technologies/dhcp/dhcp-deploy-wps)

## <a name="list-of-windows-powershell-commands-in-this-guide"></a><a name="bkmk_list"></a>Список команд Windows PowerShell в этом пошаговом окне

Ниже приведен простой список команд и примеров значений, используемых в этом руководством.

```
New-NetIPAddress -IPAddress 10.0.0.3 -InterfaceAlias "Ethernet" -DefaultGateway 10.0.0.1 -AddressFamily IPv4 -PrefixLength 24
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 10.0.0.2
Rename-Computer -Name DHCP1
Restart-Computer

Add-Computer CORP
Restart-Computer

Install-WindowsFeature DHCP -IncludeManagementTools
netsh dhcp add securitygroups
Restart-Service dhcpserver

Add-DhcpServerInDC -DnsName DHCP1.corp.contoso.com -IPAddress 10.0.0.3
Get-DhcpServerInDC

Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2

Set-DhcpServerv4DnsSetting -ComputerName "DHCP1.corp.contoso.com" -DynamicUpdates "Always" -DeleteDnsRRonLeaseExpiry $True

$Credential = Get-Credential
Set-DhcpServerDnsCredential -Credential $Credential -ComputerName "DHCP1.corp.contoso.com"

rem At prompt, supply credential in form DOMAIN\user, password

rem Configure scope Corpnet
Add-DhcpServerv4Scope -name "Corpnet" -StartRange 10.0.0.1 -EndRange 10.0.0.254 -SubnetMask 255.255.255.0 -State Active
Add-DhcpServerv4ExclusionRange -ScopeID 10.0.0.0 -StartRange 10.0.0.1 -EndRange 10.0.0.15
Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.0.1 -ScopeID 10.0.0.0 -ComputerName DHCP1.corp.contoso.com
Set-DhcpServerv4OptionValue -DnsDomain corp.contoso.com -DnsServer 10.0.0.2

rem Configure scope Corpnet2
Add-DhcpServerv4Scope -name "Corpnet2" -StartRange 10.0.1.1 -EndRange 10.0.1.254 -SubnetMask 255.255.255.0 -State Active
Add-DhcpServerv4ExclusionRange -ScopeID 10.0.1.0 -StartRange 10.0.1.1 -EndRange 10.0.1.15
Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.1.1 -ScopeID 10.0.1.0 -ComputerName DHCP1.corp.contoso.com
```
