---
title: Развертывание DHCP с помощью Windows PowerShell
description: В этом разделе можно использовать для развертывания DHCP-сервера Windows Server 2016 Internet Protocol (IP) версии 4, предоставляет автоматические IP-адреса и параметры DHCP для IPv4 DHCP-клиентов, подключенных к одной или несколькими подсетями в сети.
ms.prod: windows-server-threshold
ms.technology: networking-dhcp
ms.topic: article
ms.assetid: 7110ad21-a33e-48d5-bb3c-129982913bc8
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 8a53f6293067fa0f7014e7794696cf75f7179545
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59849095"
---
# <a name="deploy-dhcp-using-windows-powershell"></a>Развертывание DHCP с помощью Windows PowerShell

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

В этом руководстве описано, как использовать Windows PowerShell для развертывания IP (Internet Protocol) версии 4 Dynamic Host Configuration Protocol \(DHCP\) параметры сервер, который автоматически назначает IP-адреса и DHCP на IPv4 DHCP Клиенты, которые подключены к одной или несколькими подсетями в сети.

>[!NOTE]
>Чтобы загрузить этот документ в формате Word из коллекции TechNet, см. в разделе [развертывание DHCP с помощью Windows PowerShell в Windows Server 2016](https://gallery.technet.microsoft.com/Deploy-DHCP-Using-Windows-246dd293).

С помощью DHCP-серверы, чтобы назначить IP-адреса сохраняет в административную нагрузку так как вам не нужно вручную настроить параметры TCP/IP версии 4 для каждого сетевого адаптера в каждый компьютер в сети. С помощью DHCP конфигурации TCP/IP v4 выполняется автоматически, когда компьютер или другие DHCP-клиент подключен к сети.

Как автономный сервер или как часть домена Active Directory можно развернуть DHCP-сервера в рабочую группу.

Данное руководство содержит следующие разделы.

- [Общие сведения о развертывании DHCP](#bkmk_overview)
- [Обзор технологий](#bkmk_technologies)
- [Планирование развертывания DHCP](#bkmk_plan)
- [С помощью этого руководства в лабораторной среде](#bkmk_lab)
- [Развертывание DHCP](#bkmk_deploy)
- [Проверка работоспособности сервера](#bkmk_verify)
- [Команды Windows PowerShell для DHCP](#bkmk_dhcpwps)
- [Список команд Windows PowerShell в этом руководстве](#bkmk_list)

## <a name="bkmk_overview"></a>Общие сведения о развертывании DHCP

На следующем рисунке показана сценарий, который можно развернуть с помощью этого руководства. Этот сценарий включает один DHCP-сервер в домене Active Directory. Сервер настроен для предоставления IP-адресов DHCP-клиентам в двух разных подсетях. Подсети разделяются на маршрутизатор, при включенной пересылке DHCP.

![Общие сведения о топологии сети DHCP](../../media/Core-Network-Guide/cng16_overview.jpg)

## <a name="bkmk_technologies"></a>Обзор технологий

В следующих разделах приведен краткий обзор DHCP и TCP/IP.

### <a name="dhcp-overview"></a>Обзор протокола DHCP

DHCP — это стандарт IP для упрощения управления IP-конфигурацией узлов. Стандарт DHCP предусматривает использование DHCP-серверов для управления динамическим выделением IP-адресов и других сопутствующих сведений о настройке для клиентов сети, поддерживающих DHCP.

DHCP позволяет использовать DHCP-сервер для динамического назначения IP-адреса на компьютере или другом устройстве, такие как принтер, в локальной сети, а не вручную настраивать все устройства с помощью статического IP-адреса.

Любой компьютер в сети TCP/IP должен иметь уникальный IP-адрес, который вместе с маской подсети однозначно определяет главный компьютер и подсеть, в которой этот компьютер находится. Используя DHCP, можно проверить, все ли компьютеры, настроенные в качестве DHCP-клиентов, получают IP-адреса, предназначенные для данной подсети и расположения в сети; такие параметры DHCP, как шлюз по умолчанию и DNS-серверы, вместе с информацией о правильной работе в сети можно автоматически передавать DHCP-клиентам.

Для сетей на основе IP-адресов DHCP снижает сложность и объем работы администратора по настройке компьютеров.

### <a name="tcpip-overview"></a>Обзор TCP/IP

По умолчанию всех версий операционных систем Windows Server и клиента Windows имеют параметры TCP/IP для IP версии 4 сетевых подключений, автоматически получают IP-адреса и другие сведения, называемые параметры DHCP от DHCP-сервера. По этой причине не нужно вручную настроить параметры TCP/IP, если компьютер не входит серверу или другие устройства, которому требуется вручную настроенных статический IP-адрес. 

Например, рекомендуется вручную настроить IP-адрес DHCP-сервера и IP-адреса DNS-серверов и контроллеров домена, работающих под управлением доменных служб Active Directory \(AD DS\).

TCP/IP в Windows Server 2016 представляет собой следующее:

-   сетевое программное обеспечение, которое основано на сетевых протоколах, являющихся отраслевым стандартом;

-   маршрутизируемый протокол корпоративных сетей, обеспечивающий подключение компьютера под управлением Windows к локальным и глобальным сетям;

-   базовые технологии и служебные программы для соединения компьютеров под управлением ОС Windows с разнородными системами для обмена данными;

-   Основа для получения доступа к глобальным службам Интернета, таких как протокол передачи файлов (FTP) и веб-серверы.

-   надежная, масштабируемая кроссплатформенная система клиент-сервер.

TCP/IP обеспечивает основные служебные программы TCP/IP, которые позволяют компьютерам под управлением Windows соединяться с другими системами, произведенными как корпорацией Майкрософт, так и другими компаниями. Ниже указаны некоторые из них.

- Windows Server 2016

- Windows 10

- Windows Server 2012 R2

- Windows 8.1

- Windows Server 2012

- Windows 8

- Windows Server 2008 R2

- Windows 7

- Windows Server 2008

- Windows Vista

- Узлы в Интернете

- Системы Apple Macintosh

- Мэйнфреймы IBM

- Систем UNIX и Linux

- Системы Open VMS

- Сетевые принтеры

- Планшеты и телефоны сотовый с проводной сети Ethernet и беспроводных технологий 802.11

## <a name="bkmk_plan"></a>Планирование развертывания DHCP

Ниже приведены ключевые действия по планированию перед установкой роли DHCP-сервера.

### <a name="planning-dhcp-servers-and-dhcp-forwarding"></a>Планирование DHCP-серверов и пересылки DHCP

Поскольку сообщения DHCP являются широковещательными, маршрутизаторы не пересылают их между подсетями. Если имеется несколько подсетей и службу DHCP требуется обеспечить для каждой из них, необходимо выполнить одно из описанных ниже действий.

-   Установите DHCP-сервер в каждой из подсетей.

-   Настройте маршрутизаторы на пересылку широковещательных сообщений DHCP между подсетями, а на DHCP-сервере настройте несколько областей (по одной на подсеть).

В большинстве случаев настройка маршрутизаторов на пересылку широковещательных сообщений DHCP является более экономически эффективным решением, чем развертывание DHCP-сервера в каждом из физических сегментов сети.

### <a name="planning-ip-address-ranges"></a>Планирование диапазонов IP-адресов

У каждой подсети должен быть собственный уникальный диапазон IP-адресов. Эти диапазоны представлены на DHCP-сервере с помощью областей.

Область представляет собой группировку IP-адресов в целях администрирования для компьютеров подсети, в которой используется служба DHCP. Администратор сначала создает область для каждой физической подсети, а затем использует ее для определения параметров клиентских компьютеров.

Область имеет указанные ниже свойства.

-   Диапазон IP-адресов, в котором осуществляется включение или исключение адресов, используемых в предложениях на выделение адреса службы DHCP.

-   Маска подсети, определяющая префикс подсети для конкретного IP-адреса.

-   Имя области, назначаемое при ее создании.

-   Сроки действия аренды адресов, которые назначаются DHCP-клиентам, получающим динамически выделяемые IP-адреса.

-   Любые параметры области DHCP, настроенные для назначения DHCP-клиентам, такие как IP-адрес DNS-сервера и маршрутизатора или шлюза по умолчанию.

-   Резервирование — дополнительная возможность, обеспечивающая постоянное получение DHCP-клиентом одного и того же IP-адреса.

Перед развертыванием серверов создайте список подсетей и диапазонов IP-адресов, которые необходимо использовать для каждой из подсетей.

### <a name="planning-subnet-masks"></a>Планирование масок подсетей

Для различения идентификаторов сетей и адресов узлов используется маска подсети. Каждая маска подсети — это 32-разрядное число, в котором группа последовательных единичных битов (1) используется для обозначения идентификатора сети, а группа последовательных нулевых битов (0) — для обозначения адреса узла в IP-адресе.

Например, с IP-адресом 131.107.16.200 обычно используется маска подсети, которая представляет собой следующее 32-разрядное двоичное число:

```
11111111 11111111 00000000 00000000
```

Эта маска подсети — 16 битов следуют 16 нулевых битов, указывающее, что идентификатор и узла идентификатор разделах сети этот IP-адрес обоих длиной в 16 бит. Обычно маска подсети отображается в виде десятичных чисел, разделенных точками (255.255.0.0).

В таблице ниже приведены маски подсетей для классов адресов Интернета.

|Класс адреса|Количество битов для маски подсети|Маска подсети|
|-----------------|------------------------|---------------|
|Класс A|11111111 00000000 00000000 00000000|255.0.0.0|
|Класс B|11111111 11111111 00000000 00000000|255.255.0.0|
|Класс C|11111111 11111111 11111111 00000000|255.255.255.0|

При создании области в DHCP и вводе диапазона IP-адресов для области служба DHCP обеспечивает эти значения масок подсетей по умолчанию. Обычно значения масок подсетей по умолчанию применимы для большинства сетей, не имеющих особых требований, а также там, где каждый сегмент IP-сети соответствует одной физической сети.

В некоторых случаях для реализации IP-подсетей маски подсетей можно настраивать. При использовании IP-подсетей часть адреса узла по умолчанию можно разделить, чтобы определить подсети, которые являются подразделениями исходного идентификатора сети какого-либо класса.

Настройкой длины маски подсети можно уменьшить количество бит, необходимое для адреса узла.

Чтобы избежать проблем с адресацией и маршрутизацией, необходимо убедиться в том, что все компьютеры сегмента подсети, поддерживающие протокол TCP/IP, используют одинаковую маску подсети и что у каждого устройства имеется уникальный IP-адрес.

### <a name="planning-exclusion-ranges"></a>Планирование диапазонов исключения

При создании области на DHCP-сервере укажите диапазон IP-адресов, включающий все адреса, которые разрешено арендовать DHCP-клиентам, таким как компьютеры и другие устройства. Если вручную установить статические IP-адреса некоторым серверам и устройствам из того же диапазона адресов, который DHCP-сервер предоставляет в аренду, можно непреднамеренно создать конфликт IP-адресов, при котором вы и DHCP-сервер назначите один и тот же адрес разным устройствам.

Чтобы избежать этого, необходимо создать диапазон исключения для области DHCP. Диапазон исключения — это непрерывный диапазон IP-адресов, в диапазон IP-адресов области, что DHCP-сервер не разрешено использовать. DHCP-сервер не назначает адреса из созданного диапазона исключения; это позволяет вручную назначать IP-адреса, не опасаясь их конфликта.

IP-адреса можно исключить из распределения DHCP-сервером с помощью создания диапазона исключения для каждой области. Исключения необходимо использовать для всех устройств, для которых настроены статические IP-адреса. Исключаемые адреса должны включать все IP-адреса, вручную назначенные другим серверам, клиентам, не поддерживающим DHCP, бездисковым рабочим станциям или клиентам маршрутизации и удаленного доступа и PPP-клиентам.

Рекомендуется добавить в диапазоны исключения дополнительные адреса, чтобы предусмотреть рост сети в будущем. В следующей таблице приведены диапазон исключения для области с диапазоном адресов IP-адрес 10.0.0.1 - 10.0.0.254 и маской подсети 255.255.255.0.

|Элементы конфигурации|Примеры значений|
|-----------------------|------------------|
|Начальный IP-адрес диапазона исключения|10.0.0.1|
|Конечный IP-адрес диапазона исключения|10.0.0.25|

### <a name="planning-tcpip-static-configuration"></a>Планирование статической конфигурации TCP/IP

Определенные устройства, такие как маршрутизаторы, DHCP-серверы и DNS-серверы, необходимо настраивать с использованием статических IP-адресов. Кроме того, принтерам и другим дополнительным устройствам также может потребоваться назначение постоянного IP-адреса. Создайте для каждой подсети список устройств, которые необходимо настроить статически, а затем запланируйте диапазон исключения, который необходимо использовать на DHCP-сервере, чтобы последний не сдавал в аренду IP-адреса статически настроенных устройств. Диапазон исключения — это ограниченная последовательность IP-адресов области, исключаемых из числа назначаемых службой DHCP. Сервер не назначает DHCP-клиентам сети адреса из диапазонов исключения.

Например если диапазон IP-адресов для подсети — 192.168.0.1–192.168.0.254 и имеется десять устройств, которые вы хотите настроить статический IP-адрес, можно создать диапазон исключения для 192.168.0. *x* область, содержащая около десяти IP-адресов: 192.168.0.1–192.168.0.15.

В данном примере десять из числа исключаемых IP-адресов используются для настройки статических IP-адресов на серверах и других устройствах, а пять дополнительных IP-адресов оставлены про запас для статической настройки новых устройств, которые могут быть добавлены в будущем. При использовании этого диапазона исключения DHCP-серверу оставлен пул адресов 192.168.0.16–192.168.0.254.

В следующей таблице приведены дополнительные примеры элементов конфигурации для AD DS и DNS.

|Элементы конфигурации|Примеры значений|
|-----------------------|------------------|
|Привязки сетевых подключений|Ethernet|
|Параметры DNS-сервера|DC1.corp.contoso.com|
|IP-адрес предпочитаемого DNS-сервера|10.0.0.2|
|Значения области<br /><br />1.  Имя области<br />2.  Начальный IP-адрес<br />3.  Конечный IP-адрес<br />4.  Маска подсети<br />5.  Шлюз по умолчанию (необязательно)<br />6.  Срок действия аренды адреса|1.  Основная подсеть<br />2.  10.0.0.1<br />3.  10.0.0.254<br />4.  255.255.255.0<br />5.  10.0.0.1<br />6. 8 дней|
|Режим работы DHCP-сервера IPv6|Отключено|

## <a name="bkmk_lab"></a>С помощью этого руководства в лабораторной среде

В этом руководстве можно использовать для развертывания DHCP в лабораторной среде перед развертыванием в рабочей среде. 

>[!NOTE]
>Если вы не хотите развернуть DHCP в лабораторной среде, можно перейти к разделу [развертывание DHCP](#bkmk_deploy).

Требования для лаборатории, отличаются в зависимости от того, используете ли вы физических серверов или виртуальных машин \(виртуальных машин\), и является ли вы используете домен Active Directory или развертывания автономного сервера DHCP. 

Чтобы определить минимальный набор ресурсов, необходимые для тестирования развертывания DHCP с помощью этого руководства можно использовать следующие сведения.

### <a name="test-lab-requirements-with-vms"></a>Требования к лаборатории тестирования с виртуальными машинами

Чтобы развернуть DHCP в лаборатории тестирования с виртуальными машинами, вам понадобится следующие ресурсы.

Для домена развертывания или отдельного развертывания, необходим один сервер, настроенный в качестве Hyper\-узел V.

**Развертывания домена**

Для этого развертывания требуется одного физического сервера, для одного виртуального коммутатора, два виртуальных серверов и одного виртуального клиента:

На физический сервер в диспетчере Hyper-V, создайте следующие элементы.

1. Один **внутренний** виртуального коммутатора. Не создавайте **внешних** виртуального коммутатора, поскольку если Hyper\-V узел входит в подсеть, включающую DHCP-сервера, на тестовых виртуальных машин будут получать IP-адрес от DHCP-сервера. Кроме того, тестовый DHCP-сервер, который развертывается может назначать IP-адреса других компьютеров в подсети где Hyper\-узел V устанавливается.
1. Одна виртуальная машина под управлением Windows Server 2016 настроен в качестве контроллера домена с доменными службами Active Directory, который подключен к внутреннему виртуальному коммутатору, который вы создали. Чтобы сопоставить это руководство, этот сервер должен иметь статически настроенных IP-адрес 10.0.0.2. Сведения о развертывании AD DS, см. в разделе **развертывание DC1** в Windows Server 2016 [руководство по основной сети](https://technet.microsoft.com/windows-server-docs/networking/core-network-guide/core-network-guide#BKMK_deployADDNS01).
1. Одной виртуальной Машины под управлением Windows Server 2016, настроенным как DHCP-сервер, используя в этом руководстве и который подключен внутренний виртуальный коммутатор создан. 
1. Одна виртуальная машина под управлением операционной системы клиента Windows, подключенный к виртуальной внутренний переключиться был создан, и будет использовать для проверки того, что DHCP-сервера является динамического выделения IP-адресов и параметров DHCP на DHCP-клиентов.

**Развертывание DHCP автономного сервера**

Для этого развертывания требуется одного физического сервера, для одного виртуального коммутатора, один виртуальный сервер и один клиент виртуальной:

На физический сервер в диспетчере Hyper-V, создайте следующие элементы.

1. Один **внутренний** виртуального коммутатора. Не создавайте **внешних** виртуального коммутатора, поскольку если Hyper\-V узел входит в подсеть, включающую DHCP-сервера, на тестовых виртуальных машин будут получать IP-адрес от DHCP-сервера. Кроме того, тестовый DHCP-сервер, который развертывается может назначать IP-адреса других компьютеров в подсети где Hyper\-узел V устанавливается.
1. Одной виртуальной Машины под управлением Windows Server 2016, настроенным как DHCP-сервер, используя в этом руководстве и который подключен внутренний виртуальный коммутатор создан.
1. Одна виртуальная машина под управлением операционной системы клиента Windows, подключенный к виртуальной внутренний переключиться был создан, и будет использовать для проверки того, что DHCP-сервера является динамического выделения IP-адресов и параметров DHCP на DHCP-клиентов.

### <a name="test-lab-requirements-with-physical-servers"></a>Требования к лаборатории тестирования с физических серверов

Чтобы развернуть DHCP в лаборатории тестирования с физических серверов, вам понадобится следующие ресурсы.

**Развертывания домена**

Для этого развертывания требуется один концентратор или коммутатор, два физических сервера и один физический клиентский:

1. Один концентратор или коммутатор к которому могут подключаться физические компьютеры с помощью кабеля Ethernet
1. Один физический компьютер под управлением Windows Server 2016 настроен в качестве контроллера домена с доменными службами Active Directory. Чтобы сопоставить это руководство, этот сервер должен иметь статически настроенных IP-адрес 10.0.0.2. Сведения о развертывании AD DS, см. в разделе **развертывание DC1** в Windows Server 2016 [руководство по основной сети](https://technet.microsoft.com/windows-server-docs/networking/core-network-guide/core-network-guide#BKMK_deployADDNS01).
1. Один физический компьютер под управлением Windows Server 2016, который вы настроите DHCP-сервера с помощью этого руководства. 
1. Один физический компьютер под управлением операционной системы клиента Windows, который будет использоваться, чтобы убедиться, что DHCP-сервером динамического выделения IP-адресов и параметров DHCP DHCP-клиентам.

>[!NOTE]
>Если у вас недостаточно тестовых компьютеров для этого развертывания, можно использовать один тестовый компьютер для AD DS и DHCP -, однако эта конфигурация не рекомендуется для рабочей среды.

**Развертывание DHCP автономного сервера**

Для этого развертывания требуется один концентратор или коммутатор, одного физического сервера и один физический клиентский:

1. Один концентратор или коммутатор к которому могут подключаться физические компьютеры с помощью кабеля Ethernet
2. Один физический компьютер под управлением Windows Server 2016, который вы настроите DHCP-сервера с помощью этого руководства. 
3. Один физический компьютер под управлением операционной системы клиента Windows, который будет использоваться, чтобы убедиться, что DHCP-сервером динамического выделения IP-адресов и параметров DHCP DHCP-клиентам.


## <a name="bkmk_deploy"></a>Развертывание DHCP

Этот раздел содержит примеры команд Windows PowerShell, которые можно использовать для развертывания DHCP на одном сервере. Прежде чем выполнять эти примеры команд на сервере необходимо изменить команды в соответствии с вашей сетью и среды. 

Например перед запуском команды, следует заменить примеры значений в командах для следующих элементов:

- Имена компьютеров
- Диапазон IP-адресов для каждой области, которую требуется настроить (1 область каждой подсети)
- Маска подсети для каждого диапазона IP-адресов, который вы хотите настроить
- Имя области для каждой области
- Диапазон исключения для каждой области
- Значения параметров DHCP, такие как шлюз по умолчанию, имя домена и серверы DNS или WINS
- Имена интерфейсов.

>[!IMPORTANT]
>Проверять и изменять все команды для вашей среды, перед выполнением команды.

### <a name="where-to-install-dhcp---on-a-physical-computer-or-a-vm"></a>Где установить DHCP - на физическом компьютере или виртуальной Машины?

Роль DHCP-сервера можно установить на физическом компьютере или на виртуальной машине \(виртуальной Машины\) установленного Hyper\-узел V. Если вы устанавливаете DHCP на виртуальной Машине и DHCP-сервер для предоставления назначения IP-адресов для компьютеров в физической сети, к которому подключен на узле Hyper-V, виртуальный сетевой адаптер виртуальной Машины необходимо подключиться к виртуальному коммутатору Hyper-V, **Внешних**.

Дополнительные сведения см. в разделе **Создание виртуального коммутатора с помощью диспетчера Hyper-V** в разделе [Создание виртуальной сети](https://docs.microsoft.com/virtualization/hyper-v-on-windows/quick-start/connect-to-network).

### <a name="run-windows-powershell-as-an-administrator"></a>Запустите Windows PowerShell от имени администратора

Можно использовать следующую процедуру для запуска Windows PowerShell с правами администратора.

1. На компьютере под управлением Windows Server 2016, нажмите кнопку **запустить**, щелкните правой кнопкой мыши значок Windows PowerShell. Появится меню. 

2. В меню, щелкните **дополнительные**, а затем нажмите кнопку **Запуск от имени администратора**. При появлении запроса введите учетные данные для учетной записи, имеющей права администратора на компьютере. Если учетной записи пользователя, с которым вы вошли на компьютер уровня учетной записи администратора, вы не получите запрос учетных данных.

3. Windows PowerShell открывается с правами администратора.

### <a name="rename-the-dhcp-server-and-configure-a-static-ip-address"></a>Переименуйте DHCP-сервер и настроить статический IP-адрес

Если вы еще не сделано, можно использовать следующие команды Windows PowerShell для переименования DHCP-сервер и настроить статический IP-адрес для сервера.

**Настройка статического IP-адреса**

Чтобы назначить статический IP-адрес DHCP-сервер и чтобы настроить свойства TCP/IP DHCP-сервера в правильный IP-адрес сервера DNS, можно использовать следующие команды. Кроме того, в этом примере необходимо переименовать интерфейсы и сменить IP-адреса на значения, подходящие для вашего компьютера.

 `New-NetIPAddress -IPAddress 10.0.0.3 -InterfaceAlias "Ethernet" -DefaultGateway 10.0.0.1 -AddressFamily IPv4 -PrefixLength 24`

 `Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 10.0.0.2`

Дополнительные сведения об этих командах см. в разделах.

- [New-NetIPAddress](https://technet.microsoft.com/itpro/powershell/windows/tcpip/new-netipaddress)
- [SET-DnsClientServerAddress](https://technet.microsoft.com/itpro/powershell/windows/dns-client/set-dnsclientserveraddress)

**Переименование компьютера**

Переименуйте и перезагрузите компьютер, можно использовать следующие команды.

`Rename-Computer -Name DHCP1`

 `Restart-Computer`

Дополнительные сведения об этих командах см. в разделах.

- [Rename-Computer](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.management/rename-computer)
- [Restart-Computer](https://msdn.microsoft.com/powershell/reference/4.0/microsoft.powershell.management/restart-computer)

### <a name="join-the-computer-to-the-domain-optional"></a>Присоедините компьютер к домену \(необязательно.\)

При установке DHCP-сервера в среде домена Active Directory, необходимо присоединить компьютер к домену. Откройте Windows PowerShell с правами администратора, а затем выполните следующую команду после замены NetBIOS-имя домена **CORP** со значением, которое подходит для вашей среды.

    Add-Computer CORP

При запросе введите учетные данные для учетной записи пользователя домена, имеющую разрешение на присоединение компьютера к домену. 

    Restart-Computer

Дополнительные сведения о команде Add-Computer см. в разделе ниже.

- [Добавление компьютера](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.management/add-computer)

### <a name="install-dhcp"></a>Установка DHCP

После перезагрузки компьютера, откройте Windows PowerShell с правами администратора и затем установите DHCP, выполнив следующую команду.

    Install-WindowsFeature DHCP -IncludeManagementTools

Дополнительные сведения об этой команде см. в разделе ниже.

- [Install-WindowsFeature](https://technet.microsoft.com/itpro/powershell/windows/server-manager/install-windowsfeature)

### <a name="create-dhcp-security-groups"></a>Создание групп безопасности DHCP

Чтобы создать группы безопасности, необходимо запустить сетевой оболочки \(netsh\) команду в Windows PowerShell, а затем перезапустите службу DHCP, таким образом, чтобы новые группы становятся активными.

Когда вы выполните следующую команду netsh DHCP-сервера, **администраторов DHCP** и **Пользователи DHCP** группы безопасности, создаются в **локальные пользователи и группы** от DHCP сервер.

    netsh dhcp add securitygroups

Приведенная ниже команда перезапускает службу DHCP на локальном компьютере.

    Restart-service dhcpserver

Дополнительные сведения об этих командах см. в разделах.

- [Сетевой оболочки (Netsh)](../netsh/netsh.md)
- [Restart-Service](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.management/restart-service)

### <a name="authorize-the-dhcp-server-in-active-directory-optional"></a>Авторизация DHCP-сервера в Active Directory \(необязательно.\)

Если вы устанавливаете DHCP в среде домена, необходимо выполнить следующие действия, чтобы авторизовать DHCP-сервер для работы в домене.

>[!NOTE]
>Неавторизованных DHCP-серверов, установленных в доменах Active Directory не сможет работать правильно и не предоставлять в аренду IP-адресов DHCP-клиентам. Автоматическое отключение неавторизованных DHCP-серверов — это функция безопасности, который предотвращает назначение неправильные IP-адреса клиентам в сети неавторизованных DHCP-серверов.

Можно использовать следующую команду, чтобы добавить DHCP-сервер в список авторизированных DHCP-серверов в Active Directory. 

>[!NOTE]
>Если у вас в среде домена, не выполнить эту команду.

 `Add-DhcpServerInDC -DnsName DHCP1.corp.contoso.com -IPAddress 10.0.0.3`

Чтобы убедиться, что DHCP-сервер авторизован в Active Directory, можно использовать следующую команду.

    Get-DhcpServerInDC

Ниже приведены результаты, которые отображаются в Windows PowerShell.

    
        IPAddress   DnsName
        ---------   -------
        10.0.0.3    DHCP1.corp.contoso.com
    

Дополнительные сведения об этих командах см. в разделах.

- [Добавить DhcpServerInDC](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/add-dhcpserverindc)
- [Get-DhcpServerInDC](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/get-dhcpserverindc)

### <a name="notify-server-manager-that-post-install-dhcp-configuration-is-complete-optional"></a>Уведомления диспетчера серверов, Учет\-будет выполнена настройка DHCP установки \(необязательно.\)

После завершения post\-задач установки, таких как создание групп безопасности и авторизация DHCP-сервера в Active Directory, диспетчер серверов может по-прежнему отображать оповещение в пользовательском интерфейсе сообщение о том, что post\- необходимо выполнить действия по установке с помощью мастера настройки установки после DHCP.

Это можно предотвратить теперь\-ненужных и неточные сообщения появлялись в диспетчере сервера, настроив следующий раздел реестра, с помощью следующей команды Windows PowerShell.

    Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2

Дополнительные сведения об этой команде см. в разделе ниже.

- [Set-ItemProperty](https://msdn.microsoft.com/powershell/reference/4.0/microsoft.powershell.management/set-itemproperty?f=255&MSPPError=-2147217396)

### <a name="set-server-level-dns-dynamic-update-configuration-settings-optional"></a>Задать параметры конфигурации сервера динамическое обновление уровня DNS \(необязательно.\)

DHCP-сервер для выполнения динамических обновлений DNS для DHCP клиентских компьютеров, можно запустить следующую команду, чтобы настроить этот параметр. Это уровень сервера, параметра, не области уровня настройки, поэтому это повлияет на все области, которые можно настроить на сервере. В этом примере команда также настраивает DHCP-сервера для удаления записей ресурсов DNS для клиентов, если бы истечения срока действия его.

    Set-DhcpServerv4DnsSetting -ComputerName "DHCP1.corp.contoso.com" -DynamicUpdates "Always" -DeleteDnsRRonLeaseExpiry $True

Можно использовать следующую команду, чтобы настроить учетные данные, используемые DHCP-сервера для регистрации или отмены регистрации записей клиентов на DNS-сервер. В этом примере сохраняет учетные данные на DHCP-сервере. Первая команда использует **Get-Credential** для создания **PSCredential** объекта, а затем сохраняет объект в **$Credential** переменной. Команда запрашивает имя пользователя и пароль, поэтому убедитесь, что вы предоставите учетные данные учетной записи, которая имеет разрешение на обновление записей ресурсов на сервере DNS.

    
    $Credential = Get-Credential
    Set-DhcpServerDnsCredential -Credential $Credential -ComputerName "DHCP1.corp.contoso.com"
    

Дополнительные сведения об этих командах см. в разделах.

- [SET-DhcpServerv4DnsSetting](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/set-dhcpserverv4dnssetting)
- [SET-DhcpServerDnsCredential](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/set-dhcpserverdnscredential)

### <a name="configure-the-corpnet-scope"></a>Настройка области корпоративной сети

После завершения установки DHCP, можно использовать следующие команды для настройки и активировать область корпоративной сети, создать диапазон исключения для области и настроить шлюз по умолчанию параметры DHCP, IP-адрес сервера DNS и DNS-имя домена.

    
    Add-DhcpServerv4Scope -name "Corpnet" -StartRange 10.0.0.1 -EndRange 10.0.0.254 -SubnetMask 255.255.255.0 -State Active`
    
    Add-DhcpServerv4ExclusionRange -ScopeID 10.0.0.0 -StartRange 10.0.0.1 -EndRange 10.0.0.15`
    
    Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.0.1 -ScopeID 10.0.0.0 -ComputerName DHCP1.corp.contoso.com`
    
    Set-DhcpServerv4OptionValue -DnsDomain corp.contoso.com -DnsServer 10.0.0.2
    

Дополнительные сведения об этих командах см. в разделах.

- [Добавить DhcpServerv4Scope](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/add-dhcpserverv4scope)
- [Добавить DhcpServerv4ExclusionRange](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/add-dhcpserverv4exclusionrange)
- [SET-DhcpServerv4OptionValue](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/set-dhcpserverv4optionvalue)

### <a name="configure-the-corpnet2-scope-optional"></a>Настройка области Corpnet2 \(необязательно\)

Если у вас есть вторую подсеть, которая подключена к первой подсети с маршрутизатором, где включена пересылка DHCP, можно использовать следующие команды для добавления второй области, с именем Corpnet2 в этом примере. В этом примере настраивается диапазон исключения и IP-адреса для шлюза по умолчанию \(IP-адрес маршрутизатора подсети\) Corpnet2 подсети.

 `Add-DhcpServerv4Scope -name "Corpnet2" -StartRange 10.0.1.1 -EndRange 10.0.1.254 -SubnetMask 255.255.255.0 -State Active`

 `Add-DhcpServerv4ExclusionRange -ScopeID 10.0.1.0 -StartRange 10.0.1.1 -EndRange 10.0.1.15`

 `Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.1.1 -ScopeID 10.0.1.0 -ComputerName DHCP1.corp.contoso.com`

Если у вас есть дополнительные подсети, обслуживаемых этим сервером DHCP, можно повторить эти команды с помощью различных значений для всех параметров команды, чтобы добавить области для каждой подсети.

>[!IMPORTANT]
>Убедитесь, что все маршрутизаторы между DHCP-клиентов и DHCP-сервера настроены на перенаправление сообщений DHCP. См. в документации маршрутизатора сведения о настройке пересылки DHCP-сообщений.

## <a name="bkmk_verify"></a>Проверка работоспособности сервера

Чтобы убедиться, что сервер DHCP предоставляет выделения динамических IP-адресов DHCP-клиентам, можно соединиться с другого компьютера обслуживаемые подсети. После подключения кабеля Ethernet сетевой адаптер и питания на компьютере, он запрашивает IP-адрес от DHCP-сервера. Чтобы успешно настроить можно проверить с помощью **ipconfig/all** команду и просмотрев результаты или выполняя проверку возможности подключения, такие как попытка доступа к веб-ресурсы с вашего браузера или файл общих папок с Windows Проводник или других приложений.

Если клиент не получает IP-адрес от DHCP-сервера, выполните следующие действия.

1. Убедитесь, что кабель Ethernet подключен как компьютер и Ethernet коммутатора, концентратор или маршрутизатор.
1. Если клиентский компьютер подключен к сегменту сети, который отделен от DHCP-сервер, маршрутизатором, убедитесь, что маршрутизатор настроен на пересылку сообщений DHCP.
1. Убедитесь, что DHCP-сервер авторизован в Active Directory, выполнив следующую команду, чтобы получить список авторизированных DHCP-серверов из Active Directory. [Get-DhcpServerInDC](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/get-dhcpserverindc).
1. Убедитесь, что области активируются, открыв консоль DHCP \(диспетчера серверов, **средства**, **DHCP**\), развернув дерево сервера, чтобы проверить области, затем правой кнопкой мыши\-щелкнув каждой области. Если в появившемся меню включает выбор **активировать**, нажмите кнопку **активировать**. \(Если область уже активирована, считывает пунктов меню **деактивировать**.\) 

## <a name="bkmk_dhcpwps"></a>Команды Windows PowerShell для DHCP

Описание команды и синтаксис для всех команд DHCP Server Windows PowerShell предоставляет следующую ссылку для Windows Server 2016. В этом разделе перечислены команды в алфавитном порядке по глаголу, в начале команды, такие как **получить** или **задать**.

>[!NOTE]
>Можно не использовать команды Windows Server 2016 в Windows Server 2012 R2.

- [Модуля DhcpServer](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/index)

Описание команды и синтаксис для всех команд DHCP Server Windows PowerShell предоставляет следующую ссылку для Windows Server 2012 R2. В этом разделе перечислены команды в алфавитном порядке по глаголу, в начале команды, такие как **получить** или **задать**.

>[!NOTE]
>Можно использовать команды Windows Server 2012 R2 в Windows Server 2016.

- [Командлеты DHCP-сервера в Windows PowerShell](https://technet.microsoft.com/library/jj590751.aspx)

## <a name="bkmk_list"></a>Список команд Windows PowerShell в этом руководстве

Ниже приведен простой список команд и примеры значений, которые используются в этом руководстве.

    
    New-NetIPAddress -IPAddress 10.0.0.3 -InterfaceAlias "Ethernet" -DefaultGateway 10.0.0.1 -AddressFamily IPv4 -PrefixLength 24
    Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 10.0.0.2
    Rename-Computer -Name DHCP1
    Restart-Computer
    
    Add-Computer CORP
    Restart-Computer
    
    Install-WindowsFeature DHCP -IncludeManagementTools
    netsh dhcp add securitygroups
    Restart-service dhcpserver
    
    Add-DhcpServerInDC -DnsName DHCP1.corp.contoso.com -IPAddress 10.0.0.3
    Get-DhcpServerInDC
    
    Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2
    
    Set-DhcpServerv4DnsSetting -ComputerName "DHCP1.corp.contoso.com" -DynamicUpdates "Always" -DeleteDnsRRonLeaseExpiry $True
    
    $Credential = Get-Credential
    Set-DhcpServerDnsCredential -Credential $Credential -ComputerName "DHCP1.corp.contoso.com"
    
    rem At prompt, supply credential in form DOMAIN\user, password
    
    
    rem Configure scope Corpnet
    
    Add-DhcpServerv4Scope -name "Corpnet" -StartRange 10.0.0.1 -EndRange 10.0.0.254 -SubnetMask 255.255.255.0 -State Active
    
    Add-DhcpServerv4ExclusionRange -ScopeID 10.0.0.0 -StartRange 10.0.0.1 -EndRange 10.0.0.15
    
    Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.0.1 -ScopeID 10.0.0.0 -ComputerName DHCP1.corp.contoso.com
    
    Set-DhcpServerv4OptionValue -DnsDomain corp.contoso.com -DnsServer 10.0.0.2
    
    rem Configure scope Corpnet2
    
    Add-DhcpServerv4Scope -name "Corpnet2" -StartRange 10.0.1.1 -EndRange 10.0.1.254 -SubnetMask 255.255.255.0 -State Active
    
    Add-DhcpServerv4ExclusionRange -ScopeID 10.0.1.0 -StartRange 10.0.1.1 -EndRange 10.0.1.15
    
    Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.1.1 -ScopeID 10.0.1.0 -ComputerName DHCP1.corp.contoso.com
    


