---
title: Развертывание DHCP с использованием Windows PowerShell
description: В этом разделе можно использовать для развертывания DHCP-сервера Windows Server 2016 Internet Protocol (IP) версии 4, обеспечивающий автоматические IP-адреса и параметры DHCP для клиентов IPv4 DHCP, подключенных к одной или несколькими подсетями в сети.
ms.prod: windows-server-threshold
ms.technology: networking-dhcp
ms.topic: article
ms.assetid: 7110ad21-a33e-48d5-bb3c-129982913bc8
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 2be3c02f32229c9b9ee411f5e97305776f9825d8
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="deploy-dhcp-using-windows-powershell"></a>Развертывание DHCP с использованием Windows PowerShell

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

Это руководство содержит инструкции о том, как использовать Windows PowerShell для развертывания сервера \(DHCP\) Dynamic Host Configuration Protocol версии 4 протокола Интернета (IP), автоматически назначаются IP-адреса и параметры DHCP IPv4 DHCP-клиентов, подключенных к одной или несколькими подсетями в сети.

>[!NOTE]
>Этот документ в формате Word можно загрузить из галереи TechNet, в разделе [развертывание DHCP с помощью Windows PowerShell в Windows Server 2016](https://gallery.technet.microsoft.com/Deploy-DHCP-Using-Windows-246dd293).

С помощью DHCP-серверов, чтобы назначить IP-адреса сохраняет в административную нагрузку так как не нужно вручную настроить параметры TCP/IP версии 4 для каждого сетевого адаптера в каждый компьютер в сети. С помощью DHCP TCP/IP v4 конфигурации выполняется автоматически, когда компьютер или другие DHCP-клиент подключен к сети.

Можно развернуть DHCP-сервера в рабочую группу, как отдельный сервер или в составе домена Active Directory.

Это руководство содержит следующие разделы.

- [Общие сведения о развертывании DHCP](#bkmk_overview)
- [Обзор технологий](#bkmk_technologies)
- [Планирование развертывания DHCP](#bkmk_plan)
- [С помощью этого руководства в лаборатории тестирования](#bkmk_lab)
- [Развертывание DHCP](#bkmk_deploy)
- [Проверка работоспособности сервера](#bkmk_verify)
- [Команды Windows PowerShell для DHCP](#bkmk_dhcpwps)
- [Список команд Windows PowerShell в этом руководстве](#bkmk_list)

## <a name="bkmk_overview"></a>Общие сведения о развертывании DHCP

На рисунке ниже показаны сценарий, который можно развернуть с помощью этого руководства. Сценарий включает один DHCP-сервера в домене Active Directory. Сервер настроен для предоставления IP-адресов DHCP-клиентам в двух разных подсетях. Подсети разделяются маршрутизатор, который имеет пересылки DHCP включен.

![Общие сведения о топологии сети DHCP](../../media/Core-Network-Guide/cng16_overview.jpg)

## <a name="bkmk_technologies"></a>Обзор технологий

Ниже приведен краткий обзор DHCP и TCP/IP.

### <a name="dhcp-overview"></a>Обзор протокола DHCP

Протокол DHCP — это стандарт IP для упрощения управления IP-конфигурацией узлов. Стандарт DHCP предусматривает использование DHCP-серверов для управления динамическим выделением IP-адресов и других сопутствующих сведений о настройке DHCP-клиентов в сети.

Протокол DHCP позволяет использовать DHCP-сервера для динамического назначения IP-адрес компьютера или другого устройства, такие как принтер, в локальной сети, а не вручную настраивать все устройства с статический IP-адрес.

Каждый компьютер в сети TCP/IP должен иметь уникальный IP-адрес, IP-адрес и его с маской подсети однозначно определяет главный компьютер и подсеть, к которой подключен компьютер. С помощью DHCP, убедитесь, что все компьютеры, которые настроены как DHCP-клиенты получают IP-адрес, который подходит для данной подсети и сетевого расположения и параметры DHCP, как шлюз по умолчанию и DNS-серверов можно автоматически предоставлять DHCP-клиентов с помощью информации, необходимой для правильной работы в сети.

Для сетей на основе TCP/IP DHCP снижает сложность и количество административной работы, которая в настройке компьютеров.

### <a name="tcpip-overview"></a>Обзор TCP/IP

По умолчанию все версии ОС Windows Server и клиент Windows имеют параметры TCP/IP для IP версии 4 сетевых подключений, настроенных для автоматического получения IP-адрес и другие сведения, называемый параметры DHCP от DHCP-сервера. По этой причине не нужно вручную настраивать параметры TCP/IP, если компьютер не компьютере сервера или другого устройства, которое требуется вручную настроенных статический IP-адрес. 

Например рекомендуется вручную настроить IP-адрес DHCP-сервера и IP-адреса DNS-серверов и контроллеров домена, работающих под управлением \(AD DS\) доменных служб Active Directory.

TCP/IP в Windows Server 2016 выглядит следующим образом:

-   Сетевые программного обеспечения на основе стандартных сетевых протоколов.

-   Маршрутизируемый протокол корпоративных сетей, обеспечивающий подключение компьютера под управлением Windows к локальной сети (LAN) и сред глобальной сети (WAN).

-   Базовые технологии и служебные программы для соединения компьютеров под управлением Windows с разнородными системами для обмена данными.

-   Основа доступа к глобальным службам Интернета, таких как протокол передачи файлов (FTP) и веб-серверы.

-   Это платформа надежной, масштабируемая кроссплатформенная система клиент сервер.

TCP/IP обеспечивает основные служебные программы TCP/IP, которые позволяют компьютерам под управлением Windows для подключения и обмениваться сведениями с другими корпорации Майкрософт и сторонних систем, включая:

- В Windows Server 2016

- Windows 10

- Windows Server 2012 R2

- Windows 8.1

- Windows Server 2012

- Windows 8

- Windows Server 2008 R2

- Windows 7

- Windows Server 2008

- Windows Vista

- Узлы в Интернете

- Системы Apple Macintosh

- Мэйнфреймы IBM

- Системы UNIX и Linux

- Системы Open VMS

- Сетевые принтеры

- Планшеты и телефоны сотовой сети с проводной сети Ethernet и беспроводной сети стандарта 802.11 технологию

## <a name="bkmk_plan"></a>Планирование развертывания DHCP

Ниже приведены ключевые действия по планированию перед установкой роли DHCP-сервера.

### <a name="planning-dhcp-servers-and-dhcp-forwarding"></a>Планирование DHCP-серверов и пересылки DHCP

Поскольку сообщения DHCP являются широковещательными, не пересылают их между подсетями маршрутизаторами. Если имеется несколько подсетей и службу DHCP для каждой подсети требуется обеспечить, необходимо выполнить одно из следующих:

-   Установка DHCP-сервера в каждой подсети

-   Настройте маршрутизаторы на пересылку широковещательных сообщений DHCP между подсетями, а на DHCP-сервере, один на подсеть настройте несколько областей.

В большинстве случаев настройка маршрутизаторов на пересылку широковещательных сообщений DHCP является более экономически эффективным решением, чем развертывание DHCP-сервера на каждом из физических сегментов сети.

### <a name="planning-ip-address-ranges"></a>Планирование диапазонов IP-адресов

У каждой подсети должен быть собственный уникальный диапазон IP-адресов. Эти диапазоны представлены на DHCP-сервере с помощью областей.

Область представляет собой группировку IP-адреса для компьютеров подсети, которые используют службу DHCP администрирования. Администратор сначала создает область для каждой физической подсети, а затем использует ее для определения параметров клиентских компьютеров.

Область имеет следующие свойства:

-   Диапазон IP-адресов, из которого следует включить или исключить адресов, используемых в предложениях на выделение адреса службы DHCP.

-   Маска подсети, определяющая префикс подсети для конкретного IP-адреса.

-   Имя области, назначаемое при ее создании.

-   Сроки действия аренды адреса, которые назначаются DHCP-клиентам, получающим динамически выделяемые IP-адреса.

-   Любые параметры области DHCP, настроенные для назначения DHCP-клиентам, такие как IP-адрес сервера DNS и IP-адрес маршрутизатора или основного шлюза.

-   Зарезервированные адреса используются, при необходимости, чтобы гарантировать получение DHCP-клиентом одного IP-адреса.

Перед развертыванием серверов, создайте список подсетей и диапазонов IP-адрес, которые вы хотите использовать для каждой подсети.

### <a name="planning-subnet-masks"></a>Планирование масок подсетей

С помощью маски подсети различения идентификаторов сетей и узла в IP-адрес. Каждая маска подсети — 32-разрядное число, в котором последовательных единичных битов (1), идентифицирующего сеть, код и группа последовательных нулевых битов (0), для обозначения адреса узла IP-адреса.

Например с IP-адресом 131.107.16.200 обычно используется маска подсети является следующее 32-разрядное двоичное число:

```
11111111 11111111 00000000 00000000
```

Это число маски подсети — 16 единичных битов и 16 нулевых битов, указывающее, что сетевой идентификатор и узла идентификатор разделы этот IP-адрес обе длиной по 16 бит. Обычно маска подсети отображается как 255.255.0.0 в десятичной записи.

В следующей таблице показаны маски подсетей для классов адресов Интернета.

|Класс адреса|Количество битов для маски подсети|Маска подсети|
|-----------------|------------------------|---------------|
|Класса A|11111111 00000000 00000000 00000000|255.0.0.0|
|Класс B|11111111 11111111 00000000 00000000|255.255.0.0|
|Класс C|11111111 11111111 11111111 00000000|255.255.255.0|

При создании области в DHCP и вводе диапазона IP-адресов для области, служба DHCP обеспечивает эти значения масок подсетей по умолчанию. Обычно значения масок подсетей по умолчанию применимы для большинства сетей, не имеющих особых требований, а также там, где каждый сегмент IP-сети соответствует одной физической сети.

В некоторых случаях можно использовать специальные маски подсети для реализации IP-подсети. С помощью IP-подсети, можно разделить, по умолчанию часть узла IP-адрес подсети, которые являются подразделениями исходного идентификатора сети на основе класса.

Настройкой длины маски подсети можно уменьшить количество бит, необходимое для адреса узла.

Чтобы избежать проблем с адресацией и маршрутизацией, должны убедиться, что все компьютеры TCP/IP в сегменте сети, используют одинаковую маску подсети и что каждого устройства имеется уникальный IP-адрес.

### <a name="planning-exclusion-ranges"></a>Планирование диапазонов исключения

При создании области на DHCP-сервере, можно указать диапазон IP-адресов, включающий все адреса, которые разрешено арендовать DHCP-клиентам, такие как компьютерам и другим устройствам DHCP-сервера. Если перейти и вручную настроить несколько серверов и других устройств с статического IP-адреса из того же IP-адресов, используя DHCP-сервера, можно непреднамеренно создать конфликт IP-адресов, где вы и DHCP-сервер назначите же IP-адрес для различных устройств.

Чтобы решить эту проблему, можно создать диапазон исключения для области DHCP. Диапазон исключения является непрерывным диапазон IP-адресов внутри области диапазон IP-адресов DHCP-сервера не разрешено использовать. Если создать диапазон исключения DHCP-сервер не назначает адреса в диапазоне, что позволяет вручную назначать без создания конфликт IP-адресов.

IP-адреса можно исключить из распределения DHCP-сервером, путем создания диапазона исключения для каждой области. Исключения необходимо использовать для всех устройств, для которых настроены статические IP-адрес. Исключаемые адреса должны включать все IP-адреса, назначенные вручную на другие серверы, не DHCP-клиенты, бездисковым рабочим станциям или клиентам маршрутизации и удаленного доступа и PPP.

Рекомендуется настроить диапазона исключения дополнительные адреса, чтобы предусмотреть рост сети в будущем. В следующей таблице приведены диапазон исключения для области с диапазоном IP-адрес 10.0.0.1 - 10.0.0.254 и маской подсети 255.255.255.0.

|Элементы конфигурации|Примеры значений|
|-----------------------|------------------|
|Запустите IP-адрес диапазона исключения|10.0.0.1|
|Конечный IP-адрес диапазона исключения|10.0.0.25|

### <a name="planning-tcpip-static-configuration"></a>Планирование статической конфигурации TCP/IP

Некоторые устройства, например маршрутизаторы, серверы DHCP и DNS-серверы должны быть настроены статические IP-адрес. Кроме того возможно, и другим дополнительным устройствам, таким как принтеры, которые вы хотите обеспечить всегда же IP-адрес. Список устройств, которые необходимо настроить статически для каждой подсети, а затем запланируйте диапазон исключения, который вы хотите использовать на DHCP-сервере, чтобы убедиться, что DHCP-сервер не предоставляет в аренду IP-адрес статически настроенных устройств. Диапазон исключения — это ограниченная последовательность IP-адресов внутри области, исключаемых из числа DHCP службы. Диапазонов исключения не назначает адреса из этих диапазонов сервером DHCP-клиентам в сети.

Например если диапазон IP-адресов для подсети используется 192.168.0.1–192.168.0.254 и имеется десять устройств, которые вы хотите настроить статический IP-адрес, можно создать диапазон исключения для области 192.168.0. *x* область десятью и более IP-адресами: 192.168.0.1–192.168.0.15.

В этом примере десять из исключенные IP-адреса используется для настройки статических IP-адресов серверов и других устройств, а пять дополнительных IP-адресов оставлены про запас для статической настройки новых устройств, которые могут быть добавлены в будущем. С помощью этого диапазона исключения DHCP-сервера оставлен пул адресов 192.168.0.16 по 192.168.0.254.

Дополнительный пример элементов конфигурации для AD DS и DNS-сервера приведены в следующей таблице.

|Элементы конфигурации|Примеры значений|
|-----------------------|------------------|
|Привязки сетевых подключений|Ethernet|
|Параметры DNS-сервера|DC1.corp.contoso.com|
|IP-адрес предпочитаемого DNS server|10.0.0.2|
|Значения области<br /><br />1. имя области<br />2. начальный IP-адрес<br />3. Завершение IP-адрес<br />4. Маска подсети<br />5. шлюз по умолчанию (необязательно)<br />6. срок действия аренды адреса|1. основная подсеть<br />2.  10.0.0.1<br />3.  10.0.0.254<br />4.  255.255.255.0<br />5.  10.0.0.1<br />6. 8 дней|
|Режим работы DHCP-сервера IPv6|Не включен|

## <a name="bkmk_lab"></a>С помощью этого руководства в лаборатории тестирования

В этом руководстве можно использовать для развертывания DHCP в лаборатории тестирования перед развертыванием в рабочей среде. 

>[!NOTE]
>Если вы не хотите развернуть DHCP в лаборатории тестирования, можно перейти к разделу [развертывание DHCP](#bkmk_deploy).

Требования для лаборатории отличаются в зависимости от того, используется ли физических серверах или виртуальных машин \(VMs\) и ли вы используете домена Active Directory или развертывания автономного сервера DHCP. 

Чтобы определить минимальный набор ресурсов, необходимо проверить DHCP развертывания с помощью этого руководства можно использовать следующие сведения.

### <a name="test-lab-requirements-with-vms"></a>Требования к лаборатории тестирования с использованием виртуальных машин

Чтобы развернуть DHCP в лаборатории тестирования с использованием виртуальных машин, необходимо следующие ресурсы.

Для развертывания домена или изолированного развертывания необходимо один сервер, настроенный в качестве узла Hyper\-V.

**Развертывания домена**

Это развертывание требует одного физического сервера, для одного виртуального коммутатора, два виртуальных серверов и одного виртуального клиента:

На вашем физическом сервере в диспетчере Hyper-V, создайте следующие элементы.

1. Один **внутренняя** виртуального коммутатора. Не создавайте **внешних** виртуального переключения, так как если на узле Hyper\-V в подсети, которая включает в себя DHCP-сервера, тестовой ВМ получают IP-адрес от DHCP-сервера. Кроме того DHCP-сервера тестирования развертывания может назначить IP-адреса других компьютеров в подсети, установленной на узле Hyper\-V.
1. Одной виртуальной Машине под управлением Windows Server проблема настроен в качестве контроллера домена с доменными службами Active Directory, который подключен к внутреннему виртуальному коммутатору, который вы создали. Для нахождения в этом руководстве, этот сервер должен иметь статически настроенный IP-адрес 10.0.0.2. Сведения о развертывании AD DS см. раздел **развертывание DC1** в Windows Server 2016 [руководство по основной сети](https://technet.microsoft.com/windows-server-docs/networking/core-network-guide/core-network-guide#BKMK_deployADDNS01).
1. Одной виртуальной Машине под управлением Windows Server проблема, настроенным как DHCP-сервер с помощью этого руководства и подключен к внутренний виртуальный коммутатор создан. 
1. Одна виртуальная машина под управлением клиентской операционной системы Windows, подключенный виртуальный внутренняя переключение был создан, и будет использовать для проверки того, что DHCP-сервера является динамического выделения IP-адресов и параметрами DHCP, DHCP-клиентам.

**Развертывание DHCP изолированного сервера**

Это развертывание требует одного физического сервера, для одного виртуального коммутатора, одного виртуального сервера и один виртуальный клиента:

На вашем физическом сервере в диспетчере Hyper-V, создайте следующие элементы.

1. Один **внутренняя** виртуального коммутатора. Не создавайте **внешних** виртуального переключения, так как если на узле Hyper\-V в подсети, которая включает в себя DHCP-сервера, тестовой ВМ получают IP-адрес от DHCP-сервера. Кроме того DHCP-сервера тестирования развертывания может назначить IP-адреса других компьютеров в подсети, установленной на узле Hyper\-V.
1. Одной виртуальной Машине под управлением Windows Server проблема, настроенным как DHCP-сервер с помощью этого руководства и подключен к внутренний виртуальный коммутатор создан.
1. Одна виртуальная машина под управлением клиентской операционной системы Windows, подключенный виртуальный внутренняя переключение был создан, и будет использовать для проверки того, что DHCP-сервера является динамического выделения IP-адресов и параметрами DHCP, DHCP-клиентам.

### <a name="test-lab-requirements-with-physical-servers"></a>Требования к лаборатории тестирования с физических серверов

Для развертывания DHCP в лаборатории тестирования с физических серверов, вам потребуются следующие ресурсы.

**Развертывания домена**

Это развертывание требует одного концентратора или коммутатора, два физических сервера и один физический клиентский:

1. Один концентратор или коммутатор к которому можно подключаться физические компьютеры с помощью кабелей Ethernet
1. Один физический компьютер под управлением Windows Server проблема настроен в качестве контроллера домена с доменными службами Active Directory. Для нахождения в этом руководстве, этот сервер должен иметь статически настроенный IP-адрес 10.0.0.2. Сведения о развертывании AD DS см. раздел **развертывание DC1** в Windows Server 2016 [руководство по основной сети](https://technet.microsoft.com/windows-server-docs/networking/core-network-guide/core-network-guide#BKMK_deployADDNS01).
1. Один физический компьютер под управлением Windows Server проблема, который вы настроите DHCP-сервера с помощью этого руководства. 
1. Одном физическом компьютере под управлением операционной системы клиента Windows, который будет использоваться, чтобы убедиться, что DHCP-сервером динамического выделения IP-адресов и параметров DHCP DHCP-клиентам.

>[!NOTE]
>Если у вас недостаточно тестовых компьютеров, для этого развертывания, можно использовать один тестовый компьютер для AD DS и DHCP -, однако такая конфигурация не рекомендуется для рабочей среды.

**Развертывание DHCP изолированного сервера**

Это развертывание требует одного концентратора или коммутатора, одного физического сервера и один физический клиентский:

1. Один концентратор или коммутатор к которому можно подключаться физические компьютеры с помощью кабелей Ethernet
2. Один физический компьютер под управлением Windows Server проблема, который вы настроите DHCP-сервера с помощью этого руководства. 
3. Одном физическом компьютере под управлением операционной системы клиента Windows, который будет использоваться, чтобы убедиться, что DHCP-сервером динамического выделения IP-адресов и параметров DHCP DHCP-клиентам.


## <a name="bkmk_deploy"></a>Развертывание DHCP

Этот раздел содержит примеры команд Windows PowerShell, которые можно использовать для развертывания DHCP на одном сервере. Перед выполнением этих примерах команд на сервере необходимо изменить команды в соответствии с вашей сети и среды. 

Например прежде чем выполнять команды, необходимо заменить примеры значений в командах для следующих элементов:

- Имена компьютеров
- Диапазон IP-адресов для каждой области, которую требуется настроить (1 область каждой подсети)
- Маска подсети для каждого диапазона IP-адресов, которые вы хотите настроить
- Имя области для каждой области.
- Диапазон исключения для каждой области.
- Значения параметров DHCP, такие как шлюз по умолчанию и имя домена, DNS или WINS-серверы
- Имена интерфейсов

>[!IMPORTANT]
>Проверьте и измените все команды для вашей среды перед выполнением команды.

### <a name="where-to-install-dhcp---on-a-physical-computer-or-a-vm"></a>Где Установка DHCP - на физическом компьютере или виртуальной Машины?

Роль DHCP-сервера можно установить на физическом компьютере или на виртуальной машине \(VM\), установленной на узле Hyper\-V. Если вы устанавливаете на виртуальной Машине DHCP и DHCP-сервер для предоставления назначения IP-адресов для компьютеров в физической сети, к которому подключен узла Hyper-V, необходимо подключить виртуальный сетевой адаптер виртуальной Машины для виртуального коммутатора Hyper-V, который является **внешних**.

Дополнительные сведения см. раздел **Создание виртуального коммутатора с помощью диспетчера Hyper-V** раздела [Создание виртуальной сети](https://docs.microsoft.com/virtualization/hyper-v-on-windows/quick-start/connect-to-network).

### <a name="run-windows-powershell-as-an-administrator"></a>Запустите Windows PowerShell от имени администратора

Можно использовать следующую процедуру для запуска Windows PowerShell с правами администратора.

1. На компьютере под управлением Windows Server 2016, щелкните **запустить**, щелкните правой кнопкой мыши значок Windows PowerShell. Появляется меню. 

2. В меню выберите команду **дополнительные**, а затем нажмите кнопку **Запуск от имени администратора**. Если появится соответствующий запрос, введите учетные данные для учетной записи с правами администратора на компьютере. Если учетной записи пользователя, с которой вы вошли на компьютер уровня учетной записи администратора, вы не получите запрос учетных данных.

3. Windows PowerShell открывается с правами администратора.

### <a name="rename-the-dhcp-server-and-configure-a-static-ip-address"></a>Переименование сервера DHCP и настроить статический IP-адрес

Если вы еще не сделано, следующие команды Windows PowerShell можно использовать для переименования DHCP-сервер и настроить статический IP-адрес для сервера.

**Настройка статического IP-адреса**

Чтобы назначить статический IP-адрес DHCP-сервера и настройки TCP/IP свойств DHCP-сервера с правильный IP-адрес сервера DNS-сервера, можно использовать следующие команды. Также необходимо переименовать интерфейсы и IP-адреса в этом примере со значениями, которые вы хотите использовать для настройки компьютера.

 `New-NetIPAddress -IPAddress 10.0.0.3 -InterfaceAlias "Ethernet" -DefaultGateway 10.0.0.1 -AddressFamily IPv4 -PrefixLength 24`

 `Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 10.0.0.2`

Дополнительные сведения об этих командах см. в следующих разделах.

- [New-NetIPAddress](https://technet.microsoft.com/itpro/powershell/windows/tcpip/new-netipaddress)
- [Set-DnsClientServerAddress](https://technet.microsoft.com/itpro/powershell/windows/dns-client/set-dnsclientserveraddress)

**Переименование компьютера**

Следующие команды можно использовать для переименования и перезагрузите компьютер.

`Rename-Computer -Name DHCP1`

 `Restart-Computer`

Дополнительные сведения об этих командах см. в следующих разделах.

- [Rename-Computer](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.management/rename-computer)
- [Restart-Computer](https://msdn.microsoft.com/powershell/reference/4.0/microsoft.powershell.management/restart-computer)

### <a name="join-the-computer-to-the-domain-optional"></a>Присоедините компьютер к домену \(Optional\)

При установке DHCP-сервера в среде домена Active Directory, необходимо присоединить компьютер к домену. Откройте Windows PowerShell с правами администратора, а затем выполните следующую команду, после замены NetBIOS-имя домена **CORP** со значением, которое подходит для вашей среды.

    Add-Computer CORP

При запросе пароля введите учетные данные для учетной записи пользователя домена, имеющую разрешение на присоединение компьютера к домену. 

    Restart-Computer

Дополнительные сведения о команде Add-Computer см. в статье.

- [Add-Computer](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.management/add-computer)

### <a name="install-dhcp"></a>Установка протокола DHCP

После перезагрузки компьютера, откройте Windows PowerShell с правами администратора и затем установить службу DHCP, выполнив следующую команду.

    Install-WindowsFeature DHCP -IncludeManagementTools

Дополнительные сведения об этой команде см. в статье.

- [Install-WindowsFeature](https://technet.microsoft.com/itpro/powershell/windows/server-manager/install-windowsfeature)

### <a name="create-dhcp-security-groups"></a>Создание групп безопасности DHCP

Создание групп безопасности, необходимо запустить \(netsh\) команды сетевой оболочки в Windows PowerShell и затем перезапустить службу DHCP, чтобы новые группы становятся активными.

При выполнении следующей команды netsh на DHCP-сервере **Администраторы DHCP** и **Пользователи DHCP** создаются группы безопасности в **локальных пользователей и групп** на DHCP-сервере.

    netsh dhcp add securitygroups

Приведенная ниже команда перезапускает службу DHCP на локальном компьютере.

    Restart-service dhcpserver

Дополнительные сведения об этих командах см. в следующих разделах.

- [Сетевой оболочки (Netsh)](../netsh/netsh.md)
- [Restart-Service](https://msdn.microsoft.com/powershell/reference/5.1/microsoft.powershell.management/restart-service)

### <a name="authorize-the-dhcp-server-in-active-directory-optional"></a>Авторизации DHCP-сервера в Active Directory \(Optional\)

Если вы устанавливаете DHCP в среде домена, необходимо выполнить следующие действия, чтобы авторизовать DHCP-сервер для работы в домене.

>[!NOTE]
>Неавторизованных DHCP-серверов, установленных в доменах Active Directory не может работать неправильно и не предоставляет в аренду IP-адресов DHCP-клиентам. Отключение автоматического неавторизованных DHCP-серверов является функция безопасности, которая предотвращает назначение неправильные IP-адреса клиентам в сети неавторизованных DHCP-серверов.

Чтобы добавить DHCP-сервер в список авторизованных DHCP-серверов в Active Directory, можно использовать следующую команду. 

>[!NOTE]
>Если у вас в среде домена, не запускайте этой команды.

 `Add-DhcpServerInDC -DnsName DHCP1.corp.contoso.com -IPAddress 10.0.0.3`

Чтобы убедиться, что DHCP-сервер авторизован в Active Directory, можно использовать следующую команду.

    Get-DhcpServerInDC

Ниже приведены примеры результатов, отображаемых в Windows PowerShell.

    
        IPAddress   DnsName
        ---------   -------
        10.0.0.3    DHCP1.corp.contoso.com
    

Дополнительные сведения об этих командах см. в следующих разделах.

- [Add-DhcpServerInDC](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/add-dhcpserverindc)
- [Get-DhcpServerInDC](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/get-dhcpserverindc)

### <a name="notify-server-manager-that-post-install-dhcp-configuration-is-complete-optional"></a>Конфигурация — полный \(Optional\) извещать диспетчера сервера, post\ Установка DHCP

После завершения установки post\ задач, таких как создание групп безопасности и авторизация DHCP-сервера в Active Directory, диспетчер серверов может отображаться в пользовательском интерфейсе, о том, что установка post\ действия должны выполняться с помощью мастера установки после DHCP настройки оповещение.

Это сообщение now\ ненужные и неточные можно предотвратить появление в диспетчере сервера, настроив следующие разделы реестра с помощью следующей команды Windows PowerShell.

    Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2

Дополнительные сведения об этой команде см. в статье.

- [Set-ItemProperty](https://msdn.microsoft.com/powershell/reference/4.0/microsoft.powershell.management/set-itemproperty?f=255&MSPPError=-2147217396)

### <a name="set-server-level-dns-dynamic-update-configuration-settings-optional"></a>Задайте параметры \(Optional\) сервера уровня DNS динамическое обновление конфигурации

Если требуется DHCP-сервера для выполнения динамического обновления DNS для клиентов DHCP, можно выполнить следующую команду, чтобы настроить этот параметр. Это уровень сервера, параметра, не область уровня освещенности, поэтому они влияют на все области, настроенных на сервере. В этом примере команда также настраивает DHCP-сервера для удаления записей ресурсов DNS для клиентов по истечении клиент бы.

    Set-DhcpServerv4DnsSetting -ComputerName "DHCP1.corp.contoso.com" -DynamicUpdates "Always" -DeleteDnsRRonLeaseExpiry $True

Можно использовать следующую команду для настройки учетных данных, которые DHCP-сервера использует для регистрации или отмены регистрации записей клиентов на DNS-сервер. В этом примере сохранение учетных данных на DHCP-сервере. Первая команда использует **Get-Credential** для создания **PSCredential** объекта, а затем сохраняет объект в **$Credential** переменной. Команда запрашивает имя пользователя и пароль, поэтому убедитесь предоставить учетные данные для учетной записи, имеющей разрешение на обновление записей ресурсов на DNS-сервера.

    
    $Credential = Get-Credential
    Set-DhcpServerDnsCredential -Credential $Credential -ComputerName "DHCP1.corp.contoso.com"
    

Дополнительные сведения об этих командах см. в следующих разделах.

- [SET-DhcpServerv4DnsSetting](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/set-dhcpserverv4dnssetting)
- [Set-DhcpServerDnsCredential](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/set-dhcpserverdnscredential)

### <a name="configure-the-corpnet-scope"></a>Настройка области корпоративной сети

После завершения установки DHCP можно использовать следующие команды для настройки и активировать область корпоративной сети, создать диапазон исключения для области и настроить шлюз по умолчанию параметры DHCP, IP-адрес сервера DNS и DNS-имя домена.

    
    Add-DhcpServerv4Scope -name "Corpnet" -StartRange 10.0.0.1 -EndRange 10.0.0.254 -SubnetMask 255.255.255.0 -State Active`
    
    Add-DhcpServerv4ExclusionRange -ScopeID 10.0.0.0 -StartRange 10.0.0.1 -EndRange 10.0.0.15`
    
    Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.0.1 -ScopeID 10.0.0.0 -ComputerName DHCP1.corp.contoso.com`
    
    Set-DhcpServerv4OptionValue -DnsDomain corp.contoso.com -DnsServer 10.0.0.2
    

Дополнительные сведения об этих командах см. в следующих разделах.

- [Добавить DhcpServerv4Scope](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/add-dhcpserverv4scope)
- [Добавить DhcpServerv4ExclusionRange](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/add-dhcpserverv4exclusionrange)
- [SET-DhcpServerv4OptionValue](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/set-dhcpserverv4optionvalue)

### <a name="configure-the-corpnet2-scope-optional"></a>Настройка Corpnet2 область \(Optional\)

Если у вас есть вторая подсети, подключенном к первой подсети с маршрутизатором, где включена пересылка пакетов DHCP, можно использовать следующие команды для добавления второй области, с именем Corpnet2 в этом примере. В этом примере настраивается диапазон исключения и IP-адрес шлюза по умолчанию \ (IP-адрес маршрутизатора на subnet\) Corpnet2 подсети.

 `Add-DhcpServerv4Scope -name "Corpnet2" -StartRange 10.0.1.1 -EndRange 10.0.1.254 -SubnetMask 255.255.255.0 -State Active`

 `Add-DhcpServerv4ExclusionRange -ScopeID 10.0.1.0 -StartRange 10.0.1.1 -EndRange 10.0.1.15`

 `Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.1.1 -ScopeID 10.0.1.0 -ComputerName DHCP1.corp.contoso.com`

При наличии дополнительных подсетей, которые обслуживаются DHCP-сервером, вы можете повторить эти команды с использованием различных значений для всех параметров команды для добавления областей для каждой подсети.

>[!IMPORTANT]
>Убедитесь, что все маршрутизаторы между DHCP-клиентов и DHCP-сервера настроены на пересылку сообщений DHCP. Обратитесь к документации маршрутизатора сведения о настройке пересылки пакетов DHCP.

## <a name="bkmk_verify"></a>Проверка работоспособности сервера

Чтобы убедиться, что сервер DHCP предоставляет динамическим выделением IP-адресов DHCP-клиентам, обслуживаемых подсети подключаются другого компьютера. После подключения Ethernet-кабеля сетевой адаптер и питания на компьютере, он запрашивает IP-адрес от DHCP-сервера. Можно проверить успешной настройки с помощью **ipconfig/all** команды и просмотр результатов или выполняя проверку возможности подключения, такие как попытки доступа к веб-ресурсы с вашего браузера или общих файловых ресурсов в проводнике Windows или других приложений.

Если клиент не получает IP-адрес от DHCP-сервера, выполните следующие действия.

1. Убедитесь, что кабель Ethernet вставлен в оба компьютера и Ethernet коммутатора, концентратор или маршрутизатор.
1. При подключении клиентского компьютера в сегменте сети, отделена от DHCP-сервера маршрутизатором, убедитесь, что маршрутизатор настроен на пересылку сообщений DHCP.
1. Убедитесь, что DHCP-сервер авторизован в Active Directory, выполнив следующую команду, чтобы получить список авторизованных DHCP-серверов из Active Directory. [Get-DhcpServerInDC](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/get-dhcpserverindc).
1. Убедитесь, что областей активированы, открыв консоль DHCP \ (диспетчер сервера **средства**, **DHCP**\), развернув дерево сервера для просмотра области, а затем щелкнув правой кнопкой мыши каждой области. Если в появившемся меню включает выбор **активировать**, нажмите кнопку **активировать**. \ (Если область уже активирован, выбор в меню считывает **деактивировать**. \) 

## <a name="bkmk_dhcpwps"></a>Команды Windows PowerShell для DHCP

Описание команды и синтаксис для всех команд Windows PowerShell для DHCP Server предоставляет следующую ссылку для Windows Server 2016. Этой статье перечисляются команд в алфавитном порядке по команде в начале команд, таких как **получить** или **задать**.

>[!NOTE]
>Невозможно использовать команды Windows Server 2016 в Windows Server 2012 R2.

- [Модуля DhcpServer](https://technet.microsoft.com/itpro/powershell/windows/dhcp-server/index)

Описание команды и синтаксис для всех команд Windows PowerShell для DHCP Server предоставляет следующую ссылку для Windows Server 2012 R2. Этой статье перечисляются команд в алфавитном порядке по команде в начале команд, таких как **получить** или **задать**.

>[!NOTE]
>В Windows Server 2016, можно использовать команды Windows Server 2012 R2.

- [Командлеты DHCP-сервера в Windows PowerShell](https://technet.microsoft.com/library/jj590751.aspx)

## <a name="bkmk_list"></a>Список команд Windows PowerShell в этом руководстве

Ниже приведен список команд и примеры значений, используемых в этом руководстве.

    
    New-NetIPAddress -IPAddress 10.0.0.3 -InterfaceAlias "Ethernet" -DefaultGateway 10.0.0.1 -AddressFamily IPv4 -PrefixLength 24
    Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 10.0.0.2
    Rename-Computer -Name DHCP1
    Restart-Computer
    
    Add-Computer CORP
    Restart-Computer
    
    Install-WindowsFeature DHCP -IncludeManagementTools
    netsh dhcp add securitygroups
    Restart-service dhcpserver
    
    Add-DhcpServerInDC -DnsName DHCP1.corp.contoso.com -IPAddress 10.0.0.3
    Get-DhcpServerInDC
    
    Set-ItemProperty –Path registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\ServerManager\Roles\12 –Name ConfigurationState –Value 2
    
    Set-DhcpServerv4DnsSetting -ComputerName "DHCP1.corp.contoso.com" -DynamicUpdates "Always" -DeleteDnsRRonLeaseExpiry $True
    
    $Credential = Get-Credential
    Set-DhcpServerDnsCredential -Credential $Credential -ComputerName "DHCP1.corp.contoso.com"
    
    rem At prompt, supply credential in form DOMAIN\user, password
    
    
    rem Configure scope Corpnet
    
    Add-DhcpServerv4Scope -name "Corpnet" -StartRange 10.0.0.1 -EndRange 10.0.0.254 -SubnetMask 255.255.255.0 -State Active
    
    Add-DhcpServerv4ExclusionRange -ScopeID 10.0.0.0 -StartRange 10.0.0.1 -EndRange 10.0.0.15
    
    Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.0.1 -ScopeID 10.0.0.0 -ComputerName DHCP1.corp.contoso.com
    
    Set-DhcpServerv4OptionValue -DnsDomain corp.contoso.com -DnsServer 10.0.0.2
    
    rem Configure scope Corpnet2
    
    Add-DhcpServerv4Scope -name "Corpnet2" -StartRange 10.0.1.1 -EndRange 10.0.1.254 -SubnetMask 255.255.255.0 -State Active
    
    Add-DhcpServerv4ExclusionRange -ScopeID 10.0.1.0 -StartRange 10.0.1.1 -EndRange 10.0.1.15
    
    Set-DhcpServerv4OptionValue -OptionID 3 -Value 10.0.1.1 -ScopeID 10.0.1.0 -ComputerName DHCP1.corp.contoso.com
    


