---
title: Планирование сервера политики сети в качестве RADIUS-сервера
description: В этом разделе сведения о развертывании сервера RADIUS сервера политики сети, планирование в Windows Server 2016.
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5fd89ef8d95735b8cbe1334ba51ed0059595dbc3
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839175"
---
# <a name="plan-nps-as-a-radius-server"></a>Планирование сервера политики сети в качестве RADIUS-сервера

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

При развертывании сервера политики сети \(NPS\) как сервер службы проверки подлинности удаленного пользователя (RADIUS), он выполняет проверку подлинности, авторизации и учета для запросов на подключение для локального домена и доменов доверяющих локального домена. Эти правила планирования можно использовать для упрощения развертывания RADIUS.

Эти рекомендации по планированию, не включайте обстоятельства, в которых вы хотите развернуть сервер политики сети как RADIUS-прокси. При развертывании сервера политики сети как RADIUS-прокси, сервер политики сети перенаправляет запросы на подключение к серверу под управлением NPS или другие серверы RADIUS в удаленных доменов и недоверенных доменах. 

Перед развертыванием сервера политики сети как RADIUS-сервер в сети, следуйте приведенным ниже рекомендациям при планировании развертывания.

- Планирование конфигурации сервера политики сети.

- Планирование клиентов RADIUS.

- Планирование использования методов проверки подлинности.

- Планирование политик сети.

- Планирование учета NPS.

## <a name="plan-nps-configuration"></a>Планирование конфигурации сервера политики сети

Необходимо решить, какой домен, членом является сервером политики сети. Для сред с несколькими доменами сервер политики сети может проверить подлинность учетных данных для учетных записей пользователей, в который он входит в домен, а также для всех доменов, которые доверяют в локальном домене сервером политики сети. Чтобы разрешить NPS на чтение свойств удаленного доступа учетных записей пользователей в процессе авторизации, необходимо добавить учетную запись компьютера сервера политики сети на RAS и NPSs группу для каждого домена.

После определения членства в домене сервера политики сети, сервер должен быть настроен для взаимодействия с клиентами RADIUS, также называется серверы сетевого доступа, с использованием протокола RADIUS. Кроме того можно настроить типы событий, записываемых NPS в событии журнала и для ввода описания для сервера.

### <a name="key-steps"></a>Основные шаги

При планировании конфигурации сервера политики сети, можно использовать следующие действия.

- Определите RADIUS-порты, используемые сервером политики сети для получения сообщения RADIUS от клиентов RADIUS. По умолчанию это порт UDP-порты 1812 и 1645 для сообщений проверки подлинности RADIUS и порты 1813 и 1646 для сообщений учета RADIUS.

- Если сервер политики сети настроен с несколькими сетевыми адаптерами, определите адаптеры, через которых требуется RADIUS-трафика разрешается.

- Определите типы событий, которые следует NPS для записи в журнале событий. Вы можете войти, отклоненные проверки подлинности запросов, успешной проверки подлинности или оба типа запросов.

- Определите, производится развертывание более одного сервера политики сети. Чтобы обеспечить устойчивость к сбоям проверки подлинности на основе RADIUS и учет, используйте по крайней мере два NPSs. Один сервер политики сети используется в качестве основного сервера RADIUS, а другой используется в качестве резервной копии. Затем каждый клиент RADIUS настроен на обоих NPSs. Если основной сервер политики сети становится недоступным, RADIUS-клиенты отправить сообщения запроса доступа на альтернативный сервер политики сети.

- Планирование скрипт, используемый для копирования одной конфигурации NPS в других NPSs для сохранения на административную нагрузку и чтобы предотвратить неправильное конфигурация сервера. Сервер политики сети обеспечивает команды Netsh, позволяющие копировать полностью или частично конфигурации NPS для импорта на другой сервер политики сети. Можно вручную выполните команды в командной строке Netsh. Однако при сохранении вашего последовательность команд, как сценарий, можно запустить скрипт в дальнейшем Если решено изменить конфигурации серверов.

## <a name="plan-radius-clients"></a>Планирование клиентов RADIUS

Клиенты RADIUS — это серверы сетевого доступа, такие как точки беспроводного доступа, серверы виртуальной частной сети (VPN), 802.1 X с поддержкой коммутаторы и серверы удаленного доступа. RADIUS-прокси, которые пересылают сообщения запроса RADIUS-сервера для подключения, также являются клиентами RADIUS. Сервер политики сети поддерживает все серверы доступа к сети и RADIUS-прокси, которые соответствуют РАДИУС протокола, как описано в RFC 2865, «Удаленной проверки подлинности службой удаленного доступа пользователя (RADIUS),» и RFC 2866 «Бухгалтерский учет RADIUS».

>[!IMPORTANT]
>Доступ клиентов, таких как клиентские компьютеры, не являются клиентами RADIUS. Только серверы доступа к сети и прокси-серверы, которые поддерживают протокол RADIUS являются клиентами RADIUS.

Кроме того точки беспроводного доступа и коммутаторы должны быть поддерживает проверку подлинности 802.1 X. Если вы хотите развернуть расширяемого протокола проверки подлинности \(EAP\) или защищенный наращиваемый протокол аутентификации \(PEAP\), точек доступа и коммутаторы должны поддерживать использование протокола EAP.

Для тестирования базового взаимодействия для подключений PPP для точек беспроводного доступа, настройте точку доступа и доступа клиента для использования протокола проверки подлинности пароль (PAP). Используйте дополнительную проверку подлинности на основе PPP протоколы, такие как PEAP, пока не будут выявлены те, которые вы планируете использовать для доступа к сети.

### <a name="key-steps"></a>Основные шаги

В ходе планирования RADIUS-клиенты, можно использовать следующие действия.

- Задокументируйте атрибутов конкретных поставщиков (VSA), необходимо настроить на сервере политики сети. Если серверы доступа к сети требуется VSA, VSA записывает сведения в журнал для последующего использования при настройке политики в сети на сервере политики сети. 

- Задокументируйте IP-адреса клиентов RADIUS и ваш сервер политики сети, для упрощения конфигурации всех устройств. Когда вы развертываете клиенты RADIUS, необходимо настроить их для использования протокола RADIUS, сервер политики сети IP-адресом, вводится как сервер проверки подлинности. И при настройке сервера политики сети для взаимодействия с клиентами RADIUS, необходимо ввести IP-адреса клиента RADIUS в оснастке NPS.

- Создайте общие секреты для конфигурации на клиентских компьютерах, RADIUS и в оснастке NPS. Общий секретный ключ или пароль, который потребуется в оснастке NPS при настройке RADIUS-клиенты на сервере политики сети необходимо настроить RADIUS-клиенты.

## <a name="plan-the-use-of-authentication-methods"></a>Планирование использования методов проверки подлинности

Сервер политики сети поддерживает оба метода проверки подлинности с использованием пароля и на основе сертификатов. Однако не все серверы доступа к сети поддерживают те же методы проверки подлинности. В некоторых случаях может потребоваться развернуть другой метод проверки подлинности на основе типа доступа к сети.

Например может потребоваться развернуть беспроводных и VPN-доступ для вашей организации, но использовать другой метод проверки подлинности для каждого типа доступа: EAP-TLS для VPN-подключения, из-за надежную защиту, которую предоставляет EAP с помощью протокола TLS (EAP-TLS) и PEAP-MS-CHAP v2 для беспроводных подключений 802.1 X.

Переподключение PEAP с Майкрософт протокола CHAP версии 2 (PEAP-MS-CHAP v2) предоставляет функцию с именем fast, в который разработан специально для использования с портативных компьютеров и других беспроводных устройств. Быстрое переподключение позволяет беспроводным клиентам перемещаться между точками беспроводного доступа в той же сети, без повторной проверки подлинности каждый раз, когда они связываются с новой точкой доступа. Это обеспечивает удобство работы для пользователей беспроводных сетей и позволяет перемещаться между точками доступа без необходимости повторного ввода своих учетных данных.
Из-за fast повторного подключения и безопасности, предоставляющий PEAP-MS-CHAP v2, PEAP-MS-CHAP v2 является логичным выбором для проверки подлинности для беспроводных подключений.

Для VPN-подключений EAP-TLS — это метод проверки подлинности на основе сертификата, который обеспечивает высокую степень безопасности, который защищает сетевой трафик, даже во время передачи через Интернет из дома и в мобильных компьютеров для VPN-серверов организации.

### <a name="certificate-based-authentication-methods"></a>Методы проверки подлинности на основе сертификатов

Методы проверки подлинности на основе сертификатов имеют преимущество гарантирует высокую безопасность; и у них есть недостаток, сложнее для развертывания, чем методы проверки подлинности на основе пароля.

PEAP-MS-CHAP v2 и EAP-TLS являются методы проверки подлинности на основе сертификатов, но есть много различий между ними и способов, в котором они развернуты.

### <a name="eap-tls"></a>Протокол EAP-TLS

EAP-TLS использует сертификаты для проверки подлинности сервера и клиента и необходимо развернуть инфраструктуры открытых ключей (PKI) в вашей организации. Развертывание PKI может быть сложным и требует этап планирования, который является независимым от планирования для использования сервера политики сети как RADIUS-сервер.

С помощью EAP-TLS, сервер политики сети регистрирует сертификат сервера из центра сертификации \(ЦС\), и сертификат сохраняется в хранилище сертификатов локального компьютера. Во время процесса проверки подлинности проверки подлинности сервера происходит, когда сервер политики сети отправляет свой сертификат сервера для этого клиента, чтобы доказать свою подлинность клиенту доступ. Клиент проверяет различные свойства сертификата, чтобы определить допустимый сертификат и подходит для использования во время проверки подлинности сервера. Если сертификат сервера соответствует минимальным требованиям и выдается центром сертификации, которому доверяет клиент, сервер политики сети успешно проверена клиентом.

Аналогичным образом проверки подлинности клиента происходит во время проверки подлинности, когда клиент отправляет свой сертификат клиента на сервер политики сети, чтобы доказать свою подлинность в NPS. Сервер NPS проверяет сертификат, и если сертификат клиента требованиям к сертификатам минимальное клиента и выдается центром сертификации, которому доверяет сервер политики сети, клиент доступа прошел сервером политики сети.

Несмотря на то, что это обязательно, что сертификат хранится в хранилище сертификатов на сервере политики сети, сертификат клиента или пользователя могут храниться в хранилище сертификатов на клиентском компьютере или на смарт-карты.

Для успешного завершения этого процесса проверки подлинности это необходимо наличие центра сертификации вашей организации в хранилище сертификатов доверенных корневых центров сертификации для локального компьютера и текущего пользователя.

### <a name="peap-ms-chap-v2"></a>PEAP-MS-CHAP v2

PEAP-MS-CHAP v2 использует сертификат для проверки подлинности сервера и учетные данные для проверки подлинности пользователя на основе пароля. Так как сертификаты используются только для проверки подлинности сервера, вам не требуются для развертывания PKI для использования протокола PEAP-MS-CHAP v2. При развертывании PEAP-MS-CHAP v2, можно получить сертификат сервера для сервера политики сети в одном из следующих двух способов:

- Можно установить службы сертификатов Active Directory (AD CS), а затем сертификаты авторегистрации для NPSs. При использовании этого метода, необходимо также зарегистрировать сертификат ЦС для клиентских компьютеров, подключающихся к сети, таким образом, чтобы они доверяют сертификат, выданный сервером политики сети.

- Вы можете приобрести сертификат сервера из общедоступного центра сертификации, например VeriSign. Если вы используете этот метод, убедитесь, что выбрать ЦС, который уже является доверенным для клиентских компьютеров. Чтобы определить, является ли клиентские компьютеры доверяют ЦС, откройте оснастку сертификатов консоли управления (MMC) на клиентском компьютере и затем просматривать в хранилище доверенных корневых центров сертификации для локального компьютера, а также для текущего пользователя. При наличии сертификата из ЦС в этих хранилищах сертификатов, клиентский компьютер доверяет ЦС и поэтому будет доверять любой сертификат, выданный центром сертификации.

Во время процесса проверки подлинности с помощью протокола PEAP-MS-CHAP v2 проверки подлинности сервера происходит, когда сервер политики сети отправляет свой сертификат сервера на клиентский компьютер. Клиент проверяет различные свойства сертификата, чтобы определить допустимый сертификат и подходит для использования во время проверки подлинности сервера. Если сертификат сервера соответствует минимальным требованиям и выдается центром сертификации, которому доверяет клиент, сервер политики сети успешно проверена клиентом.

Проверка подлинности пользователя происходит, когда пользователь пытается подключиться к сети типы паролю учетные данные и пытается войти в систему. Сервер политики сети получает учетные данные и выполняет проверку подлинности и авторизации. Если пользователь прошел проверку подлинности и авторизация успешно выполнена, и клиентский компьютер успешно прошел проверку подлинности сервером политики сети, запрос на подключение предоставляется.

### <a name="key-steps"></a>Основные шаги

В ходе планирования использования методов проверки подлинности, можно использовать следующие действия.

- Определение типов сетевого доступа, вы планируете предоставляют, таких как беспроводных сетей, VPN, 802.1 X с поддержкой коммутатора и удаленного доступа.

- Определите, метода проверки подлинности или методы, которые вы хотите использовать для каждого типа доступа. Рекомендуется использовать методы проверки подлинности на основе сертификатов, которые обеспечивают надежную защиту; Тем не менее он может оказаться нецелесообразным для развертывания PKI, поэтому другие методы проверки подлинности может дать лучшего баланса, чем нужно для вашей сети.

- Если вы развертываете EAP-TLS, планирование развертывания инфраструктуры открытых КЛЮЧЕЙ. Это включает в себя планирование шаблонов сертификатов, которые вы собираетесь использовать для сертификатов сервера и сертификатам клиентского компьютера. Она также включает, определяющие способ регистрации сертификатов для члена домена и входящих в домен компьютеров и определения, следует ли использовать смарт-карты.

- Если вы развертываете PEAP-MS-CHAP v2, определите, нужно ли устанавливать службу сертификации AD для выдачи сертификатов сервера для вашей NPSs или нужно ли приобретать сертификаты сервера из общедоступного центра сертификации, таким как VeriSign.

### <a name="plan-network-policies"></a>Планирование политик сети

Сетевые политики используются сервером политики сети, чтобы определить, разрешено ли запросы на подключение, получаемые от клиентов RADIUS. NPS также использует свойства удаленного доступа в учетной записи пользователя для определения авторизации.

Так как сетевые политики обрабатываются в порядке, в котором они отображаются в оснастке NPS, следует сначала поместите наиболее строгие политики в списке политик. Для каждого запроса на подключение служба NPS пытается соответствуют условиям политики с помощью свойства запроса подключения. NPS проверяет каждой сетевой политики, в порядке, пока не найдет совпадение. Если он не найден, запрос на подключение отклоняется.

### <a name="key-steps"></a>Основные шаги

В ходе планирования сетевые политики, можно использовать следующие действия.

- Определите предпочтительный порядок обработки NPS политик сети, от наибольшего до наименьшего.

- Определение состояния политики. Состояние политики может иметь значение включен или отключен. Если политика включена, сервер политики сети оценивает политику при выполнении авторизации. Если политика не включена, она не вычисляется.

- Определите тип политики. Необходимо определить, предназначен ли политика для предоставления доступа при выполнении соответствующих условий политики запроса подключения или ли политика предназначена для запрета доступа при выполнении соответствующих условий политики запрос на подключение. Например если вы хотите явно запретить беспроводного доступа для членов группы Windows, можно создать политику сети, которая указывает группе, метод беспроводное подключение и, имеет политику введите параметр отказать в доступе.

- Определите, следует ли NPS так, чтобы игнорировать свойств удаленного доступа учетных записей пользователей, которые являются членами группы, на котором основана политика. Если этот параметр не включен, свойств удаленного доступа учетных записей пользователей переопределить параметры, настроенные в политиках сети. Например если политики сети настроен, пользователю предоставляется доступ, но свойства удаленного доступа в учетной записи пользователя для этого пользователя устанавливаются для запрета доступа, пользователь получает отказ в доступе. Но при включении свойств setting коммутируемый учетной записи пользователя игнорировать тип политики одному пользователю предоставляется доступ к сети.

- Определите, использует ли политика исходного параметра политики. Этот параметр позволяет легко указать источник для всех запросов на доступ. Возможные источники — шлюз служб терминалов (шлюз TS), сервер удаленного доступа (VPN или удаленного доступа), DHCP-сервера, беспроводных точек доступа и сервера центра регистрации работоспособности. Кроме того можно указать источник конкретных поставщиков.

- Определите условия, которым должен соответствовать порядку сетевой политики, применяемые.

- Определите параметры, которые применяются при выполнении соответствующих условий политики сети запрос на подключение.

- Определите, хотите ли вы использовать, изменение или удаление политик сети по умолчанию.

## <a name="plan-nps-accounting"></a>Планирование учета NPS

Сервер политики сети обеспечивает возможность входа данных учета RADIUS, таких как проверка подлинности пользователя и запросы учета, в трех форматах: IAS формат, совместимый с базой данных формат и ведения журнала Microsoft SQL Server. 

IAS формат и формат, совместимый базы данных создавать файлы журналов на локальном сервере политики сети в формате текстового файла. 

Ведение журнала SQL Server предоставляет возможность входа на SQL Server 2000 или SQL Server 2005 совместимый с XML базу данных, расширение учета RADIUS, чтобы получить преимущества ведения журнала в реляционной базе данных.

### <a name="key-steps"></a>Основные шаги

В ходе планирования учета NPS, можно использовать следующие действия.

- Определите, требуется ли хранить данные учета NPS, в файлах журналов или в базе данных SQL Server.

### <a name="nps-accounting-using-local-log-files"></a>С помощью локального журнала файлов учета NPS

Записи проверки подлинности пользователей и запросы в файлы журналов учета используется главным образом для подключения анализа и выставления счетов, а также полезна как средство исследования системы безопасности, предоставляя метод для отслеживания действий пользователь-злоумышленник после атаки.

### <a name="key-steps"></a>Основные шаги

В ходе планирования учета NPS, используя локальные файлы журнала, можно использовать следующие действия.

- Определите формат файла, который вы хотите использовать для файлов журнала NPS.

- Выберите тип данных, который вы хотите войти. Входить учета запросы, запросы на проверку подлинности и промежуточное состояние.

- Определите папку на жестком диске, где вы хотите сохранить файлы журнала.

- При разработке решения резервного копирования файлов журнала. Папку на жестком диске, где хранятся файлы журнала должно быть расположение, которое позволяет легко создавать резервные копии своих данных. Кроме того папку на жестком диске должны быть защищены, настроив списке управления доступом (ACL) к папке, где хранятся файлы журналов.

- Определите частоту, в которой необходимо, чтобы новые файлы журналов, создаваемых. Файлы журналов, создаваемых на основе размера файла, определите максимально допустимый размер файла до создания нового файла журнала на сервере политики сети.

- Определите, следует ли NPS так, чтобы удалить старые файлы журнала, если жесткий диск не хватает дискового пространства.

- Определите приложения или приложения, которые вы хотите использовать для просмотра учетных данных и создания отчетов.

### <a name="nps-sql-server-logging"></a>Ведение журнала NPS SQL Server

Ведение журнала NPS SQL Server используется при необходимости сведения о состоянии сеанса для создания отчетов и анализа данных, а также централизовать и упростить управление данными учета.

Сервер политики сети обеспечивает возможность использования SQL Server ведения журнала для проверки подлинности пользователя из записей и учета, полученных из одного или нескольких серверы сетевого доступа к источнику данных на компьютере под управлением Microsoft SQL Server Desktop Engine \(MSDE 2000\), или любая версия SQL Server более поздней версии, чем SQL Server 2000.

Данные бухгалтерской программы передается от сервера политики сети в формате XML в хранимую процедуру в базе данных, которая поддерживает оба языка структурированных запросов \(SQL\) и XML \(SQLXML\). Запись проверки подлинности пользователей и запросы в базе данных SQL Server, совместимый с XML учета включает несколько NPSs иметь один источник данных.

### <a name="key-steps"></a>Основные шаги

В ходе планирования учета NPS с помощью ведения журнала NPS SQL Server, можно использовать следующие действия.

- Определяет, имеет ли вы или другой участник вашей организации разработки реляционных баз данных SQL Server 2000 или SQL Server 2005 столкнуться, и понять, как использовать эти продукты для создания, изменения, Администрирование и управление базами данных SQL Server.

- Определите, установлен ли SQL Server на сервере политики сети или на удаленном компьютере.

- Создайте хранимую процедуру, которая используется в базе данных SQL Server для обработки входящих XML-файлы, содержащие данные учета NPS.

- Создать структуру репликации базы данных SQL Server и потока.

- Определите приложения или приложения, которые вы хотите использовать для просмотра учетных данных и создания отчетов.

- Планируете использовать серверы сетевого доступа, позволяющие атрибута класса в всех запросов учетных данных. Атрибут класса отправляется клиенту в сообщение Access-Accept RADIUS, а также полезно для корреляции сообщений запроса учетных данных с сеансов проверки подлинности. Если атрибут класса отправляется с сервера доступа к сети в сообщениях запросов учета, его можно использоваться для сопоставления записи учета и проверки подлинности. Сочетание атрибутов Unique-серийным номером, время для перезагрузки службы и адрес сервера должен быть уникальный идентификатор для каждой проверки подлинности, который принимает сервер.

- Планируете использовать серверы сетевого доступа, которые поддерживают учет промежуточных состояний.

- Планируете использовать серверы сетевого доступа, которые отправляют сообщения о и отключении учета.

- Планируете использовать серверы сетевого доступа, которые поддерживает возможность хранения и пересылки данных учета. Серверы доступа к сети, которые поддерживают эту функцию можно хранить учетные данные, когда сервер удаленного доступа не удается связаться с сервером политики сети. Когда сервер NPS, сервера доступа к сети перенаправляет хранимых записи сервера политики сети, обеспечивая надежность в учете через серверы сетевого доступа, которые не поддерживают эту функцию.

- Следует всегда настроить атрибут Acct-Interim-Interval в политиках сети. Атрибут Acct-Interim-Interval Интервал (в секундах) между промежуточными обновлениями, отправляющий сервер удаленного доступа. В соответствии с RFC 2869 значение атрибута Acct-Interim-Interval не должно быть меньше 60 секунд или одну минуту и не должно быть меньше 600 секунд или 10 минут. Дополнительные сведения см. в разделе 2869 RFC, «Расширения RADIUS».

- Убедитесь, что на вашей NPSs включено ведение журнала промежуточных состояний.

