---
title: Планирование сервера политики сети как RADIUS-сервер
description: Этот раздел содержит сведения о планировании в Windows Server 2016 развертывания сервера RADIUS сервера политики сети.
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 2900dd2c-0f70-4f8d-9650-ed83d51d509a
ms.author: pashort
author: shortpatti
ms.openlocfilehash: e9bb95428c17e5d7bde588693e84288ddfe64531
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="plan-nps-as-a-radius-server"></a>Планирование сервера политики сети как RADIUS-сервер

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

При развертывании \(NPS\) сервера политики сети как сервер службы проверки подлинности удаленного пользователя (RADIUS), сервер политики сети выполняет проверку подлинности, авторизации и учету запросов на подключение для локального домена и доменов, которые доверяют локального домена. Эти правила планирования можно использовать для упрощения развертывания RADIUS.

Эти правила планирования следует включать ситуации, в которых вы хотите развернуть сервер политики сети как RADIUS-прокси. При развертывании сервера политики сети как RADIUS-прокси, сервер политики сети перенаправляет запросы на подключение на сервере политики сети или другие RADIUS-серверы в удаленном домене или в недоверенных доменах. 

Перед развертыванием сервера политики сети как RADIUS-сервер в сети, используйте следующие рекомендации для планирования развертывания.

- Планирование конфигурации сервера NPS.

- Планирование RADIUS-клиентов.

- Планирование использовать методы проверки подлинности.

- Планирование политики сети.

- Планирование учета сервера политики сети.

## <a name="plan-nps-server-configuration"></a>Планирование конфигурации сервера NPS

Необходимо решить, в какой домен входит сервер политики сети. В средах с несколькими доменами сервер политики сети может пройти проверку подлинности учетных данных для учетных записей пользователей, в который он входит в домен и для всех доменов, которым доверяете в локальном домене сервера политики сети. Чтобы разрешить серверу политики сети на чтение свойств удаленного доступа учетных записей пользователей в процессе авторизации, необходимо добавить учетную запись компьютера сервера политики сети в группу серверов удаленного доступа и сервера политики сети для каждого домена.

После определения членства в домене сервера политики сети, необходимо настроить сервер для связи с RADIUS-клиентов, также называемый серверы доступа к сети, с использованием протокола RADIUS. Кроме того можно настроить типы событий, NPS записей в событии журнал и вы можно ввести описание для сервера.

### <a name="key-steps"></a>Основные шаги

При планировании конфигурации NPS-сервера, можно использовать следующие действия.

- Определите RADIUS-портов, используемые сервером политики сети получать сообщения RADIUS с RADIUS-клиентов. Порты по умолчанию, UDP-порты 1812 и 1645 для сообщений проверки подлинности RADIUS и порты 1813 и 1646 для сообщений учета RADIUS.

- Если сервер политики сети настроен с несколькими сетевыми адаптерами, определите адаптеров, через которое необходимо разрешить RADIUS-трафика.

- Определите типы событий, которые вы хотите NPS для записи в журнале событий. Вы можете выполнить запросы отклоненные проверки подлинности, успешной проверки подлинности или оба типа запросов.

- Определите, является ли вы развертываете несколько серверов политики сети. Для обеспечения отказоустойчивости для проверки подлинности на основе RADIUS и учет, используйте по крайней мере два сервера политики сети. Один сервер политики сети используется в качестве основного сервера RADIUS и других используется в качестве резервной копии. Все клиенты RADIUS затем настраивается на обоих серверах политики сети. Если основной сервер политики сети становится недоступным, RADIUS-клиенты отправьте сообщения запроса доступа на другой сервер политики сети.

- Планирование сценария, используемого для копирования одной конфигурации сервера NPS на другие серверы политики сети для сохранения на администрирование и во избежание неправильная конфигурация сервера. Сервер политики сети содержит команды Netsh, которые дают возможность скопировать все или часть конфигурации NPS-сервера для импорта на другой сервер политики сети. Команды в командной строке Netsh можно запустить вручную. Однако при сохранении вашей последовательность команд, как сценарий, можно запустить сценарий позже, если вы решите изменить настройки сервера.

## <a name="plan-radius-clients"></a>Планирование RADIUS-клиентов

Клиенты RADIUS — это серверы сетевого доступа, например беспроводные точки доступа, серверы виртуальных частных сетей (VPN), 802.1 X-коммутаторами и серверы удаленного доступа. RADIUS-прокси, которые пересылать подключения сообщения запроса RADIUS-серверов, также являются клиентами RADIUS. Сервер политики сети поддерживает все серверы доступа к сети и RADIUS-прокси, которые соответствуют РАДИУС протокола, как описано в см, «Удаленного служба проверки подлинности удаленного пользователя (RADIUS)» и RFC 2866, «Бухгалтерия RADIUS».

>[!IMPORTANT]
>Доступ к клиентам, таким как клиентские компьютеры не являются клиентами RADIUS. Только серверы доступа к сети и прокси-серверы, которые поддерживают протокол RADIUS являются клиентами RADIUS.

Кроме того точки беспроводного доступа и коммутаторы должны быть поддерживают проверку подлинности 802.1 X. Если вы хотите развернуть \(EAP\) расширяемого протокола проверки подлинности или \(PEAP\) защищенный расширяемый протокол проверки подлинности, точки доступа и коммутаторы должны поддерживать использование протокола EAP.

Для тестирования базового взаимодействия для подключений по протоколу PPP для точки беспроводного доступа, настройте точки доступа и доступа к клиентскому компьютеру использовать протокол проверки подлинности пароля (PAP). Используйте протоколы дополнительной проверки подлинности по протоколу PPP, такими как PEAP, пока не проверите те, которые вы планируете использовать для доступа к сети.

### <a name="key-steps"></a>Основные шаги

Во время планирования RADIUS-клиентов, можно использовать следующие действия.

- Документ атрибутов поставщика (VSA), необходимо настроить на сервере политики сети. Если серверы доступа к сети требуется VSA, VSA записывает сведения в журнал для последующего использования при настройке политики в сети на сервере политики сети. 

- Документ IP-адресов клиентов RADIUS и сервера политики сети, для упрощения настройки всех устройств. При развертывании клиентов RADIUS, необходимо настроить их для использования протокола RADIUS, с IP-адрес сервера политики сети, при вводе сервер проверки подлинности. И при настройке сервера политики сети для взаимодействия с RADIUS-клиентов, необходимо ввести IP-адресов клиентов RADIUS в оснастку сервера политики сети.

- Создайте общие секреты для настройки клиентов RADIUS и в оснастке сервера политики сети. RADIUS-клиентов необходимо настроить общий секрет или пароль, который вводится в оснастку сервера политики сети во время настройки RADIUS-клиентов на сервере политики сети.

## <a name="plan-the-use-of-authentication-methods"></a>Планирование использовать методы проверки подлинности

Сервер политики сети поддерживает оба метода проверки подлинности на основе пароля и на основе сертификатов. Однако не все серверы доступа к сети поддерживает те же методы проверки подлинности. В некоторых случаях может возникнуть необходимость развернуть свой метод проверки подлинности на основе типа доступа к сети.

Например, может потребоваться развертывание беспроводных и доступ через VPN для вашей организации, но использовать метод проверки подлинности для каждого типа доступа: протокол EAP-TLS, для VPN-подключения, из-за надежную защиту, обеспечивающий EAP в Сочетании с безопасности уровня транспорта TLS (EAP-TLS) и протокола PEAP-MS-CHAP версии 2 для беспроводных подключений 802.1 X.

Переподключение PEAP с помощью проверки подлинности протоколом MSCHAP версии 2 (PEAP-MS-CHAP v2) предоставляет функцию с именем fast, которое предназначено специально для использования с портативные компьютеры и других беспроводных устройств. Быстрое переподключение позволяет беспроводным клиентам перемещаться между точками беспроводного доступа в той же сети, без повторной проверки подлинности каждый раз при связи с новой точки доступа. Это удобнее для беспроводных пользователей и позволяет им свободно перемещать между точками доступа без необходимости повторного ввода учетных данных.
Из-за fast снова и для обеспечения безопасности PEAP-MS-CHAP v2, PEAP-MS-CHAP v2 логично как метод проверки подлинности для беспроводных подключений.

Для VPN-подключений EAP-TLS — это метод проверки подлинности на основе сертификата, который обеспечивает высокую степень безопасности, защищающий сетевой трафик, даже если она передается через Интернет с домашнего или мобильных компьютеров на VPN-серверов организации.

### <a name="certificate-based-authentication-methods"></a>Методы проверки подлинности на основе сертификатов

Методы проверки подлинности на основе сертификатов имеют преимущество гарантирует высокую безопасность; и у них есть недостаток, более трудно развертывать чем методы проверки подлинности на основе пароля.

Протокол PEAP-MS-CHAP v2 и EAP-TLS, методов проверки подлинности на основе сертификатов, но существует много различий между ними и способом, в котором они развернуты.

### <a name="eap-tls"></a>ПРОТОКОЛ EAP-TLS

Протокол EAP-TLS использует сертификаты для проверки подлинности клиента и сервера и требуется развертывания инфраструктуры открытых ключей (PKI) в организации. Развертывание PKI может быть сложным и требует этап планирования, которая не зависит от планирование для использования сервера политики сети как RADIUS-сервер.

С помощью EAP-TLS, сервер политики сети регистрирует сертификат сервера из центра сертификации \(CA\) и сертификат сохраняется в хранилище сертификатов локального компьютера. Во время процесса проверки подлинности сервера проверки подлинности происходит, когда на NPS-сервер отправляет свой сертификат сервера клиентского доступа для подтверждения его подлинности для клиентского доступа. Клиент доступа рассматриваются различные свойства сертификата, чтобы определить, является ли сертификат действителен и подходит для использования во время проверки подлинности сервера. Если сертификат сервера, требованиям к сертификатам минимальной серверной и центром сертификации, которому доверяет клиент доступа, сервер политики сети успешно проверку подлинности клиента.

Аналогичным образом проверка подлинности клиента возникает во время процесса проверки подлинности, когда клиент отправляет его сертификат клиента на сервере политики сети для подтверждения его подлинности для сервера политики сети. Сервер политики сети проверяет сертификат, и если сертификат клиента, требованиям к сертификатам минимальное клиентом и центром сертификации, которому доверяет сервер политики сети, клиент доступа успешной проверки подлинности сервером политики сети.

Хотя это требуется, что сертификат сервера хранится в хранилище сертификатов на сервере политики сети, сертификат клиента или пользователя может храниться в хранилище сертификатов на клиентском компьютере или на смарт-карте.

Для успешного выполнения этого процесса проверки подлинности, требуется наличие сертификата ЦС в вашей организации в хранилище сертификатов доверенных корневых центров сертификации для локального компьютера и текущего пользователя.

### <a name="peap-ms-chap-v2"></a>Протокол PEAP-MS-CHAP v2

Протокол PEAP-MS-CHAP v2 использует сертификат для проверки подлинности сервера и учетные данные для проверки подлинности пользователя на основе пароля. Поскольку сертификаты используются только для проверки подлинности сервера, вы не требуются для развертывания инфраструктуры открытых КЛЮЧЕЙ для использования протокола PEAP-MS-CHAP v2. При развертывании PEAP-MS-CHAP v2, можно получить сертификат сервера для сервера политики сети в одном из следующих двух способов:

- Можно установить службы сертификации Active Directory (AD CS) и автоматической регистрации сертификатов для серверов политики сети. При использовании этого метода, необходимо также зарегистрировать сертификат ЦС для клиентских компьютеров, подключающихся к сети, чтобы они доверяют сертификат, выданный для сервера политики сети.

- Вы можете приобрести сертификат сервера из общедоступного центра сертификации, например VeriSign. Если вы используете этот способ, убедитесь, что выбрать ЦС, который уже является доверенным для клиентских компьютеров. Чтобы определить, ли клиентские компьютеры доверять ЦС, откройте оснастку "сертификаты Microsoft Management Console (MMC)" на клиентском компьютере и затем просмотреть хранилище доверенных корневых центров сертификации на локальном компьютере и для текущего пользователя. Если сертификат ЦС в этих хранилищ сертификатов, клиентский компьютер доверяют ЦС и таким образом будет доверять любого сертификата, выданного центром сертификации.

Во время процесса проверки подлинности с помощью протокола PEAP-MS-CHAP v2 проверки подлинности сервера возникает, когда на NPS-сервер отправляет свой сертификат сервера на клиентском компьютере. Клиент доступа рассматриваются различные свойства сертификата, чтобы определить, является ли сертификат действителен и подходит для использования во время проверки подлинности сервера. Если сертификат сервера, требованиям к сертификатам минимальной серверной и центром сертификации, которому доверяет клиент доступа, сервер политики сети успешно проверку подлинности клиента.

Проверка подлинности пользователя возникает при попытке подключения к сети типов на основе пароля учетные данные пользователя и пытается войти в систему. Сервер политики сети, получает учетные данные и выполняет проверку подлинности и авторизации. Если пользователь с проверкой подлинности и авторизацию успешно и клиентский компьютер успешно прошел проверку подлинности с сервером политики сети, предоставляется запроса на подключение.

### <a name="key-steps"></a>Основные шаги

Во время планирования использовать методы проверки подлинности, можно использовать следующие действия.

- Определите типы доступа к сети, которые вы собираетесь предлагать, например беспроводных сетей, VPN, 802.1 X-совместимый коммутатор и удаленного доступа.

- Определите метод проверки подлинности или методов, которые вы хотите использовать для каждого типа доступа. Рекомендуется использовать методы проверки подлинности на основе сертификатов, которые обеспечивают надежную защиту; Тем не менее он может оказаться нецелесообразным для развертывания инфраструктуры открытых КЛЮЧЕЙ, чтобы другие методы проверки подлинности может обеспечить лучшую баланс требуются для локальной сети.

- Если вы развертываете EAP-TLS, планировании развертывания PKI. Это включает в себя планирование шаблонов сертификатов, которые вы собираетесь использовать для сервера сертификатов и сертификатам клиентского компьютера. Он также включает определение того, как получение сертификатов член домена и компьютеров, не входящих в домен, а также определить, следует ли использовать смарт-карты.

- Если вы развертываете PEAP-MS-CHAP v2, определите, следует ли устанавливать службу сертификации AD для выдачи сертификатов сервера для ваших серверов политики сети или хотите ли вы приобрели сертификаты сервера общедоступным центром сертификации, например VeriSign.

### <a name="plan-network-policies"></a>Планирование политики сети

Политики сети используются сервером политики сети, чтобы определить, авторизованы ли запросы на подключение, получаемые от клиентов RADIUS. Сервер политики сети также использует свойств удаленного доступа учетной записи пользователя для определения авторизации.

Поскольку сетевые политики обрабатываются в порядке, в котором они отображаются в оснастке сервера политики сети, следует сначала установите наиболее строгие политики в списке политик. Для каждого запроса на подключение политики сети пытается соответствует условиям политики с помощью свойства запроса подключения. NPS проверяет каждой политики сети в порядке, пока совпадения. Если не удается найти совпадения, запрос на подключение отклоняется.

### <a name="key-steps"></a>Основные шаги

При планировании политики сети, можно использовать следующие действия.

- Определите предпочитаемый порядок обработки NPS политик сети, с наиболее строгие для наименьшие.

- Определение состояния политики. Состояние политики может иметь значение включен или отключен. Если политика включена, сервер политики сети оценивает политики во время выполнения авторизации. Если политика не включена, она не проверяется.

- Определите тип политики. Необходимо определить, является ли политика предназначена для предоставления доступа, когда соответствующие условиям политики запроса подключения или ли политики предназначен для запрета доступа, когда соответствующие условиям политики запроса подключения. Например если вы хотите явно запрещают беспроводного доступа для членов группы Windows, можно создать сетевой политики, которая указывает группе, метод беспроводного подключения и, применяется политика введите параметр отказать в доступе.

- Определите, нужно ли сервер политики сети, чтобы игнорировать свойств удаленного доступа учетных записей пользователей, которые являются членами группы, на основе политики. Если этот параметр не включен, свойств удаленного доступа учетных записей пользователей переопределять параметры, заданные в политиках сети. Например если политики сети настроен, предоставляющем доступ для пользователя, но свойств удаленного доступа учетной записи пользователя для этого пользователя настроены на запрет доступа, пользователю будет отказано в доступе. Но если вы включите параметр коммутируемых учетной записи пользователя игнорировать свойства типа политики, же пользователю предоставляется доступ к сети.

- Определите, использует ли политика источника параметр политики. Этот параметр позволяет легко указать источник для всех запросов на доступ. Возможные источники являются шлюза служб терминалов (шлюз TS), сервер удаленного доступа (VPN-подключения или удаленного доступа), DHCP-сервера, точки беспроводного доступа и сервера центра регистрации работоспособности. Кроме того можно указать источник конкретного поставщика.

- Определите условия, которые должны быть сопоставлены в порядке сетевой политики, применяемые.

- Определите параметры, которые применяются, если соответствующие условиям политики сети запрос на подключение.

- Определите, следует ли использовать, изменять и удалять политики сети по умолчанию.

## <a name="plan-nps-accounting"></a>Планирование учета сервера политики сети

Сервер политики сети позволяет вести журнал данных учета RADIUS, такие как проверка подлинности пользователя и запросов учета, в следующих форматах: IAS форматов, совместимый с базой данных и ведение журнала Microsoft SQL Server. 

Формат IAS и формат, совместимый с базой данных создайте файлы журналов на локальном сервере политики сети в формате текстового файла. 

Ведение журнала SQL Server предоставляет возможность входа на SQL Server 2000 или SQL Server 2005 XML-совместимую базу данных, расширение учета RADIUS, позволяющее получить преимущества ведения журнала в реляционной базе данных.

### <a name="key-steps"></a>Основные шаги

Во время планирования учета сервера политики сети, можно использовать следующие действия.

- Определите, следует ли хранить данных учета сервера политики сети в файлы журнала или в базе данных SQL Server.

### <a name="nps-accounting-using-local-log-files"></a>Учет NPS с помощью локального журнала файлов

Запись проверки подлинности и учета запросов пользователей в файлах журнала в основном используется для подключения целей анализа и выставления счетов и также можно использовать в качестве средства анализа системы безопасности, предоставляя метод для отслеживания действий пользователь-злоумышленник после атаки.

### <a name="key-steps"></a>Основные шаги

Во время планирования учета сервера политики сети с помощью локальные файлы журнала, можно использовать следующие действия.

- Определите формат файла, который вы хотите использовать для файлов журнала сервера политики сети.

- Выберите тип информации, которую вы хотите войти. Вы можете выполнить запросы учета, запросы проверки подлинности и промежуточном состоянии.

- Определите расположение жесткого диска, где вы хотите сохранить файлы журнала.

- Разработка решения резервного копирования файлов журнала. Расположение жесткого диска, где хранить файлы журнала должен быть местоположение, которое позволяет легко резервного копирования данных. Кроме того расположение жесткого диска должны быть защищены, настроив список управления доступом (ACL) к папке, где хранятся файлы журналов.

- Определите частоту, с которой вы хотите новых файлов журнала, создаваемых. Файлы журнала, создаваемых на основе размера файла, определите максимально допустимый размер файла до создания нового файла журнала на сервере политики сети.

- Определите, следует ли сервер политики сети, чтобы удалить старые файлы журнала, если жесткий диск не хватает места хранения данных.

- Определение приложений, которые вы хотите использовать для просмотра учетных данных и создания отчетов.

### <a name="nps-sql-server-logging"></a>Ведение журнала SQL Server сервера политики сети

Ведение журнала SQL Server сервера политики сети используется в том случае, если вам нужно сведения о состоянии сеанса для создания отчетов и анализа данных и централизовать и упростить управление данных учета.

Сервер политики сети обеспечивает возможность использовать SQL Server ведения журнала для проверки подлинности пользователя записей и учета запросов, полученных от одного или нескольких серверов доступа к сети с источником данных на компьютере более поздней версии, чем SQL Server 2000 с \(MSDE 2000\) рабочего стола СУБД Microsoft SQL Server или любой версии SQL Server.

Учетные данные, передается от сервера политики сети в формате XML хранимую процедуру в базе данных, поддерживающий оба язык структурированных запросов \(SQL\) и XML \(SQLXML\). Запись проверки подлинности пользователя и запросы в базу данных SQL Server, XML-совместимые учета позволяет иметь один источник данных на нескольких серверах политики сети.

### <a name="key-steps"></a>Основные шаги

Во время планирования для учета сервера политики сети с помощью ведения журнала SQL Server сервера политики сети, можно использовать следующие действия.

- Определите, имеет ли вы или другой член организации разработки реляционной базы данных SQL Server 2000 или SQL Server 2005 взаимодействие и понять, как использовать эти продукты для создания, изменения, администрирования и управления базами данных SQL Server.

- Определение, установлена ли SQL Server, на NPS-сервере или на удаленном компьютере.

- Конструктор хранимой процедуры, который будет использовать в базе данных SQL Server для обработки входящих XML-файлы, содержащие данных учета сервера политики сети.

- Проектирование структуры репликации базы данных SQL Server и потока.

- Определение приложений, которые вы хотите использовать для просмотра учетных данных и создания отчетов.

- Запланируйте использование серверы доступа к сети, отправляемые в все запросы учета класс атрибута. Класс атрибута имеет смысл для сопоставления с сеансами проверки подлинности сообщения запроса учетных данных и отправляются клиенту RADIUS в сообщение предоставления доступа. Если атрибут класса отправляются с сервера доступа к сети в сообщения запроса учета, его можно использовать для сопоставления записей учета и проверки подлинности. Сочетание атрибутов Unique-серийным номером, время для перезагрузки службы и адрес сервера должен быть уникальный идентификатор для каждой проверки подлинности, который принимает сервера.

- Запланируйте использование серверы доступа к сети, которые поддерживает промежуточный учет.

- Запланируйте использование серверы доступа к сети, которые отправляют сообщения на учета и отключении учета.

- Запланируйте использование серверы доступа к сети, которые поддерживают хранения и пересылки данных учета. Серверы доступа к сети, которые поддерживают эту функцию можно хранить учетные данные, когда сервер удаленного доступа не удается связаться с сервером политики сети. Когда на NPS-сервер доступен, сервера доступа к сети пересылает хранимых записей на сервере политики сети, обеспечивая надежность учета через серверы доступа к сети, которые не поддерживают эту функцию.

- Планирование всегда Настройка атрибута Acct промежуточные интервалов в политик сети. Атрибут Acct промежуточные интервалов задает интервал (в секундах) между промежуточными обновлениями, отправляет сервера доступа к сети. В соответствии с RFC 2869 значение атрибута Acct промежуточные интервалов должен иметь размер не менее 60 секунд, или одну минуту и не должно быть меньше, чем 600 секунд или 10 минут. Дополнительные сведения см. в разделе RFC 2869 «Расширения RADIUS».

- Убедитесь, что ведение журнала состояния включено на серверах политики сети.

