---
title: Настройка шаблонов сертификатов для требований PEAP и EAP
description: В этом разделе содержатся сведения об использовании сертификатов с сервером политики сети и удаленным доступом в Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 2af0a1df-5c44-496b-ab11-5bc340dc96f0
ms.author: pashort
author: shortpatti
ms.openlocfilehash: f60e5a1da1388a6dd2432a3603f83d6ca2990a29
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405408"
---
# <a name="configure-certificate-templates-for-peap-and-eap-requirements"></a>Настройка шаблонов сертификатов для требований PEAP и EAP

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Все сертификаты, используемые для проверки подлинности доступа к сети с помощью расширенного протокола проверки подлинности\-уровень безопасности транспортного уровня \(EAP\-TLS\), защищенный протокол расширенной проверки подлинности,\-протокол PEAP \(TLS\-, и PEAP\)протокола проверки подлинности Microsoft Challenge\-MS \(CHAP v2\-должны соответствовать требованиям для сертификатов X. 509 и работать с ними Безопасность уровня сокета/транспорта (SSL/TLS).\) Сертификаты клиента и сервера имеют дополнительные требования.

>[!IMPORTANT]
>В этом разделе приводятся инструкции по настройке шаблонов сертификатов. Чтобы использовать эти инструкции, необходимо развернуть собственную инфраструктуру открытого ключа \(PKI\) с Active Directory службами сертификатов \(AD CS\).

## <a name="minimum-server-certificate-requirements"></a>Минимальные требования к сертификатам сервера

При использовании PEAP\-MS\-CHAP v2, PEAP\-TLS или EAP\-TLS в качестве метода проверки подлинности сервер политики сети должен использовать сертификат сервера, отвечающий минимальным требованиям к сертификату сервера. 

Клиентские компьютеры можно настроить для проверки сертификатов сервера с помощью параметра **проверить сертификат сервера** на клиентском компьютере или в групповая политика. 

Клиентский компьютер принимает попытки проверки подлинности сервера, когда сертификат сервера соответствует следующим требованиям.

- Имя субъекта содержит значение. Если сертификат выдается серверу, на котором выполняется сервер политики сети (NPS) с пустым именем субъекта, сертификат не будет доступен для проверки подлинности NPS. Чтобы настроить шаблон сертификата с именем субъекта, выполните следующие действия.

    1. Откройте "Шаблоны сертификатов".
    2. В области сведений щелкните правой кнопкой мыши шаблон сертификата, который необходимо изменить, и выберите пункт **Свойства** .
    3. Перейдите на вкладку **имя субъекта** и нажмите кнопку **собрать на основе сведений из этой Active Directory**.
    4. В поле **Формат имени субъекта**выберите значение, отличное от **нет**.

- Сертификат компьютера на сервере привязывается к доверенному корневому центру сертификации (ЦС) и не завершается проверкой, выполненной CryptoAPI и указанными в политике удаленного доступа или сетевой политике.

- Сертификат компьютера для сервера политики сети или VPN настроен с использованием проверки подлинности сервера в расширениях расширенного использования ключа (EKU). (Идентификатор объекта для проверки подлинности сервера — 1.3.6.1.5.5.7.3.1.)

- Настройте сертификат сервера с требуемым параметром шифрования:

    1. Откройте "Шаблоны сертификатов".
    2. В области сведений щелкните правой кнопкой мыши шаблон сертификата, который необходимо изменить, и выберите пункт **Свойства**.
    3. Перейдите на вкладку **Криптография** и убедитесь, что настроены следующие параметры.
       - **Категория поставщика:** Поставщик хранилища ключей
       - **Имя алгоритма:** RSA
       - **Поставщики:** Поставщик криптографии платформы (Майкрософт)
       - **Минимальный размер ключа:** 2048
       - **Хэш-алгоритм:** SHA2
    4. Нажмите кнопку **Далее**.

- Расширение альтернативного имени субъекта (SubjectAltName), если оно используется, должно содержать DNS-имя сервера. Чтобы настроить шаблон сертификата с помощью службы доменных имен (DNS) сервера регистрации, выполните следующие действия. 

    1. Откройте "Шаблоны сертификатов".
    2. В области сведений щелкните правой кнопкой мыши шаблон сертификата, который необходимо изменить, и выберите пункт **Свойства** .
    3. Перейдите на вкладку **имя субъекта** и нажмите кнопку **собрать на основе сведений из этой Active Directory**.
    4. В поле **включить эту информацию в альтернативное имя субъекта**выберите **DNS-имя**.

При использовании PEAP и EAP-TLS НПСС отображает список всех установленных сертификатов в хранилище сертификатов на компьютере со следующими исключениями.

- Сертификаты, не содержащие цель проверки подлинности сервера в расширениях EKU, не отображаются.

- Сертификаты, не содержащие имени субъекта, не отображаются.

- Сертификаты на основе реестра и смарт-карты не отображаются.

Дополнительные сведения см. в статье [Развертывание сертификатов сервера для беспроводных и беспроводных развертываний 802.1 x](https://technet.microsoft.com/windows-server-docs/networking/core-network-guide/cncg/server-certs/deploy-server-certificates-for-802.1x-wired-and-wireless-deployments).

## <a name="minimum-client-certificate-requirements"></a>Минимальные требования к сертификатам клиента

При использовании EAP-TLS или PEAP-TLS сервер принимает попытки проверки подлинности клиента, если сертификат соответствует следующим требованиям.

- Сертификат клиента выдается центром сертификации предприятия или сопоставляется с учетной записью пользователя или компьютера в службах домен Active Directory Services \(AD DS\).

- Сертификат пользователя или компьютера на клиенте, подключенный к доверенному корневому центру сертификации, включает в себя назначение проверки подлинности клиента в расширениях EKU \(идентификатор объекта для проверки подлинности клиента — 1.3.6.1.5.5.7.3.2\)и не выполняет проверки, выполняемые CryptoAPI и не указанные в политике удаленного доступа, или в политике сети, а также в проверках идентификатора объекта сертификата, указанных в политике сети NPS.

- Клиент 802.1 X не использует сертификаты на основе реестра, которые являются сертификатами, защищенными с помощью смарт-карт или паролем.

- Для сертификатов пользователей альтернативное имя субъекта \(SubjectAltName\) в сертификате содержит имя субъекта-пользователя \(\)UPN. Чтобы настроить имя участника-пользователя в шаблоне сертификата, выполните следующие действия.

    1. Откройте "Шаблоны сертификатов".
    2. В области сведений щелкните правой кнопкой мыши шаблон сертификата, который необходимо изменить, и выберите пункт **Свойства**.
    3. Перейдите на вкладку **имя субъекта** и нажмите кнопку **собрать на основе сведений из этой Active Directory**.
    4. В поле **включить эту информацию в альтернативное имя субъекта**выберите **имя участника-пользователя \(UPN\)** .

- Для сертификатов компьютера альтернативное имя субъекта \(SubjectAltName\) в сертификате должно содержать полное доменное имя \(FQDN\) клиента, который также называется *DNS-именем*. Чтобы настроить это имя в шаблоне сертификата, выполните следующие действия.

    1. Откройте "Шаблоны сертификатов".
    2. В области сведений щелкните правой кнопкой мыши шаблон сертификата, который необходимо изменить, и выберите пункт **Свойства**.
    3. Перейдите на вкладку **имя субъекта** и нажмите кнопку **собрать на основе сведений из этой Active Directory**.
    4. В поле **включить эту информацию в альтернативное имя субъекта**выберите **DNS-имя**.

При использовании PEAP\-TLS и EAP\-TLS клиенты отображают список всех установленных сертификатов в оснастке «Сертификаты» со следующими исключениями.

- Беспроводные клиенты не отображают сертификаты на основе реестра и смарт-карты. 

- Беспроводные клиенты и VPN-клиенты не отображают сертификаты, защищенные паролем. 

- Сертификаты, не содержащие цель проверки подлинности клиента в расширениях EKU, не отображаются.


Дополнительные сведения о NPS см. в разделе [сервер политики сети (NPS)](nps-top.md).
