---
title: Балансировка нагрузки прокси-сервера NPS
description: С помощью этого раздела вы узнаете о возможностях и функциях VPN в Windows Server 2016 и Windows 10.
ms.topic: article
ms.assetid: 528280e6-b47e-489f-b310-b257d434aa0d
manager: brianlic
ms.author: lizross
author: eross-msft
ms.openlocfilehash: ee552c0202bff26cdcc58411b64cb342a4c7409e
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87996455"
---
# <a name="nps-proxy-server-load-balancing"></a>Балансировка нагрузки прокси-сервера NPS

Область применения. Windows Server 2016

Клиенты протокол RADIUS (RADIUS), которые представляют собой серверы сетевого доступа, такие как серверы виртуальной частной сети (VPN) и точки беспроводного доступа, создают запросы на подключение и отправляют их на серверы RADIUS, такие как NPS. В некоторых случаях сервер политики сети может одновременно получить слишком много запросов на подключение, что приведет к снижению производительности или перегрузке. Если сервер политики сети перегружен, рекомендуется добавить дополнительные НПСС в сеть и настроить балансировку нагрузки. При равномерном распределении входящих запросов на подключение между несколькими НПСС, чтобы предотвратить перегрузку одного или нескольких НПСС, это называется балансировкой нагрузки.

Балансировка нагрузки особенно полезна для:

- \(Для проверки подлинности в организациях используется протокол EAP-TLS \) или защищенный расширенный протокол проверки подлинности \( PEAP \) -TLS. Так как эти методы проверки подлинности используют сертификаты для проверки подлинности сервера и для проверки подлинности пользователя или клиентского компьютера, нагрузка на прокси-серверы и серверах RADIUS становится более высокой, чем при использовании методов проверки подлинности на основе пароля.
- Организации, которым необходимо постоянно поддерживать непрерывную доступность служб.
- Поставщики услуг Интернета \( \) , имеющие доступ к VPN для других организаций. Службы VPN с внешнего источника могут создавать большой объем трафика проверки подлинности.

Для балансировки нагрузки запросов на подключение, отправляемых в НПСС, можно использовать два метода.

- Настройте серверы доступа к сети для отправки запросов на подключение нескольким серверам RADIUS. Например, если у вас есть 20 беспроводных точек доступа и два сервера RADIUS, настройте каждую точку доступа для отправки запросов на подключение обоим серверам RADIUS. Можно выполнить балансировку нагрузки и обеспечить отработку отказа на каждом сервере сетевого доступа, настроив сервер доступа для отправки запросов на соединение нескольким серверам RADIUS в указанном порядке приоритета. Этот метод балансировки нагрузки обычно лучше всего подходит для небольших организаций, которые не развертывают большое количество RADIUS-клиентов.
- Используйте NPS, настроенный в качестве прокси-сервера RADIUS, для балансировки нагрузки запросов на подключение между несколькими НПСС или другими серверами RADIUS. Например, при наличии 100 точек беспроводного доступа, одного прокси-сервера NPS и трех серверов RADIUS можно настроить точки доступа для отправки всего трафика на прокси-сервер NPS. На прокси-сервере NPS настройте балансировку нагрузки таким образом, чтобы прокси-сервер равномерно распределяет запросы на подключение между тремя серверами RADIUS. Этот метод балансировки нагрузки лучше подходит для средних и крупных организаций, имеющих много клиентов и серверов RADIUS.

Во многих случаях лучшим подходом к балансировке нагрузки является настройка клиентов RADIUS для отправки запросов на подключение к двум прокси-серверам NPS, а затем Настройка прокси-серверов NPS для балансировки нагрузки между серверами RADIUS. Такой подход обеспечивает как отработку отказа, так и балансировку нагрузки для прокси NPS и серверов RADIUS.

## <a name="radius-server-priority-and-weight"></a>Приоритет и вес сервера RADIUS

В процессе настройки прокси-сервера NPS можно создать удаленные группы серверов RADIUS, а затем добавить серверы RADIUS в каждую группу. Для настройки балансировки нагрузки необходимо иметь несколько серверов RADIUS для каждой группы удаленных серверов RADIUS. При добавлении членов группы или после создания сервера RADIUS в качестве члена группы можно открыть диалоговое окно Добавление сервера RADIUS для настройки следующих элементов на вкладке балансировка нагрузки.

- **Приоритет**. Priority задает порядок важности сервера RADIUS для прокси-сервера NPS. Уровню приоритета должно быть присвоено целое значение, например 1, 2 или 3. Чем меньше это число, тем выше приоритет, который прокси-сервер NPS передает серверу RADIUS. Например, если серверу RADIUS назначается наивысший приоритет 1, прокси-сервер NPS сначала отправляет запросы на подключение к серверу RADIUS. Если серверы с приоритетом 1 недоступны, NPS отправляет запросы на подключение к серверам RADIUS с приоритетом 2 и т. д. Можно назначить один и тот же приоритет нескольким серверам RADIUS, а затем использовать параметр веса для балансировки нагрузки между ними.

- **Вес**. Этот параметр веса используется NPS для определения количества запросов на соединение, отправляемых каждому члену группы, если члены группы имеют одинаковый уровень приоритета. Параметру веса должно быть присвоено значение от 1 до 100, а значение представляет процент от 100%. Например, если группа удаленных серверов RADIUS содержит два члена, уровень приоритета которых равен 1 и вес 50, прокси-сервер NPS перенаправляет 50 процентов запросов на подключение к каждому серверу RADIUS.

- **Дополнительные параметры**. Эти параметры отработки отказа предоставляют серверу политики сети возможность определить, недоступен ли удаленный сервер RADIUS. Если служба NPS определяет, что сервер RADIUS недоступен, он может начать отправку запросов на подключение другим членам группы. С помощью этих параметров можно настроить количество секунд, в течение которых прокси-сервер NPS будет ожидать ответа от сервера RADIUS, прежде чем он считает, что запрос отбрасывается; Максимальное число отброшенных запросов до того, как прокси NPS определит сервер RADIUS как недоступный; и количество секунд, которое может пройти между запросами, прежде чем прокси-сервер NPS определит сервер RADIUS как недоступный.

## <a name="configure-nps-proxy-load-balancing"></a>Настройка балансировки нагрузки прокси-сервера NPS

Перед настройкой балансировки нагрузки Создайте план развертывания, который включает необходимое количество удаленных групп RADIUS-серверов, серверы, входящие в каждую из этих групп, и параметры приоритета и веса для каждого сервера.

>[!NOTE]
>В следующих шагах предполагается, что вы уже развернули и настроили серверы RADIUS.

Чтобы настроить NPS для работы в качестве прокси-сервера и пересылать запросы на подключение от клиентов RADIUS к удаленным серверам RADIUS, необходимо выполнить следующие действия.

1. Разверните клиенты RADIUS \( VPN-серверы, серверы удаленного доступа, серверы шлюза служб терминалов, коммутаторы проверки подлинности 802.1 x и точки беспроводного доступа 802.1 x, \) а затем настройте их для отправки запросов на подключение к прокси-серверам NPS.

2. На прокси-сервере NPS настройте серверы доступа к сети в качестве RADIUS-клиентов. Дополнительные сведения см. в разделе [Configure RADIUS Clients](./nps-radius-clients-configure.md).

3. На прокси-сервере NPS создайте одну или несколько групп удаленных серверов RADIUS. В ходе этого процесса добавьте серверы RADIUS в группы удаленных серверов RADIUS. Дополнительные сведения см. в разделе [Настройка групп удаленных серверов RADIUS](./nps-crp-rrsg-configure.md).

4. На прокси-сервере NPS для каждого сервера RADIUS, добавляемого в группу удаленных серверов RADIUS, перейдите на вкладку **Балансировка нагрузки** сервера RADIUS, а затем настройте параметры **приоритет**, **вес**и **Дополнительно**.

5. На прокси-сервере NPS настройте политики запросов на подключение для пересылки запросов на проверку подлинности и учетных записей в удаленные группы RADIUS-серверов. Необходимо создать одну политику запросов на подключение для каждой группы удаленных серверов RADIUS. Дополнительные сведения см. в разделе [Настройка политик запросов на подключение](./nps-crp-configure.md).