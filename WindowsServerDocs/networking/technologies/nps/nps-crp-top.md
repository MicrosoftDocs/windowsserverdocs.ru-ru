---
title: Обработка запросов на подключение
description: В этом разделе приводится обзор обработки запросов на подключение к серверу политики сети в Windows Server 2016.
manager: brianlic
ms.topic: article
ms.assetid: 849d661a-42c1-4f93-b669-6009d52aad39
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: 228eebc3ad3d81868e13137ab9803d04b15df238
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97949900"
---
# <a name="connection-request-processing"></a>Обработка запросов на подключение

>Применяется к: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете об обработке запросов на подключение на сервере политики сети в Windows Server 2016.

>[!NOTE]
>Помимо этого раздела, доступна следующая документация по обработке запросов на подключение.
> - [Политики запросов на подключение](nps-crp-crpolicies.md)
> - [Имена областей](nps-crp-realm-names.md)
> - [Группы удаленных серверов RADIUS](nps-crp-rrsg.md)

Можно использовать обработку запросов на подключение, чтобы указать, где выполняется проверка подлинности запросов на локальном компьютере или на удаленном RADIUS-сервере, входящем в группу удаленных серверов RADIUS.

Если требуется, чтобы локальный сервер, на котором работает сервер политики сети (NPS), выполнял проверку подлинности для запросов на подключение, можно использовать политику запросов на подключение по умолчанию без дополнительной настройки. В зависимости от политики по умолчанию NPS проверяет подлинность пользователей и компьютеров, имеющих учетную запись в локальном домене и в доверенных доменах.

Если вы хотите перенаправить запросы на подключение к удаленному серверу политики сети или к другим серверам RADIUS, создайте группу удаленных серверов RADIUS, а затем настройте политику запросов на подключение, которая перенаправляет запросы в эту группу удаленных серверов RADIUS. В этой конфигурации сервер политики сети может перенаправлять запросы на проверку подлинности на любой сервер RADIUS, и пользователи с учетными записями в недоверенных доменах могут пройти проверку подлинности.

На следующем рисунке показан путь Access-Request сообщения от сервера доступа к сети к прокси-серверу RADIUS, а затем на сервере RADIUS в группе удаленных серверов RADIUS. На прокси-сервере RADIUS сервер сетевого доступа настроен в качестве RADIUS-клиента. и на каждом сервере RADIUS прокси-сервер RADIUS настраивается как клиент RADIUS.


![Обработка запроса на подключение к NPS](../../media/Nps-Connection-Request-Processing/Nps-Connection-Request-Processing.jpg)


>[!NOTE]
>Серверы сетевого доступа, используемые с NPS, могут быть устройствами шлюза, совместимыми с протоколом RADIUS, такими как точки беспроводного доступа 802.1 X и коммутаторами проверки подлинности, серверами с удаленным доступом, настроенными как VPN или серверы удаленного доступа, или другими устройствами, совместимыми с RADIUS.

Если требуется, чтобы сервер политики сети обрабатывал некоторые запросы проверки подлинности локально при пересылке других запросов в группу удаленных серверов RADIUS, настройте несколько политик запросов на подключение.

Сведения о настройке политики запросов на подключение, указывающей, какая группа серверов политики сети или сервера RADIUS обрабатывает запросы проверки подлинности, см. в разделе политики запросов на подключение.

Чтобы указать сервер политики сети или другие серверы RADIUS, на которые перенаправляются запросы на проверку подлинности, см. Раздел удаленные группы серверов RADIUS.

## <a name="nps-as-a-radius-server-connection-request-processing"></a>Сервер политики сети как обработка запроса на соединение с сервером RADIUS

При использовании NPS в качестве сервера RADIUS сообщения RADIUS обеспечивают проверку подлинности, авторизацию и учет подключений доступа к сети следующим образом.

1. Серверы доступа, такие как серверы удаленного доступа к сети, VPN-серверы и точки беспроводного доступа, получают запросы на подключение от клиентов доступа.

2. Сервер доступа, настроенный на использование RADIUS в качестве протокола проверки подлинности, авторизации и учета, создает Access-Request сообщение и отправляет его в NPS.

3. Сервер политики сети оценивает Access-Request сообщение.

4. При необходимости сервер политики сети отправляет сообщение Access-Challenge серверу доступа. Сервер доступа обрабатывает запрос и отправляет обновленную Access-Request на сервер политики сети.

5. Проверяются учетные данные пользователя, а свойства входящих звонков учетной записи пользователя получаются с помощью безопасного подключения к контроллеру домена.

6. Авторизация выполняется с помощью свойств входящих звонков учетной записи пользователя и политики сети.

7. Если попытка подключения проходит проверку подлинности и авторизацию, NPS отправляет на сервер доступа Access-Accept сообщение. Если попытка подключения не прошла проверку подлинности или не авторизована, NPS отправляет на сервер доступа Access-Reject сообщение.

8. Сервер доступа завершает процесс подключения с клиентом доступа и отправляет сообщение Accounting-Request на сервер политики сети, где сообщение заносится в журнал.

9. NPS отправляет Accounting-Response на сервер доступа.

>[!NOTE]
>Сервер доступа также отправляет сообщения Accounting-Request в течение времени, когда подключение установлено, когда подключение клиента Access закрывается и когда сервер доступа запускается и останавливается.

## <a name="nps-as-a-radius-proxy-connection-request-processing"></a>Обработка запросов NPS в качестве прокси-сервера RADIUS

Если сервер политики сети используется в качестве прокси-сервера RADIUS между клиентом RADIUS и сервером RADIUS, сообщения RADIUS для подключений доступа к сети перенаправляются следующим образом:

1. Серверы доступа, такие как серверы удаленного доступа к сети, серверы виртуальной частной сети (VPN) и точки беспроводного доступа, получают запросы на подключение от клиентов доступа.

2. Сервер доступа, настроенный на использование RADIUS в качестве протокола проверки подлинности, авторизации и учета, создает Access-Request сообщение и отправляет его в NPS, который используется в качестве прокси-сервера RADIUS сервера политики сети.

3. Прокси-сервер политики сети RADIUS получает сообщение Access-Request и, в зависимости от настроенных локально политик запросов на подключение, определяет, куда перенаправлять сообщение Access-Request.

4. Прокси-сервер NPS RADIUS перенаправляет Access-Request сообщение на соответствующий сервер RADIUS.

5. Сервер RADIUS оценивает Access-Request сообщение.

6. При необходимости сервер RADIUS отправляет Access-Challenge сообщение прокси-серверу NPS, где он перенаправляется на сервер доступа. Сервер доступа обрабатывает проблему с клиентом доступа и отправляет обновленную Access-Request прокси-серверу NPS, который перенаправляется на сервер RADIUS.

7. Сервер RADIUS выполняет проверку подлинности и авторизует попытки подключения.

8. Если попытка подключения проходит проверку подлинности и авторизацию, сервер RADIUS отправляет Access-Accept сообщение прокси-серверу NPS, где он перенаправляется на сервер доступа. Если попытка подключения не прошла проверку подлинности или не авторизована, сервер RADIUS отправляет Access-Reject сообщение прокси-серверу NPS, где он перенаправляется на сервер доступа.

9. Сервер доступа завершает процесс подключения с клиентом доступа и отправляет сообщение Accounting-Request прокси-серверу NPS. Прокси-сервер NPS RADIUS регистрирует данные учета и перенаправляет их на сервер RADIUS.

10. Сервер RADIUS отправляет Accounting-Response прокси-серверу NPS, который перенаправляется на сервер доступа.

Дополнительные сведения о NPS см. в разделе [сервер политики сети (NPS)](nps-top.md).
