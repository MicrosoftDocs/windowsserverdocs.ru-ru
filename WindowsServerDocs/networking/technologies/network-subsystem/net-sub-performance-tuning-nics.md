---
title: Сетевые адаптеры настройки производительности
description: Этот раздел является частью руководств по настройке производительности сетевой подсистемы для Windows Server 2016.
ms.prod: windows-server
ms.technology: networking
ms.topic: article
ms.assetid: 0b9b0f80-415c-4f5e-8377-c09b51d9c5dd
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: e9c0ba73a1df874edc63001812d059a9e70f187f
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405523"
---
# <a name="performance-tuning-network-adapters"></a>Сетевые адаптеры настройки производительности

>Относится к: Windows Server (Semi-Annual Channel), Windows Server 2016

Этот раздел можно использовать для настройки производительности сетевых адаптеров, установленных на компьютерах под управлением Windows Server 2016.

Определение правильных настроек для сетевого адаптера зависит от следующих факторов:

- сетевой адаптер и набор его функций;  

- тип рабочей нагрузки, выполняемой сервером;  

- аппаратные и программные ресурсы сервера;  

- задачи настройки сервера.  

Если сетевой адаптер предоставляет возможности настройки, то на основании приведенных выше факторов можно оптимизировать пропускную способность сети и использование ресурсов.  

В следующих разделах описывается ряд параметров настройки производительности.  

##  <a name="bkmk_offload"></a>Включение функций разгрузки

Включение функций разгрузки на сетевом адаптере обычно имеет положительный эффект. Однако иногда сетевой адаптер недостаточно производителен, чтобы осуществлять функции разгрузки с высокой пропускной способностью.

>[!IMPORTANT]
>Не используйте разгрузку **задач IPSec** функции разгрузки или **разгрузку TCP Chimney**. Эти технологии являются устаревшими в Windows Server 2016 и могут негативно сказаться на производительности сервера и сети. Кроме того, эти технологии могут не поддерживаться корпорацией Майкрософт в будущем.

Например, включение разгрузки сегментации может снизить максимальную устойчивую пропускную способность некоторых сетевых адаптеров из-за ограниченности аппаратных ресурсов. Однако если снижение пропускной способности не будет ограничением, функции разгрузки рекомендуется включать даже для подобных сетевых адаптеров.

>[!NOTE]
> В некоторых сетевых адаптерах функции разгрузки нужно включать по отдельности для пути отправки и приема.

##  <a name="bkmk_rss_web"></a>Включение масштабирования на стороне приема (RSS) для веб-серверов

RSS способно повысить веб-масштабируемость и производительность, когда число сетевых адаптеров меньше количества логических процессоров на сервере. Когда весь веб-трафик проходит через сетевые адаптеры с поддержкой RSS, входящие веб-запросы из разных соединений могут одновременно обрабатываться разными ЦП.

Важно отметить, что из-за логики в протоколе \(RSS и HTTP\) для распределения нагрузки производительность может быть значительно снижена, если сетевой адаптер, не поддерживающий RSS, принимает веб-трафик на сервере, который имеет один или другие сетевые адаптеры с поддержкой RSS. В этом случае необходимо использовать сетевые адаптеры, поддерживающие RSS, или отключить RSS на вкладке **Дополнительные свойства** в свойствах сетевого адаптера. Чтобы определить, поддерживает ли сетевой адаптер RSS, можно просмотреть сведения RSS на вкладке **Дополнительные свойства** в свойствах сетевого адаптера.

### <a name="rss-profiles-and-rss-queues"></a>Профили RSS и очереди RSS

Стандартный профиль RSS по умолчанию — NUMA static, который изменяет поведение по умолчанию из предыдущих версий операционной системы. Чтобы приступить к работе с профилями RSS, можно ознакомиться с доступными профилями, чтобы понять, когда они будут полезны и как их можно применять к своей сети или оборудованию.

Например, откройте диспетчер задач и просмотрите логические процессоры на сервере. Если они недостаточно загружены приемом трафика, можно попробовать увеличить число очередей RSS со значения 2 (по умолчанию) до максимального, которое поддерживается сетевым адаптером. В используемом сетевом адаптере могут быть параметры для изменения числа очередей RSS в драйвере.

##  <a name="bkmk_resources"></a>Увеличение ресурсов сетевого адаптера

Для сетевых адаптеров, которые позволяют вручную настраивать ресурсы, например буферы приема и передачи, следует увеличить выделение ресурсов. 

В некоторых сетевых адаптерах устанавливаются небольшие буферы приема для экономии выделенной памяти от узла. Это ведет к потере пакетов и снижению производительности. Поэтому для сценариев с интенсивным приемом рекомендуется увеличить буфер приема до максимума.

>[!NOTE]
>Если сетевой адаптер не позволяет настраивать ресурсы вручную, он либо настраивает их динамически, либо параметры ресурсов являются фиксированными.

### <a name="enabling-interrupt-moderation"></a>Включение управления прерываниями

Для прерываний в некоторых сетевых адаптерах предлагаются различные уровни управления прерываниями, параметры объединения буферов (иногда отдельно для буфера приема и передачи) или оба варианта.

Управление прерываниями имеет смысл применять для рабочих нагрузок, связанных с ЦП, также следует учитывать баланс между экономией процессорных ресурсов узла и задержкой и увеличением экономии процессорных ресурсов узла за счет большего числа прерываний и снижения задержки. Если сетевой адаптер не ведет управление прерываниями, но позволяет объединять буферы, то увеличение числа объединенных буферов для приема и передачи повышает общую производительность.

##  <a name="bkmk_low"></a>Настройка производительности для обработки пакетов с низкой задержкой

Многие сетевые адаптеры позволяют настраивать параметры для оптимизации системной задержки. Задержка — это время между обработкой входящего пакета сетевым драйвером и отправкой этого пакета обратно. Обычно это время измеряется в микросекундах. Для сравнения, время передачи для передачи пакетов на больших расстояниях обычно измеряется в миллисекундах \(в порядке увеличения.\) Эта настройка не сокращает время прохождения пакета.

Ниже приведены некоторые советы по настройке производительности для загруженных сетей, в которых на счету каждая микросекунда.

- В BIOS компьютера установите значение **High Performance** (Высокая производительность) и отключите C-состояния. Однако имейте в виду, что это зависит от системы и BIOS, и некоторые системы обеспечивают большую производительность, если операционная система управляет электропитанием. Проверить и настроить параметры управления питанием можно на странице **Параметры** или с помощью команды **powercfg** . Дополнительные сведения см. в разделе [Параметры командной строки Powercfg](https://technet.microsoft.com/library/cc748940.aspx) .

- Установите в операционной системе профиль управления электропитанием **Высокая производительность**. Имейте в виду, что он не будет работать надлежащим образом, если в BIOS компьютера отключен контроль операционной системы над управлением электропитанием.

- Включите статические разгрузки, например контрольные суммы UDP, контрольные суммы TCP и разгрузки большой отправки (LSO).

- Включите RSS, если трафик передается несколькими потоками, например при масштабной многоадресной рассылке.

-   Отключите **Управление прерываниями** в драйверах сетевых адаптеров, которым требуется самая низкая задержка. Помните, что оно может привести к увеличению загрузки процессора, таким образом это решение является компромиссом.

- Обрабатывайте прерывания сетевого адаптера и DPC на основном процессоре, который совместно использует процессорный кэш с ядром, которое используется программой (пользовательским потоком), обрабатывающей пакет. Для передачи процесса конкретным логическим процессорам можно использовать настройку фиксации ЦП вместе с настройкой RSS. Использование одного ядра для прерываний, DPC и пользовательского потока ведет к снижению производительности из-за увеличения нагрузки, поскольку ISR, DPC и поток будут конкурировать за ядро.

##  <a name="bkmk_smi"></a>Прерывания управления системой

\(Многие аппаратные системы используют прерывания SMI\) для различных функций обслуживания, включая отчеты об ошибках кода \(коррекции ошибок ECC\) , устаревшие совместимость с USB, Вентилятор Управление питанием и управляемой BIOS. 

Прерывание SMI имеет наивысший приоритет в системе и переводит ЦП в режим управления, который блокирует все другие действия, пока выполняется процедура служебного прерывания, обычно находящаяся в BIOS.

К сожалению, это может приводить к скачкообразному росту задержки до 100 микросекунд и выше. 

Когда необходимо обеспечить минимальную задержку, следует запросить у поставщика оборудования версию BIOS, в которой прерывания SMI имеют наименьший возможный приоритет. Обычно их называют "BIOS низкой задержки" или "BIOS без SMI". В некоторых случаях аппаратная платформа не может полностью устранить операции SMI, поскольку они используются для управления важными функциями (например для вентиляторов).

>[!NOTE]
>Операционная система не имеет контроля над SMI, потому что логический процессор работает в особом служебном режиме, который блокирует вмешательство операционной системы.

##  <a name="bkmk_tcp"></a>Настройка производительности TCP

 Настройку производительности TCP можно проводить с помощью следующих элементов.

###  <a name="bkmk_tcp_params"></a>Автоматическая настройка окна приема TCP

До выхода Windows Server 2008 в сетевом стеке использовалось окно приема фиксированного размера (65 535 байт), которое ограничивает общую возможную пропускную способность для подключений. Одним из самых существенных изменений в реализации стека TCP стало появление автонастройки окна получения TCP. 

При использовании окна приема TCP фиксированного размера можно вычислить общую пропускную способность отдельного соединения:

**Общая пропускная способность в байтах = размер окна приема TCP \* в байтах (1/задержка подключения в секундах)**

Например, общая доступная пропускная способность составляет всего 51 Мбит/с при подключении с 10 \(МС по разумному значению для большой корпоративной\)сетевой инфраструктуры. 

Однако при автонастройке окно получения регулируется и может вырастать в соответствии с требованиями отправителя. Подключение может обеспечить полную скорость линии для подключения 1 Гбит/с. Сценарии использования сети, которые в прошлом могли быть ограничены общей достижимой пропускной способностью TCP-соединений, теперь могут использовать сеть в полной мере.

#### <a name="deprecated-tcp-parameters"></a>Устаревшие параметры TCP

Следующие параметры реестра из Windows Server 2003 больше не поддерживаются и не учитываются в более поздних версиях.

Все эти параметры имеют следующее расположение реестра:

    ```  
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters  
    ```  

- TcpWindowSize

- NumTcbTablePartitions  

- MaxHashTableSize  



###  <a name="bkmk_wfp"></a>Платформа фильтрации Windows

Платформа фильтрации Windows (WFP), появившаяся в Windows Vista и Windows Server 2008, предоставляет API независимым поставщикам программного обеспечения (ISV) для создания фильтров обработки пакетов. Например, для брандмауэров и антивирусного ПО.

>[!NOTE]
>Плохо написанный фильтр WFP может значительно снизить производительность сети сервера. Дополнительные сведения см. в разделе [Перенос драйверов и приложений для обработки пакетов в WFP](https://msdn.microsoft.com/windows/hardware/gg463267.aspx) в центре разработки для Windows.


Ссылки на все разделы данного руководства см. в разделе [Настройка производительности сетевой подсистемы](net-sub-performance-top.md).
