---
title: Сетевые адаптеры настройки производительности
description: Этот раздел является частью руководства по настройке производительности сетевой подсистемы Windows Server 2016.
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: 0b9b0f80-415c-4f5e-8377-c09b51d9c5dd
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: d6d54f33108d1cdb936b02fc556acca1e5518b9b
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59861535"
---
# <a name="performance-tuning-network-adapters"></a>Сетевые адаптеры настройки производительности

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Можно использовать в этом разделе для производительности настройки сетевых адаптеров, установленных на компьютерах, работающих под управлением Windows Server 2016.

Определение правильных настроек для сетевого адаптера зависит от следующих факторов:

- сетевой адаптер и набор его функций;  

- тип рабочей нагрузки, выполняемой сервером;  

- аппаратные и программные ресурсы сервера;  

- задачи настройки сервера.  

Если сетевой адаптер предоставляет возможности настройки, то на основании приведенных выше факторов можно оптимизировать пропускную способность сети и использование ресурсов.  

В следующих разделах описывается ряд параметров настройки производительности.  

##  <a name="bkmk_offload"></a> Включение функций разгрузки

Включение функций разгрузки на сетевом адаптере обычно имеет положительный эффект. Однако иногда сетевой адаптер недостаточно производителен, чтобы осуществлять функции разгрузки с высокой пропускной способностью.

>[!IMPORTANT]
>Не использовать функции разгрузки **Разгрузка задач IPsec** или **разгрузки TCP Chimney**. Эти технологии являются устаревшими в Windows Server 2016 и может неблагоприятно повлиять на сервер и производительности сети. Кроме того эти технологии могут не поддерживаться корпорацией Майкрософт в будущем.

Например, включение разгрузки сегментации может снизить максимальную устойчивую пропускную способность некоторых сетевых адаптеров из-за ограниченности аппаратных ресурсов. Однако если снижение пропускной способности не будет ограничением, функции разгрузки рекомендуется включать даже для подобных сетевых адаптеров.

>[!NOTE]
> В некоторых сетевых адаптерах функции разгрузки нужно включать по отдельности для пути отправки и приема.

##  <a name="bkmk_rss_web"></a> Включение принимающая сторона, масштабирование (RSS) для веб-серверов

RSS способно повысить веб-масштабируемость и производительность, когда число сетевых адаптеров меньше количества логических процессоров на сервере. Когда весь веб-трафик проходит через сетевые адаптеры с поддержкой RSS, входящие веб-запросы из разных соединений могут одновременно обрабатываться разными ЦП.

Важно отметить, что из-за логики в RSS-Каналов и протокола передачи гипертекста \(HTTP\) для распределения нагрузки, производительность может быть сильно ухудшается значение, если не поддерживающий RSS сетевой адаптер принимает веб-трафика на сервере, который имеет один или RSS с возможностями сетевые адаптеры. В этом случае необходимо использовать сетевые адаптеры, поддерживающие RSS, или отключить RSS на вкладке **Дополнительные свойства** в свойствах сетевого адаптера. Чтобы определить, поддерживает ли сетевой адаптер RSS, можно просмотреть сведения RSS на вкладке **Дополнительные свойства** в свойствах сетевого адаптера.

### <a name="rss-profiles-and-rss-queues"></a>Профили RSS и очереди RSS

Предопределенные RSS профиль по умолчанию является NUMA Static, который изменяет поведение по умолчанию из предыдущих версий операционной системы. Чтобы приступить к работе с профилями RSS, можно ознакомиться с доступными профилями, чтобы понять, когда они будут полезны и как их можно применять к своей сети или оборудованию.

Например, откройте диспетчер задач и просмотрите логические процессоры на сервере. Если они недостаточно загружены приемом трафика, можно попробовать увеличить число очередей RSS со значения 2 (по умолчанию) до максимального, которое поддерживается сетевым адаптером. В используемом сетевом адаптере могут быть параметры для изменения числа очередей RSS в драйвере.

##  <a name="bkmk_resources"></a> Увеличение ресурсов для сетевых адаптеров

Для сетевых адаптеров, которые позволяют вручную настраивать ресурсы, например буферы приема и передачи, следует увеличить выделение ресурсов. 

В некоторых сетевых адаптерах устанавливаются небольшие буферы приема для экономии выделенной памяти от узла. Это ведет к потере пакетов и снижению производительности. Поэтому для сценариев с интенсивным приемом рекомендуется увеличить буфер приема до максимума.

>[!NOTE]
>Если сетевой адаптер не позволяет настраивать ресурсы вручную, он либо настраивает их динамически, либо параметры ресурсов являются фиксированными.

### <a name="enabling-interrupt-moderation"></a>Включение управления прерываниями

Для прерываний в некоторых сетевых адаптерах предлагаются различные уровни управления прерываниями, параметры объединения буферов (иногда отдельно для буфера приема и передачи) или оба варианта.

Управление прерываниями имеет смысл применять для рабочих нагрузок, связанных с ЦП, также следует учитывать баланс между экономией процессорных ресурсов узла и задержкой и увеличением экономии процессорных ресурсов узла за счет большего числа прерываний и снижения задержки. Если сетевой адаптер не ведет управление прерываниями, но позволяет объединять буферы, то увеличение числа объединенных буферов для приема и передачи повышает общую производительность.

##  <a name="bkmk_low"></a> Настройка производительности для обработки пакетов с низкой задержкой

Многие сетевые адаптеры позволяют настраивать параметры для оптимизации системной задержки. Задержка — это время между обработкой входящего пакета сетевым драйвером и отправкой этого пакета обратно. Обычно это время измеряется в микросекундах. Для сравнения время передачи для передачи пакетов на длинные дистанции обычно измеряется в миллисекундах \(на порядок больше\). Эта настройка не сокращает время прохождения пакета.

Ниже приведены некоторые советы по настройке производительности для загруженных сетей, в которых на счету каждая микросекунда.

- В BIOS компьютера установите значение **High Performance** (Высокая производительность) и отключите C-состояния. Однако имейте в виду, что это зависит от системы и BIOS, и некоторые системы обеспечивают большую производительность, если операционная система управляет электропитанием. Вы можете проверить и изменить параметры управления электропитанием из **параметры** или с помощью **powercfg** команды. Дополнительные сведения см. в разделе [параметры командной строки Powercfg](https://technet.microsoft.com/library/cc748940.aspx)

- Установите в операционной системе профиль управления электропитанием **Высокая производительность**. Имейте в виду, что он не будет работать надлежащим образом, если в BIOS компьютера отключен контроль операционной системы над управлением электропитанием.

- Включите статические разгрузки, например контрольные суммы UDP, контрольные суммы TCP и разгрузки большой отправки (LSO).

- Включите RSS, если трафик передается несколькими потоками, например при масштабной многоадресной рассылке.

-   Отключите **Управление прерываниями** в драйверах сетевых адаптеров, которым требуется самая низкая задержка. Помните, что оно может привести к увеличению загрузки процессора, таким образом это решение является компромиссом.

- Обрабатывайте прерывания сетевого адаптера и DPC на основном процессоре, который совместно использует процессорный кэш с ядром, которое используется программой (пользовательским потоком), обрабатывающей пакет. Для передачи процесса конкретным логическим процессорам можно использовать настройку фиксации ЦП вместе с настройкой RSS. Использование одного ядра для прерываний, DPC и пользовательского потока ведет к снижению производительности из-за увеличения нагрузки, поскольку ISR, DPC и поток будут конкурировать за ядро.

##  <a name="bkmk_smi"></a> Прерывания управления системой

Использовать во многих аппаратных системах прерывания управления системы \(SMI\) для различных функций обслуживания, включая отчеты об код коррекции ошибок \(ECC\) ошибки памяти и устаревшего USB, вентилятора элемент управления, а также BIOS Управление электропитанием. 

Прерывание SMI имеет наивысший приоритет в системе и переводит ЦП в режим управления, который блокирует все другие действия, пока выполняется процедура служебного прерывания, обычно находящаяся в BIOS.

К сожалению, это может приводить к скачкообразному росту задержки до 100 микросекунд и выше. 

Когда необходимо обеспечить минимальную задержку, следует запросить у поставщика оборудования версию BIOS, в которой прерывания SMI имеют наименьший возможный приоритет. Обычно их называют "BIOS низкой задержки" или "BIOS без SMI". В некоторых случаях аппаратная платформа не может полностью устранить операции SMI, поскольку они используются для управления важными функциями (например для вентиляторов).

>[!NOTE]
>Операционная система не имеет контроля над SMI, потому что логический процессор работает в особом служебном режиме, который блокирует вмешательство операционной системы.

##  <a name="bkmk_tcp"></a> Настройка производительности TCP

 Настройку производительности TCP можно проводить с помощью следующих элементов.

###  <a name="bkmk_tcp_params"></a>  Автоматическая настройка окна приема TCP

До появления Windows Server 2008 в сетевом стеке использовалось окно фиксированного размера на стороне приема (65 535 байт), ограниченный общую пропускную способность для подключений. Одним из самых существенных изменений в реализации стека TCP стало появление автонастройки окна получения TCP. 

При использовании фиксированного размера, в окне приема TCP, можно рассчитать общую пропускную способность одного соединения:

**Общая достижимая пропускная способность в байтах = TCP размер окна приема в байтах \* (1 / задержка соединения в секундах)**

Например, общая достижимая пропускная способность — только 51 Мбит/с для соединения с задержкой 10 мс \(разумное значение для сетевой инфраструктуры крупного предприятия\). 

Однако при автонастройке окно получения регулируется и может вырастать в соответствии с требованиями отправителя. Вполне возможно, для подключения, чтобы достичь скорости полная строка подключения 1 Гбит/с. Сценарии использования сети, которые в прошлом могли быть ограничены общей достижимой пропускной способностью TCP-соединений, теперь могут использовать сеть в полной мере.

#### <a name="deprecated-tcp-parameters"></a>Устаревшие параметры TCP

Следующие параметры реестра из Windows Server 2003 больше не поддерживаются и игнорируются в более поздних версиях.

Все эти параметры имели следующий раздел реестра:

    ```  
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters  
    ```  

- TcpWindowSize

- NumTcbTablePartitions  

- MaxHashTableSize  



###  <a name="bkmk_wfp"></a> Платформа фильтрации Windows

Windows Filtering Platform (WFP), появившихся в Windows Vista и Windows Server 2008 предоставляет API-интерфейсы для сторонних независимым поставщикам программного обеспечения (ISV) создания фильтров обработки пакетов. Например, для брандмауэров и антивирусного ПО.

>[!NOTE]
>Плохой фильтр WFP может существенно снижать сетевую производительность сервера. Дополнительные сведения см. в разделе [обработкой перенос пакетов драйверов и приложений для WFP](https://msdn.microsoft.com/windows/hardware/gg463267.aspx) в центре разработки для Windows.


Ссылки на все разделы в этом руководстве, см. в разделе [Настройка производительности сетевой подсистемы](net-sub-performance-top.md).
