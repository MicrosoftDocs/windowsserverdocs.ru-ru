---
title: Выбор сетевого адаптера
description: Этот раздел входит руководство Настройка производительности сетевой подсистемы для Windows Server 2016.
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: a6615411-83d9-495f-8a6a-1ebc8b12f164
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 4b3b9d206273dfd0e9115ebc27cf28aa960bfb0f
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="choosing-a-network-adapter"></a>Выбор сетевого адаптера

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать для получения некоторых функций сетевых адаптеров, которые могут повлиять на выбор покупки.

Приложений с интенсивным использованием сети требуют высокой производительности сетевых адаптеров. В этом разделе описаны некоторые рекомендации по выбору сетевых адаптеров, а также настройка параметров различных сетевого адаптера, чтобы обеспечить наилучшую производительность сети.

> [!TIP]
>  Параметры сетевого адаптера можно настроить с помощью Windows PowerShell. Дополнительные сведения см. в разделе [командлеты сетевого адаптера в Windows PowerShell](https://technet.microsoft.com/library/jj134956.aspx).

##  <a name="bkmk_offload"></a>Возможности разгрузки

Разгрузка задач с центрального процессора \(CPU\) для сетевого адаптера можно уменьшить загрузку ЦП на сервере, что повышает общую производительность системы.

Сетевой стек в продуктах Майкрософт может разгрузить один или дополнительные задачи сетевой адаптер, если вы выберите сетевой адаптер, в соответствии возможностями разгрузки операций. Ниже приводится краткий обзор различных возможностей, доступных в Windows Server 2016.
  
|Разгрузка типа|Описание|
|------------------|-----------------|  
|Расчет контрольной суммы для TCP|Сетевой стек может разгрузить расчета и проверки контрольных сумм \(TCP\) протокола управления передачей на отправку и получение путей кода. Можно также Разгрузка расчета и проверки IPv4 и IPv6 контрольные суммы для отправки и получения путей кода.|  
|Расчет контрольной суммы для UDP |Сетевой стек может разгрузить расчета и проверки контрольных сумм \(UDP\) протокола передачи датаграмм пользователя на отправку и получение путей кода.|
|Расчет контрольной суммы для протокола IPv4 |Сетевой стек может разгрузить расчета и проверки IPv4 контрольные суммы для отправки и получения путей кода. |
|Расчет контрольной суммы для IPv6 |Сетевой стек может разгрузить расчета и проверки IPv6 контрольные суммы для отправки и получения путей кода. | 
|Сегментирование больших пакетов TCP|На транспортном уровне TCP/IP поддерживает v2 Разгрузка большой отправки (LSOv2). С LSOv2 на транспортном уровне TCP/IP позволяет разгрузить сегментацию больших пакетов TCP для сетевого адаптера.|  
|\(RSS\) масштабирования на стороне приема|RSS — это технология драйверов сети, позволяет эффективно распределять сети обработка приема несколько ЦП в многопроцессорных системах. Дополнительные сведения о технологии RSS приведены ниже в этом разделе.|  
|Получение объединение \(RSC\) сегментов|RSC — это возможность пакетов группы вместе, чтобы свести к минимуму заголовке, обработка, необходимые для узла, для выполнения. Не более 64 КБ полученных полезных данных можно объединенных в один пакет большего размера для обработки. Дополнительные сведения о RSC приведены ниже в этом разделе.|  
  
###  <a name="bkmk_rss"></a>Масштабирование на стороне приема

Windows Server 2016, Windows Server 2012, Windows Server 2012 R2, Windows Server 2008 R2 и Windows Server 2008 поддерживает \(RSS\) масштабирование на стороне приема. 

Некоторые серверы настроены несколько логических процессоров, общий доступ к аппаратным ресурсам \ (например физической core\) и которого рассматриваются как одновременных многопоточность \(SMT\) одноранговых элементов. Технология Hyper-Threading Intel приведен пример. RSS направляет обработкой сетевого трафика с одним логическим процессором на каждое ядро. Например на сервере с Intel Hyper-Threading, 4 ядра и логических процессоров 8 RSS использует не более 4 логических процессоров для обработки сетевых.  

RSS распределяет входящие сетевые пакеты ввода-вывода между логических процессоров, чтобы пакеты, которые относятся к же TCP-соединение, обрабатываются на же логического процессора, сохранив при этом заказе. 

RSS также загрузить одноадресной балансов UDP и многоадресный трафик и он направляет связанные потоки \ (что определяется хэширования addresses\ источника и назначения) для одного логического процессора, сохраняя порядок связанных прибытия. Это позволяет повысить масштабируемость и производительность для сценариев с интенсивным приемом для серверов, которые имеют меньшее число сетевых адаптеров, чем допустимых логических процессоров. 

#### <a name="configuring-rss"></a>Настройка RSS

В Windows Server 2016 RSS можно настроить с помощью командлетов Windows PowerShell и профили RSS. 

Профили RSS можно определить с помощью **— профиль** параметр **Set-NetAdapterRss** командлета Windows PowerShell.

**Команды Windows PowerShell для настройки RSS**

Следующие командлеты позволяют просмотреть и изменить параметры RSS на сетевой адаптер.
  
>[!NOTE]
>Для ссылки на подробные команду для каждого командлета, включая синтаксис и параметры вы можете по следующим ссылкам. Кроме того, можно передать имя командлета, чтобы **Get-Help** в командной строке Windows PowerShell, сведения о каждой команды.  

- [Disable-NetAdapterRss](https://technet.microsoft.com/library/jj130892). Эта команда отключает RSS на сетевом адаптере, указанном вами.

- [Enable-NetAdapterRss](https://technet.microsoft.com/library/jj130859). Эта команда включает RSS на сетевом адаптере, указанном вами.
  
- [Get-NetAdapterRss](https://technet.microsoft.com/library/jj130912). Эта команда возвращает RSS свойства сетевого адаптера, которое вы указываете.
  
- [SET-NetAdapterRss](https://technet.microsoft.com/library/jj130863). Эта команда задает свойства RSS на сетевом адаптере, указанном вами.  

#### <a name="rss-profiles"></a>Профили RSS

Можно использовать **— профиль** командлет Set-NetAdapterRss, чтобы указать, какие логические процессоры назначаются сетевой адаптер, который параметром. Доступные значения для этого параметра::

- **Ближайший**. Предпочтительнее номера логического процессора, которые находятся рядом процессор RSS базового сетевого адаптера. С этим профилем операционной системы может заново сбалансировать динамически в зависимости от нагрузки логических процессоров.
  
- **ClosestStatic**. Предпочтительнее логического процессора цифр у базового процессор RSS сетевого адаптера. С этим профилем операционной системы не перераспределять динамически в зависимости от нагрузки логических процессоров.
  
- **NUMA**. Распределять нагрузку на разные узлы NUMA обычно выбраны номера логических процессоров. С этим профилем операционной системы может заново сбалансировать динамически в зависимости от нагрузки логических процессоров.
  
- **NUMAStatic**. Это **по умолчанию профиль**. Распределять нагрузку на разные узлы NUMA обычно выбраны номера логических процессоров. С данным профилем операционной системы не будут заново сбалансировать динамически в зависимости от нагрузки логических процессоров.

- **Консервативная**. RSS использует минимально как несколько процессоров для обработки нагрузки. Этот параметр позволяет сократить число прерываний.

В зависимости от сценария и характеристики рабочей нагрузки, можно также использовать другие параметры **Set-NetAdapterRss** командлета Windows PowerShell, укажите следующее:

- Количество логических процессоров на отдельно для каждого сетевого адаптера, можно использовать для RSS.
- Начальное смещение ряд логических процессоров.
- Узел, с которого сетевой адаптер выделяет память.

Ниже приведены дополнительные **Set-NetAdapterRss** параметры, которые можно использовать для настройки RSS:

>[!NOTE]
>В примере синтаксиса для каждого параметра ниже имя сетевого адаптера **Ethernet** используется в качестве примера значение **— имя** параметр **Set-NetAdapterRss** команды. При запуске командлета обеспечить имя сетевого адаптера, который можно использовать подходящий для вашей среды.

- **\ * MaxProcessors**: задает максимальное число процессоров RSS для использования. Это гарантирует, что приложение трафика привязан к максимальное количество процессоров на данный интерфейс. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –MaxProcessors <value>`

- **\ * BaseProcessorGroup**: задает группу базового процессора узла NUMA. Это влияет на массив процессора, используемый RSS. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –BaseProcessorGroup <value>`
  
- **\ * MaxProcessorGroup**: задает группу процессора Max узле NUMA. Это влияет на массив процессора, используемый RSS. Это будет предоставлять максимальное процессорной группой балансировки нагрузки выравнивается в группе k. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –MaxProcessorGroup <value>`

- **\ * BaseProcessorNumber**: задает номер базового процессора узла NUMA. Это влияет на массив процессора, используемый RSS. Это позволяет секционирования процессоров через сетевые адаптеры. Это первый логического процессора в процессорах диапазон RSS, назначенный каждому адаптеру. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –BaseProcessorNumber <Byte Value>`

- **\ * NumaNode**: узел NUMA, каждого сетевого адаптера можно выделить память. Это может быть в пределах группы k или из разных k групп. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –NumaNodeID <value>`

- **\ * NumberofReceiveQueues**: кажется загружены приемом трафика логических процессоров \ (например, как показано на Manager\ задач), можно попробовать увеличить число очередей RSS со значения по умолчанию 2 до максимального, которое поддерживается сетевым адаптером. Сетевой адаптер может иметь параметры для изменения числа очередей RSS в драйвере. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –NumberOfReceiveQueues <value>`

Дополнительные сведения, щелкните ссылку ниже, чтобы загрузить [масштабируемые сети: устраняя узким обработки получать — Представляем RSS](https://download.microsoft.com/download/5/D/6/5D6EAF2B-7DDF-476B-93DC-7CF0072878E6/NDIS_RSS.doc) в формате Microsoft Word.
  
#### <a name="understanding-rss-performance"></a>Общие сведения о производительности RSS

Настройка RSS требует основные сведения о конфигурации и логика балансировки нагрузки. Убедитесь, что RSS параметры вступили в силу, выходные данные можно просмотреть при запуске **Get-NetAdapterRss** командлета Windows PowerShell. Ниже приведен пример выходных данных для этого командлета.
  
```

PS C:\Users\Administrator> get-netadapterrss  
Name                           : testnic 2  
InterfaceDescription           : Broadcom BCM5708C NetXtreme II GigE (NDIS VBD Client) #66
Enabled                        : True
NumberOfReceiveQueues          : 2
Profile                        : NUMAStatic
BaseProcessor: [Group:Number]  : 0:0
MaxProcessor: [Group:Number]   : 0:15
MaxProcessors                  : 8
  
IndirectionTable: [Group:Number]:
     0:0    0:4    0:0    0:4    0:0    0:4    0:0    0:4  
…   
(# indirection table entries are a power of 2 and based on # of processors)  
…   
                          0:0    0:4    0:0    0:4    0:0    0:4    0:0    0:4  
```  

В дополнение к вывести параметры, которые были установлены, ключевой аспект выходных данных применяется в выходных данных таблицы косвенных обращений. Таблица косвенных обращений отображает сегменты хэш таблицы, которые используются для распределения входящего трафика. В этом примере нотацию n:c обозначает Numa K-пара индекс группы: ЦП, которая используется для передачи входящего трафика. Мы видим 2 уникальные записи (0:0 и 0:4), которые представляют группы k 0 и cpu0 k группы 0 и ЦП 4, соответственно.

Существует только одна группа k для этой системы (k группа 0) и n (где n < = 128) записи таблицы косвенных обращений. Поскольку число очередей приема задано значение 2, только 2 процессора (0:0, 0:4) выбираются - несмотря на то, что максимальное процессоров установлен на 8. В результате таблица косвенных обращений хэширования входящего трафика с использованием 2 ЦП вне 8, которые доступны только.

Использование всех процессорах, номер получать очередей RSS должен быть равен или больше, чем Макс процессоров. В предыдущем примере следует задать очереди получения 8 или более поздней версии.

#### <a name="nic-teaming-and-rss"></a>Объединение сетевых КАРТ и RSS

Можно включить RSS на сетевом адаптере, объединенных с помощью другой сетевой карты с помощью объединения сетевых КАРТ. В этом сценарии можно настроить только базовый физический сетевой адаптер для использования RSS. Пользователь не может задать командлеты RSS на объединенного сетевого адаптера.
  
###  <a name="bkmk_rsc"></a>Объединение полученных сегментов (RSC)

Объединение сегмент \(RSC\) помогает производительность приема, уменьшая количество заголовков IP, которые обрабатываются для объем данных, полученных данных. Его можно использовать для масштабирования производительности полученных данных путем группирования \(or coalescing\) небольших пакетов в крупных единиц.

Этот подход может повлиять на задержки преимущества, главным образом встречается прирост производительности. RSC рекомендуется увеличить пропускную способность для полученных высоких рабочих нагрузок. Рассмотрите возможность развертывания сетевых адаптеров с поддержкой RSC. 

Эти сетевые адаптеры и убедитесь, что включен RSC \ (значение по умолчанию setting\), если у вас есть конкретных рабочих нагрузок \ (например, с небольшими задержками, networking\ пропускной способности), Показать преимущества, отключить RSC.

#### <a name="understanding-rsc-diagnostics"></a>Общее представление о RSC диагностики

Можно проводить диагностику RSC с помощью командлетов Windows PowerShell **Get-NetAdapterRsc** и **Get-NetAdapterStatistics**.

Ниже приведен пример выходных данных при запуске командлета Get-NetAdapterRsc.

```  

PS C:\Users\Administrator> Get-NetAdapterRsc  
  
Name                       IPv4Enabled  IPv6Enabled  IPv4Operational IPv6Operational               IPv4FailureReason              IPv6Failure  
                                            Reason  
----                           -----------  -----------  --------------- --------------- ----------------- ------------  
Ethernet                       True         False        True            False                  NoFailure       NicProperties  
  
```  

**Получить** командлет показывает, включена ли технология RSC в интерфейсе и ли TCP обеспечивает RSC быть в операционном состоянии. Причина сбоя содержит сведения об ошибках для включения RSC в этом интерфейсе.

В предыдущем сценарии IPv4 RSC, оно поддерживаемых рабочих в интерфейсе. Для понимания диагностики ошибок, один см объединенных байтов или причиной исключения. Указываются объединения проблемы.

Ниже приведен пример выходных данных при запуске командлета Get-NetAdapterStatistics.

```  
PS C:\Users\Administrator> $x = Get-NetAdapterStatistics “myAdapter”   
PS C:\Users\Administrator> $x.rscstatistics  
  
CoalescedBytes       : 0  
CoalescedPackets     : 0  
CoalescingEvents     : 0  
CoalescingExceptions : 0  
  
```  

#### <a name="rsc-and-virtualization"></a>RSC и виртуализации

RSC поддерживается только на физическом узле, когда сетевого адаптера узла не привязан к виртуальному коммутатору Hyper-V. RSC отключена операционной системой, когда узел привязан к виртуальному коммутатору Hyper-V. Кроме того виртуальные машины не пользуются преимуществами RSC, так как виртуальные сетевые адаптеры не поддерживают RSC.

RSC можно включить для виртуальной машины при включении \(SR-IOV\) один корневой виртуализации ввода-вывода. В этом случае виртуальные функции поддержки возможности RSC; Таким образом виртуальные машины также получают преимущества RSC.

##  <a name="bkmk_resources"></a>Ресурсов для сетевых адаптеров

Несколько сетевых адаптеров активно управлять их ресурсами для достижения оптимальной производительности. Несколько сетевых адаптеров позволяют вручную настраивать ресурсы с помощью **дополнительные сети** вкладку для адаптера. Для таких адаптеров можно задать значения ряд параметров, включая число буферы приема и отправки буферов.

Настройка ресурсов для сетевых адаптеров упрощается, можно использовать следующие командлеты Windows PowerShell.

- [Get-NetAdapterAdvancedProperty](https://technet.microsoft.com/library/jj130901.aspx)

- [SET-NetAdapterAdvancedProperty](https://technet.microsoft.com/library/jj130894.aspx)

- [Enable-NetAdapter](https://technet.microsoft.com/library/jj130876.aspx)

- [Включить NetAdapterBinding](https://technet.microsoft.com/library/jj130913.aspx)

- [Включить NetAdapterChecksumOffload](https://technet.microsoft.com/library/jj130918.aspx)

- [Включить NetAdapterIPSecOffload](https://technet.microsoft.com/library/jj130890.aspx)

- [Включить NetAdapterLso](https://technet.microsoft.com/library/jj130922.aspx)

- [Включить NetAdapterPowerManagement](https://technet.microsoft.com/library/jj130907.aspx)

- [Enable-NetAdapterQos](https://technet.microsoft.com/library/jj130866.aspx)

- [Включить NetAdapterRDMA](https://technet.microsoft.com/library/jj130909.aspx)

- [Enable-NetAdapterSriov](https://technet.microsoft.com/library/jj130899.aspx)

Дополнительные сведения см. в разделе [командлеты сетевого адаптера в Windows PowerShell](https://technet.microsoft.com/library/jj134956.aspx).

Ссылки на все разделы в этом руководстве в разделе [Настройка производительности сетевой подсистемы](net-sub-performance-top.md).