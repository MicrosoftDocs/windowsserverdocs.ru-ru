---
title: Выбор сетевого адаптера
description: Этот раздел является частью руководства по настройке производительности сетевой подсистемы Windows Server 2016.
ms.prod: windows-server-threshold
ms.technology: networking
ms.topic: article
ms.assetid: a6615411-83d9-495f-8a6a-1ebc8b12f164
manager: brianlic
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 2b50f4b286e90a450278243c0294ea0aa7f221bc
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59875855"
---
# <a name="choosing-a-network-adapter"></a>Выбор сетевого адаптера

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Можно использовать в этом разделе вы ознакомитесь с некоторыми из особенностей сетевых адаптеров, которые могут повлиять на выбранные варианты приобретения.

Ресурсоемких приложений требуют высокой производительности сетевых адаптеров. В этом разделе рассматриваются некоторые рекомендации по выбору сетевых адаптеров, а также способы настройки параметров адаптера другую сеть для обеспечения лучшей производительности сети.

> [!TIP]
>  Параметры сетевого адаптера можно настроить с помощью Windows PowerShell. Дополнительные сведения см. в разделе [командлеты сетевого адаптера в Windows PowerShell](https://technet.microsoft.com/library/jj134956.aspx).

##  <a name="bkmk_offload"></a> Возможности разгрузки

Разгрузка задач из центрального процессора \(ЦП\) к сети адаптера можно уменьшить загрузку ЦП на сервере, что повышает общую производительность системы.

Сетевого стека в продуктах корпорации Майкрософт может разгрузить один или больше задач, сетевой адаптер, если выбран сетевой адаптер, который имеет подходящее разгрузку. Следующая таблица содержит краткий обзор различных возможностей, доступных в Windows Server 2016.
  
|Разгрузка типа|Описание|
|------------------|-----------------|  
|Вычисление контрольной суммы для TCP|Сетевой стек может разгрузить вычисления и проверки протокол \(TCP\) контрольные суммы для отправки и получения путей кода. Можно также разгрузки вычислений и проверки IPv4 и IPv6 контрольные суммы для отправки и получения путей кода.|  
|Вычисление контрольной суммы для UDP |Сетевой стек может разгрузить вычисления и проверки протокол UDP \(UDP\) контрольные суммы для отправки и получения путей кода.|
|Вычисление контрольной суммы для IPv4 |Сетевой стек может разгрузить вычисления и проверки IPv4 контрольные суммы для отправки и получения путей кода. |
|Вычисление контрольной суммы для IPv6 |Сетевой стек может разгрузить вычисления и проверки IPv6 контрольные суммы для отправки и получения путей кода. | 
|Сегментация больших пакетов TCP|На транспортном уровне TCP/IP поддерживает разгрузку большой отправки версии 2 (LSOv2). С помощью LSOv2 на транспортном уровне TCP/IP позволяет разгрузить сегментацию больших пакетов TCP к сетевому адаптеру.|  
|Масштабирование на стороне приема \(RSS\)|RSS — это технология драйверов сети, которая обеспечивает эффективное распространение сети получать обработки между несколькими ЦПУ в многопроцессорных системах. Дополнительные сведения о технологии RSS приведены далее в этом разделе.|  
|Объединение полученных сегментов \(RSC\)|RSC — это возможность группы пакетов друг с другом, чтобы свести к минимуму заголовка, обработки, который является необходимые для выполнения узла. Более 64 КБ, полученное полезных данных может быть совместно в единый пакет большего размера для обработки. Дополнительные сведения о RSC приведены далее в этом разделе.|  
  
###  <a name="bkmk_rss"></a> Масштабирование на стороне приема

Windows Server 2016, Windows Server 2012, Windows Server 2012 R2, Windows Server 2008 R2 и Windows Server 2008 поддерживают масштабирование на стороне приема \(RSS\). 

Некоторые серверы должны быть настроены несколько логических процессоров, которые совместно используют аппаратные ресурсы \(например физическое ядро\) и которой обрабатываются как одновременные многопоточность \(SMT\) одноранговых узлов. Примером является технологией Hyper-Threading Intel. RSS направляет сетевой обработки для более одного логического процессора на ядро. Например на сервере с Intel Hyper-Threading, 4 ядра и 8 логических процессоров, RSS использует не более 4 логических процессоров для обработки в сети.  

RSS распределяет входящие сетевые пакеты операций ввода-вывода между логических процессоров, таким образом, с тем же логическим процессором, сохраняющий порядок обработки пакетов, принадлежащие одно и то же подключение TCP. 

RSS также загружены сальдо одноадресную передачу UDP и многоадресный трафик, после чего он направляет связанных потоках \(которой определяются путем хэширования адресов источника и назначения\) один логический процессор, сохраняя порядок связанных поступившие запросы. Это помогает повысить масштабируемость и производительность для сценариев с интенсивным для серверов, которые имеют меньшее число сетевых адаптеров, чем на их соответствующих логических процессоров. 

#### <a name="configuring-rss"></a>Настройка RSS

В Windows Server 2016 можно настроить RSS с помощью командлетов Windows PowerShell и профили RSS. 

Профили RSS можно определить с помощью **— профиль** параметр **Set-NetAdapterRss** командлета Windows PowerShell.

**Команды Windows PowerShell для настройки RSS**

Следующие командлеты позволяют просмотреть и изменить параметры RSS на сетевой адаптер.
  
>[!NOTE]
>Подробный справочник по командам по каждому командлету, включая описание синтаксиса и параметров вы можете по следующим ссылкам. Кроме того, можно передать имя командлета, чтобы **Get-Help** в среде Windows PowerShell Дополнительные сведения о каждой команде.  

- [Disable-NetAdapterRss](https://technet.microsoft.com/library/jj130892). Эта команда отключает RSS на сетевом адаптере вами.

- [Enable-NetAdapterRss](https://technet.microsoft.com/library/jj130859). Эта команда включает RSS на сетевом адаптере вами.
  
- [Get-NetAdapterRss](https://technet.microsoft.com/library/jj130912). Эта команда извлекает RSS свойств сетевого адаптера, вами.
  
- [SET-NetAdapterRss](https://technet.microsoft.com/library/jj130863). Эта команда задает свойства RSS для сетевого адаптера, который можно указать.  

#### <a name="rss-profiles"></a>Профили RSS

Можно использовать **— профиль** параметр командлета Set-NetAdapterRss, чтобы указать, какие логические процессоры назначаются какому сетевому адаптеру. Ниже приведены доступные значения для этого параметра.

- **Ближайший**. Предпочтительнее использовать номера логических процессоров, близкие к процессор базового RSS для сетевого адаптера. С этим профилем операционная система может балансировать логических процессоров, динамически на основе нагрузки.
  
- **ClosestStatic**. Предпочтительнее использовать номера логических процессоров почти процессор базового RSS для сетевого адаптера. С этим профилем операционная система не перераспределить логических процессоров, динамически на основе нагрузки.
  
- **NUMA**. Номера логических процессоров, обычно выбираются на разных узлах NUMA для распределения нагрузки. С этим профилем операционная система может балансировать логических процессоров, динамически на основе нагрузки.
  
- **NUMAStatic**. Это **профиль по умолчанию**. Номера логических процессоров, обычно выбираются на разных узлах NUMA для распределения нагрузки. С этим профилем операционная система не выполнит повторную балансировку логических процессоров, динамически на основе нагрузки.

- **Консервативная**. RSS используется число процессоров максимально для обработки нагрузки. Этот параметр позволяет сократить число прерываний.

В зависимости от сценария и характеристик рабочей нагрузки, можно также использовать другие параметры **Set-NetAdapterRss** командлета Windows PowerShell, указав следующее:

- На основе — сетевой адаптер сколько логических процессоров может использоваться для RSS.
- Начальное смещение диапазона логических процессоров.
- Узел, из которого сетевой адаптер выделяет память.

Ниже приведены дополнительные **Set-NetAdapterRss** параметры, которые можно использовать для настройки RSS:

>[!NOTE]
>В примере синтаксиса для каждого параметра ниже имя сетевого адаптера **Ethernet** используется в качестве пример значения для **— имя** параметр **Set-NetAdapterRss** команда. При выполнении командлета, убедитесь, что имя сетевого адаптера, который можно использовать для своей среды.

- **\* MaxProcessors**: Задает максимальное число используемых процессоров RSS. Это гарантирует, что трафик приложения привязана к максимальное число процессоров на данный интерфейс. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –MaxProcessors <value>`

- **\* BaseProcessorGroup**: Задает группу базового процессора узла NUMA. Это влияет на массив процессор, который используется RSS. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –BaseProcessorGroup <value>`
  
- **\* MaxProcessorGroup**: Задает группу Max процессора узлом NUMA. Это влияет на массив процессор, который используется RSS. Установка этого параметра будет ограничения группу максимальном числе процессоров, таким образом, чтобы Балансировка нагрузки выравнивается в k группе. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –MaxProcessorGroup <value>`

- **\* BaseProcessorNumber**: Задает номер базового процессора узла NUMA. Это влияет на массив процессор, который используется RSS. Таким образом, секционирование процессоров через сетевые адаптеры. Это первая в процессорах диапазон из RSS логическим процессором, который назначается каждому адаптеру. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –BaseProcessorNumber <Byte Value>`

- **\* NumaNode**: Узел NUMA, сетевые адаптеры можно выделить память из. Это может быть k группе или из разных k группами. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –NumaNodeID <value>`

- **\* NumberofReceiveQueues**: Если логических процессоров показаться недостаточно загружены приемом трафика \(к примеру, как просматривать с помощью диспетчера задач\), можно попробовать увеличить число очередей RSS со значения по умолчанию 2 до максимального, которое поддерживается сетевым адаптером . Сетевой адаптер может иметь параметры, чтобы изменить число очередей RSS как частью драйвера. Пример синтаксиса:

     `Set-NetAdapterRss –Name “Ethernet” –NumberOfReceiveQueues <value>`

Дополнительные сведения, щелкните следующую ссылку для скачивания [масштабируемые сети: Устранение узкого места получения обработки — Представляем RSS](https://download.microsoft.com/download/5/D/6/5D6EAF2B-7DDF-476B-93DC-7CF0072878E6/NDIS_RSS.doc) в формате Word.
  
#### <a name="understanding-rss-performance"></a>Основные сведения о производительности RSS

Помощник по настройке RSS требует основные сведения о конфигурации и логику балансировки нагрузки. Убедитесь, что RSS параметры вступили в силу, можно просмотреть выходные данные при выполнении **Get-NetAdapterRss** командлета Windows PowerShell. Ниже приведен пример выходных данных этого командлета.
  
```

PS C:\Users\Administrator> get-netadapterrss  
Name                           : testnic 2  
InterfaceDescription           : Broadcom BCM5708C NetXtreme II GigE (NDIS VBD Client) #66
Enabled                        : True
NumberOfReceiveQueues          : 2
Profile                        : NUMAStatic
BaseProcessor: [Group:Number]  : 0:0
MaxProcessor: [Group:Number]   : 0:15
MaxProcessors                  : 8
  
IndirectionTable: [Group:Number]:
     0:0    0:4    0:0    0:4    0:0    0:4    0:0    0:4  
…   
(# indirection table entries are a power of 2 and based on # of processors)  
…   
                          0:0    0:4    0:0    0:4    0:0    0:4    0:0    0:4  
```  

Помимо отправки параметров, которые были заданы, ключевым аспектом выходных данных является выходным данным таблицы косвенного обращения. Таблица косвенных обращений отображает хэш-контейнерах таблицы, которые используются для распределения входящего трафика. В этом примере нотации n:c обозначает Numa K-пары индекс группы: ЦП, которая используется для направления входящего трафика. Мы видим ровно 2 уникальных записей (0:0 и 0:4), которые представляют k группе 0/cpu0 k группе 0/ЦП 4, соответственно.

Имеется только один k группе для этой системы (k группе 0) и n (где n < = 128) запись в таблице косвенного обращения. Так как количество очередей receive задано значение 2, только 2 процессора (0:0, 0:4) выбираются - несмотря на то, что максимальное процессоров имеет значение 8. По сути таблица косвенных обращений является хэширования входящий трафик на использование 2 процессоров из 8, которые доступны только.

В полном объеме использовать ЦП, число очередей получать RSS должно быть равно или больше, чем процессоры на Max. В предыдущем примере очередь на получение должно быть задано до 8 или больше.

#### <a name="nic-teaming-and-rss"></a>Объединение Сетевых карт и RSS

Можно включить RSS на сетевом адаптере, объединенные с помощью другой сетевой адаптер, использующие объединение Сетевых карт. В этом случае можно настроить только базовый физический сетевой адаптер для использования RSS. Невозможно установить командлеты RSS на объединенного сетевого адаптера.
  
###  <a name="bkmk_rsc"></a> Объединение полученных сегментов (RSC)

Объединение полученных сегментов \(RSC\) позволяет повысить производительность за счет сокращения числа IP-адрес заголовки, которые обрабатываются для объем данных, полученных данных. Он должен использоваться для масштабирования производительности, полученных данных, группируя \(или объединения со значением\) меньшего размера в более крупные пакеты.

Этот подход может повлиять на задержку преимущества, главным образом увидеть в растущей пропускной способности. Чтобы увеличить пропускную способность для полученных больших рабочих нагрузок рекомендуется RSC. Рассмотрите возможность развертывания сетевых адаптеров с поддержкой RSC. 

Эти сетевые адаптеры, и убедитесь, что включен RSC \(это значение по умолчанию\), если у вас нет конкретных рабочих нагрузок \(к примеру, Низкая задержка, пропускная способность сети с низкой\) Показать преимущества от долгого RSC .

#### <a name="understanding-rsc-diagnostics"></a>Основные сведения о диагностике RSC

С помощью командлетов Windows PowerShell можно диагностировать RSC **Get-NetAdapterRsc** и **Get-NetAdapterStatistics**.

Ниже приведен пример выходных данных при запуске командлета Get-NetAdapterRsc.

```  

PS C:\Users\Administrator> Get-NetAdapterRsc  
  
Name                       IPv4Enabled  IPv6Enabled  IPv4Operational IPv6Operational               IPv4FailureReason              IPv6Failure  
                                            Reason  
----                           -----------  -----------  --------------- --------------- ----------------- ------------  
Ethernet                       True         False        True            False                  NoFailure       NicProperties  
  
```  

**Получить** командлет показывает ли технология RSC включена в интерфейсе и ли TCP обеспечивает RSC в операционное состояние. Причина сбоя предоставляет сведения о сбое для включения RSC, в этом интерфейсе.

В приведенном выше сценарии IPv4 RSC поддерживается и оперативной в интерфейсе. Чтобы понять, диагностики сбоев, видно одно объединенное байт или исключениями, вызываемыми. Указываются объединения проблемы.

Ниже приведен пример выходных данных при запуске командлета Get-NetAdapterStatistics.

```  
PS C:\Users\Administrator> $x = Get-NetAdapterStatistics “myAdapter”   
PS C:\Users\Administrator> $x.rscstatistics  
  
CoalescedBytes       : 0  
CoalescedPackets     : 0  
CoalescingEvents     : 0  
CoalescingExceptions : 0  
  
```  

#### <a name="rsc-and-virtualization"></a>RSC и виртуализации

RSC поддерживается только в физическом узле, когда сетевой адаптер узла не привязан к виртуальному коммутатору Hyper-V. RSC отключена операционной системой, когда узел привязан к виртуальному коммутатору Hyper-V. Кроме того виртуальные машины не пользуются преимуществами RSC, так как виртуальные сетевые адаптеры не поддерживают RSC.

RSC можно включить для виртуальной машины при виртуализации ввода-вывода единый корневой \(SR-IOV\) включен. В этом случае виртуальные функции поддерживают возможность RSC; Таким образом виртуальные машины также получают преимущества RSC.

##  <a name="bkmk_resources"></a> Ресурсов для сетевых адаптеров

Несколько сетевых адаптеров, активно управлять ресурсами для достижения оптимальной производительности. Несколько сетевых адаптеров позволяют вручную настраивать ресурсы с помощью **Advanced Networking** вкладку для адаптера. Для таких адаптеров можно задать значения параметров, включая число буферов приема и буферов отправки.

Настройка ресурсов для сетевых адаптеров упрощается с помощью следующих командлетов Windows PowerShell.

- [Get-NetAdapterAdvancedProperty](https://technet.microsoft.com/library/jj130901.aspx)

- [SET-NetAdapterAdvancedProperty](https://technet.microsoft.com/library/jj130894.aspx)

- [Enable-NetAdapter](https://technet.microsoft.com/library/jj130876.aspx)

- [Enable-NetAdapterBinding](https://technet.microsoft.com/library/jj130913.aspx)

- [Enable-NetAdapterChecksumOffload](https://technet.microsoft.com/library/jj130918.aspx)

- [Enable-NetAdapterIPSecOffload](https://technet.microsoft.com/library/jj130890.aspx)

- [Enable-NetAdapterLso](https://technet.microsoft.com/library/jj130922.aspx)

- [Enable-NetAdapterPowerManagement](https://technet.microsoft.com/library/jj130907.aspx)

- [Enable-NetAdapterQos](https://technet.microsoft.com/library/jj130866.aspx)

- [Enable-NetAdapterRDMA](https://technet.microsoft.com/library/jj130909.aspx)

- [Enable-NetAdapterSriov](https://technet.microsoft.com/library/jj130899.aspx)

Дополнительные сведения см. в разделе [командлеты сетевого адаптера в Windows PowerShell](https://technet.microsoft.com/library/jj134956.aspx).

Ссылки на все разделы в этом руководстве, см. в разделе [Настройка производительности сетевой подсистемы](net-sub-performance-top.md).