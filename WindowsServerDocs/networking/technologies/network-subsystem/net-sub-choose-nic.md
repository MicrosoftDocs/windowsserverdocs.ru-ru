---
title: Выбор сетевого адаптера
description: Узнайте, как изучить некоторые функции сетевых адаптеров, которые могут повлиять на варианты приобретения.
ms.topic: article
ms.assetid: a6615411-83d9-495f-8a6a-1ebc8b12f164
manager: dcscontentpm
ms.author: v-tea
author: Teresa-Motiv
ms.date: 08/07/2020
ms.openlocfilehash: 0a1730ccf8aef478d3d82ea9d08b1dd8129f3942
ms.sourcegitcommit: f8da45df984f0400922a8306855b0adfdaec71af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98040414"
---
# <a name="choosing-a-network-adapter"></a>Выбор сетевого адаптера

>Применяется к: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете о некоторых возможностях сетевых адаптеров, которые могут повлиять на варианты приобретения.

Ресурсоемкие сетевые приложения требуют высокой производительности сетевых адаптеров. В этом разделе рассматриваются некоторые рекомендации по выбору сетевых адаптеров, а также настройке различных параметров сетевого адаптера для достижения оптимальной производительности сети.

> [!TIP]
>  Параметры сетевого адаптера можно настроить с помощью Windows PowerShell. Дополнительные сведения см. [в разделе командлеты сетевого адаптера в Windows PowerShell](/powershell/module/netadapter).

##  <a name="offload-capabilities"></a><a name="bkmk_offload"></a> Возможности разгрузки

Разгрузка задач из центрального \( центрального процессора вычислительного ресурса \) на сетевой адаптер может снизить загрузку ЦП на сервере, что повышает общую производительность системы.

Сетевой стек в продуктах Майкрософт может разгрузить одну или несколько задач на сетевой адаптер, если выбрать сетевой адаптер с соответствующими возможностями разгрузки. В следующей таблице приведен краткий обзор различных возможностей разгрузки, доступных в Windows Server 2016.

|Тип разгрузки|Описание|
|------------------|-----------------|
|Вычисление контрольной суммы для TCP|Сетевой стек может разгрузить вычисление и проверку \( контрольных сумм TCP протокола управления передачей \) в путях кода отправки и получения. Кроме того, она может также разгрузить вычисление и проверку контрольных сумм IPv4 и IPv6 по путям отправки и получения кода.|
|Вычисление контрольной суммы для UDP |Сетевой стек может разгрузить вычисление и проверку \( контрольных сумм UDP для протокола датаграммы пользователя \) по путям отправки и получения кодов.|
|Вычисление контрольной суммы для IPv4 |Сетевой стек может разгрузить вычисление и проверку контрольных сумм IPv4 по путям отправки и получения кода. |
|Вычисление контрольной суммы для IPv6 |Сетевой стек может разгрузить вычисление и проверку контрольных сумм IPv6 на путях отправки и получения кода. |
|Сегментация больших пакетов TCP|Транспортный уровень TCP/IP поддерживает разгрузку большого объема отправляемых сообщений версии 2 (LSOv2). С помощью LSOv2 транспортный уровень TCP/IP может разгрузить сегментацию больших пакетов TCP на сетевой адаптер.|
|RSS-канал для масштабирования на стороне приема \(\)|RSS — это технология сетевого драйвера, которая позволяет эффективно распределять обработку приема в сети между несколькими процессорами в многопроцессорных системах. Дополнительные сведения о RSS приведены далее в этом разделе.|
|Получить сегмент получения сегмента \( RSC\)|RSC — это возможность группирования пакетов, чтобы обеспечить минимальную обработку заголовка, необходимую для выполнения узла. До 64 КБ полученных полезных данных можно совместно использовать один большой пакет для обработки. Дополнительные сведения о RSC приведены далее в этом разделе.|

###  <a name="receive-side-scaling"></a><a name="bkmk_rss"></a> Масштабирование на стороне приема

Windows Server 2016, Windows Server 2012, Windows Server 2012 R2, Windows Server 2008 R2 и Windows Server 2008 поддерживают масштабирование на стороне приема в \( RSS \) .

Некоторые серверы настроены с несколькими логическими процессорами, которые используют ресурсы оборудования, \( такие как физическое ядро, \) и которые считаются одновременными однопотоковыми \( SMT \) узлами. Примером является технология Intel Hyper-Threading. RSS направляет сетевую обработку до одного логического процессора на ядро. Например, на сервере с технологией Intel Hyper-Threading, 4 ядрами и 8 логическими процессорами RSS использует не более 4 логических процессора для сетевой обработки.

RSS распределяет входящие сетевые операции ввода-вывода между логическими процессорами, чтобы пакеты, входящие в одно и то же подключение TCP, обрабатывались на одном логическом процессоре, который сохраняет порядок.

Кроме того, RSS балансировка нагрузки распределяет трафик по адресу UDP и многоадресную рассылку, а также направляет связанные потоки, \( которые определяются путем хэширования адресов источника и назначения на \) один и тот же логический процессор, сохраняя порядок связанных прибытий. Это помогает повысить масштабируемость и производительность для сценариев, требующих интенсивного получения, для серверов с меньшим числом сетевых адаптеров, чем для соответствующих логических процессоров.

#### <a name="configuring-rss"></a>Настройка RSS

В Windows Server 2016 можно настроить RSS с помощью командлетов Windows PowerShell и профилей RSS.

Профили RSS можно определить с помощью параметра **– Profile** командлета Windows PowerShell **Set-нетадаптеррсс** .

**Команды Windows PowerShell для настройки RSS**

Следующие командлеты позволяют просматривать и изменять параметры RSS для каждого сетевого адаптера.

>[!NOTE]
>Подробную справочную информацию по командам для каждого командлета, включая синтаксис и параметры, можно получить, щелкнув следующие ссылки. Кроме того, для **получения** подробных сведений о каждой команде в командной строке Windows PowerShell можно передать имя командлета.

- [Disable-нетадаптеррсс](/powershell/module/netadapter/Disable-NetAdapterRss). Эта команда отключает RSS на указанном сетевом адаптере.

- [Enable-нетадаптеррсс](/powershell/module/netadapter/Enable-NetAdapterRss). Эта команда включает RSS на указанном сетевом адаптере.

- [Get-нетадаптеррсс](/powershell/module/netadapter/Get-NetAdapterRss). Эта команда получает свойства RSS указанного сетевого адаптера.

- [Set-нетадаптеррсс](/powershell/module/netadapter/Set-NetAdapterRss). Эта команда задает свойства RSS для указанного сетевого адаптера.

#### <a name="rss-profiles"></a>Профили RSS

Можно использовать параметр **– Profile** командлета Set-NetAdapterRss, чтобы указать, какие логические процессоры назначены сетевому адаптеру. Для этого параметра доступны следующие значения:

- **Ближайший**. Предпочтительными являются номера логических процессоров, близкие к базовому обработчику RSS сетевого адаптера. В этом профиле операционная система может динамически распределять логические процессоры в зависимости от нагрузки.

- **Клосестстатик**. Предпочтительными являются номера логических процессоров рядом с базовым обработчиком RSS сетевого адаптера. В этом профиле операционная система не перераспределяет логические процессоры динамически в зависимости от нагрузки.

- **NUMA**. Номера логических процессоров обычно выбираются на разных узлах NUMA для распределения нагрузки. В этом профиле операционная система может динамически распределять логические процессоры в зависимости от нагрузки.

- **Нумастатик**. Это **профиль по умолчанию**. Номера логических процессоров обычно выбираются на разных узлах NUMA для распределения нагрузки. В этом профиле операционная система не будет динамически распределять логические процессоры в зависимости от нагрузки.

- **Консервативный**. RSS использует как можно меньше процессоров, чтобы поддерживать нагрузку. Этот параметр позволяет сократить количество прерываний.

В зависимости от сценария и характеристик рабочей нагрузки можно также использовать другие параметры командлета Windows PowerShell **Set-нетадаптеррсс** , чтобы указать следующее:

- Для отдельных сетевых адаптеров, сколько логических процессоров можно использовать для RSS.
- Начальное смещение диапазона логических процессоров.
- Узел, с которого сетевой адаптер выделяет память.

Ниже приведены дополнительные параметры **Set-нетадаптеррсс** , которые можно использовать для настройки RSS:

>[!NOTE]
>В примере синтаксиса для каждого приведенного ниже **параметра имя сетевого адаптера используется как** пример значения для параметра **– Name** команды **Set-нетадаптеррсс** . При выполнении командлета убедитесь, что используемое имя сетевого адаптера подходит для вашей среды.

- **\* Макспроцессорс**: задает максимальное число используемых обработчиков RSS. Это гарантирует, что трафик приложения будет привязан к максимальному количеству процессоров на данном интерфейсе. Пример синтаксиса:

     `Set-NetAdapterRss –Name "Ethernet" –MaxProcessors <value>`

- **\* Басепроцессорграуп**: задает базовую группу процессоров узла NUMA. Это влияет на массив процессоров, используемый RSS. Пример синтаксиса:

     `Set-NetAdapterRss –Name "Ethernet" –BaseProcessorGroup <value>`

- **\* Макспроцессорграуп**: задает максимальную группу процессоров узла NUMA. Это влияет на массив процессоров, используемый RSS. Установка этого параметра ограничивает максимальную группу процессоров, чтобы балансировка нагрузки была согласована в k-группе. Пример синтаксиса:

     `Set-NetAdapterRss –Name "Ethernet" –MaxProcessorGroup <value>`

- **\* Басепроцессорнумбер**: задает номер базового процессора узла NUMA. Это влияет на массив процессоров, используемый RSS. Это позволяет секционировать процессоры между сетевыми адаптерами. Это первый логический процессор в диапазоне процессоров RSS, назначенных каждому адаптеру. Пример синтаксиса:

     `Set-NetAdapterRss –Name "Ethernet" –BaseProcessorNumber <Byte Value>`

- **\* NumaNode**: узел NUMA, из которого каждый сетевой адаптер может выделить память. Это может быть в k-группе или из разных k-групп. Пример синтаксиса:

     `Set-NetAdapterRss –Name "Ethernet" –NumaNodeID <value>`

- **\* Нумберофрецеивекуеуес**. Если логические процессоры кажутся недостаточными для приема трафика \( , например, просматриваемого в диспетчере задач \) , можно попробовать увеличить число очередей RSS со значения по умолчанию 2 до максимального, поддерживаемого сетевым адаптером. Сетевой адаптер может иметь параметры для изменения числа очередей RSS в составе драйвера. Пример синтаксиса:

     `Set-NetAdapterRss –Name "Ethernet" –NumberOfReceiveQueues <value>`

Для получения дополнительных сведений щелкните следующую ссылку, чтобы скачать [масштабируемые сети: устранение узких мест обработки приема — RSS-канал](https://download.microsoft.com/download/5/D/6/5D6EAF2B-7DDF-476B-93DC-7CF0072878E6/NDIS_RSS.doc) в формате Word.

#### <a name="understanding-rss-performance"></a>Общие сведения о производительности RSS

Настройка RSS требует понимания конфигурации и логики балансировки нагрузки. Чтобы убедиться, что параметры RSS вступили в действие, можно просмотреть выходные данные при выполнении командлета Windows PowerShell **Get-нетадаптеррсс** . Ниже приведен пример выходных данных этого командлета.

```

PS C:\Users\Administrator> get-netadapterrss
Name                           : testnic 2
InterfaceDescription           : Broadcom BCM5708C NetXtreme II GigE (NDIS VBD Client) #66
Enabled                        : True
NumberOfReceiveQueues          : 2
Profile                        : NUMAStatic
BaseProcessor: [Group:Number]  : 0:0
MaxProcessor: [Group:Number]   : 0:15
MaxProcessors                  : 8

IndirectionTable: [Group:Number]:
     0:0    0:4    0:0    0:4    0:0    0:4    0:0    0:4
…
(# indirection table entries are a power of 2 and based on # of processors)
…
                          0:0    0:4    0:0    0:4    0:0    0:4    0:0    0:4
```

В дополнение к параметрам, которые были заданы, ключевым аспектом выходных данных является выход таблицы косвенного обращения. В таблице косвенных обращений отображаются контейнеры хэш-таблиц, которые используются для распределения входящего трафика. В этом примере нотация н:к обозначает пару индексов NUMA K-Group: CPU, которая используется для направления входящего трафика. Мы увидим ровно две уникальные записи (0:0 и 0:4), которые представляют собой k-Group 0/CPU0 и k-Group 0/CPU 4 соответственно.

Для этой системы (k-Group 0) и записи таблицы косвенного обращения n (где n <= 128) существует только одна k-группа. Так как число очередей получения равно 2, выбираются только два процессора (0:0, 0:4), даже если для максимального количества процессоров установлено значение 8. По сути, таблица косвенных обращений хэшируется входящий трафик на использование только 2 ЦП из 8 доступных.

Для полного использования ЦП число очередей приема RSS должно быть больше или равно максимальному числу процессоров. В предыдущем примере очередь получения должна иметь значение 8 или выше.

#### <a name="nic-teaming-and-rss"></a>Объединение сетевых карт и RSS-канал

RSS можно включить на сетевом адаптере, который объединен с другой платой сетевого интерфейса с помощью объединения сетевых карт. В этом сценарии можно настроить только базовый физический сетевой адаптер для использования RSS. Пользователь не может задать командлеты RSS на объединенном сетевом адаптере.

###  <a name="receive-segment-coalescing-rsc"></a><a name="bkmk_rsc"></a> Объединение полученных сегментов (RSC)

Получение сегмента полученных \( \) данных RSC помогает снизить производительность за счет сокращения количества IP-заголовков, обработанных для заданного объема полученных объемов. Его следует использовать для масштабирования производительности полученных данных путем группирования \( или объединения \) пакетов меньшего размера в более крупные единицы.

Этот подход может повлиять на задержку благодаря преимуществам, которые обычно встречаются в повышении пропускной RSC рекомендуется использовать для увеличения пропускной способности для полученных высоких рабочих нагрузок. Рассмотрите возможность развертывания сетевых адаптеров, поддерживающих RSC.

Убедитесь, что на этих сетевых адаптерах указано значение RSC \( по умолчанию \) , если у вас нет конкретных рабочих нагрузок, \( например низкой задержки, сети с низкой пропускной способностью, \) которая показывает преимущества от RSC.

#### <a name="understanding-rsc-diagnostics"></a>Общие сведения о диагностике RSC

Вы можете диагностировать RSC с помощью командлетов Windows PowerShell **Get-нетадаптеррск** и **Get-нетадаптерстатистикс**.

Ниже приведен пример выходных данных при выполнении командлета Get-NetAdapterRsc.

```

PS C:\Users\Administrator> Get-NetAdapterRsc

Name                       IPv4Enabled  IPv6Enabled  IPv4Operational IPv6Operational               IPv4FailureReason              IPv6Failure
                                            Reason
----                           -----------  -----------  --------------- --------------- ----------------- ------------
Ethernet                       True         False        True            False                  NoFailure       NicProperties

```

Командлет **Get** показывает, включен ли RSC в интерфейсе, и включает ли TCP RSC в рабочем состоянии. Причина сбоя предоставляет сведения о сбое включения RSC для этого интерфейса.

В предыдущем сценарии протокол IPv4 RSC поддерживается и работает в интерфейсе. Чтобы понять ошибки диагностики, можно увидеть Объединенные байты или исключения. Это дает указание о проблемах объединения.

Ниже приведен пример выходных данных при выполнении командлета Get-NetAdapterStatistics.

```
PS C:\Users\Administrator> $x = Get-NetAdapterStatistics "myAdapter"
PS C:\Users\Administrator> $x.rscstatistics

CoalescedBytes       : 0
CoalescedPackets     : 0
CoalescingEvents     : 0
CoalescingExceptions : 0

```

#### <a name="rsc-and-virtualization"></a>RSC и виртуализация

RSC поддерживается только на физическом узле, если сетевой адаптер узла не привязан к виртуальному коммутатору Hyper-V. RSC отключается операционной системой, когда узел привязан к виртуальному коммутатору Hyper-V. Кроме того, виртуальные машины не получают преимущества RSC, так как виртуальные сетевые адаптеры не поддерживают RSC.

RSC можно включить для виртуальной машины, если включен однокорневой \( набор SR-IOV виртуализации ввода/вывода \) . В этом случае виртуальные функции поддерживают возможность использования RSC; Таким образом, виртуальные машины также получают преимущества RSC.

##  <a name="network-adapter-resources"></a><a name="bkmk_resources"></a> Ресурсы сетевого адаптера

Несколько сетевых адаптеров активно управляют своими ресурсами для достижения оптимальной производительности. Несколько сетевых адаптеров позволяют вручную настроить ресурсы с помощью вкладки " **Дополнительные сетевые подключения** " для адаптера. Для таких адаптеров можно задать значения нескольких параметров, включая число буферов приема и буферов отправки.

Настройка ресурсов сетевого адаптера упрощена с помощью следующих командлетов Windows PowerShell.

- [Get-Нетадаптерадванцедпроперти](/powershell/module/netadapter/Get-NetAdapterAdvancedProperty)

- [Set-Нетадаптерадванцедпроперти](/powershell/module/netadapter/Set-NetAdapterAdvancedProperty)

- [Enable-NetAdapter](/powershell/module/netadapter/Enable-NetAdapte)

- [Enable-Нетадаптербиндинг](/powershell/module/netadapter/Enable-NetAdapterBinding)

- [Enable-Нетадаптерчекксумоффлоад](/powershell/module/netadapter/Enable-NetAdapterChecksumOffload)

- [Enable-Нетадаптерипсекоффлоад](/powershell/module/netadapter/Enable-NetAdapterChecksumOffload)

- [Enable-Нетадаптерлсо](/powershell/module/netadapter/Enable-NetAdapterLso)

- [Enable-Нетадаптерповерманажемент](/powershell/module/netadapter/Enable-NetAdapterPowerManagement)

- [Enable-Нетадаптеркос](/powershell/module/netadapter/Enable-NetAdapterQos)

- [Enable-Нетадаптеррдма](/powershell/module/netadapter/Enable-NetAdapterRDMA)

- [Enable-Нетадаптерсриов](/powershell/module/netadapter/Enable-NetAdapterSriov)

Дополнительные сведения см. [в разделе командлеты сетевого адаптера в Windows PowerShell](/powershell/module/netadapter).

Ссылки на все разделы данного руководства см. в разделе [Настройка производительности сетевой подсистемы](net-sub-performance-top.md).