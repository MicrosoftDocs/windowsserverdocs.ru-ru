---
title: Объединение сетевых карт
description: В этом разделе представлен обзор объединения сетевых карт (NIC) в Windows Server 2016. Объединение сетевых карт позволяет объединять один и 32 физических сетевых адаптеров Ethernet в один или несколько программных виртуальных сетевых адаптеров. Эти виртуальные сетевые адаптеры обеспечивают высокую производительность и отказоустойчивость в случае сбоя сетевого адаптера.
manager: dougkim
ms.topic: article
ms.assetid: abded6f3-5708-4e35-9a9e-890e81924fec
ms.author: lizross
author: eross-msft
ms.date: 09/10/2018
ms.openlocfilehash: d7c7a8482c1c2648558bb53462285a72ea5dd6d9
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87952253"
---
# <a name="nic-teaming"></a>Объединение сетевых карт

>Применяется к: Windows Server (Semi-Annual Channel), Windows Server 2016

В этом разделе представлен обзор объединения сетевых карт (NIC) в Windows Server 2016. Объединение сетевых карт позволяет объединять один и 32 физических сетевых адаптеров Ethernet в один или несколько программных виртуальных сетевых адаптеров. Эти виртуальные сетевые адаптеры обеспечивают высокую производительность и отказоустойчивость в случае сбоя сетевого адаптера.

> [!IMPORTANT]
> Сетевые адаптеры члена группы сетевой карты необходимо установить на одном физическом компьютере узла.

> [!TIP]
> Группа сетевых адаптеров, которая содержит только один сетевой адаптер, не может обеспечить балансировку нагрузки и отработку отказа. Однако с помощью одного сетевого адаптера можно использовать объединение сетевых карт для разделения сетевого трафика при использовании виртуальных локальных сетей (VLAN).

При настройке сетевых адаптеров в команде сетевой карты они подключаются к общему ядру решения для объединения сетевых карт, который затем представляет собой один или несколько виртуальных адаптеров (также называемых сетевыми интерфейсами группы [Тникс] или командные интерфейсы) в операционной системе.

Поскольку Windows Server 2016 поддерживает до 32 командных интерфейсов для каждой команды, существует множество алгоритмов, которые распределяют исходящий трафик между сетевыми картами.  На следующем рисунке показана группа сетевых адаптеров с несколькими Тникс.

![Группа сетевых адаптеров с несколькими Тникс](../../media/NIC-Teaming/nict_overview.jpg)

Кроме того, можно подключить объединенные сетевые карты к одному коммутатору или другим коммутаторам. При подключении сетевых карт к различным коммутаторам оба параметра должны находиться в одной подсети.

## <a name="availability"></a>Доступность
Объединение сетевых карт доступно во всех версиях Windows Server 2016. Для управления объединением сетевых карт с компьютеров, работающих под управлением клиентской операционной системы, можно использовать разнообразные средства, например:
*    Командлеты Windows PowerShell
*    Удаленный рабочий стол
*    Средства удаленного администрирования сервера

## <a name="supported-and-unsupported-nics"></a>Поддерживаемые и неподдерживаемые сетевые карты
Вы можете использовать любой сетевой адаптер Ethernet, прошедший проверку квалификации оборудования Windows и проверки логотипов (WHQL) в группе сетевых адаптеров в Windows Server 2016.

Вы не можете разместить следующие сетевые карты в группе сетевых адаптеров:

-   Виртуальные сетевые адаптеры Hyper-V, которые являются портами виртуального коммутатора Hyper-V, предоставленными в виде сетевых карт в разделе узла.

    > [!IMPORTANT]
    > Не размещайте виртуальные сетевые карты Hyper-V, представленные в разделе узла (vNIC), в группе. Объединение vNIC внутри раздела узла не поддерживается ни в какой конфигурации. Попытки команды vNIC могут привести к потере связи, если произошел сбой сети.

-   Сетевой адаптер отладки ядра (КДНИК).

-   Сетевые карты, используемые для сетевой загрузки.

-   Сетевые карты, использующие технологии, отличные от Ethernet, такие как WWAN, WLAN/Wi-Fi, Bluetooth и InfiniBand, включая сетевые адаптеры по протоколу InfiniBand (IPoIB).

## <a name="compatibility"></a>Совместимость
Объединение сетевых карт совместимо со всеми сетевыми технологиями в Windows Server 2016, за исключением следующих.

-   **Виртуализация ввода-вывода с одним корнем (SR-IOV)**. Для SR-IOV данные доставляются непосредственно в сетевую карту, не передавая их через сетевой стек (в операционной системе узла, в случае виртуализации). Поэтому Группа сетевых адаптеров не может проверить или перенаправить данные в другой путь в группе.

-   **Качество обслуживания собственного узла (QoS)**. Если политики QoS устанавливаются в собственной или основной системе, и эти политики вызывают минимальные ограничения пропускной способности, Общая пропускная способность группы сетевых адаптеров меньше, чем при использовании политик пропускной способности.

-   **TCP Chimney**. TCP Chimney не поддерживается при объединении сетевых карт, так как TCP Chimney разгружает весь сетевой стек непосредственно на сетевой адаптер.

-   **Проверка подлинности 802.1 x**. Не следует использовать проверку подлинности 802.1 X с объединением сетевых карт, так как некоторые коммутаторы не допускают настройку проверки подлинности 802.1 X и объединения сетевых карт на одном и том же порте.

Дополнительные сведения об использовании объединения сетевых карт в виртуальных машинах, работающих на узле Hyper-V, см. в статье [Создание группы сетевых адаптеров на главном компьютере или виртуальной машине](Create-a-New-NIC-Team-on-a-Host-Computer-or-VM.md).

## <a name="virtual-machine-queues-vmqs"></a>Очереди виртуальных машин (ВМКС)

ВМКС — это функция сетевого интерфейса, которая выделяет очередь для каждой виртуальной машины.  Когда Hyper-V включен; также необходимо включить VMQ. В Windows Server 2016 ВМКС использовать NIC Switch Впортс с одной очередью, назначенной впорт, для предоставления тех же функций.

В зависимости от режима конфигурации коммутатора и алгоритма распределения нагрузки объединение сетевых карт представляет собой минимальное количество доступных и поддерживаемых очередей любым адаптером в группе (режим min-Queues) или общее число очередей, доступных для всех участников группы (режим SUM-of-Queues).

Если команда находится в режиме независимого от коммутатора и вы устанавливаете распределение нагрузки в режим порта Hyper-V или в динамический режим, число сообщаемых очередей — это сумма всех очередей, доступных из членов группы (режим SUM-of-Queues). В противном случае количество очередей в отчете является наименьшим числом очередей, поддерживаемых любым участником команды (режим min-Queues).

Ниже объясняются причины.

-   Если независимая команда находится в режиме порта Hyper-V или в динамическом режиме, входящий трафик для порта коммутатора Hyper-V (ВМ) всегда поступает на один и тот же участник команды. Узел может предсказать или контролировать, какой член получает трафик для конкретной виртуальной машины, чтобы объединение сетевых карт было более продуманным, чем очереди VMQ, выделяемые для конкретного участника команды. Объединение сетевых карт, работа с коммутатором Hyper-V, устанавливает VMQ для виртуальной машины на точно одном члене команды и определяет, что входящий трафик поступает в эту очередь.

-   Если команда находится в любом режиме, зависимом от переключения (статическое объединение или объединение LACP), коммутатор, к которому подключена команда, управляет распределением входящего трафика. Программному обеспечению для объединения сетевых карт не удается предсказать, какой член команды получает входящий трафик для виртуальной машины. возможно, коммутатор распределяет трафик для виртуальной машины по всем членам группы. В результате работы программы объединения сетевых карт, работающей с коммутатором Hyper-V, программа программирует очередь для виртуальной машины на всех участниках группы, а не только на одном члене команды.

-   Если команда находится в режиме, независимом от переключения, и использует балансировку нагрузки хэша адреса, входящий трафик всегда поступает на один сетевой адаптер (основной член группы) — все это только один участник команды. Поскольку другие члены команды не работают с входящим трафиком, они запрограммированы с помощью тех же очередей, что и основной участник, поэтому при сбое основного участника любой другой член команды может использоваться для получения входящего трафика, и очереди уже существуют.

- Большинство сетевых адаптеров используют очереди для масштабирования на стороне приема (RSS) или VMQ, но не в одно и то же время. Некоторые параметры VMQ выглядят как параметры для очередей RSS, но являются параметрами универсальных очередей, которые используются как для RSS, так и для VMQ в зависимости от того, какая функция используется в настоящее время. Каждая сетевая карта имеет в своих дополнительных свойствах значения для * Рссбасепрокнумбер и \* максрсспроцессорс. Ниже приведены несколько параметров VMQ, обеспечивающих лучшую производительность системы.

-   В идеале для каждой сетевой карты необходимо, чтобы для параметра * Рссбасепрокнумбер было установлено четное число, большее или равное двум (2). Первый физический процессор, ядро 0 (логические процессоры 0 и 1) обычно выполняет большую часть системной обработки, поэтому сетевая обработка должна отойти от этого физического процессора. Некоторые архитектуры компьютеров не имеют двух логических процессоров на один физический процессор, поэтому для таких компьютеров базовый процессор должен быть больше или равен 1. Если вы сомневаетесь в том, что ваш узел использует 2 логических процессора на архитектуру физического процессора.

-   Если команда находится в режиме суммирования очередей, процессоры членов группы должны быть не перекрывающиеся. Например, в 4-ядерном хосте (8 логических процессорах) с группой из 2 10 Гбит/сетевых интерфейсов можно установить первый из них, чтобы использовать базовый процессор 2 и использовать 4 ядра; второй будет установлен для использования базового процессора 6 и 2 ядер.

-   Если команда находится в режиме min-Queues, наборы процессоров, используемые членами группы, должны быть идентичны.


## <a name="hyper-v-network-virtualization-hnv"></a>Виртуализация сети Hyper-V (HNV)
Объединение сетевых карт полностью совместимо с виртуализацией сети Hyper-V (HNV).  Система управления HNV предоставляет сведения о драйвере объединения сетевых карт, который позволяет объединением сетевых карт распределить нагрузку таким образом, чтобы оптимизировать трафик HNV.

## <a name="live-migration"></a>Динамическая миграция
Объединение сетевых карт в виртуальных машинах не влияет на динамическая миграция. Существуют те же правила, что и для динамическая миграция настройки объединения сетевых карт в виртуальной машине.


## <a name="virtual-local-area-networks-vlans"></a>Виртуальные локальные сети (VLAN)
При использовании объединения сетевых карт создание нескольких интерфейсов команды позволяет узлу подключаться к разным виртуальным ЛС одновременно.
Настройте среду, следуя приведенным ниже рекомендациям.

- Перед включением объединения сетевых карт настройте порты физического коммутатора, подключенные к узлу Teaming, для использования режима магистрали (неизбирательного). Физический коммутатор должен передавать весь трафик на узел для фильтрации без изменения трафика.

- Не настраивайте фильтры VLAN на сетевых адаптерах с помощью параметров дополнительных свойств сетевого адаптера. Разрешите программе объединения сетевых карт или виртуальному коммутатору Hyper-V (при наличии) выполнить фильтрацию виртуальных ЛС.

### <a name="use-vlans-with-nic-teaming-in-a-vm"></a>Использование виртуальных ЛС с объединением сетевых карт в виртуальной машине
Когда команда подключается к виртуальному коммутатору Hyper-V, все разделение виртуальных ЛС должно выполняться в виртуальном коммутаторе Hyper-V, а не в группе объединения сетевых карт.

Запланируйте использование виртуальных ЛС на виртуальной машине, настроенной с помощью группы сетевых адаптеров, по следующим рекомендациям.

-    Предпочтительным способом поддержки нескольких виртуальных ЛС в виртуальной машине является настройка виртуальной машины с несколькими портами на виртуальном коммутаторе Hyper-V и связывание каждого порта с виртуальной ЛС. Никогда не указывайте эти порты на виртуальной машине, так как это вызывает проблемы с сетевым подключением.

-    Если виртуальная машина имеет несколько виртуальных функций SR-IOV (VFs), убедитесь, что они находятся в одной виртуальной ЛС, прежде чем они будут объединены в виртуальную машину. Вы можете легко настроить различные VFs в различных виртуальных ЛС, и это приведет к проблемам с сетевыми подключениями.


### <a name="manage-network-interfaces-and-vlans"></a>Управление сетевыми интерфейсами и виртуальными ЛС
Если в гостевой операционной системе необходимо предоставить более одной виртуальной ЛС, рассмотрите возможность переименования интерфейсов Ethernet для уточнения виртуальной ЛС, назначенной интерфейсу. Например, если вы свяжете интерфейс **Ethernet** с виртуальной ЛС 12 и интерфейсом **Ethernet 2** с виртуальной ЛС 48, переименуйте интерфейс Ethernet в **EthernetVLAN12** , а другой — на **EthernetVLAN48**.

Переименуйте интерфейсы с помощью команды Windows PowerShell **Rename-NetAdapter** или путем выполнения следующей процедуры:

1.  В диспетчер сервера в **свойствах** сетевого адаптера, который требуется переименовать, щелкните ссылку справа от имени сетевого адаптера.

2.  Щелкните правой кнопкой мыши сетевой адаптер, который необходимо переименовать, и выберите команду **Переименовать**.

3.  Введите новое имя для сетевого адаптера и нажмите клавишу ВВОД.


## <a name="virtual-machines-vms"></a>Виртуальные машины

Если вы хотите использовать объединение сетевых карт на виртуальной машине, необходимо подключить виртуальные сетевые адаптеры виртуальной машины только к внешним коммутаторам Hyper-V. Это позволяет виртуальной машине поддерживать сетевое подключение даже в случае сбоя одного из физических сетевых адаптеров, подключенных к одному виртуальному коммутатору, или отключения. Виртуальные сетевые адаптеры, подключенные к внутренним или частным виртуальным коммутаторам Hyper-V, не могут подключиться к коммутатору, если они находятся в группе, и для виртуальной машины не удалось выполнить сетевые подключения.

Объединение сетевых карт в Windows Server 2016 поддерживает команды с двумя членами виртуальных машин. Вы можете создавать крупные команды, но больше не поддерживаются крупные команды. Каждый член команды должен подключаться к другому внешнему коммутатору Hyper-V, а сетевые интерфейсы виртуальной машины должны быть настроены для поддержки объединения.


Если вы настраиваете группу сетевых адаптеров на виртуальной машине, необходимо выбрать **режим объединения** _коммутаторов в независимом_ **режиме и режим балансировки нагрузки** для _хэша адреса_.


## <a name="sr-iov-capable-network-adapters"></a>Сетевые адаптеры с поддержкой SR-IOV
Группа сетевых адаптеров в или на узле Hyper-V не может защищать трафик SR-IOV, так как он не проходит через коммутатор Hyper-V.  С помощью параметра объединения ВИРТУАЛЬНЫХ сетевых карт можно настроить два внешних коммутатора Hyper-V, каждый из которых подключен к своей собственной сетевой карте с поддержкой SR-IOV.

![Объединение сетевых карт с сетевыми адаптерами с поддержкой SR-IOV](../../media/NIC-Teaming-in-Virtual-Machines--VMs-/nict_in_vm.jpg)

Каждая виртуальная машина может иметь виртуальную функцию (VF) из одной или обеих сетевых адаптеров SR-IOV и, в случае отключения сетевого адаптера, отработки отказа из основного VF в адаптер резервного копирования (VF). Кроме того, виртуальная машина может иметь VF из одной сетевой карты и Вмник, отличной от VF, подключенной к другому виртуальному коммутатору. Если сетевая карта, связанная с VF, отключена, трафик может выполнить отработку отказа на другой коммутатор без потери подключения.

Поскольку отработка отказа между сетевыми картами в виртуальной машине может привести к передаче трафика с MAC-адресом другого Вмник, каждый порт виртуального коммутатора Hyper-V, связанный с виртуальной машиной с помощью объединения сетевых карт, должен быть настроен для разрешения объединения.


## <a name="related-topics"></a>Связанные темы

- [Объединение сетевых карт. использование и управление MAC-адресами](NIC-Teaming-MAC-Address-Use-and-Management.md). при настройке группы сетевых карт с независимым режимом и при использовании хэша или динамического распределения нагрузки группа использует Mac-адрес основного члена группы сетевых адаптеров для исходящего трафика. Член группы основного сетевого адаптера — это сетевой адаптер, выбранный операционной системой из начального набора членов группы.

- [Параметры объединения сетевых карт](nic-teaming-settings.md). в этом разделе мы преддадим Обзор свойств группы сетевых адаптеров, таких как объединение и режим балансировки нагрузки. Кроме того, мы предоставляем подробные сведения о параметре адаптера ожидания и свойстве основного интерфейса группы. Если у вас есть по крайней мере два сетевых адаптера в группе сетевых адаптеров, не нужно назначать резервный адаптер для отказоустойчивости.

- [Создание группы сетевых адаптеров на главном компьютере или виртуальной машине](Create-a-New-NIC-Team-on-a-Host-Computer-or-VM.md). в этом разделе вы создадите новую группу сетевых адаптеров на главном компьютере или на виртуальной машине Hyper-V под управлением Windows Server 2016.

- [Устранение неполадок объединения сетевых адаптеров](Troubleshooting-NIC-Teaming.md). в этом разделе обсуждаются способы устранения неполадок объединения сетевых карт, таких как оборудование, безопасность физического коммутатора и отключение или включение сетевых адаптеров с помощью Windows PowerShell.

