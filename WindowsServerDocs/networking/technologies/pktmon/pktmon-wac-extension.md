---
title: Расширение мониторинга пакетов в Windows Admin Center
description: Эта страница используется для работы и использования монитора пакетов (Пктмон) через центр администрирования Windows.
ms.topic: how-to
author: khdownie
ms.author: v-kedow
ms.date: 11/12/2020
ms.openlocfilehash: eabcda1c535086472fda55136b14073ce6181d36
ms.sourcegitcommit: b0c10eaffaa5de3eeff44c433580b41270c27d32
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/30/2020
ms.locfileid: "97826194"
---
# <a name="packet-monitoring-extension-in-windows-admin-center"></a>Расширение мониторинга пакетов в Windows Admin Center

>Область применения: Windows Server (половина ежегодного канала), Windows Server 2019, Windows 10, Azure Stack ХЦИ, центр Azure Stack, Azure

Расширение мониторинга пакетов позволяет выполнять и использовать монитор пакетов через центр администрирования Windows. Расширение помогает диагностировать сеть путем записи и отображения сетевого трафика через сетевой стек в журнале, который легко отслеживать и манипулировать.

## <a name="what-is-packet-monitor-pktmon"></a>Что такое монитор пакетов (Пктмон)?
Монитор пакетов (Пктмон) — это встроенное средство диагностики сети для Windows. Он может использоваться для записи пакетов, обнаружения пакетов, фильтрации пакетов и подсчета. Этот инструмент особенно полезен в сценариях виртуализации, например в сетях контейнеров и SDN, так как он обеспечивает видимость сетевого стека.

## <a name="what-is-windows-admin-center"></a>Что такое Windows Admin Center?
Центр администрирования Windows — это локально развернутое средство управления на основе браузера, которое позволяет управлять серверами Windows без зависимости Azure или облака. Windows Admin Center предоставляет полный контроль над всеми аспектами серверной инфраструктуры и особенно полезен для управления серверами в частных сетях, которые не подключены к Интернету. Windows Admin Center — это продукт эволюции встроенных средств управления, таких как Диспетчер серверов и MMC.

## <a name="before-you-start"></a>Перед началом работы
- Для использования этого средства целевой сервер должен работать под управлением Windows Server 2019 версии 1903 (19H1) и более поздних версий.
- [Установите центр администрирования Windows](/windows-server/manage/windows-admin-center/deploy/install).
- Добавление сервера в центр администрирования Windows.
  1. Щелкните **+ Добавить** в разделе **Все подключения**.
  2. Выберите Добавление соединения с сервером.
  3. Введите имя сервера и при появлении запроса укажите учетные данные для использования.
  4. Нажмите кнопку **Отправить** , чтобы завершить работу.

Сервер будет добавлен в список подключений на странице **обзора** .

## <a name="getting-started"></a>Начало работы

Чтобы открыть средство, перейдите к серверу, созданному на предыдущем шаге, и перейдите к расширению "Мониторинг пакетов".

## <a name="applying-filters"></a>Применение фильтров

Настоятельно рекомендуется применять фильтры перед запуском записи пакетов, так как возможность устранения неполадок с подключением к определенному назначению упрощается, если основное внимание уделяется одному потоку пакетов. С другой стороны, захват всего сетевого трафика может сделать вывод слишком бесшумным для анализа. Таким образом, расширение перед началом записи направляет на панель "фильтры". Этот шаг можно пропустить, нажав кнопку **Далее** , чтобы начать сбор без фильтров. На панели "фильтры" можно добавить фильтры в три шага.

1. Фильтрация по компонентам стека сети

   Если вы хотите записывать трафик, проходящий через определенные компоненты, на первом шаге панели "фильтры" отображается макет сетевого стека, чтобы можно было выбрать компоненты для фильтрации. Кроме того, это отличное место для анализа и понимания структуры сетевого стека вашего компьютера.

   :::image type="content" source="media/filtering-by-networking-stack-components.png" alt-text="Пример фильтрации по компонентам стека сети" border="true" lightbox="media/filtering-by-networking-stack-components.png":::

2. Фильтрация по параметрам пакетов

   На втором шаге панель позволяет фильтровать пакеты по их параметрам. Чтобы сообщить о пакете, он должен соответствовать всем условиям, указанным по крайней мере в одном фильтре. одновременно поддерживается до 8 фильтров. Для каждого фильтра можно указать такие параметры пакетов, как MAC-адреса, адреса IP, порты, Есертипе, транспортный протокол и идентификатор виртуальной ЛС.

   - При указании двух компьютеров Mac, IP-адресов или портов средство не различает источник или назначение; Он будет записывать пакеты, имеющие оба значения, будь то назначение или источник. Однако фильтры вывода могут сделать это различие. см. раздел [фильтры по отображению](#display-filters) ниже.
   - Для дальнейшей фильтрации пакетов TCP можно указать дополнительный список флагов TCP для сопоставления. Поддерживаемые флаги: FIN, SYN, RST, КОМАНДНОМ PSH, ACK, УРГ, ECE и КВР.
   - Если флажок **инкапсуляции** установлен, средство применяет фильтр к инкапсулированным внутренним пакетам в дополнение к внешнему пакету. Поддерживаемые методы инкапсуляции: ВКСЛАН, GRE, NVGRE и IP-in-IP. Пользовательский порт ВКСЛАН является необязательным и по умолчанию равен 4789.

   :::image type="content" source="media/filtering-by-packet-parameters.png" alt-text="Пример фильтрации по параметрам пакетов" border="true" lightbox="media/filtering-by-packet-parameters.png":::

3. Фильтрация по состоянию потока пакетов

   По умолчанию монитор пакетов будет записывать отправленные и пропущенные пакеты. Чтобы захватить только удаленные пакеты, выберите **отброшенные пакеты**.

   :::image type="content" source="media/filtering-by-packet-flow-status.png" alt-text="Пример фильтрации по состоянию потока пакетов" border="true" lightbox="media/filtering-by-packet-flow-status.png":::

   Затем отображается сводка по всем выбранным условиям фильтра для просмотра. Вы сможете получить это представление после запуска записи с помощью кнопки **условия захвата** .

   :::image type="content" source="media/filters-review.png" alt-text="Запись только отброшенных пакетов" border="true" lightbox="media/filters-review.png":::

## <a name="capture-log"></a>Журнал захвата

Результаты отображаются в таблице, в которой показаны основные параметры записанных пакетов: метка времени, IP-адрес источника, исходный порт, конечный IP-адрес, порт назначения, Есертипе, протокол, флаги TCP, удален ли пакет и причина удаления.

   - Отметка времени для каждого из этих пакетов также является гиперссылкой, которая перенаправит вас на другую страницу, где можно найти дополнительные сведения о выбранном пакете. См. раздел со страницей сведений ниже.
   - Все пропущенные пакеты имеют значение "true" на вкладке " **удалено** ", причину удаления и отображаются красным текстом, чтобы упростить их определение.
   - Все вкладки можно сортировать по возрастанию и убыванию.
   - Можно выполнить поиск значения в любом столбце журнала с помощью панели поиска.
   - Вы можете перезапустить запись с теми же выбранными фильтрами, нажав кнопку **перезапустить** .

   :::image type="content" source="media/capture-log-result.png" alt-text="Пример таблицы результатов записи журнала" border="true" lightbox="media/capture-log-result.png":::

## <a name="details-page"></a>Страница сведений

На этой странице представлен моментальный снимок пакета, который проходит по каждому компоненту локального сетевого стека. В этом представлении отображается путь потока пакетов, который позволяет исследовать изменение пакетов по мере их обработки каждым компонентом, который они передают.

   - Моментальные снимки пакетов группируются по каждому стеку адаптера или коммутатора; Например, моментальные снимки пакетов, захваченные адаптером или коммутатором, его драйверы фильтров и драйверы протоколов будут сгруппированы под именем адаптера или коммутатора. Это упростит отслеживание потока пакета из одного адаптера в другой.
   - При выборе моментального снимка отображаются дополнительные сведения об этом конкретном снимке, включая заголовки необработанных пакетов.
   - Все пропущенные пакеты имеют значение "true" на вкладке " **удалено** ", причину удаления и отображаются красным текстом, чтобы упростить их определение.

   :::image type="content" source="media/details-page.png" alt-text="Пример страницы сведений, в которой показаны моментальные снимки пакетов" border="true" lightbox="media/details-page.png":::

## <a name="display-filters"></a>Фильтры экрана

Фильтры просмотра позволяют фильтровать журнал после записи пакетов. Для каждого фильтра можно указать такие параметры, как MAC-адреса, IP-адреса, порты, Есертипе и транспортный протокол. В отличие от фильтров записи:

   - Фильтры экрана могут различать источник и назначение IP-адресов, адресов MAC и портов.
   - Фильтры отображения можно удалить и изменить после применения, чтобы изменить представление журнала.
   - Фильтры фильтра отображаются в сохраненных журналах.

   :::image type="content" source="media/display-filters.png" alt-text="Экран фильтров отображения" border="true" lightbox="media/display-filters.png":::

## <a name="save-feature"></a>Сохранить функцию

Кнопка Сохранить позволяет сохранить журнал на локальном компьютере, на удаленном компьютере или в обоих случаях. Фильтры экрана будут отменены в сохраненном журнале.

   - Если журнал сохранен на локальном компьютере, вы сможете сохранить его в различных форматах:
      - Формат ETL, который можно проанализировать с помощью Microsoft Network Monitor. Примечание. Дополнительные сведения см. на этой странице.
      - Формат текста, который можно проанализировать с помощью любого текстового редактора, например TextAnalysisTool.NET.
      - Пкапнг фомат, который можно проанализировать с помощью таких средств, как Wireshark.
         - Большая часть метаданных монитора пакетов будет потеряна во время этого преобразования. Дополнительные сведения см. на [этой странице](pktmon-pcapng-support.md) .

   :::image type="content" source="media/packet-monitoring-save-feature.png" alt-text="Сохранение локальной копии записи" border="true" lightbox="media/packet-monitoring-save-feature.png":::

## <a name="open-feature"></a>Открыть компонент

Функция открыть позволяет повторно открыть любой из пяти сохраненных журналов для анализа с помощью средства.

   :::image type="content" source="media/open.png" alt-text="Открытие недавнего журнала" border="true" lightbox="media/open.png":::