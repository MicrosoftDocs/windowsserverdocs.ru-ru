---
title: Развертывание разделенной системы DNS с помощью политики DNS
description: Этот раздел является частью DNS политики сценария руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: a255a4a5-c1a0-4edc-b41a-211bae397e3c
ms.author: pashort
author: shortpatti
ms.openlocfilehash: c74bb2ee2f1647716c8c38e392434a5b7f01805f
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446391"
---
# <a name="use-dns-policy-for-split-brain-dns-deployment"></a>Использование политики DNS для разбиения\-мозг развертывания DNS

>Относится к: Windows Server 2016

В этом разделе можно использовать, чтобы узнать, как настроить политики DNS в Windows Server&reg; 2016 для развертываний с разделенной DNS, где существуют две версии одного зона - один для внутренних пользователей в интрасети организации и один для внешних пользователей как правило, кто является пользователем в Интернете.

>[!NOTE]
>Сведения о том, как с помощью политики DNS для разбиения\-зонами DNS, интегрированными мозг развертывания DNS с Active Directory, см. в разделе [использование политики DNS для Split-Brain DNS-сервер в Active Directory](dns-sb-with-ad.md).

Ранее этот сценарий необходимо, что DNS Администраторы обслуживают как два разных DNS-серверы, каждый обслуживает пользователей, внутренних и внешних. Если только несколько записей в зоне были разделены\-brained или делегированных оба экземпляра зоны (внутренним или внешним) для одного родительского домена, это стало загадок управления. 

Другой сценарий конфигурации для развертывания разделенной является выборочной управления рекурсия для разрешения имен DNS. В некоторых случаях для рекурсивного разрешения через Интернет для внутренних пользователей, а также должен выступать в качестве полномочные серверы доменных имен для внешних пользователей и блокировать рекурсии для них ожидаются корпоративный DNS-серверы. 

Эта статья содержит следующие разделы.

- [Пример развертывания разделенная система DNS](#bkmk_sbexample)
- [Пример элемента управления DNS выборочной рекурсии](#bkmk_recursion)

## <a name="bkmk_sbexample"></a>Пример развертывания разделенная система DNS
Ниже приведен пример того, как можно использовать политики DNS для выполнения ранее описанных ситуацию, в которой разделенная система DNS.

Этот раздел содержит следующие подразделы.

- [Как работает развертывание разделенная система DNS](#bkmk_sbhow)
- [Настройка развертывания разделенная система DNS](#bkmk_sbconfigure)


В этом примере используется один вымышленной компании Contoso, поддерживающий веб-сайта карьеру в www.career.contoso.com.

Сайт имеет две версии: один для внутренних пользователей, где доступны внутренний вакансии. Этот внутренний узел находится в локальный IP-адрес 10.0.0.39. 

Вторая версия является открытой версией одного узла, которое доступно в общедоступный IP-адрес 65.55.39.10.

В отсутствие политики DNS администратору необходимо разместить эти две зоны на отдельных серверах Windows Server DNS и управлять ими отдельно. 

С помощью политик DNS эти зоны могут теперь размещаться на одном сервере DNS.  

Этот сценарий показан на следующем рисунке.

![Развертывание разделенной системы DNS](../../media/DNS-Split-Brain/Dns-Split-Brain-01.jpg)  


## <a name="bkmk_sbhow"></a>Как работает развертывание разделенная система DNS

Когда DNS-сервер настроен с помощью необходимых политик DNS, каждый запрос на разрешение имени сравнивается политик к DNS-серверу.

Сервер интерфейса используется в этом примере как условие для различения между внутренними и внешними клиентами.

Если интерфейс сервера, на которой поступает запрос соответствует какой-либо политики, области связанных зоны используется отвечает на запрос. 

Таким образом в нашем примере запросы DNS для www.career.contoso.com, полученных на частный IP-адрес (10.0.0.56) получен ответ DNS, содержащий внутренний IP-адрес; и запросы DNS, которые получены в интерфейсе общедоступной сети получен ответ DNS, который содержит общедоступный IP-адрес в области зоны по умолчанию (это так же, как обычный запрос разрешения).  

## <a name="bkmk_sbconfigure"></a>Настройка развертывания разделенная система DNS
Чтобы настроить развертывание Split-Brain DNS с помощью политики DNS, необходимо использовать следующие действия.

- [Создание области зоны](#bkmk_zscopes)  
- [Добавление записей в области зоны](#bkmk_records)  
- [Создайте политики DNS](#bkmk_policies)

Следующие разделы содержат подробных инструкций по настройке.

>[!IMPORTANT]
>В следующих разделах приведены примеры команд Windows PowerShell, которые содержат примеры значений для многих параметров. Убедитесь, что примеры значений в этих командах замените значения, которые подходят для развертывания, прежде чем вы выполните следующие команды. 

### <a name="bkmk_zscopes"></a>Создание области зоны

Область зоны — это уникальный экземпляр зоны. Зоны DNS может иметь несколько областей зоны, с каждой из областей зоны, содержащий собственный набор записей DNS. Та же запись могут присутствовать в нескольких областях, различные IP-адреса или же IP-адреса. 

> [!NOTE]
> По умолчанию области зоны существует для зон DNS. Эта область зоны имеет то же имя, что зона и устаревших работы DNS работать в этой области. Эта область зоны по умолчанию будет размещаться внешнюю версию www.career.contoso.com.

Следующая команда используется для секционирования зоне contoso.com область для создания областью внутренней зоны. Области внутренней зоны будет использоваться для сохранения внутренней версии www.career.contoso.com.

`Add-DnsServerZoneScope -ZoneName "contoso.com" -Name "internal"`

Дополнительные сведения см. в разделе [DnsServerZoneScope добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps)

### <a name="bkmk_records"></a>Добавление записей в области зоны

Следующим шагом является добавление записи, представляющие веб-сервера в области видимости две зоны — внутренняя и по умолчанию (для внешних клиентов). 

В области внутренней зоны, запись <strong>www.career.contoso.com</strong> 10.0.0.39, который является частный IP-адрес; IP-адресом и добавляется в область зоны по умолчанию одной и той же записи, <strong>www.career.contoso.com</strong>, — добавить IP-адресом 65.55.39.10.

Не **— зонаобласть** в следующем примере показан предоставляется параметр, когда запись добавляется к области зоны по умолчанию. Это аналогично добавлению записи соответствующего ванили зону.

`
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "65.55.39.10"
`
`
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "10.0.0.39” -ZoneScope "internal"
`

Дополнительные сведения см. в разделе [Add-DnsServerResourceRecord](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).

### <a name="bkmk_policies"></a>Создайте политики DNS

После того как вы определили интерфейсы сервера для внешней сети и внутренней сети и создания области зоны, необходимо создать политики DNS, которые подключаются области внутренней и внешней зоны.

>[!NOTE]
>В этом примере используется интерфейс сервера как условие для различения между внутренними и внешними клиентами. Другой способ различать внешних и внутренних клиентов — с помощью подсетей клиента как критерий. Если можно определить подсети, к которым принадлежат внутренних клиентов, можно настроить политики DNS для различения в зависимости от подсети клиента. Сведения о том, как настроить управление трафиком с помощью критериев подсети клиента, см. в разделе [помощью политики DNS для управления трафиком на основе географического расположения, с серверов-источников](https://technet.microsoft.com/windows-server-docs/networking/dns/deploy/scenario--use-dns-policy-for-geo-location-based-traffic-management-with-primary-servers).

Когда DNS-сервер получает запрос на частном интерфейсе, ответа на запрос DNS возвращается из области внутренней зоны.

>[!NOTE]
>Политики не являются обязательными для сопоставления области зоны по умолчанию. 

В следующем примере команды 10.0.0.56 является IP-адрес интерфейса частной сети, как показано на предыдущем рисунке.

`Add-DnsServerQueryResolutionPolicy -Name "SplitBrainZonePolicy" -Action ALLOW -ServerInterface "eq,10.0.0.56" -ZoneScope "internal,1" -ZoneName contoso.com`

Дополнительные сведения см. в разделе [DnsServerQueryResolutionPolicy добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  


## <a name="bkmk_recursion"></a>Пример элемента управления DNS выборочной рекурсии

Ниже приведен пример того, как можно использовать политики DNS для выполнения ранее описанных ситуацию, в которой Выборочный рекурсии управления DNS.

Этот раздел содержит следующие подразделы.

- [Как работает элемент управления выборочной рекурсии DNS](#bkmk_recursionhow)
- [Настройка управления выборочной рекурсии DNS](#bkmk_recursionconfigure)

В этом примере той же вымышленной компании, как в предыдущем примере, компания Contoso, веб-узле карьеру в www.career.contoso.com.

В примере развертывания разделенная система DNS тот же сервер DNS отвечает на запросы внешних и внутренних клиентов и предоставляет им разные ответы. 

Некоторые развертывания DNS может потребоваться один и тот же сервер DNS, для выполнения рекурсивного разрешения имен для внутренних клиентов только выступает в качестве полномочного сервера имен для внешних клиентов. Такой проблемы вызывается выборочной рекурсии управления DNS.

В предыдущих версиях Windows Server Включение рекурсии означало, что он был включен для всего сервера для всех зон DNS. Так как DNS-сервер также ожидает внешних запросов, рекурсия включена для внутренних и внешних клиентов, делая арбитр откройте DNS-сервер. 

DNS-сервер, настроенный в качестве арбитр откройте могут оказаться уязвимыми к исчерпанию ресурсов и дают злоумышленниками для создания отражения атак. 

По этой причине Администраторы Contoso DNS не требуется DNS-сервера для contoso.com, чтобы выполнять рекурсивного разрешения имен для внешних клиентов. Необходим только для элемента управления рекурсии для внутренних клиентов при рекурсии управления может быть заблокирован для внешних клиентов. 

Этот сценарий показан на следующем рисунке.

![Элемент управления выборочной рекурсии](../../media/DNS-Split-Brain/Dns-Split-Brain-02.jpg) 


### <a name="bkmk_recursionhow"></a>Как работает элемент управления выборочной рекурсии DNS

Если поступает запрос, для которого не заслуживающего доверия Contoso DNS-сервера, например для www.microsoft.com, затем запрос на разрешение имени сравнивается с политик к DNS-серверу. 

Так как эти запросы не входят ни в любой зоне, зоны уровень политики \(согласно определению в разделенной примере\) не вычисляются. 

DNS-сервер оценивает политики рекурсии и запросы, получаемые совпадение, частный интерфейс **SplitBrainRecursionPolicy**. Эта политика указывает области рекурсии, где включена рекурсия.

DNS-сервер выполняет рекурсию, чтобы получить ответ для www.microsoft.com из Интернета и кэширует ответ локально. 

Если получен запрос на внешний интерфейс, совпадений политики DNS и рекурсии по умолчанию — в этом случае **отключено** -применяется.

Благодаря этому сервер выступает в качестве арбитр открытым для внешних клиентов, пока он действует как кэширующий Сопоставитель для внутренних клиентов. 

### <a name="bkmk_recursionconfigure"></a>Настройка управления выборочной рекурсии DNS

Чтобы настроить DNS выборочной рекурсии управления с помощью политики DNS, необходимо использовать следующие действия.

- [Создание областей рекурсии DNS](#bkmk_recscopes)
- [Создание политики рекурсии DNS](#bkmk_recpolicy)

#### <a name="bkmk_recscopes"></a>Создание областей рекурсии DNS

Рекурсия области являются уникальных экземпляров группы параметров, контролирующие рекурсию на DNS-сервер. Рекурсия область содержит список серверов пересылки и указывает, включена ли рекурсия. DNS-сервер может иметь несколько областей рекурсии. 

Параметр рекурсии прежних версий и списка серверов пересылки, называются рекурсии область по умолчанию. Невозможно добавить или удалить область рекурсии по умолчанию, определяемый именем точки \(«.» \).

В этом примере параметр рекурсии по умолчанию отключено, во время создания новой области рекурсии для внутренних клиентов включенной рекурсии.

    
    Set-DnsServerRecursionScope -Name . -EnableRecursion $False
    Add-DnsServerRecursionScope -Name "InternalClients" -EnableRecursion $True 
    

Дополнительные сведения см. в разделе [DnsServerRecursionScope добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverrecursionscope?view=win10-ps)

#### <a name="bkmk_recpolicy"></a>Создание политики рекурсии DNS

DNS-сервера можно создать политики рекурсии, чтобы выбрать область рекурсии для набора запросов, которые соответствуют определенным критериям. 

Если DNS-сервер не является полномочным для некоторых запросов, политики рекурсии DNS-сервера позволяет управлять как для разрешения запросов. 

В этом примере области внутренней рекурсии с включена рекурсия, связанный с частному сетевому интерфейсу.

Следующая команда позволяет настроить политики рекурсии DNS.

    
    Add-DnsServerQueryResolutionPolicy -Name "SplitBrainRecursionPolicy" -Action ALLOW -ApplyOnRecursion -RecursionScope "InternalClients" -ServerInterfaceIP "EQ,10.0.0.39"
    

Дополнительные сведения см. в разделе [DnsServerQueryResolutionPolicy добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).

Теперь DNS-сервер настроен с помощью необходимых политик DNS для DNS-сервер или сервер разделенной имен с элементом управления выборочной рекурсии для внутренних клиентов.

Можно создать тысячи политик DNS в соответствии с трафиком требований к управлению, а все новые политики применяются динамически — без перезапуска DNS-сервер — на входящих запросов. 

Дополнительные сведения см. в разделе [руководство по сценарию политики DNS](DNS-Policy-Scenario-Guide.md).
