---
title: Использование политики DNS для Split-Brain развертывание DNS
description: Этот раздел является частью DNS политики сценарий руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: a255a4a5-c1a0-4edc-b41a-211bae397e3c
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 0b25ac752ea347f4d184628eb26bc7e297443306
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="use-dns-policy-for-split-brain-dns-deployment"></a>Использование политики DNS для развертывания вычислительных мощностей Split\ DNS

>Область применения: Windows Server 2016

В этом разделе можно использовать, чтобы узнать, как настроить политику DNS в Windows Server&reg; 2016 для развертываний с разделенной DNS, где существует две версии одной зоны — одного для внутренних пользователей в интрасети организации и для внешних пользователей, которые обычно являются пользователей в Интернете.

>[!NOTE]
>Сведения о том, как с помощью политики DNS для развертывания вычислительных мощностей split\ DNS с Active Directory интегрированной зоны DNS-сервера см. в разделе [использование политики DNS для Split-Brain DNS-сервер в Active Directory](dns-sb-with-ad.md).

Ранее этот сценарий требуется, что администраторы DNS поддерживать два различных DNS-сервера, каждой обслуживает пользователей, внутренние и внешние. Если имеется только несколько записей в зоне были split\ brained или обоих экземпляров зоны (внутренний и внешний) были делегированы же родительский домен, это стало conundrum управления. 

Другой сценарий конфигурации разделенной развертывания является выборочной управления рекурсии для разрешения имен DNS. В некоторых случаях для рекурсивного разрешения через Интернет для внутренних пользователей, хотя они также должны выступать в качестве полномочные серверы доменных имен для внешних пользователей и блокировать рекурсию для них ожидается корпоративный DNS-серверов. 

Этот раздел содержит следующие разделы.

- [Пример развертывания разделенная система DNS](#bkmk_sbexample)
- [Пример элемента управления выборочной рекурсии DNS](#bkmk_recursion)

##<a name="bkmk_sbexample"></a>Пример развертывания разделенная система DNS
Ниже приведен пример того, как использовать политику DNS для выполнения описано выше сценарии разделенная система DNS-сервера.

Этот раздел содержит следующие разделы.

- [Как работает развертывание разделенной системы DNS](#bkmk_sbhow)
- [Настройка развертывания разделенная система DNS](#bkmk_sbconfigure)


В этом примере используется один вымышленной компании Contoso, которая поддерживает веб-сайта на www.career.contoso.com.

Сайт имеет две версии, один для внутренних пользователей, где доступны учет внутренней работ. Внутренний сайт доступен в локальный IP-адрес 10.0.0.39. 

Вторая версия является открытой версией том же сайте, который доступен на странице общедоступный IP-адрес 65.55.39.10.

В отсутствие политики DNS администратору необходимо разместить эти две зоны на отдельных серверах Windows Server DNS и управлять ими отдельно. 

С помощью политики DNS этих зон может теперь размещаться на том же сервере DNS-сервера.  

Этот сценарий показана на следующем рисунке.

![Развертывание разделенной системы DNS](../../media/DNS-Split-Brain/Dns-Split-Brain-01.jpg)  


##<a name="bkmk_sbhow"></a>Как работает развертывание разделенной системы DNS

Когда DNS-сервер настроен необходимые политики DNS, каждый запрос на разрешение имен оценивается для политик на DNS-сервере.

Сервер интерфейс используется в этом примере в качестве условия для различения внутренних и внешних клиентов.

Если интерфейс сервера, на котором выдается запрос соответствует какой-либо политики, область связанные зоны используется для ответа на запрос. 

Таким образом в нашем примере для www.career.contoso.com DNS-запросов, полученных частный IP-адресов (10.0.0.56) получать ответ DNS, который содержит внутренний IP-адрес; и запросы DNS, которые поступают на общем сетевом интерфейсе получать ответ DNS, который содержит общий IP-адрес в области зоны по умолчанию (это так же, как обычный запрос разрешения).  

##<a name="bkmk_sbconfigure"></a>Настройка развертывания разделенная система DNS
Чтобы настроить развертывание Split-Brain DNS с помощью политики DNS, необходимо использовать следующие действия.

- [Создание областей зоны](#bkmk_zscopes)  
- [Добавить записи в области зоны](#bkmk_records)  
- [Создание политик DNS](#bkmk_policies)

В следующих разделах приводятся подробных инструкций по настройке.

>[!IMPORTANT]
>В следующих разделах приведены примеры Windows PowerShell команд, содержащих примеры значений для многих параметров. Убедитесь, замените примеры значений в этих командах со значениями, подходящими для вашего развертывания, прежде чем выполнять эти команды. 

###<a name="bkmk_zscopes"></a>Создание областей зоны

Область зоны представляет уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, с каждой областью зону, содержащую собственный набор DNS-записей. Ту же запись может быть представлен в нескольких областях, различные IP-адреса или одинаковые IP-адреса. 

>[!NOTE]
>По умолчанию область зоны существует для зон DNS. Эта область зоны имеет то же имя, что зона и устаревших операции DNS-сервера работают в этой области. Эта область зоны по умолчанию и будет размещаться внешняя версия www.career.contoso.com.

Следующий пример команды можно использовать для создания разделов зоне contoso.com области для создания областью внутренней зоны. Область внутренней зоны будет использоваться для сохранения внутренней версии www.career.contoso.com.

`Add-DnsServerZoneScope -ZoneName "contoso.com" -Name "internal"`

Дополнительные сведения см. в разделе [добавить DnsServerZoneScope](https://technet.microsoft.com/library/mt126267.aspx)

###<a name="bkmk_records"></a>Добавить записи в области зоны

Следующим шагом является добавление записей, представляющий веб-сервера в двух зоны областей - внутренней и по умолчанию (для внешних клиентов). 

В области внутренней зоны, запись **www.career.contoso.com** добавляется с IP-адрес 10.0.0.39, который будет использовать частных IP-адрес; и в области по умолчанию зона ту же запись **www.career.contoso.com**, добавляется 65.55.39.10 IP-адрес.

Не **— зонаобласть** параметр предоставляется в команды в следующем примере, когда запись добавляется в зону области по умолчанию. Это похоже на добавление записей соответствующего ванили зону.

`
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "65.55.39.10"
`
`
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "10.0.0.39” -ZoneScope "internal"
`

Дополнительные сведения см. в разделе [добавить DnsServerResourceRecord](https://technet.microsoft.com/library/jj649925.aspx).

###<a name="bkmk_policies"></a>Создание политик DNS

После того как вы определили интерфейсов сервера для внешней сети и внутренней сети и созданный области зоны, необходимо создать политики DNS, которые связывают области внутренних и внешних зоны.

>[!NOTE]
>В этом примере используется интерфейса сервера как условие для различения внутренних и внешних клиентов. Другой способ различать внешних и внутренних клиентов — с помощью как критерий для подсети клиента. Если можно определить подсети, к которым принадлежат внутренних клиентов, можно настроить политики DNS для различения на основе подсети клиента. Сведения о том, как настроить трафик управления, с помощью критериев подсети клиента см. в разделе [использование политики DNS для управления трафиком на основе географического расположения, основных серверах с](https://technet.microsoft.com/windows-server-docs/networking/dns/deploy/scenario--use-dns-policy-for-geo-location-based-traffic-management-with-primary-servers).

Когда DNS-сервер получает запрос на частный интерфейс, с область внутренней зоны возвращается ответа на запрос DNS.

>[!NOTE]
>Политики не требуются для сопоставления зоны области по умолчанию. 

В следующем примере команды 10.0.0.56 является IP-адрес интерфейса частной сети, как показано на предыдущем рисунке.

`Add-DnsServerQueryResolutionPolicy -Name "SplitBrainZonePolicy" -Action ALLOW -ServerInterface "eq,10.0.0.56" -ZoneScope "internal,1" -ZoneName contoso.com`

Дополнительные сведения см. в разделе [добавить DnsServerQueryResolutionPolicy](https://technet.microsoft.com/library/mt126273.aspx).  


## <a name="bkmk_recursion"></a>Пример элемента управления выборочной рекурсии DNS

Ниже приведен пример того, как использовать политику DNS для выполнения описано выше сценария управления выборочной рекурсии DNS.

Этот раздел содержит следующие разделы.

- [Как работает управления выборочной рекурсии DNS](#bkmk_recursionhow)
- [Настройка управления выборочной рекурсии DNS](#bkmk_recursionconfigure)

В этом примере же вымышленной компании, как в предыдущем примере Contoso, которая поддерживает веб-сайта на www.career.contoso.com.

В примере развертывания разделенная система DNS же DNS-сервер отвечает на запросы внешних и внутренних клиентов и предоставляет их разных ответов. 

В некоторых сценариях развертывания DNS может потребоваться же DNS-сервер для выполнения рекурсивного разрешения имен для внутренних клиентов, а также выступает в качестве полномочный сервер доменных имен для внешних клиентов. Это заставляет называют DNS выборочной рекурсию.

В предыдущих версиях Windows Server Включение рекурсии означало, что он был включен на все DNS-сервера для всех зон. Так как DNS-сервер ожидает также внешних запросов, рекурсия включена для внутренних и внешних клиентов, делая откройте распознавателя DNS-сервера. 

DNS-сервер, настроенный как открыть Сопоставитель может стать уязвимым для полного истощения ресурсов и можно использовать для создания отражения атак злоумышленниками. 

По этой причине Администраторы Contoso DNS не захотите, DNS-сервер для домена contoso.com для рекурсивного разрешения имен для внешних клиентов. Необходим только для управления рекурсию для внутренних клиентов во время управления рекурсии могут быть заблокированы для внешних клиентов. 

Этот сценарий показана на следующем рисунке.

![Выборочная рекурсии управления](../../media/DNS-Split-Brain/Dns-Split-Brain-02.jpg) 


### <a name="bkmk_recursionhow"></a>Как работает управления выборочной рекурсии DNS

При получении запроса, для которого Contoso DNS-сервер — не заслуживающий доверия, например для www.microsoft.com, затем запрос разрешения имени оценивается для политик на DNS-сервере. 

Так как эти запросы, не попадают в разделе во всех зонах, зоны уровень политики \ (как определено в разделенной example\) не проверяется. 

DNS-сервер оценивает политики рекурсии и запросов, полученных на соответствие частный интерфейс **SplitBrainRecursionPolicy**. Эта политика указывает рекурсии области, где включена рекурсию.

DNS-сервер выполняет рекурсию для получения ответов для www.microsoft.com из Интернета и кэширует ответ локально. 

При получении запроса на внешний интерфейс, совпадений политики DNS и рекурсии по умолчанию — в данном случае — **отключено** -применяется.

Это предотвращает сервера выступает в качестве откройте распознавателя, для внешних клиентов, когда он выступает в качестве кэширования разрешения для внутренних клиентов. 

### <a name="bkmk_recursionconfigure"></a>Настройка управления выборочной рекурсии DNS

Настройка управления выборочной рекурсии DNS с помощью политики DNS, необходимо использовать следующие действия.

- [Создание областей рекурсии DNS](#bkmk_recscopes)
- [Создание политик рекурсии DNS](#bkmk_recpolicy)

#### <a name="bkmk_recscopes"></a>Создание областей рекурсии DNS

Области рекурсии являются уникальный экземпляров группы параметров, контролирующие рекурсию на DNS-сервере. Область рекурсии содержит список серверов пересылки и указывает, включен ли рекурсию. DNS-сервер может иметь много областей рекурсию. 

Параметр устаревших рекурсии и списка серверов пересылки, называются рекурсии области по умолчанию. Невозможно добавить или удалить область рекурсии по умолчанию, определяемый точка имя \("." \).

В этом примере параметр рекурсии по умолчанию отключен, при создании новой области рекурсию для внутренних клиентов активированной рекурсию.

    
    Set-DnsServerRecursionScope -Name . -EnableRecursion $False
    Add-DnsServerRecursionScope -Name "InternalClients" -EnableRecursion $True 
    

Дополнительные сведения см. в разделе [добавить DnsServerRecursionScope](https://technet.microsoft.com/library/mt126268.aspx)

#### <a name="bkmk_recpolicy"></a>Создание политик рекурсии DNS

DNS-сервера можно создать политики рекурсии Выбор рекурсии область для нескольких запросов, которые соответствуют определенным критериям. 

Если DNS-сервер не является полномочным для некоторых запросов, политики рекурсии сервера DNS позволяют управлять как для разрешения запросов. 

В этом примере область внутренней рекурсии с рекурсии включена связана с интерфейса частной сети

Следующий пример команды можно использовать для настройки политик рекурсии DNS.

    
    Add-DnsServerQueryResolutionPolicy -Name "SplitBrainRecursionPolicy" -Action ALLOW -ApplyOnRecursion -RecursionScope "InternalClients" -ServerInterfaceIP  "EQ,10.0.0.39"
    

Дополнительные сведения см. в разделе [добавить DnsServerQueryResolutionPolicy](https://technet.microsoft.com/library/mt126273.aspx).

Теперь DNS-сервер настроен с необходимые политики DNS для разделенной имя сервера или DNS-сервера с включенным для внутренних клиентов управлением выборочной рекурсию.

Можно создать тысячи политик DNS в соответствии с трафик требования к управлению, и все новые политики применяются динамически — без перезагрузки DNS-сервер — на входящие запросы. 

Дополнительные сведения см. в разделе [руководство по сценарию политики DNS](DNS-Policy-Scenario-Guide.md).
