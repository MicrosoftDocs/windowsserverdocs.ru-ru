---
title: Развертывание разделенной системы DNS с помощью политики DNS
description: Этот раздел является частью руководств по сценариям политики DNS для Windows Server 2016.
manager: brianlic
ms.topic: article
ms.assetid: a255a4a5-c1a0-4edc-b41a-211bae397e3c
ms.author: lizross
author: eross-msft
ms.openlocfilehash: bc1e63ff865a7eb6d4d83c75d6c2680dcf8ddb49
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87996864"
---
# <a name="use-dns-policy-for-split-brain-dns-deployment"></a>Использование политики DNS для разделения раздельного \- развертывания DNS

>Применяется к: Windows Server 2016

С помощью этого раздела вы узнаете, как настроить политику DNS в Windows Server &reg; 2016 для раздельных развертываний DNS, где есть две версии одной зоны — одна для внутренних пользователей в интрасети организации, а другая — для внешних пользователей, которые обычно являются пользователями в Интернете.

>[!NOTE]
>Сведения о том, как использовать политику DNS для разделения раздельного \- развертывания DNS с помощью Active Directory интегрированных зоны DNS, см. [в статье Использование политики DNS для разделения с помощью dns в Active Directory](dns-sb-with-ad.md).

Ранее этот сценарий требовал, чтобы администраторы DNS поддерживали два разных DNS-сервера, каждый из которых предоставляет службы каждому набору пользователей, внутренним и внешним. Если несколько записей в зоне были разделены, \- или оба экземпляра зоны (внутренние и внешние) были делегированы в один и тот же родительский домен, это стало загадка управления.

Еще один сценарий настройки для развертывания с разделением-мозгом — выборочный контроль рекурсии для разрешения DNS-имен. В некоторых обстоятельствах DNS-серверы предприятия должны выполнять рекурсивное разрешение для внутренних пользователей, а также как полномочные серверы имен для внешних пользователей и блокировать рекурсию для них.

В этом разделе содержатся следующие подразделы.

- [Пример развертывания DNS с разделением-мозгом](#bkmk_sbexample)
- [Пример управления выборочной рекурсией DNS](#bkmk_recursion)

## <a name="example-of-dns-split-brain-deployment"></a><a name="bkmk_sbexample"></a>Пример развертывания DNS с разделением-мозгом
Ниже приведен пример того, как можно использовать политику DNS для выполнения описанного выше сценария «разделение-DNS».

Этот раздел содержит следующие подразделы.

- [Как работает развертывание с разделением DNS](#bkmk_sbhow)
- [Настройка развернутого сервера с разделением DNS](#bkmk_sbconfigure)

В этом примере используется одна вымышленная компания Contoso, которая поддерживает веб-узел карьеры по адресу www.career.contoso.com.

Сайт имеет две версии — один для внутренних пользователей, где доступны внутренние сообщения о заданиях. Этот внутренний сайт доступен по локальному IP-адресу 10.0.0.39.

Вторая версия — это общедоступная версия того же сайта, которая доступна по общедоступному IP-адресу 65.55.39.10.

В отсутствие политики DNS администратору необходимо размещать эти две зоны на отдельных DNS-серверах Windows Server и управлять ими отдельно.

С помощью политик DNS эти зоны теперь можно размещать на одном DNS-сервере.

Этот сценарий показан на следующем рисунке.

![Раздельное развертывание DNS](../../media/DNS-Split-Brain/Dns-Split-Brain-01.jpg)

## <a name="how-dns-split-brain-deployment-works"></a><a name="bkmk_sbhow"></a>Как работает развертывание с разделением DNS

Если DNS-сервер настроен с использованием требуемых политик DNS, каждый запрос разрешения имен оценивается по политикам на DNS-сервере.

В этом примере интерфейс сервера используется в качестве критерия для различения внутренних и внешних клиентов.

Если серверный интерфейс, на котором получен запрос, соответствует любой из политик, то соответствующая область зоны используется для ответа на запрос.

Таким образом, в нашем примере запросы DNS для www.career.contoso.com, полученные на частном IP-адресе (10.0.0.56), получают ответ DNS, который содержит внутренние IP-адреса. и запросы DNS, получаемые в общедоступном сетевом интерфейсе, получают ответ DNS, содержащий общедоступный IP-адрес в области зоны по умолчанию (это то же самое, что и обычная разрешающая способность запросов).

## <a name="how-to-configure-dns-split-brain-deployment"></a><a name="bkmk_sbconfigure"></a>Настройка развернутого сервера с разделением DNS
Чтобы настроить развертывание с разделением DNS с помощью политики DNS, необходимо выполнить следующие действия.

- [Создание областей зоны](#bkmk_zscopes)
- [Добавление записей в области зоны](#bkmk_records)
- [Создание политик DNS](#bkmk_policies)

В следующих разделах приведены подробные инструкции по настройке.

>[!IMPORTANT]
>В следующих разделах приведены примеры команд Windows PowerShell, которые содержат примеры значений для многих параметров. Перед выполнением этих команд обязательно замените примеры значений в этих командах значениями, подходящими для вашего развертывания.

### <a name="create-the-zone-scopes"></a><a name="bkmk_zscopes"></a>Создание областей зоны

Область зоны — это уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, при этом каждая область зоны содержит собственный набор записей DNS. Одна и та же запись может присутствовать в нескольких областях с разными IP-адресами или IP-адресами.

> [!NOTE]
> По умолчанию область зоны существует в зонах DNS. Эта область зоны имеет то же имя, что и зона, а устаревшие операции DNS работают в этой области. В этой области зоны по умолчанию будет размещена внешняя версия www.career.contoso.com.

Можно использовать следующий пример команды, чтобы секционировать область зоны contoso.com для создания внутренней области зоны. Внутренняя область зоны будет использоваться для сохранения внутренней версии www.career.contoso.com.

`Add-DnsServerZoneScope -ZoneName "contoso.com" -Name "internal"`

Дополнительные сведения см. в разделе [Add-днссерверзонескопе](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps) .

### <a name="add-records-to-the-zone-scopes"></a><a name="bkmk_records"></a>Добавление записей в области зоны

Следующим шагом является добавление записей, представляющих узел веб-сервера, в две области зоны — внутренние и по умолчанию (для внешних клиентов).

В области внутренней зоны <strong>www.Career.contoso.com</strong> запись добавляется с IP-адресом 10.0.0.39, который является частным адресом. и в области зоны по умолчанию с IP-адресом 65.55.39.10 добавляется та же запись <strong>www.Career.contoso.com</strong>.

При добавлении записи в область зоны по умолчанию в следующих примерах команд отсутствует параметр **– зонескопе** . Это похоже на добавление записей в зону обычный.

`
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "65.55.39.10"
`
`
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "10.0.0.39” -ZoneScope "internal"
`

Дополнительные сведения см. в разделе [Add-днссерверресаурцерекорд](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).

### <a name="create-the-dns-policies"></a><a name="bkmk_policies"></a>Создание политик DNS

После определения интерфейсов сервера для внешней сети и внутренней сети, а также для создания областей зоны необходимо создать политики DNS, которые соединяют внутренние и внешние области зоны.

>[!NOTE]
>В этом примере серверный интерфейс используется в качестве критерия для различения внутренних и внешних клиентов. Другим способом различения внешних и внутренних клиентов является использование подсетей клиента в качестве критерия. Если вы можете определить подсети, к которым принадлежат внутренние клиенты, можно настроить политику DNS, чтобы отличать их от подсети клиента. Сведения о настройке управления трафиком с помощью критериев подсети клиента см. в статье [Использование политики DNS для управления трафиком на основе географического расположения с основными серверами](https://technet.microsoft.com/windows-server-docs/networking/dns/deploy/scenario--use-dns-policy-for-geo-location-based-traffic-management-with-primary-servers).

Когда DNS-сервер получает запрос к частному интерфейсу, ответ на запрос DNS возвращается из внутренней области зоны.

>[!NOTE]
>Для сопоставления области зоны по умолчанию не требуются никакие политики.

В следующем примере команда 10.0.0.56 является IP-адресом частного сетевого интерфейса, как показано на предыдущем рисунке.

`Add-DnsServerQueryResolutionPolicy -Name "SplitBrainZonePolicy" -Action ALLOW -ServerInterface "eq,10.0.0.56" -ZoneScope "internal,1" -ZoneName contoso.com`

Дополнительные сведения см. в разделе [Add-днссерверкуериресолутионполици](/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).

## <a name="example-of-dns-selective-recursion-control"></a><a name="bkmk_recursion"></a>Пример управления выборочной рекурсией DNS

Ниже приведен пример того, как можно использовать политику DNS для выполнения описанного выше сценария управления селективной рекурсией DNS.

Этот раздел содержит следующие подразделы.

- [Как работает управление селективной рекурсией DNS](#bkmk_recursionhow)
- [Настройка управления выборочной рекурсией DNS](#bkmk_recursionconfigure)

В этом примере используется та же вымышленная компания, что и в предыдущем примере, Contoso, который поддерживает веб-узел карьеры по адресу www.career.contoso.com.

В примере развертывания DNS Split-мозгового сервера тот же DNS-сервер отвечает как внешним, так и внутренним клиентам и предоставляет им разные ответы.

Некоторые развертывания DNS могут потребовать, чтобы один и тот же DNS-сервер выполнял рекурсивное разрешение имен для внутренних клиентов, помимо того, чтобы выступать в роли полномочного сервера имен для внешних клиентов. Это называется контролем выборочной рекурсии DNS.

В предыдущих версиях Windows Server Включение рекурсии означало, что оно было включено на всем DNS-сервере для всех зон. Так как DNS-сервер также прослушивает внешние запросы, рекурсия включается как для внутренних, так и для внешних клиентов, что делает DNS-сервер открытым сопоставительом.

DNS-сервер, настроенный как открытый сопоставитель, может быть уязвим для исчерпания ресурсов и может быть заражен вредоносными клиентами для создания атак с отражением.

По этой причине Администраторы DNS Contoso не хотят, чтобы DNS-сервер для contoso.com выполнял рекурсивное разрешение имен для внешних клиентов. Для внутренних клиентов требуется только управление рекурсией, в то время как управление рекурсией может быть заблокировано для внешних клиентов.

Этот сценарий показан на следующем рисунке.

![Управление выборочной рекурсией](../../media/DNS-Split-Brain/Dns-Split-Brain-02.jpg)


### <a name="how-dns-selective-recursion-control-works"></a><a name="bkmk_recursionhow"></a>Как работает управление селективной рекурсией DNS

Если получен запрос, для которого DNS-сервер Contoso является неполномочным, например для https://www.microsoft.com , запрос разрешения имени оценивается по политикам на DNS-сервере.

Поскольку эти запросы не попадают ни в одну зону, политики уровня зоны, \( как определено в примере Split-мозг, \) не оцениваются.

DNS-сервер оценивает политики рекурсии, а запросы, получаемые в частном интерфейсе, соответствуют **сплитбраинрекурсионполици**. Эта политика указывает на область рекурсии, в которой включена рекурсия.

Затем DNS-сервер выполняет рекурсию для получения ответа https://www.microsoft.com из Интернета и кэширует ответ локально.

Если запрос получен на внешнем интерфейсе, политики DNS не совпадают, и параметр рекурсии по умолчанию, который в данном случае **отключен** , применяется.

Это не позволяет серверу выступать в качестве открытого сопоставителя для внешних клиентов, пока он выступает в качестве сопоставителя кэширования для внутренних клиентов.

### <a name="how-to-configure-dns-selective-recursion-control"></a><a name="bkmk_recursionconfigure"></a>Настройка управления выборочной рекурсией DNS

Чтобы настроить управление выборочной рекурсией DNS с помощью политики DNS, необходимо выполнить следующие действия.

- [Создание областей рекурсии DNS](#bkmk_recscopes)
- [Создание политик рекурсии DNS](#bkmk_recpolicy)

#### <a name="create-dns-recursion-scopes"></a><a name="bkmk_recscopes"></a>Создание областей рекурсии DNS

Области рекурсии являются уникальными экземплярами группы параметров, которые управляют рекурсией на DNS-сервере. Область рекурсии содержит список серверов пересылки и указывает, включена ли рекурсия. DNS-сервер может иметь много областей рекурсии.

Устаревший параметр рекурсии и список серверов пересылки называются областью рекурсии по умолчанию. Невозможно добавить или удалить область рекурсии по умолчанию, обозначенную точкой с именем \( "." \) .

В этом примере параметр рекурсии по умолчанию отключен, а также создается новая область рекурсии для внутренних клиентов, где включена рекурсия.

```powershell
Set-DnsServerRecursionScope -Name . -EnableRecursion $False
Add-DnsServerRecursionScope -Name "InternalClients" -EnableRecursion $True
```

Дополнительные сведения см. в разделе [Add-днссерверрекурсионскопе](/powershell/module/dnsserver/add-dnsserverrecursionscope?view=win10-ps) .

#### <a name="create-dns-recursion-policies"></a><a name="bkmk_recpolicy"></a>Создание политик рекурсии DNS

Можно создать политики рекурсии DNS-сервера, чтобы выбрать область рекурсии для набора запросов, соответствующих указанным условиям.

Если DNS-сервер не является полномочным для некоторых запросов, политики рекурсии DNS-сервера позволяют управлять способом разрешения запросов.

В этом примере внутренняя область рекурсии с включенной рекурсией связана с частным сетевым интерфейсом.

Для настройки политик рекурсии DNS можно использовать приведенный ниже пример команды.

```powershell
Add-DnsServerQueryResolutionPolicy -Name "SplitBrainRecursionPolicy" -Action ALLOW -ApplyOnRecursion -RecursionScope "InternalClients" -ServerInterfaceIP "EQ,10.0.0.39"
```

Дополнительные сведения см. в разделе [Add-днссерверкуериресолутионполици](/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).

Теперь DNS-сервер настроен с использованием требуемых политик DNS для сервера доменных имен с разделением или DNS-сервера, для которого включено выборочное управление рекурсией для внутренних клиентов.

Вы можете создавать тысячи политик DNS в соответствии с требованиями к управлению трафиком, а все новые политики применяются динамически, без перезапуска DNS-сервера во входящих запросах.

Дополнительные сведения см. в разделе [руководств по сценариям политики DNS](DNS-Policy-Scenario-Guide.md).