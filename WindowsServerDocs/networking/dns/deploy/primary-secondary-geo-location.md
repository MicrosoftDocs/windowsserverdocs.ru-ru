---
title: Для управления трафиком с основных и вспомогательных серверах на основе географического расположения с помощью политики DNS
description: Этот раздел является частью DNS политики сценарий руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: a9ee7a56-f062-474f-a61c-9387ff260929
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 4c78a0198e29fb59f30fd8ad776c7f200312d014
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="use-dns-policy-for-geo-location-based-traffic-management-with-primary-secondary-deployments"></a>Для управления трафиком с основных и вспомогательных серверах на основе географического расположения с помощью политики DNS

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать, чтобы узнать, как создать политики DNS для управления трафиком на основе географического расположения, если развертывание DNS включает основного и дополнительного DNS-серверов.  

Предыдущий сценарий [использование политики DNS для управления трафиком на основе географического расположения, основных серверах с](primary-geo-location.md), предоставляются инструкции по настройке политики DNS для управления трафиком на основе географического расположения на основной DNS-сервер. В инфраструктуре Интернета Однако DNS-серверы широко развертываются в основных и вспомогательных модель, доступный для записи копия зоны хранится на основных серверах, выберите и безопасность, и только для чтения копии зоны хранятся на несколько дополнительных серверов.   
  
Вторичные серверы используйте протоколы передачи зоны полномочным передачи (AXFR) и добавочные передачи зоны (IXFR) для запроса и получения обновлений зоны, включая новые изменения в зоны на основной DNS-серверов.   
  
>[!NOTE]
>Дополнительные сведения о AXFR см. в разделе Internet Engineering Task Force (IETF) [запрос комментарии 5936](https://tools.ietf.org/rfc/rfc5936.txt). Дополнительные сведения о IXFR см. в разделе Internet Engineering Task Force (IETF) [запрос 1995 комментарии](https://tools.ietf.org/html/rfc1995).  
  
## <a name="bkmk_example"></a>Пример управления трафиком на основе географического расположения на основных и вспомогательных  
Ниже приведен пример того, как использовать политику DNS в развертывании основных и вспомогательных для достижения перенаправление трафика на основании физического расположения клиента, который выполняет запрос DNS.  
  
В этом примере используется двух вымышленные компаний - Contoso облачные службы, который предоставляет веб доменов и размещения решения; и Woodgrove еда служб, который предоставляет службы доставки еда в нескольких городов со всего мира и с веб-сайт с именем woodgrove.com.  
  
Чтобы убедиться, что клиенты woodgrove.com получить быстрое взаимодействие с веб-сайтах, Woodgrove хочет европейской клиентов направлен на европейской центра обработки данных и American направлен США центра обработки данных. Клиентов, расположенных в других местах в мире может быть перенаправлен к любой из центров обработки данных.  
  
Contoso облачных служб имеет двумя центрами обработки данных, в США и в Европе, на котором Contoso размещает его еда порядок портал для woodgrove.com.  
  
Развертывание Contoso DNS включает два вторичных сервера: **SecondaryServer1**, с IP-адресом 10.0.0.2; и **SecondaryServer2**, с IP-адресом 10.0.0.3. Эти дополнительные серверы действуют как серверы имен в двух разных регионах с SecondaryServer1, расположенных в Европе и SecondaryServer2, расположенных в США.
  
Отсутствует основная зона для записи копии на **PrimaryServer** (IP-адрес 10.0.0.1), где были сделаны изменения зоны. С передачами зон регулярных на серверах-получателях вторичные серверы установлены всегда зону на PrimaryServer новые изменения.
  
Этот сценарий показана на следующем рисунке.
  
![Пример управления трафиком на основе географического расположения на основных и вспомогательных](../../media/Dns-Policy_PS1/dns_policy_primarysecondary1.jpg)  
   
## <a name="bkmk_works"></a>Как работает система основной дополнительный DNS-сервера

При развертывании управление трафиком на основе географического расположения в развертывании основной дополнительный DNS-сервера, важно понять, как обычный зоны основных и вспомогательных перенос перед изучение уровня передачи зон область. Следующие разделы содержат сведения, зоны и уровня передачи зон области.  
  
- [Передачи зоны в развертывании основной дополнительный DNS-сервера](#bkmk_zone)  
- [Область уровня зоны передает в развертывании основной дополнительный DNS-сервера](#bkmk_scope)  
  
### <a name="bkmk_zone"></a>Передачи зоны в развертывании основной дополнительный DNS-сервера

Можно создать развертывания основных и вспомогательных DNS и синхронизировать зон указанные ниже действия.  
1. При установке DNS основная зона создается на основной DNS-сервер.  
2. На сервере-получателе Создайте зоны и укажите основных серверов.   
3. На основных серверах можно добавить дополнительных серверов как надежных уведомлений дополнительных основной зоны.   
4. Дополнительные зоны запроса передачи полного зоны (AXFR) и получать копии зоны.   
5. При необходимости, основные серверы отправлять уведомления об обновлениях зоны вторичные серверы.  
6. Вторичные серверы отправить запрос на передачи добавочные зоны (IXFR). По этой причине вторичные серверы будут синхронизированы с основного сервера.   
  
### <a name="bkmk_scope"></a>Область уровня зоны передает в развертывании основной дополнительный DNS-сервера

Сценарий трафика управления требует дополнительных шагов для создания разделов зоны в области другой зоны. По этой причине дополнительные действия, необходимые для передачи данных внутри области зоны на серверах-получателях и передача политик и подсети клиента DNS в дополнительных серверов.   
  
После настройки инфраструктуры DNS на серверах основного и дополнительного уровня передачи зон область автоматически выполняется путем DNS, с помощью следующих процедур.  
  
Чтобы обеспечить передачу уровня области зоны, DNS-серверы используют механизмы расширений для записи Ресурса необязательно DNS (EDNS0). Всех запросов на передачу (AXFR и IXFR) зон из зоны с помощью областей создаются с помощью записи EDNS0 отказаться от Ресурса, идентификатор которого параметр по умолчанию установлен «65433». Дополнительные сведения о EDNSO см. в разделе IETF [запрос 6891 комментарии](https://tools.ietf.org/html/rfc6891).  
  
Имя области зоны, для которого отправляется запрос значение ресурса необязательно. Если основной DNS-сервер получает этот пакет из доверенного сервера-получателя, он интерпретирует запрос поступающий для данной области зоны.   
  
Если основной сервер имеет область этой зоны он отвечает передачи (XFR) данных из этой области. Ответ содержит RR СОГЛАСИТЬСЯ с таким же Идентификатором параметр «65433» и значение, установленное для той же области зоны. Вторичные серверы получение этого ответа, получать сведения об области из ответ и обновление конкретной области применения зоны.  
  
После этого процесса основной сервер поддерживает список доверенных уведомлений дополнительных, которые отправили такой зоны область запрос для получения уведомлений.   
  
Все дальнейшие обновления в область зоны IXFR уведомление отправляется на серверах-получателях, с помощью того же Ресурса необязательно. Область зоны, получения этого уведомления делает запрос IXFR, содержащий RR, необязательно и том же процессе, как описано выше ниже.  
  
## <a name="bkmk_config"></a>Настройка политики DNS для управления трафиком на основе географического расположения основных и вспомогательных

Прежде чем начать, убедитесь, что выполнены все действия, описанные в разделе [использование политики DNS для управления трафиком на основе географического расположения, основных серверах с](../../dns/deploy/Scenario--Use-DNS-Policy-for-Geo-Location-Based-Traffic-Management-with-Primary-Servers.md), и основной DNS-сервер настроен с зон, области зоны, подсети клиента DNS и политики DNS.  
  
>[!NOTE]
> Инструкции в этом разделе для копирования политики DNS, подсети клиента DNS-сервера и области зоны из основных серверов DNS дополнительных DNS-серверов предназначены для начальной настройки DNS-сервера и проверки. В будущем может потребоваться изменить подсети клиента DNS, области зоны и параметров политик на сервере-источнике. В этом случае можно создавать сценарии автоматизации для обеспечения вторичных серверов, которые синхронизируются с основного сервера.  
  
Чтобы настроить политики географического расположения основных и вспомогательных на основе ответы на запросы DNS, необходимо выполнить следующие действия.  
  
- [Создайте дополнительной зоны](#bkmk_secondary)  
- [Настройка параметров передачи зоны на основную зону](#bkmk_zonexfer)  
- [Скопируйте подсети клиента DNS](#bkmk_client)  
- [Создание областей зоны на дополнительный сервер](#bkmk_zonescopes)  
- [Настройка политики DNS](#bkmk_dnspolicy)  
  
В следующих разделах приводятся подробных инструкций по настройке.  
  
>[!IMPORTANT]
>В следующих разделах приведены примеры Windows PowerShell команд, содержащих примеры значений для многих параметров. Убедитесь, замените примеры значений в этих командах со значениями, подходящими для вашего развертывания, прежде чем выполнять эти команды.  
><br>Членство в группе **DnsAdmins**, или наличие эквивалентных прав, необходимых для выполнения следующих процедур.  
  
### <a name="bkmk_secondary"></a>Создайте дополнительной зоны

Можно создать дополнительный копия зоны, необходимо реплицировать SecondaryServer1 и SecondaryServer2 (при условии командлеты выполнялись удаленно с помощью клиента единого управления).   
  
Например можно создать дополнительный копия www.woodgrove.com на SecondaryServer1 и SecondarySesrver2.  
  
Следующие команды Windows PowerShell можно использовать для создания дополнительной зоны.  
  
    
    Add-DnsServerSecondaryZone -Name "woodgrove.com" -ZoneFile "woodgrove.com.dns" -MasterServers 10.0.0.1 -ComputerName SecondaryServer1  
      
    Add-DnsServerSecondaryZone -Name "woodgrove.com" -ZoneFile "woodgrove.com.dns" -MasterServers 10.0.0.1 -ComputerName SecondaryServer2  
      

Дополнительные сведения см. в разделе [добавить DnsServerSecondaryZone](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserversecondaryzone?view=win10-ps).  
  
### <a name="bkmk_zonexfer"></a>Настройка параметров передачи зоны на основную зону

Необходимо настроить параметры основная зона, чтобы:

1. Разрешены передачи зон с основного сервера на указанный вторичные серверы.  
2. Уведомления об обновлениях зоны передается с основного сервера вторичные серверы.  
  
Следующие команды Windows PowerShell можно использовать для настройки параметров передачи зоны на основную зону.
  
>[!NOTE]
>В следующем примере команды параметр **-уведомить** указывает, что основной сервер будет отправлять уведомления об обновлениях в списке уведомлений дополнительных.  
  
    
    Set-DnsServerPrimaryZone -Name "woodgrove.com" -Notify Notify -SecondaryServers "10.0.0.2,10.0.0.3" -SecureSecondaries TransferToSecureServers -ComputerName PrimaryServer  
     
  
Дополнительные сведения см. в разделе [Set-DnsServerPrimaryZone](https://https://docs.microsoft.com/powershell/module/dnsserver/set-dnsserverprimaryzone?view=win10-ps).  
  
  
### <a name="bkmk_client"></a>Скопируйте подсети клиента DNS

Необходимо скопировать подсети клиента DNS с основного сервера вторичные серверы.
  
Следующие команды Windows PowerShell можно использовать для копирования подсетей вторичные серверы.
  
    
    Get-DnsServerClientSubnet -ComputerName PrimaryServer | Add-DnsServerClientSubnet -ComputerName SecondaryServer1  
      
    Get-DnsServerClientSubnet -ComputerName PrimaryServer | Add-DnsServerClientSubnet -ComputerName SecondaryServer2  
      

Дополнительные сведения см. в разделе [добавить DnsServerClientSubnet](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverclientsubnet?view=win10-ps).  
  
### <a name="bkmk_zonescopes"></a>Создание областей зоны на дополнительный сервер

На серверах-получателях, необходимо создать области зоны. В DNS области зоны также приступить к запросу XFRs с основного сервера. Любые изменения в области зоны на сервере-источнике уведомление, содержащее сведения об области зоны отправляется вторичные серверы. Вторичные серверы можно обновить их области зоны с помощью добавочных изменений.  
  
Для создания областей зоны на серверах-получателях, можно использовать следующие команды Windows PowerShell.  
  
    
    Get-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName PrimaryServer|Add-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName SecondaryServer1 -ErrorAction Ignore  
      
    Get-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName PrimaryServer|Add-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName SecondaryServer2 -ErrorAction Ignore  
  

>[!NOTE]
>В этих примерах команд **- ErrorAction игнорировать** параметр включается, так как область зоны по умолчанию существует в каждой зоне. Не удается создать или удалить области зоны по умолчанию. Конвейеризация приведет к попытка создать эта область и оно завершится ошибкой. Кроме того можно создать области зоны не по умолчанию на двух дополнительные зоны.  
  
Дополнительные сведения см. в разделе [добавить DnsServerZoneScope](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps).  
  
### <a name="bkmk_dnspolicy"></a>Настройка политики DNS

После создания подсетей разделов (области зоны) и вы добавили записей, необходимо создать политики, которые связывают подсети и разделы, чтобы при запросе поступает из источника в одной подсети клиента DNS, ответ на запрос возвращается из области действия зоны. Политики не требуются для сопоставления зоны области по умолчанию.  
  
Следующие команды Windows PowerShell можно использовать для создания политики DNS со ссылкой подсети клиента DNS-сервера и области зоны.   
    
    $policy = Get-DnsServerQueryResolutionPolicy -ZoneName "woodgrove.com" -ComputerName PrimaryServer  
      
    $policy | Add-DnsServerQueryResolutionPolicy -ZoneName "woodgrove.com" -ComputerName SecondaryServer1  
      
    $policy | Add-DnsServerQueryResolutionPolicy -ZoneName "woodgrove.com" -ComputerName SecondaryServer2  
      

Дополнительные сведения см. в разделе [добавить DnsServerQueryResolutionPolicy](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  
  
Теперь вторичные серверы DNS настроены необходимые политики DNS для перенаправления трафика в зависимости от географического расположения.  
  
Когда DNS-сервер получает запросы разрешения имен, DNS-сервер оценивает поля на DNS-запрос от настроенных политик DNS. Если исходный IP-адрес в запросе на разрешение имени соответствует какой-либо политики, область связанные зоны используется реагировать на запрос, и пользователь направляется на ресурс, который географически ближайшего к ним.   
  
Можно создать тысячи политик DNS в соответствии с трафик требования к управлению, и все новые политики применяются динамически — без перезагрузки DNS-сервер — на входящие запросы.
