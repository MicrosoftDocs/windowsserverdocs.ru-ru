---
title: Управление трафиком на основе географического расположения на основных и вспомогательных серверах с помощью политики DNS
description: Этот раздел является частью DNS политики сценария руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: a9ee7a56-f062-474f-a61c-9387ff260929
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 6869ee5f39f1719a3c71025207ef9ffe740492ff
ms.sourcegitcommit: d84dc3d037911ad698f5e3e84348b867c5f46ed8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2019
ms.locfileid: "66266788"
---
# <a name="use-dns-policy-for-geo-location-based-traffic-management-with-primary-secondary-deployments"></a>Управление трафиком на основе географического расположения на основных и вспомогательных серверах с помощью политики DNS

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Дополнительные сведения о создании политики DNS для управления трафиком на основе географического расположения, при развертывание DNS включает основной и дополнительный DNS-серверы можно использовать в этом разделе.  

Приведенном выше сценарии [помощью политики DNS для управления трафиком на основе географического расположения, с серверов-источников](primary-geo-location.md), предоставлены инструкции по настройке политики DNS для управления трафиком на основе географического расположения на основной DNS-сервер. В инфраструктуре Интернета Однако на DNS-серверы широко развертываются в основных и вспомогательных модель, доступный для записи копия зоны хранится на select и безопасность серверов-источников, и только для чтения копии зоны хранятся на нескольких серверов-получателей.   
  
Серверы-получатели использовать протоколы передачи зоны заслуживающие доверия передачи (AXFR) и добавочные передачи зоны (IXFR) запрашивать и получать обновления зоны, которые включают новые изменения в зоны на основной DNS-серверов.   
  
>[!NOTE]
>Дополнительные сведения о AXFR, см. в разделе Internet Engineering Task Force (IETF) [запрос комментарии 5936](https://tools.ietf.org/rfc/rfc5936.txt). Дополнительные сведения о IXFR, см. в разделе Internet Engineering Task Force (IETF) [запрос 1995 комментарии](https://tools.ietf.org/html/rfc1995).  
  
## <a name="primary-secondary-geo-location-based-traffic-management-example"></a>Географическое местоположение основных и вспомогательных основе пример управления трафика  
Ниже приведен пример того, как использовать политики DNS в развертывании основных и вспомогательных для достижения перенаправление трафика на основе физического расположения клиента, который выполняет запрос DNS.  
  
В этом примере используется двух вымышленных компаний - Contoso облачных служб, который предоставляет веб- и домена, размещение решений; и качества пищевых продуктов Woodgrove службы, которая предоставляет службы доставки качества пищевых продуктов в нескольких городах по всему миру и содержит веб-сайт с именем woodgrove.com.  
  
Чтобы убедиться, что woodgrove.com клиенты получают более высокую скорость работы с их веб-сайта, Woodgrove хочет европейских клиенты, направлен в европейских центр обработки данных и American клиенты, направлен в центр обработки данных США. Клиентов, расположенных в других местах в мире может быть перенаправлен к любой из центров обработки данных.  
  
Облачные службы Contoso имеет два центра обработки данных, в США, а другой в Европе, на которой Contoso размещает его качества пищевых продуктов, упорядочение портал для woodgrove.com.  
  
Развертывание Contoso DNS включает в себя два сервера-получателя: **SecondaryServer1**, IP-адресом 10.0.0.2; и **SecondaryServer2**, IP-адрес 10.0.0.3. Эти дополнительные серверы действующих как серверы имен в двух разных регионах с SecondaryServer1, расположенных в Европе и SecondaryServer2, расположенные в США
  
Отсутствует основная зона для записи копии на **PrimaryServer** (IP-адрес 10.0.0.1), где были сделаны изменения зоны. С помощью передачи регулярных зон на серверах-получателях серверы-получатели всегда являются курсе изменений в зону на PrimaryServer.
  
Этот сценарий показан на следующем рисунке.
  
![Географическое местоположение основных и вспомогательных основе пример управления трафика](../../media/Dns-Policy_PS1/dns_policy_primarysecondary1.jpg)  
   
## <a name="how-the-dns-primary-secondary-system-works"></a>Как работает система основных и вспомогательных DNS

Когда вы развертываете управление трафиком на основе географического расположения в развертывании основной дополнительный DNS, важно понимать, как обычный основных и вспомогательных зоны, перенос, прежде чем перейти к уровня передачи зоны области. В следующих разделах сведения зоны и передач уровня области зоны.  
  
- [Передачи зоны в развертывании основной дополнительный DNS](#zone-transfers-in-a-dns-primary-secondary-deployment)  
- [Уровень области зоны передает в развертывании основной дополнительный DNS](#zone-scope-level-transfers-in-a-dns-primary-secondary-deployment)  
  
### <a name="zone-transfers-in-a-dns-primary-secondary-deployment"></a>Передачи зоны в развертывании основной дополнительный DNS

Можно создать развертывание основных и вспомогательных DNS и синхронизировать зон, выполнив следующие действия.  
1. При установке DNS, основная зона создается на основной DNS-сервер.  
2. На сервере-получателе создание зон и указав основные серверы.   
3. На основных серверах можно добавить серверы-получатели как доверенный баз данных-получателей основной зоны.   
4. Дополнительные зоны сделать запрос на передачу полный зоны (AXFR) и получите копию зоны.   
5. При необходимости, основных серверах отправлять уведомления на серверы-получатели об обновлениях зоны.  
6. Серверы-получатели сделать запрос на передачу зоны (IXFR). По этой причине серверы-получатели будут синхронизированы с основным сервером.   
  
### <a name="zone-scope-level-transfers-in-a-dns-primary-secondary-deployment"></a>Уровень области зоны передает в развертывании основной дополнительный DNS

Сценарий прохождения трафика управления требует дополнительных шагов для секционирования зоны в другую зону областей. По этой причине необходимы дополнительные шаги для передачи данных внутри области зоны с серверами-получателями и для передачи политик и подсетей клиента DNS на серверах-получателях.   
  
После настройки инфраструктуры DNS с помощью основного и дополнительного серверов, уровня передачи зоны области выполняются автоматически с DNS, с помощью следующих процессов.  
  
Чтобы обеспечить передачу уровня области зоны, DNS-серверы используют механизмы расширения для DNS (EDNS0) необязательно RR. Всех запросов на передачу (AXFR и IXFR) зон из зон с областями получаются с помощью записи EDNS0 необязательно Ресурса, идентификатор которого параметр имеет значение «65433» по умолчанию. Дополнительные сведения о EDNSO, см. в разделе IETF [запрос 6891 комментарии](https://tools.ietf.org/html/rfc6891).  
  
RR необязательно значение имени области зоны, для которого отправляется запрос. Когда основной DNS-сервер получает этот пакет из доверенного сервера-получателя, она интерпретирует запрос как исходящий для данной области зоны.   
  
Если сервер-источник имеет область этой зоны, интегрированной в ответ выдается передачи (XFR) данных из этой области. Ответ содержит необязательно RR с одинаковым Идентификатором параметра «65433» и значением, равным одной и той же области зоны. Серверы-получатели получать этот ответ, получить сведения об области из ответа и обновления этой определенной области зоны.  
  
После этого процесса основной сервер ведет список доверенных вторичных реплик, которые отправили такого зоны область запроса для получения уведомлений.   
  
Для никакие дальнейшие обновления, в области зоны отправляется уведомление IXFR серверах-получателях, с тем же RR необязательно. Области зоны, получения этого уведомления делает запрос IXFR, содержащий RR, необязательно и тот же процесс, как описано выше следует.  
  
## <a name="how-to-configure-dns-policy-for-primary-secondary-geo-location-based-traffic-management"></a>Настройка политики DNS для управления трафиком на основе географического расположения основных и вспомогательных

Перед началом работы убедитесь, что выполнены все действия, описанные в разделе [помощью политики DNS для управления трафиком на основе географического расположения, с серверов-источников](../../dns/deploy/Scenario--Use-DNS-Policy-for-Geo-Location-Based-Traffic-Management-with-Primary-Servers.md), и ваш основной DNS-сервер настроен с зонами, области зоны DNS-клиента Подсети и политики DNS.  
  
>[!NOTE]
> Инструкции в этом разделе для копирования подсети клиента DNS, области зоны и политик DNS из основных серверов DNS в дополнительных DNS-серверов, для начальной настройки DNS и проверки. В будущем может потребоваться изменить подсети клиента DNS, области зоны и параметров политик на сервере-источнике. В этом случае можно создать сценарии автоматизации для сохранения серверы-получатели синхронизированы с сервера-источника.  
  
Чтобы настроить политики DNS для основных и вспомогательных географическое местоположение, на основе ответы на запросы, необходимо выполнить следующие действия.  
  
- [Создание зон получателя](#create-the-secondary-zones)  
- [Настройка параметров передачи зоны на основную зону](#configure-the-zone-transfer-settings-on-the-primary-zone)  
- [Скопируйте подсетей клиента DNS](#copy-the-dns-client-subnets)  
- [Создание области зоны на сервере-получателе](#create-the-zone-scopes-on-the-secondary-server)  
- [Настройка политики DNS](#configure-dns-policy)  
  
Следующие разделы содержат подробных инструкций по настройке.  
  
>[!IMPORTANT]
>В следующих разделах приведены примеры команд Windows PowerShell, которые содержат примеры значений для многих параметров. Убедитесь, что примеры значений в этих командах замените значения, которые подходят для развертывания, прежде чем вы выполните следующие команды.  
><br>Членство в группе **DnsAdmins**, или наличие эквивалентных прав, необходимых для выполнения следующих процедур.  
  
### <a name="create-the-secondary-zones"></a>Создание зон получателя

Можно создать дополнительную копию зоны, которые требуется реплицировать SecondaryServer1 и SecondaryServer2 (при условии, что командлеты выполняются удаленно из единого управления клиента).   
  
Например можно создать дополнительную копию www.woodgrove.com SecondaryServer1 и SecondarySesrver2.  
  
Чтобы создать дополнительные зоны можно использовать следующие команды Windows PowerShell.  
  
    
    Add-DnsServerSecondaryZone -Name "woodgrove.com" -ZoneFile "woodgrove.com.dns" -MasterServers 10.0.0.1 -ComputerName SecondaryServer1  
      
    Add-DnsServerSecondaryZone -Name "woodgrove.com" -ZoneFile "woodgrove.com.dns" -MasterServers 10.0.0.1 -ComputerName SecondaryServer2  
      

Дополнительные сведения см. в разделе [DnsServerSecondaryZone добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserversecondaryzone?view=win10-ps).  
  
### <a name="configure-the-zone-transfer-settings-on-the-primary-zone"></a>Настройка параметров передачи зоны на основную зону

Необходимо настроить параметры основной зоне, чтобы:

1. Разрешены передачи зон с сервера-источника на указанный сервер-получатель.  
2. Уведомления об обновлениях зоны отправляются сервером-источником с серверами-получателями.  
  
Чтобы настроить параметры передачи зоны на основной зоны можно использовать следующие команды Windows PowerShell.
  
>[!NOTE]
>В следующем примере команды параметр **-уведомить** указывает, что основной сервер отправит уведомления об обновлениях список выбора баз данных-получателей.  
  
    
    Set-DnsServerPrimaryZone -Name "woodgrove.com" -Notify Notify -SecondaryServers "10.0.0.2,10.0.0.3" -SecureSecondaries TransferToSecureServers -ComputerName PrimaryServer  
     
  
Дополнительные сведения см. в разделе [Set-DnsServerPrimaryZone](https://docs.microsoft.com/powershell/module/dnsserver/set-dnsserverprimaryzone?view=win10-ps).  
  
  
### <a name="copy-the-dns-client-subnets"></a>Скопируйте подсетей клиента DNS

Необходимо скопировать подсетей клиента DNS с основного сервера на серверах-получателях.
  
Можно использовать следующие команды Windows PowerShell копируемые подсетей с серверами-получателями.
  
    
    Get-DnsServerClientSubnet -ComputerName PrimaryServer | Add-DnsServerClientSubnet -ComputerName SecondaryServer1  
      
    Get-DnsServerClientSubnet -ComputerName PrimaryServer | Add-DnsServerClientSubnet -ComputerName SecondaryServer2  
      

Дополнительные сведения см. в разделе [DnsServerClientSubnet добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverclientsubnet?view=win10-ps).  
  
### <a name="create-the-zone-scopes-on-the-secondary-server"></a>Создание области зоны на сервере-получателе

На серверах-получателях, необходимо создать области зоны. В DNS области зоны также запрашивают XFRs с сервера-источника. Любые изменения на области зоны на сервере-источнике отправляется уведомление, содержащее сведения об области зоны с серверами-получателями. Серверы-получатели можно обновить их области зоны с помощью добавочных изменений.  
  
Следующие команды Windows PowerShell можно использовать для создания области зоны на серверах-получателях.  
  
    
    Get-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName PrimaryServer|Add-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName SecondaryServer1 -ErrorAction Ignore  
      
    Get-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName PrimaryServer|Add-DnsServerZoneScope -ZoneName "woodgrove.com" -ComputerName SecondaryServer2 -ErrorAction Ignore  
  

>[!NOTE]
>В этих командах пример **- ErrorAction Ignore** включен, так как существует область зоны по умолчанию в каждой зоне. Невозможно создать или удалить область зоны по умолчанию. Конвейеризация вызовет попытки создания этой области и его не удастся. Кроме того можно создать области зоны не по умолчанию на две дополнительные зоны.  
  
Дополнительные сведения см. в разделе [DnsServerZoneScope добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps).  
  
### <a name="configure-dns-policy"></a>Настройка политики DNS

После создания подсети секций (области зоны) и добавления записей, необходимо создать политики, которые соединяют подсетей и секций, таким образом, когда запрос поступает из источника в одной из подсетей клиента DNS, ответ на запрос возвращается из области зоны. Политики не являются обязательными для сопоставления области зоны по умолчанию.  
  
Следующие команды Windows PowerShell можно использовать для создания политики DNS, каналам подсетей клиента DNS и области зоны.   
    
    $policy = Get-DnsServerQueryResolutionPolicy -ZoneName "woodgrove.com" -ComputerName PrimaryServer  
      
    $policy | Add-DnsServerQueryResolutionPolicy -ZoneName "woodgrove.com" -ComputerName SecondaryServer1  
      
    $policy | Add-DnsServerQueryResolutionPolicy -ZoneName "woodgrove.com" -ComputerName SecondaryServer2  
      

Дополнительные сведения см. в разделе [DnsServerQueryResolutionPolicy добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  
  
Теперь вторичные DNS-серверы настраиваются с помощью необходимых политик DNS для перенаправления трафика в зависимости от географического расположения.  
  
Когда DNS-сервер получает запросы разрешения имен, DNS-сервер оценивает поля в запрос DNS к настроенных политик DNS. Если исходный IP-адрес в запрос на разрешение имени соответствует какой-либо политики, области связанных зоны, используются для ответа на запрос, и пользователь перенаправляется к ресурсу, которая географически ближе к ним.   
  
Можно создать тысячи политик DNS в соответствии с трафиком требований к управлению, а все новые политики применяются динамически — без перезапуска DNS-сервер — на входящих запросов.
