---
title: Управление трафиком на основе географического расположения на основных серверах с помощью политики DNS
description: Этот раздел является частью DNS политики сценария руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: ef9828f8-c0ad-431d-ae52-e2065532e68f
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 110014adf1e23be574f23efc01e8a4d69397e547
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59831985"
---
# <a name="use-dns-policy-for-geo-location-based-traffic-management-with-primary-servers"></a>Управление трафиком на основе географического расположения на основных серверах с помощью политики DNS

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Можно использовать в этом разделе описывается, как настроить политики DNS, чтобы разрешить основной DNS-серверы отвечать на запросы клиента на основе географического расположения клиента и ресурса, к которому клиент пытается подключиться, клиента обеспечивается с помощью ad IP-адрес Напомните ближайший ресурс.  
  
>[!IMPORTANT]  
>Этот сценарий иллюстрирует, как развернуть политики DNS для управления трафиком на основе географического расположения, при использовании только основной DNS-серверов. Вы также можете выполнять управление трафиком на основе географического расположения, при наличии основного и дополнительного DNS-серверов. При наличии развертывания основных и вспомогательных, сначала выполните действия, описанные в этом разделе, а затем выполните действия, которые приведены в разделе [помощью политики DNS для управления трафиком на основе географического расположения, с помощью основных и вспомогательных серверах](primary-secondary-geo-location.md).

С помощью новых политик DNS можно создать политику DNS, которая позволяет DNS-сервер отвечает на запрос клиента, запрашивает IP-адрес веб-сервера. Экземпляры веб-сервера может находиться в разных центрах обработки данных в разных физических расположениях. DNS можно Оценка клиента и сервера веб-узлах, а затем отвечает на запрос клиента, предоставляя клиента веб-сервера IP-адрес для веб-сервер, который физически расположен ближе к клиенту.  

Следующие параметры политики DNS можно использовать для управления ответов DNS-сервера на запросы DNS-клиентов. 

- **Подсеть клиента**. Имя подсети предопределенные клиента. Используется для проверки в подсети, из которого был отправлен запрос.
- **Транспортный протокол**. Транспортный протокол, используемый в запросе. Возможные операции **UDP** и **TCP**.
- **Протокол IP**. Сетевой протокол, используемый в запросе. Возможные операции **IPv4** и **IPv6**.
- **Интерфейс IP-адрес сервера**. IP-адрес сетевого интерфейса DNS-сервера, который получил запрос DNS.
- **ПОЛНОЕ ДОМЕННОЕ ИМЯ**. Полное доменное имя (FQDN) записи в запросе с возможность использования подстановочного знака.
- **Тип запроса**. Тип запрашиваемой записи (A, SRV, TXT, и т.д.).
- **Время суток**. Время получения запроса. 
  
Следующие критерии можно объединить с логическим оператором (или) для создания выражений политики. Когда эти выражения совпадают, ожидается политики, выполните одно из следующих действий.
 
- **Игнорировать**. DNS-сервер автоматически удаляет запрос.          
- **Запретить**. Сервер DNS отвечает этот запрос с сообщение о сбое.          
- **Разрешить**. DNS-сервер отправляет ответ управление трафиком.          
  
##  <a name="bkmk_example"></a>Пример трафика управления, на основе географического расположения

Ниже приведен пример того, как можно использовать политики DNS для достижения перенаправление трафика на основе физического расположения клиента, который выполняет запрос DNS.   
  
В этом примере используется двух вымышленных компаний - Contoso облачных служб, который предоставляет веб- и домена, размещение решений; и качества пищевых продуктов Woodgrove службы, которая предоставляет службы доставки качества пищевых продуктов в нескольких городах по всему миру и содержит веб-сайт с именем woodgrove.com.  
  
Contoso облачных служб имеет два центра обработки данных, в США, а другой в Европе. Европейская центра обработки данных размещается качества пищевых продуктов, упорядочение портал для woodgrove.com.   
  
Чтобы убедиться, что woodgrove.com клиенты получают более высокую скорость работы с их веб-сайта, Woodgrove хочет европейских клиенты, направлен в европейских центр обработки данных и American клиенты, направлен в центр обработки данных США. Клиентов, расположенных в других местах в мире может быть перенаправлен к любой из центров обработки данных.   
  
Этот сценарий показан на следующем рисунке.  
  
![Пример трафика управления, на основе географического расположения](../../media/DNS-Policy-Geo1/dns_policy_geo1.png)  
  
##  <a name="bkmk_works"></a>Как процесс разрешения имен DNS работает  
  
Во время процесса разрешения имен пользователь пытается подключиться к www.woodgrove.com. Это приводит запрос разрешения имен DNS, который отправляется на DNS-сервер, настроенный в свойствах сетевого подключения на компьютере пользователя. Как правило это является DNS-сервер, предоставленный местного поставщика услуг Интернета, действующий как кэширующий Сопоставитель и называется LDNS.   
  
Если имя DNS отсутствует в локальном кэше LDNS, LDNS сервер пересылает запрос на DNS-сервер, который отвечает за woodgrove.com. Полномочный DNS-сервер отвечает запрошенной записи (www.woodgrove.com) на сервере LDNS, который в свою очередь кэширует записи локально, прежде чем отправить их на компьютере.  
  
Поскольку облачных служб Contoso использует политики DNS-сервер, полномочный DNS-сервер, на котором размещена contoso.com настраивается для возвращения ответов управление трафиком на основе географического расположения. В результате направление европейских клиентов для центра обработки данных Европы и направление American клиентов в США центр обработки данных, как показано на рисунке.  
  
В этом случае полномочного DNS-сервера обычно видит запрос разрешение имен, поступающих от сервера LDNS и очень редко, с компьютера пользователя. По этой причине исходный IP-адрес в запрос разрешения имен, как явствует полномочный DNS-сервер является, LDNS сервера, а не на компьютере. Тем не менее при настройке географического расположения, с помощью IP-адрес сервера LDNS запроса на основе ответов обеспечивает равномерное оценку географического расположения пользователя, так как пользователь отправляет запрос DNS-сервер, его местного поставщика услуг Интернета.  
  
>[!NOTE]  
>Политики DNS используют IP-адрес отправителя в пакете UDP и TCP, содержащий DNS-запроса. Если запрос достигает сервера-источника через несколько прыжков Сопоставитель/LDNS, политика будет рассматривать только IP-адрес последнего сопоставителя, из которого DNS-сервер получает запрос.  
  
##  <a name="bkmk_config"></a>Настройка политики DNS для ответы на запросы на основе географического расположения  
Чтобы настроить политики на основе географического расположения ответы на запросы DNS, необходимо выполнить следующие действия.  
  
1. [Создание подсетей клиента DNS](#bkmk_subnets)  
2. [Создайте области зоны](#bkmk_scopes)  
3. [Добавление записей в области зоны](#bkmk_records)  
4. [Создайте политики](#bkmk_policies)  
  
>[!NOTE]  
>Эти действия необходимо выполнить на DNS-сервере, который заслуживает доверия для зоны, которую требуется настроить. Членство в группе **DnsAdmins**, или наличие эквивалентных прав, необходимых для выполнения следующих процедур.  
  
Следующие разделы содержат подробных инструкций по настройке.  
  
>[!IMPORTANT]  
>В следующих разделах приведены примеры команд Windows PowerShell, которые содержат примеры значений для многих параметров. Убедитесь, что примеры значений в этих командах замените значения, которые подходят для развертывания, прежде чем вы выполните следующие команды.  
  
### <a name="bkmk_subnets"></a>Создание подсетей клиента DNS  
  
Первым шагом является определение подсети и пространства IP-адресов из регионов, для которых вы хотите перенаправить трафик. Например если вы хотите перенаправить трафик для США и Европе, необходимо определить подсети и пространства IP-адресов из этих регионов.  
  
Эти сведения можно получить из maps Geo-IP. На основе этих Geo-IP версий, необходимо создать «Подсетей клиента DNS». Подсеть клиента DNS — это логическая группа подсети IPv4 или IPv6, из которых запросы отправляются на DNS-сервер.  
  
Можно использовать следующие команды Windows PowerShell для создания подсетей клиента DNS.  
  
      
    Add-DnsServerClientSubnet -Name "USSubnet" -IPv4Subnet "192.0.0.0/24"  
      
    Add-DnsServerClientSubnet -Name "EuropeSubnet" -IPv4Subnet "141.1.0.0/24"  
      
  
Дополнительные сведения см. в разделе [DnsServerClientSubnet добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverclientsubnet?view=win10-ps).  
  
### <a name="bkmk_scopes"></a>Создание области зоны  
После того как настроены подсети клиента, необходимо секционировать зоны, трафик которых вы хотите перенаправить на две области для другой зоны, одну область для каждой из подсетей клиента DNS, который вы настроили.   
  
Например если вы хотите перенаправить трафик для www.woodgrove.com имя DNS, необходимо создать две области другую зону в зоне woodgrove.com: для США и Европы.  
  
Область зоны — это уникальный экземпляр зоны. Зоны DNS может иметь несколько областей зоны, с каждой из областей зоны, содержащий собственный набор записей DNS. Та же запись могут присутствовать в нескольких областях, различные IP-адреса или же IP-адреса.  
  
>[!NOTE]  
>По умолчанию области зоны существует для зон DNS. Эта область зоны имеет то же имя, что зона и устаревших работы DNS работает в этой области.   
  
Следующие команды Windows PowerShell можно использовать для создания области зоны.  
  
      
    Add-DnsServerZoneScope -ZoneName "woodgrove.com" -Name "USZoneScope"  
      
    Add-DnsServerZoneScope -ZoneName "woodgrove.com" -Name "EuropeZoneScope"  

Дополнительные сведения см. в разделе [DnsServerZoneScope добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps).  
  
### <a name="bkmk_records"></a>Добавление записей в области зоны  
Теперь необходимо добавить записи, представляющий узел веб-сервера в области две зоны.   
  
Например **USZoneScope** и **EuropeZoneScope**. В USZoneScope вы можете добавить www.woodgrove.com записи IP-адресом 192.0.0.1, который находится в центре обработки данных США; и в EuropeZoneScope одной и той же записи (www.woodgrove.com) можно добавить IP-адресом 141.1.0.1 в европейских центре обработки данных.   
  
Следующие команды Windows PowerShell можно использовать для добавления записей в области зоны.  
  
      
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "192.0.0.1" -ZoneScope "USZoneScope  
      
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "141.1.0.1" -ZoneScope "EuropeZoneScope"  
  
  
  
В этом примере необходимо также использовать следующие команды Windows PowerShell для добавления записей в зоне область по умолчанию, остальная часть мира можно по-прежнему получить доступ к веб-сервере woodgrove.com от любого из двух центрах обработки данных.  
    
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "192.0.0.1"   
      
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "141.1.0.1"
      
 
**Зонаобласть** параметр не указан, при добавлении записи в области по умолчанию. Это то же самое, что при добавлении записей стандартной зоны DNS.  
  
Дополнительные сведения см. в разделе [Add-DnsServerResourceRecord](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).  
  
### <a name="bkmk_policies"></a>Создайте политики  
После создания подсети секций (области зоны) и добавления записей, необходимо создать политики, которые соединяют подсетей и секций, таким образом, когда запрос поступает из источника в одной из подсетей клиента DNS, ответ на запрос возвращается из области зоны. Политики не являются обязательными для сопоставления области зоны по умолчанию.   
  
Следующие команды Windows PowerShell можно использовать для создания политики DNS, каналам подсетей клиента DNS и области зоны.   
  
      
    Add-DnsServerQueryResolutionPolicy -Name "USPolicy" -Action ALLOW -ClientSubnet "eq,USSubnet" -ZoneScope "USZoneScope,1" -ZoneName "woodgrove.com"  
      
    Add-DnsServerQueryResolutionPolicy -Name "EuropePolicy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "EuropeZoneScope,1" -ZoneName "woodgrove.com"  
     
Дополнительные сведения см. в разделе [DnsServerQueryResolutionPolicy добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  
  
Теперь DNS-сервера с помощью необходимых политик DNS для перенаправления трафика в зависимости от географического расположения.  
  
Когда DNS-сервер получает запросы разрешения имен, DNS-сервер оценивает поля в запрос DNS к настроенных политик DNS. Если исходный IP-адрес в запрос на разрешение имени соответствует какой-либо политики, области связанных зоны, используются для ответа на запрос, и пользователь перенаправляется к ресурсу, которая географически ближе к ним.   
  
Можно создать тысячи политик DNS в соответствии с трафиком требований к управлению, а все новые политики применяются динамически — без перезапуска DNS-сервер — на входящих запросов.  
  
  
