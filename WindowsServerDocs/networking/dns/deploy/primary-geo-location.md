---
title: Используйте DNS географического расположения на основе политики управления трафика с серверов-источников
description: Этот раздел является частью DNS политики сценарий руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: ef9828f8-c0ad-431d-ae52-e2065532e68f
ms.author: pashort
author: shortpatti
ms.openlocfilehash: bd72e13cd3d2d7f3ca886afcdcf97e824ef227f5
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="use-dns-policy-for-geo-location-based-traffic-management-with-primary-servers"></a>Используйте DNS географического расположения на основе политики управления трафика с серверов-источников

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать на сведения о настройке DNS политику, чтобы разрешить основной DNS-серверы, отвечать на запросы DNS-клиента на основе географического расположения для клиента и ресурсов, к которой клиент пытается подключиться, обеспечивая ближайший ресурс IP-адрес клиента.  
  
>[!IMPORTANT]  
>Этот сценарий иллюстрирует развертывание политики DNS для управления трафиком на основе географического расположения, при использовании только основной DNS-серверов. При наличии основного и дополнительного DNS-серверов, то можно также выполнить управление трафиком на основе географического расположения. Если имеется развертывание основных и вспомогательных сначала выполните действия, описанные в этом разделе, а затем выполните действия, которые приведены в статье [использование политики DNS для управления трафиком на основе географического расположения, с помощью основных и вспомогательных серверах](primary-secondary-geo-location.md).

Новые политики DNS можно создать политики DNS, которая позволяет DNS-сервер отвечает на запрос клиента, запрашивает IP-адрес веб-сервера. Экземпляры веб-сервера может находиться в различных центрах обработки данных в разных точках. DNS-сервера можно оценить клиента и сервера веб-сайтах, а затем отвечать на запросы клиентов, предоставляя клиента с веб-сервером IP-адрес для веб-сервера, который физически расположен ближе к клиенту.  

Можно использовать следующие параметры политики DNS для управления ответов DNS-сервера на запросы DNS-клиентов. 

- **Подсеть клиента**. Имя предопределенных клиентской подсети. Используется для проверки подсети, из которого был отправлен запрос.
- **Протокол**. Транспорта протокол, используемый в запросе. Возможные операции **UDP** и **TCP**.
- **Протокол**. Сетевой протокол, используемый в запросе. Возможные операции **IPv4** и **IPv6**.
- **Интерфейс IP-адрес сервера**. IP-адрес сетевого интерфейса DNS-сервер, который получил запрос DNS.
- **Полное доменное имя**. Полное доменное имя (FQDN) записи в запросе, с возможность использования подстановочный знак.
- **Тип запроса**. Тип записи запрашиваемый (A, SRV, TXT, и т. д.).
- **Время дня,**. Время получения запроса. 
  
Вы можете объединить следующим условиям логическим оператором (или) для создания политики выражения. При этих выражений совпадать, политик должны будут выполнять одно из следующих действий.
 
- **Игнорировать**. DNS-сервер без вмешательства пользователя отбрасывает запроса.          
- **Запретить**. DNS-сервер отвечает с ответа на сбой запроса.          
- **Разрешить**. Сервер DNS отвечает обратно с управляемых трафика ответа.          
  
##  <a name="bkmk_example"></a>Пример управления трафиком на основе географического расположения

Ниже приведен пример того, как использовать политику DNS для достижения перенаправление трафика на основании физического расположения клиента, который выполняет запрос DNS.   
  
В этом примере используется двух вымышленные компаний - Contoso облачные службы, который предоставляет веб доменов и размещения решения; и Woodgrove еда служб, который предоставляет службы доставки еда в нескольких городов со всего мира и с веб-сайт с именем woodgrove.com.  
  
Contoso облачных служб имеет двумя центрами обработки данных, в США, а другой в пределах Европы. Европейский центра обработки данных размещается еда, порядок портал для woodgrove.com.   
  
Чтобы убедиться, что клиенты woodgrove.com получить быстрое взаимодействие с веб-сайтах, Woodgrove хочет европейской клиентов направлен на европейской центра обработки данных и American направлен США центра обработки данных. Клиентов, расположенных в других местах в мире может быть перенаправлен к любой из центров обработки данных.   
  
Этот сценарий показана на следующем рисунке.  
  
![Пример управления трафиком на основе географического расположения](../../media/DNS-Policy-Geo1/dns_policy_geo1.png)  
  
##  <a name="bkmk_works"></a>Как процесс разрешения имен DNS работает.  
  
Во время процесса разрешения имен пользователь пытается подключиться к www.woodgrove.com. В результате в запрос разрешения имени DNS, который отправляется на DNS-сервер, настроенный в свойствах сетевого подключения на компьютере пользователя. Как правило это DNS-сервер поставщика услуг Интернета локальной выступает в качестве кэширования Сопоставитель и называется LDNS.   
  
Если DNS-имя не существует в локальном кэше LDNS, сервер LDNS пересылает запрос на DNS-сервер, который отвечает за woodgrove.com. Полномочный DNS-сервер отвечает запрошенной записи (www.woodgrove.com) на сервере LDNS, который в свою очередь кэширует записи локально перед его отправкой на компьютере.  
  
Поскольку Contoso облачных служб используется политик DNS-сервер, полномочный DNS-сервер, что узлы contoso.com настроен для возврата географического расположения на основе ответов управляемых трафика. В результате направление европейской клиентов европейской центра обработки данных и направления клиентов American США центра обработки данных, как показано на рисунке.  
  
В этом сценарии полномочный DNS-сервер обычно видит запрос разрешения имени, поступающих LDNS с сервера, очень редко с компьютера пользователя. По этой причине исходный IP-адрес в запросе на разрешение имен, видимые полномочный DNS-сервер, оно LDNS сервера, на компьютере. Тем не менее с помощью IP-адрес сервера LDNS при настройке географического расположения на основе запросов, ответов обеспечивает равноправный оценки географического расположения пользователя, так как пользователь запрашивает DNS-сервер его локальным поставщиком услуг Интернета.  
  
>[!NOTE]  
>DNS-сервера политик использования IP отправителя в пакет UDP или TCP, который содержит DNS-запрос. Если запрос достигает основной сервер через несколько прыжков сопоставитель или LDNS, политика будет рассматривать только IP-адреса последнего распознавателя, из которого DNS-сервер получает запрос.  
  
##  <a name="bkmk_config"></a>Настройка политики DNS для ответы на запросы на основе географического расположения  
Чтобы настроить политики на основе географического расположения ответы на запросы DNS, необходимо выполнить следующие действия.  
  
1. [Создание подсети клиента DNS](#bkmk_subnets)  
2. [Создание областей зоны](#bkmk_scopes)  
3. [Добавить записи в области зоны](#bkmk_records)  
4. [Создайте политики](#bkmk_policies)  
  
>[!NOTE]  
>На DNS-сервере, который является заслуживающим доверия для зоны, которую вы хотите настроить, необходимо выполнить следующие действия. Членство в группе **DnsAdmins**, или наличие эквивалентных прав, необходимых для выполнения следующих процедур.  
  
В следующих разделах приводятся подробных инструкций по настройке.  
  
>[!IMPORTANT]  
>В следующих разделах приведены примеры Windows PowerShell команд, содержащих примеры значений для многих параметров. Убедитесь, замените примеры значений в этих командах со значениями, подходящими для вашего развертывания, прежде чем выполнять эти команды.  
  
### <a name="bkmk_subnets"></a>Создание подсети клиента DNS  
  
Первым шагом является для определения подсетей, или пространство IP-адресов из регионов, для которых требуется для перенаправления трафика. Например для перенаправления трафика для США и Европе, необходимо определить подсети или пространства IP-адресов из этих регионов.  
  
Эти сведения можно получить из карты географического-IP. На основании этих IP-географического распределения, необходимо создать «Подсети клиента DNS». Подсеть клиента DNS является логической группой подсети IPv4 или IPv6, из которых запросы отправляются на DNS-сервер.  
  
Создание подсети клиента DNS можно использовать следующие команды Windows PowerShell.  
  
      
    Add-DnsServerClientSubnet -Name "USSubnet" -IPv4Subnet "192.0.0.0/24"  
      
    Add-DnsServerClientSubnet -Name "EuropeSubnet" -IPv4Subnet "141.1.0.0/24"  
      
  
Дополнительные сведения см. в разделе [добавить DnsServerClientSubnet](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverclientsubnet?view=win10-ps).  
  
### <a name="bkmk_scopes"></a>Создание областей зоны  
После настройки подсети клиента необходимо разделить зоны, трафик которого будет перенаправляться в две области другой зоне одну область для каждой из подсетей клиента DNS, который вы настроили.   
  
Например если требуется перенаправить трафик для DNS-имени www.woodgrove.com, необходимо создать две области другой зоне в зоне woodgrove.com: для США и Европы.  
  
Область зоны представляет уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, с каждой областью зону, содержащую собственный набор DNS-записей. Ту же запись может быть представлен в нескольких областях, различные IP-адреса или одинаковые IP-адреса.  
  
>[!NOTE]  
>По умолчанию область зоны существует для зон DNS. Эта область зоны имеет то же имя, что зона и устаревших операции DNS-сервера работает в этой области.   
  
Следующие команды Windows PowerShell можно использовать для создания областей зоны.  
  
      
    Add-DnsServerZoneScope -ZoneName "woodgrove.com" -Name "USZoneScope"  
      
    Add-DnsServerZoneScope -ZoneName "woodgrove.com" -Name "EuropeZoneScope"  

Дополнительные сведения см. в разделе [добавить DnsServerZoneScope](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps).  
  
### <a name="bkmk_records"></a>Добавить записи в области зоны  
Теперь необходимо добавить записи, представляющий веб-сервера в области две зоны.   
  
Например **USZoneScope** и **EuropeZoneScope**. В USZoneScope вы можете добавить запись www.woodgrove.com с IP-адрес 192.0.0.1, который находится в США центра обработки данных; и в EuropeZoneScope можно добавить одну и ту же запись (www.woodgrove.com) с IP-адресом 141.1.0.1 в европейской центре обработки данных.   
  
Можно использовать следующие команды Windows PowerShell для добавления записей в зоне области.  
  
      
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "192.0.0.1" -ZoneScope "USZoneScope  
      
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "141.1.0.1" -ZoneScope "EuropeZoneScope"  
  
  
  
В этом примере необходимо также использовать следующие команды Windows PowerShell для добавления записей в зоне области по умолчанию, чтобы гарантировать, что остального мира можно по-прежнему доступа woodgrove.com веб-сервер из одного из двух центров обработки данных.  
    
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "192.0.0.1"   
      
    Add-DnsServerResourceRecord -ZoneName "woodgrove.com" -A -Name "www" -IPv4Address "141.1.0.1"
      
 
**Зонаобласть** параметр не включен, при добавлении записи в области по умолчанию. Это то же самое, что при добавлении записей стандартной зоны DNS.  
  
Дополнительные сведения см. в разделе [добавить DnsServerResourceRecord](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).  
  
### <a name="bkmk_policies"></a>Создайте политики  
После создания подсетей разделов (области зоны) и вы добавили записей, необходимо создать политики, которые связывают подсети и разделы, чтобы при запросе поступает из источника в одной подсети клиента DNS, ответ на запрос возвращается из области действия зоны. Политики не требуются для сопоставления зоны области по умолчанию.   
  
Следующие команды Windows PowerShell можно использовать для создания политики DNS со ссылкой подсети клиента DNS-сервера и области зоны.   
  
      
    Add-DnsServerQueryResolutionPolicy -Name "USPolicy" -Action ALLOW -ClientSubnet "eq,USSubnet" -ZoneScope "USZoneScope,1" -ZoneName "woodgrove.com"  
      
    Add-DnsServerQueryResolutionPolicy -Name "EuropePolicy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "EuropeZoneScope,1" -ZoneName "woodgrove.com"  
     
Дополнительные сведения см. в разделе [добавить DnsServerQueryResolutionPolicy](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  
  
Теперь DNS-сервер настроен с необходимые политики DNS для перенаправления трафика в зависимости от географического расположения.  
  
Когда DNS-сервер получает запросы разрешения имен, DNS-сервер оценивает поля на DNS-запрос от настроенных политик DNS. Если исходный IP-адрес в запросе на разрешение имени соответствует какой-либо политики, область связанные зоны используется реагировать на запрос, и пользователь направляется на ресурс, который географически ближайшего к ним.   
  
Можно создать тысячи политик DNS в соответствии с трафик требования к управлению, и все новые политики применяются динамически — без перезагрузки DNS-сервер — на входящие запросы.  
  
  
