---
title: Разделение вычислительных мощностей DNS в Active Directory с помощью политики DNS
description: С помощью этого раздела вы можете использовать возможности управления трафиком политик DNS для развертывания с разделением и Active Directory интегрированными зонами DNS в Windows Server 2016.
manager: brianlic
ms.topic: article
ms.assetid: f9533204-ad7e-4e49-81c1-559324a16aeb
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 4aa18e3f93cdb0a50cac3db697a10dd40c1f05e0
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87996905"
---
# <a name="use-dns-policy-for-split-brain-dns-in-active-directory"></a>Разделение вычислительных мощностей DNS в Active Directory с помощью политики DNS

>Применяется к: Windows Server (Semi-Annual Channel), Windows Server 2016

Этот раздел можно использовать для использования возможностей управления трафиком политик DNS для раздельного \- развертывания с помощью Active Directory интегрированных зон DNS в Windows Server 2016.

В Windows Server 2016 поддержка политик DNS расширена для Active Directory интегрированных зон DNS. Интеграция Active Directory предоставляет \- DNS-серверу несколько основных возможностей обеспечения высокой доступности.

Ранее этот сценарий требовал, чтобы администраторы DNS поддерживали два разных DNS-сервера, каждый из которых предоставляет службы каждому набору пользователей, внутренним и внешним. Если несколько записей в зоне были разделены, \- или оба экземпляра зоны (внутренние и внешние) были делегированы в один и тот же родительский домен, это стало загадка управления.

> [!NOTE]
> - Развертывания DNS разбиваются \- , если имеется две версии одной зоны, одна версия для внутренних пользователей в интрасети организации и одна версия для внешних пользователей, которые обычно являются пользователями в Интернете.
> - В разделе [Использование политики DNS для раздельного развертывания DNS](split-brain-DNS-deployment.md) . объясняется, как можно использовать политики DNS и области зоны для развертывания разделенной \- мозговой системы DNS на одном DNS-сервере Windows Server 2016.

## <a name="example-split-brain-dns-in-active-directory"></a>Пример разбиения \- DNS на Active Directory

В этом примере используется одна вымышленная компания Contoso, которая поддерживает веб-узел карьеры по адресу www.career.contoso.com.

Сайт имеет две версии — один для внутренних пользователей, где доступны внутренние сообщения о заданиях. Этот внутренний сайт доступен по локальному IP-адресу 10.0.0.39.

Вторая версия — это общедоступная версия того же сайта, которая доступна по общедоступному IP-адресу 65.55.39.10.

В отсутствие политики DNS администратору необходимо размещать эти две зоны на отдельных DNS-серверах Windows Server и управлять ими отдельно.

С помощью политик DNS эти зоны теперь можно размещать на одном DNS-сервере.

Если DNS-сервер для contoso.com Active Directory интегрирован и прослушивает два сетевых интерфейса, администратор Contoso DNS может выполнить действия, описанные в этом разделе, для достижения \- развернутого мозгового развертывания.

Администратор DNS настраивает интерфейсы DNS-сервера со следующими IP-адресами.

- Сетевой адаптер с выходом в Интернет настроен с общедоступным IP-адресом 208.84.0.53 для внешних запросов.
- Сетевой адаптер, подключенный к интрасети, настроен с использованием частного IP-адреса 10.0.0.56 для внутренних запросов.

Этот сценарий показан на следующем рисунке.

![Интегрированное развертывание DNS с разделением и мозгом](../../media/DNS-SB-AD/DNS-SB-AD.jpg)

## <a name="how-dns-policy-for-split-brain-dns-in-active-directory-works"></a>Как работает политика DNS для разделения \- мозгового DNS-сервера в Active Directory

Если DNS-сервер настроен с использованием требуемых политик DNS, каждый запрос разрешения имен оценивается по политикам на DNS-сервере.

В этом примере интерфейс сервера используется в качестве критерия для различения внутренних и внешних клиентов.

Если серверный интерфейс, на котором получен запрос, соответствует любой из политик, то соответствующая область зоны используется для ответа на запрос.

Таким образом, в нашем примере запросы DNS для www.career.contoso.com, полученные на частном IP-адресе (10.0.0.56), получают ответ DNS, который содержит внутренние IP-адреса. и запросы DNS, получаемые в общедоступном сетевом интерфейсе, получают ответ DNS, содержащий общедоступный IP-адрес в области зоны по умолчанию (это то же самое, что и обычная разрешающая способность запросов).

Поддержка динамической \( DDNS \) обновлений и очистки DNS поддерживается только в области зоны по умолчанию. Так как внутренние клиенты обслуживаются по области зоны по умолчанию, администраторы Contoso DNS могут продолжать использовать существующие механизмы (динамические DNS или статические) для обновления записей в contoso.com. Для \- областей зон, отличных от заданной по умолчанию \( , таких как внешняя область в этом примере \) , поддержка DDNS или очистки недоступна.

### <a name="high-availability-of-policies"></a>Высокий уровень доступности политик

Политики DNS не Active Directory интегрированы. По этой причине политики DNS не реплицируются на другие DNS-серверы, на которых размещена одна и та же интегрированная зона Active Directory.

Политики DNS хранятся на локальном DNS-сервере. Политики DNS можно легко экспортировать с одного сервера на другой, используя следующие примеры команд Windows PowerShell.

```powershell
$policies = Get-DnsServerQueryResolutionPolicy -ZoneName "contoso.com" -ComputerName Server01
$policies |  Add-DnsServerQueryResolutionPolicy -ZoneName "contoso.com" -ComputerName Server02
```

Дополнительные сведения см. в следующих справочных разделах Windows PowerShell.

- [Get-Днссерверкуериресолутионполици](/powershell/module/dnsserver/get-dnsserverqueryresolutionpolicy?view=win10-ps)
- [Add-Днссерверкуериресолутионполици](/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps)

## <a name="how-to-configure-dns-policy-for-split-brain-dns-in-active-directory"></a>Настройка политики DNS для разделения \- мозгового DNS-сервера в Active Directory

Чтобы настроить развертывание с разделением DNS с помощью политики DNS, необходимо использовать следующие разделы, содержащие подробные инструкции по настройке.

### <a name="add-the-active-directory-integrated-zone"></a>Добавление интегрированной зоны Active Directory

Приведенный ниже пример команды можно использовать для добавления Active Directory интегрированной зоны contoso.com на DNS-сервер.

```powershell
Add-DnsServerPrimaryZone -Name "contoso.com" -ReplicationScope "Domain" -PassThru
```

Дополнительные сведения см. в разделе [Add-днссерверпримаризоне](/powershell/module/dnsserver/add-dnsserverprimaryzone?view=win10-ps).

### <a name="create-the-scopes-of-the-zone"></a>Создание областей зоны

С помощью этого раздела можно секционировать зону contoso.com для создания области внешней зоны.

Область зоны — это уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, при этом каждая область зоны содержит собственный набор записей DNS. Одна и та же запись может присутствовать в нескольких областях с разными IP-адресами или IP-адресами.

Так как вы добавляете эту новую область зоны в интегрированную зону Active Directory, область зоны и записи внутри нее будут реплицироваться с помощью Active Directory на другие серверы реплик в домене.

По умолчанию область зоны существует в каждой зоне DNS. Эта область зоны имеет то же имя, что и зона, а устаревшие операции DNS работают в этой области. В этой области зоны по умолчанию будет размещена внутренняя версия www.career.contoso.com.

Для создания области зоны на DNS-сервере можно использовать приведенный ниже пример команды.

```powershell
Add-DnsServerZoneScope -ZoneName "contoso.com" -Name "external"
```

Дополнительные сведения см. в разделе [Add-днссерверзонескопе](/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps).

### <a name="add-records-to-the-zone-scopes"></a>Добавление записей в области зоны

Следующим шагом является добавление записей, представляющих узел веб-сервера, в две области зоны — внешние и по умолчанию \( для внутренних клиентов \) .

В области внутренней зоны по умолчанию запись www.career.contoso.com добавляется с IP-адресом 10.0.0.39, который является частным IP-адресом. и в области внешней зоны Эта запись \( www.Career.contoso.com \) добавляется с общедоступным IP-адресом 65.55.39.10.

Записи \( в области внутренней зоны по умолчанию и области внешней зоны \) будут автоматически реплицироваться по домену с соответствующими областями зоны.

Приведенный ниже пример команды можно использовать для добавления записей в области зоны на DNS-сервере.

```powershell
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "65.55.39.10" -ZoneScope "external"
Add-DnsServerResourceRecord -ZoneName "contoso.com" -A -Name "www.career" -IPv4Address "10.0.0.39”
```

> [!NOTE]
> Параметр **– зонескопе** не включается при добавлении записи в область зоны по умолчанию. Это действие аналогично добавлению записей в обычную зону.

Дополнительные сведения см. в разделе [Add-днссерверресаурцерекорд](/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).

### <a name="create-the-dns-policies"></a>Создание политик DNS

После определения интерфейсов сервера для внешней сети и внутренней сети, а также для создания областей зоны необходимо создать политики DNS, которые соединяют внутренние и внешние области зоны.

> [!NOTE]
> В этом примере используется интерфейс сервера \( с параметром-ServerInterface в приведенной ниже команде примера в \) качестве критерия для различения внутренних и внешних клиентов. Другим способом различения внешних и внутренних клиентов является использование подсетей клиента в качестве критерия. Если вы можете определить подсети, к которым принадлежат внутренние клиенты, можно настроить политику DNS, чтобы отличать их от подсети клиента. Сведения о настройке управления трафиком с помощью критериев подсети клиента см. в статье [Использование политики DNS для управления трафиком на основе географического расположения с основными серверами](primary-geo-location.md).

После настройки политик при получении запроса DNS к общедоступному интерфейсу ответ возвращается из внешней области зоны.

> [!NOTE]
> Для сопоставления области внутренней зоны по умолчанию не требуются никакие политики.

```powershell
Add-DnsServerQueryResolutionPolicy -Name "SplitBrainZonePolicy" -Action ALLOW -ServerInterface "eq,208.84.0.53" -ZoneScope "external,1" -ZoneName contoso.com
```

> [!NOTE]
> 208.84.0.53 — это IP-адрес общедоступного сетевого интерфейса.

Дополнительные сведения см. в разделе [Add-днссерверкуериресолутионполици](/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).

Теперь DNS-сервер настроен с использованием требуемых политик DNS для сервера разделенного имени с Active Directoryной зоной DNS.

Вы можете создавать тысячи политик DNS в соответствии с требованиями к управлению трафиком, а все новые политики применяются динамически, без перезапуска DNS-сервера во входящих запросах.