---
title: Ответов DNS на основе времени дня с Azure сервера облачных приложений
description: Этот раздел является частью DNS политики сценарий руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: 4846b548-8fbc-4a7f-af13-09e834acdec0
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 3255d3fe29f6a7dda821183fa4352964cc230a5f
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="dns-responses-based-on-time-of-day-with-an-azure-cloud-app-server"></a>Ответов DNS на основе времени дня с Azure сервера облачных приложений

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать, чтобы узнать, как для распределения трафика приложения по географически различных экземпляров приложения с помощью политики DNS, которые основаны на время дня. 

Этот сценарий полезен в ситуациях, где вы хотите направлять трафик в один часовой пояс на серверы альтернативного приложений, например компьютере под управлением веб-серверов, размещенных на Microsoft Azure, расположенных в другой часовой пояс. Это позволяет балансировки нагрузки трафика между экземплярами приложения во время пиковой период, когда серверов-источников перегружен трафика. 

>[!NOTE]
>Узнайте, как с помощью политики DNS для интеллектуальных ответов DNS без использования Azure, в разделе [использование политики DNS для интеллектуальной DNS ответов на основе времени дня](Scenario--Use-DNS-Policy-for-Intelligent-DNS-Responses-Based-on-the-Time-of-Day.md). 

## <a name="bkmk_azureexample"></a>Пример интеллектуальных ответов DNS на основе времени дня с сервером приложения облака Azure

Ниже приведен пример того, как можно использовать политику DNS для Балансировка трафика приложения на основе времени дня.

В этом примере используется один вымышленной компании Contoso оплаты службы, которая предоставляет online подарить свой решения по всему миру через веб-сайтах, contosogiftservices.com. 

Веб-сайт contosogiftservices.com размещается только на одном на локальном центре обработки данных, в Сиэтле (с помощью общего IP 192.68.30.2). 

DNS-сервер также находится в центре обработки данных локальными. 

С последней всплеск бизнес contosogiftservices.com имеет более высокого количества посетителей каждый день, и некоторые клиенты сообщили проблемы доступности службы. 

Службы оплаты Contoso выполняет анализ сайта и обнаруживает, что каждый вечер между 6 PM и 9 PM местного времени, скачков трафика Сиэтл веб-серверу. Веб-сервер может масштабироваться для обработки увеличить пропускную способность в эти часы максимальной нагрузки приведет к отказу в обслуживании клиентам. 

Чтобы убедиться, что клиенты contosogiftservices.com получить быстрое взаимодействие с веб-сайта, службы оплаты Contoso решает эти часы, который будет арендовать виртуальной машины \(VM\) на Microsoft Azure для размещения копии свой веб-сервер.  

Службы оплаты Contoso возвращает общий IP-адрес из Azure для виртуальной Машины (192.68.31.44) и разрабатывает автоматизации развертывание сервера веб-каждый день в Azure между 5-10 PM, позволяя для одного часа на непредвиденный случай.

>[!NOTE]
>Дополнительные сведения о виртуальных машинах Azure см. в разделе [документации виртуальных машин](https://azure.microsoft.com/documentation/services/virtual-machines/) 

DNS-серверы, настраиваются с политиками DNS-сервера и области зоны, чтобы между 5 – 9 PM каждый день, 30% от запросы отправляются экземпляра веб-сервера, на котором выполняется в Azure.

Этот сценарий показана на следующем рисунке.

![Время дня ответов политики DNS](../../media/DNS-Policy-Tod2/dns_policy_tod2.jpg)  

## <a name="bkmk_azurehow"></a>О том, как получение интеллектуальных ответов DNS на основе времени дня с помощью Azure работает сервер приложений
 
В этой статье показано, как Настройка DNS-сервера для ответов на запросы DNS-сервера с помощью двух разных приложения IP-адресов серверов - одного веб-сервера находится в Сиэтле, а другой — в центре обработки данных Azure.

После настройки новой политики DNS, основанная на часы максимальной нагрузки от 18 часов до 21: 00 в Сиэтле DNS-сервер отправляет семьдесят процентов ответов DNS на клиентах, содержащий IP-адрес в Сиэтле веб-сервера и тридцать процентов ответов DNS на клиентах, содержащий IP-адрес Azure веб-сервера, тем самым направляют трафик клиента на новый Azure веб-сервера и препятствует стать перегружен Сиэтл веб-сервера. 

В остальных случаях дня, их обработки обычного запроса и ответы отправляются с область зоны по умолчанию, который содержит записи для веб-сервера в центре обработки данных локальной. 

После истечения срока ЖИЗНИ 10 минут на Azure записи гарантирует, что записи истек срок действия из кэша LDNS перед удалением виртуальной Машины из Azure. Одним из преимуществ такого масштабирования — можно сохранить DNS данных локальной и сохранить масштабирование в Azure как требование требует.

## <a name="bkmk_azureconfigure"></a>Настройка политики DNS для интеллектуальных ответов DNS на основе времени дня с Azure сервера приложений
Чтобы настроить политики время дня балансировки нагрузки приложений на основе ответы на запросы DNS, необходимо выполнить следующие действия.


- [Создание областей зоны](#bkmk_zscopes)
- [Добавить записи в области зоны](#bkmk_records)
- [Создание политик DNS](#bkmk_policies)


>[!NOTE]
>На DNS-сервере, который является заслуживающим доверия для зоны, которую вы хотите настроить, необходимо выполнить следующие действия. Членство в группе DnsAdmins или аналогичной ей необходим для выполнения следующих процедур. 

В следующих разделах приводятся подробных инструкций по настройке.

>[!IMPORTANT]
>В следующих разделах приведены примеры Windows PowerShell команд, содержащих примеры значений для многих параметров. Убедитесь, замените примеры значений в этих командах со значениями, подходящими для вашего развертывания, прежде чем выполнять эти команды. 


### <a name="bkmk_zscopes"></a>Создание областей зоны
Область зоны представляет уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, с каждой областью зону, содержащую собственный набор DNS-записей. Ту же запись может быть представлен в нескольких областях, различные IP-адреса или одинаковые IP-адреса. 

>[!NOTE]
>По умолчанию область зоны существует для зон DNS. Эта область зоны имеет то же имя, что зона и устаревших операции DNS-сервера работают в этой области. 

Следующий пример команды можно использовать для создания области зоны для размещения записей Azure.

```
Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "AzureZoneScope"
```

Дополнительные сведения см. в разделе [добавить DnsServerZoneScope](https://technet.microsoft.com/library/mt126267.aspx)

### <a name="bkmk_records"></a>Добавить записи в области зоны
Следующим шагом является добавление записей, представляющий веб-сервера в области зоны. 

Запись www.contosogiftservices.com добавляется в AzureZoneScope, с IP-адресом 192.68.31.44, который находится в общедоступное облако Azure. 

Аналогичным образом \(contosogiftservices.com\) области по умолчанию зона, \(www.contosogiftservices.com\) запись добавляется в IP-адрес 192.68.30.2 веб-сервера в центре обработки данных Сиэтл локальными.

В второй командлет — зонаобласть не указан. По этой причине записи добавляются в зонаобласть по умолчанию. 

Кроме того после истечения срока ЖИЗНИ записи для виртуальных машин Azure хранится на 600s (10 минут), чтобы LDNS не кэшировать его дольше времени - будут конфликтовать с балансировкой нагрузки. Кроме того виртуальные машины Azure доступны в течение часа лишние в непредвиденных случаях, чтобы обеспечить возможность разрешения даже клиентов с кэшированные записи.

```
Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "192.68.31.44" -ZoneScope "AzureZoneScope" –TimeToLive 600

Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "192.68.30.2"
```

Дополнительные сведения см. в разделе [добавить DnsServerResourceRecord](https://technet.microsoft.com/library/jj649925.aspx).  

### <a name="bkmk_policies"></a>Создание политик DNS 
После создания области зоны можно создать политики DNS, которые распределять входящие запросы между этих областях, происходит следующее.

1. С 6 по 9 PM ежедневно, 30% клиентов получать IP-адрес веб-сервера в центре обработки данных Azure в ответе DNS, пока 70% от клиентов получает IP-адрес веб-сервера, локального Сиэтл.
2. В остальных случаях все клиенты будут получать IP-адрес Сиэтл локальными веб-сервера.

Время дня имеет выразить в формате местного времени DNS-сервера.

Следующий пример команды можно использовать для создания политики DNS.

```
Add-DnsServerQueryResolutionPolicy -Name "Contoso6To9Policy" -Action ALLOW –-ZoneScope "contosogiftservices.com,7;AzureZoneScope,3" –TimeOfDay “EQ,18:00-21:00” -ZoneName "contosogiftservices.com" –ProcessingOrder 1
```

Дополнительные сведения см. в разделе [добавить DnsServerQueryResolutionPolicy](https://technet.microsoft.com/library/mt126273.aspx).  
  
Теперь DNS-сервер настроен с необходимые политики DNS для перенаправления трафика на Azure веб-сервер, на основе времени дня. 

Примечание выражение.

`
 -ZoneScope "contosogiftservices.com,7;AzureZoneScope,3" –TimeOfDay “EQ,18:00-21:00” 
`

Это выражение настраивает DNS-сервера с помощью комбинации зонаобласть и вес, предоставляющий DNS-сервер для отправки семьдесят % времени при отправке тридцать процентов времени Azure веб-сервера, IP-адрес IP-адрес в Сиэтле веб-сервера.

Можно создать тысячи политик DNS в соответствии с трафик требования к управлению, и все новые политики применяются динамически — без перезагрузки DNS-сервер — на входящие запросы.
