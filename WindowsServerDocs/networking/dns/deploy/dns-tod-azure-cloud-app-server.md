---
title: Получение ответов DNS на основе времени дня с помощью сервера облачных приложений Azure
description: Этот раздел является частью DNS политики сценария руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: 4846b548-8fbc-4a7f-af13-09e834acdec0
ms.author: pashort
author: shortpatti
ms.openlocfilehash: ed6ac2ebc8839d0e7ecee682d7644251f8a59381
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59829075"
---
# <a name="dns-responses-based-on-time-of-day-with-an-azure-cloud-app-server"></a>Получение ответов DNS на основе времени дня с помощью сервера облачных приложений Azure

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Чтобы узнать, как для распределения трафика приложения для различных экземпляров географически распределенного приложения с помощью политики DNS, которые основаны на время суток, можно использовать в этом разделе. 

Этот сценарий полезен в ситуациях, где вы хотите направить трафик из одного часового пояса на серверы приложения от другого, например компьютере под управлением веб-серверы, размещенные в Microsoft Azure, которые находятся в другом часовом поясе. Это дает возможность балансировки нагрузки трафика между экземплярами приложения во время пиковой временные периоды, когда серверы-источники являются перегруженными с трафиком. 

>[!NOTE]
>Узнайте, как с помощью политики DNS для интеллектуальных ответов DNS без использования Azure, см. в разделе [использование политики DNS для интеллектуальных ответов DNS в зависимости от дня из времени](Scenario--Use-DNS-Policy-for-Intelligent-DNS-Responses-Based-on-the-Time-of-Day.md). 

## <a name="bkmk_azureexample"></a>Пример интеллектуальных ответов DNS на основе времени дня с сервера приложений в облаке Azure

Ниже приведен пример того, как можно использовать политики DNS для балансировки трафика приложения на основе времени суток.

В этом примере используется один вымышленной компании Contoso подарок Services, которая предоставляет Интернет-решений, дарения по всему миру через его веб-узел, contosogiftservices.com. 

Веб-сайт contosogiftservices.com размещается только на одном локальном центре обработки данных в Сиэтле (с общедоступным IP-адресом 192.68.30.2). 

DNS-сервер также находится в локальном центре обработки данных. 

С помощью последних рост бизнеса contosogiftservices.com имеет большее количество посетителей каждый день, и некоторые пользователи сообщали о проблемах доступности службы. 

Службы Contoso подарок выполняет анализ сайта и обнаруживает, что каждый вечер между 18: 00 до 21: 00 по местному времени, скачков трафика Сиэтл веб-серверу. Веб-сервер нельзя масштабировать для обработки большего объема трафика в эти часы максимальной нагрузки, приводит к отказу в обслуживании клиентов. 

Чтобы убедиться, что contosogiftservices.com клиенты получают более высокую скорость работы с веб-сайта, службы подарок Contoso решает, что эти часы он будет арендовать виртуальной машины \(виртуальной Машины\) в Microsoft Azure для размещения копии веб-сервера .  

Службы подарок Contoso возвращает общедоступный IP-адрес из Azure для виртуальной Машины (192.68.31.44) и разрабатывает автоматизации для развертывания веб-сервера каждый день в Azure между 17-10: 00, что для одного часа на непредвиденные случаи.

>[!NOTE]
>Дополнительные сведения о виртуальных машинах Azure, см. в разделе [документация по виртуальным машинам](https://azure.microsoft.com/documentation/services/virtual-machines/) 

DNS-серверы настраиваются с помощью области зоны и политик DNS таким образом, чтобы между 5-9 PM каждый день, 30% от запросы отправляются к экземпляру веб-сервера, на котором выполняется в Azure.

Этот сценарий показан на следующем рисунке.

![Политики времени дня ответов DNS](../../media/DNS-Policy-Tod2/dns_policy_tod2.jpg)  

## <a name="bkmk_azurehow"></a>Работает как получение интеллектуальных ответов DNS на основе времени дня с помощью Azure сервера приложений
 
В этой статье показано, как настроить DNS-серверу отвечать на запросы DNS с помощью двух приложений с различными IP-адреса сервера - один веб-сервер находится в Сиэтле, а другой — в центре обработки данных Azure.

После настройки новой политики DNS, основанный на часы максимальной нагрузки из 18: 00 до 21: 00 в Сиэтле DNS-сервер отправляет семьдесят процентов ответов DNS на клиентах, содержащий IP-адрес Сиэтл веб-сервера и 30 процентов ответов на топологи DNS nts с IP-адресом Azure веб-сервера, тем самым направляют трафик клиента на новый сервер Azure Web и препятствует стать перегруженным Сиэтл веб-сервера. 

Во всех остальных случаях дня, обработка обычный запрос выполняется, и результаты отправляются из области зоны по умолчанию, который содержит запись для веб-сервера в локальном центре обработки данных. 

Срока ЖИЗНИ 10 минут Azure запись о гарантирует, что запись просрочена из кэша LDNS перед удалением виртуальной Машины из Azure. Одним из преимуществ такого масштабирования — что можно сохранять DNS данных в локальной и сохранить горизонтальное масштабирование в Azure по запросу.

## <a name="bkmk_azureconfigure"></a>Настройка политики DNS для интеллектуальных ответов DNS на основе времени дня с помощью Azure сервера приложений
Чтобы настроить политики времени балансировки нагрузки приложений, день, в основе ответы на запросы DNS, необходимо выполнить следующие действия.


- [Создание области зоны](#bkmk_zscopes)
- [Добавление записей в области зоны](#bkmk_records)
- [Создайте политики DNS](#bkmk_policies)


>[!NOTE]
>Эти действия необходимо выполнить на DNS-сервере, который заслуживает доверия для зоны, которую требуется настроить. Для выполнения следующей процедуры требуется членство в DnsAdmins или наличие эквивалентных прав. 

Следующие разделы содержат подробных инструкций по настройке.

>[!IMPORTANT]
>В следующих разделах приведены примеры команд Windows PowerShell, которые содержат примеры значений для многих параметров. Убедитесь, что примеры значений в этих командах замените значения, которые подходят для развертывания, прежде чем вы выполните следующие команды. 


### <a name="bkmk_zscopes"></a>Создание области зоны
Область зоны — это уникальный экземпляр зоны. Зоны DNS может иметь несколько областей зоны, с каждой из областей зоны, содержащий собственный набор записей DNS. Та же запись могут присутствовать в нескольких областях, различные IP-адреса или же IP-адреса. 

>[!NOTE]
>По умолчанию области зоны существует для зон DNS. Эта область зоны имеет то же имя, что зона и устаревших работы DNS работать в этой области. 

Например, следующая команда можно использовать для создания области зоны для размещения записей Azure.

```
Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "AzureZoneScope"
```

Дополнительные сведения см. в разделе [DnsServerZoneScope добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps)

### <a name="bkmk_records"></a>Добавление записей в области зоны
Следующим шагом является добавление записей, представляющий узел веб-сервера в области зоны. 

В AzureZoneScope www.contosogiftservices.com запись добавляется с IP-адресом 192.68.31.44, который находится в общедоступном облаке Azure. 

Аналогично, в области зоны по умолчанию \(contosogiftservices.com\), запись \(www.contosogiftservices.com\) добавляется с IP-адресом 192.68.30.2 в Сиэтл на локальном веб-сервера Центр обработки данных.

В следующий командлет, второй параметр – зонаобласть не включается. По этой причине записи добавляются в используемом по умолчанию зонаобласть. 

Кроме того срок ЖИЗНИ записи для виртуальных машин Azure хранится на 600s (10 минут), чтобы LDNS не кэшировать его дольше, — который может повлиять на балансировку нагрузки. Кроме того виртуальные машины Azure доступны в течение 1 дополнительный час непредвиденной, чтобы обеспечить возможность разрешать даже клиентов с помощью кэшированные записи.

```
Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "192.68.31.44" -ZoneScope "AzureZoneScope" –TimeToLive 600

Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "192.68.30.2"
```

Дополнительные сведения см. в разделе [Add-DnsServerResourceRecord](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).  

### <a name="bkmk_policies"></a>Создайте политики DNS 
После создания области зоны, можно создать политики DNS, которые распределяют входящие запросы в этих областях, таким образом, происходит следующее.

1. От 18: 00 до 21: 00 ежедневно, 30% клиентов получите IP-адрес веб-сервера в центре обработки данных Azure в ответе DNS, пока 70% от клиентов получать IP-адрес веб-сервера в локальной Сиэтл.
2. Во всех остальных случаях все клиенты получают IP-адрес веб-сервера в локальной Сиэтл.

Время дня должно быть в формате местного времени DNS-сервера.

Например, следующая команда используется для создания политики DNS.

```
Add-DnsServerQueryResolutionPolicy -Name "Contoso6To9Policy" -Action ALLOW -ZoneScope "contosogiftservices.com,7;AzureZoneScope,3" –TimeOfDay “EQ,18:00-21:00” -ZoneName "contosogiftservices.com" –ProcessingOrder 1
```

Дополнительные сведения см. в разделе [DnsServerQueryResolutionPolicy добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  
  
Теперь DNS-сервера с помощью необходимых политик DNS для перенаправления трафика на веб-Azure сервер, на основе времени суток. 

Обратите внимание, выражение:

`
 -ZoneScope "contosogiftservices.com,7;AzureZoneScope,3" –TimeOfDay “EQ,18:00-21:00” 
`

Это выражение настраивает DNS-сервер с сочетанием зонаобласть и вес, который указывает, что DNS-сервер для отправки семьдесят процентов времени, при отправке 30 процентов времени IP-адрес Azure веб-сервера IP-адрес Сиэтл веб-сервера.

Можно создать тысячи политик DNS в соответствии с трафиком требований к управлению, а все новые политики применяются динамически — без перезапуска DNS-сервер — на входящих запросов.
