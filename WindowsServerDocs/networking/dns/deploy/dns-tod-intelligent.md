---
title: Получение интеллектуальных ответов DNS на основе времени дня с помощью политики DNS
description: Этот раздел является частью руководств по сценариям политики DNS для Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-dns
ms.topic: article
ms.assetid: 161446ff-a072-4cc4-b339-00a04857ff3a
ms.author: lizross
author: eross-msft
ms.openlocfilehash: e4bb075368bb3dfadaa8046b177dbbac637763e3
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "80317826"
---
# <a name="use-dns-policy-for-intelligent-dns-responses-based-on-the-time-of-day"></a>Получение интеллектуальных ответов DNS на основе времени дня с помощью политики DNS

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете, как распределять трафик приложений между различными географически распределенными экземплярами приложения с помощью политик DNS, основанных на времени суток.  
  
Этот сценарий полезен в ситуациях, когда требуется направить трафик в один часовой пояс на альтернативные серверы приложений, такие как веб-серверы, которые находятся в другом часовом поясе. Это позволяет распределять трафик между экземплярами приложения во время пиковых периодов, когда основные серверы перегружаются с трафиком.   
  
### <a name="example-of-intelligent-dns-responses-based-on-the-time-of-day"></a><a name="bkmk_example1"></a>Пример интеллектуальных ответов DNS на основе времени суток  
Ниже приведен пример того, как можно использовать политику DNS для балансировки трафика приложения в зависимости от времени суток.  
  
В этом примере используется одна вымышленная компания, подарочные службы Contoso, которые предоставляют Интернет-решения для электронной коммерции по всему миру с помощью своего Web-узла, contosogiftservices.com.   
  
Веб-сайт contosogiftservices.com размещается в двух центрах обработки данных: один в Сиэтле (Северная Америка), а другой — в Дублин (Европа). DNS-серверы настроены для отправки ответов с поддержкой географического расположения с помощью политики DNS. Благодаря недавнему всплеску в бизнесе contosogiftservices.com имеет большее количество посетителей каждый день, и некоторые клиенты сообщали о проблемах доступности служб.  
  
Службы подарков компании Contoso выполняют анализ сайта и обнаруживают, что каждый вечер в промежутке между 6 и 9 РМ по местному времени — это всплеск трафика на веб-серверы. Веб-серверы не могут масштабироваться для поддержки увеличенного трафика в часы пиковой нагрузки, что приводит к отказу в обслуживании для клиентов. Одна и та же перегрузка пикового трафика происходит в центрах обработки данных в Европе и США. В другие моменты времени серверы обрабатывают тома трафика, которые являются более надежными по сравнению с максимальными возможностями.  
  
Чтобы гарантировать, что contosogiftservices.com клиенты получают возможность реагирования с веб-сайта, службы подарков компании Contoso хотят перенаправить некоторый трафик Дублин на серверы приложений в Сиэтле от 6 до 9 PM в Дублин; и им нужно перенаправить некоторый трафик в Сиэтле на серверы приложений Дублин в диапазоне от 6 до 9 PM в Сиэтле.  
  
Этот сценарий показан на следующем рисунке.  
  
![Пример политики DNS для времени суток](../../media/DNS-Policy-Tod1/dns_policy_tod1.jpg)  
  
### <a name="how-intelligent-dns-responses-based-on-time-of-day-works"></a><a name="bkmk_works1"></a>Как интеллектуальные ответы DNS на основе времени суток  
  
Если для DNS-сервера настроена политика DNS с временем суток, от 6 до 9 PM в каждом географическом расположении DNS-сервер выполняет следующие настройки.  
  
- Отвечает на первые четыре получаемых им запроса с IP-адресом сервера в локальном центре обработки данных.  
- Отвечает на пятый запрос, полученный с IP-адресом сервера в удаленном центре обработки данных.   
  
Это поведение на основе политики разгружает двадцать за одно увеличение трафика локального веб-сервера на удаленный веб-сервер, сокращая нагрузку на локальный сервер приложений и повышая производительность сайта для клиентов.  
  
В часы наименьшей нагрузки DNS-серверы выполняют нормальное управление трафиком на основе географических расположений. Кроме того, DNS-клиенты, которые отправляют запросы из расположений, отличных от Северная Америка или Европы, выгружают балансировку трафика в центрах обработки данных в Сиэтле и Дублин.  
  
Если в DNS настроено несколько политик DNS, они являются упорядоченным набором правил и обрабатываются службой DNS от наивысшего приоритета до самого низкого приоритета. DNS использует первую политику, которая соответствует условиям, включая время суток. По этой причине более конкретные политики должны иметь более высокий приоритет. Если вы создаете политики времени суток и придаете им высокий приоритет в списке политик, службы DNS и сначала используют эти политики, если они соответствуют параметрам запроса DNS-клиента и критериям, определенным в политике. Если они не совпадают, DNS перемещает список политик для обработки политик по умолчанию до тех пор, пока не найдет совпадение.  
  
Дополнительные сведения о типах политик и критериях см. в разделе [Общие сведения о политиках DNS](../../dns/deploy/DNS-Policies-Overview.md).  
  
### <a name="how-to-configure-dns-policy-for-intelligent-dns-responses-based-on-time-of-day"></a><a name="bkmk_how1"></a>Настройка политики DNS для интеллектуальных ответов DNS на основе времени суток  
Чтобы настроить политику DNS для времени суток с балансировкой нагрузки приложений на основе запросов, необходимо выполнить следующие действия.  
  
- [Создание подсетей клиента DNS](#bkmk_subnets)  
- [Создание областей зоны](#bkmk_zscopes)  
- [Добавление записей в области зоны](#bkmk_records)  
- [Создание политик DNS](#bkmk_policies)  
  
>[!NOTE]
>Эти действия необходимо выполнить на DNS-сервере, который является полномочным для зоны, которую требуется настроить. Членство в **DnsAdmins**(или аналогичное) требуется для выполнения следующих процедур.  
  
В следующих разделах приведены подробные инструкции по настройке.  
  
>[!IMPORTANT]
>В следующих разделах приведены примеры команд Windows PowerShell, которые содержат примеры значений для многих параметров. Перед выполнением этих команд обязательно замените примеры значений в этих командах значениями, подходящими для вашего развертывания.  
  
#### <a name="create-the-dns-client-subnets"></a><a name="bkmk_subnets"></a>Создание подсетей клиента DNS  
Первым шагом является указание подсетей или пространства IP-адресов регионов, для которых необходимо перенаправить трафик. Например, если требуется перенаправить трафик для США и Европы, необходимо найти подсети или пространства IP-адресов этих регионов.  
  
Эти сведения можно получить из карт географических IP-адресов. На основе этих дистрибутивов геоip-адресов необходимо создать "подсети клиента DNS". Подсеть клиента DNS — это логическая группа подсетей IPv4 или IPv6, из которой отправляются запросы на DNS-сервер.  
  
Для создания подсетей клиента DNS можно использовать следующие команды Windows PowerShell.  
  
```  
Add-DnsServerClientSubnet -Name "AmericaSubnet" -IPv4Subnet "192.0.0.0/24, 182.0.0.0/24"  
  
Add-DnsServerClientSubnet -Name "EuropeSubnet" -IPv4Subnet "141.1.0.0/24, 151.1.0.0/24"  
  
```  
Дополнительные сведения см. в разделе [Add-днссерверклиентсубнет](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverclientsubnet?view=win10-ps).  
  
#### <a name="create-the-zone-scopes"></a><a name="bkmk_zscopes"></a>Создание областей зоны  
После настройки подсетей клиента необходимо секционировать зону, трафик которой необходимо перенаправить на две разные области зоны, по одной области для каждой настроенной подсети клиента DNS.  
  
Например, если вы хотите перенаправить трафик для DNS-имени www.contosogiftservices.com, необходимо создать две разные области зоны в зоне contosogiftservices.com, одну для США и одну для Европы.  
  
Область зоны — это уникальный экземпляр зоны. Зона DNS может иметь несколько областей зоны, при этом каждая область зоны содержит собственный набор записей DNS. Одна и та же запись может присутствовать в нескольких областях с разными IP-адресами или IP-адресами.  
  
>[!NOTE]
>По умолчанию область зоны существует в зонах DNS. Эта область зоны имеет то же имя, что и зона, а устаревшие операции DNS работают в этой области.  
  
Для создания областей зоны можно использовать следующие команды Windows PowerShell.  
  
```  
Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "SeattleZoneScope"  
  
Add-DnsServerZoneScope -ZoneName "contosogiftservices.com" -Name "DublinZoneScope"  
  
```  
Дополнительные сведения см. в разделе [Add-днссерверзонескопе](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverzonescope?view=win10-ps).  
  
#### <a name="add-records-to-the-zone-scopes"></a><a name="bkmk_records"></a>Добавление записей в области зоны  
Теперь необходимо добавить записи, представляющие узел веб-сервера, в две области зоны.  
  
Например, в **сеаттлезонескопе**запись <strong>www.contosogiftservices.com</strong> добавляется с IP-адресом 192.0.0.1, который находится в Сиэтле. Аналогичным образом в **дублинзонескопе**запись <strong>www.contosogiftservices.com</strong> добавляется с IP-адресом 141.1.0.3 в центре обработки данных.  
  
Для добавления записей в области зоны можно использовать следующие команды Windows PowerShell.  
  
```  
Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "192.0.0.1" -ZoneScope "SeattleZoneScope  
  
Add-DnsServerResourceRecord -ZoneName "contosogiftservices.com" -A -Name "www" -IPv4Address "141.1.0.3" -ZoneScope "DublinZoneScope"  
  
```  
Параметр Зонескопе не включается при добавлении записи в область по умолчанию. Это то же самое, что и добавление записей в стандартную зону DNS.  
  
Дополнительные сведения см. в разделе [Add-днссерверресаурцерекорд](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverresourcerecord?view=win10-ps).  
  
#### <a name="create-the-dns-policies"></a><a name="bkmk_policies"></a>Создание политик DNS  
После создания подсетей, разделов (областей зоны) и добавления записей необходимо создать политики, соединяющие подсети и секции, чтобы при получении запроса из источника в одной из подсетей клиента DNS возвращался ответ запроса. правильная область действия зоны. Для сопоставления области зоны по умолчанию не требуются никакие политики.  
  
После настройки этих политик DNS поведение DNS-сервера выглядит следующим образом:  
  
1. Европейские DNS-клиенты получают в ответах на запросы DNS IP-адрес сервера в центре обработки данных.  
2. Клиентские DNS-клиенты получают IP-адреса в центре обработки данных в Сиэтле в ответе на запрос DNS.  
3. В диапазоне от 6 до 9 PM в Дублин, 20% запросов от европейских клиентов получают IP-адрес веб сервера в центре обработки данных в Сиэтле в своем ответе на запрос DNS.  
4. В диапазоне от 6 до 9 PM в Сиэтле 20% запросов от американских клиентов получают IP-адрес веб сервера в центре обработки данных в своем ответе на запрос DNS.  
5. Половина запросов из оставшейся части мира получают IP-адрес центра обработки данных в Сиэтле, а вторая — IP-адрес центра обработки данных Dublin.  
  
  
Для создания политики DNS, связывающей подсети клиента DNS и области зоны, можно использовать следующие команды Windows PowerShell.  
  
>[!NOTE]
>В этом примере DNS-сервер находится в часовом поясе GMT, поэтому периоды пикового времени в часах должны быть выражены в эквивалентном времени GMT.  
  
```  
Add-DnsServerQueryResolutionPolicy -Name "America6To9Policy" -Action ALLOW -ClientSubnet "eq,AmericaSubnet" -ZoneScope "SeattleZoneScope,4;DublinZoneScope,1" -TimeOfDay "EQ,01:00-04:00" -ZoneName "contosogiftservices.com" -ProcessingOrder 1  
  
Add-DnsServerQueryResolutionPolicy -Name "Europe6To9Policy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "SeattleZoneScope,1;DublinZoneScope,4" -TimeOfDay "EQ,17:00-20:00" -ZoneName "contosogiftservices.com" -ProcessingOrder 2  
  
Add-DnsServerQueryResolutionPolicy -Name "AmericaPolicy" -Action ALLOW -ClientSubnet "eq,AmericaSubnet" -ZoneScope "SeattleZoneScope,1" -ZoneName "contosogiftservices.com" -ProcessingOrder 3  
  
Add-DnsServerQueryResolutionPolicy -Name "EuropePolicy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "DublinZoneScope,1" -ZoneName "contosogiftservices.com" -ProcessingOrder 4  
  
Add-DnsServerQueryResolutionPolicy -Name "RestOfWorldPolicy" -Action ALLOW --ZoneScope "DublinZoneScope,1;SeattleZoneScope,1" -ZoneName "contosogiftservices.com" -ProcessingOrder 5  
  
```  
Дополнительные сведения см. в разделе [Add-днссерверкуериресолутионполици](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps).  
  
Теперь на DNS-сервере настроены необходимые политики DNS для перенаправления трафика на основе географического расположения и времени суток.  
  
Когда DNS-сервер получает запросы на разрешение имен, DNS-сервер оценивает поля в DNS-запросе на соответствие настроенным политикам DNS. Если исходный IP-адрес в запросе разрешения имен соответствует любой из политик, область связанной зоны используется для ответа на запрос, а пользователь направляется к ресурсу, который является географически ближайшим к ним.  
  
Вы можете создавать тысячи политик DNS в соответствии с требованиями к управлению трафиком, а все новые политики применяются динамически, без перезапуска DNS-сервера во входящих запросах.


