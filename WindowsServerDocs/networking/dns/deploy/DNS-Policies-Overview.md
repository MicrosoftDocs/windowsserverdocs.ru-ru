---
title: Обзор политик DNS
description: Этот раздел является частью DNS политики сценария руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: 566bc270-81c7-48c3-a904-3cba942ad463
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 6c4d8f9bb6c56e8f90a90cd4e77565a39211f719
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446437"
---
# <a name="dns-policies-overview"></a>Обзор политик DNS

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Дополнительные сведения о политике DNS, которое впервые появилось в Windows Server 2016 можно использовать в этом разделе. Можно использовать политику DNS для географического расположения на основе управление трафиком, интеллектуальных ответов DNS, на основе времени дня, чтобы управлять один DNS-сервер, настроенный для разбиения\-развертывания вычислительных мощностей, применения фильтров к DNS-запросы и многое другое. Ниже приведены дополнительные сведения об этих возможностях.

-   **Балансировка нагрузки приложения.** Если вы развернули несколько экземпляров приложения в разных местах, можно использовать политики DNS для балансировки нагрузки трафика между экземплярами приложений с различными, динамического выделения нагрузки трафика для приложения.

-   **Географическая\-Location Based управление трафиком.** Можно использовать политики DNS позволяет основного и дополнительного DNS-серверы реагировать на запросы DNS-клиента на основе географического расположения клиента и ресурса, к которому клиент пытается подключиться, предоставляя клиент с IP-адрес ближайшего ресурс. 

-   **Разделение вычислительных мощностей DNS.** С разделением\-мозг DNS, записи DNS были разбиты на различные области зоны на одном сервере DNS и DNS-клиентам получить ответ, основанного на клиенты внутренних и внешних клиентов. Можно настроить разделение\-мозг DNS для зон, интегрированных в Active Directory или для зон на автономных серверах DNS.

-   **Фильтрация.** Можно настроить политики DNS для создания фильтров запросов, основанных на введенных признаков. Фильтры запросов в политике DNS позволяют настроить DNS-сервер отвечает специальным образом на основе запроса DNS и DNS-клиента, который отправляет запрос DNS. 
-   **Расследований.** Можно использовать политики DNS для перенаправления вредоносные клиенты DNS не\-существующий IP-адрес вместо направления их на компьютер, они удается связаться.

-   **Время суток, на основе перенаправления.** Политики DNS можно использовать для распределения трафика приложения для различных экземпляров географически распределенного приложения с помощью политики DNS, которые основаны на время суток.

## <a name="new-concepts"></a>Новые концепции  
Чтобы создать политики для поддержки сценариев, перечисленных выше, бывает необходимо иметь возможность идентифицировать набор записей в зоне, групп клиентов в сети, между другими элементами. Эти элементы представлены следующие новые объекты DNS:  

- **Подсеть клиента:** объект подсети клиента представляет IPv4 или IPv6 подсети, из которого запросы отправляются на DNS-сервер. Вы можете создать подсети для более поздней версии определения политик, применяемых в зависимости от какую подсеть, чтобы запросы исходили от. Например, в сценарии DNS мозг разбиения, запрос для разрешения для имени, например <em>www.microsoft.com</em> можно получать в ответ внутренний IP-адрес для клиентов из внутренней подсети, а другой IP-адрес, на клиентах во внешних подсети.

- **Область рекурсии:** рекурсии области являются уникальных экземпляров группы параметров, контролирующие рекурсию на DNS-сервер. Рекурсия область содержит список серверов пересылки и указывает, включена ли рекурсия. DNS-сервер может иметь несколько областей рекурсии. Политики рекурсии DNS-сервера можно выбрать область рекурсии для набора запросов. Если DNS-сервер не является полномочным для некоторых запросов, политики рекурсии DNS server позволяют управлять как для разрешения этих запросов. Можно указать, какие серверы пересылки и следует ли использовать рекурсию.

- **Зона областей:** зоны DNS может иметь несколько областей зоны, с каждой из областей зоны, содержащий собственные наборы записей DNS. Та же запись могут присутствовать в нескольких областях, различные IP-адреса. Кроме того передач зон, выполняются на уровне области зоны. Это означает, что записи из область зоны, интегрированной в основной зоне будет перенесена на той же области зоны в дополнительной зоны.

## <a name="types-of-policy"></a>Типы политики

Политики DNS разделяются по типам и уровень. Можно использовать политики разрешения запросов, чтобы определить, каким образом запросы обрабатываются и политики передачи зоны для определения того, как происходят передачи зоны. Каждый тип политики на уровне сервера или уровне зоны можно применить.

### <a name="query-resolution-policies"></a>Политики для разрешения запросов

Политики разрешения запросов DNS можно использовать для указания входящих устранения запросы обрабатываются DNS-сервер. Политика каждые DNS для разрешения запроса содержит следующие элементы:  

|Поле|Описание|Возможные значения|  
|---------|---------------|-------------------|  
|**Name**|Имя политики|-До 256 символов<br />— Может содержать любые символы, допустимые для имени файла|  
|**Состояние**|Состояние политики|— Включите (по умолчанию)<br />-Отключено|  
|**Уровень**|Уровень политики|-Сервер<br />-Зоны|  
|**Порядок обработки**|После запроса классифицируется по уровню и применяет, находит первый политики, для которых запрос удовлетворяет критериям и применяет его для запроса|— Числовое значение<br />-Уникальным значением для каждого политики, содержащий те же уровня и применяет значение|  
|**Действие**|Действие для выполнения DNS-сервером|— Разрешить (по умолчанию для уровня зоны)<br />-Deny (по умолчанию на уровне сервера)<br />-Ignore|  
|**Критерии**|Условие политики (или) и список критерия должны быть выполнены для для применения политики|— Условный оператор (или)<br />-Список критериев (см. в следующей таблице критерию)|  
|**Область**|Список областей зоны и взвешенные значения каждой области. Взвешенные значения используются для распространения балансировки нагрузки. Например если этот список включает datacenter1 с весом 3 и datacenter2 вес 5 сервер отправит с записью из datacentre1 три раза из восьми запросов|-Список области зоны (по имени) и значений веса|  

> [!NOTE]
> Политики на уровне сервера может иметь только значения **Deny** или **пропустить** как действие.

Поле условия политики DNS состоит из двух элементов:


|              Имя               |                                         Описание                                          |                                                                                                                               Примеры значений                                                                                                                               |
|---------------------------------|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|        **Подсеть клиента**        | Имя подсети предопределенные клиента. Используется для проверки в подсети, из которого был отправлен запрос. |                             -   **EQ, Испании, Франции** -возвращает значение true, если подсеть определяется как Испания или Франция<br />-   **NE, Канада, Мексика** -разрешается в значение true, если какой-либо подсети, отличный от Канаде и Мексике подсети клиента                             |
|     **Транспортный протокол**      |        Транспортный протокол, используемый в запросе. Возможные операции **UDP** и **TCP**        |                                                                                                                    -   **EQ, TCP**<br />-   **EQ, UDP**                                                                                                                     |
|      **Протокол IP**      |        Сетевой протокол, используемый в запросе. Возможные операции **IPv4** и **IPv6**        |                                                                                                                   -   **EQ,IPv4**<br />-   **EQ,IPv6**                                                                                                                    |
| **Интерфейс IP-адрес сервера** |                   IP-адрес для входящего сетевого интерфейса DNS-сервера                   |                                                                                                              -   **EQ, 10.0.0.1**<br />-   **EQ, 192.168.1.1**                                                                                                              |
|            **ПОЛНОЕ ДОМЕННОЕ ИМЯ**             |            Полное ДОМЕННОЕ имя записи в запросе с возможность использования подстановочного знака            | -   **EQ, www.contoso.com** -tot разрешает rue, только если запрос пытается сопоставить <em>www.contoso.com</em> полное доменное имя<br />-   **EQ,\*. contoso.com,\*. woodgrove.com** -возвращает значение true, если запрос предназначен для любой записи, заканчивающиеся на *contoso.com***или***woodgrove.com* |
|         **Тип запроса**          |                          Тип запрашиваемой записи (A, SVR, TXT)                          |                                                  -   **EQ, TXT, SRV** -возвращает значение true, если запрос запрашивает txt-ФАЙЛ **или** SRV-записи<br />-   **EQ, MX** -возвращает значение true, если запрос запрашивает запись MX                                                   |
|         **Время суток**         |                              Время получения запроса                               |                                                                    -   **EQ, 10:00-12:00, 22:00-23:00** -возвращает значение true, если запрос получен период: 10 до полудня, **или** между 22: 00 до 23: 00                                                                    |

С помощью приведенной выше таблицы в качестве отправной точки, в следующей таблице может использоваться для определения условие, которое используется для сопоставления запросов для всех типов записей, но записи SRV в домене contoso.com, поступающих от клиентов в подсети 10.0.0.0/24 через TCP 8-22: 00 до я интерфейс 10.0.0.3:  

|Имя|Значение|  
|--------|---------|  
|Подсеть клиента|EQ,10.0.0.0/24|  
|Транспортный протокол|EQ, TCP|  
|Интерфейс IP-адрес сервера|EQ, 10.0.0.3|  
|FQDN|EQ, *.contoso.com|  
|Тип запроса|NE, SRV|  
|Время суток|EQ, 20:00-22:00|  

Можно создать несколько запросов политики разрешения того же уровня, до тех пор, пока они имеют другое значение для порядка обработки. Если доступны несколько политик, DNS-сервер обрабатывает входящие запросы следующим образом:  

![Обработка политики DNS](../../media/DNS-Policies-Overview/DNSQueryResolutionPolicyFlowchart.png)  

### <a name="recursion-policies"></a>Политики рекурсии  
Политики рекурсии, — это специальный **тип** из политики на уровне сервера. Рекурсия политики управления, как DNS-сервер выполняет рекурсию для запроса. Политики рекурсии, применяются только в том случае, когда обработка запросов достигает путь рекурсии. Можно выбрать значение запретить или ИГНОРИРОВАТЬ для рекурсии для набора запросов. Кроме того можно выбрать набор серверов пересылки для набора запросов.  

Для реализации конфигурации Split-brain DNS можно использовать политики рекурсии. В этой конфигурации DNS-сервер выполняет рекурсию для набора клиентов для запроса, хотя DNS-сервер не выполняет рекурсию для других клиентов для этого запроса.  

Политики рекурсии содержит те же элементы, содержащиеся в регулярных политика разрешения запросов DNS, наряду с элементами в таблице ниже:  

|Имя|Описание|  
|--------|---------------|  
|**Применить на рекурсии**|Указывает, что этот параметр следует использовать только для рекурсии.|  
|**Область рекурсии**|Имя области рекурсии.|  

> [!NOTE]  
> Политики рекурсии могут создаваться только на уровне сервера.  

### <a name="zone-transfer-policies"></a>Политики передачи зоны  
Политики передачи зоны управления запрет на передачу зоны или нет, DNS-сервера. Можно создать политики для передачи зоны на уровне сервера или уровне зоны. Политики уровня сервера применяются на каждый запрос передачи зоны, происходит на DNS-сервере. Политики на уровне зоны применяются только в запросах в зоне, размещенной на DNS-сервере. Чаще всего для политики на уровне зоны используется для реализации списков заблокированных или надежных.  

> [!NOTE]  
> Политики передачи зоны можно использовать только запретить или ИГНОРИРОВАТЬ как действия.  

Чтобы запретить передачу зоны для домена contoso.com из определенной подсети, можно использовать уровня зоны передачи политику сервера ниже:  

```  
Add-DnsServerZoneTransferPolicy -Name DenyTransferOfContosoToFabrikam -Zone contoso.com -Action DENY -ClientSubnet "EQ,192.168.1.0/24"  
```  

Можно создать несколько передачу зоны политики того же уровня, до тех пор, пока они имеют другое значение для порядка обработки. Если доступны несколько политик, DNS-сервер обрабатывает входящие запросы следующим образом:  

![Процесс несколько политик передачи зоны DNS](../../media/DNS-Policies-Overview/DNSPolicyZone.png)  

## <a name="managing-dns-policies"></a>Управление политиками DNS  
Можно создать и управлять политиками DNS с помощью PowerShell. В приведенных ниже примерах проходить через различные примеры сценариев, которые можно настроить с помощью политик DNS:  

### <a name="traffic-management"></a>Управление трафиком  
Можно направлять трафик, в зависимости от полного доменного ИМЕНИ на разных серверах, в зависимости от расположения клиента DNS. В приведенном ниже примере показано, как создать политики управления, чтобы заставить клиентов из подсети в Северной Америке центр обработки данных и другую подсеть в европейских центр обработки данных трафик.  

```  
Add-DnsServerClientSubnet -Name "NorthAmericaSubnet" -IPv4Subnet "172.21.33.0/24"  
Add-DnsServerClientSubnet -Name "EuropeSubnet" -IPv4Subnet "172.17.44.0/24"  
Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "NorthAmericaZoneScope"  
Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "EuropeZoneScope"  
Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.17.97.97" -ZoneScope "EuropeZoneScope"  
Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.21.21.21" -ZoneScope "NorthAmericaZoneScope"  
Add-DnsServerQueryResolutionPolicy -Name "NorthAmericaPolicy" -Action ALLOW -ClientSubnet "eq,NorthAmericaSubnet" -ZoneScope "NorthAmericaZoneScope,1" -ZoneName "Contoso.com"  
Add-DnsServerQueryResolutionPolicy -Name "EuropePolicy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "EuropeZoneScope,1" -ZoneName contoso.com  
```  

Первые две строки скрипта создания клиентских объектов подсети для Северной Америки и Европы. Две строки, после этого создайте область зоны, интегрированной в домене contoso.com, один для каждого региона. Две строки, после этого создайте запись в каждой зоне, которая связывает ww.contoso.com другой IP-адрес, один для Европы, еще один — для Северной Америки. И, наконец последние строки скрипта создайте две политики разрешения запросов DNS, одной для применения к подсети Северной Америки, другой в Европе подсети.  

### <a name="block-queries-for-a-domain"></a>Блокировать запросы для домена  
Можно использовать политику разрешения запроса DNS, чтобы блокировать запросы к домену. В приведенном ниже примере блокирует все запросы к treyresearch.net:  

```  
Add-DnsServerQueryResolutionPolicy -Name "BlackholePolicy" -Action IGNORE -FQDN "EQ,*.treyresearch.com"  
```  

### <a name="block-queries-from-a-subnet"></a>Блокировать запросы из подсети  
Кроме того, вы можете заблокировать запросов, поступающих из определенной подсети. Приведенный ниже сценарий создает подсеть для 172.0.33.0/24, а затем создает политику, чтобы игнорировать все запросы, поступающие из этой подсети:  

```  
Add-DnsServerClientSubnet -Name "MaliciousSubnet06" -IPv4Subnet 172.0.33.0/24  
Add-DnsServerQueryResolutionPolicy -Name "BlackholePolicyMalicious06" -Action IGNORE -ClientSubnet  "EQ,MaliciousSubnet06"  
```  

### <a name="allow-recursion-for-internal-clients"></a>Разрешить рекурсии для внутренних клиентов  
Рекурсия можно управлять с помощью политики разрешения запросов DNS. В следующем примере позволяют включить рекурсию для внутренних клиентов при отключении его для внешних клиентов в случае разделения вычислительных мощностей.  

```  
Set-DnsServerRecursionScope -Name . -EnableRecursion $False   
Add-DnsServerRecursionScope -Name "InternalClients" -EnableRecursion $True  
Add-DnsServerQueryResolutionPolicy -Name "SplitBrainPolicy" -Action ALLOW -ApplyOnRecursion -RecursionScope "InternalClients" -ServerInterfaceIP  "EQ,10.0.0.34"  
```  

В первой строке скрипт изменяет рекурсии область по умолчанию, просто называется «.» (точка), чтобы отключить рекурсию. Во второй строке создается рекурсии область с именем *InternalClients* с включена рекурсия. И третья строка создает политику для применения вновь создайте область рекурсии для любых запросов, поступающих интерфейс сервера, который имеет 10.0.0.34 IP-адрес.  

### <a name="create-a-server-level-zone-transfer-policy"></a>Создать политику передачи зоны на уровне сервера  
Передача зоны в виде более детализированные можно управлять с помощью политик передачи зоны DNS. Пример сценария ниже можно использовать для передачи зоны для любого сервера в данной подсети:  

```  
Add-DnsServerClientSubnet -Name "AllowedSubnet" -IPv4Subnet 172.21.33.0/24  
Add-DnsServerZoneTransferPolicy -Name "NorthAmericaPolicy" -Action IGNORE -ClientSubnet "ne,AllowedSubnet"  
```  

В первой строке в скрипте создается объект подсети с именем *AllowedSubnet* с IP-адресом блокировать 172.21.33.0/24. Вторая строка создает политики передачи зоны, чтобы разрешить передачу зоны на любой DNS-сервер на подсети, созданной ранее.  

### <a name="create-a-zone-level-zone-transfer-policy"></a>Создать политику уровня зоны передачи зоны  
Кроме того, можно также создать политики передачи зоны на уровне зоны. В приведенном ниже примере игнорирует любой запрос на передачу зоны для contoso.com, поступающие из интерфейса сервера, с IP-адресом 10.0.0.33:  

```  
Add-DnsServerZoneTransferPolicy -Name "InternalTransfers" -Action IGNORE -ServerInterfaceIP "ne,10.0.0.33" -PassThru -ZoneName "contoso.com"  
```  

## <a name="dns-policy-scenarios"></a>Вариантов использования политик DNS

Сведения о том, как с помощью политики DNS для конкретных сценариев см. в следующих подразделах в этом руководстве.

- [Используйте DNS географического расположения на основе политики управления трафиком с серверов-источников](primary-geo-location.md)  
- [Для управления трафиком с помощью основных и вспомогательных серверах, на основе географического расположения с помощью политики DNS](primary-secondary-geo-location.md)  
- [Использование политики DNS для интеллектуальных ответов DNS на основе времени дня](dns-tod-intelligent.md)
- [Ответы DNS, на основе времени дня с помощью Azure сервера облачных приложений](dns-tod-azure-cloud-app-server.md)
- [Развертывание разделенной системы DNS с помощью политики DNS](split-brain-DNS-deployment.md)
- [Разделенная система DNS в Active Directory с помощью политики DNS](dns-sb-with-ad.md)
- [Использование политики DNS для применения фильтров к запросам DNS](apply-filters-on-dns-queries.md)
- [Использование политики DNS для балансировки нагрузки приложений](app-lb.md)
- [Использование политики DNS для балансировки с учетом географического расположения нагрузки приложений](app-lb-geo.md)

## <a name="using-dns-policy-on-read-only-domain-controllers"></a>С помощью политики DNS на контроллерах домена только для чтения

Политики DNS совместим с контроллерами домена только для чтения. Обратите внимание, что перезапуск службы DNS-сервер является обязательным наличие новых политик DNS, необходимо загрузить на контроллерах домена только для чтения. Это не является обязательным на контроллерах домена с возможностью записи.
