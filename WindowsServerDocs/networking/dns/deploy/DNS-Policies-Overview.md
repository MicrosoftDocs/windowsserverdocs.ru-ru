---
title: Обзор политик DNS
description: Этот раздел является частью DNS политики сценарий руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: 566bc270-81c7-48c3-a904-3cba942ad463
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 06086bbd7edc2fa489805eb5075062332e002ab4
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="dns-policies-overview"></a>Обзор политик DNS

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать для изучения политики DNS, которое является новым в Windows Server 2016. Политики DNS можно использовать для управления трафиком на основе географического расположения, интеллектуальных ответов DNS на основе времени дня, для управления один DNS-сервер настроен для развертывания вычислительных мощностей split\ применение фильтров на запросы DNS и многое другое. Следующие элементы содержат более подробные сведения об этих возможностях.

-   **Балансировки нагрузки приложений.** При развертывании нескольких экземпляров одного приложения в разных местах можно использовать политики DNS для балансировки нагрузки трафика между экземплярами другого приложения, динамическое распределение нагрузки трафика для приложения.

-   **Расположение Geo\ на основе трафика управления.** Чтобы разрешить основного и дополнительного DNS-серверов, отвечать на запросы DNS-клиента на основе географического расположения для клиента и ресурсов, к которой клиент пытается подключиться, предоставление ближайший ресурс IP-адрес клиента, можно использовать политики DNS. 

-   **Разделите систему DNS.** С помощью DNS вычислительных мощностей split\ DNS-записи разбиты на разных областей зоны на том же сервере DNS, и DNS-клиенты получают ответ, в зависимости от того, являются ли клиенты внутренних или внешних клиентов. На автономных серверах DNS можно настроить вычислительных мощностей split\ DNS для зон, интегрированных в Active Directory или для зон.

-   **Фильтрация.** Можно настроить политики DNS для создания фильтрах запросов, которые основываются на критериях, предоставленных вами. Фильтры запроса в политике DNS позволяют настроить DNS-сервер для ответа особым образом на основе запроса DNS и DNS-клиента, который отправляет запросы DNS. 
-   **Расследований.** Можно использовать политики DNS для перенаправления вредоносных DNS-клиентов на несуществующие отличных IP-адрес вместо направив их компьютера, к которому они пытаются получить доступ.

-   **Время дня, на основе перенаправления.** Можно использовать политику DNS для распределения трафика приложения по географически различных экземпляров приложения с помощью политики DNS, которые основаны на время дня.

## <a name="new-concepts"></a>Новые основные понятия  
Чтобы создавать политики для поддержки сценариев, приведенные выше, необходимо иметь возможность установить личность групп записей в зоне, группы клиентов в сети, среди других элементов. Эти элементы представлены следующие новые объекты DNS-сервера:  

- **Подсеть клиента:** представляет клиентского объекта подсети IPv4 или IPv6 подсети, из которой запросы отправляются на DNS-сервер. Можно создать подсети для определения политик на основе подсети, какие запросы приходят из более поздних версий. Так, в сценарий DNS разделения вычислительных мощностей, запрос на разрешение имен для имени, таких как *www.microsoft.com* можно ответить на внутренний IP-адрес для клиентов с внутренним подсетям и другой IP-адрес для клиентов в подсети с внешним.

- **Область рекурсии:** рекурсии области являются уникальный экземпляров группы параметров, контролирующие рекурсию на DNS-сервере. Область рекурсии содержит список серверов пересылки и указывает, включен ли рекурсию. DNS-сервер может иметь много областей рекурсию. Политики рекурсии сервера DNS позволяют выбрать рекурсии область для нескольких запросов. Если DNS-сервер не является полномочным для определенных запросы политик рекурсии сервера DNS позволяют управлять способы устранения этих запросов. Можно указать, какие серверы пересылки, и следует ли использовать рекурсию.

- **Зоны областей:** зона DNS может иметь несколько областей зоны, с каждой областью зону, содержащую свой собственный набор DNS-записей. Ту же запись может быть представлен в нескольких областях различные IP-адреса. Кроме того передач зон, выполняются на уровне области зоны. Это означает, что записи из области зоны в основной зоне будут перенесены на той же области зоны, в дополнительную зону.

## <a name="types-of-policy"></a>Типы политики

Политики DNS деления на уровень и тип. Можно использовать политики разрешение запроса для определения того, как обрабатываются запросы и политики передачи зоны, для определения того, как возникает передачи зоны. Вы можете применить к каждому типу политик на уровне сервера или зоны.
  
### <a name="query-resolution-policies"></a>Политики для разрешения запросов

Политики разрешения запросов DNS-сервера можно использовать для указания входящих разрешения, обрабатываются запросы DNS-сервером. Каждая политика разрешения запросов DNS содержатся следующие элементы.  
  
|Поле|Описание|Возможные значения|  
|---------|---------------|-------------------|  
|**Имя**|Имя политики|— До 256 символов.<br />-Может содержать любой знак допустимое имя файла|  
|**Состояние**|Состояние политики|-Включить (по умолчанию)<br />-Отключено|  
|**Уровень**|Уровень политики|-Сервера<br />-Зоны|  
|**Порядок обработки**|После запроса классифицируются по уровню и применяет, сервер находит первой политики, для которого запрос, соответствующего критериям и применяет ее для запроса|-Числовое значение<br />-Уникальные значения для каждой политики, содержащий ту же уровня и применяет значение|  
|**Действие**|Действия должны быть выполнены DNS-сервера|-Позволить (по умолчанию для зоны уровень)<br />-Запретить (по умолчанию на уровне сервера)<br />-Игнорировать|  
|**Условия**|Условия политики (и) и список процессов, которые должны быть выполнены для политики для применения|-Оператор условие (и)<br />-Список критериев (см. ниже в таблице процессов)|  
|**Область**|Список области зоны и Взвешенное значений каждой области. Средневзвешенное значения используются для распространения балансировки нагрузки. Например, если этот список включает datacenter1 с весом 3 и datacenter2 с весовым коэффициентом 5 сервер будет отвечать с помощью записи от datacentre1 три раза вне 8 запросов|-List зоны областей (по имени) и веса|  

> [!NOTE]
> Политики на уровне сервера может принимать только значения **запретить** или **игнорировать** как действие.

Поле условия политики DNS-сервера состоит из двух элементов.

|Имя|Описание|Примеры значений|
|--------|---------------|-----------------|
|**Подсеть клиента**|Транспорта протокол, используемый в запросе. Возможные операции **UDP** и **TCP**|-   **Франция EQ, Испания,** -возвращает значение true, если подсеть определяется как Испания или Франции<br />-   **NE, Канада, Мексика** -возвращает значение true, если подсеть клиента является все подсети, отличные от Канада, Мексика|  
|**Протокол транспорта**|Транспорта протокол, используемый в запросе. Возможные операции **UDP** и **TCP**|-   **EQ TCP**<br />-   **EQ UDP**|  
|**Протокол Интернета**|Сетевой протокол, используемый в запросе. Возможные операции **IPv4** и **IPv6**|-   **EQ IPv4**<br />-   **EQ IPv6**|  
|**Интерфейс IP-адрес сервера**|IP-адрес входящего сетевого интерфейса DNS server|-   **EQ 10.0.0.1**<br />-   **EQ 192.168.1.1**|  
|**ПОЛНОЕ ДОМЕННОЕ ИМЯ**|Полное доменное имя записи в запросе, с возможность использования подстановочный знак|-   **EQ www.contoso.com** -разрешает по rue только если запрос пытается сопоставить *www.contoso.com* полное доменное имя<br />-   **EQ,\*.contoso.com,\*.woodgrove.com** -возвращает значение true, если запрос — для каждой записи, заканчивающиеся *contoso.com***или***woodgrove.com*|  
|**Тип запроса**|Тип записи запрашиваемый (A, Серверэкземпляр, TXT)|-   **SRV EQ TXT,** -разрешает по rue, если запрос запрашивает TXT **или** SRV-записи<br />-   **EQ, MX** -разрешает по rue, если запрос запрашивает MX-запись|  
|**Время дня**|Время дня, которые получили запроса|-   **EQ 10:00-12:00, 22:00-23:00** -разрешает по rue при получении запроса от 10 по и с **или** между 10 PM и 23: 00|  
  
В таблице выше как отправную точку, в таблице ниже может можно использовать для определения условие, которое используется для сопоставления запросы для любого типа, но записей SRV в домене contoso.com, поступающие от клиентов в подсети 10.0.0.0/24 через TCP 8-10 PM через интерфейс 10.0.0.3:  
  
|Имя|Значение|  
|--------|---------|  
|Подсеть клиента|EQ 10.0.0.0/24|  
|Протокол транспорта|EQ TCP|  
|Интерфейс IP-адрес сервера|EQ 10.0.0.3|  
|ПОЛНОЕ ДОМЕННОЕ ИМЯ|EQ *. contoso.com|  
|Тип запроса|NE SRV|  
|Время дня|EQ 20:00-22:00|  
  
Можно создать несколько запрос разрешения политик одного уровня, пока они имеют другое значение для изменения порядка обработки. Если доступно несколько политик, DNS-сервер обрабатывает входящие запросы следующим образом:  
  
![Обработка политики DNS](../../media/DNS-Policies-Overview/DNSQueryResolutionPolicyFlowchart.png)  
  
### <a name="recursion-policies"></a>Политики рекурсия  
Политики рекурсии — это специальный **тип** политик на уровне сервера. Политики рекурсии управлять тем, как DNS-сервер выполняет рекурсию для запроса. Политики, рекурсии применяются только в том случае, когда при обработке запроса достигает путь рекурсию. Можно выбрать значение DENY или ИГНОРИРОВАТЬ рекурсии для набора запросов. Кроме того можно выбрать набор серверов пересылки для набора запросов.  
  
Политики рекурсии можно использовать для реализации Split-brain конфигурации DNS. В этой конфигурации DNS-сервер выполняет рекурсию для набора клиентов для запроса, хотя DNS-сервер не выполняет рекурсию для других клиентов для данного запроса.  
  
Политики рекурсии содержит те же элементы, которые содержит регулярных политика разрешения запросов DNS, а также элементы, описанные в следующей таблице:  
  
|Имя|Описание|  
|--------|---------------|  
|**Применить на рекурсия**|Указывает, что этот параметр должен использоваться только для рекурсии.|  
|**Область рекурсия**|Имя области рекурсию.|  
  
> [!NOTE]  
> Политики рекурсии можно создавать только на уровне сервера.  
  
### <a name="zone-transfer-policies"></a>Политики передачи зоны  
Политики передачи зоны управляют разрешение или запрет на передачу зоны или не с помощью DNS-сервера. Можно создавать политики для передачи зоны на уровне сервера или уровень зоны. Применить политики уровня сервера на каждый запрос передачи зоны, происходит на DNS-сервере. Политики на уровне зоны применяются только на запросы от зоны, размещенные на DNS-сервере. Политики на уровне зоны в наиболее распространенные используется для реализации списков заблокированных или сейф.  
  
> [!NOTE]  
> Политики передачи зоны можно использовать только DENY или ИГНОРИРОВАТЬ как действия.  
  
Чтобы запретить передачу зоны для домена contoso.com данной подсети можно использовать передачи зоны на уровне сервера политики ниже:  
  
```  
Add-DnsServerZoneTransferPolicy -Name DenyTransferOfCOnsotostoFabrikam -Zone contoso.com -Action DENY -ClientSubnet "EQ,192.168.1.0/24"  
```  
  
Можно создать несколько передачу зоны политики одного уровня, пока они имеют другое значение для изменения порядка обработки. Если доступно несколько политик, DNS-сервер обрабатывает входящие запросы следующим образом:  
  
![Процесс несколько политик передачи зоны DNS](../../media/DNS-Policies-Overview/DNSPolicyZone.png)  
  
## <a name="managing-dns-policies"></a>Управление политиками DNS  
Можно создать и управление политиками DNS с помощью PowerShell. В приведенных ниже примерах пройти различные возможные сценарии, которые можно настраивать с помощью политики DNS:  
  
### <a name="traffic-management"></a>Управление трафиком  
Можно направить трафика в зависимости от полного доменного ИМЕНИ на разных серверах, в зависимости от расположения клиента DNS. В примере ниже показано, как создавать трафика управления политики для перенаправления клиентов из подсети в Северной Америке центр обработки данных и другой подсети, в европейской центр обработки данных.  
  
```  
Add-DnsServerClientSubnet -Name "NorthAmericaSubnet" -IPv4Subnet "172.21.33.0/24"  
Add-DnsServerClientSubnet -Name "EuropeSubnet" -IPv4Subnet "172.17.44.0/24"  
Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "NorthAmericaZoneScope"  
Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "EuropeZoneScope"  
Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.17.97.97" -ZoneScope "EuropeZoneScope"  
Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.21.21.21" -ZoneScope "NorthAmericaZoneScope"  
Add-DnsServerQueryResolutionPolicy -Name "NorthAmericaPolicy" -Action ALLOW -ClientSubnet "eq,NorthAmericaSubnet" -ZoneScope "NorthAmericaZoneScope,1" -ZoneName "Contoso.com"  
Add-DnsServerQueryResolutionPolicy -Name "EuropePolicy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "EuropeZoneScope,1" -ZoneName contoso.com  
```  
  
Первые две строки сценария клиента создаются объекты подсети для Северной Америки и Европы. Две строки после этого создать область зоны в домене contoso.com, и один для каждого региона. Две строки после этого создать запись в каждой зоне, который связывает ww.contoso.com другой IP-адрес, один для Европы, еще один для Северной Америки. Наконец последней строки сценария создать две политики разрешения запросов DNS, один для применения к другой подсети Europe подсети Северной Америки.  
  
### <a name="block-queries-for-a-domain"></a>Блокировать запросы для домена  
Можно использовать политику разрешения запросов DNS, блокировать запросы к домену. В примере ниже блокирует все запросы к treyresearch.net:  
  
```  
Add-DnsServerQueryResolutionPolicy -Name "BlackholePolicy" -Action IGNORE -FQDN "EQ,*.treyresearch.com"  
```  
  
### <a name="block-queries-from-a-subnet"></a>Блокировать запросы из подсети  
Можно также блокировать запросы, поступающие от конкретной подсети. Следующий сценарий создает подсети 172.0.33.0/24, а затем создает политики, чтобы игнорировать все запросы, поступающие от этой подсети:  
  
```  
Add-DnsServerClientSubnet -Name "MaliciousSubnet06" -IPv4Subnet 172.0.33.0/24  
Add-DnsServerQueryResolutionPolicy -Name "BlackholePolicyMalicious06" -Action IGNORE -ClientSubnet  "EQ,MaliciousSubnet06"  
```  
  
### <a name="allow-recursion-for-internal-clients"></a>Разрешить рекурсию для внутренних клиентов  
Рекурсию можно управлять с помощью политики разрешения запросов DNS. Следующий пример позволяет включать рекурсию для внутренних клиентов во время отключения его для внешних клиентов в случае разделения вычислительных мощностей.  
  
```  
Set-DnsServerRecursionScope -Name . -EnableRecursion $False   
Add-DnsServerRecursionScope -Name "InternalClients" -EnableRecursion $True  
Add-DnsServerQueryResolutionPolicy -Name "SplitBrainPolicy" -Action ALLOW -ApplyOnRecursion -RecursionScope "InternalClients" -ServerInterfaceIP  "EQ,10.0.0.34"  
```  
  
Первая строка в сценарии изменения области рекурсии по умолчанию, просто с именем «.» (точка), чтобы отключить рекурсию. Вторая строка создает рекурсии область с именем *InternalClients* с рекурсия включена. И третья строка создается политика для применения вновь создать область рекурсию на любые запросы через интерфейс сервера, который имеет 10.0.0.34 IP-адрес.  
  
### <a name="create-a-server-level-zone-transfer-policy"></a>Создание политики передачи уровня зоны сервера  
Передача зоны в виде более детального можно управлять с помощью политик передачи зоны DNS. Чтобы разрешить передачу зоны для любого сервера в данной подсети можно использовать сценарий:  
  
```  
Add-DnsServerClientSubnet -Name "AllowedSubnet" -IPv4Subnet 172.21.33.0/24  
Add-DnsServerZoneTransferPolicy -Name "NorthAmericaPolicy" -Action IGNORE -ClientSubnet "ne,AllowedSubnet"  
```  
  
В первой строке в сценарии создается объект подсети с именем *AllowedSubnet* 172.21.33.0/24 блокировать IP-адресов. Вторая строка создает политику передачи зоны, чтобы разрешить передачу зоны на все DNS-сервера в подсети, которые создали ранее.  
  
### <a name="create-a-zone-level-zone-transfer-policy"></a>Создание политики уровня зоны передачи зоны  
Кроме того, можно создать политики передачи зоны уровня зоны. В этом примере игнорируются все запросы для передачи зоны для contoso.com поступает из интерфейса сервера, который имеет IP-адрес 10.0.0.33:  
  
```  
Add-DnsServerZoneTransferPolicy -Name "InternalTransfers" -Action IGNORE -ServerInterfaceIP "ne,10.0.0.33" -PassThru -ZoneName "contoso.com"  
```  
  
## <a name="dns-policy-scenarios"></a>Сценарии политик DNS

Сведения о том, как с помощью политики DNS для конкретных сценариев см. в следующих разделах в данном руководстве.

- [Используйте DNS географического расположения на основе политики управления трафика с серверов-источников](primary-geo-location.md)  
- [Для управления трафиком с основных и вспомогательных серверах на основе географического расположения с помощью политики DNS](primary-secondary-geo-location.md)  
- [Получение интеллектуальных ответов DNS на основе времени дня с помощью политики DNS](dns-tod-intelligent.md)
- [Ответов DNS на основе времени дня с Azure сервера облачных приложений](dns-tod-azure-cloud-app-server.md)
- [Использование политики DNS для Split-Brain развертывание DNS](split-brain-DNS-deployment.md)
- [Использование политики DNS для Split-Brain DNS-сервер в Active Directory](dns-sb-with-ad.md)
- [Использование политики DNS для применения фильтров к запросам DNS](apply-filters-on-dns-queries.md)
- [Использование политики DNS для балансировки нагрузки приложений](app-lb.md)
- [Использование политики DNS для балансировки нагрузки приложений с географического местоположения](app-lb-geo.md)


