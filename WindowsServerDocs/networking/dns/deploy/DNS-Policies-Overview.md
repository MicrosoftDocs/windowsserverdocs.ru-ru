---
title: Обзор политик DNS
description: Этот раздел является частью руководств по сценариям политики DNS для Windows Server 2016.
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: 566bc270-81c7-48c3-a904-3cba942ad463
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 687864619c981b3ab8d24ef540c759bc29314c90
ms.sourcegitcommit: 6f968368c12b9dd699c197afb3a3d13c2211f85b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68544669"
---
# <a name="dns-policies-overview"></a>Обзор политик DNS

>Относится к: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете о политике DNS, которая является новой в Windows Server 2016. Вы можете использовать политику DNS для управления трафиком на основе географического расположения, интеллектуальные ответы DNS в зависимости от времени суток, для управления одним DNS-сервером,\-настроенным для раздельного развертывания, применения фильтров к запросам DNS и многого другого. Следующие элементы содержат более подробные сведения об этих возможностях.

-   **Балансировка нагрузки приложений.** При развертывании нескольких экземпляров приложения в разных местах можно использовать политику DNS для балансировки нагрузки трафика между разными экземплярами приложения, динамически выделяя нагрузку на трафик для приложения.

-   **Управление\-трафиком на основе географического расположения.** С помощью политики DNS можно разрешить основным и дополнительным DNS-серверам отвечать на запросы клиентов DNS на основе географического расположения клиента и ресурса, к которому пытается подключиться клиент, предоставляя клиенту IP-адрес ближайшей ресурсов. 

-   **Разделение мозгового DNS-сервера.** При разделенном\-мозге DNS записи DNS разбиваются на разные области зоны на одном DNS-сервере, а DNS-клиенты получают ответ в зависимости от того, являются ли клиенты внутренними или внешними клиентами. Вы можете настроить раздельный\-мозг DNS для Active Directory интегрированных зон или для зон на автономных DNS-серверах.

-   **Записей.** Вы можете настроить политику DNS для создания фильтров запросов на основе заданных вами условий. Фильтры запросов в политике DNS позволяют настроить DNS-сервер на отправку пользовательского способа на основе DNS-запроса и DNS-клиента, отправляющего запрос DNS. 
-   **Экспертизы.** С помощью политики DNS можно перенаправить вредоносные DNS-клиенты\-на несуществующий, а не направить их на компьютер, к которому они пытаются связаться.

-   **Перенаправление на основе времени суток.** Политику DNS можно использовать для распределения трафика приложений между различными географически распределенными экземплярами приложения с помощью политик DNS, основанных на времени суток.

## <a name="new-concepts"></a>Новые концепции  
Чтобы создать политики для поддержки описанных выше сценариев, необходимо иметь возможность определять группы записей в зоне, группы клиентов в сети, помимо других элементов. Эти элементы представлены следующими новыми объектами DNS:  

- **Подсеть клиента:** объект подсети клиента представляет подсеть IPv4 или IPv6, с которой отправляются запросы на DNS-сервер. Можно создать подсети, чтобы в дальнейшем определить политики, которые будут применяться, в зависимости от подсети, из которой исходят запросы. Например, в случае разделенного мозгового запроса DNS запрос разрешения имени, например <em>www.Microsoft.com</em> , можно получить с помощью внутреннего IP-адреса для клиентов из внутренних подсетей, а также другой IP-адрес для клиентов во внешних подсетях.

- **Область рекурсии.** области рекурсии — это уникальные экземпляры группы параметров, управляющих рекурсией на DNS-сервере. Область рекурсии содержит список серверов пересылки и указывает, включена ли рекурсия. DNS-сервер может иметь много областей рекурсии. Политики рекурсии DNS-сервера позволяют выбрать область рекурсии для набора запросов. Если DNS-сервер не является полномочным для определенных запросов, политики рекурсии DNS-сервера позволяют управлять способом разрешения этих запросов. Можно указать, какие серверы пересылки следует использовать, а также использовать ли рекурсию.

- **Области зоны.** зона DNS может иметь несколько областей зоны, при этом каждая область зоны содержит собственный набор записей DNS. Одна и та же запись может присутствовать в нескольких областях с разными IP-адресами. Кроме того, зонные передачи выполняются на уровне области зоны. Это означает, что записи из области зоны в основной зоне будут передаваться в ту же область зоны в дополнительной зоне.

## <a name="types-of-policy"></a>Типы политик

Политики DNS делятся на уровни и типы. Политики разрешения запросов можно использовать для определения способа обработки запросов, а политики передачи зоны — для определения способа передачи зон. Каждый тип политики можно применять на уровне сервера или на уровне зоны.

### <a name="query-resolution-policies"></a>Политики разрешения запросов

Политики разрешения запросов DNS можно использовать для указания способа обработки входящих запросов разрешения DNS-сервером. Каждая политика разрешения запросов DNS содержит следующие элементы.  

|Поле|Описание|Возможные значения|  
|---------|---------------|-------------------|  
|**Name**|Имя политики|— До 256 символов<br />— Может содержать любой символ, допустимый для имени файла|  
|**Состояние**|Состояние политики|-Enable (по умолчанию)<br />— Отключено|  
|**Уровню**|Уровень политики|Сервер<br />-Zone|  
|**Порядок обработки**|Когда запрос классифицируется по уровню и применяется к, сервер находит первую политику, для которой запрос соответствует критерию, и применяет его к запросу.|— Числовое значение<br />— Уникальное значение на политику, содержащее один и тот же уровень и применяемое к значению|  
|**Действие**|Действие, выполняемое DNS-сервером|-Allow (по умолчанию для уровня зоны)<br />-Deny (по умолчанию на уровне сервера)<br />-Ignore|  
|**Критерии**|Условие политики (и/или) и список критериев, которые должны быть выполнены для применения политики|-Оператор условия (и/или)<br />— Список критериев (см. таблицу критериев ниже).|  
|**Область**|Список областей зоны и взвешенных значений для области. Взвешенные значения используются для распределения балансировки нагрузки. Например, если в этом списке есть datacenter1 с весом 3 и datacenter2 с весом 5, сервер будет отвечать на запись из datacentre1 три раза из восьми запросов.|— Список областей зоны (по имени) и весов|  

> [!NOTE]
> Политики уровня сервера могут иметь только значения **Deny** или **Ignore** в качестве действия.

Поле критериев политики DNS состоит из двух элементов:


|              Имя               |                                         Описание                                          |                                                                                                                               Примеры значений                                                                                                                               |
|---------------------------------|----------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|        **Подсеть клиента**        | Имя предопределенной клиентской подсети. Используется для проверки подсети, из которой был отправлен запрос. |                             -   **EQ, Испания, Франция** — разрешается в true, если подсеть определена как Испания или Франция.<br />-   **Ne, Канада, Мексика** — разрешается в true, если подсеть клиента является любой подсетью, отличной от Канады и Мексики.                             |
|     **Транспортный протокол**      |        Транспортный протокол, используемый в запросе. Возможные значения — **UDP** и **TCP** .        |                                                                                                                    -   **EQ, TCP**<br />-   **EQ, UDP**                                                                                                                     |
|      **Протокол Интернета**      |        Сетевой протокол, используемый в запросе. Возможные записи — **IPv4** и **IPv6** .        |                                                                                                                   -   **EQ, IPv4**<br />-   **EQ, IPv6**                                                                                                                    |
| **IP-адрес интерфейса сервера** |                   IP-адрес входящего сетевого интерфейса DNS-сервера                   |                                                                                                              -   **EQ, 10.0.0.1**<br />-   **EQ, 192.168.1.1**                                                                                                              |
|            **ПОЛН**             |            Полное доменное имя записи в запросе с возможностью использования подстановочного знака            | -   **EQ, www. contoso. com** — разрешается в true только в случае, если запрос пытается разрешить полное доменное имя <em>www.contoso.com</em> .<br />-   **EQ,\*. contoso.com,\*. Woodgrove.com** — разрешается в true, если запрос предназначен для записи, завершающейся в *contoso.com***или***Woodgrove.com* |
|         **Тип запроса**          |                          Тип запрашиваемой записи (A, SRV, TXT)                          |                                                  -   **EQ, txt, SRV** — разрешается в значение true, если запрос запрашивает запись типа TXT **или** SRV.<br />-   **EQ, MX** — разрешает значение true, если запрос запрашивает MX-запись                                                   |
|         **Время суток**         |                              Время суток, когда получен запрос                               |                                                                    -   **EQ, 10:00 – 12:00, 22:00-23:00** — разрешается в true, если запрос получен в диапазоне от 10 до полудня **или** между 10PM и 11 вечера                                                                    |

Используя приведенную выше таблицу, можно определить критерий, который будет использоваться для сопоставления запросов для записей любого типа, но записи SRV в домене contoso.com, поступающие от клиента в подсети 10.0.0.0/24 через TCP между 8 и 10 по нтерфаце 10.0.0.3:  

|Имя|Значение|  
|--------|---------|  
|Подсеть клиента|EQ, 10.0.0.0/24|  
|Транспортный протокол|EQ, TCP|  
|IP-адрес интерфейса сервера|EQ, 10.0.0.3|  
|FQDN|EQ, *. contoso. com|  
|Тип запроса|NE, SRV|  
|Время суток|EQ, 20:00-22:00|  

Можно создать несколько политик разрешения запросов на одном уровне, если они имеют разное значение для порядка обработки. Если доступно несколько политик, DNS-сервер обрабатывает входящие запросы следующим образом:  

![Обработка политики DNS](../../media/DNS-Policies-Overview/DNSQueryResolutionPolicyFlowchart.png)  

### <a name="recursion-policies"></a>Политики рекурсии  
Политики рекурсии — это особые **типы** политик уровня сервера. Политики рекурсии определяют, как DNS-сервер выполняет рекурсию для запроса. Политики рекурсии применяются только в том случае, если обработка запросов достигает пути рекурсии. Для набора запросов можно выбрать значение DENY или IGNORE для рекурсии. Кроме того, можно выбрать набор серверов пересылки для набора запросов.  

Политики рекурсии можно использовать для реализации конфигурации DNS с разделением. В этой конфигурации DNS-сервер выполняет рекурсию для набора клиентов для запроса, а DNS-сервер не выполняет рекурсию для других клиентов этого запроса.  

Политики рекурсии содержат те же элементы, которые содержит обычная политика разрешения запросов DNS, а также элементы в таблице ниже.  

|Имя|Описание|  
|--------|---------------|  
|**Применить к рекурсии**|Указывает, что эту политику следует использовать только для рекурсии.|  
|**Область рекурсии**|Имя области рекурсии.|  

> [!NOTE]  
> Политики рекурсии могут создаваться только на уровне сервера.  

### <a name="zone-transfer-policies"></a>Политики зонных передач  
Политики зонных передач управляют тем, разрешена ли зонная отправка на ваш DNS-сервер. Вы можете создавать политики для зонных передач на уровне сервера или на уровне зоны. Политики уровня сервера применяются ко всем запросам на зонную пересылку, происходящим на DNS-сервере. Политики уровня зоны применяются только к запросам в зоне, размещенной на DNS-сервере. Наиболее распространенным применением политик уровня зоны является реализация заблокированных или безнадежных списков.  

> [!NOTE]  
> Политики зонных передач могут использовать только действия DENY или IGNORE в качестве действий.  

Вы можете использовать политику зонных передач зон на уровне сервера, чтобы запретить зонную пересылку для домена contoso.com из данной подсети.  

```  
Add-DnsServerZoneTransferPolicy -Name DenyTransferOfContosoToFabrikam -Zone contoso.com -Action DENY -ClientSubnet "EQ,192.168.1.0/24"  
```  

Можно создать несколько политик зонных передач одного уровня, если они имеют разное значение для порядка обработки. Если доступно несколько политик, DNS-сервер обрабатывает входящие запросы следующим образом:  

![Процесс DNS для нескольких политик зонных передач](../../media/DNS-Policies-Overview/DNSPolicyZone.png)  

## <a name="managing-dns-policies"></a>Управление политиками DNS  
Вы можете создавать политики DNS и управлять ими с помощью PowerShell. В приведенных ниже примерах рассматриваются различные примеры сценариев, которые можно настроить с помощью политик DNS.  

### <a name="traffic-management"></a>Управление трафиком  
Трафик, основанный на полном доменном имени, можно направить на разные серверы в зависимости от расположения DNS-клиента. В приведенном ниже примере показано, как создать политики управления трафиком для направления клиентов из определенной подсети в центр обработки данных для Северной Америки и из другой подсети в Европейский центр обработки данных.  

```  
Add-DnsServerClientSubnet -Name "NorthAmericaSubnet" -IPv4Subnet "172.21.33.0/24"  
Add-DnsServerClientSubnet -Name "EuropeSubnet" -IPv4Subnet "172.17.44.0/24"  
Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "NorthAmericaZoneScope"  
Add-DnsServerZoneScope -ZoneName "Contoso.com" -Name "EuropeZoneScope"  
Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.17.97.97" -ZoneScope "EuropeZoneScope"  
Add-DnsServerResourceRecord -ZoneName "Contoso.com" -A -Name "www" -IPv4Address "172.21.21.21" -ZoneScope "NorthAmericaZoneScope"  
Add-DnsServerQueryResolutionPolicy -Name "NorthAmericaPolicy" -Action ALLOW -ClientSubnet "eq,NorthAmericaSubnet" -ZoneScope "NorthAmericaZoneScope,1" -ZoneName "Contoso.com"  
Add-DnsServerQueryResolutionPolicy -Name "EuropePolicy" -Action ALLOW -ClientSubnet "eq,EuropeSubnet" -ZoneScope "EuropeZoneScope,1" -ZoneName contoso.com  
```  

Первые две строки скрипта создают объекты подсети клиента для Северная Америка и Европы. Две строки после этого создают область зоны в домене contoso.com, по одной для каждого региона. Две строки после этого создают запись в каждой зоне, которая связывает ww.contoso.com с разным IP-адресом, один для Европы, другой — для Северная Америка. Наконец, в последних строках скрипта создаются две политики разрешения DNS-запросов, одна из которых применяется к подсети Северная Америка, другой — к подсети Europe.  

### <a name="block-queries-for-a-domain"></a>Блокировать запросы для домена  
Для блокировки запросов к домену можно использовать политику разрешения DNS-запросов. В приведенном ниже примере блокируются все запросы к treyresearch.net:  

```  
Add-DnsServerQueryResolutionPolicy -Name "BlackholePolicy" -Action IGNORE -FQDN "EQ,*.treyresearch.com"  
```  

### <a name="block-queries-from-a-subnet"></a>Блокировка запросов из подсети  
Кроме того, можно блокировать запросы, поступающие из определенной подсети. Приведенный ниже сценарий создает подсеть для 172.0.33.0/24, а затем создает политику для игнорирования всех запросов, поступающих из этой подсети.  

```  
Add-DnsServerClientSubnet -Name "MaliciousSubnet06" -IPv4Subnet 172.0.33.0/24  
Add-DnsServerQueryResolutionPolicy -Name "BlackholePolicyMalicious06" -Action IGNORE -ClientSubnet  "EQ,MaliciousSubnet06"  
```  

### <a name="allow-recursion-for-internal-clients"></a>Разрешить рекурсию для внутренних клиентов  
Вы можете управлять рекурсией с помощью политики разрешения DNS-запросов. Приведенный ниже пример можно использовать для включения рекурсии для внутренних клиентов, отключив его для внешних клиентов в сценарии раздельного мозгового случая.  

```  
Set-DnsServerRecursionScope -Name . -EnableRecursion $False   
Add-DnsServerRecursionScope -Name "InternalClients" -EnableRecursion $True  
Add-DnsServerQueryResolutionPolicy -Name "SplitBrainPolicy" -Action ALLOW -ApplyOnRecursion -RecursionScope "InternalClients" -ServerInterfaceIP  "EQ,10.0.0.34"  
```  

Первая строка скрипта изменяет область рекурсии по умолчанию, просто именуемую "." (точка) для отключения рекурсии. Вторая строка создает область рекурсии с именем *интерналклиентс* с включенной рекурсией. А третья строка создает политику для применения новой области рекурсии к любым запросам, поступающим через серверный интерфейс, который имеет 10.0.0.34 в качестве IP-адреса.  

### <a name="create-a-server-level-zone-transfer-policy"></a>Создание политики зонных передач на уровне сервера  
Вы можете управлять зонными перемещениями в более детализированной форме, используя политики зонных передач DNS. Приведенный ниже пример скрипта можно использовать, чтобы разрешить передачу зоны для любого сервера в данной подсети.  

```  
Add-DnsServerClientSubnet -Name "AllowedSubnet" -IPv4Subnet 172.21.33.0/24  
Add-DnsServerZoneTransferPolicy -Name "NorthAmericaPolicy" -Action IGNORE -ClientSubnet "ne,AllowedSubnet"  
```  

Первая строка скрипта создает объект подсети с именем *алловедсубнет* и блоком IP 172.21.33.0/24. Во второй строке создается политика передачи зоны, позволяющая передавать зоны на любой DNS-сервер в подсети, созданной ранее.  

### <a name="create-a-zone-level-zone-transfer-policy"></a>Создание политики зонных передач на уровне зоны  
Кроме того, можно создать политики зонных передач на уровне зоны. В приведенном ниже примере игнорируются любые запросы на зонную пересылку для contoso.com, поступающих из интерфейса сервера с IP-адресом это 10.0.0.33:  

```  
Add-DnsServerZoneTransferPolicy -Name "InternalTransfers" -Action IGNORE -ServerInterfaceIP "eq,10.0.0.33" -PassThru -ZoneName "contoso.com"  
```  

## <a name="dns-policy-scenarios"></a>Сценарии политики DNS

Сведения о том, как использовать политику DNS для конкретных сценариев, см. в следующих подразделах этого руководства.

- [Использование политики DNS для управления трафиком на основе географического расположения с основными серверами](primary-geo-location.md)  
- [Использование политики DNS для управления трафиком на основе географического расположения с помощью первичных и вторичных развертываний](primary-secondary-geo-location.md)  
- [Использование политики DNS для интеллектуальных ответов DNS в зависимости от времени суток](dns-tod-intelligent.md)
- [Ответы DNS на основе времени суток с сервером облачных приложений Azure](dns-tod-azure-cloud-app-server.md)
- [Использование политики DNS для раздельного развертывания DNS](split-brain-DNS-deployment.md)
- [Использование политики DNS для разделения DNS-имен в Active Directory](dns-sb-with-ad.md)
- [Использование политики DNS для применения фильтров к запросам DNS](apply-filters-on-dns-queries.md)
- [Использование политики DNS для балансировки нагрузки приложений](app-lb.md)
- [Использование политики DNS для балансировки нагрузки приложений с учетом географического расположения](app-lb-geo.md)

## <a name="using-dns-policy-on-read-only-domain-controllers"></a>Использование политики DNS на контроллерах домена только для чтения

Политика DNS совместима с контроллерами домена только для чтения. Обратите внимание, что для загрузки новых политик DNS на контроллеры домена только для чтения требуется перезагрузка службы DNS-сервера. Это необязательно для контроллеров домена с возможностью записи.
