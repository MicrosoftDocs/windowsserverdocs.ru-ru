---
title: Использование политики DNS для применения фильтров к запросам DNS
description: Этот раздел является частью DNS политики сценария руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: b86beeac-b0bb-4373-b462-ad6fa6cbedfa
ms.author: pashort
author: shortpatti
ms.openlocfilehash: e9322da3142c584c7b9d0a28396a1d1fd62ce6ee
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446403"
---
# <a name="use-dns-policy-for-applying-filters-on-dns-queries"></a>Использование политики DNS для применения фильтров к запросам DNS

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

В этом разделе можно использовать, чтобы узнать, как настроить политики DNS в Windows Server&reg; 2016 создание фильтров запроса на основании введенных признаков. 

Фильтры запросов в политике DNS позволяют настроить DNS-сервер отвечает специальным образом на основе запроса DNS и DNS-клиента, который отправляет запрос DNS.

Например можно настроить политики DNS с помощью запроса фильтра списка блокировок, блокирующего запросы DNS от известных вредоносных доменов, предотвращающий отвечает на запросы из этих доменов DNS. Так как ответ не отправляется от DNS-сервера, элемент вредоносного домена DNS время ожидания запроса.

Другой пример — Создание фильтра запроса список разрешений, позволяющий только определенный набор клиентов для разрешения определенных имен.

## <a name="bkmk_criteria"></a> Условия фильтрации запроса
Можно создавать фильтры запроса с любой комбинацией логическое (и/или/не) из следующих критериев.

|Имя|Описание|
|-----------------|---------------------|
|Подсеть клиента|Имя подсети предопределенные клиента. Используется для проверки в подсети, из которого был отправлен запрос.|
|Транспортный протокол|Транспортный протокол, используемый в запросе. Возможные значения: UDP и TCP.|
|Протокол IP|Сетевой протокол, используемый в запросе. Возможные значения: IPv4 и IPv6.|
|Интерфейс IP-адрес сервера|IP-адрес сетевого интерфейса DNS-сервера, полученного запроса DNS.|
|FQDN|Полное доменное имя записи в запросе с возможность использования подстановочного знака.|
|Тип запроса|Тип записи, запрашиваемой \(A, SRV, TXT и др.\).|
|Время суток|Время получения запроса.|

Ниже показано, как создавать фильтры для политики DNS, либо блок или разрешить запросы разрешения имен DNS.

>[!NOTE]
>Примеры команд в этом разделе с помощью команды Windows PowerShell **DnsServerQueryResolutionPolicy добавить**. Дополнительные сведения см. в разделе [DnsServerQueryResolutionPolicy добавить](https://docs.microsoft.com/powershell/module/dnsserver/add-dnsserverqueryresolutionpolicy?view=win10-ps). 

## <a name="bkmk_block1"></a>Блок запросов из домена

В некоторых случаях может потребоваться заблокировать разрешения имен DNS для доменов, которые вы определили как вредоносный или для доменов, которые не соответствуют рекомендации по использованию вашей организации. Блокирующие запросы для доменов можно выполнить с помощью политики DNS.

На любой конкретной зоне не создается политика, в этом примере — вместо этого создать политику уровня сервера, который применяется для всех зон, настроенных на сервере DNS. Политики на уровне сервера являются первой вычисляемое и таким образом сначала для сравнения при запросе принимается DNS-сервером.

Например, следующая команда настраивает политику уровня сервера, чтобы блокировать запросы с доменом **суффикс contosomalicious.com**.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicy" -Action IGNORE -FQDN "EQ,*.contosomalicious.com" -PassThru 
`

>[!NOTE]
>При настройке **действие** параметр со значением **пропустить**, DNS-сервер настроен для удаления запросов при отсутствии ответа вообще. Это приводит к DNS-клиент в вредоносного домена истечения времени ожидания.

## <a name="bkmk_block2"></a>Блокировать запросы из подсети
С этим примером вы можете заблокировать запросы из подсети, если он найден заражение некоторых вредоносных программ и повторите попытку вредоносные сайты, с помощью DNS-сервера. 

"Добавить DnsServerClientSubnet-имя «MaliciousSubnet06»-IPv4Subnet 172.0.33.0/24 - PassThru

Добавление DnsServerQueryResolutionPolicy-имя «BlockListPolicyMalicious06»-«EQ, MaliciousSubnet06» ИГНОРИРОВАТЬ действие - ClientSubnet - PassThru "

Ниже приведен пример, как можно использовать критерии подсети в сочетании с критериями полное доменное имя блокировать запросы для определенных вредоносных доменов из зараженных подсетей.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicyMalicious06" -Action IGNORE -ClientSubnet  "EQ,MaliciousSubnet06" –FQDN “EQ,*.contosomalicious.com” -PassThru
`

## <a name="bkmk_block3"></a>Блок тип запроса
Может потребоваться заблокировать разрешение имен для определенных типов запросов на серверах. Например вы можете заблокировать «ANY» запрос, который может использоваться для создания усиления атаки злоумышленником.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicyQType" -Action IGNORE -QType "EQ,ANY" -PassThru
`

## <a name="bkmk_allow1"></a>Разрешить запросы только из домена
Можно не использовать только политики DNS, чтобы запретить запросы, их можно использовать для автоматического утверждения запросов из отдельных доменов или подсети. При настройке списков разрешенных DNS-сервер обрабатывает только запросы из разрешенных доменов блокировать все остальные запросы из других доменов.

Например, следующая команда позволяет только компьютерам и устройствам в contoso.com и дочерние домены для запроса DNS-сервера.

`
Add-DnsServerQueryResolutionPolicy -Name "AllowListPolicyDomain" -Action IGNORE -FQDN "NE,*.contoso.com" -PassThru 
`

## <a name="bkmk_allow2"></a>Разрешить запросы только из подсети
Можно также создать списков разрешенных для IP-подсетей, чтобы все запросы, поступающий не из этих подсетей учитываются.

`
Add-DnsServerClientSubnet -Name "AllowedSubnet06" -IPv4Subnet 172.0.33.0/24 -PassThru
`
`
Add-DnsServerQueryResolutionPolicy -Name "AllowListPolicySubnet” -Action IGNORE -ClientSubnet  "NE, AllowedSubnet06" -PassThru
`

## <a name="bkmk_allow3"></a>Разрешить только определенные QTypes
Списков разрешенных можно применить к QTYPEs. 

Например при наличии внешних клиентов, запрос интерфейса DNS-сервера 164.8.1.1 только определенные QTYPEs могут запрашиваться, несмотря на наличие других QTYPEs, как и SRV или TXT-записи, которые используются внутренние серверы для разрешения имен, или для наблюдения.

`
Add-DnsServerQueryResolutionPolicy -Name "AllowListQType" -Action IGNORE -QType "NE,A,AAAA,MX,NS,SOA" –ServerInterface “EQ,164.8.1.1” -PassThru
`

Можно создать тысячи политик DNS в соответствии с трафиком требований к управлению, а все новые политики применяются динамически — без перезапуска DNS-сервер — на входящих запросов. 
