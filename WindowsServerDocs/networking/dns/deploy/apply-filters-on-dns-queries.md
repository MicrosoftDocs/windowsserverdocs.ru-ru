---
title: Использование политики DNS для применения фильтров к запросам DNS
description: Этот раздел является частью DNS политики сценарий руководство для Windows Server 2016
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-dns
ms.topic: article
ms.assetid: b86beeac-b0bb-4373-b462-ad6fa6cbedfa
ms.author: pashort
author: shortpatti
ms.openlocfilehash: ff10af5f88a03f806a5e5b5fa698c7c3637816bd
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="use-dns-policy-for-applying-filters-on-dns-queries"></a>Использование политики DNS для применения фильтров к запросам DNS

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать, чтобы узнать, как настроить политику DNS в Windows Server&reg; 2016 года, чтобы создать фильтрах запросов, которые основываются на критериях, предоставленных вами. 

Фильтры запроса в политике DNS позволяют настроить DNS-сервер для ответа особым образом на основе запроса DNS и DNS-клиента, который отправляет запросы DNS.

Например можно настроить политики DNS с фильтр запроса черный список DNS-запросы из известных вредоносных доменов, которая блокирует не сможет подключиться к DNS-сервера отвечает на запросы из этих доменов. Поскольку нет ответа отправляются с DNS-сервера, вредоносный домен DNS время ожидания запроса.

Другой пример — Создание фильтра запросов белый список, который позволяет только определенный набор-клиентам разрешать определенные имена.

## <a name="bkmk_criteria"></a>Критерии фильтрации запросов
Можно создать фильтры запросов с любой комбинацией логической (и (или) или не), указанным ниже критериям.

|Имя|Описание|
|-----------------|---------------------|
|Подсеть клиента|Имя предопределенных клиентской подсети. Используется для проверки подсети, из которого был отправлен запрос.|
|Протокол транспорта|Транспорта протокол, используемый в запросе. Допустимые значения: UDP и TCP.|
|Протокол Интернета|Сетевой протокол, используемый в запросе. Допустимые значения: IPv4 и IPv6.|
|Интерфейс IP-адрес сервера|IP-адрес сетевого интерфейса DNS-сервера, получил запрос DNS|
|ПОЛНОЕ ДОМЕННОЕ ИМЯ|Полное доменное имя записи в запросе, с возможность использования подстановочный знак.|
|Тип запроса|Тип записи запрашиваемый \ (A, SRV, TXT, и т. д. \)|
|Время дня|Время получения запроса.|

Следующие примеры показывают, как создать фильтры для политики DNS, либо блок или разрешить запросы разрешения имен DNS.

>[!NOTE]
>Примеры команд в этом разделе используйте команду Windows PowerShell **добавить DnsServerQueryResolutionPolicy**. Дополнительные сведения см. в разделе [добавить DnsServerQueryResolutionPolicy](https://technet.microsoft.com/library/mt126273.aspx). 

##<a name="bkmk_block1"></a>Блокировать запросы из домена

В некоторых случаях может потребоваться заблокировать разрешения имен DNS для доменов, которые вы определили как вредоносные или для доменов, которые не соответствуют рекомендации по использованию вашей организации. Блокирующие запросы для доменов можно выполнить с помощью политики DNS.

Политики, настроенной в этом примере не создана на любой конкретной зоне — вместо создания политики уровня сервера, который применяется ко всем зонам, настроенных на сервере DNS. Политики на уровне сервера, сначала для оценки и таким образом сначала для сравнения при запросе получаемых DNS-сервером.

Следующая команда настраивает политику уровня сервера, чтобы блокировать запросы с доменом **суффикс contosomalicious.com**.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicy" -Action IGNORE -FQDN "EQ,*.contosomalicious.com" -PassThru 
`

>[!NOTE]
>При настройке **действие** параметр со значением **ИГНОРИРОВАТЬ**, DNS-сервер настроен для удаления запросов без ответа на всех. В результате DNS-клиента в вредоносный домен времени ожидания.

##<a name="bkmk_block2"></a>Блокировать запросы из подсети
В этом примере можно блокировать запросы из подсети, если он найден заражение некоторое вредоносное ПО и повторите попытку вредоносные сайты, использующие DNS-сервера. 

"Добавить DnsServerClientSubnet-имя «MaliciousSubnet06»-IPv4Subnet 172.0.33.0/24 - PassThru

Добавление DnsServerQueryResolutionPolicy-имя «BlockListPolicyMalicious06»-действие «EQ MaliciousSubnet06» ИГНОРИРОВАТЬ - ClientSubnet - PassThru "

В следующем примере показано, как использовать критерии подсети в сочетании с критериями полное доменное имя блокировать запросы для определенных вредоносными доменами на основе зараженные подсетей.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicyMalicious06" -Action IGNORE -ClientSubnet  "EQ,MaliciousSubnet06" –FQDN “EQ,*.contosomalicious.com” -PassThru
`

##<a name="bkmk_block3"></a>Блокировать тип запроса
Может потребоваться заблокировать разрешение имен для определенными типами запросов на серверы. Например можно блокировать «Все» запрос, который может использоваться для создания атак усиления злоумышленником.

`
Add-DnsServerQueryResolutionPolicy -Name "BlockListPolicyQType" -Action IGNORE -QType "EQ,ANY" -PassThru
`

##<a name="bkmk_allow1"></a>Разрешить запросы только из домена
Можно не только использование политики DNS, чтобы запретить запросы, их можно использовать для автоматически утверждать запросы от определенных доменов или подсетей. При настройке списков разрешенных DNS-сервер обрабатывает только запросы от разрешенных доменов блокировать все запросы из других доменов.

Следующая команда позволяет только компьютеры и устройства в contoso.com и дочерних доменов на запрос DNS-сервера.

`
Add-DnsServerQueryResolutionPolicy -Name "AllowListPolicyDomain" -Action IGNORE -FQDN "NE,*.contoso.com" -PassThru 
`

##<a name="bkmk_allow2"></a>Разрешить запросы только из подсети
Можно также создать списков разрешенных для IP-подсетей, чтобы все запросы, происходящие из этих подсетей, игнорируются.

`
Add-DnsServerClientSubnet -Name "AllowedSubnet06" -IPv4Subnet 172.0.33.0/24 -PassThru
`
`
Add-DnsServerQueryResolutionPolicy -Name "AllowListPolicySubnet” -Action IGNORE -ClientSubnet  "NE, AllowedSubnet06" -PassThru
`

##<a name="bkmk_allow3"></a>Разрешить только определенным QTypes
Разрешить перечислены можно применить к QTYPEs. 

Например при наличии внешних клиентов запросов интерфейса сервера DNS 164.8.1.1 только определенные QTYPEs разрешено запрос, пока есть другие QTYPEs как записей SRV- или TXT, которые используются внутренние серверы для разрешения имен, или для целей наблюдения.

`
Add-DnsServerQueryResolutionPolicy -Name "AllowListQType" -Action IGNORE -QType "NE,A,AAAA,MX,NS,SOA" –ServerInterface “EQ,164.8.1.1” -PassThru
`

Можно создать тысячи политик DNS в соответствии с трафик требования к управлению, и все новые политики применяются динамически — без перезагрузки DNS-сервер — на входящие запросы. 
