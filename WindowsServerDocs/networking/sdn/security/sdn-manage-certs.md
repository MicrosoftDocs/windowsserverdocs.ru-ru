---
title: Управление сертификатами для программно-Конфигурируемую сеть
description: В этом разделе можно использовать, чтобы узнать, как управление сертификатами для сетевого контроллера Северный и Подсистемамми коммуникаций при развертывании программно определяемой сети (SDN) в Windows Server 2016 Datacenter.
manager: dougkim
ms.prod: windows-server-threshold
ms.technology: networking-sdn
ms.topic: article
ms.assetid: c4e2f6c7-0364-4bf8-bb66-9af59c0bbd74
ms.author: pashort
author: shortpatti
ms.date: 08/22/2018
ms.openlocfilehash: 618c2c4da60decc94f84c2a40cd4d2aa80d5f26b
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59827575"
---
# <a name="manage-certificates-for-software-defined-networking"></a>Управление сертификатами для программно-Конфигурируемую сеть

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Можно использовать в этом разделе вы научитесь управлять сертификатами Северный сетевого контроллера и Southbound обмен данными при развертывании программно-Конфигурируемую сеть \(SDN\) в Windows Server 2016 Datacenter, но при использовании системы Center Virtual Machine Manager \(SCVMM\) клиент управления SDN.

>[!NOTE]
>Общие сведения о сетевом контроллере, см. в разделе [сетевого контроллера](../technologies/network-controller/Network-Controller.md).

Если вы не используете Kerberos для обеспечения безопасной связи сетевого контроллера, можно использовать сертификаты X.509 для проверки подлинности, авторизации и шифрования.

SDN в Windows Server 2016 Datacenter поддерживает оба self\-автоматический и сертификации \(ЦС\)-сертификаты X.509. В этом разделе приведены пошаговые инструкции для создания этих сертификатов и их применения для защиты сети контроллера Северный каналы связи с клиентами для управления и южного communications с сетевых устройств, таких как программное обеспечение Подсистема балансировки нагрузки \(SLB\).
.
При использовании сертификата\-на основе проверки подлинности, необходимо зарегистрировать один сертификат на узлах сетевого контроллера, который используется одним из следующих способов.

1. Шифрование обмена данными с Secure Sockets Layer вышестоящими \(SSL\) между узлами сетевого контроллера и управления клиентами, таких как System Center Virtual Machine Manager.
2. Проверка подлинности между узлов сетевого контроллера и Подсистемамми устройств и служб, таких как узлы Hyper-V и подсистемы балансировки нагрузки программного обеспечения \(SLBs\).

## <a name="creating-and-enrolling-an-x509-certificate"></a>Создание и регистрация сертификата X.509

Можно создать и зарегистрировать самозаверяющих\-подписи сертификата или сертификат, выданный центром сертификации.

>[!NOTE]
>При использовании SCVMM для развертывания сетевого контроллера, необходимо указать сертификат X.509, который используется для шифрования Северный обмена данными во время настройки шаблона службы сетевого контроллера.

Конфигурация сертификата должен содержать следующие значения.

- Значение для **RestEndPoint** текстовое поле должно представлять сетевого контроллера полное доменное имя \(полное доменное имя\) или IP-адрес. 
- **RestEndPoint** значение должно соответствовать имени субъекта \(общее имя, CN\) сертификата X.509.

### <a name="creating-a-self-signed-x509-certificate"></a>Создание самозаверяющего\-сертификат X.509, подписанный

Можно создать самозаверяющий сертификат X.509 и экспортировать его с закрытым ключом \(защищенным паролем\) , выполнив следующие действия для отдельной\-узла и несколько\-развертывания на узле сетевого контроллера .

При создании self\-подписанных сертификатов, можно использовать следующие рекомендации.

- Для параметра DnsName — можно использовать IP-адрес конечной точки REST сетевого контроллера, но это не рекомендуется, поскольку она требует, что узлы сетевого контроллера все расположены в пределах подсети единого управления \(например, на одной стойке\)
- Для нескольких развертываний узла сетевого Контроллера, DNS-имя, указываемое станет полное ДОМЕННОЕ имя кластера контроллер сети \(узла DNS, записи создаются автоматически.\) 
- Для развертывания сетевого контроллера на одном узле DNS-имя может быть именем узла сетевого контроллера, за которым следует полное доменное имя.

#### <a name="multiple-node"></a>Несколько узлов

Можно использовать [New-SelfSignedCertificate](https://technet.microsoft.com/itpro/powershell/windows/pkiclient/new-selfsignedcertificate) команду Windows PowerShell, чтобы создать самозаверяющий\-сертификата.

**Синтаксис**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "<YourNCComputerName>" -DnsName @("<NCRESTName>")

**Пример использования**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "MultiNodeNC" -DnsName @("NCCluster.Contoso.com")

#### <a name="single-node"></a>Один узел

Можно использовать [New-SelfSignedCertificate](https://technet.microsoft.com/itpro/powershell/windows/pkiclient/new-selfsignedcertificate) команду Windows PowerShell, чтобы создать самозаверяющий\-сертификата.

**Синтаксис**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "<YourNCComputerName>" -DnsName @("<NCFQDN>")

**Пример использования**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "SingleNodeNC" -DnsName @("SingleNodeNC.Contoso.com")

### <a name="creating-a-ca-signed-x509-certificate"></a>Создание ЦС\-сертификат X.509, подписанный

Чтобы создать сертификат с помощью центра сертификации, должен быть уже развернут инфраструктура открытого ключа \(PKI\) со службами сертификатов Active Directory \(AD CS\). 

>[!NOTE]
>Можно использовать сторонних центров сертификации или средств, таких как openssl, чтобы создать сертификат для использования с сетевым контроллером, но инструкции в этом разделе относятся только к AD CS. Сведения об использовании сторонних ЦС или средство, см. в документации для программного обеспечения, которое вы используете.

Создание сертификата в центре сертификации включает следующие шаги.

1. Вы или ваша организация домена или администратора безопасности настраивает шаблон сертификата
2. Вы или ваша организация контроллера администратору сети или администратора SCVMM запрашивает новый сертификат из ЦС.

#### <a name="certificate-configuration-requirements"></a>Требования к конфигурации сертификата

При настройке шаблона сертификата в следующем шаге, убедитесь, что шаблон, который настраивается включает следующие обязательные элементы.

1. Имя субъекта сертификата должно быть полное ДОМЕННОЕ имя узла Hyper-V
2. Сертификат должен размещаться в личном хранилище локального компьютера (My-cert: \localmachine\my)
3. Сертификат должен иметь как проверка подлинности сервера (EKU: 1.3.6.1.5.5.7.3.1) и проверка подлинности клиента (EKU: 1.3.6.1.5.5.7.3.2) политики приложения.

>[!NOTE]
>Если Personal \(моей — cert: \localmachine\my\) хранилище сертификатов на Hyper\-узел V имеет более одного сертификата X.509 с именем субъекта (CN), что полное доменное имя узла \(полное доменное имя\), Убедитесь, что сертификат, который будет использоваться SDN имеет дополнительное свойство пользовательского расширенное использование ключа с идентификатором Объекта 1.3.6.1.4.1.311.95.1.1.1. В противном случае — обмен данными между сетевым контроллером и узлом может не работать.

#### <a name="to-configure-the-certificate-template"></a>Чтобы настроить шаблон сертификата
  
>[!NOTE]
>Перед выполнением этой процедуры изучите требования к сертификатам и доступные шаблоны сертификатов в консоль шаблонов сертификатов. Вы можете изменить существующий шаблон или создать дубликат существующего шаблона и затем изменить копию шаблона. Рекомендуется создать копию существующего шаблона.

1. На сервере, где установлены службы AD CS в диспетчере серверов щелкните **средства**, а затем нажмите кнопку **сертификации**. Консоль управления Майкрософт центра сертификации \(MMC\) открывает. 
2. Щелкните правой кнопкой мыши в консоли MMC, дважды щелкните имя ЦС **шаблонов сертификатов**, а затем нажмите кнопку **управление**.
3. Откроется консоль шаблонов сертификатов. В области сведений отображаются все шаблоны сертификатов.
4. В области сведений щелкните шаблон, который требуется воспроизвести.
5.  Нажмите кнопку **действие** меню, а затем щелкните **скопировать шаблон**. Шаблон **свойства** откроется диалоговое окно.
6.  В шаблоне **свойства** диалоговом окне **имя субъекта** щелкните **предоставляется в запросе**. \(Этот параметр является обязательным для сетевого контроллера SSL-сертификатов.\)
7.  В шаблоне **свойства** диалоговом окне **обработка запроса** вкладке, убедитесь, что **Разрешить экспортировать закрытый ключ** выбран. Также убедитесь, что **подпись и шифрование** цель выбрана.
8.  В шаблоне **свойства** диалоговом окне **расширения** выберите **использование ключа**, а затем нажмите кнопку **изменить**.
9.  В **подпись**, убедитесь, что **цифровой подписи** выбран.
10.  В шаблоне **свойства** диалоговом окне **расширения** выберите **политики приложений**, а затем нажмите кнопку **изменить**.
11.  В **политики приложений**, убедитесь, что **проверки подлинности клиента** и **аутентификация** перечислены.
12.  Сохраните копию шаблона сертификата с уникальным именем, например **шаблон сетевого контроллера**.

#### <a name="to-request-a-certificate-from-the-ca"></a>Чтобы запросить сертификат из ЦС

Можно использовать оснастку "Сертификаты" для запроса сертификатов. Вы можете запросить любой тип сертификата, который был предварительно настроенных и становятся доступными через администратора центра сертификации, который обрабатывает запрос на сертификат.

**Пользователи** или локальном **Администраторы** членство в группе, минимальным требованием для выполнения этой процедуры.

1. Откройте оснастку "Сертификаты" для компьютера.
2. В дереве консоли щелкните **сертификаты \(локального компьютера\)**. Выберите **личные** хранилище сертификатов.
3. На **действие** последовательно выберите пункты ** все задачи **, а затем нажмите кнопку **запросить новый сертификат** для запуска мастера регистрации сертификатов. Нажмите кнопку **Далее**.
4. Выберите **настроенный администратором** политики регистрации сертификатов и нажмите кнопку **Далее**.
5. Выберите **политика регистрации Active Directory** \(на основе шаблона ЦС, настроенную в предыдущем разделе\).
6. Разверните **сведения** раздела и настроить следующие элементы.
    1. Убедитесь, что **использование ключа** включает в себя ** цифровой подписи ** и **шифрование ключей**.
    2. Убедитесь, что **политики приложений** включает в себя **аутентификация** \(1.3.6.1.5.5.7.3.1\) и **проверки подлинности клиента** \(1.3.6.1.5.5.7.3.2\).
7. Выберите пункт **Свойства**.
8. На **субъекта** на вкладке **имя субъекта**в **тип**выберите **общее имя**. В значении, укажите **сетевую конечную точку REST контроллера**.
9. Щелкните **Применить** и нажмите кнопку **ОК**.
10. Нажмите кнопку **Регистрация**.

В оснастке MMC для сертификатов щелкните в личном хранилище, чтобы просмотреть сертификат, который вы зарегистрировали из ЦС.

## <a name="exporting-and-copying-the-certificate-to-the-scvmm-library"></a>Экспорт и копирование сертификата в библиотеке SCVMM

После создания самозаверяющих\-автоматический или ЦС\-сертификат, необходимо экспортировать сертификат с закрытым ключом \(в формате PFX\) и без закрытого ключа \(в формате Base-64 CER\) из оснастку «Сертификаты». 

Затем необходимо скопировать два экспортированные файлы, к **ServerCertificate.cr** и **NCCertificate.cr** папки, указанные во время, при импорте шаблона службы сетевого Контроллера.

1. Откройте оснастку сертификатов (certlm.msc) и найдите сертификат в хранилище личных сертификатов на локальном компьютере.
2. Справа\-щелкните сертификат, нажмите кнопку **все задачи**, а затем нажмите кнопку **Экспорт**. Откроется мастер экспорта сертификатов. Нажмите кнопку **Далее**.
3. Выберите **Да**, экспорт закрытого ключа параметр, нажмите кнопку **Далее**.
4. Выберите **файл обмена личной информацией - PKCS #12 (. PFX-ФАЙЛ)** и примите имя по умолчанию для **включить по возможности все сертификаты в путь сертификации** , если это возможно.
5. Назначить пользователей или групп и пароль для сертификата, экспорте, щелкните **Далее**.
6. В файл, страница «Экспорт» перейдите к расположению, где вы хотите поместить экспортируемый файл и присвойте ему имя.
7. Аналогичным образом экспортируйте сертификат в. Формат CER. Примечание. Для экспорта. Формат CER, снимите флажок Да, экспортировать параметр закрытого ключа.
8. Копирования. PFX-ФАЙЛ в папку ServerCertificate.cr.
9. Копирования. CER-файл в папку NCCertificate.cr.

Когда вы закончите, обновите эти папки в библиотеке SCVMM и убедитесь, что эти сертификаты скопированы. Продолжите конфигурацию шаблона службы сетевого контроллера и развертывания.

## <a name="authenticating-southbound-devices-and-services"></a>Проверки подлинности южного устройств и служб 

Сетевых подключений контроллера с помощью узлов и устройств SLB/MUX использует сертификаты для проверки подлинности. Обмен данными с узлами — по протоколу OVSDB при связи с устройствами SLB/MUX по протоколу WCF.

### <a name="hyper-v-host-communication-with-network-controller"></a>Взаимодействия с узлом Hyper-V с помощью сетевого контроллера

Для обмена данными с узлами Hyper-V через OVSDB сетевого контроллера необходимо представить сертификат на хост-компьютеры. По умолчанию SCVMM принимает сертификат SSL, настроенный в сетевом контроллере и использует его для южного обмена данными с узлами.

Это причина, почему SSL-сертификат необходимо настроить EKU для проверки подлинности клиента. Этот сертификат настроен на REST «серверы» ресурсов \(узлов Hyper-V, представлены на сетевом контроллере как ресурс сервера\)и можно просмотреть с помощью команды Windows PowerShell  **Get-NetworkControllerServer**.

Ниже приведен неполный пример ресурс REST сервера.

      "resourceId": "host31.fabrikam.com",
      "properties": {
        "connections": [
          {
            "managementAddresses": [
               "host31.fabrikam.com"
            ],
            "credential": {
              "resourceRef": "/credentials/a738762f-f727-43b5-9c50-cf82a70221fa"
            },
            "credentialType": "X509Certificate"
          }
        ],

Для проверки подлинности на узле Hyper-V должен также иметь сертификат для обмена данными с сетевым контроллером. 

Вы можете зарегистрировать сертификат из центра сертификации \(ЦС\). Если сертификат ЦС на основе не найден на хост-компьютере, SCVMM создает самозаверяющий сертификат и подготавливает его на хост-компьютере.

Сетевой контроллер и сертификатов узла Hyper-V должен быть доверенным друг с другом. Сертификат узла Hyper-V корневой сертификат должен находиться в сетевой контроллер доверенные корневые центры сертификации хранения для локального компьютера и наоборот. 

При использовании self\-сертификаты, SCVMM гарантирует, что необходимые сертификаты присутствуют в хранилище доверенных корневых центров сертификации для локального компьютера. 

Если вы используете сертификаты ЦС для узлов Hyper-V, необходимо убедитесь, что корневой сертификат ЦС в хранилище доверенных корневых центров сертификации сетевого контроллера для локального компьютера.

### <a name="software-load-balancer-mux-communication-with-network-controller"></a>Связи Мультиплексора подсистемы балансировки нагрузки программного обеспечения с помощью сетевого контроллера

Мультиплексор подсистемы балансировки нагрузки программного обеспечения \(Мультиплексора\) и сетевым контроллером обмениваться данными по протоколу WCF, с использованием сертификатов для проверки подлинности.

По умолчанию SCVMM принимает сертификат SSL, настроенный в сетевом контроллере и использует его для подсистемамми с устройствами мультиплексора. Этот сертификат настроен на «NetworkControllerLoadBalancerMux» REST ресурсов и можно просмотреть, выполнив командлет Powershell **Get-NetworkControllerLoadBalancerMux**.

Пример ресурса REST Мультиплексора \(частичного\):

      "resourceId": "slbmux1.fabrikam.com",
      "properties": {
        "connections": [
          {
            "managementAddresses": [
               "slbmux1.fabrikam.com"
            ],
            "credential": {
              "resourceRef": "/credentials/a738762f-f727-43b5-9c50-cf82a70221fa"
            },
            "credentialType": "X509Certificate"
          }
        ],

Для проверки подлинности необходимо также иметь сертификат на устройствах SLB/MUX. Этот сертификат автоматически настраивается с помощью SCVMM, при развертывании программного обеспечения подсистемы балансировки нагрузки с использованием диспетчера SCVMM.

>[!IMPORTANT]
>Для узлов и узлов SLB, крайне важно хранилище сертификатов доверенных корневых центров сертификации не поддерживает любой сертификат, где «Кому выдан» не является таким же, как «Кем выдан». В этом случае сбой связи между сетевым контроллером и подсистемамми устройством.

Сетевого контроллера и SLB/MUX сертификаты должны доверять друг с другом \(SLB/MUX сертификата корневого сертификата должен присутствовать в хранилище доверенных корневых центров сертификации машине сетевого контроллера и наоборот\). При использовании self\-сертификаты, SCVMM гарантирует, что необходимые сертификаты присутствуют в в доверенные корневые центры сертификации хранить на локальном компьютере.



