---
title: Управление сертификатами для программно определяемых сетей
description: С помощью этого раздела вы узнаете, как управлять сертификатами для сетевого контроллера обмена и Подсистемамми при развертывании программно-определяемой сети (SDN) в Windows Server 2016 Datacenter.
manager: grcusanz
ms.prod: windows-server
ms.technology: networking-sdn
ms.topic: article
ms.assetid: c4e2f6c7-0364-4bf8-bb66-9af59c0bbd74
ms.author: anpaul
author: AnirbanPaul
ms.date: 08/22/2018
ms.openlocfilehash: 3225b3f5065e49521411b35fa3781338086b4e59
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80854357"
---
# <a name="manage-certificates-for-software-defined-networking"></a>Управление сертификатами для программно определяемых сетей

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете, как управлять сертификатами для сетевого контроллера обмена и Подсистемамми, когда вы развертываете программно определенную сеть \(SDN\) в Windows Server 2016 Datacenter и используете System Center Virtual Machine Manager \(SCVMM\) в качестве клиента управления SDN.

>[!NOTE]
>Общие сведения о сетевом контроллере см. в разделе [сетевой контроллер](../technologies/network-controller/Network-Controller.md).

Если Kerberos не используется для защиты связи сетевого контроллера, можно использовать сертификаты X. 509 для проверки подлинности, авторизации и шифрования.

SDN в Windows Server 2016 Datacenter поддерживает как самостоятельно подписанный\-, так и центр сертификации \(CA\)-заверенные сертификаты X. 509. В этом разделе приводятся пошаговые инструкции по созданию этих сертификатов и их применению к защищенному сетевому контроллеру обмена каналам связи с клиентами управления и Подсистемамми связью с сетевыми устройствами, такими как программное обеспечение Load Balancer \(SLB\).
.
При использовании проверки подлинности на основе сертификата\-необходимо зарегистрировать один сертификат на узлах сетевого контроллера, который используется следующими способами.

1. Шифрование связи обмена с SSL \(SSL\) между узлами сетевого контроллера и клиентами управления, такими как System Center Virtual Machine Manager.
2. Проверка подлинности между узлами сетевого контроллера и Подсистемамми устройствами и службами, такими как узлы Hyper-V и программные подсистемы балансировки нагрузки \(Слбс\).

## <a name="creating-and-enrolling-an-x509-certificate"></a>Создание и регистрация сертификата X. 509

Вы можете создать и зарегистрировать самозаверяющий\-сертификат или сертификат, выданный центром сертификации.

>[!NOTE]
>При использовании SCVMM для развертывания сетевого контроллера необходимо указать сертификат X. 509, используемый для шифрования связи обмена во время настройки шаблона службы сетевого контроллера.

Конфигурация сертификата должна включать следующие значения.

- Значение текстового поля **рестендпоинт** должно быть полным доменным именем сетевого контроллера \(FQDN\) или IP-адрес. 
- Значение **рестендпоинт** должно совпадать с именем субъекта \(общим именем, CN\) сертификата X. 509.

### <a name="creating-a-self-signed-x509-certificate"></a>Создание собственного\-подписанного сертификата X. 509

Вы можете создать самозаверяющий сертификат X. 509 и экспортировать его с закрытым ключом, \(защитить паролем\), выполнив следующие действия для одного узла\-и нескольких развертываний узла сетевого контроллера\-.

При создании самостоятельно подписанных сертификатов\-можно использовать следующие рекомендации.

- Для параметра DnsName можно использовать IP-адрес конечной точки RESTFUL сетевого контроллера, но это не рекомендуется, так как для этого требуется, чтобы узлы сетевого контроллера размещались в одной подсети управления \(например, в одной стойке\)
- Для нескольких развертываний с полным доменным именем DNS-имя, которое вы указали, будет превышено до полного доменного имени кластера сетевого контроллера \(узел DNS. записи A создаются автоматически.\) 
- Для развертывания сетевого контроллера с одним узлом DNS-имя может быть именем узла сетевого контроллера, за которым следует полное доменное имя.

#### <a name="multiple-node"></a>Несколько узлов

Чтобы создать самозаверяющий сертификат\-, можно использовать команду Windows PowerShell [New-SelfSignedCertificate](https://technet.microsoft.com/itpro/powershell/windows/pkiclient/new-selfsignedcertificate) .

**Синтаксис**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "<YourNCComputerName>" -DnsName @("<NCRESTName>")

**Пример использования**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "MultiNodeNC" -DnsName @("NCCluster.Contoso.com")

#### <a name="single-node"></a>Один узел

Чтобы создать самозаверяющий сертификат\-, можно использовать команду Windows PowerShell [New-SelfSignedCertificate](https://technet.microsoft.com/itpro/powershell/windows/pkiclient/new-selfsignedcertificate) .

**Синтаксис**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "<YourNCComputerName>" -DnsName @("<NCFQDN>")

**Пример использования**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "SingleNodeNC" -DnsName @("SingleNodeNC.Contoso.com")

### <a name="creating-a-ca-signed-x509-certificate"></a>Создание ЦС\-подписанного сертификата X. 509

Чтобы создать сертификат с помощью центра сертификации, необходимо предварительно развернуть инфраструктуру открытого ключа \(PKI\) с Active Directory службами сертификатов \(AD CS\). 

>[!NOTE]
>Для создания сертификата для использования с сетевым контроллером можно использовать сторонние ЦС или средства, такие как OpenSSL, однако инструкции, приведенные в этом разделе, относятся только к AD CS. Дополнительные сведения об использовании стороннего центра сертификации или средства см. в документации по используемому программному обеспечению.

Создание сертификата с помощью ЦС включает следующие шаги.

1. Вы или ваш домен или администратор безопасности вашей организации настраиваете шаблон сертификата.
2. Вы или администратор сетевого контроллера или администратор SCVMM вашей организации запрашивает новый сертификат из центра сертификации.

#### <a name="certificate-configuration-requirements"></a>Требования к конфигурации сертификата

Настроив шаблон сертификата на следующем шаге, убедитесь, что настраиваемый шаблон включает следующие обязательные элементы.

1. Имя субъекта сертификата должно быть полным доменным именем узла Hyper-V
2. Сертификат должен быть размещен в личном хранилище на локальном компьютере (My-CERT: \ LocalMachine\MY)
3. Сертификат должен иметь политики приложения проверки подлинности сервера (EKU: 1.3.6.1.5.5.7.3.1) и проверки подлинности клиента (EKU: 1.3.6.1.5.5.7.3.2).

>[!NOTE]
>Если личное \(хранилище сертификатов My-CERT: \ LocalMachine\MY\) на узле Hyper\-V имеет более одного сертификата X. 509 с именем субъекта (CN) в качестве полного доменного имени узла \(FQDN\), убедитесь, что сертификат, который будет использоваться SDN, имеет дополнительное свойство расширенного использования ключа с идентификатором OID 1.3.6.1.4.1.311.95.1.1.1. В противном случае обмен данными между сетевым контроллером и узлом может не работать.

#### <a name="to-configure-the-certificate-template"></a>Настройка шаблона сертификата
  
>[!NOTE]
>Перед выполнением этой процедуры необходимо ознакомиться с требованиями к сертификатам и доступными шаблонами сертификатов в консоли Шаблоны сертификатов. Можно либо изменить существующий шаблон, либо создать дубликат существующего шаблона, а затем изменить копию шаблона. Рекомендуется создать копию существующего шаблона.

1. На сервере, где установлена служба AD CS, в диспетчер сервера выберите **Сервис**, а затем щелкните **центр сертификации**. Откроется консоль управления центра сертификации Microsoft Management Console \(\) MMC. 
2. В консоли управления (MMC) дважды щелкните имя ЦС, щелкните правой кнопкой мыши **шаблоны сертификатов**, а затем выберите пункт **Управление**.
3. Откроется консоль Шаблоны сертификатов. Все шаблоны сертификатов отображаются в области сведений.
4. В области сведений щелкните шаблон, который необходимо дублировать.
5.  В меню **действие** выберите пункт **дублировать шаблон**. Откроется диалоговое окно **Свойства** шаблона.
6.  В диалоговом окне **Свойства** шаблона на вкладке **имя субъекта** щелкните **указать в запросе**. \(этого параметра требуется для SSL-сертификатов сетевого контроллера.\)
7.  В диалоговом окне **Свойства** шаблона на вкладке **Обработка запроса** установите флажок **Разрешить экспорт закрытого ключа** . Также убедитесь, что выбрано назначение **подписи и шифрования** .
8.  В диалоговом окне **Свойства** шаблона на вкладке **расширения** выберите **Использование ключа**и нажмите кнопку **изменить**.
9.  Убедитесь, что в **подписи**выбрана **Цифровая подпись** .
10.  В диалоговом окне **Свойства** шаблона на вкладке **расширения** выберите **политики приложений**и нажмите кнопку **изменить**.
11.  В **политиках приложений**убедитесь, что в списке указаны проверка подлинности **клиента** и **сервера** .
12.  Сохраните копию шаблона сертификата с уникальным именем, например **шаблоном сетевого контроллера**.

#### <a name="to-request-a-certificate-from-the-ca"></a>Запрос сертификата из центра сертификации

Для запроса сертификатов можно использовать оснастку "сертификаты". Можно запросить любой тип сертификата, предварительно настроенный и предоставленный администратором центра сертификации, который обрабатывает запрос на сертификат.

**Пользователи** или локальные **Администраторы** являются минимальным членством в группе, необходимым для выполнения этой процедуры.

1. Откройте оснастку "сертификаты" для компьютера.
2. В дереве консоли щелкните **сертификаты \(локальный компьютер\)** . Выберите хранилище **личных** сертификатов.
3. В меню **действие** наведите указатель мыши на пункт * * Все задачи<strong>, а затем нажмите кнопку * * Запросить новый сертификат,</strong> чтобы запустить мастер регистрации сертификатов. Нажмите кнопку **Далее**.
4. Выберите политику, **настроенную** политикой регистрации сертификатов администратора, и нажмите кнопку **Далее**.
5. Выберите **политику регистрации Active Directory** \(на основе шаблона ЦС, настроенного в предыдущем разделе\).
6. Разверните раздел **сведения** и настройте следующие элементы.
   1. Убедитесь, что **Использование ключа** включает в себя <strong>цифровые подписи * * и * * шифрование ключей</strong>.
   2. Убедитесь, что **политики приложений** включают **проверку подлинности сервера** \(1.3.6.1.5.5.7.3.1\) и **проверку подлинности клиента** \(1.3.6.1.5.5.7.3.2\).
7. Нажмите кнопку **Свойства**.
8. На вкладке **субъект** в поле **имя субъекта**в **поле Тип**выберите **Общее имя**. В списке значение укажите **конечную точку сети сетевого контроллера**.
9. Щелкните **Применить** и нажмите кнопку **ОК**.
10. Нажмите кнопку **Регистрация**.

В консоли "сертификаты" щелкните личное хранилище, чтобы просмотреть сертификат, который вы зарегистрировали в центре сертификации.

## <a name="exporting-and-copying-the-certificate-to-the-scvmm-library"></a>Экспорт и копирование сертификата в библиотеку SCVMM

После создания самостоятельно\-подписанного сертификата или ЦС\-подписанный сертификат необходимо экспортировать сертификат с закрытым ключом \(в формате PFX\) и без закрытого ключа \(в формате Base-64. cer\) из оснастки "сертификаты". 

Затем необходимо скопировать два экспортированных файла в папки **ServerCertificate.CR** и **NCCertificate.CR** , указанные во время импорта шаблона службы NC.

1. Откройте оснастку "сертификаты" (certlm. msc) и выберите сертификат в личном хранилище сертификатов для локального компьютера.
2. Щелкните сертификат правой кнопкой мыши\-выберите пункт **все задачи**, а затем щелкните **Экспорт**. Откроется мастер экспорта сертификатов. Нажмите кнопку **Далее**.
3. Выберите **Да**, экспортировать параметр закрытый ключ и нажмите кнопку **Далее**.
4. Выберите **файл обмена личной информацией — PKCS #12 (. PFX)** и примите значение по умолчанию, чтобы **включить все сертификаты в путь сертификации, если это** возможно.
5. Назначьте пользователей и группы, а также пароль экспортируемого сертификата, нажмите кнопку **Далее**.
6. На странице файл для экспорта найдите расположение, в которое нужно поместить экспортированный файл, и присвойте ему имя.
7. Аналогичным образом Экспортируйте сертификат в. Формат CER. Примечание. для экспорта в. Формат CER, снимите флажок Да, экспортировать закрытый ключ.
8. Скопируйте. PFX-файл в папку ServerCertificate.cr
9. Скопируйте. CER в папку NCCertificate.cr

По завершении обновите эти папки в библиотеке SCVMM и убедитесь, что эти сертификаты скопированы. Продолжайте настройку и развертывание шаблона службы сетевого контроллера.

## <a name="authenticating-southbound-devices-and-services"></a>Проверка подлинности устройств и служб Подсистемамми 

Связь сетевого контроллера с узлами и устройствами МУЛЬТИПЛЕКСОРа SLB использует сертификаты для проверки подлинности. Обмен данными с узлами осуществляется по протоколу ОВСДБ, а связь с устройствами МУЛЬТИПЛЕКСОРа SLB осуществляется по протоколу WCF.

### <a name="hyper-v-host-communication-with-network-controller"></a>Взаимодействие узла Hyper-V с сетевым контроллером

Для связи с узлами Hyper-V через ОВСДБ сетевой контроллер должен представлять сертификат для хост-компьютеров. По умолчанию SCVMM выбирает SSL-сертификат, настроенный на сетевом контроллере, и использует его для связи подсистемамми с узлами.

Это причина, по которой SSL-сертификат должен иметь настроенное EKU проверки подлинности клиента. Этот сертификат настраивается в ресурсе "серверы", \(узлы Hyper-V представлены в сетевом контроллере как ресурс сервера\), и их можно просмотреть, выполнив команду Windows PowerShell **Get-нетворкконтроллерсервер**.

Ниже приведен частичный пример ресурса "Серверная часть".

      "resourceId": "host31.fabrikam.com",
      "properties": {
        "connections": [
          {
            "managementAddresses": [
               "host31.fabrikam.com"
            ],
            "credential": {
              "resourceRef": "/credentials/a738762f-f727-43b5-9c50-cf82a70221fa"
            },
            "credentialType": "X509Certificate"
          }
        ],

Для взаимной проверки подлинности узел Hyper-V также должен иметь сертификат для взаимодействия с сетевым контроллером. 

Сертификат можно зарегистрировать из центра сертификации \(\)CA. Если на хост-компьютере не найден сертификат на основе центра сертификации, то SCVMM создает самозаверяющий сертификат и подготавливает его на хост-компьютере.

Сетевой контроллер и сертификаты узла Hyper-V должны быть доверенными друг от друга. Корневой сертификат сертификата узла Hyper-V должен присутствовать в хранилище доверенных корневых центров сертификации сетевого контроллера для локального компьютера и наоборот. 

При использовании самостоятельно\-подписанных сертификатов SCVMM гарантирует, что необходимые сертификаты будут находиться в хранилище доверенных корневых центров сертификации для локального компьютера. 

Если для узлов Hyper-V используются сертификаты на основе ЦС, необходимо убедиться, что корневой сертификат ЦС находится в хранилище доверенных корневых центров сертификации сетевого контроллера для локального компьютера.

### <a name="software-load-balancer-mux-communication-with-network-controller"></a>Связь по Load Balancer МУЛЬТИПЛЕКСОРа с сетевым контроллером

Мультиплексор программного Load Balancer \(МУЛЬТИПЛЕКСОР\) и сетевой контроллер взаимодействуют по протоколу WCF, используя сертификаты для проверки подлинности.

По умолчанию SCVMM выбирает SSL-сертификат, настроенный на сетевом контроллере, и использует его для подсистемамми связи с устройствами мультиплексора. Этот сертификат настраивается в ресурсе Нетворкконтроллерлоадбаланцермукс, и его можно просмотреть, выполнив командлет PowerShell **Get-нетворкконтроллерлоадбаланцермукс**.

Пример \(частичных\)ресурсов МУЛЬТИПЛЕКСОРа:

      "resourceId": "slbmux1.fabrikam.com",
      "properties": {
        "connections": [
          {
            "managementAddresses": [
               "slbmux1.fabrikam.com"
            ],
            "credential": {
              "resourceRef": "/credentials/a738762f-f727-43b5-9c50-cf82a70221fa"
            },
            "credentialType": "X509Certificate"
          }
        ],

Для взаимной проверки подлинности также необходим сертификат на устройствах МУЛЬТИПЛЕКСОРа SLB. Этот сертификат автоматически настраивается SCVMM при развертывании программной подсистемы балансировки нагрузки с помощью SCVMM.

>[!IMPORTANT]
>На узлах узла и SLB крайне важно, чтобы хранилище сертификатов доверенных корневых центров сертификации не включало сертификаты, для которых "выдан" не совпадает с "выдан". В этом случае происходит сбой связи между сетевым контроллером и устройством подсистемамми.

Сетевой контроллер и сертификаты МУЛЬТИПЛЕКСОРа SLB должны быть доверенными друг от друга \(корневой сертификат сертификата МУЛЬТИПЛЕКСОРа SLB должен присутствовать в хранилище доверенных корневых центров сертификации компьютера сетевого контроллера и наоборот\). Если вы используете самозаверяющий сертификат\-, SCVMM обеспечивает присутствие необходимых сертификатов в в хранилище доверенных корневых центров сертификации для локального компьютера.



