---
title: Управление сертификатами для программно-конфигурируемой сети
description: В этом разделе можно использовать, чтобы узнать, как управлять сертификатами для сетевого контроллера Северный и Южный связи при развертывании программного обеспечения конфигурируемые сети (SDN) в Windows Server 2016 Datacenter.
manager: brianlic
ms.prod: windows-server-threshold
ms.technology: networking-sdn
ms.topic: article
ms.assetid: c4e2f6c7-0364-4bf8-bb66-9af59c0bbd74
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 3036de9161cabc2f3a85a1d3b2ce7739f0ff6bd3
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="manage-certificates-for-software-defined-networking"></a>Управление сертификатами для программно-конфигурируемой сети

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

Чтобы узнать, как управлять сертификатами для сетевого контроллера Северный и Южный связи при развертывании программного обеспечения определены сети \(SDN\) в Windows Server 2016 Datacenter и с помощью System Center Virtual Machine Manager \(SCVMM\) как ваш клиент управления SDN можно использовать в этом разделе.

>[!NOTE]
>Общие сведения о сетевой контроллер см. в разделе [сетевой контроллер](../technologies/network-controller/Network-Controller.md).

Если вы не используете Kerberos для обеспечения безопасной связи сетевого контроллера, сертификаты X.509 можно использовать для проверки подлинности, авторизации и шифрования.

SDN в Windows Server 2016 Datacenter поддерживает подписанные многоразовый и центр сертификации \ (CA\)-подписанные сертификаты X.509. В этом разделе приведены пошаговые инструкции по созданию этих сертификатов и их применения для защиты сетевого контроллера Северный каналы связи с клиентами управления и Южный обмен данными с сетевыми устройствами, например \(SLB\) Балансировка нагрузки программного обеспечения.
.
При использовании проверки подлинности на основе certificate\ должен зарегистрировать один сертификат на узлах сетевой контроллер, который используется следующими способами.

1. Шифрование Северный связь с \(SSL\) протокола SSL между узлами сетевой контроллер и управления клиентами, таких как System Center Virtual Machine Manager.
2. Проверка подлинности между узлами сетевой контроллер и Южный устройств и служб, таких как узлов Hyper-V и \(SLBs\) подсистем балансировки нагрузки программного обеспечения.

## <a name="creating-and-enrolling-an-x509-certificate"></a>Создание и регистрация сертификата X.509

Можно создать и зарегистрировать сертификат, подписанный многоразовый или сертификат, выданный центром сертификации.

>[!NOTE]
>При использовании SCVMM по развертыванию сетевого контроллера, необходимо указать сертификат X.509, который используется для шифрования данных Северный взаимодействия во время настройки шаблона службы сетевого контроллера.

Конфигурация сертификата должен содержать следующие значения.

- Значение для **RestEndPoint** текстовое поле должны быть \(FQDN\) сетевой контроллер полное доменное имя или IP-адрес. 
- **RestEndPoint** значение должно совпадать с именем субъекта \ (общее имя, CN\) сертификата X.509.

### <a name="creating-a-self-signed-x509-certificate"></a>Создание сертификата подписи многоразовый X.509

Можно создать самозаверяющий сертификат X.509 и экспортировать его с закрытым ключом \ (защищенные с помощью password\), выполнив следующие действия для одиночных узел и узел множественным развертывания сетевого контроллера.

При создании многоразовый подписанные сертификаты, можно использовать приведенные ниже рекомендации.

- IP-адрес конечной точки REST сетевого контроллера можно использовать для параметра DnsName -, но это не рекомендуется, поскольку он означает, что узлы сетевой контроллер все находятся в подсети единое управление \ (например, на одном rack\)
- Для нескольких развертываний узел NC DNS-имя, которое вы указываете станет полное доменное имя кластера контроллер сети \ (записи A узла DNS-сервера создаются автоматически. \) 
- Для развертывания сетевого контроллера одного узла DNS-имя может быть имя узла сетевой контроллер, за которым следует полное доменное имя.

#### <a name="multiple-node"></a>Несколько узлов

Можно использовать [New-SelfSignedCertificate](https://technet.microsoft.com/en-us/itpro/powershell/windows/pkiclient/new-selfsignedcertificate) команды Windows PowerShell для создания многоразовый подписанного сертификата.

**Синтаксис**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "<YourNCComputerName>" -DnsName @("<NCRESTName>")

**Пример использования**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "MultiNodeNC" -DnsName @("NCCluster.Contoso.com")

#### <a name="single-node"></a>Один узел

Можно использовать [New-SelfSignedCertificate](https://technet.microsoft.com/en-us/itpro/powershell/windows/pkiclient/new-selfsignedcertificate) команды Windows PowerShell для создания многоразовый подписанного сертификата.

**Синтаксис**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "<YourNCComputerName>" -DnsName @("<NCFQDN>")

**Пример использования**

    New-SelfSignedCertificate -KeyUsageProperty All -Provider "Microsoft Strong Cryptographic Provider" -FriendlyName "SingleNodeNC" -DnsName @("SingleNodeNC.Contoso.com")

### <a name="creating-a-ca-signed-x509-certificate"></a>Создание сертификата подписи CA\ X.509

Чтобы создать сертификат с помощью центра сертификации, вы уже должен быть развернут \(PKI\) Инфраструктура открытых ключей с \(AD CS\) службы сертификатов Active Directory. 

>[!NOTE]
>Сторонние центры сертификации или средств, таких как openssl, можно использовать для создания сертификата для использования с сетевым контроллером, однако инструкции в этом разделе относятся только к AD CS. Чтобы узнать, как использовать сторонних ЦС или средства, см. в документации для программного обеспечения, которое вы используете.

Создание сертификата в ЦС включает следующие шаги.

1. Вы или вашей организации домена или администраторов безопасности настраивает шаблона сертификата
2. Вы или вашей организации сетевой контроллер администратора или администратора SCVMM запрашивает новый сертификат из ЦС.

#### <a name="certificate-configuration-requirements"></a>Требования к конфигурации сертификата

При настройке шаблона сертификата в следующем шаге, убедитесь, что шаблон, который вы настраиваете содержит следующие необходимые элементы.

1. Имя субъекта сертификата должно быть полное доменное имя узла Hyper-V
2. Сертификат необходимо разместить в личном хранилище локального компьютера (Мои — cert: \localmachine\my)
3. Сертификат должен иметь как проверка подлинности сервера (EKU: 1.3.6.1.5.5.7.3.1) и проверки подлинности клиента (EKU: 1.3.6.1.5.5.7.3.2) политики приложения.

>[!NOTE]
>Если личный \ (Мои — cert: \localmachine\my\) хранилища на узле Hyper\-V имеет более одного X.509 сертификатов с именем субъекта (CN) в качестве узла \(FQDN\) полное доменное имя, убедитесь, что сертификат, который будет использоваться SDN имеет дополнительные настраиваемое свойство расширенное использование ключа с OID 1.3.6.1.4.1.311.95.1.1.1 сертификата. В противном случае — обмен данными между сетевой контроллер и узла может не работать.

#### <a name="to-configure-the-certificate-template"></a>Настройка шаблона сертификата
  
>[!NOTE]
>Перед выполнением этой процедуры изучите требования к сертификатам и доступные шаблоны сертификатов в консоли шаблонов сертификатов. Можно изменить существующий шаблон или создать копию существующего шаблона и затем измените копию шаблона. Рекомендуется создать копию существующего шаблона.

1. На сервере, где установлены службы AD CS в диспетчере сервера щелкните **средства**, а затем нажмите кнопку **центра сертификации**. Откроется консоль управления Microsoft центра сертификации \(MMC\). 
2. В консоли Управления, дважды щелкните имя ЦС, щелкните правой кнопкой мыши **шаблонов сертификатов**, а затем нажмите кнопку **управление**.
3. Откроется консоль шаблонов сертификатов. Все шаблоны сертификатов, отображаются в области сведений.
4. В области сведений щелкните шаблон, который требуется воспроизвести.
5.  Нажмите кнопку **действие** меню, а затем выберите **скопировать шаблон**. Шаблон **свойства** откроется диалоговое окно.
6.  В шаблоне **свойства** диалогового **имя субъекта** щелкните **предоставляется в запросе**. \ (Этот параметр является обязательным для сетевого контроллера SSL-сертификаты. \)
7.  В шаблоне **свойства** диалогового **обработка запроса** убедитесь, что **Разрешить экспортировать закрытый ключ** выбран. Также убедитесь, что **подпись и шифрование** цель выбрана.
8.  В шаблоне **свойства** диалогового **расширения** выберите **использование ключа**, а затем нажмите кнопку **изменить**.
9.  В **подписи**, убедитесь, что **цифровой подписи** выбран.
10.  В шаблоне **свойства** диалогового **расширения** выберите **политики применения**, а затем нажмите кнопку **изменить**.
11.  В **политики приложения**, убедитесь, что **проверки подлинности клиента** и **проверки подлинности сервера** указаны.
12.  Сохраните копию шаблона сертификата уникальное имя, например **шаблона сетевой контроллер**.

#### <a name="to-request-a-certificate-from-the-ca"></a>Чтобы запросить сертификат от центра сертификации

Можно использовать оснастку "Сертификаты" для запроса сертификатов. Вы можете запросить любой тип сертификата, заранее настроенный и становятся доступными через администратор ЦС, который обрабатывает запрос на сертификат.

**Пользователи** или локального **Администраторы** членство в группе минимальным требованием для выполнения этой процедуры.

1. Откройте оснастку "Сертификаты" для компьютера.
2. В дереве консоли щелкните **\(Local Computer\) сертификаты**. Выберите **личные** хранилище сертификатов.
3. На **действие** выберите пункт ** все задачи **, а затем щелкните **запросить новый сертификат** Чтобы запустить мастер регистрации сертификатов. Нажмите кнопку **Далее**.
4. Выберите **настроена вашим администратором** политика регистрации сертификатов и нажмите кнопку **Далее**.
5. Выберите **политику регистрации Active Directory** \ (в зависимости от шаблона ЦС, настроенную в предыдущем section\).
6. Разверните **сведений** статьи и настроить следующие элементы.
    1. Убедитесь, что **использование ключа** включает в себя обе ** цифровой подписи ** и **шифрование ключей**.
    2. Убедитесь, что **политики приложения** включает в себя обе **проверки подлинности сервера** \(1.3.6.1.5.5.7.3.1\) и **проверки подлинности клиента** \(1.3.6.1.5.5.7.3.2\).
7. Нажмите кнопку **свойства**.
8. На **субъекта** вкладке **имя субъекта**в **тип**выберите **общее имя**. В поле значение укажите **конечной точки REST контроллера сети**.
9. Нажмите кнопку **применить**, а затем нажмите кнопку **ОК**.
10. Нажмите кнопку **зарегистрировать**.

В MMC "Сертификаты" щелкните личное хранилище для просмотра сертификата, которые были зарегистрированы из ЦС.

## <a name="exporting-and-copying-the-certificate-to-the-scvmm-library"></a>Экспорт и копирование сертификата в библиотеке SCVMM

После создания-выполнил многоразовый или CA\ сертификат, необходимо экспортировать сертификат с закрытым ключом \(in.pfx format\) и без закрытого ключа \ (в командлета Format .cer Base-64) из оснастку «Сертификаты». 

Затем необходимо скопировать два экспортированные файлы для **ServerCertificate.cr** и **NCCertificate.cr** папки, указанные во время, при импорте шаблона службы NC.

1. Откройте оснастку сертификатов (certlm.msc) и найдите сертификат в хранилище личных сертификатов на локальном компьютере.
2. Щелкните правой кнопкой мыши сертификат, **все задачи**, а затем нажмите кнопку **Экспорт**. Открывает мастер экспорта сертификатов. Нажмите кнопку **Далее**.
3. Выберите **Да**, экспорт закрытого ключа параметр, нажмите кнопку **Далее**.
4. Выберите **обмена личной информацией - PKCS #12 (. PFX)** и принять значения по умолчанию для **включить все сертификаты в путь сертификации** , если это возможно.
5. Назначение пользователей или групп и пароль для экспорта сертификата, нажмите кнопку **Далее**.
6. Файл, чтобы экспортировать страницу перейдите в расположение, в котором требуется разместить экспортированный файл и присвойте ему имя.
7. Аналогичным образом Экспорт сертификата в. Формат CER. Примечание: Чтобы экспортировать. Формат CER снимите Да, экспортировать параметр закрытого ключа.
8. Копировать. PFX-ФАЙЛ в папку ServerCertificate.cr.
9. Копировать. CER-файл в папку NCCertificate.cr.

Когда все будет готово, обновите эти папки в библиотеке SCVMM и убедитесь, что эти сертификаты копируется. Продолжите контроллер службы шаблона конфигурации сети и развертывания.

## <a name="authenticating-southbound-devices-and-services"></a>Проверка подлинности Южный устройств и служб 

Взаимодействие по сети контроллер узлы и SLB MUX устройств использует сертификаты для проверки подлинности. Связи с узлами — по протоколу OVSDB во время обмена данными с устройствами SLB MUX по протоколу WCF.

### <a name="hyper-v-host-communication-with-network-controller"></a>Связь узлов Hyper-V с помощью сетевого контроллера

Для связи с узлами Hyper-V через OVSDB сетевой контроллер должен представить сертификат для этих компьютеров. По умолчанию SCVMM собирают SSL-сертификата, настроенного на сетевой контроллер и использует его для Южный связи с узлами.

Это причин, почему SSL-сертификат, необходимо настроить EKU для проверки подлинности клиента. Этот сертификат настроен на «Серверы» REST ресурсов \ (узлов Hyper-V представлены в сетевой контроллер resource\ сервера) и можно просмотреть, выполнив команду Windows PowerShell **Get-NetworkControllerServer**.

Ниже приведен частичные пример REST ресурсов сервера.

      "resourceId": "host31.fabrikam.com",
      "properties": {
        "connections": [
          {
            "managementAddresses": [
               "host31.fabrikam.com"
            ],
            "credential": {
              "resourceRef": "/credentials/a738762f-f727-43b5-9c50-cf82a70221fa"
            },
            "credentialType": "X509Certificate"
          }
        ],

Для взаимной проверки подлинности для узла Hyper-V необходимо также иметь сертификат для обмена данными с сетевым контроллером. 

Вы можете зарегистрировать сертификат из \(CA\) центра сертификации. Если сертификат ЦС на основе не найден на хост-компьютере, SCVMM создает самозаверяющий сертификат и подготавливает его на хост-компьютере.

Сетевой контроллер и сертификаты узла Hyper-V должен быть доверенным друг с другом. Корневой сертификат узла Hyper-V сертификат должен находиться в сетевой контроллер доверенные корневые центры сертификации хранить на локальном компьютере и наоборот. 

При использовании сертификатов подписи многоразовый SCVMM гарантирует, что необходимые сертификаты присутствуют в хранилище доверенных корневых центров сертификации на локальном компьютере. 

Если вы используете ЦС на основе сертификатов для узлов Hyper-V, необходимо убедиться, что присутствует корневой сертификат ЦС в хранилище доверенных корневых центров сертификации сетевого контроллера для локального компьютера.

### <a name="software-load-balancer-mux-communication-with-network-controller"></a>Связи Мультиплексора подсистемы балансировки нагрузки программного обеспечения с помощью сетевого контроллера

\(MUX\) мультиплексор подсистемы балансировки нагрузки программного обеспечения и сетевой контроллер взаимодействовать по протоколу WCF использование сертификатов для проверки подлинности.

По умолчанию SCVMM собирают SSL-сертификата, настроенного на сетевой контроллер и использует его для Южный обмена данными с устройствами мультиплексирования. Этот сертификат настроен на «NetworkControllerLoadBalancerMux» РАСПОЛОЖИТЕ ресурсов и можно просмотреть, выполнив командлет Powershell **Get-NetworkControllerLoadBalancerMux**.

Пример \(partial\) ресурс Мультиплексирования REST.

      "resourceId": "slbmux1.fabrikam.com",
      "properties": {
        "connections": [
          {
            "managementAddresses": [
               "slbmux1.fabrikam.com"
            ],
            "credential": {
              "resourceRef": "/credentials/a738762f-f727-43b5-9c50-cf82a70221fa"
            },
            "credentialType": "X509Certificate"
          }
        ],

Для проверки подлинности необходимо также иметь сертификат на устройствах SLB Мультиплексирования. Этот сертификат автоматически настраивается с SCVMM, при развертывании с помощью SCVMM Балансировка нагрузки программного обеспечения.

>[!IMPORTANT]
>Для узлов и узлов SLB, крайне важно хранилище сертификатов доверенных корневых центров сертификации не выполняет любого сертификата, где «Выдан для» не так же, как «Поставщик». В этом случае не удается установить связь между сетевой контроллер и Южный устройства.

Сетевой контроллер и SLB MUX сертификаты должны быть надежными друг с другом \ (SLB MUX сертификат корневого сертификата должен присутствовать в машине сетевой контроллер доверенные корневые центры сертификации хранения и versa\). Когда вы используете многоразовый подписанные сертификаты, SCVMM гарантирует, что необходимые сертификаты присутствуют в в доверенные корневые центры сертификации хранить на локальном компьютере.



