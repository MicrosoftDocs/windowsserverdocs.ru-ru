---
title: Развертывание инфраструктуры программно конфигурируемой сети с помощью сценариев
description: В этом разделе приведены инструкции по развертыванию инфраструктуры Microsoft программно-конфигурируемой сети (SDN), с помощью сценариев в Windows Server 2016.
manager: brianlic
ms.prod: windows-server-threshold
ms.service: virtual-network
ms.technology: networking-sdn
ms.topic: get-started-article
ms.assetid: 5ba5bb37-ece0-45cb-971b-f7149f658d19
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 4428ad73ab8933510d5a759ec4fa7377ea222ebd
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="deploy-a-software-defined-network-infrastructure-using-scripts"></a>Развертывание инфраструктуры программно конфигурируемой сети с помощью сценариев

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе приведены инструкции по развертыванию инфраструктуры Microsoft программно-конфигурируемой сети (SDN), с помощью сценариев. Эта инфраструктура включает высокой доступности сетевой контроллер (высокой ДОСТУПНОСТИ), ВЫСОКОДОСТУПНЫЕ программного обеспечения нагрузки балансировки (SLB) / MUX, виртуальные сети и связанные списки управления доступом (ACL). Кроме того еще один скрипт развертывает рабочую нагрузку клиентов, проверять SDN инфраструктуры.  
  
Если вы хотите рабочих нагрузок клиентов для связи за пределами их виртуальным сетям, настройкой правил SLB NAT, туннели шлюза сайта для сайта или переадресации уровня 3 для маршрутизации между виртуальными и физическими рабочих нагрузок.  
  
Можно также развернуть инфраструктуру SDN с помощью Virtual Machine Manager (VMM). Дополнительные сведения см. в разделе [Настройка инфраструктуры для программного обеспечения конфигурируемой сети (SDN) в структуре VMM](https://technet.microsoft.com/system-center-docs/vmm/scenario/sdn-overview).  
  
## <a name="pre-deployment"></a>Перед развертыванием  
  
> [!IMPORTANT]  
> Перед началом развертывания необходимо спланировать и настроить узлы и физической сетевой инфраструктуры. Дополнительные сведения см. в разделе [спланировать инфраструктуру сети определенного программного обеспечения](../../sdn/plan/Plan-a-Software-Defined-Network-Infrastructure.md).  
  
Все узлы Hyper-V необходимо установить Windows Server 2016.  
  
## <a name="deployment-steps"></a>Шаги развертывания  
Начните с настройки виртуального коммутатора Hyper-V (физических серверов) и назначение IP-адреса узла Hyper-V. Может использоваться любой тип хранилища, совместимого с Hyper-V, общие или локального.  
### <a name="install-host-networking"></a>Установка узла сети  
1. Установите последние версии драйверов сети, доступных для вашего оборудования сетевого Адаптера.  
2. Установка роли Hyper-V на всех узлах (Дополнительные сведения см. в разделе [начало работы с Hyper-V в Windows Server 2016](https://technet.microsoft.com/en-us/library/mt126159.aspx).   
  
   Из командной строки с повышенными привилегиями Windows PowerShellcommand:  
   ``Install-WindowsFeature -Name Hyper-V -ComputerName <computer_name> -IncludeManagementTools -Restart``  
    
    . Создание виртуального коммутатора Hyper-V (используйте то же имя коммутатора, для всех узлов. Например: **sdnSwitch**). Настроить по крайней мере один сетевой адаптер, или при использовании объединение внедренных коммутатора, настроить по крайней мере два сетевых адаптера. Максимальный входящий распространения происходит при использовании двух сетевых адаптеров.  
 `` New-VMSwitch "<switch name>" -NetAdapterName "<NetAdapter1>" [, "<NetAdapter2>" -EnableEmbeddedTeaming $True] -AllowManagementOS $True``  
 
 >[!NOTE] 
 >Если у вас есть отдельные сетевые адаптеры управления можно пропустить шаги 3 и 4.

3. См. в разделе, посвященном планированию ([планирование инфраструктуры программно-определенные сети](../../sdn/plan/../../sdn/plan/../../sdn/plan/Plan-a-Software-Defined-Network-Infrastructure.md)) и могут работать вместе с администратором сети, чтобы получить идентификатор виртуальной локальной сети VLAN управления. Присоедините виртуального сетевого адаптера управления вновь созданного виртуального коммутатора, виртуальной локальной сети управления. Этот шаг можно указывать, если в вашей среде не используется теги виртуальной локальной сети.  
 `` Set-VMNetworkAdapterIsolation -ManagementOS -IsolationMode Vlan -DefaultIsolationID <Management VLAN> -AllowUntaggedTraffic $True``  
 
4. См. в разделе, посвященном планированию ([планирование инфраструктуры программно-определенные сети](../../sdn/plan/../../sdn/plan/../../sdn/plan/Plan-a-Software-Defined-Network-Infrastructure.md)) и работают с администратору сети на использование либо DHCP или статические назначений IP-адресов для назначения IP-адрес виртуального сетевого адаптера управления из только что созданный виртуальный коммутатор. Следующий пример демонстрирует создание статический IP-адрес и назначьте его виртуального сетевого адаптера управления vswitch.:  
 ``New-NetIPAddress -InterfaceAlias "vEthernet (<switch name>)" -IPAddress <IP> -DefaultGateway <Gateway IP> -AddressFamily IPv4 -PrefixLength <Length of Subnet Mask - for example: 24>``  
      
5. [Необязательно] Развертывание виртуальной машины на узел доменных служб Active Directory ([Установка служб Active Directory домена (уровень 100)](https://technet.microsoft.com/library/hh472162.aspx) и DNS-сервер.  
   
    . Подключите виртуальную машину Active Directory и DNS-сервера для управления виртуальной локальной сети:
    
            Set-VMNetworkAdapterIsolation -VMName "<VM Name>" -Access -VlanId <Management VLAN> -AllowUntaggedTraffic $True  
   
   б. Установка доменных служб Active Directory и DNS.  
      >[!NOTE]
      >Сетевой контроллер поддерживает Kerberos и X.509 сертификаты для проверки подлинности. В данном руководстве оба механизма проверки подлинности для различных целей (несмотря на то, что обязательным является только один).  
        
6. Присоедините все узлы Hyper-V в домен. Проверьте сервер DNS для сетевого адаптера, который имеет IP-адрес, назначенного точкам сети управления DNS-сервер, который может разрешить имя домена. Например:

        Set-DnsClientServerAddress -InterfaceAlias "vEthernet (<switch name>)" -ServerAddresses <DNS Server IP>  
   
   . Щелкните правой кнопкой мыши **запустить**, нажмите кнопку **системы**, а затем нажмите кнопку **изменить параметры**.  
   б. Нажмите кнопку **изменение**.  
   c. Нажмите кнопку **домена** и укажите имя домена.  
   d. Нажмите кнопку **ОК**.  
   e. Введите имя и пароль учетные данные пользователя при появлении соответствующего запроса.  
   f. Перезапустите сервер.  
  
### <a name="validation"></a>Проверка  
Используйте следующие действия для проверки этого узла к сети, настроен правильно.  
1. Убедитесь, что успешно создан коммутатор виртуальной Машины.  
      
    ``Get-VMSwitch "<switch name>"``  
2. Проверьте подключение виртуального сетевого адаптера управления на коммутатор виртуальной Машины управление виртуальной локальной сети:  
    >[!NOTE]
    >Значение, только в том случае, если трафик управления и клиента совместного использования одного сетевого адаптера.    
      
    ``Get-VMNetworkAdapterIsolation -ManagementOS``  
3. Убедитесь, что все узлы Hyper-V (и ресурсы внешнего управления, например: DNS-серверы) будут доступны с помощью команды ping, с помощью своих управления IP-адрес или полное доменное имя (FQDN).   
      
   ``ping <Hyper-V Host IP>``  
   ``ping <Hyper-V Host FQDN>``  
4. Выполните следующую команду на узле развертывания и указать полное доменное имя каждого узла Hyper-V, чтобы учетные данные Kerberos предоставляет доступ ко всем серверам.  
      
   ``winrm id -r:<Hyper-V Host FQDN>``  
      
### <a name="nano-installation-requirements-and-notes"></a>Требования к установке Nano и примечания  
Если Nano использует в качестве узлов Hyper-V (физических серверов) для развертывания, ниже приведены дополнительные требования:  
1. Все узлы Nano понадобится DSC пакета установки с языковым пакетом.  
   
   * Microsoft-NanoServer-DSC-Package.cab  
   * Microsoft-NanoServer-DSC-Package_en-us.cab
   
        ``dism /online /add-package /packagepath:<Path> /loglevel:4``  
2. Сценарии SDN Express необходимо запускать из узла не Nano (Windows Server Core или Windows Server с графическим интерфейсом пользователя). Рабочие процессы PowerShell на сервере nano Server не поддерживаются.  
3.  Вызов Северный API-Интерфейс контроллера с помощью PowerShell или NC REST программы-оболочки (которая зависит от Invoke-WebRequest и Invoke-RestMethod) должна выполняться с узла не Nano.  
   
         
### <a name="run-sdn-express-scripts"></a>Запустить сценарии Express SDN  
  
1.  Установочные файлы находятся на GitHub. Скачайте ZIP-файл из [репозитории GitHub Microsoft SDN](https://github.com/Microsoft/SDN.git). На странице Microsoft SDN репозиторий, щелкните **клонировать или скачать** и нажмите кнопку **загрузить ZIP-ФАЙЛ**.  
  
2.  Назначить один компьютер в качестве компьютера развертывания.  Этот компьютер должен работать под управлением Windows Server 2016. Разверните ZIP-файл и Копировать **SDNExpress** папку на компьютере развертывания `C:\`папки.  
  
3.  Общий ресурс `C:\SDNExpress`папку как «**SDNExpress**» разрешение для **все** для **чтения и записи**.  
  
4.  Перейдите к `C:\SDNExpress`папки.

 Вы увидите следующие папки:  

|Имя папки|Описание|  
|---------------|---------------|  
|AgentConf|Содержит новые копии схем OVSDB SDN агента узла на каждом узле Windows Server 2016 Hyper-V для программы сетевой политики.|  
|Сертификаты|Временное расположение общего файла сертификата NC.|  
|Изображения|Пустая, установите образ vhdx Windows Server 2016 здесь|  
|Средства|Служебные программы для устранения неполадок и отладки.  Скопировать узлов и виртуальных машин.  Мы рекомендуем размещать сетевого монитора или Wireshark здесь чтобы оно было доступно при необходимости.|  
|Сценарии|Сценарии развертывания.<br /><br />-   **SDNExpress.ps1**<br />    Развертывает и настраивает структуры, в том числе виртуальных машин сетевой контроллер, SLB Mux виртуальных машин, шлюза пулы и виртуальные машины шлюза HNV, соответствующие пулы.<br />-   **FabricConfig.psd1**<br />    Шаблон файла конфигурации для сценария SDNExpress.  Это будет выполнена настройка для вашей среды.<br />-   **SDNExpressTenant.ps1**<br />    Развертывает рабочую нагрузку клиентов пример виртуальной сети с балансировкой нагрузки виртуальных IP-адресов.<br />    Также предоставляет один или несколько сетевых подключений (IPSec S2S VPN, GRE, уровня 3) на шлюзах edge поставщика службы, которые подключены к рабочей нагрузки ранее созданного клиента. Шлюзы IPSec и GRE доступны для подключения через соответствующие IP-адреса виртуальных IP-адресов и шлюз переадресации уровня 3 через соответствующий пул адресов.<br />    Этот сценарий можно также удалить соответствующий конфигурации с возможностью отмены.<br />-   **TenantConfig.psd1**<br />    Файл конфигурации шаблонов для клиента рабочей нагрузки и конфигурации шлюза S2S.<br />-   **SDNExpressUndo.ps1**<br />    Очищает среды структуры и возвращает его в первоначальное состояние.<br />-   **SDNExpressEnterpriseExample.ps1**<br />    Предоставляет один или несколько корпоративных средах сайта с одной шлюз удаленного доступа и (при необходимости) одной соответствующего корпоративных виртуальной машины на каждом сайте. Шлюзы предприятия IPSec или GRE подключается к соответствующей виртуальных IP-адресов IP-адрес шлюза поставщика службы для установления туннеля S2S. Шлюз переадресации уровня 3 подключается через соответствующий IP-адрес узла. <br />            Этот сценарий можно также удалить соответствующий конфигурации с возможностью отмены.<br />-   **EnterpriseConfig.psd1**<br />    Файл шаблона конфигурации для корпоративного шлюза сайта для сайта и конфигурация виртуальной Машины клиента.|  
|TenantApps|Файлы, используемые для развертывания клиента пример рабочей нагрузки.|  
  
5.  Убедитесь, Windows Server 2016 VHDX-файл находится в **изображения** папки.  
  
6. Настроить, изменив файл SDNExpress\scripts\FabricConfig.psd1 **<< заменить >>** теги с определенными значениями для размеру инфраструктуры лаборатории, включая имена узлов, доменные имена, имена пользователей и пароли и сетевых сведения в сети, перечисленные в разделе планирования сети.  
7. Создайте записи узла A в DNS для NetworkControllerRestName (FQDN) и NetworkControllerRestIP.  
8. Запустите сценарий как пользователя с учетными данными администратора домена:  
      
    ``SDNExpress\scripts\SDNExpress.ps1 -ConfigurationDataFile FabricConfig.psd1 -Verbose``  
      
9.  Чтобы отменить все операции, выполните следующую команду:  
      
    ``SDNExpress\scripts\SDNExpressUndo.ps1 -ConfigurationDataFile FabricConfig.psd1 -Verbose``  
      
#### <a name="validation"></a>Проверка  
Предполагается, что скрипт SDN Express был выполнен до завершения без передачи все ошибки, можно выполнить следующее действие, чтобы обеспечить ресурсов структуры, развернутых правильно и доступны для развертывания клиентов.  

- Используйте [средства диагностики](https://docs.microsoft.com/windows-server/networking/sdn/troubleshoot/troubleshoot-windows-server-software-defined-networking-stack) чтобы убедиться в отсутствии ошибок на любой ресурсов структуры в сетевым контроллером.  
      
    ``Debug-NetworkControllerConfigurationState -NetworkController <FQDN of Network Controller Rest Name>``  
        
   
### <a name="deploy-a-sample-tenant-workload-with-the-software-load-balancer"></a>Развертывание клиента пример рабочей нагрузки с подсистемой балансировки нагрузки программного обеспечения  
    
Теперь, когда ресурсы структуры были развернуты, можно проверить ваш SDN развертывания узел узел, развертывание рабочую нагрузку клиентов пример. Этой рабочей нагрузкой клиента состоит из двух виртуальных подсетей (веб-уровень и уровень базы данных) защищенными посредством правила список управления доступом (ACL), с помощью SDN распределенных брандмауэра. Веб-уровень виртуальной подсети должен быть доступен через SLB/MUX, используя адрес виртуальных IP-адресов (VIP). Сценарий автоматически развертывает два web уровня виртуальных машин и одну базу данных уровня виртуальной машины и подключение для виртуальных подсетей.  
  
1.  Настроить, изменив файл SDNExpress\scripts\TenantConfig.psd1 **<< заменить >>** теги с определенными значениями (например: имя, имя REST сетевого контроллера, имя виртуального коммутатора, т. д., ранее определенные в файле FabricConfig.psd1 из образа виртуального жесткого диска)  
2.  Запустите сценарий. Например:  
``SDNExpress\scripts\SDNExpressTenant.ps1 -ConfigurationDataFile TenantConfig.psd1 -Verbose``  
3.  Чтобы отменить конфигурацию, выполните такие же сценарии с **отменить** параметра. Например:  
``SDNExpress\scripts\SDNExpressTenant.ps1 -Undo -ConfigurationDataFile TenantConfig.psd1 -Verbose``  

#### <a name="validation"></a>Проверка  
Для проверки успешности развертывания клиента, выполните следующие действия.
1.  Войдите в виртуальную машину уровня базы данных и попробуйте проверить связь с IP-адрес одного из виртуальных машин уровня web (Убедитесь, что брандмауэр Windows отключен в Интернете уровня виртуальных машин).  
2.  Проверьте ресурсы клиента сетевой контроллер на наличие ошибок. Выполните следующую команду из любого узла Hyper-V с уровня 3 подключения сетевого контроллера:  
      
    ``Debug-NetworkControllerConfigurationState -NetworkController <FQDN of Network Controller REST Name>``
3. Чтобы убедиться в правильной работе подсистемы балансировки нагрузки, выполните следующую команду из любого узла Hyper-V:
    
        wget <VIP IP address>/unique.htm -disablekeepalive -usebasicparsing
   
   где `<VIP IP address>`является веб-уровень виртуальных IP-адресов IP-адрес, настраиваются в файле TenantConfig.psd1. Поиск `VIPIP`переменной в TenantConfig.psd1.

   Выполняет высокая раз для просмотра подсистемы балансировки нагрузки, для переключения между доступными использованием значений DIP. Также вы можете увидеть это поведение с помощью веб-браузера. Перейдите к `<VIP IP address>/unique.htm`. Закройте браузеру и открытия нового экземпляра и снова перейдите. Вы увидите на синие и страницы зеленый альтернативного, за исключением при браузера страница кэшируется в кэше времени до отключения.