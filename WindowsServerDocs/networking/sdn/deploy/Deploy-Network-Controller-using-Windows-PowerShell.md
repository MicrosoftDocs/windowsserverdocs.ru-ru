---
title: Развертывание сетевого контроллера с помощью Windows PowerShell
description: Этот раздел содержит инструкции по использованию Windows PowerShell для развертывания сетевого контроллера на компьютерах или виртуальных машин (ВМ), работающих под управлением Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 2448d381-55aa-4c14-997a-202c537c6727
ms.author: pashort
author: shortpatti
ms.openlocfilehash: cfd06662f317381fb77bf31db5ed60c2489ff871
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="deploy-network-controller-using-windows-powershell"></a>Развертывание сетевого контроллера с помощью Windows PowerShell

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

Этот раздел содержит инструкции по использованию Windows PowerShell для развертывания сетевого контроллера на один или несколько виртуальных машин (ВМ, работающих под управлением Windows Server 2016).

>[!IMPORTANT]
>Не выполняйте развертывание роли сервера сетевого контроллера на физических узлах. Для развертывания сетевого контроллера, необходимо установить роль сервера сетевого контроллера на виртуальной машине Hyper-V \(VM\), установленной на узле Hyper-V. После установки сетевого контроллера на виртуальные машины на трех разных узлах Hyper\-V, необходимо включить узлов Hyper\-V для программного обеспечения определены сети \(SDN\) путем добавления узлов для сетевого контроллера с помощью команды Windows PowerShell **New-NetworkControllerServer**. Таким образом, включается Балансировка нагрузки программного обеспечения SDN функции. Дополнительные сведения см. в разделе [New-NetworkControllerServer](https://technet.microsoft.com/itpro/powershell/windows/network-controller/new-networkcontrollerserver).

Этот раздел содержит следующие разделы.

- [Установка роли сервера сетевого контроллера](#bkmk_role)

- [Настройка кластера сетевого контроллера](#bkmk_configure)

- [Настройка приложения сетевого контроллера](#bkmk_app)

- [Сетевой контроллер проверки развертывания](#bkmk_validation)

- [Дополнительные команды Windows PowerShell для сетевого контроллера](#bkmk_ps)

- [Пример сценария конфигурации сетевого контроллера](#bkmk_script)

- [После Post-Deployment Действия для развертывания сторонних Kerberos](#bkmk_nonkerb)

## <a name="bkmk_role"></a>Установка роли сервера сетевого контроллера

Эту процедуру можно использовать для установки роли сервера сетевого контроллера на виртуальной машине \(VM\).

>[!IMPORTANT]
>Не выполняйте развертывание роли сервера сетевого контроллера на физических узлах. Для развертывания сетевого контроллера, необходимо установить роль сервера сетевого контроллера на виртуальной машине Hyper-V \(VM\), установленной на узле Hyper-V. После установки сетевого контроллера на виртуальные машины на трех разных узлах Hyper\-V, необходимо включить узлов Hyper\-V для программного обеспечения определены сети \(SDN\) путем добавления узлов для сетевого контроллера. Таким образом, включается Балансировка нагрузки программного обеспечения SDN функции.

Членство в группе **Администраторы**, или в эквивалентной минимальным требованием для выполнения этой процедуры.  

>[!NOTE]
>Если вы хотите использовать диспетчер сервера вместо Windows PowerShell для установки сетевого контроллера см. в разделе [Установка роли сервера сетевого контроллера с помощью диспетчера сервера](https://technet.microsoft.com/library/mt403348.aspx)

Установка сетевого контроллера с помощью Windows PowerShell, введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД.

`Install-WindowsFeature -Name NetworkController -IncludeManagementTools`

Установка сетевого контроллера требует перезагрузки компьютера. Чтобы сделать это, введите следующую команду и нажмите клавишу ВВОД.

`Restart-Computer`

## <a name="bkmk_configure"></a>Настройка кластера сетевого контроллера

Кластер сетевой контроллер обеспечивает высокий уровень доступности и масштабируемости для сетевого контроллера приложение, которого можно настроить после создания кластера, а также которой размещается поверх кластера.

>[!NOTE]
>Можно либо непосредственно на виртуальной Машине, где установлена сетевого контроллера или удаленный сервер администрирования средства для Windows Server 2016 можно использовать для выполнения процедур с удаленного компьютера, на котором работает Windows Server 2016 или Windows 10 выполнить процедуры, описанные в следующих разделах. Кроме того, членство в группе **Администраторы**, или в эквивалентной минимальным требованием для выполнения этой процедуры. Если компьютер или виртуальная машина, на котором установлен сетевой контроллер присоединен к домену, ваша учетная запись пользователя должна быть членом **пользователи домена**.

Можно создать кластер сетевой контроллер, создав объект узла и затем настройка кластера.

### <a name="create-a-node-object"></a>Создайте объект узла

Необходимо создать объект узла для каждой виртуальной Машины, которая является членом кластера сетевого контроллера.

Чтобы создать объект узла, введите следующую команду в командной строке Windows PowerShell и нажмите клавишу ВВОД. Убедитесь, что добавлены значения для каждого параметра, которые подходят для развертывания.  

```
New-NetworkControllerNodeObject -Name <string> -Server <String> -FaultDomain <string>-RestInterface <string> [-NodeCertificate <X509Certificate2>]
```

В следующей таблице приведены описания для каждого параметра **New-NetworkControllerNodeObject** команды.

|Параметр|Описание|
|-------------|---------------|
|Имя|**Имя** параметр задает понятное имя сервера, который вы хотите добавить в кластер|
|Сервер|**Сервера** параметр задает имя узла, полное доменное имя (FQDN) или IP-адрес сервера, который требуется добавить в кластер. Для компьютеров, присоединенных к домену полное доменное имя является обязательным.|
|FaultDomain|**FaultDomain** параметр указывает домен сбоя для сервера, добавляемого в кластер. Этот параметр определяет, серверы, которые могут возникнуть ошибки, в то же время, что и сервер, который добавляется в кластер. Этот сбой может быть из-за общей физической зависимости, например электроэнергии и сетевые источники. Домены сбоя обычно представляют иерархии, которые связаны с этих общих зависимостей с нескольких серверов, может привести к отказу вместе с более высоким точки в дереве доменов сбоя. Во время выполнения сетевой контроллер считает доменах сбоя в кластере и пытается рассредоточить службах сетевой контроллер, чтобы они были в отдельных доменах сбоя. Этот процесс помогает обеспечить, в случае сбоя любого домена сбоя одного доступности этой службы и его состояние не нарушена. В иерархическом формате указаны домены сбоя. Например: «Fd: / Rack1/DC1/узел1», где DC1 — это имя центра обработки данных, Rack1 — это имя стойке и узел1 — это имя узла, где необходимо разместить узел.|
|RestInterface|**RestInterface** параметр задает имя интерфейса, на узле, где завершается связи Representational State Transfer (REST). Этот интерфейс сетевого контроллера получает Северный API-Интерфейс запросы из сети уровень управления.|
|NodeCertificate|**NodeCertificate** параметр задает сертификат, который использует сетевой контроллер для проверки подлинности компьютера. Сертификат является обязательным, если вы используете проверку подлинности на основе сертификатов для обмена данными внутри кластера; сертификат также используется для шифрования трафика между службами сетевого контроллера. Имя субъекта сертификата должно быть такой же, как DNS-имя узла.|

### <a name="configure-the-cluster"></a>Настройка кластера

Чтобы настроить кластер, введите следующую команду в командной строке Windows PowerShell и нажмите клавишу ВВОД. Убедитесь, что добавлены значения для каждого параметра, которые подходят для развертывания.

```
Install-NetworkControllerCluster -Node <NetworkControllerNode[]> -ClusterAuthentication <ClusterAuthentication> [-ManagementSecurityGroup <string>][-DiagnosticLogLocation <string>][-LogLocationCredential <PSCredential>] [-CredentialEncryptionCertificate <X509Certificate2>][-Credential <PSCredential>][-CertificateThumbprint <String>] [-UseSSL][-ComputerName <string>][-LogSizeLimitInMBs<UInt32>] [-LogTimeLimitInDays<UInt32>]
```

В следующей таблице приведены описания для каждого параметра **установки NetworkControllerCluster** команды.
  
|Параметр|Описание|
|-------------|---------------|
|ClusterAuthentication|**ClusterAuthentication** параметр задает тип проверки подлинности, который используется для обеспечения безопасной связи между узлами и также используется для шифрования трафика между службами сетевого контроллера. Поддерживаются значения **Kerberos**, **X509** и **нет**. Проверка подлинности Kerberos использует учетных записей домена и может использоваться только узлы сетевого контроллера в случае присоединен к домену. Если указать проверку подлинности на основе X509, необходимо предоставить сертификат в объекте NetworkControllerNode. Кроме того перед выполнением этой команды необходимо вручную предоставить сертификат.|
|ManagementSecurityGroup|**ManagementSecurityGroup** параметр задает имя группы безопасности, которая содержит пользователей, которые разрешено запускать командлеты управления с удаленного компьютера. Это применимо только в случае Kerberos ClusterAuthentication. Необходимо указать группу безопасности домена, а не группой безопасности на локальном компьютере.|
|Узел|**Узел** параметр задает список узлов сетевой контроллер, созданные с помощью **New-NetworkControllerNodeObject** команды.|
|DiagnosticLogLocation|**DiagnosticLogLocation** параметр указывает расположение папки, где диагностические журналы периодически отправляются. Если вы не укажете значение для этого параметра, журналы хранятся локально на каждом узле. Журналы хранятся локально в systemdrive%\Windows\tracing\SDNDiagnostics % папке. Журнал кластера хранятся локально в папку %systemdrive%\ProgramData\Microsoft\Service Fabric\log\Traces.|
|LogLocationCredential|**LogLocationCredential** указывает учетные данные, которые требуются для доступа к общей папке, где хранятся журналы.|
|CredentialEncryptionCertificate|**CredentialEncryptionCertificate** параметр задает сертификат, который использует сетевой контроллер шифровать учетные данные, которые используются для доступа к сетевым контроллером двоичных файлов и **LogLocationCredential**, если он указан. На всех узлах сетевой контроллер перед выполнением этой команды необходимо подготовить сертификат и тот же сертификат необходимо зарегистрировать на всех узлах кластера. В рабочей среде рекомендуется использовать этот параметр для защиты сетевого контроллера двоичные файлы и журналы. Без этого параметра учетные данные хранятся в виде открытого текста и может использоваться на любой неавторизованных пользователей.|
|Учетные данные|Этот параметр является обязательным только в том случае, если эта команда выполняется на удаленном компьютере. **Credential** параметр указывает учетную запись пользователя, обладающую разрешением для выполнения этой команды на конечном компьютере.|
|CertificateThumbprint|Этот параметр является обязательным только в том случае, если эта команда выполняется на удаленном компьютере. **CertificateThumbprint** параметр задает цифровой сертификат открытого ключа (X509) учетной записи пользователя, имеющую разрешение на выполнение этой команды на конечном компьютере.|
|UseSSL|Этот параметр является обязательным только в том случае, если эта команда выполняется на удаленном компьютере. **UseSSL** параметр указывает протокол Secure Sockets Layer (SSL), который используется для подключения к удаленному компьютеру. По умолчанию не используется протокол SSL.|
|Имя компьютера|**ComputerName** параметр указывает узел сетевой контроллер, на котором выполняется команда. Если вы не укажете значение для этого параметра, по умолчанию используется локальный компьютер.|
|LogSizeLimitInMBs|Этот параметр задает максимальный размер журнала, в МБ, которое можно хранить сетевого контроллера. Журналы хранятся в кругу. Если DiagnosticLogLocation, значение этого параметра по умолчанию — 40 ГБ. Если DiagnosticLogLocation не предоставляется, журналы хранятся на узлах сетевой контроллер, и значение по умолчанию этого параметра — 15 ГБ.|
|LogTimeLimitInDays|Этот параметр задает ограничение длительность в днях, в которых хранятся журналы. Журналы хранятся в кругу. Значение этого параметра по умолчанию — 3 дня.|

## <a name="bkmk_app"></a>Настройка приложения сетевого контроллера
Чтобы настроить приложения сетевой контроллер, введите следующую команду в командной строке Windows PowerShell и нажмите клавишу ВВОД. Убедитесь, что добавлены значения для каждого параметра, которые подходят для развертывания.

```
Install-NetworkController -Node <NetworkControllerNode[]> -ClientAuthentication <ClientAuthentication>  [-ClientCertificateThumbprint <string[]>]  [-ClientSecurityGroup <string>] -ServerCertificate <X509Certificate2> [-RESTIPAddress <String>] [-RESTName <String>] [-Credential <PSCredential>][-CertificateThumbprint <String> ] [-UseSSL]
```

В следующей таблице приведены описания для каждого параметра **установки NetworkController** команды.

|Параметр|Описание|
|-------------|---------------|
|Допустимый|**Допустимый** параметр указывает тип проверки подлинности, используемый для обеспечения безопасной связи между REST и сетевого контроллера. Поддерживаются значения **Kerberos**, **X509** и **нет**. Проверка подлинности Kerberos использует учетных записей домена и может использоваться только узлы сетевого контроллера в случае присоединен к домену. Если указать проверку подлинности на основе X509, необходимо предоставить сертификат в объекте NetworkControllerNode. Кроме того перед выполнением этой команды необходимо вручную предоставить сертификат.|
|Узел|**Узел** параметр задает список узлов сетевой контроллер, созданные с помощью **New-NetworkControllerNodeObject** команды.|
|ClientCertificateThumbprint|Этот параметр является обязательным только в том случае, если вы используете проверку подлинности на основе сертификатов для клиентов сетевого контроллера. **ClientCertificateThumbprint** параметр указывает отпечаток сертификатов, зарегистрированных клиентов на Северный уровня.|
|Сертификата сервера|**Сертификата сервера** параметр задает сертификат, который использует сетевой контроллер для подтверждения его подлинности для клиентов. Сертификат сервера необходимо включить цель проверки подлинности сервера в расширениях расширенное использование ключа и должен быть выдан для сетевого контроллера центра сертификации, которому доверяют клиенты.|
|RESTIPAddress|Необходимо указать значение для **RESTIPAddress** с одним узлом развертывания сетевого контроллера. Для развертываний с несколькими узлами **RESTIPAddress** параметр указывает IP-адрес конечной точки REST в нотацию CIDR. Например 192.168.1.10/24. Значение имени субъекта **сертификата сервера** должен разрешаться в значение **RESTIPAddress** параметра. Этот параметр должен быть указан для всех развертываний сетевой контроллер несколько узлов, если все узлы находятся в той же подсети. Если узлы находятся в разных подсетях, необходимо использовать **RestName** parameter, а не с помощью **RESTIPAddress**.|
|RestName|Необходимо указать значение для **RestName** с одним узлом развертывания сетевого контроллера. Только один раз, необходимо указать значение для **RestName** когда несколько узлов развертываний имеют узлов, которые находятся в разных подсетях. Для развертываний с несколькими узлами **RestName** параметр полное доменное имя кластера сетевого контроллера.|
|ClientSecurityGroup|**ClientSecurityGroup** параметр задает имя группы безопасности Active Directory, членами которой являются клиентами сетевого контроллера. Этот параметр является обязательным только в том случае, если вы используете проверку подлинности Kerberos для **допустимый**. Группа безопасности должна содержать учетные записи, с которых осуществляется интерфейсы API REST, и необходимо создать группу безопасности и добавить членов перед выполнением этой команды.|
|Учетные данные|Этот параметр является обязательным только в том случае, если эта команда выполняется на удаленном компьютере. **Credential** параметр указывает учетную запись пользователя, обладающую разрешением для выполнения этой команды на конечном компьютере.|
|CertificateThumbprint|Этот параметр является обязательным только в том случае, если эта команда выполняется на удаленном компьютере. **CertificateThumbprint** параметр задает цифровой сертификат открытого ключа (X509) учетной записи пользователя, имеющую разрешение на выполнение этой команды на конечном компьютере.|
|UseSSL|Этот параметр является обязательным только в том случае, если эта команда выполняется на удаленном компьютере. **UseSSL** параметр указывает протокол Secure Sockets Layer (SSL), который используется для подключения к удаленному компьютеру. По умолчанию не используется протокол SSL.|

После завершения настройки приложения сетевой контроллер развертывания сетевого контроллера будет завершена.

## <a name="bkmk_validation"></a>Сетевой контроллер проверки развертывания

Чтобы проверить развертывание сетевого контроллера, можно добавить учетные данные для сетевого контроллера и извлекают учетные данные.

Если вы используете в качестве механизма допустимый, членство в группе Kerberos **ClientSecurityGroup** вы создали является минимальным требованием для выполнения этой процедуры.

#### <a name="to-validate-deployment-of-network-controller"></a>Для проверки развертывания сетевого контроллера

1.  На клиентском компьютере, при использовании Kerberos в качестве механизма допустимый войдите в систему с учетной записью пользователя, которая является членом вашей **ClientSecurityGroup**.

2. Откройте Windows PowerShell, введите следующие команды, чтобы добавить учетные данные для сетевого контроллера и нажмите клавишу ВВОД. Убедитесь, что добавлены значения для каждого параметра, которые подходят для развертывания.

    ```
    $cred=New-Object Microsoft.Windows.Networkcontroller.credentialproperties
    $cred.type="usernamepassword"
    $cred.username="admin"
    $cred.value="abcd"

    New-NetworkControllerCredential -ConnectionUri https://networkcontroller -Properties $cred -ResourceId cred1
    ```

3. Чтобы получить учетные данные, которые вы добавили в сетевой контроллер, введите следующую команду и нажмите клавишу ВВОД. Убедитесь, что добавлены значения для каждого параметра, которые подходят для развертывания.

    ```
    Get-NetworkControllerCredential -ConnectionUri https://networkcontroller -ResourceId cred1  
    ```

4. Просмотрите выходные данные, который должен быть в следующем примере вывод команды.

    ```
    Tags                   :
    ResourceRef     : /credentials/cred1
    CreatedTime    : 1/1/0001 12:00:00 AM
    InstanceId        : e16ffe62-a701-4d31-915e-7234d4bc5a18
    Etag                  : W/"1ec59631-607f-4d3e-ac78-94b0822f3a9d"
    ResourceMetadata :
    ResourceId       : cred1
    Properties       : Microsoft.Windows.NetworkController.CredentialProperties
    ```

    > [!NOTE]
    > При запуске **Get-NetworkControllerCredential** команды, можно назначить выходные данные команды в переменную, используя оператор-точка в список свойств учетных данных. Например, $cred. Свойства.

## <a name="bkmk_ps"></a>Дополнительные команды Windows PowerShell для сетевого контроллера

После развертывания сетевого контроллера можно использовать команды Windows PowerShell для управления и изменить для развертывания. Ниже приведены некоторые изменения, которые могут привести к развертыванию.

- Изменение сетевого контроллера узел кластера и параметры приложения

- Удаление кластера сетевой контроллер и приложения

- Управление сетевой контроллер узлов кластера, включая добавление, удаление, включение и отключение узлов.

Следующая таблица содержит синтаксис Windows PowerShell команды, использующиеся для выполнения этих задач.

|Задача|Команда|Синтаксис|
|--------|-------|----------|
|Изменение параметров кластера сетевого контроллера|Set-NetworkControllerCluster|`Set-NetworkControllerCluster [-ManagementSecurityGroup <string>][-Credential <PSCredential>] [-computerName <string>][-CertificateThumbprint <String> ] [-UseSSL]`
|Изменение параметров приложения сетевого контроллера|SET-NetworkController|`Set-NetworkController [-ClientAuthentication <ClientAuthentication>] [-Credential <PSCredential>] [-ClientCertificateThumbprint <string[]>] [-ClientSecurityGroup <string>] [-ServerCertificate <X509Certificate2>] [-RestIPAddress <String>] [-ComputerName <String>][-CertificateThumbprint <String> ] [-UseSSL]`
|Изменение параметров узла сетевого контроллера|Set-NetworkControllerNode|`Set-NetworkControllerNode -Name <string> > [-RestInterface <string>] [-NodeCertificate <X509Certificate2>] [-Credential <PSCredential>] [-ComputerName <string>][-CertificateThumbprint <String> ] [-UseSSL]`
|Изменение параметров диагностики сетевого контроллера|Set-NetworkControllerDiagnostic|`Set-NetworkControllerDiagnostic [-LogScope <string>] [-DiagnosticLogLocation <string>] [-LogLocationCredential <PSCredential>] [-UseLocalLogLocation] >] [-LogLevel <loglevel>][-LogSizeLimitInMBs <uint32>] [-LogTimeLimitInDays <uint32>] [-Credential <PSCredential>] [-ComputerName <string>][-CertificateThumbprint <String> ] [-UseSSL]`
|Удалите приложение для сетевого контроллера|Uninstall-NetworkController|`Uninstall-NetworkController [-Credential <PSCredential>][-ComputerName <string>] [-CertificateThumbprint <String> ] [-UseSSL]`
|Удалите кластер сетевого контроллера|Uninstall-NetworkControllerCluster|`Uninstall-NetworkControllerCluster [-Credential <PSCredential>][-ComputerName <string>][-CertificateThumbprint <String> ] [-UseSSL]`
|Добавление узла в кластер сетевого контроллера|Add-NetworkControllerNode|`Add-NetworkControllerNode -FaultDomain <String> -Name <String> -RestInterface <String> -Server <String> [-CertificateThumbprint <String> ] [-ComputerName <String> ] [-Credential <PSCredential> ] [-Force] [-NodeCertificate <X509Certificate2> ] [-PassThru] [-UseSsl]`
|Отключение узла кластера сетевого контроллера|Disable-NetworkControllerNode|`Disable-NetworkControllerNode -Name <String> [-CertificateThumbprint <String> ] [-ComputerName <String> ] [-Credential <PSCredential> ] [-PassThru] [-UseSsl]`
|Включить узел кластера сетевого контроллера|Enable-NetworkControllerNode|`Enable-NetworkControllerNode -Name <String> [-CertificateThumbprint <String> ] [-ComputerName <String> ] [-Credential <PSCredential> ] [-PassThru] [-UseSsl]`
|Удаление сетевой контроллер узла из кластера|Remove-NetworkControllerNode|`Remove-NetworkControllerNode [-CertificateThumbprint <String> ] [-ComputerName <String> ] [-Credential <PSCredential> ] [-Force] [-Name <String> ] [-PassThru] [-UseSsl]`

>[!NOTE]
>Команды Windows PowerShell, для сетевого контроллера, в библиотеке TechNet по [командлеты сетевого контроллера](https://technet.microsoft.com/library/mt576401.aspx).

## <a name="bkmk_script"></a>Пример сценария конфигурации сетевого контроллера

Следующий пример сценария конфигурации показано, как создать кластер с несколькими узлами сетевой контроллер и установка приложения для сетевого контроллера. Кроме того переменную $cert выбирает сертификат из хранилища сертификатов на локальном компьютере, совпадает со строкой имя субъекта «networkController.contoso.com».

```
$a = New-NetworkControllerNodeObject -Name Node1 -Server NCNode1.contoso.com -FaultDomain fd:/rack1/host1 -RestInterface Internal
$b = New-NetworkControllerNodeObject -Name Node2 -Server NCNode2.contoso.com -FaultDomain fd:/rack1/host2 -RestInterface Internal
$c = New-NetworkControllerNodeObject -Name Node3 -Server NCNode3.contoso.com -FaultDomain fd:/rack1/host3 -RestInterface Internal

$cert= get-item Cert:\LocalMachine\My | get-ChildItem | where {$_.Subject -imatch "networkController.contoso.com" }

Install-NetworkControllerCluster -Node @($a,$b,$c)  -ClusterAuthentication Kerberos -DiagnosticLogLocation \\share\Diagnostics - ManagementSecurityGroup Contoso\NCManagementAdmins -CredentialEncryptionCertificate $cert  
Install-NetworkController -Node @($a,$b,$c) -ClientAuthentication Kerberos -ClientSecurityGroup Contoso\NCRESTClients -ServerCertificate $cert -RestIpAddress 10.0.0.1/24
```

## <a name="bkmk_nonkerb"></a>После развертывания действия для не - Kerberos развертываний

Если вы не используете Kerberos при развертывании сетевого контроллера, необходимо развернуть сертификаты.

Дополнительные сведения см. в разделе [действия после развертывания для сетевого контроллера](../technologies/network-controller/post-deploy-steps-nc.md).


