---
title: Архитектура развертывания шлюза RAS-сервера
description: Дополнительные сведения о развертывании поставщика облачных служб (CSP) шлюза удаленного доступа в Windows Server 2016, включая пулы шлюза RAS, отражатели маршрута и развертывание нескольких шлюзов для отдельных клиентов, можно использовать в этом разделе.
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: d46e4e91-ece0-41da-a812-af8ab153edc4
ms.author: pashort
author: shortpatti
ms.openlocfilehash: a3895e25a2af0437deb9eebe4ad89b110cfc9f2b
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59870275"
---
# <a name="ras-gateway-deployment-architecture"></a>Архитектура развертывания шлюза RAS-сервера

>Относится к: Windows Server (полугодовой канал), Windows Server 2016

Дополнительные сведения о развертывании поставщика облачных служб (CSP) для шлюза RAS, включая пулы шлюза RAS, отражатели маршрута и развертывание нескольких шлюзов для отдельных клиентов, можно использовать в этом разделе.  
  
В следующих разделах приведен краткий обзор некоторых из новых функций шлюза RAS таким образом, чтобы понять, как использовать эти функции в проекте развертывания шлюза.  
  
Кроме того предоставляется пример развертывания, включая сведения о процессе добавления новых клиентов, синхронизации маршрута и маршрутизация плоскости данных, шлюза и отработки отказа рефлектор маршрутов и многое другое.  
  
Эта статья содержит следующие разделы.  
  
-   [С помощью новых функций шлюза RAS разработки развертывания](#bkmk_new)  
  
-   [Пример развертывания](#bkmk_example)  
  
-   [Добавление новых клиентов и пространство адресов (ЦС) клиента EBGP Пиринг](#bkmk_tenant)  
  
-   [Синхронизация маршрутов и данных плоскости маршрутизации](#bkmk_route)  
  
-   [Реакция сетевого контроллера для шлюза RAS и отработки отказа рефлектор маршрутов](#bkmk_failover)  
  
-   [Преимущества использования новых функций шлюза RAS](#bkmk_advantages)  
  
## <a name="bkmk_new"></a>С помощью новых функций шлюза RAS разработки развертывания  
Шлюз удаленного доступа включает несколько новых компонентов, которые изменяются и улучшить развертывание инфраструктуры шлюза в центре обработки данных.  
  
### <a name="bgp-route-reflector"></a>Объектом, отражающим маршрут BGP  
Возможность рефлектор маршрутов протокола пограничного шлюза (BGP) — теперь включена в шлюз RAS и представляет собой альтернативу BGP топология полной сетки, которая обычно необходима для синхронизации маршрута между маршрутизаторами. При синхронизации полной сетки всех маршрутизаторов BGP нужно подключить к всех маршрутизаторов в топологии маршрутизации. При использовании рефлектор маршрутов, тем не менее, объект, отражающий маршрута является только маршрутизатор подключается со всеми другими маршрутизаторами, вызывается объектом, отражающим маршрут BGP клиентов, тем самым упрощая синхронизации маршрутов и сократить объем сетевого трафика. Объект, отражающий маршрут определяет все маршруты, вычисляет оптимальные маршруты и перераспределяет оптимальные маршруты BGP клиентам.  
  
Дополнительные сведения см. в разделе [новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md).  
  
### <a name="bkmk_pools"></a>Пулы шлюза  
В Windows Server 2016 можно создать множество пулов шлюзов различных типов. Пулы шлюза содержат несколько экземпляров шлюза RAS и маршрутизации сетевого трафика между физическими и виртуальными сетями.  
  
Дополнительные сведения см. в разделе [новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md) и [высокий уровень доступности шлюза RAS](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md).  
  
### <a name="bkmk_gps"></a>Масштабируемость пула шлюза  
Можно легко масштабировать пул шлюзов вверх или вниз путем добавления или удаления виртуальных машин шлюза в пуле. Удаления или добавления шлюзов не нарушить работу службы, которые предоставляются с помощью пула. Кроме того, можно также добавлять и удалять весь пулов шлюзов.  
  
Дополнительные сведения см. в разделе [новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md) и [высокий уровень доступности шлюза RAS](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md).  
  
### <a name="bkmk_m"></a>Избыточность пула шлюза M + N  
Каждый пул шлюзов — избыточностью M + N. Это означает, что меня "число виртуальных машин шлюза active резервное копирование по номеру" n "виртуальные машины ожидания шлюза. M + N избыточность обеспечивает большую гибкость при определении уровня надежности, которые могут потребоваться при развертывании шлюза RAS.  
  
Дополнительные сведения см. в разделе [новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md) и [высокий уровень доступности шлюза RAS](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md).  
  
## <a name="bkmk_example"></a>Пример развертывания  
Ниже приведен пример с eBGP, пиринг через подключения VPN-сеть, настроенного между двух клиентов "," Contoso "и" Woodgrove "и" центра обработки данных Fabrikam CSP.  
  
![пиринг через VPN-Подключение сайт сайт eBGP](../../../media/RAS-Gateway-Deployment-Architecture/ras_gateway_architecture.png)  
  
В этом примере Contoso требует дополнительного шлюза пропускной способности, что приводит к проектному завершить Contoso Лос-Анджелес на GW3 вместо GW2 инфраструктуры шлюза. По этой причине Contoso VPN-подключений на различных сайтах закрыть в центре обработки данных CSP на двух различных шлюзов.  
  
Оба этих шлюзов, GW2 и GW3, были первой шлюзы RAS настроен сетевым контроллером, при добавлении CSP клиентов Contoso и Woodgrove своей инфраструктуры. По этой причине эти два шлюза настраиваются как отражатели маршрута для этих соответствующих клиентов (или клиенты). GW2 является объект, отражающий маршрута Contoso, которая GW3 Reflector маршрута Woodgrove - см. Кроме того, что точки завершения шлюза RAS CSP для VPN-подключения с сайтом штаб-Квартира Contoso Лос-Анджелесе.  
  
> [!NOTE]  
> Один шлюз RAS может направлять виртуальной и физической сетевой трафик для разных клиентов до 100 в зависимости от потребностей каждого клиента.  
  
Как отражатели маршрута GW2 отправляет пространстве ак Contoso маршруты для сетевого контроллера и GW3 отправляет пространстве ак Woodgrove маршруты для сетевого контроллера.  
  
Сетевой контроллер помещает политики виртуализации сети Hyper-V для компании Contoso и Woodgrove виртуальных сетей, а также политики удаленного доступа к шлюзам удаленного доступа и политики для Мультиплексоры (Мультиплексорами), настроенные как балансировку нагрузки программного обеспечения балансировки нагрузки пул.  
  
## <a name="bkmk_tenant"></a>Добавление новых клиентов и пространства адресов клиента (ак) eBGP Пиринга  
Когда вход нового клиента и добавления customer в качестве нового клиента в центре обработки данных, можно использовать следующий процесс, большая часть из которых выполняется автоматически маршрутизаторами eBGP сетевого контроллера и шлюза RAS.  
  
1.  Подготовьте новую виртуальную сеть и рабочие нагрузки в соответствии с требованиями вашего клиента.  
  
2.  При необходимости настройте удаленное подключение между удаленным клиентским Enterprise и их виртуальной сети в центре данных. При развертывании VPN-подключение сайт сайт для клиента, сетевого контроллера автоматически выбирает доступна виртуальная машина шлюза RAS из пула доступных шлюз и настраивает подключение.  
  
3.  При настройке виртуальной Машины шлюза удаленного доступа для нового клиента, сетевой контроллер также настраивает шлюза RAS как маршрутизатор BGP и определяет его как объект, отражающий маршрута для клиента. Это верно даже в случаях, где шлюза RAS служит как шлюз или шлюз и объектом, отражающим маршрут, для других клиентов.  
  
4.  В зависимости от того ЦС пространства настроена маршрутизация к сетям использование статической или динамической маршрутизации BGP сетевой контроллер настраивает соответствующие статические маршруты, соседями BGP или в виртуальной Машине шлюза RAS и объектом, отражающим маршрут.  
  
    > [!NOTE]  
    > -   Сетевой контроллер настроены шлюза RAS и объектом, отражающим маршрут для клиента, каждый раз, когда того же клиента требуется новое VPN-подключение сайт сайт, сетевой контроллер проверяет наличие доступной емкости на этой виртуальной Машине шлюза RAS. Если первый шлюз может обслуживать требуемая емкость, нового сетевого соединения также настраивается на одной и той же виртуальной Машине шлюза RAS. Если виртуальная машина шлюза удаленного доступа не может обрабатывать дополнительную емкость, сетевой контроллер выбирает новую доступных шлюза RAS виртуальную Машину и настраивает новое соединение на нем. Новую виртуальную Машину шлюза удаленного доступа, связанные с клиентом становится объектом, отражающим маршрут клиент исходного клиента рефлектор маршрутов шлюза RAS.  
    > -   Поскольку пулов шлюза RAS находятся за Балансировщиками нагрузки программного обеспечения (SLBs), вызывается адреса VPN-сеть клиентов, каждый из них использовать один общедоступный IP-адрес, вызывается виртуальный IP-адрес (VIP), которое было переведено с SLBs в центре обработки данных: внутренняя IP-адрес, динамический IP-адрес (DIP), для маршрутизации трафика для клиента корпоративного шлюза RAS. Этот сопоставления открытого и закрытого IP-адреса с SLB обеспечивает создание VPN-туннели сеть сеть правильно корпоративные сайты шлюзов RAS CSP и отражатели маршрута.  
    >   
    >     Дополнительные сведения о SLB, виртуальные IP-адреса и спадов, см. в разделе [программная Балансировка нагрузки &#40;SLB&#41; для SDN](../../../sdn/technologies/network-function-virtualization/Software-Load-Balancing--SLB--for-SDN.md).  
  
5.  Статические маршруты, которые связаны с туннели после сеть сеть VPN-туннель между сайтом Enterprise и центре обработки данных CSP, шлюз RAS устанавливается для нового клиента, будут автоматически добавляться на предприятия и CSP сторонах туннеля .  
  
6.  В пространстве ак BGP маршрутизации, eBGP, пиринг между сайтами Enterprise и отражатель маршрутов шлюза RAS CSP также устанавливается.  
  
## <a name="bkmk_route"></a>Синхронизация маршрутов и данных плоскости маршрутизации  
После eBGP пиринговую связь между сайтами Enterprise и отражатель маршрутов шлюза RAS CSP, объект, отражающий маршрута изучает все маршруты предприятия с помощью динамической маршрутизации BGP. Объект, отражающий маршрута синхронизирует эти маршруты между всеми клиентами объектом, отражающим маршрут таким образом, чтобы все они настроены с одинаковым набором маршрутов.  
  
Reflector маршрута также обновляет эти консолидированные маршруты с помощью синхронизации маршрутов для сетевого контроллера. Сетевой контроллер затем преобразует маршруты политик виртуализации сети Hyper-V и настраивает к сети структуры, чтобы обеспечить подготовку маршрутизации путь к данным End-to-End. Этот процесс делает клиента виртуальной сети, доступного в клиенте Enterprise сайтов.  
  
Для маршрутизации плоскости данных, пакеты, которые переданы в виртуальные машины шлюза RAS будете направлены непосредственно на виртуальной сети клиента, так как необходимые маршруты теперь доступны со всеми участвующими ВМ шлюза RAS.  
  
Аналогичным образом с помощью политик виртуализации сети Hyper-V на месте, виртуальной сети клиента маршрутизирует пакеты непосредственно к виртуальным машинам шлюза RAS (без необходимости знать о рефлектор маршрутов), а затем к сайтам предприятия через туннели VPN-сеть .  
  
В дополнение. обратный трафик из виртуальной сети клиента к сайту удаленного клиента Enterprise обходит SLBs, этот процесс называется прямой ответ от сервера (DSR).  
  
## <a name="bkmk_failover"></a>Реакция сетевого контроллера для шлюза RAS и отработки отказа рефлектор маршрутов  
Ниже приведены два возможных сценария — один для клиентов рефлектор маршрутов шлюза RAS - и один для отражатели маршрутов шлюза RAS включая сведения о том, как сетевой контроллер обрабатывает отработки отказа для виртуальных машин в конфигурации.  
  
### <a name="vm-failure-of-a-ras-gateway-bgp-route-reflector-client"></a>Сбой виртуальной Машины клиента объектом, отражающим маршрут BGP шлюза RAS  
Сетевой контроллер выполняет следующие действия при сбое клиента рефлектор маршрутов шлюза RAS.  
  
> [!NOTE]  
> Шлюз RAS не рефлектор маршрутов BGP инфраструктуры клиента, при клиент рефлектор маршрутов в инфраструктуре BGP клиента.  
  
-   Сетевой контроллер выбирает доступных резервной ВМ шлюза RAS и подготавливает новую виртуальную Машину шлюза RAS с конфигурацией сбоя виртуальной машины шлюза RAS.  
  
-   Сетевой контроллер обновляет соответствующую конфигурацию SLB, чтобы убедиться, что с помощью нового шлюза RAS, правильно настроены Туннели VPN-сеть из клиентских сайтов для шлюза RAS со сбоем.  
  
-   Сетевой контроллер настраивает клиент рефлектор маршрутов BGP на новый шлюз.  
  
-   Сетевой контроллер настраивает новый клиент объектом, отражающим маршрут BGP шлюза RAS как активные. Шлюз RAS немедленно запускает пиринг с Reflector маршрута клиента для совместного использования сведений о маршрутизации и включить пиринг eBGP для соответствующего узла Enterprise.  
  
### <a name="vm-failure-for-a-ras-gateway-bgp-route-reflector"></a>Сбой виртуальной Машины для рефлектор маршрутов BGP шлюза RAS  
Сетевой контроллер выполняет следующие действия при сбое рефлектор маршрутов BGP шлюза RAS.  
  
-   Сетевой контроллер выбирает доступных резервной ВМ шлюза RAS и подготавливает новую виртуальную Машину шлюза RAS с конфигурацией сбоя виртуальной машины шлюза RAS.  
  
-   Сетевой контроллер настраивает объект, отражающий маршрут к новой виртуальной машине шлюза RAS и присваивает новой виртуальной Машины тот же адрес, используемый Потерпевшем сбой, тем самым обеспечивая целостность маршрута в случае сбоя виртуальной Машины.  
  
-   Сетевой контроллер обновляет соответствующую конфигурацию SLB, чтобы убедиться, что с помощью нового шлюза RAS, правильно настроены Туннели VPN-сеть из клиентских сайтов для шлюза RAS со сбоем.  
  
-   Сетевой контроллер настроит новый RAS шлюз BGP маршрута Reflector виртуальную Машину как активные.  
  
-   Объект, отражающий маршрута немедленно становится активным. Установления туннеля VPN-сеть предприятия, а объект, отражающий маршрут используется пиринг eBGP и меняет местами маршруты с маршрутизаторами сайта предприятия.  
  
-   После выбора маршрутов BGP объектом, отражающим маршрут BGP шлюза RAS обновления клиента рефлектор маршрутов клиентов в центре обработки данных и синхронизирует маршруты с сетевым контроллером, предоставление пути данных End-to-End для трафика клиентов.  
  
## <a name="bkmk_advantages"></a>Преимущества использования новых функций шлюза RAS  
Ниже приведены некоторые из преимуществ использования этих новых функций шлюза RAS при проектировании развертывания шлюза RAS.  
  
**Масштабируемость шлюза RAS**  
  
Так как можно добавить столько RAS виртуальные машины шлюза для шлюза RAS пулы, можно легко масштабировать развертывания шлюза RAS для оптимизации производительности и емкости. При добавлении виртуальных машин в кластер, можно настроить эти шлюзы RAS сеть сеть VPN-подключения любого типа (IKEv2, L3, GRE), чтобы исключить падению производительности без задержки.  
  
**Упрощенное Enterprise узла шлюза управления**  
  
Если у клиента есть несколько сайтов предприятия, клиента можно настроить все сайты с одним адресом удаленного IP-адрес VPN-сеть и IP-адрес одного удаленного соседа - центра обработки данных CSP шлюза RAS BGP объектом, отражающим маршрут виртуального IP-адреса для этого клиента. Это упрощает управление шлюза для клиентов.  
  
**Быстрое исправление сбоя шлюза**  
  
Чтобы обеспечить быструю отработку отказа ответ, можно настроить время параметр BGP Keepalive между edge маршруты и управления маршрутизатором на короткое время интервала, например меньше или равно 10 секундам. Этот короткий интервал проверки активности пограничный маршрутизатор BGP шлюза удаленного доступа в случае сбоя быстро обнаружения сбоя и сетевого контроллера, следует за действия, описанные в предыдущих разделах. Это преимущество может снизить потребность в протокол обнаружения сбоев отдельных, например протокол обнаружения пересылки двунаправленный (BFD).  
  
 
  


