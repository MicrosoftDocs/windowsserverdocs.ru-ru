---
title: Архитектура развертывания шлюза RAS-сервера
description: С помощью этого раздела вы узнаете о развертывании поставщика облачных служб (CSP) в Windows Server 2016, включая пулы шлюзов RAS, отражения маршрутов и развертывание нескольких шлюзов для отдельных клиентов.
manager: grcusanz
ms.prod: windows-server
ms.technology: networking-sdn
ms.topic: get-started-article
ms.assetid: d46e4e91-ece0-41da-a812-af8ab153edc4
ms.author: anpaul
author: AnirbanPaul
ms.openlocfilehash: 1704cd6d933af1e796a9ac1237ff2de3a49fb3d3
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80859607"
---
# <a name="ras-gateway-deployment-architecture"></a>Архитектура развертывания шлюза RAS-сервера

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

С помощью этого раздела вы узнаете о развертывании поставщика облачных служб (CSP), включая пулы шлюзов RAS, отражения маршрутов и развертывание нескольких шлюзов для отдельных клиентов.  
  
В следующих разделах приведены краткие обзоры некоторых новых функций шлюза RAS, позволяющие понять, как использовать эти функции в проектировании развертывания шлюза.  
  
Кроме того, предоставляется пример развертывания, в том числе сведения о процессе добавления новых клиентов, синхронизации маршрутов и маршрутизации плоскости данных, отработке отказа для отражения шлюза и маршрута, а также многое другое.  
  
В этом разделе содержатся следующие подразделы:  
  
-   [Использование новых функций шлюза RAS для проектирования развертывания](#bkmk_new)  
  
-   [Пример развертывания](#bkmk_example)  
  
-   [Добавление новых клиентов и пространства (CA) EBGP пиринга](#bkmk_tenant)  
  
-   [Синхронизация маршрутов и маршрутизация на плоскости данных](#bkmk_route)  
  
-   [Как сетевой контроллер отвечает на шлюз RAS и отработку отказа для отражения маршрута](#bkmk_failover)  
  
-   [Преимущества использования новых функций шлюза RAS](#bkmk_advantages)  
  
## <a name="using-ras-gateway-new-features-to-design-your--deployment"></a><a name="bkmk_new"></a>Использование новых функций шлюза RAS для проектирования развертывания  
Шлюз RAS включает несколько новых функций, которые изменяют и улучшают способ развертывания инфраструктуры шлюза в центре обработки данных.  
  
### <a name="bgp-route-reflector"></a>Отражатель маршрутов BGP  
Функция отражения маршрутов протокол BGP (BGP) теперь включена в шлюз RAS и предоставляет альтернативу топологии полной сетки BGP, которая обычно требуется для синхронизации маршрутов между маршрутизаторами. При полной синхронизации с сеткой все маршрутизаторы BGP должны подключаться ко всем другим маршрутизаторам в топологии маршрутизации. Однако при использовании отражателя маршрутов отражатель маршрутизации является единственным маршрутизатором, который соединяется со всеми другими маршрутизаторами, называемыми клиентами отражателя маршрутов BGP, тем самым упрощая синхронизацию маршрутов и уменьшая сетевой трафик. Отражатель маршрутов изучает все маршруты, рассчитывает лучшие маршруты и распространяет лучшие маршруты клиентам BGP.  
  
Дополнительные сведения см. [в разделе новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md).  
  
### <a name="gateway-pools"></a><a name="bkmk_pools"></a>Пулы шлюзов  
В Windows Server 2016 можно создать множество пулов шлюзов различных типов. Пулы шлюзов содержат множество экземпляров шлюза RAS и направляют сетевой трафик между физическими и виртуальными сетями.  
  
Дополнительные сведения см. [в разделе новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md) и [высокий уровень доступности шлюза RAS](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md).  
  
### <a name="gateway-pool-scalability"></a><a name="bkmk_gps"></a>Масштабируемость пула шлюзов  
Вы можете легко масштабировать пул шлюзов, добавляя или удаляя виртуальные машины шлюза в пуле. Удаление или добавление шлюзов не приводит к нарушению работы служб, предоставляемых пулом. Также можно добавлять и удалять целые пулы шлюзов.  
  
Дополнительные сведения см. [в разделе новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md) и [высокий уровень доступности шлюза RAS](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md).  
  
### <a name="mn-gateway-pool-redundancy"></a><a name="bkmk_m"></a>Избыточность пула шлюзов M + N  
Каждый пул шлюзов имеет резервирование M + N. Это означает, что количество виртуальных машин активного шлюза зарезервировано числом "N" виртуальных машин резервного шлюза. Резервирование M + N обеспечивает большую гибкость при определении уровня надежности, который требуется при развертывании шлюза RAS.  
  
Дополнительные сведения см. [в разделе новые возможности шлюза RAS](../../../sdn/technologies/network-function-virtualization/What-s-New-in-RAS-Gateway.md) и [высокий уровень доступности шлюза RAS](../../../sdn/technologies/network-function-virtualization/RAS-Gateway-High-Availability.md).  
  
## <a name="example-deployment"></a><a name="bkmk_example"></a>Пример развертывания  
На следующем рисунке приведен пример с eBGP пиринга по VPN-подключениям типа "сеть — сеть", настроенным между двумя клиентами, Contoso и Woodgrove и центром обработки данных Fabrikam CSP.  
  
![eBGP пиринга через VPN-подключение типа "сеть — сеть"](../../../media/RAS-Gateway-Deployment-Architecture/ras_gateway_architecture.png)  
  
В этом примере компании Contoso требуется дополнительная пропускная способность шлюза, ведущая к решению инфраструктуры шлюза для завершения работы сайта Contoso Лос-Анджелес на GW3 вместо GW2. По этой причине VPN-подключения Contoso из разных сайтов прерываются в центре обработки данных CSP на двух разных шлюзах.  
  
Оба шлюза, GW2 и GW3, являются первыми шлюзами RAS, настроенными сетевым контроллером, когда CSP добавил клиенты Contoso и Woodgrove в инфраструктуру. По этой причине эти два шлюза настраиваются в качестве Отражательов маршрутов для соответствующих клиентов (или клиентов). GW2 — это отражатель Contoso Route, а GW3 — это, помимо того, что точка прерывания шлюза RAS для VPN-подключения с сайтом Contoso Лос-Анджелес.  
  
> [!NOTE]  
> Один шлюз RAS может маршрутизировать виртуальный и физический сетевой трафик для 100 разных клиентов в зависимости от требований к пропускной способности каждого клиента.  
  
В качестве отражательных передаваемых маршрутов GW2 отправляет маршруты пространства ЦС Contoso в сетевой контроллер, а GW3 отправляет маршруты пространства ЦС Woodgrove в сетевой контроллер.  
  
Сетевой контроллер отправляет политики виртуализации сети Hyper-V в виртуальные сети Contoso и Woodgrove, а также политики RAS к шлюзам RAS и политикам балансировки нагрузки для мультиплексоров (мультиплексоров), настроенных в качестве программной балансировки нагрузки. подключений.  
  
## <a name="adding-new-tenants-and-customer-address-ca-space-ebgp-peering"></a><a name="bkmk_tenant"></a>Добавление новых клиентов и пространства (CA) eBGP пиринга  
При подписании нового клиента и добавлении клиента в качестве нового клиента в ваш центр обработки данных можно использовать следующий процесс, который многие из них автоматически выполняются с помощью сетевого контроллера и маршрутизаторов eBGP шлюза RAS.  
  
1.  Подготавливает новую виртуальную сеть и рабочие нагрузки в соответствии с требованиями клиента.  
  
2.  При необходимости настройте удаленное подключение между сайтом удаленного клиента предприятия и их виртуальной сетью в центре обработки данных. При развертывании VPN-подключения типа "сеть — сеть" для клиента сетевой контроллер автоматически выбирает доступную виртуальную машину шлюза RAS из доступного пула шлюзов и настраивает подключение.  
  
3.  При настройке виртуальной машины шлюза RAS для нового клиента сетевой контроллер также настраивает шлюз RAS в качестве маршрутизатора BGP и назначает его в качестве отражателя маршрутов для клиента. Это справедливо даже в тех случаях, когда шлюз RAS выступает в качестве шлюза, а также в качестве шлюза и отражателя маршрутов для других клиентов.  
  
4.  В зависимости от того, настроена ли маршрутизация на место ЦС для использования статически настроенных сетей или динамической маршрутизации BGP, сетевой контроллер настраивает соответствующие статические маршруты, соседи BGP или и то, и другое на виртуальной машине шлюза RAS и в Отражателье маршрутизации.  
  
    > [!NOTE]  
    > -   После того как сетевой контроллер настроил шлюз RAS и отражатель маршрутизации для клиента, каждый раз, когда для того же клиента требуется новое VPN-подключение типа "сеть — сеть", сетевой контроллер проверяет наличие доступной емкости на этой виртуальной машине шлюза RAS. Если исходный шлюз может обслуживать требуемую емкость, новое сетевое подключение также настраивается на той же виртуальной машине шлюза удаленного доступа. Если виртуальная машина шлюза RAS не может справиться с дополнительной емкостью, сетевой контроллер выбирает новую доступную виртуальную машину шлюза RAS и настраивает новое подключение. Эта новая виртуальная машина шлюза RAS, связанная с клиентом, станет клиентом отражателя маршрута исходного клиента, отражающего маршрут шлюза RAS.  
    > -   Так как пулы шлюзов шлюза находятся за подсистемами балансировки нагрузки программного обеспечения (Слбс), VPN-адреса типа "сеть — сеть" клиента используют один общедоступный IP-адрес, называемый виртуальным IP-адресом (VIP), который преобразуется Слбс в центр обработки данных — внутренний IP-адрес, называемый динамический IP-адрес (DIP) для шлюза RAS, который направляет трафик для корпоративного клиента. Это сопоставление общедоступного IP-адреса с помощью SLB гарантирует правильную установку VPN-туннелей типа "сеть — сеть" между корпоративными сайтами и шлюзами RAS CSP и перенаправлениями маршрутов.  
    >   
    >     Дополнительные сведения о SLB, VIP и DIP см. в разделе [Программная &#40;балансировка&#41; нагрузки SLB для Sdn](../../../sdn/technologies/network-function-virtualization/Software-Load-Balancing--SLB--for-SDN.md).  
  
5.  После того как туннель VPN типа "сеть — сеть" между сайтом предприятия и шлюзом службы "центр обработки данных CSP" будет установлен для нового клиента, статические маршруты, связанные с туннелем, будут автоматически подготовлены на обеих сторонах туннеля — на предприятии и в CSP. .  
  
6.  При использовании маршрутизации BGP на уровне ЦС также устанавливается пиринг eBGP между корпоративными сайтами и отражением для маршрутизации шлюза RAS поставщика.  
  
## <a name="route-synchronization-and-data-plane-routing"></a><a name="bkmk_route"></a>Синхронизация маршрутов и маршрутизация на плоскости данных  
После установки пиринга eBGP между корпоративными сайтами и отражением поставщика шлюза RAS CSP, отражатель маршрутов будет изучать все корпоративные маршруты с помощью динамической маршрутизации BGP. Отражатель маршрутов синхронизирует эти маршруты между всеми клиентами отражателя маршрута, чтобы они были настроены с одинаковым набором маршрутов.  
  
Отражатель маршрутов также обновляет эти консолидированные маршруты, используя синхронизацию маршрутов, к сетевому контроллеру. Затем сетевой контроллер преобразует маршруты в политики виртуализации сети Hyper-V и настраивает сеть структуры, чтобы обеспечить подготовку сквозной маршрутизации пути к данным. Этот процесс делает виртуальную сеть клиента доступной с сайтов клиентов предприятия.  
  
Для маршрутизации на уровне данных пакеты, которые попадают на виртуальные машины шлюза RAS, напрямую направляются в виртуальную сеть клиента, так как необходимые маршруты теперь доступны для всех участвующих в нем виртуальных машин шлюза RAS.  
  
Аналогично, благодаря политикам виртуализации сети Hyper-V клиентская виртуальная сеть направляет пакеты непосредственно на виртуальные машины шлюза RAS (без необходимости узнавать об использовании отражателя маршрута), а затем на корпоративные сайты по туннелям VPN типа "сеть — сеть". .  
  
В дополнение. Верните трафик из виртуальной сети клиента на корпоративный сайт удаленного клиента, минуя Слбс, процесс, именуемый прямым возвратом сервера (DSR).  
  
## <a name="how-network-controller-responds-to-ras-gateway-and-route-reflector-failover"></a><a name="bkmk_failover"></a>Как сетевой контроллер отвечает на шлюз RAS и отработку отказа для отражения маршрута  
Ниже приведены два возможных сценария отработки отказа: один для клиентов-интерфейсов отражения шлюза RAS и один для отражения маршрутов шлюза RAS. в том числе сведения о том, как сетевой контроллер обрабатывает отработку отказа для виртуальных машин в любой конфигурации.  
  
### <a name="vm-failure-of-a-ras-gateway-bgp-route-reflector-client"></a>Сбой виртуальной машины клиента отражения маршрутизации BGP для шлюза RAS  
Сетевой контроллер выполняет следующие действия при сбое клиента-устройства отражения шлюза RAS.  
  
> [!NOTE]  
> Если шлюз RAS не является отражателем маршрутизации для инфраструктуры BGP клиента, это клиент-отражатель маршрутизации в инфраструктуре BGP клиента.  
  
-   Сетевой контроллер выбирает доступную виртуальную машину резервного шлюза RAS и подготавливает новую виртуальную машину шлюза RAS с конфигурацией неисправной виртуальной машины шлюза RAS.  
  
-   Сетевой контроллер обновляет соответствующую конфигурацию SLB, чтобы обеспечить правильное подключение VPN-туннелей типа "сеть — сеть" с сайтов клиента к сбойному шлюзу RAS с помощью нового шлюза RAS.  
  
-   Сетевой контроллер настраивает клиент отражателя маршрутов BGP на новом шлюзе.  
  
-   Сетевой контроллер настраивает новый клиент отражения маршрутов BGP для шлюза RAS как активный. Шлюз RAS немедленно начинает пиринг с Отражательом маршрута клиента для совместного использования сведений о маршрутизации и включения пиринга eBGP для соответствующего корпоративного сайта.  
  
### <a name="vm-failure-for-a-ras-gateway-bgp-route-reflector"></a>Сбой виртуальной машины для отражения маршрута BGP для шлюза RAS  
Сетевой контроллер выполняет следующие действия при сбое отражения маршрута BGP для шлюза RAS.  
  
-   Сетевой контроллер выбирает доступную виртуальную машину резервного шлюза RAS и подготавливает новую виртуальную машину шлюза RAS с конфигурацией неисправной виртуальной машины шлюза RAS.  
  
-   Сетевой контроллер настраивает отражение маршрутов на новой виртуальной машине шлюза RAS и назначает новой виртуальной машине тот же IP-адрес, который использовался неисправным виртуальным машинам, тем самым обеспечивая целостность маршрута, несмотря на сбой виртуальной машины.  
  
-   Сетевой контроллер обновляет соответствующую конфигурацию SLB, чтобы обеспечить правильное подключение VPN-туннелей типа "сеть — сеть" с сайтов клиента к сбойному шлюзу RAS с помощью нового шлюза RAS.  
  
-   Сетевой контроллер настраивает новую виртуальную машину для отражения маршрутов BGP для шлюза RAS как активная.  
  
-   Отражение маршрута немедленно становится активным. Устанавливается туннель VPN типа "сеть — сеть" для предприятия, а отражатель маршрутов использует eBGP пиринг и Обмен маршрутами с маршрутизаторами корпоративного сайта.  
  
-   После выбора маршрута BGP сервер отразит маршрут BGP шлюза RAS обновляет клиентские клиенты-отражать в центре обработки данных и синхронизирует маршруты с сетевым контроллером, делая сквозной путь к данным доступным для трафика клиента.  
  
## <a name="advantages-of-using-new-ras-gateway-features"></a><a name="bkmk_advantages"></a>Преимущества использования новых функций шлюза RAS  
Ниже приведены некоторые преимущества использования этих новых функций шлюза RAS при проектировании развертывания шлюза удаленного доступа.  
  
**Масштабируемость шлюза RAS**  
  
Так как вы можете добавить столько виртуальных машин шлюза RAS, сколько требуется для пулов шлюзов RAS, можно легко масштабировать развертывание шлюза службы удаленного доступа для оптимизации производительности и емкости. При добавлении виртуальных машин в пул эти шлюзы RAS можно настроить с помощью VPN-подключений типа "сеть — сеть" любого вида (IKEv2, L3, GRE), устраняя узкие места в ресурсах без простоя.  
  
**Упрощенное управление шлюзом сайта предприятия**  
  
Если у клиента несколько корпоративных сайтов, клиент может настроить все сайты с одним удаленным IP-адресом VPN типа "сеть — сеть" и одним удаленным соседним IP-адресом. ваш центр обработки данных CSP шлюза RAS для этого клиента. Это упрощает управление шлюзами для клиентов.  
  
**Быстрое исправление сбоев шлюза**  
  
Чтобы обеспечить быстрое реагирование на отработку отказа, можно настроить время для параметра проверки активности BGP между граничными маршрутами и маршрутизатором управления на короткий интервал времени, например меньше или равное десяти секундам. Этот интервал короткого проверки активности, если пограничным маршрутизатором BGP шлюза RAS завершается сбоем, быстро обнаруживается сбой и сетевой контроллер выполняет действия, описанные в предыдущих разделах. Это преимущество может снизить потребность в отдельном протоколе обнаружения сбоев, таком как протокол обнаружения двунаправленной переадресации (БФД).  
  
 
  


