---
title: Высокая доступность шлюза RAS-сервера
description: В этом разделе можно использовать для изучения конфигураций высокой доступности для Мультитенантного шлюза RAS-сервера для программного обеспечения конфигурируемые сети (SDN) в Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 34d826c9-65bc-401f-889d-cf84e12f0144
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 48794ff8312ca00eda25f6d8bdca9929fc47084f
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="ras-gateway-high-availability"></a>Высокая доступность шлюза RAS-сервера

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе можно использовать для изучения конфигураций высокой доступности для Мультитенантного шлюза RAS-сервера для программно-конфигурируемые сети (SDN).  
  
Этот раздел содержит следующие разделы.  
  
-   [Обзор шлюза RAS-сервера](#bkmk_overview)  
  
-   [Обзор пулов шлюза](#bkmk_pools)  
  
-   [Обзор развертывания шлюза RAS-сервера](#bkmk_deployment)  
  
-   [Интеграция шлюза RAS-сервера с помощью сетевого контроллера](#bkmk_integration)  
  
## <a name="bkmk_overview"></a>Обзор шлюза RAS-сервера  
Если ваша организация — поставщик облачных услуг (CSP) или предприятия с помощью нескольких клиентов, вы можете развернуть шлюз удаленного доступа в мультитенантном режиме для маршрутизации сетевого трафика и из виртуальными и физическими сетями, включая Интернет.  
  
Вы можете развернуть шлюз удаленного доступа в мультитенантном режиме виде пограничного шлюза для маршрутизации трафика клиента клиента сети, для клиента виртуальных сетей и ресурсы.  
  
При развертывании нескольких экземпляров виртуальные машины шлюза RAS-сервера, высокий уровень доступности и отработки отказа вы развертываете пула шлюза. В Windows Server 2012 R2 со шлюзом виртуальные машины форматом одного пула, которое было немного сложно логическое разделение развертывания шлюза.  Шлюз Windows Server 2012 R2 предлагаться развертывания избыточностью 1:1 для шлюза виртуальных машин, которые привели к находящиеся на стадии использования доступной емкости для сайта к сайту (S2S) подключений VPN.  
  
Эта проблема будет устранена в Windows Server 2016 предоставляет несколько пулов шлюз - которого могут быть разных типов для логического разделения. Новый режим избыточности + N, M позволяет более эффективно конфигурацию отработки отказа.  
  
Дополнительные общие сведения о шлюза RAS-сервера см. в разделе [шлюза RAS-сервера](../../../../remote/remote-access/ras-gateway/RAS-Gateway.md).  
  
## <a name="bkmk_pools"></a>Обзор пулов шлюза  
В Windows Server 2016 вы можете развернуть шлюзов в один или несколько пулов.  
  
На следующем рисунке показано различных типов пулов шлюза маршрутизацию трафика между виртуальными сетями.  
  
![Пулы шлюза RAS-сервера](../../../media/RAS-Gateway-High-Availability/ras_pools.png)  
  
Каждый пул имеет следующие свойства.  
  
-   Каждый пул может избыточных M + N. Это означает, что меня "число виртуальных машин шлюза active создаются резервные копии номеру 'N' ожидания шлюза для виртуальных машин. Значение N (ожидания шлюзов), всегда является меньше или равно M (активные шлюзы).  
  
-   Пул позволяет выполнять функции шлюза отдельных — все эти функции можно выполнять Internet Key Exchange версии 2 (IKEv2) S2S, третьего уровня (уровня 3) и Generic Routing Encapsulation (GRE) - или пула.  
  
-   Можно назначить один общий IP-адрес, для всех пулов или подмножество этих пулов. Выполнив, значительно уменьшает количество общих IP-адресов, которые необходимо использовать, так как для всех клиентов в облаке на один IP-адрес подключения. В разделе ниже на высокий уровень доступности и балансировку нагрузки описывает, как это работает.  
  
-   Можно легко масштабировать пула шлюза вверх или вниз, добавив или удалив виртуальные машины шлюза в пуле. Удаления или добавления шлюзов не прерывает выполнение службы, которые поставляются с помощью пула. Можно также добавить и удалить весь пулы шлюзов.  
  
-   На несколько пулов, а также несколько шлюзов в пуле может завершить подключений одного клиента. Тем не менее если клиент имеет подключений, в завершение **все** пула шлюза, введите его не удается подписаться на другие **все** типа или типа отдельных шлюза пулов.  
  
Пулы шлюза также предоставляют возможность включить дополнительные сценарии:  
  
-   Пулы одного клиента — можно создать один пул для использования одного клиента.  
  
-   Если вы продаете облачных служб по каналам партнеров (reseller), можно создать отдельные наборы пулов для каждого торгового посредника.  
  
-   Несколько пулов может предоставить такую же функцию шлюза, но различные мощности. Например можно создать пул шлюза, который поддерживает высокой пропускной способностью и низкой пропускной способности IKEv2 S2S-подключений.  
  
## <a name="bkmk_deployment"></a>Обзор развертывания шлюза RAS-сервера  
На следующем рисунке показана типичное развертывание поставщика облачных услуг (CSP) для шлюза RAS-сервера.  
  
![Обзор развертывания шлюза RAS-сервера](../../../media/RAS-Gateway-High-Availability/ras_csp_deploy.png)  
  
Этот тип развертывания шлюза пулы развертываются за программного обеспечения нагрузки балансировки (SLB), который позволяет CSP назначить один общий IP-адрес для всего развертывания. Несколько подключения клиента к шлюзу можно прерывать несколько пулов шлюз -, а также несколько шлюзов в пуле. Это показано через IKEv2 S2S-подключений на схеме выше, но в то же самое применимо к другим функциям шлюза слишком, такие как шлюзы уровня 3 и GRE.  
  
На рисунке MT BGP устройство работает с протоколом BGP Мультитенантного шлюза RAS-сервера. BGP на мультитенантном используется для динамической маршрутизации. Маршрутизация для клиента содержится - единый, называемый рефлектора маршрутов (RR), обрабатывает пиринг BGP так, для всех сайтов клиента. Запись Ресурса сам распределяется между всех шлюзов в пуле. Это приводит к конфигурации, где завершения подключения клиентов (путь к данным) на несколько шлюзов, но RR для клиента (BGP пиринга точка - путь к элементу управления) только на одном из шлюзов.  
  
Маршрутизатор BGP отделена схеме для отображения этой централизованной маршрутизации концепции. Реализация BGP шлюза также предоставляет транзитной маршрутизацией, что позволяет в облако, чтобы выступать в качестве точки транзитной маршрутизации между сайтами два клиента. Эти возможности BGP применимы ко всем функциям шлюза.  
  
## <a name="bkmk_integration"></a>Интеграция шлюза RAS-сервера с помощью сетевого контроллера  
Шлюз RAS-сервера полностью интегрированы с сетевым контроллером в Windows Server 2016. При развертывании шлюза RAS-сервера и сетевого контроллера сетевой контроллер выполняет следующие функции.  
  
-   Развертывание пулов шлюза  
  
-   Конфигурации подключений клиентов на всех шлюзов  
  
-   Переключение сетевой трафик передается ожидания шлюза в случае сбоя шлюза  
  
Подробные сведения о шлюза RAS-сервера и сетевого контроллера в следующих разделах.  
  
-   [Подготовка и балансировка нагрузки для подключения к шлюзу (IKEv2, уровня 3 и GRE)](#bkmk_provisioning)  
  
-   [Высокая доступность для IKEv2 S2S](#bkmk_ike)  
  
-   [Высокая доступность для GRE](#bkmk_gre)  
  
-   [Высокая доступность для уровня 3 переадресации шлюзов](#bkmk_l3)  
  
### <a name="bkmk_provisioning"></a>Подготовка и балансировка нагрузки для подключения к шлюзу (IKEv2, уровня 3 и GRE)  
Когда клиент запрашивает подключения шлюза, запрос отправляется для сетевого контроллера. Сетевой контроллер настраивается с использованием сведений обо всех пулов шлюза, включая емкость каждого пула и каждые шлюза в каждом пуле. Сетевой контроллер выбирает правильный пула и шлюз для подключения. Этот выбор основана на требование пропускной способности для подключения. Сетевой контроллер использует алгоритм «наилучшего» для эффективного выбора подключения в пуле. Если это первое подключение клиента точке пиринга BGP для подключения также назначенный в данный момент.  
  
Сетевой контроллер выбрал шлюза RAS-сервера для подключения, сетевой контроллер предоставляет необходимые конфигурации для подключения шлюза. Если подключение установлено подключение к IKEv2 S2S, сетевой контроллер также подготавливает правила преобразования сетевых адресов (NAT) в пуле SLB; Это правило NAT в пуле SLB направляет запросы на подключение от клиента к шлюзу назначенного. Клиенты, различаются по исходный IP-адрес, который должен быть уникальным.  
  
> [!NOTE]  
> Подключения уровня 3 и GRE обходить SLB и подключаться напрямую с назначенным шлюза RAS-сервера.  Эти подключения требуют, что маршрутизатор удаленной конечной точки (или другого устройства сторонних производителей) должны быть правильно настроены для подключения к шлюза RAS-сервера.  
  
Если включена маршрутизация BGP для подключения, то пиринга BGP инициируется шлюза RAS - и маршруты передаются между локальной средой и облаком шлюзы. Сетевой контроллер отправляются маршруты запоминания BGP (или, которые статически настроенных маршрутов, если не используется BGP). Сетевой контроллер затем настраивает маршруты до узлов Hyper-V, на которых установлены виртуальным машинам. На этом этапе трафика клиентов можно перенаправлять на правильный на локальном сайте. Сетевой контроллер также создает соответствующие политики виртуализации сети Hyper-V, укажите расположения шлюз и настраивает их вниз, чтобы узлы Hyper-V.  
  
### <a name="bkmk_ike"></a>Высокая доступность для IKEv2 S2S  
Шлюз RAS-сервера в пул состоит из подключений и пиринга BGP различных клиентов. Каждый пул имеет меня "Активные шлюзы и перехода в режим ожидания шлюзов 'N'.  
  
Сетевой контроллер обрабатывает сбой шлюзов следующим образом.  
  
-   Сетевой контроллер постоянно проверок шлюзы во всех пулах и может обнаруживать шлюза, сбой или сбой. Сетевой контроллер позволяет обнаружить следующие типы ошибок шлюза RAS-сервера.  
  
    -   Сбой виртуальной Машины шлюза RAS-сервера  
  
    -   Сбой узла Hyper-V, на котором работает шлюз RAS-сервера  
  
    -   Ошибка службы шлюза RAS-сервера  
  
    Сетевой контроллер хранит конфигурацию всех развернутых активные шлюзы. Настройка включает в себя параметры подключения и маршрутизации.  
  
-   В случае сбоя шлюза влияет на подключения клиентов на шлюзе, а также для подключений клиентов, расположенных на другие шлюзы, но которого RR находится на сбой шлюза. Вниз время последний подключений меньше первый из них. Сетевой контроллер, обнаружив неудачных шлюза, он выполняет следующие задачи.  
  
    -   Удаляет маршруты затронутых подключений из вычислительных узлов.  
  
    -   Удалит все политики виртуализации сети Hyper-V, на этих узлах.  
  
    -   Выбирает ожидания шлюза, преобразует его в active шлюза и настраивает шлюза.  
  
    -   Изменение сопоставлений NAT в пуле SLB для указания подключения к новый шлюз.  
  
-   Одновременно на новый шлюз active появляется конфигурацию, IKEv2 S2S-подключений и пиринга BGP, снова устанавливается. Подключения и пиринга BGP может инициироваться облака шлюза или шлюза локальными. Шлюзами обновите маршруты и отправлять их сетевого контроллера. После сетевой контроллер определяет новый маршруты, обнаружение, шлюзов, сетевой контроллер отправляет маршруты и соответствующие политики виртуализации сети Hyper-V для узлов Hyper-V которых размещаются виртуальные машины клиентов затронуты сбоя. Это действие сетевой контроллер аналогично для случая новой установки подключения, оно возникает только увеличить масштаб.  
  
### <a name="bkmk_gre"></a>Высокая доступность для GRE  
Процесс отработки отказа ответ шлюза RAS-сервера, сетевой контроллер - включая обнаружения сбоев копирования подключения и маршрутизации для перехода в режим ожидания шлюза, конфигурации отработки отказа маршрутизации BGP или статического затронутых подключения (включая изъятия и повторно коммуникации маршрутов на вычислительные узлы и повторно пиринга BGP) и повторной настройки политик виртуализации сети Hyper-V на узлах вычислительного - идентичен шлюзов GRE и подключений. Повторную установку подключений GRE происходит по-разному, но и решений высокой доступности для GRE имеет некоторые дополнительные требования.  
  
![Высокая доступность для GRE](../../../media/RAS-Gateway-High-Availability/ras_ha.png)  
  
Во время развертывания шлюза для каждой виртуальной Машины шлюза RAS-сервера назначается динамического IP-адреса (DIP). Кроме того каждый шлюз виртуальной Машины также назначается виртуальный IP-адрес (VIP) для обеспечения высокой доступности GRE. Виртуальные IP-адреса назначаются только для шлюзов в пулах носителей, которые могут принимать подключения GRE, а не в пулах не GRE. Назначить виртуальные IP объявлены в верхнюю часть стоечного коммутаторы с помощью протокола BGP, в которой дальнейшей объявляет виртуальные IP-адреса в облаке физической сети. Это делает шлюзами доступен из удаленного маршрутизаторы или устройств сторонних производителей файлу абонент GRE подключения. Пиринг BGP отличается от пиринг для exchange клиента маршрутов BGP уровне клиента.  
  
Во время подготовки GRE подключения сетевой контроллер выбирает шлюза, настраивает GRE endpoint на шлюза и обратно Возвращает виртуальный IP-адрес, назначенный шлюза. Это VIP затем настраивается как конечный адрес туннеля GRE удаленного маршрутизатора.  
  
В случае сбоя шлюза сетевой контроллер копирует виртуальный IP-адрес шлюза неудачных и другие конфигурационные данные для перехода в режим ожидания шлюза. После перехода в режим ожидания шлюза становится активным, он объявляет виртуальных IP-адресов для своего коммутатора TOR и дальнейшее в физической сети. Удаленные маршрутизаторы по-прежнему подключения туннели GRE же виртуальных IP-адресов и маршрутизации инфраструктура гарантирует, что пакеты направляются новый шлюз active.  
  
### <a name="bkmk_l3"></a>Высокая доступность для уровня 3 переадресации шлюзов  
Шлюз переадресации уровня 3 виртуализации сети Hyper-V является моста между физической инфраструктуры центра обработки данных и виртуальной инфраструктурой в облаке виртуализации сети Hyper-V. Для мультитенантного шлюза переадресации уровня 3 каждого клиента использует собственный виртуальной ЛС с тегами логической сети для подключения к физической сети клиента.  
  
Когда создается новый клиент создает новый шлюз уровня 3, сетевой контроллер шлюза Service Manager выбирает доступен шлюз виртуальной Машины и настраивает новый интерфейс клиента высокой доступности адреса клиента (ак) пространства IP-адрес (из клиента виртуальной ЛС с тегами логической сети). IP-адрес используется в качестве IP-адрес узла на шлюзе удаленных (физической сети) и является следующего прыжка для достижения сети клиента виртуализации сети Hyper-V.  
  
В отличие от сетевых подключений IPsec или GRE коммутатора TOR не узнаете, с тегами сеть VLAN клиента динамически. Маршрут с тегами сеть VLAN клиента должна быть настроена на коммутатор TOR и все промежуточные коммутаторы и маршрутизаторы между физической инфраструктуры и шлюза, чтобы обеспечить подключение в сквозном режиме.  Ниже приведен пример конфигурации CSP виртуальной сети, как показано на рисунке ниже.  
  
|Сети|Подсети|ИДЕНТИФИКАТОР ВИРТУАЛЬНОЙ ЛС|Шлюз по умолчанию|  
|-----------|----------|-----------|-------------------|  
|Логическая сеть Contoso уровня 3|10.127.134.0/24|1001|10.127.134.1|  
|Логическая сеть Woodgrove уровня 3|10.127.134.0/24|1002|10.127.134.1|  
  
Ниже приведены примеры конфигурации шлюза клиента, как показано на рисунке ниже.  
  
|Имя клиента|Шлюз уровня 3 IP-адрес|ИДЕНТИФИКАТОР ВИРТУАЛЬНОЙ ЛС|IP-адрес узла|  
|---------------|-------------------------|-----------|-------------------|  
|Contoso|10.127.134.50|1001|10.127.134.55|  
|Woodgrove|10.127.134.60|1002|10.127.134.65|  
  
Ниже приведен рисунке этих конфигураций в центре обработки данных CSP.  
  
![Высокая доступность для уровня 3 переадресации шлюзов](../../../media/RAS-Gateway-High-Availability/ras_fwdgw.png)  
  
Сбои шлюза, функция обнаружения сбоев и процесс отработки отказа шлюза в контексте 3 шлюза переадресации аналогичен процессы IKEv2 и шлюзов RAS GRE. Различия, внешних IP-адресов, которые обрабатываются так.  
  
Когда состояние виртуальной Машины шлюза переходит в неработоспособное состояние, сетевой контроллер выбирает один из режима ожидания шлюзов из пула и повторно инициализирует сетевые подключения и маршрутизации для перехода в режим ожидания шлюза. Во время перемещения на подключения, шлюз переадресации уровня 3 высокой доступный ЦС пространства IP-адрес также перемещается в новый шлюз виртуальной Машины вместе с пространстве BGP IP-адрес клиента.  
  
Так как адрес Пиринг IP уровня 3 перемещается в новый шлюз виртуальной Машины во время отработки отказа, удаленного физической инфраструктуры снова возможность подключения IP-адресу и впоследствии достичь нагрузки виртуализации сети Hyper-V. Для динамической маршрутизации BGP, как пространстве BGP IP-адрес был перемещен в новый шлюз виртуальной Машины, удаленного маршрутизатора BGP можно заново установить пиринг и снова получить все маршруты виртуализации сети Hyper-V.  
  
> [!NOTE]  
> Чтобы использовать с тегом логической сети VLAN для связи клиента необходимо настроить отдельно коммутаторы TOR и всех промежуточных маршрутизаторов. Кроме того отказоустойчивости уровня 3 ограничивается только стоек, которые настроены таким образом. По этой причине тщательно необходимо настроить пул шлюза уровня 3 и ручной настройки должны выполняться отдельно.  
  


