---
title: Внутренняя служба DNS (iDNS) для SDN
description: В этом разделе объясняется, как предоставить службы DNS для рабочих нагрузок клиентов размещенного с помощью внутренней DNS-сервера (IDN), который интегрирован с помощью определенных сетевых программного обеспечения в Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: ad848a5b-0811-4c67-afe5-6147489c0384
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 4bdb495b585cf60315dee60f9365e282877fdc1d
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/28/2018
---
# <a name="internal-dns-service-idns-for-sdn"></a>Внутренние DNS служба \(iDNS\) для SDN

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

Если вы работаете \(CSP\) поставщиком облачных услуг или Корпоративная, которая заключается в планировании развертывания программного обеспечения определены сети \(SDN\) в Windows Server 2016, можно предоставить службы DNS рабочих нагрузок клиентов размещенного с помощью \(iDNS\) внутренние DNS-сервера, который интегрирован с SDN.

\(VMs\) размещенные виртуальные машины и приложения, требующие DNS для обмена данными в их собственных сетей и внешние ресурсы в Интернете. С имена IDN вы можете предоставить клиентам службы разрешения имен DNS для их пространство имен изолированной, локальный и для Интернет-ресурсов.

Поскольку имена IDN служба недоступна из клиента виртуальных сетей, отличным от через прокси имена IDN сервер не уязвимой для вредоносных действий в сети клиента.

**Ключевые функции**

Ниже перечислены ключевые характеристики имена IDN.

- Предоставляет общие DNS разрешение имен для клиентов рабочих нагрузок
- Принудительное службы DNS для разрешения имен и регистрации DNS-сервера в пространство имен клиента
- Служба рекурсивный DNS-сервера для разрешения имен Интернета с виртуальным машинам.
- При необходимости можно настроить одновременное размещения имен структуры и клиента
- Экономичное решение DNS - клиентам не требуется для развертывания инфраструктуры DNS
- Высокая доступность с интеграцией Active Directory, которая является обязательной.

Дополнение к этим функциям Если вы сомневаетесь связана с предотвращением показа Рекламы интегрировать откройте DNS-серверы к Интернету, можно развернуть серверы имена IDN за другой распознаватель рекурсивный в сети периметра.

Поскольку имена IDN централизованный сервер для всех DNS-запросов, CSP или Enterprise можно также реализовать брандмауэров клиента DNS, применять фильтры, обнаруживать вредоносные действия и аудита транзакций в центральном расположении

## <a name="idns-infrastructure"></a>имена IDN инфраструктуры
Инфраструктура имена IDN включает имена IDN серверы и имена IDN прокси-сервера.

### <a name="idns-servers"></a>имена IDN серверов
имена IDN включает набор DNS-серверов, на которых размещены данные конкретного клиента, такие как DNS-записи ресурсов виртуальной Машины.

серверы имена IDN заслуживающих доверия серверов для своей внутренней зоны DNS-сервера и также выступают как разрешения для общих имен при клиента виртуальные машины, попытка подключения к внешним ресурсам.

Все имена узлов для виртуальных машин в виртуальных сетях хранятся в виде записей ресурсов DNS в той же зоны. Например при развертывании имена IDN для зоны, с именем contoso.local записей ресурсов DNS для виртуальных машин в этой сети хранятся в зоне contoso.local.

\(FQDNs\) виртуальной Машины полных доменных имен клиенту состоят из имени компьютера и строка суффикса DNS для виртуальной сети, в формате GUID. Например если у вас есть клиента виртуальной Машины с именем TENANT1, в виртуальной сети contoso, локальная система, полное доменное имя виртуальной Машины — TENANT1. *vn guid*. contoso.local, где *vn guid* — строка суффикса DNS для виртуальной сети.

>[!NOTE]
>Если вы являетесь администратором структуры, вы можно использовать инфраструктуры CSP или DNS предприятия как серверы имена IDN вместо DNS-серверов для развертывания как имена IDN серверов. Развертывание новых серверов имена IDN или использовать существующую инфраструктуру, имена IDN зависит от Active Directory для обеспечения высокой доступности. Имена IDN серверы таким образом должен быть интегрирован с Active Directory.

### <a name="idns-proxy"></a>имена IDN прокси-сервера
имена IDN прокси-сервера — это служба Windows, которое будет выполняться на каждом узле и что перенаправляет клиента DNS виртуальной сети трафик имена IDN сервера.

На рисунке ниже показаны пути DNS трафик клиента виртуальные сети через прокси-сервер имена IDN в имена IDN сервера и в Интернете.

![имена IDN инфраструктуры](../../media/Internal-Dns/Internal-Dns.jpg)

## <a name="how-to-deploy-idns"></a>Как развернуть IDN.
При развертывании SDN в Windows Server 2016 с помощью сценариев имена IDN автоматически включается в вашем развертывании.

Дополнительные сведения см. в следующих разделах.

- [Развертывание инфраструктуры программно-конфигурируемой сети с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts)


## <a name="understanding-idns-deployment-steps"></a>Общее представление о имена IDN шаги развертывания
В этом разделе позволяют получить представление о том, как устанавливается и настраивается при развертывании с помощью сценариев SDN имена IDN.

Ниже приведен обзор шагов, необходимых для развертывания имена IDN.

>[!NOTE]
>Если вы развернули SDN с помощью сценариев, необязательно выполнять следующие действия. Эти действия представлены сведения и только в целях устранения неполадок.

### <a name="step-1-deploy-dns"></a>Шаг 1: Развертывание DNS
DNS-сервер можно развернуть с помощью в следующем примере команды Windows PowerShell.
    
    Install-WindowsFeature DNS -IncludeManagementTools
    
### <a name="step-2-configure-idns-information-in-network-controller"></a>Шаг 2: Настройка сведения имена IDN в сетевого контроллера
Этот сценарий сегмент является вызов REST, сделанных администратором сетевой контроллер, он сообщил об настройки зоны имена IDN - как IP-адрес iDNSServer и зону, которая используется для размещения имена IDN.. 

```
    Url: https://<url>/networking/v1/iDnsServer/configuration
Method: PUT
{
      "properties": {
        "connections": [
          {
            "managementAddresses": [
              "10.0.0.9"
            ],
            "credential": {
              "resourceRef": "/credentials/iDnsServer-Credentials"
            },
            "credentialType": "usernamePassword"
          }
        ],
        "zone": "contoso.local"
      }
    }
```

>[!NOTE]
>Это выдержка из раздела **ConfigureIDns конфигурации** в SDNExpress.ps1. Дополнительные сведения см. в разделе [развертывание инфраструктуры программно-конфигурируемой сети с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts).

### <a name="step-3-configure-the-idns-proxy-service"></a>Шаг 3: Настройка прокси-служба IDN.
Имена IDN прокси-служба выполняет на каждом из узлов Hyper-V, предоставляя моста между виртуальными сетями клиентов и к физической сети, в которой находятся серверы имена IDN. Следующие разделы реестра необходимо создать на каждом узле Hyper-V.


**Порт DNS:** фиксированный порт 53

- Раздел реестра = HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NcHostAgent\Parameters\Plugins\Vnet\InfraServices\DnsProxyService»
- Имени = «Порт»
- ValueData = 53
- Тип значения = «Параметр Dword»
       

**Порт прокси-сервера DNS:** фиксированный порт 53

- Раздел реестра = HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NcHostAgent\Parameters\Plugins\Vnet\InfraServices\DnsProxyService»
- Имени = «ProxyPort»
- ValueData = 53
- Тип значения = «Параметр Dword»
        
**IP-адрес DNS-сервера:** это фиксированный IP-адрес, настроенный в сетевом интерфейсе на случай, если клиент выбирает использование службы имена IDN.

- Раздел реестра = HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NcHostAgent\Parameters\Plugins\Vnet\InfraServices\DnsProxyService»
- Имени = «IP»
- ValueData = «169.254.169.254»
- Тип значения = «Строка»

        
**MAC-адрес:** аппаратный адрес DNS-сервера

- Раздел реестра = HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\NcHostAgent\Parameters\Plugins\Vnet\InfraServices\DnsProxyService
- Имени = «MAC»
- ValueData = «aa-bb-cc-aa-bb-cc»
- Тип значения = «Строка»

**Адрес сервера имена IDN:** разделенный запятыми список серверов имена IDN.

- Раздел реестра: HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\DNSProxy\Parameters
- Имени = «Серверы пересылки»
- ValueData = «10.0.0.9»
- Тип значения = «Строка»



>[!NOTE]
>Это выдержка из раздела **ConfigureIDnsProxy конфигурации** в SDNExpress.ps1. Дополнительные сведения см. в разделе [развертывание инфраструктуры программно-конфигурируемой сети с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts).

### <a name="step-4-restart-the-network-controller-host-agent-service"></a>Шаг 4: Перезапустите службу агента узла сетевого контроллера
Чтобы перезапустить службу агента узла сетевого контроллера можно использовать следующую команду Windows PowerShell.
    
    Restart-Service nchostagent -Force
    
Дополнительные сведения см. в разделе [Restart-Service](https://technet.microsoft.com/library/hh849823.aspx).

### <a name="enable-firewall-rules-for-the-dns-proxy-service"></a>Включение правила брандмауэра для прокси-служба DNS-сервера
Чтобы создать правило брандмауэра, разрешающее исключения для прокси-сервера для взаимодействия с виртуальной Машины и имена IDN сервера можно использовать следующую команду Windows PowerShell.
    
    Enable-NetFirewallRule -DisplayGroup 'DNS Proxy Firewall'

Дополнительные сведения см. в разделе [Enable-NetFirewallRule](https://technet.microsoft.com/library/jj554869.aspx).
    
### <a name="validate-the-idns-service"></a>Проверка службы IDN.
Чтобы проверить имена IDN службы, необходимо развернуть рабочую нагрузку клиентов пример.

Дополнительные сведения см. в разделе [создания виртуальной Машины и подключение к виртуальной сети клиента или виртуальной локальной сети](https://technet.microsoft.com/windows-server-docs/networking/sdn/manage/create-a-tenant-vm).

Следует клиента виртуальной Машины, чтобы использовать службу имена IDN необходимо оставить пустым конфигурацию виртуальной Машины интерфейсы сети DNS-сервера и разрешить интерфейсы, используемые DHCP. 

После запуска виртуальной Машины с интерфейсом сети, она автоматически получает конфигурацию, которая позволяет использовать имена IDN ВМ и виртуальной Машины сразу же начинает разрешении имен с помощью службы имена IDN.

При настройке клиента виртуальной Машины, чтобы использовать службу имена IDN оставляя пустое сведения сетевого интерфейса DNS-сервер и Альтернативный DNS-сервер, сетевой контроллер предоставляет IP-адрес виртуальной Машины и выполняет регистрации DNS-имени, от имени виртуальной Машины с имена IDN сервера. 

Сетевой контроллер также сообщает прокси имена IDN о виртуальной Машины и необходимые сведения, чтобы выполнять разрешение имен для виртуальной Машины. 

Виртуальная машина инициирует запрос DNS, прокси-сервер действует как сервер пересылки запрос из виртуальной сети к службе имена IDN. 

Прокси-сервер DNS также гарантирует, что запросы виртуальной Машины клиента изолированы. Если сервер имена IDN является полномочным для запроса, имена IDN сервер отвечает полномочный ответ. Если имена IDN сервера нет полномочий для запроса, она выполняет рекурсию DNS для разрешения имен Интернета.

>[!NOTE]
>Эти сведения включаются в разделе **AttachToVirtualNetwork конфигурации** в SDNExpressTenant.ps1. Дополнительные сведения см. в разделе [развертывание инфраструктуры программно-конфигурируемой сети с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts).

