---
title: Внутренняя служба DNS (iDNS) для SDN
description: В этом разделе объясняется, как можно предоставить службы DNS для рабочих нагрузок размещенного клиента с помощью внутренней службы DNS (iDNS), интегрированной с программно-определяемой сетью в Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-sdn
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: ad848a5b-0811-4c67-afe5-6147489c0384
ms.author: pashort
author: shortpatti
ms.openlocfilehash: a7e5aa9e1ae7442c706c1bdbdb56d65234fe5ae8
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405968"
---
# <a name="internal-dns-service-idns-for-sdn"></a>Внутренняя служба DNS (iDNS) для SDN

>Относится к: Windows Server (Semi-Annual Channel), Windows Server 2016

Если вы работаете с поставщиком облачных служб \(CSP @ no__t-1 или Enterprise, который планирует развертывать программно определенную сеть \(SDN @ no__t-3 в Windows Server 2016, вы можете предоставлять службы DNS для рабочих нагрузок размещенных клиентов с помощью внутренних DNS-@no__ t-4iDNS @ no__t-5, интегрированный с SDN.

Размещенные виртуальные машины \(VMs @ no__t-1 и приложения нуждаются в том, чтобы служба DNS могла обмениваться данными в своих сетях и с внешними ресурсами в Интернете. С помощью iDNS можно предоставить клиентам службы разрешения имен DNS для изолированного, локального пространства имен и для Интернет-ресурсов.

Так как служба iDNS недоступна из виртуальных сетей клиента, кроме прокси-сервера iDNS, сервер не подвержен вредоносным действиям в сетях клиентов.

**Основные возможности**

Ниже приведены основные функции iDNS.

- Предоставляет общие службы разрешения имен DNS для рабочих нагрузок клиента
- Официальная служба DNS для разрешения имен и регистрации DNS в пространстве имен клиента
- Рекурсивная служба DNS для разрешения имен Интернета из виртуальных машин клиента.
- При необходимости можно настроить одновременное размещение имен структуры и клиента.
- Экономичное решение DNS — клиенты не нуждаются в развертывании собственной инфраструктуры DNS.
- Высокий уровень доступности с интеграцией Active Directory, которая необходима.

Помимо этих функций, если вы хотите обеспечить открытие интегрированных DNS-серверов в Интернете, можно развернуть серверы iDNS за другим рекурсивным распознавателем в сети периметра.

Поскольку iDNS является централизованным сервером для всех запросов DNS, CSP или предприятие может также реализовать брандмауэры DNS клиента, применить фильтры, обнаружить вредоносные действия и выполнить аудит транзакций в центральном расположении.

## <a name="idns-infrastructure"></a>Инфраструктура iDNS
Инфраструктура iDNS включает серверы iDNS и прокси iDNS.

### <a name="idns-servers"></a>Серверы iDNS
iDNS включает набор DNS-серверов, на которых размещаются данные для конкретного клиента, например записи ресурсов DNS виртуальной машины.

серверы iDNS являются полномочными серверами для внутренних зон DNS, а также выполняют роль распознавателя для общедоступных имен, когда клиентские виртуальные машины пытаются подключиться к внешним ресурсам.

Все имена узлов виртуальных машин в виртуальной сети хранятся в виде записей ресурсов DNS в одной и той же зоне. Например, если развернуть iDNS для зоны с именем Contoso. local, записи ресурсов DNS для виртуальных машин в этой сети будут храниться в зоне contoso. local.

Полные доменные имена виртуальных машин клиента \(FQDNs @ no__t-1 состоят из имени компьютера и строки DNS-суффикса для виртуальной сети в формате GUID. Например, если у вас есть виртуальная машина клиента с именем TENANT1, которая находится в виртуальной сети Contoso, Local, полное доменное имя виртуальной машины — TENANT1. *VN-GUID*. contoso. local, где *VN — GUID* — строка DNS-суффикса для виртуальной сети.

>[!NOTE]
>Если вы являетесь администратором структуры, вы можете использовать свою службу CSP или корпоративную инфраструктуру DNS в качестве серверов iDNS, а не развертывать новые DNS-серверы специально для использования в качестве серверов iDNS. Независимо от того, развертываете ли вы новые серверы для iDNS или используете существующую инфраструктуру, iDNS использует Active Directory для обеспечения высокой доступности. Поэтому серверы iDNS должны быть интегрированы с Active Directory.

### <a name="idns-proxy"></a>Прокси-сервер iDNS
iDNS Proxy — это служба Windows, которая выполняется на каждом узле и перенаправляет трафик DNS виртуальной сети клиента на сервер iDNS.

На следующем рисунке показаны пути трафика DNS из виртуальных сетей клиента через прокси-сервер iDNS к серверу iDNS и Интернету.

![Инфраструктура iDNS](../../media/Internal-Dns/Internal-Dns.jpg)

## <a name="how-to-deploy-idns"></a>Развертывание iDNS
При развертывании SDN в Windows Server 2016 с помощью скриптов iDNS автоматически включается в развертывание.

Дополнительные сведения см. в следующих статьях.

- [Развертывание программно-определяемой сетевой инфраструктуры с помощью сценариев](https://docs.microsoft.com/windows-server/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts)


## <a name="understanding-idns-deployment-steps"></a>Основные сведения о шагах развертывания iDNS
С помощью этого раздела можно получить представление о том, как iDNS устанавливается и настраивается при развертывании SDN с помощью скриптов.

Ниже приведена сводка действий, необходимых для развертывания iDNS.

>[!NOTE]
>Если вы развернули SDN с помощью скриптов, вам не нужно выполнять никаких действий. Эти действия предназначены только для получения сведений и устранения неполадок.

### <a name="step-1-deploy-dns"></a>Шаг 1. Развертывание DNS
Вы можете развернуть DNS-сервер, используя следующий пример команды Windows PowerShell.
    
    Install-WindowsFeature DNS -IncludeManagementTools
    
### <a name="step-2-configure-idns-information-in-network-controller"></a>Шаг 2. Настройка сведений о iDNS в сетевом контроллере
Этот сегмент скрипта является вызовом функции RESTFUL, который выполняется администратором сетевого контроллера и информирует его о настройке зоны iDNS, такой как IP-адрес Иднссервер и зона, используемая для размещения имен iDNS. 

```
    Url: https://<url>/networking/v1/iDnsServer/configuration
Method: PUT
{
      "properties": {
        "connections": [
          {
            "managementAddresses": [
              "10.0.0.9"
            ],
            "credential": {
              "resourceRef": "/credentials/iDnsServer-Credentials"
            },
            "credentialType": "usernamePassword"
          }
        ],
        "zone": "contoso.local"
      }
    }
```

>[!NOTE]
>Это выдержка из раздела **Configuration конфигуреиднс** в сднекспресс. ps1. Дополнительные сведения см. [в статье Развертывание программно-определяемой сетевой инфраструктуры с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts).

### <a name="step-3-configure-the-idns-proxy-service"></a>Шаг 3. Настройка службы прокси-сервера iDNS
Служба прокси-сервера iDNS выполняется на каждом узле Hyper-V, предоставляя мост между виртуальными сетями клиентов и физической сетью, в которой находятся серверы iDNS. На каждом узле Hyper-V должны быть созданы следующие разделы реестра.


**DNS-порт:** Фиксированный порт 53

- Раздел реестра = Хклм\систем\куррентконтролсет\сервицес\нчостажент\параметерс\плугинс\внет\инфрасервицес\днспроксисервице "
- ValueName = "порт"
- ValueData = 53
- ValueType = "DWORD"
       

**Порт прокси-сервера DNS:** Фиксированный порт 53

- Раздел реестра = Хклм\систем\куррентконтролсет\сервицес\нчостажент\параметерс\плугинс\внет\инфрасервицес\днспроксисервице "
- ValueName = "Проксипорт"
- ValueData = 53
- ValueType = "DWORD"
        
**IP-АДРЕС DNS:** Фиксированный IP-адрес, настроенный для сетевого интерфейса, если клиент выбрал использование службы iDNS

- Раздел реестра = Хклм\систем\куррентконтролсет\сервицес\нчостажент\параметерс\плугинс\внет\инфрасервицес\днспроксисервице "
- ValueName = "IP"
- ValueData = "169.254.169.254"
- ValueType = "строка"

        
**Mac-адрес:** Адрес управления доступом к носителю DNS-сервера

- Раздел реестра = Хклм\систем\куррентконтролсет\сервицес\нчостажент\параметерс\плугинс\внет\инфрасервицес\днспроксисервице
- ValueName = "MAC"
- ValueData = "AA-BB-CC-AA-BB-CC"
- ValueType = "строка"

**Адрес сервера IDNS:** Разделенный запятыми список серверов iDNS.

- Раздел реестра: хклм\систем\куррентконтролсет\сервицес\днспрокси\параметерс
- ValueName = "серверы пересылки"
- ValueData = "10.0.0.9"
- ValueType = "строка"



>[!NOTE]
>Это выдержка из раздела **Configuration конфигуреиднспрокси** в сднекспресс. ps1. Дополнительные сведения см. [в статье Развертывание программно-определяемой сетевой инфраструктуры с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts).

### <a name="step-4-restart-the-network-controller-host-agent-service"></a>Шаг 4. Перезапуск службы агента узла сетевого контроллера
Для перезапуска службы агента узла сетевого контроллера можно использовать следующую команду Windows PowerShell.
    
    Restart-Service nchostagent -Force
    
Дополнительные сведения см. в разделе [Restart-Service](https://technet.microsoft.com/library/hh849823.aspx).

### <a name="enable-firewall-rules-for-the-dns-proxy-service"></a>Включение правил брандмауэра для службы DNS-прокси
Чтобы создать правило брандмауэра, разрешающее исключения прокси-сервера для взаимодействия с виртуальной машиной и сервером iDNS, можно использовать следующую команду Windows PowerShell.
    
    Enable-NetFirewallRule -DisplayGroup 'DNS Proxy Firewall'

Дополнительные сведения см. в разделе [Enable-NetFirewallRule](https://technet.microsoft.com/library/jj554869.aspx).
    
### <a name="validate-the-idns-service"></a>Проверка службы iDNS
Чтобы проверить службу iDNS, необходимо развернуть пример рабочей нагрузки клиента.

Дополнительные сведения см. в статьях [Создание виртуальной машины и подключение к виртуальной сети клиента или VLAN](https://technet.microsoft.com/windows-server-docs/networking/sdn/manage/create-a-tenant-vm).

Если вы хотите, чтобы виртуальная машина клиента использовала службу iDNS, необходимо оставить конфигурацию DNS-сервера сетевых интерфейсов виртуальной машины пустой и разрешить интерфейсам использовать DHCP. 

После запуска виртуальной машины с таким сетевым интерфейсом она автоматически получает конфигурацию, позволяющую виртуальной машине использовать iDNS, а виртуальная машина сразу же начинает выполнять разрешение имен с помощью службы iDNS.

Если вы настраиваете виртуальную машину клиента для использования службы iDNS, не закрывая DNS-сервер сетевого интерфейса и дополнительные сведения о DNS-сервере, сетевой контроллер предоставляет виртуальную машину с IP-адресом и выполняет регистрацию DNS-имени от имени виртуальной машины с сервером iDNS. . 

Сетевой контроллер также информирует прокси-сервер iDNS о виртуальной машине и необходимые сведения для выполнения разрешения имен для виртуальной машины. 

Когда виртуальная машина инициирует запрос DNS, прокси-сервер выступает в качестве сервера пересылки запроса из виртуальной сети в службу iDNS. 

DNS-прокси также гарантирует, что запросы виртуальных машин клиента будут изолированы. Если сервер iDNS является полномочным для запроса, сервер iDNS отвечает полномочным ответом. Если сервер iDNS не является полномочным для запроса, он выполняет рекурсию DNS для разрешения имен Интернета.

>[!NOTE]
>Эти сведения содержатся в разделе **Конфигурация аттачтовиртуалнетворк** в сднекспресстенант. ps1. Дополнительные сведения см. [в статье Развертывание программно-определяемой сетевой инфраструктуры с помощью сценариев](https://technet.microsoft.com/windows-server-docs/networking/sdn/deploy/deploy-a-software-defined-network-infrastructure-using-scripts).

