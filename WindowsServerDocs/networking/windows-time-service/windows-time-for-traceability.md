---
ms.assetid: ''
title: Время Windows для трассировки
description: Нормативам во многих секторах требуются системы для отслеживания в формате UTC.  Это означает, что смещение системы можно подтверждать относительно времени в формате UTC.
author: shortpatti
ms.author: dacuo
manager: dougkim
ms.date: 10/17/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: 161188eccdd848cf50be1a4485beeb58935f643a
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70871776"
---
# <a name="windows-time-for-traceability"></a>Время Windows для трассировки
>Относится к: Windows Server 2016 версии 1709 или более поздней, а также Windows 10 версии 1703 или более поздней.


Нормативам во многих секторах требуются системы для отслеживания в формате UTC.  Это означает, что смещение системы можно подтверждать относительно времени в формате UTC.  Чтобы включить сценарии соответствия нормативным требованиям, Windows 10 (версия 1703 или более поздняя) и Windows Server 2016 (версия 1709 или более поздняя) предоставляют новые журналы событий для получения изображения с точки зрения операционной системы, чтобы понять, какие действия выполняются Системные часы.  Эти журналы событий создаются постоянно для службы времени Windows и могут быть проверены или архивированы для последующего анализа.

Эти новые события позволяют получить ответы на следующие вопросы:

* Изменились системные часы
* Изменилась тактовая частота
* Изменилась конфигурация службы времени Windows

## <a name="availability"></a>Доступность

Эти улучшения включены в Windows 10 версии 1703 или более поздней, а также в Windows Server 2016 версии 1709 или более поздней.

## <a name="configuration"></a>Конфигурация

Для реализации этой функции настройка не требуется.  Эти журналы событий включены по умолчанию, и их можно найти в средстве просмотра событий в канале **приложений и служб лог\микрософт\виндовс\тиме-сервице\оператионал** .


## <a name="list-of-event-logs"></a>Список журналов событий

В следующем разделе описываются события, регистрируемые для использования в сценариях отслеживания.

# <a name="257tab257"></a>[257](#tab/257)
Это событие регистрируется при запуске службы времени Windows (W32Time) и записывает сведения о текущем времени, текущее количество тактов, конфигурацию среды выполнения, поставщики времени и текущую тактовую частоту.

|||
|---|---|
|Описание события |Запуск службы |
|Подробности |Происходит при запуске W32Time |
|Данные зарегистрированы |<ul><li>Текущее время в формате UTC</li><li>Текущее число тактов</li><li>Конфигурация W32Time</li><li>Конфигурация поставщика времени</li><li>Тактовая частота</li></ul> |
|Механизм регулирования  |Нет. Это событие срабатывает при каждом запуске службы. |

**Например**
```
W32time service has started at 2018-02-27T04:25:17.156Z (UTC), System Tick Count 3132937.
```

**Команда:**

Эти сведения также можно запросить с помощью следующих команд.

*Настройка службы W32Time и поставщика времени*
```
w32tm.exe /query /configuration
```

*Тактовая частота*
```
w32tm.exe /query /status /verbose
```


# <a name="258tab258"></a>[258](#tab/258)
Это событие регистрируется при остановке службы времени Windows (W32Time) и записывает сведения о текущем времени и числе тактов.

|||
|---|---|
|Описание события |Завершение службы |
|Подробности |Происходит при завершении работы W32Time |
|Данные зарегистрированы |<ul><li>Текущее время в формате UTC</li><li>Текущее число тактов</li></ul> |
|Механизм регулирования  |Нет. Это событие срабатывает при каждом остановке службы. |

**Пример текста:** 
`W32time service is stopping at 2018-03-01T05:42:13.944Z (UTC), System Tick Count 6370250.`

# <a name="259tab259"></a>[259](#tab/259)
Это событие периодически регистрирует текущий список источников времени и выбранный источник времени.  Кроме того, он регистрирует текущее количество тактов.  Это событие не срабатывает при каждом изменении источника времени.  Другие события, перечисленные далее в этом документе, предоставляют эту функцию.

|||
|---|---|
|Описание события |Периодическое состояние поставщика NTP-клиента |
|Подробности |Список источников времени, используемых NTP-клиентом |
|Данные зарегистрированы |<ul><li>Доступные источники времени</li><li>Выбранный сервер времени ссылки во время ведения журнала</li><li>Текущее число тактов</li></ul>  |
|Механизм регулирования  |Заносится в журнал каждые 8 часов. |

**Пример текста:** Периодическое состояние поставщика NTP-клиента:

Клиент NTP получает данные времени от следующих NTP-серверов:

Server1. fabrikam. com, 0x8 (NTP. m | 0x8 | [::]: 123-> [IPAddress]: 123) Server2. fabrikam. com, 0x8 (NTP. m | 0x8 | [::]: 123-> [IPAddress]: 123);  выбранный сервер времени ссылки — Server1. fabrikam. com, 0x8 (NTP. m | 0x8 | [::]: 123-> [IPAddress]: 123) (RefID: 0x08d6648e63). Число тактов системы 13187937

**Команда** Эти сведения также можно запросить с помощью следующих команд.

*Идентификация одноранговых узлов*
`w32tm.exe /query /peers`

# <a name="260tab260"></a>[260](#tab/260)

|||
|---|---|
|Описание события |Конфигурация и состояние службы времени |
|Подробности |Служба W32Time периодически регистрирует свою конфигурацию и состояние. Это эквивалентно вызову:<br><br>`w32tm /query /configuration /verbose`<br>ИЛИ<br>`w32tm /query /status /verbose` |
|Механизм регулирования  |Заносится в журнал каждые 8 часов. |

# <a name="261tab261"></a>[261](#tab/261)
Каждый экземпляр записывается в журнал при изменении системного времени с помощью API Сетсистемтиме.

|||
|---|---|
|Описание события |Системное время задано |
|Механизм регулирования  |Нет.<br><br>Это должно происходить редко на системах с разумной синхронизацией времени, и мы хотим регистрировать его каждый раз, когда он происходит. Мы будем пропускать параметр Тимежумпаудитоффсет при ведении журнала этого события, поскольку этот параметр предназначен для регулирования событий в журнале системных событий Windows. |

# <a name="262tab262"></a>[262](#tab/262)

|||
|---|---|
|Описание события |Частота системных часов скорректирована |
|Подробности |Служба W32Time постоянно изменяет частоту системных часов, когда часы закрывают синхронизацию. Мы хотим собрать «достаточно значимые» изменения частоты часов без перезапуска журнала событий. |
|Механизм регулирования  |Все настройки часов ниже Тимеаджустментаудитсрешолд (min = 128 часть за миллион, по умолчанию = 800 часть в миллионы) не регистрируются.<br><br>2 изменения частоты часов в минуту с текущей степенью детализации дают 120 μсек/с в точности часов.<br><br>В синхронизированной системе большая часть корректировок выполняется ниже этого уровня. Если требуется более точное отслеживание, этот параметр можно скорректировать или использовать PerfCounters. также можно выполнить оба действия. |

# <a name="263tab263"></a>[263](#tab/263)

|||
|---|---|
|Описание события |Измените параметры службы времени или список загруженных поставщиков времени. |
|Подробности |Повторное чтение параметров W32Time может привести к изменению определенных критических параметров в памяти, что может повлиять на общую точность синхронизации времени.<br><br>Служба W32Time регистрирует каждое событие при повторном считывании его параметров, что обеспечивает потенциальное влияние на синхронизацию времени. |
|Механизм регулирования  |Нет.<br><br>Это событие возникает только в том случае, если обновление администратором или групповой политики изменяет поставщиков времени, а затем активирует службу W32Time. Мы хотим записать каждый экземпляр изменения параметров. |


# <a name="264tab264"></a>[264](#tab/264)

|||
|---|---|
|Описание события |Изменение источников времени, используемых NTP-клиентом |
|Подробности |NTP-клиент записывает событие с текущим состоянием серверов или узлов времени, когда изменяется состояние сервера или однорангового узла (**ожидание > синхронизация**, **Синхронизация — > недоступен**или другие переходы). |
|Механизм регулирования  |Максимальная частота — только один раз в 5 минут для защиты журнала от временных проблем и неправильной реализации поставщика. |

# <a name="265tab265"></a>[265](#tab/265)

|||
|---|---|
|Описание события |Изменение источника или номера Стратум службы времени |
|Подробности |Источник времени W32Time и номер Стратум — это важные факторы, влияющие на возможность трассировки времени, и все изменения, внесенные в них, должны регистрироваться. Если служба w32time не имеет источника времени и вы не настроили в качестве надежного источника времени, то она перестанет объявляться как сервер времени и будет отвечать на запросы с недопустимыми параметрами. Это событие важно для отслеживания изменений состояния в топологии NTP. |
|Механизм регулирования  |Нет. |


# <a name="266tab266"></a>[266](#tab/266)

|||
|---|---|
|Описание события |Время повторной синхронизации запрошено |
|Подробности |Эта операция активируется:<ul><li>При изменении сети</li><li>Система возвращается из подключенного режима ожидания/гибернации</li><li>Когда мы не выполняли синхронизацию в течение длительного времени</li><li>Администратор выдает команду повторной синхронизации</li></ul>Эта операция приводит к немедленной утрате точности точного времени синхронизации, так как заставляет NTP-клиент очищать свои фильтры. |
|Механизм регулирования  |Максимальная частота — каждые 5 минут.<br><br>Возможно, что неверная сетевая карта (или неплохой сценарий) может запустить эту операцию несколько раз и привести к переполнению журналов. Следовательно, необходимо регулировать это событие.<br><br>Обратите внимание, что для достижения точных синхронизаций времени требуется гораздо больше 5 минут, а регулирование не теряет сведений о первоначальном событии, что привело к потере точности времени.  |

---
