---
ms.assetid: 72a90d00-56ee-48a9-9fae-64cbad29556c
title: Точное время для Windows Server 2016
description: Точность синхронизации времени в Windows Server 2016 была значительно улучшена, при этом обеспечивается полная обратная совместимость NTP с более старыми версиями Windows.
author: shortpatti
ms.author: dacuo
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 2e8e9e86f81596c85219c37c07d8fd2e95cc3a49
ms.sourcegitcommit: 10331ff4f74bac50e208ba8ec8a63d10cfa768cc
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2020
ms.locfileid: "75953083"
---
# <a name="accurate-time-for-windows-server-2016"></a>Точное время для Windows Server 2016

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows 10 или более поздней версии

Служба времени Windows — это компонент, использующий модель подключаемых модулей для клиентских и серверных поставщиков синхронизации времени.  В Windows есть два встроенных поставщика клиентов, и доступны подключаемые модули сторонних производителей. Один поставщик использует [NTP (RFC 1305)](https://tools.ietf.org/html/rfc1305) или [MS-NTP](https://msdn.microsoft.com/library/cc246877.aspx) для синхронизации ЛОКАЛЬНОГО системного времени с NTP-и (или) совместимым с MS/NTP эталонным сервером. Другой поставщик предназначен для Hyper-V и синхронизирует виртуальные машины (ВМ) с узлом Hyper-V.  Если существует несколько поставщиков, Windows выберет наилучший поставщик с помощью уровня Стратум, а затем корневую задержку, корневую дисперсию и смещение времени в конце.

> [!NOTE]
> Краткий обзор службы времени в Windows можно получить в [этом видео](https://aka.ms/WS2016TimeVideo).

В этом разделе мы обсудим... Эти темы связаны с тем, чтобы обеспечить точное время: 

- Улучшения
- Измерения
- Советы и рекомендации

> [!IMPORTANT]
> Приложение, на которое ссылается статья точного времени Windows 2016, можно скачать [здесь](https://windocs.blob.core.windows.net/windocs/WindowsTimeSyncAccuracy_Addendum.pdf).  В этом документе содержатся дополнительные сведения о методологиях тестирования и измерения.

> [!NOTE] 
> Модель подключаемого модуля поставщика времени Windows [описана в TechNet](https://msdn.microsoft.com/library/windows/desktop/ms725475%28v=vs.85%29.aspx).

## <a name="domain-hierarchy"></a>Иерархия доменов
Настройки домена и автономной конфигурации работают по-разному.

- Члены домена используют безопасный протокол NTP, который использует проверку подлинности для обеспечения безопасности и подлинности ссылки времени.  Члены домена синхронизируются с главными часами, определенными иерархией доменов и системой оценки.  В домене существует иерархический уровень времени, стратумс, что каждый контроллер домена указывает на родительский контроллер домена с более точным временем Стратум.  Иерархия разрешается в основной контроллер домена или контроллер домена в корневом лесу или контроллер домена с флагом домена ГТИМЕСЕРВ, который обозначает хороший сервер времени для домена.  См. раздел [укажите локальную надежную службу времени с помощью ГТИМЕСЕРВ ниже.

- По умолчанию автономные компьютеры настроены для использования time.windows.com.  Это имя разрешается DNS-сервером, который должен указывать на ресурс, принадлежащий корпорации Майкрософт.  Как и все удаленно размещенные ссылки времени, сетевые сбои, могут препятствовать синхронизации.  Загрузка сетевого трафика и асимметричные сетевые пути могут снизить точность синхронизации времени.  Для точности 1 мс вы не можете зависеть от удаленных источников времени.

Так как гости Hyper-V будут иметь по крайней мере два поставщика времени Windows для выбора, время узла и NTP, вы можете столкнуться с различными поведениями домена или автономной среды при работе в качестве гостя.

> [!NOTE] 
> Дополнительные сведения об иерархии доменов и системе оценки см. в разделе ["что такое служба времени Windows?".](https://blogs.msdn.microsoft.com/w32time/2007/07/07/what-is-windows-time-service/) .

> [!NOTE]
> СТРАТУМ — это концепция, используемая в поставщиках NTP и Hyper-V, и ее значение указывает расположение часов в иерархии.  СТРАТУМ 1 резервируется для часов самого высокого уровня, а Стратум 0 резервируется для того, чтобы оборудование считалось точным и не сопоставлено с минимальной задержкой.  Стратум 2 Поговорите с Стратум 1 серверами, Стратум 3 до Стратум 2 и так далее.  Хотя более низкие Стратум часто указывают более точные часы, можно найти несоответствия.  Кроме того, Служба W32Time принимает только время из Стратум 15 или ниже.  Чтобы просмотреть Стратум клиента, используйте *w32tm/query/status*.

## <a name="critical-factors-for-accurate-time"></a>Критические факторы для точного времени
Во всех случаях для точного времени есть три важных фактора:

1. **Твердотельные часы источника** . часы в домене должны быть стабильными и точными. Обычно это означает установку устройства GPS или указание на источник Стратум 1, #3 учетной записи. Если у вас есть две боатсы в воды, и вы пытаетесь измерять высоту по сравнению с другой, то лучше использовать точность, если источник в значительной степени стабильный и не перемещается. То же самое касается времени, и если исходные часы не стабильны, то влияние на всю цепь синхронизированных часов будет затронуто и увеличено на каждом этапе. Он также должен быть доступен, так как нарушения соединения могут помешать синхронизации времени. И, наконец, он должен быть безопасным. Если ссылка на время не поддерживается или может быть вызвана потенциально вредоносной стороной, вы можете предоставить своему домену атаки на основе времени.
2. **Стабильные клиентские часы** — стабильные часы клиента гарантируют, что естественное смещение осциллятор будет содержать.  NTP использует несколько примеров от потенциально нескольких NTP-серверов для условия и дисциплины часов локальных компьютеров.  Это не Пошаговое изменение времени, а на медленное или ускоренное выполнение локальных часов, что позволяет быстро и точно следить за тем, чтобы гарантировать точное время и обеспечить точность между NTP-запросами.  Однако если осциллятор часов клиентского компьютера не является стабильным, то могут возникать более колебания между настройкой, а алгоритмы Windows используют для условия, что часы не работают точно.  В некоторых случаях для точного времени могут потребоваться обновления встроенного по.
3. **Симметричное взаимодействие NTP** . очень важно, чтобы подключение по протоколу NTP было симметричным.  NTP использует вычисления для настройки времени, в течение которого предполагается, что сетевое исправление является симметричным.  Если путь, по которому NTP-пакет переходит к серверу, переходит на другой период времени, это затронет точность.  Например, путь может измениться из-за изменений в топологии сети или пакетов, направляемых через устройства с разными скоростями интерфейса.

Для устройств с питанием от аккумулятора, как мобильных, так и переносимых, необходимо учитывать различные стратегии.  Согласно нашим рекомендациям, поддержание точного времени требует, чтобы часы обменялись раз в секунду, которая соотносится с частотой обновления часов. Эти параметры будут потреблять больше энергии аккумулятора, чем ожидалось, и могут мешать режимам энергосбережения, доступным в Windows для таких устройств. Устройства с питанием от аккумулятора также имеют определенные режимы электропитания, которые останавливают выполнение всех приложений, что мешает W32time'sу способности накладывать дисциплину часов и поддерживать точное время. Кроме того, часы на мобильных устройствах могут быть не очень точны, начиная с.  Условия для окружающей среды влияют на точность тактовых импульсов, и мобильное устройство может перемещаться от одного внешнего состояния к другому, что может повлиять на возможность точного сохранения времени.  Поэтому корпорация Майкрософт не рекомендует устанавливать мобильные устройства с питанием от аккумулятора с параметрами высокой точности. 

## <a name="why-is-time-important"></a>Зачем важно время?  
Существует множество различных причин, по которым может потребоваться точное время.  Типичным вариантом для Windows является Kerberos, который требует 5 минут между клиентом и сервером.  Однако существует множество других областей, на которые может повлиять точность времени, в том числе:


- Правительственные нормы, такие как:
    - 50 MS точность для ФИНРА в США
    - 1 мс ЕСМА (МИФИД II) в ЕС.
- Алгоритмы шифрования
- Распределенные системы, такие как Cluster/SQL/Exchange и Document баз данных
- Блокчейн Framework для транзакций биткоин
- Распределенные журналы и анализ угроз 
- Репликация Active Directory
- PCI (отрасль платежных карт), в настоящее время 1 точность



[!INCLUDE [windows-server-2016-improvements](windows-server-2016-improvements.md)]
