---
ms.assetid: 72a90d00-56ee-48a9-9fae-64cbad29556c
title: Точное время в Windows 2016
description: ''
author: shortpatti
ms.author: pashort
manager: brianlic
ms.date: 3/12/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: f4b61dbf07fbc21820dd7b9326bbc990e4db3602
ms.sourcegitcommit: fb4e2ace2e0a29e0f6b028f1cb945cab6aa6ee2c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="windows-server-2016-accurate-time"></a>Точное время в Windows Server 2016

>Область применения: Windows Server 2016

Точность синхронизация времени в Windows Server 2016 была улучшена существенно, сохраняя полностью обратно NTP совместимость с предыдущими версиями Windows. При разумных рабочих условиях позволяет поддерживать 1 точность мс относительно времени UTC или лучше для членов домена Windows Server 2016 и Windows 10 Anniversary Update.

Службы времени Windows — это компонент, который использует модель подключаемых модулей для клиента и сервера служб синхронизации времени.  Существует два поставщика встроенный клиент в Windows и доступны подключаемых модулей сторонних разработчиков. Один поставщик использует [NTP (RFC 1305)](https://tools.ietf.org/html/rfc1305) или [MS-NTP](https://msdn.microsoft.com/en-us/library/cc246877.aspx) для синхронизации времени локальной системы на сервер соответствует ссылку NTP или MS-NTP. Другой поставщик для Hyper-V и синхронизирует виртуальных машин (VM) на узле Hyper-V.  Если имеется несколько поставщиков, Windows будет выбрать наиболее поставщика, во-первых, с помощью иерархической уровень следуют задержки, распределение корневого и наконец времени смещение.

>[!NOTE]
>Краткий обзор службы времени Windows, взгляните на это [общий обзор видео ](https://aka.ms/WS2016TimeVideo).

<!-- Not sure what to do with the following -->
В этом разделе мы... рассмотрим эти разделы, как они связаны с включением точное время: 

- Улучшения
- Измерения
- Советы и рекомендации

>[!IMPORTANT]
> Дополнение ссылается статье времени точность 2016 Windows можно загрузить [здесь](http://windocs.blob.core.windows.net/windocs/WindowsTimeSyncAccuracy_Addendum.pdf).  Данный документ содержит дополнительные сведения о наших методики тестирования и измерения.



> [!NOTE] 
> Поставщик подключаемого модуля windows времени модель [описаны на портале TechNet](https://msdn.microsoft.com/en-us/library/windows/desktop/ms725475%28v=vs.85%29.aspx).
<!-- -->





## <a name="domain-hierarchy"></a>Иерархии доменов
Конфигурации домена и автономных работают по-разному.

- Члены домена используйте безопасный протокол NTP использует проверку подлинности для обеспечения безопасности и подлинность справочника по времени.  Члены домена синхронизировать с часами главного определяется иерархии доменов и системы игры.  В домене существует иерархический уровень stratums времени, при котором каждый контроллер домена указывает на родительский контроллера домена с более точное время иерархической.  Иерархии разрешается в основной контроллер домена или контроллера домена в лесу корневой или контроллера домена с флагом домена GTIMESERV обозначает хорошо сервером времени для данного домена.  В разделе [укажите локальный надежного времени службы с помощью GTIMESERV](#GTIMESERV) далее в разделе.

- Автономные компьютеры настроены на использование time.windows.com по умолчанию.  Это имя домена разрешается поставщиком услуг Интернета, который должен указывать компании ресурсов Microsoft.  Как и все ссылки удаленному времени, перебоев в сети, могут препятствовать синхронизации.  Загружает сетевой трафик и асимметричных сетевые пути, могут снизить точность синхронизацию времени.  Для точности 1 мс не могут зависеть от удаленных источников.

Так как гостевые машины Hyper-V будут иметь по крайней мере два службы времени Windows можно выбрать, временем узла и NTP, может возникнуть себя по-разному с доменом или автономный при работе в качестве гостя.

> [!NOTE] 
> Дополнительные сведения об иерархии доменов и системы игры см. в разделе [«Что такое служба времени Windows»](https://blogs.msdn.microsoft.com/w32time/2007/07/07/what-is-windows-time-service/) записи блога.

> [!NOTE]
> Иерархической — это концепция, используется в Hyper-V и NTP поставщики, а его значение указывает расположение часы в иерархии.  Иерархической 1 зарезервирована для наивысшего уровня часы и иерархической 0 зарезервирована для оборудования, предполагается, что точной и мало или без задержки, связанные с ним.  Иерархической 2 общаться с серверами первого уровня 1, первого уровня 3 для первого уровня 2 и т. д.  Ниже иерархической часто указывает более точные часов, но, возможно, поиск несоответствия.  Кроме того служба W32time принимает только время из иерархической 15 или меньше.  Чтобы увидеть иерархической клиента, используйте *w32tm/Status /query*.

## <a name="critical-factors-for-accurate-time"></a>Важные факторы для точного времени
В любом случае для точного времени существует три важных факторов:

1. **Сплошной часы источника** -часы источника в вашего домена должна быть стабильным и актуальности. Данное событие обычно означает Установка устройства GPS или команды источника первого уровня 1, учитывая #3. Аналогию выходит, если у вас есть два лодки на воды и вы пытаетесь измерения высоту одного по сравнению с другой, точность лучше всего подходит, если источник Лодка очень стабильной и не перемещать. Это же касается времени, а если ваш исходный часы не стабильной, затем всей цепочки синхронизации часов затронутых и экранной лупы на каждом этапе. Он также должен быть доступен из-за сбоев подключения повлияет на синхронизацию времени. И наконец, он должен быть безопасной. Если время ссылка не должным образом сохранены или эксплуатируется потенциально вредоносных стороной, может привести к домена к атакам на основе времени.
2. **Часов стабильной клиента** -часы стабильной клиента гарантирует, что естественным отклонений генератор containable.  NTP-сервер использует несколько примеров из потенциально нескольких серверов NTP условие и дисциплины часы на локальных компьютерах.  Он не шаг изменения время, но вместо замедляет или ускоряет часов локального что приближения точное время быстро и будьте точные между NTP-запросы.  Тем не менее если генератор часами клиентского компьютера не стабильна, могут происходить дополнительные колебания между корректировки, а алгоритмов, который Windows использует для условие часы не работают правильно.  В некоторых случаях может потребоваться обновления встроенного по для точного времени.
3. **Симметричная NTP связи** -крайне важно, что подключения для связи с NTP симметричными.  NTP-Сервером с помощью вычисления время, предполагается, что исправление сети симметричными.  Если путь пакетов NTP-сервер принимает переход на сервер имеет другое значение для возвращения, затронутых точность.  Например путь может измениться из-за изменений в топологии сети и пакетов, проходят через устройств, имеющих интерфейса на разных скоростях.


Для устройств с питанием от батареи мобильных устройств и портативные, необходимо учитывать различные стратегии.  Согласно рекомендация поддержание точное время требует часы, чтобы быть дисциплинарном порядке один раз в секунду, который соответствует тактовой частоты обновления. Эти параметры потребляют больше энергии батареи, чем ожидается и это может мешать энергосбережению доступных режимов в Windows для таких устройств. Питанием от батареи устройства также имеют некоторые режимы питания, которые остановить все приложения, который препятствует возможность дисциплины часы и поддерживать точное время W32time. Кроме того часы на мобильных устройствах может оказаться очень точна начинается с.  Окружения условий эксплуатации влияет на точность часы и мобильных устройств можно переходить из одно условие окружения Далее, который могут влиять на возможность сохранить время точно.  Таким образом Майкрософт рекомендует настроить портативные устройства от батареи с настройками высокая точность. 

## <a name="why-is-time-important"></a>Почему важно время?  


## <a name="windows-server-2016-improvements"></a>Улучшения Windows Server 2016
### <a name="windows-time-service-and-ntp"></a>Служба времени Windows и NTP
Windows Server 2016 улучшенные алгоритмы, используемые для правильное время и условия часов локального для синхронизации с UTC.  NTP-сервер использует 4 значения для расчета смещение времени в зависимости от метки времени запроса или ответа клиента и сервера запрос и ответ.  Тем не менее сети являются шума и может быть пики данных с NTP-сервер из-за перегрузки сети и других факторов, влияющих на задержки в сети.  Алгоритмы Windows 2016 среднее out шума с помощью множества различных способов образованием часами стабильной и актуальности.  Кроме того источник используется для ссылки на точное время улучшенные API, который дает нам лучше разрешения.  С помощью этих улучшений можно добиться 1 точность мс относительно времени UTC в домене.

### <a name="hyper-v"></a>Hyper-V
Windows 2016 улучшила службы TimeSync Hyper-V. Усовершенствования включают более точное время первоначального запуска виртуальной Машины или восстановления виртуальной Машины и исправление задержка прерываний для предоставленных w32time образцов.  Это улучшение позволяет нам оставаться 10µs с узла с помощью RMS (корневой означает квадрат, который указывает отклонение), из 50µs даже на компьютере с 75% нагрузки.

> [!NOTE]
> См. в статье на [архитектура Hyper-V](https://msdn.microsoft.com/library/cc768520.aspx) Дополнительные сведения.

> [!NOTE]
> Нагрузки был создан с помощью prime95 тестирования с использованием балансировкой профиля.

Кроме того уровень иерархической, который узел отправляет отчеты для гостевой является более прозрачным.  Ранее узел представляет основных первого уровня 2, независимо от его точность.  Изменения в Windows Server 2016 узел отчеты иерархической, больше иерархической узла, образованием уменьшение времени для виртуальных гостевых элементов.  Иерархической узла определяется w32time, используя обычные средства на основе времени ее источник.  К домену Windows 2016 Гости найдет наиболее точные часы, а не по умолчанию для узла.  Именно по этой причине, мы рекомендуется вручную отключить параметр Поставщик времени Hyper-V для компьютеров, входящих в домен Windows 2012R2 и ниже.

### <a name="monitoring"></a>Мониторинг
Счетчики монитора производительности были добавлены.  Они позволяют создавать базовые показатели, отслеживания и диагностики точность времени.  Эти счетчики содержат:

Счетчик|Описание|
----- | ----- |
Вычисления смещение времени|   Абсолютный время смещение между системные часы и источником выбранное время, как вычисленного службой W32Time в микросекундах. При появлении нового образца допустимый вычисленное время обновляется смещение времени, указано в примере. Это смещение часов локального фактическое время. Служба W32Time инициирует исправление часы, с помощью этого смещения и обновляет вычисленное время между примеры оставшиеся смещение времени, который должен применяться к часов локального. Точность часов можно отслеживать с помощью этого счетчика производительности с низкой интервала опроса (например: 256 секунд или меньше) и найдите значение счетчика, должен быть меньше ограничение точность нужные часы.|
Частота корректировки часы| Коррекция частоты абсолютный часы, W32Time в частях каждого billion сделанные время локальной системы. Этот счетчик помогает визуализировать действий время W32time.|
Задержка NTP|    Самые последние задержка приема-передачи, из-за NTP-клиента в получении ответа от сервера в микросекундах. Это время, затраченное на клиенте NTP между передачи запрос на NTP-сервером и получения допустимый ответ с сервера. Этот счетчик помогает охарактеризовать опытным клиентом NTP задержки. Больше или изменяющиеся передач можно добавить шум вычисления времени NTP, которые в свою очередь, могут повлиять на точность синхронизации времени через NTP-Сервером.|
Число источников NTP клиента|    Активный номер времени NTP-сервер в качестве источника используется NTP-клиента. Это число active, отдельные IP-адресов серверов времени, которые отвечают на запросы клиента. Этот номер может быть больше или меньше настроенного одноранговых узлов, в зависимости от разрешения DNS имена одноранговых и текущего аудиторию возможности.|
NTP-сервером входящие запросы|   Число запросов, полученных NTP-сервером (запросов/сек).|
Ответы исходящих NTP сервера|  Число запросов, ответов с NTP-сервером (откликов в секунду).|

Сначала 3 счетчики целью сценариев для устранения неполадок точность.  Устранение неполадок точности времени и NTP статьи ниже, в разделе [рекомендации](#BestPractices), имеет более подробно.
Счетчики последних 3 описываются сценарии сервера NTP и являются полезными Если определить нагрузки и работе с базовыми показателями эффективности вашей текущей.

### <a name="configuration-updates-per-environment"></a>Обновления конфигурации в среде
Ниже описаны изменения в конфигурации по умолчанию между Windows 2016 и более ранних версий для каждой роли.  Параметры для Windows Server 2016 и Windows 10 Anniversary Update(build 14393), теперь являются уникальными именно поэтому отображаются в виде отдельных столбцов. 

|Роли|Параметр|В Windows Server 2016|Windows 10 версии 1607|Windows Server 2012 R2</br>Windows Server 2008 R2</br>Windows 10|
|---|---|---|---|---|
|**Изолированные и Nano Server**||||
| |*Сервер времени*|time.windows.com|NA|time.windows.com|
| |*Частота опроса*|64 - 1024 секунд|NA|Один раз в неделю|
| |*Тактовая частота обновления*|Один раз в секунду|NA|Раз в час|
|**Изолированный клиент**||||
| |*Сервер времени*|NA|time.windows.com|time.windows.com|
| |*Частота опроса*|NA|Один раз в день|Один раз в неделю|
| |*Тактовая частота обновления*|NA|Один раз в день|Один раз в неделю|
|**Контроллер домена**||||
| |*Сервер времени*|КОНТРОЛЛЕР ДОМЕНА ИЛИ GTIMESERV|NA|КОНТРОЛЛЕР ДОМЕНА ИЛИ GTIMESERV|
| |*Частота опроса*|64-1024 секунд|NA|1024 - 32768 секунд|
| |*Тактовая частота обновления*|Один раз в день|NA|Один раз в неделю|
|**Сервер члена домена**||||
| |*Сервер времени*|КОНТРОЛЛЕР ДОМЕНА|NA|КОНТРОЛЛЕР ДОМЕНА|
| |*Частота опроса*|64-1024 секунд|NA|1024 - 32768 секунд|
| |*Тактовая частота обновления*|Один раз в секунду|NA|Каждые 5 минут|
|**Клиент члена домена**||||
| |*Сервер времени*|NA|КОНТРОЛЛЕР ДОМЕНА|КОНТРОЛЛЕР ДОМЕНА|
| |*Частота опроса*|NA|1204 - 32768 секунд|1024 - 32768 секунд|
| |*Тактовая частота обновления*|NA|Каждые 5 минут|Каждые 5 минут|
|**Виртуальной машине Hyper-V**||||
| |*Сервер времени*|Выбирает лучший вариант с учетом иерархической сервера узла и время|Выбирает лучший вариант с учетом иерархической сервера узла и время|По умолчанию — узла|
| |*Частота опроса*|На основе роли выше|На основе роли выше|На основе роли выше|
| |*Тактовая частота обновления*|На основе роли выше|На основе роли выше|На основе роли выше|

>[!NOTE]
>Для Linux в Hyper-V в статье [Linux позволяет использовать время узла Hyper-V](#AllowingLinux) далее в разделе.

### <a name="impact-of-increased-polling-and-clock-update-frequency"></a>Влияние Повышенная опроса и тактовой частоты обновления
Чтобы обеспечить более точное время значения по умолчанию для опроса частоты и часы обновлениями, увеличиваются, которые мы могли внести незначительные изменения более часто.  В результате трафик UDP или NTP, однако эти пакеты малы, должно быть очень мало без существенного широкополосные сети. Тем не менее, это преимущество, время должно быть лучше на более широком спектре оборудования и среды.

Для устройств резервные батареи увеличение частоты опроса могут вызывать проблемы.  Заряда устройства не хранить время при отключенной.  Если они возобновить, может потребоваться часто исправления часы.  Увеличение частоты опроса приведет к нестабильной часов и также может использовать больше электроэнергии.  Корпорация Майкрософт рекомендует не изменяйте параметры клиента по умолчанию.

Контроллеры домена следует как минимум затронуты даже с эффектом умноженное Повышенная обновлений от клиентов NTP-Сервером в домене AD.  NTP-сервер имеет гораздо меньше потребление ресурсов, по сравнению с другими протоколами и минимальное влияние.  Вы, скорее всего, при достижении ограничения на другие функциональные возможности домена понижает увеличение параметров для Windows Server 2016.  Active Directory использовать безопасного NTP-Сервером, что обычно менее точно, чем простые NTP синхронизацию времени, но мы убедились, что он будет масштабирование для клиентов двумя иерархической от основного контроллера домена.

Как консервативный план необходимо зарезервировать 100 NTP-запросов в секунду на одного ядра.  Так домен, состоящих из 4 контроллеры доменов с 4 ядрами, можно обслуживать запросы NTP 1600 в секунду.  Если у вас есть 10 k клиенты, настроенные для синхронизации времени каждые 64 секунд, а запросы единообразно со временем, вы увидите 10 000/64, или около 160 запросов в секунду, распределены все контроллеры домена.  Это легко попадает в наших 1600 NTP запросов в секунду в этом примере.  Эти параметры консервативный рекомендации по планированию и конечно имеет большой зависимостей в сети, скорость процессора и загружает, так, чтобы всегда базовых показателей и тестирование в своих средах.

Также важно отметить, что если контроллеров доменов под управлением с значительную нагрузку на ЦП, более чем на 40%, это будет почти наверняка добавить шум NTP ответов и повлиять на точность времени в вашем домене.  Снова необходимо проверить в вашей среде, чтобы понять фактическими результатами.

## <a name="time-accuracy-measurements"></a>Точность измерения времени
### <a name="methodology"></a>Методика
Чтобы измерить время точность для Windows Server 2016, мы использовали целый ряд средств, методы и средах.  Эти методы можно использовать для измерения и настройки среды и определить ваши требованиям точность результатов. 

Наши часы исходного домена состоял двух серверов NTP чувствительными с оборудованием GPS.  Мы также использовали тестовый компьютер отдельная ссылка для измерения, которые также получили установленного другого производителя оборудования GPS высокой точностью.  Для некоторых тестирование необходимо источника достоверности часы, используйте в качестве справочника помимо источник часы вашего домена.

Мы использовали четырьмя разными методами для измерения точность физических и виртуальных машин. Несколько способов предоставить независимых средства для проверки результатов.


1. Измерения часов локального, что обусловлено w32tm, от наших ссылку тестовый компьютер, на которой есть отдельный оборудование GPS.  
2.  Измерения NTP пакеты проверки связи с NTP-сервером для клиентов, использующих W32tm «stripchart»
3.  Проверки связи NTP мер от клиента к серверу NTP-сервер, с помощью W32tm «stripchart»
4.  Результаты измерения Hyper-V с узла на виртуальной машине, с помощью счетчика метку времени (TSC).  Этот счетчик используется совместно между разделами и системное время в обоих разделов.  Мы вычисляется разница между временем узла и время клиента на виртуальной машине.  Затем мы воспользуемся TSC часы для интерполяции временем узла с гостевой, так как не произойти измерения, в то же время.  Кроме того мы используем TSV часы факторизовать задержки и задержка в API.

Встроенные w32tm, но другие средства, использованного в процессе нашего тестирования доступны для репозитория корпорации Майкрософт на GitHub как открытым исходным кодом для тестирования и использования.  Вики-САЙТ в репозитории имеет дополнительные сведения о том, как использовать средства для этого измерения.

> [https://github.com/Microsoft/Windows-Time-Calibration-Tools](https://github.com/Microsoft/Windows-Time-Calibration-Tools)

Результаты тестов, как показано ниже, являются подмножеством измерения, которые мы внесли в одном из тестовой среды.  Они показывают точность, сохраняется в начале процесса иерархия времени и дочернего домена клиента в конце иерархии времени.  Это сравнивается с же машин 2012 на основе топологии для сравнения.

### <a name="topology"></a>Топология
Для сравнения протестированы и Windows Server 2012 R2 и Windows Server 2016 на основе топологии.  Обеих топологиях состоят из двух физических компьютеров узла Hyper-V, ссылаться на компьютере Windows Server 2016 с помощью установленного оборудования часы GPS.  На каждом узле выполняется 3 домену гостевых систем windows, которые упорядочены в соответствии со следующей топологией.  Линии представляют иерархии времени и, используемый протокол и транспорта.

![Служба времени Windows](media/Windows-2016-Accurate-Time/topology1.png)

![Служба времени Windows](media/Windows-2016-Accurate-Time/topology2.png)

### <a name="graphical-results-overview"></a>Обзор графических результатов
Следующие две диаграммы представляют точность времени для двух участников, определенных в домене, на основе топологии выше.  Каждый график отображает Windows Server 2012 R2 и 2016 результаты поверх, демонстрирующего улучшения визуально.  Точность был относительно в гостевую по сравнению с узла.  Графических данных представляет собой подмножество весь набор тестов, которые мы внесли и отображает его лучшем случае и худшем сценарии.  

![Служба времени Windows](media/Windows-2016-Accurate-Time/topology3.png)

### <a name="performance-of-the-root-domain-pdc"></a>Производительность корневого домена основного контроллера домена
Для узла Hyper-V (с помощью VMIC), который является Windows Server 2016 с помощью GPS оборудования, весьма успешно быть точно и стабильно синхронизируется корневого основного контроллера домена.  Это наиболее важным требованием для 1 мс точность, оно отображается в виде зеленой затемненный области.

![Служба времени Windows](media/Windows-2016-Accurate-Time/chart1.png)

### <a name="performance-of-the-child-domain-client"></a>Производительность клиента дочернего домена
Клиент дочернего домена прикрепляется к дочернего домена PDC, который подключается к корневого основного контроллера домена.  Время, это также в течение 1 мс требование.

![Служба времени Windows](media/Windows-2016-Accurate-Time/chart2.png)


### <a name="long-distance-test"></a>Тест Междугородняя
Следующая диаграмма сравнивает 1 прыжков виртуальной сети для 6 прыжков физической сети с Windows Server 2016.  Две диаграммы создаются оверлеи друг с другом с прозрачностью для отображения перекрывающиеся данных.  Увеличение максимального числа прыжков сети означает большее время задержки и колебания больше времени.  Диаграмма увеличенной и так 1 ms границы, зеленый обозначена большего размера.  Как видно, время, по-прежнему в течение 1 мс с несколькими прыжков.  Отрицательно сдвигом, который демонстрирует асимметрии сети.  Конечно в каждой сети отличаются, а измерений зависят от множество факторов окружающей среды.

![Служба времени Windows](media/Windows-2016-Accurate-Time/chart3.png)

## <a name="BestPractices"></a>Советы и рекомендации для точной хронометраж
### <a name="solid-source-clock"></a>Сплошной источника часов
Время машин считается только часы источника, который синхронизации с.  Для достижения 1 мс точности, вам потребуется GPS оборудования или устройства времени в сети ссылаются в качестве основного источника часов.  С помощью по умолчанию time.windows.com, могут не содержать стабильной и источника местное время.  Кроме того как вы получите дальше от источника часы, сети влияет на точность.  С часами основного источника в каждом данных center необходим для наиболее точность.

### <a name="hardware-gps-options"></a>Параметры GPS оборудования
Существуют различные аппаратные решения, которые можно предложить точное время.  Как правило решения сегодня основаны на антенны GPS.  Существуют также радио и модем решения, используя специальные линии.  Их присоединения к вашей сети, либо как устройства, или подключите к компьютеру, например Windows через PCIe или USB-устройство.  Различные параметры предоставим разные уровни точность и как всегда, результаты зависят от среды.  Переменные, которые могут повлиять на точность включают GPS доступность, надежность сети и нагрузки и оборудование компьютера.  Это все важные факторы, при выборе часы источника, который как мы уже говорилось, необходима для стабильность и точное время.

### <a name="domain-and-synchronizing-time"></a>Домен и синхронизация времени
Члены домена использует доменную структуру, чтобы определить, какой компьютер они использовать в качестве источника для синхронизации времени.  Каждый член домена будет найти другой компьютер для синхронизации на и сохраните ее как источник часов.  Каждый тип члена домена следует разные наборы правил, чтобы найти источник времени для синхронизации времени.  PDC в корне леса является источником часы по умолчанию для всех доменов.  Ниже перечислены различные роли и как их найти источник высокого уровня описание.


- **Контроллер домена с ролью PDC** — этот компьютер является доверенным источником времени для домена. Он будет иметь наиболее точные доступного времени в домене и необходимо синхронизировать с контроллером домена в родительском домене, за исключением в случаях, где [GTIMESERV](#GTIMESERV) включена роль. 
- **Любому другому контроллеру домена** — этот компьютер будет выступать в качестве источника времени для клиентов и рядовые серверы в домене. Контроллер домена могут синхронизироваться с основным контроллером домена в собственном домене или любой контроллер домена в его родительским доменом.
- **Клиенты или рядовых серверах** — этот компьютер можно синхронизировать с контроллера домена или PDC собственного домена или контроллера домена или основного контроллера домена в родительском домене.

В зависимости от доступных кандидатов системы игры используется для нахождения Лучший источник времени.  Эта система учитывает надежности источника времени и его относительное расположение.  Это происходит, когда при время запуска службы.  Если вам нужны более точное управление как синхронизирует время, можно добавить хорошая серверы в определенных местах или добавить избыточность.  В разделе [укажите локальный надежного времени службы с помощью GTIMESERV](#GTIMESERV) Дополнительные сведения.

#### <a name="mixed-os-environments-win2012r2-and-win2008r2"></a>ОС смешанных средах (Win2012R2 и Win2008R2)
Хотя чистой среде домена Windows Server 2016 необходим для наиболее точность, существует преимущества в смешанной среде.  Развертывание Windows Server 2016 Hyper-V в домене Windows 2012 польза гостевых виртуальных машинах, из-за улучшений, которые мы упомянули выше, но только если гостей также являются Windows Server 2016.  Windows Server 2016 основным контроллером домена, будет предоставлять более точное время из-за улучшенные алгоритмы, которые оно будет более стабильной источника.  Как замену PDC могут быть параметр, вместо этого можно добавить контроллер домена Windows Server 2016 с [GTIMESERV](#GTIMESERV) сводный набор, который будет обновления в точности для вашего домена.  Контроллере домена Windows Server 2016 могут предоставлять уменьшение времени клиентам подчиненных времени, однако только так же хорошо, как его источник времени NTP.

Кроме того, как было указано выше частоты опроса и обновить часы были изменены с Windows Server 2016.  Их можно вручную изменен на нижнего уровня контроллеров доменов или применить через групповую политику.  Пока мы не протестировать эти конфигурации, они должны вести себя в Win2008R2 и Win2012R2 и предоставлять некоторые преимущества.

Версии до того, как Windows Server 2016 несколько проблем, поддержание точное время, хранение, вызвавшее в системе время дрейфующие сразу же после внесения изменения.  По этой причине получения примеры времени источника точные NTP часто и сглаживание часов локального с данными, приводит к более мелкие отклонений в свои часы системы внутри выборку период, из-за которой уменьшение времени, в более ранних версиях операционной системы. Лучше всего наблюдаемых точность была около 5 мс, когда клиент 2012R2 NTP-Сервером Windows Server, настроены с использованием параметров высокая точность, синхронизации времени с точным сервера Windows 2016 NTP.

В некоторых сценариях с использованием контроллеров домена на виртуальной машине Hyper-V TimeSync примеры могут нарушить работу домена синхронизации времени.  Это будет больше не является проблемой для гостей Server 2016, работающих на узлах Server 2016 Hyper-V.

Отключение службы TimeSync Hyper-V от предоставления выборок w32time, настройте следующий раздел реестра виртуальной машине:

    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\VMICTimeProvider 
    "Enabled"=dword:00000000

#### <a name="AllowingLinux"></a>Позволяет Linux использовать время узла Hyper-V
Для гостевых систем Linux в Hyper-V клиенты обычно настраивается для использования управляющей программы NTP для синхронизации времени с NTP-серверами.  Если дистрибутив Linux поддерживает протокол TimeSync версии 4 и гостевых ОС Linux имеет включена служба интеграции TimeSync, оно синхронизируется с временем узла. Это может привести к несогласованности время, чтобы если оба метода включены.

Чтобы синхронизировать только с временем узла, рекомендуется отключить функцию синхронизации времени NTP какой-либо:

- Отключение серверы NTP в файле ntp.conf
- или отключение управляющую программу NTP

В этой конфигурации сервер времени параметр является этот узел.  Его опроса частоты 5 секунд и тактовой частоты обновления 5 секунд.

Для синхронизации только через NTP, рекомендуется отключить службу интеграции TimeSync на гостевой виртуальной машине.

> [!NOTE]
> Примечание: Поддержка точное время гостей Linux требует функция, которая поддерживается только в последней вышестоящего ядрах Linux и не является то, что еще широко доступны на всех дистрибутивах Linux. Дополнительную информацию можно [поддерживаемые Linux и FreeBSD виртуальных машин Hyper-V в Windows](https://technet.microsoft.com/en-us/windows-server-docs/virtualization/hyper-v/supported-linux-and-freebsd-virtual-machines-for-hyper-v-on-windows) Дополнительные сведения о дистрибутивах поддержки.

#### <a name="GTIMESERV"></a>Укажите локальный надежную службу времени с помощью GTIMESERV
Можно указать один или несколько контроллеров домена в качестве часы точные источника с помощью GTIMESERV, хорошо сервер времени, флаги.  Например определенные контроллеры домена с оборудования GPS можно отмечена как GTIMESERV.  Это будет гарантировать домена ссылается на часы, основанные на оборудовании GPS.

> [!NOTE]
> Дополнительные сведения о флагах домена можно найти в [документации протокола MS-ADTS](https://msdn.microsoft.com/library/mt226583.aspx).

TIMESERV является другой связанных домена службы флаг, указывающий является ли компьютер в настоящее время заслуживающих доверия, который можно изменить, если контроллер домена теряет соединение.  Контроллер домена в этом состоянии будет возвращать «Неизвестный иерархической» при запросе через NTP-Сервером.  После нескольких попыток, контроллер домена будет записывать в журнал системных событий службы времени событий 36.

Если вы хотите настроить контроллер домена в качестве GTIMESERV, это можно настроить вручную с помощью следующей команды.  В этом случае контроллер домена использует другой машины как синхронизирующий.  Это может быть устройства или выделенном компьютере.

    w32tm /config /manualpeerlist:”master_clock1,0x8 master_clock2,0x8” /syncfromflags:manual /reliable:yes /update

> [!NOTE]
> Дополнительные сведения см. в разделе [Настройка службы времени Windows](https://technet.microsoft.com/library/cc731191.aspx)

Если контроллер домена имеет установленного оборудования GPS, необходимо использовать указанные ниже действия для отключения NTP-клиента и включения NTP-сервером.

Запуск, отключив NTP-клиента и Включение NTP-сервера, используя эти изменения разделов реестра.

    reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\w32time\TimeProviders\NtpClient /v Enabled /t REG_DWORD /d 0 /f

    reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\w32time\TimeProviders\NtpServer /v Enabled /t REG_DWORD /d 1 /f

Затем перезапустите службу времени Windows

    net stop w32time && net start w32time

Наконец вы указываете, что этот компьютер имеет источника надежный источник времени с помощью.
   
    w32tm /config /reliable:yes /update

Чтобы проверить, что изменения были выполнены надлежащим образом, необходимо выполнить следующие команды, которые могут повлиять на результаты, как показано ниже. 

    w32tm /query /configuration

Значение|Ожидаемое значение|
----- | ----- |
AnnounceFlags|  5 (локальный)|
NTP-сервер   |(Локальные)|
DllName |C:\WINDOWS\SYSTEM32\w32time.DLL (локальный)|
Включен |1 (локальный)|
NTP-клиент|  (Локальные)|

    w32tm /query /status /verbose

Значение|  Ожидаемое значение|
----- | ----- |
Иерархической|    1 (основная ссылка - синхронизирована с часами радио)|
ReferenceId|    0x4C4F434C (имя источника: «LOCAL»)|
Источник| Часов локального CMOS|
Этап смещение|   0.0000000s|
Роль сервера|    576 (надежную службу времени)|

#### <a name="windows-server-2016-on-3rd-party-virtual-platforms"></a>Windows Server 2016 на третьей стороной виртуальных платформах
При виртуализации Windows, по умолчанию гипервизор отвечает за предоставление времени.  Однако члены нужно управлять с контроллером домена в порядке для Active Directory для правильной работы присоединен к домену.  Рекомендуется отключить виртуализацию все время между гостевой ОС и узлом любой стороной виртуальных платформ.

#### <a name="discovering-the-hierarchy"></a>Обнаружение иерархии
Поскольку цепочку иерархии времени к источнику синхронизирующий является динамическим в домене и согласовании, вам потребуется запросить состояние конкретного компьютера, чтобы понять, что источник времени и цепочку часы основного источника.  Это может помочь диагностировать проблемы с синхронизацией времени.

Учитывая вы хотите Устранение неполадок определенного клиента; Первый этап — понять его источником времени с помощью этой команды w32tm.

    w32tm /query /status

Результаты отображают источник многое другое.  Источник указывает, с которым синхронизации времени, в домене.  Это первый шаг иерархии времени этой машины.
Затем используйте запись источника сверху и /StripChart параметр, чтобы найти Далее источником времени в цепочке.

    w32tm /stripchart /computer:MySourceEntry /packetinfo /samples:1

Также полезно следующую команду перечислены каждого контроллера домена, его можно найти в заданном домене и выводит результат, что позволяет определить каждого партнера.  Эта команда будет включать компьютеров, которые были заданы вручную.
    
    w32tm /monitor /domain:my_domain

С помощью списка, можно отслеживать результаты через домен и понять иерархии, а также смещение времени в каждом шаге.  Зайдите в точку, где значительно усугубляется смещение времени, можно будет определить корневой неправильное время.  Здесь можно попробовать понять, почему это время неправильное, включив [ведения журнала w32tm](#W32Logging). 

#### <a name="using-group-policy"></a>С помощью групповой политики
Можно использовать групповой политики добиваться более строгие точность, например, для назначением клиентов для использования определенных серверов NTP или ОС управления как нижнего уровня настраиваются при виртуальных.  
Ниже приведен список возможных сценариев и соответствующие параметры групповой политики.

**Виртуализированные домены** — для управления виртуализированных контроллеров домена в Windows 2012R2, чтобы они синхронизации времени с их домена, а не с узлом Hyper-V, вы можете отключить этот параметр реестра.   Для основного контроллера домена вы не хотите отключить запись, как узел Hyper-V доставляет наиболее стабильное источника времени.  Запись реестра необходимо перезапустить службы w32time после его изменения.

    [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\VMICTimeProvider]
    "Enabled"=dword:00000000

**Конфиденциальные загружает точность** - рабочих нагрузок конфиденциальные точность времени, можно настроить группы компьютеров, чтобы задать серверы NTP-сервер и все связанные параметры времени, такие как частота обновления опросов и часы.  Это обычно обрабатывается в домене, но для получения более широких можно ориентироваться на определенных компьютерах, чтобы они указывали синхронизирующий.

Параметр групповой политики|   Новое значение|
----- | ----- |
NTP-сервер|  ClockMasterName 0x8|
MinPollInterval|    6 – 64 секунд|
MaxPollInterval|    6|
UpdateInterval| 100 – раз в секунду|
EventLogFlags|  3 – все специальные время ведения журнала|

> [!NOTE]
> NTP-сервер и EventLogFlags параметры находятся в Service\Time поставщиков System\Widows времени, с помощью параметров настройки NTP-клиента Windows.  Другие 3 находятся в папке System\Windows службой времени, используя глобальные параметры конфигурации.

**Удаленных точностью конфиденциальные загружает удаленного** — для систем, в доменах филиала для экземпляра розничной торговли и кредитная индустрии платежных (PCI), Windows использует сведения о текущем сайте и источник настроен времени, локатора контроллеров домена, чтобы найти локальный контроллер домена, при отсутствии вручную NTP.  Эта среда требует 1 секунда точность, который использует быстрее конвергенции правильное время.  Этот параметр позволяет службы w32time перемещения часы в обратном направлении.  Если это приемлемо, соответствует вашим требованиям, можно создать следующие политики.   Как и в любой среде гарантирует для тестирования и базовые показатели вашей сети. 

Параметр групповой политики|   Новое значение|
----- | ----- |
MaxAllowedPhaseOffset|  1, если более чем на секунду, часы переводятся в нужное время.|

Параметр MaxAllowedPhaseOffset расположен в разделе System\Windows службой времени, используя глобальные параметры конфигурации.

> [!NOTE]
> Дополнительные сведения о групповой политике и связанных записей см. в разделе [средства службы времени Windows](windows-time-service-tools-and-settings.md) и параметры в статье в библиотеке TechNet.

#### <a name="azure-and-windows-iaas-considerations"></a>Рекомендации по Azure и Windows IaaS

##### <a name="azure-virtual-machine-active-directory-domain-services"></a>Azure виртуальной машины: Доменные службы Active Directory
Если виртуальной Машине Azure доменных служб Active Directory является частью существующей локальной леса Active Directory, затем TimeSync(VMIC) должна быть отключена. Это позволяет обеспечить все контроллеры домена в лесу, физических и виртуальных, использовать иерархию синхронизации один раз. См. Технический документ по наиболее практического [«под управлением домена контроллеры в Hyper-V»](https://technet.microsoft.com/en-us/library/virtual_active_directory_domain_controller_virtualization_hyperv.aspx)

##### <a name="azure-virtual-machine-domain-joined-machine"></a>Azure виртуальной машины: Компьютер присоединен к домену
При размещении компьютера, который подключен к домену в существующий лес Active Directory, виртуальным или физическим, рекомендуется отключить TimeSync для гостей и обеспечить W32Time настроен для синхронизации с контроллером домена через Настройка времени для типа = NTP5

##### <a name="azure-virtual-machine-standalone-workgroup-machine"></a>Azure виртуальной машины: Компьютер рабочей группы изолированного
Если виртуальной Машине Azure не присоединен к домену, и не является контроллером домена, рекомендуется сохранить конфигурацию по умолчанию время и синхронизировать с узлом виртуальной машиной.

### <a name="windows-application-requiring-accurate-time"></a>Windows требуется точное время приложения
#### <a name="time-stamp-api"></a>Метка времени API
Программы, требующие максимальную точность относительно времени UTC, а не прохождения времени, должны использовать [GetSystemTimePreciseAsFileTime API](https://msdn.microsoft.com/library/windows/desktop/Hh706895.aspx).  Это гарантирует, что ваше приложение получает системное время, что обусловлено службы времени Windows.

#### <a name="udp-performance"></a>Производительность UDP
Если какое-либо приложение использует UDP связи для транзакций и его организации, важно свести к минимуму задержку, некоторые связанные записи реестра, которые можно использовать для настройки диапазона портов, должны быть исключены из порта базовой, фильтрации.  Это будет увеличить обоих задержку и на пропускную способность.  Тем не менее изменения в реестр должны быть ограничены опытными администраторами.  Кроме того этот способ исключает порты из защищаемого брандмауэром.  См. в статье справочнике ниже дополнительные сведения.

Для Windows Server 2012 и Windows Server 2008 необходимо сначала установить исправление.  Можно сослаться в этой статье БАЗЫ знаний: [утерянных датаграмм при запуске приложения многоадресной рассылки получателя в Windows 8 и Windows Server 2012](https://support.microsoft.com/en-us/kb/2808584)

#### <a name="update-network-drivers"></a>Обновление драйверов сети
Некоторые поставщики сетевых имеют обновления драйверов, что повышает производительность относительно задержки драйверов и пакетов UDP буферизации.  Обратитесь к поставщику сети ли имеются обновления, которые помогут с пропускной способностью UDP.

### <a name="logging-for-auditing-purposes"></a>Ведение журнала для целей аудита
Нормам время трассировки вручную архивировать w32tm журналы, журналы событий и информацию о мониторе производительности.  Более поздней версии архивные данные можно использовать для подтверждения того соответствия на определенный момент в прошлом.  Для указания точность используются следующие факторы.


1. С помощью счетчиков системного монитора вычисления смещение времени точность часов.  Здесь отображается часов в требуемую точность.
2.  Ищете ответ однорангового элемента «из» в журналах w32tm источника часов.   Следующий текст сообщения — это IP-адрес или VMIC, описывающей источник времени и далее в цепочке ссылок часов для проверки.
3.  Условия состояния, с помощью w32tm журналы, чтобы проверить, что часов» Дисциплина ClockDispl: \*SKEW\*TIME\*» происходят.  Это означает, что во время этого w32tm активен.

#### <a name="event-logging"></a>Ведение журнала событий
Чтобы получить описание функциональности, вам также потребуется информация из журнала событий.  Сбор журнала системных событий и фильтрацию, на сервер времени, Microsoft-Windows-Kernel-Boot, Microsoft-Windows-ядра Общие, может быть возможности обнаружения, если есть другие влиянием измененные времени, например, третьим лицам.  Эти журналы может потребоваться исключить внешних помех.  Групповая политика может повлиять на какие журналы событий записываются в журнал.  Дополнительные сведения см. раздел выше на использование групповой политики.

#### <a name="W32Logging"></a>Ведение журнала отладки W32Time
Чтобы включить w32tm для целей аудита, следующая команда включает ведение журнала, который показывает периодические обновления часы и указывает часы источника.  Перезапустите службу, чтобы включить ведение журнала для нового.  

Дополнительные сведения см. в разделе [как включить ведение журнала в службу времени Windows для отладки](https://support.microsoft.com/en-us/kb/816043).

    w32tm /debug /enable /file:C:\Windows\Temp\w32time-test.log /size:10000000 /entries:0-73,103,107,110

#### <a name="performance-monitor"></a>Монитор производительности
Служба времени Windows Windows Server 2016 предоставляет счетчики производительности, которые можно использовать для сбора аудита в журнал.  Они могут регистрироваться локально или удаленно.  Можно записать смещение времени компьютера и счетчики задержки кругового пути.  
И как счетчик производительности можно отслеживать их удаленно и создание оповещений с помощью System Center Operations Manager.  Для экземпляра позволяют оповещение будильник вы при смещение времени отличается от требуемую точность.  [Пакет управления System Center](https://social.technet.microsoft.com/wiki/contents/articles/15251.system-center-management-pack-authoring-guide.aspx) приводятся дополнительные сведения.

#### <a name="windows-traceability-example"></a>Пример отслеживания Windows
Из файлов журнала w32tm требуется проверить два фрагмента информации.  Первый — указывает, что файл журнала в настоящий момент условие часы.  Доказать, что часы был определяется во время спорной службой времени Windows.

    151802 20:18:32.9821765s - ClockDispln Discipline: *SKEW*TIME* - PhCRR:223 CR:156250 UI:100 phcT:65 KPhO:14307
    151802 20:18:33.9898460s - ClockDispln Discipline: *SKEW*TIME* - PhCRR:1 CR:156250 UI:100 phcT:64 KPhO:41
    151802 20:18:44.1090410s - ClockDispln Discipline: *SKEW*TIME* - PhCRR:1 CR:156250 UI:100 phcT:65 KPhO:38

Основным инструментом — разделе сообщения, начинающимся с Дисциплина ClockDispln это документ, подтверждающий w32time взаимодействует с системных часов.
 
Далее вам нужно найти последний отчет в журнале перед спорной время, которое сообщает исходного компьютера, который в настоящее время используется как часы ссылки.  Это может быть IP-адрес, имя компьютера или поставщик VMIC, который указывает, что она выполняет синхронизацию с узлом Hyper-v.  В следующем примере приводится IPv4-адрес 10.197.216.105.

    151802 20:18:54.6531515s - Response from peer 10.197.216.105,0x8 (ntp.m|0x8|0.0.0.0:123->10.197.216.105:123), ofs: +00.0012218s

Теперь, когда проверки предоставленных первая система в цепочке ссылок времени необходимо Проверьте файл журнала на источник времени ссылки и повторите те же действия.  Это продолжается, пока не дойдете до физических часов, такие как GPS или известного источника времени как NIST.  Если ссылка часы GPS оборудования, затем журналы из произведенных могут требовать.

### <a name="network-considerations"></a>Требования к сети
Алгоритмы протокол NTP, зависят от симметрии вашей сети.  Как увеличить число прыжков сети повышает вероятность асимметрии.  Существует, очень трудно предсказать, какие типы accuracies, вы увидите в соответствии с конкретной средой. 

Монитор производительности и счетчиков времени Windows в Windows Server 2016 можно использовать для оценки вашей среды точность и Создание базовых показателей. Кроме того можно выполнить, устранение неполадок, чтобы определить текущее смещение любому компьютеру в сети.

Существует две общие стандартов точное время по сети.  PTP ([протокол NTP точности - IEEE 1588](https://www.nist.gov/el/intelligent-systems-division-73500/introduction-ieee-1588)) имеет более жесткие требования к сетевой инфраструктуре, но часто содержат дочерние микросекунд точность.  NTP-Сервером ([протокол NTP-RFC 1305](https://tools.ietf.org/html/rfc1305)) работает на больших различных сетей и среды, что облегчает управление. 

Windows поддерживает простой NTP (RFC2030) по умолчанию для компьютеров к домену, не входящих в домен.  Для компьютеров к домену, мы используем безопасного NTP под названием [MS SNTP](https://msdn.microsoft.com/en-us/library/cc246877.aspx), который использует домен согласование секреты, предоставляют управления преимущества по сравнению с проверкой подлинности NTP, описанных в RFC1305 и RFC5905.   

Имя домена и к домену протоколов не входящих в домен необходимо UDP-порт 123.  Дополнительные сведения о рекомендациях по NTP называть [сети времени протокола лучший текущий рекомендациям IETF черновик](https://tools.ietf.org/html/draft-ietf-ntp-bcp-00).

### <a name="reliable-hardware-clock-rtc"></a>Надежное системных часов (RTC)
Windows не не времени шаг, пока не превышены определенные границы, но вместо дисциплинах часы.  Это означает, что w32tm настраивает частоту часы через определенный интервал, с помощью тактовой частоты обновления, установка, которые по умолчанию — один раз в секунду, Windows Server 2016.  Если за часы, она ускоряет частоту и вперед в противном случае это замедляет частоту.  Тем не менее это время между часами частоты изменения системных часов возможности управления.  Если проблема заключается в микропрограмме или системных часов, время на компьютере может стать менее точным.

Это еще одна причина, которые необходимо протестировать и базовые показатели в вашей среде.  Если счетчик производительности «Вычисления смещение времени» не стабилизировать в точности, который вы используете, может потребоваться убедитесь, что обновления встроенного по.  Как другого теста можно просмотреть, если дубликатов воспроизвести то же самое.

### <a name="troubleshooting-time-accuracy-and-ntp"></a>Устранение неполадок точность времени и NTP
Можно использовать обнаружение разделе иерархии, показанное выше, чтобы определить источник неправильное время.  Просмотрев смещение времени, найти точку в иерархии, где время отличается от источника NTP наиболее.  Поняв иерархии, необходимо попробовать и понять, почему источника определенный момент времени не получает точное время.  

Фокусировка на системе с дивергентному времени, эти средства ниже можно использовать для сбора Дополнительные сведения помогут вам определить проблему и найти решение.  UpstreamClockSource ссылку ниже, находятся часы, обнаруживаемое с помощью «w32tm /config /Status».


- Журналы событий системы
- Включить ведение журнала с помощью: журналы w32tm - w32tm /debug /enable /file: C:\Windows\Temp\w32time-test.log//size: 10000000 /entries: 0 300
- раздел реестра w32Time HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\W32Time
- Операции в локальной сети
- Счетчиков производительности (на локальном компьютере или UpstreamClockSource)
- W32tm /stripchart /computer: UpstreamClockSource
- UpstreamClockSource PING для понимания задержки и число прыжков источник
- Tracert UpstreamClockSource

Проблема|    Симптомы|   Разрешение|
----- | ----- | ----- |
Локальный TSC часы может быть нестабильным.| С помощью системного монитора - физического компьютера — синхронизации часов стабильной часы, но вы по-прежнему видеть, что каждый 1 – 2 минуты несколько 100us. |   Обновление встроенного по или проверить другое оборудование не отображается, то же самое.|
Задержка сети|    W32tm stripchart отображает RoundTripDelay более чем 10 мс.  Вариант шум причина задержки, объему ½ время кругового пути, например задержки, только в одном направлении.</br></br>UpstreamClockSource работает несколько прыжков путем проверки СВЯЗИ.  После истечения срока ЖИЗНИ должна быть близкой к 128.</br></br>Используйте Tracert найдут задержку каждого перехода.    | Найти источник ближе часов для времени.  Возможное решение проблемы — установить часы источника в том же сегменте или вручную указать источник часы, которые физически находятся ближе.  С доменом можно добавьте в компьютер с ролью GTimeServ. |  
Не удается подключиться к надежного источника NTP|    W32tm /stripchart периодически возвращает «Истекло время ожидания запроса»    |Источник NTP завис|
Источник NTP завис|    Поиск ответов исходящих сервера NTP число источников клиента NTP, NTP сервера входящие запросы, счетчики системного монитора и определите использования по сравнению с базовых параметров.|    С помощью счетчиков производительности сервера, определите, изменилось ли ссылке базовых параметров загрузки.</br></br>Существуют сети перегрузки проблемы?|
Контроллер домена, не используется наиболее точные часы|    Изменения в топологии или недавно добавленные главной часы.|   w32tm /resync "" /rediscover|
Дрейфующие часы клиента| Служба времени события 36 в журнал системных событий и/или текста в файл журнала, указывающая, что: переход от 1 до 0 счетчика «Счетчик источник времени NTP клиента»|Устранение вышестоящего источника и понять, если он работает в проблем с производительностью.|

### <a name="baselining-time"></a>Базовые показатели времени
Базовые показатели важно, во-первых, могли понять, производительность и точность сети и при возникновении проблем в будущем сравнения с базовыми показателями.  Вам нужно будет базовых показателей корневого основного контроллера домена или все компьютеры, помеченные GTIMESRV.  Мы также рекомендуем базовых основного контроллера домена в каждом лесу.  Наконец, выбрать любой критически важных контроллеров домена или компьютеры, которые имеют интересные характеристики, например расстояния или высокой нагрузки и базового плана этих.

Также полезно для базовых показателей Windows Server 2016 vs 2012 R2, однако имеется только w32tm /stripchart как средство можно использовать для сравнения, так как Windows Server 2012 R2 не имеет счетчиков производительности.  Следует выбрать два компьютера с одинаковыми характеристиками или обновить компьютер, а также сравните результаты после обновления.  Дополнительное соглашение измерения времени Windows приводятся дополнительные сведения о том, как сделать подробные измерения между 2016 и 2012.

С помощью всех w32time счетчики производительности, сбор данных по крайней мере за неделю.  Это будет убедиться, что имеется достаточно ссылку на учетную запись для различных в сети со временем и достаточно выполнения для обеспечения уверенность в том, что время точность стабильной.

### <a name="ntp-server-redundancy"></a>Избыточности NTP-сервера
Для ручной настройки NTP-сервера с компьютеров к домену не входящих в домен или основной контроллер домена наличие более одного сервера — это мера хорошая избыточность, в случае доступности.  Он также может предоставить точность, при условии, что все источники работают точно и стабильно.  Тем не менее, топологии также не предназначен, или источниками времени не стабильны, полученный точность может быть хуже, поэтому следует соблюдать осторожность.  Поддерживаемые время w32time серверов вручную может ссылаться ограничено 10. 

## <a name="leap-seconds"></a>LEAP секунд
Период вращения Земли меняются с течением времени, из-за события climatic и геологические. Как правило варианта посвящен второй каждые несколько лет. Каждый раз, когда вариант с атомарными времени становится слишком большим, коррекция одну секунду (вверх или вниз) вставлен, называется секунда. Это делается так, что разница никогда не превышает 0.9 секунд. Это исправление было объявлено шесть месяцев опережают фактические исправление. До Windows Server 2016 службу времени корпорация Майкрософт не было известно о leap секунд, но полагаться на службу внешних времени ухаживать это. При установке точности увеличению времени, Windows Server 2016 Корпорация Майкрософт работает на более подходящее решение проблемы секунда.

## <a name="secure-time-seeding"></a>Безопасная время инициализации
Служба W32Time в Server 2016 включает функцию безопасной время инициализации. Эта функция определяет приблизительное текущее время из исходящего SSL-подключений.  Это значение времени используется для отслеживания локальный системные часы и исправьте все ошибки грубой. Подробнее о функции в [этой записи блога](https://blogs.msdn.microsoft.com/w32time/2016/09/28/secure-time-seeding-improving-time-keeping-in-windows/).  В развертываниях с надежный источник времени источников и хорошо отслеживаемых компьютерах включить наблюдение за смещения времени, вы можете не использовать функцию безопасной время инициализации и вместо этого на существующей инфраструктуре. 

Вы можете отключить эту функцию с помощью этих действий:

1.  Присвойте значение конфигурации реестра UtilizeSSLTimeData 0 на определенном компьютере:

    Добавление REG HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\w32time\Config /v UtilizeSslTimeData /t REG_DWORD /d 0 /f


2.  Если не удается перезагрузить компьютер немедленно, из-за какой-либо причине, можно уведомить службы W32time об обновлении конфигурации. При этом прекращается выполнение время наблюдения и принудительного применения на основе данных о времени собираются из SSL-подключений. 

    W32tm.exe /config /update

3.  Перезагрузки компьютера чему параметр вступает в силу немедленно и вызывает его, чтобы остановить процесс сбора любой данных времени от SSL-подключений.  Последней части очень малой нагрузку и не должен представлять собой проблему производительности.

4.  Чтобы применить этот параметр во всем домене, значение UtilizeSSLTimeData W32time параметр групповой политики значение 0 и опубликовать этот параметр.  Когда этот параметр является забрать клиента групповой политики, служба W32time отправляется уведомление, и он перестанет время наблюдения и принудительного применения с помощью SSL данных времени. Сбор данных времени SSL будет остановлен при перезагрузки каждого компьютера. Если домен имеет портативные тонкий ноутбуки и планшеты и другие устройства, может потребоваться исключить таких машин из этого изменения политики. Эти устройства в конечном итоге обращен разрядку батареи, а должны заполнения безопасной время компонентов подготовить их времени.














 













 




