---
ms.assetid: 6086947f-f9ef-4e18-9f07-6c7c81d7002c
title: Средства и параметры службы времени Windows
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 10/16/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: 7cf3b3f2bb9a2c9f95c50aa6a7b7690f89cdd0af
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59840665"
---
# <a name="windows-time-service-tools-and-settings"></a>Средства и параметры службы времени Windows
>Относится к: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows 10 или более поздней версии

В этом разделе вы узнаете о средствах и параметров службы времени Windows (W32Time). 

Если вы хотите синхронизировать время для присоединенных к домену клиентского компьютера, см. в разделе [настроить клиентский компьютер для синхронизации времени автоматического домена](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc816884%28v%3dws.10%29). Дополнительные разделы, описывающие способы настройки службы времени Windows, см. в разделе [где можно найти сведения конфигурации службы Windows время](https://docs.microsoft.com/windows-server/networking/windows-time-service/windows-time-service-top).  
  
>[!CAUTION]  
>Не следует использовать команды Net time для настройки или задать время, когда служба времени Windows запущена.  
>
>Кроме того на устаревших компьютерах под управлением Windows XP или более ранних версиях /querysntp команды Net time команда отображает имя сервера протокола сетевого времени (NTP), с которой компьютер настроен на синхронизацию, но этого NTP-сервер используется только в том случае, если клиент времени компьютера настроен в качестве NTP или AllSync. Является устаревшим, так как этой команды.  
  
Тип клиента времени NT5DS, это означает, что их синхронизации времени в иерархии домена у большинства компьютеров члена домена. Только типичные исключением из этого — контроллер домена, который работает как хозяин операций эмулятора основного контроллера основного домена корневого домена леса, который обычно настраивают для синхронизации времени с внешним источником времени. Чтобы просмотреть конфигурацию клиента времени компьютера, выполните команду W32tm/Query /configuration из командной строки с повышенными правами при запуске в Windows Server 2008 и Windows Vista и прочитать **тип** строки в выходные данные команды. Дополнительные сведения см. в разделе [принцип работы службы времени Windows](https://docs.microsoft.com/windows-server/networking/windows-time-service/How-the-Windows-Time-Service-Works). Можно выполнить команду **reg query HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters** и прочитать значение **NTP-сервер** в выходных данных команды.  
  
> [!IMPORTANT]  
> До выпуска Windows Server 2016 служба W32Time не была разработана для удовлетворения потребностей приложения с учетом времени.  Однако обновления до Windows Server 2016 теперь позволяют реализовать решение для 1 мс точности в вашем домене.  См. в разделе [Windows 2016 Accurate время](accurate-time.md) и [границы поддержки, чтобы настроить службу времени Windows для сред с высокой точностью](https://docs.microsoft.com/windows-server/networking/windows-time-service/support-boundary) Дополнительные сведения.  
  
## <a name="windows-time-service-tools"></a>Средства службы времени Windows  
Следующие средства связаны со службой времени Windows.  
  
#### <a name="w32tmexe-windows-time"></a>W32tm.exe: Служба времени Windows  
**Категория**  

Этот инструмент устанавливается как часть Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 установок по умолчанию.  
  
**Совместимость версий**  
  
Это средство работает в Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 установок по умолчанию.  
  
W32tm.exe используется для настройки параметров службы времени Windows. Он также может использоваться для диагностики проблем со службой времени. W32tm.exe является средством предпочтительный командной строки для настройки, мониторинга или Устранение неполадок службы времени Windows.  
  
В следующих таблицах описываются параметры, которые используются с W32tm.exe.  
  
**Основные параметры W32tm.exe**  
  
|Параметр|Описание|  
|-------------|---------------|  
|W32tm /?|Справка по командной строке W32tm|  
|W32tm/Register|Регистрирует службу времени для запуска в качестве службы и добавляет в реестр конфигурации по умолчанию.|  
|W32tm / unregister|Отменяет регистрацию службы времени и удаляет все сведения о конфигурации из реестра.|  
|W32tm /monitor<br /><br />[/ домена:<domain name>] [/ компьютеров:<name>[,<name>[,<name>...]]] [/ потоки:<num>]|Domain - указывает, какой домен для отслеживания. Если имя домена не задано, или указан параметр домена ни компьютеры, используется домен по умолчанию. Этот параметр может использоваться более одного раза.<br /><br />компьютеры — отслеживает заданный список компьютеров. Имена компьютеров разделяются запятыми без пробелов. Если имени добавляется префикс "*", он рассматривается как основной контроллер домена. Этот параметр может использоваться более одного раза.<br /><br />потоки — указывает число компьютеров, чтобы анализировать одновременно. Значение по умолчанию — 3. Допустимый диапазон — от 1 до 50.|  
|W32tm /ntte <NT time epoch>|Преобразовать в системное время NT, (10 ^ -7) s интервалах - секундных интервалах, в удобном для чтения формате.|  
|W32tm /ntpte <NTP time epoch>|Преобразование времени NTP, (2 ^ -32) s интервалах 1 января 1900 года в удобном для чтения формате.|  
|команду w32tm/resync<br /><br />[/ компьютера:<computer>]<br /><br />[/ nowait]<br /><br />[/rediscover]<br /><br />[/ обратимо]|Указывает компьютер, следует выполнить синхронизацию часов как можно скорее, и сбросить статистику накопленных ошибок.<br /><br />компьютер:<computer> -компьютер, который следует выполнить синхронизацию. Если не указан, будет выполнена повторная синхронизация локального компьютера.<br /><br />nowait - не стоит ожидать, для повторной синхронизации синхронизации; немедленный возврат. В противном случае ожидания повторной синхронизации для выполнения перед возвратом.<br /><br />Повторное обнаружение — обнаружить конфигурацию сети и повторное обнаружение сетевых источников, а затем повторно синхронизировать.<br /><br />soft - повторной синхронизации, с помощью существующей статистики ошибок. Бесполезные, предоставленный для обеспечения совместимости.|  
|W32tm /stripchart<br /><br />/ Computer:<target><br /><br />[/ период:<refresh>]<br /><br />[/dataonly]<br /><br />[/ samples:<count>]<br/><br/>[/rdtsc]<br/>|Отображение диаграммы различий между данным компьютером и другой компьютер.<br /><br />компьютер:<target> -компьютер для сравнения.<br /><br />период:<refresh> — время между выборками в секундах. Значение по умолчанию-2 секунды.<br /><br />dataonly - отображают только данные без графики.<br /><br />Примеры:<count> - собрать <count> образцы, затем остановите. Если не указано, сбор данных прекращается до **Ctrl + C** нажата.<br/><br/>RDTSC: для каждого примера, этот параметр выводит значения с разделителями-запятыми, а также заголовки RdtscStart, RdtscEnd, FileTime, RoundtripDelay, NtpOffset вместо его текст.<br/><ul><li>[RdtscStart — RDTSC (чтение счетчика отметок времени)](https://en.wikipedia.org/wiki/Time_Stamp_Counter) значение собраны и только что был создан запрос NTP.</li><li>RdtscEnd — просто собранных после NTP-ответа были получены и обработаны значение RDTSC (чтение счетчика отметок времени).</li><li>FileTime — локальный FILETIME значение, используемое в запросе NTP.</li><li>RoundtripDelay — время в секундах между Создание запроса NTP и обработки полученных NTP-ответа, вычисляемых согласно вычислений NTP обмена данными.</li><li>Согласно NTP смещения вычисления вычисляемых NTPOffset — смещение в секундах между локальной системы и NTP-сервером времени.</li></ul>|
|W32tm/config<br /><br />[/ компьютера:<target>]<br /><br />[/ Update]<br /><br />[/ manualpeerlist:<peers>]<br /><br />[/ syncfromflags:<source>]<br /><br />[/ LocalClockDispersion:<seconds>]<br /><br />[/ reliable: (Да&#124;NO)]<br /><br />[/ largephaseoffset:<milliseconds>]|компьютер:<target> -Настройка <target>. Если не указан, по умолчанию используется локальный компьютер.<br /><br />Update - уведомление службы времени, что конфигурация изменилась, вызывающих изменения вступили в силу.<br /><br />manualpeerlist:<peers> -задает списка <peers>, который является список с разделителями пробелами DNS и IP-адресов. При указании нескольких узлов, этот параметр должен быть заключен в кавычки.<br /><br />syncfromflags:<source> -задает какие источники синхронизации с NTP-клиента. <source> должен быть список с разделителями-запятыми эти ключевые слова (без учета регистра):<br /><br />ВРУЧНУЮ — включают одноранговых узлов из списка.<br /><br />DOMHIER - синхронизация с контроллера домена (DC) в иерархии домена.<br /><br />LocalClockDispersion:<seconds> -настраивает точность внутренние часы, который предполагает W32Time, когда он не может получить время из своих настроенных источников.<br /><br />Надежные: (Да&#124;нет) — переводит ли этот компьютер является надежным источником времени.<br /><br />Этот параметр применяется только на контроллерах домена.<br /><br />Да, этот компьютер является доверенной службы времени.<br /><br />НЕ - этот компьютер не является доверенной службы времени.<br /><br />largephaseoffset:<milliseconds> -задает разницу между локальной и сетевой W32Time будет рассматривать пиковое время.|  
|команду w32tm/TZ|Отобразите текущие параметры часового пояса.|  
|W32tm /dumpreg<br /><br />[/ подраздела:<key>]<br /><br />[/ компьютера:<target>]|Отображать значения, связанные с ключом реестра.<br /><br />Ключ по умолчанию является HKLM\System\CurrentControlSet\Services\W32Time<br /><br />(корневой ключ службы времени).<br /><br />подраздел:<key> -отображает значения, связанные с подраздел <key> ключа по умолчанию.<br /><br />компьютер:<target> -запрашивает параметры реестра для компьютера <target>|  
|W32tm/Query [/ компьютера:<target>] {/ source &#124; /configuration &#124; /одноранговые элементы &#124; /Status} [/ verbose]|Этот параметр впервые появилась в версии клиента Windows время Windows Vista и Windows Server 2008.<br /><br />Отобразить сведения о службы времени Windows на компьютере.<br /><br />**компьютер:<target>**  -запросить данные из **<target>**. Если не указан, значение по умолчанию — локальный компьютер.<br /><br />**Источник** -отобразить источник времени.<br /><br />**Конфигурация** -отображения времени работы и откуда параметр конфигурации. В подробном режиме отображения не определен или неиспользуемые параметра слишком.<br /><br />**одноранговые узлы** -отобразить список узлов и их состояние.<br /><br />**состояние** — состояние службы времени Windows для отображения.<br /><br />**verbose** -задать режим подробного протоколирования для отображения дополнительных сведений.|  
|w32tm /debug {/disable &#124; {/enable /file:<name> /size:<bytes> /entries:<value> [/ truncate]}}|Этот параметр впервые появилась в версии клиента Windows время Windows Vista и Windows Server 2008.<br /><br />Включение или отключение локальном журнал частной службы времени Windows.<br /><br />**Отключить** -отключить закрытого журнала.<br /><br />**включить** -включить закрытый журнал.<br /><br />-   **файл:<name>**  -указать абсолютное имя файла.<br />-   **Размер:<bytes>**  -укажите максимальный размер для циклического ведения журнала.<br />-   **операции:<value>**  — содержит список флагов, заданной номерами и через запятую, указывающих типы данных, которые следует вносить в журнал. Допустимые номера — от 0 до 300. Диапазон номеров является допустимым, кроме одного числа, например 0-100,103 106. Значение 0 – 300 — для записи в журнал все сведения.<br /><br />**усечь** -усечение файла, если он существует.|  

---  
Дополнительные сведения о **W32tm.exe**, см. в разделе Центр справки и поддержки в Windows XP, Windows Vista, Windows 7, Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2.  
  
## <a name="windows-time-service-registry-entries"></a>Записи реестра для службы времени Windows  
Следующие параметры реестра связаны со службой времени Windows.  
  
Эта информация как ссылку для использования в устранении неполадок или проверки, что применяются необходимые параметры. Что не изменять непосредственно реестра при отсутствии иных возможностей не рекомендуется. Изменения в реестре не проверяются редактором реестра или с Windows до того, как они применяются в результате могут храниться неправильные значения. Это может привести неустранимые ошибки в системе.  
  
По возможности используйте групповую политику или другими средствами Windows, например консоли управления (MMC), для выполнения задач, а не непосредственное редактирование реестра. Если отредактировать реестр все же необходимо, соблюдайте крайнюю осторожность.  
  
> [!WARNING]  
> Некоторые существующие значения, настроенные в файле системы административного шаблона (System.adm) для параметров групповой политики объект Групповой политики, отличаются от соответствующих записей реестра по умолчанию. Если вы планируете использовать объект групповой Политики для настройки параметров времени Windows, убедитесь, что вы просмотрите [Предустановка значения для параметров групповой политики службы времени Windows отличаются от соответствующей записи реестра для службы времени Windows в Windows Server 2003 ](https://go.microsoft.com/fwlink/?LinkId=186066). Эта проблема возникает в Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 и Windows Server 2003.  
  
Много записей реестра для службы времени Windows совпадают с параметром групповой политики с тем же именем. Параметры групповой политики соответствуют записи в реестре с тем же именем, расположенных в:  
  
>**HKLM\SYSTEM\CurrentControlSet\Services\W32Time\\**

  
В этом расположении реестра есть несколько параметров реестра. Параметры времени Windows хранятся в значения во всех этих ключей:
* [Параметры](#Parameters)
* [конфигурации](#Configuration)
* [NTP-клиент](#NtpClient)
* [NtpServer](#NtpServer)
  

Многие из значений в разделе реестра W32Time используются внутренне W32Time для хранения информации. Эти значения не должен быть изменен вручную в любое время. Не изменяйте параметры в этом разделе, если вы знакомы с параметром и уверены, что новое значение будет работать должным образом. Следующие записи реестра, находятся в разделе:

**HKLM\SYSTEM\CurrentControlSet\Services\W32Time**  

При создании политики, настройки хранятся в следующем расположении, не имеют приоритет над следующего местоположения:

**HKLM\SOFTWARE\Policies\Microsoft\Windows\W32time**

Ключ W32time создается с помощью политики.  При удалении политики, этот ключ также удаляется.

Другие расположение по умолчанию:

**HKLM\SYSTEM\CurrentControlSet\Services\W32time**

Некоторые параметры хранятся в тактов в реестре, а некоторые — в секундах. Для преобразования времени из тактов секунд:  
  
-   1 минута = 60 сек  
  
-   1 сек = 1000 мс  
  
-   1 мс = 10 000 тактов в системе Windows, как описано в статье [свойством DateTime.Ticks](https://docs.microsoft.com/dotnet/api/system.datetime.ticks?redirectedfrom=MSDN&view=netframework-4.7.2#System_DateTime_Ticks).  
  
Например, 5 минут стал бы 5 * 60\*1000\*10000 = 3000000000 тактов. 

Входят во все версии Windows 7, Windows 8, Windows 10, Windows Server 2008 и Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2, Windows Server 2016.  Некоторые записи доступны только в более новых версиях Windows.


#### <a name="hklmsystemcurrentcontrolsetservicesw32timeparameters"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Parameters

|Запись реестра|Версия|Описание|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Все|Обозначает, что сочетания нестандартные режим разрешены в синхронизации между одноранговыми узлами. Значение по умолчанию для членов домена — 1. Значение по умолчанию для изолированных компьютеров и серверов — 1.|
|NTP-сервер|Все|Запись указывает список коллег, с которых компьютер получает отметки времени, состоящий из одной или нескольких DNS-имена или IP-адресов в каждой строке. Каждый DNS-имя или IP-адрес должен быть уникальным. Компьютеров, подключенных к домену необходимо синхронизировать с более надежным источником времени, таких как официальный часов времени США.  <ul><li>0x01 SpecialInterval </li><li>0x02 UseAsFallbackOnly</li><li>SymmetricActive 0x04 — Дополнительные сведения об этом режиме см. в разделе [сервер времени Windows: 3.3 режимы работы](https://go.microsoft.com/fwlink/?LinkId=208012).</li><li>0x08 клиента</li></ul><br />Для этой записи реестра для членов домена не значение по умолчанию. Значение по умолчанию на серверах и автономных клиентов — time.windows.com,0x1.<br /><br />Примечание. Дополнительные сведения о доступных NTP-серверов, см. в разделе [статье базы знаний Майкрософт 262680 - список серверов времени простой сети времени протокол SNTP, доступные в Интернете](https://go.microsoft.com/fwlink/?LinkId=186067)|
|ServiceDll|Все|Запись обслуживается W32Time. Он содержит зарезервированные данные, используемые операционной системой Windows, и любые изменения этого параметра может привести к непредсказуемым результатам. Расположение по умолчанию для этой библиотеки DLL для членов домена и изолированных компьютеров и серверов — % windir%\System32\W32Time.dll.  |
|ServiceMain|Все|Запись обслуживается W32Time. Он содержит зарезервированные данные, используемые операционной системой Windows, и любые изменения этого параметра может привести к непредсказуемым результатам. Значение по умолчанию для членов домена — SvchostEntry_W32Time. Значение по умолчанию на серверах и автономных клиентов — SvchostEntry_W32Time.  "|
|Тип|Все|Обозначает, который одноранговым узлам для принятия синхронизации из:  <ul><li>**NoSync**. Службе времени не синхронизируется с другими источниками.</li><li>**NTP.** Служба времени выполняет синхронизацию с серверов, указанных в **NTP-сервер**. запись реестра.</li><li>**NT5DS**. Синхронизации времени в иерархии домена.  </li><li>**AllSync**. Служба времени использует все доступные способы синхронизации.  </li></ul>Значение по умолчанию для членов домена — **NT5DS**. Значение по умолчанию на серверах и автономных клиентов — **NTP**.   |
---
#### <a name="hklmsystemcurrentcontrolsetservicesw32timeconfig"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\Config

|Запись реестра|Версия|Описание|
|------------------------------------|---------------|----------------------------|
|AnnounceFlags|Все|Запись определяет, является ли этот компьютер помечается как надежным сервером времени. Компьютер не помечен как надежный, если он также не отмечен как сервер времени.<br /> -0x00 не сервером времени  <br /> -0x01 всегда времени сервера  <br /> -0x02 автоматическое время сервера  <br /> -0x04 всегда надежным сервером времени  <br /> -0x08 автоматического надежным сервером времени  <br />Значение по умолчанию для членов домена — 10. Значение по умолчанию для изолированных компьютеров и серверов — 10.|
|EventLogFlags|Все|Запись определяет события, на которые входит служба времени.  <br />-Ссылки время: 0x1  <br />-Изменение источника: 0x2  <br />Значение по умолчанию для членов домена — 2. Значение по умолчанию на серверах и автономных клиентов — 2.  |
|FrequencyCorrectRate|Все|Запись определяет скорость, по которому исправляется часы. Если это значение слишком мало, часы нестабилен и overcorrects. Если значение слишком велико, часы занимает много времени для синхронизации. Значение по умолчанию для членов домена — 4. Значение по умолчанию на серверах и автономных клиентов — 4.  <br /><br />Обратите внимание на то, что 0 является недопустимым значением записи реестра FrequencyCorrectRate. В Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 компьютеры Если имеет значение 0 служба времени Windows автоматически произойдет замена его на 1.  |
|HoldPeriod|Все|Запись определяет период времени, для которого пик обнаружение отключено, чтобы быстро перенести локальные часы в синхронизации. Пик — пример времени, указывающее, что время выключен количество секунд и обычно принимается после возвращения примеры подходящий момент, постоянно. Значение по умолчанию для членов домена — 5. Значение по умолчанию на серверах и автономных клиентов — 5.  |
|LargePhaseOffset|Все|Запись указывает, что время, смещение больше или равно этому значению в 10<sup>-7</sup> секунд считается пик. К нарушению работы сети, например большой объем трафика может вызвать критическую массу. Пик будет игнорироваться, если он сохраняется в течение длительного периода времени. Значение по умолчанию для членов домена — значение "50000000". Значение по умолчанию на серверах и автономных клиентов — значение "50000000".  |
|LastClockRate|Все|Запись обслуживается W32Time. Он содержит зарезервированные данные, используемые операционной системой Windows, и любые изменения этого параметра может привести к непредсказуемым результатам. Значение по умолчанию для членов домена — 156250. Значение по умолчанию на серверах и автономных клиентов — 156250.  |
|LocalClockDispersion|Все|Запись определяет рассредоточение (в секундах), который следует учитывать, когда только источника времени встроенных CMOS часов. Значение по умолчанию для членов домена — 10. Значение по умолчанию на серверах и автономных клиентов — 10.|
|MaxAllowedPhaseOffset|Все|Параметр задает максимальное смещение (в секундах), для которого W32Time пытается настроит часы компьютера с помощью частоты синхронизации. Если смещение превышает данное значение, служба W32Time непосредственно изменяет часов компьютера. Значение по умолчанию для членов домена — 300. Значение по умолчанию для изолированных компьютеров и серверов — 1.  [Дополнительные сведения см. ниже](#MaxAllowedPhaseOffset).|
|MaxClockRate|Все|Запись обслуживается W32Time. Он содержит зарезервированные данные, используемые операционной системой Windows, и любые изменения этого параметра может привести к непредсказуемым результатам. Значение по умолчанию для членов домена — 155860. Значение по умолчанию для изолированных компьютеров и серверов — 155860.  |
|MaxNegPhaseCorrection|Все|Параметр задает наибольшее отрицательное время коррекции, служба времени. Если окажется, что больше, чем это изменение является обязательным, он будет зарегистрировано событие. Особый случай: 0xFFFFFFFF означает всегда коррекция времени. Значение по умолчанию для членов домена — 0xFFFFFFFF. Значение по умолчанию для изолированных компьютеров и серверов — 54 000 (15 часов).  |
|MaxPollInterval|Все|Запись задает наибольший интервал, в секундах log2, отводимое между опросами. Обратите внимание, что хотя системе необходимо выполнять опрос в соответствии с запланированной, поставщик может отказаться запрос для этого. Значение по умолчанию для контроллеров домена — 10. Значение по умолчанию для членов домена — 15. Значение по умолчанию для изолированных компьютеров и серверов — 15.  |
|MaxPosPhaseCorrection|Все|Параметр задает наибольшее коррекции положительное время, служба времени. Если окажется, что больше, чем это изменение является обязательным, он будет зарегистрировано событие. Особый случай: 0xFFFFFFFF означает всегда коррекция времени. Значение по умолчанию для членов домена — 0xFFFFFFFF. Значение по умолчанию для изолированных компьютеров и серверов — 54 000 (15 часов).  |
|MinClockRate|Все|Запись обслуживается W32Time. Он содержит зарезервированные данные, используемые операционной системой Windows, и любые изменения этого параметра может привести к непредсказуемым результатам. Значение по умолчанию для членов домена — 155860. Значение по умолчанию для изолированных компьютеров и серверов — 155860.  |
|MinPollInterval|Все|Параметр определяет наименьший интервал в секундах log2, отводимое между опросами. Обратите внимание на то, что во время системы не чаще, чем это запросить примеры, поставщик может создать примеры время от времени, отличный от запланированного интервала. Значение по умолчанию для контроллеров домена — 6. Значение по умолчанию для членов домена — 10. Значение по умолчанию для изолированных компьютеров и серверов — 10.  |
|PhaseCorrectRate|Все|Запись определяет скорость, с которой исправления ошибки этапа. Указание небольшое значение исправит ошибку этап быстро, но может привести к нестабильной часов. Если значение слишком велико, занимает больше времени для исправления ошибки этапа. <br /><br />Значение по умолчанию для членов домена — 1. Значение по умолчанию на серверах и автономных клиентов — 7.<br /><br />Примечание. 0 является недопустимым значением записи реестра PhaseCorrectRate. В Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 компьютеры Если имеет значение 0, служба времени Windows автоматически изменяет его значение 1.  |
|PollAdjustFactor|Все|Запись определяет принятия решений, чтобы увеличить или уменьшить интервал опроса для системы. Больше, чем меньше объем ошибка, вызывающая интервал опроса уменьшить. Значение по умолчанию для членов домена — 5. Значение по умолчанию на серверах и автономных клиентов — 5. |
|SpikeWatchPeriod|Все|Параметр задает количество времени, которые должны сохраняться подозрительных смещения прежде, чем он будет принят верным (в секундах). Значение по умолчанию для членов домена — 900. Значение по умолчанию для изолированных компьютеров и рабочих станций — 900.  |
|TimeJumpAuditOffset|Все|Целое число без знака, указывающее перехода аудита пороговое значение времени, в секундах. Если служба времени настраивает локальные часы, задав часы напрямую и коррекция времени больше, чем это значение, служба времени регистрирует событие аудита.|
|UpdateInterval|Все|Запись указывает количество тактов между корректировки этапа исправления. Значение по умолчанию для контроллеров домена — 100. Значение по умолчанию для членов домена — 30 000. Значение по умолчанию для изолированных компьютеров и серверов — 360,000.  <br /><br />**ПРИМЕЧАНИЕ**. Нуль является недопустимым значением записи реестра UpdateInterval. На компьютерах под управлением Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 Если значение имеет значение 0 служба времени Windows автоматически изменяет его значение 1.<br /><br />Следующие три параметры реестра не являются частью конфигурации по умолчанию W32Time, но можно добавить в реестр, чтобы получить возможность повышения ведения журнала. Информация, зарегистрированная в журнале системных событий можно изменить, изменив значение параметра EventLogFlags в редакторе объектов групповой политики. По умолчанию служба времени создает журнал в средстве просмотра событий, каждый раз, чтобы он переключается на новый источник времени.<br /><br />**ВНИМАНИЕ!** Некоторые существующие значения, настроенные в файле системы административного шаблона (System.adm) для параметров групповой политики объект Групповой политики, отличаются от соответствующих записей реестра по умолчанию. Если вы планируете использовать объект групповой Политики для настройки параметров времени Windows, убедитесь, что вы просмотрите [Предустановка значения для параметров групповой политики службы времени Windows отличаются от соответствующей записи реестра для службы времени Windows в Windows Server 2003 ](https://go.microsoft.com/fwlink/?LinkId=186066). Эта проблема возникает в Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 и Windows Server 2003. |
|UtilizeSslTimeData|Учет Windows 10 сборки 1511|Запись 1 указывает, что W32Time будет использовать несколько SSL отметки времени для задания начального значения часов, которые точных.|
---
Чтобы включить ведение журнала W32Time должны быть добавлены следующие записи реестра:  

|Запись реестра|Версия|Описание|
|------------------------------------|---------------|----------------------------|
|FileLogEntries|Все|Запись определяет количество операций, созданных в файле журнала времени Windows. Значение по умолчанию — none, который регистрирует других действий времени Windows. Допустимые значения: от 0 до 300. Это значение не влияет на записи журнала событий, обычно создается по времени Windows|
|FileLogName|Все|Запись определяет расположение и имя файла журнала времени Windows. Значение по умолчанию является пустым и не должен изменяться, если не **FileLogEntries** изменяется. Допустимое значение — это полный путь и имя файла, который времени Windows будет использовать для создания файла журнала. Это значение не влияет на записи журнала событий, обычно создается по времени Windows.  |
|FileLogSize|Все|Запись управляет поведением циклического ведения журнала файлов журнала времени Windows. Когда **FileLogEntries** и **FileLogName** будут определены, элемент определяет размер в байтах для файла журнала для достижения перед перезаписью самые старые записи журнала, новые записи. Для этого параметра используйте значение 1000000 или большего размера. Это значение не влияет на записи журнала событий, обычно создается по времени Windows.  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpclient"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient

|Запись реестра|Версия|Описание|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Все|Обозначает, что сочетания нестандартные режим разрешены в синхронизации между одноранговыми узлами. Значение по умолчанию для членов домена — 1. Значение по умолчанию для изолированных компьютеров и серверов — 1.|
|CompatibilityFlags содержит|Все|Запись задает следующие флаги совместимости и значения: <br /><br />-DispersionInvalid: 0x00000001  <br />-IgnoreFutureRefTimeStamp: 0x00000002  <br /> -AutodetectWin2K: 0x80000000  <br />-   AutodetectWin2KStage2: 0x40000000  <br /><br />Значение по умолчанию для членов домена — 0x80000000. Значение по умолчанию для изолированных компьютеров и серверов — 0x80000000.  |
|CrossSiteSyncFlags|Все|Запись определяет ли служба решает участников синхронизации за пределами домена компьютера. Ниже приведены параметры и значения.  <br /><br />-None: 0  <br />-PdcOnly: 1  <br />— Все: 2  <br /><br />Это значение игнорируется, если не задано значение NT5DS. Значение по умолчанию для членов домена — 2. Значение по умолчанию для изолированных компьютеров и серверов — 2.  |
|DllName|Все|Параметр задает расположение библиотеки DLL для поставщика времени.  <br /><br />Расположение по умолчанию для этой библиотеки DLL для членов домена и изолированных компьютеров и серверов — % windir%\System32\W32Time.dll.|
|Enabled|Все|Запись указывает, включена ли в текущей службе времени NTP-клиент поставщика.  <br /><ul><li>Да 1</li><li>Не 0</li></ul>Значение по умолчанию для членов домена — 1. Значение по умолчанию на серверах и автономных клиентов — 1.|
|EventLogFlags|Все|Запись указывает события записываются в журнал службой времени Windows.<ul><li>0x1 достижимость изменения</li><li>0x2 большой образец наклон (это значение применимо к Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 только)</li></ul>Значение по умолчанию для членов домена имеет значение 0x1. Значение по умолчанию на серверах и автономных клиентов имеет значение 0x1.|
|InputProvider|Все|Запись указывает, следует ли включить NTP-клиент в качестве InputProvider, который получает сведения о времени с NTP-сервер. NTP-сервер является сервером времени, которая отвечает на запросы время клиента в сети, возвращая примеры времени, которые можно использовать для синхронизации часов локального. <ul><li>Yes = 1  </li><li>Не = 0 </li></ul><p>Значение по умолчанию для членов домена и автономные клиенты: 1  |
|LargeSampleSkew|Все|Запись определяет Перекос большой образец для ведения журнала в секундах. Для соблюдения спецификации безопасности и Exchange комиссии (в Секундах), это должно быть присвоено три секунды. События будут регистрироваться для этого параметра только в том случае, если EventLogFlags явным образом настроен для большой образец 0x2 наклона. Значение по умолчанию для членов домена — 3. Значение по умолчанию на серверах и автономных клиентов — 3.  |
|ResolvePeerBackOffMaxTimes|Все|Запись указывает максимальное число попыток, интервал ожидания при повторном пытается найти однорангового узла для синхронизации с fail. Нулевое значение означает, что интервал ожидания всегда является минимальным. Значение по умолчанию для членов домена — 7. Значение по умолчанию на серверах и автономных клиентов — 7. |
|ResolvePeerBackoffMinutes|Все|Запись указывает начальный интервал ожидания в минутах, прежде чем попытаться обнаружить однорангового узла для синхронизации с. Значение по умолчанию для членов домена — 15. Значение по умолчанию на серверах и автономных клиентов — 15.  |
|SpecialPollInterval|Все|Запись указывает интервал опроса в секундах для одноранговых узлов вручную. При включении флага SpecialInterval 0x1 операционной системой определить W32Time использует этот интервал опроса, вместо интервала опроса. Значение по умолчанию для членов домена — 3600. Значение по умолчанию на серверах и автономных клиентов — 604 800.<br/><br/>Новое для построения 1702, SpecialPollInterval содержится значения реестра MinPollInterval и MaxPollInterval конфигурации.|
|SpecialPollTimeRemaining|Все|Запись обслуживается W32Time. Он содержит зарезервированные данные, используемые операционной системой Windows. Он задает время в секундах, прежде чем будет повторно синхронизировать W32Time, после перезагрузки компьютера. Любые изменения этого параметра может привести к непредсказуемым результатам. Значение по умолчанию для обоих членов домена и на изолированных компьютеров и серверов будет пустым.  |

---

#### <a name="hklmsystemcurrentcontrolsetservicesw32timetimeprovidersntpserver"></a>HKLM\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpServer

|Запись реестра|Версия|Описание|
|------------------------------------|---------------|----------------------------|
|AllowNonstandardModeCombinations|Все|Обозначает, что сочетания нестандартные режим разрешены в синхронизации между клиентами и серверами. Значение по умолчанию для членов домена — 1. Значение по умолчанию для изолированных компьютеров и серверов — 1.|
|DllName|Все|Параметр задает расположение библиотеки DLL для поставщика времени.<br /><br />Расположение по умолчанию для этой библиотеки DLL для членов домена и изолированных компьютеров и серверов — % windir%\System32\W32Time.dll.  |
|Enabled|Все|Запись указывает, включена ли поставщик NTP-сервер в службе текущего времени. <ul><li>Да 1</li><li>Не 0</li></ul>Значение по умолчанию для членов домена — 1. Значение по умолчанию на серверах и автономных клиентов — 1.  |
|InputProvider|Все|Запись указывает, следует ли включить NTP-клиент в качестве InputProvider, который получает сведения о времени с NTP-сервер. NTP-сервер является сервером времени, которая отвечает на запросы время клиента в сети, возвращая примеры времени, которые можно использовать для синхронизации часов локального. <ul><li>Yes = 1  </li><li>Не = 0 </li></ul><p>Значение по умолчанию для членов домена и автономные клиенты: 1  |

---

#### <a name="maxallowedphaseoffset-information"></a>Сведения о MaxAllowedPhaseOffset
Чтобы W32Time присвоить часов компьютера постепенно, смещение должно быть меньше, чем **MaxAllowedPhaseOffset** значение и удовлетворяют следующее уравнение, в то же время:  

```  
|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) < SystemClockRate / 2  
``` 
CurrentTimeOffset измеряется в тактах часов, где 1 мс = 10 000 тактов в системе Windows.  
  
SystemClockRate и PhaseCorrectRate также измеряются в тактов. Чтобы получить SystemClockRate, можно использовать следующую команду и преобразование секунд тактов, используя формулу, время в секундах * 1000\*10000:  
  
```  
W32tm /query /status /verbose  
ClockRate: 0.0156000s  
```  
  
SystemclockRate это число часов в системе. Используя 156000 секунд в качестве примера, SystemclockRate бы быть = 0.0156000 * 1000 \* 10000 = 156000 тактов.  
  
MaxAllowedPhaseOffset также задается в секундах. Чтобы преобразовать его в тактов, умножьте MaxAllowedPhaseOffset * 1000\*10000.  
  
В следующих двух примерах показано применение  
  
**Пример 1**: Время отличается 4 минуты (например, срок — 11:05:00 и образец time, полученных от однорангового узла и считается верным — 11:09:00).  
```
phasecorrectRate = 1  
  
UpdateInterval = 30000 (clock ticks)  
  
systemclockRate = 156000 (clock ticks)  
  
MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  
  
|currentTimeOffset| = 4mins = 4*60\*1000\*10000 = 2400000000 ticks  
  
Is CurrentTimeOffset < MaxAllowedPhaseOffset?  
  
2400000000 < 6000000000 = TRUE  
```
И удовлетворяют выше уравнение? 
```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) < SystemClockRate / 2)  
  
Is 2,400,000,000 / (30000*1) < 156000/2  
  
Is 80,000 < 78,000  
  
NO/FALSE  
```  
Поэтому W32tm устанавливал часов назад немедленно.  
  
> [!NOTE]  
> Таким образом Если вы хотите медленно переведите часы, необходимо настроить значения PhaseCorrectRate или updateInterval в реестре также для обеспечения результатов формул в значение TRUE.  
  
**Пример 2.** Время отличается 3 минуты.  
```  
phasecorrectRate = 1  
  
UpdateInterval = 30000 (clock ticks)  
  
systemclockRate = 156000 (clock ticks)  
  
MaxAllowedPhaseOffset = 10min = 600 seconds = 600*1000\*10000=6000000000 clock ticks  
  
currentTimeOffset = 3mins = 3*60\*1000\*10000 = 1800000000 clock ticks  
  
Is CurrentTimeOffset < MaxAllowedPhaseOffset?  
  
1800000000 < 6000000000 = TRUE  
```  
И удовлетворяют выше уравнение?
```
(|CurrentTimeOffset| / (PhaseCorrectRate*UpdateInterval) < SystemClockRate / 2)  
  
Is 3 mins (1,800,000,000) / (30000*1) < 156000/2  
  
Is 60,000 < 78,000  
  
YES/TRUE  
```  
В этом случае часы присваиваются медленно.  
  
## <a name="windows-time-service-group-policy-settings"></a>Параметры политики группы службы времени Windows  
Большинство параметров W32Time можно настроить с помощью редактора объектов групповой политики. Сюда входит Настройка компьютера должен быть надежным источником времени NTP-сервер ни NTP-клиент, настройку механизм синхронизации времени, а также настройку компьютер.  
  
> [!NOTE]  
> Параметры групповой политики для службы времени Windows можно настроить на контроллерах домена Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2 и может применяться только к компьютерам под управлением Windows Server 2003, Windows Server 2003 R2, Windows Server 2008 и Windows Server 2008 R2.  
  
Вы можете найти групповой политики, параметры, используются для настройки W32Time в оснастку редактора объектов групповой политики в следующих расположениях:  
  
-   Конфигурация компьютера\Административные Templates\System\Windows время службу WinRM  
  
    Настройка **глобальные параметры конфигурации** здесь.  
  
-   Компьютер Конфигурация компьютера\Административные Templates\System\Windows время Service\Time поставщиков  
  
    Настройка **NTP-клиента Windows** здесь параметры.  
  
    Включить **NTP-клиента Windows** здесь.  
  
    Включить **NTP-сервером Windows** здесь.  
  
> [!WARNING]  
> Некоторые существующие значения, настроенные в файле системы административного шаблона (System.adm) для параметров групповой политики объект Групповой политики, отличаются от соответствующих записей реестра по умолчанию. Если вы планируете использовать объект групповой Политики для настройки параметров времени Windows, убедитесь, что вы просмотрите [Предустановка значения для параметров групповой политики службы времени Windows отличаются от соответствующей записи реестра для службы времени Windows в Windows Server 2003 ](https://go.microsoft.com/fwlink/?LinkId=186066). Эта проблема возникает в Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 R2 и Windows Server 2003.  
  
В следующей таблице перечислены глобальные параметры групповой политики, связанные со службой времени Windows и предварительно заданное значение, связанное с каждым параметром. Дополнительные сведения о каждом параметре см. в разделе соответствующей записи в реестре в "[записи реестра для службы времени Windows](#w2k3tr_times_tools_uhlp)» ранее в этой теме. Содержатся следующие параметры в вызове одного объекта GPO **глобальные параметры конфигурации**.  
  
**Параметры глобальной групповой политики, связанные с временем Windows**  
  
|Параметр групповой политики|Заранее заданное значение|  
|------------------------|------------------|  
|AnnounceFlags|10|  
|EventLogFlags|2|  
|FrequencyCorrectRate|4|  
|HoldPeriod|5|  
|LargePhaseOffset|1280000|  
|LocalClockDispersion|10|  
|MaxAllowedPhaseOffset|300|  
|MaxNegPhaseCorrection|54 000 (15 часов)|  
|MaxPollInterval|15|  
|MaxPosPhaseCorrection|54 000 (15 часов)|  
|MinPollInterval|10|  
|PhaseCorrectRate|7|  
|PollAdjustFactor|5|  
|SpikeWatchPeriod|90|  
|UpdateInterval|100|  
  
В следующей таблице перечислены доступные параметры для **Настройка клиента Windows NTP** объекта групповой Политики и заранее настроенные значения, которые связаны со службой времени Windows. Дополнительные сведения о каждом параметре см. в разделе соответствующей записи в реестре в "[записи реестра для службы времени Windows](#w2k3tr_times_tools_uhlp)» ранее в этой теме.  
  
**Параметры NTP клиента групповой политики, связанные с временем Windows**  
  
|Параметр групповой политики|Значение по умолчанию|  
|------------------------|-----------------|  
|NTP-сервер|Time.Windows.com,0x1|  
|Тип|Параметры по умолчанию:<br /><br />-   **NTP.** Использовать на компьютерах, которые не присоединены к домену.<br />-   **NT5DS.** Использовать на компьютерах, присоединенных к домену.|  
|CrossSiteSyncFlags|2|  
|ResolvePeerBackoffMinutes|15|  
|ResolvePeerBackoffMaxTimes|7|  
|SpecialPollInterval|3600|  
|EventLogFlags|0|  
  
## <a name="network-ports-used-by-the-windows-time-service"></a>Сетевые порты, используемые службой времени Windows  
Время Windows соответствует спецификации NTP, который необходимо использовать UDP-порт 123 для всех видов связи синхронизации времени. Этот порт зарезервирована службой времени Windows и остается зарезервированным в любое время. Каждый раз, когда компьютер выполняет синхронизацию часов или предоставляет времени на другой компьютер, подобный обмен данными выполняется через UDP-порт 123.  
  
> [!NOTE]  
> Если у вас есть компьютер с несколькими сетевыми адаптерами (также называемый многосетевого компьютера), невозможно включить выборочно службы времени Windows на основании сетевого адаптера.  
  
## <a name="related-information"></a>Связанные сведения  
Следующие ресурсы содержат дополнительные сведения, относящиеся к этому разделу.  
  
-   RFC *1305* в базе данных IETF RFC  

