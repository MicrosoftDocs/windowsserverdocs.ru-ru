---
ms.assetid: ''
title: Настройка высокой точности в системах
description: Синхронизация времени в Windows 10 и Windows Server 2016 была значительно улучшена.  При разумных условиях работы можно настроить системы для поддержания точности до 1 мс (миллисекунды) или еще точнее (относительно UTC).
author: dcuomo
ms.author: dacuo
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: 71f15f9da1f477ec8632fd2eb900e650f83ef3de
ms.sourcegitcommit: 145cf75f89f4e7460e737861b7407b5cee7c6645
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/29/2020
ms.locfileid: "87409604"
---
# <a name="configuring-systems-for-high-accuracy"></a>Настройка высокой точности в системах
>Применяется к: Windows Server 2016 и Windows 10 версии 1607 или более поздней.

Синхронизация времени в Windows 10 и Windows Server 2016 была значительно улучшена.  При разумных условиях работы можно настроить системы для поддержания точности до 1 мс (миллисекунды) или еще точнее (относительно UTC).

Следующие рекомендации помогут настроить системы для достижения высокой точности.  В этой статье описаны следующие компоненты:

- Поддерживаемые операционные системы
- Конфигурация системы

> [!WARNING]
> **Цели точности предыдущих операционных систем**<br>
>Windows Server 2012 R2 и более ранней версии не может соответствовать тем же самым целям высокой точности. Эти операционные системы не поддерживаются для высокой точности.
>
>В этих версиях служба времени Windows выполняет следующие действия.
>
> - Предоставляет необходимую точность времени для выполнения требований проверки подлинности Kerberos версии 5.
> - Предоставляет условно точное время для клиентов и серверов Windows, присоединенных к общему лесу Active Directory.
>
>Большая погрешность в версии 2012 R2 и ранних версиях выходит за пределы спецификации службы времени Windows.

## <a name="windows-10-and-windows-server-2016-default-configuration"></a>Настройка по умолчанию Windows 10 и Windows Server 2016

В то время как мы поддерживаем точность до 1 мс в Windows 10 или Windows Server 2016, большинство клиентов не нуждаются в высокой точности времени.

Таким образом, **конфигурация по умолчанию** соответствует тем же требованиям, что и предыдущие операционные системы, которые выполняют следующие действия:

- Предоставляют необходимую точность времени для выполнения требований проверки подлинности Kerberos версии 5.
- Предоставляют условно точное время для клиентов и серверов Windows, присоединенных к общему лесу Active Directory.

## <a name="how-to-configure-systems-for-high-accuracy"></a>Как настроить высокую точность в системах

>[!IMPORTANT]
>**Примечание относительно поддержки высокоточных систем**<br>
> Точность времени влечет за собой сквозное распределение точного времени от достоверного источника до конечного устройства.  Все, что добавляет асимметрию в измерения по этому пути, негативно влияет на точность, получаемую на конечных устройствах.
>
>Ознакомьтесь со статьей [Support boundary for high-accuracy time](support-boundary.md) (Граница области поддержки для высокоточного времени), которая содержит сведения о требованиях к среде, которые также должны быть удовлетворены для получения высокой точности.

### <a name="operating-system-requirements"></a>Требования к операционной системе

Для конфигураций с высокой точностью требуется Windows 10 или Windows Server 2016.  Все устройства Windows в топологии времени должны соответствовать этому требованию, включая более высокие стратумные серверы времени Windows, а также в виртуализированных сценариях узлы Hyper-V, на которых работают виртуальные машины с ограничением по времени. Все эти устройства должны быть как минимум под управлением Windows 10 или Windows Server 2016.

На приведенной ниже иллюстрации показаны виртуальные машины, для которых необходима высокая точность и которые работают под управлением Windows 10 или Windows Server 2016.  Аналогично, узел Hyper-V, на котором находятся виртуальные машины, и вышестоящий сервер времени Windows также должны работать под управлением Windows Server 2016.

![Топология времени — 1607](../media/Windows-Time-Service/Configuring-Systems-for-High-Accuracy/Topology2016.png)

>[!TIP]
>**Определение версии Windows**<br>
> Вы можете выполнить команду `winver` в командной строке, чтобы убедиться, что используется ОС версии 1607 (или выше) и сборка 14393 (или выше), как показано ниже:
>
> ![Winver — 2016 1607](../media/Windows-Time-Service/Configuring-Systems-for-High-Accuracy/winver2016.png)

### <a name="system-configuration"></a>Конфигурация системы

Для достижения целей высокой точности требуется настроить систему.  Есть множество способов выполнения этой настройки, включая ее выполнение непосредственно в реестре или с помощью групповой политики.  Дополнительные сведения о каждом из этих параметров можно найти в техническом справочнике о службе времени Windows [здесь](Windows-Time-Service-Tools-and-Settings.md#windows-time-service-tools).

#### <a name="windows-time-service-startup-type"></a>Тип запуска службы времени Windows

Служба времени Windows (W32time) должна работать постоянно.  Для этого в качестве типа запуска службы времени Windows задайте значение "Автоматически".

![Автоматическая настройка](../media/Windows-Time-Service/Configuring-Systems-for-High-Accuracy/AutomaticService.PNG)

#### <a name="cumulative-one-way-network-latency"></a>Совокупная односторонняя задержка сети

Погрешность измерения и "шум" нарастают при увеличении задержки сети.  Таким образом, крайне важно, чтобы задержка сети была в пределах разумного.  Конкретные требования зависят от целевой точности и описаны в статье [Support boundary for high-accuracy time](support-boundary.md) (Граница области поддержки для высокоточного времени).

Чтобы вычислить совокупную одностороннюю задержку сети, добавьте отдельные односторонние задержки между парами узлов NTP-сервера клиента в топологии времени, начиная с целевого объекта и заканчивая источником времени страты 1 с высокой точностью.

Например: рассмотрим иерархию синхронизации времени с высокоточным источником, двумя промежуточными NTP-серверами A и Б, а также целевым компьютером в таком порядке. Чтобы получить совокупную задержку сети между целью и источником, измерьте среднее время циклического прохождения (RTTs) отдельного NTP между:

- целью и сервером времени Б;
- сервером времени Б и сервером времени А;
- сервером времени А и источником.

Эти измерения можно сделать с помощью встроенного средства w32tm.exe.  Выполните указанные ниже действия.

1. Выполните вычисления между целевым объектом и сервером времени Б.

    `w32tm /stripchart /computer:TimeServerB /rdtsc /samples:450 > c:\temp\Target_TsB.csv`

2. Выполните вычисления между сервером времени Б и сервером времени А.

    `w32tm /stripchart /computer:TimeServerA /rdtsc /samples:450 > c:\temp\Target_TsA.csv`

3. Выполните вычисления между сервером времени А и источником.

4. Затем добавьте среднее значение RoundTripDelay, измеренное на предыдущем шаге, и разделите на 2, чтобы получить совокупную задержку сети между целевым объектом и источником.

## <a name="registry-settings"></a>Параметры реестра

### <a name="minpollinterval"></a>MinPollInterval

Настраивает наименьший интервал в log2 в секундах, разрешенный для системного опроса.

| Описание | Значение |
|--|--|
| Расположение ключа | HKLM:\SYSTEM\CurrentControlSet\Services\W32Time\Config |
| Параметр | 6 |
| Результат | Минимальный интервал опроса теперь составляет 64 секунды. |

Следующая команда вызывает службу времени Windows для получения обновленных параметров: `w32tm /config /update`

### <a name="maxpollinterval"></a>MaxPollInterval

Настраивает наибольший интервал в log2 в секундах, разрешенный для системного опроса.

| Описание | Значение |
|--|--|
| Расположение ключа | HKLM:\SYSTEM\CurrentControlSet\Services\W32Time\Config |
| Параметр | 6 |
| Результат | Максимальный интервал опроса теперь составляет 64 секунды. |

Следующая команда вызывает службу времени Windows для получения обновленных параметров: `w32tm /config /update`

### <a name="updateinterval"></a>UpdateInterval

Количество тактов часов между настройками фазовой коррекции.

| Описание | Значение |
|--|--|
| Расположение ключа | HKLM:\SYSTEM\CurrentControlSet\Services\W32Time\Config |
| Параметр | 100 |
| Результат | Количество тактов часов между настройками фазовой коррекции теперь имеет значение — 100. |

Следующая команда вызывает службу времени Windows для получения обновленных параметров: `w32tm /config /update`

### <a name="specialpollinterval"></a>SpecialPollInterval

Настраивает интервал опроса в секундах, когда включен флаг SpecialInterval 0x1.

| Описание | Значение |
|--|--|
| Расположение ключа | HKLM:\SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient |
| Параметр | 64 |
| Результат | Интервал опроса теперь составляет 64 секунды. |

Следующая команда перезапускает службу времени Windows, чтобы получить обновленные параметры: `net stop w32time && net start w32time`

### <a name="frequencycorrectrate"></a>FrequencyCorrectRate

| Описание | Значение |
|--|--|
| Расположение ключа | HKLM:\SYSTEM\CurrentControlSet\Services\W32Time\Config |
| Параметр | 2 |
