---
ms.assetid: ''
title: Настройка систем для высокой точности
description: Синхронизация времени в Windows 10 и Windows Server 2016 была значительно улучшена.  При разумных условиях работы системы можно настроить для поддержки точности 1 мс (в миллисекундах) или более высокого (относительно UTC).
author: shortpatti
ms.author: dacuo
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server
ms.technology: networking
ms.openlocfilehash: b7cd256fdbbdbe7432e5b5d5b16254314132560f
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71405194"
---
# <a name="configuring-systems-for-high-accuracy"></a>Настройка систем для высокой точности
>Относится к: Windows Server 2016 и Windows 10 версии 1607 или более поздней

Синхронизация времени в Windows 10 и Windows Server 2016 была значительно улучшена.  При разумных условиях работы системы можно настроить для поддержки точности 1 мс (в миллисекундах) или более высокого (относительно UTC).

Следующие рекомендации помогут настроить системы для достижения высокой точности.  В этой статье обсуждаются следующие требования.

- Поддерживаемые операционные системы
- Конфигурация системы 

> [!WARNING]
> **Целевые показатели для предыдущих версий операционных систем**<br>
>Windows Server 2012 R2 и ниже не может соответствовать тем же самым целям высокой точности. Эти операционные системы не поддерживаются для высокой точности.
>
>В этих версиях служба времени Windows удовлетворяет следующим требованиям.
>
> - Предоставляли необходимую точность времени для удовлетворения требований проверки подлинности Kerberos версии 5.
> - Указано слабо точное время для клиентов и серверов Windows, присоединенных к общему лесу Active Directory.
>
>Большая погрешность в 2012 R2 и более поздних версий выходит за пределы спецификации службы времени Windows.

## <a name="windows-10-and-windows-server-2016-default-configuration"></a>Конфигурация по умолчанию для Windows 10 и Windows Server 2016

В то время как мы поддерживаем точность до 1 мс в Windows 10 или Windows Server 2016, большинство клиентов не нуждаются в высокой точности.

Таким образом, **Конфигурация по умолчанию** предназначена для удовлетворения тех же требований, что и предыдущие операционные системы.

- Предоставление необходимой точности времени для удовлетворения требований проверки подлинности Kerberos версии 5.
- Предоставьте слабо точное время для клиентов и серверов Windows, присоединенных к общему лесу Active Directory.

## <a name="how-to-configure-systems-for-high-accuracy"></a>Как настроить системы для высокой точности

>[!IMPORTANT]
>**Примечание о поддержке строго точных систем**<br>
> Точность времени влечет за собой сквозное распределение точного времени от полномочного источника времени к конечному устройству.  Все, что добавляет ассиметри в измерения по этому пути, негативно повлияет на точность, достигаемую на устройствах.
>
>По этой причине мы задокументировани [границу поддержки для настройки службы времени Windows для сред с высокой точностью](support-boundary.md) , описывающей требования к окружающей среде, которые также должны быть удовлетворены для достижения целей высокой точности.

### <a name="operating-system-requirements"></a>Требования к операционной системе

Для конфигураций с высокой точностью требуется Windows 10 или Windows Server 2016.  Все устройства Windows в топологии времени должны соответствовать этому требованию, включая более высокие стратумные серверы Windows, а также в виртуализированных сценариях узлы Hyper-V, на которых работают временные виртуальные машины. Все эти устройства должны быть как минимум Windows 10 или Windows Server 2016.

На приведенном ниже рисунке виртуальные машины, для которых необходима высокая точность, работают под Windows 10 или Windows Server 2016.  Аналогично, узел Hyper-V, на котором находятся виртуальные машины, а вышестоящий сервер времени Windows также должен работать под управлением Windows Server 2016.

![Топология времени — 1607](../media/Windows-Time-Service/Configuring-Systems-for-High-Accuracy/Topology2016.png)


>[!TIP] 
>**Определение версии Windows**<br>
> Вы можете выполнить команду `winver` в командной строке, чтобы убедиться в том, что версия ОС — 1607 (или более поздняя), а сборка ОС — 14393 (или более поздней версии), как показано ниже:
>
> ![Winver-2016 1607](../media/Windows-Time-Service/Configuring-Systems-for-High-Accuracy/winver2016.png)

### <a name="system-configuration"></a>Конфигурация системы

Достижение целей высокой точности требует настройки системы.  Существует множество способов выполнения этой настройки, включая непосредственно в реестре или с помощью групповой политики.  Дополнительные сведения о каждом из этих параметров можно найти в техническом справочнике по службе времени Windows — [средства службы времени Windows](Windows-Time-Service-Tools-and-Settings.md#windows-time-service-tools).

#### <a name="windows-time-service-startup-type"></a>Тип запуска службы времени Windows

Служба времени Windows (W32Time) должна работать постоянно.  Для этого в качестве типа запуска службы времени Windows задайте значение "автоматически".

![Автоматическая настройка](../media/Windows-Time-Service/Configuring-Systems-for-High-Accuracy/AutomaticService.PNG)

#### <a name="cumulative-one-way-network-latency"></a>Совокупная односторонняя задержка сети

Неопределенность измерений и "шум" при увеличении задержки сети.  Таким образом, крайне важно, чтобы задержка в сети была в пределах разумной границы.  Конкретные требования зависят от точности целевого объекта и обрабатываются на [границе поддержки для настройки службы времени Windows для статьи о средах с высокой точностью](support-boundary.md) .

Чтобы вычислить общую однонаправленную задержку в сети, добавьте отдельные односторонние задержки между парой узлов NTP-сервера клиента в топологии времени, начиная с целевого объекта и заканчивая стратумным источником времени с высокой точностью.

Пример: Рассмотрим иерархию синхронизации времени с высокоточным источником, двумя промежуточными NTP-серверами A и B, а также целевым компьютером в указанном порядке. Чтобы получить совокупную задержку сети между целевым и исходным кодом, измерьте среднее время отдельного NTP-обмена (RTTs) между:

- Цель и сервер времени B
- Сервер времени B и сервер времени A
- Сервер времени а и источник

Это измерение можно получить с помощью средства Inbox W32tm. exe.  Выполните указанные ниже действия.

1. Выполните вычисление с целевого сервера, а также сервер времени B.
    
    `w32tm /stripchart /computer:TimeServerB /rdtsc /samples:450 > c:\temp\Target_TsB.csv`

2. Выполняйте вычисление с сервера времени b по сравнению с (на момент времени) сервера a.
    
    `w32tm /stripchart /computer:TimeServerA /rdtsc /samples:450 > c:\temp\Target_TsA.csv`

3. Выполните вычисление с сервера времени а по отношению к источнику.
 
4. Затем добавьте среднее значение Раундтрипделай, измеренное на предыдущем шаге, и разделите на 2, чтобы получить совокупную задержку сети между целевым и исходным значениями.

#### <a name="registry-settings"></a>Параметры реестра

# <a name="minpollintervaltabminpollinterval"></a>[минполлинтервал](#tab/MinPollInterval)
Настраивает наименьший интервал в log2 секунд, разрешенный для системного опроса.

|  |  | 
|---------|---------|
|Расположение ключа     | HKLM: \ SYSTEM\CurrentControlSet\Services\W32Time\Config        |
|Параметр    | 6        |
|Результат | Минимальный интервал опроса теперь составляет 64 секунд. |

Следующая команда сигнализирует о времени Windows, чтобы получить обновленные параметры:

`w32tm /config /update`


# <a name="maxpollintervaltabmaxpollinterval"></a>[максполлинтервал](#tab/MaxPollInterval)
Настраивает максимальный интервал в log2 секунд, разрешенный для системного опроса.

|  |  |  
|---------|---------|
|Расположение ключа     | HKLM: \ SYSTEM\CurrentControlSet\Services\W32Time\Config        |
|Параметр    | 6        |
|Результат | Максимальный интервал опроса теперь составляет 64 секунд.  |

Следующая команда сигнализирует о времени Windows, чтобы получить обновленные параметры:

`w32tm /config /update`

# <a name="updateintervaltabupdateinterval"></a>[упдатеинтервал](#tab/UpdateInterval)
Число тактов часов между корректировками исправления этапа.

|  |  |  
|---------|---------|
|Расположение ключа     | HKLM: \ SYSTEM\CurrentControlSet\Services\W32Time\Config       |
|Параметр    | 100        |
|Результат | Число тактов часов между корректировками коррекции этапа теперь 100 тактов. |

Следующая команда сигнализирует о времени Windows, чтобы получить обновленные параметры:

`w32tm /config /update`

# <a name="specialpollintervaltabspecialpollinterval"></a>[спеЦиалполлинтервал](#tab/SpecialPollInterval)
Настраивает интервал опроса в секундах, когда включен флаг СпеЦиалинтервал 0x1.

|  |  |  
|---------|---------|
|Расположение ключа     | HKLM: \ SYSTEM\CurrentControlSet\Services\W32Time\TimeProviders\NtpClient        |
|Параметр    | 64        |
|Результат | Интервал опроса теперь составляет 64 секунд. |

Следующая команда перезапускает время Windows для выбора обновленных параметров:

`net stop w32time && net start w32time`

# <a name="frequencycorrectratetabfrequencycorrectrate"></a>[фрекуенцикорректрате](#tab/FrequencyCorrectRate)

|  |  |  
|---------|---------|
|Расположение ключа     | HKLM: \ SYSTEM\CurrentControlSet\Services\W32Time\Config      |
|Параметр    | 2        |


---
