---
ms.assetid: d1953097-63ea-4a0e-b860-2f3b7c175c41
title: Принцип работы службы времени Windows
description: ''
author: shortpatti
ms.author: pashort
manager: dougkim
ms.date: 05/08/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: networking
ms.openlocfilehash: 9e4131c28a18a50f3312e5e0201a0ed9529d4555
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66812395"
---
# <a name="how-the-windows-time-service-works"></a>Принцип работы службы времени Windows

>Относится к: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012, Windows 10 или более поздней версии

**В этом разделе**  
  
-   [Архитектура службы времени Windows](#windows-time-service-architecture)  
  
-   [Протоколы времени служба времени Windows](#windows-time-service-time-protocols)  
  
-   [Windows время службы процессы и взаимодействия](#windows-time-service-processes-and-interactions)  
  
-   [Сетевые порты, используемые службой времени Windows](#network-ports-used-by-windows-time-service)  
  
> [!NOTE]  
> В этом разделе объясняется, как служба времени Windows (W32Time) работает только. Сведения о настройке службы времени Windows, см. в разделе [настройки системы для высокая точность](configuring-systems-for-high-accuracy.md).
  
> [!NOTE]  
> В Windows Server 2003 и Microsoft Windows 2000 Server служба каталогов называется службой каталогов Active Directory. В Windows Server 2008 и более поздних версий служба каталогов называется доменных служб Active Directory (AD DS). Остальная часть этой статьи относится к AD DS, но эти сведения применимы также и к Active Directory.  
  
Несмотря на то, что служба времени Windows не точное реализацию протокола сетевого времени (NTP), он использует сложный набор алгоритмов, определенный в спецификациях NTP для обеспечения максимальной точности часы на компьютерах в сети. В идеале все часы компьютера в домене AD DS синхронизируются с временем компьютера, заслуживающих доверия. Синхронизация времени в сети влияют многие факторы. Следующие факторы часто повлиять на точность синхронизации в AD DS:  
  
-   Условия сети  
  
-   Точность часов оборудования компьютера  
  
-   Объем ресурсов ЦП и сетевых ресурсов, доступных для службы времени Windows  
  
> [!IMPORTANT]  
> До выпуска Windows Server 2016 служба W32Time не была разработана для удовлетворения потребностей приложения с учетом времени.  Однако обновления до Windows Server 2016 теперь позволяют реализовать решение для 1 мс точности в вашем домене.  См. в разделе [Windows 2016 Accurate время](accurate-time.md) и [границы поддержки, чтобы настроить службу времени Windows для сред с высокой точностью](support-boundary.md) Дополнительные сведения.  
  
По умолчанию для синхронизации с сайтом time.windows.com настроены компьютеров, которые часто синхронизации времени меньше или не присоединены к домену.  Таким образом невозможно гарантировать точность времени на компьютере имеются временные и не сетевые подключения.  
  
Лес AD DS имеет иерархию заранее заданное время синхронизации. Служба времени Windows синхронизирует время между компьютерами в иерархии, с наиболее точную синхронизирующие вверху. Если на компьютере настроено несколько источников времени, время Windows используются алгоритмы NTP позволяет выбрать лучший источник времени из настроенного источника на основании компьютера возможность синхронизации с источником этого времени. Служба времени Windows не поддерживает синхронизацию сети от рассылки или многоадресной рассылки одноранговых узлов. Дополнительные сведения об этих функциях NTP см. в разделе 1305 RFC в базе данных RFC IETF.  
  
Каждый компьютер, на котором выполняется служба времени Windows использует службу для обеспечения наиболее точного времени. Компьютеры, которые являются членами домена выступать в качестве времени клиента по умолчанию, поэтому в большинстве случаев это не необходимо настроить службу времени Windows. Тем не менее служба времени Windows можно настроить время запроса из источника времени заданного ссылку и можно также задать время клиентам.
  
Степень, в которую времени компьютера является точным называется первого уровня. Наиболее точным источником времени в сети (например, системными часами) занимает низком уровне первого уровня, то есть stratum один. Этот источник точного времени, называется синхронизирующих импульсов. NTP-сервер, который получает время, его непосредственно из синхронизирующих импульсов занимает первого уровня, который расположен на один уровень выше, чем синхронизирующих импульсов. Ресурсы, которые запрашивают время с NTP-сервер из двух этапов от синхронизирующих импульсов и таким образом занимают первого уровня, которое равно двум выше, чем наиболее точным источником времени и так далее. Как номер первого уровня компьютера увеличивается, системное время на его может стать менее точным. Таким образом уровень stratum любой компьютер является индикатором насколько этого компьютера синхронизируется с наиболее точным источником времени.  
  
Когда диспетчер W32Time получает примеры времени, он использует специальный алгоритмы в NTP для определения, какие из образцов времени лучше всего подходит для использования. Служба времени также использует другой набор алгоритмов, чтобы определить, какие из источникам времени является наиболее точным. Когда служба времени определяет, какой образец time рекомендации, соответствии с приведенным выше критериям ли он корректирует скорость локальные часы, чтобы приложение для сведения к правильное время. Если разницу между локальные часы и пример выбранного точное время (также называемый время неравномерного распределения) слишком велико, чтобы исправить путем настройки частоты синхронизации локального, служба времени задает локальные часы правильное время. Эта корректировка частоты синхронизации или изменения времени прямой времени называется Дисциплина часов.  
  
## <a name="windows-time-service-architecture"></a>Архитектура службы времени Windows  
Служба времени Windows состоит из следующих компонентов:  
  
-   Диспетчер управления службами  
  
-   Диспетчер службы времени Windows  
  
-   Дисциплина часов  
  
-   Поставщики времени  
  
На рисунке ниже показана архитектура службы времени Windows.  
  
**Архитектура службы времени Windows**  
  
![Служба времени Windows](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_sec_arcc.gif)
  
Диспетчер управления службами отвечает за запуск и остановка службы времени Windows. Диспетчер службы времени Windows отвечает за инициирование действия из поставщиков времени NTP включается с операционной системой. Диспетчер службы времени Windows определяет все функции службы времени Windows и объединения со значением от всех выборок сеанса времени. В дополнение к предоставляет сведения о текущем системном состоянии, такие как источник времени текущего или последнего времени системных часов была обновлена, диспетчер службы времени Windows также отвечает за создание событий в журнале событий.  
  
Процесс синхронизации времени включает следующие шаги:  
  
-   Поставщиков запрашивать и получать примеры времени из настроенных источников времени NTP.  
  
-   Эти примеры времени передаются в Windows времени Service Manager, который собирает все примеры и передает их подкомпонент Дисциплина часов.  
  
-   Дисциплина вспомогательный компонент часов применяет алгоритмы NTP, что приводит к Выбор наиболее образец time.  
  
-   Дисциплина вспомогательный компонент часов настраивает время системных часов, чтобы время отображалось максимально точно Настройка частоты синхронизации или непосредственно изменение времени.  
  
Если компьютеру назначен как сервер времени, его можно отправлять на любой компьютер запрашивает синхронизацию времени на любом этапе этого процесса.  
  
## <a name="windows-time-service-time-protocols"></a>Протоколы времени служба времени Windows  

Протоколы время определить, насколько двух компьютеров Часы синхронизированы. Протокола NTP несет ответственность за определение наиболее точные сведения доступное время и объединения часы, чтобы убедиться, что согласованное время сохраняется в различных системах.  
  
Служба времени Windows использует протокол сетевого времени (NTP) для синхронизации времени в сети. NTP является время Интернет-протокол, включает в себя алгоритмов Дисциплина, необходимые для синхронизации часов. NTP является более точные протоколом времени, чем простой сети времени протокол SNTP, используемого в некоторых версиях Windows; Тем не менее W32Time продолжает поддерживать SNTP для обеспечения обратной совместимости с компьютерами под управлением службы времени на основе SNTP, такие как Windows 2000.  
  
### <a name="network-time-protocol"></a>Протокола NTP  
По умолчанию используется протокол сетевого времени (NTP) времени синхронизации протокол, используемый службой времени Windows в операционной системе. NTP — это протокол отказоустойчивый времени с высокой степенью масштабируемости и является протоколом, наиболее часто используемые для синхронизации часов компьютера с помощью ссылку на заданное время.  
  
Синхронизация времени NTP происходит за период времени и включает в себя передачу NTP пакетов по сети. NTP пакеты содержат меток времени, которые включают образец времени из клиента и сервера участвует в синхронизации времени.  
  
NTP зависит синхронизирующих импульсов для определения наиболее точного времени для использования и синхронизирует все часы в сети, синхронизирующих импульсов. NTP использует формате UTC (UTC) в качестве универсальный стандарт для текущего времени. В формате UTC не зависит от часовых поясов и позволяет NTP для использования в любом месте в мире независимо от того, параметры часового пояса.  
  
#### <a name="ntp-algorithms"></a>Алгоритмы NTP  
NTP включает в себя два алгоритма, алгоритм фильтрации часов и используется алгоритм отбора часов, для выявления наиболее Образец времени служба времени Windows. Алгоритм фильтрации часов предназначен в поисках примеры времени, полученных из источников запрошенное время и определите лучшие примеры времени из каждого источника. Затем алгоритм выбора часов определяет наиболее точную сервер времени в сети. Эта информация затем передается часов Дисциплина алгоритм, который использует данные, собранные для исправления часов локального компьютера, при компенсации ошибок из-за неточность часов задержки и компьютера сети.  
  
Алгоритмы NTP, наиболее точную условиях освещения и средних нагрузок сети и сервера. Как и в любой алгоритм, который учитывает время передачи по сети, NTP алгоритмы могут плохо перегрузки сети экстремальных условиях. Дополнительные сведения об алгоритмах NTP см. в разделе 1305 RFC в базе данных RFC IETF.  
  
#### <a name="ntp-time-provider"></a>Поставщик времени NTP  
Служба времени Windows — это пакет синхронизации время выполнения, который может поддерживать множество устройств и протоколов времени. Для включения такой поддержки, служба использует поставщиков подключаемых времени. Поставщик времени отвечает, либо Получение отметки точное время (от сети или от оборудования) или для предоставления этих меток времени в другие компьютеры в сети.  
  
Поставщик NTP является поставщик (зима), включенный в состав операционной системы. Поставщик NTP соответствует стандартам, определяемое NTP версии 3 для клиента и сервера и может взаимодействовать с SNTP клиентов и серверов для обеспечения обратной совместимости с Windows 2000 и другими клиентскими SNTP. Поставщик NTP в службу времени Windows состоит из следующих двух частей:  
  
-   **Поставщик вывода NTP-сервер.** Это сервер времени, которая отвечает на запросы клиента времени в сети.  
  
-   **Поставщик ввода с NTP-клиент.** Это время клиент, который получает сведения о времени из другого источника, устройства и NTP-сервером и может возвращать примеры времени, которые можно использовать для синхронизации локальные часы.  
  
Несмотря на то, что фактическое выполнение операций из этих двух поставщиков тесно связаны, они отображаются независимые службы времени. Начиная с Windows 2000 Server, когда компьютер Windows подключен к сети, настроен в качестве NTP-клиента. Кроме того компьютеры под управлением Windows время службы только попытки синхронизации времени с контроллером домена или вручную выбранным источником времени по умолчанию. Это поставщики, предпочтительное время, так как они автоматически доступную и безопасную источники времени.  
  
#### <a name="ntp-security"></a>NTP безопасности  

В пределах леса AD DS служба времени Windows использует стандартные средства безопасности для обеспечения проверки подлинности данных временных. Безопасность NTP пакеты, которые передаются между членом домена и контроллером локального домена, выступающего в качестве сервера времени зависит от проверка подлинности shared key. Служба времени Windows использует компьютера Kerberos сеансовый ключ для создания подписей прошедшего проверку подлинности на NTP пакетов, отправленных по сети. NTP пакеты не передаются в безопасный канал сетевого входа в систему. Вместо этого когда компьютер запрашивает время с контроллера домена в иерархии домена, служба времени Windows требует проверки подлинности время. Контроллер домена возвращает необходимую информацию в виде 64-разрядное значение, который прошел проверку подлинности с ключом сеанса от службы сетевого входа в систему. Если возвращенный NTP пакет не подписан ключом сеанса на компьютере или неправильно подписанного, время отклоняется. Все такие сбои проверки подлинности, регистрируются в журнале событий. Таким образом служба времени Windows обеспечивает безопасность данных NTP в лесу AD DS.  
  
Как правило клиентов службы времени Windows автоматически получить точное время для синхронизации с контроллеров домена в одном домене. В лесу контроллеров домена в дочерний домен синхронизировать время с контроллерами домена в их родительских доменов. По возвращении сервер времени пакет NTP прошедшего проверку подлинности для клиента, который запрашивает время пакет подписан с помощью заданного ключа сеанса Kerberos учетная запись междоменного доверия. Учетная запись междоменного доверия создается при леса присоединяется новый домен AD DS, а служба сетевого входа в систему управляет сеансового ключа. В этом случае контроллер домена, настроенный в корневом домене леса в качестве надежного становится источником времени, прошедшего проверку подлинности для всех контроллеров домена в родительских и дочерних доменов, а также косвенно для всех компьютеров, расположенных в дереве домена.  
  
Служба времени Windows можно настроить для работы между лесами, но это важно отметить, что эта конфигурация не является безопасным. Например NTP-сервером, можно в другом лесу. Тем не менее так как этот компьютер расположен в другом лесу, отсутствует ключ сеанса Kerberos, использующийся для подписи и проверки подлинности пакетов NTP. Чтобы получить точное время синхронизации с компьютера в другом лесу, клиент должен сетевой доступ к этому компьютеру, и служба времени должна быть настроена таким образом, чтобы использовать источник определенное время, расположенный в другом лесу. Если клиент вручную настроен и имеет доступ к Time с NTP-сервера вне иерархии домена, NTP пакетов, отправляемых между клиентом и сервером времени не прошел проверку подлинности и таким образом не являются безопасными. Даже с реализацией доверие леса служба времени Windows не является безопасным между лесами. Несмотря на то, что защищенный канал сетевого входа в систему является механизмом проверки подлинности для службы времени Windows, проверка подлинности между лесами не поддерживается.  
  
#### <a name="hardware-devices-that-are-supported-by-the-windows-time-service"></a>Устройства, которые поддерживаются службой времени Windows  
Аппаратный часами, например GPS или радио часы часто используются как высокоточные Справочник по времени устройства. По умолчанию данный поставщик времени NTP службы времени Windows не поддерживает прямое подключение устройства к компьютеру, несмотря на то, что можно создать поставщик независимых времени на основе программного обеспечения, поддерживающий этот тип подключения. Этот тип поставщика, в сочетании со службой времени Windows, может обеспечивать связь надежных и стабильных времени.  
  
Устройств, таких как часы cesium или получатель системы глобального позиционирования (GPS), предоставить точные текущее время, следуя standard для получения точных определения времени. Часы cesium чрезвычайно стабильны и факторами, такими как температуры, давления и влажности не затрагиваются, но также является весьма затратным. GPS-приемника гораздо менее дорого в эксплуатации и точные синхронизирующих импульсов. GPS получатели получают значения времени от спутников, которые получают значения времени из часов cesium. Без использования с поставщиком независимых времени серверы Windows может получать свое время путем подключения к внешним NTP-сервером, который соединен с устройством посредством телефонной связи или Интернета. Организации, например следующему военно США предоставлять NTP-серверов, подключенных к надежность синхронизирующие.  
  
Увеличение количества получателей по GPS и другими устройствами времени может функционировать в качестве NTP-серверы в сети. Вы можете настроить леса AD DS для синхронизации времени из этих внешних устройств только в том случае, если они также выступают как NTP-серверы в сети. Для этого нужно настройте контроллер домена работает в качестве основного контроллера домена эмулятора (PDC) в корневом каталоге леса для синхронизации с NTP-сервером, устройства GPS. Чтобы сделать это, см. в разделе [настроить службу времени Windows в эмуляторе основного контроллера домена в корневом домене леса](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731191%28v=ws.10%29).  
  
### <a name="simple-network-time-protocol"></a>Простой протокола NTP  
Простой протокол времени сети (SNTP) — это протокол упрощенный времени, предназначенный для серверов и клиентов, не требующие степень достоверности, которая предоставляет NTP. SNTP, более Минимальная версия NTP, — это время основной протокол, который используется в Windows 2000. Поскольку форматы пакетов сети SNTP и NTP идентичны, двух протоколов с возможностью взаимодействия. Основное различие между ними является SNTP не наличие управление обработкой ошибок и сложных систем фильтрации, которые предоставляет NTP. Дополнительные сведения о простой протокола NTP см. в разделе 1769 RFC в базе данных RFC IETF.  
  
### <a name="time-protocol-interoperability"></a>Взаимодействие протокола времени  
Служба времени Windows могут работать в смешанной среде с компьютеров под управлением Windows 2000, Windows XP и Windows Server 2003, так как SNTP протокола, используемого в Windows 2000 может взаимодействовать с протокола NTP в Windows XP и Windows Server 2003.  
  
Служба времени Windows NT Server 4.0, вызывается TimeServ, синхронизирует время в сети Windows NT 4.0. TimeServ является функцией расширения доступны как часть *набор ресурсов Microsoft Windows NT 4.0* и не обеспечивает степень надежности синхронизации времени, который необходим для Windows Server 2003.  
  
Служба времени Windows могут взаимодействовать с компьютерами под управлением Windows NT 4.0, так как они могут синхронизировать время с компьютеров под управлением Windows 2000 или Windows Server 2003; Тем не менее компьютер под управлением Windows 2000 или Windows Server 2003 не автоматически обнаружить серверы Windows NT 4.0. Например если домен настроен для синхронизации времени с помощью метода основе иерархии домена синхронизации и хотите, чтобы компьютеры в иерархии домена для синхронизации времени с контроллером домена Windows NT 4.0, необходимо настроить эти компьютеры вручную, чтобы синхронизировать с контроллерами домена Windows NT 4.0.  
  
Windows NT 4.0 использует простой механизм для синхронизации времени, чем используемая службой времени Windows. Таким образом чтобы обеспечить точное время синхронизации в сети, рекомендуется обновить контроллеры домена Windows NT 4.0 до Windows 2000 или Windows Server 2003.  
  
## <a name="windows-time-service-processes-and-interactions"></a>Windows время службы процессы и взаимодействия  

Служба времени Windows позволяет синхронизировать часы компьютеров в сети. Процесс синхронизации времени сети, также называется конвергенции времени происходит в сети каждый раз обращается к компьютеру с более точного времени сервера. Конвергенция время включает в себя процесс, по которому полномочный сервер предоставляет текущее время на клиентских компьютерах в виде пакетов NTP. Сведения, предоставленные в пределах пакета указывает, нужно выполнить в текущее время на часах компьютера, таким образом, чтобы он синхронизирован с более точные server корректировку.  
  
Как часть процесса конвергенции времени члены домена предпринята новая попытка синхронизировать время с одним контроллером домена, расположенных в одном домене. Если компьютер является контроллером домена, предпринимается попытка синхронизации с контроллером домена более заслуживающих доверия.  
  
Компьютеры под управлением Windows XP Home Edition или компьютеров, которые не присоединены к домену не следует синхронизировать с иерархии доменов, но настроены по умолчанию, чтобы получить время из time.windows.com.  
  
Для установления компьютер под управлением Windows Server 2003 в качестве основного, компьютер должен быть настроен так, чтобы быть надежным источником времени. По умолчанию первый контроллер домена, которая устанавливается в домене Windows Server 2003 автоматически должен быть надежным источником времени. Так как основного компьютера домена, его необходимо настроить для синхронизации с внешним источником, а не с иерархией домена. Также по умолчанию для синхронизации с иерархией домена настраиваются всех остальных членов домена Windows Server 2003.  
  
После установки сети Windows Server 2003, можно настроить службу времени Windows для использования одного из следующих вариантов для синхронизации:  
  
-   Синхронизации на основе иерархии домена  
  
-   Источник синхронизации вручную  
  
-   Все доступные способы синхронизации  
  
-   Нет синхронизации.  
  
Каждый из этих типов синхронизации рассматривается в следующем разделе.  
  
### <a name="domain-hierarchy-based-synchronization"></a>Синхронизации на основе иерархии домена  

Для обнаружения надежного источника, с которым необходимо синхронизировать время синхронизации, которая основана на иерархии домена используется иерархии домена AD DS. Исходя из иерархии домена, служба времени Windows определяет точность каждого сервера времени. В лесу Windows Server 2003 компьютер, содержащий основного домена (PDC) эмулятора роль хозяина операций контроллера, расположенный в корневом домене леса, занимает должность Лучший источник времени, если не был настроен другой надежным источником времени. На следующем рисунке показано, в ходе синхронизации времени между компьютерами в иерархии домена.  
  
**Синхронизация времени в иерархии доменных служб Active Directory AD**  
![Времени Windows](../media/Windows-Time-Service/How-the-Windows-Time-Service-Works/trnt_ntw_adhc.gif)
  
#### <a name="reliable-time-source-configuration"></a>Конфигурация надежного источника времени  
Компьютер, который должен быть надежным источником времени определяется как корень службы времени. Корень службы времени является полномочным сервером для домена и обычно настраивается для получения времени из внешнего NTP-сервера или устройства. Сервер времени можно настроить как надежным источником времени для оптимизации, процесс синхронизации времени в иерархии домена. Если контроллер домена должен быть надежным источником времени, служба сетевого входа в систему объявляет о выпуске этот контроллер домена как надежным источником времени при подключении к сети. Когда другие контроллеры домена будут искать источник времени для синхронизации с, они надежный источник сначала выберите если таковой доступен.  
  
#### <a name="time-source-selection"></a>Выбор источника времени  
Процесс выбора источника времени можно создать две проблемы в сети:  
  
-   Циклы дополнительной синхронизации.  
  
-   Возрастающего объема сетевого трафика.  
  
Цикл в сети синхронизации происходит, когда время остается согласованной между группой контроллеров домена и то же время используется ими совместно постоянно без повторную синхронизацию с другим надежным источником времени. Алгоритм выбора источника времени службу времени Windows предназначен для защиты от подобных проблем.  
  
Компьютер использует один из следующих методов для определения источника времени для синхронизации с:  
  
-   Если компьютер не является членом домена, его необходимо настроить для синхронизации с выбранным источником времени.  
  
-   Если компьютер является рядовым сервером или рабочей станции в домене по умолчанию, он соответствует иерархии AD DS и синхронизирует время его с контроллером домена в его локальном домене, который выполняется в данный момент служба времени Windows.  
  
Если компьютер является контроллером домена, он делает до шести запросы для поиска другой контроллер домена для синхронизации с. Каждый запрос предназначен для определения источника времени с определенными атрибутами, например, тип контроллера домена, в определенном месте, и является ли надежным источником времени. Источник времени также должен соответствовать следующим ограничениям:  
  
-   Надежным источником времени могут синхронизироваться только с контроллером домена в родительском домене.  
  
-   Эмулятор основного контроллера домена, могут синхронизироваться с надежным источником времени в своем собственном домене или любой контроллер домена в родительском домене.  
  
Если контроллер домена не удалось синхронизовать с типом контроллера домена, который создается запрос, запрос не выполняется. Контроллер домена знает, какой тип компьютера, его можно получить время перед отправкой запроса. Например локальный эмулятор основного контроллера домена не пытайтесь числа запросов, три или шесть так, как контроллер домена не будет пытаться синхронизировать с самим собой.  
  
В следующей таблице перечислены запросы, сделанные в контроллер домена для поиска источника времени и порядок, в котором запрашивается.  
  
**Запрашивает источник времени для контроллера домена**  
  
|Номер запроса|Контроллер домена|Location|Надежность источника времени|  
|----------------|---------------------|------------|------------------------------|  
|1|Родительский контроллер домена|В веб-узлов|Является предпочтительным является надежным источником времени, но его можно синхронизировать с-надежным источником времени если это все, что доступен.|  
|2|Локальный контроллер домена|В веб-узлов|Только синхронизация с надежным источником времени.|  
|3|Локальный эмулятор основного контроллера домена|В веб-узлов|Не применяется.<br /><br />Контроллер домена не пытается синхронизировать с самим собой.|  
|4|Родительский контроллер домена|Входящих в сайт|Является предпочтительным является надежным источником времени, но его можно синхронизировать с-надежным источником времени если это все, что доступен.|  
|5|Локальный контроллер домена|Входящих в сайт|Только синхронизация с надежным источником времени.|  
|6|Локальный эмулятор основного контроллера домена|Входящих в сайт|Не применяется.<br /><br />Контроллер домена не пытается синхронизировать с самим собой.| 
  
**Примечание**  
  
-   Компьютер никогда не синхронизируется с самим собой. Если компьютер, попытки синхронизации локального эмулятора основного контроллера домена, не выполняет запросы 3 или 6.  
  
Каждый запрос возвращает список контроллеров домена, которые могут использоваться в качестве источника времени. Время Windows назначает каждый контроллер домена, являющийся запрос оценку, основанную на надежность и расположение контроллера домена. В следующей таблице перечислены показатели, присвоенные по времени Windows для каждого типа контроллера домена.  
  
**Определение оценки**  
  
|Состояние контроллера домена|Оценка|  
|----------------------------|---------|  
|Контроллер домена, расположенных в пределах одного сайта|8|  
|Контроллер домена, которые помечены как надежным источником времени|4|  
|Контроллер домена, расположенных в родительском домене|2|  
|Контроллер домена является эмулятором основного контроллера домена|1|  
  
Когда служба времени Windows определяет, что он определил контроллера домена с наилучшую оценку возможных, дополнительные запросы не выполняются. Показатели, присвоенные службой времени являются накопительными, это означает, что эмулятор основного контроллера домена, расположенный на том же сайте получает оценку из девяти.  
  
Если корень службы времени не настроен для синхронизации с внешним источником, системных часов компьютера определяет время.  
  
### <a name="manually-specified-synchronization"></a>Синхронизация вручную  
Синхронизация вручную позволяет указать один или несколько одноранговых узлов, с которых компьютер получает время. Если компьютер не является членом домена, его необходимо вручную настроить синхронизацию с выбранным источником времени. Компьютере, который является членом домена настраивается по умолчанию для синхронизации из иерархии доменов, синхронизация вручную может пригодиться для корневого домена леса, или для компьютеров, которые не присоединены к домену. Указывается вручную внешним NTP-сервером для синхронизации с доменом основного компьютера предоставляет надежный источник времени. Однако настраивать основной сервер для домена для синхронизации с системными часами является фактически лучшее решение для обеспечения наиболее точные и безопасное время к вашему домену.  
  
В качестве источника времени вручную не проходят проверку подлинности, если поставщик определенное время для них, то они их уязвимыми для злоумышленников. Кроме того Если компьютер синхронизируется с источником вручную, а не к контроллеру домена, эти два компьютера может быть синхронизирована, вызывая сбой проверки подлинности Kerberos. Это может вызвать другие действия, требующие проверки подлинности сети переход на другой, например печати или общего доступа к файлам. Если только корень леса настроен на синхронизацию с внешним источником, все компьютеры в пределах леса будут синхронизированы друг с другом, что затрудняет атаки с повторением пакетов.  
  
### <a name="all-available-synchronization-mechanisms"></a>Все доступные способы синхронизации  

Параметр «все доступные способы синхронизации» — метод синхронизации наиболее ценных для пользователей в сети. Этот метод позволяет синхронизировать с иерархией домена и также может предоставлять альтернативный источник времени, если в иерархии домена становится недоступной, в зависимости от конфигурации. Если клиент не сможет синхронизировать время с помощью иерархии доменов, источник времени автоматически переходит обратно к источника времени, заданного параметром **NTP-сервер** параметр. Этот метод синхронизации, скорее всего, для предоставления точного времени для клиентов.  

### <a name="stopping-time-synchronization"></a>Остановка синхронизации времени  
Существуют определенные ситуации, в которых требуется запретить синхронизацию времени. К примеру Если компьютер пытается синхронизировать из источника времени в Интернете или на другом сайте, с помощью подключения удаленного доступа по глобальной сети, он может взиматься плата за дорогостоящих телефона. При отключении синхронизации на этом компьютере, компьютере предотвратить попытки доступа к источнику времени через подключение удаленного доступа.  
  
Можно также отключить синхронизации для предотвращения создания ошибки в журнале событий. Каждый раз, когда компьютер пытается выполнить синхронизацию с источником времени, который недоступен, он создает ошибку в журнале событий. Если источник времени берется из сети для запланированного обслуживания, и вы не собираетесь измените конфигурацию клиента для синхронизации из другого источника, можно отключить синхронизацию на клиенте, чтобы предотвратить попытки синхронизации, пока сервер времени недоступен.  
  
Это полезно для отключения синхронизации на компьютере, который используется в качестве корневого сети синхронизации. Это означает, что компьютер корневого доверяет ее локальные часы. Если корень иерархии синхронизации не присваивается **NoSync** , и если это не удалось синхронизировать с другим источником времени, клиенты не принимают пакет, который отправляет этот компьютер из-за время его нельзя доверять.
  
Единственный случай, когда серверы, которые являются доверенными клиентов, даже если они не были синхронизированы с другим источником времени, которые были определены с помощью клиента как надежный источник времени серверов.  
  
### <a name="disabling-the-windows-time-service"></a>Отключение службы времени Windows  
Служба времени Windows (W32Time) может быть полностью отключена. Если вы решили реализовать продукт стороннего времени синхронизации, использующий NTP, необходимо отключить службу времени Windows. Это потому, что все NTP-серверов требуется доступ к порту датаграмм протокола UDP (User) 123 и до тех пор, пока служба времени Windows запущена в операционной системе Windows Server 2003, порт 123 остается зарезервированным по времени Windows.  
  
## <a name="network-ports-used-by-windows-time-service"></a>Сетевые порты, используемые службой времени Windows  
Служба времени Windows взаимодействует в сети для выявления надежных источников, получить сведения о времени и предоставляют сведения о времени на другие компьютеры. Он выполняет это взаимодействие, согласно определению RFC SNTP и NTP.  
  
**Назначение портов для службы времени Windows**  
  
|Служебное имя|UDP|TCP|  
|----------------|-------|-------|  
|NTP|123|Н/Д|  
|SNTP|123|Н/Д|  
  
## <a name="see-also"></a>См. также  
[Технический справочник по службы времени Windows](windows-time-service-tech-ref.md)
[средства службы времени Windows и параметры](Windows-Time-Service-Tools-and-Settings.md)
[статье базы знаний Майкрософт 902229](https://go.microsoft.com/fwlink/?LinkId=186066)