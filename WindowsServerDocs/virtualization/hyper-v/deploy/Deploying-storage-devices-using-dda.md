---
title: Развертывание устройств хранения NVMe с помощью дискретного назначения устройств
description: Узнайте, как использовать ДДА для развертывания устройств хранения данных
ms.prod: windows-server
ms.service: na
ms.technology: hyper-v
ms.tgt_pltfrm: na
ms.topic: article
author: chrishuybregts
ms.author: chrihu
ms.assetid: 1c36107e-78c9-4ec0-a313-6ed557ac0ffc
ms.openlocfilehash: eb76b25e8ff1428b2c03b37dde1f76562751d3bb
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71364325"
---
# <a name="deploy-nvme-storage-devices-using-discrete-device-assignment"></a>Развертывание устройств хранения NVMe с помощью дискретного назначения устройств

>Область применения. Microsoft Hyper-V Server 2016, Windows Server 2016

Начиная с Windows Server 2016 можно использовать дискретное назначение устройств или ДДА для передачи целого устройства PCIe в виртуальную машину.  Это обеспечит высокопроизводительный доступ к устройствам, например к хранилищу NVMe или графическим картам, из виртуальной машины, в то время как они смогут использовать собственные драйверы устройств.  Дополнительные сведения о том, какие устройства работают, каковы возможные последствия для безопасности и т. д., см. в [плане развертывания устройств с помощью дискретного назначения устройств](../plan/Plan-for-Deploying-Devices-using-Discrete-Device-Assignment.md) . Использование устройства с ДДА состоит из трех этапов.
-   Настройка виртуальной машины для ДДА
-   Отключение устройства от раздела узла
-   Назначение устройства гостевой виртуальной машине

Все команды могут выполняться на узле в консоли Windows PowerShell с правами администратора.

## <a name="configure-the-vm-for-dda"></a>Настройка виртуальной машины для ДДА
Отдельное назначение устройств накладывает некоторые ограничения на виртуальные машины, и необходимо выполнить следующий шаг.

1.  Настройте параметр "Автоматическое действие при автоматическом запуске" для виртуальной машины в Турнофф, выполнив

```
Set-VM -Name VMName -AutomaticStopAction TurnOff
```

## <a name="dismount-the-device-from-the-host-partition"></a>Отключение устройства от раздела узла

### <a name="locating-the-devices-location-path"></a>Поиск пути к расположению устройства
Для отключения и подключения устройства к узлу требуется указать путь к расположению PCI.  Пример пути к расположению выглядит следующим образом: `"PCIROOT(20)#PCI(0300)#PCI(0000)#PCI(0800)#PCI(0000)"`.   Дополнительные сведения о расположении пути расположения можно найти здесь: [Планирование развертывания устройств с помощью дискретного назначения устройств](../plan/Plan-for-Deploying-Devices-using-Discrete-Device-Assignment.md).

### <a name="disable-the-device"></a>Отключение устройства
С помощью Device Manager или PowerShell убедитесь, что устройство отключено.  

### <a name="dismount-the-device"></a>Отключение устройства
```
Dismount-VMHostAssignableDevice -LocationPath $locationPath
```

## <a name="assigning-the-device-to-the-guest-vm"></a>Назначение устройства гостевой виртуальной машине
Последний шаг — сообщить Hyper-V, что виртуальная машина должна иметь доступ к устройству.  Помимо пути к расположению, приведенному выше, необходимо знать имя виртуальной машины.

```
Add-VMAssignableDevice -LocationPath $locationPath -VMName VMName
```

## <a name="whats-next"></a>Что дальше
После успешной установки устройства в виртуальной машине теперь можно запустить эту виртуальную машину и взаимодействовать с устройством, как обычно при работе в системе без операционной системы.  Это можно проверить, открыв диспетчер устройств на гостевой виртуальной машине и просмотрев, что оборудование теперь отображается.

## <a name="removing-a-device-and-returning-it-to-the-host"></a>Удаление устройства и его возврат на узел
Если вы хотите вернуть устройство в исходное состояние, необходимо будет закрыть виртуальную машину и выдать следующее:
```
#Remove the device from the VM
Remove-VMAssignableDevice -LocationPath $locationPath -VMName VMName
#Mount the device back in the host
Mount-VMHostAssignableDevice -LocationPath $locationPath
```
Затем можно снова включить устройство в диспетчере устройств, и операционная система узла сможет снова взаимодействовать с устройством.
