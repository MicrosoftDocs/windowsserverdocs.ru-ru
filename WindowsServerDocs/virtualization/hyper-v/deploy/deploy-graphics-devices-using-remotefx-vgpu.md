---
title: Развертывание графических устройств с помощью vGPU RemoteFX
description: Узнайте, как развернуть и настроить RemoteFX на виртуальных GPU в Windows Server
ms.reviewer: rickman
author: rick-man
ms.author: rickman
manager: stevelee
ms.topic: article
ms.date: 07/14/2020
ms.openlocfilehash: 9a060f1650d20a029d64739e1fc7f9be44d8355c
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87953442"
---
# <a name="deploy-graphics-devices-using-remotefx-vgpu"></a>Развертывание графических устройств с помощью vGPU RemoteFX

> Область применения: Windows Server 2016, Microsoft Hyper-V Server 2016

> [!NOTE]
> Из соображений безопасности процессор RemoteFX vGPU по умолчанию отключен для всех версий Windows, начиная с обновления для системы безопасности за 14 июля 2020 г. См. [KB 4570006](https://support.microsoft.com/help/4570006).

Функция виртуальных машин для RemoteFX позволяет нескольким виртуальным машинам совместно использовать физический GPU. Визуализация и вычисление ресурсов динамически используются в виртуальных машинах, что делает виртуальную машину RemoteFX пригодной для высокопроизводительных рабочих нагрузок, когда выделенные ресурсы GPU не требуются. Например, в службе VDI виртуальный графический процессор RemoteFX можно использовать для разгрузки затрат на визуализацию приложений в GPU, что приводит к снижению нагрузки на ЦП и улучшению масштабируемости служб.

## <a name="remotefx-vgpu-requirements"></a>Требования к RemoteFX vGPU

Требования к системе узла:

- Windows Server 2016
- Совместимый с DirectX 11,0 графический процессор с драйвером 1,2 WDDM, совместимым с курьером.
- ЦП с поддержкой преобразования адресов второго уровня (SLAT)

Требования к гостевым виртуальным машинам:

- Поддерживаемая гостевая ОС. Дополнительные сведения см. в разделе [Поддержка RemoteFX 3D Video Adapter (виртуальный графический адаптер)](../../../remote/remote-desktop-services/rds-supported-config.md#remotefx-3d-video-adapter-vgpu-support).

Дополнительные рекомендации для гостевых виртуальных машин:

- Функции OpenGL и OpenCL доступны только в гостевых ОС Windows 10 или Windows Server 2016.
- DirectX 11,0 доступен только для гостей под Windows 8 или более поздней версии.

## <a name="enable-remotefx-vgpu"></a>Включить RemoteFX для виртуальных GPU

Чтобы настроить виртуальный жесткий процессор RemoteFX на узле Windows Server 2016, выполните следующие действия.

1. Установите графические драйверы, рекомендованные поставщиком GPU для Windows Server 2016.
2. Создайте виртуальную машину под управлением гостевой ОС, поддерживаемой виртуальным процессором RemoteFX. Дополнительные сведения см. в разделе [Поддержка RemoteFX 3D Video Adapter (виртуальный графический адаптер)](../../../remote/remote-desktop-services/rds-supported-config.md#remotefx-3d-video-adapter-vgpu-support).
3. Добавьте на виртуальную машину адаптер 3D Graphics для RemoteFX. Дополнительные сведения см. в статье [Настройка 3D-адаптера RemoteFX для виртуальных GPU](#configure-the-remotefx-vgpu-3d-adapter).

По умолчанию виртуальный графический процессор RemoteFX будет использовать все доступные и поддерживаемые GPU. Чтобы ограничить количество GPU, используемых виртуальным графическим процессором RemoteFX, выполните следующие действия.

1. В диспетчере Hyper-V перейдите к параметрам Hyper-V.
2. Выберите **физические GPU** в параметрах Hyper-V.
3. Выберите графический процессор, который не нужно использовать, а затем снимите флажок **Использовать этот графический процессор в RemoteFX**.

### <a name="configure-the-remotefx-vgpu-3d-adapter"></a>Настройка трехмерного адаптера vGPU RemoteFX

Вы можете использовать пользовательский интерфейс диспетчера Hyper-V или командлеты PowerShell, чтобы настроить трехмерный графический адаптер vGPU RemoteFX.

#### <a name="configure-remotefx-vgpu-with-hyper-v-manager"></a>Настройка RemoteFX для виртуальных GPU с помощью диспетчера Hyper-V

1. Останавливает виртуальную машину, если она выполняется в данный момент.
2. Откройте диспетчер Hyper-V, перейдите к разделу **Параметры виртуальной машины**, а затем выберите **Добавить оборудование**.
3. Выберите **адаптер RemoteFX 3D Graphics**и нажмите кнопку **Добавить**.
4. Задайте максимальное число мониторов, максимальное разрешение монитора и используемой видеопамяти, либо оставьте значения по умолчанию.

   > [!NOTE]
   > - Установка большего числа значений для любого из этих параметров повлияет на масштаб службы, поэтому следует задать только то, что необходимо.
   > - Если необходимо использовать 1 ГБ выделенной видеопамяти, для получения наилучших результатов используйте 64-разрядную гостевую виртуальную машину вместо 32-bit (x86).

5. Нажмите кнопку **ОК** , чтобы завершить настройку.

#### <a name="configure-remotefx-vgpu-with-powershell-cmdlets"></a>Настройка виртуальных GPU RemoteFX с помощью командлетов PowerShell

Используйте следующие командлеты PowerShell для добавления, проверки и настройки адаптера:

- [Add-VMRemoteFx3dVideoAdapter](https://docs.microsoft.com/powershell/module/hyper-v/add-vmremotefx3dvideoadapter?view=win10-ps)
- [Get-VMRemoteFx3dVideoAdapter](https://docs.microsoft.com/powershell/module/hyper-v/get-vmremotefx3dvideoadapter?view=win10-ps)
- [Set-VMRemoteFx3dVideoAdapter](https://docs.microsoft.com/powershell/module/hyper-v/set-vmremotefx3dvideoadapter?view=win10-ps)
- [Get-Вмремотефксфисикалвидеоадаптер](https://docs.microsoft.com/powershell/module/hyper-v/get-vmremotefxphysicalvideoadapter?view=win10-ps)

## <a name="monitor-performance"></a>Мониторинг производительности

Производительность и масштаб службы, поддерживающей RemoteFX на виртуальных GPU, определяется различными факторами, такими как количество графических процессоров в системе, Общая память GPU, объем системной памяти и скорость памяти, число ядер ЦП и тактовая частота ЦП, скорость хранения и реализация NUMA.

### <a name="host-system-memory"></a>Память системы узла

Для каждой виртуальной машины, поддерживающей виртуальный графический процессор, RemoteFX использует системную память как в гостевой операционной системе, так и на сервере узла. Гипервизор гарантирует доступность системной памяти для гостевой операционной системы. На узле каждому виртуальному рабочему столу с поддержкой виртуальных рабочих столов необходимо объявить требования к системной памяти гипервизору. Когда запускается виртуальный рабочий стол с поддержкой виртуальных рабочих столов, гипервизор резервирует дополнительный объем системной памяти на узле.

Требования к памяти для сервера с поддержкой RemoteFX являются динамическими, так как объем памяти, потребляемой на сервере с поддержкой RemoteFX, зависит от числа мониторов, связанных с виртуальными рабочими столами с поддержкой виртуальных рабочих столов, и максимального разрешения этих мониторов.

### <a name="host-gpu-video-memory"></a>Видеопамять основного GPU узла

Каждый виртуальный рабочий стол с поддержкой виртуальных рабочих столов использует аппаратную видеопамять GPU на сервере узла для подготовки к просмотру рабочего стола. Кроме того, кодек использует видео-память для сжатия отображаемого экрана. Объем памяти, необходимый для отрисовки и сжатия, непосредственно зависит от количества мониторов, подготовленных для виртуальной машины. Объем зарезервированной видеопамяти зависит от разрешения экрана системы и количества мониторов. Некоторым пользователям требуется более высокое разрешение экрана для определенных задач, но существует большая масштабируемость с более низкими параметрами разрешения, если все остальные параметры остаются постоянными.

### <a name="host-cpu"></a>ЦП узла

Гипервизор планирует размещение и виртуальные машины на ЦП. Издержки на узле с поддержкой RemoteFX увеличиваются, так как система запускает дополнительный процесс (rdvgm.exe) на виртуальном рабочем столе с поддержкой виртуальных рабочих столов. Этот процесс использует драйвер графического устройства для выполнения команд GPU. Кодек также использует ЦП для сжатия данных экрана, которые необходимо отправить обратно клиенту.

Большее число виртуальных процессоров означает лучшее взаимодействие с пользователем. Мы рекомендуем выделить не менее двух виртуальных процессоров на виртуальный рабочий стол с поддержкой виртуальных рабочих столов. Мы также советуем использовать архитектуру x64 для виртуальных рабочих столов с поддержкой GPU, так как производительность виртуальных машин x64 лучше по сравнению с виртуальными машинами x86.

### <a name="gpu-processing-power"></a>Вычислительная мощность процессора

У каждого виртуального рабочего стола с поддержкой виртуальных рабочих столов есть соответствующий процесс DirectX, выполняемый на сервере узла. Этот процесс воспроизводит все команды графики, полученные от виртуального рабочего стола RemoteFX, на физический графический процессор. Это аналогично одновременному запуску нескольких приложений DirectX на одном физическом GPU.

Как правило, графические устройства и драйверы настроены на запуск только нескольких приложений на рабочем столе за раз, но RemoteFX растягивает графические процессоры еще больше. Вгпус поставляются с счетчиками производительности, которые измеряют ответ GPU на запросы RemoteFX и помогают убедиться, что GPU не растягиваются слишком далеко.

Когда GPU не хватает ресурсов, операции чтения и записи выполняются длительное время. Администраторы могут использовать счетчики производительности, чтобы выяснить, когда следует настраивать ресурсы и предотвращать время простоя для пользователей.

Узнайте больше о счетчиках производительности для мониторинга поведения виртуальных GPU RemoteFX при [диагностике проблем с производительностью графики в удаленный рабочий стол](https://docs.microsoft.com/azure/virtual-desktop/remotefx-graphics-performance-counters).
