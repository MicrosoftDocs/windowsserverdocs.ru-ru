---
title: Обновление версии виртуальной машины в Hyper-V в Windows 10 или Windows Server
description: Предоставляет инструкции и рекомендации по обновлению версии виртуальной машины
ms.prod: windows-server-threshold
ms.service: na
manager: dongill
ms.technology: compute-hyper-v
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 897f2454-5aee-445c-a63e-f386f514a0f6
author: jasongerend
ms.author: jgerend
ms.date: 05/22/2019
ms.openlocfilehash: 1d19b3dc7000a4bf5558f351ce67ce7406b3d5d8
ms.sourcegitcommit: b190fac4bfa5599751a60d3fc3b4c4a64dd9afd7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/22/2019
ms.locfileid: "66009077"
---
# <a name="upgrade-virtual-machine-version-in-hyper-v-on-windows-10-or-windows-server"></a>Обновление версии виртуальной машины в Hyper-V в Windows 10 или Windows Server

>Область применения. Windows 10, Windows Server 2019 г., Windows Server 2016, Windows Server (Semi-Annual Channel)

Освободить новейших функций Hyper-V на виртуальных машинах, обновив версию конфигурации. У этого до:

- Обновления узлов Hyper-V до последней версии Windows или Windows Server.
- Обновления режима работы кластера.
- Вы уверены, что вам не нужно будет переместить виртуальную машину обратно на узел Hyper-V под управлением предыдущей версии Windows или Windows Server.

Дополнительные сведения см. в разделе [последовательного обновления кластерной ОС](../../../failover-clustering/Cluster-Operating-System-Rolling-Upgrade.md) и [выполнение последовательного обновления кластера узлов Hyper-V в VMM](https://docs.microsoft.com/system-center/vmm/hyper-v-rolling-upgrade).

## <a name="step-1-check-the-virtual-machine-configuration-versions"></a>Шаг 1. Проверка версии конфигурации виртуальной машины

1. На рабочем столе Windows нажмите кнопку "Пуск" и введите любую часть имени **Windows PowerShell**.
2. Щелкните правой кнопкой мыши Windows PowerShell и выберите **Запуск от имени администратора**.
3. Используйте [Get-VM](https://docs.microsoft.com/powershell/module/hyper-v/get-vm)командлета. Выполните следующую команду, чтобы получить список версий виртуальных машин.

```PowerShell
Get-VM * | Format-Table Name, Version
```

Можно также увидеть версию конфигурации в диспетчере Hyper-V, выбрав виртуальную машину и оценив **Сводка** вкладки.

## <a name="step-2-upgrade-the-virtual-machine-configuration-version"></a>Шаг 2. Обновить версию конфигурации виртуальной машины

1. Завершите работу виртуальной машины в диспетчере Hyper-V.
2. Выберите действие > обновления версии конфигурации. Если этот параметр недоступен для виртуальной машины, а затем уже используется последняя версия конфигурации поддерживается на узле Hyper-V.

Чтобы обновить версию конфигурации виртуальной машины с помощью Windows PowerShell, используйте [VMVersion обновления](https://docs.microsoft.com/powershell/module/hyper-v/update-vmversion) командлета. Выполните следующую команду, в которой vmname — это имя виртуальной машины.

```PowerShell
Update-VMVersion <vmname>
```

## <a name="BKMK_SupportedConfigVersions"></a>Поддерживаемые версии виртуальных машин конфигурации

Выполните командлет PowerShell [Get VMHostSupportedVersion](https://docs.microsoft.com/powershell/module/hyper-v/get-vmhostsupportedversion) знать, какие версии конфигурации виртуальной машины, поддерживает узла Hyper-V. При создании виртуальной машины, он создается с конфигурацией версии по умолчанию. Чтобы увидеть, что такое значение по умолчанию, выполните следующую команду.

```PowerShell
Get-VMHostSupportedVersion -Default
```

Если вам нужно создать виртуальную машину, можно переместить на узел Hyper-V, которое будет выполняться более старой версии Windows, используйте [New-VM](https://docs.microsoft.com/powershell/module/hyper-v/new-vm) командлет с параметром - версии. Например чтобы создать виртуальную машину, можно переместить на узел Hyper-V под управлением Windows Server 2012 R2, выполните команду ниже. Эта команда создает виртуальную машину с именем «WindowsCV5» с конфигурацией версии 5.0.

```PowerShell
New-VM -Name "WindowsCV5" -Version 5.0
```

>[!NOTE]
>Можно импортировать виртуальные машины, которые были созданы для узла Hyper-V под управлением более ранней версии Windows или восстановить их из резервной копии. Если версия конфигурации виртуальной Машины нет в списке, поддерживаемой для узла Hyper-V ОС в следующей таблице, необходимо обновить версию конфигурации виртуальной Машины перед запуском виртуальной Машины.

### <a name="supported-vm-configuration-versions-for-long-term-servicing-hosts"></a>Поддерживаемые версии конфигурации виртуальной Машины для долгосрочного обслуживания узлов

Ниже перечислены версии конфигурации виртуальной Машины, которые поддерживаются на узлах под управлением версии долгосрочного обслуживания Windows.

| Версия Windows на узле Hyper-V | 9.1 | 9.0 | 8.3 | 8.2 | 8.1 | 8.0 | 7.1 | 7.0 | 6.2 | 5.0 |
| --- |---|---|---|---|---|---|---|---|---|---|
|Windows Server 2019|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Корпоративная LTSC 2019 г.|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows Server 2016|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Корпоративная 2016 с долгосрочным обслуживанием|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Корпоративная 2015 с долгосрочным обслуживанием|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|
|Windows Server 2012 R2|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|
|Windows 8.1|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|

### <a name="supported-vm-configuration-versions-for-semi-annual-channel-hosts"></a>Поддерживаемые версии конфигурации виртуальной Машины для узлов полугодовой канал

Ниже перечислены версии конфигурации виртуальной Машины для узлов под управлением поддерживаемых в настоящее время полугодовой канал версии Windows. Чтобы получить дополнительные сведения о версиях полугодовой канал в Windows, посетите следующие страницы для [Windows Server](../../../get-started-19/servicing-channels-19.md) и [Windows 10](https://docs.microsoft.com/windows/deployment/update/waas-overview#servicing-channels)

| Версия Windows на узле Hyper-V | 9.1 | 9.0 | 8.3 | 8.2 | 8.1 | 8.0 | 7.1 | 7.0 | 6.2 | 5.0 |
| --- |---|---|---|---|---|---|---|---|---|---|
| Windows 10 могут 2019 г. обновление (версия 1903) |&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;| &#10004;|
| Windows Server версии 1903 |&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;| &#10004;|
|Windows Server версии 1809|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 октября 2018 Update (версия 1809)|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows Server версии 1803|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 апреля 2018 г. обновление (версия 1803)|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Fall Creators Update (версия 1709)|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Creators Update (версия 1703)|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|
|Windows 10 Anniversary Update (версия 1607)|&#10006;|&#10006;|&#10006;|&#10006;|&#10006;|&#10004;|&#10004;|&#10004;|&#10004;|&#10004;|

## <a name="why-should-i-upgrade-the-virtual-machine-configuration-version"></a>Почему мне нужно обновить версию конфигурации виртуальной машины?

При перемещении или импорте виртуальной машины на компьютер под управлением Hyper-V на Windows Server 2019, Windows Server 2016 или Windows 10, виртуальная машина «s конфигурация не обновится автоматически. Это означает, что можно будет переместить виртуальную машину обратно на узел Hyper-V под управлением предыдущей версии Windows или Windows Server. Но это также означает, что нельзя использовать некоторые новые функции виртуальной машины, пока вы вручную не обновите версию конфигурации. Не удается понизить версию конфигурации виртуальной машины, после его обновления.

Версия конфигурации виртуальной машины представляет совместимости конфигурация виртуальной машины, сохраненное состояние и файлы моментальных снимков с версией Hyper-V. При обновлении версию конфигурации, изменяется структура файла, который используется для хранения конфигурации виртуальных машин и файлов контрольных точек. Можно также обновить версию конфигурации до последней версии, поддерживается в этом узле Hyper-V. Обновленные виртуальные машины используют новый формат файлов конфигурации, который повышает эффективность чтения и записи данных. Кроме того, при обновлении снижается вероятность повреждения данных в случае ошибки хранилища.

Ниже перечислены описания, расширения имен файлов и расположения по умолчанию для каждого типа файла, который используется для новых или обновленных виртуальных машин.

 |Типы файлов виртуальной машины | Описание|
 |---|---|
|Конфигурация |Сведения о конфигурации виртуальной машины, которые хранятся в двоичном формате. <br /> Расширение имени файла: .vmcx <br /> Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines|
 |Состояние среды выполнения|Виртуальной машины сведения о состоянии выполнения, хранящиеся в двоичном формате. <br />Расширение имени файла: .vmrs и .vmgs <br />Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual Machines|
|Виртуальный жесткий диск|Сохраняет виртуальные жесткие диски для виртуальной машины. <br /> Расширение имени файла: VHD или vhdx <br />Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual жестких дисков|
 |Автоматических виртуальных жестких дисков |Разностные файлы, используемые для контрольных точек виртуальной машины. <br /> Расширение имени файла: .avhdx <br /> Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Hyper-V\Virtual жестких дисков|
 |Контрольная точка|Контрольные точки хранятся в нескольких файлах. Каждая контрольная точка создает файл конфигурации и файл состояния среды выполнения <br /> Расширения имен файлов: .vmrs и .vmcx <br />Расположение по умолчанию: C:\ProgramData\Microsoft\Windows\Snapshots|

## <a name="what-happens-if-i-dont-upgrade-the-virtual-machine-configuration-version"></a>Что произойдет, если не обновить версию конфигурации виртуальной машины?

Если у вас есть виртуальные машины, созданные с помощью более ранней версии Hyper-V, некоторые функции, доступные на нем новой операционной системы не может работать с этих виртуальных машин, пока вы не обновите версию конфигурации.

Как правило мы рекомендуем обновить версию конфигурации после успешного обновления узлов виртуализации до более новой версии Windows и чувствовать уверенность в том, что откат не требуется. При использовании [последовательное обновление кластерной ОС](https://docs.microsoft.com/windows-server/failover-clustering/Cluster-Operating-System-Rolling-Upgrade) функция, это было бы после обновления режима работы кластера. Таким образом, будет обеспечен новые функции внутренних изменений и оптимизации также.

>[!NOTE]
>После обновления версии конфигурации виртуальной Машины, виртуальная машина будет невозможно запустить на узлах, которые не поддерживают версию обновленной конфигурации.

В следующей таблице показаны минимальное версию конфигурации виртуальной машины должен использовать некоторые функции Hyper-V.

|Компонент|Минимальная версия конфигурации виртуальной Машины|
|---|---|
|Горячее добавление и удаление памяти|6.2|
|Безопасная загрузка виртуальных машин Linux|6.2|
|Рабочие контрольные точки|6.2|
|PowerShell Direct |6.2|
|Группирование виртуальных машин|6.2|
|Виртуальный доверенный платформенный модуль (vTPM)|7.0|
|Виртуальную машину с несколькими очередями (VMMQ)|7.1|
|Поддержка xsave|8.0|
|Диск хранилища ключей|8.0|
|Поддержка гостевых безопасности на основе виртуализации (VBS)|8.0|
|Вложенная виртуализация|8.0|
|Число виртуальных процессоров|8.0|
|Большим объемом памяти виртуальных машин|8.0|
|Увеличить количество по умолчанию для виртуальных устройств для 64 каждого устройства (например сети и назначенные устройства)|8.3|
|Разрешить функции дополнительный процессор для системного монитора|9.0|
|Автоматически предоставлять [одновременных многопоточности](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types#background) конфигурацию для виртуальных машин, работающих на узлах с помощью [Core планировщика](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/manage-hyper-v-scheduler-types#windows-server-2019-hyper-v-defaults-to-using-the-core-scheduler)|9.0|
|Поддержка спящего режима|9.0|

Дополнительные сведения об этих функциях см. в разделе [новые возможности в Hyper-V в Windows Server](../What-s-new-in-Hyper-V-on-Windows.md).

