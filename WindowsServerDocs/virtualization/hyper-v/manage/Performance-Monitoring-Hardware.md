---
title: Включение оборудования мониторинга производительности Intel на виртуальной машине Hyper-V
description: Как включить аппаратное обеспечение мониторинга производительности Intel на компьютере Hyper-V. Также касается того, как включить мониторинг производительности аппаратных эффектов динамической миграции.
ms.prod: windows-server-threshold
ms.reviewer: ifufondu
author: ifeomaufondu-ms
ms.author: ifufondu
manager: chhuybre
ms.topic: article
ms.date: 09/20/2019
ms.openlocfilehash: 67f32a6e2ceeaf07701d558f473e2f997fbd8219
ms.sourcegitcommit: d12d9e6afd71d23e8a24682ad80d2cf3bc486588
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2019
ms.locfileid: "71226029"
---
# <a name="enable-intel-performance-monitoring-hardware-in-a-hyper-v-virtual-machine"></a>Включение оборудования мониторинга производительности Intel на виртуальной машине Hyper-V

Процессоры Intel содержат функции, которые совместно называются оборудованием мониторинга производительности (например, ПМУ, ПЕБС, ЛБР). Эти функции используются программным обеспечением для настройки производительности, например Intel VTune, для анализа производительности программного обеспечения.  До Windows Server 2019 и Windows 10 версии 1809 ни операционная система узла, ни Гостевые виртуальные машины Hyper-V не могли использовать оборудование мониторинга производительности при включении Hyper-V.  Начиная с Windows Server 2019 и Windows 10 версии 1809, операционная система узла по умолчанию имеет доступ к оборудованию мониторинга производительности.  Гостевые виртуальные машины Hyper-V по умолчанию не имеют доступа, но администраторы Hyper-V могут предоставить доступ к одной или нескольким гостевым виртуальным машинам.  В этом документе описаны шаги, необходимые для обеспечения мониторинга производительности на гостевых виртуальных машинах.

## <a name="requirements"></a>Требования

Чтобы включить мониторинг производительности на виртуальной машине, вам потребуется:

- Процессор Intel с оборудованием мониторинга производительности (например, ПМУ, ПЕБС, скрип)
- Windows Server 2019 или Windows 10 версии 1809 (обновление за Октябрь 2018) или более поздняя версия
- Виртуальная машина Hyper-V _без_ [вложенной виртуализации](https://docs.microsoft.com/virtualization/hyper-v-on-windows/user-guide/nested-virtualization) , которая также находится в остановленном состоянии
 
## <a name="enabling-performance-monitoring-components-in-a-virtual-machine"></a>Включение компонентов наблюдения за производительностью в виртуальной машине

Чтобы включить различные компоненты наблюдения за производительностью для конкретной гостевой виртуальной машины, используйте `Set-VMProcessor` командлет PowerShell:
 
``` Powershell
# Enable all components
Set-VMProcessor MyVMName -Perfmon @("pmu", "lbr", "pebs")
```
 
``` Powershell
# Enable a specific component
Set-VMProcessor MyVMName -Perfmon @("pmu")
```
 
``` Powershell
# Disable all components
Set-VMProcessor MyVMName -Perfmon @()
```
> [!NOTE]
> При включении компонентов наблюдения за производительностью `"pebs"` , если указан `"pmu"` , необходимо указать.  Кроме того, включение компонента, который не поддерживается физическими процессорами узла, приведет к сбою запуска виртуальной машины.
 
## <a name="effects-of-enabling-performance-monitoring-hardware-on-saverestore-export-and-live-migration"></a>Влияние включения оборудования мониторинга производительности при сохранении, восстановлении, экспорте и динамической миграции
 
Корпорация Майкрософт не рекомендует выполнять динамическую миграцию и сохранение и восстановление виртуальных машин с аппаратным обеспечением мониторинга производительности между системами с различным оборудованием Intel. Особое поведение оборудования мониторинга производительности часто является неархитектурным и отличается от изменений между системами оборудования Intel.  Перемещение работающей виртуальной машины между разными системами может привести к непредсказуемому поведению счетчиков, не являющихся архитектурными.