---
title: Предоставление оборудования мониторинга производительности Intel виртуальной машине Hyper-V
description: Описывает о том, как предоставить оборудование Intel Performance Мониторнинг компьютеру Hyper-V. Также касается применения эффектов включения динамической миграции.
ms.prod: windows-server-threshold
ms.reviewer: ifufondu
author: ifeomaufondu-ms
ms.author: ifufondu
manager: chhuybre
ms.topic: article
ms.date: 09/20/2019
ms.openlocfilehash: 1bc821cc46a3a402778e1c76f4a2d8feb862fd75
ms.sourcegitcommit: 45415ba58907d650cfda45f4c57f6ddf1255dcbf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2019
ms.locfileid: "71213620"
---
# <a name="exposing-intel-performance-monitoring-hardware-to-a-hyper-v-virtual-machine"></a>Предоставление оборудования мониторинга производительности Intel виртуальной машине Hyper-V
 
## <a name="background"></a>Фон
Процессоры Intel содержат функции, которые совместно называются оборудованием мониторинга производительности (например, ПМУ, ПЕБС, ЛБР). Эти функции используются программным обеспечением для настройки производительности, например Intel VTune, для анализа производительности программного обеспечения.  До Windows Server 2019 и Windows 10 версии 1809 ни операционная система узла, ни Гостевые виртуальные машины Hyper-V не могли использовать оборудование мониторинга производительности при включении Hyper-V.  Начиная с Windows Server 2019 и Windows 10 версии 1809, операционная система узла по умолчанию имеет доступ к оборудованию мониторинга производительности.  Гостевые виртуальные машины Hyper-V по умолчанию не имеют доступа, но администраторы Hyper-V могут предоставить доступ к одной или нескольким гостевым виртуальным машинам.  В этом документе описаны шаги, необходимые для обеспечения мониторинга производительности на гостевых виртуальных машинах.
 
## <a name="requirements"></a>Требования 
Чтобы предоставить оборудование для мониторинга производительности в виртуальной машине, вам потребуется:
- Процессор Intel с оборудованием мониторинга производительности (например, ПМУ, ПЕБС, скрип)
- Windows Server 2019 или Windows 10 версии 1809 (обновление за Октябрь 2018) или более поздняя версия
- Виртуальная машина Hyper-V _без_ [вложенной виртуализации](https://docs.microsoft.com/virtualization/hyper-v-on-windows/user-guide/nested-virtualization) , которая находится в остановленном состоянии
 
## <a name="exposing-the-pmu-capabilities-pmu-lbr-pebs-to-virtual-machines-via-powershells-set-vmprocessor-cmdlet"></a>Предоставление возможностей ПМУ (ПМУ, ЛБР, ПЕБС) виртуальным машинам с помощью командлета Set-Вмпроцессор в PowerShell
Чтобы включить различные компоненты наблюдения за производительностью для конкретной гостевой виртуальной машины, используйте `Set-VMProcessor` командлет PowerShell:
 
``` Powershell
# Enable all components
Set-VMProcessor MyVMName -Perfmon @("pmu", "lbr", "pebs")
```
 
``` Powershell
# Enable a specific component
Set-VMProcessor MyVMName -Perfmon @("pmu")
```
 
``` Powershell
# Disable all components
Set-VMProcessor MyVMName -Perfmon @()
```
 
>Примечание. При включении компонентов PerfMon, если `"pebs"` указан `"pmu"` , необходимо указать.  Кроме того, включение компонента PerfMon, не поддерживаемого физическими процессорами узла, приведет к сбою при запуске виртуальной машины.
 
## <a name="effect-of-pmu-enabelement-on-saverestore-export-and-live-migration"></a>Воздействие ПМУ енабелемент на сохранение, восстановление, экспорт и динамическую миграцию
 
Корпорация Майкрософт не рекомендует выполнять динамическую миграцию и сохранение и восстановление виртуальных машин с аппаратным обеспечением мониторинга производительности между системами с различным оборудованием Intel. Особое поведение оборудования мониторинга производительности часто является неархитектурным и отличается от изменений между системами оборудования Intel.  Перемещение работающей виртуальной машины между разными системами может привести к непредсказуемому поведению счетчиков, не являющихся архитектурными.