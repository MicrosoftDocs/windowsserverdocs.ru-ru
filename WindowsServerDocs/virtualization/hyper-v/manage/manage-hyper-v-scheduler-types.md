---
title: Понимание и использование типов планировщика низкоуровневой оболочки Hyper-V
description: Предоставляет сведения для администраторов узла Hyper-V на использование Hyper-V планировщика режимы
author: allenma
ms.author: allenma
ms.date: 08/14/2018
ms.topic: article
ms.prod: windows-server-hyper-v
ms.technology: virtualization
ms.localizationpriority: low
ms.assetid: 6cb13f84-cb50-4e60-a685-54f67c9146be
ms.openlocfilehash: c0c2f85fbbeca9e8ac5d40bbcb71f286fabfb65c
ms.sourcegitcommit: cd12ace92e7251daaa4e9fabf1d8418632879d38
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66501673"
---
# <a name="managing-hyper-v-hypervisor-scheduler-types"></a>Управление типами планировщика низкоуровневой оболочки Hyper-V

>Область применения. Windows 10, Windows Server 2016, Windows Server версии 1709, Windows Server версии 1803, Windows Server 2019

В этой статье описывается новых режимов виртуального процессора, планирование логики, впервые представленный в Windows Server 2016. Эти режимы или типы планировщика, определить выделяет низкоуровневой оболочки Hyper-V и управляет работой между гостевой виртуальными процессорами. Администратором узла Hyper-V можно выбрать типы планировщика низкоуровневой оболочки, которые лучше всего подходят для гостевых виртуальных машин (ВМ) и настройка виртуальных машин, чтобы воспользоваться преимуществами логики планирования.

>[!NOTE]
>Чтобы использовать возможности планировщика низкоуровневой оболочки, описанные в этом документе необходимы обновления. Дополнительные сведения см. в разделе [обязательные обновления](#required-updates).

## <a name="background"></a>Фон

Прежде чем обсуждать логику и элементы управления за Hyper-V использования виртуального процессора, полезно изучить основные понятия, описанные в этой статье.

### <a name="understanding-smt"></a>Основные сведения о SMT

Одновременные многопоточность или SMT, методика использования в проектах современный процессор, позволяющий ресурсов процессора для совместного использования потоков выполнения отдельные, независимые. SMT обычно предлагает boost незначительный рост производительности для большинства рабочих нагрузок за счет параллелизации вычислений по возможности увеличить пропускную способность инструкции, хотя производительность не получить или даже небольшая потери производительности может возникнуть при конкуренции между потоков для происходит общий процессор ресурсов.
С поддержкой SMT доступны AMD и Intel. Intel ссылается на свои предложения SMT, как технологии Hyper Threading Intel или Intel HT.

Для целей этой статьи описания SMT и как она используется технологией Hyper-V также применяются к системам Intel и AMD.

* Дополнительные сведения о технологии HT Intel, см. [технологии Intel Hyper-Threading](https://www.intel.com/content/www/us/en/architecture-and-technology/hyper-threading/hyper-threading-technology.html)

* Дополнительные сведения о AMD SMT, см. [«Zen» базовая архитектура](https://www.amd.com/en/technologies/zen-core)

## <a name="understanding-how-hyper-v-virtualizes-processors"></a>Основные сведения о том, как Hyper-V виртуализирует процессоров

Прежде чем низкоуровневая оболочка типы планировщика, это также полезно понимать архитектуру Hyper-V. Можно найти в Общая Сводка [Общие сведения о технологии Hyper-V](https://docs.microsoft.com/windows-server/virtualization/hyper-v/hyper-v-technology-overview). Ниже перечислены важные понятия в этой статье.

* Hyper-V создает и управляет секциями виртуальной машины, на какие вычислительные ресурсы выделенных и совместно, в системе управления гипервизора. Разделы обеспечивают четких границ между всех гостевых виртуальных машин, а также между гостевых виртуальных машин и корневой раздел.

* Корневой раздел является секции виртуальную машину, несмотря на то, что она имеет уникальные свойства и гораздо больше полномочий, чем гостевых виртуальных машин. Корневой раздел предоставляет услуги по управлению, которые управляют все гостевые виртуальные машины, поддерживает виртуальное устройство для гостевых систем и управляет всем устройством ввода-вывода для гостевых виртуальных машин. Корпорация Майкрософт настоятельно рекомендует не под управлением любой рабочей нагрузки приложения в корневом разделе.

* Каждый виртуальный процессор (VP) корневой раздел является сопоставленные 1:1 для базовой логический процессор (LP). Вице-Президент ведущее приложение будет всегда выполняться на том же базового LP: в нем нет миграции вице-президенты корневой раздел.

* По умолчанию LPs, на которых запущены вице-президенты узла можно также запустить вице-президенты гостя.

* Вице-Президентом гостевой может быть запланирован низкоуровневой оболочкой для запуска на любой доступных логический процессор. Хотя необходимо учитывать расположение временного кэша, топология NUMA и множество других факторов при планировании вице-Президентом гостевой берет на себя планировщик низкоуровневой оболочки, в конечном счете вице-Президент могут планироваться на любом узле LP.

## <a name="hypervisor-scheduler-types"></a>Типы планировщика низкоуровневой оболочки

Начиная с Windows Server 2016, низкоуровневая оболочка Hyper-V поддерживает несколько режимов логики планировщика, которые определяют, как низкоуровневая оболочка назначает виртуальных процессоров на базовых логических процессоров. Ниже приведены эти типы планировщика.

- [Планировщик классической, удовлетворительные share](#the-classic-scheduler)
- [Планировщик core](#the-core-scheduler)
- [Корневой планировщика](#the-root-scheduler)

### <a name="the-classic-scheduler"></a>Классический планировщика

Классический планировщика был по умолчанию для всех версий гипервизор Windows Hyper-V с момента ее создания, включая Windows Server 2016 Hyper-V. Классический планировщик предоставляет долевого модель планирования вытеснением циклический перебор для гостевых виртуальных процессоров.

Тип планировщика классический лучше всего подходит для подавляющего большинства традиционного использования Hyper-V — для частных облаков, поставщиков услуг размещения и т. д. Характеристики производительности хорошо понятны и лучше всего оптимизированы для поддержки широкий спектр сценариев виртуализации, таких как превышение подписки из вице-президенты, чтобы LPs, одновременно выполняющихся многих разнородных виртуальных машин и рабочих нагрузок, запуска большего масштаба высокого уровня производительность виртуальных машин, которые поддерживают функцию полного набора Hyper-V без ограничений и многое другое.

### <a name="the-core-scheduler"></a>Планировщик core

Планировщик core низкоуровневой оболочки — это новая альтернатива в классическом планировщика логику, появившихся в Windows Server 2016 и Windows 10 версии 1607. Планировщик core предлагает надежную защиту границы изоляции гостевой рабочей нагрузки и вариативность снижение производительности для рабочих нагрузок внутри виртуальных машин, работающих на узле виртуализации с поддержкой SMT. Планировщик core позволяет SMT и не SMT виртуальных машинах одновременно на одном узле виртуализации с поддержкой SMT.

Планировщик core использует SMT топологии узла виртуализации и при необходимости предоставляет пары SMT для гостевых виртуальных машин и групп расписаний гостевой виртуальных процессоров из той же виртуальной машине на группы SMT логических процессоров. Это делается симметрично, чтобы если LPs находятся в группы из двух, вице-президенты запланированы в двух группах, а базовая никогда не передается между виртуальными машинами.
Когда вице-Президент запланировано для виртуальной машины без SMT включена, вице-Президент будет потребляемых всей основной момент, когда он выполняется.

Общий результат планировщика core это:

* Вице-президенты гостевой ограничены для запуска базового физического ядра пары, изолируя виртуальную Машину, чтобы процессор core границы, что уменьшает уязвимость для атак по сторонним каналам от вредоносных виртуальных машин.

* Вариативность в пропускной способности используется значительно реже.

* Производительность потенциально снижается, поскольку если только группы вице-президенты можно запускать, только один из потоков инструкций в основном выполняется, пока другой не используется.

* ОС и приложений, работающих в гостевой виртуальной машины можно использовать поведение SMT и программные интерфейсы (API) для контроля и распределения работы между SMT-потока, так же, как и когда без виртуализации.

* Границы надежную защиту для изоляции рабочей нагрузки гостевого - вице-президенты гостевой ограничены для запуска на базовой пары физическое ядро, уменьшить уязвимость для атак по сторонним каналам.

Планировщик core будет использоваться по умолчанию, начиная с Windows Server 2019. В Windows Server 2016 core планировщика является необязательным и должен явно включить администратор узла Hyper-V и классическом планировщик по умолчанию.

#### <a name="core-scheduler-behavior-with-host-smt-disabled"></a>Основное поведение планировщика с узлом SMT отключена

Если низкоуровневая оболочка настроен для использования планировщика основного типа, но возможность SMT отключено или отсутствует на узле виртуализации, низкоуровневая оболочка будет использовать поведение классической планировщика, независимо от параметров типа планировщика низкоуровневой оболочки.

### <a name="the-root-scheduler"></a>Корневой планировщика

Планировщик корневой впервые появилась в Windows 10 версии 1803. При включении корневой тип планировщика, низкоуровневая оболочка cedes управления планирования работы в корневой раздел. Планировщик в корневом разделе экземпляр ОС NT управляет всеми аспектами планирования работы систему LPs.

Планировщик корневого адреса уникальными требованиями, присущие с поддержкой раздел служебной программы для изоляции строгого рабочей нагрузки, как использовать с Windows Defender Application Guard (WDAG). В этом сценарии оставляя планирования обязанности в корневой каталог операционной системы предоставляет ряд преимуществ. Например можно применять в сценариях, контейнер элементов управления ресурсами ЦП с секцией служебной программы, что упрощает управление и развертывание. Кроме того планировщик ОС корневого можно легко собирать метрики о рабочей нагрузке ЦП внутри контейнера и использовать эти данные в качестве входных данных для одной планирования политики, применимые для всех других рабочих нагрузок в системе. Эти же метрики также помогают очевидно, что работа выполняется в контейнере приложения в системе узла атрибута. Отслеживание этих метрик является более сложной, с помощью традиционных рабочих нагрузок виртуальных машин, где некоторую работу от имени всех работающим виртуальным Машинам происходит в корневом разделе.

#### <a name="root-scheduler-use-on-client-systems"></a>Использование планировщика корневой в клиентских системах

Начиная с Windows 10 версии 1803, корневой планировщик по умолчанию используется клиента только в системах, где может включаться низкоуровневой оболочки для поддержки безопасности на основе виртуализации и изоляции WDAG рабочей нагрузки, а также для правильной работы будущих систем с core разнородных архитектур. Это конфигурация планировщика только поддерживаемой низкоуровневой оболочке для клиентских систем. Администраторы не следует пытаться переопределить тип планировщика низкоуровневой оболочки по умолчанию в Windows 10 клиентских системах.

#### <a name="virtual-machine-cpu-resource-controls-and-the-root-scheduler"></a>Элементы управления ресурсами ЦП виртуальной машины и корневой планировщика

Элементы управления ресурсами процессора виртуальной машины, предоставляемые Hyper-V не поддерживаются при включении планировщик корневой низкоуровневой оболочки как логики планировщика корневой операционной системы управление ресурсами узла на основе глобальной и не имеет сведений виртуальной машины определенные настройки. Hyper-V каждой виртуальной Машины процессора управления ресурсами, например caps, весовые коэффициенты и резервирует, применяются только там, где гипервизор управляет непосредственно вице-Президент, планирования, например с помощью классической модели развертывания и основные типы планировщика.

#### <a name="root-scheduler-use-on-server-systems"></a>Использование планировщика корневой в серверных системах

Планировщик корневой не рекомендуется для использования с Hyper-V на серверах в настоящее время, как его характеристик производительности еще не были полностью характеризуется тем и настроены так, чтобы вместить широкий спектр рабочих нагрузок, типичные для многих развертываний виртуализации сервера.

## <a name="enabling-smt-in-guest-virtual-machines"></a>Включение SMT в гостевых виртуальных машин

После настройки узла виртуализации гипервизора для использования типа планировщика core гостевых виртуальных машин может настроить использование SMT, при необходимости. Предоставление тот факт, что вице-президенты, технологией Hyper-Threading на гостевой виртуальной машине позволяет планировщик в гостевой операционной системы и рабочих нагрузок, выполняющихся на виртуальной Машине и обнаруживать и использовать топологию SMT в свои собственные планирование работы. В Windows Server 2016 гостевой SMT по умолчанию не настроен и необходимо явно включить администратор узла Hyper-V. Начиная с Windows Server 2019, новых виртуальных машин, созданных на узле будет наследовать SMT топологии узла по умолчанию.  То есть версия 9.0 виртуальной Машины, созданной на узле 2 SMT-потока на ядро бы также см. в разделе 2 SMT-потока на ядро.

Необходимо использовать PowerShell для включения SMT на гостевой виртуальной машине; Нет не пользовательский интерфейс, предоставляемый в диспетчере Hyper-V.
Чтобы включить SMT на гостевой виртуальной машине, откройте окно PowerShell с достаточные разрешения и введите:

``` powershell
Set-VMProcessor -VMName <VMName> -HwThreadCountPerCore <n>
```

Где <n> — это количество SMT-потока на ядро гостевой виртуальной Машины будет см. в разделе.  
Обратите внимание, что <n> = 0 задаст значение HwThreadCountPerCore для сопоставления узла число потоков SMT на ценностях.

>[!NOTE] 
>Параметр HwThreadCountPerCore = 0 поддерживается, начиная с Windows Server 2019.

Ниже приведен пример системных сведений, полученных из гостевой ОС на виртуальной машине с 2 виртуальными процессорами и поддержкой SMT. Гостевая операционная система обнаруживает 2 логических процессоров, принадлежащих того же ядра.

![Снимок экрана, показывающий msinfo32 в гостевой виртуальной Машине с поддержкой SMT](media/Hyper-V-CoreScheduler-VM-Msinfo32.png)

## <a name="configuring-the-hypervisor-scheduler-type-on-windows-server-2016-hyper-v"></a>Настройка планировщика тип низкоуровневой оболочки на Windows Server 2016 Hyper-V

Windows Server 2016 Hyper-V использует модель планировщика классический низкоуровневой оболочки по умолчанию. Низкоуровневая оболочка можно также настроить для использования планировщика core, чтобы повысить безопасность за счет ограничения вице-президенты гостя для запуска на соответствующих физических пары SMT и поддерживать использование виртуальных машин с SMT планирования для их вице-президенты гостевой.

>[!NOTE]
>Корпорация Майкрософт рекомендует, что все клиенты под управлением Windows Server 2016 Hyper-V выберите планировщика core, чтобы убедиться, что их узлов виртуализации, оптимально защищены от потенциально вредоносных гостевых виртуальных машин.

## <a name="windows-server-2019-hyper-v-defaults-to-using-the-core-scheduler"></a>По умолчанию — Windows Server 2019 Hyper-V с помощью планировщика core

Чтобы убедиться, что в конфигурации оптимальной безопасности развертываются узлы Hyper-V, Windows Server 2019 Hyper-V теперь будут использовать ее основной моделью планировщика низкоуровневой оболочки по умолчанию. Администратор узла может при необходимости настроить узел для использования устаревший классический планировщика. Администраторы должны тщательно чтение, понимать и учитывать изменение, у каждого типа планировщика о безопасности и производительности узлов виртуализации до переопределение параметров по умолчанию тип планировщика.  См. в разделе [Выбор типа основные сведения о Hyper-V планировщика](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/understanding-hyper-v-scheduler-type-selection) Дополнительные сведения.

### <a name="required-updates"></a>Необходимые обновления

>[!NOTE]
>Следующие обновления необходимы для использования функций планировщика низкоуровневой оболочки, описанные в этом документе. Эти обновления содержат изменения для поддержки новый параметр BCD «hypervisorschedulertype», который необходим для настройки узла.

| Version | Выпуск  | Требуется обновление | Статья базы Знаний |
|--------------------|------|---------|-------------:|
|Windows Server 2016 | 1607 | 2018.07 C | [KB4338822](https://support.microsoft.com/help/4338822/windows-10-update-kb4338822) |
|Windows Server 2016 | 1703 | 2018.07 C | [KB4338827](https://support.microsoft.com/help/4338827/windows-10-update-kb4338827) |
|Windows Server 2016 | 1709 | 2018.07 C | [KB4338817](https://support.microsoft.com/help/4338817/windows-10-update-kb4338817) |
|Windows Server 2019 | 1804 | Нет | Нет |

## <a name="selecting-the-hypervisor-scheduler-type-on-windows-server"></a>Выбрав тип планировщика низкоуровневой оболочки в Windows Server

Конфигурация планировщика низкоуровневой оболочки, контролируется с помощью hypervisorschedulertype запись BCD.

Чтобы выбрать тип планировщика, откройте командную строку с правами администратора:

``` command
     bcdedit /set hypervisorschedulertype type
```

Где `type` является одним из:

* Классическая
* Базовая
* Корень

Тип планировщика низкоуровневой оболочки вступили в силу любых изменений необходимо выполнить перезагрузку системы.

>[!NOTE]
>В настоящее время планировщик корневой низкоуровневой оболочки не поддерживается в Windows Server Hyper-V. Администраторы Hyper-V не следует пытаться настроить планировщик корневой для использования в сценариях виртуализации сервера.

## <a name="determining-the-current-scheduler-type"></a>Определение типа текущего планировщика

Можно определить текущий тип планировщика низкоуровневой оболочки используется путем проверки в системном журнале в средстве просмотра событий для последнего события запуска низкоуровневой оболочки идентификатор 2, которая сообщает тип планировщика низкоуровневой оболочки, настроенные на запуск гипервизора. События запуска низкоуровневой оболочки можно получить из средства просмотра событий Windows или с помощью PowerShell.

Мероприятие, посвященное запуску низкоуровневой оболочки Идентификатором 2 обозначает тип планировщика низкоуровневой оболочки, где:

    1 = Classic scheduler, SMT disabled

    2 = Classic scheduler

    3 = Core scheduler

    4 = Root scheduler

![Подробные сведения о событии 2 идентификатор запуска низкоуровневой оболочки снимок экрана:](media/Hyper-V-CoreScheduler-EventID2-Details.png)

![Снимок экрана средства просмотра событий, отображение мероприятие, посвященное запуску низкоуровневой оболочки Идентификатором 2](media/Hyper-V-CoreScheduler-EventViewer.png)

### <a name="querying-the-hyper-v-hypervisor-scheduler-type-launch-event-using-powershell"></a>Запросы событий Hyper-V низкоуровневая оболочка планировщика тип запуска, с помощью PowerShell

Запрос события низкоуровневой оболочки идентификатор 2 с помощью PowerShell, введите следующие команды в командной строке PowerShell.

``` powershell
Get-WinEvent -FilterHashTable @{ProviderName="Microsoft-Windows-Hyper-V-Hypervisor"; ID=2} -MaxEvents 1
```

![Снимок экрана PowerShell запросов и результаты для низкоуровневой оболочки мероприятие, посвященное запуску Идентификатором 2](media/Hyper-V-CoreScheduler-PowerShell.png)
