---
title: О шифровании дампа
description: Описывает шифрование файлов дампа и устранение неполадок шифрования.
ms.prod: windows-server-threshold
manager: dongill
ms.topic: article
author: larsiwer
ms.asset: b78ab493-e7c3-41f5-ab36-29397f086f32
ms.author: kathydav
ms.date: 11/03/2016
ms.openlocfilehash: d46deee7fc9d911de2a6ee44ae097affe1d658a3
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70872141"
---
# <a name="about-dump-encryption"></a>О шифровании дампа
Шифрование дампа можно использовать для шифрования аварийных дампов и динамических дампов, созданных для системы. Дампы шифруются с помощью симметричного ключа шифрования, который создается для каждого дампа. Затем сам ключ шифруется с помощью открытого ключа, заданного доверенным администратором узла (предохранитель ключа шифрования аварийного дампа). Это гарантирует, что только кто-то, у которого есть соответствующий закрытый ключ, сможет расшифровывать и, следовательно, получать доступ к содержимому дампа. Эта возможность используется в защищенной структуре.
Примечание. При настройке шифрования дампа также отключите отчеты об ошибках Windows. WER не может читать зашифрованные аварийные дампы.

# <a name="configuring-dump-encryption"></a>Настройка шифрования дампа
## <a name="manual-configuration"></a>Ручная настройка
Чтобы включить шифрование дампа с помощью реестра, настройте следующие параметры реестра в разделе`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl`

| Имя значения | Type | Значение |
| ---------- | ---- | ----- |
| думпенкриптионенаблед | DWORD | 1 для включения шифрования дампа, 0 для отключения шифрования дампа |
| EncryptionCertificates\Certificate.1::P Убликкэй | Binary | Открытый ключ (RSA, 2048 бит/с), который следует использовать для шифрования дампов. Его необходимо отформатировать как [BCRYPT_RSAKEY_BLOB](https://msdn.microsoft.com/library/windows/desktop/aa375531(v=vs.85).aspx). |
| EncryptionCertificates\Certificate.1:: Thumbprint | Строка | Отпечаток сертификата, чтобы разрешить автоматический поиск закрытого ключа в локальном хранилище сертификатов при расшифровке аварийного дампа. |


## <a name="configuration-using-script"></a>Настройка с помощью скрипта
Чтобы упростить настройку, доступен [Пример скрипта](https://github.com/Microsoft/Virtualization-Documentation/tree/live/hyperv-tools/DumpEncryption) , позволяющий включить шифрование дампа на основе открытого ключа из сертификата.

1. В доверенной среде: Создайте сертификат с 2048-битным ключом RSA и экспортируйте открытый сертификат.
2. На целевых узлах: Импорт общедоступного сертификата в локальное хранилище сертификатов
3. Запуск примера скрипта конфигурации 
    ```
    .\Set-DumpEncryptionConfiguration.ps1 -Certificate (Cert:\CurrentUser\My\093568AB328DF385544FAFD57EE53D73EFAAF519) -Force
    ```

# <a name="decrypting-encrypted-dumps"></a>Расшифровка зашифрованных дампов
Чтобы расшифровать существующий зашифрованный файл дампа, необходимо скачать и установить средства отладки для Windows. Этот набор инструментов содержит Кернелдумпдекрипт. exe, который можно использовать для расшифровки зашифрованного файла дампа.
Если сертификат, включающий закрытый ключ, имеется в хранилище сертификатов текущего пользователя, файл дампа можно расшифровать путем вызова метода

```
    KernelDumpDecrypt.exe memory.dmp memory_decr.dmp
```
После расшифровки такие средства, как WinDbg, могут открыть расшифрованный файл дампа.

# <a name="troubleshooting-dump-encryption"></a>Устранение неполадок шифрования дампа
Если шифрование дампа включено в системе, но дампы не создаются, проверьте журнал `System` событий системы на наличие `Kernel-IO` события 1207. Если не удается инициализировать шифрование дампа, это событие создается, а дампы отключаются.

| Подробное сообщение об ошибке | Действия по устранению проблемы |
| ---------------------- | ----------------- |
| Отсутствует реестр открытого ключа или отпечатков | Проверьте, существуют ли в ожидаемом расположении оба значения реестра. |
| Недопустимый открытый ключ | Убедитесь, что открытый ключ, хранящийся в значении реестра PublicKey, хранится в виде [BCRYPT_RSAKEY_BLOB](https://msdn.microsoft.com/library/windows/desktop/aa375531(v=vs.85).aspx). |
| Неподдерживаемый размер открытого ключа | В настоящее время поддерживаются только 2048 разрядных ключа RSA. Настройка ключа, соответствующего этому требованию |

Также проверьте, установлено ли `GuardedHost` значение `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl\ForceDumpsDisabled` , отличное от 0. Это приведет к полному отключению аварийных дампов. Если это так, задайте для него значение 0.
