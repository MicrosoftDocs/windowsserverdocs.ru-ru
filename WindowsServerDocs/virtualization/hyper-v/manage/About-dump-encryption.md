---
title: О шифровании дампа
description: Описывает, как для шифрования файлов дампа и устранение неполадок шифрования.
ms.prod: windows-server-threshold
manager: dongill
ms.topic: article
author: larsiwer
ms.asset: b78ab493-e7c3-41f5-ab36-29397f086f32
ms.author: kathydav
ms.date: 11/03/2016
ms.openlocfilehash: e0ca8829aa8f93e7543b4183539beade3b4aeb47
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59812395"
---
# <a name="about-dump-encryption"></a>О шифровании дампа
Шифрование дампов можно использовать для шифрования аварийные дампы и динамической дампов, созданные для системы. Дампы, шифруются с помощью симметричного ключа шифрования, созданный для каждого дампа. Сам этот ключ шифруется с помощью открытого ключа, указанного администратором доверенного узла (аварийных дампов Защитник ключа шифрования). Это гарантирует, что только пользователь, соответствующий закрытый ключ расшифровки и таким образом получить доступ к содержимому дампа. Эта возможность используется в защищенной структуре.
Примечание. Если вы настраиваете шифрование дампов, также отключите отчеты об ошибках Windows. Отчеты об ошибках Windows не удается прочитать зашифрованные аварийных дампов.

# <a name="configuring-dump-encryption"></a>Настройка шифрования дампа
## <a name="manual-configuration"></a>Ручная настройка
Чтобы включить шифрование дампов с помощью реестра, настройте следующие значения реестра в разделе `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl`

| Имя значения | Тип | Значение |
| ---------- | ---- | ----- |
| DumpEncryptionEnabled | DWORD | 1, чтобы включить шифрование дампов, 0, чтобы отключить шифрование дампов |
| EncryptionCertificates\Certificate.1::PublicKey | Бинарный | Открытый ключ (RSA, 2048 бит), следует использовать для шифрования дампов. Это должно быть в формате [BCRYPT_RSAKEY_BLOB](https://msdn.microsoft.com/library/windows/desktop/aa375531(v=vs.85).aspx). |
| EncryptionCertificates\Certificate.1::Thumbprint | Строка | Отпечаток сертификата, чтобы разрешить автоматический поиск закрытого ключа в локальном хранилище сертификатов при расшифровке аварийного дампа. |


## <a name="configuration-using-script"></a>С помощью сценария конфигурации
Для упрощения настройки, [пример сценария](https://github.com/Microsoft/Virtualization-Documentation/tree/live/hyperv-tools/DumpEncryption) можно включить шифрование дампов, на основе открытого ключа из сертификата.

1. В доверенной среде: Создайте сертификат с ключом RSA 2048 бит и экспортировать сертификат открытого
2. На узле назначения: Импорт открытого сертификата в локальном хранилище сертификатов
3. Запустите сценарий настройки образца 
    ```
    .\Set-DumpEncryptionConfiguration.ps1 -Certificate (Cert:\CurrentUser\My\093568AB328DF385544FAFD57EE53D73EFAAF519) -Force
    ```

# <a name="decrypting-encrypted-dumps"></a>Расшифровка зашифрованных дампы
Чтобы расшифровать существующий файл дампа зашифрованные, необходимо загрузить и установить средства отладки для Windows. Этот набор средств содержит KernelDumpDecrypt.exe который может использоваться для расшифровки зашифрованных дампа файла.
Если сертификат, включая закрытый ключ присутствует в хранилище сертификатов текущего пользователя, путем вызова могут быть расшифрованы файла дампа

```
    KernelDumpDecrypt.exe memory.dmp memory_decr.dmp
```
После расшифровки таких средств, как WinDbg можно открыть файл расшифрованный дампа.

# <a name="troubleshooting-dump-encryption"></a>Устранение неполадок шифрования дампа
Если шифрование дампа в системе, но не файлы дампа создаются, проверьте системы `System` журнал событий на наличие `Kernel-IO` 1207 событий. Когда не удается инициализировать шифрование дампов, это событие создается, и дампы будут отключены.

| Подробное сообщение об ошибке | Шаги по уменьшению риска |
| ---------------------- | ----------------- |
| Открытый ключ или отпечаток реестра отсутствует | Проверьте, если оба значения реестра существует в ожидаемом расположении |
| Недопустимый открытый ключ | Убедитесь, что открытый ключ, хранящийся в значении реестра открытый ключ хранится как [BCRYPT_RSAKEY_BLOB](https://msdn.microsoft.com/library/windows/desktop/aa375531(v=vs.85).aspx). |
| Неподдерживаемый размер открытого ключа | В настоящее время поддерживаются только ключи RSA 2048 бит. Настроить ключ, соответствующий этому требованию |

Проверьте также, если значение `GuardedHost` под `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl\ForceDumpsDisabled` присваивается значение, отличное от 0. Это полностью отключает аварийных дампов. Если это так, присвойте ей значение 0.
