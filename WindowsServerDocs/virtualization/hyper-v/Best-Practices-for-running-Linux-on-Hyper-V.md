---
title: Рекомендации по использованию Linux на Hyper-V
description: Рекомендации по использованию Linux на виртуальной машине
ms.prod: windows-server-threshold
ms.service: na
manager: dongill
ms.technology: compute-hyper-v
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: a08648eb-eea0-4e2b-87fb-52bfe8953491
author: shirgall
ms.author: kathydav
ms.date: 3/1/2019
ms.openlocfilehash: 190a5e5d32140d6fa688bb9de98d05ec2f9783c3
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59838685"
---
# <a name="best-practices-for-running-linux-on-hyper-v"></a>Рекомендации по использованию Linux на Hyper-V

>Область применения. Windows Server 2019, Windows Server 2016, Hyper-V Server 2016, Windows Server 2012 R2, Hyper-V Server 2012 R2, Windows Server 2012, Hyper-V Server 2012, Windows Server 2008 R2, Windows 10, Windows 8.1, Windows 8, Windows 7.1, Windows 7

В этом разделе содержится список рекомендаций по запуску виртуальной машины Linux в Hyper-V.

## <a name="tuning-linux-file-systems-on-dynamic-vhdx-files"></a>Настройки Linux файловые системы на динамических vhdx-файлы

Некоторые файловые системы Linux может потреблять значительный объем места на диске реальных, даже при отсутствии файловой системы. Чтобы сократить объем использования места на диске реальных динамических vhdx-файлов, учитывайте следующие рекомендации:

* При создании VHDX, используйте 1 BlockSizeBytes МБ (по умолчанию 32 МБ) в PowerShell, например:

```Powershell
PS > New-VHD -Path C:\MyVHDs\test.vhdx -SizeBytes 127GB -Dynamic -BlockSizeBytes 1MB
```

* Формат ext4 предпочтительнее ext3, поскольку ext4 является более требовательны к пространству чем ext3, при использовании динамических файлах VHDX.

* Когда создание файловой системы указать количество групп, чтобы быть 4096, например:

```bash
# mkfs.ext4 -G 4096 /dev/sdX1

```

## <a name="grub-menu-timeout-on-generation-2-virtual-machines"></a>Время ожидания меню GRUB на виртуальных машинах поколения 2

Из-за устаревшее оборудование, удаляемого из эмуляции в виртуальных машинах поколения 2 таймер обратного отсчета меню grub отсчитывает слишком быстро для меню grub для отображения, сразу же загрузка запись по умолчанию. До устранения grub для использования таймера поддерживается EFI, измените **/boot/grub/grub.conf**, /**д/по умолчанию/grub**, или эквивалентных иметь «время ожидания = 100000» вместо значения по умолчанию «время ожидания = 5".

## <a name="pxe-boot-on-generation-2-virtual-machines"></a>PXE-загрузки на виртуальных машинах поколения 2

Так как таймер PIT отсутствует в Generation 2 Virtual Machines, сетевые подключения PxE TFTP-сервер может быть завершен преждевременно и предотвратить загрузчик чтения конфигурации Grub, и при загрузке ядра.

На RHEL 6.x, загрузчик EFI v0.97 устаревших grub может использоваться вместо grub2, как описано здесь: [https://access.redhat.com/documentation/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-netboot-pxe-config-efi.html](https://access.redhat.com/documentation/Red_Hat_Enterprise_Linux/6/html/Installation_Guide/s1-netboot-pxe-config-efi.html)

Для дистрибутивов Linux, отличных от RHEL 6.x, аналогичные действия применимы для настройки v0.97 grub для загрузки ядра Linux из PXE-сервера.

Кроме того, на RHEL и CentOS 6.6 клавиатуры и мыши входные данные не будут работать с предварительной установки ядра, что предотвращает задание параметров установки в меню. Чтобы разрешить выбор параметров установки необходимо настроить последовательную консоль.

* В **efidefault** файлов на PXE-сервер, добавьте следующий параметр ядра **«консоли = ttyS1»**

* На виртуальной Машине в Hyper-V установки COM-порт, с помощью этого командлета PowerShell:

```Powershell
Set-VMComPort -VMName <Name> -Number 2 -Path \\.\pipe\dbg1

```

Указание файла kickstart в ядро предварительной установки будет также избежать клавиатуру и мышь во время установки.

## <a name="use-static-mac-addresses-with-failover-clustering"></a>Используйте статические MAC-адреса с отказоустойчивой кластеризацией

Виртуальные машины Linux, которые будут развернуты с помощью отказоустойчивой кластеризации должны быть настроены статические МАС-адреса для каждого виртуального сетевого адаптера. В некоторых версиях Linux конфигурации сети могут быть потеряны после отработки отказа, так как новый MAC-адрес назначается виртуальный сетевой адаптер. Чтобы избежать потери конфигурации сети, убедитесь, что каждый виртуальный сетевой адаптер имеет статический MAC-адрес. MAC-адрес можно настроить, изменив параметры виртуальной машины в диспетчере Hyper-V или Диспетчер отказоустойчивости кластеров.

## <a name="use-hyper-v-specific-network-adapters-not-the-legacy-network-adapter"></a>Использовать Hyper-V-конкретных сетевых адаптеров, не устаревший сетевой адаптер

Настройка и использование виртуального адаптера Ethernet, который является сетевой адаптер Hyper v, появляющихся с улучшенной производительностью. Если для прежних версий и сетевых адаптеров Hyper v, появляющихся уже подключены к виртуальной машине, сети имена в выходных данных **ifconfig - a** может показывать случайных значений, таких как **_tmp12000801310**. Чтобы избежать этой проблемы, удалите все устаревшие сетевые адаптеры, при использовании Hyper-V-конкретных сетевых адаптеров в виртуальной машине Linux.

## <a name="use-io-scheduler-noop-for-better-disk-io-performance"></a>Использование операций ввода-вывода планировщик NOOP для места на диске производительность ввода-вывода

Ядро Linux имеет четыре различные планировщики операций ввода-вывода для изменения порядка запросов с помощью различных алгоритмов. NOOP является первым обслужен очередь, передает расписание принять решение о низкоуровневой оболочкой. Рекомендуется использовать как планировщик NOOP, при запуске виртуальной машины Linux на Hyper-V. Чтобы изменить планировщик для конкретного устройства, в начальной загрузки configuration (/ etc/grub.conf, например), добавьте **лифта = noop** для параметры ядра, а затем перезапустить.

## <a name="numa"></a>NUMA

Версии ядра Linux ранее 2.6.37 не поддерживают NUMA в Hyper-V с виртуальные Машины больших размеров. Эта проблема влияет в основном на дистрибутивы более ранних версий, в ядро Red Hat 2.6.32 и была исправлена в Red Hat Enterprise Linux (RHEL) 6.6 (kernel-2.6.32-504). Системы под управлением модифицированных ядер старше версии 2.6.37 или ядер RHEL более старой чем 2.6.32-504 необходимо задать параметр загрузки `numa=off` в командной строке ядра в файле grub.conf. Дополнительные сведения см. в разделе [Red Hat KB 436883](https://access.redhat.com/solutions/436883).

## <a name="reserve-more-memory-for-kdump"></a>Резервирование памяти для kdump

В случае, если ядро захвата дампа составляло авария во время загрузки, резервирование памяти для ядра. Например, измените параметр **crashkernel = 384M-:128M** для **crashkernel = 384M-:256M** в файле конфигурации grub Ubuntu.

## <a name="shrinking-vhdx-or-expanding-vhd-and-vhdx-files-can-result-in-erroneous-gpt-partition-tables"></a>Сжатие VHDX или расширение размера VHD и vhdx-файлов может привести к ошибочной таблицы разделов GPT

Hyper-V позволяет сжатия файлов виртуального диска (VHDX), без учета того, любой раздел, тома или структур данных системных файлов, которые могут существовать на диске. Если VHDX будет уменьшено до вступает в конец VHDX в конец раздела, данные могут быть потеряны, что секции может быть поврежден или недопустимых данных могут быть возвращены при чтении раздела.

После изменения размера VHD или VHDX, администраторам следует использовать программу, такую как fdisk или parted для обновления раздела, тома и структуры файловой системы в соответствии с изменениями размера диска. Сжатие или расширение размера VHD или VHDX, который имеет таблица разделов GUID (GPT) вызовет предупреждение при средство управления секции используется для проверки разметка разделов, а предупреждение администратору для устранения GPT заголовков первого и дополнительного. Это выполняемое вручную действие можно безопасно выполнять без потери данных.

## <a name="see-also"></a>См. также

* [Поддерживаемые Linux и FreeBSD виртуальных машин для Hyper-V в Windows](Supported-Linux-and-FreeBSD-virtual-machines-for-Hyper-V-on-Windows.md)

* [Рекомендации по использованию FreeBSD на Hyper-V](Best-practices-for-running-FreeBSD-on-Hyper-V.md)

* [Развертывание кластера Hyper-V](https://technet.microsoft.com/library/jj863389.aspx)

* [Создание образов Linux для Azure](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/create-upload-generic)

* [Оптимизация виртуальной Машины Linux в Azure](https://docs.microsoft.com/en-us/azure/virtual-machines/linux/optimization)
