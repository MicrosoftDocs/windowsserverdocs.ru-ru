---
title: План развертывания устройств с помощью дискретных назначение устройств
description: Дополнительные сведения о принципах DDA в Windows Server
ms.prod: windows-server-threshold
ms.service: na
ms.technology: hyper-v
ms.tgt_pltfrm: na
ms.topic: article
author: chrishuybregts
ms.author: chrihu
ms.date: 02/06/2018
ms.openlocfilehash: c64c2b75c00f97622278c3e590db46995e108218
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59840205"
---
# <a name="plan-for-deploying-devices-using-discrete-device-assignment"></a>Планирование развертывания устройств, с помощью дискретных назначение устройств
>Область применения. Microsoft Hyper-V Server 2016, Windows Server 2016, Microsoft Hyper-V Server 2019, Windows Server 2019 г.

Дискретные назначение устройства позволяет физическое оборудование PCIe для прямого доступа из виртуальной машины.  В этом руководстве будут рассмотрены тип устройств, которые можно использовать дискретный назначение устройств, требования к системе, ограничения, накладываемые на виртуальные машины, а также последствия дискретных назначение устройств для системы безопасности.

Для первоначального выпуска дискретных назначение устройств мы постарались двумя классами устройств, чтобы быть формально поддерживаются корпорацией Майкрософт: Видеоадаптеры и NVMe хранилище устройства.  Другие устройства, скорее всего, для работы и поставщики оборудования могут предлагать инструкций поддержку этих устройств.  Для этих других устройств обратитесь с просьбой для поставщиков оборудования для поддержки.

Вы будете готовы опробовать дискретных назначение устройств, можно переходить по для [развертывание графических устройств с помощью дискретных назначение устройств](../deploy/Deploying-graphics-devices-using-dda.md) или [развертывание запоминающих устройств с помощью дискретных назначение устройств](../deploy/Deploying-storage-devices-using-dda.md) Чтобы приступить к работе!

## <a name="supported-virtual-machines-and-guest-operating-systems"></a>Поддерживаемые виртуальные машины и гостевых операционных систем
Дискретные назначение устройств поддерживается для поколения 1 или 2 виртуальных машин.  Кроме того, включите Гости поддерживается Windows 10, Windows Server 2019, Windows Server 2016, Windows Server 2012 R2 с [3133690 КБ](https://support.microsoft.com/kb/3133690) применяется и различные дистрибутивы [ОС Linux.](../supported-linux-and-freebsd-virtual-machines-for-hyper-v-on-windows.md)

## <a name="system-requirements"></a>Требования к системе
В дополнение к [требования к системе для Windows Server](../../../get-started/System-Requirements--and-Installation.md) и [требования к системе для Hyper-V](../System-requirements-for-Hyper-V-on-Windows.md), дискретные назначение устройств требуется серверное оборудование класс, способный предоставление Настройка структуры PCIe (собственного PCI Express управления) управление операционной системы. Кроме того сложные корневой PCIe должен поддерживать «Службы контроля доступа» (ACS), что позволяет Hyper-V, чтобы весь трафик PCIe через Выполнением операций ввода-вывода.

Обычно эти возможности не предоставляются непосредственно в BIOS сервера и часто скрыты за другие параметры.  Например те же возможности требуются для поддержки SR-IOV, а в BIOS необходимо задать «Включить SR-IOV».  Свяжитесь с поставщиком системы, если вы не сможете определить правильный параметр в BIOS.

Для обеспечения аппаратного оборудования способен дискретных назначение устройств, наши инженеры были собраны вместе [сценарий профиля машины](#machine-profile-script) , выполняемых на узле Hyper-V включена для тестирования, если ваш сервер правильно установки и что устройства способны дискретных назначение устройств.

## <a name="device-requirements"></a>Требования к устройствам
Не все устройства PCIe может использоваться с дискретными назначение устройств.  Например старые устройства, использующие устаревшие прерывает PCI (INTx) не поддерживаются. Джейк Oshin [сообщения в блогах](https://blogs.technet.microsoft.com/virtualization/2015/11/20/discrete-device-assignment-machines-and-devices/) перейдите к более подробному - тем не менее, для пользователя, под управлением [сценарий профиля машины](#machine-profile-script) отображаются устройства, пригодный для использования для назначения отдельных устройств.

Производители устройств можно обратиться к своему представителю корпорации Майкрософт для получения дополнительных сведений.

## <a name="device-driver"></a>Драйвер устройства
Как дискретные назначение устройства передает всего устройства PCIe в гостевой виртуальной Машине, драйвер узла не должен быть установлен до устройства, которому выполняется подключение виртуальной Машины.  Единственное требование на узле является то, что устройства [путь расположения PCIe](#pcie-location-path) можно определить.  Драйвер устройства можно установить (необязательно) в том случае, если это помогает определять устройства.  Например GPU без ее драйверу устройства, установленных на узле может выглядеть как Microsoft базового устройства отображения.  Если драйвер установлен, его производителя и модель скорее всего появится.

После подключения устройства в гостевой ОС, драйвер изготовителя устройства теперь можно устанавливать как обычный внутри гостевой виртуальной машины.  

## <a name="virtual-machine-limitations"></a>Ограничения виртуальной машины
Из-за природы реализации дискретных устройства назначения некоторые функции виртуальной машины ограничены, когда устройство будет подключен.  Недоступны следующие функции:
- Сохранение и восстановление виртуальных Машин
- Динамическая миграция виртуальной машины
- Использование динамической памяти
- Добавление виртуальной Машины в кластере высокой доступности (HA)

## <a name="security"></a>Безопасность
Дискретные назначение устройства передает все устройство в виртуальную Машину.  Это означает, что доступны все возможности этого устройства из гостевой операционной системы. Некоторые возможности, такие как обновление встроенного по, может отрицательно повлиять на стабильность системы. Таким образом многочисленные предупреждающих администратору при отключении устройства из узла. Мы настоятельно рекомендуем, что дискретных назначение устройств используется только когда клиентам виртуальные машины являются доверенными.  

Если администратор хочет использовать устройство с ненадежных клиентом, мы предоставили производители устройств с возможностью создания драйвер устройства по устранению рисков, который может быть установлен на узле.  Обратитесь к изготовителю устройства сведения о ли они обеспечивают устранение рисков драйвера устройства.

Если вы хотите обойти проверку безопасности для устройства, которое не поддерживает драйвер устройства по устранению рисков, необходимо передать `-Force` параметра `Dismount-VMHostAssignableDevice` командлета.  Понимать, что таким образом, вы изменили профиль безопасности этой системы и только это рекомендуется во время создания прототипов или доверенных средах.

## <a name="pcie-location-path"></a>Путь к расположению PCIe
Путь к расположению PCIe необходим для отключения и подключения устройства из узла.  Путь расположения выглядит следующим образом: `"PCIROOT(20)#PCI(0300)#PCI(0000)#PCI(0800)#PCI(0000)"`.   [Сценарий профиля машины](#machine-profile-script) также возвращает путь к устройств PCIe.

### <a name="getting-the-location-path-by-using-device-manager"></a>Получение пути с помощью диспетчера устройств
![Диспетчер устройств](../deploy/media/dda-devicemanager.png)
- Откройте диспетчер устройств и найдите устройство.  
- Щелкните устройство правой кнопкой мыши и выберите пункт «Свойства».
- Перейдите на вкладку "Сведения" и выберите «Расположение пути» в свойство раскрывающегося списка.  
- Щелкните правой кнопкой мыши запись, которая начинается с «PCIROOT» и выберите «Копировать».  Теперь у вас есть пути для этого устройства.

## <a name="mmio-space"></a>Оно
Некоторые устройства, особенно GPU, требуется дополнительное место MMIO попадут в виртуальную Машину для памяти этого устройства могут быть недоступны. По умолчанию каждой виртуальной Машины начинается с недостатком места MMIO 128 МБ и 512 МБ места высокой MMIO, выделяемой для него. Тем не менее устройство может потребоваться больше пространства MMIO, или несколько устройств могут передаваться таким образом, что эти значения будут превышены объединенный требования.  Изменение пространства MMIO прост и может быть выполнена в PowerShell, используя следующие команды:

```
Set-VM -LowMemoryMappedIoSpace 3Gb -VMName $vm
Set-VM -HighMemoryMappedIoSpace 33280Mb -VMName $vm
```
Самый простой способ определить, сколько места MMIO выделить для использования [сценарий профиля машины](#machine-profile-script).  Кроме того вы можете вычислить с помощью диспетчера устройств. См. в блоге TechNet [дискретных назначение устройств - GPU](https://blogs.technet.microsoft.com/virtualization/2015/11/23/discrete-device-assignment-gpus/) для получения дополнительных сведений.

## <a name="machine-profile-script"></a>Сценарий профиля машины
Чтобы упростить определение, если сервер настроен правильно, и какие устройства доступны должен передаваться с помощью дискретных назначение устройств, один из наших инженеров собрали следующий сценарий PowerShell: [SurveyDDA.ps1.](https://github.com/Microsoft/Virtualization-Documentation/blob/live/hyperv-tools/DiscreteDeviceAssignment/SurveyDDA.ps1)

Перед использованием сценария, убедитесь, у вас установлена роль Hyper-V и запустите скрипт из командное окно PowerShell с правами администратора.

Если система неправильно настроена для поддержки отдельных назначение устройств, средство будет отображать сообщение об ошибке о том, что не так. Если средство обнаруживает система настроена правильно, он перечислит все устройства, его можно найти на шине PCIe.

Для каждого устройства, найденную выводится ли она будет доступна для использования с дискретными назначение устройств. Если устройство определяется как совместимую с дискретными назначение устройств, сценарий будет указать причину.  Когда устройство успешно определяется как совместимые, будет отображаться путь расположения устройства.  Кроме того Если для этого устройства требуется [пространство MMIO](#mmio-space), а также будет отображаться.

![SurveyDDA.ps1](./images/hyper-v-surveydda-ps1.png)

## <a name="frequently-asked-questions"></a>Вопросы и ответы

### <a name="how-does-remote-desktops-remotefx-vgpu-technology-relate-to-discrete-device-assignment"></a>Как технология vGPU RemoteFX удаленного рабочего стола связана с дискретными назначение устройств
Они совершенно разные технологии. RemoteFX vGPU не обязательно должен быть установлен для дискретных назначения устройств для работы. Кроме того без дополнительных ролей должен быть установлен. RemoteFX vGPU требуется роль RDVH, нужно установить драйвер vGPU RemoteFX должны присутствовать в виртуальной Машине. Для назначения отдельных устройств поскольку необходимо установить драйвер поставщика оборудования в виртуальную машину без дополнительных ролей должны присутствовать.  

### <a name="ive-passed-a-gpu-into-a-vm-but-remote-desktop-or-an-application-isnt-recognizing-the-gpu"></a>В виртуальную Машину прошли графического Процессора, но удаленный рабочий стол или приложение не распознает GPU
Существует ряд причин это могло произойти, но ряд распространенных проблем, перечислены ниже.
- Убедитесь, последние поставщика GPU драйвер установлен и не является сообщением об ошибке, проверяя состояние устройства в диспетчере устройств.
- Убедитесь, это устройство имеет недостаточно [пространство MMIO](#mmio-space) выделенной для виртуальной Машины.
- Убедитесь, что вы используете GPU, поддерживающего поставщика используется в этой конфигурации. Например некоторые поставщики препятствуют карты потребителя работе при передаче через виртуальную Машину.
- Убедитесь, поддерживает выполнение внутри виртуальной Машины, а также что графического Процессора и его соответствующих драйверов поддерживаются приложением выполняемому приложению. Некоторые приложения имеют разрешенных GPU и сред.
- Если вы используете роль узла сеансов удаленных рабочих столов или Windows Multipoint Services на гостевом компьютере, необходимо будет убедитесь, что определенную запись групповой политики для того чтобы разрешить по умолчанию GPU. С помощью объекта групповой политики применяется к гостевой ОС (или редактор локальных групповых политик на гостевом компьютере), перейдите к элементу следующие групповой политики:
   - Конфигурация компьютера
   - Шаблоны администратора
   - Компоненты Windows
   - Службы удаленных рабочих столов
   - Узел сеансов удаленных рабочих столов
   - Удаленный сеанс среды
   - Использовать графический адаптер оборудования по умолчанию для всех сеансов служб удаленных рабочих столов

    Установите это значение включено, а затем перезагрузите виртуальную Машину, после применения политики.

### <a name="can-discrete-device-assignment-take-advantage-of-remote-desktops-avc444-codec"></a>Дискретные назначение устройств можно воспользоваться кодек AVC444 удаленного рабочего стола?
Да, см. в этой записи блога, Дополнительные сведения. [Улучшения кодеков AVC/H.264 удаленного рабочего стола (RDP) 10 в Windows 10 и Windows Server 2016 Technical Preview.](https://blogs.technet.microsoft.com/enterprisemobility/2016/01/11/remote-desktop-protocol-rdp-10-avch-264-improvements-in-windows-10-and-windows-server-2016-technical-preview/)

### <a name="can-i-use-powershell-to-get-the-location-path"></a>Можно ли использовать PowerShell для получения пути доступа?
Да, существуют различные способы сделать это. Ниже приведен один пример.
```
#Enumerate all PNP Devices on the system
$pnpdevs = Get-PnpDevice -presentOnly
#Select only those devices that are Display devices manufactured by NVIDIA
$gpudevs = $pnpdevs |where-object {$_.Class -like "Display" -and $_.Manufacturer -like "NVIDIA"}
#Select the location path of the first device that's available to be dismounted by the host.
$locationPath = ($gpudevs | Get-PnpDeviceProperty DEVPKEY_Device_LocationPaths).data[0]
```

### <a name="can-discrete-device-assignment-be-used-to-pass-a-usb-device-into-a-vm"></a>Дискретные назначение устройств может использоваться для передачи USB-устройство в виртуальной Машине?
Несмотря на то, что официально не поддерживается, наши клиенты использовали дискретных назначение устройств это сделать путем передачи всего контроллера USB3 в виртуальную Машину.  Как всего контроллера передается в, отсоединен от этого контроллера устройства USB, также будут доступны на виртуальной машине.  Обратите внимание, что только некоторые контроллеры USB3 могут работать контроллеры USB2 нельзя использовать с дискретными назначение устройств.
