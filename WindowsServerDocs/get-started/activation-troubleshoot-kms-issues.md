---
title: 'Активация KMS: известные проблемы'
description: Описываются распространенные проблемы, которые могут возникнуть во время активации KMS, а также приводятся рекомендации по их устранению.
ms.topic: article
ms.date: 10/3/2019
ms.technology: server-general
ms.assetid: ''
author: Teresa-Motiv
ms.author: v-tea
manager: dcscontentpm
ms.localizationpriority: medium
ms.openlocfilehash: dab8294837a5f9116328e59364de9beb139a4b77
ms.sourcegitcommit: 9855d6b59b1f8722f39ae74ad373ce1530da0ccf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/04/2019
ms.locfileid: "71963010"
---
# <a name="kms-activation-known-issues"></a>Активация KMS: известные проблемы

В этой статье описываются распространенные вопросы и проблемы, которые могут возникнуть при активации с помощью службы управления ключами (KMS), а также рекомендации по их устранению.

> [!NOTE]
> Если вы подозреваете, что ваша проблема связана с DNS, ознакомьтесь с разделом [Общие процедуры устранения неполадок с KMS и DNS](common-troubleshooting-procedures-kms-dns.md).

## <a name="should-i-back-up-kms-host-information"></a>Следует ли выполнять резервное копирование данных узла KMS?

Для узлов KMS резервное копирование не требуется. Однако если вы используете инструмент для регулярной очистки журналов событий, то возможна утрата хронологии активации, хранящейся в журналах. Если вы используете журнал событий для трассировки или документирования активаций KMS, периодически экспортируйте журнал событий службы управления ключами из папки "Журналы приложений и служб" Просмотра событий.

Если вы используете System Center Operations Manager, то в базе данных хранилища данных System Center хранятся данные журнала событий для создания отчетов, поэтому нет необходимости в отдельном резервном копировании журналов событий.

## <a name="is-the-kms-client-computer-activated"></a>Активирован ли клиентский компьютер KMS?

На клиентском компьютере KMS откройте панель управления **Система** и найдите сообщение **Активация Windows выполнена**. Кроме того, можно запустить Slmgr.vbs и указать параметр командной строки **/dli**.

## <a name="the-kms-client-computer-does-not-activate"></a>Клиентский компьютер KMS не активируется

Проверьте, не достигнут ли порог активаций KMS. На главном компьютере KMS выполните Slmgr.vbs и укажите параметр командной строки **/dli**, чтобы узнать текущее число клиентов этого узла. Если к узлу KMS не подключены как минимум 25 клиентов, то клиентские компьютеры Windows 7 активировать невозможно. Для активации клиентов KMS на платформе Windows Server 2008 R2 требуется, чтобы у узла KMS было не менее 5 клиентов. Дополнительные сведения о требованиях к KMS см. в [руководстве по планированию активации корпоративных лицензий](http://go.microsoft.com/fwlink/?linkid=155926). 

На клиентском компьютере KMS в журнале событий приложений найдите идентификатор события 12289. Проверьте это событие на наличие следующих сведений.

- Код результата **0**? Все прочие коды означают ошибку.
- В событии указано правильное имя узла KMS?
- Указан правильный порт KMS?
- Доступен ли узел KMS?
- Если на клиенте работает брандмауэр стороннего производителя, необходимо ли настроить исходящий порт?

На главном компьютере KMS в журнале событий KMS найдите идентификатор события 12290. Проверьте это событие на наличие следующих сведений.

- Содержит ли журнал узла KMS запрос с клиентского компьютера? Убедитесь, что указано имя клиентского компьютера KMS. Убедитесь, что клиент и узел KMS могут обмениваться данными. Получил ли клиент ответ?
- Если в журнале не зарегистрировано событие клиента KMS, запрос не поступил на узел KMS или узлу KMS не удалось его обработать. Убедитесь, что маршрутизаторы не блокируют трафик через TCP-порт 1688 (если используется порт по умолчанию) и разрешена передача трафика с отслеживанием состояния в клиент KMS.

## <a name="what-does-this-error-code-mean"></a>Что означает этот код ошибки?

За исключением событий KMS с идентификатором 12290, Windows регистрирует все события активации в журнале событий приложений под именем поставщика событий Microsoft-Windows-Security-SPP. Windows регистрирует события KMS в журнале службы управления ключами, который хранится в папке "Приложения и службы". ИТ-специалисты могут запустить Slui.exe, чтобы отобразить описание большинства кодов ошибок, связанных с активацией. Общий синтаксис этой команды выглядит следующим образом.

```cmd
slui.exe 0x2a ErrorCode
```

Например, если событие с идентификатором 12293 содержит код ошибки 0x8007267C, можно отобразить описание этой ошибки, выполнив следующую команду.

```cmd
slui.exe 0x2a 0x8007267C
```

Дополнительные сведения о конкретных кодах ошибок и способах их устранения см. в разделе [Устранение ошибок активации](activation-error-codes.md).

## <a name="clients-are-not-adding-to-the-kms-count"></a>Клиенты не добавляются к счетчику KMS

Чтобы сбросить идентификатор клиентского компьютера (идентификатор CMID) и другие сведения об активации продукта, выполните команду **sysprep /generalize** или **slmgr /rearm**. В противном случае каждый клиентский компьютер выглядит одинаково и узел KMS не учитывает их как отдельные клиенты KMS.

## <a name="kms-hosts-are-unable-to-create-srv-records"></a>Узлам KMS не удается создавать записи SRV

Служба доменных имен (DNS) может ограничивать доступ на запись или не поддерживает динамическую службу доменных имен (DDNS). В этом случае предоставьте узлу KMS доступ на запись к базе данных DNS или создайте запись ресурса (RR) службы (SRV) вручную. Дополнительные сведения о проблемах с KMS и DNS см. в статье [Общие процедуры устранения неполадок с KMS и DNS](common-troubleshooting-procedures-kms-dns.md).

## <a name="only-the-first-kms-host-is-able-to-create-srv-records"></a>Только первый узел KMS может создавать записи SRV

Если в организации имеется несколько узлов KMS, другие узлы могут не иметь возможности обновлять записи ресурсов SRV, пока не изменены разрешения по умолчанию для SRV. Дополнительные сведения о проблемах с KMS и DNS см. в статье [Общие процедуры устранения неполадок с KMS и DNS](common-troubleshooting-procedures-kms-dns.md).

## <a name="i-installed-a-kms-key-on-the-kms-client"></a>Мной установлен ключ KMS на клиенте KMS

Ключи KMS должны устанавливаться только на узлах KMS, а не на клиентах KMS. Выполните команду **slmgr.vbs -ipk &lt;SetupKey&gt;** . Таблицы ключей, которые можно использовать для настройки компьютера в качестве клиента KMS, приведены в разделе [Ключи установки клиента KMS](KMSclientkeys.md). Эти ключи общеизвестны и зависят от выпуска. Обязательно удалите из DNS лишние записи ресурсов SRV и перезагрузите компьютеры.

## <a name="a-kms-host-failed"></a>Произошел сбой узла KMS

В случае сбоя узла KMS необходимо установить ключ узла KMS на новом узле, а затем активировать этот узел. Убедитесь, что для нового узла KMS в базе данных DNS имеется запись ресурса SRV. Если вы устанавливаете новый узел KMS, используя те же имя компьютера и IP-адрес, что и у неисправного узла KMS, то новый узел KMS может использовать запись SRV DNS неисправного узла. Если новый узел имеет другое имя компьютера, то можно вручную удалить запись ресурса SRV DNS неисправного узла или (если в DNS включена очистка) разрешить службе DNS удалить ее автоматически. Если сеть использует DDNS, то новый узел KMS автоматически создаст на DNS-сервере новую запись ресурса SRV. Затем, как только будет соблюден порог активации KMS, новый узел KMS начнет сбор запросов на возобновление работы клиентов и перейдет к их активации.

Если клиенты KMS используют автоматическое обнаружение, они автоматически выберут другой узел KMS, если исходный узел KMS не отвечает на запросы на возобновление. Если клиенты не используют автоматическое обнаружение, необходимо будет вручную обновить клиентские компьютеры KMS, назначенные узлу KMS, на котором произошел сбой. Для этого нужно выполнить команду **slmgr.vbs /skms**. Чтобы избежать этой ситуации, настройте на клиентах KMS автоматическое обнаружение. Для получения дополнительных сведений ознакомьтесь с [руководством по развертыванию активации корпоративных лицензий](http://go.microsoft.com/fwlink/?linkid=150083).
