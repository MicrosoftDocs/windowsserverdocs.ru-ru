---
title: Разработка подключаемого модуля шлюза
description: Разработка подключаемого модуля шлюза Windows Admin Center SDK (Project Хонолулу)
ms.technology: manage
ms.topic: article
author: nwashburn-ms
ms.author: niwashbu
ms.date: 09/18/2018
ms.localizationpriority: medium
ms.prod: windows-server
ms.openlocfilehash: 2b096b226190ad1ca3fd07c38b7b939d019ee30f
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71406936"
---
# <a name="develop-a-gateway-plugin"></a>Разработка подключаемого модуля шлюза

>Относится к Windows Admin Center, ознакомительной версии Windows Admin Center

Подключаемый модуль шлюза центра администрирования Windows обеспечивает взаимодействие API из пользовательского интерфейса средства или решения с целевым узлом.  В центре администрирования Windows размещается служба шлюза, которая передает команды и скрипты из подключаемых модулей шлюза для выполнения на целевых узлах. Службу шлюза можно расширить, включив в нее Пользовательские подключаемые модули, которые поддерживают протоколы, отличные от используемых по умолчанию.

Эти подключаемые модули шлюза включены по умолчанию в центре администрирования Windows.

* Подключаемый модуль шлюза PowerShell
* Подключаемый модуль шлюза WMI

Если вы хотите взаимодействовать с протоколом, отличным от PowerShell или WMI, например с помощью других компонентов, можно создать собственный подключаемый модуль шлюза.  Подключаемые модули шлюза загружаются в отдельный домен приложения из существующего процесса шлюза, но используют тот же уровень повышения прав.

> [!NOTE]
> Не знакомы с различными типами расширений? Дополнительные сведения об [архитектуре расширяемости и типах расширений](understand-extensions.md).

## <a name="prepare-your-environment"></a>Подготовка среды

Если вы еще не сделали этого, [подготовьте среду](prepare-development-environment.md) , установив зависимости и глобальные необходимые компоненты, необходимые для всех проектов.

## <a name="create-a-gateway-plugin-c-library"></a>Создание подключаемого модуля шлюза (C# библиотека)

Чтобы создать пользовательский подключаемый модуль шлюза, создайте C# новый класс, реализующий интерфейс ```IPlugIn``` из пространства имен ```Microsoft.ManagementExperience.FeatureInterfaces```.  

> [!NOTE]
> Интерфейс ```IFeature```, доступный в более ранних версиях пакета SDK, теперь помечен как устаревший.  При разработке подключаемого модуля шлюза следует использовать Иплугин (или, при необходимости, абстрактный класс Хттпплугин).

### <a name="download-sample-from-github"></a>Скачать пример из GitHub

Чтобы быстро приступить к работе с подключаемым модулем настраиваемого шлюза, можно клонировать или скачать копию [проекта этого C# примера](https://github.com/Microsoft/windows-admin-center-sdk/tree/master/GatewayPluginExample/Plugin) с [сайта GitHub](https://aka.ms/wacsdk)пакета SDK для Windows Admin Center.

### <a name="add-content"></a>Добавление содержимого

Добавьте новое содержимое в клонированную копию проекта проекта [ C# образца надстройки](https://github.com/Microsoft/windows-admin-center-sdk/tree/master/GatewayPluginExample/Plugin) (или собственного проекта) для хранения настраиваемых API, а затем создайте файл DLL подключаемого модуля пользовательского шлюза, который будет использоваться в следующих шагах.

### <a name="deploy-plugin-for-testing"></a>Развертывание подключаемого модуля для тестирования

Протестируйте библиотеку DLL подключаемого модуля пользовательского шлюза, загрузив ее в процесс шлюза центра администрирования Windows.

Центр администрирования Windows ищет все подключаемые модули в папке ```plugins``` в папке Application Data на текущем компьютере (используя значение Коммонаппликатиондата перечисления Environment. SpecialFolder). В Windows 10 это расположение ```C:\ProgramData\Server Management Experience```.  Если папка ```plugins``` еще не существует, ее можно создать самостоятельно.

> [!NOTE]
> Вы можете переопределить расположение подключаемого модуля в отладочной сборке, обновив значение конфигурации "Статиксфолдер". Если отладка выполняется локально, этот параметр находится в файле App. config решения для настольных систем. 

Внутри папки plugins (в этом примере ```C:\ProgramData\Server Management Experience\plugins```)

* Создайте новую папку с тем же именем, что и значение свойства ```Name``` ```Feature``` в библиотеке DLL подключаемого модуля пользовательского шлюза (в нашем примере проекта ```Name``` — "Sample Уно").
* Скопируйте DLL-файл подключаемого модуля пользовательского шлюза в эту новую папку
* Перезапуск процесса центра администрирования Windows

После перезапуска процесса администрирования Windows вы сможете выполнять API-интерфейсы в библиотеке DLL подключаемого модуля пользовательского шлюза, выполняя GET, размещение, исправление, удаление или POST, чтобы ```http(s)://{domain|localhost}/api/nodes/{node}/features/{feature name}/{identifier}```

### <a name="optional-attach-to-plugin-for-debugging"></a>Необязательно: подключение к подключаемому модулю для отладки

В Visual Studio 2017 в меню Отладка выберите команду "присоединить к процессу". В следующем окне прокрутите список Доступные процессы и выберите Смедесктоп. exe, а затем нажмите кнопку "присоединить". После запуска отладчика можно поместить точку останова в код функции, а затем выполнить ее с помощью приведенного выше формата URL-адреса. Для нашего примера проекта (имя компонента: "Sample Уно") URL-адрес: "<http://localhost:6516/api/nodes/fake-server.my.domain.com/features/Sample%20Uno>"

## <a name="create-a-tool-extension-with-the-windows-admin-center-cli"></a>Создание расширения средства с помощью интерфейса командной строки центра администрирования Windows ##

Теперь необходимо создать расширение инструмента, из которого можно вызвать пользовательский подключаемый модуль шлюза.  Создайте или перейдите к папке, в которой нужно сохранить файлы проекта, откройте командную строку и задайте эту папку в качестве рабочего каталога.  Используя интерфейс командной строки центра администрирования Windows, который был установлен ранее, создайте расширение с помощью следующего синтаксиса:

```
wac create --company "{!Company Name}" --tool "{!Tool Name}"
```

| Значение | Объяснение | Пример |
| ----- | ----------- | ------- |
| ```{!Company Name}``` | Название вашей компании (с пробелами) | ```Contoso Inc``` |
| ```{!Tool Name}``` | Имя средства (с пробелами) | ```Manage Foo Works``` |

Вот пример использования:

```
wac create --company "Contoso Inc" --tool "Manage Foo Works"
```

При этом в текущем рабочем каталоге создается новая папка с именем, которое вы указали для средства, копирует все необходимые файлы шаблонов в проект и настраивает файлы с названием компании и средства.  

Затем измените каталог на только что созданную папку, а затем установите необходимые локальные зависимости, выполнив следующую команду:

```
npm install
```

После завершения этого процесса вы настроили все необходимое для загрузки нового расширения в центр администрирования Windows. 

## <a name="connect-your-tool-extension-to-your-custom-gateway-plugin"></a>Подключение расширения средства к подключаемому модулю пользовательского шлюза

Теперь, когда вы создали расширение с помощью интерфейса командной строки центра администрирования Windows, вы можете подключить расширение средства к подключаемому модулю пользовательского шлюза, выполнив следующие действия.

- Добавить [пустой модуль](guides/add-module.md)
- Использование [подключаемого модуля пользовательского шлюза](guides/use-custom-gateway-plugin.md) в расширении средства
 
## <a name="build-and-side-load-your-extension"></a>Сборка и загрузка на стороне вашего расширения

Затем создайте и загружайте свои расширения в центре администрирования Windows.  Откройте командное окно, перейдите в каталог исходного каталога, а затем все готово к сборке.

* Создание и обслуживание с помощью Gulp:

    ```
    gulp build
    gulp serve -p 4201
    ```

Обратите внимание, что необходимо выбрать порт, который в данный момент будет не занят. Убедитесь, что вы не используете порт, на котором работает Windows Admin Center.

Проект можно загрузить в локальный экземпляр Windows Admin Center для тестирования, присоединив локально обслуживаемый проект к Windows Admin Center.

* Запустите Windows Admin Center в веб-браузере
* Откройте отладчик (F12)
* Откройте консоль и введите следующую команду:

    ```
    MsftSme.sideLoad("http://localhost:4201")
    ```

*   Обновите веб-браузер

Теперь проект будет отображаться в списке "Средства" (неопубликованный) рядом с соответствующим именем.

## <a name="target-a-different-version-of-the-windows-admin-center-sdk"></a>Нацеливание на другую версию пакета SDK для Windows Admin Center

Обновление расширения с помощью изменений пакета SDK и изменение платформы — это просто.  Узнайте о том, как [ориентироваться на другую версию](target-sdk-version.md) пакета SDK для Windows Admin Center.