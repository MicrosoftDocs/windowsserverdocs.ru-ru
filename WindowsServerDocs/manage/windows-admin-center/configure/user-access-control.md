---
title: Настройка управления доступом пользователей и разрешений
description: Сведения о настройке управления доступом пользователей и разрешений с использованием Active Directory или Azure AD (Гонолулу проекта)
ms.technology: manage
ms.topic: article
author: haley-rowland
ms.author: harowl
ms.date: 03/19/2019
ms.localizationpriority: medium
ms.prod: windows-server-threshold
ms.openlocfilehash: b19657f4ce1a1a2cfb94f7234f07805ba0abd42c
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59850575"
---
# <a name="configure-user-access-control-and-permissions"></a>Настройка управления доступом пользователей и разрешений

>Область применения. Windows Admin Center, предварительная версия Windows Admin Center

Если это еще не сделано, ознакомьтесь с [параметры контроля доступа пользователей в Windows Admin Center](../plan/user-access-options.md)

>[!NOTE]
> Доступ на основе групп в Windows Admin Center не поддерживается в средах рабочей группы или недоверенных доменах.

## <a name="gateway-access-role-definitions"></a>Определения ролей доступ шлюза

Существуют две роли для доступа к службе шлюза в Windows Admin Center:

**Пользователи шлюза** можно подключиться к службе шлюза Windows Admin Center для управления серверами через шлюз, но не могут изменять разрешения на доступ, ни механизм проверки подлинности, используемый для проверки подлинности в шлюзе.

**Администраторов шлюза** можно настроить, кто получает доступ также, как пользователи проходят проверку подлинности к шлюзу. Только администраторы шлюза можно просмотреть и настройка параметров доступа в Windows Admin Center. Локальных администраторов на компьютере шлюза всегда являются администраторами Windows Admin Center службы шлюза.

> [!NOTE]
> Доступ к шлюзу не означает доступ к управляемым серверам видимым шлюзом. Для управления целевым сервером, подключающийся пользователь должен использовать учетные данные (либо через свои передается через систему Windows учетные данные или учетные данные, предоставленные в сеансе Windows Admin Center с помощью **управлять как** действие), имеющих административный доступ к этой целевой сервер.

## <a name="active-directory-or-local-machine-groups"></a>Active Directory или группы на локальном компьютере

По умолчанию Active Directory или локальный компьютер группы используются для контроля доступа к шлюзу. Если у вас есть домен Active Directory, вы можете управлять шлюза пользователей и администраторов доступ из интерфейса Windows Admin Center.

На **пользователей** вкладке вы можете управлять доступом к Windows Admin Center как пользователь шлюза. По умолчанию и если не указать группу безопасности, любой пользователь, который обращается к URL-адрес шлюза имеет доступ. Когда вы добавите одну или несколько групп безопасности в список пользователей, доступ будет ограничен членами этих групп.

Если вы не используете домен Active Directory в вашей среде, управление доступом осуществляется с ```Users``` и ```Administrators``` локальных групп на компьютере шлюза Windows Admin Center.

### <a name="smartcard-authentication"></a>Проверка подлинности смарт-карты

Можно принудительно задать **проверки подлинности смарт-карты** , указав дополнительный _требуется_ группа для групп безопасности на основе смарт-карты. После добавления группы безопасности на основе смарт-карты пользователя доступен только служба Windows Admin Center, если они являются членом группы безопасности, и группу смарт-карты, включенные в список пользователей.

На **Администраторы** вкладке вы можете управлять доступом к Windows Admin Center как администратор шлюза. Группы локальных администраторов на компьютере будет всегда имеют полный административный доступ и не может быть удален из списка. Добавление группы безопасности, вы предоставляете членами эти привилегии группы, чтобы изменить параметры шлюза Windows Admin Center. В списке администраторов поддерживает проверку подлинности смарт-карты в так же, как список пользователей: с условием AND, для групп безопасности и смарт-карты.

## <a name="azure-active-directory"></a>Azure Active Directory

Если ваша организация использует Azure Active Directory (Azure AD), вы можете добавить **дополнительных** уровень безопасности для Windows Admin Center, требуя проверки подлинности Azure AD для доступа к шлюзу. Чтобы получить доступ к Windows Admin Center, пользователь **учетной записи Windows** также необходим доступ к серверу шлюза, (даже если используется проверка подлинности Azure AD). При использовании Azure AD разрешения на доступ пользователей и администраторов Windows Admin Center будет управлять на портале Azure, а не из пользовательского интерфейса Windows Admin Center.

### <a name="accessing-windows-admin-center-when-azure-ad-authentication-is-enabled"></a>Доступ к Windows Admin Center, если включена проверка подлинности Azure AD

В зависимости от браузера, используемого, некоторых пользователей, обращающихся к Windows Admin Center с аутентификацией Azure AD настроен получите дополнительный запрос **из браузера** где необходимо ввести свои учетные данные учетной записи Windows для компьютер, на котором установлен Windows Admin Center. После ввода этой информации, пользователи будут получать дополнительные запрос проверки подлинности Azure Active Directory, который требует учетные данные учетной записи Azure, которой предоставлены доступ в приложении Azure AD в Azure.

> [!NOTE]
> Пользователи, у Windows учетная запись имеет **права администратора** в шлюзе компьютера будет запрашиваться не для проверки подлинности Azure AD.

### <a name="configuring-azure-active-directory-authentication-for-windows-admin-center-preview"></a>Настройка проверки подлинности Azure Active Directory для предварительной версии Windows Admin Center

Перейдите к Windows Admin Center **параметры** > **доступа** и используйте переключатель, чтобы включить «использовать Azure Active Directory, чтобы добавить дополнительный уровень безопасности к шлюзу». Если вы не зарегистрировали шлюза в Azure, вам предлагается для этого в данный момент.

По умолчанию все члены в клиенте Azure AD имеют доступ пользователя к службе шлюза Windows Admin Center. Только для локальных администраторов на компьютере шлюза иметь доступ администратора к шлюзу Windows Admin Center. Обратите внимание, что права локальных администраторов на компьютере шлюза нельзя ограничить локальные администраторы могут выполнять любые операции, независимо от того, используется ли для проверки подлинности Azure AD.

Если вы хотите пользователям Azure AD для конкретного или группы пользователей шлюза или шлюза доступ администратора к службе Windows Admin Center, выполните следующие действия.

1.  Перейдите в приложение Windows Admin Center Azure AD на портале Azure с помощью гиперссылки, предоставленный в настройках доступа. Обратите внимание, что эта гиперссылка доступна только в случае, если включена проверка подлинности Azure Active Directory. 
    -   Приложение можно также найти на портале Azure, перейдя к **Azure Active Directory** > **корпоративные приложения** > **всех приложений** и поиск **WindowsAdminCenter** (приложения Azure AD будет называться WindowsAdminCenter -<gateway name>). Если вы не получили все результаты поиска, убедитесь, **Показать** присваивается **все приложения**, **состояние приложения** имеет значение **любой** и нажмите кнопку Apply, затем повторите поиск. После того как приложение, перейдите к **пользователей и групп**
2.  На вкладке «Свойства» задайте **требуется назначение пользователей** значение Да.
    Сделав это, только элементы перечислены в **пользователей и групп** вкладке будут иметь возможность доступа к шлюзу Windows Admin Center.
3.  На вкладке пользователи и группы, выберите **добавить пользователя**. Необходимо назначить шлюз пользователя или роль администратора шлюза для каждого пользователя или группы добавлены.

После включения проверки подлинности Azure AD, перезапуска службы шлюза и вы должны обновите страницу в браузере. Вы можете обновить доступ пользователя для приложения специалист-Эксперт Azure AD на портале Azure в любое время.

Пользователям будет предложено войти с помощью удостоверений Azure Active Directory, когда они пытаются получить доступ к URL-адрес шлюза Windows Admin Center. Помните, что пользователи также должны быть членом локальных пользователей на сервере шлюза для доступа к Windows Admin Center.

Пользователи и Администраторы могут просмотреть учетной записи вошедшего в систему и выхода из этой учетной записи Azure AD с также **учетной записи** вкладки "Параметры Windows Admin Center.

### <a name="configuring-azure-active-directory-authentication-for-windows-admin-center"></a>Настройка проверки подлинности Azure Active Directory для Windows Admin Center

[Чтобы настроить проверку подлинности Azure AD, необходимо сначала зарегистрировать шлюз с помощью Azure](azure-integration.md) (требуется только для этого один раз для шлюза Windows Admin Center). Этот шаг создает приложение Azure AD, из которого можно управлять шлюза и шлюза доступ с правами администратора.

Если вы хотите пользователям Azure AD для конкретного или группы пользователей шлюза или шлюза доступ администратора к службе Windows Admin Center, выполните следующие действия.

1.  Перейдите в приложение специалист-Эксперт Azure AD на портале Azure. 
    -   При нажатии кнопки **управления доступом к изменениям** , а затем выберите **Azure Active Directory** в настройках Windows Admin Center доступа, гиперссылки, приведенные в пользовательском Интерфейсе можно использовать для доступа к Azure AD приложения на портале Azure. Эта гиперссылка также доступна в параметрах доступа после выбранной Azure AD в качестве поставщика удостоверений контроля доступа и нажмите кнопку Сохранить.
    -   Приложение можно также найти на портале Azure, перейдя к **Azure Active Directory** > **корпоративные приложения** > **всех приложений** и поиск **специалист-Эксперт** (приложения Azure AD будет называться специалист-Эксперт -<gateway>). Если вы не получили все результаты поиска, убедитесь, **Показать** присваивается **все приложения**, **состояние приложения** имеет значение **любой** и нажмите кнопку Apply, затем повторите поиск. После того как приложение, перейдите к **пользователей и групп**
2.  На вкладке «Свойства» задайте **требуется назначение пользователей** значение Да.
    Сделав это, только элементы перечислены в **пользователей и групп** вкладке будут иметь возможность доступа к шлюзу Windows Admin Center.
3.  На вкладке пользователи и группы, выберите **добавить пользователя**. Необходимо назначить шлюз пользователя или роль администратора шлюза для каждого пользователя или группы добавлены.

После сохранения Azure AD управление доступом в **управления доступом к изменениям** области перезапуска службы шлюза и необходимо обновить страницу в браузере. Вы можете обновить доступ пользователя для приложения Windows Admin Center Azure AD на портале Azure в любое время. 

Пользователям будет предложено войти с помощью удостоверений Azure Active Directory, когда они пытаются получить доступ к URL-адрес шлюза Windows Admin Center. Помните, что пользователи также должны быть членом локальных пользователей на сервере шлюза для доступа к Windows Admin Center. 

С помощью **Azure** вкладке Общие параметры Windows Admin Center, пользователей и администраторов можно просмотреть учетной записи вошедшего в систему и выхода из этой учетной записи Azure AD также.

### <a name="conditional-access-and-multi-factor-authentication"></a>Условный доступ и многофакторную проверку подлинности

Одним из преимуществ использования Azure AD как дополнительный уровень безопасности для управления доступом к шлюзу Windows Admin Center является, как использовать Azure AD эффективных функций безопасности как условный доступ и многофакторную проверку подлинности. 

[Дополнительные сведения о настройке условного доступа с помощью Azure Active Directory.](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal-get-started)

## <a name="configure-single-sign-on"></a>Настройте единый вход

**Единый вход при развертывании в качестве службы на базе Windows Server**

При установке Windows Admin Center в Windows 10, она готова для использования единого входа. Если вы собираетесь использовать Windows Admin Center в Windows Server, тем не менее, необходимо настроить определенные виды делегирование Kerberos в вашей среде, прежде чем использовать единый вход. Делегирование настраивает на компьютере шлюза как доверенный для делегирования на целевой узел. 

Чтобы настроить [основанное на ресурсах ограниченное делегирование](http://windowsitpro.com/security/how-windows-server-2012-eases-pain-kerberos-constrained-delegation-part-1) в вашей среде, выполните следующие командлеты PowerShell. (Будет знать, что для этого необходим контроллер домена под управлением Windows Server 2012 или более поздней версии).

```powershell
     $gateway = "WindowsAdminCenterGW" # Machine where Windows Admin Center is installed
     $node = "ManagedNode" # Machine that you want to manage
     $gatewayObject = Get-ADComputer -Identity $gateway
     $nodeObject = Get-ADComputer -Identity $node
     Set-ADComputer -Identity $nodeObject -PrincipalsAllowedToDelegateToAccount $gatewayObject
```

В этом примере шлюз Windows Admin Center устанавливается на сервере **WindowsAdminCenterGW**, и имя целевого узла — **ManagedNode**.

Чтобы удалить эту связь, выполните следующий командлет:

```powershell
Set-ADComputer -Identity $nodeObject -PrincipalsAllowedToDelegateToAccount $null
```

## <a name="role-based-access-control"></a>Управление доступом на основе ролей

Управление доступом на основе ролей позволяет предоставить пользователям ограниченный доступ к компьютеру, вместо того, чтобы их полной локальных администраторов.
[Дополнительные сведения об управлении доступом на основе ролей и доступных ролей.](../plan/user-access-options.md#role-based-access-control)

Настройка RBAC состоит из шагов 2: Включение поддержки на целевых компьютерах и назначению пользователей в соответствующие роли.

> [!TIP]
> Убедитесь, что у вас есть права локального администратора на компьютерах, где настраивается поддержка управления доступом на основе ролей.

### <a name="apply-role-based-access-control-to-a-single-machine"></a>Применить контроль доступа на основе ролей на одном компьютере

В модели развертывания на одном компьютере идеально подходит для простых средах с лишь несколько компьютеров для управления.
Настройка компьютера с поддержкой управления доступом на основе ролей приведет следующие изменения:
-   Модули PowerShell с помощью функций, необходимых Windows Admin Center будет устанавливаться на системном диске, в разделе `C:\Program Files\WindowsPowerShell\Modules`. Все модули будут начинаться с **Microsoft.Sme**
-   Desired State Configuration будет выполняться однократной настройки для настройки конечной точки Just Enough Administration на компьютере с именем **Microsoft.Sme.PowerShell**. Эта конечная точка определяет три роли, используемые Windows Admin Center и будет выполняться как временный локальный администратор, когда пользователь подключается к нему.
-   к элементу управления, какие пользователи имеют разрешение доступа к роли, которые будут созданы 3 новые локальные группы:
    -   Администраторы Windows Admin Center
    -   Администраторы Hyper-V Windows Admin Center
    -   Читатели Windows Admin Center

Чтобы включить поддержку для управления доступом на основе ролей на одном компьютере, выполните следующие действия.

1.  Откройте Windows Admin Center и подключитесь к компьютеру, который вы хотите настроить с помощью управления доступом на основе ролей, используя учетную запись с правами локального администратора на целевом компьютере.
2.  На **Обзор** инструмент, нажмите кнопку **параметры** > **управление доступом на основе ролей**.
3.  Нажмите кнопку **применить** в нижней части страницы, чтобы включить поддержку для управления доступом на основе ролей на конечном компьютере. Процесс приложения включает в себя копирование сценариев PowerShell и вызова конфигурацию (с помощью Desired State Configuration для PowerShell) на целевом компьютере. Может занять до 10 минут, чтобы завершить и приведет к перезапуску WinRM. Это будет временно отключить Windows Admin Center, PowerShell и WMI пользователей.
4.  Обновите страницу, чтобы проверить состояние элемента управления доступом на основе ролей. Когда он будет готов к использованию, состояние изменится на **применения**.

После применения конфигурации можно назначить пользователей в роли:

1.  Откройте **локальные пользователи и группы** средство и перейдите к **группы** вкладки.
2.  Выберите **Windows Admin Center читатели** группы.
3.  В *сведения* панели внизу щелкните **добавить пользователя** и введите имя группы пользователей или безопасности, который должен иметь доступ только для чтения к серверу через Windows Admin Center. Пользователи и группы могут поступать из локального компьютера или домена Active Directory.
4.  Повторите шаги 2 – 3 для **администраторов Hyper-V в Windows Admin Center** и **Администраторы Windows Admin Center** группы.

Вы также можете заполнить эти группы согласованно во всем домене, настроив объект групповой политики с [ограниченных групп политика](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc756802%28v=ws.10%29).

### <a name="apply-role-based-access-control-to-multiple-machines"></a>Применить контроль доступа на основе ролей на нескольких компьютерах

В развертывании крупного предприятия можно использовать существующие средства автоматизации для передачи функция управления доступом на основе ролей на компьютерах, загрузив пакет конфигурации из шлюза Windows Admin Center.
Пакет конфигурации предназначен для использования с Desired State Configuration для PowerShell, но вы можете адаптировать его для работы с решением предпочтительный автоматизации.

#### <a name="download-the-role-based-access-control-configuration"></a>Скачать конфигурацию управления доступом на основе ролей

Чтобы скачать пакет конфигурации для управления доступом на основе ролей, необходимо иметь доступ к Windows Admin Center и командную строку PowerShell.

Если вы используете Windows Admin Center шлюза в режиме службы на сервере Windows, используйте следующую команду для загрузки пакета конфигурации.
Не забудьте обновить адрес шлюза с оптимальный вариант в вашей среде.

```powershell
$WindowsAdminCenterGateway = 'https://windowsadmincenter.contoso.com'
Invoke-RestMethod -Uri "$WindowsAdminCenterGateway/api/nodes/all/features/jea/endpoint/export" -Method POST -UseDefaultCredentials -OutFile "~\Desktop\WindowsAdminCenter_RBAC.zip"
```

Если вы используете Windows Admin Center шлюз на компьютере Windows 10, выполните следующую команду:

```powershell
$cert = Get-ChildItem Cert:\CurrentUser\My | Where-Object Subject -eq 'CN=Windows Admin Center Client' | Select-Object -First 1
Invoke-RestMethod -Uri "https://localhost:6516/api/nodes/all/features/jea/endpoint/export" -Method POST -Certificate $cert -OutFile "~\Desktop\WindowsAdminCenter_RBAC.zip"
```

При развертывании ZIP-архив, вы увидите следующую структуру папок:
- InstallJeaFeatures.ps1
- JustEnoughAdministration (каталог)
- Модули (каталог)
    - Microsoft.SME. \* (каталоги)
    - WindowsAdminCenter.Jea (каталог)

Чтобы настроить поддержку для управления доступом на основе ролей на узле, вам потребуется выполнить следующие действия:
1.  Скопируйте JustEnoughAdministration Microsoft.SME. \*и WindowsAdminCenter.Jea модулей в каталог модуля PowerShell на целевом компьютере. Как правило, она находится на `C:\Program Files\WindowsPowerShell\Modules`.
2.  Обновление **InstallJeaFeature.ps1** файл в соответствии с выбранной конфигурации для конечной точки RBAC.
3.  Запустите InstallJeaFeature.ps1 для компиляции ресурсов DSC.
4.  Развертывание конфигурации DSC на все свои компьютеры для применения конфигурации.

Ниже объясняется, как это сделать с помощью удаленного взаимодействия PowerShell.

#### <a name="deploy-on-multiple-machines"></a>Развертывание на нескольких компьютерах

Для развертывания конфигурации, загруженный на нескольких компьютерах, необходимо обновить **InstallJeaFeatures.ps1** сценарий для включения в соответствующие группы безопасности для вашей среды, скопируйте файлы на каждом компьютере, и запуска сценариев конфигурации.
Можно использовать предпочтительные автоматизации набора инструментов для этого, однако в этой статье основное внимание уделяется чистого подхода на основе PowerShell.

По умолчанию скрипт конфигурации создает локальные группы безопасности на компьютере для управления доступом к каждой из ролей.
Это подходит для рабочих групп и компьютеров, присоединенных к домену, но также при развертывании в среде, предназначенной только для домена, возможно, вам потребуется для напрямую связать группу безопасности домена с каждой ролью.
Чтобы обновить конфигурацию, чтобы использовать группы безопасности домена, откройте **InstallJeaFeatures.ps1** и внесите следующие изменения:

1.  Удалить 3 **группы** ресурсы из файла:
    1.  Группа MS-модулей чтения-» группа «
    2.  «Группа MS-Hyper-V-Администраторы Group»
    3.  «Группы MS группы администраторов»
2.  Удалите 3 ресурсы группы для JeaEndpoint **DependsOn** свойство
    1.  «[Group] MS-группе читателей»
    2.  «[Group] MS-Hyper-V-Администраторы Group»
    3.  «[Group] MS-группы администраторов»
3.  Измените имена группы в JeaEndpoint **RoleDefinitions** свойство для групп безопасности. Например, если у вас есть группа безопасности *CONTOSO\MyTrustedAdmins* , должен быть предоставлен доступ к роли "Администраторы Windows Admin Center", изменение `'$env:COMPUTERNAME\Windows Admin Center Administrators'` для `'CONTOSO\MyTrustedAdmins'`. Ниже приведены три строки, которые необходимо обновить.
    1.  '$env:COMPUTERNAME\Windows Admin Center Administrators'
    2.  '$env:COMPUTERNAME\Windows Admin Center Hyper-V Administrators'
    3.  '$env:COMPUTERNAME\Windows Admin Center Readers'

> [!NOTE]
> Не забудьте использовать группы безопасности, уникальные для каждой роли. Настройка завершится неудачей, если ту же группу безопасности назначено несколько ролей.

Далее, в конце **InstallJeaFeatures.ps1** добавьте следующие строки PowerShell в нижнюю часть скрипта:

```powershell
Copy-Item "$PSScriptRoot\JustEnoughAdministration" "$env:ProgramFiles\WindowsPowerShell\Modules" -Recurse -Force
$ConfigData = @{
    AllNodes = @()
    ModuleBasePath = @{
        Source = "$PSScriptRoot\Modules"
        Destination = "$env:ProgramFiles\WindowsPowerShell\Modules"
    }
}
InstallJeaFeature -ConfigurationData $ConfigData | Out-Null
Start-DscConfiguration -Path "$PSScriptRoot\InstallJeaFeature" -JobName "Installing JEA for Windows Admin Center" -Force
```

Наконец, можно скопировать в папку, содержащую модули, ресурс DSC и конфигурации для каждого целевого узла и запустите **InstallJeaFeature.ps1** скрипта.
Чтобы сделать это удаленно на рабочей станции администрирования, вы выполните следующие команды:

```powershell
$ComputersToConfigure = 'MyServer01', 'MyServer02'

$ComputersToConfigure | ForEach-Object {
    $session = New-PSSession -ComputerName $_ -ErrorAction Stop
    Copy-Item -Path "~\Desktop\WindowsAdminCenter_RBAC\JustEnoughAdministration\" -Destination "$env:ProgramFiles\WindowsPowerShell\Modules\" -ToSession $session -Recurse -Force
    Copy-Item -Path "~\Desktop\WindowsAdminCenter_RBAC" -Destination "$env:TEMP\WindowsAdminCenter_RBAC" -ToSession $session -Recurse -Force
    Invoke-Command -Session $session -ScriptBlock { Import-Module JustEnoughAdministration; & "$env:TEMP\WindowsAdminCenter_RBAC\InstallJeaFeature.ps1" } -AsJob
    Disconnect-PSSession $session
}
```
