---
title: Настройка контроля доступа и разрешений пользователей
description: Узнайте, как настроить управление доступом и разрешения пользователей с помощью Active Directory или Azure AD (проект Хонолулу).
ms.technology: manage
ms.topic: article
author: haley-rowland
ms.author: harowl
ms.date: 06/07/2019
ms.localizationpriority: medium
ms.prod: windows-server
ms.openlocfilehash: 20b311e9330880c2b26e2494aabe27bb04891868
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71407036"
---
# <a name="configure-user-access-control-and-permissions"></a>Настройка контроля доступа и разрешений пользователя

> Относится к: Windows Admin Center, ознакомительная версия Windows Admin Center

Если вы еще не сделали этого, ознакомьтесь с [параметрами управления доступом пользователей в центре администрирования Windows](../plan/user-access-options.md) .

> [!NOTE]
> Доступ на основе групп в Windows Admin Center не поддерживается в средах Рабочей группы или в доменах, не являющихся доверенными.

## <a name="gateway-access-role-definitions"></a>Определения ролей доступа к шлюзу

Существует две роли для доступа к службе шлюза центра администрирования Windows.

**Пользователи шлюза** могут подключаться к службе шлюза центра администрирования Windows для управления серверами через этот шлюз, но не могут изменять разрешения доступа и механизм проверки подлинности, используемый для проверки подлинности шлюза.

**Администраторы шлюзов** могут настроить доступ пользователей к шлюзу, а также к нему. Только администраторы шлюза могут просматривать и настраивать параметры доступа в центре администрирования Windows. Локальные администраторы на компьютере шлюза всегда являются администраторами службы шлюза центра администрирования Windows.

> [!NOTE]
> Доступ к шлюзу не подразумевает доступ к управляемым серверам, отображаемым шлюзом. Для управления целевым сервером подключающийся пользователь должен использовать учетные данные (через переданные учетные данные Windows или учетные данные, предоставленные в сеансе центра администрирования Windows с помощью действия " **Управление как** ") с административным доступом. на этот целевой сервер.

## <a name="active-directory-or-local-machine-groups"></a>Active Directory или группы локальных компьютеров

По умолчанию для управления доступом к шлюзу используются Active Directory или группы локальных компьютеров. При наличии домена Active Directory можно управлять доступом пользователей и администраторов шлюза в интерфейсе центра администрирования Windows.

На вкладке **Пользователи** можно указать, кто имеет доступ к центру администрирования Windows в качестве пользователя шлюза. По умолчанию, и если не указать группу безопасности, доступ будет иметь любой пользователь, обращающийся к URL-адресу шлюза. После добавления одной или нескольких групп безопасности в список пользователей доступ ограничен членами этих групп.

Если в вашей среде не используется домен Active Directory, управление доступом осуществляется с помощью локальных групп `Users` и `Administrators` на компьютере шлюза центра администрирования Windows.

### <a name="smartcard-authentication"></a>Проверка подлинности смарт-карты

Вы можете принудительно применить **проверку подлинности смарт-карты** , указав дополнительную _обязательную_ группу для групп безопасности на основе карты. После добавления группы безопасности на основе смарт-карты пользователь может получить доступ к службе центра администрирования Windows, только если она является членом любой группы безопасности и группы смарт-карты, включенной в список пользователей.

На вкладке " **Администраторы** " можно указать, кто имеет доступ к центру администрирования Windows в качестве администратора шлюза. Локальная группа администраторов на компьютере всегда будет иметь полный доступ администратора и не может быть удалена из списка. Добавляя группы безопасности, членам этих групп предоставляются права на изменение параметров шлюза центра администрирования Windows. Список администраторов поддерживает проверку подлинности со смарт-картой так же, как и список пользователей: с условием и для группы безопасности и группы смарт-карты.

## <a name="azure-active-directory"></a>Azure Active Directory

Если в вашей организации используется Azure Active Directory (Azure AD), можно добавить **дополнительный** уровень безопасности в центр администрирования Windows, запросив проверку подлинности Azure AD для доступа к шлюзу. Для доступа к центру администрирования Windows **учетная запись пользователя Windows** также должна иметь доступ к серверу шлюза (даже если используется проверка подлинности Azure AD). При использовании Azure AD вы управляете правами доступа пользователя и администратора центра администрирования Windows на портале Azure, а не в пользовательском интерфейсе центра администрирования Windows.

### <a name="accessing-windows-admin-center-when-azure-ad-authentication-is-enabled"></a>Доступ к центру администрирования Windows при включенной проверке подлинности Azure AD

В зависимости от используемого браузера некоторые пользователи, обращающиеся к центру администрирования Windows с настроенной проверкой подлинности Azure AD, получат дополнительные запросы **от браузера** , где им нужно указать учетные данные учетной записи Windows для компьютера, на котором Центр администрирования Windows установлен. После ввода этой информации пользователи получат дополнительный запрос на проверку подлинности Azure Active Directory, для которого требуются учетные данные учетной записи Azure, которой предоставлен доступ к приложению Azure AD в Azure.

> [!NOTE]
> Пользователи, у которых у учетной записи Windows есть **права администратора** на компьютере шлюза, не будут получать запрос на проверку подлинности Azure AD.

### <a name="configuring-azure-active-directory-authentication-for-windows-admin-center-preview"></a>Настройка проверки подлинности Azure Active Directory для предварительной версии Windows Admin Center

Перейдите в раздел **Параметры**центра администрирования Windows  > **доступ** и используйте переключатель, чтобы включить параметр "использовать Azure Active Directory, чтобы добавить уровень безопасности в шлюз". Если вы не зарегистрировали шлюз в Azure, вам будет предложено сделать это в данный момент.

По умолчанию все члены клиента Azure AD имеют доступ пользователей к службе шлюза центра администрирования Windows. Только локальные администраторы на компьютере шлюза имеют доступ администратора к шлюзу центра администрирования Windows. Обратите внимание, что права локальных администраторов на компьютере шлюза не могут быть ограничены. Локальные администраторы могут выполнять любые действия независимо от того, используется ли Azure AD для проверки подлинности.

Если вы хотите предоставить доступ к службе центра администрирования Windows конкретным пользователям или группам шлюза Azure AD, необходимо выполнить следующие действия.

1.  Перейдите в приложение Azure AD центра администрирования Windows в портал Azure, используя гиперссылку, указанную в параметрах доступа. Примечание. Эта гиперссылка доступна, только если включена проверка подлинности Azure Active Directory. 
    -   Вы также можете найти приложение в портал Azure, перейдя в **Azure Active Directory** > **корпоративные приложения** > **все приложения** и поиск в **виндовсадминцентер** (приложение Azure AD будет называться Виндовсадминцентер-<gateway name>). Если результаты поиска не получены, убедитесь, что для параметра **Показывать** задано значение **все приложения**, для параметра **состояние приложения** установлено значение **любое** и нажмите кнопку Применить, а затем попробуйте выполнить поиск. Найдя приложение, перейдите к разделу **Пользователи и группы** .
2.  На вкладке Свойства задайте для параметра **Назначение пользователей** значение Да.
    После этого только члены, перечисленные на вкладке **Пользователи и группы** , смогут получить доступ к шлюзу центра администрирования Windows.
3.  На вкладке Пользователи и группы выберите **Добавить пользователя**. Необходимо назначить роль пользователя шлюза или администратора шлюза для каждого добавляемого пользователя или группы.

После включения проверки подлинности Azure AD служба шлюза перезапускается и необходимо обновить браузер. Вы можете обновить доступ пользователей для приложения эксперт Azure AD в портал Azure в любое время.

При попытке доступа к URL-адресу шлюза центра администрирования Windows пользователям будет предложено войти, используя удостоверение Azure Active Directory. Помните, что пользователи также должны быть членами локальных пользователей на сервере шлюза для доступа к центру администрирования Windows.

Пользователи и администраторы могут просматривать текущую учетную запись в системе, а также выход из этой учетной записи Azure AD с вкладки **учетная запись** в параметрах центра администрирования Windows.

### <a name="configuring-azure-active-directory-authentication-for-windows-admin-center"></a>Настройка проверки подлинности Azure Active Directory для центра администрирования Windows

[Чтобы настроить аутентификацию Azure AD, необходимо сначала зарегистрировать шлюз в Azure](azure-integration.md) (это необходимо сделать только один раз для шлюза центра администрирования Windows). На этом шаге создается приложение Azure AD, из которого можно управлять доступом пользователей шлюза и администратора шлюза.

Если вы хотите предоставить доступ к службе центра администрирования Windows конкретным пользователям или группам шлюза Azure AD, необходимо выполнить следующие действия.

1.  Перейдите к приложению эксперт Azure AD в портал Azure. 
    -   Если щелкнуть **изменить управление доступом** , а затем выбрать **Azure Active Directory** из раздела параметры доступа центра администрирования Windows, можно использовать гиперссылку, предоставленную в пользовательском интерфейсе, для доступа к приложению Azure AD в портал Azure. Эта гиперссылка также доступна в параметрах доступа после нажатия кнопки Сохранить и выбора Azure AD в качестве поставщика удостоверений управления доступом.
    -   Вы также можете найти приложение в портал Azure, перейдя в **Azure Active Directory** > **корпоративные приложения** > **все приложения** и выполнив поиск в **эксперт** (приложение Azure AD будет называться эксперт-<gateway>). Если результаты поиска не получены, убедитесь, что для параметра **Показывать** задано значение **все приложения**, для параметра **состояние приложения** установлено значение **любое** и нажмите кнопку Применить, а затем попробуйте выполнить поиск. Найдя приложение, перейдите к разделу **Пользователи и группы** .
2.  На вкладке Свойства задайте для параметра **Назначение пользователей** значение Да.
    После этого только члены, перечисленные на вкладке **Пользователи и группы** , смогут получить доступ к шлюзу центра администрирования Windows.
3.  На вкладке Пользователи и группы выберите **Добавить пользователя**. Необходимо назначить роль пользователя шлюза или администратора шлюза для каждого добавляемого пользователя или группы.

После сохранения контроля доступа Azure AD в области **управления доступом на изменение** служба шлюза перезапускается и необходимо обновить браузер. Вы можете обновить пользовательский доступ для приложения Azure AD центра администрирования Windows в портал Azure в любое время. 

При попытке доступа к URL-адресу шлюза центра администрирования Windows пользователям будет предложено войти, используя удостоверение Azure Active Directory. Помните, что пользователи также должны быть членами локальных пользователей на сервере шлюза для доступа к центру администрирования Windows. 

С помощью вкладки **Azure** в центре администрирования Windows общие параметры пользователи и администраторы могут просматривать текущую учетную запись в системе, а также выход из этой учетной записи Azure AD.

### <a name="conditional-access-and-multi-factor-authentication"></a>Условный доступ и многофакторная проверка подлинности

Одним из преимуществ использования Azure AD в качестве дополнительного уровня безопасности для управления доступом к шлюзу центра администрирования Windows является то, что вы можете использовать мощные функции безопасности Azure AD, такие как условный доступ и многофакторная идентификация. 

[Дополнительные сведения о настройке условного доступа с помощью Azure Active Directory.](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal-get-started)

## <a name="configure-single-sign-on"></a>Настройте единый вход

**Единый вход при развертывании в качестве службы в Windows Server**

При установке центра администрирования Windows в Windows 10 все готово к использованию единого входа. Однако если вы собираетесь использовать центр администрирования Windows в Windows Server, то перед использованием единого входа необходимо настроить в среде некоторую форму делегирования Kerberos. Делегирование настраивает компьютер шлюза как доверенный для делегирования целевому узлу. 

Чтобы настроить [ограниченное делегирование на основе ресурсов](https://docs.microsoft.com/windows-server/security/kerberos/kerberos-constrained-delegation-overview) в вашей среде, выполните следующие командлеты PowerShell. (Имейте в виду, что для этого требуется контроллер домена под Windows Server 2012 или более поздней версии).

```powershell
     $gateway = "WindowsAdminCenterGW" # Machine where Windows Admin Center is installed
     $node = "ManagedNode" # Machine that you want to manage
     $gatewayObject = Get-ADComputer -Identity $gateway
     $nodeObject = Get-ADComputer -Identity $node
     Set-ADComputer -Identity $nodeObject -PrincipalsAllowedToDelegateToAccount $gatewayObject
```

В этом примере шлюз центра администрирования Windows устанавливается на сервере **виндовсадминцентергв**, а имя целевого узла — **манажедноде**.

Чтобы удалить эту связь, выполните следующий командлет:

```powershell
Set-ADComputer -Identity $nodeObject -PrincipalsAllowedToDelegateToAccount $null
```

## <a name="role-based-access-control"></a>Управление доступом на основе ролей

Управление доступом на основе ролей позволяет предоставлять пользователям ограниченный доступ к компьютеру, не делая их полными локальными администраторами.
[Дополнительные сведения см. в статье Управление доступом на основе ролей и доступные роли.](../plan/user-access-options.md#role-based-access-control)

Настройка RBAC состоит из двух шагов: Включение поддержки на целевых компьютерах и назначение пользователям соответствующих ролей.

> [!TIP]
> Убедитесь, что у вас есть права локального администратора на компьютерах, на которых настраивается поддержка управления доступом на основе ролей.

### <a name="apply-role-based-access-control-to-a-single-machine"></a>Применение управления доступом на основе ролей к одному компьютеру

Модель развертывания на одном компьютере идеально подходит для простых сред, в которых может управлять только несколько компьютеров.
Настройка компьютера с поддержкой управления доступом на основе ролей приведет к следующим изменениям:

-   Модули PowerShell с функциями, необходимыми для центра администрирования Windows, будут установлены на системный диск в разделе `C:\Program Files\WindowsPowerShell\Modules`. Все модули будут начинаться с **Microsoft. Эксперт**
-   Настройка требуемого состояния выполняет однократную настройку для настройки достаточной конечной точки администрирования на компьютере с именем **Microsoft. Эксперт. PowerShell**. Эта конечная точка определяет 3 роли, используемые центром администрирования Windows, и будет запускаться как временный локальный администратор при подключении к нему пользователя.
-   3 будут созданы новые локальные группы для управления тем, каким пользователям назначен доступ к каким ролям:
    -   Администраторы центра администрирования Windows
    -   Администраторы Hyper-V центра администрирования Windows
    -   Читатели центра администрирования Windows

Чтобы включить поддержку управления доступом на основе ролей на одном компьютере, выполните следующие действия.

1.  Откройте центр администрирования Windows и подключитесь к компьютеру, который вы хотите настроить с помощью управления доступом на основе ролей, используя учетную запись с правами локального администратора на целевом компьютере.
2.  В средстве **обзора** щелкните **Параметры** > **Управление доступом на основе ролей**.
3.  Нажмите кнопку **Применить** в нижней части страницы, чтобы включить поддержку управления доступом на основе ролей на целевом компьютере. Процесс приложения включает копирование скриптов PowerShell и вызов конфигурации (с помощью настройки требуемого состояния PowerShell) на целевом компьютере. Выполнение может занять до 10 минут, что приведет к перезапуску WinRM. Это приведет к временному отключению пользователей центра администрирования Windows, PowerShell и WMI.
4.  Обновите страницу, чтобы проверить состояние управления доступом на основе ролей. Когда она будет готова к использованию, состояние изменится на **применено**.

После применения конфигурации можно назначить пользователей ролям:

1.  Откройте средство **Локальные пользователи и группы** и перейдите на вкладку **группы** .
2.  Выберите группу **читателей центра администрирования Windows** .
3.  В области *сведений* внизу щелкните **Добавить пользователя** и введите имя пользователя или группы безопасности, которые должны иметь доступ только для чтения к серверу через центр администрирования Windows. Пользователи и группы могут поступать с локального компьютера или домена Active Directory.
4.  Повторите шаги 2-3 для групп администраторов **Hyper-V администраторы** и администраторы **Windows** для центра администрирования Windows.

Можно также согласованно заполнить эти группы в домене, настроив объект групповая политика с [параметром политики ограниченные группы](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc756802%28v=ws.10%29).

### <a name="apply-role-based-access-control-to-multiple-machines"></a>Применение управления доступом на основе ролей к нескольким компьютерам

В крупномасштабном развертывании предприятия можно использовать имеющиеся средства автоматизации для отправки функции управления доступом на основе ролей на компьютеры, загрузив пакет конфигурации из шлюза центра администрирования Windows.
Пакет конфигурации предназначен для использования с настройкой требуемого состояния PowerShell, но его можно адаптировать для работы с предпочтительным решением для автоматизации.

#### <a name="download-the-role-based-access-control-configuration"></a>Скачивание конфигурации управления доступом на основе ролей

Чтобы загрузить пакет конфигурации управления доступом на основе ролей, необходимо иметь доступ к центру администрирования Windows и командной строке PowerShell.

Если вы используете шлюз центра администрирования Windows в режиме службы в Windows Server, используйте следующую команду, чтобы скачать пакет конфигурации.
Не забудьте обновить адрес шлюза, указав для своей среды правильный.

```powershell
$WindowsAdminCenterGateway = 'https://windowsadmincenter.contoso.com'
Invoke-RestMethod -Uri "$WindowsAdminCenterGateway/api/nodes/all/features/jea/endpoint/export" -Method POST -UseDefaultCredentials -OutFile "~\Desktop\WindowsAdminCenter_RBAC.zip"
```

Если вы используете шлюз центра администрирования Windows на компьютере с Windows 10, выполните следующую команду:

```powershell
$cert = Get-ChildItem Cert:\CurrentUser\My | Where-Object Subject -eq 'CN=Windows Admin Center Client' | Select-Object -First 1
Invoke-RestMethod -Uri "https://localhost:6516/api/nodes/all/features/jea/endpoint/export" -Method POST -Certificate $cert -OutFile "~\Desktop\WindowsAdminCenter_RBAC.zip"
```

При развертывании ZIP-архива вы увидите следующую структуру папок:

- Инсталлжеафеатурес. ps1
- Жустенаугхадминистратион (каталог)
- Модули (каталог)
    - Microsoft. Эксперт. \* (каталоги)
    - Виндовсадминцентер. Jea (каталог)

Чтобы настроить поддержку управления доступом на основе ролей на узле, необходимо выполнить следующие действия.

1.  Скопируйте модули Жустенаугхадминистратион, Microsoft. Эксперт. \* и Виндовсадминцентер. Jea в каталог модуля PowerShell на целевом компьютере. Как правило, он находится в `C:\Program Files\WindowsPowerShell\Modules`.
2.  Обновите файл **инсталлжеафеатуре. ps1** в соответствии с требуемой конфигурацией для КОНЕЧНОЙ точки RBAC.
3.  Запустите Инсталлжеафеатуре. ps1, чтобы скомпилировать ресурс DSC.
4.  Разверните конфигурацию DSC на всех компьютерах, чтобы применить конфигурацию.

В следующем разделе объясняется, как это сделать с помощью удаленного взаимодействия PowerShell.

#### <a name="deploy-on-multiple-machines"></a>Развертывание на нескольких компьютерах

Чтобы развернуть конфигурацию, загруженную на несколько компьютеров, необходимо обновить сценарий **инсталлжеафеатурес. ps1** , чтобы включить соответствующие группы безопасности для среды, скопировать файлы на каждый из компьютеров и вызвать скрипты конфигурации.
Для этого можно использовать предпочтительные средства автоматизации, однако в этой статье основное внимание уделяется чистому подходу на основе PowerShell.

По умолчанию скрипт конфигурации будет создавать локальные группы безопасности на компьютере для управления доступом к каждой из ролей.
Это подходит для компьютеров, присоединенных к Рабочей группе и доменам, но если развертывание выполняется в среде только для домена, то может потребоваться напрямую связать группу безопасности домена с каждой ролью.
Чтобы обновить конфигурацию для использования групп безопасности домена, откройте **инсталлжеафеатурес. ps1** и внесите следующие изменения:

1.  Удалите 3 ресурса **группы** из файла:
    1.  "Группа MS-читателей-Group"
    2.  "Группа MS-Hyper-V-Administrators-Group"
    3.  "Группа MS-Administrators-Group"
2.  Удалите 3 ресурса группы из свойства Жеаендпоинт **DependsOn** .
    1.  "[Group] MS-Readers-Group"
    2.  "[Group] MS-Hyper-V-Administrators-Group"
    3.  "[Группа] MS-Administrators-Group"
3.  Измените имена групп в свойстве Жеаендпоинт **RoleDefinitions** на нужные группы безопасности. Например, если у вас есть группа безопасности *контосо\митрустедадминс* , которой должен быть назначен доступ к роли администраторов центра администрирования Windows, измените `'$env:COMPUTERNAME\Windows Admin Center Administrators'` на `'CONTOSO\MyTrustedAdmins'`. Ниже перечислены три строки, которые необходимо обновить.
    1.  "$env: Администраторы центра администрирования Компутернаме\виндовс
    2.  "$env: Администраторы Hyper-V центра администрирования Компутернаме\виндовс
    3.  ' $env: читатели центра администрирования Компутернаме\виндовс

> [!NOTE]
> Обязательно используйте уникальные группы безопасности для каждой роли. Настройка завершится ошибкой, если одна и та же группа безопасности назначена нескольким ролям.

Затем в конце файла **инсталлжеафеатурес. ps1** добавьте следующие строки PowerShell в нижнюю часть скрипта:

```powershell
Copy-Item "$PSScriptRoot\JustEnoughAdministration" "$env:ProgramFiles\WindowsPowerShell\Modules" -Recurse -Force
$ConfigData = @{
    AllNodes = @()
    ModuleBasePath = @{
        Source = "$PSScriptRoot\Modules"
        Destination = "$env:ProgramFiles\WindowsPowerShell\Modules"
    }
}
InstallJeaFeature -ConfigurationData $ConfigData | Out-Null
Start-DscConfiguration -Path "$PSScriptRoot\InstallJeaFeature" -JobName "Installing JEA for Windows Admin Center" -Force
```

Наконец, можно скопировать папку, содержащую модули, ресурс DSC и конфигурацию, на каждый целевой узел и выполнить сценарий **инсталлжеафеатуре. ps1** .
Чтобы сделать это удаленно с рабочей станции администратора, можно выполнить следующие команды:

```powershell
$ComputersToConfigure = 'MyServer01', 'MyServer02'

$ComputersToConfigure | ForEach-Object {
    $session = New-PSSession -ComputerName $_ -ErrorAction Stop
    Copy-Item -Path "~\Desktop\WindowsAdminCenter_RBAC\JustEnoughAdministration\" -Destination "$env:ProgramFiles\WindowsPowerShell\Modules\" -ToSession $session -Recurse -Force
    Copy-Item -Path "~\Desktop\WindowsAdminCenter_RBAC" -Destination "$env:TEMP\WindowsAdminCenter_RBAC" -ToSession $session -Recurse -Force
    Invoke-Command -Session $session -ScriptBlock { Import-Module JustEnoughAdministration; & "$env:TEMP\WindowsAdminCenter_RBAC\InstallJeaFeature.ps1" } -AsJob
    Disconnect-PSSession $session
}
```
