---
title: 'Windows Admin Center: общие действия по устранению неполадок'
description: 'Windows Admin Center: общие действия по устранению неполадок (проект Honolulu)'
ms.technology: manage
ms.topic: article
author: jwwool
ms.author: jeffrew
ms.localizationpriority: medium
ms.prod: windows-server-threshold
ms.date: 02/12/2019
ms.openlocfilehash: a91a8dcf6f05ef0ef66dee603851150b2145d559
ms.sourcegitcommit: f1edfc6525e09dd116b106293f9260123a94de0c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/12/2019
ms.locfileid: "9297123"
---
# Устранение неполадок в Windows Admin Center

>Относится к Windows Admin Center, ознакомительной версии Windows Admin Center

> [!Important]
> Это руководство поможет вам в диагностике и разрешении проблем, которые не позволяют использовать Windows Admin Center. Если у вас возникает проблема с определенным средством, проверьте, возможно, эта проблема [уже известна.](http://aka.ms/wacknownissues)

<a id="toc"></a>

## Быстрые ссылки

* [Программа установки завершается ошибкой, сообщение: ** _модуль «Microsoft.PowerShell.LocalAccounts» не может быть загружен._**](#psmodulepath)

* В браузере появляется сообщение об ошибке **Не удается подключиться к этому сайту/странице** (выберите свой тип развертывания)
    * [Windows Admin Center установлен в качестве приложения в Windows 10](#whitescreenw10)
    * [Windows Admin Center установлен в качестве шлюза в Windows Server](#whitescreenws)
    * [Windows Admin Center установлен в качестве шлюза на виртуальной машине Azure](#whitescreenazvm)

* [Домашняя страница Windows Admin Center загружается, но зайти на панели "Добавить подключение", или не удается подключиться к любому компьютеру.](#winvercompat)

* [Появляется сообщение: «Ошибка при загрузке модуля. Rpc: истекло количество попыток Ping.»](#winvercompat)

* [Появляется сообщение: «не удается безопасно подключаться к этой странице. Возможно, что сайт использует устаревшие или небезопасных параметры безопасности TLS.»](#tls)

* [Возникают проблемы с помощью средств удаленного рабочего стола, события и PowerShell.](#websockets)

* [Возникают проблемы с помощью функции Azure в Edge](#azlogin)

* [Удается подключиться к некоторым серверам, но к другим нет](#connectionissues)

* [Я использую Windows Admin Center в **рабочей группе**](#workgroup)

* [Windows Admin Center установлен ранее, и теперь ничего можно использовать один и тот же порт TCP/IP](#urlacl)

* [Моя проблема здесь не указана, либо действия, перечисленные на этой странице, не решают ее.](#filebug)

<a id="psmodulepath"></a>

## Программа установки завершается ошибкой, сообщение: ** _модуль «Microsoft.PowerShell.LocalAccounts» не может быть загружен._**

Это может произойти, если путем модуля PowerShell по умолчанию были изменены или удалены. Чтобы устранить проблему, убедитесь, что ```%SystemRoot%\system32\WindowsPowerShell\v1.0\Modules``` — это **первый** элемент в переменную среды PSModulePath. Этого можно добиться с помощью следующей строчке PowerShell:

```powershell
[Environment]::SetEnvironmentVariable("PSModulePath","%SystemRoot%\system32\WindowsPowerShell\v1.0\Modules;" + ([Environment]::GetEnvironmentVariable("PSModulePath","User")),"User")
```

## В браузере появляется сообщение об ошибке **Не удается подключиться к этому сайту/странице**

<a id="whitescreenw10"></a>

### Если вы установили Windows Admin Center в качестве **приложения в Windows 10**

* Убедитесь, что Windows Admin Center запущен. Найдите значок Windows Admin Center ![](../media/trayIcon.PNG) на панели задач или **рабочий стол Windows Admin Center / SmeDesktop.exe** в диспетчере задач. Если ни того, ни другого нет, запустите **Windows Admin Center** из меню "Пуск".

> [!NOTE] 
> После перезагрузки необходимо запустить Windows Admin Center из меню "Пуск".  

* [Проверьте версию Windows](#winvercompat)

* Убедитесь, что вы используете браузер Microsoft Edge или Google Chrome.

* Вы выбрали правильный сертификат при [первом запуске?](../use/get-started.md#selecting-a-client-certificate)

  * Попробуйте открыть браузер в приватном режиме, и если это сработает, вам потребуется очистить кэш.

* Недавно обновления Windows 10 до новой сборки или версии?

  * Возможно, это снят параметров доверенных узлов. [Следуйте этим инструкциям для обновления настроек доверенных узлов.](#configure-trustedhosts) 

[[в начало]](#toc)

<a id="whitescreenws"></a>

### Если вы установили Windows Admin Center в качестве **шлюза в Windows Server**

* И обновления с предыдущей версии Windows Admin Center? Проверьте, убедитесь, что правило брандмауэра не был удален из-за [этой известной проблеме](known-issues.md#upgrade). Используйте указанную ниже команду PowerShell, чтобы определить, существует ли правило. В противном случае выполните [следующие действия](known-issues.md#upgrade) , чтобы повторно создать ее.
    ```powershell
    Get-NetFirewallRule -DisplayName "SmeInboundOpenException"
    ```

* [Проверьте версию Windows](#winvercompat) на клиенте и сервере.

* Убедитесь, что вы используете браузер Microsoft Edge или Google Chrome.

* На сервере откройте диспетчер задач > службы и убедитесь, что **ServerManagementGateway или Windows Admin Center** работает.
![](../media/Service-TaskMan.PNG)

* Проверьте сетевое подключение к шлюзу (замените \<значения>, используя данные из своего развертывания)
    ```powershell
    Test-NetConnection -Port <port> -ComputerName <gateway> -InformationLevel Detailed
    ```

[[в начало]](#toc)

<a id="whitescreenazvm"></a>  

### Если вы установили Windows Admin Center на виртуальной машине Azure Windows Server

* [Проверьте версию Windows](#winvercompat)
* Добавили ли вы правило для портов входящего трафика HTTPS? 
* [Дополнительные сведения об установке Windows Admin Center на виртуальной машине Azure](https://docs.microsoft.com/windows-server/manage/windows-admin-center/configure/azure-integration#use-a-windows-admin-center-gateway-deployed-in-azure)

[[в начало]](#toc)

<a id="winvercompat"></a>

### Проверьте версию Windows

* Откройте диалоговое окно "Выполнить" (клавиши Windows + R) и запустите ```winver```.

* Если вы используете Windows 10 версии 1703 или ниже, Windows Admin Center не поддерживается в вашей версии Microsoft Edge. Выполните обновление до более новой версии Windows 10, либо используйте Google Chrome.

* При использовании предварительной версии Windows 10 или Server с версией сборки 17134 и 17637 Windows было ошибки, который вызвал Windows Admin Center может завершиться сбоем. Используйте текущий поддерживаемая версия Windows.

### Убедитесь, что на компьютер шлюза и управляемый узел запущена служба удаленного управления Windows (WinRM)

* Откройте диалоговое окно выполнения с клавиша с эмблемой Windows + R
* Тип ```services.msc``` и нажмите клавишу ВВОД
* В открывшемся окне, проверьте наличие удаленного управления Windows (WinRM), убедитесь, что она запущена и настроить автоматический запуск

### И вы обновляете свой сервер 2016 до 2019?

* Возможно, это снят параметров доверенных узлов. [Следуйте этим инструкциям для обновления настроек доверенных узлов.](#configure-trustedhosts) 

[[в начало]](#toc)

<a id="tls"></a>

## Появляется сообщение: «не удается безопасно подключаться к этой странице. Это может быть, так как сайт использует устаревшие или небезопасных параметры безопасности TLS.

<!--REF: https://docs.microsoft.com/iis/get-started/whats-new-in-iis-10/http2-on-iis#when-is-http2-not-supported -->
Компьютер будет ограничена подключений HTTP/2. Windows Admin Center использует встроенную проверку подлинности Windows, который не поддерживается в HTTP/2. Добавьте следующие два значения в разделе ```HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Http\Parameters``` ключей на **компьютере под управлением браузера** для снятия ограничения HTTP/2:

```
EnableHttp2Cleartext=dword:00000000
EnableHttp2Tls=dword:00000000
```

[[в начало]](#toc)

<a id="websockets"></a> 

## Возникают проблемы с помощью средств удаленного рабочего стола, события и PowerShell.

Эти три средства требуется протокол websocket, который часто блокируемого брандмауэры и прокси-серверы. Если вы используете Google Chrome, существует [Известная проблема](known-issues.md#google-chrome) с websockets и проверки подлинности NTLM.

[[в начало]](#toc)


<a id="connectionissues"></a> 

## Возможно подключение к некоторым серверам, но к другим нет
* Войдите на компьютер шлюза в локальном режиме и попробуйте ввести ```Enter-PSSession <machine name>``` в PowerShell, заменив \<machine name> на имя компьютера, на котором вы пытаетесь отладить Windows Admin Center. 

* Если в вашей среде вместо домена используется рабочая группа, см. [использование Windows Admin Center в рабочей группе](#workgroup).

* **Использование локальных учетных записей администратора.** При использовании учетной записи локального пользователя, которая не является встроенной учетной записью администратора, необходимо включить политику на целевом компьютере, выполнив следующую команду в PowerShell или в командной строке от имени администратора на целевом компьютере:

        REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1


[[в начало]](#toc)

<a id="workgroup"></a>

## Использование Windows Admin Center в рабочей группе 

### Какая учетная запись используется?
Убедитесь, что учетная запись, которую вы используете, входит в группу локальных администраторов на целевом сервере. В некоторых случаях WinRM также требует членство в группе "Пользователи удаленного управления". При использовании учетной записи локального пользователя, которая не является **встроенной учетной записью администратора**, необходимо включить политику на целевом компьютере, выполнив следующую команду в PowerShell или в командной строке от имени администратора на целевом компьютере:

```cmd
REG ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1
```
### Подключение производится к компьютеру рабочей группы в другой подсети?

Для подключения к компьютеру рабочей группы, который находится не в одной подсети с шлюзом, убедитесь, что порт брандмауэра для WinRM (TCP 5985) пропускает входящий трафик на целевой компьютер. Вы можете выполнить следующую команду в PowerShell или в командной строке от имени администратора на целевом компьютере для создания этого правила брандмауэра:

- **Windows Server**

    ```powershell
    Set-NetFirewallRule -Name WINRM-HTTP-In-TCP-PUBLIC -RemoteAddress Any
    ```

- **Windows 10**

    ```powershell
    Set-NetFirewallRule -Name WINRM-HTTP-In-TCP -RemoteAddress Any
    ```

### Настройка TrustedHosts

При установке Windows Admin Center пользователю предоставляется возможность задать параметр TrustedHosts шлюза через Windows Admin Center. Это обязательно в среде рабочей группы и при использовании учетных данных локального администратора в домене. Если вы решили пропустить настройку этого параметра, необходимо вручную настроить TrustedHosts.

**Изменение TrustedHosts с помощью команд PowerShell:**

1. Откройте сеанс PowerShell от имени администратора.
2. Просмотрите текущие настройки TrustedHosts:

    ```powershell
    Get-Item WSMan:\localhost\Client\TrustedHosts
    ```

    > [!WARNING]
    > Если текущий параметр TrustedHosts не является пустым, приведенные ниже команды перезапишут его. Рекомендуется сохранить текущий параметр в текстовый файл с помощью следующей команды, чтобы его можно было восстановить при необходимости.

    > `Get-Item WSMan:localhost\Client\TrustedHosts | Out-File C:\OldTrustedHosts.txt`

3. Задайте для TrustedHosts значение NetBIOS, IP-адреса или полного доменного имени компьютеров, которыми вы планируете управлять:

    ```powershell
    Set-Item WSMan:localhost\Client\TrustedHosts -Value '192.168.1.1,server01.contoso.com,server02'
    ```

    > [!TIP] 
    >Простой способ задать все значения TrustedHosts за один раз заключается в использовании подстановочных знаков.

    >     Set-Item WSMan:\localhost\Client\TrustedHosts -Value '*'

4. После завершения тестирования можно выполнить следующую команду в сеансе PowerShell с повышенными привилегиями для очистки параметров TrustedHosts:

    ```powershell
    Clear-Item WSMan:localhost\Client\TrustedHosts
    ```

5. Если вы ранее экспортировали параметры, откройте файл, скопируйте значения и используйте следующую команду:

    ```powershell
    Set-Item WSMan:localhost\Client\TrustedHosts -Value '<paste values from text file>'
    ```

[[в начало]](#toc)

<a id="urlacl"></a>

## Windows Admin Center установлен ранее, и теперь ничего можно использовать один и тот же порт TCP/IP

Вручную выполните следующие две команды в командной строке с повышенными привилегиями:

```cmd
netsh http delete sslcert ipport=0.0.0.0:443
netsh http delete urlacl url=https://+:443/
```

[[в начало]](#toc)

<a id="azlogin"></a>

## Возникают проблемы с помощью функции Azure в Edge

Edge имеет [Известные проблемы](https://github.com/AzureAD/azure-activedirectory-library-for-js/wiki/Known-issues-on-Edge) , связанные с зоны безопасности, которые влияют на Azure входа в Windows Admin Center. Если у вас возникли проблемы при использовании функции Azure при использовании Edge, попробуйте добавить https://login.microsoftonline.com, https://login.live.com и URL-адрес шлюза как надежные сайты и для разрешенных сайтов для параметров Edge блокирование всплывающих окон в браузере стороне клиента. 

Для этого выполните следующие действия.
1. Поиск **Свойства обозревателя** в меню "Пуск" Windows
2. Перейдите на вкладку " **Безопасность** "
3. Под параметром **Надежных сайтов** нажмите кнопку " **узлы** " и добавьте URL-адреса в открывшемся диалоговом окне. Вам потребуется добавить URL-адрес шлюза в том числе в https://login.microsoftonline.com и https://login.live.com.
4. Перейдите на вкладку " **Конфиденциальность** "
5. В разделе **Блокирование всплывающих окон** нажмите кнопку « **Параметры** » и добавьте URL-адреса в открывшемся диалоговом окне. Вам потребуется добавить URL-адрес шлюза в том числе в https://login.microsoftonline.com и https://login.live.com.


[[в начало]](#toc)

<a id="azissue"></a>

## Возникли проблемы с возможностью связанные с Azure?

Отправьте нам сообщение электронной почты по wacFeedbackAzure@microsoft.com со следующими данными:
* Общие проблемы информации из [вопросы перечисленные ниже](#filebug). 
* Описать свою проблему и действия привели к возникновению проблемы. 
* Мы ранее регистрации шлюза в Azure, с помощью New-AadApp.ps1 загружаемых сценария и затем выполнить обновление до версии 1807? Или зарегистрировать шлюза в Azure, с помощью пользовательского интерфейса из > параметры шлюз Azure?
* Такое учетную запись Azure, связанные с несколько каталоги/клиентов?
    * Если сервер: при регистрации приложения Azure AD для Windows Admin Center, был каталог, используемый каталог по умолчанию в Azure? 
* У учетной записи Azure есть доступ к несколько подписок?
* Есть ли у подписку, которую вы использовали подключенные выставления счетов?
* Был выполнен вход несколько учетных записей Azure при обнаружении проблемы?
* Требуется ли многофакторная проверка подлинности учетной записи Azure?
* — Компьютер, вы пытаетесь отладить Машине Azure?
* Windows Admin Center устанавливается на виртуальной Машине Azure?

[[в начало]](#toc)

<a id="filebug"></a>

## По-прежнему не работает или ваша проблема здесь не фиксируются? [часто задаваемые вопросы по устранению неполадок]

Перейдите в средство "Просмотр событий" > "Приложения и службы" > Microsoft-ServerManagementExperience и проверьте наличие каких-либо ошибок и предупреждений.

Отправьте сообщение об ошибке в разделе [UserVoice](https://windowsserver.uservoice.com/forums/295071/category/319162?query=%5BBug%5D) с описанием проблемы.

Укажите все ошибки и предупреждения, которые удастся найти в журнале событий, а также следующие сведения: 

* Платформа, на которой **установлен** Windows Admin Center (Windows 10 или Windows Server):
    * Если установлен на сервере, что такое Windows [версии](#winvercompat) **компьютера под управлением браузера** для доступа к Windows Admin Center: 
    * Вы используете самозаверяющий сертификат, созданный с помощью установщика?
    * Если вы используете свой собственный сертификат, соответствует ли имя субъекта компьютеру?
    * Если вы используете свой собственный сертификат, указано ли в нем альтернативное имя субъекта?
* Выполнена ли установка с настройками порта по умолчанию?
    * В противном случае, какой порт был указан?
* Компьютер, где **установлен** Windows Admin Center, присоединен к домену?
* [Версия](#winvercompat) Windows, где **установлен** Windows Admin Center:
* Присоединен ли компьютер, который вы **пытаетесь отладить**, к домену?
* [Версия](#winvercompat) Windows AC на компьютере, который вы **пытаетесь отладить**:
* Какой браузер вы используете?
    * Если вы используете Google Chrome, какая у него версия? (Справка > О Google Chrome)

[[в начало]](#toc)