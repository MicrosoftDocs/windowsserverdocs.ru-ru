---
title: Использование автоматической адресации TCP/IP без DHCP-сервера
description: Познакомьтесь с использованием автоматической адресации TCP/IP без DHCP-сервера.
manager: dcscontentpm
ms.date: 5/26/2020
ms.topic: troubleshooting
author: Deland-Han
ms.author: delhan
ms.reviewer: robsmi
ms.openlocfilehash: eb8a21fc999ce4f6c5953634dcfdc692b9dd0608
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97948550"
---
# <a name="how-to-use-automatic-tcpip-addressing-without-a-dhcp-server"></a>Использование автоматической адресации TCP/IP без DHCP-сервера

В этой статье описывается, как использовать автоматическую адресацию протокола управления передачей или протокола Интернета (TCP/IP) без наличия в сети сервера DHCP. Версии операционной системы, перечисленные в разделе "применимо к" этой статьи, имеют функцию автоматического назначения частных IP-адресов (APIPA). С помощью этой функции компьютер Windows может назначить себе IP-адрес в случае, если DHCP-сервер недоступен или не существует в сети. Эта функция делает настройку и поддержку небольшой локальной сети (LAN), использующей протокол TCP/IP, менее сложной.

## <a name="more-information"></a>Дополнительные сведения

> [!IMPORTANT]
> Внимательно выполните действия, описанные в этом разделе. Неправильное изменение реестра может привести к серьезным проблемам. Перед внесением изменений [создайте резервную копию реестра для его восстановления](https://support.microsoft.com/help/322756) в случае возникновения проблем.

Компьютер под управлением Windows, настроенный на использование DHCP, может автоматически назначать себе IP-адрес, если DHCP-сервер недоступен. Например, это может произойти в сети без DHCP-сервера или в сети, если DHCP-сервер временно отключен для обслуживания.

Служба Assigned Numbers Authority (IANA) заблокировала 169.254.0.0-169.254.255.255 для автоматического назначения частных IP-адресов. В результате APIPA предоставляет адрес, который гарантирует не конфликт с направляемыми адресами.

После того, как сетевому адаптеру был назначен IP-адрес, компьютер может использовать протокол TCP/IP для взаимодействия с любым другим компьютером, подключенным к той же локальной сети, который также настроен для APIPA или IP-адрес вручную задан как 169.254. x. y (где x. y — уникальный идентификатор клиента) с маской подсети 255.255.0.0. Обратите внимание, что компьютер не может взаимодействовать с компьютерами в других подсетях или с компьютерами, которые не используют автоматическую частных IP-адресов. Автоматическая Частная IP-адресация включена по умолчанию.

Вы можете отключить его в любом из следующих случаев.

- В сети используются маршрутизаторы.

- Сеть подключена к Интернету без NAT или прокси-сервера.

Если сообщения, связанные с DHCP, отключены, сообщения DHCP предоставляют уведомления при переходе между DHCP-адресацией и автоматической частной IP-адресацией. Если сообщения DHCP случайно отключены, можно включить их снова, изменив значение Попупфлаг в следующем разделе реестра с 00 на 01: `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\VxD\DHCP`

Обратите внимание, что для вступления изменений в силу необходимо перезагрузить компьютер. Можно также определить, использует ли компьютер APIPA с помощью средства Winipcfg в Windows Millennium Edition, Windows 98 или Windows 98 Second Edition:

Нажмите кнопку Пуск, выберите команду выполнить, введите Winipcfg (без кавычек) и нажмите кнопку ОК. Щелкните Дополнительные сведения. Если поле адрес автоматической настройки IP-адресов содержит IP-адрес в диапазоне 169.254. x. x, автоматическое назначение частных IP-адресов включено. Если поле IP-адрес существует, автоматическая Частная IP-адресация в настоящее время не включена.
Для Windows 2000, Windows XP или Windows Server 2003 можно определить, использует ли компьютер APIPA, выполнив команду IPconfig в командной строке:

Нажмите кнопку Пуск, выберите команду выполнить, введите "cmd" (без кавычек), а затем нажмите кнопку ОК, чтобы открыть окно командной строки MS-DOS. Введите команду ipconfig/all (без кавычек), а затем нажмите клавишу ВВОД. Если в строке "Автонастройка включена" указано "Да", а "IP-адрес автонастройки" — 169.254. x. y (где x. y — уникальный идентификатор клиента), компьютер использует APIPA. Если в строке "Автонастройка включена" указано "нет", компьютер в настоящее время не использует APIPA.
Вы можете отключить автоматическое назначение частных IP-адресов, используя любой из следующих методов.

Сведения о TCP/IP можно настроить вручную, что полностью отключает DHCP. Вы можете отключить автоматическое назначение частных IP-адресов (но не DHCP), отредактировав реестр. Это можно сделать, добавив запись реестра DWORD "Ипаутоконфигуратионенаблед" со значением 0x0 в следующий раздел реестра для Windows Millennium Edition, Windows98 или Windows 98 Second Edition:  `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\VxD\DHCP`

Для Windows 2000, Windows XP и Windows Server 2003 можно отключить APIPA, добавив запись реестра DWORD «Ипаутоконфигуратионенаблед» со значением 0x0 в следующий раздел реестра: `HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\<Adapter GUID>`
> [!NOTE]
> Подраздел **GUID адаптера** является глобальным уникальным идентификатором (GUID) для адаптера локальной сети компьютера.

При указании значения 1 для записи DWORD Ипаутоконфигуратионенаблед будет включено APIPA, что является состоянием по умолчанию, если это значение не указано в реестре.

## <a name="examples-of-where-apipa-may-be-useful"></a>Примеры того, где можно использовать APIPA

### <a name="example-1-no-previous-ip-address-and-no-dhcp-server"></a>Пример 1. нет предыдущего IP-адреса и DHCP-сервера

При инициализации компьютера под управлением Windows (настроенного для DHCP) он выполняет вещание трех или более "Discover" сообщений. Если DHCP-сервер не отвечает после передачи нескольких сообщений Discover, компьютер Windows назначает себе адрес класса B (APIPA). Затем компьютер Windows отобразит сообщение об ошибке для пользователя компьютера (ему не был назначен IP-адрес с DHCP-сервера в прошлом). После этого компьютер Windows будет отсылать сообщение Discover каждые три минуты при попытке установить связь с DHCP-сервером.

### <a name="example-2-previous-ip-address-and-no-dhcp-server"></a>Пример 2. предыдущий IP-адрес без DHCP-сервера

Компьютер проверяет наличие DHCP-сервера и, если он не найден, предпринимается попытка обратиться к шлюзу по умолчанию. При ответе шлюза по умолчанию компьютер Windows будет хранить IP-адрес, который ранее был арендован. Однако если компьютер не получает ответ от шлюза по умолчанию или не назначен, то он использует функцию автоматического частного IP-адресации, чтобы назначить себе IP-адрес. Пользователю предоставляется сообщение об ошибке, и сообщения обнаружения передаются каждые 3 минуты. Когда DHCP-сервер поступает в строке, создается сообщение о том, что обмен данными с DHCP-сервером был восстановлен.

### <a name="example-3-lease-expires-and-no-dhcp-server"></a>Пример 3. срок действия аренды истекает и DHCP-сервер отсутствует

Компьютер под управлением Windows пытается повторно установить аренду IP-адреса. Если компьютер Windows не находит сервер DCHP, он назначает себе IP-адрес после создания сообщения об ошибке. Затем компьютер передает четыре сообщения Discover и через каждые 5 минут повторяет всю процедуру до тех пор, пока DHCP-сервер не выйдет из системы. После этого создается сообщение о том, что обмен данными с DHCP-сервером был восстановлен.
