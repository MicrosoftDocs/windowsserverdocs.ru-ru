---
title: Устранение проблем с кластером с ИД события 1135
description: В этой статье описывается, как устранять неполадки при запуске службы кластеров с событием с ИДЕНТИФИКАТОРом 1135.
ms.date: 05/28/2020
ms.openlocfilehash: 73357cc5b696a969de82123d3ca2a6fbb36fdc40
ms.sourcegitcommit: ef089864980a1d4793a35cbf4cbdd02ce1962054
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/28/2020
ms.locfileid: "84150462"
---
# <a name="troubleshooting-cluster-issue-with-event-id-1135"></a>Устранение проблем с кластером с ИД события 1135

Эта статья поможет вам диагностировать и разрешать события с ИДЕНТИФИКАТОРом 1135, которые могут регистрироваться во время запуска служба кластеров в среде отказоустойчивой кластеризации.

В этой статье содержатся сведения о разрешении

## <a name="start-page"></a>Начальная страница

Событие с ИДЕНТИФИКАТОРом 1135 указывает на то, что один или несколько узлов кластера были удалены из активного членства отказоустойчивого кластера. Возможно, он сопровождается следующими симптомами.

- Фаиловер\нодес кластера удаляется из активного членства отказоустойчивого кластера: [возникла проблема с узлами, удаляемыми из активного членства отказоустойчивого кластера](/problem-nodes-failover-cluster.md)
- ИД события 1069 [, ИД события 1069 — доступность службы или приложения в службе кластеров](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc756225(v=ws.10))
- Идентификатор события 1177 для события потери кворума [1177 — кворум и подключение, необходимые для кворума](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc773498(v=ws.10))
- Событие с ИДЕНТИФИКАТОРом 1006 для служба кластеров остановлено: [событие с ид 1006 — запуск службы кластеров](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc773418(v=ws.10))

Проверка и тестирование сети рекомендуется использовать в качестве одного из начальных шагов по устранению неполадок конфигурации, которые могут быть причиной проблем.

### <a name="check-if-installed-the-recommended-hot-fixes"></a>Проверьте, установлены ли Рекомендуемые исправления

Служба кластеров — это важный компонент программного обеспечения, который управляет всеми аспектами работы отказоустойчивого кластера и управляет базой данных конфигурации кластера. Если отображается событие с ИДЕНТИФИКАТОРом 1135, корпорация Майкрософт рекомендует установить исправления, упомянутые в статьях базы знаний, и перезагрузить все узлы кластера, а затем проверить, не возникает ли проблема.

- [Исправление для Windows Server 2012 R2](https://support.microsoft.com/help/2920151)
- [Исправление для Windows Server 2012](https://support.microsoft.com/help/2784261)
- [Исправление для Windows Server 2008 R2](https://support.microsoft.com/help/2545685)

### <a name="check-if-the-cluster-service-running-on-all-the-nodes"></a>Проверьте, работает ли служба кластеров на всех узлах.

Выполните следующую команду в соответствии с операционной системой Windows, чтобы убедиться, что служба кластеров непрерывно работает и доступна.

#### <a name="for-windows-server-2008-r2-cluster"></a>Для кластера Windows Server 2008 R2

в командной строке с повышенными привилегиями выполните команду **cluster. exe/стат** .  

#### <a name="for-windows-server-2012-and-windows-server-2012-r2-cluster"></a>Для кластера Windows Server 2012 и Windows Server 2012 R2

выполнение команды PS: " **узел кластера"/Status**  

Служба кластеров непрерывно работает и доступна на всех узлах?

## <a name="solution-for-cluster-service-is-failing"></a>Сбой решения для службы кластеров

Если служба кластеров не работает, выполните устранение неполадок с помощью этой статьи: [Параметры запуска отказоустойчивого кластера Windows Server 2008 и 2008R2](/archive/blogs/askcore/windows-server-2008-and-2008r2-failover-cluster-startup-switches).


## <a name="several-scenarios-of-event-id-1135"></a>Несколько сценариев с ИДЕНТИФИКАТОРом события 1135

Мы хотим более подробно рассмотреть журналы системных событий на всех узлах кластера. Проверьте событие с ИДЕНТИФИКАТОРом 1135, которое вы видите на узлах, и скопируйте все экземпляры этого события. Это позволит вам легко просматривать их и просматривать.

```console
Event ID 1135
Cluster node ' **NODE A** ' was removed from the active failover cluster membership. The Cluster service on this node may have stopped. This could also be due to the node having lost communication with other active nodes in the failover cluster. Run the Validate a Configuration wizard to check your network configuration. If the condition persists, check for hardware or software errors related to the network adapters on this node. Also check for failures in any other network components to which the node is connected such as hubs, switches, or bridges.
```

Существует три типичных сценария:

### <a name="scenario-a"></a>Сценарий А

Вы видите все события и все узлы в кластере, указывающие, что узел A потерял связь.

![Сценарий. ](media/troubleshooting-cluster-event-id-1135/18647.png)
 ![ сценарий a](media/troubleshooting-cluster-event-id-1135/18648.png)

Возможно, при просмотре системных журналов на узле A у него есть события для всех оставшихся узлов в кластере.

#### <a name="solution"></a>Решение

Это означает, что во время проблемы происходит из-за перегрузки сети или в противном случае потери связи с УЗЛОМ A.

Следует проверить и проверить конфигурацию сети и проблемы связи. Не забывайте искать проблемы, относящиеся к узлу A.

### <a name="scenario-b"></a>Сценарий Б

Вы просматриваете события на узлах и сообщите, что кластер распределен между двумя сайтами. УЗЕЛ A, узел B и узел C на сайте 1 и узле D & узле E на сайте 2.

![Сценарий Б](media/troubleshooting-cluster-event-id-1135/18649.png)

На узлах A, B и C видно, что регистрируемые события предназначены для подключения к узлам D & E. Аналогично, когда вы видите события на узлах D & E, события предполагают, что мы потеряли связь с A, B и C.

![Сценарий Б](media/troubleshooting-cluster-event-id-1135/18650.png)

#### <a name="solution"></a>Решение

Если вы видите похожие действия, это означает, что произошла ошибка связи, по ссылке, соединяющей эти сайты. Рекомендуется проанализировать подключение между сайтами, если это происходит через подключение к глобальной сети. Мы рекомендуем вам проверить подключение к поставщику услуг Интернета.

### <a name="scenario-c"></a>Сценарий в

Вы просматриваете события на узлах и видите, что имена узлов не имеют определенного шаблона. Предположим, что кластер распределен между двумя сайтами. УЗЕЛ A, узел B и узел C на сайте 1 и узле D & узле E на сайте 2.

- На узле A: отображаются события для узлов B, D, E.
- На узле б отображаются события для узлов C, D, E.
- На узле C: отображаются события для узлов A, B, E.
- На узле D отображаются события для узлов A, C, E.
- На узле E отображаются события для узлов B, C, D.
- Или любые другие сочетания.

![Сценарий в](media/troubleshooting-cluster-event-id-1135/18651.png)

#### <a name="solution"></a>Решение

Такие события возможны, когда сетевые каналы между узлами находятся в режиме треппинга и обмен сообщениями между кластерами не достигается своевременно, что позволяет кластеру покажется, что связь между узлами будет потеряна, что приведет к удалению узлов из членства в кластере.

## <a name="review-cluster-networks"></a>Проверка сетей кластера

Рекомендуется проанализировать кластерные сети, проверив следующие три варианта по одному, чтобы продолжить это руководство по устранению неполадок.

### <a name="check-for-antivirus-exclusion"></a>Проверка на наличие исключений антивирусных программ

Исключите следующие расположения файловой системы из поиска вирусов на сервере, на котором работают службы кластеров:

- Путь к ресурсу-свидетелю общей папки

- *Папка%системрут%\клустер*

Настройте компонент сканирования в режиме реального времени в антивирусной программе, чтобы исключить следующие каталоги и файлы:

- Каталог конфигурации виртуальной машины по умолчанию (К:\програмдата\микрософт\виндовс\хипер-в)

- Пользовательские каталоги конфигурации виртуальных машин

- Каталог виртуального жесткого диска по умолчанию (жесткие диски К:\усерс\публик\документс\хипер-в\виртуал)

- Каталоги настраиваемых виртуальных жестких дисков

- Пользовательские каталоги данных репликации, если используется реплика Hyper-V

- Каталоги моментальных снимков

- MMS. exe

    > [!NOTE]
    > Этот файл может быть настроен в качестве исключения процесса в антивирусном программном обеспечении.)

- Вмвп. exe

    > [!NOTE]
    > Этот файл может быть настроен в качестве исключения процесса в антивирусном программном обеспечении.

Кроме того, при использовании динамическая миграция вместе с общими томами кластера исключите путь CSV *C:\Clusterstorage* и все его подкаталоги. При устранении неполадок, связанных с отработкой отказа, или общих проблем с службами кластеров и антивирусной программой, временно удалите антивирусную программу или обратитесь к производителю программного обеспечения, чтобы определить, работает ли антивирусная программа со службами кластеров. В большинстве случаев недостаточное Отключение антивирусного программного обеспечения. Даже при отключении антивирусной программы драйвер фильтра по-прежнему загружается при перезагрузке компьютера.

### <a name="check-for-network-port-configuration-in-firewall"></a>Проверка конфигурации сетевого порта в брандмауэре

Служба кластеров управляет работой кластера серверов и управляет базой данных кластера. Кластер — это набор независимых компьютеров, выступающих в роли одного компьютера. Руководители, программисты и пользователи видят кластер как единую систему. Программное обеспечение распределяет данные между узлами кластера. В случае сбоя узла другие узлы предоставляют службы и данные, которые ранее были предоставлены отсутствующим узлом. При добавлении или восстановлении узла программное обеспечение кластера переносит некоторые данные на этот узел.

Имя системной службы: **ClusSvc**  

|Развертывание|Протокол|порты;|
|---|---|---|
|Служба кластеров|UDP|3343|
|Служба кластеров|TCP|3343 (этот порт необходим во время операции присоединение узла.)|
|RPC|TCP|135|
|Администратор кластера|UDP|137|
|Kerberos|удп\ткп|464 *|
|SMB|TCP|445|
|Произвольно выделенные порты UDP с высоким уровнем доступности * *|UDP|Случайный номер порта в диапазоне от 1024 до 65535<br/>Случайный номер порта в диапазоне от 49152 до 65535 * * *|
||||

> [!NOTE]
> Кроме того, для успешной проверки отказоустойчивых кластеров Windows на Windows Server 2008 и более поздних версий разрешите входящий и исходящий трафик для ICMP4, ICMP6.

- Дополнительные сведения см. в статье [сбой создания отказоустойчивого кластера Windows Server 2012 с ошибкой 0xc000005e](https://support.microsoft.com/help/2830510).

- Дополнительные сведения о настройке этих портов см. в разделе [Общие сведения о службе и требования к сетевым портам для Windows](https://support.microsoft.com/help/832017/) раздела "ссылки".

Это диапазон в Windows Server 2012, Windows 8, Windows Server 2008 R2, Windows 7, Windows Server 2008 и Windows Vista.

Кроме того, выполните следующую команду, чтобы проверить конфигурацию сетевого порта в брандмауэре. Пример. Эта команда помогает определить порт 3343 аваилабле\опен, используемый для отказоустойчивого кластера:

```console
netsh advfirewall firewall show rule name="Failover Clusters (UDP-In)" verbose
```

### <a name="run-the-cluster-validation-report-for-any-errors-or-warnings"></a>Запуск отчета о проверке кластера для любых ошибок или предупреждений

Средство проверки кластера выполняет набор тестов, чтобы убедиться, что оборудование и параметры совместимы с отказоустойчивой кластеризацией.

Следуйте указаниям, приведенным ниже:

1. Запустите отчет о проверке кластера для любых ошибок или предупреждений. Дополнительные сведения см. в разделе [Основные сведения о тестах проверки кластера: сеть.](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc771323(v=ws.11)?redirectedfrom=MSDN)

    ![subhatt1](media/troubleshooting-cluster-event-id-1135/18653.png)

2. Проверьте наличие предупреждений и ошибок для сетей. Дополнительные сведения см. в разделе [Основные сведения о тестах проверки кластера: сеть](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc771323(v=ws.11)?redirectedfrom=MSDN).

    ![Результаты по категории " ](media/troubleshooting-cluster-event-id-1135/18654.png) ![ сеть"](media/troubleshooting-cluster-event-id-1135/18655.png)

#### <a name="check-the-list-network-binding-order"></a>Проверьте список порядка привязки к сети.

Этот тест перечисляет порядок, в котором сети привязаны к адаптерам на каждом узле.

На вкладке Адаптеры и привязки перечислены соединения в порядке, в котором доступ к подключениям осуществляется сетевыми службами. Порядок этих подключений отражает порядок, в котором универсальные вызовы TCP/IP/пакеты передаются на канал передачи.

Чтобы изменить порядок привязки сетевых адаптеров, выполните указанные ниже действия.

1. Нажмите кнопку **Пуск**, выберите пункт **выполнить**, введите ncpa. cpl и нажмите кнопку **ОК**. Доступные подключения можно просмотреть в разделе **Локальная сеть и высокоскоростной Интернет** окна **Сетевые подключения** .

2. В меню **Дополнительно** выберите **Дополнительные параметры**, а затем перейдите на вкладку **адаптеры и привязки** .

3. В области **подключения** выберите подключение, которое нужно переместить выше в списке. Для перемещения соединения используйте кнопки со стрелками. Как правило, карта, которая взаимодействует с сетью (подключение к домену, маршрутизация в другие сети и т. д.), должна быть первой границей карты (вверху списка).

Узлы кластера являются несколькими сетевыми системами. Приоритет сети влияет на DNS-клиент для исходящего сетевого подключения. Сетевые адаптеры, используемые для связи с клиентами, должны находиться вверху в порядке привязки. Ненаправляемые сети можно разместить с низким приоритетом. В Windows Server 2012 и Windows Server2012 R2 — драйвер сети кластера (NETFT. SYS) адаптер автоматически помещается в нижнюю часть списка порядка привязки.

#### <a name="check-the-validate-network-communication"></a>Проверка сетевого взаимодействия

Причиной этого может быть задержка в сети. Пакеты могут не быть потеряны между узлами, но они могут не получить достаточно быстрых узлов до истечения времени ожидания.

Эта проверка позволяет проверить, что проверенные серверы могут взаимодействовать с допустимой задержкой во всех сетях.

Например, в разделе Проверка сетевого взаимодействия могут отображаться следующие сообщения о проблемах задержки сети.

```console
Succeeded in pinging network interface node003.contoso.com IP Address 192.168.0.2 from network interface node004.contoso.com IP Address 192.168.0.3 with maximum delay 500 after 1 attempt(s).
Either address 10.0.0.96 is not reachable from 192.168.0.2 or **the ping latency is greater than the maximum allowed 2000 ms** This may be expected, since network interfaces node003.contoso.com - Heartbeat Network and node004.contoso.com - Production Network are on different cluster networks
Either address 192.168.0.2 is not reachable from 10.0.0.96 or **the ping latency is greater than the maximum allowed 2000 ms** This may be expected, since network interfaces node004.contoso.com - Production Network and node003.contoso.com - Heartbeat Network for MSCS are on different cluster networks
```

Для многосайтового кластера вы можете увеличить значения времени ожидания. Дополнительные сведения см. [в статье Настройка параметров пульса и DNS в отказоустойчивом кластере с несколькими сайтами](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd197562(v=ws.10)?redirectedfrom=MSDN).

Проверьте у ISP наличие проблем с подключением к глобальной сети.

Проверьте, возникают ли какие либо из следующих проблем.

##### <a name="network-packets-lost-between-nodes"></a>Потеряны сетевые пакеты между узлами

1. Проверка потери пакетов с помощью производительности

    Если пакет теряет связь между узлами, произойдет сбой пульса. Мы легко можем выяснить, является ли это проблемой, используя системный монитор для просмотра счетчика "сетевой Интерфаце\паккетс получено". После добавления этого счетчика проверьте среднее, минимальное и максимальное числа и, если они имеют любое значение больше нуля, для адаптера необходимо настроить буфер приема.

    ![Добавить счетчики](media/troubleshooting-cluster-event-id-1135/18652.png)

    Если сетевой пакет потерян на платформе виртуализации VmWare, см. раздел "кластер, установленный на платформе виртуализации VmWare".

2. Обновление драйверов сетевых адаптеров

    Эта проблема может возникать из-за устаревших сетевых адаптеров Дриверс\интегратион (IC) \Вмтулс или неисправного сетевого адаптера.
    Если между узлами на физических компьютерах потеряны сетевые пакеты, обновите драйвер сетевого адаптера. Устаревшие или устаревшие драйверы сетевой карты и/или встроенное по.
    Иногда непростая Настройка сетевой карты или коммутатора также может привести к потере пульса.

##### <a name="cluster-installed-in-the-vmware-virtualization-platform"></a>Кластер, установленный на платформе виртуализации VmWare

Проверьте проблемы с адаптером VMware в случае среды VMware. 

Эта проблема может возникать, если пакеты удаляются при высоких нагрузках на трафик. Убедитесь в отсутствии фильтрации трафика (например, с помощью фильтра почты). После устранения этой возможности постепенно увеличивают количество буферов в гостевой операционной системе и проверяйте их.

Чтобы сократить число сбросов нагрузки, выполните следующие действия.

1. Откройте окно Запуск с помощью клавиши Windows + R.
2. Введите devmgmt. msc и нажмите клавишу **Ввод**.
3. Разверните узел **Сетевые адаптеры** .  
4. Щелкните правой кнопкой мыши **vmxnet3 и выберите пункт Свойства.**  
5. Перейдите на вкладку **Дополнительно**.
6. Щелкните **маленькие буферы RX** и увеличьте значение. Значение по умолчанию — 512, а максимальное — 8192.
7. Щелкните **RX Ring #1** размер и увеличьте значение. Значение по умолчанию — 1024, а максимальное — 4096.

Проверьте следующие URL-адреса, чтобы проверить проблемы с адаптером VMware в случае среды VMware:

- [Узлы, удаляемые из состава отказоустойчивого кластера в VMware ESX?](/archive/blogs/askcore/nodes-being-removed-from-failover-cluster-membership-on-vmware-esx).

- [Большая потеря пакетов на уровне операционной системы на виртуальной машине в VMXNET3 vNIC в ESXi](https://kb.vmware.com/s/article/2039495)

##### <a name="noticed-any-network-congestion"></a>Замечена любая перегрузка сети

Перегрузка сети также может вызвать проблемы с сетевым подключением.

Проверка конфигурации сети в соответствии с рекомендациями Майкрософт и поставщиками см. в разделе [Настройка сетей отказоустойчивого кластера Windows](/archive/blogs/askcore/configuring-windows-failover-cluster-networks).

##### <a name="check-the-network-configuration"></a>Проверка конфигурации сети

Если он по-прежнему не работает, проверьте наличие секционированной сети в графическом интерфейсе кластера или включите объединение сетевых карт в сетевом адаптере пульса.

Если вы видите раздел "секционированные сети" в графическом интерфейсе кластера, ознакомьтесь с [разделом "секционированные" кластерные сети](/archive/blogs/askcore/partitioned-cluster-networks) , чтобы устранить проблему.

Если на сетевом адаптере пульса включено объединение сетевых карт, ознакомьтесь с рекомендацией по работе с программным обеспечением для групп в соответствии с рекомендациями поставщика группы.

##### <a name="upgrade-the-nic-drivers"></a>Обновление драйверов сетевых адаптеров

Эта проблема может возникать из-за устаревших драйверов сетевых адаптеров или неисправных сетевых адаптеров.

Если между узлами на физических компьютерах потеряны сетевые пакеты, обновите драйвер сетевого адаптера. Устаревшие или устаревшие драйверы сетевой карты и/или встроенное по.

Иногда непростая Настройка сетевой карты или коммутатора также может привести к потере пульса.

##### <a name="check-the-network-configuration"></a>Проверка конфигурации сети

Если он по-прежнему не работает, проверьте, не была ли обнаружена секционированная сеть в графическом интерфейсе кластера, или включено объединение сетевых карт на сетевом адаптере пульса.
