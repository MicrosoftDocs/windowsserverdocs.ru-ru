---
ms.date: 09/27/2018
ms.topic: conceptual
keywords: OpenSSH, SSH, SSHD, установка, установка
contributor: maertendMSFT
ms.product: w10
author: maertendMSFT
title: Конфигурация сервера OpenSSH для Windows
ms.openlocfilehash: ed424c33c4cd2c19a9b5e985ab6083bcbcb9fbdc
ms.sourcegitcommit: 0467b8e69de66e3184a42440dd55cccca584ba95
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/16/2019
ms.locfileid: "69546262"
---
# <a name="openssh-server-configuration-for-windows-10-1809-and-server-2019"></a>Конфигурация сервера OpenSSH для Windows 10 1809 и сервера 2019

В этом разделе рассматривается Конфигурация Windows для сервера OpenSSH (sshd). 

OpenSSH поддерживает подробную документацию по параметрам конфигурации в Интернете по адресу [OpenSSH.com](https://www.openssh.com/manual.html), который не дублируется в этом наборе документации. 

## <a name="configuring-the-default-shell-for-openssh-in-windows"></a>Настройка оболочки по умолчанию для OpenSSH в Windows

Командная оболочка по умолчанию предоставляет пользователю возможности, отображаемые при подключении к серверу с помощью SSH. Начальными окнами по умолчанию является Командная оболочка Windows (cmd. exe). Windows также включает PowerShell и bash, и оболочки команд сторонних производителей также доступны для Windows и могут быть настроены в качестве оболочки по умолчанию для сервера.

Чтобы задать командную оболочку по умолчанию, сначала убедитесь, что папка установки OpenSSH находится в системном пути. Для Windows папка установки по умолчанию — SystemDrive: WindowsDirectory\System32\openssh. Следующие команды показывают текущий параметр пути и добавляют к ней папку установки по умолчанию OpenSSH. 

Командная оболочка | Используемая команда
------------- | -------------- 
Command | path
PowerShell | $env:p ь

Настройка оболочки SSH по умолчанию выполняется в реестре Windows путем добавления полного пути к исполняемому файлу оболочки в Computer\HKEY_LOCAL_MACHINE\SOFTWARE\OpenSSH в строковом значении Дефаултшелл. 

Например, следующая команда PowerShell устанавливает оболочку по умолчанию как PowerShell. exe:

```powershell
New-ItemProperty -Path "HKLM:\SOFTWARE\OpenSSH" -Name DefaultShell -Value "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -PropertyType String -Force
```

## <a name="windows-configurations-in-sshd_config"></a>Конфигурации Windows в sshd_config 

В Windows sshd считывает данные конфигурации из%ProgramData%\ssh\sshd_config по умолчанию или можно указать другой файл конфигурации, запустив sshd. exe с параметром-f.
Если файл отсутствует, sshd создает его с конфигурацией по умолчанию при запуске службы.

Перечисленные ниже элементы предоставляют конфигурацию Windows, которая может быть представлена в записях в sshd_config. Существуют другие параметры конфигурации, которые не перечислены здесь, так как они подробно описаны в [документации по Win32 OpenSSH](https://github.com/powershell/win32-openssh/wiki)в Интернете. 


### <a name="allowgroups-allowusers-denygroups-denyusers"></a>Алловграупс, Алловусерс, Дениграупс, Денюсерс 

Управление тем, какие пользователи и группы могут подключаться к серверу, осуществляется с помощью директив Алловграупс, Алловусерс, Дениграупс и Денюсерс. Директивы allow/deny обрабатываются в следующем порядке: Денюсерс, Алловусерс, Дениграупс и, наконец, Алловграупс. Все имена учетных записей должны быть указаны в нижнем регистре. Дополнительные сведения о шаблонах для подстановочных знаков см. в разделе ЗАКОНОМЕРНОсти в ssh_config.

При настройке правил на основе пользователя или группы с пользователем или группой домена используйте следующий формат: ``` user?domain* ```.
Windows поддерживает несколько форматов для указания субъектов домена, но многие конфликтуют со стандартными шаблонами Linux. По этой причине * добавляется в подопределение полных доменных имен. Кроме того, этот подход использует "?" вместо @, чтобы избежать конфликтов с username@host форматом. 

Пользователи и группы рабочей группы, а также подключенные к Интернету учетные записи всегда разрешаются по имени локальной учетной записи (нет части домена, похожей на стандартные имена UNIX). Пользователи и группы домена строго разрешаются в формате [намесамкомпатибле](https://docs.microsoft.com/windows/desktop/api/secext/ne-secext-extended_name_format) -domain_short_name\user_name. Все правила конфигурации на основе пользователей и групп должны соответствовать этому формату.

Примеры для пользователей и групп домена 

```
DenyUsers contoso\admin@192.168.2.23 : blocks contoso\admin from 192.168.2.23
DenyUsers contoso\* : blocks all users from contoso domain
AllowGroups contoso\sshusers : only allow users from contoso\sshusers group
```

Примеры для локальных пользователей и групп 

```
AllowUsers localuser@192.168.2.23
AllowGroups sshusers
```

### <a name="authenticationmethods"></a>аусентикатионмесодс 

Для Windows OpenSSH единственными доступными методами проверки подлинности являются "Password" и "PublicKey".

### <a name="authorizedkeysfile"></a>аусоризедкэйсфиле 

Значение по умолчанию — ". ssh/authorized_keys. ssh/authorized_keys2". Если путь не является абсолютным, он принимается относительно домашнего каталога пользователя (или пути к образу профиля). Символа. к:\усерс\усер.

### <a name="chrootdirectory-support-added-in-v7700"></a>Чрутдиректори (поддержка добавлена в версии v 7.7.0.0)

Эта директива поддерживается только для сеансов SFTP. Удаленный сеанс в cmd. exe не соблюдается. Чтобы настроить сервер чрут только SFTP, задайте для Форцекомманд значение Internal-SFTP. Вы также можете настроить SCP с помощью чрут, реализовав пользовательскую оболочку, которая будет разрешать только SCP и SFTP.

### <a name="hostkey"></a>HostKey

Значения по умолчанию:% папка ProgramData%/SSH/ssh_host_ecdsa_key,% папка ProgramData%/SSH/ssh_host_ed25519_key и% папка ProgramData%/SSH/ssh_host_rsa_key. Если значения по умолчанию отсутствуют, sshd автоматически создает их при запуске службы.

### <a name="match"></a>Сопоставление

Обратите внимание на правила шаблона в этом разделе. Имена пользователей и групп должны быть в нижнем регистре.

### <a name="permitrootlogin"></a>пермитрутлогин

Неприменимо в Windows. Чтобы предотвратить вход администратора, используйте администраторы с директивой Дениграупс.

### <a name="syslogfacility"></a>сислогфаЦилити

Если требуется ведение журнала на основе файлов, используйте LOCAL0. Журналы создаются в разделе%програмдата%\сш\логс.
Любое другое значение, включая проверку подлинности по умолчанию, направляет ведение журнала в ETW. Дополнительные сведения см. в статье средства ведения журнала в Windows.

### <a name="not-supported"></a>Не поддерживается. 

Следующие параметры конфигурации недоступны в версии OpenSSH, которая поставляется в Windows Server 2019 и Windows 10 1809:

* акцептенв
* алловстреамлокалфорвардинг
* аусоризедкэйскомманд
* аусоризедкэйскоммандусер
* аусоризедпринЦипалскомманд
* аусоризедпринЦипалскоммандусер
* сжатие;
* експосеаусинфо
* гссапиаусентикатион
* гссапиклеанупкредентиалс
* гссапистриктакцепторчекк
* хостбаседакцептедкэйтипес
* хостбаседаусентикатион
* хостбаседусеснамефромпаккетонли
* игнорерхостс
* игнореусеркновнхостс
* кбдинтерактивеаусентикатион
* керберосаусентикатион
* керберосжетафстокен
* керберосорлокалпассвд
* керберостиккетклеануп
* пермиттуннел
* пермитусеренвиронмент
* пермитусеррк
* пидфиле
* принтластлог
* рдомаин
* стреамлокалбиндмаск
* стреамлокалбиндунлинк
* стриктмодес
* X11DisplayOffset
* X11Forwarding
* X11UseLocalhost
* ксауслокатион

