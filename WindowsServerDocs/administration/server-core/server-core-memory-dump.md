---
title: Настройка файлов дампа памяти для установки основных серверных компонентов
description: Сведения о настройке файлов дампа памяти для установки основных серверных компонентов Windows Server
ms.prod: windows-server-threshold
ms.mktglfcycl: manage
ms.sitesec: library
author: lizap
ms.localizationpriority: medium
ms.date: 10/17/2017
ms.openlocfilehash: 235df6f681de51a12f82b9fad019dd2db45fd486
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66435548"
---
# <a name="configure-memory-dump-files-for-server-core-installation"></a>Настройка файлов дампа памяти для установки основных серверных компонентов

>Область применения. Windows Server (полугодовой канал) и Windows Server 2016

Следуйте инструкциям ниже, чтобы настроить дамп памяти для установки основных серверных компонентов. 

## <a name="step-1-disable-the-automatic-system-page-file-management"></a>Шаг 1. Отключить управление файлами автоматической системы страницы

Первым шагом является вручную настроить параметры восстановления системы. Это необходимо для выполните оставшиеся шаги.

Выполните следующую команду: 

```
wmic computersystem set AutomaticManagedPagefile=False
```
 
## <a name="step-2-configure-the-destination-path-for-a-memory-dump"></a>Шаг 2. Настройте путь назначения для дампа памяти

Не нужно иметь файл подкачки на секции, в котором установлена операционная система. Чтобы поместить файл подкачки на другой секцией, необходимо создать новую запись реестра с именем **DedicatedDumpFile**. Размер файла подкачки можно определить с помощью **DumpFileSize** запись реестра. Чтобы создать записи реестра DedicatedDumpFile и DumpFileSize, выполните следующие действия. 

1. В командной строке запустите **regedit** команду, чтобы открыть редактор реестра.
2. Найдите и выберите следующий подраздел реестра. HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CrashControl
3. Нажмите кнопку **изменить > New > строковое значение**.
4. Укажите новое значение **DedicatedDumpFile**, и нажмите клавишу ВВОД.
5. Щелкните правой кнопкой мыши **DedicatedDumpFile**, а затем нажмите кнопку **изменить**.
6. В **значение** тип  **\<диска\>:\\\<Dedicateddumpfile.sys\>** , а затем нажмите кнопку **ОК**.

   >[!NOTE] 
   > Замените \<диск\> с на диск, который имеет достаточно дискового пространства для файла подкачки и замените \<Dedicateddumpfile.dmp\> с указанием полного пути в выделенный файл.
 
7. Нажмите кнопку **изменить > New > значение DWORD**.
8. Тип **DumpFileSize**, и нажмите клавишу ВВОД.
9. Щелкните правой кнопкой мыши **DumpFileSize**, а затем нажмите кнопку **изменить**.
10. В **изменение параметра DWORD**в разделе **базы**, нажмите кнопку **десятичное**.
11. В **значение**, введите соответствующее значение и нажмите кнопку **ОК**.
    >[!NOTE]
    > Размер файла дампа содержится в мегабайтах (МБ).
12. Закройте редактор реестра.

После определения секции расположение дампа памяти, настройте конечный путь для файла подкачки. Чтобы просмотреть текущий путь назначения для файла подкачки, выполните следующую команду:

```
wmic RECOVEROS get DebugFilePath
```

Назначение по умолчанию для **DebugFilePath** — % systemroot%\memory.dmp. Чтобы изменить текущий путь назначения, выполните следующую команду:

```
wmic RECOVEROS set DebugFilePath = <FilePath>
```

Задайте \<FilePath\> в целевой путь. Например следующая команда задает путь назначения дампа памяти для C:\WINDOWS\MEMORY. ТОЧКИ УПРАВЛЕНИЯ УСТРОЙСТВАМИ: 

```
wmic RECOVEROS set DebugFilePath = C:\WINDOWS\MEMORY.DMP
```
 
## <a name="step-3-set-the-type-of-memory-dump"></a>Шаг 3. Задайте тип дампа памяти

Определите тип дампа памяти, чтобы настроить для сервера. Чтобы просмотреть текущий тип дампа памяти, выполните следующую команду:

```
wmic RECOVEROS get DebugInfoType
```

Чтобы изменить текущий тип дампа памяти, выполните следующую команду: 

```
wmic RECOVEROS set DebugInfoType = <Value>
```

\<Значение\> может быть 0, 1, 2 или 3, как определено ниже.

- 0: Отключение удаления дамп памяти.
- 1. Полный дамп памяти. Записывает все содержимое системной памяти при непредвиденной остановке компьютера. Полный дамп памяти может содержать данные из процессов, которые были запущены, когда был создан дамп памяти.
- 2. Дамп памяти ядра (по умолчанию). Записывает только память ядра. Это ускоряет процесс записи данных в файл журнала при непредвиденной остановке компьютера.
- 3. Малый дамп памяти. Записывает наименьший набор полезных сведений, которые могут помочь определить, почему компьютер неожиданно остановился.

## <a name="step-4-configure-the-server-to-restart-automatically-after-generating-a-memory-dump"></a>Шаг 4. Настройка сервера на автоматический перезапуск после создания дампа памяти

По умолчанию сервер автоматически перезапустится после создания дампа памяти. Чтобы просмотреть текущую конфигурацию, выполните следующую команду:

```
wmic RECOVEROS get AutoReboot
```

Если значение для **AutoReboot** имеет значение TRUE, сервер перезагрузится автоматически после создания дампа памяти. Настройка не требуется, и можно переходить к следующему шагу.

Если значение для **AutoReboot** имеет значение FALSE, сервер не будет автоматически перезагружен. Выполните следующую команду, чтобы изменить значение:

```
wmic RECOVEROS set AutoReboot = true
```
 
## <a name="step-5-configure-the-server-to-overwrite-the-existing-memory-dump-file"></a>Шаг 5. Настройка сервера для перезаписи существующего файла дампа памяти

По умолчанию сервер перезаписывает существующий файл дампа памяти при создании нового, она будет создана. Чтобы определить, если нужно перезаписать уже настроены существующие файлы дампа памяти, выполните следующую команду:

```
wmic RECOVEROS get OverwriteExistingDebugFile
```

Если значение равно 1, сервер будет перезаписывать существующий файл дампа памяти. Настройка не требуется, и можно перейти к следующему шагу.

Если значение равно 0, сервер не перезаписывает существующий файл дампа памяти. Выполните следующую команду, чтобы изменить значение: 

```
wmic RECOVEROS set OverwriteExistingDebugFile = 1
```
 
## <a name="step-6-set-an-administrative-alert"></a>Шаг 6. Настройка администрирования оповещений

Определить, является ли оповещение соответствующий и задайте **SendAdminAlert** соответствующим образом. Чтобы просмотреть текущее значение для SendAdminAlert, выполните следующую команду:

```
wmic RECOVEROS get SendAdminAlert
```

Возможные значения для SendAdminAlert имеют значение TRUE или FALSE. Чтобы изменить существующее значение SendAdminAlert значение true, выполните следующую команду: 

```
wmic RECOVEROS set SendAdminAlert = true
```
 
## <a name="step-7-set-the-memory-dumps-page-file-size"></a>Шаг 7. Задать размер файла подкачки дамп памяти

Чтобы проверить параметры текущей страницы файла, выполните одну из следующих команд:

   ```
   wmic.exe pagefile
   ```

   или

   ```
   wmic.exe pagefile list /format:list
   ```

Например выполните следующую команду, чтобы настроить исходный и максимальный размеры файла страницы:

```
wmic pagefileset where name="c:\\pagefile.sys" set InitialSize=1000,MaximumSize=5000
```

## <a name="step-8-configure-the-server-to-generate-a-manual-memory-dump"></a>Шаг 8. Настройка сервера для создания дампа памяти вручную

Можно вручную создать дамп памяти с помощью клавиатуры PS/2. Эта функция отключена по умолчанию, и он не доступен для клавиатуры универсальной последовательной шины (USB).

Чтобы включить памяти вручную дампов с помощью клавиатуры PS/2, выполните следующую команду:

```
reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters /v CrashOnCtrlScroll /t REG_DWORD /d 1 /f
```

Чтобы определить, если эта функция работает правильно, выполните следующую команду:

```
Reg query HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ i8042prt \ Parameters / v CrashOnCtrlScroll
```

Необходимо перезапустить сервер, чтобы изменения вступили в силу. Сервер можно перезапустить, выполнив следующую команду:

```
Shutdown / r / t 0
```

Вы можете создать файлы дампа памяти вручную с помощью клавиатуры PS/2, который подключен к серверу, удерживая клавишу CTRL ПРАВОЙ клавиши SCROLL LOCK. Это делает компьютер bug проверка 0xE2 код ошибки. После перезагрузки сервера, в пути назначения, заданные в шаге 2 появится новый файл дампа.

## <a name="step-9-verify-that-memory-dump-files-are-being-created-correctly"></a>Шаг 9. Проверьте, файлов создается правильно дампа памяти

Чтобы убедиться, что правильно создаются файлы дампа памяти можно использовать утилиту dumpchk.exe. Программа dumpchk.exe не установлено с вариантом установки основных серверных компонентов, поэтому вам придется запустить его с сервера с возможностями рабочего стола или из Windows 10. Кроме того необходимо установить средства отладки для Windows продуктов.  

Программа dumpchk.exe позволяет передавать файл дампа памяти из установки основных серверных компонентов Windows Server 2008 к другому компьютеру с помощью среднего по своему усмотрению.

> [!WARNING]
> Файлы подкачки может быть очень большим, поэтому тщательно рассмотрите возможность передачи, метод и метод необходимым ресурсам.
 

Дополнительные ссылки

Общие сведения об использовании файлов дампа памяти см. в разделе [параметры Обзор файла дампа памяти Windows](https://support.microsoft.com/help/254649/overview-of-memory-dump-file-options-for-windows).

Дополнительные сведения о выделенном дампа, см. в разделе [как использовать параметр реестра DedicatedDeumpFile для преодоления ограничений пространства на системном диске во время записи дампа памяти системы](https://blogs.msdn.microsoft.com/ntdebugging/2010/04/02/how-to-use-the-dedicateddumpfile-registry-value-to-overcome-space-limitations-on-the-system-drive-when-capturing-a-system-memory-dump/).



