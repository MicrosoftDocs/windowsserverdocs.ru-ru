---
title: Настройка производительности шлюза SLB в программно определенных сетях
description: Рекомендации по настройке производительности шлюза SLB в сетях SDN
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: grcusanz; anpaul
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: d1a497f24eba26b3b9b866772ae5171ea0fcbb24
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80851587"
---
# <a name="slb-gateway-performance-tuning-in-software-defined-networks"></a>Настройка производительности шлюза SLB в программно определенных сетях

Программная балансировка нагрузки обеспечивается сочетанием диспетчера подсистемы балансировки нагрузки в виртуальных машинах сетевого контроллера, виртуального коммутатора Hyper-V и набора виртуальных машин Load Balancer Мултиксплексор (мультиплексора).

Для настройки сетевого контроллера или узла Hyper-V для балансировки нагрузки не требуется дополнительная настройка производительности, если вы не используете SR-IOV [Software Defined Networking](index.md) для мультиплексоров, как описано ниже.

## <a name="slb-mux-vm-configuration"></a>Конфигурация виртуальной машины мультиплексора SLB

Виртуальные машины мультиплексора SLB развернуты в конфигурации "активный — активный".  Это означает, что все виртуальные машины мультиплексора, развернутые и добавленные в сетевой контроллер, могут обрабатывать входящие запросы.  Таким результатом, общая совокупная пропускная способность всех подключений ограничивается только числом развернутых виртуальных машин мультиплексора.  

Отдельное подключение к виртуальному IP-адресу (VIP) всегда будет отправляться в тот же мультиплексор, предполагая, что количество мультиплексоров остается постоянным, и в результате его пропускная способность будет ограничена пропускной способностью одной виртуальной машины мультиплексора.  Мультиплексоров обрабатывает только входящий трафик, предназначенный для виртуального IP-адреса.  Пакеты ответов отправляются непосредственно из виртуальной машины, которая отправляет ответ физическому коммутатору, который пересылает его клиенту.

В некоторых случаях, когда источником запроса является узел SDN, который добавляется к тому же сетевому контроллеру, который управляет виртуальным IP-адресом, также выполняется дальнейшая оптимизация входящего пути для запроса, что позволяет большинству пакетов переключаться непосредственно от клиента на сервер, минуя виртуальную машину мультиплексора полностью.  Для выполнения этой оптимизации дополнительная настройка не требуется.

Каждая виртуальная машина мультиплексора SLB должна иметь размер в соответствии с рекомендациями, указанными в разделе Требования к роли виртуальной машины инфраструктуры SDN статьи [Планирование сетевой инфраструктуры, определяемой программным обеспечением](../../../../networking/sdn/plan/Plan-a-Software-Defined-Network-Infrastructure.md) .

## <a name="single-root-io-virtualization-sr-iov"></a>Виртуализация с одним корневым элементом ввода-вывода (SR – IOV)

При использовании сеть InfiniBand Ethernet способность виртуального коммутатора обрабатывать пакеты для виртуальной машины мультиплексора станет ограничивающим фактором для пропускной способности виртуальной машины мультиплексора.  Поэтому рекомендуется включить SR-IOV на сетевом адаптере ВИРТУАЛЬНОЙ машины SLB ВИРТУАЛЬНОЙ машины, чтобы гарантировать, что виртуальный коммутатор не является узким местом.

Чтобы включить SR-IOV, необходимо включить его на виртуальном коммутаторе при создании виртуального коммутатора.  В этом примере мы создаем виртуальный коммутатор с включенной поддержкой объединения коммутаторов (SET) и SR-IOV.
``` syntax
    new-vmswitch -Name SDNSwitch -EnableEmbeddedTeaming $true -NetAdapterName @("NIC1", "NIC2") -EnableIOV $true
```
Затем его необходимо включить на виртуальных сетевых адаптерах виртуальной машины мультиплексора SLB, обрабатывающей трафик данных.  В этом примере SR-IOV включается на всех адаптерах:
``` syntax
    get-vmnetworkadapter -VMName SLBMUX1 | set-vmnetworkadapter -IovWeight 50
```
