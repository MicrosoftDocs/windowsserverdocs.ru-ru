---
title: Устранение проблем с производительностью кэша и диспетчера памяти
description: Устранение проблем с производительностью кэша и диспетчера памяти в Windows Server 16
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Pavel; ATales
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 56871924311a945d62fef8a7ef7231889ba018cc
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70866411"
---
# <a name="troubleshoot-cache-and-memory-manager-performance-issues"></a>Устранение проблем с производительностью кэша и диспетчера памяти

До выхода Windows Server 2012 две основные потенциальные проблемы приводят к увеличению размера кэша системных файлов до тех пор, пока объем доступной памяти не будет почти исчерпан при определенных рабочих нагрузках. Если эта ситуация приводит к медленной работе системы, можно определить, является ли сервер одной из этих проблем.


## <a name="counters-to-monitor"></a>Счетчики для мониторинга

-   Время\\существования долгосрочного резервного кэша памяти (в &lt; байтах), 1800 с

-   Нехватка доступной памяти\\, МБ

-   Резидентные байты в системном кэше памяти\\

Если объем\\доступной памяти (в МБ) слишком мал и в течение\\одного байта память, резидентная в кэш, занимает значительную часть физической памяти, можно использовать [раммап](https://technet.microsoft.com/sysinternals/ff700229.aspx) , чтобы узнать, для чего используется кэш.

## <a name="system-file-cache-contains-ntfs-metafile-data-structures"></a>Системный кэш файлов содержит структуры данных метафайлов NTFS


Эта проблема обозначается очень большим числом активных страниц метафайлов в выходных данных РАММАП, как показано на следующем рисунке. Эта проблема могла быть замечена на занятых серверах, к которым обращаются миллионы файлов, что приводит к кэшированию данных метафайлов NTFS, которые не освобождаются из кэша.

![раммап, представление](../../media/perftune-guide-rammap.png)

Проблема, используемая для устранения проблемы с помощью средства *динкаче* . В Windows Server 2012 + архитектура была переработана, и эта проблема больше не должна существовать.

## <a name="system-file-cache-contains-memory-mapped-files"></a>Системный кэш файлов содержит файлы, сопоставленные с памятью


Эта проблема обозначается очень большим числом активных страниц, сопоставленных с файлами, в выходных данных РАММАП. Обычно это означает, что какое-либо приложение на сервере открывает много больших файлов с помощью API-интерфейса [CreateFile](https://msdn.microsoft.com/library/windows/desktop/aa363858.aspx) с \_FLAG\_RANDOM\_ACCESS.

Эта проблема подробно описана в статье базы знаний [2549369](https://support.microsoft.com/default.aspx?scid=kb;en-US;2549369). \_Флаг случайногодоступа\_к файлу — это указание для диспетчера кэша, которое сохраняет сопоставленные представления файла в памяти (до тех пор, пока диспетчер памяти не сообщит о нехватке памяти).\_ В то же время этот флаг указывает диспетчеру кэша, что необходимо отключить предзагрузку файловых данных.

Эта ситуация была устранена в некоторой степени за счет улучшения обрезки в Windows Server 2012 +, но сама по себе проблема должна быть решена поставщиком приложения без использования флага\_\_файла случайным\_образом.Доступ. Альтернативным решением для поставщика приложения может быть использование приоритета нехватки памяти при доступе к файлам. Это можно сделать с помощью API [сетсреадинформатион](https://msdn.microsoft.com/library/windows/desktop/hh448390.aspx) . Страницы, доступ к которым осуществляется с низким приоритетом памяти, более агрессивно удаляются из рабочего набора.

Диспетчер кэша, начиная с Windows Server 2016, в дальнейшем устраняет эту возможность, игнорируя FILE_FLAG_RANDOM_ACCESS при выполнении обрезки, поэтому он обрабатывается так же, как любой другой файл, Открытый без флага FILE_FLAG_RANDOM_ACCESS (диспетчер кэша по-прежнему учитывает это флаг, позволяющий отключить предзагрузку файловых данных. При наличии большого числа открытых файлов с этим флагом и доступе к ним по-настоящему случайным образом можно вызвать чрезмерное количество системных кэшей. Настоятельно рекомендуется, чтобы FILE_FLAG_RANDOM_ACCESS не использовался приложениями.
