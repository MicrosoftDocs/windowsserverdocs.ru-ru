---
title: Устранение неполадок кэша и проблем с производительностью диспетчер памяти
description: Устранение неполадок кэша и проблем с производительностью диспетчер памяти на сервере Windows 16
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Pavel; ATales
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 66c7e2a6b264a837c65df927b271fadd2672fa24
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59835795"
---
# <a name="troubleshoot-cache-and-memory-manager-performance-issues"></a>Устранение неполадок кэша и проблем с производительностью диспетчер памяти

До Windows Server 2012 две основных потенциальные неполадки вызвал кэша файлов системы расти вплоть до почти исчерпано доступной памяти в для некоторых рабочих нагрузок. Если результаты этой ситуации в системе, низкой производительностью, можно определить ли сервер является столкнулись с одной из этих проблем.


## <a name="counters-to-monitor"></a>Счетчики для мониторинга

-   Память\\Long-Term среднее Standby время существования кэша (s) &lt; 1800 секунд

-   Память\\"Доступно МБ" мала.

-   Память\\Резидентных байт системного кэша

Если памяти\\"Доступно МБ" — при низком и в то же время памяти\\Резидентных байт системного кэша занимает значительную долю физической памяти, можно использовать [RAMMAP](https://technet.microsoft.com/sysinternals/ff700229.aspx) чтобы узнать, какие кэша для.

## <a name="system-file-cache-contains-ntfs-metafile-data-structures"></a>Кэш файловой системы содержит структур данных NTFS метафайл


Эта проблема обозначается очень большое число активные страницы метафайла в RAMMAP выходные данные, как показано на рисунке ниже. Эта проблема может наблюдались на серверах занят с миллионами файлов осуществлялся, тем самым приводит к кэширования данных метафайла NTFS, не освобождается из кэша.

![представление rammap](../../media/perftune-guide-rammap.png)

Проблемы можно устранить путем *DynCache* средство. В Windows Server 2012 и выше, была переработана архитектура и эта проблема больше не должна существовать.

## <a name="system-file-cache-contains-memory-mapped-files"></a>Кэш файловой системы содержит файлы, отображенные в памяти


Эта проблема обозначается очень большое число активных страниц файла сопоставлен в выходных данных RAMMAP. Обычно это означает, что некоторые приложения на сервере открывает массу больших файлов с помощью [CreateFile](https://msdn.microsoft.com/library/windows/desktop/aa363858.aspx) API с помощью файла\_ФЛАГ\_RANDOM\_значение флага доступа.

Эта проблема описана в статье базы Знаний подробно [2549369](https://support.microsoft.com/default.aspx?scid=kb;en-US;2549369). ФАЙЛ\_ФЛАГ\_RANDOM\_флаг доступа является подсказкой для диспетчера кэша для хранения сопоставленных представлений для файла в памяти, при условии, возможно, (пока диспетчер памяти не указать условие нехватки памяти). В то же время этот флаг указывает, что диспетчер кэша для отключения предварительная выборка данных файлов.

Такой ситуации сдерживается в некоторой степени, работая набора обрезки усовершенствования в Windows Server 2012 и выше, но проблема сам требуется в первую очередь поставщика приложения, не используя ФАЙЛ\_ФЛАГ\_RANDOM\_Доступа. Альтернативное решение для поставщика приложения необходимо использовать приоритет нехватки памяти при доступе к файлам. Это можно сделать с помощью [SetThreadInformation](https://msdn.microsoft.com/library/windows/desktop/hh448390.aspx) API. Страниц, доступных с приоритетом нехватки памяти, удаляются из рабочего набора более агрессивно.

Диспетчер кэша, дальнейшей начиная с Windows Server 2016 позволяет устранить это, игнорируя FILE_FLAG_RANDOM_ACCESS при принятии обрезки, поэтому она обрабатывается так же, как и любые другие файлы, открываемые без флага FILE_FLAG_RANDOM_ACCESS (диспетчера кэша по-прежнему учитывает это флаг, чтобы отключить предварительная выборка данных файлов). При наличии большого количества файлов открыты с помощью этого флага и доступны по-настоящему случайного образом, можно по-прежнему вызывать Раздувание кэша системы. Настоятельно рекомендуется не использовать FILE_FLAG_RANDOM_ACCESS приложениями.
