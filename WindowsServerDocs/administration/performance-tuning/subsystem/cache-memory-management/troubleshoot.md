---
title: Устранение проблем с производительностью кэша и диспетчера памяти
description: Устранение проблем с производительностью кэша и диспетчера памяти в Windows Server 16
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: pavel; atales
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 0b01808564cfaf1eaedf30a66c774e2228205847
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80851657"
---
# <a name="troubleshoot-cache-and-memory-manager-performance-issues"></a>Устранение проблем с производительностью кэша и диспетчера памяти

До выхода Windows Server 2012 две основные потенциальные проблемы приводят к увеличению размера кэша системных файлов до тех пор, пока объем доступной памяти не будет почти исчерпан при определенных рабочих нагрузках. Если эта ситуация приводит к медленной работе системы, можно определить, является ли сервер одной из этих проблем.


## <a name="counters-to-monitor"></a>Счетчики для мониторинга

-   Время существования\\долгосрочного среднего времени жизни резервного кэша &lt; 1800 с

-   Нехватка доступной памяти\\МБ

-   Резидентные байты системного кэша\\памяти

Если объем памяти\\доступный мегабайт (МБ) слишком мал и в то же время память\\памяти системного кэша потребляет значительную часть физической памяти, можно использовать [раммап](https://technet.microsoft.com/sysinternals/ff700229.aspx) , чтобы узнать, для чего используется кэш.

## <a name="system-file-cache-contains-ntfs-metafile-data-structures"></a>Системный кэш файлов содержит структуры данных метафайлов NTFS


Эта проблема обозначается очень большим числом активных страниц метафайлов в выходных данных РАММАП, как показано на следующем рисунке. Эта проблема могла быть замечена на занятых серверах, к которым обращаются миллионы файлов, что приводит к кэшированию данных метафайлов NTFS, которые не освобождаются из кэша.

![раммап, представление](../../media/perftune-guide-rammap.png)

Проблема, используемая для устранения проблемы с помощью средства *динкаче* . В Windows Server 2012 + архитектура была переработана, и эта проблема больше не должна существовать.

## <a name="system-file-cache-contains-memory-mapped-files"></a>Системный кэш файлов содержит файлы, сопоставленные с памятью


Эта проблема обозначается очень большим числом активных страниц, сопоставленных с файлами, в выходных данных РАММАП. Как правило, это означает, что некоторые приложения на сервере открывают большой объем больших файлов с помощью API-интерфейса [CreateFile](https://msdn.microsoft.com/library/windows/desktop/aa363858.aspx) с флагом FILE\_\_установленным флагом доступа Random\_.

Эта проблема подробно описана в статье базы знаний [2549369](https://support.microsoft.com/default.aspx?scid=kb;en-US;2549369). Флаг\_файлов\_СЛУЧАЙный\_ный флаг доступа — это подсказка для диспетчера кэша с целью сохранения сопоставленных представлений файла в памяти (до тех пор, пока диспетчер памяти не сообщит о нехватке памяти). В то же время этот флаг указывает диспетчеру кэша, что необходимо отключить предзагрузку файловых данных.

Эта ситуация была устранена в некоторой степени за счет улучшения работы с обрезками в Windows Server 2012 +, но сама проблема должна быть решена поставщиком приложения, не используя флаг\_файлов\_СЛУЧАЙного\_доступа. Альтернативным решением для поставщика приложения может быть использование приоритета нехватки памяти при доступе к файлам. Это можно сделать с помощью API [сетсреадинформатион](https://msdn.microsoft.com/library/windows/desktop/hh448390.aspx) . Страницы, доступ к которым осуществляется с низким приоритетом памяти, более агрессивно удаляются из рабочего набора.

Диспетчер кэша, начиная с версии Windows Server 2016, в дальнейшем устраняет эту возможность, игнорируя FILE_FLAG_RANDOM_ACCESS при выполнении обрезки, поэтому она обрабатывается так же, как и любой другой файл, Открытый без флага FILE_FLAG_RANDOM_ACCESS (диспетчер кэша по-прежнему учитывает этот флаг для отключения предварительной выборки данных файлов). При наличии большого числа открытых файлов с этим флагом и доступе к ним по-настоящему случайным образом можно вызвать чрезмерное количество системных кэшей. Настоятельно рекомендуется FILE_FLAG_RANDOM_ACCESS не использовать приложения.
