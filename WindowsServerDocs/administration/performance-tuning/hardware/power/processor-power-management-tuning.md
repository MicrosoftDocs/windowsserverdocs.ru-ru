---
title: Настройка управления питанием процессора (PPM) для схемы управления питанием с балансировкой сетевой нагрузки Windows Server
description: Настройка управления питанием процессора (PPM) для схемы управления питанием с балансировкой сетевой нагрузки Windows Server
ms.topic: conceptual
ms.author: qizha;tristanb
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 1fcc21df93d9963ee83159c1df2fcf918ddbbfba
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87992378"
---
# <a name="processor-power-management-ppm-tuning-for-the-windows-server-balanced-power-plan"></a>Настройка управления питанием процессора (PPM) для схемы управления питанием с балансировкой сетевой нагрузки Windows Server

Начиная с Windows Server 2008, Windows Server предоставляет три схемы управления питанием: **сбалансированная**, **Высокая производительность**и **экономия энергии**. **Сбалансированная** схема управления питанием — это выбор по умолчанию, нацеленный на наилучшее энергопотребление для набора типичных серверных рабочих нагрузок. В этом разделе описываются рабочие нагрузки, которые использовались для определения параметров по умолчанию для схемы с **балансировкой нагрузки** в прошлых нескольких выпусках Windows.

При запуске серверной системы, которая сильно различает характеристики рабочей нагрузки или требования к производительности и питанию, можно настроить параметры управления питанием по умолчанию (т. е. создать настраиваемую схему управления питанием). Одним из источников полезной информации о настройке является [Серверная информация о питании оборудования](../power.md). Кроме того, вы можете решить, что **высокопроизводительная** схема управления питанием является оптимальным выбором для вашей среды. Это означает, что, скорее всего, потребуется значительное снижение энергии в обмен на некоторый уровень скорости реагирования.

> [!IMPORTANT]
> Следует использовать политики управления питанием, включенные в Windows Server, если нет особой необходимости создавать собственный пользователь и иметь очень хорошее представление о том, что результаты будут зависеть от характеристик рабочей нагрузки.

## <a name="windows-processor-power-tuning-methodology"></a>Методология настройки питания процессора Windows

### <a name="tested-workloads"></a>Протестированные рабочие нагрузки

Рабочие нагрузки выбираются, чтобы охватить наиболее интенсивный набор рабочих нагрузок Windows Server. Очевидно, что этот набор не должен представлять себе всю среду реальных серверных сред.

Настройка в каждой политике питания — это данные, управляемые следующими пятью рабочими нагрузками:

- **Рабочая нагрузка веб-сервера IIS**

    Внутренний тест производительности, называемый веб-основами, используется для оптимизации энергоэкономичности платформ, на которых работает веб-сервер IIS. Программа установки содержит веб-сервер и несколько клиентов, имитирующих трафик веб-доступа. Распределение динамической, статичной (в памяти) и статичной (необходимой для доступа к диску) веб-страниц основано на статистических исследованиях рабочих серверов. Для принудительной передачи ПРОЦЕССОРных ядер сервера в полную загрузку (один конец протестированного спектра) программа установки требует достаточно быстрых сетевых и дисковых ресурсов.

- **Рабочая нагрузка базы данных SQL Server**

    Тест производительности [TPC-E](http://www.tpc.org/tpce/default.asp) — это популярный тестовый контроль над производительностью базы данных. Он используется для создания рабочей нагрузки OLTP для оптимизации настройкой стр/мин. Эта Рабочая нагрузка требует значительных дисковых операций ввода-вывода и, следовательно, требует высокой производительности для системы хранения и размера памяти.

- **Рабочая нагрузка файлового сервера**

    Для создания рабочей нагрузки файлового сервера SMB используется тест производительности, разработанный корпорацией Майкрософт, именуемый [фскт](http://www.snia.org/sites/default/files2/sdc_archives/2009_presentations/tuesday/BartoszNyczkowski-JianYan_FileServerCapacityTool.pdf) . Он создает большой набор файлов на сервере и использует многие клиентские системы (фактические или виртуализированные) для создания операций открытия, закрытия, чтения и записи файлов. Набор операций основан на статистических исследованиях рабочих серверов. Он нагружает ресурсы ЦП, диска и сети.

- **Спекповер — Рабочая нагрузка JAVA**

    [Спекповер \_ ssj2008](http://spec.org/power_ssj2008/) — это первый промышленный эталонный тест, который совместно оценивает характеристики мощности и производительности. Это рабочая нагрузка Java на стороне сервера с различными уровнями загрузки ЦП. Он не требует много дисковых или сетевых ресурсов, но имеет определенные требования к пропускной способности памяти. Почти все действия ЦП выполняются в пользовательском режиме. действие режима ядра не оказывает существенного влияния на производительность и характеристики производительности, за исключением решений по управлению питанием.

- **Рабочая нагрузка сервера приложений**

    Для создания рабочей нагрузки сервера приложений используется тест производительности [SAP-SD](http://global.sap.com/campaigns/benchmark/index.epx) . Используется двухуровневая Настройка с базой данных и сервером приложений на одном узле сервера. Эта Рабочая нагрузка также использует время отклика в качестве метрики производительности, которая отличается от других протестированных рабочих нагрузок. Поэтому он используется для проверки влияния параметров в минуту на скорость реагирования. Тем не менее, он не должен представлять все рабочие нагрузки, учитывающие задержку.

Все тесты производительности, за исключением Спекповер, изначально разрабатывались для анализа данных, поэтому они были созданы для запуска на пиковых уровнях нагрузки. Однако средние и легкие уровни нагрузки наиболее распространены для реальных рабочих серверов и более интересны для оптимизации **сбалансированных** планов. Мы намеренно выполняли тесты на разных уровнях нагрузки с 100% на 10% (в течение 10% шагов), используя различные методы регулирования (например, путем уменьшения числа активных пользователей и клиентов).

### <a name="hardware-configurations"></a>Конфигурации оборудования

Для каждого выпуска Windows в процессе анализа и оптимизации схемы управления питанием используются наиболее актуальные рабочие серверы. В некоторых случаях тесты были выполнены в подготовительных системах, расписание выпуска которых соответствует следующему выпуску Windows.

Учитывая, что большинство серверов продаются с 1 до 4 сокетов процессоров, и, так как масштабируемые серверы менее подвержены энергосбережению в качестве основной проблемы, тесты оптимизации схемы управления питанием в первую очередь выполняются в системах с 2 процессорами и 4 процессорами. Объем оперативной памяти, диска и сетевых ресурсов для каждого теста выбирается для того, чтобы каждая система выполнялась вплоть до полной емкости, в то же время принимая во внимание ограничения по затратам, которые обычно применяются для реальных серверных сред, например для обеспечения разумных конфигураций.

> [!IMPORTANT]
> Несмотря на то, что система может работать с пиковой нагрузкой, мы обычно оптимизированы для более низких уровней нагрузки, так как серверы, которые постоянно выполняются на пиковых нагрузках, хорошо привыкли использовать **высокопроизводительную** схему управления питанием, если энергопотребление не является высоким приоритетом.

### <a name="metrics"></a>Метрики

Все протестированные тестовые тесты используют пропускную способность в качестве метрики производительности. Время отклика рассматривается как требование соглашения об уровне обслуживания для этих рабочих нагрузок (за исключением SAP, где это основная метрика). Например, тестовый запуск считается допустимым, если среднее или максимальное время отклика меньше определенного значения.

Таким образом, в качестве метрики производительности также используется пропускная способность для анализа настройки на стр.  На высшем уровне нагрузки (100% использования ЦП) Наша цель заключается в том, что пропускная способность не должна снижаться более чем на несколько процентов из-за оптимизации управления питанием. Но основное внимание заключается в максимально эффективном энергопотреблении (как определено ниже) на средних и низких уровнях нагрузки.

![Формула эффективности питания](../../media/serverperf-ppm-formula.jpg)

Использование ядер ЦП с низкими частотами сокращает энергопотребление. Однако низкие частоты обычно уменьшают пропускную способность и увеличивают время отклика. Для **сбалансированной** схемы управления питанием предусмотрено преднамеренное соотношение скорости реагирования и эффективности питания. Тестирование рабочей нагрузки SAP, а также время отклика на соглашения об уровне обслуживания на других рабочих нагрузках убедитесь, что увеличение времени отклика не превышает определенный порог (5% в качестве примера) для этих конкретных рабочих нагрузок.

> [!NOTE]
> Если в рабочей нагрузке в качестве метрики производительности используется время отклика, система должна либо переключиться на **высокопроизводительную** схему управления питанием, либо изменить **сбалансированную** схему управления питанием, как описано в [рекомендациях по рекомендуемому сбалансированному тарифному плану](recommended-balanced-plan-parameters.md).

### <a name="tuning-results"></a>Результаты настройки

Начиная с Windows Server 2008 Корпорация Майкрософт работала с корпорацией Intel и AMD, чтобы оптимизировать параметры в PPM для самых последних версий серверных процессоров для каждого выпуска Windows. Для каждой из ранее обсуждаемых рабочих нагрузок было протестировано значительное количество сочетаний параметров в минуту, чтобы найти оптимальную эффективность энергопотребления на разных уровнях нагрузки. Так как алгоритмы программного обеспечения были улучшены и были изменены архитектурные аппаратные мощности, каждый новый сервер Windows Server всегда имеет лучшую или экономичную мощность, чем предыдущие версии в рамках ряда протестированных рабочих нагрузок.

На следующем рисунке приведен пример эффективности энергопотребления в различных уровнях нагрузки TPC-E на 4-процессорном рабочем сервере под управлением Windows Server 2008 R2. В нем показан уровень улучшения в 8% на средних уровнях загрузки по сравнению с Windows Server 2008.

![Сравнение энергопотребления](../../media/serverperf-ppm-figure1.jpg)

## <a name="customized-tuning-suggestions"></a>Настраиваемые предложения по настройке

Если характеристики основной рабочей нагрузки значительно отличаются от пяти рабочих нагрузок, используемых для настройки **сбалансированного** плана питания по умолчанию, можно поэкспериментировать, изменив один или несколько параметров в минуту, чтобы найти оптимальное соответствие для вашей среды.

Из-за количества и сложности параметров это может быть сложной задачей, но если вы ищете лучший компромисс между энергопотреблением и рабочей нагрузкой, эффективность в конкретной среде, возможно, стоит потратить усилия.

 Полный набор параметров, настроенных на PPM, можно найти в окне " [Настройка управления питанием процессора](/previous-versions/windows/hardware/design/dn613983(v=vs.85))". Вот некоторые простейшие параметры питания, с которыми можно начинать с:

-   **Увеличение производительности процессора пороговое значение и увеличение производительности процессора** — большие значения замедляют реагирование производительности на повышение активности.

-   **Порог уменьшения производительности процессора** — большие значения.

-   **Время уменьшения производительности процессора** — большие значения более постепенно снижают производительность во время периодов простоя.

-   **Политика увеличения производительности процессора** — "единственная" политика снижает производительность ответа на повышение и устойчивую активность; политика "Rocket" быстро реагирует на повышение активности

-   **Политика уменьшения производительности процессора** — "единственная" политика постепенно сокращает производительность до более длительных периодов бездействия; политика "Rocket" снижает энергопотребление при входе в период простоя

>[!Important]
> Прежде чем приступать к экспериментам, необходимо сначала понять рабочие нагрузки, что поможет вам выбрать правильные параметры и сократить усилия по настройке.

### <a name="understand-high-level-performance-and-power-requirements"></a>Общие сведения о высокой производительности и требованиях к питанию

Если ваша рабочая нагрузка — "реальное время" (например, подвержена ошибкам или другим видимым конечным пользователям) или имеет очень тесное требование на реагирование (например, брокер фондовой биржи), и если энергопотребление не является основным критерием для вашей среды, то, вероятно, следует просто переключиться на **высокопроизводительную** схему управления питанием. В противном случае следует понимать требования к времени отклика рабочих нагрузок, а затем настраивать параметры для максимальной эффективности, которая по-прежнему соответствует этим требованиям.

### <a name="understand-underlying-workload-characteristics"></a>Общие сведения о характеристиках базовой рабочей нагрузки

Вам следует ознакомиться с рабочими нагрузками и спроектировать наборы параметров эксперимента для настройки. Например, если частоты ядер ЦП необходимо быстро увеличить (возможно, у вас есть Пакетная нагрузка с значительными периодами бездействия, но при появления новой транзакции требуется очень быстро реагировать на запросы, поэтому для политики увеличения производительности процессора может потребоваться задать значение «Rocket» (которое, как предполагается в названии), позволяет прокрутить частоту ядра ЦП к максимальному значению, а не по пошаговому выполнению в течение определенного периода времени.

Если Рабочая нагрузка очень интенсивна, интервал проверки PPM можно уменьшить, чтобы начать работу с пошаговым выполнением с последовательной частотой загрузки. Если в рабочей нагрузке не используется высокая степень параллелизма потоков, то можно включить приостановка ядра, чтобы принудительно выполнить рабочую нагрузку на меньшем числе ядер, что также может улучшить коэффициенты попаданий в кэш процессора.

Если вы просто хотите увеличить частоту ЦП на средних уровнях загрузки (т. е. не в светлых уровнях рабочей нагрузки), пороговые значения увеличения и уменьшения производительности процессора можно изменить, чтобы не реагировать на определенные уровни активности.

### <a name="understand-periodic-behaviors"></a>Общие сведения о периодических поведении

Могут существовать разные требования к производительности для постоянную и ночь или выходных дней. Кроме того, могут существовать разные рабочие нагрузки, выполняемые в разное время. В этом случае один набор параметров PPM может быть неоптимальным для всех периодов времени. Поскольку можно разрабатывать несколько пользовательских схем управления питанием, вы можете даже настроить их для различных периодов времени и переключаться между схемами управления питанием с помощью сценариев или других средств динамической конфигурации системы.

Опять же, это увеличивает сложность процесса оптимизации, поэтому это вопрос о том, какой объем данных будет получен из этого типа настройки, который, скорее всего, придется повторять при значительных обновлениях оборудования или рабочей нагрузке.

Именно поэтому Windows предоставляет **сбалансированную** схему управления питанием в первую очередь, поскольку во многих случаях это не стоит тратить усилий на настройку конкретной рабочей нагрузки на определенном сервере.

## <a name="see-also"></a>См. также:
- [Рекомендации по планированию производительности серверного оборудования](../index.md)
- [Рекомендации по питанию серверного оборудования](../power.md)
- [Питание и настройка производительности](power-performance-tuning.md)
- [Настройка управления питанием процессора](processor-power-management-tuning.md)
- [Рекомендуемые параметры сбалансированного режима энергоснабжения](recommended-balanced-plan-parameters.md)