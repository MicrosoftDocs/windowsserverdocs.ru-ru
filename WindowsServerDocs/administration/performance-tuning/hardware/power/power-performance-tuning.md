---
title: Общие сведения о настройке питания и производительности для Windows Server
description: Обзор настройки управления питанием процессора (PPM) для Windows Server.
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: conceptual
ms.author: qizha;tristanb
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 67e72967d29fc96fe3f57b714bd8aaf19f406565
ms.sourcegitcommit: 771db070a3a924c8265944e21bf9bd85350dd93c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/27/2020
ms.locfileid: "85471659"
---
# <a name="power-and-performance-tuning"></a>Обеспечение оптимального питания и производительности

Эффективность энергопотребления в корпоративных средах и центрах обработки данных все равно важна, и она добавляет еще один набор компромиссов к сочетаниям параметров конфигурации.

Windows Server 2016 оптимизирован для обеспечения великолепной экономичности с минимальным влиянием на производительность в самых разных рабочих нагрузках клиентов. [Настройка управления питанием процессора (ppm) для схемы управления питанием Windows Server](processor-power-management-tuning.md) описывает рабочие нагрузки, используемые для настройки параметров по умолчанию в windows Server 2016, и предоставляет рекомендации по настройке.

В этом разделе разворачиваются компромиссы, помогающие принимать взвешенные решения, если необходимо изменить параметры управления питанием по умолчанию на сервере. Однако большинство серверного оборудования и рабочих нагрузок не должны требовать настройки управления питанием администратора при работе с Windows Server 2016.

## <a name="calculating-server-energy-efficiency"></a>Вычисление эффективности использования серверной энергии

При настройке сервера для энергосбережения необходимо также учитывать производительность. Настройка влияет на производительность и энергопотребление, иногда в непропорциональной сумме. Для каждой возможной корректировки рассмотрите требования к бюджету питания и производительности, чтобы определить, приемлемо ли компромисс.

Вы можете рассчитать коэффициент эффективности энергопотребления на сервере для полезной метрики, включающей сведения о мощности и производительности. Эффективность энергопотребления — это отношение работы к среднему питанию, которое требуется в течение определенного периода времени.

![Формула эффективности энергопотребления](../../media/perftune-guide-power-formula.png)

Эту метрику можно использовать для установки практических целей, учитывающих компромисс между питанием и производительностью. В отличие от этого, цель экономии энергии в 10% в центре обработки данных не позволяет захватить соответствующие эффекты на производительность и наоборот.

Аналогичным образом, если настроить сервер для повышения производительности на 5%, что приводит к увеличению энергопотребления на 10 процентов, то общий результат может быть неприемлемым для ваших бизнес-целей. Метрика эффективности энергопотребления позволяет принимать более обоснованные решения, а не только метрики мощности или производительности.

## <a name="measuring-system-energy-consumption"></a>Измерение энергопотребления системы

Прежде чем настраивать сервер для повышения эффективности энергопотребления, следует установить базовое измерение мощности.

Если сервер имеет необходимую поддержку, вы можете использовать функции измерения и управления питанием в Windows Server 2016 для просмотра потребления энергии на уровне системы с помощью системного монитора.

Один из способов определить, поддерживает ли ваш сервер отслеживание и бюджетирование, — просматривать [каталог Windows Server](https://www.windowsservercatalog.com). Если модель сервера соответствует новой расширенной квалификации по управлению питанием в программе сертификации оборудования Windows, то гарантируется поддержка функций измерения и бюджетирования.

Другой способ проверить поддержку отслеживания использования — вручную найти счетчики в системном мониторе. Откройте системный монитор, выберите **Добавить счетчики**, а затем найдите группу счетчиков **индикатора питания** .

Если в поле **экземпляры выбранного объекта**отображаются именованные экземпляры Power метры, ваша платформа поддерживает измерение. Счетчик **питания** , отображающий питание в ватт, отображается в выбранной группе счетчиков. Точное наследование значения данных о питании не указано. Например, это может быть мгновенное Рисование энергии или среднее энергопотребление за некоторый интервал времени.

Если серверная платформа не поддерживает измерение, можно использовать физическое устройство, подключенное к источнику питания, чтобы измерять энергопотребление системы или энергопотребление.

Чтобы установить базовый уровень, необходимо измерять среднюю мощность, необходимую для различных точек загрузки системы, от бездействия до 100% (максимальная пропускная способность) для создания линии загрузки. На следующем рисунке показаны линии загрузки для трех образцов конфигураций:

![Примеры строк загрузки](../../media/perftune-guide-sample-loadlines.png)

Строки загрузки можно использовать для оценки и сравнения производительности и потребления энергии конфигураций во всех точках загрузки. В этом конкретном примере можно легко увидеть, что такое лучшая конфигурация. Однако возможны ситуации, когда одна конфигурация лучше всего подходит для интенсивных рабочих нагрузок, и одна из них лучше всего подходит для облегченных рабочих нагрузок.

Чтобы выбрать оптимальную конфигурацию, необходимо тщательно разобраться в требованиях к рабочей нагрузке. Не следует думать, что при обнаружении хорошей конфигурации она всегда будет оптимальной. Вы должны измерять использование системы и энергопотребление на регулярной основе и после изменений рабочих нагрузок, уровней рабочей нагрузки или серверного оборудования.

## <a name="diagnosing-energy-efficiency-issues"></a>Диагностика проблем с энергосбережением

**PowerCfg.exe** поддерживает параметр командной строки, который можно использовать для анализа эффективности сервера в неактивном энергопотреблении. При запуске PowerCfg.exe с параметром **/енерги** средство выполняет проверку 60-секунд для обнаружения потенциальных проблем с энергосбережением. Средство создает простой HTML-отчет в текущем каталоге.

> [!Important]
> Чтобы обеспечить точный анализ, перед запуском **PowerCfg.exe**убедитесь, что все локальные приложения закрыты. 

Сокращение частоты тактов таймера, драйверов, в которых отсутствует поддержка управления питанием и чрезмерное использование ЦП, — это несколько проблем поведения, обнаруженных командой **powercfg/енерги** . Это средство предоставляет простой способ обнаружения и устранения проблем управления питанием, что может привести к значительному снижению затрат в большом центре обработки данных.

Дополнительные сведения о PowerCfg.exe см. [в разделе Использование Powercfg для вычисления эффективности энергопотребления системы](https://msdn.microsoft.com/windows/hardware/gg463250.aspx).

## <a name="using-power-plans-in-windows-server"></a>Использование схем управления питанием в Windows Server

В Windows Server 2016 есть три встроенные схемы управления питанием, предназначенные для удовлетворения различных бизнес-потребностей. Эти планы предоставляют простой способ настройки сервера в соответствии с целями питания или производительности. В следующей таблице описаны планы, перечислены распространенные сценарии использования каждого плана и приведены некоторые сведения о реализации каждого плана.

| **План** | **Описание** | **Распространенные применимые сценарии** | **Основные особенности реализации** |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Сбалансированный (рекомендуется) | Параметр по умолчанию. Нацелены на экономичное энергопотребление с минимальным влиянием на производительность. | Общие вычисления | Соответствует емкости по запросу. Экономия энергии обеспечивает баланс мощности и производительности. |
| высокопроизводительная | Повышение производительности за счет использования высокой энергии. Действуют ограничения по питанию и температуре, эксплуатационные расходы и надежность. | Приложения с низкой задержкой и код приложения, которые чувствительны к изменениям производительности процессора | Процессоры всегда блокируются с наибольшим состоянием производительности (включая частоты "Turbo"). Все ядра не будут приостановлены. Данные для термальной температуры могут быть значительными. |
| Экономия энергии | Ограничивает производительность для экономии энергии и снижения эксплуатационных расходов. Не рекомендуется без тщательного тестирования, чтобы обеспечить достаточную производительность. | Развертывания с ограниченными бюджетами питания и температурными ограничениями | Частота процессора с поддержкой CAPS в процентах от максимального (если поддерживается) и включает другие функции энергосбережения. |


Эти схемы управления питанием существуют в Windows для чередующихся систем на основе тока (AC) и Direct Current (DC), но мы будем предположить, что серверы всегда используют источник питания AC.

Дополнительные сведения о схемах управления питанием и конфигурациях политик питания см. [в разделе Настройка и развертывание политики](https://msdn.microsoft.com/windows/hardware/gg463243.aspx)управления питанием в Windows.

> [!Note]
> Некоторые серверные производства имеют собственные возможности управления питанием, доступные в настройках BIOS. Если операционная система не имеет контроля над управлением питанием, изменение схем управления питанием в Windows не повлияет на энергопотребление и производительность системы.

## <a name="tuning-processor-power-management-parameters"></a>Настройка параметров управления питанием процессора

Каждая схема управления питанием представляет собой сочетание многочисленных параметров управления питанием. Встроенные планы — это три коллекции рекомендуемых параметров, охватывающие разнообразные рабочие нагрузки и сценарии. Однако мы понимаем, что эти планы не будут соответствовать потребностям каждого клиента.

В следующих разделах описаны способы настройки некоторых параметров управления питанием процессора в соответствии с целями, которые не были решены тремя встроенными планами. Если необходимо ознакомиться с более широким набором параметров питания, см. раздел [Настройка и развертывание политики управления питанием в Windows](https://msdn.microsoft.com/windows/hardware/gg463243.aspx).

## <a name="processor-performance-boost-mode"></a>Режим повышения производительности процессора

Технологии Intel Turbo Boost и AMD Turbo CORE — это функции, позволяющие процессорам добиться дополнительной производительности, когда она наиболее полезна (то есть при высоких нагрузках на систему). Однако эта функция увеличивает энергопотребление ЦП, поэтому Windows Server 2016 настраивает технологии Turbo на основе используемой политики электропитания и конкретной реализации процессора.

Для высокопроизводительных схем управления питанием на всех процессорах Intel и AMD включена поддержка Turbo, и для них отключены схемы Power энергосберегающая. Для сбалансированных схем управления питанием в системах, основанных на традиционном управлении частотой, основанной на состоянии P-состояния, Turbo включается по умолчанию, только если платформа поддерживает Регистр ЕПБ.

> [!Note]
> Регистр ЕПБ поддерживается только в процессорах Intel Вестмере и более поздних версий.

Для процессоров Intel Нехалем и AMD по умолчанию Turbo отключено на платформах, основанных на состоянии P-State. Однако, если система поддерживает управление производительностью совместного использования процессора (КППК), что является новым альтернативным режимом взаимодействия между операционной системой и оборудованием (определенный в ACPI 5,0), можно использовать Turbo, если операционная система Windows динамически запрашивает оборудование, чтобы обеспечить максимально возможный уровень производительности.

Чтобы включить или отключить функцию Turbo Boost, параметр режима повышения производительности процессора должен быть настроен администратором или параметрами по умолчанию для выбранной схемы управления питанием. Режим повышения производительности процессора имеет пять допустимых значений, как показано в таблице 5.

Для элементов управления на основе P-состояния варианты отключаются, включаются (устройство Turbo доступно оборудованию при запросе номинальной производительности) и эффективно (Turbo доступно только при реализации регистра ЕПБ).

Для элемента управления, основанного на КППК, варианты отключены, эффективно включены (Windows указывает точный объем Turbo) и агрессивно (Windows запрашивает максимальную производительность, чтобы включить Turbo).

В Windows Server 2016 значение по умолчанию для режима Boost равно 3.

| **имя**; | **Поведение на основе P-состояния** | **Поведение КППК** |
|--------------------------|------------------------|-------------------|
| 0 (отключено) | Выключено | Выключено |
| 1 (включено) | Активировано | Эффективность включена |
| 2 (агрессивно) | Активировано | Aggressive |
| 3 (эффективность включена) | Эффективно | Эффективность включена |
| 4 (эффективный агрессивный) | Эффективно | Aggressive |


Следующие команды включают режим повышения производительности процессора в текущей схеме управления питанием (укажите политику с помощью псевдонима GUID):

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PERFBOOSTMODE 1
Powercfg -setactive scheme_current
```

> [!Important]
> Чтобы включить новые параметры, необходимо выполнить команду **powercfg-сетактиве** . Перезагружать сервер не требуется.

Чтобы задать это значение для схем управления питанием, отличных от выбранного в данный момент, можно использовать псевдонимы, такие как \_ максимальная скорость (экономия энергии), схема \_ min (высокая производительность) и \_ сбалансированная схема (сбалансированная) вместо схемы \_ текущий. Замените "схема Current" в командах Powercfg-сетактиве, которые ранее отображались с нужным псевдонимом, чтобы включить эту схему управления питанием.

Например, чтобы настроить режим усиления в плане экономии энергии и сделать его текущим планом, выполните следующие команды:

``` syntax
Powercfg -setacvalueindex scheme_max sub_processor PERFBOOSTMODE 1
Powercfg -setactive scheme_max
```

## <a name="minimum-and-maximum-processor-performance-state"></a>Минимальное и максимальное состояние производительности процессора

Процессоры меняются между состояниями производительности (P-состояния) очень быстро, чтобы соответствовать спросу, обеспечивая производительность по мере необходимости и экономию энергии, когда это возможно. Если сервер имеет определенные высокопроизводительные или минимальные требования к энергопотреблению, можно подумать о настройке **минимального значения параметра состояния производительности процессора** или параметра **состояния максимальной производительности процессора** .

Значения **минимального состояния производительности процессора** и **максимального состояния производительности** процессора выражаются в процентах от максимальной частоты процессора и значения в диапазоне от 0 до 100.

Если сервер требует высокой задержки, неизменяемой частоты ЦП (например, для повторяемого тестирования) или наивысшего уровня производительности, процессоры могут переключаться на более низкие состояния производительности. Для такого сервера можно ограничить минимальное состояние производительности процессора на 100% с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PROCTHROTTLEMIN 100
Powercfg -setactive scheme_current
```

Если сервер требует снижения энергопотребления энергии, может потребоваться закрепление состояния производительности процессора в процентах от максимума. Например, можно ограничить процессор до 75% от максимальной частоты с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PROCTHROTTLEMAX 75
Powercfg -setactive scheme_current
```

> [!Note]
> При ограничении производительности процессора в процентах от максимума требуется поддержка процессора. Проверьте документацию по процессору, чтобы определить, существует ли такая поддержка, или просмотрите счетчик производительности " **% максимальной частоты** " в группе " **процессор** ", чтобы узнать, были ли применены какие либо ограничения по частоте.

## <a name="processor-performance-increase-and-decrease-of-thresholds-and-policies"></a>Увеличение производительности процессора и снижение пороговых значений и политик

Скорость, с которой увеличивается или уменьшается состояние производительности процессора, управляется несколькими параметрами. Следующие четыре параметра имеют наиболее заметные последствия:

-   **Порог увеличения производительности процессора** определяет значение использования, по достижении которого увеличится состояние производительности процессора. Большие значения снижают скорость увеличения состояния производительности в ответ на повышенные действия.

-   **Порог уменьшения производительности процессора** определяет значение использования, ниже которого будет снижаться состояние производительности процессора. Большие значения увеличивают скорость уменьшения состояния производительности во время периодов простоя.

-   **Производительность процессора увеличение политики и снижение производительности процессора** Политика определяет, какое состояние производительности должно быть задано при изменении. Политика "Single" означает, что она выбирает следующее состояние. "Rocket" — максимальное или минимальное состояние производительности электропитания. "Идеальный вариант" пытается найти баланс между питанием и производительностью.

Например, если сервер требует высокой задержки, при этом вы по-прежнему захотите воспользоваться преимуществами низкого энергопотребления в периодах простоя, то можно было бы увеличить состояние производительности для любого увеличения нагрузки и замедлить уменьшение времени, когда нагрузка выйдет из строя. Следующие команды устанавливают для политики увеличения значение "Rocket" для ускорения увеличения состояния и устанавливают для политики уменьшения значение "Single". Пороговые значения увеличения и уменьшения задаются равными 10 и 8 соответственно.

``` syntax
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFINCPOL 2
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFDECPOL 1
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFINCTHRESHOLD 10
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFDECTHRESHOLD 8
Powercfg.exe /setactive scheme_current
```

## <a name="processor-performance-core-parking-maximum-and-minimum-cores"></a>Максимальное и минимальное число ядер для ядер производительности процессора

Стоянка ядер — это функция, появившаяся в Windows Server 2008 R2. Подсистема управления питанием процессора (PPM) и планировщик работают вместе для динамического регулирования количества ядер, доступных для выполнения потоков. Подсистема PPM выбирает минимальное количество ядер для потоков, которые будут запланированы.

Для ядер, которые приостановлены, обычно не запланировано ни одного потока, и они будут переведены в очень низкие состояния питания, если они не обрабатывают прерывания, DPC или другие строго привязаны работы. Остальные ядра отвечают за оставшуюся часть рабочей нагрузки. Стоянка ядер потенциально может повысить эффективность энергопотребления во время пониженного использования.

Для большинства серверов поведение ядра по умолчанию обеспечивает разумное распределение пропускной способности и энергии. На процессорах, где стоянка ядра может не показывать как можно больше преимуществ универсальных рабочих нагрузок, по умолчанию она может быть отключена.

Если сервер имеет определенные основные требования к стоянке, можно управлять количеством ядер, доступных для приостановки, с помощью параметра максимального числа ядер ядра **производительности процессора** или параметра **минимального количества ядер ядра производительности процессора** в Windows Server 2016.

Один из сценариев, в котором основная стоянка не всегда оптимальна для, — когда один или несколько активных потоков привязаны к нетривиальному подмножеству ЦП узла NUMA (то есть более 1 ЦП, но меньше, чем весь набор ЦП на узле). Когда основной алгоритм стоянки выполняет комплектацию ядер для освобождения (при условии увеличения интенсивности рабочей нагрузки), он может не всегда выбирать ядра в активном подмножестве привязаны (или подмножествах) для освобождения, что может привести к неприпаркованным ядрам, которые фактически не используются.

Значения этих параметров задаются в процентах в диапазоне от 0 до 100. Параметр **максимального числа ядер ядра производительности процессора** управляет максимальным процентом ядер, которые могут быть неприпаркованными (доступными для выполнения потоков) в любое время, в то время как параметр минимального числа ядер ядра **производительности процессора** управляет минимальным процентом ядер, которые могут быть неприпаркованными. Чтобы отключить приостановка ядра, задайте для параметра **минимального количества ядер ядра производительности процессора** значение 100% с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor CPMINCORES 100
Powercfg -setactive scheme_current
```

Чтобы уменьшить количество планируемых ядер до 50% от максимального значения счетчика, задайте для параметра Максимальная доля ядер **ядра производительности процессора** значение 50 следующим образом:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor CPMAXCORES 50
Powercfg -setactive scheme_current
```

## <a name="processor-performance-core-parking-utility-distribution"></a>Распространение служебной программы парковки ядра производительности процессора

Распространение служебной программы — это алгоритм оптимизации в Windows Server 2016, предназначенный для повышения эффективности энергопотребления для некоторых рабочих нагрузок. Он отслеживает неперемещаемую активность ЦП (то есть DPC, прерываний или строго привязаны потоков) и прогнозирует будущую работу на каждом процессоре в зависимости от предположения, что любая перемещаемая работа может равномерно распределяться по всем неприпаркованным ядрам.

Распространение служебной программы включено по умолчанию для сбалансированной схемы управления питанием для некоторых процессоров. Это позволяет сократить энергопотребление процессора, уменьшая запрошенные частоты ЦП рабочих нагрузок, которые находятся в определенном стабильном состоянии. Однако распространение служебной программы не обязательно является хорошим выбором алгоритма для рабочих нагрузок, для которых накладываются высокие объемы действий или для программ, в которых Рабочая нагрузка быстро и случайно смещается между процессорами.

Для таких рабочих нагрузок рекомендуется отключить распространение служебной программы с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor DISTRIBUTEUTIL 0
Powercfg -setactive scheme_current
```

## <a name="additional-references"></a>Дополнительные ссылки

- [Рекомендации по планированию производительности серверного оборудования](../index.md)
- [Рекомендации по питанию серверного оборудования](../power.md)
- [Настройка управления питанием процессора](processor-power-management-tuning.md)
- [Рекомендуемые параметры сбалансированного режима энергоснабжения](recommended-balanced-plan-parameters.md)
