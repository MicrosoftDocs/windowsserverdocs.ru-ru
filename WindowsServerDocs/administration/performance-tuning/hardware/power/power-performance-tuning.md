---
title: Мощности и производительности помощник по настройке
description: Управление питанием процессора (PPM), помощник по настройке для плана сбалансированного электропитания Windows Server
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Qizha;TristanB
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 4ad58e9b477f61844dedd9f6638efb12f1a96500
ms.sourcegitcommit: 6ef4986391607bb28593852d06cc6645e548a4b3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/07/2019
ms.locfileid: "66811566"
---
# <a name="power-and-performance-tuning"></a>Power и настройка производительности

Энергопотребление становится все более важной в средах центров обработки предприятия и данных, а также добавляет другой набор компромиссы в набор параметров настройки.

Windows Server 2016 оптимизирован для эффективности энергопотребления отличную производительность в самых различных рабочих нагрузок клиентов. [Настройка управления питанием (PPM) процессора для балансировки управления питанием Windows Server](processor-power-management-tuning.md) описание рабочих нагрузок, используемые для настройки параметров по умолчанию в Windows Server 2016, а также предложения по настраиваемые tunings.

Этот раздел разворачивает тему компромиссы эффективности энергопотребления, чтобы помочь вам принять обоснованное решение в том случае, если вам нужно настроить параметры питания по умолчанию на сервере. Тем не менее большинство серверного оборудования и рабочих нагрузок не требует настройки администратора power при под управлением Windows Server 2016.

## <a name="calculating-server-energy-efficiency"></a>Вычисление server энергетической эффективности

При настройке сервера для экономии электроэнергии, необходимо также учитывать производительность. Помощник по настройке влияет на производительность и эффективность, иногда неограниченного объема. Для каждой возможной корректировкой рассмотрите возможность целей power бюджета и производительности для определения, является ли такой компромисс приемлем.

Вы можете вычислить коэффициент эффективности энергопотребления сервера для полезным показателем, который включает информацию о мощности и производительности. Эффективность энергопотребления — это отношение работа, выполняемая в среднее степени, необходимой во время заданного количества времени.

![Формула энергоэффективности](../../media/perftune-guide-power-formula.png)

Эта метрика позволяет задать практические цели, с учетом компромисс между мощности и производительности. Напротив цель 10 процентов экономии энергии в центров обработки данных не удается записать соответствующий эффектов на производительность и наоборот.

Аналогичным образом Если вы настройки сервера для повышения производительности, 5 процентов и который результаты 10 процентов выше потребления энергии, финальный результат может или не может быть приемлемым для бизнес-целей. Метрики эффективности энергопотребления позволяет более продуманные и обоснованные принятия чем питание и метрики отдельно.

## <a name="measuring-system-energy-consumption"></a>Измерение потребления энергии системы

Внутреннее измерение мощности базовых показателей следует устанавливать до настройки сервера для повышения эффективности энергопотребления.

Если сервер имеет необходимую поддержку, можно использовать возможности отслеживания использования и бюджет функции в Windows Server 2016 для просмотра расход энергии на уровне системы с помощью системного монитора.

Один из способов определить ли сервер имеет поддержку отслеживания использования и бюджет — Просмотр [каталоге Windows Server](http://www.windowsservercatalog.com). Если модель сервера соответствует заданному значению новый квалификации улучшенное управление питанием в программа сертификации оборудования для Windows, он гарантированно поддерживают функции контроля использования программных продуктов и составление бюджета.

Еще один способ проверки для отслеживания использования поддержки — вручную найдите счетчики в системном мониторе. Откройте системный монитор, выберите **добавить счетчики**, а затем найдите **индикатор питания** группу счетчиков.

Если именованные экземпляры набора ваттметров, отображаются в поле, помеченное **экземпляры выбранного объекта**, поддерживает платформы, ваше отслеживания использования. **Power** счетчик, показывающий питания (Вт) отображается в группе выбранного счетчика. Точный источник значение power не указан. Например он может быть draw мгновенно power или draw среднее энергопотребление за некоторые интервал времени.

Если серверная платформа не поддерживает измерение, физического контроля использования программных продуктов устройства, подключенного к тока питания можно использовать для измерения draw или энергии энергопотребление системы.

Чтобы определить базовые показатели, следует выполнить измерение средней мощности, необходимой в различных точках нагрузки системы из состояния простоя до 100 процентов (максимальная пропускная способность) для создания нагрузки строки. На следующем рисунке показана загрузка строки для трех примеров конфигураций:

![Пример строк загрузки](../../media/perftune-guide-sample-loadlines.png)

Загрузка строки можно использовать для оценки и сравнить производительность и расход энергии конфигураций точек вообще нагрузки. В данном конкретном примере это легко увидеть, что такое наилучшую конфигурацию. Тем не менее легко может быть сценариях, где одна конфигурация лучше всего подходит для больших рабочих нагрузок и один лучше всего подходит для небольших рабочих нагрузок.

Необходимо тщательно проанализировать требования рабочей нагрузки для выбора оптимальной конфигурации. Не следует предполагать, что Найдя рабочей конфигурации, он всегда будет оптимальной. Следует выполнить измерение системы использования расход энергии на регулярной основе и после внесения изменений в рабочие нагрузки, уровни рабочей нагрузки или серверное оборудование.

## <a name="diagnosing-energy-efficiency-issues"></a>Диагностика эффективности энергопотребления

**PowerCfg.exe** поддерживает параметр командной строки, который можно использовать для анализа эффективности энергопотребления простоя сервера. При запуске PowerCfg.exe с **/energy** параметр, средство выполняет тест 60 секунд для обнаружения проблем энергии потенциал эффективности. Программа создает простой HTML-отчет в текущем каталоге.

> [!Important]
> Чтобы в точности отражает анализ, убедитесь, что закрыты все локальные приложения, перед запуском **PowerCfg.exe**. 

Сокращено тарифы tick таймера, драйверы, поддержка управления питанием отсутствие и чрезмерного использования ЦП небольшая часть поведения проблем, выявляемых **powercfg /energy** команды. Это средство предоставляет простой способ обнаружения и устранения неполадок управления питанием, что может привести к значительному снижению затрат в крупном центре обработки данных.

Дополнительные сведения о PowerCfg.exe см. в разделе [использование PowerCfg для оценки эффективности потребления энергии системы](https://msdn.microsoft.com/windows/hardware/gg463250.aspx).

## <a name="using-power-plans-in-windows-server"></a>С помощью схем управления питанием в Windows Server

Windows Server 2016 имеет три встроенные схемы управления питанием с целью обеспечения соответствия различным набором бизнес-потребностей. Эти планы обеспечит простой способ для настройки сервера для достижения целей питания или производительности. В следующей таблице описываются планы, перечислены распространенные сценарии использования каждого плана и предоставляет некоторые сведения о реализации для каждого плана.

| **План** | **Описание** | **Общие применимые сценарии** | **Реализация** |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------|
| С балансировкой (рекомендуется) | Значение по умолчанию. Целевые объекты хорошо энергопотребления без ущерба для производительности. | Общие вычисления | Соответствует емкости по требованию. Энергопотребление сбалансировать мощности и производительности. |
| Высокая производительность | Повышает производительность за счет высокой энергопотребление. Применить Power и температуры ограничения, операционные расходы и надежности вопросы. | Приложения с низкой задержкой и кода приложения, чувствителен к производительности процессора | Процессоры они всегда будут находиться в наивысшей производительности (в том числе частоты «turbo»). Все ядра unparked. Тепловыделение могут быть значительными. |
| Экономия энергии | Ограничивает производительность для экономии энергии и снижения эксплуатационных затрат. Не рекомендуется без тщательного тестирования производительности, что вполне подходит. | Развертывания с помощью power ограниченные бюджеты и температуры ограничения | CAPS частота процессора в процент от максимально (если поддерживается), а также позволяет другие функции энергосбережения. |


Эти схемы управления питанием существует в Windows для переменного тока (AC) и постоянного тока (DC) на базе систем, но мы предполагаем, что всегда используется серверами источнику питания переменного ТОКА.

Дополнительные сведения о схем управления питанием и конфигураций политики питания см. в разделе [Power Настройка и развертывание политик в Windows](https://msdn.microsoft.com/windows/hardware/gg463243.aspx).

> [!Note]
> Некоторые производители сервера имеют свои собственные параметры управления питанием, доступные через параметры BIOS. Если операционная система не имеет контроля над управления питанием, изменение схем управления питанием в Windows не влияет на системное питание и производительности.

## <a name="tuning-processor-power-management-parameters"></a>Настройка параметров управления питанием процессора

Каждый план питания представляет комбинацию многочисленные базовой параметров управления питанием. Встроенные планы — это три коллекции рекомендуемые параметры, которые охватывают широкий круг рабочих нагрузок и сценариев. Тем не менее мы понимаем, что эти планы не будут соответствовать требованиям каждого клиента.

Следующие разделы описывают способы настройки некоторых параметров управления определенного процессора power для достижения целей, не устраняется трех планов. Если вам нужно понять широкий массив параметров электропитания, см. в разделе [Power Настройка и развертывание политик в Windows](https://msdn.microsoft.com/windows/hardware/gg463243.aspx).

## <a name="processor-performance-boost-mode"></a>Режим повышения производительности процессора

Технологии Intel Turbo Boost и AMD Turbo CORE имеют функции, позволяющие процессоров обеспечить дополнительную производительность при особенно полезны (то есть при больших нагрузках системы загружает). Тем не менее эта функция увеличивает энергопотребление Процессора core, поэтому Windows Server 2016 настраивает Turbo технологий в зависимости от политики питания, и реализацию определенного процессора.

Turbo включена для высокой производительности управления питанием на всех процессорах Intel и AMD, и оно отключено для управления питанием режим экономии энергии. Для сбалансированного электропитания планов в системах, которые зависят от традиционных частота основе P-состояния управления Turbo включена по умолчанию только в том случае, если платформа поддерживает EPB регистр.

> [!Note]
> Регистрация EPB поддерживается только в Intel Westmere и процессоры, более поздней версии.

Для процессоров Intel Nehalem и AMD Turbo отключен по умолчанию на платформах на базе P-состояния. Тем не менее, если система поддерживает совместной работы процессора производительности элемента управления (CPPC), новый альтернативный режим обмена данными по производительности между операционная система и оборудование (определенных в ACPI 5.0), Turbo может привлечь Если операционной Windows система запрашивает динамически оборудование на обеспечение высочайшего уровня производительности.

Чтобы включить или отключить функцию Turbo Boost, необходимо настроить параметр режима повышение производительности процессора, администратором или путем настройки параметров по умолчанию для схемы управления питанием выбранной. Режим повышения производительности процессора имеет пять допустимых значений, как показано в таблице 5.

Для элемента управления на основе P-состояния варианты отключены, Enabled (Turbo доступна на оборудовании, каждый раз, когда запрашивается Номинальное производительности) и эффективный (Turbo доступна только в том случае, если регистр EPB реализуется).

Для элемента управления на основе CPPC варианты отключены, эффективной поддержкой (Windows указывает точный объем Turbo для предоставления) и агрессивная (Windows запрашивает «Максимальная производительность» для включения Turbo).

В Windows Server 2016 значение по умолчанию для режима Boost — 3.

| **Name** | **Поведение на основе P-состояния** | **Поведение CPPC** |
|--------------------------|------------------------|-------------------|
| 0 (отключено) | Отключено | Отключено |
| 1 (включено) | Enabled | Эффективный включена |
| 2 (агрессивная) | Enabled | Агрессивное |
| 3 (эффективный включена) | Эффективность | Эффективный включена |
| 4 (эффективный агрессивной) | Эффективность | Агрессивное |

 
Следующие команды включите режим повышения производительности процессора текущую схему управления питанием (указать политику с помощью псевдонима GUID):

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PERFBOOSTMODE 1
Powercfg -setactive scheme_current
```

> [!Important]
> Необходимо запустить **powercfg - setactive** команду, чтобы включить новые параметры. Необходимо перезагрузить сервер.

Чтобы это значение используется для управления питанием, отличный от текущего выбранного плана, можно использовать псевдонимы, например СХЕМУ\_MAX (режим экономии энергии), СХЕМУ\_MIN (высокая производительность) и схему, КОТОРАЯ\_СБАЛАНСИРОВАННЫЙ (Сбалансированный) вместо СХЕМЫ\_ТЕКУЩЕГО. Замените «схему текущей» в командах - setactive powercfg показано ранее, с требуемый псевдоним для включения этой схемы управления питанием.

Например для настройки режима Boost в плане режим экономии энергии и убедитесь, что экономия энергии является текущий план, выполните следующие команды:

``` syntax
Powercfg -setacvalueindex scheme_max sub_processor PERFBOOSTMODE 1
Powercfg -setactive scheme_max
```

## <a name="minimum-and-maximum-processor-performance-state"></a>Минимальное и максимальном числе процессоров состояния производительности

Процессоры между состояниями производительности (P-состояния) меняется очень быстро питания совпадение требование, обеспечивают производительность, если это необходимо и экономя энергию, когда это возможно. Если сервер имеет определенные требования к высокой производительности или минимальное энергопотребление, может потребоваться настройка **состояние производительности процессора минимум** параметр или **максимальной производительности процессора Состояние** параметра.

Значения для **состояние производительности процессора минимум** и **состояние производительности процессора максимально** параметры выражаются в процентах от максимальной частоты процессора, со значением в диапазоне от 0 до 100.

Если сервер требует сверхнизкой задержкой инвариантного тактовая частота Процессора (например, для повторяемого тестирования) и самые высокие уровни производительности, вы можете не процессоров, переключение состояния производительности нижнего. Для такой сервер может ограничивать состояния производительности процессора в масштабе 100%, используя следующие команды:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PROCTHROTTLEMIN 100
Powercfg -setactive scheme_current
```

Если сервер требует меньше энергии, может потребоваться ограничить состояния производительности процессора в процентах от максимально. Например можно ограничить процессора на 75 процентов от его максимальной частоты с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor PROCTHROTTLEMAX 75
Powercfg -setactive scheme_current
```

> [!Note]
> Производительность процессора на процент от максимально ограниченного требуется поддержка процессоров. См. в документации процессора, чтобы определить, существует ли такая поддержка, или просмотрите счетчик системного монитора **% от максимальной частоты** в **процессора** группы, чтобы увидеть, были ли любые ограничения частоты применить.

## <a name="processor-performance-increase-and-decrease-of-thresholds-and-policies"></a>Производительность процессора увеличить и уменьшить пороговые значения и политик

Скорость, с которой состояние производительности процессора, увеличивает или уменьшает управляет несколькими параметрами. Самой заметной влиять следующие параметры:

-   **Порог повышения производительности процессора** определяет использование значение выше это приведет к увеличению состояния производительности процессора. Большие значения снизить степень увеличения состояния производительности в ответ на повышение действий.

-   **Пороговое значение уменьшение производительности процессора** определяет ниже использования значение, что приведет к уменьшению состояния производительности процессора. Более крупные значения увеличивают скорость уменьшение состояния производительности в периоды простоя.

-   **Политики повышения производительности процессора и привести к снижению производительности процессора** политики определить, какие состояния производительности следует задавать, если происходит изменение. Политика «Single» означает, что он выбирает следующее состояние. «Rocket» означает максимальное или минимальное производительности энергопотребления. «Идеального» пытается найти баланс между мощности и производительности.

Например если серверу требуется сверхнизкой задержкой при по-прежнему хотят использовать преимущества пониженного энергопотребления периоды простоя, удалось quicken увеличение состояние производительности для увеличения нагрузки и низкая уменьшение, при снижении нагрузки. Следующие команды присвоено увеличение значение «Rocket» быстрее повысить состояние и задать политику уменьшение «Один». Увеличение или уменьшение пороговые значения задаются до 10 и 8 соответственно.

``` syntax
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFINCPOL 2
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFDECPOL 1
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFINCTHRESHOLD 10
Powercfg.exe -setacvalueindex scheme_current sub_processor PERFDECTHRESHOLD 8
Powercfg.exe /setactive scheme_current
```

## <a name="processor-performance-core-parking-maximum-and-minimum-cores"></a>Ядро производительности процессора, парковки максимальное и минимальное ядер

Технология Core parking — это функция, которая была введена в Windows Server 2008 R2. Ядро процессора power management (PPM) и планировщик совместно динамически корректировать число ядер, доступных для выполнения потоков. Подсистема PPM выбирает минимальное число ядер для потоков, которые будут запланированы.

Ядер, которые паркуются обычно не имеют назначенные обсуждения, и они будет удалена в очень низкого энергопотребления, когда они не обрабатывают прерываний, DPC или другим строго непотоковой рабочих. Остальные ядра отвечают за оставшуюся часть рабочей нагрузки. Технология Core parking потенциально может увеличить эффективность энергопотребления во время использования ниже.

Для большинства серверов по умолчанию технология core parking предоставляет разумного баланса эффективности пропускной способности и энергии. На процессорах, где технология core parking могут не отображаться столько преимущество универсальные рабочие нагрузки его можно отключить по умолчанию.

Если сервер имеет парковки требования из ядер, вы можете контролировать количество ядер, доступных на парковку с помощью **производительность Core парковки максимальное ядер процессора** параметр или **процессора Производительность Core парковки минимум ядер** параметр в Windows Server 2016.

Один из сценариев, технология core parking не всегда является оптимальным выбором для — при наличии одного или нескольких активных потоков, родственных нетривиальные подмножеству ЦП в узле NUMA (то есть более чем 1 ЦП, но меньше всего набора ЦП на узле). При основной алгоритм парковкой выбирает ядер, которое unpark (при условии, что происходит увеличение интенсивности рабочей нагрузки), он не всегда может получить ядер в active непотоковой подмножества (или подмножества), чтобы unpark и таким образом может окажутся unparking ядра, не будет фактически загруженные.

Значения для этих параметров являются процентных долей в диапазоне от 0 до 100. **Производительность Core парковки максимальное ядер процессора** параметр определяет максимальную процентную долю ядер, которые могут быть unparked (доступен для запуска потоков) в любое время, пока **парковки Core производительности процессора Минимум ядер** параметр задает минимальный процент ядер, которые могут быть unparked. Чтобы отключить технология core parking, задайте **производительность Core парковки минимальное количество ядер процессора** параметр до 100 процентов с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor CPMINCORES 100
Powercfg -setactive scheme_current
```

Чтобы уменьшить количество ядер, планируемые в значение 50% от максимального числа, задайте **производительность Core парковки максимальное ядер процессора** параметр в значение 50, следующим образом:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor CPMAXCORES 50
Powercfg -setactive scheme_current
```

## <a name="processor-performance-core-parking-utility-distribution"></a>Ядро производительности процессора, парковки служебной программы распространения

Программы распространения является оптимизация алгоритмов в Windows Server 2016, предназначенный для повышения эффективности управления питанием для некоторых рабочих нагрузок. Он отслеживает неперемещаемые активность ЦП (то есть DPC, прерывания или строго непотоковой потоков), и он прогнозирует будущей работы на каждый процессор, основываясь на предположении, что какой-либо подвижной работы могут распространяться одинаково во всех ядрах unparked.

Программа распространения включена по умолчанию для плана сбалансированного электропитания для некоторых процессоров. Его можно уменьшить энергопотребление процессора, понижая запрошенного частоты ЦП рабочих нагрузок, которые находятся в устойчивом состоянии достаточно. Тем не менее программа распространения не обязательно алгоритмического подходит для рабочих нагрузок, которые подвержены высокой активности пакетов или программ, где рабочая нагрузка быстро и случайным образом перемещается между процессорами.

Для таких рабочих нагрузок рекомендуется отключение распространения программы с помощью следующих команд:

``` syntax
Powercfg -setacvalueindex scheme_current sub_processor DISTRIBUTEUTIL 0
Powercfg -setactive scheme_current
```

## <a name="see-also"></a>См. также
- [Вопросы производительности оборудования сервера](../index.md)
- [Рекомендации по питанию серверного оборудования](../power.md)
- [Настройка управления питанием процессора](processor-power-management-tuning.md)
- [Рекомендуемые параметры сбалансированного режима энергоснабжения](recommended-balanced-plan-parameters.md)
