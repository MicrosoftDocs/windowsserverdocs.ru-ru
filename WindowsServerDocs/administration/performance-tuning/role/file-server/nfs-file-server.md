---
title: Настройка производительности файловых серверов NFS
description: Настройка производительности файловых серверов NFS
ms.topic: article
author: phstee
ms.author: roopeshb, nedpyle
ms.date: 10/16/2017
ms.openlocfilehash: 897e45a99ac4640c5fbae4287ac99a0bce6eae66
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87896183"
---
# <a name="performance-tuning-nfs-file-servers"></a>Настройка производительности файловых серверов NFS

## <a name="services-for-nfs-model"></a><a href="" id="servicesnfs"></a>Службы для модели NFS


В следующих разделах приводятся сведения о службах Майкрософт для сетевой файловой системы (NFS) для обмена данными между клиентом и сервером. Так как NFS v2 и NFS v3 по-прежнему являются самыми распространенными версиями протокола, все разделы реестра, за исключением Максконкуррентконнектионсперип, относятся только к NFS v2 и NFS v3.

Для протокола NFS версии 4.1 Настройка реестра не требуется.

### <a name="service-for-nfs-model-overview"></a>Общие сведения о модели службы для NFS

Службы Microsoft для NFS предоставляют решение для совместного использования файлов для предприятий, имеющих смешанную среду Windows и UNIX. Эта модель взаимодействия состоит из клиентских компьютеров и сервера. Приложения в файлах запроса клиента, расположенные на сервере через мини-перенаправитель (Rdbss.sys) и NFS (Nfsrdr.sys). Мини-перенаправитель использует протокол NFS для отправки своего запроса через TCP/IP. Сервер получает несколько запросов от клиентов через TCP/IP и направляет запросы в локальную файловую систему (Ntfs.sys), которая обращается к стеку хранилища.

На следующем рисунке показана модель взаимодействия для NFS.

![модель взаимодействия NFS](../../media/perftune-guide-nfs-model.png)

### <a name="tuning-parameters-for-nfs-file-servers"></a>Параметры настройки для файловых серверов NFS

Следующие \_ параметры реестра DWORD могут повлиять на производительность файловых серверов NFS:

-   **оптималреадс**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\OptimalReads
    ```

    Значение по умолчанию — 0. Этот параметр определяет, будут ли файлы открываться для \_ произвольного \_ доступа к файлам или \_ только для последовательного файла \_ , в зависимости от характеристик операций ввода-вывода рабочей нагрузки. Установите значение 1, чтобы принудительно открывать файлы для \_ случайного \_ доступа к файлам. \_Случайный \_ доступ к файлу предотвращает предзагрузку файловой системы и диспетчера кэша.

    >[!NOTE]
    > Этот параметр следует тщательно оценить, так как он может оказать влияние на увеличение размера кэша системных файлов.


-   **рдврхандлелифетиме**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrHandleLifeTime
    ```

    Значение по умолчанию — 5. Этот параметр управляет временем существования записи кэша NFS в кэше File Handle. Параметр ссылается на записи кэша, имеющие связанный файл Open NTFS. Фактическое время существования приблизительно равно значению Рдврхандлелифетиме, умноженному на Рдврсреадслиптиме. Минимальное значение — 1, а максимальное — 60.

-   **рдврнфшандлелифетиме**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrNfsHandleLifeTime
    ```

    Значение по умолчанию — 5. Этот параметр управляет временем существования записи кэша NFS в кэше File Handle. Параметр ссылается на записи кэша, не имеющие связанного с ним открытого обработчика файлов NTFS. Службы для NFS используют эти записи кэша для хранения атрибутов файлов, не сохраняя открытым маркером файловой системы. Фактическое время существования приблизительно равно значению Рдврнфшандлелифетиме, умноженному на Рдврсреадслиптиме. Минимальное значение — 1, а максимальное — 60.

-   **рдврнфсреадхандлеслифетиме**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrNfsReadHandlesLifeTime
    ```

    Значение по умолчанию — 5. Этот параметр управляет временем существования записи кэша чтения NFS в кэше File Handle. Фактическое время существования приблизительно равно значению Рдврнфсреадхандлеслифетиме, умноженному на Рдврсреадслиптиме. Минимальное значение — 1, а максимальное — 60.

-   **рдврсреадслиптиме**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrThreadSleepTime
    ```

    Значение по умолчанию — 5. Этот параметр управляет интервалом ожидания перед запуском потока очистки в кэше обработки файлов. Значение находится в тактах и не является детерминированным. Такт эквивалентен приблизительно 100 наносекунд. Минимальное значение — 1, а максимальное — 60.

-   **филехандлекачесизеинмб**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\FileHandleCacheSizeinMB
    ```

    Значение по умолчанию — 4. Этот параметр задает максимальный объем памяти, который будет использоваться записями кэша обработки файлов. Минимальное значение — 1, а максимальное — 1 \* 1024 \* 1024 \* 1024 (1073741824).

-   **локкфилехандлекачеинмемори**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\LockFileHandleCacheInMemory
    ```

    Значение по умолчанию — 0. Этот параметр указывает, блокируются ли в памяти физические страницы, выделенные для размера кэша, заданного параметром Филехандлекачесизеинмб. Если установить это значение равным 1, это действие будет включено. Страницы заблокированы в памяти (не выводятся на диск), что повышает производительность при разрешении дескрипторов файлов, но сокращает объем памяти, доступный приложениям.

-   **максикбнфсреадхандлескачесизе**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\MaxIcbNfsReadHandlesCacheSize
    ```

    Значение по умолчанию — 64. Этот параметр указывает максимальное количество дескрипторов на том для кэша считанных данных. Записи кэша чтения создаются только в системах, имеющих более 1 ГБ памяти. Минимальное значение равно 0, а максимальное значение — 0xFFFFFFFF.

-   **хандлесигнинженаблед**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\HandleSigningEnabled
    ```

    Значение по умолчанию — 1. Этот параметр определяет, будут ли зашифрованы дескрипторы, предоставленные файловым сервером NFS. Установка значения 0 отключает обработку подписи.

-   **рдврнфсдеферредвритесфлушделай**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrNfsDeferredWritesFlushDelay
    ```

    Значение по умолчанию равно 60. Этот параметр представляет собой мягкое время ожидания, которое управляет длительностью NFS v3 нестабильное кэширование записи данных. Минимальное значение равно 1, а максимальное — 600. Фактическое время существования приблизительно равно значению Рдврнфсдеферредвритесфлушделай, умноженному на Рдврсреадслиптиме.

-   **качеаддфромкреатеандмкдир**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\CacheAddFromCreateAndMkDir
    ```

    Значение по умолчанию — 1 (включено). Этот параметр определяет, будут ли в кэше дескрипторов файлов храниться дескрипторы, открытые во время создания NFS v2 и V3 обработчики процедур RPC CREATE и MKDIR. Присвойте этому параметру значение 0, чтобы отключить добавление записей в кэш в путях кода CREATE и MKDIR.

-   **аддитионалделайедворкерсреадс**

    ```
    HKLM\SYSTEM\CurrentControlSet\Control\SessionManager\Executive\AdditionalDelayedWorkerThreads
    ```

    Увеличивает число отложенных рабочих потоков, созданных для указанной рабочей очереди. Отложенные рабочие потоки обрабатывают рабочие элементы, которые не считаются критичными по времени, и могут иметь страничный стек памяти при ожидании рабочих элементов. Недостаточное количество потоков сокращает скорость обслуживания рабочих элементов. слишком большое значение потребляет системные ресурсы без необходимости.

-   **NtfsDisable8dot3NameCreation**

    ```
    HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisable8dot3NameCreation
    ```

    По умолчанию в Windows Server 2012 и Windows Server 2012 R2 используется значение 2. В выпусках до Windows Server 2012 значение по умолчанию — 0. Этот параметр определяет, создает ли NTFS короткое имя в соглашении об именовании 8.3 (MSDOS) для длинных имен файлов и для имен файлов, содержащих символы из расширенной кодировки. Если значение этой записи равно 0, то файлы могут иметь два имени: имя, которое указывает пользователь, и краткое имя, создаваемое системой NTFS. Если указанное пользователем имя соответствует соглашению об именовании 8.3, NTFS не создает короткое имя. Значение 2 означает, что этот параметр можно настроить для каждого тома.

    >[!NOTE]
    > По умолчанию для системного тома включено значение 8.3. Все остальные тома в Windows Server 2012 и Windows Server 2012 R2 по умолчанию отключены. Изменение этого значения не приводит к изменению содержимого файла, но позволяет избежать создания атрибута короткого имени для файла, что также влияет на отображение и управление файлом в NTFS. Для большинства файловых серверов рекомендуемым параметром является 1 (отключен).


-   **нтфсдисаблеластакцессупдате**

    ```
    HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisableLastAccessUpdate
    ```

    Значение по умолчанию — 1. Этот параметр позволяет сократить нагрузку и задержку дискового ввода-вывода, отключив обновление метки даты и времени для последнего доступа к файлу или каталогу.

-   **максконкуррентконнектионсперип**

    ```
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Rpcxdr\Parameters\MaxConcurrentConnectionsPerIp
    ```

    Значение параметра Максконкуррентконнектионсперип по умолчанию — 16. Вы можете увеличить это значение до максимума в 8192, чтобы увеличить число подключений на каждый IP-адрес.
