---
title: Настройка производительности для NFS файловых серверов
description: Настройка производительности для NFS файловых серверов
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
author: phstee
ms.author: RoopeshB, NedPyle
ms.date: 10/16/2017
ms.openlocfilehash: 06a2a7206d3673046bd5a926a657bac91b02bf5f
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59879015"
---
# <a name="performance-tuning-nfs-file-servers"></a>Настройка NFS файловые серверы производительности

## <a href="" id="servicesnfs"></a>Службы для NFS модели


Следующие разделы содержат сведения о службах Майкрософт для сетевой файловой системы (NFS) модели для обмена данными между клиентом и сервером. Поскольку NFS v2 и NFS v3 по-прежнему наиболее широкое распространение версий протокола, все ключи реестра, за исключением MaxConcurrentConnectionsPerIp применяются к NFS v2 и NFS v3 только.

Настройка реестра не является обязательным для протокола NFS версии 4.1.

### <a name="service-for-nfs-model-overview"></a>Службы для NFS Общие сведения о модели

Службы для NFS предоставляет решение общего доступа к файлам для организаций, использующих смешанной среды Windows и UNIX. Эта модель связи состоит из клиентских компьютеров и сервера. Приложения на стороне клиента запросить файлы, расположенные на сервере через Перенаправитель (Rdbss.sys) и мини-перенаправителе NFS (Nfsrdr.sys). Мини перенаправителе использует протокол NFS для отправки запроса, его через TCP/IP. Сервер получает несколько запросов от клиентов через TCP/IP и направляет запросы к локальной файловой системе (Ntfs.sys), который обращается к стека хранилища.

Ниже изображена модель обмена данными для NFS.

![модель взаимодействия NFS](../../media/perftune-guide-nfs-model.png)

### <a name="tuning-parameters-for-nfs-file-servers"></a>Настройка параметров для NFS файловых серверов

Следующий REG\_параметры реестра DWORD может повлиять на производительность NFS файловых серверов:

-   **OptimalReads**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\OptimalReads
    ```

    Значение по умолчанию — 0. Этот параметр определяет, открываются ли файлы для файла\_RANDOM\_доступа или для файла\_SEQUENTIAL\_только в зависимости от характеристик рабочей нагрузки ввода-вывода. Это значение равно 1 для принудительной файлов для открытия файла\_RANDOM\_доступа. ФАЙЛ\_RANDOM\_доступа предотвращает предварительная выборка диспетчер файлов системы и кэша.

    >[!NOTE]
    > Этот параметр необходимо тщательно вычислить, так как при этом возможны потенциального воздействия на кэш файловой системы расти.


-   **RdWrHandleLifeTime**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrHandleLifeTime
    ```

    Значение по умолчанию — 5. Этот параметр контролирует время существования элемента кэша NFS в кэше дескриптор файла. Параметр ссылается на записей кэша, которые имеют связанные открытого файла NTFS обработки. Фактическое время жизни приблизительно равно RdWrHandleLifeTime, умноженное на RdWrThreadSleepTime. Минимальное значение — 1, а максимальное — 60.

-   **RdWrNfsHandleLifeTime**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrNfsHandleLifeTime
    ```

    Значение по умолчанию — 5. Этот параметр контролирует время существования элемента кэша NFS в кэше дескриптор файла. Параметр ссылается на записей кэша, у которых нет связанных открытого файла NTFS обработки. Службы для NFS использует эти записи кэша для хранения атрибутов файла для файла без сохранения открытый дескриптор в файловой системе. Фактическое время жизни приблизительно равно RdWrNfsHandleLifeTime, умноженное на RdWrThreadSleepTime. Минимальное значение — 1, а максимальное — 60.

-   **RdWrNfsReadHandlesLifeTime**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrNfsReadHandlesLifeTime
    ```

    Значение по умолчанию — 5. Этот параметр контролирует время существования NFS прочесть запись кэша в кэше дескриптор файла. Фактическое время жизни приблизительно равно RdWrNfsReadHandlesLifeTime, умноженное на RdWrThreadSleepTime. Минимальное значение — 1, а максимальное — 60.

-   **RdWrThreadSleepTime**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrThreadSleepTime
    ```

    Значение по умолчанию — 5. Этот параметр определяет интервал ожидания перед запуском поток очистки кэша дескриптор файла. Значение находится в тактах, и он является недетерминированным. Такт соответствует приблизительно 100 наносекунд. Минимальное значение — 1, а максимальное — 60.

-   **FileHandleCacheSizeinMB**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\FileHandleCacheSizeinMB
    ```

    Значение по умолчанию — 4. Этот параметр задает максимальный объем памяти для использования процессом записи кэша дескриптор файла. Минимальное значение — 1, а максимальный — 1\*1024\*1024\*1024 (1073741824).

-   **LockFileHandleCacheInMemory**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\LockFileHandleCacheInMemory
    ```

    Значение по умолчанию — 0. Этот параметр указывает, блокируются ли физических страниц, выделенных для размер кэша, указанный параметром FileHandleCacheSizeInMB в памяти. Значение 1 включает это действие. Страницы блокируются в памяти (не выгружены на диск), что улучшает производительность при разрешении дескрипторы файлов, но снижает объем памяти, которая доступна для приложений.

-   **MaxIcbNfsReadHandlesCacheSize**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\MaxIcbNfsReadHandlesCacheSize
    ```

    Значение по умолчанию — 64. Этот параметр задает максимальное число дескрипторов на том для чтения данных кэша. Операции чтения кэш создаются только в системах, имеющих более 1 ГБ памяти. Минимальное значение — 0, а максимальный — 0xFFFFFFFF.

-   **HandleSigningEnabled**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\HandleSigningEnabled
    ```

    Значение по умолчанию — 1. Этот параметр контролирует криптографически подписанные маркеры, на которые указывает файлового сервера для NFS. Установка значения 0 отключает маркер подписи.

-   **RdWrNfsDeferredWritesFlushDelay**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\RdWrNfsDeferredWritesFlushDelay
    ```

    Значение по умолчанию — 60. Этот параметр является обратимо тайм-аута управляющее длительностью кэширование NFS V3 НЕСТАБИЛЬНОЙ записи данных. Минимальное значение — 1, а максимальное значение — 600. Фактическое время жизни приблизительно равно RdWrNfsDeferredWritesFlushDelay, умноженное на RdWrThreadSleepTime.

-   **CacheAddFromCreateAndMkDir**

    ```
    HKLM\System\CurrentControlSet\Services\NfsServer\Parameters\CacheAddFromCreateAndMkDir
    ```

    Значение по умолчанию — 1 (включено). Этот параметр контролирует, обрабатывать ли дескрипторы, открытые во время NFS версии 2 и процедуру СОЗДАНИЯ V3 и MKDIR RPC, обработчики, сохраняются в файле кэша. Это значение равно 0, чтобы отключить добавления элементов в кэш в CREATE and MKDIR ветви кода.

-   **AdditionalDelayedWorkerThreads**

    ```
    HKLM\SYSTEM\CurrentControlSet\Control\SessionManager\Executive\AdditionalDelayedWorkerThreads
    ```

    Увеличивает число отложенных рабочих потоков, которые создаются для указанной рабочей очереди. Отложенные рабочих потоков процесса работ, которые не считаются критичных по времени и на которых их стек памяти выгружена во время ожидания для рабочих элементов. Недостаточное количество потоков снижает скорость передачи, в какие рабочие элементы обслуживаются; слишком большое значение чрезмерно потребляет системные ресурсы.

-   **NtfsDisable8dot3NameCreation**

    ```
    HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisable8dot3NameCreation
    ```

    По умолчанию в Windows Server 2012 и Windows Server 2012 R2 — 2. В выпусках, предшествующих Windows Server 2012 значение по умолчанию равно 0. Этот параметр определяет, создает ли NTFS краткое имя в формате 8.3 (MSDOS) соглашения об именовании для длинные имена файлов и имена файлов, содержащих символы из расширенного набора. Если значением этого параметра равно 0, файлы могут иметь два имени: имя, которое пользователь указывает и короткое имя, которое формирует NTFS. Значение, если указанное имя пользователя соответствует соглашению об именовании 8dot3, NTFS не создает короткое имя. Значение 2 означает, что этот параметр можно настроить для каждого тома.

    >[!NOTE]
    > Системный том имеет 8dot3 включен по умолчанию. Все тома в Windows Server 2012 и Windows Server 2012 R2 имеют 8dot3, отключены по умолчанию. Изменение этого значения не изменяет содержимое файла, но она позволяет избежать создания атрибута короткое имя для файла, который также изменяет как NTFS отображает и управляет ими файл. Для большинства файловых серверов рекомендуется установить значение 1 (выключено).


-   **NtfsDisableLastAccessUpdate**

    ```
    HKLM\System\CurrentControlSet\Control\FileSystem\NtfsDisableLastAccessUpdate
    ```

    Значение по умолчанию — 1. Этот параметр системно глобального уменьшает нагрузки дискового ввода-вывода и задержки, отключив обновления отметки даты и времени для последнего доступа к файлу или каталогу.

-   **MaxConcurrentConnectionsPerIp**

    ```
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Rpcxdr\Parameters\MaxConcurrentConnectionsPerIp
    ```

    Значение по умолчанию параметра MaxConcurrentConnectionsPerIp равно 16. Можно увеличить это значение максимум до 8192, чтобы увеличить число подключений на IP-адрес.
