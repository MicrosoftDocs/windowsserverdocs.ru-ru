---
title: Определение и домен контроллера размещении сайта в настройке производительности ADDS
description: Узел определения и домен контроллера рекомендации по размещению в настройке производительности Active Directory.
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: TimWi; ChrisRob; HerbertM; KenBrumf;  MLeary; ShawnRab
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 0e5c5f8b7cf5c028fbfa5d72c4bc1218565d4087
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59814025"
---
# <a name="proper-placement-of-domain-controllers-and-site-considerations"></a>Правильное размещение контроллеров домена и рекомендации по сайта

Определение сайта крайне важен для производительности. Клиентов, превышенным узла могут возникать к снижению производительности для проверки подлинности и запросов. Кроме того с появлением IPv6 на клиентах, запрос может быть на любом IPv4 или IPv6-адрес и Active Directory требуется должным образом в протоколе IPv6 сайтов. Операционная система предпочитает IPv6 IPv4 в том случае, когда оба настроены.

Начиная с Windows Server 2008, контроллер домена попытается использовать разрешение имен для выполнить обратный просмотр, чтобы определить сайт клиента должен находиться в. Это может привести к исчерпанию пула потоков ATQ и привести к контроллеру домена перестанет отвечать на запросы. Соответствующие разрешения на это — правильно определить топологии сайтов для IPv6. Избежать этого один может оптимизировать инфраструктура разрешения имен, чтобы быстро реагировать на запросы контроллера домена. Дополнительные сведения см. в разделе [Windows Server 2008 или Windows Server 2008 R2 Domain Controller задержка ответа на запросы LDAP или Kerberos](https://support.microsoft.com/kb/2668820).

Для сценариев, где используются RODC в дополнительной области рассмотрения ищет контроллеров домена для чтения и записи.  Некоторые операции, требуется доступ к контроллеру домена для записи или предназначенных для записи контроллер домена, время было бы достаточно контроллер домена только для чтения.  Оптимизация эти сценарии займет два пути:
-   Время контроллера домена только для чтения было бы достаточно обратиться к доступным для записи контроллеров домена.  Для этого требуется изменение кода приложения.
-   Где доступный для записи контроллер домена может потребоваться.  Место чтения и записи контроллеров домена в центральное расположение для минимизации задержки.

Для дальнейшей информации справочные материалы.
-   [Совместимость приложений с подобными контроллерами](https://technet.microsoft.com/library/cc772597.aspx)
-   [Интерфейс службы Active Directory (ADSI) и чтения только контроллер домена (RODC) — избежать проблем с производительностью](https://blogs.technet.microsoft.com/fieldcoding/2012/06/24/active-directory-service-interface-adsi-and-the-read-only-domain-controller-rodc-avoiding-performance-issues/)

## <a name="optimize-for-referrals"></a>Оптимизация для ссылок

Рекомендации являются как перенаправляются запросы LDAP, когда контроллер домена не содержать копию раздела, в запросе. При возвращении ссылки, он содержит отличительное имя секции, DNS-имя и номер порта. Клиент использует эти сведения для продолжения запроса на сервере, который содержит секцию. Это сценарий DCLocator все рекомендации определений узла и размещение контроллера домена поддерживается, но приложения, которые зависят от направления часто упускают из виду. Рекомендуется, чтобы обеспечить топологию AD, включая определения узла и размещение контроллера домена в соответствии с потребностями клиента. Кроме того это может быть, имеющие контроллеры доменов из нескольких доменов в одном сайте, настроив параметры DNS или перемещение узла приложения.

## <a name="optimization-considerations-for-trusts"></a>Рекомендации по оптимизации для отношений доверия

В сценарии внутри леса доверия обрабатываются в соответствии со следующей иерархии домена: Домен внучатых -&gt; дочерний домен -&gt; леса корневой домен -&gt; дочерний домен -&gt; Гранд дочерний домен. Это означает, что для защиты каналов в корне леса и всех его родительских, может стать перегружен из-за статистической обработки запросов проверки подлинности, транзитом контроллеров домена в иерархии доверия. Это также привести к задержкам в больших географическое рассредоточение каталогов Active Directory, после проверки подлинности также к транзитной высокую задержку ссылки, чтобы повлиять на поток выше. Перегрузки может возникнуть в сценариях доверия между лесами и низкого уровня. Следующие рекомендации применимы для всех сценариев:

-   Правильно настройте MaxConcurrentAPI для поддержки нагрузки по безопасному каналу. Дополнительные сведения см. в разделе [как настройка производительности для проверки подлинности NTLM с использованием настройки MaxConcurrentApi](https://support.microsoft.com/kb/2688798/EN-US).

-   Создайте установленное напрямую доверие, в зависимости от нагрузки.

-   Убедитесь, что каждый контроллер домена в домене, может выполнять разрешение имен и взаимодействовать с контроллерами домена в доверенном домене.

-   Убедитесь, что вопросы локальность принимаются во внимание для отношений доверия.

-   Протокол Kerberos, где это возможно и свести к минимуму влияние безопасный канал для уменьшения риска достичь MaxConcurrentAPI узкие места.

Междоменное доверие, сценарии представляют собой области, которая была постоянно становится болевой точкой для многих клиентов. Имя разрешения проблемы и возможностью подключения, часто из-за брандмауэрами, привести к исчерпанию ресурсов в доверяющем домене и влияет на все клиенты. Кроме того это часто упускают из виду такой сценарий оптимизация доступ к контроллерам доверенного домена. Далее приведены ключевых областях, чтобы убедиться, что это работает должным образом.

-   Убедитесь, что разрешение имен DNS и WINS, доверяющем контроллеры домена работают под можно разрешить точный список контроллеров домена, доверенного домена.

    -   Статически добавленных записей наблюдается тенденция устарели и снова добавить неполадки со временем. Служба DNS перенаправляет, динамическое обновление DNS и объединение инфраструктуры WINS/DNS, более простого в сопровождении в долгосрочной перспективе.

    -   Обеспечения правильности конфигурации серверов пересылки, условной пересылки и дополнительные копии как зон прямого и обратного просмотра для каждого ресурса, в которой клиент может потребоваться доступ к среде. Опять же это требует обслуживания вручную и тенденция устарели. Консолидация инфраструктуры идеально.

-   Контроллеры домена в доверяющем домене будет пытаться найти контроллеры домена в доверенном домене, во-первых, в том же сайте, а затем выполнить восстановление размещения универсальных указателей.

    -   Дополнительные сведения о работе локатора контроллеров домена см. в разделе [поиск контроллера домена в ближайший сайт](https://technet.microsoft.com/library/cc978016.aspx).

    -   Для достижения имена сайтов между доменами доверенных и доверяющих в соответствии с контроллера домена в том же расположении. Убедитесь, подсети и IP-адрес, который сопоставления должным образом связаны с сайтами в обоих лесах. Дополнительные сведения см. в разделе [домена обнаружения через доверие леса](http://blogs.technet.com/b/askds/archive/2008/09/24/domain-locator-across-a-forest-trust.aspx).

    -   Убедитесь, что открыты порты, в соответствии с потребностями локатора контроллеров домена, для обнаружения контроллера домена. Если между доменами существует брандмауэры, убедитесь, что брандмауэры настроены правильно для всех отношений доверия. Если брандмауэры не открыты, доверяющем домене по-прежнему будет пытаться получить доступ к доверенному домену. Если какой-либо причине произошел сбой связи, доверяющем контроллер домена будет истечь время ожидания запроса к контроллеру доверенного домена. Тем не менее эти истечения времени ожидания может занять несколько секунд на запрос и может использовать сетевые порты в доверяющем домене, при высоком уровне объема входящих запросов. Клиент может наблюдаться в течение которого ожидает время ожидания на контроллере домена, как его работа замедлена потоки, которые удалось преобразовать в его работа замедлена приложения (если приложение выполняет запросы в основной поток). Дополнительные сведения см. в разделе [Настройка брандмауэра для домены и доверие](https://support.microsoft.com/kb/179442).

    -   Используйте DnsAvoidRegisterRecords во избежание плохо выполнение или высокой задержкой контроллеров домена, такие сайты вспомогательной, из рекламы универсальных указателей. Дополнительные сведения см. в разделе [как оптимизировать расположение контроллера домена или глобального каталога, находящегося за пределами сайта клиента](https://support.microsoft.com/kb/306602).

        **Примечание**    имеется ограничение около 50, чтобы число контроллеров домена, клиент может использовать. Это должны быть наиболее оптимальной для сайта и самого высокого емкости контроллеров домена.

         

    -   Рассмотрите возможность размещения контроллеров домена из доверенных и доверяющих доменов в одном месте.

Для всех сценариев доверия учетные данные направляются в соответствии с домена, указанного в запросах проверки подлинности. Это также справедливо для запросов к LookupAccountName и LsaLookupNames (а также другие, они просто наиболее часто используются) API-интерфейсы. Если параметры домена для этих интерфейсов API передаются значения NULL, контроллер домена будет пытаться найти имя учетной записи, указанной в каждый доверенный домен, доступный.

-   Отключите проверку всех доступных отношений при указании домена значение NULL. [Как ограничить поиск изолированной имена внешних доверенных доменах, используя параметр LsaLookupRestrictIsolatedNameLevel](https://support.microsoft.com/kb/818024)

-   Отключение передачи запросов на проверку подлинности с доменом NULL для всех доступных отношений. [Процесс Lsass.exe может перестать отвечать, если у вас есть много внешних отношений доверия на контроллере домена Active Directory](https://support.microsoft.com/kb/923241/EN-US)

## <a name="see-also"></a>См. также
- [Настройка серверов Active Directory производительности](index.md)
- [Вопросы оборудования](hardware-considerations.md)
- [Рекомендации по LDAP](ldap-considerations.md)
- [Устранение проблем с производительностью ADDS](troubleshoot.md) 
- [Планирование емкости для доменных служб Active Directory](https://go.microsoft.com/fwlink/?LinkId=324566)