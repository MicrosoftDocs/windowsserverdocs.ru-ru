---
title: Рекомендации по LDAP в настройке производительности ADDS
description: Вопросы LDAP в Active Directory рабочих нагрузок
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: TimWi; ChrisRob; HerbertM; KenBrumf;  MLeary; ShawnRab
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 9032988c65581ea602451d224f40719b932ab7f5
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59821695"
---
# <a name="ldap-considerations-in-adds-performance-tuning"></a>Рекомендации по LDAP в настройке производительности ADDS

>[!Important]
> Ниже приведен краткий перечень ключевые советы и рекомендации для оптимизации серверного оборудования для рабочих нагрузок Active Directory, рассматриваются более подробно в [планирование мощности для доменных служб Active Directory](https://go.microsoft.com/fwlink/?LinkId=324566) статьи. Читатели, настоятельно рекомендуется просмотреть [планирование мощности для доменных служб Active Directory](https://go.microsoft.com/fwlink/?LinkId=324566) больше технические сведения и последствия этих рекомендаций.

## <a name="verify-ldap-queries"></a>Проверка запросов LDAP

Убедитесь, что запросы LDAP соответствуют рекомендациям создание эффективных запросов.

Имеется подробная документация на сайте MSDN о том, как правильно написать, структуры и анализировать запросы для использования в службе Active Directory. Дополнительные сведения см. в разделе [Creating More Efficient Microsoft Active Directory-Enabled приложений](https://msdn.microsoft.com/library/ms808539.aspx).

## <a name="optimize-ldap-page-sizes"></a>Оптимизация размеров страницы LDAP

При возврате результатов с несколькими объектами в ответ на запросы клиентов, на контроллере домена доступно для временного хранения результирующего набора в памяти. Увеличение размеров страницы вызовет дополнительные использование памяти и без необходимости возраст элементов из кэша. В этом случае параметры по умолчанию являются оптимальными. Существует несколько сценариев, которые были внесены рекомендаций для повышения параметры размера страницы. Мы рекомендуем, используя значения по умолчанию, если не особо отмеченных как недостатка.

Когда запросы содержат большое количество результатов, могут возникнуть ограничение на число аналогичные запросы, выполняемые параллельно.  Это происходит, так как сервер LDAP может поглотить всю область глобальной памяти, известный как пул файлов cookie.  Может потребоваться увеличить размер пула, как описано в [как LDAP сервера файлы cookie обрабатываются](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/manage/how-ldap-server-cookies-are-handled).

Чтобы настроить эти параметры, см. в разделе [контроллера Windows Server 2008 и более новых домена возвращает только 5000 значения в ответе LDAP](https://support.microsoft.com/kb/2009267).

## <a name="determine-whether-to-add-indices"></a>Определить, следует ли добавлять индексы

Индексирование атрибутов полезно в том случае, при поиске объектов, которые содержат имя атрибута в фильтре. Индексирование можно уменьшить число объектов, которые должны быть посещены при оценке фильтра. Тем не менее это снижает производительность операций записи, так как индекс должен обновляться при изменении или добавлении соответствующего атрибута. Он также увеличивает размер базы данных каталога, на то, что часто получаемые преимущества перевешивают затраты на хранилище. Ведение журнала можно использовать для поиска дорогостоящие и неэффективные запросы. После определения рекомендуется индексировать некоторые атрибуты, которые используются в соответствующих запросах для повышения производительности поиска. Дополнительные сведения о работе Active Directory поисковые запросы, см. в разделе [Active Directory выполняет работу](https://technet.microsoft.com/library/cc755809.aspx).

### <a name="scenarios-that-benefit-in-adding-indices"></a>Сценарии, которые получают преимущества в добавление индексов

-   Загрузки клиента в запросе данных создает степенью использования ЦП и поведение запроса клиента невозможно изменить или оптимизировать. По существенную нагрузку рассмотрите возможность его бюллетень себя в списке виновника 10 самых популярных в Server Performance Advisor или встроенные Active Directory сборщиков данных и использует более чем на 1% загрузки ЦП.

-   Создает значительного дискового ввода-вывода на сервере из-за атрибута неиндексированную загрузки клиента и поведение запроса клиента невозможно изменить или оптимизировать.

-   Запрос занимает много времени, а не завершается в разумное время клиенту из-за отсутствия охватывающих индексов.

-   Большие объемы запросов с высокой длительностью вызывают потребления и исчерпание потоков ATQ LDAP. Следующие счетчики производительности:

    -   **NTDS\\задержка запроса** – это может быть как долго выполняет запрос к процессу. Active Directory время ожидания запросов через 120 секунд (по умолчанию), однако большинство должен выполняться быстрее, и очень долго выполняющиеся запросы должны получить скрыты в общего числа. Проверяйте наличие изменений в этот базовый план, а не абсолютные пороговые значения.

        **Примечание**    высокие значения здесь также может быть индикаторы задержек в «прокси? запросы к другим доменам и проверки списка отзыва Сертификатов.


    -   **NTDS\\оценка задержка очереди** – это в идеале должно быть близко к 0, для обеспечения оптимальной производительности, это означает, что запросы тратят время не ожидают обработки.

Эти сценарии могут быть обнаружены, используя один или несколько из следующих подходов:

-   [Определение истечения времени запроса с помощью элемента управления статистики](https://msdn.microsoft.com/library/ms808539.aspx)

-   [Отслеживание дорогостоящие и неэффективные поисковые запросы](https://msdn.microsoft.com/library/ms808539.aspx)

-   Active Directory диагностики группы сборщиков данных в системном мониторе ([видит сын твоего SPA: Задает сборщик данных AD в Win2008, так и за ее пределами](http://blogs.technet.com/b/askds/archive/2010/06/08/son-of-spa-ad-data-collector-sets-in-win2008-and-beyond.aspx))

-   [Microsoft Server Performance Advisor](../../../server-performance-advisor/microsoft-server-performance-advisor.md) пакет Advisor Active Directory

-   Выполняет поиск с помощью любого фильтра, кроме "(objectClass =\*)? использующие индекс предков.

### <a name="other-index-considerations"></a>Дополнительные рекомендации индекса

-   Убедитесь, что создание индекса является подходящим решением проблемы, после настройки запроса была использована как параметр. Очень важно правильно изменения размера оборудования. Индексы должны быть добавлены только в том случае, если правой исправление заключается в Индексировать атрибут, а не при попытке применить запутывание проблем с оборудованием.

-   Индексы увеличить размер базы данных на менее общий размер атрибута будут индексироваться. Таким образом оценки роста базы данных можно вычислить Средний размер данных в атрибуте и умножая на количество объектов, которые будут иметь заполнен атрибут. Обычно это о увеличение размера базы данных 1%. Дополнительные сведения см. в разделе [данных Store принцип](https://technet.microsoft.com/library/cc772829.aspx).

-   Если поведение поиска преимущественно выполняется на уровне подразделения организации, рекомендуется индексировать для контейнерного поиска.

-   Кортеж индексов больше, чем обычные индексы, но это гораздо труднее оценить размер. Используйте обычных индексов, которое оценивает размер как ближайшее снизу целое для роста размера, не более 20%. Дополнительные сведения см. в разделе [данных Store принцип](https://technet.microsoft.com/library/cc772829.aspx).

-   Если поведение поиска преимущественно выполняется на уровне подразделения организации, рекомендуется индексировать для контейнерного поиска.

-   Кортеж индексы необходимы для поддержки строк срединного поиска и последний искомые строки. Индексы кортежа не требуются для начального поиска строк.

    -   Начальная строка поиска — (samAccountName = MYPC\*)

    -   Medial Search String - (samAccountName=\*MYPC\*)

    -   Окончательная строка поиска — (samAccountName =\*MYPC$)

-   Создание индекса будет формировать дискового ввода-вывода во время построения индекса. Это выполняется в фоновом потоке с более низким приоритетом и входящих запросов будет иметь приоритет перед создания индекса. Если планирование емкости для среды выполнена правильно, это должен быть прозрачным. Тем не менее, интенсивными операциями записи сценариев или среду, где неизвестно нагрузку на хранилище контроллер домена может привести к снижению взаимодействия с пользователем и должно быть выполнено в нерабочее время.

-   Влияет на трафик репликации минимальна, поскольку создание индексов происходит локально.

Дополнительные сведения см. в следующих:

-   [Создание более эффективно Microsoft Active Directory-приложения](https://msdn.microsoft.com/library/ms808539.aspx)

-   [Поиск в доменных службах Active Directory](https://msdn.microsoft.com/library/aa746427.aspx)

-   [Индексированные атрибуты](https://msdn.microsoft.com/library/windows/desktop/ms677112.aspx)


## <a name="see-also"></a>См. также
- [Настройка серверов Active Directory производительности](index.md)
- [Вопросы оборудования](hardware-considerations.md)
- [Правильное размещение контроллеров домена и рекомендации по сайта](site-definition-considerations.md)
- [Устранение проблем с производительностью ADDS](troubleshoot.md) 
- [Планирование емкости для доменных служб Active Directory](https://go.microsoft.com/fwlink/?LinkId=324566)