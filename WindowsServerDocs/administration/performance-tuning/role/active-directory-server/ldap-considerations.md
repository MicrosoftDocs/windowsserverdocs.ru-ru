---
title: Рекомендации по LDAP в добавляет настройку производительности
description: Рекомендации по LDAP в Active Directory рабочих нагрузках
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: timwi; chrisrob; herbertm; kenbrumf;  mleary; shawnrab
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 86aef48575388ad76ff22fc6027c5ce2d4b6694a
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80851897"
---
# <a name="ldap-considerations-in-adds-performance-tuning"></a>Рекомендации по LDAP в добавляет настройку производительности

> [!IMPORTANT]
> Ниже приведена сводка основных рекомендаций и рекомендации по оптимизации серверного оборудования для Active Directory рабочих нагрузок, более подробно описанных в статье [планирование ресурсов для домен Active Directory служб](https://go.microsoft.com/fwlink/?LinkId=324566) . Читатели настоятельно рекомендуем ознакомиться с [планированием ресурсов для домен Active Directory служб](https://go.microsoft.com/fwlink/?LinkId=324566) , чтобы получить более подробное техническое описание и последствия этих рекомендаций.

## <a name="verify-ldap-queries"></a>Проверка запросов LDAP

Убедитесь, что запросы LDAP соответствуют рекомендациям по созданию эффективных запросов.

В MSDN есть обширная документация о том, как правильно писать, структурировать и анализировать запросы для использования с Active Directory. Дополнительные сведения см. в разделе [Создание более эффективных приложений с поддержкой Active Directory Майкрософт](https://msdn.microsoft.com/library/ms808539.aspx).

## <a name="optimize-ldap-page-sizes"></a>Оптимизация размеров страниц LDAP

При возврате результатов с несколькими объектами в ответ на запросы клиентов контроллер домена должен временно сохранить результирующий набор в памяти. Увеличение размера страниц приведет к увеличению объема используемой памяти и может привести к необязательному возрасту элементов из кэша. В этом случае параметры по умолчанию являются оптимальными. Существует несколько сценариев, в которых были сделаны рекомендации по увеличению параметров размера страницы. Рекомендуется использовать значения по умолчанию, если только они не определены как недостаточные.

Если у запросов много результатов, может быть обнаружено ограничение на количество похожих запросов, выполняемых одновременно.  Это происходит, поскольку LDAP-сервер может привести к исчерпанию глобальной области памяти, известной как пул файлов cookie.  Может потребоваться увеличить размер пула, как описано в разделе [Обработка файлов cookie сервера LDAP](https://technet.microsoft.com/windows-server-docs/identity/ad-ds/manage/how-ldap-server-cookies-are-handled).

Сведения о настройке этих параметров см. [в разделе Windows Server 2008 и более новые контроллеры домена возвращают только 5000 значений в ответе LDAP](https://support.microsoft.com/kb/2009267).

## <a name="determine-whether-to-add-indices"></a>Определение необходимости добавления индексов

Индексирование атрибутов полезно при поиске объектов, которые имеют имя атрибута в фильтре. Индексирование позволяет уменьшить количество объектов, которые должны быть просмотрены при оценке фильтра. Однако это снижает производительность операций записи, так как индекс должен обновляться при изменении или добавлении соответствующего атрибута. Также увеличивается размер базы данных каталогов, хотя преимущества часто перевешивают затраты на хранение. Ведение журнала можно использовать для поиска дорогостоящих и неэффективных запросов. После определения рассмотрите возможность индексирования некоторых атрибутов, используемых в соответствующих запросах, для повышения производительности поиска. Дополнительные сведения о работе Active Directory поиска см. в разделе [как работает поиск Active Directory](https://technet.microsoft.com/library/cc755809.aspx).

### <a name="scenarios-that-benefit-in-adding-indices"></a>Сценарии, в которых преимущество добавления индексов

-   Загрузка клиента в запросе данных приводит к значительному использованию ЦП, а поведение запросов клиентов не может быть изменено или оптимизировано. При значительной нагрузке следует учесть, что она отображается в наиболее 10 списке проблем в советнике по производительности сервера или во встроенной Active Directory наборе сборщиков данных и использует более 1% ресурсов ЦП.

-   Нагрузка клиента создает значительный дисковый ввод-вывод на сервере из-за неиндексированного атрибута, и поведение запроса клиента не может быть изменено или оптимизировано.

-   Запрос занимает много времени и не завершается допустимым временным периодом для клиента из-за отсутствия охватывающих индексов.

- Большие объемы запросов с высокой длительностью вызывают потребление и исчерпание потоков LDAP ATQ. Отслеживайте следующие счетчики производительности:

    - **Задержка запросов\\в NTDS** — это зависит от того, сколько времени занимает обработка запроса. Active Directory время ожидания запросов через 120 секунд (по умолчанию), однако большинство должно выполняться гораздо быстрее, а очень долго выполняющиеся запросы должны быть скрыты в общих числах. Ищите изменения в этом базовом плане, а не абсолютные пороговые значения.

        > [!NOTE]
        > Большие значения также могут быть показателями задержки в запросах прокси-сервера к другим доменам и проверкам списка отзыва сертификатов.

    - **Примерная задержка очереди в NTDS\\** — для оптимальной производительности этот параметр лучше всего близок к 0, так как это означает, что запросы не тратят время ожидания на обслуживание.

Эти сценарии можно обнаружить с помощью одного или нескольких из следующих подходов:

-   [Определение времени запроса с помощью элемента управления Statistics](https://msdn.microsoft.com/library/ms808539.aspx)

-   [Отслеживание дорогостоящих и неэффективных поисков](https://msdn.microsoft.com/library/ms808539.aspx)

-   Группа сборщиков данных диагностики Active Directory в мониторе производительности (от-за[Spa: Наборы сборщиков данных AD в Win2008 и более поздних версиях](https://blogs.technet.com/b/askds/archive/2010/06/08/son-of-spa-ad-data-collector-sets-in-win2008-and-beyond.aspx))

-   [Советник по производительности Microsoft Server](../../../server-performance-advisor/microsoft-server-performance-advisor.md) Пакет Advisor Active Directory

-   Выполняет поиск с помощью любого фильтра помимо "(objectClass =\*)", который использует индекс предков.

### <a name="other-index-considerations"></a>Другие вопросы по индексам

-   Убедитесь, что создание индекса является верным решением проблемы после того, как Настройка запроса была исчерпана. Правильное изменение размеров оборудования очень важно. Индексы следует добавлять только в том случае, если правильное исправление предназначено для индексации атрибута и не является попыткой запутывания проблем оборудования.

-   Индексы увеличивают размер базы данных, используя как минимум общий размер индексируемого атрибута. Таким образом, оценка роста базы данных может быть оценена путем получения среднего размера данных в атрибуте и умножения на количество объектов, для которых атрибут заполняется. Обычно размер базы данных увеличивается на 1%. Дополнительные сведения см. [в статье как работает хранилище данных](https://technet.microsoft.com/library/cc772829.aspx).

-   Если поведение поиска выполняется преимущественно на уровне подразделения Организации, рассмотрите возможность индексирования для контейнерных поисков.

-   Индексы кортежей больше, чем обычные индексы, но гораздо труднее оценить размер. Используйте обычные оценки размера индексов в качестве основания для роста, максимум 20%. Дополнительные сведения см. [в статье как работает хранилище данных](https://technet.microsoft.com/library/cc772829.aspx).

-   Если поведение поиска выполняется преимущественно на уровне подразделения Организации, рассмотрите возможность индексирования для контейнерных поисков.

-   Индексы кортежей необходимы для поддержки строк поиска срединного и конечных строк поиска. Индексы кортежей не требуются для начальных строк поиска.

    -   Начальная строка поиска — (samAccountName = МИПК\*)

    -   Строка поиска срединного-(samAccountName =\*МИПК\*)

    -   Окончательная строка поиска — (samAccountName =\*МИПК $)

-   Создание индекса приведет к формированию дискового ввода-вывода во время сборки индекса. Это делается в фоновом потоке с более низким приоритетом, и входящие запросы будут расставляться по приоритету при построении индекса. Если планирование емкости для среды выполнено правильно, оно должно быть прозрачным. Однако сценарии с большим количеством операций записи или среда, в которой нагрузка на хранилище контроллера домена неизвестна, может привести к снижению производительности клиента и должна выполняться в нерабочее время.

-   Влияние на трафик репликации минимально, так как создание индексов происходит локально.

Дополнительные сведения см. в следующих статьях:

-   [Создание более эффективных приложений с поддержкой Active Directory Майкрософт](https://msdn.microsoft.com/library/ms808539.aspx)

-   [Поиск в домен Active Directory Services](https://msdn.microsoft.com/library/aa746427.aspx)

-   [Индексированные атрибуты](https://msdn.microsoft.com/library/windows/desktop/ms677112.aspx)

## <a name="see-also"></a>См. также:

- [Настройка производительности Active Directory серверов](index.md)
- [Рекомендации по оборудованию](hardware-considerations.md)
- [Правильное размещение контроллеров домена и рекомендации по сайту](site-definition-considerations.md)
- [Устранение проблем с производительностью доменных служб Active Directory](troubleshoot.md) 
- [Планирование ресурсов для доменных служб Active Directory](https://go.microsoft.com/fwlink/?LinkId=324566)