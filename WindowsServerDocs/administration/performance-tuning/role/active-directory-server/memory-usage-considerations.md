---
title: Замечания по использованию памяти в настройке производительности AD DS
description: Использование памяти процессом Lsass.exe на контроллерах домена, работающих под управлением Windows Server 2012 R2, 2016 и 2019 г.
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: v-tea; lindakup
author: Teresa-Motiv
ms.date: 7/3/2019
ms.openlocfilehash: dd33124d7d480f3670fa2781f567eaaa28abbce6
ms.sourcegitcommit: be243a92f09048ca80f85d71555ea6ee3751d712
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/11/2019
ms.locfileid: "67799786"
---
# <a name="memory-usage-considerations-for-ad-ds-performance-tuning"></a>Замечания по использованию памяти для настройки производительности AD DS

В этой статье описываются некоторые основные сведения о безопасности службы подсистемы локального администратора (LSASS, также известный как процесс Lsass.exe), советы и рекомендации по конфигурации LSASS и оценке использования памяти. В этой статье можно использовать в качестве руководства при анализе LSASS производительности и использования памяти на контроллерах домена (DC). Сведения в этой статье может быть полезно, если у вас есть вопросы о том, как настроить серверов и контроллеров домена для оптимизации этого механизма.  

LSASS несет ответственность за управление локальной безопасности проверки подлинности домена authority (LSA) и управления Active Directory. Служба LSASS выполняет проверку подлинности для клиента и сервера, и управляет механизмом Active Directory. LSASS отвечает за следующие компоненты:  

- Локальная система безопасности
- Служба NetLogon
- Служба диспетчера Учетных записей безопасности
- Служба сервера LSA
- Secure Sockets Layer (SSL)
- Протокол проверки подлинности Kerberos v5
- Протокол проверки подлинности NTLM
- Другие пакеты проверки подлинности, которые загружаются в LSA

Службы базы данных Active Directory (NTDSAI.dll) работать с расширенный обработчик хранилищ (ESE, ESENT.dll).

Вот графическую диаграмму использования памяти LSASS на Контроллере домена:

![Схема компонентов, которые используют память службы LSASS](media/domain-controller-lsass-memory-usage.png)  

Объем памяти, который использует LSASS на Контроллере домена увеличивается в соответствии с использования Active Directory. При запросе данных, он кэшируется в памяти. Таким образом это нормально, чтобы увидеть LSASS, с помощью объем памяти, который больше, чем размер файла базы данных Active Directory (NTDS.dit).

Как показано на схеме, использование памяти LSASS можно разделить на несколько частей, включая буферный кэш базы данных ESE, хранилище версий подсистемы ESE и пр. В оставшейся части этой статьи предоставляет сведения о каждой из этих частей.

## <a name="ese-database-buffer-cache"></a>Буферный кэш базы данных ESE  
Максимальный уровень использования памяти переменной LSASS является буферного кэша базы данных ESE. Объем кэш-памяти находится в диапазоне от 1 МБ по размеру всей базы данных. Так как размер кэша повышает производительность, ядро базы данных Active Directory (ESENT) пытается сохранить как можно большего размера кэша. Хотя объем кэш-памяти зависит от нехватки памяти на компьютере, максимальный размер буферного кэша базы данных ESE является *только* ограничена из-за физической памяти, установленной на компьютере. До тех пор, пока имеется нет других достаточный объем памяти, кэша может увеличиваться до размера файла базы данных Active Directory NTDS.dit. Чем больше базы данных, которые могут быть кэшированы, тем лучше производительность контроллера домена будет.  
  
> [!NOTE]
> Из-за того, что базы данных, кэширование будет работать алгоритм, в 64-разрядной системе, на котором размер базы данных меньше, чем доступной оперативной памяти, кэша базы данных может превысить размер базы данных на 30-40 процентов.

## <a name="ese-version-store"></a>Хранилище версий подсистемы ESE

Нет переменных память, хранилище версий подсистемы ESE (красного компонента на схеме выше). Объем используемой памяти зависит от наличия Windows Server 2019 или более ранних версиях Windows.

- В версиях Windows Server, predating Windows Server 2019 по умолчанию, которые LSASS может использовать до примерно 400 МБ памяти (в зависимости от количества процессоров) на 64-разрядном компьютере версию подсистемы ESE хранения. Дополнительные сведения об использовании в хранилище версий см. в разделе ниже блоге ASKDS блога от Райана Сброс параметров Internet Explorer: [Вызывается Store версии, и они все за пределы сегментов](https://techcommunity.microsoft.com/t5/Ask-the-Directory-Services-Team/The-Version-Store-Called-and-They-8217-re-All-Out-of-Buckets/ba-p/400415).

- В Windows Server 2019 года это упрощенный вариант и при первом запуске службы NTDS, размер хранилища ESE версии теперь вычисляется как 10% физической памяти ОЗУ менее 400 МБ и более 4 ГБ. Полезные сведения об этом и устранение неполадок хранилища версии см. в разделе другого блога, отличный от Райана Сброс параметров Internet Explorer: [Подробный обзор: Active Directory ESE версии Store изменений в сервер 2019](https://techcommunity.microsoft.com/t5/Ask-the-Directory-Services-Team/Deep-Dive-Active-Directory-ESE-Version-Store-Changes-in-Server/ba-p/400510).

## <a name="other-memory-use"></a>Другое использование памяти

Наконец имеется код, стеки, кучи и различных структур данных фиксированного размера (например, кэш схемы). Объем памяти, который использует LSASS зависит от нагрузки на компьютере. По мере увеличения количества выполняемых потоков, растет количество стеков в памяти. В среднем LSASS использует 100 МБ до 300 МБ памяти для этих основных компонентов. При установке больший объем оперативной памяти LSASS можно использовать больше оперативной памяти и меньше виртуальной памяти.

**Ограничить или свести к минимуму количество программ на контроллере домена или добавить дополнительный объем ОЗУ, если это уместно**

Для достижения оптимальной производительности LSASS занимает количество памяти как можно с данного контроллера домена. LSASS освобождает ПАМЯТЬ, как задавать их другими процессами. Идея состоит в том, чтобы оптимизировать производительность LSASS при по-прежнему учета для других процессов, которые могут выполняться на компьютере. Список программ следует остерегаться включает в себя агентов мониторинга. Некоторые клиенты имеют отдельные агенты для различных функций сервера, которые могут потреблять значительные ресурсы памяти. Некоторые могут выдавать много запросов WMI, для которых у нас есть некоторые сведения ниже.

По этой причине и повысить производительность рекомендуется ограничить или свести к минимуму количество программ на Контроллере домена. Если отсутствуют запросы памяти, LSASS использует эту память для кэширования в базу данных Active Directory и таким образом добиться оптимальной производительности.

Если вы заметили, что у DC есть проблемы с производительностью, также должно следить за процессов с помощью значительный объем использования. Они могут применять проблема, которую необходимо устранить неполадки. Они могут включать компоненты Майкрософт. Убедитесь, что вам всегда оставаться в курсе последних обновлений для обслуживания&mdash;Майкрософт включает решения для слишком интенсивное использование памяти в процессе исправления, которые могут также помочь производительность контроллера домена.

Существуют встроенные средства операционной системы, которые могут потреблять значительные ОЗУ в зависимости от использования профиля:

- **Файловый сервер**. Контроллеры доменов, также используют файловые серверы для SYSVOL и Netlogon общих папок, обслуживание групповой политики и скрипты для политики и сценариев запуска или входа.
  Тем не менее мы видим клиентам использовать контроллеры домена для обслуживания другого содержимого файла. Файловый сервер SMB будет затем смогут использовать ОЗУ для отслеживания активных клиентов, но в первую очередь, содержимое файла сделает кэш файлов операционной системы обеспечить необходимый рост и конкурировать с кэш базы данных ESE ОЗУ для.  

- **Запросы WMI**. Решения для мониторинга часто делают многие запросы WMI. Возможно, требует больших затрат для выполнения отдельного запроса. Часто это объем вызовов, влечет за собой дополнительные издержки, особенно в том случае, как решения для мониторинга извлекать новые события из различных журналов событий, которыми управляет Windows.  

  В журнал событий, создающее большинство тома обычно является журнал событий безопасности. И это также в журнал событий, Администраторы безопасности необходимо собрать, особенно из контроллеров домена.  

  Служба WMI использует схему выделения динамической памяти позволяет оптимизировать запросы. Таким образом служба WMI может выделить большой объем памяти, снова приводит кэш базы данных ESE.  
