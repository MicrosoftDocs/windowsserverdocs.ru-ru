---
title: Помощник по настройке IIS 10.0
description: Настройка recommmendations для веб-серверов IIS 10.0 в Windows Server 16 производительности
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: landing-page
ms.author: DavSo; Ericam; YaShi
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 16ea5c857d99e8a69f528e81178911236341dbb8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59869855"
---
# <a name="tuning-iis-100"></a>Помощник по настройке IIS 10.0

Службы Internet Information Services (IIS) версии 10.0 входит в состав Windows ServerÂ 2016. Она использует модель процесса, аналогичны IIS 8.5 и IIS 7.0. Web драйвер режима ядра (http.sys) получает и направляет HTTP-запросы и обрабатывает запросы из своего кэша ответа. Рабочие процессы регистрации для подпространства URL-адрес и http.sys перенаправляет запрос соответствующего процесса (или набор процессов для пулов приложений).

HTTP.sys несет ответственность за управление соединениями и обработки запросов. Запрос может быть из кэша HTTP.sys или рабочий процесс, передается для дальнейшей обработки. Можно настроить несколько рабочих процессов, который обеспечивает изоляцию с меньшими затратами. Дополнительные сведения о том, как запросить works обработки, на следующем рисунке:

![Обработка запроса в iis 10.0](../../media/perftune-guide-iis-request-handling.png)

HTTP.sys включает кэша ответов. Если запрос соответствует записи в кэш ответа, HTTP.sys отправляет ответ кэша непосредственно из режима ядра. Некоторые веб-платформ приложений, таких как ASP.NET, предоставляют механизмы для включения динамического содержимого для кэширования в кэше в режиме ядра. Обработчик статических файлов в IIS 10.0 автоматически кэширует часто запрашиваемыми файлами в http.sys.

Так как веб-сервер состоит из компонентов в режиме ядра и пользовательского режима, оба компонента должна настраиваться для обеспечения оптимальной производительности. Таким образом Настройка IIS 10.0 для конкретной рабочей нагрузки включает в себя настройку следующих:

-   HTTP.sys и кэш уровня ядра

-   Рабочие процессы и пользовательского режима IIS, включая настройку пула приложений

-   Определенные параметры настройки, которые влияют на производительность

В следующих разделах рассматриваются способы настройки режима ядра и пользовательского режима аспекты IIS 10.0.

## <a name="kernel-mode-settings"></a>Параметры режима ядра

Параметры HTTP.sys, связанные с производительностью делятся на две большие категории: кэша управления и управления подключение и запрос. Все параметры реестра, хранятся в реестр следующую запись:

``` syntax
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters
```

**Примечание**   Если HTTP-служба уже запущена, необходимо перезапустить его, чтобы изменения вступили в силу.

Â 

## <a name="cache-management-settings"></a>Параметры управления кэшем

Одно из преимуществ, предоставляющий HTTP.sys — это кэш в режиме ядра. Если ответ в кэше в режиме ядра, может удовлетворять HTTP-запроса из режима ядра, что значительно понижает стоимость ЦП обработки запроса. Тем не менее кэш в режиме ядра IIS 10.0 основан на физической памяти, и затраты на запись — это память, он занимает.

Запись в кэше полезно только в том случае, когда он используется. Тем не менее операция всегда получают физической памяти, независимо от того, имеется ли операция, используется. Необходимо оценить полезность элемента в кэше (экономии не сможет обслуживать его из кэша) и его цена (физической памяти, занимаемой) в течение времени существования записи, с учетом доступных ресурсов (ЦП и объем физической памяти) и рабочей нагрузки требования. HTTP.sys пытается сохранить только полезный, активно используемые элементы в кэше, но для повышения производительности веб-сервера путем настройки кэша HTTP.sys для конкретных рабочих нагрузок.

Ниже приведены некоторые полезные параметры кэша в режиме ядра HTTP.sys.

-   **UriEnableCache** значение по умолчанию: 1

    Ненулевое значение позволяет в режиме ядра ответа и кэширование фрагментов. Для большинства рабочих нагрузок кэша должны быть разрешены. Рекомендуется отключить кэш, если ожидается, что ответ очень мало и кэширование фрагментов.

-   **UriMaxCacheMegabyteCount** значение по умолчанию: 0

    Ненулевое значение, указывающее максимальный объем памяти, доступный в кэш в режиме ядра. Значение по умолчанию, 0, позволяет системе автоматически регулировать объем памяти доступен в кэш.

    **Примечание** указания размера задает только максимальное и система могут не допускать увеличиваться до набора максимального размера кэша.

    Â 

-   **UriMaxUriBytes** значение по умолчанию: 262 144 байт (256 КБ)

    Максимальный размер записи в кэше в режиме ядра. Ответы или фрагменты, размер которых превышает это не кэшируются. Если у вас есть достаточный объем памяти, попробуйте увеличить предел. Если объем памяти ограничен, и большой операции переполняют out более мелкие варианты, рекомендуется уменьшить объем.

-   **UriScavengerPeriod** значение по умолчанию: 120 секунд

    Периодически проверяет команд очистки кэша HTTP.sys и записи, которые не осуществляется между проверок команд очистки удаляются. Задание периода команд очистки более высокого значения уменьшает число сканирований команд очистки. Тем не менее использование памяти кэша может возрасти, так как старых, редко записей может оставаться в кэше. Задать период слишком низким приводит к более частых проверок команд очистки, и может привести к слишком много операций очистки и кэшировать оттока.

## <a name="request-and-connection-management-settings"></a>Параметры управления запроса и соединения

В Windows Server 2016 HTTP.sys автоматически управляет соединениями. Больше не используются следующие параметры реестра:

-   **maxConnections**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\MaxConnections
    ```

-   **IdleConnectionsHighMark**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleConnectionsHighMark
    ```

-   **IdleConnectionsLowMark**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleConnectionsLowMark
    ```

-   **IdleListTrimmerPeriod**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleListTrimmerPeriod
    ```

-   **RequestBufferLookasideDepth**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\RequestBufferLookasideDepth
    ```

-   **InternalRequestLookasideDepth**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\InternalRequestLookasideDepth
    ```


## <a name="user-mode-settings"></a>Параметры пользовательского режима

Параметры в этом разделе влияет на поведение IISÂ 10.0 рабочего процесса. Большинство этих параметров можно найти в следующем XML-файл конфигурации:

% SystemRoot %\\system32\\inetsrv\\config\\applicationHost.config

Использование Appcmd.exe, консоль управления IIS 10.0, WebAdministration или командлеты PowerShell IISAdministration для их изменения. Большинство параметров автоматически обнаруживаются, и они не требуют перезапуска рабочих процессов IIS 10.0 или сервера веб-приложений. Дополнительные сведения о файле applicationHost.config, см. в разделе [введение ApplicationHost.config](http://www.iis.net/learn/get-started/planning-your-iis-architecture/introduction-to-applicationhostconfig).


## <a name="ideal-cpu-setting-for-numa-hardware"></a>Настройку ЦП для оборудования NUMA

Начиная с Windows 2016, IIS 10.0 поддерживает автоматическое назначение идеальный Процессор для его пула потоков для повышения производительности и масштабируемости на оборудовании NUMA. Эта функция включена по умолчанию и можно настроить с помощью следующего раздела реестра:

``` syntax
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\InetInfo\Parameters\ThreadPoolUseIdealCpu
```

Эта функция включена диспетчер потоков IIS делает система пытается равномерно распределить IIS потоки пула потоков для всех процессоров в зависимости от их текущих нагрузках всех узлов NUMA. Как правило рекомендуется оставить этот параметр без изменений для оборудования NUMA по умолчанию.

**Примечание**   параметр идеальный ЦП отличается от рабочего процесса настройки узла NUMA назначения (numaNodeAssignment и numaNodeAffinityMode) появился в [параметры ЦП для пула приложений](https://www.iis.net/configreference/system.applicationhost/applicationpools/add/cpu). Идеальный ЦП влияет на как IIS распределяет его потоки пула потоков, а назначение параметров узла NUMA рабочего процесса определяют, на каком узле NUMA запускает рабочий процесс.

## <a name="user-mode-cache-behavior-settings"></a>Параметры поведения кэша пользовательского режима

В этом разделе описываются параметры, которые влияют на поведение кэширования в IISÂ 10.0. Кэш пользовательского режима реализуется как модуль, который прослушивает глобальные события кэширования, которые вызываются интегрированного конвейера. Чтобы полностью отключить кэш пользовательского режима, удалите модуль FileCacheModule (cachfile.dll) из списка установленных модулей в разделе конфигурации system.webServer/globalModules в файле applicationHost.config.

**system.webServer/caching**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|Enabled|Отключает кэш пользовательского режима IIS, если значение **False**. Если попадания в кэш частота — это очень мало, вы можете отключить кэш полностью, чтобы избежать дополнительной нагрузки, сопоставленный путь кода кэша. Отключение кэша пользовательского режима не отключает кэша в режиме ядра.|True|
|enableKernelCache|Отключает кэш в режиме ядра, если значение **False**.|True|
|значение maxCacheSize|Ограничивает размер кэша пользовательского режима IIS до заданного размера в мегабайтах. IIS настройка по умолчанию, в зависимости от доступной памяти. Выберите значение тщательно на основе объема набор часто используемых файлов сравнению с объемом ОЗУ или адресного пространства процесса IIS.|0|
|maxResponseSize|Кэширует файлы вплоть до указанного размера. Фактическое значение зависит от того, количество и размер самые большие файлы в наборе данных и Оперативной памяти. Кэширование большие, часто запрашиваемых файлов может снизить использование ЦП, доступ к диску и связанных с ними задержек.|262144|

## <a name="compression-behavior-settings"></a>Параметры поведения сжатия

По умолчанию в IIS, начиная с 7.0 сжатие статического содержимого. Кроме того при установке DynamicCompressionModule сжатия динамического содержимого включена по умолчанию. Сжатие уменьшает использование пропускной способности, но повышает загрузку ЦП. Сжатое содержимое кэшируется в кэше в режиме ядра, если это возможно. Начиная с 8.5, IIS обеспечивает сжатие управляться независимо друг от друга для статического и динамического содержимого. Статическое содержимое обычно относится к содержимому, которые не изменяются, такие как файлы GIF или HTM. Динамическое содержимое обычно создается с помощью сценариев или код на сервере, то есть страницы ASP.NET. Вы можете настроить классификацию любого конкретного расширения как статический или динамический.

Чтобы полностью отключить сжатие, удалите StaticCompressionModule и DynamicCompressionModule из списка модулей в разделе system.webServer/globalModules в файле applicationHost.config.

**system.webServer/httpCompression**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|staticCompression EnableCpuUsage<br><br>staticCompression DisableCpuUsage<br><br>dynamicCompression EnableCpuUsage<br><br>dynamicCompression DisableCpuUsage|Включает или отключает сжатие, если текущий процент использования ЦП выходит за пределы указанных пределов.<br><br>Начиная с IIS 7.0, сжатие автоматически отключается при увеличении ЦП постоянным превышают пороговое значение отключения. Сжатие включено в том случае, если ЦП не превышает пороговое значение enable.|50, 100, 50 и 90 соответственно|
|Каталог|Указывает каталог, в котором сжатые версии статических файлов временно сохраняются и кэшируются. Рекомендуется переместить этот каталог отключить на системном диске, если осуществляется часто.|%SystemDrive%\inetpub\temp\IIS temporary Compressed Files|
|doDiskSpaceLimiting|Указывает, существует ограничение ли объем места на диске все сжатые файлы могут занимать. Сжатые файлы хранятся в каталоге сжатия, который задается параметром **directory** атрибута.|True|
|maxDiskSpaceUsage|Указывает число байтов пространства на диске, который может занимать сжатых файлов в каталоге сжатия.<br><br>Этот параметр может потребоваться увеличить, если общий размер всех сжатое содержимое слишком велико.|100 МБ|

**system.webServer/urlCompression**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|doStaticCompression|Указывает, используется ли сжатие статического содержимого.|True|
|doDynamicCompression|Указывает, используется ли сжатие динамического содержимого.|True|

**Примечание** для серверов под управлением IIS 10.0 с низкой средняя загрузка ЦП, рассмотрите возможность включения сжатия динамического содержимого, особенно в том случае, если ответы велики. Это должен сделать сначала в тестовой среде, чтобы оценить эффект от использования ЦП от базового плана.


### <a name="tuning-the-default-document-list"></a>Настройка списка документов по умолчанию

Модуль документа по умолчанию обрабатывает HTTP-запросы для корневого каталога и переводит их в запросы для определенного файла, например Default.htm или Index.htm. В среднем aroundÂ 25 процентов всех запросов в Интернете проходят через путь к документу по умолчанию. Это существенно изменяется для отдельных сайтов. Если HTTP-запроса не указал имя файла, модуль документа по умолчанию выполняет поиск в списке документов разрешено по умолчанию для каждого имени в файловой системе. Это может отрицательно сказаться на производительности, особенно в том случае, если достижения содержимое, необходимо сделать сети round trip или touching диска.

Можно избежать, выборочно отключив документов по умолчанию и за счет сокращения или упорядочения списка документов. Для веб-сайты, использовать документ по умолчанию следует уменьшить списка только типах документов по умолчанию, которые используются. Кроме того порядка в списке, чтобы он начинается с наиболее часто используемые по умолчанию имени файла.

Выборочно документа по умолчанию можно задать на определенный URL-адреса, путем настройки конфигурации внутри себя тег расположения, в файле applicationHost.config, или путем добавления файла web.config непосредственно в каталоге содержимого. Это позволяет гибридный подход, позволяющий документов по умолчанию, только когда они являются необходимости и задает имя списка, чтобы правильный файл для каждого URL-адреса.

Чтобы полностью отключить документов по умолчанию, удалите DefaultDocumentModule из списка модулей в разделе system.webServer/globalModules в файле applicationHost.config.

**system.webServer/defaultDocument**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|enabled|Указывает, что документы по умолчанию включены.|True|
|&lt;файлы&gt; элемент|Задает имена файлов, которые настроены как документы по умолчанию.|Список по умолчанию является Default.htm, Default.asp, Index.htm, Index.html, Iisstart.htm и Default.aspx.|

## <a name="central-binary-logging"></a>Центральная Ведение двоичного журнала

Если сеанс сервера имеет множество групп URL-адрес под ним, процесс создания сотен форматированные файлы журналов для отдельных групп URL-адрес и запись данных журнала на диске достаточно быстро исчерпать ценные ресурсы ЦП и памяти, тем самым создавая производительности и проблемы масштабируемости. Централизованное ведение двоичного журнала позволяет свести к минимуму объем системных ресурсов, которые используются для ведения журнала, в то же время, предоставляя подробные данные журнала для организаций, которым это необходимо. Анализ журналов двоичный требуются постобработки средства отладки.

Вы можете включить централизованную двоичных путем установки атрибута centralLogFileMode CentralBinary и присвоения **включена** атрибут **True**. Рекомендуется переместить расположение центра файла журнала на диск журнала выделенную во избежание конфликтов между system и ведение журнала действий и системного раздела.

**system.applicationHost/log**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|centralLogFileMode|Задает режим ведения журнала для сервера. Измените это значение на CentralBinary ведение журнала центра двоичный.|Сайт|

**system.applicationHost/log/centralBinaryLogFile**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|enabled|Указывает, включено ли ведение журнала с центральной двоичный.|False|
|Каталог|Указывает каталог, где регистрируются записи журнала.|%SystemDrive%\inetpub\logs\LogFiles|


## <a name="application-and-site-tunings"></a>Приложения и узла tunings

Следующие параметры связаны с tunings пула и узла приложения.

**system.applicationHost/applicationPools/applicationPoolDefaults**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|queueLength|Указывает на HTTP.sys, сколько запросы ставятся в очередь для пула приложений, прежде чем будущие запросы отклоняются. При превышении значения этого свойства, службы IIS отклоняют последующие запросы сообщением об ошибке 503.<br><br>Рекомендуется увеличить это для приложений, взаимодействующих с хранилищами данных серверной части высокой задержкой, если наблюдаются ошибки 503.|1000|
|enable32BitAppOnWin64|Если значение равно True, включает 32-разрядное приложение для запуска на компьютере с 64-разрядный процессор.<br><br>Рассмотрите возможность включения 32-разрядном режиме, если потребление памяти является проблемой. Так как размеры указателей и размеры инструкции имеют небольшой размер, 32-разрядные приложения использовать меньше памяти, чем 64-разрядных приложений. Недостатком под управлением 32-разрядных приложений на 64-разрядном компьютере является ограничен 4 ГБ адресного пространства пользовательского режима.|False|

**system.applicationHost/sites/VirtualDirectoryDefault**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|allowSubDirConfig|Определяет, выполняет поиск файлов web.config в содержимого каталогах ниже, чем текущий уровень (True) или не выполняет поиск файлов web.config в содержимого каталогах ниже, чем текущий уровень (False) IIS. За счет применения простых ограничение, которое позволяет настраивать только в виртуальных каталогах, IISÂ 10.0 может знать, что, если не  **/ &lt;имя&gt;.htm** является виртуальным каталогом, не следует искать файл конфигурации. Пропуск операции дополнительный файл может значительно повысить производительность веб-сайты, имеют очень большой набор произвольным доступом статического содержимого.|True|

## <a name="managing-iis-100-modules"></a>Управлении модулями IIS 10.0

IIS 10.0, были перенесены на несколько, предусматривающая пользователя модули для поддержки модульная структура. Это разложение имеет небольших затратах. Для каждого модуля интегрированного конвейера необходимо вызвать модуль для каждого события, относящиеся к модулю. Это происходит независимо от того, ли модуль должен выполнять работы. Чем больше циклов ЦП и памяти путем удаления всех модулей, которые не являются значимыми для определенного веб-сайта.

Веб-сервера, настроенную для простой статических файлов может содержать только следующие пять модулей: UriCacheModule, HttpCacheModule, StaticFileModule, AnonymousAuthenticationModule и HttpLoggingModule.

Чтобы удалить модули из файла applicationHost.config, удалите все ссылки на модуль из раздела system.webServer/handlers и system.webServer/modules помимо удаления объявления модуля в system.webServer/globalModules.

## <a name="classic-asp-settings"></a>Параметры классической ASP

Включает в себя основные затраты на обработку запроса классического ASP инициализацию обработчика сценариев, компиляция запрошенного скрипта ASP в шаблон ASP и выполнения шаблона на обработчик скриптов. Хотя затраты на выполнение шаблона зависит от сложности запрошенного скрипта ASP, классической ASP модуля IIS можно кэшировать обработчиков сценариев в памяти и кэша шаблонов в памяти и диска (только при переполнении кэша в памяти шаблон) для повышения производительности в Сценарии ЦП.

Следующие параметры используются для настройки кэша шаблонов классического ASP и кэше обработчика сценариев, и они не влияют на параметры ASP.NET.

**system.webServer/asp/cache**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|diskTemplateCacheDirectory|Имя каталога, в котором ASP для хранения скомпилированных шаблонов, при переполнении кэша в памяти.<br><br>Рекомендация. Набор для каталога, который не является в значительной степени использовать, например, на диск, который не используется совместно с операционной системой, журналов IIS или других часто используемого содержимого.|%SystemDrive%\inetpub\temp\ASP скомпилированных шаблонов|
|maxDiskTemplateCacheFiles|Указывает максимальное количество скомпилированных шаблонов ASP, которые могут быть кэшированы на диске.<br><br>Рекомендация. Присвоено максимальное значение 0x7FFFFFFF.|2000|
|scriptFileCacheSize|Этот атрибут указывает максимальное количество скомпилированных шаблонов ASP, которые могут быть кэшированы в памяти.<br><br>Рекомендация. Значение по крайней мере столько как количество часто запрашиваемого скриптов ASP, обслуживаемых пул приложений. Если это возможно значение столько шаблонов ASP, как разрешить ограничения по памяти.|500|
|scriptEngineCacheMax|Указывает максимальное число обработчиков сценариев, кэшируемых в памяти.<br><br>Рекомендация. Значение по крайней мере столько как количество часто запрашиваемого скриптов ASP, обслуживаемых пул приложений. Если это возможно значение столько обработчиков сценариев позволяет ограничение объема памяти.|250|

**system.webServer/asp/limits**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|processorThreadMax|Указывает максимальное число рабочих потоков на процессор, которое может создать ASP. Увеличьте, если текущее значение параметра недостаточно для обработки нагрузки, что может привести к ошибкам, когда она обслуживает запросы или недостаточного использования ресурсов ЦП.|25|

**system.webServer/asp/comPlus**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|executeInMta|Значение **True** Если ошибкам или проблемам обнаружена во время IIS обслуживает ASP содержимого. Это может произойти, например, при размещении нескольких изолированных узлов, в которых каждый узел выполняется под свой собственный рабочий процесс. Ошибки обычно выводятся из COM + в средстве просмотра событий. Этот параметр позволяет модели многопотокового подразделения в ASP.|False|


## <a name="aspnet-concurrency-setting"></a>Параметр параллелизма ASP.NET

### <a name="aspnet-35"></a>ASP.NET 3.5
По умолчанию устанавливаемая ASP.NET верхняя граница запрос параллелизма для снижения потребления памяти устойчивого состояния на сервере. Приложения с высокой степенью параллелизма может понадобиться изменить некоторые параметры, чтобы повысить общую производительность. Можно изменить этот параметр в файле aspnet.config:

``` syntax
<system.web>
  <applicationPool maxConcurrentRequestsPerCPU="5000"/>
</system.web>
```

Следующий параметр полезен для полноценного использования ресурсов в системе:

-   **maxConcurrentRequestPerCpu** значение по умолчанию: 5000

    Этот параметр ограничивает максимальное число одновременно выполняющихся запросов ASP.NET в системе. Значение по умолчанию является консервативным, снизив потребление памяти для приложений ASP.NET. Попробуйте увеличить этот предел в системах, работающих приложений, которые выполняют long, синхронных операций ввода-вывода. В противном случае пользователи могут наблюдается большая задержка из-за сбоев очереди или запрос из-за превышения ограничения очереди в условиях высокой нагрузки, когда используется параметр по умолчанию.

### <a name="aspnet-46"></a>ASP.NET 4.6
Помимо параметра maxConcurrentRequestPerCpu ASP.NET 4.7 также включает параметры для повышения производительности в приложениях, которые сильно зависят от асинхронной операции. Этот параметр можно изменить в файле aspnet.config.

``` syntax
<system.web>
  <applicationPool percentCpuLimit="90" percentCpuLimitMinActiveRequestPerCpu="100"/>
</system.web>
```

-   **percentCpuLimit** значение по умолчанию: 90 асинхронный запрос имеет некоторые проблемы масштабируемости при большой нагрузки (за пределы возможностей оборудования) помещается в таком сценарии. Проблема заключается в том, из-за природы выделение на асинхронные сценарии. В этих условиях выделение будет происходить при запуске асинхронной операции, и она будет использоваться после ее завершения. В то время своей s очень возможно, что объекты были перемещены в поколение 1 или 2 сборщиком Мусора. В этом случае повышается нагрузка будет показывать увеличение на запросов в секунду (rps) до точки. После того как мы передаем этой точки, время, затраченное на сборку Мусора начнет стать проблемой и запросов в секунду начнут выделенного IP-адреса, отсутствие отрицательного влияния масштабирования. Чтобы устранить эту проблему, при превышении параметр percentCpuLimit, запросы будут отправляться в очередь собственного ASP.NET.
-   **percentCpuLimitMinActiveRequestPerCpu** значение по умолчанию: 100 регулировка ЦП (percentCpuLimit параметр), не основан на число запросов, но на сколько они являются. Таким образом может быть несколько запросов интенсивно использующие ЦП, замедляющие резервное копирование в собственном очереди без возможности очищена помимо входящих запросов. Для решения этой problme, percentCpuLimitMinActiveRequestPerCpu можно использовать, чтобы убедиться, что минимальное число запросы обслуживаются перед регулированием вступает в работу.

## <a name="worker-process-and-recycling-options"></a>Рабочий процесс и повторное использование параметров

Можно настроить параметры перезапуска рабочих процессов IIS и предоставляют готовые решения острой ситуациях или событий без необходимости вмешательства или сброс настроек службы или компьютера. Такие ситуации и события включают утечек памяти, увеличение нагрузки на память или не отвечает или бездействующих рабочих процессов. В нормальных условиях повторное использование параметров могут оказаться ненужными и перезапуск можно отключить или системы можно настроить повторное использование очень редко.

Вы можете включить повторное использование процесса для конкретного приложения, добавив атрибуты, которые **перезапуск periodicRestart** элемент. Повторный запуск событие может инициироваться несколько событий, включая использование памяти, фиксированное число запросов и фиксированный период. При перезапуске рабочего процесса запросы в очереди и выполняться постепенно завершается, а новый процесс запускается одновременно для обслуживания новых запросов. **Перезапуск periodicRestart** каждого приложения, что означает, что каждый атрибут в следующей таблице разбит на основе каждого приложения.

**system.applicationHost/applicationPools/ApplicationPoolDefaults/recycling/periodicRestart**

|Атрибут|Описание|Значение по умолчанию|
|--- |--- |--- |
|memory.|Разрешить перезапуск процессов, если потребление виртуальной памяти превышает заданный предел в килобайтах. Это значение полезно для 32-разрядных компьютерах, которые имеют малое, 2 ГБ адресного пространства. Это может помочь избежать неудачных запросов из-за ошибок памяти.|0|
|privateMemory|Включения перезапуска процесса, если распределение выделенной памяти превышает заданное ограничение в килобайтах.|0|
|requests|Включите повторное использование процесса после определенного числа запросов.|0|
|time|Включите повторное использование процесса после указанного периода времени.|29:00:00|


## <a name="dynamic-worker-process-page-out-tuning"></a>Динамическую настройку выгрузка страницы рабочих процессов

Начиная с Windows Server 2012 R2, IIS предоставляет возможность настройки рабочего процесса для приостановки после их простоя некоторое время (в дополнение к параметра для метода terminate, который существовал с IIS 7).

Основная цель свободных рабочих процессов-выгрузка страницы и функции завершения процесса простаивающим исполнителем заключается в необходимости экономить использование памяти на сервере, так как сайт может использовать большой объем памяти, даже если он просто находится там прослушивание. В зависимости от технологии, используемые на сайте (vs ASP.NET статические содержимого и других платформ), память, используемая можно в любом из около 10 МБ до нескольких сотен мегабайт, и это означает, что если сервер настраивается с помощью многих узлах выяснить наиболее действующих параметров для веб-узлов может значительно повысить производительность active и приостановленных сайтов.

Прежде чем углубляться в конкретные особенности, мы должны Имейте в виду, который наилучшим образом, если нет никаких ограничений памяти, то возможно только для установки сайтов для никогда не приостановки или завершения. В конце концов thereâ s мало пользы в завершение работника обрабатывает, если он является единственным на компьютере.

**Примечание**   в случае нестабильности кода, например код с утечкой памяти, работает сайт или в противном случае нестабильности, установка веб-узла для завершения в состояние бездействия может быть черновые альтернативой исправления кода ошибки. Это не то, что рекомендуется сделать Обзорное, но в исследование, может быть лучше использовать эту функцию как механизм очистки, хотя более постоянного решения идет работа.\]

Â 

Надо учесть другое обстоятельство: Если сайт должен использовать большой объем памяти, сам процесс приостановки принимает звонок, поскольку на компьютере для записи данных, используемых рабочим процессом на диск. Если рабочий процесс использует большой блок памяти, затем приостановка его может оказаться дороже, чем стоимость ждать его, чтобы начать резервное копирование.

Чтобы максимально эффективно используйте функцию приостановки рабочего процесса, необходимо в узлов каждый пул приложений, а также решить, которой может быть приостановлена, которого должна быть завершена, и какие active неограниченное время. Для каждого действия и каждого сайта необходимо понять, интервал времени ожидания идеально.

В идеале узлы, которые вы настроите для приостановки или завершения будут тех, которые имеют посетителей каждый день, но не достаточно, чтобы гарантировать поддержание active постоянно. Как правило, они узлов с около 20 уникальных посетителей в день или меньше. Можно анализировать шаблоны трафика, с помощью файлов журнала веб-узла и вычислить средний дневной объем трафика.

Имейте в виду, что когда пользователь подключается к сайту, обычно остается на нем по крайней мере через некоторое время следующим запросом и поэтому просто подсчет запросов ежедневно может неточно отображать шаблоны реального трафика. Чтобы получить более точные чтения, также можно использовать средство, например Microsoft Excel, для которого требуется вычислить среднее время между запросами. Пример:

||URL-адрес запроса|Время запроса|дельта|
|--- |--- |--- |--- |
|1|/SourceSilverLight/Geosource.web/grosource.html|10:01||
|2|/SourceSilverLight/Geosource.web/sliverlight.js|10:10|0:09|
|3|/SourceSilverLight/Geosource.web/clientbin/geo/1.aspx|10:11|0:01|
|4|/lClientAccessPolicy.xml|10:12|0:01|
|5|/ SourceSilverLight/GeosourcewebService/Service.asmx|10:23|0:11|
|6|/ SourceSilverLight/Geosource.web/GeoSearchServer...¦.|11:50|1:27|
|7|/REST/Services/CachedServices/Silverlight_load_la...¦|12:50|1:00|
|8|/REST/Services/CachedServices/Silverlight_basemap...¦.|12:51|0:01|
|9|/ rest/Services/DynamicService/Silverlight_basemap.......|12:59|0:08|
|10|/rest/Services/CachedServices/Ortho_2004_cache.as...|13:40|0:41|
|11|/rest/Services/CachedServices/Ortho_2005_cache.js|13:40|0:00|
|12|/rest/Services/CachedServices/OrthoBaseEngine.aspx|13:41|0:01|

Сложная часть, делом необходимо выяснить, какой параметр для применения к смысла. В нашем случае сайт получает ряд запросов от пользователей и приведенной выше таблице показано, что в сумме 4 уникальные сеансы произошла в течение 4 часов. С параметрами по умолчанию для приостановки рабочего процесса пула приложений сайта, будут прерваны после времени ожидания по умолчанию 20 минут, что означает каждая из этих пользователей будет испытывать цикла регулировать сайта. В результате является идеальным для приостановки рабочего процесса, так как для большую часть времени простоя, поэтому приостановка его экономии ресурсов и позволяет пользователю подключиться к узлу практически мгновенно.

Окончательная версия очень важное примечание об этом является решающее значение для этой функции производительности диска. Поскольку приостановки и пробуждения процесса записи и чтения большого объема данных на жестком диске, настоятельно рекомендуется использовать быстром диске для этого. Твердотельные накопители (SSD) являются идеальным и настоятельно рекомендуется для этого и следует убедиться в том, что на нем хранится файл подкачки Windows (если самой операционной системы не установлен на SSD-ДИСКАХ, настройки операционной системы, чтобы переместить в нее файл подкачки).

Использование SSD или нет, мы также рекомендуем исправления размер файла подкачки производить запись в нее данных выгрузка страницы без изменения размера файла. Изменение размера файла подкачки может произойти, когда операционная система должна хранить данные в файл подкачки, так как по умолчанию настроен Windows для автоматически подстраивает свой размер, на основе. Установив один фиксированный размер, можно запретить изменение размеров и намного повысить производительность.

Чтобы настроить предварительно фиксированного размера, необходимо вычислить идеальный размер, который зависит от того, сколько сайтов будет Приостановка и какой объем памяти, они потребляют. Если среднее значение составляет 200 МБ для активных рабочих процесса и у вас есть 500 сайтов на серверах, которые будут приостановки, то файл подкачки должен быть по крайней мере (200 \* 500) МБ за основной размер файла подкачки (поэтому базовый + 100 ГБ в нашем примере).

**Примечание** при сайты будут приостановлены, они будут учтены приблизительно 6 МБ каждый, поэтому в нашем случае использование памяти, если все узлы будут приостановлены будет приблизительно 3 ГБ. Однако на самом деле вы повторно, возможно, никогда не придется использовать их всех приостановленных в то же время.

 
## <a name="transport-layer-security-tuning-parameters"></a>Безопасность на транспортном уровне параметры настройки

Использование безопасности транспортного уровня (TLS) налагает дополнительные затраты ЦП. Наиболее ресурсоемкие компонент TLS находится затраты на установление установки сеанса, так как он содержит полного подтверждения. Повторное подключение, шифрования и расшифровки также добавить к стоимости. Для повышения производительности TLS сделайте следующее:

-   Включите HTTP-соединений для сеансов TLS. Это устраняет затраты на установление сеанса.

-   Повторно использовать сеансы при необходимости, особенно с не keep-alive трафика.

-   Выборочно применять шифрование только для страниц или части сайта, необходимо, скорее всего сайта.

**Примечание**
-   Более длинные ключи предоставляют больший уровень безопасности, но она также использует больше времени центрального Процессора.

-   Все компоненты могут не должен быть зашифрован. Тем не менее совместное использование обычного HTTP и HTTPS может привести всплывающее окно предупреждение, что не все содержимое страницы является безопасным.

 
## <a name="internet-server-application-programming-interface-isapi"></a>Интерфейс MAPI сервера Интернета (ISAPI)

Специальные параметры настройки не требуются для приложения ISAPI. При написании закрытого расширения ISAPI, убедитесь, что документ предназначен для производительности и эффективного использования ресурсов.

## <a name="managed-code-tuning-guidelines"></a>Управляемый код, рекомендации по настройке

Модель интегрированного конвейера в IIS 10.0 обеспечивает высокую степень гибкости и расширяемости. Пользовательские модули, которые реализованы в машинный или управляемый код может быть вставлен в конвейер, или они могут заменять существующие модули. Несмотря на то, что эта модель расширяемости предлагает удобства и простоты следует соблюдать осторожность перед вставкой новых управляемых модулей, которые подключают в глобальные события. Добавление глобального управляемый модуль означает, что необходимо касаются всех запросов, включая запросы статических файлов управляемого кода. Пользовательские модули уязвимы для события, такие как сборка мусора. Кроме того пользовательские модули добавьте значительные стоимость ЦП из-за маршалинг данных между машинным и управляемым кодом. Если это возможно необходимо присвоить значение предварительного условия managedHandler для управляемого модуля.

Чтобы повысить производительность холодного запуска, убедитесь, что Предварительная компиляция веб-сайта или используйте инициализации приложения IIS функцию ASP.NET для прогрева приложения.

Если состояние сеанса не требуется, убедитесь, что отключить его для каждой страницы.

При наличии многих операций ввода-вывода операций, связанных с, попробуйте использовать асинхронную версию метода соответствующие интерфейсы API, что обеспечит гораздо лучшую масштабируемость.

Также использует кэш выходных данных также повышает производительность веб-сайт.

При выполнении нескольких узлов, содержащие скрипты ASP.NET в изолированном режиме (один пул приложений для каждого узла), мониторинга использования памяти. Убедитесь, что сервер имеет достаточно ОЗУ для ожидаемое количество одновременно выполняемых пулов приложений. Рассмотрите возможность использования нескольких доменов приложений вместо нескольких изолированных процессах.


## <a name="other-issues-that-affect-iis-performance"></a>Другие ошибки IIS, влияющих на производительность

Следующие проблемы могут повлиять на производительность IIS:

-   Установка фильтров, не содержащую средства выявления кэша

    Установка фильтра, которые не поддерживают HTTP-кэша приводит к IIS, чтобы полностью отключить кэширование, что приводит к снижению производительности. Фильтры ISAPI, которые были записаны до IISÂ 6.0 может вызвать это поведение.

-   Общие запросы интерфейс шлюза (CGI)

    Для повышения производительности не рекомендуется использование приложений CGI для обслуживания запросов со службами IIS. Часто Создание и удаление процессы CGI включает в себя значительную нагрузку. Лучшие альтернативы включают в себя использование FastCGI, сценарии приложений ISAPI и сценариев ASP или ASP.NET. Изоляция доступна для каждого из этих вариантов.

# <a name="see-also"></a>См. также
- [Веб-настройки производительности сервера](index.md) 
- [HTTP 1.1/2 помощник по настройке](http-performance.md)
