---
title: Настройка IIS 10,0
description: Настройка производительности рекомммендатионс для веб-серверов IIS 10,0 на Windows Server 16
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: landing-page
ms.author: DavSo; Ericam; YaShi
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 8b86bf779a4ea9d67f959dacf125a98a8e26a729
ms.sourcegitcommit: 083ff9bed4867604dfe1cb42914550da05093d25
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2020
ms.locfileid: "75947136"
---
# <a name="tuning-iis-100"></a>Настройка IIS 10,0

Службы IIS (IIS) 10,0 входит в состав Windows Server 2016. В нем используется модель процессов, аналогичная версии IIS 8,5 и IIS 7,0. Веб-драйвер режима ядра (HTTP. sys) получает и маршрутизирует HTTP-запросы, а также выполняет запросы из кэша ответов. Рабочие процессы регистрируются для подпространств URL-адресов, а HTTP. sys направляет запрос в соответствующий процесс (или набор процессов для пулов приложений).

HTTP. sys отвечает за управление подключениями и обработку запросов. Запрос может быть обслужен из кэша HTTP. sys или передан рабочему процессу для дальнейшей обработки. Можно настроить несколько рабочих процессов, что обеспечивает изоляцию по сниженным затратам. Дополнительные сведения о том, как работает обработка запросов, см. на следующем рисунке.

![Обработка запросов в IIS 10,0](../../media/perftune-guide-iis-request-handling.png)

HTTP. sys включает кэш ответов. Когда запрос соответствует записи в кэше ответов, HTTP. sys отправляет ответ кэша непосредственно из режима ядра. Некоторые платформы веб-приложений, такие как ASP.NET, предоставляют механизмы, позволяющие кэшировать любое динамическое содержимое в кэше в режиме ядра. Обработчик статических файлов в IIS 10,0 автоматически кэширует часто запрашиваемые файлы в HTTP. sys.

Поскольку веб-сервер имеет компоненты режима ядра и пользовательского режима, оба компонента должны быть настроены для оптимальной производительности. Поэтому Настройка IIS 10,0 для конкретной рабочей нагрузки включает в себя настройку следующих параметров:

-   HTTP. sys и связанный кэш режима ядра

-   Рабочие процессы и IIS в пользовательском режиме, включая конфигурацию пула приложений.

-   Некоторые параметры настройки, влияющие на производительность

В следующих разделах описывается настройка аспектов служб IIS 10,0 в режиме ядра и в пользовательском режиме.

## <a name="kernel-mode-settings"></a>Параметры режима ядра

Параметры HTTP. sys, относящиеся к производительности, делятся на две основные категории: Управление кэшем, подключение и управление запросами. Все параметры реестра хранятся в следующей записи реестра:

``` syntax
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters
```

**Примечание** .  если служба HTTP уже запущена, необходимо перезапустить ее, чтобы изменения вступили в силу.

Â 

## <a name="cache-management-settings"></a>Параметры управления кэшем

Одним из преимуществ, предоставляемых HTTP. sys, является кэш режима ядра. Если ответ находится в кэше режима ядра, запрос HTTP можно полностью удовлетворить с помощью режима ядра, что значительно снижает стоимость ЦП при обработке запроса. Однако кэш служб IIS 10,0 в режиме ядра основан на физической памяти, а стоимость записи — это объем памяти, который она занимает.

Запись в кэше полезна только при использовании. Однако запись всегда потребляет физическую память независимо от того, используется ли запись. Необходимо оценить полезность элемента в кэше (экономия от возможности его обслуживания из кэша) и затраты (занимаемая физической памятью) в течение времени существования записи, учитывая доступные ресурсы (ЦП и физическая память) и рабочую нагрузку. необходимость. HTTP. sys пытается использовать в кэше только полезные, активно доступные элементы, но можно повысить производительность веб-сервера, настроив кэш HTTP. sys для определенных рабочих нагрузок.

Ниже приведены некоторые полезные параметры для кэша режима ядра HTTP. sys.

-   **Уриенаблекаче** Значение по умолчанию: 1

    Ненулевое значение включает ответ в режиме ядра и кэширование фрагментов. Для большинства рабочих нагрузок кэш должен оставаться включенным. Рекомендуется отключить кэш, если предполагается очень низкий отклик и кэширование фрагментов.

-   **Уримакскачемегабитекаунт** Значение по умолчанию: 0

    Ненулевое значение, указывающее максимальный объем памяти, доступный кэшу режима ядра. Значение по умолчанию 0 позволяет системе автоматически настраивать объем памяти, доступной для кэша.

    **Примечание** . Задание размера устанавливает только максимальное значение, и система может не дорастить размер кэша до максимального размера.

    Â 

-   **Уримаксурибитес** Значение по умолчанию: 262144 байт (256 КБ)

    Максимальный размер записи в кэше режима ядра. Ответы или фрагменты, превышающие этот, не кэшируются. При наличии достаточного объема памяти рекомендуется увеличить это ограничение. Если память ограничена, а большие записи кровдинг меньше, может оказаться полезным уменьшить это ограничение.

-   **Урискавенжерпериод** Значение по умолчанию: 120 с

    Кэш HTTP. sys периодически сканируется средством очистки, а записи, к которым нет доступа между проверками очистки, удаляются. Установка для периода очистки большого значения сокращает число просмотров очистки. Однако использование памяти кэша может увеличиться из-за более старых, менее часто запрашиваемых записей может остаться в кэше. Установка слишком низкого периода приводит к более частому сканированию очистки и может привести к чрезмерному увеличению количества операций очистки и кэширования.

## <a name="request-and-connection-management-settings"></a>Параметры управления запросами и соединениями

В Windows Server 2016 протокол HTTP. sys управляет подключениями автоматически. Следующие параметры реестра больше не используются:

-   **MaxConnections**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\MaxConnections
    ```

-   **идлеконнектионшигхмарк**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleConnectionsHighMark
    ```

-   **идлеконнектионсловмарк**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleConnectionsLowMark
    ```

-   **идлелисттриммерпериод**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\IdleListTrimmerPeriod
    ```

-   **рекуестбуфферлукасидедепс**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\RequestBufferLookasideDepth
    ```

-   **интерналрекуестлукасидедепс**

    ``` syntax
    HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Http\Parameters\InternalRequestLookasideDepth
    ```


## <a name="user-mode-settings"></a>Параметры пользовательского режима

Параметры в этом разделе влияют на поведение рабочего процесса ИИСÂ 10,0. Большинство этих параметров можно найти в следующем XML-файле конфигурации:

% SystemRoot%\\system32\\Inetsrv\\config\\applicationHost. config

Чтобы изменить их, используйте Appcmd. exe, консоль управления IIS 10,0, командлеты Иисадминистратион PowerShell. Большинство параметров обнаруживаются автоматически и не требует перезапуска рабочих процессов IIS 10,0 или сервера веб-приложений. Дополнительные сведения о файле applicationHost. config см. в разделе [Введение в файл ApplicationHost. config](http://www.iis.net/learn/get-started/planning-your-iis-architecture/introduction-to-applicationhostconfig).


## <a name="ideal-cpu-setting-for-numa-hardware"></a>Идеальный параметр ЦП для оборудования NUMA

Начиная с Windows 2016, IIS 10,0 поддерживает автоматическое идеальное назначение ЦП для потоков пула потоков, чтобы повысить производительность и масштабируемость оборудования NUMA. Эта функция включена по умолчанию и может быть настроена с помощью следующего раздела реестра:

``` syntax
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\InetInfo\Parameters\ThreadPoolUseIdealCpu
```

Если эта функция включена, диспетчер потоков IIS предоставляет лучшие усилия для равномерного распределения потоков пула потоков IIS по всем ЦП во всех узлах NUMA на основе их текущих нагрузок. Как правило, рекомендуется не изменять этот параметр по умолчанию для оборудования NUMA.

**Обратите внимание** ,  идеальный параметр ЦП отличается от параметров назначения узлов NUMA рабочего процесса (Нуманодеассигнмент и нуманодеаффинитимоде), введенных в [параметрах ЦП для пула приложений](https://www.iis.net/configreference/system.applicationhost/applicationpools/add/cpu). Идеальный параметр ЦП влияет на то, как IIS распространяет потоки пула потоков, а параметры назначения узлов NUMA рабочего процесса определяют, на каком узле NUMA запускается рабочий процесс.

## <a name="user-mode-cache-behavior-settings"></a>Параметры поведения кэша пользовательского режима

В этом разделе описываются параметры, влияющие на поведение кэширования в ИИСÂ 10,0. Кэш пользовательского режима реализуется как модуль, который прослушивает события глобального кэширования, создаваемые интегрированным конвейером. Чтобы полностью отключить кэш пользовательского режима, удалите модуль Филекачемодуле (качфиле. dll) из списка установленных модулей в разделе конфигурации System. Web Server или Глобалмодулес в файле applicationHost. config.

**System .ING Server/Caching**

|Атрибут|Описание|Default|
|--- |--- |--- |
|Включен|Отключает кэш IIS пользовательского режима при установке значения **false**. Если коэффициент попадания в кэш очень мал, можно полностью отключить кэш, чтобы избежать издержек, связанных с путем к коду кэша. Отключение кэша пользовательского режима не отключает кэш режима ядра.|True|
|енаблекернелкаче|Отключает кэш режима ядра при установке значения **false**.|True|
|макскачесизе|Ограничивает размер кэша пользовательского режима IIS указанным размером в мегабайтах. Службы IIS настраивают значение по умолчанию в зависимости от доступной памяти. Тщательно выбирайте значение в зависимости от размера набора часто используемых файлов по сравнению с объемом ОЗУ или адресным пространством процесса IIS.|0|
|максреспонсесизе|Кэширует файлы вплоть до указанного размера. Фактическое значение зависит от числа и размера самого большого файла в наборе данных, а также от объема доступной оперативной памяти. Кэширование больших и часто запрашиваемых файлов может снизить загрузку ЦП, доступ к диску и связанные с ними задержки.|262144|

## <a name="compression-behavior-settings"></a>Параметры поведения сжатия

IIS, начиная с 7,0, по умолчанию сжимает статическое содержимое. Кроме того, сжатие динамического содержимого включается по умолчанию при установке Динамиккомпрессионмодуле. Сжатие сокращает использование пропускной способности, но увеличивает загрузку ЦП. Если это возможно, сжатое содержимое кэшируется в кэше режима ядра. Начиная с 8,5, службы IIS позволяют управлять сжатием независимо для статического и динамического содержимого. Статическое содержимое обычно относится к содержимому, которое не изменяется, например GIF-или HTM-файлы. Динамическое содержимое обычно создается скриптами или кодом на сервере, то есть ASP.NET страницами. Классификацию любого конкретного расширения можно настроить как статический или динамический.

Чтобы полностью отключить сжатие, удалите Статиккомпрессионмодуле и Динамиккомпрессионмодуле из списка модулей в разделе System. Web Server/Глобалмодулес в файле applicationHost. config.

**System. Хттпкомпрессион/**

|Атрибут|Описание|Default|
|--- |--- |--- |
|Статиккомпрессион — Енаблекпуусаже<br><br>Статиккомпрессион — Дисаблекпуусаже<br><br>Динамиккомпрессион — Енаблекпуусаже<br><br>Динамиккомпрессион — Дисаблекпуусаже|Включает или отключает сжатие, если текущая процентная загрузка ЦП превышает или ниже указанных пределов.<br><br>Начиная с IIS 7,0, сжатие автоматически отключается, если ЦП стабильного состояния превышает пороговое значение отключения. Сжатие включается, если ЦП падает ниже порога включения.|50, 100, 50 и 90 соответственно|
|каталог|Указывает каталог, в котором временно хранятся и кэшируются сжатые версии статических файлов. Рекомендуется переместить этот каталог на системный диск, если к нему часто обращаются.|%Системдриве%\инетпуб\темп\иис временные сжатые файлы|
|додискспацелимитинг|Указывает, существует ли ограничение на количество места на диске, которое может занимать все сжатые файлы. Сжатые файлы хранятся в каталоге сжатия, указанном атрибутом **Directory** .|True|
|максдискспацеусаже|Указывает число байтов дискового пространства, которое может занимать сжатые файлы в каталоге сжатия.<br><br>Этот параметр может потребоваться увеличиться, если общий размер всех сжатых содержимого слишком велик.|100 МБ|

**System. urlCompression/**

|Атрибут|Описание|Default|
|--- |--- |--- |
|достатиккомпрессион|Указывает, следует ли сжимать статическое содержимое.|True|
|додинамиккомпрессион|Указывает, следует ли сжимать динамическое содержимое.|True|

**Примечание** . Для серверов, использующих IIS 10,0 с низкой средней загрузкой ЦП, рассмотрите возможность включения сжатия для динамического содержимого, особенно если ответы велики. Сначала следует сделать это в тестовой среде, чтобы оценить воздействие на загрузку ЦП из базовых показателей.


### <a name="tuning-the-default-document-list"></a>Настройка списка документов по умолчанию

Модуль документов по умолчанию обрабатывает HTTP-запросы к корню каталога и преобразует их в запросы для определенного файла, например Default. htm или index. htm. В среднем Араундâ 25% всех запросов в Интернете проходит по пути к документу по умолчанию. Это существенно различается для отдельных сайтов. Если HTTP-запрос не указывает имя файла, модуль документов по умолчанию выполняет поиск по списку допустимых документов по умолчанию для каждого имени в файловой системе. Это может негативно сказаться на производительности, особенно если достижение содержимого требует приема сетевого пути или прикосновения к диску.

Можно избежать дополнительной нагрузки путем выборочного отключения документов по умолчанию, а также путем уменьшения или упорядочения списка документов. Для веб-сайтов, использующих документ по умолчанию, следует сократить список до используемых типов документов по умолчанию. Кроме того, следует упорядочить список, чтобы он начинался с наиболее часто запрашиваемого имени файла документа по умолчанию.

Можно выборочно задать поведение документов по умолчанию для определенных URL-адресов, настроив конфигурацию внутри тега location в файле applicationHost. config или вставив файл Web. config непосредственно в каталог содержимого. Это позволяет применять гибридный подход, который позволяет документам по умолчанию только там, где это необходимо, и присваивает списку правильное имя файла для каждого URL-адреса.

Чтобы полностью отключить документы по умолчанию, удалите Дефаултдокументмодуле из списка модулей в разделе System. Web Server/Глобалмодулес в файле applicationHost. config.

**System. Server/defaultDocument**

|Атрибут|Описание|Default|
|--- |--- |--- |
|enabled|Указывает, что документы по умолчанию включены.|True|
|элемент&gt; &lt;Files|Указывает имена файлов, которые настроены в качестве документов по умолчанию.|По умолчанию используется список Default. htm, Default. ASP, index. htm, index. HTML, iisstart. htm и Default. aspx.|

## <a name="central-binary-logging"></a>Централизованное ведение журнала в двоичном формате

Когда сеанс сервера содержит множество групп URL-адресов, процесс создания сотен форматированных файлов журналов для отдельных групп URL-адресов и записи данных журнала на диск может быстро потреблять ценные ресурсы ЦП и памяти, тем самым создавая производительность и проблемы масштабируемости. Централизованное ведение журнала в двоичном формате уменьшает объем системных ресурсов, используемых для ведения журнала, в то же время предоставляя подробные данные журналов для организаций, которым он необходим. Для анализа журналов в двоичном формате требуется средство последующей обработки.

Вы можете включить централизованное ведение журнала в двоичном формате, установив для атрибута Централлогфилемоде значение Централбинари и установив для атрибута **Enabled** значение **true**. Рассмотрите возможность перемещения центрального файла журнала из системного раздела и на выделенный диск журнала, чтобы избежать конфликтов между действиями системы и действиями ведения журнала.

**System. applicationHost/журнал**

|Атрибут|Описание|Default|
|--- |--- |--- |
|централлогфилемоде|Задает режим ведения журнала для сервера. Измените это значение на Централбинари, чтобы включить централизованное ведение журнала в двоичном формате.|Сайт|

**System. applicationHost/log/Централбинарилогфиле**

|Атрибут|Описание|Default|
|--- |--- |--- |
|enabled|Указывает, включено ли централизованное ведение журнала в двоичном формате.|Нет|
|каталог|Указывает каталог, в который записываются записи журнала.|%системдриве%\инетпуб\логс\логфилес|


## <a name="application-and-site-tunings"></a>Настройки приложений и сайтов

Следующие параметры относятся к настройкам пула приложений и сайта.

**System. applicationHost/Аппликатионпулс/Аппликатионпулдефаултс**

|Атрибут|Описание|Default|
|--- |--- |--- |
|queueLength|Указывает HTTP. sys количество запросов, поставленных в очередь для пула приложений до отклонения будущих запросов. При превышении значения этого свойства IIS отклоняет последующие запросы с ошибкой 503.<br><br>Попробуйте увеличить это для приложений, взаимодействующих с серверными хранилищами данных с высокой задержкой, если наблюдаются ошибки 503.|1000|
|enable32BitAppOnWin64|Если значение — true, позволяет запускать 32-разрядное приложение на компьютере с 64-разрядным процессором.<br><br>Рассмотрите возможность включения 32-разрядного режима, если использование памяти является важным фактором. Так как размеры указателей и размеры команд меньше, 32-разрядные приложения используют меньше памяти, чем 64-разрядные приложения. Недостаток выполнения 32-разрядных приложений на 64-разрядном компьютере состоит в том, что адресное пространство пользовательского режима ограничено 4 ГБ.|Нет|

**System. applicationHost/Sites/Виртуалдиректоридефаулт**

|Атрибут|Описание|Default|
|--- |--- |--- |
|алловсубдирконфиг|Указывает, будет ли IIS искать файлы Web. config в каталогах содержимого ниже текущего уровня (true) или не искать файлы Web. config в каталогах содержимого ниже текущего уровня (false). Установления простое ограничение, которое допускает настройку только в виртуальных каталогах, ИИСÂ 10,0 может быть уверенным в том, что, если только **/&lt;name&gt;. htm** является виртуальным каталогом, он не должен искать файл конфигурации. Пропуск дополнительных файловых операций может значительно повысить производительность веб-сайтов, имеющих очень большой набор статических содержимого со случайным доступом.|True|

## <a name="managing-iis-100-modules"></a>Управление модулями IIS 10,0

Службы IIS 10,0 были разделены на несколько расширяемых пользователем модулей для поддержки модульной структуры. Эта разложение имеет небольшую стоимость. Для каждого модуля интегрированный конвейер должен вызывать модуль для каждого события, относящегося к модулю. Это происходит независимо от того, должен ли модуль выполнять какие – либо действия. Вы можете экономить циклы ЦП и память, удалив все модули, которые не относятся к конкретному веб-сайту.

Веб-сервер, настроенный для простых статических файлов, может включать только следующие пять модулей: Урикачемодуле, Хттпкачемодуле, StaticFileModule, Анонимаусаусентикатионмодуле и Хттплоггингмодуле.

Чтобы удалить модули из файла applicationHost. config, удалите все ссылки на модуль из раздела System. Web Server/обработчики и System. Web Server/modules в дополнение к удалению объявления модуля в System. Web Server/Глобалмодулес.

## <a name="classic-asp-settings"></a>Параметры классической модели ASP

Основная стоимость обработки классического запроса ASP включает инициализацию обработчика скриптов, компиляцию запрошенного скрипта ASP в шаблон ASP и выполнение шаблона в обработчике сценариев. Хотя стоимость выполнения шаблона зависит от сложности запрошенного скрипта ASP, ASP-модуль IIS может кэшировать обработчики сценариев в памяти и шаблонах кэша в памяти и на диске (только в случае, если избыточные потоки шаблонов в памяти) для повышения производительности в Сценарии, связанные с ЦП.

Следующие параметры используются для настройки кэша шаблона классической модели ASP и кэша обработчика скриптов, а также не влияют на параметры ASP.NET.

**System. Server/ASP/Cache**

|Атрибут|Описание|Default|
|--- |--- |--- |
|дисктемплатекачедиректори|Имя каталога, используемого ASP для хранения скомпилированных шаблонов при переполняется кэшем в памяти.<br><br>Рекомендация: укажите каталог, который не является интенсивно используемым, например диск, который не используется совместно с операционной системой, журналом IIS или другим содержимым, к которому часто обращаются.|%Системдриве%\инетпуб\темп\асп скомпилированные шаблоны|
|максдисктемплатекачефилес|Указывает максимальное количество скомпилированных шаблонов ASP, которые могут быть кэшированы на диске.<br><br>Рекомендация: Задайте максимальное значение 0x7FFFFFFF.|2000|
|скриптфилекачесизе|Этот атрибут указывает максимальное количество скомпилированных шаблонов ASP, которые могут быть кэшированы в памяти.<br><br>Рекомендация. Задайте значение по меньшей мере в количестве часто запрашиваемых скриптов ASP, обслуживаемых пулом приложений. Если это возможно, задайте для параметра значение столько шаблонов ASP, сколько разрешено памяти.|500|
|скриптенгинекачемакс|Указывает максимальное число обработчиков сценариев, которые будут хранить кэшированные в памяти.<br><br>Рекомендация. Задайте значение по меньшей мере в количестве часто запрашиваемых скриптов ASP, обслуживаемых пулом приложений. Если это возможно, задайте для параметра значение, равное количеству обработчиков скриптов, если разрешено ограничение памяти.|250|

**System. Server/ASP/limits**

|Атрибут|Описание|Default|
|--- |--- |--- |
|процессорсреадмакс|Указывает максимальное число рабочих потоков, которые может создать ASP на каждый процессор. Увеличьте, если текущий параметр недостаточен для обработки нагрузки, что может вызвать ошибки при обработке запросов или вызвать нехватку ресурсов ЦП.|25|

**System. Server/ASP/comPlus**

|Атрибут|Описание|Default|
|--- |--- |--- |
|ексекутеинмта|Задайте значение **true** , если ошибки или сбои обнаруживаются в то время, когда IIS обслуживает содержимое ASP. Это может произойти, например, при размещении нескольких изолированных сайтов, в которых каждый сайт работает под своим рабочим процессом. Ошибки обычно выводятся из COM+ в Просмотр событий. Этот параметр включает модель многопоточного апартамента в ASP.|Нет|


## <a name="aspnet-concurrency-setting"></a>Параметр параллелизма ASP.NET

### <a name="aspnet-35"></a>ASP.NET 3.5
По умолчанию ASP.NET ограничивает параллелизм запросов для уменьшения потребления памяти стабильного состояния на сервере. Приложениям с высоким уровнем параллелизма может потребоваться изменить некоторые параметры, чтобы повысить общую производительность. Этот параметр можно изменить в файле aspnet. config:

``` syntax
<system.web>
  <applicationPool maxConcurrentRequestsPerCPU="5000"/>
</system.web>
```

Следующий параметр полезен для полного использования ресурсов в системе:

-   **максконкуррентрекуестперкпу** Значение по умолчанию: 5000

    Этот параметр ограничивает максимальное количество одновременно выполняемых запросов ASP.NET в системе. Значение по умолчанию — консервативно, чтобы сократить потребление памяти ASP.NET приложениями. Рекомендуется увеличить это ограничение в системах, где работают приложения, выполняющие длительные синхронные операции ввода-вывода. В противном случае пользователи могут столкнуться с высокой задержкой из-за превышения ограничений очереди при высокой нагрузке при использовании параметра по умолчанию.

### <a name="aspnet-46"></a>ASP.NET 4.6
Помимо параметра Максконкуррентрекуестперкпу, ASP.NET 4,7 также предоставляет параметры для повышения производительности приложений, которые сильно полагаются на асинхронные операции. Параметр можно изменить в файле aspnet. config.

``` syntax
<system.web>
  <applicationPool percentCpuLimit="90" percentCpuLimitMinActiveRequestPerCpu="100"/>
</system.web>
```

-   **перценткпулимит** Значение по умолчанию: 90. асинхронный запрос имеет некоторые проблемы масштабируемости, возникающие при наличии большой нагрузки (помимо аппаратных возможностей) в таком сценарии. Проблема обусловлена характером выделения в асинхронных сценариях. В этих условиях выделение будет выполняться при запуске асинхронной операции и будет использоваться после ее завершения. По истечении этого времени итâс объекты были перемещены в поколение 1 или 2 с помощью GC. В этом случае увеличение нагрузки будет показывать увеличение числа запросов в секунду до точки. Когда мы передаем эту точку, время, затраченное на GC, начнет стать проблемой, а RP начнется на DIP, при отрицательном результате масштабирования. Чтобы устранить проблему, когда загрузка ЦП превысит значение параметра Перценткпулимит, запросы будут отправляться в собственную очередь ASP.NET.
-   **перценткпулимитминактиверекуестперкпу** Значение по умолчанию: 100. регулирование ЦП (параметр Перценткпулимит) не основано на количестве запросов, но на том, насколько дорого они. В результате может быть всего несколько ресурсоемких запросов, вызывающих резервное копирование в собственной очереди без возможности его очистки от входящих запросов. Чтобы решить эту проблме, Перценткпулимитминактиверекуестперкпу можно использовать, чтобы гарантировать, что минимальное количество запросов будет обслуживаться до начала регулирования в.

## <a name="worker-process-and-recycling-options"></a>Параметры рабочего процесса и повторного запуска

Можно настроить параметры для перезапуска рабочих процессов IIS и предоставить практичные решения для акутом ситуаций или событий без необходимости вмешательства или сброса службы или компьютера. К таким ситуациям и событиям относятся утечки памяти, увеличение нагрузки на память, неотвечающие и неактивные рабочие процессы. В обычных условиях могут не требоваться параметры повторного запуска, а перезапуск можно отключить, а система может быть настроена на повторный запуск очень редко.

Вы можете включить перезапуск процесса для конкретного приложения, добавив атрибуты в элемент **утилизация или периодикрестарт** . Событие очистки может инициироваться несколькими событиями, включая использование памяти, фиксированное количество запросов и фиксированный период времени. При перезапуске рабочего процесса запросы, поставленные в очередь и выполняющиеся, преобразуются, а новый процесс одновременно запускается для обслуживания новых запросов. Элемент " **Утилизация/периодикрестарт** " предназначен для каждого приложения. Это означает, что каждый атрибут в следующей таблице секционирован отдельно для каждого приложения.

**System. applicationHost/Аппликатионпулс/Аппликатионпулдефаултс/перезапуск/Периодикрестарт**

|Атрибут|Описание|Default|
|--- |--- |--- |
|memory.|Включить перезапуск процесса, если потребление виртуальной памяти превышает заданное ограничение в килобайтах. Это полезное значение для 32-разрядных компьютеров с небольшим адресным пространством в 2 ГБ. Это позволит избежать неудачных запросов из-за ошибок нехватки памяти.|0|
|privateMemory|Включить перезапуск процесса, если объем выделенной памяти превышает указанный предел в килобайтах.|0|
|requests|Включение повторного запуска процесса после определенного числа запросов.|0|
|время|Включить повторное использование процессов по истечении указанного периода времени.|29:00:00|


## <a name="dynamic-worker-process-page-out-tuning"></a>Динамическая настройка рабочего процесса рабочей роли

Начиная с Windows Server 2012 R2, IIS предлагает возможность настройки приостановки рабочего процесса после бездействия в течение определенного времени (в дополнение к параметру завершения, который существовал с момента выпуска IIS 7).

Основным назначением функций неактивного рабочего процесса и завершения бездействия рабочих процессов является экономия использования памяти на сервере, так как сайт может потреблять много памяти, даже если он просто находится в режиме ожидания. В зависимости от технологии, используемой на сайте (статическое содержимое VS ASP.NET и другие платформы), используемая память может находиться в любом месте от 10 МБ до сотен МБ, а это означает, что если на сервере настроено множество сайтов, то будут вычислены наиболее эффективные параметры. для сайтов может значительно повысить производительность как активных, так и приостановленных сайтов.

Прежде чем мы перейдем к конкретным, мы должны помнить, что если ограничения памяти отсутствуют, то, вероятно, лучше просто настроить узлы так, чтобы они никогда не приходили к приостановке или прекращению работы. В конце концов, сереâс небольшое значение в завершение рабочего процесса, если это единственный компьютер.

**Обратите внимание** ,  если на сайте выполняется нестабильный код, например код с утечкой памяти или нестабильная работа, Настройка сайта на завершение в режиме простоя может быть быстрым и недействительным вариантом исправления ошибки в коде. Мы не рекомендуем использовать эту функцию в качестве механизма очистки, в то время как в Works есть более постоянное решение.\]

Â 

Другой фактор, который следует учитывать, заключается в том, что если сайт использует большой объем памяти, то сам процесс приостановки выполняет сбор данных, так как компьютер должен записывать данные, используемые рабочим процессом, на диск. Если рабочий процесс использует большой объем памяти, то ее приостановка может оказаться более дорогостоящей, чем стоимость ожидания запуска резервного копирования.

Чтобы максимально эффективно использовать функцию приостановки рабочего процесса, необходимо проверить сайты в каждом пуле приложений и решить, какие из них должны быть приостановлены, что должно быть завершено и что должно быть активно в течение неограниченного времени. Для каждого действия и каждого сайта необходимо определить идеальный период времени ожидания.

В идеале сайты, которые вы настраиваете для приостановки или прекращения, — это те, которые имеют посетителей каждый день, но не настолько, чтобы гарантировать его постоянное активное время. Обычно это сайты с 20 уникальными посетителями в день или менее. Вы можете проанализировать шаблоны трафика с помощью файлов журналов сайта и вычислить средний ежедневный объем трафика.

Помните, что когда конкретный пользователь подключается к сайту, он обычно остается на нем по крайней мере в течение определенного времени, что делает дополнительные запросы, а значит, просто подсчитывает ежедневные запросы, может не точно отражать реальные шаблоны трафика. Для более точного чтения можно также использовать средство, например Microsoft Excel, для вычисления среднего времени между запросами. Пример

||URL-адрес запроса|Время запроса|Delta|
|--- |--- |--- |--- |
|1|/SourceSilverLight/Geosource.web/grosource.html|10:01||
|2|/саурцесилверлигхт/жеосаурце.веб/сливерлигхт.жс|10:10|0:09|
|3|/SourceSilverLight/Geosource.web/clientbin/geo/1.aspx|10:11|0:01|
|추가를 클릭합니다.|/лклиентакцессполици.ксмл|10:12|0:01|
|5|/Саурцесилверлигхт/Жеосаурцевебсервице/Service. asmx|10:23|0:11|
|6|/Саурцесилверлигхт/геоисточник. Web/Жеосеарчсервер... ¦.|11:50|1:27|
|7|/Рест/сервицес/качедсервицес/Silverlight_load_la... ¦|12:50|1:00|
|8|/Рест/сервицес/качедсервицес/Silverlight_basemap... ¦.|12:51|0:01|
|9|/Рест/сервицес/динамиксервице/Silverlight_basemap... ¦.|12:59|0:08|
|10|/Рест/сервицес/качедсервицес/Ortho_2004_cache. AS...|13:40|0:41|
|11|/Рест/сервицес/качедсервицес/Ortho_2005_cache. js|13:40|0:00|
|12|/рест/сервицес/качедсервицес/орсобасингине.аспкс|13:41|0:01|

Тем не менее, трудно определить, какой параметр применить к смыслу. В нашем случае сайт получает пакет запросов от пользователей, а в таблице выше показано, что общее количество уникальных сеансов в течение 4 часов истекло. При использовании параметров по умолчанию для приостановки рабочего процесса пула приложений сайт будет прерван по истечении времени ожидания по умолчанию, равного 20 минутам, что означает, что каждый из этих пользователей может столкнуться с циклом ускорения сайта. Это делает его идеальным кандидатом к приостановке рабочих процессов, так как в большинстве случаев сайт переходит в режим простоя, и поэтому его приостановка приведут к экономии ресурсов и позволяет пользователям сразу же обращаться к сайту.

Последнее и очень важное замечание заключается в том, что для этой функции важна производительность диска. Так как процесс приостановки и пробуждения предполагает запись и чтение большого объема данных на жестком диске, мы настоятельно рекомендуем использовать для этого быстрый диск. Твердотельные накопители (SSD) идеально подходят для этого, поэтому следует убедиться в том, что файл подкачки Windows хранится на нем (если сама операционная система не установлена на SSD-накопителе, настройте операционную систему для перемещения файла подкачки на него).

Независимо от того, используется SSD-диск или нет, мы рекомендуем исправить размер файла подкачки для размещения в нем данных для выхода из страницы без изменения размера файлов. Изменение размера файла страницы может произойти, если операционная система должна хранить данные в файле подкачки, так как по умолчанию Windows настроена на автоматическую корректировку размера в зависимости от потребностей. Установив фиксированный размер, можно предотвратить изменение размера и повысить производительность.

Чтобы настроить предварительно фиксированный размер файла подкачки, необходимо вычислить его идеальный размер, который зависит от количества сайтов, которые будут приостановлены, и объема используемой памяти. Если среднее значение составляет 200 МБ для активного рабочего процесса и на серверах, которые будут приостановлены, 500 узлов, то файл подкачки должен быть не менее (200 \* 500) МБ над базовым размером файла подкачки (т. е. базовый + 100 ГБ в нашем примере).

**Примечание** . Когда сайты приостанавливаются, они потребляют около 6 МБ каждого, поэтому в нашем случае использование памяти, если все узлы приостановлены, займет около 3 ГБ. Однако в реальности йоуâре, вероятно, никогда не будет приостанавливаться одновременно.

 
## <a name="transport-layer-security-tuning-parameters"></a>Параметры настройки безопасности транспортного уровня

Использование протокола TLS накладывает дополнительные затраты на ЦП. Самый ресурсоемкий компонент TLS — это стоимость установления сеанса, так как она включает полное подтверждение. При повторном подключении, шифровании и расшифровке также добавляются затраты. Для повышения производительности TLS выполните следующие действия.

-   Включите поддержку открытых соединений HTTP для сеансов TLS. Это устраняет затраты на установку сеанса.

-   Повторно используйте сеансы, если это уместно, особенно с трафиком без активности.

-   Выборочно примените шифрование только к страницам или частям сайта, которые им нужны, а не ко всему сайту.

**Примечание**
-   Большие ключи обеспечивают дополнительную безопасность, но они также используют больше времени ЦП.

-   Все компоненты могут не требовать шифрования. Однако смешивание обычного протокола HTTP и HTTPS может привести к появлению всплывающего предупреждения о том, что не все содержимое страницы является безопасным.

 
## <a name="internet-server-application-programming-interface-isapi"></a>Серверный интерфейс прикладного программирования (ISAPI)

Для приложений ISAPI специальные параметры настройки не требуются. При написании частного расширения ISAPI убедитесь, что оно написано для повышения производительности и использования ресурсов.

## <a name="managed-code-tuning-guidelines"></a>Рекомендации по настройке управляемого кода

Интегрированная модель конвейера в IIS 10,0 обеспечивает высокую степень гибкости и расширяемости. Пользовательские модули, реализованные в машинном или управляемом коде, могут быть вставлены в конвейер или заменены существующими модулями. Хотя эта модель расширяемости обеспечивает удобство и простоту, перед вставкой новых управляемых модулей, которые присоединяются к глобальным событиям, следует соблюдать осторожность. Добавление глобального управляемого модуля означает, что все запросы, включая запросы статических файлов, должны касаться управляемого кода. Пользовательские модули уязвимы для таких событий, как сборка мусора. Кроме того, пользовательские модули добавляют значительные затраты на ЦП из-за упаковки данных между машинным и управляемым кодом. По возможности следует установить предварительное условие в Манажедхандлер для управляемого модуля.

Чтобы повысить производительность холодного запуска, обязательно выполните предварительную компиляцию веб-сайта ASP.NET или используйте функцию инициализации приложения IIS, чтобы подготовить приложение.

Если состояние сеанса не требуется, убедитесь, что оно отключено для каждой страницы.

При наличии множества операций, связанных с вводом-выводом, старайтесь использовать асинхронную версию соответствующих API, что обеспечит более высокую масштабируемость.

Кроме того, использование кэша вывода также повышает производительность веб-узла.

При запуске нескольких узлов, содержащих сценарии ASP.NET в изолированном режиме (один пул приложений на сайт), отслеживайте использование памяти. Убедитесь, что на сервере достаточно ОЗУ для ожидаемого количества одновременно выполняющихся пулов приложений. Рассмотрите возможность использования нескольких доменов приложений вместо нескольких изолированных процессов.


## <a name="other-issues-that-affect-iis-performance"></a>Другие проблемы, влияющие на производительность IIS

Следующие проблемы могут повлиять на производительность IIS:

-   Установка фильтров, не поддерживающих кэширование

    При установке фильтра, не поддерживающего кэширование HTTP, службы IIS полностью отключают кэширование, что приводит к снижению производительности. Фильтры ISAPI, которые были написаны до ИИСÂ 6,0, могут вызвать это поведение.

-   Запросы общего шлюза (CGI)

    По соображениям производительности использование приложений CGI для обслуживания запросов не рекомендуется для служб IIS. Частое создание и удаление процессов CGI требует значительных издержек. Лучшими альтернативами являются использование FastCGI, скриптов приложений ISAPI и скриптов ASP или ASP.NET. Для каждого из этих параметров доступна изоляция.

## <a name="see-also"></a>См. также статью
- [Настройка производительности веб-сервера](index.md) 
- [Настройка HTTP 1.1 и HTTP 2](http-performance.md)
