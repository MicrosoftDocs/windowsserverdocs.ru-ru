---
title: Рекомендации по виртуальным машинам Linux
description: Виртуальная машина Linux и BSD
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Asmahi; SandySp; JoPoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 5668629e7eded214525561d30fec496a4e91b8dc
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71385071"
---
# <a name="linux-virtual-machine-considerations"></a>Рекомендации по виртуальным машинам Linux

Виртуальные машины Linux и BSD имеют дополнительные соображения по сравнению с виртуальными машинами Windows в Hyper-V.

Первое, что следует учесть, — наличие Integration Services или если виртуальная машина работает только на имитируемом оборудовании без просвещение. Таблица выпусков Linux и BSD с встроенными или загружаемыми Integration Services доступна на [поддерживаемых виртуальных машинах Linux и FreeBSD для Hyper-V в Windows](https://technet.microsoft.com/windows-server-docs/compute/hyper-v/supported-linux-and-freebsd-virtual-machines-for-hyper-v-on-windows). На этих страницах есть таблицы доступных функций Hyper-V, доступных для дистрибутивов Linux, и примечания по этим функциям (если применимо).

Даже если гостевой компьютер работает Integration Services, его можно настроить с помощью устаревшего оборудования, которое не обеспечивает наилучшую производительность. Например, настройте и используйте виртуальный адаптер Ethernet для гостя вместо использования устаревшего сетевого адаптера. В Windows Server 2016 также доступны расширенные возможности работы с сетью, например SR-IOV.

## <a name="linux-network-performance"></a>Производительность сети Linux

Linux по умолчанию включает аппаратное ускорение и разгрузки по умолчанию. Если функция vRSS включена в свойствах сетевой карты на узле, а гостевая ОС Linux имеет возможность использовать vRSS, эта возможность будет включена. В PowerShell этот же параметр можно изменить с помощью команды `EnableNetAdapterRSS`.

Аналогично, функция ВММК (RSS-канал виртуального коммутатора) может быть включена на физическом сетевом адаптере, используемом гостевыми **свойствами** > **Configure...**  >  Вкладка**дополнительно** > задайте для **параметра RSS виртуального коммутатора** значение **включено** или включите вммк в PowerShell, используя следующую команду:

```PowerShell
 Set-VMNetworkAdapter -VMName **$VMName** -VmmqEnabled $True
 ```

Дополнительные настройки TCP в гостевой виртуальной машине можно выполнить путем увеличения ограничений. Для наилучшей производительности, распространяющей рабочую нагрузку на несколько процессоров и обеспечивающих высокую пропускную способность, так как виртуализированные рабочие нагрузки будут иметь большую задержку, чем "исходное состояние".

Ниже приведены некоторые примеры параметров настройки, которые были полезны при тестировании сети.

```PowerShell
net.core.netdev_max_backlog = 30000
net.core.rmem_max = 67108864
net.core.wmem_max = 67108864
net.ipv4.tcp_wmem = 4096 12582912 33554432
net.ipv4.tcp_rmem = 4096 12582912 33554432
net.ipv4.tcp_max_syn_backlog = 80960
net.ipv4.tcp_slow_start_after_idle = 0
net.ipv4.tcp_tw_reuse = 1
net.ipv4.ip_local_port_range = 10240 65535
net.ipv4.tcp_abort_on_overflow = 1
```

Полезным инструментом для тестирования сетевых тестов является ntttcp, который доступен как в Linux, так и в Windows. Версия Linux — это открытый исходный код, доступный в [ntttcp для Linux на GitHub.com](https://github.com/Microsoft/ntttcp-for-linux). Версию Windows можно найти в [центре загрузки](https://gallery.technet.microsoft.com/NTttcp-Version-528-Now-f8b12769). При настройке рабочих нагрузок лучше использовать столько потоков, сколько необходимо для достижения наилучшей пропускной способности. При использовании ntttcp для моделирования трафика параметр `-P` задает количество используемых параллельных подключений.

## <a name="linux-storage-performance"></a>Производительность хранилища Linux

Некоторые рекомендации, как показано ниже, перечислены в статье рекомендации [по запуску Linux в Hyper-V](https://technet.microsoft.com/windows-server-docs/compute/hyper-v/best-practices-for-running-linux-on-hyper-v). Ядро Linux имеет разные планировщики ввода-вывода для изменения порядка запросов с различными алгоритмами. NOOP — это очередь первого возврата, которая передает запланированное решение гипервизору. При запуске виртуальной машины Linux в Hyper-V рекомендуется использовать NOOP в качестве планировщика. Чтобы изменить планировщик для конкретного устройства, в конфигурации загрузчика (например,/ЕТК/груб.конф) добавьте `elevator=noop` в параметры ядра, а затем перезапустите.

Как и в случае с сетями, производительность гостевых систем Linux с учетом преимуществ в хранилище выгодна из нескольких очередей с достаточной глубиной, чтобы узел был занят. Производительность хранилища микропроизводительности, вероятно, лучше всего подходит для fioного средства тестирования с помощью механизма либаио.

## <a name="see-also"></a>См. также

-   [Терминология Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Конфигурация сервера Hyper-V](configuration.md)

-   [Производительность процессоров Hyper-V](processor-performance.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Производительность ввода-вывода хранилища Hyper-V](storage-io-performance.md)

-   [Производительность ввода-вывода сети Hyper-V](network-io-performance.md)

-   [Обнаружение узких мест в виртуализированной среде](detecting-virtualized-environment-bottlenecks.md)
