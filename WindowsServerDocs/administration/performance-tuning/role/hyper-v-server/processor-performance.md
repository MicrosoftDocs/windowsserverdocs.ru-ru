---
title: Производительность процессора Hyper-V
description: Вопросы производительности процессора при настройке производительности Hyper-V
ms.topic: article
ms.author: asmahi; sandysp; jopoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: ba426a2a4db853dbd91180fcceed6807726efbf8
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87992100"
---
# <a name="hyper-v-processor-performance"></a>Производительность процессора Hyper-V


## <a name="virtual-machine-integration-services"></a>Службы интеграции виртуальных машин

Виртуальная машина Integration Services включает драйверы поддержкой для устройств ввода-вывода, специфичных для Hyper-V, что значительно сокращает нагрузку на ЦП для операций ввода-вывода по сравнению с эмуляциями устройств. Следует установить последнюю версию виртуальной машины Integration Services на каждой поддерживаемой виртуальной машине. Службы уменьшают загрузку ЦП гостевых компьютеров, от бездействующих гостей до интенсивно используемых гостей и улучшают пропускную способность ввода-вывода. Это первый шаг в настройке производительности на сервере с Hyper-V. Список поддерживаемых гостевых операционных систем см. в статье [Обзор Hyper-V](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831531(v=ws.11)).

## <a name="virtual-processors"></a>Виртуальные процессоры

Hyper-V в Windows Server 2016 поддерживает не более 240 виртуальных процессоров на одну виртуальную машину. Виртуальные машины, для которых используются нагрузки, не требующие интенсивного использования ЦП, должны быть настроены на использование одного виртуального процессора. Это обусловлено дополнительными издержками, связанными с несколькими виртуальными процессорами, например дополнительными затратами на синхронизацию в гостевой операционной системе.

Увеличьте число виртуальных процессоров, если для виртуальной машины требуется более одного ЦП при пиковой нагрузке.

## <a name="background-activity"></a>Фоновое действие

Минимизация фоновых действий в бездействующих виртуальных машинах освобождает циклы ЦП, которые могут использоваться другими виртуальными машинами. Windows Гости обычно используют менее одного процента от одного ЦП, когда они бездействуют. Ниже приведены некоторые рекомендации по минимизации фонового использования ЦП виртуальной машины.

-   Установите последнюю версию Integration Services виртуальной машины.

-   Удалите эмулированного сетевого адаптера с помощью диалогового окна "Параметры виртуальной машины" (используйте адаптер Microsoft Hyper-V).

-   Удалите неиспользуемые устройства, такие как компакт-диски и COM-порты, или отключите их носители.

-   При отсутствии использования и отключении заставки используйте гостевую операционную систему Windows на экране входа.

-   Проверьте запланированные задачи и службы, которые включены по умолчанию.

-   Проверьте поставщики трассировки событий Windows, которые включены по умолчанию, запустив **logman.exe Query-ETS** .

-   Улучшение серверных приложений для сокращения периодических действий (например, таймеров).

-   Закройте диспетчер сервера в основной и гостевой операционных системах.

-   Не выполняйте запуск диспетчера Hyper-V, так как он постоянно обновляет эскиз виртуальной машины.

Ниже приведены дополнительные рекомендации по настройке *клиентской версии* Windows на виртуальной машине для снижения общей загрузки ЦП.

-   Отключите фоновые службы, такие как "упреждающая выборка" и "Поиск Windows".

-   Отключите запланированные задачи, такие как запланированная дефрагментация.

## <a name="virtual-numa"></a>Виртуальная топология NUMA

Чтобы обеспечить виртуализацию крупномасштабных рабочих нагрузок, Hyper-V в Windows Server 2016 расширил ограничения масштабирования виртуальных машин. Одной виртуальной машине можно назначить до 240 виртуальных процессоров и 12 ТБ памяти. При создании таких крупных виртуальных машин, скорее всего, будет использоваться память из нескольких узлов NUMA в основной системе. В такой конфигурации виртуальной машины, если виртуальные процессоры и память не распределяются из одного узла NUMA, рабочие нагрузки могут иметь неплохое снижение производительности из-за невозможности воспользоваться преимуществами оптимизации NUMA.

В Windows Server 2016 Hyper-V представляет собой виртуальную топологию NUMA для виртуальных машин. Виртуальная топология NUMA по умолчанию оптимизируется в соответствии с топологией NUMA основного компьютера. Предоставление топологии NUMA виртуальной машине позволяет гостевой операционной системе и установленным в ней приложениям с поддержкой NUMA использовать связанные с NUMA преимущества оптимизаций производительности точно так же, как если бы они работали на физическом компьютере.

Между виртуальной и физической архитектурой NUMA нет различий от перспективы рабочей нагрузки. Когда рабочая нагрузка на виртуальной машине выделяет локальную память для данных и обращается к этим данным на одном и том же узле NUMA, в соответствующей физической системе осуществляется быстрый доступ к локальной памяти. При этом потерь производительности в процессе доступа к удаленной памяти удается избежать. Только приложения, поддерживающие NUMA, могут использовать преимущества Внума.

Microsoft SQL Server является примером приложения, поддерживающего NUMA. Дополнительные сведения см. в разделе [Общие сведения о доступе к неоднородной памяти](/previous-versions/sql/sql-server-2008-r2/ms178144(v=sql.105)).

Виртуальную архитектуру NUMA и функцию динамической памяти нельзя использовать одновременно. Виртуальная машина, для которой включена динамическая память, имеет только один виртуальный узел NUMA и ей не предоставляется топология NUMA вне зависимости от параметров виртуальной архитектуры NUMA.

Дополнительные сведения о виртуальной архитектуре NUMA см. в статье [Общие сведения о виртуальной архитектуре NUMA Hyper-V](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn282282(v=ws.11)).

## <a name="additional-references"></a>Дополнительные ссылки

-   [Терминология Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Конфигурация сервера Hyper-V](configuration.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Производительность ввода-вывода хранилища Hyper-V](storage-io-performance.md)

-   [Производительность ввода-вывода сети Hyper-V](network-io-performance.md)

-   [Обнаружение узких мест в виртуализированной среде](detecting-virtualized-environment-bottlenecks.md)

-   [Виртуальные машины Linux](linux-virtual-machine-considerations.md)