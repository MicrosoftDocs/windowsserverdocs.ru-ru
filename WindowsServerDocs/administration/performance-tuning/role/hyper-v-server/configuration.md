---
title: Конфигурация Hyper-V
description: Вопросы настройки Hyper-V для настройки производительности
ms.topic: article
ms.author: asmahi
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: a7779b882fe6a704dcf12819ad91042c20381eba
ms.sourcegitcommit: 7cacfc38982c6006bee4eb756bcda353c4d3dd75
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/14/2020
ms.locfileid: "90077221"
---
# <a name="hyper-v-configuration"></a>Конфигурация Hyper-V

## <a name="hardware-selection"></a>Выбор оборудования

Рекомендации по оборудованию для серверов под управлением Hyper-V, как правило, похожи на те, которые являются невиртуализованными серверами, но серверы с Hyper-V могут демонстрировать увеличение загрузки ЦП, потребляют больше памяти и требуют большей пропускной способности ввода-вывода в связи с консолидацией серверов.

-   **Процессоры**

    Hyper-V в Windows Server 2016 представляет логические процессоры как один или несколько виртуальных процессоров для каждой активной виртуальной машины. Hyper-V теперь требует процессоров, поддерживающих технологии преобразования адресов второго уровня (SLAT), такие как расширенные таблицы страниц (EPT) или таблицы вложенных страниц (НПТ).

-   **Cache**

    Hyper-V может выиграть от больших кэшей процессора, особенно для нагрузок с большим рабочим набором в памяти и в конфигурациях виртуальных машин, в которых отношение виртуальных процессоров к логическим процессорам велико.

-   **Память**

    Физическому серверу требуется достаточно памяти для корневого и дочернего разделов. Корневой разделу требуется память для эффективного выполнения операций ввода-вывода от имени виртуальных машин и операций, таких как моментальный снимок виртуальной машины. Hyper-V обеспечивает достаточный объем доступной памяти для корневого раздела и позволяет назначить оставшийся объем памяти дочерним секциям. Размеры дочерних секций должны быть в зависимости от потребностей ожидаемой нагрузки для каждой виртуальной машины.

-   **Хранилище**

    Оборудование хранилища должно иметь достаточную пропускную способность ввода-вывода и емкость для удовлетворения текущих и будущих потребностей виртуальных машин, размещенных на физическом сервере. Эти требования следует учитывать при выборе контроллеров и дисков хранилища и выборе конфигурации RAID. Размещение виртуальных машин с ресурсоемкими рабочими нагрузками на разных физических дисках может повысить общую производительность. Например, если четыре виртуальные машины используют один диск и активно используют его, каждая виртуальная машина может выдавать только 25% пропускной способности этого диска.

## <a name="power-plan-considerations"></a>Рекомендации по схеме управления питанием

Виртуализация — это мощное средство, которое полезно при увеличении плотности рабочих нагрузок серверов, уменьшая количество необходимых физических серверов в центре обработки данных, повышая эксплуатационную эффективность и уменьшая затраты на энергопотребление. Управление питанием является критически важным для управления затратами.

В идеальной среде центра обработки данных потребление энергии управляется путем консолидации работы на компьютерах до тех пор, пока они не будут заняты, а затем отключены на бездействующие компьютеры. Если этот подход непрактичен, администраторы могут использовать схемы управления питанием на физических узлах, чтобы гарантировать, что они не потребляют больше энергии, чем необходимо.

Методы управления питанием сервера поставляются с учетом затрат, особенно в том случае, если рабочие нагрузки клиента не являются доверенными для диктовки политики физической инфраструктуры поставщика услуг размещения. Программное обеспечение уровня узла оставляет возможность максимально увеличить пропускную способность и свести к минимуму энергопотребление. В основном на бездействующих машинах это может привести к тому, что физическая инфраструктура завершится с помощью средней мощности, что приведет к тому, что отдельные рабочие нагрузки клиента будут работать медленнее, чем в противном случае.

Windows Server использует виртуализацию в самых разных сценариях. С легко загруженного сервера IIS на умеренную SQL Server в облачный узел с Hyper-V, на котором запущены сотни виртуальных машин на каждом сервере. Каждый из этих сценариев может иметь уникальные требования к оборудованию, программному обеспечению и производительности. По умолчанию Windows Server использует и рекомендует **сбалансированную** схему управления питанием, которая позволяет экономить электроэнергию путем масштабирования производительности процессора на основе загрузки ЦП.

При использовании **сбалансированной** схемы управления питанием самые высокие состояния питания (и наименьшие задержки ответа в рабочих нагрузках клиента) применяются только в том случае, когда физический узел относительно занят. При значении детерминированного ответа с низкой задержкой для всех рабочих нагрузок клиента следует рассмотреть возможность переключения с **сбалансированной** схемы управления питанием на **высокопроизводительную** схему управления питанием. **Высокопроизводительная** схема управления питанием будет выполнять все процессоры с максимальной скоростью, эффективно отключая переключение на основе спроса вместе с другими методами управления питанием и оптимизировать производительность по сравнению с энергосбережением.

Для клиентов, которым удовлетворена экономия затрат от сокращения числа физических серверов и требуется обеспечить максимальную производительность для виртуализованных рабочих нагрузок, следует рассмотреть возможность использования **высокопроизводительной** схемы управления питанием.

Дополнительные рекомендации и сведения об использовании схем управления питанием для оптимизации инфраструктуры см. в статье [Рекомендуемые параметры схемы управления питанием для быстрого ответа](../../hardware/power/recommended-balanced-plan-parameters.md) .



## <a name="server-core-installation-option"></a>Установка основных серверных компонентов

Windows Server 2016 — вариант установки основных серверных компонентов. Server Core предлагает минимальную среду для размещения выбранного набора ролей сервера, включая Hyper-V. Он занимает меньше места на диске для операционной системы узла, а также меньшей атаки и обслуживания. Поэтому мы настоятельно рекомендуем использовать для серверов виртуализации Hyper-V вариант установки Server Core.

Установка Server Core предлагает окно консоли только в том случае, если пользователь вошел в систему, но Hyper-V предоставляет функции удаленного управления, включая [Windows PowerShell](/powershell/module/hyper-v/?view=win10-ps) , поэтому администраторы могут управлять ею удаленно.

## <a name="dedicated-server-role"></a>Выделенная роль сервера

Корневой раздел должен быть выделен для Hyper-V. Выполнение дополнительных ролей сервера на сервере под управлением Hyper-V может негативно сказаться на производительности сервера виртуализации, особенно если они потребляют значительный объем ресурсов ЦП, памяти или ввода-вывода. Минимизация ролей сервера в корневом разделе имеет дополнительные преимущества, такие как уменьшение уязвимой зоны.

Системным администраторам следует тщательно продумать, какое программное обеспечение установлено в корневом разделе, поскольку некоторое программное обеспечение может негативно сказаться на общей производительности сервера с Hyper-V.

## <a name="guest-operating-systems"></a>Гостевые операционные системы

Hyper-V поддерживает и были настроены для нескольких операционных систем на виртуальной машине. Число виртуальных процессоров, которые поддерживаются на гостевых машинах, зависит от операционной системы на виртуальной машине. Список поддерживаемых гостевых операционных систем см. в статье [Обзор Hyper-V](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831531(v=ws.11)).

## <a name="cpu-statistics"></a>Статистика ЦП

Hyper-V публикует счетчики производительности, чтобы помочь определить поведение сервера виртуализации и сообщить об использовании ресурсов. Стандартный набор инструментов для просмотра счетчиков производительности в Windows включает системный монитор и Logman.exe, которые могут отображать и записывать в журнал счетчики производительности Hyper-V. Имена соответствующих объектов счетчиков начинаются с префикса **Hyper-V**.

Следует всегда измерять загрузку ЦП физической системы с помощью счетчиков производительности логического процессора гипервизора Hyper-V. Счетчики использования ЦП, которые диспетчер задач и отчет монитора производительности в корневых и дочерних разделах не соответствуют фактическому физическому использованию ЦП. Используйте следующие счетчики производительности для мониторинга производительности:

- **Логический процессор гипервизора Hyper-V ( \* ) \\ % всего времени выполнения** общее время, отличное от времени простоя логических процессоров

- **Логический процессор гипервизора Hyper-V ( \* ) \\ % времени выполнения гостевой** системы время, затраченное на выполнение циклов в гостевой службе или в узле

- **Логический процессор гипервизора Hyper-V ( \* ) \\ % времени выполнения низкоуровневой** оболочки время, затраченное на выполнение в гипервизоре

- **Корневой виртуальный процессор гипервизора Hyper-V ( \* ) \\ \\ *** измеряет использование ЦП корневого раздела

- **Виртуальный процессор гипервизора Hyper-V \* ( \\ \\ )*** измеряет использование ЦП гостевыми секциями


## <a name="additional-references"></a>Дополнительные ссылки

-   [Терминология Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Производительность процессоров Hyper-V](processor-performance.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Производительность ввода-вывода хранилища Hyper-V](storage-io-performance.md)

-   [Производительность ввода-вывода сети Hyper-V](network-io-performance.md)

-   [Обнаружение узких мест в виртуализированной среде](detecting-virtualized-environment-bottlenecks.md)

-   [Виртуальные машины Linux](linux-virtual-machine-considerations.md)