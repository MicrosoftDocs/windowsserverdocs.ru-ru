---
title: Обнаружение узких мест в виртуализированной среде
description: Обнаружение и устранение потенциальных узких мест производительности Hyper-v
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Asmahi; SandySp; JoPoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: a0d6d263b344cde412ee4dd3caa80305742d56e7
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70866596"
---
# <a name="detecting-bottlenecks-in-a-virtualized-environment"></a>Обнаружение узких мест в виртуализированной среде

В этом разделе вы узнаете о том, что следует отслеживать с помощью системного монитора, и как определить, где проблема может быть вызвана тем, что узел или некоторые виртуальные машины не выполняются так, как ожидалось.

## <a name="processor-bottlenecks"></a>Узкие места процессора

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в работе процессора:

-   Загружен один или несколько логических процессоров

-   Загружен один или несколько виртуальных процессоров

С узла можно использовать следующие счетчики производительности:

-   Использование логического процессора — \\логический процессор гипервизора Hyper-V\*(\\)% общего времени выполнения

-   Использование виртуального процессора — \\виртуальный процессор гипервизора Hyper-V\*(\\)% общего времени выполнения

-   Использование корневого виртуального процессора \\— корневой виртуальный процессор гипервизора Hyper\*-\\V ()% общего времени выполнения

Если **логический процессор гипервизора Hyper-V (\_всего)\\% общего времени выполнения** превышает 90%, узел перегружен. Необходимо добавить дополнительные вычислительные мощности или переместить некоторые виртуальные машины на другой узел.

Если **виртуальный процессор гипервизора Hyper-V (имя виртуальной машины: вице-\\президент x)% общего счетчика времени выполнения** превышает 90% для всех виртуальных процессоров, необходимо выполнить следующие действия.

-   Убедитесь, что узел не перегружен

-   Узнайте, может ли Рабочая нагрузка использовать больше виртуальных процессоров

-   Назначение виртуальной машине дополнительных виртуальных процессоров

Если **виртуальный процессор гипервизора Hyper-V (имя виртуальной машины: вице\\-президент x)% общего счетчика времени выполнения** превышает 90% для некоторых, но не всех виртуальных процессоров, необходимо выполнить следующие действия.

-   Если Рабочая нагрузка получает ресурсоемкий доступ к сети, следует рассмотреть возможность использования vRSS.

-   Если виртуальные машины не работают под Windows Server 2012 R2, следует добавить дополнительные сетевые адаптеры.

-   Если Рабочая нагрузка требует большого объема хранилища, необходимо включить виртуальную архитектуру NUMA и добавить дополнительные виртуальные диски.

Если для некоторых, но не для всех виртуальных процессоров и процессор (x) **\\** **\\% времени DPC (x)% времени прерываний и процессора (х)% от общего 90 количества процессоров\\, а также тактовой частоте ЦП (x)%** счетчик приблизительно увеличивает значение счетчика " **% всего времени работы корневого виртуального процессора" (\\привилегированный виртуальный процессор x)** , поэтому необходимо включить VMQ на сетевых адаптерах.

## <a name="memory-bottlenecks"></a>Узкие места в памяти

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в памяти:

-   Узел не отвечает.

-   Не удается запустить виртуальные машины.

-   Недостаточно памяти на виртуальных машинах.

С узла можно использовать следующие счетчики производительности:

-   Объем\\доступной памяти, МБ

-   Доступная память балансировщика динамическая память Hyper-\*V\\()

На виртуальной машине можно использовать следующие счетчики производительности:

-   Объем\\доступной памяти, МБ

Если **объем доступной\\памяти** ( **\*МБ)\\и счетчики памяти для подсистемы балансировки динамическая память Hyper-V** недостаточно на узле, следует отключить ненужные службы и перенести одну или несколько виртуальных компьютеров на другой узел.

Если значение счетчика " **Доступно МБ памяти\\** " мало в виртуальной машине, следует назначить виртуальной машине больше памяти. При использовании динамическая память следует увеличить значение параметра Максимальный объем памяти.

## <a name="network-bottlenecks"></a>Узкие места в сети

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в сети.

-   Узел привязан к сети.

-   Виртуальная машина привязана к сети.

С узла можно использовать следующие счетчики производительности:

-   Сетевой интерфейс (*имя сетевого адаптера*)\\(байт/с)

На виртуальной машине можно использовать следующие счетчики производительности:

-   Виртуальный сетевой адаптер Hyper-V (*идентификатор GUID&lt;&gt;имени виртуальной машины*)\\, байт/с

Если счетчик " **байт физической сетевой карты/сек** " больше или равен 90% емкости, необходимо добавить дополнительные сетевые адаптеры, выполнить миграцию виртуальных машин на другой узел и настроить сетевое качество обслуживания.

Если значение счетчика " **байт/сек" виртуального сетевого адаптера Hyper-V** превышает или равно 250 Мбит/с, необходимо добавить дополнительные объединенные сетевые адаптеры в виртуальную машину, включить vRSS и использовать SR-IOV.

Если рабочие нагрузки не могут удовлетворить их задержки в сети, включите SR-IOV для представления физических ресурсов сетевого адаптера виртуальной машине.

## <a name="storage-bottlenecks"></a>Узкие места в хранилище

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в хранилище.

-   Операции узла и виртуальной машины выполняются с задержкой или временем ожидания.

-   Виртуальная машина медленно работает.

С узла можно использовать следующие счетчики производительности:

-   Физический диск (*буква диска*) среднее время чтения с диска (с)\\

-   Физический диск (*буква диска*) среднее время записи на диск (сек.)\\

-   Физический диск (*буква диска*)\\СР. Длина очереди чтения с диска

-   Физический диск (*буква диска*)\\СР. Длина очереди записи на диск

Если задержки постоянно превышают 50 мс, следует выполнить следующие действия.

-   Распределение виртуальных машин по дополнительному хранилищу

-   Рассмотрите возможность приобретения более быстрого хранилища

-   Рассмотрите возможность использовать многоуровневые дисковые пространства, появившиеся в Windows Server 2012 R2

-   Рассмотрите возможность использования качества обслуживания хранилища, которое было представлено в Windows Server 2012 R2

-   Использовать VHDX

## <a name="see-also"></a>См. также

-   [Терминология Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Конфигурация сервера Hyper-V](configuration.md)

-   [Производительность процессоров Hyper-V](processor-performance.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Производительность ввода-вывода хранилища Hyper-V](storage-io-performance.md)

-   [Производительность ввода-вывода сети Hyper-V](network-io-performance.md)

-   [Виртуальные машины Linux](linux-virtual-machine-considerations.md)
