---
title: Обнаружение узких мест в виртуализованной среде
description: Как обнаружить и устранить потенциальные узкие места производительности Hyper-v
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Asmahi; SandySp; JoPoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: cdad5f0cc3b0e49ae46e975e3acc2c48a18e5f70
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59867535"
---
# <a name="detecting-bottlenecks-in-a-virtualized-environment"></a>Обнаружение узких мест в виртуализованной среде

В этом разделе следует предоставить некоторые ссылки на что следует отслеживать с помощью системного монитора и как определить, где могут быть проблемы, когда на узле или некоторые из виртуальных машин не выполняют как ожиданиям.

## <a name="processor-bottlenecks"></a>Узкие места процессора

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места процессора.

-   Загружаются один или несколько логических процессоров

-   Загружаются один или несколько виртуальных процессоров

Можно использовать следующие счетчики производительности на узле:

-   Использование логического процессора - \\логического процессора низкоуровневой оболочки Hyper-V (\*)\\% общее время выполнения

-   Использование виртуального процессора - \\виртуального процессора низкоуровневой оболочки Hyper-V (\*)\\% общее время выполнения

-   Корневой виртуальный процессор использование - \\Hyper-V низкоуровневая оболочка корневой виртуальный процессор (\*)\\% общее время выполнения

Если **логического процессора низкоуровневой оболочки Hyper-V (\_общее)\\% общего времени выполнения** счетчика является более 90%, узел перегружен. Следует добавить больше вычислительной мощности или переместить некоторые виртуальные машины на другой узел.

Если **Processor(VM Name:VP x) виртуального низкоуровневой оболочки Hyper-V\\% общего времени выполнения** счетчика является более чем на 90% для всех виртуальных процессоров, вы должны сделать следующее:

-   Убедитесь, что узел не перегружен

-   Узнайте, если рабочая нагрузка может использовать несколько виртуальных процессоров

-   Назначить несколько виртуальных процессоров для виртуальной машины

Если **Processor(VM Name:VP x) виртуального низкоуровневой оболочки Hyper-V\\% общего времени выполнения** счетчика является более 90% для некоторых, но не все виртуальные процессоры, вы должны сделать следующее:

-   Если рабочая нагрузка является получаемым интенсивным использованием сети, можно использовать vRSS.

-   Если виртуальные машины работают не под управлением Windows Server 2012 R2, следует добавить дополнительные сетевые адаптеры.

-   Если рабочая нагрузка интенсивно хранилища, вы включите виртуальную архитектуру NUMA и добавить дополнительные виртуальные диски.

Если **Hyper-V низкоуровневая оболочка корневой виртуальный процессор (корневой вице-президент по x)\\% общего времени выполнения** счетчика превышает 90% для некоторых, но не для всех виртуальных процессоров и **процессоров (x)\\% времени прерываний и Процессор (x)\\% времени DPC** счетчика приблизительно складывает значению для **Processor(Root VP x) виртуальный корневой\\% общего времени выполнения** счетчика, следует убедиться, включить очередь виртуальных МАШИН на сетевые адаптеры.

## <a name="memory-bottlenecks"></a>Узкие места в памяти

Ниже приведены некоторые распространенные сценарии, которые могут привести к памяти.

-   Узел не отвечает.

-   Не удалось запустить виртуальные машины.

-   Виртуальные машины работать не хватает памяти.

Можно использовать следующие счетчики производительности на узле:

-   Память\\"Доступно МБ"

-   Балансировщик динамической памяти Hyper-V (\*)\\доступной памяти

Можно использовать следующие счетчики производительности из виртуальной машины:

-   Память\\"Доступно МБ"

Если **памяти\\"Доступно МБ"** и **балансировщик динамической памяти Hyper-V (\*)\\доступной памяти** счетчики не хватает на узле, следует остановить Необязательные служб и перенесите одну или несколько виртуальных машин на другой узел.

Если **памяти\\"Доступно МБ"** счетчика слишком мало на виртуальной машине, следует выделить больше памяти для виртуальной машины. При использовании динамической памяти, вам следует увеличить максимальный объем памяти.

## <a name="network-bottlenecks"></a>Узкие места сети

Ниже приведены некоторые распространенные сценарии, которые могут стать причиной узких мест сети.

-   Узел представляет привязан сети.

-   Виртуальная машина находится в сети привязан.

Можно использовать следующие счетчики производительности на узле:

-   Сетевой интерфейс (*имя сетевого адаптера*)\\байт/с

Можно использовать следующие счетчики производительности из виртуальной машины:

-   Hyper-V виртуального сетевого адаптера (*имя виртуальной машины имя&lt;GUID&gt;*)\\байт/с

Если **физический сетевой Адаптер, байт/с** счетчика больше или равно 90% от мощности, следует добавить дополнительные сетевые адаптеры, перенос виртуальных машин на другой узел и настройка параметров качества обслуживания сети.

Если **Hyper-V виртуального сетевого адаптера, байт/с** счетчика больше или равно 250 Мбит/с, вы должны добавить дополнительные объединенные сетевые адаптеры на виртуальной машине, включите vRSS и использовать SR-IOV.

Если рабочие нагрузки не может обеспечить соблюдение задержки в сети, включите SR-IOV, для предоставления ресурсов для физических сетевых адаптеров на виртуальную машину.

## <a name="storage-bottlenecks"></a>Узкие места хранения

Ниже приведены некоторые распространенные сценарии, которые могут стать причиной узких мест в хранилище.

-   Узла и виртуальной машины, выполнения операций медленным, или истекло время ожидания.

-   Виртуальная машина будет низкой производительностью.

Можно использовать следующие счетчики производительности на узле:

-   Физический диск (*букву диска*)\\Средняя чтения с диска

-   Физический диск (*букву диска*)\\Средняя сек время записи на диск

-   Физический диск (*букву диска*)\\длина очереди чтения диска Avg.

-   Физический диск (*букву диска*)\\диск Средняя длина очереди записи

Если значения задержки постоянно больше 50 мс, следует сделайте следующее:

-   Распределить виртуальные машины по дополнительное хранилище

-   Рассмотрите возможность приобретения более быстрое хранилище

-   Рассмотрим многоуровневый дисковых пространств, которая была введена в Windows Server 2012 R2

-   Рассмотрите возможность использования качества обслуживания хранилища, которая была введена в Windows Server 2012 R2

-   Использовать VHDX

## <a name="see-also"></a>См. также

-   [Терминологии Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Конфигурация сервера Hyper-V](configuration.md)

-   [Производительность процессора Hyper-V](processor-performance.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Хранилище Hyper-V производительность ввода-вывода](storage-io-performance.md)

-   [Сети Hyper-V производительность ввода-вывода](network-io-performance.md)

-   [Виртуальные машины Linux](linux-virtual-machine-considerations.md)
