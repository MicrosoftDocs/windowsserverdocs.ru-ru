---
title: Обнаружение узких мест в виртуализированной среде
description: Обнаружение и устранение потенциальных узких мест производительности Hyper-v
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: asmahi; sandysp; jopoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 211f35c151e94bc8b8a11a614edad18053cb18b9
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80851785"
---
# <a name="detecting-bottlenecks-in-a-virtualized-environment"></a>Обнаружение узких мест в виртуализированной среде

В этом разделе вы узнаете о том, что следует отслеживать с помощью системного монитора, и как определить, где проблема может быть вызвана тем, что узел или некоторые виртуальные машины не выполняются так, как ожидалось.

## <a name="processor-bottlenecks"></a>Узкие места процессора

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в работе процессора:

-   Загружен один или несколько логических процессоров

-   Загружен один или несколько виртуальных процессоров

С узла можно использовать следующие счетчики производительности:

-   Использование логического процессора — \\логический процессор гипервизора Hyper-V (\*)\\% общего времени выполнения

-   Использование виртуального процессора — \\виртуального процессора гипервизора Hyper-V (\*)\\% общего времени выполнения

-   Использование корневого виртуального процессора. \\корневой виртуальный процессор гипервизора Hyper-V (\*)\\% общего времени выполнения

Если **логический процессор гипервизора Hyper-V (\_всего)\\% всего времени выполнения** превышает 90%, узел перегружен. Необходимо добавить дополнительные вычислительные мощности или переместить некоторые виртуальные машины на другой узел.

Если **виртуальный процессор гипервизора Hyper-V (имя виртуальной машины: вице-президент x)\\% общего счетчика времени выполнения** превышает 90% для всех виртуальных процессоров, необходимо выполнить следующие действия.

-   Убедитесь, что узел не перегружен

-   Узнайте, может ли Рабочая нагрузка использовать больше виртуальных процессоров

-   Назначение виртуальной машине дополнительных виртуальных процессоров

Если **виртуальный процессор гипервизора Hyper-V (имя виртуальной машины: вице-президент x)\\% общего счетчика времени выполнения** превышает 90% для некоторых, но не всех виртуальных процессоров, необходимо выполнить следующие действия.

-   Если Рабочая нагрузка получает ресурсоемкий доступ к сети, следует рассмотреть возможность использования vRSS.

-   Если виртуальные машины не работают под Windows Server 2012 R2, следует добавить дополнительные сетевые адаптеры.

-   Если Рабочая нагрузка требует большого объема хранилища, необходимо включить виртуальную архитектуру NUMA и добавить дополнительные виртуальные диски.

Если **корневой виртуальный процессор гипервизора Hyper-V (root вице-президент x)\\% общего времени выполнения** превышает 90% для некоторых, но не все виртуальные процессоры и **процессор (x)\\% времени прерываний и процессора (x)\\% времени DPC** , приблизительно соответствуют значению для **корневого виртуального процессора (root вице-президент x)\\% Total** , необходимо включить VMQ на сетевых адаптерах.

## <a name="memory-bottlenecks"></a>Узкие места в памяти

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в памяти:

-   Узел не отвечает.

-   Не удается запустить виртуальные машины.

-   Недостаточно памяти на виртуальных машинах.

С узла можно использовать следующие счетчики производительности:

-   Объем доступной памяти\\МБ

-   Балансировщик динамическая память Hyper-V (\*)\\доступной памяти

На виртуальной машине можно использовать следующие счетчики производительности:

-   Объем доступной памяти\\МБ

Если **объем доступной памяти\\МБ** и **балансировщик динамическая память Hyper-V (\*\\)** не хватает на узле, следует приостанавливаться к необязательным службам и перенести одну или несколько виртуальных машин на другой узел.

Если значение счетчика " **память\\доступно МБ** " мало в виртуальной машине, следует назначить виртуальной машине больше памяти. При использовании динамическая память следует увеличить значение параметра Максимальный объем памяти.

## <a name="network-bottlenecks"></a>Узкие места в сети

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в сети.

-   Узел привязан к сети.

-   Виртуальная машина привязана к сети.

С узла можно использовать следующие счетчики производительности:

-   Сетевой интерфейс (*имя сетевого адаптера*)\\байт/с

На виртуальной машине можно использовать следующие счетчики производительности:

-   Виртуальный сетевой адаптер Hyper-V (имя*виртуальной машины&lt;GUID&gt;* )\\байт/с

Если счетчик " **байт физической сетевой карты/сек** " больше или равен 90% емкости, необходимо добавить дополнительные сетевые адаптеры, выполнить миграцию виртуальных машин на другой узел и настроить сетевое качество обслуживания.

Если значение счетчика " **байт/сек" виртуального сетевого адаптера Hyper-V** превышает или равно 250 Мбит/с, необходимо добавить дополнительные объединенные сетевые адаптеры в виртуальную машину, включить vRSS и использовать SR-IOV.

Если рабочие нагрузки не могут удовлетворить их задержки в сети, включите SR-IOV для представления физических ресурсов сетевого адаптера виртуальной машине.

## <a name="storage-bottlenecks"></a>Узкие места в хранилище

Ниже приведены некоторые распространенные сценарии, которые могут вызвать узкие места в хранилище.

-   Операции узла и виртуальной машины выполняются с задержкой или временем ожидания.

-   Виртуальная машина медленно работает.

С узла можно использовать следующие счетчики производительности:

-   Физический диск (*буква диска*)\\среднее время чтения с диска (сек.) "

-   Физический диск (*буква диска*)\\СР. время записи на диск (сек.) "

-   Физический диск (*буква диска*)\\средняя длина очереди чтения диска

-   Физический диск (*буква диска*)\\средняя длина очереди записи на диск

Если задержки постоянно превышают 50 мс, следует выполнить следующие действия.

-   Распределение виртуальных машин по дополнительному хранилищу

-   Рассмотрите возможность приобретения более быстрого хранилища

-   Рассмотрите возможность использовать многоуровневые дисковые пространства, появившиеся в Windows Server 2012 R2

-   Рассмотрите возможность использования качества обслуживания хранилища, которое было представлено в Windows Server 2012 R2

-   Использовать VHDX

## <a name="see-also"></a>См. также:

-   [Терминология Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Конфигурация сервера Hyper-V](configuration.md)

-   [Производительность процессоров Hyper-V](processor-performance.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Производительность ввода-вывода хранилища Hyper-V](storage-io-performance.md)

-   [Производительность ввода-вывода сети Hyper-V](network-io-performance.md)

-   [Виртуальные машины Linux](linux-virtual-machine-considerations.md)
