---
title: Производительность хранилища Hyper-V ввода-вывода
description: Вопросы производительности операций ввода-вывода хранилища в настройке производительности Hyper-V
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: Asmahi; SandySp; JoPoulso
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: fedc23083914bcf97a8cde12b78c0b174143de25
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59831315"
---
# <a name="hyper-v-storage-io-performance"></a>Производительность хранилища Hyper-V ввода-вывода

В этом разделе описываются различные варианты и рекомендации по настройке хранилища производительность ввода-вывода на виртуальной машине. Пути ввода-вывода хранилища расширяет из стека хранилища гостя, через уровень виртуализации узла, узел стека хранилища, а затем на физический диск. Ниже приведены пояснения о том, как оптимизация возможны на каждом из этих этапов.

## <a name="virtual-controllers"></a>Виртуальные контроллеры

Hyper-V предоставляет три типа виртуальных контроллеров: IDE, SCSI и виртуальные адаптеры шины (HBA).

## <a name="ide"></a>IDE

Контроллеры IDE предоставляют IDE-диски к виртуальной машине. Эмулируется контроллер IDE, и это единственный контроллер, которая доступна для гостевых виртуальных машин под управлением более ранней версии Windows без служб интеграции виртуальной машины. Дисковый ввод-вывод, который выполняется с помощью драйвера фильтра интегрированной среды разработки, который предоставляется с помощью служб интеграции виртуальной машины значительно лучше, чем производительность ввода-вывода, который входит в состав לףכטנמגאםםי ךמםענמככונ IDE диска. Мы рекомендуем использования IDE-диски только для дисков операционной системы из-за наличия ограничения производительности из-за максимальный размер ввода-вывода, выполняемые на этих устройствах.

## <a name="scsi-sas-controller"></a>SCSI (SAS-контроллера)

Контроллеры SCSI предоставлять SCSI-дисков к виртуальной машине, и каждый виртуальный SCSI-контроллер поддерживает до 64 устройств. Для обеспечения оптимальной производительности рекомендуется подключить несколько дисков в единый виртуальный SCSI-контроллер и создать дополнительные контроллеры только в том случае, когда они требуются для масштабирования количество дисков, подключенных к виртуальной машине. Не эмулируется путь SCSI, что делает его основной контроллер для любого диска, отличном от диска операционной системы. На самом деле с виртуальных машин поколения 2, это единственный тип контроллера возможных. Представленный в Windows Server 2012 R2, данный контроллер сообщается как SAS для поддержки общий диск VHDX.

## <a name="virtual-fibre-channel-hbas"></a>Адаптеры шины виртуального адаптера Fibre Channel

Можно настроить адаптеры шины виртуального адаптера Fibre Channel для прямого доступа для виртуальных машин для Fibre Channel и Fibre Channel через Ethernet (FCoE) LUN. Диски виртуального адаптера Fibre Channel обхода в файловой системе NTFS, в корневом разделе, что снижает загрузку ЦП, ввода-вывода хранилища.

Большие объемы данных и дисками, которые являются общими между несколькими виртуальными машинами (для кластеризации гостевых систем сценариев) являются основными кандидатами для виртуальных дисков Fibre Channel.

Виртуальный адаптер Fibre Channel дисков требуется один или несколько Fibre Channel адаптеров шины (HBA), должны быть установлены на узле. Каждый узел адаптера ШИНЫ, должен использовать драйвер адаптера ШИНЫ, который поддерживает возможности Windows Server 2016 виртуального адаптера Fibre Channel/NPIV. В инфраструктуре сети SAN должны поддерживать NPIV, и следует настроить порты адаптера ШИНЫ, которые используются для виртуального адаптера Fibre Channel в топологии Fibre Channel, которая поддерживает NPIV.

Для повышения пропускной способности на узлах, которые устанавливаются вместе с более чем одного адаптера ШИНЫ, мы рекомендуем настроить несколько виртуальных адаптеров шины на виртуальной машине Hyper-V (до четырех адаптеров шины может быть конфигурации для каждой виртуальной машины). Hyper-V автоматически сделает максимум усилий, чтобы сбалансировать виртуальные адаптеры шины систем для адаптеров шин узлов, которые обращаются к одной и той же виртуальной сети SAN.

## <a name="virtual-disks"></a>Виртуальные диски

Диски могут предоставляться к виртуальным машинам через виртуальные контроллеры. Эти диски может быть виртуальные жесткие диски, которые являются абстракции файл диска или транзитный диск на узле.

## <a name="virtual-hard-disks"></a>Виртуальные жесткие диски

Существует два формата виртуального жесткого диска VHD и VHDX. Каждая из этих форматов поддерживает три типа файлов виртуального жесткого диска.

## <a name="vhd-format"></a>Формат виртуального жесткого диска

Формат виртуального жесткого диска был формат единственный виртуальный жесткий диск, который участвовал в поддерживаемой Hyper-V в прошлых выпусках. Представленный в Windows Server 2012, в формат VHD был изменен разрешающее улучшено выравнивание, что приводит к значительно повысить производительность на новые диски с большими секторами.

Любой нового виртуального жесткого диска, который создается в Windows Server 2012 или более поздней версии имеет оптимальную выравнивание 4 КБ. Этот формат выровненные полностью совместим с предыдущими операционными системами Windows Server. Тем не менее свойство выравнивания будет невозможно для новых выделений из средства синтаксического анализа, которые находятся не на 4 КБ выравнивания с поддержкой, например (виртуальный жесткий ДИСК средство синтаксического анализа из предыдущей версии Windows Server) или средство синтаксического анализа сторонних производителей.

Любой виртуальный жесткий ДИСК, которые перемещаются из предыдущего выпуска не автоматически преобразуется в этот новый улучшенный формат виртуального жесткого диска.

Чтобы преобразовать в новый формат виртуального жесткого диска, выполните следующую команду Windows PowerShell:

``` syntax
Convert-VHD –Path E:\vms\testvhd\test.vhd –DestinationPath E:\vms\testvhd\test-converted.vhd
```

Можно проверить свойство выравнивание для всех виртуальных жестких дисков в системе, и он должны быть преобразованы в оптимальной выравнивание 4 КБ. Создание нового виртуального жесткого диска с данными из исходного виртуального жесткого диска с помощью **создать из источника** параметр.

Чтобы проверить наличие выравнивание с помощью Windows Powershell, изучите выравнивания строки, как показано ниже:

``` syntax
Get-VHD –Path E:\vms\testvhd\test.vhd

Path                    : E:\vms\testvhd\test.vhd
VhdFormat               : VHD
VhdType                 : Dynamic
FileSize                : 69245440
Size                    : 10737418240
MinimumSize             : 10735321088
LogicalSectorSize       : 512
PhysicalSectorSize      : 512
BlockSize               : 2097152
ParentPath              :
FragmentationPercentage : 10
Alignment               : 0
Attached                : False
DiskNumber              :
IsDeleted               : False
Number                  :
```

Проверка выравнивание с помощью Windows PowerShell, изучите выравнивания строки, как показано ниже:

``` syntax
Get-VHD –Path E:\vms\testvhd\test-converted.vhd

Path                    : E:\vms\testvhd\test-converted.vhd
VhdFormat               : VHD
VhdType                 : Dynamic
FileSize                : 69369856
Size                    : 10737418240
MinimumSize             : 10735321088
LogicalSectorSize       : 512
PhysicalSectorSize      : 512
BlockSize               : 2097152
ParentPath              :
FragmentationPercentage : 0
Alignment               : 1
Attached                : False
DiskNumber              :
IsDeleted               : False
Number                  :
```

## <a name="vhdx-format"></a>Формат VHDX

VHDX — это новый формат виртуального жесткого диска, появившихся в Windows Server 2012, которая позволяет создавать устойчивых высокой производительности виртуальные диски емкостью до 64 терабайт. Преимущества этого формата:

-   Поддержка емкость виртуального жесткого диска до 64 терабайт.

-   Защита от повреждения данных во время сбоев питания за счет журналирования обновлений в структурах метаданных VHDX.

-   Возможность сохранять пользовательские метаданные о файле, который пользователь может потребоваться записать, такие как версия операционной системы или примененных обновлениях.

Формат VHDX также обеспечивает следующие преимущества производительности:

-   Лучшее выравнивание формата виртуального жесткого диска обеспечивает работу с дисками, имеющими сектора большого размера.

-   Увеличенный размер блока для динамических и разностных дисков позволяет дискам подстраиваться с учетом потребностей рабочей нагрузки.

-   Виртуальный диск логического сектора 4 КБ, которое обеспечивает повышенную производительность при использовании приложениями и рабочими нагрузками, рассчитанными секторов 4 КБ.

-   Эффективность представления данных, который приводит к размер файла и позволяет физическому устройству хранения использовать неиспользованное пространство. (Trim требуется сквозная или диски SCSI и оборудования, совместимого с trim.)

При обновлении до Windows Server 2016, рекомендуется преобразовать все VHD-файлы в формате VHDX, из-за этих преимуществ. Единственный сценарий, где смысл сохранить файлы в формате VHD при виртуальной машины может переместиться к предыдущей версии Hyper-v, который не поддерживает формат VHDX.

## <a name="types-of-virtual-hard-disk-files"></a>Типы файлов виртуального жесткого диска

Существует три типа файлов VHD. Ниже приведены характеристики производительности и компромиссы между этими типами.

Следующие рекомендации следует учитывать в зависимости от того, Выбор типа файла виртуального жесткого диска:

-   При использовании формата виртуального жесткого диска, рекомендуется использовать фиксированный тип, поскольку она имеет лучшую устойчивость и характеристики производительности по сравнению с других типов файлов виртуального жесткого диска.

-   При использовании формата VHDX, мы рекомендуем использовать динамический тип, так как он обеспечивает устойчивость экономию места благодаря выделению пространства только в том случае, когда требуется, чтобы сделать это.

-   Фиксированный тип также рекомендуется, независимо от формата, когда хранилища на томе размещения не ведется активно для обеспечения достаточно места на диске при расширении файла VHD во время выполнения.

-   Создание моментальных снимков виртуальной машины разностного виртуального жесткого диска для хранения записи на диски. Только несколько моментальных снимков может не заметно повысить ЦП для хранения операций ввода-вывода, но может повлиять на производительность за исключением в рабочих нагрузок сервера высокой ввода-вывода. Тем не менее длинная цепочка моментальных снимков может заметно повлиять на производительность, так как чтение из виртуального жесткого диска может потребовать проверки запрошенных блоков на многих разностных виртуальных жестких дисков. Сохранение короткие цепочки моментальных снимков для обеспечения хорошей диск производительность ввода-вывода.

## <a name="fixed-virtual-hard-disk-type"></a>Исправлена тип виртуального жесткого диска

Пространство виртуального жесткого диска выделяется во-первых, при создании файла виртуального жесткого диска. Этот тип файла виртуального жесткого диска является вряд ли fragment, что снижает пропускную способность ввода-вывода при одной операции ввода-вывода разбивается на несколько операций ввода-вывода. Он имеет низкий нагрузку на ЦП из трех типов файла виртуального жесткого диска, так как операции чтения и записи устраняет необходимость поиска в сопоставлении блока.

## <a name="dynamic-virtual-hard-disk-type"></a>Тип динамического виртуального жесткого диска

Пространство виртуального жесткого диска выделяется по запросу. Блоки на диске как нераспределенный блоки начисление платы не дополняются фактическое место в файле. При первом блок записи, стек виртуализации необходимо выделить пространство в файле виртуального жесткого диска для блока и затем обновлять метаданные. Это увеличивает количество операций ввода-вывода диске для записи и повышает загрузку ЦП. Считывает и операции записи для существующих блоков создают доступ к диску и нагрузку на ЦП, при поиске блоков-мишеней сопоставления в метаданных.

## <a name="differencing-virtual-hard-disk-type"></a>Тип разностного виртуального жесткого диска

Виртуальный жесткий ДИСК указывает на файл родительского виртуального жесткого диска. Все операции записи к блокам, с последующим получением пространство выделяется в файле виртуального жесткого диска с помощью динамически расширяемый виртуальный жесткий ДИСК не записывается. Операции чтения обслуживаются из VHD-файл, если записи блока. В противном случае они обслуживаются из родительского файла VHD. В обоих случаях для определения соответствия блока чтения метаданных. Считывает и записи в этот виртуальный жесткий ДИСК может потреблять больше ресурсов ЦП и привести операций ввода-вывода, более чем фиксированный VHD-файла.

## <a name="block-size-considerations"></a>Рекомендации по выбору размера блока

Размер блока может значительно повлиять на производительность. Он является оптимальным в соответствии с размером блока к шаблонам распределения рабочей нагрузки, использующую диск. Например если приложение является выделение блоками по 16 МБ, было бы оптимальной будет иметь размер блока виртуального жесткого диска составляет 16 МБ. Размер блока в &gt;2 МБ возможна только для виртуальных жестких дисков в формате VHDX. Наличие блоков большего размера, чем шаблон распределения для случайных операций ввода-вывода рабочей нагрузки значительно увеличит использование пространства на узле.

## <a name="sector-size-implications"></a>Последствия размер сектора

Большая часть отрасль программного обеспечения зависят от дисковых секторов размером 512 байт, но стандартный перемещается в секторы диска на 4 КБ. Чтобы сократить проблемы совместимости, которые могут возникнуть из-за изменения размера сектора, поставщики жестких дисков Представляем transitional размер, называется 512 эмуляции дисков (512e).

Эти диски эмуляции предлагают некоторые преимущества, предлагаемые 4 КБ сектора собственного дисков, такие как улучшенная эффективность форматирования и улучшенная схема для кодов исправлений ошибок (ECC). Они поставляются с возникает меньше проблем совместимости, которые произошли бы, предоставляя размером сектора 4 КБ уровне дискового интерфейса.

## <a name="support-for-512e-disks"></a>Поддержка дисков 512e

Дисков 512e могут выполнять запись только в смысле физических секторов, то есть не удалось произвести запись непосредственно на сектор размером 512 байт, выданный его. Внутренний процесс на диске, который делает возможным такие попытки записи включает следующие шаги.

-   Диск считывает физический сектор размером 4 КБ для внутренний кэш, который содержит 512-байтный логический сектор, упоминаемый в записи.

-   Данные в буфере размером 4 КБ изменяются так, чтобы содержать обновленные 512-байтные сектора.

-   Диск выполняет операцию записи обновленного Четырехкилобайтного буфера назад на физический сектор на диске.

Этот процесс называется чтения, изменения и записи (RMW). Общее влияние на производительность процесс RMW зависит от рабочей нагрузки. Процесс RMW приводит к снижению производительности виртуальных жестких дисков по следующим причинам:

-   Динамических и разностных виртуальных жестких дисков имеют 512-байтового сектора их полезных данных. Кроме того нижний колонтитул, заголовок и указатели родительского выровнять 512-байтового сектора. Довольно часто для записи 512-байтовых команды, чтобы обновить эти структуры, описанный ранее процесс RMW приводит к драйвера виртуального жесткого диска.

-   Приложения часто проблема считывает и записывает кратно размером 4 КБ (по умолчанию размер кластера NTFS). Так как отсутствует 512-байтового сектора блок данных из динамических и разностных виртуальных жестких дисков, блоки по 4 КБ не соответствуют физической границе в 4 КБ. На следующем рисунке показана блок VHD 4 КБ (выделено) то есть не согласована с физической границе в 4 КБ.

![блок VHD 4 КБ](../../media/perftune-guide-vhd-4kb-block.png)

Каждая команда записи 4 КБ, выданный текущее средство синтаксического анализа для обновления полезных данных приводит две операции чтения для двух блоков на диске, которые затем обновляются и записываются обратно на два дисковых блока. Hyper-V в Windows Server 2016 позволяет уменьшить влияние на производительность на дисках 512e в стеке виртуального жесткого диска путем подготовки ранее упомянутых структур для выравнивания границами в 4 КБ в формате VHD. Это позволяет избежать эффекта RMW при доступе к данным в файле виртуального жесткого диска и при обновлении структур метаданных виртуального жесткого диска.

Как упоминалось ранее, виртуальные жесткие диски, которые копируются из предыдущих версий Windows Server будет в не выровнен по 4 КБ. Можно вручную преобразовать их оптимально выравнивание с помощью **копирования из источника** параметр, который доступен в интерфейсах виртуального жесткого диска на диске.

По умолчанию виртуальные жесткие диски, предоставляются с физический сектор размером 512 байт. Это позволяет убедиться, что физический сектор размером зависимые приложения не затрагиваются при перемещении приложения и виртуальные жесткие диски из предыдущей версии Windows Server.

По умолчанию диски в формате VHDX создаются с размер физического сектора 4 КБ для оптимизации их производительности профиля обычных дисков и дисках с большими секторами. Для полноценного использования сектора 4 КБ рекомендуется использовать формат VHDX.

## <a name="support-for-native-4kb-disks"></a>Поддержка собственных дисков 4 КБ

Hyper-V в Windows Server 2012 R2 и более поздних версий поддерживает 4 КБ собственных дисков. Но это по-прежнему можно хранить диск VHD на диске собственного 4 КБ. Это делается путем реализации программного обеспечения RMW алгоритм на уровне стека виртуального хранилища, который преобразует 512-байтовых доступа и обновления запросы в соответствующий 4 КБ, доступа и обновления.

Так как VHD-файл можно предоставлять только сами как диски размер логического сектора 512 байт, очень вероятно, что будут приложения, которые создают запросы ввода-вывода 512 байт. В этих случаях на уровне RMW удовлетворения этих запросов и привести к снижению производительности. Это также справедливо для диска, который представляется в формате VHDX, который имеет размер логического сектора 512 байт.

Это можно настроить vhdx-файл в качестве диска размер логического сектора 4 КБ, и это было бы оптимальной конфигурации для повышения производительности при размещении диска на собственном физическом устройстве 4 КБ. Для копирования гостевой ОС и приложения, использующего виртуальный диск с логическими секторами размером 4 КБ следует соблюдать осторожность. VHDX форматирование будет работать на устройстве размер логического сектора 4 КБ.

## <a name="pass-through-disks"></a>Транзитные диски

Виртуальный жесткий ДИСК на виртуальной машине может быть сопоставлен непосредственно на физический диск или логический номер устройства (LUN), а не файл виртуального жесткого диска. Преимущество в том, что эта конфигурация обходит в файловой системе NTFS, в корневом разделе, что снижает загрузку ЦП, ввода-вывода хранилища. Риск использования — физических дисков или LUN может оказаться сложнее перемещаются между компьютерами, чем файлы виртуального жесткого диска.

Транзитные диски следует избегать из-за ограничения, возникающие в рамках сценариев миграции виртуальной машины.

## <a name="advanced-storage-features"></a>Расширенные возможности хранения

### <a name="storage-quality-of-service-qos"></a>Качество обслуживания хранилища

Начиная с Windows Server 2012 R2, Hyper-V включает возможность устанавливать определенные параметры качества обслуживания (QoS), для хранилищ на виртуальных машинах. Качество обслуживания хранилища обеспечивает его изоляцию в мультитенантной среде и механизмы для уведомления в случае, если производительность ввода-вывода хранилища не соответствует установленному уровню, необходимому для эффективного выполнения рабочей нагрузки на виртуальных машинах.

Качество обслуживания хранилища позволяет указать максимальное количество операций ввода-вывода в секунду (IOPS) для виртуального жесткого диска. Администратор может отрегулировать вводы-выводы хранилища таким образом, чтобы потребление ресурсов хранилища одним клиентом не отражалось на другом.

Можно также задать минимальное значение IOPS. В этом случае он получит уведомление, если IOPS на указанном виртуальном диске опустится ниже порога, необходимого для оптимальной работы устройства.

При этом также обновляется инфраструктура метрики виртуальной машины и параметры хранилища, что позволяет администратору отслеживать производительность и параметры, связанные с возвратом платежей.

Максимальное и минимальное значения указываются относительно нормализованного значения IOPS, где каждые 8 КБ данных составляют одну операцию ввода-вывода.

Некоторые ограничения, как показано ниже:

-   Только для виртуальных дисков

-   Разностный диск не может иметь родительского виртуального диска на другой том

-   Реплика — качества обслуживания для узла реплики настроены отдельно от первичного сайта

-   Общий диск VHDX не поддерживается.

Дополнительные сведения о качестве обслуживания хранилища см. в разделе [качества обслуживания хранилища для Hyper-V](https://technet.microsoft.com/library/dn282281.aspx).

### <a name="numa-io"></a>NUMA ВВОДА-ВЫВОДА

Windows Server 2012 и не только поддерживает большие виртуальные машины и все конфигурации виртуальных машин (например, конфигурация с Microsoft SQL Server под управлением с 64 виртуальными процессорами) также потребуется масштабирование с точки зрения пропускной способности ввода-вывода.

Следующие основные улучшения, впервые представленный в стек хранилища Windows Server 2012 и Hyper-V обеспечивают потребности масштабируемость ввода-вывода больших виртуальных машин:

-   Увеличение числа каналов связи, созданные между гостевой устройств и стек хранилища узла.

-   Более эффективный механизм завершения ввода-вывода, с участием прерываний распределение виртуальных процессоров, избежать ресурсоемких interprocessor прерывания работы.

Представленный в Windows Server 2012, существует ряд записей реестра, расположенный в HKLM\\системы\\CurrentControlSet\\перечисления\\VMBUS\\{идентификатор устройства}\\{идентификатор экземпляра}\\StorChannel, позволяющие число каналов, следует изменить. Они также выровнять виртуальных процессоров, которые обрабатывают завершения ввода/вывода для виртуальных ЦП, назначенных для быть процессоров ввода-вывода приложения. Параметры реестра настроены на основе каждого адаптера на ключ оборудования устройства.

-   **ChannelCount (DWORD)** общее число каналов для использования с максимальным размером 16. По умолчанию задает максимальное число виртуальных процессоров и 16.

-   **ChannelMask (QWORD)** сходство процессоров для каналов. Если он не задан или имеет значение 0, по умолчанию используется существующий канал распространения алгоритм, который вы используете обычное хранилище или сетевым каналам. Это гарантирует, что каналы хранилища не конфликтует с вашей сетевым каналам.

### <a name="offloaded-data-transfer-integration"></a>Прямая интеграция передачи данных

Важнейшие задачи технического обслуживания для виртуальных жестких дисков, такие как слияние, переместить и сжатие, зависят от копирования больших объемов данных. Текущий метод копирования данных требует, чтобы чтение и запись данных производились в различные местоположения, что может занимать много времени. Он также использует ресурсы ЦП и памяти на узле, который мог бы использоваться для службы виртуальных машин.

Поставщики решений сети хранения данных (SAN) работают над обеспечением почти мгновенных операций копирования больших объемов данных. Это хранилище позволяет системе, находящейся выше дисков, чтобы задавать параметры перемещения конкретного набора данных из одного расположения в другое. Эта функция оборудования называется передачи разгруженных данных.

Hyper-V в Windows Server 2012 и более поздних версий поддерживает операции Offload Data Transfer (ODX), таким образом, эти операции можно передать из гостевой операционной системе серверного оборудования. Это гарантирует, что же, как если бы оно было запущено в среде без виртуализации, рабочая нагрузка может использовать хранения с поддержкой ODX. Стек хранилища Hyper-V также выдает ODX операций во время операций обслуживания для виртуальных жестких дисков такими, как слияние дисков и хранилища мета операции миграции где перемещаются большие объемы данных.

### <a name="unmap-integration"></a>Отмена сопоставления интеграции

Файлы виртуального жесткого диска существуют как файлы на томе хранилища, и они совместно используют доступное пространство с другими файлами. Так как размер этих файлов имеет тенденцию быть большим, пространство, занимаемое массивом быстрому росту. Потребность в более физического хранилища, влияет на ИТ-бюджета оборудования. Очень важно оптимизировать использование физического хранилища насколько это возможно.

До Windows Server 2012 когда приложения удаляют содержимого в виртуальный жесткий диск, который фактически прервана содержимого дисковое пространство, стек хранилища Windows в операционной системе и на узле Hyper-V было ограничения, которые не позволяли это сведения из передаваемых виртуального жесткого диска и устройства физического хранилища. Это запрещено стек хранилища Hyper-V оптимизации места, занятого файлов виртуального диска на основе виртуального жесткого диска. Он также не запоминающее устройство освобождение дискового пространства, которое ранее было занято удаленные данные.

Начиная с Windows Server 2012, Hyper-V поддерживает отменить сопоставление уведомления, которые позволяют vhdx-файлы для повышения эффективности при представлении эти данные в ней. Это приводит к меньшего размера файлов и позволяет физическому устройству хранения использовать неиспользованное пространство.

Только Hyper v, появляющихся SCSI, работающими с интегрированной среды разработки, а виртуального адаптера Fibre Channel контроллеры принимать команды операций unmap от гостевой до стека виртуального хранилища узла. Для виртуальных жестких дисков в формате VHDX поддерживает только виртуальные диски отменить сопоставление команд из гостевой ОС.

По этим причинам рекомендуется использовать vhdx-файлы, подключенные к контроллеру SCSI, без использования виртуального адаптера Fibre Channel дисков.

## <a name="see-also"></a>См. также

-   [Терминологии Hyper-V](terminology.md)

-   [Архитектура Hyper-V](architecture.md)

-   [Конфигурация сервера Hyper-V](configuration.md)

-   [Производительность процессора Hyper-V](processor-performance.md)

-   [Производительность памяти Hyper-V](memory-performance.md)

-   [Сети Hyper-V производительность ввода-вывода](network-io-performance.md)

-   [Обнаружение узких мест в виртуализованной среде](detecting-virtualized-environment-bottlenecks.md)

-   [Виртуальные машины Linux](linux-virtual-machine-considerations.md)
