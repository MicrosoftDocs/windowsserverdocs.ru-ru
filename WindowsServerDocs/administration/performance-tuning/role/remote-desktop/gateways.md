---
title: Шлюзы удаленный рабочий стол настройки производительности
description: Рекомендации по настройке производительности для шлюзов удаленный рабочий стол
ms.topic: article
ms.author: hammadbu; vladmis
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 8aeaf524b3621c61cfdd6b0e4edd9d0f8f73ebae
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87896050"
---
# <a name="performance-tuning-remote-desktop-gateways"></a>Шлюзы удаленный рабочий стол настройки производительности

> [!NOTE]
> В Windows 8 + и Windows Server 2012 R2 + шлюз удаленный рабочий стол (шлюз удаленных рабочих столов) поддерживает TCP, UDP и устаревшие транспорта RPC. Большая часть следующих данных касается устаревшего транспорта RPC. Если устаревший транспорт RPC не используется, этот раздел неприменим.

В этом разделе описаны параметры, связанные с производительностью, которые помогают повысить производительность развертывания клиента и настройки, зависящие от особенностей использования сети клиентом.

По сути, шлюз удаленных рабочих столов выполняет множество операций пересылки пакетов между экземплярами подключение к удаленному рабочему столу и экземплярами сервера узла сеансов удаленных рабочих столов в сети клиента.

> [!NOTE]
> Следующие параметры применяются только к транспорту RPC.

Службы IIS (IIS) и шлюз удаленных рабочих столов экспортируйте следующие параметры реестра, чтобы улучшить производительность системы в шлюзе удаленных рабочих столов.

**Настройка потоков**

-   **MaxIOThreads**

    ``` syntax
    HKLM\Software\Microsoft\Terminal Server Gateway\Maxiothreads (REG_DWORD)
    ```

    Этот пул потоков конкретного приложения определяет количество потоков, создаваемых шлюзом удаленных рабочих столов для обработки входящих запросов. Если этот параметр реестра задан, он вступает в силу. Число потоков равно числу логических процессов. Если число логических процессоров меньше 5, по умолчанию используется 5 потоков.

-   **макспулсреадс**

    ``` syntax
    HKLM\System\CurrentControlSet\Services\InetInfo\Parameters\MaxPoolThreads (REG_DWORD)
    ```

    Этот параметр указывает количество потоков пула IIS, создаваемых для каждого логического процессора. Потоки пула IIS пропускают сеть для запросов и обрабатывают все входящие запросы. Число **макспулсреадс** не включает потоки, потребляемые шлюзом удаленных рабочих столов. Значение по умолчанию — 4.

**Настройка удаленного вызова процедур для шлюза удаленных рабочих столов**

Следующие параметры могут помочь в настройке удаленных вызовов процедур (RPC), полученных подключение к удаленному рабочему столу и компьютерами шлюза удаленных рабочих столов. Изменение окон помогает регулировать объем данных, передаваемых через каждое подключение, и может повысить производительность для сценариев RPC через HTTP v2.

-   **серверрецеивевиндов**

    ``` syntax
    HKLM\Software\Microsoft\Rpc\ServerReceiveWindow (REG_DWORD)
    ```

    Значение по умолчанию — 64 КБ. Это значение указывает окно, используемое сервером для данных, получаемых от прокси-сервера RPC. Минимальное значение равно 8 КБ, а максимальное значение равно 1 ГБ. Если значение не указано, используется значение по умолчанию. При внесении изменений в это значение необходимо перезапустить службы IIS, чтобы изменения вступили в силу.

-   **серверрецеивевиндов**

    ``` syntax
    HKLM\Software\Microsoft\Rpc\ServerReceiveWindow (REG_DWORD)
    ```

    Значение по умолчанию — 64 КБ. Это значение указывает окно, которое клиент использует для данных, получаемых от прокси-сервера RPC. Минимальное значение — 8 КБ, а максимальное значение — 1 ГБ. Если значение не указано, используется значение по умолчанию.

## <a name="monitoring-and-data-collection"></a>Мониторинг и сбор данных

Следующий список счетчиков производительности считается базовым набором счетчиков при мониторинге использования ресурсов на шлюзе удаленных рабочих столов.

-   \\Шлюз службы терминалов\\\*

-   \\Прокси-сервер RPC/HTTP\\\*

-   \\Прокси-сервер RPC/HTTP для каждого сервера\\\*

-   \\Веб-служба\\\*

-   \\W3SVC \_ w3wp\\\*

-   \\IPv4\\\*

-   \\Свободной\\\*

-   \\Сетевой интерфейс ( \* )\\\*

-   \\Процесс ( \* )\\\*

-   \\Сведения о процессоре ( \* )\\\*

-   \\Синхронизация ( \* )\\\*

-   \\Системой\\\*

-   \\TCPv4\\\*

Следующие счетчики производительности применимы только для устаревшего транспорта RPC:

-   \\RPC RPC/HTTP \\ прокси \*

-   \\RPC/HTTP-прокси для \\ каждого сервера \*

-   \\RPC веб-службы \\ \*

-   \\W3SVC \_ w3wp \\ \* RPC

> [!NOTE]
> Если применимо, добавьте \\ \\ \* объекты IPv6 и \\ TCPv6 \\ \* . ReplaceThisText

