---
title: удаленный рабочий стол узлов сеансов для настройки производительности
description: Рекомендации по настройке производительности для узлов сеансов удаленный рабочий стол
ms.prod: windows-server
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: HammadBu; VladmiS; DenisGun
author: phstee
ms.date: 10/22/2019
ms.openlocfilehash: b439b0cbab66f98a1f74faeb7bff996b30a188d5
ms.sourcegitcommit: 3262c5c7cece9f2adf2b56f06b7ead38754a451c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/23/2019
ms.locfileid: "72812328"
---
# <a name="performance-tuning-remote-desktop-session-hosts"></a>удаленный рабочий стол узлов сеансов для настройки производительности


В этом разделе описано, как выбрать оборудование узла сеансов удаленных рабочих столов удаленный рабочий стол, настроить узел и настроить приложения.

**В этом разделе:**

-   [Выбор надлежащего оборудования для повышения производительности](#selecting-the-proper-hardware-for-performance)

-   [Настройка приложений для узла сеансов удаленный рабочий стол](#tuning-applications-for-remote-desktop-session-host)

-   [Параметры настройки узла сеансов удаленный рабочий стол](#remote-desktop-session-host-tuning-parameters)

## <a name="selecting-the-proper-hardware-for-performance"></a>Выбор правильного выбора оборудования для повышения производительности


Для развертывания сервера узла сеансов удаленных рабочих столов выбор оборудования регулируется набором приложений и способом их использования пользователями. Ключевыми факторами, влияющими на количество пользователей и их интерфейсов, являются ЦП, память, диск и графика. В этом разделе приводятся дополнительные рекомендации, относящиеся к серверам узлов сеансов удаленных рабочих столов, которые в основном связаны с многопользовательской средой серверов узлов сеансов удаленных рабочих столов.

### <a name="cpu-configuration"></a>Конфигурация ЦП

Конфигурация ЦП концептуально определяется путем умножения требуемого ЦП для поддержки сеанса по количеству сеансов, которое должна поддерживать система, сохраняя при этом буферную зону для управления временными пиковыми нагрузками. Несколько логических процессоров могут помочь уменьшить аномальные ситуации перегрузки ЦП, которые обычно вызываются несколькими чрезмерно активными потоками, которые содержатся в одинаковом числе логических процессоров.

Таким образом, чем больше логических процессоров в системе, тем меньше поле подкладки должно быть встроено в оценку использования ЦП, что приводит к увеличению процента активной нагрузки на ЦП. Важно помнить, что удвоение количества ЦП не вдвое превышает производительность ЦП.

### <a name="memory-configuration"></a>Конфигурация памяти

Конфигурация памяти зависит от приложений, которые применяются пользователями; Однако требуемый объем памяти можно оценить с помощью следующей формулы: Тоталмем = Осмем + Сессионмем \* NS.

Осмем — это объем памяти, необходимой операционной системе (например, двоичные образы системы, структуры данных и т. д.), Сессионмем — это объем памяти, выполняемой в одном сеансе, а NS — целевое количество активных сеансов. Объем требуемой памяти для сеанса в основном определяется набором ссылок на частную память для приложений и системных процессов, выполняющихся в рамках сеанса. Общий код или страницы данных практически не оказывают влияния, поскольку в системе имеется только одна копия.

Одно интересное наблюдение (при условии, что резервная копия файла подкачки не изменяется) заключается в том, что чем больше число одновременных активных сеансов, поддерживаемых системными планами, тем больше ресурсов памяти для каждого сеанса должно быть. Если объем памяти, выделяемый для каждого сеанса, не увеличивается, количество ошибок страниц, создаваемых активными сеансами, увеличивается с учетом количества сеансов. Эти сбои в конечном итоге перегружают подсистему ввода-вывода. Увеличивая объем памяти, выделяемой для каждого сеанса, вероятность возникновения ошибок на страницах уменьшается, что помогает снизить общую частоту ошибок страниц.

### <a name="disk-configuration"></a>Конфигурация дисков

Хранилище является одним из самых нерекомендуемых аспектов при настройке серверов узлов сеансов удаленных рабочих столов. это может быть самым распространенным ограничением в системах, развернутых в поле.

Активность диска, созданная на обычном сервере узла сеансов удаленных рабочих столов, влияет на следующие области:

-   Системные файлы и двоичные данные приложения

-   Файлы подкачки

-   Профили пользователей и данные пользователя

В идеале эти области должны быть резервными копиями отдельных запоминающих устройств. Использование чередующихся конфигураций RAID или других типов высокопроизводительного хранилища дополнительно повышает производительность. Настоятельно рекомендуется использовать адаптеры хранилища с кэшированием записи со временем на батарею. Контроллеры с кэшированием записи на диск обеспечивают улучшенную поддержку синхронных операций записи. Так как все пользователи имеют отдельный куст, синхронные операции записи значительно более распространены на сервере узла сеансов удаленных рабочих столов. Кусты реестра периодически сохраняются на диск с помощью синхронных операций записи. Чтобы включить эти оптимизации, в консоли управления дисками откройте диалоговое окно **Свойства** для конечного диска, а затем на вкладке **политики** установите флажок **включить кэширование записи на диск** и **отключить буфер записи в кэш Windows. флажок Сброс** на устройстве.

### <a name="network-configuration"></a>конфигурация сети;

Использование сети для сервера узла сеансов удаленных рабочих столов включает две основные категории:

-   Использование трафика для подключения узла сеансов удаленных рабочих столов определяется практически исключительно шаблонами рисования, которые используются приложениями, работающими в сеансах, и трафиком ввода-вывода перенаправленных устройств.

    Например, приложения, обрабатывающие обработку текста и ввод данных, потребляют пропускную способность приблизительно от 10 до 100 килобит в секунду, в то время как насыщенное воспроизведение изображений и видео приводит к значительному увеличению использования пропускной способности.

-   Серверные подключения, такие как перемещаемые профили, доступ приложений к общим папкам, серверы баз данных, серверы электронной почты и серверы HTTP.

    Объем и профиль сетевого трафика относятся к каждому развертыванию.

## <a name="tuning-applications-for-remote-desktop-session-host"></a>Настройка приложений для узла сеансов удаленный рабочий стол


Большая часть загрузки ЦП на сервере узла сеансов удаленных рабочих столов управляется приложениями. Настольные приложения, как правило, оптимизированы для реагирования с целью минимизации времени, затрачиваемого приложением на ответ на запрос пользователя. Однако в серверной среде очень важно снизить общий объем загрузки ЦП, необходимый для выполнения действия во избежание неблагоприятного воздействия на другие сеансы.

При настройке приложений, которые будут использоваться на сервере узла сеансов удаленных рабочих столов, учитывайте следующие рекомендации.

-   Сокращение обработки фонового цикла бездействия

    Типичными примерами являются отключение грамматики в фоновом режиме и проверки орфографии, индексирование данных для поиска и сохранение в фоновом режиме.

-   Сократите, как часто приложение выполняет проверку или обновление состояния.

    Отключение таких поведений или увеличение интервала между опросными итерациями и срабатыванием таймера значительно повышает загрузку ЦП, так как эти действия быстро задействуются для многих активных сеансов. Типичными примерами являются обновления значков состояния подключения и сведения о строке состояния.

-   Минимизируйте состязание за ресурсы между приложениями, уменьшая частоту синхронизации.

    Примерами таких ресурсов являются разделы реестра и файлы конфигурации. Примерами компонентов и компонентов приложений являются индикаторы состояния (например, уведомления оболочки), фоновое индексирование, мониторинг изменений и автономная синхронизация.

-   Отключите ненужные процессы, зарегистрированные для запуска с входом пользователя или запуском сеанса.

    Эти процессы могут значительно влиять на стоимость использования ЦП при создании нового сеанса пользователя, который обычно является ресурсоемким процессом и может быть очень затратным в утром. Используйте MsConfig. exe или MsInfo32. exe для получения списка процессов, запущенных при входе пользователя в систему. Для получения более подробных сведений можно использовать [автозапуски для Windows](https://technet.microsoft.com/sysinternals/bb963902.aspx).

Для использования памяти необходимо учитывать следующее.

-   Убедитесь, что библиотеки DLL, загруженные приложением, не перемещаются.

    -   Повторно расположенные библиотеки DLL можно проверить, выбрав команду обработать представление DLL, как показано на следующем рисунке, с помощью [обозревателя процессов](https://technet.microsoft.com/sysinternals/bb896653.aspx).

    -   Здесь можно увидеть, что файл y. dll был перемещен, так как файл x. dll уже занят базовым адресом по умолчанию, а ASLR не включен.

        ![Перемещенные библиотеки DLL](../../media/perftune-guide-relocated-dlls.png)

        При перемещении библиотек DLL невозможно совместно использовать свой код в сеансах, что значительно увеличивает объем сеанса. Это одна из наиболее распространенных проблем производительности, связанных с памятью на сервере узла сеансов удаленных рабочих столов.

-   Для приложений среды CLR используйте генератор образов в машинном кодах (Ngen. exe), чтобы повысить общий доступ к странице и сократить нагрузку на ЦП.

    По возможности примените аналогичные методы к другим аналогичным механизмам выполнения.

## <a name="remote-desktop-session-host-tuning-parameters"></a>Параметры настройки узла сеансов удаленный рабочий стол


### <a name="page-file"></a>Файл подкачки

Недостаточный размер файла подкачки может вызвать сбои выделения памяти в приложениях или компонентах системы. Счетчик производительности память (байт) можно использовать для отслеживания объема выделенной виртуальной памяти в системе.

### <a name="antivirus"></a>Антивирус

Установка антивирусного по на сервере узла сеансов удаленных рабочих столов значительно влияет на общую производительность системы, особенно на загрузку ЦП. Настоятельно рекомендуется исключить из списка активных наблюдений все папки, содержащие временные файлы, особенно те, которые создаются службами и другими системными компонентами.

### <a name="task-scheduler"></a>Планировщик заданий

Планировщик задач позволяет просмотреть список задач, запланированных для различных событий. Для сервера узла сеансов удаленных рабочих столов полезно сосредоточиться на задачах, настроенных на выполнение в режиме простоя, при входе пользователя или при подключении и отключении сеанса. Из-за особенностей развертывания многие из этих задач могут быть ненужными.

### <a name="desktop-notification-icons"></a>Значки уведомлений рабочего стола

Значки уведомлений на рабочем столе могут иметь довольно дорогостоящие механизмы обновления. Необходимо отключить все уведомления, удалив компонент, регистрирующий их из списка автозагрузки, или изменив конфигурацию в приложениях и компонентах системы, чтобы отключить их. Для просмотра списка уведомлений, доступных на сервере, можно использовать **значки Настройка уведомлений** .

### <a name="remote-desktop-protocol-data-compression"></a>протокол удаленного рабочего стола сжатия данных

Сжатие протокол удаленного рабочего стола можно настроить с помощью групповая политика в разделе **Конфигурация компьютера** &gt; **Административные шаблоны** &gt; **компоненты Windows** &gt; **службы удаленных рабочих столов &gt;** **Удаленный рабочий стол узле сеансов** &gt; **среде удаленного сеанса** &gt; **настроить сжатие для данных RemoteFX**. Возможны три значения:

-   **Оптимизировано для использования меньшего объема памяти** Потребляет минимальный объем памяти на сеанс, но имеет наименьшее соотношение сжатия и, следовательно, наибольшее потребление пропускной способности.

-   **Балансировка памяти и пропускной способности сети** Уменьшение потребления пропускной способности при увеличении объема используемой памяти (приблизительно 200 КБ на сеанс).

-   **Оптимизировано для использования меньшей пропускной способности сети** Дальнейшее уменьшение использования пропускной способности сети за счет приблизительно 2 МБ на сеанс. Если вы хотите использовать этот параметр, то перед размещением сервера в рабочей среде следует оценить максимальное количество сеансов и протестировать этот уровень с помощью этого параметра.

Можно также не использовать алгоритм сжатия протокол удаленного рабочего стола, поэтому рекомендуется использовать его только с аппаратным устройством, предназначенным для оптимизации сетевого трафика. Даже если вы решили не использовать алгоритм сжатия, некоторые графические данные будут сжиматься.

### <a name="device-redirection"></a>Перенаправление устройств

Перенаправление устройств можно настроить с помощью групповая политика в разделе **Конфигурация компьютера** &gt; **Административные шаблоны** &gt; **компоненты Windows** &gt; службы удаленных рабочих столов **Удаленный Узел сеансов рабочего стола** &gt; **перенаправление устройств и ресурсов** либо с помощью поля свойства **коллекции сеансов** в Диспетчер сервера.

Как правило, перенаправление устройства увеличивает объем пропускной способности подключения к серверу узла сеансов удаленных рабочих столов, так как данные обмениваются данными между устройствами на клиентских компьютерах и процессами, запущенными в сеансе сервера. Степень увеличения является функцией частоты операций, выполняемых приложениями, работающими на сервере, с перенаправляемыми устройствами.

Перенаправление принтера и Plug and Play перенаправление устройств также повышает загрузку ЦП при входе. Перенаправление принтеров можно выполнить двумя способами:

-   Сопоставление перенаправления на основе драйвера принтера, если на сервере должен быть установлен драйвер для принтера. Этот метод использовался в более ранних выпусках Windows Server.

-   В Windows Server 2008 для простого перенаправления драйвера принтера печати используется общий драйвер принтера для всех принтеров.

Рекомендуется использовать простой метод печати, так как он приводит к снижению загрузки ЦП при установке принтера во время подключения. Соответствующий метод драйвера приводит к увеличению загрузки ЦП, так как требует от службы диспетчера очереди загрузки различных драйверов. При использовании пропускной способности простая печать приводит к значительному увеличению использования полосы пропускания сети, но не вполне достаточно для того, чтобы повысить производительность, управляемость и преимущества надежности.

Перенаправление звука вызывает устойчивый поток сетевого трафика. Перенаправление звука также позволяет пользователям запускать мультимедийные приложения, которые обычно имеют высокий уровень использования ЦП.

### <a name="client-experience-settings"></a>Параметры интерфейса клиента

По умолчанию подключение к удаленному рабочему столу (RDC) автоматически выбирает нужные параметры в зависимости от пригодности сетевого подключения между сервером и клиентскими компьютерами. Рекомендуется, чтобы конфигурация RDC оставалась в состоянии **автоматически определять качество подключения**.

Для опытных пользователей RDC предоставляет контроль над диапазоном параметров, влияющих на производительность пропускной способности сети для подключения службы удаленных рабочих столов. Вы можете получить доступ к следующим параметрам, используя вкладку **опыт** в подключение к удаленному рабочему столу или в качестве параметров в RDP-файле.

При подключении к любому компьютеру применяются следующие параметры.

-   **Отключить фоновый рисунок** (отключить фоновый рисунок: i: 0) не показывает фоновый рисунок рабочего стола при перенаправленных подключениях. Этот параметр может значительно снизить использование пропускной способности, если фоновый рисунок рабочего стола состоит из изображения или другого содержимого с значительными затратами на рисование.

-   **Кэш точечных рисунков** (битмапкачеперсистенабле: i: 1) Если этот параметр включен, он создает клиентский кэш растровых изображений, отображаемых в сеансе. Он обеспечивает значительное улучшение использования пропускной способности, и его следует всегда включать (если нет других соображений безопасности).

-   **Отображение содержимого окон при перетаскивании** (отключение полного перетаскивания окна: i: 1) Если этот параметр отключен, пропускная способность сокращается за счет отображения только рамки окна, а не всего содержимого при перетаскивании окна.

-   **Анимация меню и окон** (отключить меню анимс: i: 1 и отключить параметр курсора: i: 1). Если эти параметры отключены, пропускная способность сокращается за счет отключения анимации меню (например, плавности) и курсоров.

-   **Сглаживание шрифтов** (разрешить сглаживание шрифтов: i: 0) управляет поддержкой визуализации шрифтов ClearType. При подключении к компьютерам под управлением Windows 8 или Windows Server 2012 и более поздних версий включение или отключение этого параметра не оказывает существенного влияния на использование пропускной способности. Однако для компьютеров под управлением более ранних версий, чем Windows 7 и Windows 2008 R2, включение этого параметра существенно влияет на использование полосы пропускания сети.

Следующие параметры применяются только при подключении к компьютерам под управлением Windows 7 и более ранних версий операционной системы.

-   **Композиция рабочего стола** Этот параметр поддерживается только для удаленного сеанса на компьютере под Windows 7 или Windows Server 2008 R2.

-   **Стили оформления** (отключить темы: i: 1) Если этот параметр отключен, пропускная способность сокращается за счет упрощения чертежей тем, использующих классическую тему.

С помощью вкладки **опыт** в подключение к удаленному рабочему столу можно выбрать скорость подключения, чтобы снизить производительность сети. Ниже перечислены параметры, доступные для настройки скорости подключения.

-   **Автоматически определять качество соединения** (тип подключения: i: 7) Если этот параметр включен, подключение к удаленному рабочему столу автоматически выбирает параметры, что приведет к оптимальному взаимодействиям с пользователем в зависимости от качества подключения. (Эту конфигурацию рекомендуется использовать при подключении к компьютерам под управлением Windows 8 или Windows Server 2012 и более поздних версий).

-   **Модем (56 кбит/с)** (тип подключения: i: 1) Этот параметр включает кэширование постоянного растрового изображения.

-   **Низкая скорость широкополосной сети (256 кбит/с)** (тип подключения: i: 2). Этот параметр включает Постоянное кэширование битовых карт и визуальные стили.

-   **Сотовый/Спутниковое (секунду-16 Мбит/с с высокой задержкой)** (тип подключения: i: 3) Этот параметр обеспечивает композицию рабочего стола, Постоянное кэширование битовых карт, стили визуальных элементов и фон рабочего стола.

-   **Высокоскоростное широкополосное подключение (2 Мбит/с – 10 Мбит/с)** (тип подключения: i: 4). Этот параметр обеспечивает композицию рабочего стола, отображение содержимого окон при перетаскивании, анимации по меню и окну, Постоянное кэширование растровых изображений, стили оформления и фон рабочего стола.

-   **WAN (10 Мбит/с и выше с высокой задержкой)** (тип подключения: i: 5) Этот параметр обеспечивает композицию рабочего стола, отображение содержимого окон при перетаскивании, анимации меню и окон, Постоянное кэширование растровых изображений, визуальные стили и фон рабочего стола.

-   **Локальная сеть (10 Мбит/с или выше)** (тип подключения: i: 6) Этот параметр обеспечивает композицию рабочего стола, отображение содержимого окон при перетаскивании, анимации меню и окон, Постоянное кэширование растровых изображений, темы и фон рабочего стола.

### <a name="desktop-size"></a>Размер рабочего стола

Размер рабочего стола для удаленных сеансов можно контролировать с помощью вкладки Отображение в подключение к удаленному рабочему столу или с помощью файла конфигурации RDP (десктопвидс: i: 1152 и десктофеигхт: i: 864). Чем больше размер рабочего стола, тем больше потребление памяти и пропускной способности, связанной с этим сеансом. Текущий максимальный размер рабочего стола — 4096 x 2048.
