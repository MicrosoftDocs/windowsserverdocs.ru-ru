---
title: Настройка узлов сеансов удаленных рабочих столов производительности
description: Рекомендации по регулировке узлах сеансов производительности
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: HammadBu; VladmiS
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: e45d1abb545ad46e654c811a0347c589bd12adf0
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59863245"
---
# <a name="performance-tuning-remote-desktop-session-hosts"></a>Настройка узлов сеансов удаленных рабочих столов производительности


В этом разделе описывается Выбор оборудования узла сеансов удаленных рабочих столов (RD Session Host), настройки узла и настройки приложений.

**В этом разделе:**

-   [Выбор правильного выбора оборудования для повышения производительности](#hw)

-   [Настройка приложений для узла сеансов удаленных рабочих столов](#apps)

-   [Настройка параметров узла сеансов удаленных рабочих столов](#host)

## <a href="" id="hw"></a>Выбор правильного выбора оборудования для повышения производительности


Для развертывания серверов узла сеансов удаленных рабочих Столов Выбор оборудования регулируется набора приложения и как их использовать пользователи. Ключевые факторы влияют на количество пользователей и взаимодействия с ними, ЦП, памяти, диска и графики. Этот раздел содержит дополнительные рекомендации, относящиеся к серверам узла сеансов удаленных рабочих Столов и основном связаны с многопользовательской среды серверов узла сеансов удаленных рабочих Столов.

### <a name="cpu-configuration"></a>Конфигурация ЦП

Конфигурация ЦП концептуально определяется путем умножения требуется ЦП для поддержки сеанса на количество сеансов, которые система способен поддерживать, сохраняя зону буфер для обработки временных пиков. Несколько логических процессоров может помочь снизить аномальных ситуациях перегрузки ЦП, которые обычно вызваны несколько активного потоков, которые содержатся в числом логических процессоров.

Таким образом, более логических процессоров в системе, тем ниже поля подкладка, который должен быть встроен оценке использования ЦП, что приводит к больший процент active нагрузки на ЦП. Важным фактором для запоминания, предлагает удвоить число ЦП не double не мощности ЦП.

### <a name="memory-configuration"></a>Конфигурация памяти

Конфигурация памяти зависит от приложения, которые пользователи применять; Тем не менее необходимый объем памяти может быть оценена по следующей формуле: TotalMem = OSMem + SessionMem \* NS

OSMem какой объем памяти, требуемый для запуска (например, двоичные образы системы, структуры данных и т. д.), SessionMem операционной системы является объем памяти процессов, запущенных в одном сеансе требуют, которая NS целевое количество активных сеансов. Требуемый объем памяти для сеанса, главным образом определяется ссылка собственной памяти для приложений и системные процессы, запущенные в сеансе. Общие страницы кода или данных оказывать существенное влияние, поскольку в системе присутствует только одна копия.

Один интересный наблюдения, (при условии, что дисковая система резервное копирование файла подкачки не изменяется) том, что чем больше число одновременных активных сеансов, система планы для поддержки, чем больше выполняется выделение памяти для сеанса должен быть. Если объем памяти, выделенной для сеанса не увеличивается, число ошибок страниц, активные сеансы создают увеличивается с количеством сеансов. Эти ошибки со временем перегрузить подсистемы ввода-вывода. Увеличив объем памяти, выделенной для сеанса, уменьшается вероятность возникновения ошибок страниц, которые помогают снизить общее число ошибок страниц.

### <a name="disk-configuration"></a>Конфигурация дисков

Хранение — это одна из наиболее не уделяют должного внимания аспектов при настройке серверов узла сеансов удаленных рабочих Столов, и может быть наиболее распространенных ограничений в системах, которые развертываются в поле.

Активности диска, который создается на сервере узла сеансов удаленных рабочих Столов обычно влияет на следующие области:

-   Системные файлы и двоичные файлы приложения

-   Файлы подкачки

-   Профили пользователей и сведений о пользователях

В идеале эти области необходимо архивировать устройствами отдельного хранилища. Использование чередующихся конфигурации RAID или другие виды дальнейшей высокопроизводительное хранилище увеличивает производительность. Настоятельно рекомендуется использовать адаптеры хранилища с кэшированием записи, от аккумулятора. Контроллеры с кэшированием записи диска обеспечивают улучшенную поддержку синхронной записи операций. Так как все пользователи имеют отдельный куст, синхронной записи операций используются значительно чаще, на сервере узла сеансов удаленных рабочих Столов. Кусты реестра периодически сохраняются на диск с помощью синхронной записи операций. Чтобы включить эти оптимизации, из консоли управления дисками, откройте **свойства** диалоговое окно на диске и на **политики** выберите **разрешить кэширование записи на диск** и **Отключить сброс буфера кэша записи Windows** на устройстве флажки.

### <a name="network-configuration"></a>конфигурация сети;

Использование сети для сервера узла сеансов удаленных рабочих Столов включает в себя две основные категории:

-   Использование трафика узла сеансов удаленных рабочих Столов подключения определяется исключительно рисования закономерности, проявляется приложениям, выполняемым внутри сеансы и трафик перенаправления устройств ввода-вывода.

    Например приложения, обработка обработки текста и входных данных использовать пропускную способность примерно 10 до 100 килобит в секунду, тогда как сложные графические объекты, а также воспроизведение видео вызывают существенное увеличение в использовании пропускной способности.

-   Внутренних соединений, например перемещаемые профили, доступ к приложениям для файловых ресурсов, серверы баз данных, серверы электронной почты и HTTP.

    Тома и профиль сетевого трафика зависит от каждого развертывания.

## <a href="" id="apps"></a>Настройка приложений для узла сеансов удаленных рабочих столов


Большая часть ЦП на сервере узла сеансов удаленных рабочих Столов зависит от приложения. Классические приложения обычно оптимизированы по скорости реагирования с целью минимизировать время ответа на запрос пользователя. Тем не менее в серверной среде, не менее важно свести к минимуму объем ЦП, которые необходимо выполнить действие, чтобы избежать, что отрицательно повлияет на другие сеансы.

При настройке приложения, которые будут использоваться на сервере узла сеансов удаленных рабочих Столов, рассмотрите следующие предложения:

-   Свести к минимуму Фоновая обработка пустых циклов

    Типичные примеры отключаем грамматики и орфографии проверку, данных, индексирования поиска, и сохраняет в фоновом режиме.

-   Свести к минимуму, как часто приложение выполняет проверку состояния или обновления.

    Отключения такого поведения или увеличить интервал между итерациями опроса и значительно срабатывание таймера преимущества использования ЦП, потому что последствия таких действий быстро усиливаться для много активных сеансов. Типичными примерами являются значки состояния подключения и обновления сведений строки состояния.

-   Минимизируйте состязание между приложениями за счет сокращения их частоту синхронизации.

    Примерами таких ресурсов являются разделы реестра и файлы конфигурации. Компоненты приложения и компоненты относятся индикатор состояния (например, уведомления оболочки), индексирование фона или отслеживания изменений и синхронизации в автономном режиме.

-   Отключите ненужные процессы, которые регистрируются, чтобы начать со входа пользователей в систему или запуска сеанса.

    Эти процессы могут значительно способствовать затраты на использование ЦП при создании новый пользовательский сеанс, который обычно представляет собой процесс интенсивной нагрузкой ЦП, и он может быть очень затратным в сценариях утро. Используйте MsConfig.exe или MsInfo32.exe для получения списка процессов, которые запускаются при входе пользователя. Более подробные сведения, можно использовать [Autoruns для Windows](https://technet.microsoft.com/sysinternals/bb963902.aspx).

Для потребления памяти необходимо учитывать следующее.

-   Убедитесь, что библиотеки DLL, загружаемые приложения не перемещаются.

    -   Перемещенные DLL можно проверить, выбрав представление библиотеки DLL, как показано на рисунке ниже, с помощью [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653.aspx).

    -   Здесь можно увидеть, что этот y.dll перемещена, поскольку x.dll уже занят его базовый адрес по умолчанию и не поддерживает ASLR

        ![перемещенные DLL](../../media/perftune-guide-relocated-dlls.png)

        Если библиотеки DLL, перемещены, вы не сможете совместно использовать свой код во всех сеансах, что значительно увеличивает объем сеанса. Это одна из наиболее распространенных проблем с производительностью, связанных с памятью на сервере узла сеансов удаленных рабочих Столов.

-   Для приложения (CLR) среды CLR используйте генератором машинных образов (Ngen.exe) для повышения общего доступа к странице и снизить нагрузку на ЦП.

    По возможности применять сходные методы для других подобных подсистемы выполнения.

## <a href="" id="host"></a>Настройка параметров узла сеансов удаленных рабочих столов


### <a name="page-file"></a>Файл подкачки

Недостаточно размера может вызвать ошибок выделения памяти в приложениях или системных компонентов. Можно использовать счетчик производительности памяти зафиксированных байтов мониторинга, какой объем выделенной виртуальной памяти в системе.

### <a name="antivirus"></a>Антивирусная программа

Установка антивирусного программного обеспечения на сервере узла сеансов удаленных рабочих Столов значительно влияет на общую производительность системы, особенно ЦП. Мы настоятельно рекомендуем что исключить из списка активных мониторинга все папки, которые содержат временные файлы, особенно те, которые служб и других компонентов системы создают.

### <a name="task-scheduler"></a>Планировщик заданий

Планировщик задач позволяет изучить список задач, которые запланированы для различных событий. Для сервера узла сеансов удаленных рабочих Столов полезно связана именно с задачи, которые настроены для запуска состояние бездействия, при входе пользователя или в сеансе подключения. Из-за особенностей развертывания многие из этих задач может оказаться ненужным.

### <a name="desktop-notification-icons"></a>Значки уведомлений рабочего стола

Значки уведомлений на рабочем столе может быть довольно дорогой механизмы обновления. Следует отключить все уведомления, удаляя компонент, который регистрирует их из списка запуска, или путем изменения конфигурации для приложений и компонентов системы, чтобы отключить их. Можно использовать **настраивать значки уведомлений** изучаемый список уведомлений, доступные на сервере.

### <a name="remotefx-data-compression"></a>Сжатие данных RemoteFX

Microsoft RemoteFX сжатия можно настроить с помощью групповой политики в разделе **Конфигурация компьютера &gt; административные шаблоны &gt; компоненты Windows &gt; служб удаленных рабочих столов &gt; удаленного Узла сеанса рабочего стола &gt; удаленной среде сеанса &gt; Настройка сжатия для данных RemoteFX**. Возможны три значения:

-   **Оптимизированный использовал меньше памяти** занимает наименьший объем памяти для каждого сеанса, но имеет низкий коэффициент сжатия и, следовательно, наибольший потребление пропускной способности.

-   **Распределяет памяти и пропускной способности сети** сокращение уровня использования пропускной способности, а немногим увеличение объема используемой памяти (примерно 200 КБ на сеанс).

-   **Оптимизированный использовать меньшую полосу пропускания** Дополнительно уменьшает использование пропускной способности сети за счет приблизительно 2 МБ на сеанс. Если вы хотите использовать этот параметр, следует оценить максимальное количество сеансов и проверить до этого уровня с этим параметром, перед помещением сервера в рабочей среде.

Также можно не использовать алгоритм сжатия RemoteFX. Решили не использовать алгоритм сжатия RemoteFX будет использовать больше пропускной способности, и это рекомендуется только при использовании устройства, предназначенной для оптимизации сетевого трафика. Даже если вы решили не использовать алгоритм сжатия RemoteFX, будет ли сжиматься данные некоторых графики.

### <a name="device-redirection"></a>Перенаправление устройств

Перенаправление устройств можно настроить с помощью групповой политики в разделе **Конфигурация компьютера &gt; административные шаблоны &gt; компоненты Windows &gt; служб удаленных рабочих столов &gt; удаленного рабочего стола Узел сеансов &gt; перенаправление устройств и ресурсов** или с помощью **коллекции сеансов** свойства поле в диспетчере сервера.

Как правило перенаправление устройств увеличивает объем пропускной способности сети сервера узла сеансов удаленных рабочих Столов использовать, поскольку обмен данными между устройствами, на клиентских компьютерах и процессы, запущенные в сеансе сервера. Степень увеличения зависит от частоты операции, выполняемые для приложений, работающих на сервере для перенаправления устройств.

Перенаправление принтеров и Plug and Play перенаправление устройств также повышает загрузку ЦП при входе в систему. Вы можете перенаправлять принтеры двумя способами:

-   Сопоставления на основе драйвер перенаправление принтеров Если драйвер принтера, должны устанавливаться на сервере. Более ранних версиях Windows Server использовал этот метод.

-   Представленный в Windows Server 2008, драйвер Easy Print перенаправление использует общие драйвер принтера для всех принтеров.

Мы рекомендуем метод Easy Print, так как вызывает меньше ЦП, для установки принтера, во время установления соединения. Соответствующий метод драйвер вызывает больше ресурсов ЦП, так как он требуется служба диспетчера очереди печати для загрузки различными драйверами. Для использования пропускной способности, Easy Print вызывает использование пропускной способности сети немного, но не настолько значительная, смещение другие преимущества производительности, управляемости и надежности.

Перенаправление звука вызывает устойчивый поток сетевого трафика. Перенаправление звука также позволяет пользователям запускать мультимедийных приложений, которые обычно имеют высокий уровень потребления ресурсов ЦП.

### <a name="client-experience-settings"></a>Параметры взаимодействия с клиентом

По умолчанию Remote Desktop Connection (RDC) автоматически выбирает справа возникнуть параметр, основываясь на пригодность сетевое подключение между сервером и клиентских компьютеров. Мы рекомендуем, что конфигурация RDC остаются в **автоматически определить качество соединения**.

Для опытных пользователей RDC обеспечивает контроль над ряд параметров, влияющих на производительность пропускной способности сети для подключения служб удаленных рабочих столов. Доступны следующие параметры с помощью **качества** вкладку в удаленный рабочий стол или как параметры в RDP-файл.

Следующие параметры применяются при подключении к любому компьютеру.

-   **Отключить фоновый рисунок** (Disable фоновый рисунок: i: 0) не содержит фоновый рисунок рабочего стола на перенаправленные соединения. Этот параметр может значительно снизить использование пропускной способности, если фоновый рисунок рабочего стола состоит из образа или другое содержимое с значительные затраты для рисования.

-   **Кэш рисунка** (Bitmapcachepersistenable:i:1) Если этот параметр включен, он создает клиентского кэша точечных рисунков, подготавливаются к просмотру в сеансе. Это значительное улучшение на использование пропускной способности, а он должен быть всегда включен (если есть другие вопросы безопасности).

-   **Отображать содержимое окна при перетаскивании** (отключить перетаскивание окон: i: 1) Если этот параметр отключен, он снижает потребление пропускной способности, отображая только фрейм окна, а не все содержимое, при перетаскивании окна.

-   **Анимация меню и окон** (отключение меню anims:i:1 и Disable cursor параметр: i: 1): Если эти параметры отключены, он снижает потребление пропускной способности путем отключения анимации меню (таких как затухание) и курсоров.

-   **Сглаживание шрифтов** (Allow font smoothing: i: 0) поддержка отображения шрифтов ClearType элементов управления. При подключении к компьютерам под управлением Windows 8 или Windows Server 2012 и более поздних версий, включая или отключая этот параметр не имеет значительное влияние на использование пропускной способности. Тем не менее для компьютеров под управлением версий более ранних, чем Windows 7 и Windows 2008 R2, при включении этого параметра влияет на полосу пропускания сети значительно.

Следующие параметры применяются только при подключении к компьютерам под управлением Windows 7 и более ранних версий операционной системы:

-   **Компоновки рабочего стола** этот параметр поддерживается только для удаленного сеанса на компьютере под управлением Windows 7 или Windows Server 2008 R2.

-   **Визуальные стили** (отключить темы: i: 1) Если этот параметр отключен, он снижает потребление пропускной способности за счет упрощения темы рисунки, используемые в классической теме.

С помощью **качества** вкладке Удаленный рабочий стол, можно выбрать скорость подключения, которые влияют на производительность пропускной способности сети. Ниже перечислены параметры, доступные для настройки скорости подключения.

-   **Определяет качество соединения автоматически** (тип подключения: i:7) Если этот параметр включен, удаленный рабочий стол автоматически выбирает параметры, которые будут вызывать в зависимости от качества подключения удобство работы пользователей. (Эта конфигурация рекомендуется при подключении к компьютерам под управлением Windows 8 или Windows Server 2012 и более поздних версий).

-   **Модем (56 Кбит/с)** (подключение типа: i: 1) этот параметр позволяет включить постоянное кэширование точечных рисунков.

-   **Низкая скорость высокоскоростное (256 Кбит/с - 2 Мбит/с)** (тип подключения: i:2) этот параметр позволяет включить постоянные растрового изображения кэширования и визуальные стили.

-   **Сотовый/вспомогательной (2Mbps - 16 Мбит/с с высокой задержкой)** (тип подключения: i:3) этот параметр включает компоновки рабочего стола, постоянное кэширование точечных рисунков, визуальные стили и фон рабочего стола.

-   **Высокоскоростной широкополосное подключение (2 Мбит/с — 10 Мбит/с)** (тип подключения: i:4) этот параметр позволяет компоновки рабочего стола, отображать содержимое окна при перетаскивании, анимация меню и окон, постоянное кэширование точечных рисунков, визуальные стили и фон рабочего стола.

-   **Глобальную сеть (10 Мбит/с или более поздней версии с высокой задержкой)** (тип подключения: i:5) этот параметр позволяет компоновки рабочего стола, отображать содержимое окна при перетаскивании, анимация меню и окон, постоянное кэширование точечных рисунков, визуальные стили и фон рабочего стола.

-   **Локальная сеть (10 Мбит/с или более поздней версии)** (тип подключения: i:6) этот параметр позволяет компоновки рабочего стола, отображать содержимое окна при перетаскивании, анимация меню и окон, постоянное кэширование точечных рисунков, темы и фон рабочего стола.

### <a name="desktop-size"></a>Размер рабочего стола

Размер рабочего стола для удаленных сеансов, можно управлять с помощью вкладку отображения в удаленный рабочий стол или с помощью файла конфигурации удаленного рабочего СТОЛА (desktopwidth:i:1152 и desktopheight:i:864). Чем больше размер рабочего стола, тем больше памяти и потребление полосы пропускания, связанный с этого сеанса. Текущий максимальный размер рабочего стола – 4096 x 2048.
