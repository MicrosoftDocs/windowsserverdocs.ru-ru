---
title: Настройка производительности удаленный рабочий стол узлов виртуализации
description: Настройка производительности для узлов виртуализации удаленный рабочий стол
ms.topic: article
ms.author: hammadbu; vladmis; denisgun
author: phstee
ms.date: 10/22/2019
ms.openlocfilehash: 235dd0209030854f1fc883f52ab41550ab693dc5
ms.sourcegitcommit: 68444968565667f86ee0586ed4c43da4ab24aaed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87992074"
---
# <a name="performance-tuning-remote-desktop-virtualization-hosts"></a>Настройка производительности удаленный рабочий стол узлов виртуализации

Узел виртуализации удаленных рабочих столов (узел виртуализации удаленных рабочих столов) — это служба роли, которая поддерживает сценарии инфраструктуры виртуальных рабочих столов (VDI) и позволяет нескольким пользователям запускать приложения на базе Windows на виртуальных машинах, размещенных на сервере под управлением Windows Server и Hyper-V.

Windows Server поддерживает два типа виртуальных рабочих столов: личные виртуальные рабочие столы и виртуальные рабочие столы в составе пула.

## <a name="general-considerations"></a>Общие рекомендации

### <a name="storage"></a>Хранение

Наиболее вероятное узким местом производительности является хранилище, поэтому важно изменить размер хранилища, чтобы правильно обрабатывалась нагрузка ввода-вывода, созданная изменениями состояния виртуальной машины. Если пилотный проект или имитация нецелесообразна, рекомендуется подготовить один дисковый шпиндел для четырех активных виртуальных машин. Используйте конфигурации дисков с хорошей производительностью записи (например, RAID 1 + 0).

При необходимости используйте дедупликацию дисков и кэширование, чтобы уменьшить нагрузку на диск, и включите решение для хранения данных, чтобы повысить производительность путем кэширования значительной части образа.

### <a name="data-deduplication-and-vdi"></a>Дедупликация данных и VDI

В Windows Server 2012 R2 дедупликация данных поддерживает оптимизацию открытых файлов. Чтобы использовать виртуальные машины, работающие на дедупликации тома, файлы виртуальной машины должны храниться на отдельном узле, отличном от узла Hyper-V. Если Hyper-V и дедупликация выполняются на одном компьютере, эти две функции будут конкурировать за системные ресурсы и негативно повлияют на общую производительность.

Том также должен быть настроен для использования типа оптимизации дедупликации "инфраструктура виртуальных рабочих столов (VDI)". Это можно настроить с помощью Диспетчер сервера (**Файловые службы и тома служб хранилища**  - &gt; **Volumes**  - &gt; **Параметры дедупликации**) или с помощью следующей команды Windows PowerShell:

``` syntax
Enable-DedupVolume <volume> -UsageType HyperV
```

> [!NOTE]
> Оптимизация дедупликации данных для открытых файлов поддерживается только для сценариев VDI с Hyper-V, использующих удаленное хранилище по протоколу SMB 3,0.

### <a name="memory"></a>Память

Использование памяти сервера управляется тремя основными факторами:

- Издержки операционной системы

- Служебные ресурсы Hyper-V на каждую виртуальную машину

- Память, выделенная для каждой виртуальной машины

Для типичных рабочих нагрузок рабочей нагрузки на гостевых виртуальных машинах с x86 Window 8 или Windows 8.1 необходимо предоставить около 512 МБ памяти в качестве базовых показателей. Однако динамическая память, скорее всего, увеличит объем памяти гостевой виртуальной машины примерно на 800 МБ в зависимости от рабочей нагрузки. Для x64 мы увидим, что начиная с 800 МБ и увеличивая до 1024 МБ.

Поэтому важно предоставить достаточно памяти сервера, чтобы удовлетворить объем памяти, требуемый ожидаемым числом гостевых виртуальных машин, а также обеспечить достаточный объем памяти для сервера.

### <a name="cpu"></a>ЦП

При планировании емкости сервера для сервера узла виртуализации удаленных рабочих столов количество виртуальных машин на физические ядра будет зависеть от природы рабочей нагрузки. В качестве отправной точки целесообразно планировать 12 виртуальных машин на физические ядра, а затем выполнять соответствующие сценарии для проверки производительности и плотности. Более высокая плотность может быть достижима в зависимости от особенностей рабочей нагрузки.

Рекомендуется включить технологию Hyper-Threading, но не забудьте вычислить коэффициент превышения лимита подписки на основе числа физических ядер, а не числа логических процессоров. Это обеспечивает ожидаемый уровень производительности для каждого ЦП.

## <a name="performance-optimizations"></a>Оптимизация производительности

### <a name="dynamic-memory"></a>Динамическое распределение памяти

Динамическая память обеспечивает более эффективное использование ресурсов памяти сервера, на котором работает Hyper-V, путем балансировки распределения памяти между работающими виртуальными машинами. Память можно динамически перераспределить между виртуальными машинами в ответ на изменяющиеся рабочие нагрузки.

Динамическая память позволяет повысить плотность виртуальных машин с учетом уже существующих ресурсов без ущерба для производительности или масштабируемости. Результатом является более эффективное использование дорогостоящих ресурсов серверного оборудования, что может привести к более легкому управлению и снижению затрат.

В операционных системах на виртуальной машине под управлением Windows 8 и более поздних версий с виртуальными процессорами, охватывающими несколько логических процессоров, следует рассмотреть компромисс между запуском с динамическая память, чтобы сократить использование памяти и отключить динамическая память, чтобы повысить производительность приложения, которое поддерживает топологию компьютеров. Такое приложение может использовать сведения о топологии для принятия решений о планировании и выделении памяти.

### <a name="tiered-storage"></a>Многоуровневое хранилище

Узел виртуализации удаленных рабочих столов поддерживает многоуровневые хранилища для пулов виртуальных рабочих столов. Физический компьютер, совместно используемый всеми виртуальными рабочими столами в составе пула, может использовать высокопроизводительное решение для хранения данных, такое как зеркальный твердотельный накопитель (SSD). Виртуальные рабочие столы в составе пула можно разместить на менее дорогостоящем традиционном хранилище, таком как RAID 1 + 0.

Физический компьютер должен быть размещен на SSD, так как большая часть операций чтения и ввода-вывода из виртуальных рабочих столов в составе пула переходит в операционную систему управления. Таким образом, хранилище, используемое физическим компьютером, должно поддерживать более высокие объемы операций чтения в секунду.

Эта конфигурация развертывания гарантирует экономичную производительность, когда требуется производительность. SSD обеспечивает более высокую производительность на диске меньшего размера (~ 20 ГБ на коллекцию в зависимости от конфигурации). В традиционном хранилище для виртуальных рабочих столов в составе пула (RAID 1 + 0) используется около 3 ГБ на виртуальную машину.

### <a name="csv-cache"></a>Кэш CSV

Отказоустойчивая кластеризация в Windows Server 2012 и более поздних версий обеспечивает кэширование общих томов кластера (CSV). Это чрезвычайно полезно для коллекций виртуальных рабочих столов в составе пула, где большая часть операций ввода-вывода считывается из операционной системы управления. Кэш CSV обеспечивает более высокую производительность с помощью нескольких порядков, поскольку он кэширует блоки, которые считываются более одного раза, и доставляет их из системной памяти, что сокращает число операций ввода-вывода. Дополнительные сведения о кэше CSV см. в разделе [Включение кэша CSV](https://blogs.msdn.com/b/clustering/archive/2012/03/22/10286676.aspx).

### <a name="pooled-virtual-desktops"></a>Виртуальные рабочие столы в составе пула

По умолчанию виртуальные рабочие столы в составе пула откатываются в состояние поддерживалась после выхода пользователя, поэтому любые изменения, внесенные в операционную систему Windows с момента последнего входа пользователя, будут отменены.

Хотя откат можно отключить, он по-прежнему является временным, так как обычно коллекция виртуальных рабочих столов в составе пула создается повторно из-за различных обновлений шаблона виртуального рабочего стола.

Имеет смысл отключить функции и службы Windows, зависящие от постоянного состояния. Кроме того, имеет смысл отключить службы, которые в основном используются для некорпоративных сценариев.

Каждая конкретная служба должна оцениваться должным образом до любого широкого развертывания. Ниже приведены некоторые начальные моменты, которые следует учитывать.

| Служба                                      | Почему?                                                                                                                                                                                                      |
|----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Автоматическое обновление                                  | Виртуальные рабочие столы в составе пула обновляются путем повторного создания шаблона виртуального рабочего стола.                                                                                                                          |
| автономные файлы;                                | Виртуальные рабочие столы всегда находятся в сети и подключены с точки зрения сети.                                                                                                                         |
| Фоновая дефрагментация                            | Изменения в файловой системе удаляются после выхода пользователя из системы (из-за отката в состояние поддерживалась или при повторном создании шаблона виртуального рабочего стола, что приводит к повторному созданию всех виртуальных рабочих столов в составе пула). |
| Режим гибернации или спящий режим                           | Нет такого понятия для VDI                                                                                                                                                                                   |
| Дамп памяти для проверки ошибок                        | Нет такой концепции для виртуальных рабочих столов в составе пула. Ошибка. Проверка виртуального рабочего стола в составе пула начнется из состояния поддерживалась.                                                                                       |
| Автонастройка WLAN                              | Отсутствует интерфейс устройства Wi-Fi для VDI                                                                                                                                                                 |
| Служба общего доступа к проигрывателю Windows Media | Ориентированная на потребителей служба                                                                                                                                                                                  |
| Поставщик домашней группы                          | Ориентированная на потребителей служба                                                                                                                                                                                  |
| Общий доступ к подключению к Интернету                  | Ориентированная на потребителей служба                                                                                                                                                                                  |
| Расширенные службы Media Center               | Ориентированная на потребителей служба                                                                                                                                                                                  |
> [!NOTE]
> Этот список не является полным списком, так как любые изменения повлияют на предполагаемые цели и сценарии. Дополнительные сведения см. в разделе [горячее нажатие клавиш, получите его сейчас, сценарий оптимизации VDI для Windows 8, с помощью PFE!](/archive/blogs/jeff_stokes/hot-off-the-presses-get-it-now-the-windows-8-vdi-optimization-script-courtesy-of-pfe).


> [!NOTE]
> В Windows 8 по умолчанию включена упреждающая выборка. Он совместим с VDI и не должен быть отключен. Избыточная выборка может еще больше сократить потребление памяти посредством общего доступа к странице памяти, что полезно для VDI. Виртуальные рабочие столы в составе пула под Windows 7 должны быть отключены, но для персональных виртуальных рабочих столов, работающих под Windows 7, необходимо оставить.