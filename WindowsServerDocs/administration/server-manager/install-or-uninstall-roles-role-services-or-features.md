---
title: Установка и удаление ролей, служб ролей и компонентов
description: Диспетчер серверов
ms.topic: article
ms.assetid: 04f16d84-45c2-4771-84c1-1cc973d0ee02
ms.author: lizross
author: eross-msft
manager: mtillman
ms.date: 10/16/2017
ms.openlocfilehash: 91cc11133d42168197541e451da27771a377bab9
ms.sourcegitcommit: db2d46842c68813d043738d6523f13d8454fc972
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "89628401"
---
# <a name="install-or-uninstall-roles-role-services-or-features"></a>Установка и удаление ролей, служб ролей и компонентов

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В Windows Server консоль диспетчер сервера и командлеты Windows PowerShell для диспетчер сервера позволяют устанавливать роли и компоненты на локальные или удаленные серверы или в автономные виртуальные жесткие диски (VHD). Вы можете установить несколько ролей и компонентов на одном удаленном сервере или в автономном виртуальном жестком диске в мастере добавления ролей и компонентов или в сеансе Windows PowerShell.

> [!IMPORTANT]
> Диспетчер серверов нельзя использовать для управления более новыми выпусками операционной системы Windows Server. Диспетчер сервера, выполняющиеся в Windows Server 2012 R2 или Windows 8.1, нельзя использовать для установки ролей, служб ролей и компонентов на серверах под Windows Server 2016.

Для установки и удаления ролей, служб ролей и компонентов необходимо войти на сервер с правами администратора. Если вы вошли на локальный компьютер с учетной записью, не имеющей прав администратора на целевом сервере, щелкните правой кнопкой мыши целевой сервер на плитке **Серверы**, выберите **Управлять как** и укажите учетную запись с правами администратора. Сервер, на котором требуется подключить автономный виртуальный жесткий диск, должен быть добавлен в диспетчер серверов. На таком сервере нужны права администратора.

Дополнительные сведения о ролях, службах ролей и компонентах см. в разделе [роли, службы ролей и компоненты](https://go.microsoft.com/fwlink/p/?LinkId=239558).

В этом разделе содержатся следующие подразделы.

-   [Установка ролей, служб ролей и компонентов с помощью мастера добавления ролей и компонентов](#install-roles-role-services-and-features-by-using-the-add-roles-and-features-wizard)

-   [Установка ролей, служб ролей и компонентов при помощи командлетов Windows PowerShell](#install-roles-role-services-and-features-by-using-windows-powershell-cmdlets)

-   [Удаление ролей, служб ролей и компонентов с помощью мастера удаления ролей и компонентов](#remove-roles-role-services-and-features-by-using-the-remove-roles-and-features-wizard)

-   [Удаление ролей, служб ролей и компонентов при помощи командлетов Windows PowerShell](#remove-roles-role-services-and-features-by-using-windows-powershell-cmdlets)

-   [Установка ролей и компонентов на нескольких серверах при помощи сценария Windows PowerShell](#install-roles-and-features-on-multiple-servers-by-running-a-windows-powershell-script)

-   [Установка .NET Framework 3.5 и других компонентов по требованию](#install-net-framework-35-and-other-features-on-demand)

## <a name="install-roles-role-services-and-features-by-using-the-add-roles-and-features-wizard"></a>Установка ролей, служб ролей и компонентов с помощью мастера добавления ролей и компонентов
В одном сеансе мастера добавления ролей и компонентов можно установить роли, службы ролей и компоненты на локальном сервере, на удаленном сервере, который добавлен в диспетчер сервера, или в автономный виртуальный жесткий диск. Дополнительные сведения о добавлении сервера в диспетчер сервера управления см. в разделе [Добавление серверов в Диспетчер сервера](add-servers-to-server-manager.md).

> [!NOTE]
> Если вы используете диспетчер сервера на Windows Server 2016 или Windows 10, можно использовать мастер добавления ролей и компонентов для установки ролей и компонентов только на серверах и автономных виртуальных жестких дисках, работающих под Windows Server 2016.

#### <a name="to-install-roles-and-features-by-using-the-add-roles-and-features-wizard"></a>Установка ролей и компонентов с помощью мастера добавления ролей и компонентов

1.  Если диспетчер серверов уже открыт, переходите к следующему шагу. Если диспетчер серверов еще не открыт, откройте его одним из следующих способов.

    -   На рабочем столе Windows запустите диспетчер серверов, щелкнув **Диспетчер серверов** на панели задач Windows.

    -   На **начальном** экране Windows щелкните плитку **Диспетчер сервера** .

2.  В меню **Управление** выберите команду **Добавить роли и компоненты**.

3.  На странице **Приступая к работе** убедитесь, что конечный сервер и сетевое окружение подготовлены к установке нужной вам роли или компонента. Щелкните **Далее**.

4.  На странице **Выбор типа установки** выберите **Установка ролей или компонентов**, чтобы установить все элементы ролей или компонентов на одном сервере, или **Установка служб удаленных рабочих столов**, чтобы установить инфраструктуру рабочих столов на основе виртуальных машин или сеансов для служб удаленных рабочих столов. В случае варианта **Установка служб удаленных рабочих столов** логические части роли служб удаленных рабочих столов нужным образом распределяются администраторами между разными серверами. Щелкните **Далее**.

5.  На странице **Выбор целевого сервера** выберите сервер из пула серверов или автономный виртуальный жесткий диск. Чтобы выбрать автономный виртуальный жесткий диск в качестве конечного сервера, сначала выберите сервер, на котором будет подключен виртуальный жесткий диск, а затем выберите VHD-файл. Сведения о добавлении серверов в пул серверов см. [в разделе Добавление серверов в Диспетчер сервера](add-servers-to-server-manager.md). Выбрав конечный сервер, нажмите кнопку **Далее**.

    > [!NOTE]
    > Для установки ролей и компонентов на автономных виртуальных жестких дисках целевые виртуальные жесткие диски должны отвечать следующим требованиям.
    >
    > -   На виртуальных жестких дисках должен быть установлен выпуск Windows Server, соответствующий используемой версии диспетчер сервера. См. Примечание в начале [установки ролей, служб ролей и компонентов с помощью мастера добавления ролей и компонентов](#install-roles-role-services-and-features-by-using-the-add-roles-and-features-wizard).
    > -   Виртуальные жесткие диски не должны содержать больше одного системного тома или раздела.
    > -   Общая сетевая папка, в которой хранится VHD-файл, должна предоставлять учетной записи компьютера (или локальной системы) для сервера, где будет подключен виртуальный жесткий диск, следующие права доступа. Одной лишь учетной записи пользователя недостаточно. На общем ресурсе можно предоставить разрешения **Чтение** и **Запись** группе **Все**, чтобы разрешить доступ к виртуальному жесткому диску, но из соображений безопасности делать это не рекомендуется.
    >
    >     -   Права на **Чтение и запись** в диалоговом окне **Общий доступ к файлам.**
    >     -   **Полный** доступ на вкладке **Безопасность** диалогового окна **Свойства** файла или папки.

6.  Выберите роли, если необходимо, выберите службы ролей и нажмите кнопку **Далее**, чтобы выбрать компоненты.

    По мере продолжения мастер добавления ролей и компонентов автоматически информирует вас о том, что на целевом сервере обнаружены конфликты, которые могут препятствовать установке или нормальной работе выбранных ролей или компонентов. Также появляется запрос на добавление ролей, служб ролей и компонентов, необходимых для выбранных ролей или компонентов.

    Кроме того, если планируется удаленное управление ролями либо с другого сервера, либо с компьютера на базе клиента Windows с установленными средствами администрирования удаленного сервера, можно не устанавливать средства управления и оснастки для ролей на конечном сервере. По умолчанию в мастере добавления ролей и компонентов для установки выбраны средства управления.

7.  На странице **Подтверждение выбранных элементов для установки** проверьте выбранные роли, компоненты и серверы. Если все готово к установке, нажмите кнопку **Установить**.

    Вы также можете экспортировать параметры в файл конфигурации на основе XML, который можно использовать для автоматической установки с помощью Windows PowerShell. Чтобы экспортировать конфигурацию, указанную в этом сеансе мастера добавления ролей и компонентов, щелкните **Экспорт параметров конфигурации**, а затем сохраните XML-файл в удобном месте.

    Команда **Указать альтернативный исходный путь** на странице **Подтверждение выбранных элементов для установки** позволяет указать альтернативный исходный путь для файлов, необходимых для установки ролей и компонентов на выбранном сервере. В Windows Server 2012 и более поздних версиях Windows Server [функции по запросу](https://go.microsoft.com/fwlink/p/?LinkID=241573) позволяют сократить объем дискового пространства, используемого операционной системой, путем удаления файлов ролей и компонентов с серверов, которые управляются удаленно. Удалив файлы ролей и компонентов с сервера при помощи командлета `Uninstall-WindowsFeature -remove` , в дальнейшем можно установить роли и компоненты на сервер, указав альтернативный исходный путь или общий ресурс, на котором хранятся необходимые файлы ролей и компонентов. Исходный путь или общая папка должны предоставлять разрешения на **Чтение** для группы " **все** " (не рекомендуется по соображениям безопасности) или учетной записи компьютера (*домен* \\ *SERverNAME*$) на целевом сервере; предоставление доступа к учетной записи пользователя недостаточна. Дополнительные сведения о функции "Компоненты по запросу" см. в разделе [Варианты установки Windows Server](https://go.microsoft.com/fwlink/p/?LinkId=241573).

    При установке ролей, служб ролей и компонентов на работающем физическом сервере можно указать WIM-файл в качестве альтернативного источника файлов компонентов. Исходный путь для WIM-файла должен быть в следующем формате, с **WIM** в качестве префикса и индексом, где файлы компонентов являются суффиксом: **WIM:e:\sources\install.wim:4**. Однако вы не можете использовать WIM-файл непосредственно в качестве источника для установки ролей, служб ролей и компонентов на автономный виртуальный жесткий диск. необходимо подключить автономный виртуальный жесткий диск и указать путь для его подключения к исходным файлам, или же необходимо указать папку, содержащую копию содержимого WIM-файла.

8.  После нажатия кнопки **установить**на странице **ход** установки отображаются ход выполнения установки, результаты и сообщения, такие как предупреждения, сбои или действия по настройке после установки, необходимые для установленных ролей или компонентов. В Windows Server 2012 и более поздних версиях Windows Server можно закрыть мастер добавления ролей и компонентов в ходе установки, а также просмотреть результаты установки или другие сообщения в области **уведомлений** в верхней части консоли Диспетчер сервера. Щелкните значок флага **уведомлений** , чтобы просмотреть дополнительные сведения об установке или других задачах, выполняемых в Диспетчер сервера.

## <a name="install-roles-role-services-and-features-by-using-windows-powershell-cmdlets"></a>Установка ролей, служб ролей и компонентов при помощи командлетов Windows PowerShell
Командлеты развертывания диспетчер сервера для Windows PowerShell работают аналогично мастеру добавления ролей и компонентов на основе графического интерфейса, а также мастера удаления ролей и компонентов с ВАЖНОЙ разницей. В Windows PowerShell, в отличие от мастера добавления ролей и компонентов, средства управления и оснастки для роли не включаются по умолчанию. Чтобы установить средства управления вместе с ролью, добавьте в командлет параметр `IncludeManagementTools` . При установке ролей и компонентов на сервере, на котором выполняется вариант установки Server Core в Windows Server 2012 или более поздних версиях, можно добавить в установку средства управления роли, но средства управления на основе графического интерфейса пользователя и оснастки не могут быть установлены на серверах, на которых выполняется вариант установки Server Core Windows Server. В варианте установки Server Core можно установить только средства командной строки и управления Windows PowerShell.

#### <a name="to-install-roles-and-features-by-using-the-install-windowsfeature-cmdlet"></a>Установка ролей и компонентов при помощи командлета Install-WindowsFeature

1. Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

   > [!NOTE]
   > Если вы устанавливаете роли и компоненты на удаленном сервере, вам не нужно запускать Windows PowerShell с повышенными правами пользователя.

   -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

   -   На **начальном** экране Windows щелкните правой кнопкой мыши плитку Windows PowerShell, а затем на панели приложения щелкните **Запуск от имени администратора**.

2. Введите **Get-WindowsFeature** и нажмите клавишу **ВВОД**, чтобы просмотреть список доступных и установленных ролей и компонентов на локальном сервере. Если локальный компьютер не является сервером или требуются сведения об удаленном сервере, выполните команду **Get-WindowsFeature-computerName <** <em>computer_name</em> **>** , в которой *computer_name* представляет имя удаленного компьютера под управлением Windows Server 2016. Результаты командлета содержат имена команд ролей и компонентов, добавленных в командлет на шаге 4.

   > [!NOTE]
   > В Windows PowerShell 3,0 и более поздних версиях Windows PowerShell нет необходимости импортировать модуль командлета диспетчер сервера в сеанс Windows PowerShell перед выполнением командлетов, которые являются частью модуля. Модуль автоматически импортируется при первом выполнении командлета, входящего в модуль. Кроме того, ни командлеты Windows PowerShell, ни имена функций, используемые с командлетами, учитывают регистр.

3. Введите **Get-Help Install-WindowsFeature**и нажмите клавишу **Ввод** , чтобы просмотреть синтаксис и принять параметры для `Install-WindowsFeature` командлета.

4. Введите следующую команду и нажмите клавишу **Ввод**, где *feature_name* представляет имя команды роли или компонента, которые требуется установить (получено на шаге 2), а *computer_name* представляет удаленный компьютер, на котором необходимо установить роли и компоненты. Несколько значений параметра *имя_компонента* разделяйте запятыми. Параметр `Restart` автоматически перезапускает конечный сервер, если это требуется для установки роли или компонента.

   ```
   Install-WindowsFeature -Name <feature_name> -computerName <computer_name> -Restart
   ```

   Чтобы установить роли и компоненты на автономном виртуальном жестком диске, добавьте оба параметра — `computerName` и `VHD` . Если не добавить параметр `computerName` , то командлет решит, что доступ к виртуальному жесткому диску должен получить локальный компьютер. Параметр `computerName` содержит имя сервера, на котором следует подключить виртуальный жесткий диск, а параметр `VHD` — путь к VHD-файлу на указанном сервере.

   > [!NOTE]
   > Необходимо добавить параметр, `computerName` Если командлет выполняется с компьютера, работающего под управлением клиентской операционной системы Windows.
   >
   > Для установки ролей и компонентов на автономных виртуальных жестких дисках целевые виртуальные жесткие диски должны отвечать следующим требованиям.
   >
   > -   На виртуальных жестких дисках должен быть установлен выпуск Windows Server, соответствующий используемой версии диспетчер сервера. См. Примечание в начале [установки ролей, служб ролей и компонентов с помощью мастера добавления ролей и компонентов](#install-roles-role-services-and-features-by-using-the-add-roles-and-features-wizard).
   > -   Виртуальные жесткие диски не должны содержать больше одного системного тома или раздела.
   > -   Общая сетевая папка, в которой хранится VHD-файл, должна предоставлять учетной записи компьютера (или локальной системы) для сервера, где будет подключен виртуальный жесткий диск, следующие права доступа. Одной лишь учетной записи пользователя недостаточно. На общем ресурсе можно предоставить разрешения **Чтение** и **Запись** группе **Все**, чтобы разрешить доступ к виртуальному жесткому диску, но из соображений безопасности делать это не рекомендуется.
   >
   >     -   Права на **Чтение и запись** в диалоговом окне **Общий доступ к файлам.**
   >     -   **Полный** доступ на вкладке **Безопасность** диалогового окна **Свойства** файла или папки.

   ```
   Install-WindowsFeature -Name <feature_name> -VHD <path> -computerName <computer_name> -Restart
   ```

   **Пример:** Следующий командлет устанавливает роль доменных служб Active Directory и функцию управления групповая политика на удаленном сервере ContosoDC1. Средства управления и оснастки добавляются с использованием параметра `IncludeManagementTools` , и конечный сервер будет перезагружен автоматически, если этого требует установка.

   ```
   Install-WindowsFeature -Name AD-Domain-Services,GPMC -computerName ContosoDC1 -IncludeManagementTools -Restart
   ```

5. После завершения установки проверьте установку, открыв страницу **все серверы** в Диспетчер сервера, выбрав сервер, на котором установлены роли и компоненты, и просмотрев плитку **роли и компоненты** на странице для выбранного сервера. Можно также запустить командлет, `Get-WindowsFeature` предназначенный для выбранного сервера (Get-WindowsFeature-computerName <*computer_name*>), чтобы просмотреть список ролей и компонентов, установленных на сервере.

## <a name="remove-roles-role-services-and-features-by-using-the-remove-roles-and-features-wizard"></a>Удаление ролей, служб ролей и компонентов с помощью мастера удаления ролей и компонентов
Для удаления ролей, служб ролей и компонентов необходимо войти на сервер с правами администратора. Если вы вошли на локальный компьютер с учетной записью, не имеющей прав администратора на целевом сервере удаления, щелкните правой кнопкой мыши целевой сервер на плитке **Серверы**, выберите **Управлять как** и укажите учетную запись с правами администратора. Сервер, на котором требуется подключить автономный виртуальный жесткий диск, должен быть добавлен в диспетчер серверов. На таком сервере нужны права администратора.

#### <a name="to-remove-roles-and-features-by-using-the-remove-roles-and-features-wizard"></a>Удаление ролей и компонентов с помощью мастера удаления ролей и компонентов

1.  Если диспетчер серверов уже открыт, переходите к следующему шагу. Если диспетчер серверов еще не открыт, откройте его одним из следующих способов.

    -   На рабочем столе Windows запустите диспетчер серверов, щелкнув **Диспетчер серверов** на панели задач Windows.

    -   На **начальном экране** Windows выберите плитку **Диспетчер сервера**.

2.  В меню **Управление** выберите команду **Удалить роли и компоненты**.

3.  На странице **Приступая к работе** проверьте, все ли готово к удалению ролей и компонентов с сервера. Щелкните **Далее**.

4.  На странице **Выбор целевого сервера** выберите сервер из пула серверов или выберите автономный виртуальный жесткий диск. Чтобы выбрать автономный виртуальный жесткий диск, сначала выберите сервер, на котором будет подключен виртуальный жесткий диск, а затем выберите VHD-файл.

    > [!NOTE]
    > Общая сетевая папка, в которой хранится VHD-файл, должна предоставлять учетной записи компьютера (или локальной системы) для сервера, где будет подключен виртуальный жесткий диск, следующие права доступа. Одной лишь учетной записи пользователя недостаточно. На общем ресурсе можно предоставить разрешения **Чтение** и **Запись** группе **Все**, чтобы разрешить доступ к виртуальному жесткому диску, но из соображений безопасности делать это не рекомендуется.
    >
    > -   Права на **Чтение и запись** в диалоговом окне **Общий доступ к файлам.**
    > -   **Полный доступ** на вкладке **Безопасность** в диалоговом окне **Свойства** файла или папки.

    Сведения о добавлении серверов в пул серверов см. [в разделе Добавление серверов в Диспетчер сервера](add-servers-to-server-manager.md). Выбрав конечный сервер, нажмите кнопку **Далее**.

    > [!NOTE]
    > Мастер удаления ролей и компонентов можно использовать для удаления ролей и компонентов с серверов, на которых работает тот же выпуск Windows Server, который поддерживает используемую версию диспетчер сервера. Вы не можете удалить роли, службы ролей или компоненты с серверов под Windows Server 2016, если вы используете диспетчер сервера на Windows Server 2012 R2, Windows Server 2012 или Windows 8. Мастер удаления ролей и компонентов нельзя использовать для удаления ролей и компонентов с серверов под Windows Server 2008 или Windows Server 2008 R2.

5.  Выберите роли, если необходимо, выберите службы ролей и нажмите кнопку **Далее**, чтобы выбрать компоненты.

    По мере продолжения мастер удаления ролей и компонентов автоматически предлагает удалить все роли, службы ролей или компоненты, которые не могут выполняться без удаляемых ролей или компонентов.

    Кроме того, можно отказаться от удаления средств управления и оснасток для ролей на целевом сервере. По умолчанию в мастере удаления ролей и компонентов для удаления выбраны средства управления. Средства управления и оснастки можно оставить, если выбранный сервер планируется использовать для управления ролью на других удаленных серверах.

6.  На странице **Подтверждение выбора компонентов для удаления** проверьте выбранные роли, компоненты и серверы. Если вы готовы удалить роли или компоненты, нажмите кнопку **Удалить**.

7.  После нажатия кнопки **Удалить**на странице **Ход удаления** отображается ход удаления, результаты и сообщения, такие как предупреждения, сбои или необходимые шаги настройки после удаления, например перезапуск сервера назначения. В Windows Server 2012 и более поздних версиях Windows Server можно закрыть мастер удаления ролей и компонентов в ходе удаления, а также просмотреть результаты удаления или другие сообщения в области **уведомления** в верхней части консоли Диспетчер сервера. Щелкните флаг **уведомлений** , чтобы просмотреть дополнительные сведения об операциях удаления или других задачах, выполняемых в Диспетчер сервера.

## <a name="remove-roles-role-services-and-features-by-using-windows-powershell-cmdlets"></a>Удаление ролей, служб ролей и компонентов при помощи командлетов Windows PowerShell
Командлеты развертывания диспетчер сервера для Windows PowerShell работают аналогично мастеру удаления ролей и компонентов на основе графического интерфейса, что существенно отличается. В Windows PowerShell, в отличие от мастера удаления ролей и компонентов, средства управления и оснастки для роли не удаляются по умолчанию. Чтобы удалить средства управления вместе с ролью, добавьте в командлет параметр `IncludeManagementTools` . При удалении ролей и компонентов с сервера, на котором выполняется вариант установки Server Core в Windows Server 2012 или более поздней версии Windows Server, этот параметр удаляет средства командной строки и средств управления Windows PowerShell для указанных ролей и компонентов.

#### <a name="to-remove-roles-and-features-by-using-the-uninstall-windowsfeature-cmdlet"></a>Удаление ролей и компонентов при помощи командлета Uninstall-WindowsFeature

1. Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

   > [!NOTE]
   > При удалении ролей и компонентов с удаленного сервера не нужно запускать Windows PowerShell с повышенными правами пользователя.

   -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

   -   На **начальном** экране Windows щелкните правой кнопкой мыши плитку Windows PowerShell, а затем на панели приложения щелкните **Запуск от имени администратора**.

2. Введите **Get-WindowsFeature** и нажмите клавишу **ВВОД**, чтобы просмотреть список доступных и установленных ролей и компонентов на локальном сервере. Если локальный компьютер не является сервером или требуются сведения об удаленном сервере, выполните команду **Get-WindowsFeature-computerName <** <em>computer_name</em> **>** , в которой *computer_name* представляет имя удаленного компьютера под управлением Windows Server 2016. Результаты командлета содержат имена команд ролей и компонентов, добавленных в командлет на шаге 4.

   > [!NOTE]
   > В Windows PowerShell 3,0 и более поздних версиях Windows PowerShell нет необходимости импортировать модуль командлета диспетчер сервера в сеанс Windows PowerShell перед выполнением командлетов, которые являются частью модуля. Модуль автоматически импортируется при первом выполнении командлета, входящего в модуль. Кроме того, ни командлеты Windows PowerShell, ни имена функций, используемые с командлетами, учитывают регистр.

3. Введите **Get-Help uninstall-WindowsFeature**и нажмите клавишу **Ввод** , чтобы просмотреть синтаксис и принять параметры для `Uninstall-WindowsFeature` командлета.

4. Введите указанный ниже командлет, а затем нажмите клавишу **Ввод**. Здесь *имя_компонента* представляет имя команды роли или компонента, которые требуется удалить (полученной на шаге 2), а *имя_компьютера* — удаленный компьютер, из которого требуется удалить роли и компоненты. Несколько значений параметра *имя_компонента* разделяйте запятыми. Параметр `Restart` автоматически перезапускает конечные серверы, если это требуется для удаления роли или компонента.

   ```
   Uninstall-WindowsFeature -Name <feature_name> -computerName <computer_name> -Restart
   ```

   Чтобы удалить роли и компоненты с автономного виртуального жесткого диска, добавьте оба параметра — `computerName` и `VHD` . Если не добавить параметр `computerName` , то командлет решит, что доступ к виртуальному жесткому диску должен получить локальный компьютер. Параметр `computerName` содержит имя сервера, на котором следует подключить виртуальный жесткий диск, а параметр `VHD` — путь к VHD-файлу на указанном сервере.

   > [!NOTE]
   > Необходимо добавить параметр, `computerName` Если командлет выполняется с компьютера, работающего под управлением клиентской операционной системы Windows.
   >
   > Общая сетевая папка, в которой хранится VHD-файл, должна предоставлять учетной записи компьютера (или локальной системы) для сервера, где будет подключен виртуальный жесткий диск, следующие права доступа. Одной лишь учетной записи пользователя недостаточно. На общем ресурсе можно предоставить разрешения **Чтение** и **Запись** группе **Все**, чтобы разрешить доступ к виртуальному жесткому диску, но из соображений безопасности делать это не рекомендуется.
   >
   > -   Права на **Чтение и запись** в диалоговом окне **Общий доступ к файлам.**
   > -   **Полный** доступ на вкладке **Безопасность** диалогового окна **Свойства** файла или папки.

   ```
   Uninstall-WindowsFeature -Name <feature_name> -VHD <path> -computerName <computer_name> -Restart
   ```

   **Пример:** Следующий командлет удаляет роль доменных служб Active Directory и функцию управления групповая политика с удаленного сервера ContosoDC1. Средства управления и оснастки также удаляются, и конечный сервер будет перезапущен автоматически, если это требуется для удаления.

   ```
   Uninstall-WindowsFeature -Name AD-Domain-Services,GPMC -computerName ContosoDC1 -IncludeManagementTools -Restart
   ```

5. После завершения удаления убедитесь, что роли и компоненты удалены, открыв страницу **все серверы** в Диспетчер сервера, выбрав сервер, с которого были удалены роли и компоненты, и просмотрев плитку **роли и компоненты** на странице для выбранного сервера. Можно также запустить командлет, `Get-WindowsFeature` предназначенный для выбранного сервера (Get-WindowsFeature-computerName <*computer_name*>), чтобы просмотреть список ролей и компонентов, установленных на сервере.

## <a name="install-roles-and-features-on-multiple-servers-by-running-a-windows-powershell-script"></a>Установка ролей и компонентов на нескольких серверах при помощи сценария Windows PowerShell
Хотя мастер добавления ролей и компонентов нельзя использовать для установки ролей, служб ролей и компонентов на нескольких целевых серверах в одном сеансе мастера, можно использовать сценарий Windows PowerShell для установки ролей, служб ролей и компонентов на нескольких целевых серверах, управляемых с помощью диспетчер сервера. Скрипт, используемый для выполнения пакетного развертывания, по мере вызова этого процесса указывает на XML-файл конфигурации, который можно легко создать с помощью мастера добавления ролей и компонентов, а также нажав кнопку **Экспорт параметров конфигурации** после перехода мастера на страницу **Подтверждение выбора установки** в мастере добавления ролей и компонентов.

> [!IMPORTANT]
> На всех целевых серверах, указанных в сценарии, должен выполняться выпуск Windows Server, соответствующий версии диспетчер сервера, выполняемой на локальном компьютере. Например, если вы используете диспетчер сервера в Windows 10, вы можете установить роли, службы ролей и компоненты на серверах под Windows Server 2016. Если в установку добавляются средства управления на основе графического пользовательского интерфейса, то процесс установки автоматически преобразует целевые серверы, на которых выполняется установка основных серверных компонентов Windows Server, в режим полной установки (сервер с полным графическим интерфейсом пользователя, также называемый работающей графической оболочкой сервера).
>
> Сценарий, приведенный в этом разделе, является примером того, как можно выполнить пакетное развертывание с помощью `Install-WindowsFeature` командлета и сценария Windows PowerShell. Есть и другие сценарии и методы пакетного развертывания на нескольких серверах. Другие сценарии для развертывания ролей и компонентов можно найти в [репозитории центра сценариев](https://gallery.technet.microsoft.com/ScriptCenter).

#### <a name="to-install-roles-and-features-on-multiple-servers"></a>Установка ролей и компонентов на нескольких серверах

1.  Создайте XML-файл конфигурации, содержащий роли, службы ролей и компоненты, которые необходимо установить на нескольких серверах, если вы еще этого не сделали. Чтобы создать этот файл конфигурации, запустите мастер добавления ролей и компонентов, выберите нужные роли, службы ролей и компоненты и нажмите кнопку **Экспорт параметров конфигурации** после перехода мастера на страницу **Подтверждение выбранных вариантов установки** . Сохраните файл конфигурации в удобном месте. Не нужно нажимать кнопку **Установить** или выполнять мастер до конца, если вы используете его только для создания файла конфигурации.

2.  Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

    -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

    -   На **начальном** экране Windows щелкните правой кнопкой мыши плитку Windows PowerShell, а затем на панели приложения щелкните **Запуск от имени администратора**.

3.  Скопируйте и вставьте следующий скрипт в сеанс Windows PowerShell.

    ```
    function Invoke-WindowsFeatureBatchDeployment {
        param (
            [parameter(mandatory)]
            [string[]] $computerNames,
            [parameter(mandatory)]
            [string] $ConfigurationFilepath
        )

        # Deploy the features on multiple computers simultaneously.
        $jobs = @()
        foreach($computerName in $computerNames) {
            $jobs += start-Job -Command {
                Install-WindowsFeature -ConfigurationFilepath $using:ConfigurationFilepath -computerName $using:computerName -Restart
            }
        }

        Receive-Job -Job $jobs -Wait | select-Object Success, RestartNeeded, exitCode, FeatureResult
    }
    ```

    Целевые серверы будут автоматически перезапущены, если этого требуют выбранные роли и компоненты.

4.  Запустите функцию следующим образом.

    1.  Создайте переменную, где будут храниться имена конечных компьютеров, разделенные запятыми. В следующем примере в переменной `$ServerNames` хранятся имена целевых серверов *Contoso_01* и *Contoso_02*. Нажмите клавишу **ВВОД**.

        ```
        # Sample Invocation
        $ServerNames = 'Contoso_01','Contoso_02'
        Invoke-WindowsFeatureBatchDeployment -computerNames $ServerNames -ConfigurationFilepath C:\Users\sampleuser\Desktop\DeploymentConfigTemplate.xml
        ```

    2.  Чтобы запустить функцию, введите следующую команду и нажмите клавишу **ВВОД**, где `$ServerNames` — пример переменной, созданной в предыдущем шаге, а *C:\Users\Sampleuser\Desktop\DeploymentConfigTemplate.xml* — пример пути к файлу конфигурации, созданному на шаге 1.

        **Invoke-Виндовсфеатуребатчдеплоймент-computerNames $ServerNames-Конфигуратионфилепас C:\Users\Sampleuser\Desktop\DeploymentConfigTemplate.xml**

5.  После завершения установки проверьте установку, открыв страницу **все серверы** в Диспетчер сервера, выбрав сервер, на котором установлены роли и компоненты, и просмотрев плитку **роли и компоненты** на странице для выбранного сервера. Можно также запустить командлет, `Get-WindowsFeature` предназначенный для определенного сервера ( `Get-WindowsFeature -computerName`  < *computer_name*>), чтобы просмотреть список ролей и компонентов, установленных на сервере.

## <a name="install-net-framework-35-and-other-features-on-demand"></a>Установка по требованию .NET Framework 3.5 и других компонентов
начиная с Windows Server 2012 и Windows 8, файлы компонентов для .NET Framework 3,5 (которые включают .NET Framework 2,0 и .NET Framework 3,0) недоступны на локальном компьютере по умолчанию. Данные файлы удалены. Файлы компонентов, удаленных в конфигурации функции "Компоненты по требованию", вместе с файлами компонентов для .NET Framework 3.5 доступны в Центре обновления Windows. По умолчанию, если файлы компонентов недоступны на целевом сервере под управлением Windows Server 2012 или более поздней версии, процесс установки выполняет поиск недостающих файлов, подключаясь к Центр обновления Windows. Поведение по умолчанию можно переопределить, настроив параметр групповая политика или указав альтернативный исходный путь во время установки, независимо от того, выполняется ли установка с помощью графического интерфейса мастера добавления ролей и компонентов или командной строки.

Компонент .NET Framework 3.5 можно установить, выполнив одно из описанных ниже действий.

-   Воспользуйтесь разделом [Порядок установки .NET Framework 3.5 с помощью командлета Install-WindowsFeature](#to-install-net-framework-35-by-running-the-install-windowsfeature-cmdlet), чтобы добавить параметр `Source`, и укажите источник файлов компонентов .NET Framework 3.5. Без добавления параметра `Source` в процессе установки сначала определяется, указан ли путь к файлам компонентов в параметрах групповой политики, и если такой путь не найден, поиск недостающих файлов компонентов осуществляется с помощью Центра обновления Windows.

-   Используйте [для установки .NET Framework 3,5 с помощью мастера добавления ролей и компонентов](#to-install-net-framework-35-by-using-the-add-roles-and-features-wizard) , чтобы указать альтернативное расположение исходного файла на странице **Подтверждение параметров установки** мастера добавления ролей и компонентов.

-   Воспользуйтесь разделом [Установка .NET Framework 3.5 с помощью DISM](#to-install-net-framework-35-by-using-dism), чтобы получить файлы из Центра обновления Windows по умолчанию или указав исходный путь к установочному носителю.

[Настройте альтернативные источники файлов компонентов в групповой политике](#configure-alternate-sources-for-feature-files-in-group-policy) для .NET Framework 3.5 или других компонентов, если файлы компонентов не обнаружены на локальном компьютере.

> [!IMPORTANT]
> При установке файлов компонентов из удаленного источника права на **Чтение** в исходном пути или файловом ресурсе общего доступа необходимо присвоить группе **Все** (не рекомендуется по соображениям безопасности) или учетной записи компьютера (локальная система) конечного сервера; предоставления доступа учетной записи пользователя недостаточно.
>
> Серверы в рабочих группах не могут получить доступ к внешним файловым ресурсам, даже если учетная запись компьютера для сервера рабочей группы имеет права на **Чтение** внешнего общего ресурса. Другие исходные расположения, действующие для серверов рабочих групп, включают установочные носители, Центр обновления Windows и VHD- или WIM-файлы, хранящиеся на локальном сервере рабочей группы.
>
> При установке ролей, служб ролей и компонентов на работающем физическом сервере можно указать WIM-файл в качестве альтернативного источника файлов компонентов. Исходный путь для WIM-файла должен быть в следующем формате, с **WIM** в качестве префикса и индексом, где файлы компонентов являются суффиксом: **WIM:e:\sources\install.wim:4**. Однако вы не можете использовать WIM-файл непосредственно в качестве источника для установки ролей, служб ролей и компонентов на автономный виртуальный жесткий диск. необходимо подключить автономный виртуальный жесткий диск и указать путь для его подключения к исходным файлам, или же необходимо указать папку, содержащую копию содержимого WIM-файла.

### <a name="to-install-net-framework-35-by-running-the-install-windowsfeature-cmdlet"></a>Порядок установки .NET Framework 3.5 с помощью командлета Install-WindowsFeature

1.  Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

    > [!NOTE]
    > Если вы устанавливаете роли и компоненты с удаленного сервера, не нужно запускать Windows PowerShell с повышенными правами пользователя.

    -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

    -   На **начальном** экране Windows щелкните правой кнопкой мыши плитку Windows PowerShell, а затем на панели приложения щелкните **Запуск от имени администратора**.

    -   На сервере, на котором работает вариант установки Server Core Windows Server 2012 R2 или Windows Server 2012, введите **PowerShell** в командную строку и нажмите клавишу **Ввод**.

2.  Введите следующую команду и нажмите клавишу **Ввод**. В примере ниже исходные файлы находятся в хранилище параллельных компонентов (также называется **SxS**) на установочном носителе на диске D.

    ```
    Install-WindowsFeature NET-Framework-Core -Source D:\Sources\SxS
    ```

    Если нужно, чтобы в качестве источника недостающих файлов компонентов использовался Центр обновления Windows, или источник по умолчанию уже настроен с помощью групповой политики, параметр `Source` следует добавлять только для указания альтернативного источника.

### <a name="to-install-net-framework-35-by-using-the-add-roles-and-features-wizard"></a>Установка .NET Framework 3,5 с помощью мастера добавления ролей и компонентов

1. В меню **Управление** в Диспетчер сервера выберите команду **Добавить роли и компоненты**.

2. Выберите целевой сервер под Windows Server 2016.

3. На странице **Выбор компонентов** мастера добавления ролей и компонентов выберите **.NET Framework 3,5**.

4. Если локальному компьютеру разрешено это делать настройками групповой политики, процесс установки пытается получить недостающие файлы компонентов с помощью Центра обновления Windows. Нажмите кнопку **Установить**; переходить к следующему шагу не нужно.

   Если параметры групповая политика не допускают этого, или вы хотите использовать другой источник для файлов компонентов .NET Framework 3,5, на странице мастера **Подтверждение выбора установки** нажмите **указать альтернативный исходный путь**.

5. Предоставьте путь к хранилищу соседствующих (side-by-side) компонентов (также называется **SxS**) в установочном носителе или к WIM-файлу. В примере ниже установочный носитель находится на диске D.

   **д:\саурцес\сксс\\**

   Чтобы указать WIM-файл, добавьте префикс **WIM:** и индекс образа для использования в WIM-файле в качестве суффикса, как показано в примере ниже.

   **WIM- \\ \\ файл:** <em>server_name</em>**\шаре\инсталл.Вим: 3**

6. Нажмите кнопку **ОК**, а затем кнопку **Установить**.

### <a name="to-install-net-framework-35-by-using-dism"></a>Установка .NET Framework 3.5 с помощью DISM

1.  Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

    > [!NOTE]
    > Если вы устанавливаете роли и компоненты с удаленного сервера, не нужно запускать Windows PowerShell с повышенными правами пользователя.

    -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

    -   На **начальном** экране Windows щелкните правой кнопкой мыши плитку Windows PowerShell, а затем на панели приложения щелкните **Запуск от имени администратора**.

    -   На сервере, на котором работает вариант установки Server Core, введите **PowerShell** в командную строку и нажмите клавишу **Ввод**.

2.  Используйте одну из указанных ниже команд DISM.

    -   Если компьютер имеет доступ к Центр обновления Windows или расположение исходного файла по умолчанию уже настроено в групповая политика, выполните следующую команду.

        ```
        DISM /online /Enable-Feature /Featurename:NetFx3 /All
        ```

    -   Если у компьютера есть доступ к установочному носителю, выполните команду, аналогичную приведенной ниже. В примере ниже установочный носитель операционной системы находится на диске D. Параметр `LimitAccess` не позволяет команде связаться с Центром обновления Windows или сервером, на котором выполняются службы WSUS.

        ```
        DISM /online /Enable-Feature /Featurename:NetFx3 /All /LimitAccess /Source:d:\sources\sxs
        ```

    > [!NOTE]
    > В команде DISM учитывается регистр.

### <a name="configure-alternate-sources-for-feature-files-in-group-policy"></a>Настройка альтернативных источников файлов компонентов в групповой политике
Параметр групповой политики, описанный в этом разделе, указывает расположение авторизованного источника файлов .NET Framework 3.5 и файлов других компонентов, которые удалены как часть конфигурации "Компоненты по требованию". Параметр политики **задает параметры для установки дополнительных компонентов и восстановления компонентов** находится в папке **компьютер \ конфигурация темплатес\систем** в консоль управления групповыми политиками или в редакторе локальных групповая политика.

> [!NOTE]
> Для изменения параметров групповой политики на локальном компьютере требуется быть членом группы "Администраторы". Если параметры групповой политики нужного компьютера управляются на уровне домена, для их изменения необходимо быть членом группы "Администраторы домена".

##### <a name="to-configure-a-default-alternate-source-path-in-group-policy"></a>Порядок настройки пути по умолчанию к альтернативному источнику в групповой политике

1. В редакторе локальных групповая политика или консоль управления групповыми политиками откройте следующий параметр политики.

   **компьютер \ конфигурация Темплатес\систем\спеЦифи параметры для установки дополнительного компонента и восстановления компонентов**

2. Сселект **включено** , чтобы включить параметр политики, если он еще не включен.

3. В текстовом поле **Альтернативный путь к исходным файлам** в области **Параметры** укажите полный путь к общей папке или WIM-файлу. Чтобы указать WIM-файл в качестве альтернативного расположения исходных файлов, добавьте префикс **WIM:** к пути и индекс образа для использования в WIM-файле в качестве суффикса. Ниже приводятся примеры возможных значений.

   - путь к общей папке: **\\\\** <em>server_name</em>**\шаре \\ **<em>folder_name</em>

   - путь к WIM-файлу, в котором **3** представляет индекс изображения, в котором найдены файлы компонентов: **WIM: \\ \\ **<em>server_name</em>**\шаре\инсталл.Вим: 3**

4. Если вы не хотите, чтобы на компьютерах, управляемых этим параметром политики, выполнялся поиск отсутствующих файлов компонентов в Центр обновления Windows, установите флажок **никогда не пытаться скачивать полезные данные из центр обновления Windows**.

5. Если компьютеры, которые управляются данным параметром политики обычно получают обновления с помощью служб WSUS, но вы предпочитаете использовать для поиска недостающих файлов компонентов Центр обновления Windows, а не WSUS, выберите **Напрямую обращаться в Центр обновления Windows, чтобы загрузить контент для восстановления вместо использования служб WSUS**.

6. После завершения изменения данного параметра политики нажмите кнопку **ОК**, а затем закройте редактор групповых политик.

## <a name="see-also"></a>См. также:
Параметры установки Windows [Server](https://go.microsoft.com/fwlink/p/?LinkId=241573) 
 Рекомендации по развертыванию [Microsoft .NET Framework 3,5](https://go.microsoft.com/fwlink/p/?LinkId=248869) 
 [Включение и отключение функций Windows](https://go.microsoft.com/fwlink/p/?LinkId=246552)



