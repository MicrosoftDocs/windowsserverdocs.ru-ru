---
title: Configure Features on Demand in Windows Server
description: Диспетчер серверов
ms.topic: article
ms.assetid: e663bbea-d025-41fa-b16c-c2bff00a88e8
ms.author: lizross
author: eross-msft
manager: mtillman
ms.date: 10/16/2017
ms.openlocfilehash: 3f35b9cab30dcccbdc364d0fc76ec56aa4326b71
ms.sourcegitcommit: db2d46842c68813d043738d6523f13d8454fc972
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2020
ms.locfileid: "89628370"
---
# <a name="configure-features-on-demand-in-windows-server"></a>Configure Features on Demand in Windows Server

>Область применения. Windows Server 2016

В данном разделе описывается удаление файлов компонентов в конфигурации функции "Компоненты по требованию" с помощью командлета Uninstall-WindowsFeature.

Функции по запросу — это функция, появившаяся в Windows 8 и Windows Server 2012, которая позволяет удалять файлы ролей и компонентов (иногда называемые *полезной*нагрузкой компонентов) из операционной системы для экономии места на диске, а также устанавливать роли и компоненты из удаленных расположений или установочных носителей, а не с локальных компьютеров. Можно удалять файлы компонентов с работающих физических или виртуальных компьютеров. Также можно добавлять или удалять файлы компонентов из файлов образа Windows (WIM) или автономных виртуальных жестких дисков, чтобы создать воспроизводимую копию конфигураций функции "Компоненты по требованию".

В конфигурации компонентов по требованию, когда файлы компонентов недоступны на компьютере, если для установки требуются эти файлы, Windows Server 2012 R2 или Windows Server 2012 можно направлять для получения файлов из параллельного хранилища компонентов (общей папки, содержащей файлы компонентов и доступной для компьютера в сети), с Центр обновления Windows или с установочного носителя. По умолчанию, если файлы компонентов на целевом сервере недоступны, то для поиска отсутствующих файлов компонентов функция "Компоненты по требованию" выполняет следующие задачи в указанном ниже порядке:

1.  Поиск в расположении, указанном пользователями мастера добавления ролей и компонентов или команд установки DISM

2.  Оценка конфигурации параметра групповая политика, **Параметры компьютера \ конфигурация темплатес\систем\спеЦифи для установки дополнительного компонента и восстановление компонентов**

3.  поиск в Центре обновления Windows.

Можно переопределить реакцию функции "Компоненты по требованию" на событие посредством любого из следующих действий:

-   указания альтернативного исходного пути командлета `Install-WindowsFeature` путем добавления параметра `Source`;

-   Указание альтернативного исходного пути на странице " **Подтверждение параметров установки** " во время установки компонентов с помощью мастера добавления ролей и компонентов

-   настройки параметра групповой политики **Указать параметры установки дополнительных компонентов и восстановления компонентов**.

В этом разделе содержатся следующие подразделы.

-   [Создание файла компонента или параллельного хранилища](#BKMK_store)

-   [Методы удаления файлов компонентов](#BKMK_methods)

-   [Удаление файлов компонентов с помощью командлета Uninstall-WindowsFeature](#BKMK_remove)

## <a name="create-a-feature-file-or-side-by-side-store"></a><a name=BKMK_store></a>Создание файла компонента или параллельного хранилища
В этом разделе описывается настройка общей папки с удаленным компонентом (также называемой параллельным хранилищем), в которой хранятся файлы, необходимые для установки ролей, служб ролей и компонентов на серверах под управлением Windows Server 2012 R2 или Windows Server 2012. После настройки хранилища признаков можно установить роли, службы ролей и компоненты на серверах, работающих под управлением этих операционных систем, и указать хранилище компонентов в качестве расположения исходных файлов установки.

#### <a name="to-create-a-feature-file-store"></a>Создание хранилища файлов компонентов

1.  Создайте общую папку на сервере в вашей сети. Например, * \\ \нетворк\шаре\сксс*.

2.  Проверьте, что хранилищу компонентов назначены правильные разрешения. Исходный путь или общая папка должны предоставлять разрешения на **Чтение** для группы " **все** " (не рекомендуется по соображениям безопасности) или учетных записей компьютеров (*домен* \\ *SERverNAME*$) серверов, на которых планируется устанавливать компоненты, с помощью этого хранилища функций; предоставление доступа к учетной записи пользователя не является достаточным.

    Общий доступ к файлам и настройке разрешений можно получить, выполнив одно из следующих действий на рабочем столе Windows.

    -   Щелкните правой кнопкой мыши общую папку, нажмите **Свойства**, а затем на вкладке **Безопасность** измените разрешенных пользователей и их права доступа к папке.

    -   Щелкните правой кнопкой мыши общую папку, укажите **Общий доступ** и щелкните **Конкретные пользователи**.

    > [!NOTE]
    > Серверы в рабочих группах не могут получить доступ к внешним файловым ресурсам, даже если учетная запись компьютера для сервера рабочей группы имеет права на **Чтение** внешнего общего ресурса. Другие исходные расположения, действующие для серверов рабочих групп, включают установочные носители, Центр обновления Windows и VHD- или WIM-файлы, хранящиеся на локальном сервере рабочей группы.

3.  Скопируйте папку **Sources\SxS** из вашего носителя установки Windows Server в общую папку, созданную на шаге 1.

## <a name="methods-of-removing-feature-files"></a><a name=BKMK_methods></a>Методы удаления файлов компонентов
Для удаления файлов компонентов из Windows Server в конфигурации функции "Компоненты по требованию" доступно два метода.

-   `remove`Параметр `Uninstall-WindowsFeature` командлета позволяет удалять файлы компонентов с сервера или с неподключенного виртуального жесткого диска (VHD) под windows Server 2012 R2 или windows Server 2012. Допустимые значения `remove` параметра — это имена ролей, служб ролей и компонентов.

-   С помощью команды системы обслуживания образов развертывания и управления ими (DISM) можно создавать пользовательские WIM-файлы, позволяющие экономить дисковое пространство путем пропуска файлов компонентов, которые не требуются или могут быть получены из других, удаленных источников. Дополнительные сведения об использовании DISM для подготовки пользовательских образов см. в разделе [Включение и отключение компонентов Windows](/previous-versions/windows/it-pro/windows-8.1-and-8/hh824822(v=win.10)).

## <a name="remove-feature-files-by-using-uninstall-windowsfeature"></a><a name=BKMK_remove></a>Удаление файлов компонентов с помощью командлета Uninstall-WindowsFeature
Командлет Uninstall-WindowsFeature можно использовать для удаления ролей, служб ролей и компонентов с серверов и автономных виртуальных жестких дисков, работающих под управлением Windows Server 2012 R2 или Windows Server 2012, а также для удаления файлов компонентов. При необходимости можно удалить и удалить те же роли, службы ролей и компоненты в одной и той же команде.

> [!IMPORTANT]
> При удалении файлов компонентов для роли, службы роли или компонента, ролей, служб ролей и компонентов, которые зависят от удаляемых файлов, также удаляются. Если вы удаляете файлы компонентов для службы роли или подфункции и для родительской роли или функции больше не установлено служб ролей или подфункций, то файлы для всей родительской роли или функции удаляются. Для просмотра всех файлов компонентов, которые может удалить команда `Uninstall-WindowsFeature -remove`, добавьте в команду параметр `whatif`, чтобы выполнить ее и просмотреть результаты без фактического удаления файлов.

#### <a name="to-remove-role-and-feature-files-by-using-uninstall-windowsfeature"></a>Удаление файлов ролей и компонентов с помощью командлета Uninstall-WindowsFeature

1.  Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

    > [!NOTE]
    > При удалении ролей и компонентов с удаленного сервера не нужно запускать Windows PowerShell с повышенными правами пользователя.

    -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

    -   На **начальном** экране Windows щелкните правой кнопкой мыши плитку Windows PowerShell, а затем на панели приложения щелкните **Запуск от имени администратора**.

    -   На сервере, на котором работает вариант установки Server Core, введите **PowerShell** в командную строку и нажмите клавишу **Ввод**.

2.  Введите следующую команду и нажмите клавишу **ВВОД**:

    ```
    Uninstall-WindowsFeature -Name <feature_name> -computerName <computer_name> -remove
    ```

    **Пример:** "Лицензирование удаленных рабочих столов" является последней установленной службой роли из служб удаленных рабочих столов. Команда удаляет лицензирование удаленных рабочих столов, а затем удаляет файлы компонентов всей роли служб удаленных рабочих столов с указанного сервера *contoso_1*.

    ```
    Uninstall-WindowsFeature -Name rdS-Licensing -computerName contoso_1 -remove
    ```

    **Пример:** В следующем примере команда удаляет доменные службы Active Directory и групповая политика управления с автономного диска VHD. Сначала удаляются роль и компонент, затем файлы их компонентов окончательно удаляются с автономного виртуального жесткого диска, *Contoso.vhd*.

    > [!NOTE]
    > Необходимо добавить параметр, `computerName` Если командлет выполняется с компьютера, на котором выполняется Windows 8.1 или Windows 8.
    >
    > Если ввести имя VHD-файла из общей сетевой папки, то этот общий ресурс должен предоставить разрешения на **Чтение** и **запись** учетной записи компьютера сервера, выбранного для подключения виртуального жесткого диска. Одной лишь учетной записи пользователя недостаточно. На общем ресурсе можно предоставить разрешения **Чтение** и **Запись** группе **Все**, чтобы разрешить доступ к виртуальному жесткому диску, но из соображений безопасности делать это не рекомендуется.

    ```
    Uninstall-WindowsFeature -Name AD-Domain-Services,GPMC -VHD C:\WS2012VHDs\Contoso.vhd -computerName ContosoDC1
    ```

## <a name="see-also"></a>См. также:
[Установка и удаление ролей, служб ролей или компонентов](install-or-uninstall-roles-role-services-or-features.md) 
 Параметры установки Windows [Server](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831786(v=ws.11)) 
 [Включение и отключение функций Windows](/previous-versions/windows/it-pro/windows-8.1-and-8/hh824822(v=win.10)) 
 [Обзор системы обслуживания образов развертывания и управления ими (DISM)](/previous-versions/windows/it-pro/windows-8.1-and-8/hh825236(v=win.10))