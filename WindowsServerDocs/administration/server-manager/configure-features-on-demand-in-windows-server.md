---
title: Настройка компонентов по требованию в Windows Server
description: Диспетчер серверов
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: manage-server-manager
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: e663bbea-d025-41fa-b16c-c2bff00a88e8
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: c77bd088a02d405b17a4f7decd6093785296d5e8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59818935"
---
# <a name="configure-features-on-demand-in-windows-server"></a>Настройка компонентов по требованию в Windows Server

>Область применения. Windows Server 2016

В данном разделе описывается удаление файлов компонентов в конфигурации функции "Компоненты по требованию" с помощью командлета Uninstall-WindowsFeature.

Компоненты по требованию — это функция, представленная в Windows 8 и Windows Server 2012, которая позволяет удалять файлы ролей и компонентов (иногда называемых *полезных данных*) из операционной системы для экономии места на диске и установки ролей и компоненты из удаленных расположений или с носителей установки, а не с локальных компьютеров. Можно удалять файлы компонентов с работающих физических или виртуальных компьютеров. Также можно добавлять или удалять файлы компонентов из файлов образа Windows (WIM) или автономных виртуальных жестких дисков, чтобы создать воспроизводимую копию конфигураций функции "Компоненты по требованию".

В компоненты по требованию конфигурации Если файлы компонентов недоступны на компьютере, если для установки необходимы эти файлы компонентов Windows Server 2012 R2 или Windows Server 2012 может быть перенаправлен к получить файлы из хранилища side-by-side компонентов (общую папку содержит файлы компонентов и доступную для компьютера в сети), Центр обновления Windows или с установочного носителя. По умолчанию, если файлы компонентов на целевом сервере недоступны, то для поиска отсутствующих файлов компонентов функция "Компоненты по требованию" выполняет следующие задачи в указанном ниже порядке:

1.  Поиск в расположении, указанном пользователями Добавить роли и функции мастера или командами установки DISM

2.  Оценку конфигурации параметра групповой политики **компьютера Конфигурация компьютера\Административные шаблоны\система\указать параметры установки дополнительных компонентов и восстановления компонентов**

3.  поиск в Центре обновления Windows.

Можно переопределить реакцию функции "Компоненты по требованию" на событие посредством любого из следующих действий:

-   указания альтернативного исходного пути командлета `Install-WindowsFeature` путем добавления параметра `Source` ;

-   Указания альтернативного исходного пути на **Подтверждение параметров установки** странице во время установки компонентов с помощью Добавить роли и функции мастера

-   настройки параметра групповой политики **Указать параметры установки дополнительных компонентов и восстановления компонентов**.

Эта статья содержит следующие разделы.

-   [Создание файла компонента или store side-by-side](#BKMK_store)

-   [Методы удаления файлов компонентов](#BKMK_methods)

-   [Удаление файлов компонентов с помощью командлета Uninstall-WindowsFeature](#BKMK_remove)

## <a name="BKMK_store"></a>Создание файла компонента или store side-by-side
В этом разделе описывается, как настроить функцию удаленной общей папки с файлами (также называемой хранилищем side-by-side), хранящую файлы, необходимые для установки ролей, служб ролей и компонентов на серверах под управлением Windows Server 2012 R2 или Windows Server 2012. После настройки хранилища компонентов можно установить ролей, служб ролей и компонентов на серверах, работающих под управлением этих операционных систем и указать хранилище компонентов в качестве расположения файлов источника установки.

#### <a name="to-create-a-feature-file-store"></a>Создание хранилища файлов компонентов

1.  Создайте общую папку на сервере в вашей сети. Например  *\\\network\share\sxs*.

2.  Проверьте, что хранилищу компонентов назначены правильные разрешения. Источника пути или файловом ресурсе должны быть предоставлены **чтения** разрешения либо **все** (не рекомендуется по соображениям безопасности), группы или учетным записям компьютера (*домена* \\ *SERverNAME*$) серверов, на которых планируется установка компонентов с помощью хранилища компонентов; предоставления доступа учетной записи пользователя недостаточно.

    Общий доступ к файлам и настройке разрешений можно получить, выполнив одно из следующих действий на рабочем столе Windows.

    -   Щелкните правой кнопкой мыши общую папку, нажмите **Свойства**, а затем на вкладке **Безопасность** измените разрешенных пользователей и их права доступа к папке.

    -   Щелкните правой кнопкой мыши общую папку, укажите **Общий доступ**и щелкните **Конкретные пользователи**.

    > [!NOTE]
    > Серверы в рабочих группах не могут получить доступ к внешним файловым ресурсам, даже если учетная запись компьютера для сервера рабочей группы имеет права на **Чтение** внешнего общего ресурса. Другие исходные расположения, действующие для серверов рабочих групп, включают установочные носители, Центр обновления Windows и VHD- или WIM-файлы, хранящиеся на локальном сервере рабочей группы.

3.  Скопируйте папку **Sources\SxS** из вашего носителя установки Windows Server в общую папку, созданную на шаге 1.

## <a name="BKMK_methods"></a>Методы удаления файлов компонентов
Для удаления файлов компонентов из Windows Server в конфигурации функции "Компоненты по требованию" доступно два метода.

-   `remove` Параметр `Uninstall-WindowsFeature` командлета позволяет удалять файлы компонентов с сервера или автономного виртуального жесткого диска (VHD) под управлением Windows Server 2012 R2 или Windows Server 2012. Допустимые значения для `remove` параметр — это имена ролей, служб ролей и компонентов.

-   С помощью команды системы обслуживания образов развертывания и управления ими (DISM) можно создавать пользовательские WIM-файлы, позволяющие экономить дисковое пространство путем пропуска файлов компонентов, которые не требуются или могут быть получены из других, удаленных источников. Дополнительные сведения об использовании DISM для подготовки пользовательских образов см. в разделе [Включение и отключение компонентов Windows](https://technet.microsoft.com/library/hh824822.aspx).

## <a name="BKMK_remove"></a>Удаление файлов компонентов с помощью командлета Uninstall-WindowsFeature
Командлет Uninstall-WindowsFeature можно использовать как для удаления ролей, служб ролей и компонентов с серверов и автономных виртуальных жестких дисков, работающих под управлением Windows Server 2012 R2 или Windows Server 2012, так и для удаления файлов компонентов. Можно удалить и удаление ролей, служб ролей и компонентов в одной команде, при необходимости.

> [!IMPORTANT]
> При удалении файлов компонентов для роли, службы роли или компонент, ролей, служб ролей и функций, которые зависят от файлов, которые вы удаляете также удаляются. Если вы удаляете файлы компонентов для службы роли или подфункции и для родительской роли или функции больше не установлено служб ролей или подфункций, то файлы для всей родительской роли или функции удаляются. Для просмотра всех файлов компонентов, которые может удалить команда `Uninstall-WindowsFeature -remove`, добавьте в команду параметр `whatif`, чтобы выполнить ее и просмотреть результаты без фактического удаления файлов.

#### <a name="to-remove-role-and-feature-files-by-using-uninstall-windowsfeature"></a>Удаление файлов ролей и компонентов с помощью командлета Uninstall-WindowsFeature

1.  Выполните одно из следующих действий, чтобы открыть сеанс Windows PowerShell с повышенными правами.

    > [!NOTE]
    > Если вы удаляете роли и компоненты с удаленного сервера, запустите Windows PowerShell с повышенными правами пользователя не нужно.

    -   На рабочем столе Windows щелкните правой кнопкой мыши **Windows PowerShell** на панели задач и выберите команду **Запустить от имени администратора**.

    -   В Windows **запустить** экрана, щелкните правой кнопкой мыши плитку Windows PowerShell и затем на панели приложения щелкните **Запуск от имени администратора**.

    -   На сервере, на котором выполняется вариант установки основных серверных компонентов, введите **PowerShell** в командной строке, а затем нажмите клавишу **ввод**.

2.  Введите следующую команду и нажмите клавишу **ВВОД**:

    ```
    Uninstall-WindowsFeature -Name <feature_name> -computerName <computer_name> -remove
    ```

    **Пример:** Лицензирование удаленных рабочих столов является последней установленной службой роли служб удаленных рабочих столов, которая устанавливается. Команда удаляет лицензирование удаленных рабочих столов, а затем удаляет файлы компонентов всей роли служб удаленных рабочих столов с указанного сервера *contoso_1*.

    ```
    Uninstall-WindowsFeature -Name rdS-Licensing -computerName contoso_1 -remove
    ```

    **Пример:** В следующем примере команда удаляет доменные службы active directory и управление групповой политикой из автономного виртуального жесткого диска. Сначала удаляются роль и компонент, затем файлы их компонентов окончательно удаляются с автономного виртуального жесткого диска, *Contoso.vhd*.

    > [!NOTE]
    > Необходимо добавить `computerName` параметра, если вы запускаете командлет с компьютера, выполняется Windows 8.1 или Windows 8.
    > 
    > Если вы вводите имя VHD-файла из общей сетевой папки, этот ресурс должен предоставить **чтения** и **записи** разрешения учетной записи компьютера сервера, выбранного для подключения виртуальный жесткий ДИСК. Одной лишь учетной записи пользователя недостаточно. На общем ресурсе можно предоставить разрешения **Чтение** и **Запись** группе **Все**, чтобы разрешить доступ к виртуальному жесткому диску, но из соображений безопасности делать это не рекомендуется.

    ```
    Uninstall-WindowsFeature -Name AD-Domain-Services,GPMC -VHD C:\WS2012VHDs\Contoso.vhd -computerName ContosoDC1
    ```

## <a name="see-also"></a>См. также
[Установка и удаление ролей, служб ролей и компонентов](install-or-uninstall-roles-role-services-or-features.md)
[варианты установки Windows Server](https://technet.microsoft.com/library/hh831786.aspx)
[как включение и отключение компонентов Windows](https://technet.microsoft.com/library/hh824822.aspx) 
 [Развертывания системы обслуживания образов и управления (ими DISM) Обзор](https://technet.microsoft.com/library/hh825236.aspx)


