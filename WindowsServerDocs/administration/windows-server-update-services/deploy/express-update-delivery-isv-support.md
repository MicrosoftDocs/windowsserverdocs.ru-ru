---
title: Поддержка экспресс-доставки обновлений для независимых поставщиков программного обеспечения
description: Узнайте о службе Windows Server Update Service (WSUS), в т. ч. о том, как независимые поставщики программного обеспечения могут настраивать доставку экспресс-обновлений с использованием WSUS.
ms.topic: how-to
author: brentfor
ms.author: brentf
manager: mtillman
ms.date: 10/16/2017
ms.openlocfilehash: 1c677fbd56b21d69e7c9641583b5949aa2870480
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97947620"
---
# <a name="express-update-delivery-isv-support"></a>Поддержка экспресс-доставки обновлений для независимых поставщиков программного обеспечения

>Область применения. Windows 10, Windows Server 2016

Загружаемые обновления Windows 10 могут быть большими, так как каждый пакет содержит все ранее выпущенные исправления для простоты и обеспечения согласованности.

Начиная с версии 7, Windows позволяет уменьшить размер загружаемых Центром обновления Windows файлов с помощью функции [экспресс-доставки](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc708456(v=ws.10)#Anchor_2). По умолчанию все клиентские устройства поддерживают эту функцию, но на устройствах Windows 10 Корпоративная требуется служба Windows Server Update Services (WSUS).

## <a name="how-microsoft-supports-express"></a>Как корпорация Майкрософт поддерживает функцию экспресс-доставки

- **Экспресс-доставка в автономной службе WSUS**

    Экспресс-доставка обновлений уже [доступна во всех поддерживаемых версиях WSUS](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc708456(v=ws.10)).

- **Экспресс-доставка на устройствах, подключенных к Центру обновления Windows**

    Клиентские устройства поддерживают экспресс-доставку через клиент Центра обновления Windows, который проверяет, скачивает и устанавливает обновления. На этапе скачивания клиент Центра обновления Windows запрашивает пакеты экспресс-доставки и скачивает соответствующие диапазоны байтов.

-  **Корпоративные устройства, управляемые с помощью [Центра обновления Windows для бизнеса](/windows/deployment/update/waas-manage-updates-wufb)** , также могут воспользоваться экспресс-доставкой обновлений без дополнительной настройки.

## <a name="how-isvs-can-take-advantage-of-express"></a>Как независимые поставщики программного обеспечения могут воспользоваться экспресс-доставкой

Независимые поставщики программного обеспечения могут использовать доставку обновлений через WSUS и клиент Центра обновления Windows. Корпорация Майкрософт рекомендует выполнить следующие три шага, которые подробно описаны в следующих разделах.

1.  [**Настройка WSUS**](#BKMK_1)

    Сервер WSUS требуется для проверки и синхронизации обновлений ([подробнее](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn800972(v=ws.11))).

2.  [**Указание и заполнение файлового кэша независимого поставщика программного обеспечения**](#BKMK_2)

    Для размещения содержимого обновлений мы рекомендуем использовать файловый кэш независимого поставщика программного обеспечения, где хранятся CAB-файлы обновлений и PSF-файлы экспресс-пакетов.

3.  [**Настройка агента клиента независимого поставщика программного обеспечения для управления операциями клиента Центра обновления Windows**](#BKMK_3)

>[!NOTE]
>Должен быть установлен накопительный пакет обновления для выпуска Windows 10 версии 1607 (или более поздней) от января 2017 г. ([KB3213986 (сборка ОС 14393.693)](https://support.microsoft.com/help/4009938/january-10-2017-kb3213986-os-build-14393-693).

   - Агент клиента независимого поставщика программного обеспечения определяет, какие обновления будут утверждены, скачаны и установлены.
   - Клиент Центра обновления Windows определяет диапазоны байтов для скачивания и инициирует запрос на скачивание.

### <a name="step-1-configure-wsus"></a><a name=BKMK_1></a>Шаг 1. Настройка WSUS

Служба WSUS выступает в качестве интерфейса Центра обновления Windows и управляет всеми метаданными с описанием скачиваемых экспресс-пакетов. Если вам нужно выполнить развертывание, см. [**описание службы Windows Server Update Service версии 3.0 с пакетом обновления 2 (SP2)**](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd939931(v=ws.10)). После развертывания службы WSUS следует принять решение, нужно ли хранить содержимое обновлений локально на сервере WSUS. Мы рекомендуем при настройке служб WSUS не настраивать локальное хранение обновлений. При этом предполагается, что у вас уже есть программное обеспечение для управления развертыванием пакетов в локальной среде. Дополнительные сведения о настройке локального хранилища WSUS см. в руководстве по [**выбору расположения для хранения обновлений**](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc720494(v=ws.10)).

### <a name="step-2-specify-and-populate-the-isv-file-cache"></a><a name=BKMK_2></a>Шаг 2. Указание и заполнение файлового кэша независимого поставщика программного обеспечения

#### <a name="specify-the-isv-file-cache"></a>Указание файлового кэша независимого поставщика программного обеспечения

Новые параметры групповой политики и управления мобильными устройствами (MDM) на стороне клиента, которые описаны в [**справочнике поставщика службы конфигурации**](/windows/client-management/mdm/configuration-service-provider-reference), определяют расположение файлового кэша для независимого поставщика программного обеспечения.

| **Имя**                                              | **Описание**                                                                                                                                                      |
|-------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Настройте альтернативное расположение для скачивания обновлений. | Здесь определяется другой сервер в интрасети, на котором будут размещаться обновления из Центра обновления Майкрософт. Вы сможете применить эту службу обновления для автоматического обновления компьютеров в локальной сети. |

Есть два варианта настройки альтернативного расположения для скачивания файлового кэша независимого поставщика программного обеспечения.

1. **Укажите имя узла для HTTP-сервера независимого поставщика программного обеспечения**, который будет выполнять роль файлового кэша.

    В этом варианте клиент Центра обновления Windows будет отправлять запросы на скачивание HTTP-серверу, который указан в политике.

2. **Укажите локальный узел**.

    В этом варианте клиент Центра обновления Windows будет отправлять запросы на скачивание локальному узлу. Так агент клиента независимого поставщика программного обеспечения будет самостоятельно обрабатывать эти запросы и перенаправлять их для выполнения запроса на скачивание.

> [!IMPORTANT]
> Для файлового кэша независимого поставщика программного обеспечения должны выполняться следующие условия:
> - Сервер должен соответствовать стандарту HTTP 1.1 согласно RFC: <http://www.w3.org/Protocols/rfc2616/rfc2616.html> В частности, веб-сервер должен поддерживать запросы [**HEAD**](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html) и [**GET**](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.htm):<br>                                                                                                                                                                                                                                                                                                  – частичные запросы по диапазону;<br>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   – поддержание активности;<br>                                                                                                                                                                                                                                                                                                                                                                                                                            – игнорирование Transfer-Encoding:chunked.

#### <a name="populate-the-isv-file-cache"></a>Заполнение файлового кэша независимого поставщика программного обеспечения

Файловый кэш независимого поставщика программного обеспечения следует заполнить файлами, связанными с обновлениями, которые должны быть установлены на управляемых клиентах.

**Чтобы заполнить файловый кэш независимого поставщика программного обеспечения, сделайте следующее:**

1. С помощью [API WSUS](/previous-versions/windows/desktop/aa354524(v=vs.85)) получите путь и имя файла обновления для службы Центра обновления Майкрософт.

    Метаданные для каждого обновления на сервере WSUS содержат путь и имя файла обновления в Центре обновления Майкрософт в следующем формате (имя узла для Центра обновления Майкрософт выделено полужирным шрифтом, а за ним следует путь к файлу и имя файла): **<http://download.windowsupdate.com>** /c/msdownload/update/software/updt/2016/09/windows10.0-kb3195781-x64_0c06079bccc35cba35a48bd2b1ec46f818bd2e74.msu.

2. Скачайте файлы в Центре обновления Майкрософт и сохраните их в файловом кэше независимого поставщика программного обеспечения с помощью одного из следующих двух методов:

   - Сохраните файлы в **той же папке, которая используется в службе Центра обновления Майкрософт**.

   - Сохраните файлы в **папке, путь к которой определен независимым поставщиком программного обеспечения**.

     Настройте на HTTP-сервера (или на локальном узле) перенаправление запросов **HTTP GET**, которые направляются к папке и файлу в Центре обновления Майкрософт, в расположение файлов независимого поставщика программного обеспечения.

### <a name="step-3-set-up-an-isv-client-agent-to-direct-wu-client-operations"></a><a name=BKMK_3></a>Шаг 3. Настройка агента клиента независимого поставщика программного обеспечения для управления операциями клиента Центра обновления Windows

Агент клиента независимого поставщика программного обеспечения управляет скачиванием и установкой утвержденных обновлений, используя следующий рекомендуемый рабочий процесс:

1.  Агент клиента независимого поставщика программного обеспечения вызывает клиент Центра обновления Майкрософт для проверки сервера WSUS.

2.  Результатом проверки является набор обновлений, применимых к этому клиенту Центра обновления Майкрософт.

3.  Клиент независимого поставщика программного обеспечения определяет, какие обновления будут утверждены, скачаны и установлены.

4.  Агент клиента независимого поставщика программного обеспечения вызывает клиент Центра обновления Майкрософт для скачивания утвержденных обновлений.

5.  Когда скачивание обновлений завершается, агент клиента независимого поставщика программного обеспечения вызывает клиент Центра обновления Майкрософт для установки утвержденных обновлений.

См. сведения об [использовании клиента Центра обновления Майкрософт для проверки, скачивания и установки обновлений](/windows/win32/wua_sdk/searching--downloading--and-installing-updates).

### <a name="download-workflow-options"></a>Варианты рабочего процесса скачивания обновлений

На следующих двух схемах представлены варианты рабочего процесса скачивания файлов из кэша независимого поставщика программного обеспечения.

![Рабочий процесс 1](../../media/express-update-delivery-isv-support/image1.png)

![Рабочий процесс 2](../../media/express-update-delivery-isv-support/image2.png)
### <a name="how-express-download-works"></a>Как работает экспресс-доставка

- Для обновлений операционной системы, которая поддерживает экспресс-доставку, в службе сохраняются следующие две версии файла полезных данных:

  - **Полная версия** по сути заменяет собой локальные версии двоичных файлов обновления.

  - **Экспресс-версия** содержит разностные данные, которых достаточно для исправления существующих двоичных файлов прямо на устройстве.

    Полная версия и экспресс-версия упоминаются в метаданных обновления, которое скачивается на клиент во время фазы сканирования.

    **Экспресс-доставка работает следующим образом:**

    Клиент Центра обновления Windows сначала пытается скачать экспресс-версию, а в некоторых ситуациях при необходимости возвращается к полной версии файла (например, если запрос идет через прокси-сервер, не поддерживающий запросы диапазона байтов).

  1. Когда клиент Центра обновления Windows инициирует скачивание экспресс-версии, **клиент Центра обновления Windows сначала скачивает заглушку**, которая входит в пакет Express.

  2. **Клиент Центра обновления Windows передает эту заглушку установщику Windows**, который использует заглушку для локальной проверки, сравнивая разностные данные файла на устройстве и необходимые элементы для получения последней версии предлагаемого файла.

  3. Затем **установщик Windows обращается к клиенту Центра обновления Windows для скачивания диапазонов**, которые были определены как обязательные.

  4. **Клиент Центра обновления Windows скачивает эти диапазоны и передает их установщику Windows**, который в свою очередь применяет диапазоны и определяет, нужны ли дополнительные диапазоны. Это повторяется, пока установщик Windows не сообщит клиенту Центра обновления Windows о том, что все необходимые диапазоны уже скачаны.

  На этом этапе скачивание завершено и обновления готовы к установке.

### <a name="how-delivery-optimization-reduces-bandwidth-consumption"></a>Как оптимизация доставки снижает нагрузку на сеть

Оптимизация доставки — это самостоятельное решение с распределенным кэшем для компаний, которым требуется снизить потребление пропускной способности обновлениями операционной системы и приложениями. С помощью этого решения клиенты могут скачивать необходимые элементы из альтернативных источников (например, одноранговых клиентов в сети) помимо указанного расположения (в нашем примере это файловый кэш независимого поставщика программного обеспечения).

По умолчанию в Windows 10 Корпоративная и Windows 10 для образовательных учреждений оптимизация доставки поддерживает одноранговый обмен данными только в локальной сети компании, но вы можете изменить это поведение с помощью параметров групповой политики и управления мобильными устройствами (MDM).

См. сведения о [настройке оптимизации доставки для обновлений Windows 10](/windows/deployment/update/waas-delivery-optimization).