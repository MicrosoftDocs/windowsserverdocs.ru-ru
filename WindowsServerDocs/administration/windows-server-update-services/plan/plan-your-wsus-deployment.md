---
title: Планирование развертывания WSUS
description: Статья о службе обновления Windows Server (WSUS) с общими сведениями о процессе планирования развертывания со ссылками на соответствующие разделы
ms.topic: article
ms.assetid: 35865398-b011-447a-b781-1c52bc0c9e3a
ms.author: lizross
author: eross-msft
manager: mtillman
ms.date: 05/24/2018
ms.openlocfilehash: 1d3638b7a05c406293035c7f0a0e8854ed2ecee9
ms.sourcegitcommit: 5344adcf9c0462561a4f9d47d80afc1d095a5b13
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/18/2020
ms.locfileid: "90766807"
---
# <a name="plan-your-wsus-deployment"></a>Планирование развертывания WSUS

>Область применения. Windows Server 2019, Windows Server (Semi-Annual Channel), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Первым шагом в процессе развертывания службы Windows Server Update Services (WSUS) является принятие таких важных решений, как выбор сценария развертывания службы WSUS, топологии сети и осмысливание требований к системе. В следующем контрольном списке кратко описываются шаги по подготовке к процессу развертывания.

|Задача|Описание|
|----|--------|
|[1.1. Анализ существующих факторов и требований к системе](#11-review-considerations-and-system-requirements)|Проанализируйте список факторов, которые необходимо учесть, а также требования к системе, чтобы убедиться, что у вас есть все необходимое оборудование и программное обеспечение для развертывания службы WSUS.|
|[1.2. Выбор сценария развертывания службы WSUS](#12-choose-a-wsus-deployment-scenario)|Выберите сценарий развертывания службы WSUS, который будет использован.|
|[1.3. Выбор стратегии хранения данных для службы WSUS](#13-choose-a-wsus-storage-strategy)|Выберите, какая из стратегий хранения данных для службы WSUS наиболее подходит для данного развертывания.|
|[1.4 Выбор языков для обновления службы WSUS](#14-choose-wsus-update-languages)|Выберите те языки обновления для службы WSUS, которые будут установлены.|
|[1.5 Планирование относительно групп компьютеров службы WSUS](#15-plan-wsus-computer-groups)|Спланируйте, какой подход относительно групп компьютеров службы WSUS вы будете использовать в ходе развертывания.|
|[1.6 Рекомендации по планированию производительности службы WSUS. Фоновая интеллектуальная служба передачи](#16-plan-wsus-performance-considerations)|Разработайте модель службы WSUS, которая позволяла бы добиться оптимизированной производительности.|
|[1.7. Планирование относительно параметров автоматического обновления](#17-plan-automatic-updates-settings)|Продумайте, как будете настраивать параметры автоматического обновления в своем сценарии.|

## <a name="11-review-considerations-and-system-requirements"></a>1.1. Анализ существующих факторов и требований к системе

### <a name="system-requirements"></a>Системные требования

Требования к оборудованию и программному обеспечению баз данных определяются числом клиентских компьютеров, обновляемых в организации.  Перед активацией роли сервера службы WSUS подтвердите, что сервер соответствует требованиям к системе, а также что у вас есть необходимые разрешения для завершения установки, руководствуясь следующими указаниями.

-   Требования к оборудованию сервера для включения роли WSUS привязаны к требованиям к оборудованию. Минимальные аппаратные требования к WSUS

    -   **Процессор:** 1,4 ГГц разрядностью x64 (рекомендуется 2 ГГц и более)

    -   **Память:** для WSUS требуется дополнительно 2 ГБ ОЗУ помимо ресурсов, необходимых серверу, другим службам и программным пакетам.

    -   **Свободного места на диске:** рекомендуется 40 ГБ или более.

    -   **Сетевой адаптер:** 100 мегабит в секунду (Мбит/с) и выше (рекомендуется 1 ГБ).

> [!NOTE]
> В этих рекомендациях предполагается, что клиенты WSUS синхронизируются с сервером каждые 8 часов для свертки из 30 000 клиентов. Если синхронизация происходит чаще, то для серверной нагрузки будет соответствующее приращение.

-   Требования к программному обеспечению

    -   Для просмотра отчетов WSUS требуется пакет [Microsoft Report Viewer Redistributable 2008](https://www.microsoft.com/download/details.aspx?id=6576). В Windows Server 2016 для WSUS требуется наличие [Microsoft Report Viewer Runtime 2012](https://www.microsoft.com/download/details.aspx?id=35747).

-   Если вы устанавливаете роли или обновления программного обеспечения, которые требуют перезагрузки сервера по окончании установки, то перезагрузите сервер перед тем, как активировать роль сервера службы WSUS.

-   На сервере, где будет установлена роль сервера службы WSUS, должна быть установлена платформа Microsoft .NET Framework 4.0.

-   Чтобы оснастка администрирования WSUS отображалась корректно, учетная запись NT Authority\Network Service должна иметь разрешения на полный доступ к следующим папкам:

    -   %windir%\Microsoft.NET\Framework\v4.0.30319\Temporary ASP.NET Files

        > [!NOTE]
        > Данный путь может и не существовать до установки роли веб-сервера, которая содержит службы IIS.

    -   %windir%\Temp

-   Подтвердите, что учетная запись, которую вы планируете использовать для установки службы WSUS, входит в группу локальных администраторов.

### <a name="installation-considerations"></a>Рекомендации по установке

В ходе установки служба WSUS будет устанавливать по умолчанию следующие компоненты.

-   Командлеты .NET API и Windows PowerShell

-   Внутреннюю базу данных Windows (WID), которую использует служба WSUS

-   Службы, используемые WSUS

    -   Служба обновления

    -   Веб-служба отчетов

    -   Веб-служба клиентов

    -   Веб-служба простой веб-проверки подлинности

    -   Служба синхронизации сервера

    -   Веб-служба проверки подлинности DSS

### <a name="features-on-demand-considerations"></a>Рекомендации в отношении компонентов по требованию

Помните, что настройка клиентских компьютеров (включая серверы) для обновления с помощью служб WSUS приведет к следующим ограничениям.

1. Роли сервера, для которых полезная нагрузка была удалена с помощью установки "Компоненты по требованию", нельзя установить по запросу из Центра обновления Майкрософт. Потребуется указать источник установки во время установки таких ролей сервера или настроить источник для компонентов по требованию в групповой политике.

2. Клиентские выпуски Windows не смогут установить .NET 3.5 по запросу из Интернета. К .NET 3.5 применяются те же рекомендации, что и к ролям сервера.

   > [!NOTE]
   > Настройка источника установки компонентов по требованию не включает использование WSUS. Сведения о настройке компонентов см. в разделе [Настройка компонентов по требованию в Windows Server](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127275(v=ws.11)).

3. Корпоративные устройства под управлением Windows 10 версии 1709 или 1803 не могут устанавливать компоненты по запросу непосредственно из служб WSUS. Чтобы установить компоненты по требованию, [создайте файл компонента (параллельное хранилище)](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127275%28v=ws.11%29#create-a-feature-file-or-side-by-side-store) или получите пакет такого компонента из одного из следующих источников:
   - [Volume Licensing Service Center](https://www.microsoft.com/licensing/servicecenter) (VLSC), для доступа к которому требуется корпоративное лицензирование;
   - портал OEM, для доступа к которому требуются права OEM-поставщика;
   - Центр загрузки MSDN, для которого требуется действующая подписка MSDN.

     Полученные отдельно пакеты с компонентами по требованию можно установить с помощью [параметров командной строки системы DISM](/windows-hardware/manufacture/desktop/dism-operating-system-package-servicing-command-line-options).

### <a name="wsus-database-requirements"></a>Требования к базе данных службы WSUS
Для службы WSUS требуется одна из перечисленных ниже баз данных.

-   Внутренняя база данных Windows (WID)

-   Любая поддерживаемая версия Microsoft SQL Server. Дополнительные сведения см. на странице о [политике жизненного цикла продуктов Майкрософт](/lifecycle/products/?products=sql-server).

Следующие выпуски SQL Server поддерживаются службами WSUS:

-   Standard

-   Enterprise

-   Express

> [!NOTE]
> Размер базы данных SQL Server Express 2008 R2 ограничен десятью гигабайтами. Базы данных такого размера будет достаточно для служб WSUS, хотя значительного выигрыша при использовании этой базы вместо внутренней базы данных Windows нет. Внутренней базе данных Windows (WID) требуется не менее 2 ГБ ОЗУ помимо стандартных системных требований для Windows Server.

Вы можете установить роль службы WSUS на компьютере, отдельном от компьютера-сервера базы данных. В данном случае вступают в силу следующие дополнительные критерии.

1.  Сервер баз данных нельзя настроить так, чтобы он выполнял роль контроллера домена.

2.  Сервер службы WSUS не может запускать службы удаленных рабочих столов.

3.  Сервер базы данных должен находиться в том же домене Active Directory, что и сервер службы WSUS, либо должен иметь отношение доверия с доменом Active Directory сервера WSUS.

4.  Сервер службы WSUS и сервер базы данных должны находиться в одном и том же часовом поясе, либо быть синхронизированными с одним и тем же источником времени в формате UTC (время по Гринвичу).

## <a name="12-choose-a-wsus-deployment-scenario"></a>1.2. Выбор сценария развертывания службы WSUS
Данный раздел описывает основные функции всех развертываний службы WSUS. Используйте данный раздел для ознакомления с простым процессом развертывания на примере одиночного сервера службы WSUS. Дополнительно описываются более сложные сценарии, такие как иерархия сервера WSUS или сервер WSUS в изолированном сегменте сети.

### <a name="simple-wsus-deployment"></a>Простое развертывание службы WSUS
Базовый процесс развертывания службы WSUS включает развертывание сервера в пределах корпоративного брандмауэра, который обслуживает клиентские компьютеры в частной интрасети. Для загрузки обновлений сервер WSUS подключается к центру обновления Майкрософт. Это называется *синхронизация*. В ходе синхронизации служба WSUS определяет, появились ли доступные свежие обновления с момента последней синхронизации. Если это первая синхронизация WSUS, то все обновления становятся доступными для загрузки.

> [!NOTE]
> Первичная синхронизация может занять более часа. Все последующие синхронизации должны происходить значительно быстрее.

Для получения обновлений от Майкрософт сервер WSUS по умолчанию использует порт 80 для протокола HTTP и порт 443 для протокола HTTPS. Если выход из вашей сети в Интернет защищен корпоративным брандмауэром, то необходимо будет открыть порты на сервере, который непосредственно подключается к центру обновления Майкрософт. Если вы планируете использовать настраиваемые порты для этого подключения, то необходимо открыть эти порты вместо упомянутых выше. Вы можете настроить несколько серверов WSUS так, чтобы они синхронизировались с родительским WSUS-сервером. Для передачи обновлений на клиентские рабочие станции сервер WSUS по умолчанию использует порт 8530 для протокола HTTP и порт 8531 для протокола HTTPS.

### <a name="multiple-wsus-servers"></a>Несколько серверов WSUS
Администраторы могут развернуть несколько серверов под управлением WSUS, которые синхронизируют все содержимое в интрасети организации. В Интернет можно предоставить только один сервер, который будет единственным скачивать обновления из Центра обновления Майкрософт. Этот сервер настраивается как вышестоящий сервер-источник, с которым синхронизируются подчиненные серверы. Там, где это возможно, серверы могут располагаться на всем протяжении территориально разнесенной сети, чтобы обеспечивать наилучшее качество подключения для всех клиентских компьютеров.

### <a name="disconnected-wsus-server"></a>Отключенный WSUS-сервер
Если политика организации или другие условия ограничивают доступ компьютера в Интернет, администраторы могут настроить внутренний сервер, чтобы он запускал WSUS. Примером этого может служить сервер, подключенный к Интрасети, но изолированный от Интернета. После загрузки, тестирования и одобрения обновления на этом сервере администратор экспортирует метаданные и содержимое обновления на DVD-диск. Метаданные и содержимое обновления импортируются с DVD-диска на серверы, работающие с WSUS в Интрасети.

### <a name="wsus-server-hierarchies"></a>Иерархии серверов WSUS
Вы можете создавать сложные иерархии серверов WSUS. Вам необходимо иметь только один сервер WSUS, подключенный к Центру обновления Майкрософт, поскольку остальные серверы WSUS могут синхронизироваться между собой, а не с Центром обновления Майкрософт. При подключении серверов WSUS между собой один из них является вышестоящим, а другой — подчиненным. Развертывание иерархии сервера WSUS имеет следующие преимущества.

-   Вы можете загрузить обновления из Интернета один раз, а затем распространить их на клиентские компьютеры посредством подчиненных серверов. Данный метод сохраняет пропускную способность интернет-подключения в организации.

-   Обновления можно загружать на те серверы WSUS, которые физически находятся ближе к клиентским компьютерам, например в филиалах.

-   Можно настроить отдельные серверы WSUS для обслуживания клиентских компьютеров, использующих продукты корпорации Майкрософт на различных языках.

-   Можно развернуть WSUS в масштабе крупной организации, в которой клиентских компьютеров больше, чем то количество, которым может эффективно управлять один сервер WSUS.

> [!NOTE]
> Не рекомендуется создавать иерархию серверов WSUS глубиной более трех уровней. Каждый уровень увеличивает время распространения обновлений через подключенные серверы. Хотя теоретически иерархия не имеет границ, корпорация Майкрософт проводила тестирование развертывания лишь в иерархии глубиной в пять уровней.
>
> Кроме того, подчиненные серверы должны иметь ту же или более раннюю версию WSUS, что и вышестоящий источник синхронизации.

Можно подключить серверы WSUS в автономном режиме (чтобы достичь распределенного администрирования) или в режиме репликации (чтобы достичь централизованного администрирования). Необязательно разворачивать серверную иерархию, которая использует только один режим: можно развернуть решения WSUS, которые используют как автономные серверы, так и серверы-реплики WSUS.

#### <a name="autonomous-mode"></a>Автономный режим
Автономный режим, также называемый распределенным администрированием, является параметром установки по умолчанию для WSUS. В автономном режиме вышестоящий сервер WSUS делит обновления с подчиненными серверами при синхронизации. Администрирование подчиненных серверов WSUS происходит по-отдельности, и они не получают статуса утверждения обновлений или сведений о группах компьютеров от вышестоящего сервера. С помощью модели распределенного управления администратор каждого сервера WSUS выбирает языки обновления, создает группы компьютеров, назначает компьютеры группам, тестирует и утверждает обновления, а также убеждается, что на соответствующие группы компьютеров установлены нужные обновления. Следующий рисунок показывает, как можно развернуть автономные серверы WSUS в среде филиала:

#### <a name="replica-mode"></a>Режим реплики
Режим реплики, называемый также централизованным администрированием, предполагает, что вышестоящий сервер WSUS разделяет обновления, статус утверждения и группы компьютеров с подчиненными серверами. Серверы-реплики наследуют утверждения обновлений, и ими нельзя управлять независимо с соответствующего вышестоящего сервера WSUS. Следующий рисунок показывает, как можно развернуть серверы-реплики WSUS в среде филиала:

> [!NOTE]
> Если вы настроили несколько серверов-реплик на подключение к одному вышестоящему серверу WSUS, то не назначайте запуск синхронизации на каждом из серверов-реплик в одно и то же время. Данная методика позволит избежать внезапных колебаний пропускной способности.

### <a name="branch-offices"></a>Филиалы
Для оптимизации развертывания службы WSUS можно использовать функцию "Филиал" в Windows. Данный тип развертывания предлагает следующие преимущества.

1.  Помогает снизить загруженность каналов глобальной сети и ускоряет взаимодействие с сетевыми приложениями. Чтобы активировать ускорение передачи содержимого BranchCache от сервера WSUS, установите компонент BranchCache на сервере и клиентах и убедитесь, что служба BranchCache запустилась. Другие действия не требуются.

2.  Функцию "Филиал" можно также использовать в филиалах, которые имеют подключение к центральному офису через канал с низкой пропускной способностью, а подключение к Интернету через канал с высокой пропускной способностью. В таком случае можно настроить подчиненные серверы WSUS так, чтобы они принимали информацию об обновлениях, которые надо установить, от центрального сервера WSUS, но загружали эти обновления из Центра обновления Майкрософт.

### <a name="network-load-balancing"></a>Network Load Balancing
Балансировка сетевой нагрузки (NLB) повышает надежность и производительность вашей сети на WSUS. Можно установить несколько серверов WSUS, которые используют один отказоустойчивый кластер с SQL Server, например под управлением SQL Server 2008 R2 SP1. При такой конфигурации необходимо использовать полную установку SQL Server , а не установку внутренней базы данных Windows, которая поставляется WSUS, при этом роль базы данных должна быть установлена на всех серверах WSUS переднего плана. Можно также сделать так, чтобы все серверы WSUS использовали распределенную файловую систему (DFS), чтобы хранить свое содержимое.

**Настройка WSUS для балансировки сетевой нагрузки (NLB).** По сравнению с настройкой WSUS 3.2 для NLB специальный вызов программы установки и параметры больше не требуются для настройки служб WSUS для NLB. Нужно лишь настроить каждый сервер WSUS, учитывая следующие рекомендации.

-   Службы WSUS необходимо настроить, используя базу данных SQL вместо WID.

-   Если обновления хранятся локально, к папке содержимого необходимо предоставить общий доступ для серверов WSUS, которые совместно используют одну базу данных SQL.

-   Установка служб WSUS должна выполняться последовательно. Задачи после установки нельзя выполнять на нескольких серверах одновременно при использовании совместного доступа к одной базе данных SQL.

### <a name="wsus-deployment-with-roaming-client-computers"></a>Развертывание службы WSUS с роумингом клиентских компьютеров
Если в сети есть мобильные пользователи, которые выполняют вход в сеть из различных мест, можно настроить службы WSUS так, чтобы позволить пользователям в роуминге осуществлять обновление на своих клиентских компьютерах с ближайшего к ним географически сервера WSUS. Например, вы можете развернуть один сервер WSUS в каждом регионе и использовать разные подсети DNS для каждого региона. Все клиентские компьютеры можно направить на один сервер WSUS, который подключает каждую подсеть к ближайшему физически серверу WSUS.

## <a name="13-choose-a-wsus-storage-strategy"></a>1.3. Выбор стратегии хранения данных для службы WSUS
Службы Windows Server Update Services (WSUS) используют два типа систем хранения: базу данных для хранения настроек WSUS и метаданных обновлений, а также дополнительную локальную файловую систему, чтобы хранить файлы обновлений. Перед установкой WSUS необходимо решить, каким образом будет реализовано хранение данных.

Обновления состоят из двух частей: метаданные, которые описывают обновление, и файлы, которые необходимы для установки обновления. Размер метаданных обновлений обычно намного меньше, чем размер самого обновления, а хранятся они в базе данных WSUS. Файлы обновлений хранятся на локальном сервере WSUS или на веб-сервере Центра обновления Майкрософт.

### <a name="wsus-database"></a>База данных службы WSUS
Для служб WSUS необходимо иметь по базе данных на каждом сервере WSUS. WSUS может поддерживать использование базы данных, которая находится не на сервере WSUS, а на другом компьютере, но при этом есть некоторые ограничения. Список поддерживаемых баз данных и ограничений для удаленных баз данных см. в разделе "1.1 Анализ исходных факторов и требований к системе" этого руководства.

База данных WSUS хранит следующую информацию.

-   Сведения о конфигурации сервера WSUS

-   Метаданные, описывающие обновление

-   Сведения о клиентских компьютерах, обновлениях и взаимодействиях

При установке нескольких серверов WSUS необходимо поддерживать отдельные базы данных для каждого сервера WSUS, независимо от того, является ли этот сервер автономным или сервером-репликой. Нельзя хранить несколько баз данных WSUS на одном экземпляре SQL Server за исключением хранения в кластерах балансировки сетевой нагрузки (NLB), которые используют отказоустойчивость SQL Server.

SQL Server, SQL Server Express и внутренняя база данных Windows обеспечивают одинаковые характеристики производительности для конфигурации, в которой используется один сервер, а база данных и служба WSUS расположены на одном компьютере. Односерверная конфигурация может поддерживать несколько тысяч клиентских компьютеров, работающих с WSUS.

> [!NOTE]
> Не пытайтесь управлять службами WSUS через прямой доступ к базе данных. Прямые манипуляции в базе данных могут привести к ее повреждению. Такое повреждение может незаметно сразу, но помешает обновлению продукта до следующей версии. Управление WSUS можно осуществлять через консоль WSUS или программный интерфейс WSUS.

#### <a name="wsus-with-windows-internal-database"></a>WSUS с внутренней базой данных Windows
По умолчанию мастер установки создает и использует внутреннюю базу данных Windows, которая называется SUSDB.mdf. Эта база данных находится в папке %windir%\wid\data\ , где %windir% — локальный диск, на котором установлено серверное программное обеспечение WSUS.

> [!NOTE]
> Внутренняя база данных Windows (WID) появилась в Windows Server 2008.

WSUS поддерживает проверку подлинности Windows только для базы данных. Нельзя использовать проверку подлинности SQL Server совместно с WSUS. Если для базы данных WSUS используется внутренняя база данных Windows, то программа установки WSUS создает экземпляр SQL Server с названием server\Microsoft##WID, где server — это имя компьютера. С каждым параметром базы данных программа установки WSUS создает базу данных с названием SUSDB. Название этой базы данных нельзя перенастраивать.

Внутреннюю базу данных Windows рекомендуется использовать в следующих случаях.

-   Организация еще не приобрела или ей не требуется продукт SQL Server для других приложений.

-   Организации не требуется решение NLB WSUS.

-   Предполагается развернуть несколько серверов WSUS (например, в филиалах). В данном случае необходимо рассмотреть вопрос об использовании внутренней базы данных Windows на серверах-получателях, даже если на корневом сервере WSUS будет использоваться SQL Server. Поскольку каждый сервер WSUS требует отдельного экземпляра SQL Server, вы быстро испытаете проблемы с производительностью базы данных, если только один экземпляр SQL Server будет работать с несколькими серверами WSUS.

Внутренняя база данных Windows не предоставляет пользовательский интерфейс или какие-либо инструменты управления базой данных. Если эта база данных будет выбрана для WSUS, то возникнет необходимость использования внешних инструментов управления базой данных. Дополнительная информация:

-   [Резервное копирование и восстановление данных службы WSUS и резервное копирование сервера](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd939904(v=ws.10))

-   [Повторная индексация базы данных WSUS](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd939795(v=ws.10))

#### <a name="wsus-with-sql-server"></a>Использование WSUS с SQL Server
Использование SQL Server совместно с WSUS рекомендуется в следующих случаях.

1.  Вам необходимо решение NLB WSUS.

2.  У вас уже установлен по крайней мере один экземпляр SQL Server.

3.  Вы не можете запускать службу SQL Server из-под локальной учетной записи, которая не является системной, или с использованием проверки подлинности SQL Server. Служба WSUS поддерживает только проверку подлинности Windows.

### <a name="wsus-update-storage"></a>Хранение обновлений WSUS
Когда обновления синхронизируются на сервере WSUS, файлы метаданных и файлы обновлений хранятся в двух разных расположениях. Метаданные хранятся в базе данных WSUS. Файлы обновлений могут храниться на сервере WSUS или на серверах Центра обновления Майкрософт (в зависимости настройки параметров синхронизации). Если вы решили хранить файлы обновлений на сервере WSUS, клиентские компьютеры будут загружать утвержденные обновления с локального сервера WSUS. В противном случае клиентские компьютеры будут загружать утвержденные обновления напрямую из Центра обновления Майкрософт. Наиболее оптимальный выбор для вашей организации будет зависеть от пропускной способности подключения к Интернету, пропускной способности интрасети, а также доступности локального хранилища.

Для каждого развернутого сервера WSUS можно выбрать различные решения для хранения обновлений.

#### <a name="local-wsus-server-storage"></a>Хранение данных на локальном сервере WSUS
Задание локального хранения файлов обновлений происходит по умолчанию при установке и настройке службы WSUS. Данный параметр позволяет экономить пропускную способность в корпоративном подключении к Интернету, поскольку клиентские компьютеры загружают обновления непосредственно с локального сервера WSUS.

Данный параметр требует, чтобы на сервере было достаточно дискового пространства для хранения всех необходимых обновлений. WSUS требуется как минимум 20 ГБ для локального хранения обновлений, но по результатам тестирования мы рекомендуем предоставить не менее 30 ГБ.

#### <a name="remote-storage-on-microsoft-update-servers"></a>Удаленное хранение данных на серверах Центра обновления Майкрософт
Можно хранить обновления удаленно на серверах Центра обновления Майкрософт. Данная возможность полезна, поскольку большинство клиентских компьютеров подключаются к серверу WSUS через медленное WAN-подключение, а к Интернету они подключаются по каналам с высокой пропускной способностью.

В данном случае корневой сервер WSUS синхронизируется с Центром обновления Майкрософт и получает метаданные обновлений. После утверждения обновлений клиентские компьютеры загружают утвержденные обновления с серверов Центра обновления Майкрософт.

## <a name="14-choose-wsus-update-languages"></a>1.4. Выбор языков обновления для службы WSUS
При развертывании иерархии сервера WSUS следует определить, на каком языке необходимы обновления в организации. Необходимо настроить корневой сервер WSUS на загрузку обновлений на всех языках, которые используются в организации.

Например, главному офису необходимы обновления на английском и французском языках, в одном филиале необходимы обновления на английском, французском и немецком языках, а в другом — на английском и испанском. В данной ситуации необходимо настроить корневой сервер WSUS на загрузку обновлений на английском, французском, немецком и испанском языках. Затем надо настроить сервер WSUS первого филиала на загрузку обновлений только на английском, французском и немецком языках, а сервер второго филиала — на загрузку обновлений только на английском и испанском языках.

Страница **Выбор языков** мастера настройки WSUS позволяет получать обновления на всех языках или на какой-то определенной подгруппе языков. Выбор набора языков позволяет сэкономить дисковое пространство, но ВАЖНО выбрать все языки, которые потребуются подчиненным серверам и клиентским компьютерам сервера WSUS.

Перед настройкой языков обновления необходимо учитывать следующие важные замечания.

-   Всегда включайте английский язык в дополнение к другим языкам, используемым в вашей организации. Все обновления имеют в своей основе языковой пакет на английском языке.

-   Подчиненные серверы и клиентские компьютеры не будут получать все необходимые обновления, если вы не выберете все необходимые языки для вышестоящего сервера. Убедитесь, что вы выбрали все языки, которые понадобятся на клиентских компьютерах, связанных со всеми подчиненными серверами.

-   Необходимо в основном загрузить обновления на всех языках на корневой сервер WSUS, который синхронизируется с Центром обновления Майкрософт. Данный выбор гарантирует, что все подчиненные серверы и клиентские компьютеры получат обновления на необходимых языках.

Если вы храните обновления локально и настроили сервер WSUS на загрузку обновлений на ограниченном количестве языков, вы можете заметить, что есть обновления на языках, отличающихся от указанных вами. Многие файлы обновлений объединяются в пакет из нескольких различных языков, которые имеют в своем составе один из языков, указанных на сервере.

**Вышестоящие серверы**

> [!NOTE]
> Настройте вышестоящие серверы для синхронизации обновлений на всех языках, необходимых для подчиненных серверов-реплик. Пользователи не будут получать уведомления о необходимых обновлениях на несинхронизированных языках.

Обновления будут отображаться как **неприменимые** на клиентских компьютерах, требующих данный язык. Чтобы избежать этого, убедитесь, что все языки операционных систем включены в параметры синхронизации сервера WSUS. Чтобы просмотреть все языки операционных систем, перейдите в представление **Компьютеры** консоли администрирования WSUS и примените сортировку компьютеров по языку операционной системы. Тем не менее, может потребоваться включить дополнительные языки при наличии приложений Майкрософт на нескольких языках (например, при установке французской версии Microsoft Word на некоторых компьютерах, использующих английскую версию Windows 8).

Выбор языков для вышестоящего сервера отличается от выбора языков для подчиненного сервера. Следующие процедуры поясняют различия.

#### <a name="to-choose-update-languages-for-a-server-synchronizing-from-microsoft-update"></a>Выбор языков обновлений для сервера, синхронизированного с Центром обновления Майкрософт

1.  В мастере настройки WSUS выполните следующие действия.

    -   Для получения обновлений на всех языках щелкните **Загружать обновления на всех языках, включая новые**.

    -   Для получения обновлений только для определенных языков выберите **Загружать обновления только для следующих языков**, а затем выберите языки, для которых вы желаете получать обновления.

#### <a name="to-choose-update-languages-for-a-downstream-server"></a>Выбор языков обновлений для подчиненного сервера

1.  Если вышестоящий сервер был настроен для скачивания файлов обновлений на языках из определенного набора, выполните следующие действия. В мастере настройки служб WSUS щелкните **Скачивать обновления только для следующих языков (вышестоящий сервер поддерживает только языки, отмеченные звездочкой)** , а затем выберите языки, для которых требуется установить обновления.

> [!NOTE]
> Эту процедуру необходимо выполнить, даже если требуется загружать на подчиненном сервере те же языки, что и на вышестоящем сервере.

2. Если вышестоящий сервер был настроен для загрузки файлов обновлений на всех языках, выполните следующие действия. В мастере настройки служб WSUS щелкните **Download updates in all languages supported by the upstream server** (Скачивать обновления на всех языках, поддерживаемых вышестоящим сервером).

> [!NOTE]
> Эту процедуру необходимо выполнить, даже если требуется загружать на подчиненном сервере те же языки, что и на вышестоящем сервере. Этот параметр задает загрузку вышестоящим сервером обновлений на всех языках, включая языки, которые первоначально не были настроены для вышестоящего сервера. При добавлении языков для вышестоящего сервера следует скопировать новые обновления на его серверы-реплики.
>
> Изменение параметров языка только на вышестоящем сервере может привести к несоответствию числа обновлений, утвержденных на центральном сервере, и числа обновлений, утвержденных на серверах-репликах.

## <a name="15-plan-wsus-computer-groups"></a>1.5. Планирование групп компьютеров службы WSUS
Служба WSUS позволяет направлять обновления на группы клиентских компьютеров, таким образом обеспечивается получение определенными компьютерами нужных обновлений в самое подходящее время. Например, если компьютеры в одном отделе (например, бухгалтерии) имеют особую конфигурацию, то можно настроить группу для данного отдела, определить, какие обновления нужны на их компьютерах и в какое время их нужно устанавливать, а затем использовать отчеты WSUS для оценки данных обновлений.

> [!NOTE]
> Если сервер WSUS работает в режиме реплики, группы компьютеров нельзя создать на сервере. Все группы компьютеров, которые необходимы для клиентских компьютеров сервера-реплики, должны быть созданы на корневом сервере WSUS иерархии серверов WSUS. Дополнительные сведения о режиме реплики см. в статье [Manage WSUS Replica Servers](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd939893(v=ws.10)) (Управление серверами-репликами WSUS) руководства по работе с WSUS 3.0 SP2.

Компьютеры всегда входят в группу **Все компьютеры** и остаются в группе **Неназначенные компьютеры**, пока вы не добавите их к другой группе. Компьютеры могут входить в несколько групп.

Можно создать иерархические группы компьютеров (например, создать группу "Зарплата" и группу "Расчеты с поставщиками" в группе "Бухгалтерия"). Обновления, одобренные для высшей группы, будут автоматически развернуты помимо высшей группы и в низшей группе. В данном примере после одобрения Обновление 1 для группы "Бухгалтерия" будет развернуто на всех компьютерах этой группы, всех компьютерах группы "Зарплата", а также на всех компьютерах группы "Расчеты с поставщиками".

Поскольку компьютеры могут состоять в нескольких группах, то возможна ситуация, когда одно обновление будет одобрено несколько раз на одном и том же компьютере. Тем не менее само обновление будет развернуто только один раз, а любые конфликты будут разрешены сервером WSUS. В продолжение предыдущего примера — если Компьютер А состоит в группах "Зарплата" и "Расчеты с поставщиками", а Обновление 1 одобрено для обеих групп, то оно будет развернуто только один раз.

Для добавления компьютеров в группы можно использовать один из двух методов: указание на стороне сервера и указание на стороне клиентов. Далее следуют определения для каждого из методов.

-   **Указание на стороне сервера**. Один или несколько клиентских компьютеров добавляются вручную в несколько групп одновременно.

-   **Указание на стороне клиента**. Для автоматического добавления клиентских компьютеров в ранее созданные группы используется групповая политика или изменяются настройки реестра клиентских компьютеров.

### <a name="conflict-resolution"></a>Устранение конфликтов
Сервер применяет следующие правила для устранения конфликтов и определения результирующего действия на клиентах:

1.  Priority

2.  Установить/Удалить

3.  Предельный срок

#### <a name="priority"></a>Priority
Действия, связанные с группой наивысшего приоритета, переопределяют действия других групп. Чем глубже группа расположена в иерархии групп, тем выше ее приоритет. Приоритет назначается только на основании глубины. Все ветви обладают одинаковым приоритетом. Например, группа двумя уровнями ниже ветви "Настольные компьютеры" обладает более высоким приоритетом, чем группа, располагающаяся на один уровень ниже ветви "Сервер".

В следующем текстовом примере области иерархии консоли служб обновления для сервера WSUS с именем WSUS-01 в группу по умолчанию **Все компьютеры** были добавлены группы компьютеров с именами "Настольные компьютеры" и "Сервер". Группы "Настольные компьютеры" и "Сервер" находятся на одном и том же иерархическом уровне.

-   **Службы обновления**

    -   **WSUS-01**

        -   **Обновления**

        -   **Компьютеры**

            -   **Все компьютеры**

                -   **Неназначенные компьютеры**

                -   **Настольные компьютеры**

                    -   **Настольные компьютеры-У1**

                        -   **Настольные компьютеры-У2**

                -   **Серверы**

                    -   **Серверы-У1**

        -   **Подчиненные серверы**

        -   **Синхронизация**

        -   **Отчеты**

        -   **Параметры**

В этом примере группа двумя уровнями ниже ветви "Настольные компьютеры" ("Настольные компьютеры-У2") обладает более высоким приоритетом, чем группа, располагающаяся на один уровень ниже ветви "Сервер" ("Серверы-У1"). Соответственно, для компьютера, являющегося членом сразу двух групп, "Настольные компьютеры-У2" и "Серверы-У1", все действия для группы "Настольные компьютеры-У2" обладают более высоким приоритетом по сравнению с действиями, определенными для группы "Серверы-У1".

#### <a name="priority-of-install-and-uninstall"></a>Приоритет установки и удаления
Действия "Установить" переопределяют действия "Удалить". Обязательные установки переопределяют необязательные (последние доступны только через API; при изменении утверждения обновления через консоль администрирования WSUS все необязательные утверждения будут удалены.)

#### <a name="priority-of-deadlines"></a>Приоритет крайних сроков
Действия, для которых установлен предельный срок, переопределяют действия без предельного срока.  Действия с более ранним предельным сроком переопределяют действия с более поздним предельным сроком.

## <a name="16-plan-wsus-performance-considerations"></a>1.6. Рекомендации по планированию производительности службы WSUS
Перед тем как разворачивать WSUS, нужно тщательно продумать несколько моментов. Это поможет оптимизировать производительность. Ключевые моменты

-   Настройка сети

-   Отложенная загрузка

-   Фильтры

-   Установка

-   Развертывание крупных обновлений

-   Фоновая интеллектуальная служба передачи (BITS)

### <a name="network-setup"></a>Настройка сети
Чтобы оптимизировать производительность в сетях WSUS, примите во внимание следующие советы.

1.  Для сетей WSUS предпочтительнее звездообразная топология, чем иерархическая.

2.  Используйте сетевую маску DNS, направленную на клиентские компьютеры в роуминге, настройте эти компьютеры так, чтобы они получали обновления с локального сервера WSUS.

### <a name="deferred-download"></a>Отложенная загрузка
Можно утверждать обновления и загружать метаданные обновлений перед загрузкой файлов обновлений. Данный метод называется *отложенные загрузки*. Когда загрузка откладывается, обновление загружается только после его утверждения. Рекомендуется использовать отложенную загрузку, поскольку это оптимизирует пропускную способность сети и дисковое пространство.

В иерархии серверов WSUS служба WSUS автоматически настраивает подчиненные серверы использовать параметр отложенной загрузки корневого сервера WSUS. Данный параметр по умолчанию можно поменять. Например, можно настроить вышестоящий сервер на выполнение полной немедленной синхронизации, а затем настроить подчиненный сервер на отложенную загрузку.

При развертывании иерархии подключенных серверов WSUS рекомендуется не располагать серверы глубоко. Если активировано отложенное скачивание, а подчиненный сервер запрашивает обновление, которое не утверждено на вышестоящем сервере, то запрос подчиненного сервера вызывает скачивание на вышестоящем сервере. Затем подчиненный сервер загружает обновление при последующей синхронизации. На глубоких уровнях иерархии серверов WSUS при запросе обновлений, их загрузке и прохождении через иерархию могут возникать задержки. По умолчанию отложенные загрузки активированы при локальном хранении обновлений. Данный параметр можно поменять вручную.

### <a name="filters"></a>Фильтры
Служба WSUS позволяет фильтровать синхронизацию обновлений по таким признакам, как язык, продукт и класс. В иерархии серверов WSUS служба WSUS автоматически настраивает подчиненные серверы использовать параметры фильтрации обновлений, которые выбраны на корневом сервере WSUS. Серверы загрузок можно настроить на прием только подмножества языков.

По умолчанию продукты, которые должны обновляться — Windows и Office, а классами по умолчанию являются критические обновления, обновления группы безопасности и определений. Для сохранения пропускной способности и дискового пространства рекомендуется ограничить количество языков до действительно используемого.

### <a name="installation"></a>Установка
Обновления обычно состоят из новых версий файлов, которые уже существуют на компьютере и обновление которых выполняется. На уровне двоичного кода эти существующие файлы могут и не сильно отличаться от обновленных версий. Функция экспресс-установки файлов определяет точное различие в байтах между версиями, создает и распространяет обновления, в которых учтены именно эти различия, а затем дополняет существующие файлы обновленными байтами.

Иногда эта функция называется разностной доставкой, так как она скачивает только те объекты, которые отличаются в двух версиях файлов. Файлы экспресс-установки имеют больший размер, чем обновления, которые распространяются на клиентские компьютеры, поскольку эти файлы содержат все возможные версии каждого обновляемого файла.

Файлы экспресс-установки можно использовать для ограничения пропускной способности, потребляемой в локальной сети, так как службы WSUS передают только изменившиеся данные, применимые к конкретной версии обновляемого компонента. Однако это достигается за счет дополнительной полосы пропускания между сервером WSUS, любыми вышестоящими серверами WSUS и Центром обновления Майкрософт и требует дополнительного дискового пространства. По умолчанию служба WSUS не использует файлы экспресс-установки.

Не все обновления подходят для распространения посредством файлов экспресс-установки. При выборе данного параметра вы получите файлы экспресс-установки для всех обновлений. Если вы не храните обновления локально, агент обновления Windows будет решать, загружать ли файлы экспресс-установки или распространяемые пакеты полного обновления.

### <a name="large-update-deployment"></a>Развертывание крупных обновлений
Чтобы избежать перегрузки сети при развертывании крупных обновлений (таких как пакеты обновлений), применяются следующие методики.

1.  Регулирование количества запросов фоновой интеллектуальной службы передачи (BITS). Ограничения пропускной способности BITS можно контролировать посредством истинного времени, но эти ограничения распространяются на все приложения, которые используют BITS. Сведения о том, как управлять регулированием BITS, см. в разделе [Групповые политики](/windows/win32/bits/group-policies).

2.  Регулирование количества запросов Internet Information Services (IIS) для ограничения количества запросов к одной или нескольким веб-службам.

3.  Использование групп компьютеров для контроля управления выгрузкой. Клиентский компьютер определяет себя членом отдельной группы компьютеров, когда отсылает сведения на сервер WSUS. Сервер WSUS использует данную информацию для определения тех обновлений, которые необходимо развернуть на этом компьютере. Можно настроить несколько групп компьютеров и последовательно утвердить загрузки крупных пакетов обновлений для подмножества этих групп.

### <a name="background-intelligent-transfer-service"></a>Фоновая интеллектуальная служба передачи
Для всех своих задач по передаче файлов служба WSUS использует протокол фоновой интеллектуальной службы передачи (BITS). Это включает в себя загрузки на клиентские компьютеры и синхронизацию серверов. BITS позволяет программам загружать файлы, используя запасную пропускную способность. BITS поддерживает передачу файлов во время отключения сети или перезагрузок компьютера. Дополнительная информация: [Фоновая интеллектуальная служба передачи](/windows/win32/bits/background-intelligent-transfer-service-portal).

## <a name="17-plan-automatic-updates-settings"></a>1.7. Планирование параметров автоматического обновления
Можно задать предельный срок утверждения обновлений на сервере WSUS. Предельный срок побуждает клиентский компьютер устанавливать обновление в определенное время, но существует ряд различных ситуаций, зависящих от таких факторов как: истек ли предельный срок, есть ли другие обновления в очереди на установку, требует ли обновление (или другое обновление в очереди) перезагрузки компьютера.

По умолчанию автоматическое обновление опрашивает сервер WSUS на наличие утвержденных обновлений каждые 22 часа за вычетом случайной задержки. Если необходимо установить новые обновления, то они загружаются. Время между каждым циклом обнаружения можно менять от 1 до 22 часов.

С параметрами уведомлений можно производить следующие действия.

1.  Если автоматическое обновление настроено на уведомление пользователей об уже установленных обновлениях, то уведомление передается в журнал системы и область уведомлений клиентского компьютера.

2.  Когда пользователь с соответствующими учетными данными щелкает значок области уведомлений, автоматическое обновление отображает доступные для установки обновления. Чтобы запустить процесс установки, пользователь должен щелкнуть **Установка** . Если для окончания обновления требуется перезагрузить компьютер, то появляется сообщение. При поступлении запроса на перезагрузку автоматическое обновление не может обнаруживать дополнительные обновления, пока компьютер не будет перезагружен.

Если автоматическое обновление настроено устанавливать обновления по имеющемуся расписанию, то подходящие обновления загружаются и помечаются как готовые к установке. Автоматическое обновление уведомляет пользователей с соответствующими учетными данными с помощью значка области уведомлений, а событие заносится в журнал системы.

В назначенный день и время автоматическое обновление устанавливает обновление и перезагружает компьютер (по необходимости), даже если локальный администратор не вошел в систему. Если локальный администратор вошел в систему, а компьютеру требуется перезагрузка, автоматическое обновление выводит на экран предупреждение и обратный отсчет времени до перезагрузки. Иначе установка происходит в фоновом режиме.

Если компьютер необходимо перезагрузить, а в систему вошел какой-либо пользователь, то на экран выводится аналогичное диалоговое окно с обратным отсчетом времени, которое предупреждает пользователя о предстоящей перезагрузке. Управлять перезагрузками компьютера можно с помощью групповой политики.

После загрузки свежих обновлений автоматическое обновление запрашивает у сервера WSUS список утвержденных пакетов для подтверждения того, что срок действия пакетов, которые оно загрузило, не истек, а сами пакеты являются утвержденными. Это означает, что если администратор WSUS удалит обновления из списка утвержденных обновлений в ходе их загрузки автоматическим обновлением, то будут установлены лишь те обновления, которые до сих пор находятся в списке утвержденных.