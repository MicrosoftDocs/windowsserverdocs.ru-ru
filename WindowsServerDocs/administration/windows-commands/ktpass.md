---
title: ktpass
description: Справочный раздел по * * * *-
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: 47087676-311e-41f1-8414-199740d01444
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 09f0a715c8addf8694eb75d17f9b8089cad72e56
ms.sourcegitcommit: ab64dc83fca28039416c26226815502d0193500c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/01/2020
ms.locfileid: "82724533"
---
# <a name="ktpass"></a>ktpass

> Область применения: Windows Server (половина ежегодного канала), Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Настраивает имя участника на сервере для узла или службы в доменных службах Active Directory (AD DS) и создает файл. keytab, содержащий общий секретный ключ службы. Keytab-файл основан на реализации протокола проверки подлинности Kerberos Массачусетс института Technology (MIT). Средство командной строки ктпасс позволяет использовать службы, отличные от Windows, поддерживающие проверку подлинности Kerberos, для использования функций взаимодействия, предоставляемых службой центр распространения ключей Kerberos (KDC). Этот раздел относится к версиям операционной системы, указанным в списке **применяется к** в начале раздела.  

## <a name="syntax"></a>Синтаксис  
```  
ktpass  
[/out <FileName>]   
[/princ <PrincipalName>]   
[/mapuser <UserAccount>]   
[/mapop {add|set}] [{-|+}desonly] [/in <FileName>]  
[/pass {Password|*|{-|+}rndpass}]  
[/minpass]  
[/maxpass]  
[/crypto {DES-CBC-CRC|DES-CBC-MD5|RC4-HMAC-NT|AES256-SHA1|AES128-SHA1|All}]  
[/itercount]  
[/ptype {KRB5_NT_PRINCIPAL|KRB5_NT_SRV_INST|KRB5_NT_SRV_HST}]  
[/kvno <KeyversionNum>]  
[/answer {-|+}]  
[/target]  
[/rawsalt] [{-|+}dumpsalt] [{-|+}setupn] [{-|+}setpass <Password>]  [/?|/h|/help]  
```  
### <a name="parameters"></a>Параметры  

|                                             Параметр                                              |                                                                                                                                                                                                                                                                                                      Описание                                                                                                                                                                                                                                                                                                       |
|----------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                                          /out<FileName>                                           |                                                                                                                                                                        Указывает имя создаваемого файла Kerberos версии 5. keytab. **Примечание.** Это keytab-файл, который передается на компьютер, на котором не установлена операционная система Windows, а затем заменяется или объединяется с существующим keytab-файлом/Etc/Krb5.keytab.                                                                                                                                                                        |
|                                       /принк<PrincipalName>                                       |                                                                                                                                                                                                                   Указывает имя участника в форме host/computer.contoso.com@CONTOSO.COM. **Предупреждение:** Этот параметр учитывает регистр. Дополнительные сведения см. в разделе [Примечания](#BKMK_remarks) .                                                                                                                                                                                                                    |
|                                       /мапусер<UserAccount>                                       |                                                                                                                                                                                                                                                Сопоставляет имя участника Kerberos, указанного параметром **принк** , с указанной учетной записью домена.                                                                                                                                                                                                                                                |
|                                       /мапоп {Add&#124;Set}                                        |                                                                                                                                                                             Указывает, как задается атрибут mapping.<p>-   **Добавить** добавляет значение указанного локального имени пользователя. Это значение по умолчанию.<br />-   **Set** задает значение шифрования только для стандарта шифрования данных (DES) для указанного локального имени пользователя.                                                                                                                                                                             |
|                                         Десонли {-&#124;+}                                          |                                                                                                                                                            Шифрование только по алгоритму DES установлено по умолчанию.<p>-   **+** Задает учетную запись для шифрования только по алгоритму DES.<br />-   **-** Выдает ограничение на учетную запись для шифрования только по алгоритму DES. **Важно.** Начиная с Windows 7 и Windows Server 2008 R2, Windows не поддерживает DES по умолчанию.                                                                                                                                                            |
|                                           /in<FileName>                                           |                                                                                                                                                                                                                                                       Указывает keytab-файл для чтения с главного компьютера, на котором не установлена операционная система Windows.                                                                                                                                                                                                                                                        |
|                          /Пасс {пароль&#124;\*&#124; {-&#124;+} рндпасс}                           |                                                                                                                                                                                                                                           Задает пароль для основного имени пользователя, заданного параметром **принк** . Используется \* для запроса пароля.                                                                                                                                                                                                                                            |
|                                              /минпасс                                              |                                                                                                                                                                                                                                                                            Устанавливает минимальную длину случайного пароля в 15 символов.                                                                                                                                                                                                                                                                            |
|                                              /макспасс                                              |                                                                                                                                                                                                                                                                           Устанавливает максимальную длину случайного пароля в 256 символов.                                                                                                                                                                                                                                                                            |
| /крипто {DES-CBC-CRC&#124;алгоритм DES-CBC-MD5&#124;RC4-HMAC-NT&#124;AES256-SHA1&#124;AES128-SHA1&#124;ALL} | Задает ключи, создаваемые в файле keytab:<p>-   Для обеспечения совместимости используется **des-CBC-CRC** .<br />-   **Алгоритм DES-CBC-MD5** тесно соответствует реализации MIT и используется для обеспечения совместимости.<br />-   **RC4-HMAC-NT** использует 128-разрядное шифрование.<br />-   **AES256-SHA1** использует шифрование AES256-CTS-HMAC-SHA1-96.<br />-   **AES128-SHA1** использует шифрование AES128-CTS-HMAC-SHA1-96.<br />-   **Все** состояния, в которых можно использовать все поддерживаемые типы шифрования. **Примечание.** Параметры по умолчанию основаны на старых версиях MIT. Поэтому всегда `/crypto` следует указывать. |
|                                             /итеркаунт                                             |                                                                                                                                                                                                                        Указывает число итераций, используемое для шифрования AES. По умолчанию **итеркаунт** игнорируется для шифрования, отличного от AES, и устанавливается в 4 096 для шифрования AES.                                                                                                                                                                                                                         |
|               /птипе {KRB5_NT_PRINCIPAL&#124;KRB5_NT_SRV_INST&#124;KRB5_NT_SRV_HST}                |                                                                                                                                                                                         Указывает тип участника.<p>-   **KRB5_NT_PRINCIPAL** является общим типом участника (рекомендуется).<br />-   **KRB5_NT_SRV_INST** является экземпляром пользовательской службы.<br />-   **KRB5_NT_SRV_HST** является экземпляром службы узла.                                                                                                                                                                                         |
|                                       /квно<KeyversionNum>                                        |                                                                                                                                                                                                                                                                               Указывает номер версии ключа. Значение по умолчанию — 1.                                                                                                                                                                                                                                                                                |
|                                         /ансвер {-&#124;+}                                         |                                                                                                                                                                                                                    Задает фоновый режим ответов:<p>**-** Ответ автоматически сбрасывает запрос пароля.<p>**+** Ответ на запрос сброса пароля автоматически.                                                                                                                                                                                                                     |
|                                              /target                                               |                                                                                                                                                                                           Задает используемый контроллер домена. По умолчанию контроллер домена определяется на основе имени участника. Если имя контроллера домена не разрешается, в диалоговом окне будет предложено ввести допустимый контроллер домена.                                                                                                                                                                                           |
|                                              /равсалт                                              |                                                                                                                                                                                                                                                           заставляет ктпасс использовать алгоритм равсалт при создании ключа. Этот параметр не требуется.                                                                                                                                                                                                                                                            |
|                                         Думпсалт {-&#124;+}                                         |                                                                                                                                                                                                                                                           Выходные данные этого параметра показывают алгоритм соли MIT, который используется для создания ключа.                                                                                                                                                                                                                                                            |
|                                          Сетупн {-&#124;+}                                          |                                                                                                                                                                                                                                          Задает имя участника-пользователя (UPN) в дополнение к имени участника-службы (SPN). По умолчанию оба значения задаются в файле. keytab.                                                                                                                                                                                                                                           |
|                                    "{-&#124;+} setpass"<Password>                                    |                                                                                                                                                                                                                                                          Задает пароль пользователя при его предоставлении. Если используется рндпасс, вместо него создается случайный пароль.                                                                                                                                                                                                                                                           |
|                                       /? &#124;/h&#124;/Help                                        |                                                                                                                                                                                                                                                                                         Отображает справку командной строки для ктпасс.                                                                                                                                                                                                                                                                                         |

## <a name="remarks"></a><a name=BKMK_remarks></a>Примечания  
Службы, работающие на системах, работающих под управлением операционной системы Windows, могут быть настроены с учетными записями экземпляра службы в доменных службах Active Directory. Это позволяет любому клиенту Kerberos проходить проверку подлинности в службах, не работающих под управлением операционной системы Windows, с помощью Windows Кдкс.  
Параметр/принк не вычисляется с помощью ктпасс и используется, как указано. Не проверяется соответствие параметра точному регистру значения атрибута **userPrincipalName** при создании файла keytab. В случае с учетом регистра Kerberos, использующих этот keytab-файл, могут возникать проблемы при отсутствии точного совпадения регистра и может произойти сбой во время предварительной проверки подлинности. Проверьте и получите правильное значение атрибута **userPrincipalName** из файла экспорта LDifDE. Пример:  
```  
ldifde /f keytab_user.ldf /d CN=Keytab User,OU=UserAccounts,DC=contoso,DC=corp,DC=microsoft,DC=com /p base /l samaccountname,userprincipalname  
```  
## <a name="examples"></a>Примеры  
Демонстрация создания файла Kerberos. keytab, Machine. keytab, в текущем каталоге для пользователя sample1. (Этот файл будет объединен с файлом krb5. keytab на главном компьютере, на котором не установлена операционная система Windows.) Файл Kerberos. keytab будет создан для всех поддерживаемых типов шифрования для общего типа субъекта.  
Чтобы создать keytab-файл для главного компьютера, на котором не установлена операционная система Windows, выполните следующие действия, чтобы связать субъект с учетной записью и задать пароль субъекта-службы:  
1.  Используйте оснастку "пользователи и компьютеры Active Directory", чтобы создать учетную запись пользователя для службы на компьютере, на котором не установлена операционная система Windows. Например, создайте учетную запись с именем sample1.  
2.  Используйте ктпасс, чтобы настроить сопоставление удостоверений для учетной записи пользователя, введя следующую команду в командной строке:  
    ```  
    ktpass /princ host/Sample1.contoso.com@CONTOSO.COM /mapuser Sample1 /pass MyPas$w0rd /out Sample1.keytab /crypto all /ptype KRB5_NT_PRINCIPAL /mapop set   
    ```  

    > [!NOTE]  
    > Нельзя сопоставлять несколько экземпляров службы с одной и той же учетной записью пользователя.  

3.  Объедините файл. keytab с файлом/Etc/Krb5.keytab на главном компьютере, на котором не установлена операционная система Windows. 

## <a name="additional-references"></a>Дополнительные ссылки  
- [Условные обозначения синтаксиса команд командной строки](command-line-syntax-key.md)  
