---
title: ktpass
description: Справочная статья по команде ктпасс, которая настраивает имя участника на сервере для узла или службы в AD DS и создает keytab-файл, содержащий общий секретный ключ службы.
ms.topic: article
ms.assetid: 47087676-311e-41f1-8414-199740d01444
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 3bb523d35a1bbf2d15895201855a58e96ebb7772
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87887648"
---
# <a name="ktpass"></a>ktpass

> Область применения: Windows Server (половина ежегодного канала), Windows Server 2019, Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Настраивает имя участника на сервере для узла или службы в домен Active Directory Services (AD DS) и создает файл. keytab, содержащий общий секретный ключ службы. Keytab-файл основан на реализации протокола проверки подлинности Kerberos Массачусетс института Technology (MIT). Средство командной строки ктпасс позволяет использовать службы, отличные от Windows, поддерживающие проверку подлинности Kerberos, для использования функций взаимодействия, предоставляемых службой центр распространения ключей Kerberos (KDC).

## <a name="syntax"></a>Синтаксис

```
ktpass
[/out <filename>]
[/princ <principalname>]
[/mapuser <useraccount>]
[/mapop {add|set}] [{-|+}desonly] [/in <filename>]
[/pass {password|*|{-|+}rndpass}]
[/minpass]
[/maxpass]
[/crypto {DES-CBC-CRC|DES-CBC-MD5|RC4-HMAC-NT|AES256-SHA1|AES128-SHA1|All}]
[/itercount]
[/ptype {KRB5_NT_PRINCIPAL|KRB5_NT_SRV_INST|KRB5_NT_SRV_HST}]
[/kvno <keyversionnum>]
[/answer {-|+}]
[/target]
[/rawsalt] [{-|+}dumpsalt] [{-|+}setupn] [{-|+}setpass <password>]  [/?|/h|/help]
```

### <a name="parameters"></a>Параметры

| Параметр | Описание |
| --------- | ------------|
| /out`<filename>` | Указывает имя создаваемого файла Kerberos версии 5. keytab. **Примечание.** Это keytab-файл, который передается на компьютер, на котором не установлена операционная система Windows, а затем заменяется или объединяется с существующим keytab-файлом */etc/krb5.keytab*. |
| /princ `<principalname>` | Указывает имя участника в форме host/computer.contoso.com@CONTOSO.COM . **Предупреждение:** Этот параметр учитывает регистр. |
| /mapuser `<useraccount>` | Сопоставляет имя участника Kerberos, указанного параметром **принк** , с указанной учетной записью домена. |
| /мапоп`{add|set}` | Указывает, как задается атрибут mapping.<ul><li>**Добавить** — добавляет значение указанного локального имени пользователя. Это значение по умолчанию.</li><li>**Set** — задает значение для шифрования по стандарту шифрования данных (DES) только для указанного локального имени пользователя.</li></ul> |
| `{-|+}`десонли | Шифрование только по алгоритму DES установлено по умолчанию.<ul><li>**+** Задает учетную запись для шифрования только по алгоритму DES.</li><li>**-** Выдает ограничение на учетную запись для шифрования только по алгоритму DES. **Важно.** По умолчанию Windows не поддерживает DES.</li></ul> |
| /in`<filename>` | Указывает keytab-файл для чтения с главного компьютера, на котором не установлена операционная система Windows. |
| /пасс`{password|*|{-|+}rndpass}` | Задает пароль для основного имени пользователя, заданного параметром **принк** . Используется `*` для запроса пароля. |
| /минпасс | Устанавливает минимальную длину случайного пароля в 15 символов. |
| /макспасс | Устанавливает максимальную длину случайного пароля в 256 символов. |
| /крипто`{DES-CBC-CRC|DES-CBC-MD5|RC4-HMAC-NT|AES256-SHA1|AES128-SHA1|All}` | Задает ключи, создаваемые в файле keytab:<ul><li>**Des-CBC-CRC** -используется для совместимости.</li><li>**Des-CBC-MD5** — тесно соответствует реализации MIT и используется для обеспечения совместимости.</li><li>**RC4-HMAC-NT** — использует 128-разрядное шифрование.</li><li>**AES256-SHA1** — использует шифрование AES256-CTS-HMAC-SHA1-96.</li><li>   **AES128-SHA1** — использует шифрование AES128-CTS-HMAC-SHA1-96.</li><li>**ALL** — состояния, в которых можно использовать все поддерживаемые типы шифрования.</li></ul><p>**Примечание.** Поскольку параметры по умолчанию основаны на старых версиях MIT, всегда следует использовать `/crypto` параметр. |
| /итеркаунт | Указывает число итераций, используемое для шифрования AES. Значение по умолчанию игнорирует **итеркаунт** для шифрования, отличного от AES, и устанавливает шифрование AES в 4 096. |
| /птипе`{KRB5_NT_PRINCIPAL|KRB5_NT_SRV_INST|KRB5_NT_SRV_HST}` | Указывает тип участника.<ul><li>**KRB5_NT_PRINCIPAL** — общий тип участника (рекомендуется).</li><li>**KRB5_NT_SRV_INST** — экземпляр пользовательской службы</li><li>  **KRB5_NT_SRV_HST** — экземпляр службы узла;</li></ul> |
| /квно`<keyversionnum>` | Указывает номер версии ключа. Значение по умолчанию — 1. |
| /ансвер`{-|+}` | Задает фоновый режим ответов:<ul><li>**-** Ответ автоматически сбрасывает запрос **пароля.**</li><li>**+** Ответ на запрос сброса пароля автоматически **.**</li></ul> |
| /target | Задает используемый контроллер домена. По умолчанию контроллер домена определяется на основе имени участника. Если имя контроллера домена не разрешается, в диалоговом окне будет предложено ввести допустимый контроллер домена. |
| /равсалт | заставляет ктпасс использовать алгоритм равсалт при создании ключа. Это необязательный параметр. |
| `{-|+}dumpsalt` | Выходные данные этого параметра показывают алгоритм соли MIT, который используется для создания ключа. |
| `{-|+}setupn` | Задает имя участника-пользователя (UPN) в дополнение к имени участника-службы (SPN). По умолчанию оба значения задаются в файле. keytab. |
| `{-|+}setpass <password>` | Задает пароль пользователя при его предоставлении. Если используется рндпасс, вместо него создается случайный пароль. |
| /? | Отображает справку для этой команды. |

#### <a name="remarks"></a>Remarks

- Службы, работающие в системах, которые не работают под управлением операционной системы Windows, можно настроить с учетными записями экземпляра службы в AD DS. Это позволяет любому клиенту Kerberos проходить проверку подлинности в службах, не работающих под управлением операционной системы Windows, с помощью Windows Кдкс.

- Параметр **/принк** не вычисляется с помощью ктпасс и используется, как указано. Не проверяется соответствие параметра точному регистру значения атрибута **userPrincipalName** при создании файла keytab. При использовании этого keytab-распределения с учетом регистра могут возникнуть проблемы при отсутствии точного совпадения регистра и даже при предварительной проверке подлинности. Проверка и получение правильного значения атрибута **userPrincipalName** из файла экспорта LDifDE. Пример:

    ```
    ldifde /f keytab_user.ldf /d CN=Keytab User,OU=UserAccounts,DC=contoso,DC=corp,DC=microsoft,DC=com /p base /l samaccountname,userprincipalname
    ````

### <a name="examples"></a>Примеры

Чтобы создать файл Kerberos. keytab для главного компьютера, на котором не установлена операционная система Windows, необходимо связать субъект с учетной записью и задать пароль субъекта узла.

1. Используйте оснастку " **Пользователи и компьютеры** Active Directory", чтобы создать учетную запись пользователя для службы на компьютере, на котором не установлена операционная система Windows. Например, создайте учетную запись с именем *User1*.

2. Используйте команду **ктпасс** , чтобы настроить сопоставление удостоверений для учетной записи пользователя, введя:

    ```
    ktpass /princ host/User1.contoso.com@CONTOSO.COM /mapuser User1 /pass MyPas$w0rd /out machine.keytab /crypto all /ptype KRB5_NT_PRINCIPAL /mapop set
    ```

    > [!NOTE]
    > Нельзя сопоставлять несколько экземпляров службы с одной и той же учетной записью пользователя.

3. Объедините файл. keytab с файлом */etc/krb5.keytab* на главном компьютере, на котором не установлена операционная система Windows.

## <a name="additional-references"></a>Дополнительные ссылки

- [Условные обозначения синтаксиса команд командной строки](command-line-syntax-key.md)
