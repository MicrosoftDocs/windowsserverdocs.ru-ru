---
title: Добавление фильтра пктмон
description: Справочная статья для команды фильтра пктмон Add.
ms.topic: reference
author: khdownie
ms.author: v-kedow
ms.date: 1/14/2021
ms.openlocfilehash: e1e69bbad5433eedd582b1d6218e462b4c70f71d
ms.sourcegitcommit: 5dd48d0da9400d7e8a6ae40b4c977d1703c4e669
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/15/2021
ms.locfileid: "98241170"
---
# <a name="pktmon-filter-add"></a>Добавление фильтра пктмон

> Область применения: Windows Server (половина ежегодного канала), Windows Server 2019, Windows 10, Azure Stack ХЦИ, центр Azure Stack, Azure

Добавление фильтра пктмон позволяет добавить фильтр для управления переданными пакетами. Чтобы сообщить о пакете, он должен соответствовать всем условиям, указанным по крайней мере в одном фильтре. Одновременно может быть активно до восьми фильтров.

## <a name="syntax"></a>Синтаксис

```
pktmon filter add <name> [-m mac [mac2]] [-v vlan] [-d { IPv4 | IPv6 | number }]
                         [-t { TCP [flags...] | UDP | ICMP | ICMPv6 | number }]
                         [-i ip [ip2]] [-p port [port2]] [-e [port]]
```

Вы можете указать необязательное имя или описание фильтра.

  > [!NOTE]
  > Если указаны два компьютера Mac (-m), IP-адрес (i) или порты (-p), фильтр сопоставляет пакеты, содержащие оба. Для этой цели не будет различить источник или назначение.

### <a name="parameters"></a>Параметры

| **Параметр** | **Описание** |
| ------------- | --------------- |
| **-m,--Mac [-address]** | Совпадение с исходным или целевым MAC-адресом. См. примечание выше. |
| **-v,--VLAN** | Совпадение с ИД виртуальной ЛС (VID) в заголовке 802.1 Q. |
| **-d,--Data-Link [-Protocol],--есертипе** | Сопоставление по протоколу канала данных (уровень 2). Может быть IPv4, IPv6, ARP или номером протокола. |
| **-t,--Transport [-Protocol],--IP-протокол** | Соответствует протоколу транспорта (Layer 4). Может принимать значения TCP, UDP, ICMP, ICMPv6 или номер протокола. Для дальнейшей фильтрации пакетов TCP можно указать дополнительный список флагов TCP для сопоставления. Поддерживаемые флаги: FIN, SYN, RST, КОМАНДНОМ PSH, ACK, УРГ, ECE и КВР. |
| **-i,--IP-адрес [-address]** | Совпадение с исходным или целевым IP-адресом. См. примечание выше. Для сопоставления по подсети используйте нотацию CIDR с длиной префикса. |
| **-p,--Port** | Совпадение с исходным или целевым номером порта. См. примечание выше. |
| **-e,--енкап** | Этот фильтр также применяется к инкапсулированным внутренним пакетам в дополнение к внешнему пакету. Поддерживаемые методы инкапсуляции: ВКСЛАН, GRE, NVGRE и IP-in-IP. Пользовательский порт ВКСЛАН является необязательным и по умолчанию равен 4789. |

## <a name="examples"></a>Примеры

Следующий набор фильтров захватывает трафик ICMP, входящий в IP-адрес 10.0.0.10, а также трафик через порт 53.

```PowerShell
C:\Test> pktmon filter add -i 10.0.0.10 -t icmp
C:\Test> pktmon filter add -p 53
```

Следующий фильтр будет фиксировать все пакеты SYN, отправленные или полученные IP-адресом 10.0.0.10:

```PowerShell
C:\Test> pktmon filter add -i 10.0.0.10 -t tcp syn
```

Следующий фильтр с именем **мипинг** проверяет связь с протоколом ICMP:

```PowerShell
C:\Test> pktmon filter add MyPing -i 10.10.10.10 -t ICMP
```

Следующий фильтр с именем **мисмбсиб** ЗАхватывает TCP-трафик с синхронизацией по протоколу SMB:

```PowerShell
C:\Test> pktmon filter add MySmbSyn -i 10.10.10.10 -t TCP SYN -p 445
```

Следующий фильтр с именем **MySubnet** захватывает трафик в маске подсети 255.255.255.0 или/24 в нотации CIDR:

```PowerShell
C:\Test> pktmon filter add MySubnet -i 10.10.10.0/24
```

## <a name="other-references"></a>Прочие ссылки

- [пктмон](pktmon.md)
- [Пктмонная Comp](pktmon-comp.md)
- [Счетчики пктмон](pktmon-counters.md)
- [Фильтр пктмон](pktmon-filter.md)
- [Формат пктмон](pktmon-format.md)
- [Список пктмон](pktmon-list.md)
- [Пктмон пкапнг](pktmon-pcapng.md)
- [Сброс пктмон](pktmon-reset.md)
- [Запуск пктмон](pktmon-start.md)
- [Выгрузка пктмон](pktmon-unload.md)
- [Общие сведения о мониторе пакетов](/windows-server/networking/technologies/pktmon/pktmon)
