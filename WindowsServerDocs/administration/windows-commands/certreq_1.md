---
title: certreq
description: Раздел команд Windows для certreq, который запрашивает сертификаты из центра сертификации, получает ответ на предыдущий запрос от центра сертификации, создает новый запрос из INF-файла, принимает и устанавливает ответ на запрос, создает запрос на перекрестную сертификацию или квалифицированное подчинение на основе существующего сертификата или запроса ЦС, а также подписывает запрос на перекрестную сертификацию или квалифицированное подчинение.
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: 7a04e51f-f395-4bff-b57a-0e9efcadf973
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: babe28932b57fd0a1adc39ba1cb9a8018552c331
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80848217"
---
# <a name="certreq"></a>certreq

Certreq можно использовать для запроса сертификатов из центра сертификации (ЦС), получение ответа на предыдущий запрос из центра сертификации для создания нового запроса из INF-файла для принятия и установки ответа на запрос, создания запроса на перекрестную сертификацию или квалифицированного подчинения из существующего сертификата или запроса ЦС, а также для подписания запроса на перекрестную сертификацию или запрос на квалифицированное подчинение.

> [!WARNING]
> Более ранние версии certreq могут не предоставлять все параметры, описанные в этом документе. Вы можете просмотреть все параметры, предоставляемые конкретной версией средства certreq, выполнив команды, показанные в разделе синтаксические обозначения. Certreq не поддерживает создание нового запроса на сертификат на основе шаблона аттестации ключей в среде CEP/CES

## <a name="contents"></a><a name=BKMK_Contents></a>Содержимое

Ниже приведены основные разделы этой статьи.
1.  [Команды](#BKMK_Verbs)
2.  [Синтаксические нотации](#BKMK_notation)
3.  [Параметры](#BKMK_Options)
4.  [Форматирование](#BKMK_Formats)
5.  [Дополнительные примеры Certreq](#BKMK_Examples)

## <a name="verbs"></a><a name=BKMK_Verbs></a>Команды

В следующей таблице описаны глаголы, которые можно использовать с командой Certreq.

|Переключатель|Описание|
|------|-----------|
|-Отправить|Отправляет запрос в центр сертификации. Дополнительные сведения см. в разделе [certreq-Submit](#BKMK_Submit).|
|— получение *ИД запроса*|Извлекает ответ на предыдущий запрос от центра сертификации. Дополнительные сведения см. в разделе [certreq — извлечение](#BKMK_Retrieve).|
|-Создать|Создает новый запрос из INF-файла. Дополнительные сведения см. в разделе [certreq-new](#BKMK_New).|
|— Принять|Принимает и устанавливает ответ на запрос сертификата. Дополнительные сведения см. в разделе [certreq-Accept](#BKMK_accept).|
|Политика|Задает политику для запроса. Дополнительные сведения см. в разделе [certreq-Policy](#BKMK_policy).|
|-Sign|Подписывает запрос на перекрестную сертификацию или квалифицированное подчинение. Дополнительные сведения см. в разделе [certreq-Sign](#BKMK_sign).|
|Регистрация|Регистрирует или обновляет сертификат. Дополнительные сведения см. в разделе [certreq-регистрация](#BKMK_enroll).|
|-?|Отображает список синтаксиса, параметров и описаний средства Certreq.|
|*\<глагол >* -?|Отображает справку для указанного глагола.|
|-v-?|Отображает подробный список синтаксиса, параметров и описаний Certreq.|

Вернуться к [содержимому](#BKMK_Contents)

## <a name="syntax-notations"></a><a name=BKMK_notation></a>Синтаксические нотации

-   Для базового синтаксиса командной строки выполните `certreq -?`
-   Для синтаксиса команды certutil с определенной командой выполните команду **certreq** *\<verb >* **-?**
-   Чтобы отправить весь синтаксис certutil в текстовый файл, выполните следующие команды:  
    -   `certreq -v -? > certreqhelp.txt`
    -   `notepad certreqhelp.txt`

В следующей таблице описана нотация, используемая для указания синтаксиса командной строки.

|Представлении|Описание|
|--------|-----------|
|Текст без квадратных или фигурных скобок|Необходимо ввести элементы, как показано|
|\<текст внутри угловых скобок >|Заполнитель, для которого необходимо указать значение|
|[Текст в квадратных скобках]|Необязательные элементы|
|{Текст в фигурных скобках}|Набор обязательных элементов; Выберите один|
|Вертикальная черта (&#124;)|Разделитель для взаимоисключающих элементов; Выберите один|
|Кнопка с многоточием (…)|Элементы, которые могут повторяться|

Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--submit"></a><a name=BKMK_Submit></a>Certreq — отправка

Это параметр Certreq. exe по умолчанию, если параметр не указан явно в командной строке, Программа CertReq. exe пытается отправить запрос на сертификат в центр сертификации.
```
CertReq [-Submit] [Options] [RequestFileIn [CertFileOut [CertChainFileOut [FullResponseFileOut]]]]
```
При использовании параметра – Submit необходимо указать файл запроса сертификата. Если этот параметр пропущен, отображается общее окно открытия файла, где можно выбрать соответствующий файл запроса сертификата.

Эти примеры можно использовать в качестве отправной точки для создания запроса на отправку сертификата:

Чтобы отправить запрос на простой сертификат, используйте следующий пример:
```
certreq –submit certRequest.req certnew.cer certnew.pfx
```
Чтобы запросить сертификат, указав атрибут SAN, ознакомьтесь с подробными инструкциями в статье базы знаний Майкрософт 931351 [Добавление альтернативного имени субъекта к защищенному сертификату LDAP](https://support.microsoft.com/kb/931351) в разделе Использование служебной программы Certreq. exe для создания и отправки запроса на сертификат, включающего раздел San.

Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--retrieve"></a><a name=BKMK_Retrieve></a>Certreq — получение

```
certreq -retrieve [Options] RequestId [CertFileOut [CertChainFileOut [FullResponseFileOut]]]
```
-   Если вы не укажете диалоговое окно Имякомпьютерацс или Имя_цс in-config Какомпутернаме\канамеа, отобразится список всех доступных центров сертификации.
-   Если -config - используется вместо -config имя_компьютера_ЦС\название_ЦС, операция выполняется с использованием центра сертификации по умолчанию.
-   Чтобы получить сертификат после его фактического выдачи, можно использовать certreq — получение *RequestId* . Идентификатор *RequestId*ПКК может быть десятичным или шестнадцатеричным с префиксом 0x. он может быть серийным номером сертификата без префикса 0x. Его также можно использовать для получения сертификата, который когда-либо выдавался центром сертификации, включая отозванные или просроченные сертификаты, независимо от того, находится ли запрос сертификата в состоянии ожидания.
-   При отправке запроса в ЦС модуль политики ЦС может оставить запрос в состоянии ожидания и вернуть код *запроса* в окно certreq для отображения. В конечном итоге администратор ЦС выдаст сертификат или отклонит запрос.

Приведенная ниже команда извлекает сертификат с идентификатором 20 и создает файл сертификата (CER):
```
certreq -retrieve 20 MyCertificate.cer 
```
Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--new"></a><a name=BKMK_New></a>Certreq — new

```
certreq -new [Options] [PolicyFileIn [RequestFileOut]]
```
Поскольку INF-файл позволяет указать богатый набор параметров и параметров, трудно определить шаблон по умолчанию, который администраторы должны использовать для всех целей. Поэтому в этом разделе описаны все параметры, позволяющие создать INF-файл, отвечающий конкретным потребностям. Для описания структуры INF-файла используются следующие ключевые слова.
1.  *Раздел* — это область в INF-файле, охватывающая логическую группу ключей. Раздел всегда появляется в квадратных скобках в INF-файле.
2.  *Ключ* — это параметр, который находится слева от знака равенства.
3.  *Значение* — это параметр, расположенный справа от знака равенства.

Например, минимальный INF-файл будет выглядеть следующим образом:
```
[NewRequest] 
; At least one value must be set in this section 
Subject = CN=W2K8-BO-DC.contoso2.com
```
Ниже приведены некоторые из возможных разделов, которые можно добавить в INF-файл.

**NewRequest**

Этот раздел является обязательным для INF-файла, который выступает в качестве шаблона для нового запроса на сертификат. Для этого раздела требуется по крайней мере один ключ со значением.

|Ключ|Определение|Значение|Пример|
|---|----------|-----|-------|
|Субъект|Несколько приложений используют сведения о субъекте в сертификате. Поэтому рекомендуется указать значение для этого ключа. Если субъект не задан, рекомендуется включать имя субъекта как часть расширения сертификата альтернативного имени субъекта.|Строковые значения относительного различающегося имени|Subject = CN = COMPUTER1. contoso. com subject = CN = John Smith, CN = Users, DC = contoso, DC = com|
|Exportable|Если для этого атрибута задано значение TRUE, закрытый ключ можно экспортировать с помощью сертификата. Чтобы обеспечить высокий уровень безопасности, закрытые ключи не должны быть экспортированы. Однако в некоторых случаях может потребоваться сделать закрытый ключ экспортируемым, если несколько компьютеров или пользователей должны совместно использовать один закрытый ключ.|true, false|Exported = TRUE. Ключи CNG могут различать этот и экспортируемый текст. Ключи CAPI1 не могут быть.|
|експортаблинкриптед|Указывает, должен ли закрытый ключ быть настроен для экспорта.|true, false|Експортаблинкриптед = true</br>Совет. не все размеры открытых ключей и алгоритмы будут работать со всеми алгоритмами хэширования. Тамехе, указанный CSP, должен также поддерживать указанный хэш-алгоритм. Чтобы просмотреть список поддерживаемых хэш-алгоритмов, можно выполнить команду <code>certutil -oid 1 &#124; findstr pwszCNGAlgid &#124; findstr /v CryptOIDInfo</code>|
|HashAlgorithm|Хэш-алгоритм, используемый для этого запроса.|SHA256, SHA384, SHA512, SHA1, MD5, MD4, MD2|HashAlgorithm = SHA1. Чтобы просмотреть список поддерживаемых хэш-алгоритмов, используйте: certutil-OID &#124; 1 findstr &#124; пвсзкнгалгид findstr/v криптоидинфо|
|кэйалгорисм|Алгоритм, который будет использоваться поставщиком услуг для создания пары открытого и закрытого ключей.|RSA, DH, DSA, ECDH_P256, ECDH_P521, ECDSA_P256, ECDSA_P384, ECDSA_P521|Кэйалгорисм = RSA|
|KeyContainer|Не рекомендуется задавать этот параметр для новых запросов, в которых создается новый материал ключа. Контейнер ключей автоматически создается и обслуживается системой. Для запросов, в которых следует использовать существующий ключевой материал, это значение можно задать в качестве имени контейнера ключа для существующего ключа. Используйте команду certutil – Key, чтобы отобразить список доступных контейнеров ключей для контекста компьютера. Используйте команду certutil – Key-User для контекста текущего пользователя.|Случайное строковое значение</br>Совет. следует использовать двойные кавычки вокруг любого значения ключа INF, которое содержит пробелы или специальные символы, чтобы избежать потенциальных проблем синтаксического анализа INF.|KeyContainer = {C347BD28-7F69-4090-AA16-BC58CF4D749C}|
|KeyLength|Определяет длину открытого и закрытого ключей. Длина ключа влияет на уровень безопасности сертификата. Большая длина ключа обычно обеспечивает более высокий уровень безопасности. Однако некоторые приложения могут иметь ограничения, связанные с длиной ключа.|Любая допустимая длина ключа, поддерживаемая поставщиком служб шифрования.|KeyLength = 2048|
|KeySpec|Определяет, можно ли использовать ключ для подписей, для обмена (шифрования) или для обоих.|AT_NONE, AT_SIGNATURE AT_KEYEXCHANGE|KeySpec = AT_KEYEXCHANGE|
|кэйусаже|Определяет, для чего следует использовать ключ сертификата.|CERT_DIGITAL_SIGNATURE_KEY_USAGE--80 (128)</br>Совет. отображаемые значения — это шестнадцатеричные (десятичные) значения для каждого определения бита. Более старый синтаксис также можно использовать: одно шестнадцатеричное значение с несколькими наборами битов вместо символьного представления. Например, Кэйусаже = 0x82.</br>CERT_NON_REPUDIATION_KEY_USAGE--40 (64)</br>CERT_KEY_ENCIPHERMENT_KEY_USAGE--20 (32)</br>CERT_DATA_ENCIPHERMENT_KEY_USAGE--10 (16)</br>CERT_KEY_AGREEMENT_KEY_USAGE--8</br>CERT_KEY_CERT_SIGN_KEY_USAGE--4</br>CERT_OFFLINE_CRL_SIGN_KEY_USAGE--2</br>CERT_CRL_SIGN_KEY_USAGE--2</br>CERT_ENCIPHER_ONLY_KEY_USAGE--1</br>CERT_DECIPHER_ONLY_KEY_USAGE--8000 (32768)|Кэйусаже = CERT_DIGITAL_SIGNATURE_KEY_USAGE &#124; CERT_KEY_ENCIPHERMENT_KEY_USAGE</br>Совет. несколько значений используют разделитель символов вертикальной черты (&#124;). Обязательно используйте двойные кавычки при использовании нескольких значений, чтобы избежать проблем с синтаксическим анализом INF.|
|кэйусажепроперти|Извлекает значение, определяющее конкретную цель, для которой можно использовать закрытый ключ.|NCRYPT_ALLOW_DECRYPT_FLAG--1</br>NCRYPT_ALLOW_SIGNING_FLAG--2</br>NCRYPT_ALLOW_KEY_AGREEMENT_FLAG--4</br>NCRYPT_ALLOW_ALL_USAGES--FFFFFF (16777215)|Кэйусажепроперти = NCRYPT_ALLOW_DECRYPT_FLAG &#124; NCRYPT_ALLOW_SIGNING_FLAG|
|MachineKeySet|Этот ключ важен, если необходимо создать сертификаты, принадлежащие компьютеру, а не пользователю. Создаваемый ключевой материал сохраняется в контексте безопасности субъекта безопасности (учетной записи пользователя или компьютера), создавшего запрос. Когда администратор создает запрос на сертификат от имени компьютера, материал ключа должен быть создан в контексте безопасности компьютера, а не в контексте безопасности администратора. В противном случае компьютер не сможет получить доступ к закрытому ключу, так как он был бы в контексте безопасности администратора.|true, false|MachineKeySet = true</br>Совет. значение по умолчанию — false.|
|NotBefore|Указывает дату или дату и время, до которого запрос не может быть выдан. NotBefore можно использовать с Валидитипериод и Валидитипериодунитс.|Дата или Дата и время|NotBefore = 7/24/2012 10:31 AM</br>Совет. NotBefore и NotAfter предназначены для RequestType = CERT only. Попытки синтаксического анализа даты, зависящие от языкового стандарта. Использование названий месяцев не позволит устранить неоднозначность и будет работать в каждом языковом стандарте.|
|NotAfter|Указывает дату или дату и время, по истечении которых запрос не может быть выдан. NotAfter нельзя использовать с Валидитипериод или Валидитипериодунитс.|Дата или Дата и время|NotAfter = 9/23/2014 10:31 AM</br>Совет. NotBefore и NotAfter предназначены для RequestType = CERT only. Попытки синтаксического анализа даты, зависящие от языкового стандарта. Использование названий месяцев не позволит устранить неоднозначность и будет работать в каждом языковом стандарте.|
|приватекэйарчиве|Параметр Приватекэйарчиве работает, только если для соответствующего параметра RequestType задано значение CMC, так как только сообщения управления сертификатами в формате запроса CMS (CMC) позволяют безопасно передавать закрытый ключ инициатора запроса в ЦС для архивирования ключей.|true, false|Приватекэйарчиве = true|
|EncryptionAlgorithm|Используемый алгоритм шифрования.|Возможные параметры различаются в зависимости от версии операционной системы и набора установленных поставщиков служб шифрования. Чтобы просмотреть список доступных алгоритмов, выполните команду, <code>certutil -oid 2 &#124; findstr pwszCNGAlgid</code> указанный используемый CSP должен также поддерживать указанный алгоритм симметричного шифрования и длину.|EncryptionAlgorithm = 3DES|
|енкриптионленгс|Длина используемого алгоритма шифрования.|Любая длина, разрешенная указанным EncryptionAlgorithm.|Енкриптионленгс = 128|
|ProviderName|Имя поставщика — это отображаемое имя CSP.|Если вы не знакомы с именем поставщика CSP, выполните команду certutil-ксплист из командной строки. Команда отобразит имена всех CSP, доступных в локальной системе.|ProviderName = поставщик служб шифрования Microsoft RSA SChannel|
|ProviderType|Тип поставщика используется для выбора конкретных поставщиков на основе конкретных возможностей алгоритма, таких как RSA Full.|Если вы не знакомы с типом поставщика CSP, выполните команду certutil-ксплист из командной строки. Команда отобразит тип поставщика всех CSP, доступных в локальной системе.|ProviderType = 1|
|реневалцерт|Если необходимо продлить сертификат, существующий в системе, в которой создается запрос сертификата, необходимо указать его хэш сертификата в качестве значения для этого ключа.|Хэш сертификата любого сертификата, доступного на компьютере, на котором создается запрос на сертификат. Если вы не узнаете хэш сертификата, используйте оснастку MMC "сертификаты" и просмотрите сертификат, который следует обновить. Откройте свойства сертификата и просмотрите атрибут отпечатка сертификата. Для продления сертификата требуется формат запроса PKCS # 7 или CMC.|Реневалцерт = 4EDF274BD2919C6E9EC6A522F0F3B153E9B1582D|
|RequesterName</br>Примечание. это делает запрос на регистрацию от имени другого запроса пользователя. Запрос также должен быть подписан с помощью сертификата агента регистрации, иначе центр сертификации отклонит запрос. Используйте параметр-CERT, чтобы указать сертификат агента регистрации.|Имя запросившего можно указать для запросов на сертификат, если для RequestType задано значение PKCS # 7 или CMC. Если для RequestType задано значение PKCS # 10, этот ключ будет проигнорирован. Рекуестернаме можно задать только в составе запроса. Вы не можете манипулировать Рекуестернаме в ожидающем запросе.|Домен \ пользователь|Рекуестернаме = Контосо\бсмис|
|RequestType|Определяет стандарт, используемый для создания и отправки запроса на сертификат.|PKCS10--1</br>PKCS7--2</br>CMC--3</br>CERT--4</br>SCEP — fd00 (64768)</br>Совет. Этот параметр указывает на самозаверяющий или самостоятельно выданный сертификат. Он не создает запрос, а новый сертификат, а затем устанавливает сертификат. По умолчанию используется Self-подпись. Укажите сертификат подписи с помощью параметра – CERT, чтобы создать самозаверяющий сертификат, который не является самозаверяющим.|RequestType = CMC|
|SecurityDescriptor</br>Совет. Это относится только к несмартным ключам машинного контекста.|Содержат сведения о безопасности, связанные с защищаемыми объектами. Для большинства защищаемых объектов можно указать дескриптор безопасности объекта в вызове функции, который создает объект.|Строки, основанные на [языке определения дескрипторов безопасности](https://msdn.microsoft.com/library/aa379567(v=vs.85).aspx).|SecurityDescriptor = Д:П (A;; Общедоступный;;; SY) (A;; Общедоступный;;; Бизнес|
|алтернатесигнатуреалгорисм|Указывает и получает логическое значение, указывающее, является ли идентификатор объекта алгоритма подписи для запроса или подписи сертификата PKCS # 10 дискретным или Объединенным.|true, false|Алтернатесигнатуреалгорисм = false</br>Совет. для подписи RSA значение false указывает на Pkcs1 v 1.5. Значение true указывает на сигнатуру версии 2.1.|
|Автоматически|По умолчанию этот параметр позволяет CSP получать доступ к рабочему столу интерактивного пользователя и запрашивать такие сведения, как ПИН-код с картой пользователя. Если этот ключ имеет значение TRUE, CSP не должен взаимодействовать с рабочим столом и будет блокировать отображение пользовательского интерфейса для пользователя.|true, false|Silent = true|
|ЗАШИФРОВАН|Если этот параметр имеет значение TRUE, то в запрос добавляется расширение с идентификатором объекта 1.2.840.113549.1.9.15. Количество идентификаторов объектов зависит от установленной версии операционной системы и возможности CSP, которые относятся к алгоритмам симметричного шифрования, которые могут использоваться приложениями, использующими безопасные многоцелевые расширения электронной почты Интернета (S/MIME), например Outlook.|true, false|SMIME = true|
|усиксистингкэйсет|Этот параметр используется, чтобы указать, что при создании запроса на сертификат следует использовать существующую пару ключей. Если для этого раздела задано значение TRUE, необходимо также указать имя для ключа Реневалцерт или KeyContainer. Не следует задавать экспортируемый ключ, так как нельзя изменить свойства существующего ключа. В этом случае материал ключа не создается при создании запроса на сертификат.|true, false|Усиксистингкэйсет = true|
|кэйпротектион|Задает значение, указывающее, как защищен закрытый ключ перед использованием.|XCN_NCRYPT_UI_NO_PROTCTION_FLAG--0</br>XCN_NCRYPT_UI_PROTECT_KEY_FLAG--1</br>XCN_NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG--2|Кэйпротектион = NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG|
|суппрессдефаултс|Задает логическое значение, указывающее, включаются ли в запрос расширения по умолчанию и атрибуты. Значения по умолчанию представлены идентификаторами объектов (OID).|true, false|Суппрессдефаултс = true|
|FriendlyName|Понятное имя для нового сертификата.|Text|FriendlyName = Server1|
|ValidityPeriodUnits</br>Примечание. используется, только если тип запроса — CERT.|Указывает число единиц, которое будет использоваться с Валидитипериод.|Числовой|Валидитипериодунитс = 3|
|ValidityPeriod</br>Примечание. используется, только если тип запроса — CERT.|Ввалидитипериод должен быть одновременным периодом английского языка (США).|Годы, месяцы, недели, дни, часы, минуты, секунды|Валидитипериод = годы|

Вернуться к [содержимому](#BKMK_Contents)

**Расширений**

Этот раздел является необязательным.


|  OID расширения   | Определение | Значение |                                                                                                                                                                                                                                                                                                                                                                                                                      Пример                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|------------|-------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    2.5.29.17     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                                2.5.29.17 = {текст}                                                                                                                                                                                                                                                                                                                                                                                                                |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                        *Continue* = UPN =User@Domain.com&                                                                                                                                                                                                                                                                                                                                                                                                         |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                       *Continue* = e-mail =User@Domain.com&                                                                                                                                                                                                                                                                                                                                                                                                        |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                        *продолжить* = DNS = Host. домен. com &                                                                                                                                                                                                                                                                                                                                                                                                         |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                               *Continue* = ДИРЕКТОРИНАМЕ = CN = имя, DC = Domain, DC = com &                                                                                                                                                                                                                                                                                                                                                                                               |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                             *Continue* = URL =<http://host.domain.com/default.html&>                                                                                                                                                                                                                                                                                                                                                                                              |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                         *Continue* = IPAddress = 10.0.0.1 &                                                                                                                                                                                                                                                                                                                                                                                                         |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                       *Continue* = регистередид = 1.2.3.4.5 &                                                                                                                                                                                                                                                                                                                                                                                                       |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                      *Continue* = 1.2.3.4.6.1 = {Utf8} строка &                                                                                                                                                                                                                                                                                                                                                                                                      |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                  *Continue* = 1.2.3.4.6.2 = {октет} ааекавкфбгк = &                                                                                                                                                                                                                                                                                                                                                                                                   |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                          *Continue* = 1.2.3.4.6.2 = {октет} {Hex} 00 01 02 03 04 05 06 07 &                                                                                                                                                                                                                                                                                                                                                                                           |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                 *Continue* = 1.2.3.4.6.3 = {ASN} багаакидбаугбв = = &                                                                                                                                                                                                                                                                                                                                                                                                  |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                           *Continue* = 1.2.3.4.6.3 = {Hex} 04 08 00 01 02 03 04 05 06 07                                                                                                                                                                                                                                                                                                                                                                                            |
|    2.5.29.37     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                                 2.5.29.37 = {текст}                                                                                                                                                                                                                                                                                                                                                                                                                 |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                            *Continue* = 1.3.6.1.5.5.7.                                                                                                                                                                                                                                                                                                                                                                                                            |
|    *продолжения*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                          *Continue* = 1.3.6.1.5.5.7.3.1                                                                                                                                                                                                                                                                                                                                                                                                          |
|    2.5.29.19     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                              {Text} CA = 0pathlength = 3                                                                                                                                                                                                                                                                                                                                                                                                              |
|     Критические важное     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                                 Критическая = 2.5.29.19                                                                                                                                                                                                                                                                                                                                                                                                                 |
|     KeySpec      |            |       |                                                                                                                                                                                                                                                                                                                                                                                             AT_NONE--0</br>AT_SIGNATURE--2</br>AT_KEYEXCHANGE--1                                                                                                                                                                                                                                                                                                                                                                                             |
|   RequestType    |            |       |                                                                                                                                                                                                                                                                                                                                                                                   PKCS10--1</br>PKCS7--2</br>CMC--3</br>CERT--4</br>SCEP — fd00 (64768)                                                                                                                                                                                                                                                                                                                                                                                   |
|     кэйусаже     |            |       |                                                                                                                                                                                                       CERT_DIGITAL_SIGNATURE_KEY_USAGE--80 (128)</br>CERT_NON_REPUDIATION_KEY_USAGE--40 (64)</br>CERT_KEY_ENCIPHERMENT_KEY_USAGE--20 (32)</br>CERT_DATA_ENCIPHERMENT_KEY_USAGE--10 (16)</br>CERT_KEY_AGREEMENT_KEY_USAGE--8</br>CERT_KEY_CERT_SIGN_KEY_USAGE--4</br>CERT_OFFLINE_CRL_SIGN_KEY_USAGE--2</br>CERT_CRL_SIGN_KEY_USAGE--2</br>CERT_ENCIPHER_ONLY_KEY_USAGE--1</br>CERT_DECIPHER_ONLY_KEY_USAGE--8000 (32768)                                                                                                                                                                                                       |
| кэйусажепроперти |            |       |                                                                                                                                                                                                                                                                                                                                            NCRYPT_ALLOW_DECRYPT_FLAG--1</br>NCRYPT_ALLOW_SIGNING_FLAG--2</br>NCRYPT_ALLOW_KEY_AGREEMENT_FLAG--4</br>NCRYPT_ALLOW_ALL_USAGES--FFFFFF (16777215)                                                                                                                                                                                                                                                                                                                                             |
|  кэйпротектион   |            |       |                                                                                                                                                                                                                                                                                                                                                                NCRYPT_UI_NO_PROTECTION_FLAG--0</br>NCRYPT_UI_PROTECT_KEY_FLAG--1</br>NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG--2                                                                                                                                                                                                                                                                                                                                                                 |
| субжектнамефлагс |  template (шаблон)  |       |                                                                           CT_FLAG_SUBJECT_REQUIRE_COMMON_NAME--40000000 (1073741824)</br>CT_FLAG_SUBJECT_REQUIRE_DIRECTORY_PATH--80000000 (2147483648)</br>CT_FLAG_SUBJECT_REQUIRE_DNS_AS_CN--10000000 (268435456)</br>CT_FLAG_SUBJECT_REQUIRE_EMAIL--20000000 (536870912)</br>CT_FLAG_OLD_CERT_SUPPLIES_SUBJECT_AND_ALT_NAME--8</br>CT_FLAG_SUBJECT_ALT_REQUIRE_DIRECTORY_GUID--1000000 (16777216)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_DNS--8000000 (134217728)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_DOMAIN_DNS--400000 (4194304)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_EMAIL--4000000 (67108864)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_SPN--800000 (8388608)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_UPN--2000000 (33554432)                                                                            |
|  X500NameFlags   |            |       | CERT_NAME_STR_NONE--0</br>CERT_OID_NAME_STR--2</br>CERT_X500_NAME_STR--3</br>CERT_NAME_STR_SEMICOLON_FLAG--40000000 (1073741824)</br>CERT_NAME_STR_NO_PLUS_FLAG--20000000 (536870912)</br>CERT_NAME_STR_NO_QUOTING_FLAG--10000000 (268435456)</br>CERT_NAME_STR_CRLF_FLAG--8000000 (134217728)</br>CERT_NAME_STR_COMMA_FLAG--4000000 (67108864)</br>CERT_NAME_STR_REVERSE_FLAG--2000000 (33554432)</br>CERT_NAME_STR_FORWARD_FLAG--1000000 (16777216)</br>CERT_NAME_STR_DISABLE_IE4_UTF8_FLAG--10000 (65536)</br>CERT_NAME_STR_ENABLE_T61_UNICODE_FLAG--20000 (131072)</br>CERT_NAME_STR_ENABLE_UTF8_UNICODE_FLAG--40000 (262144)</br>CERT_NAME_STR_FORCE_UTF8_DIR_STR_FLAG--80000 (524288)</br>CERT_NAME_STR_DISABLE_UTF8_DIR_STR_FLAG--100000 (1048576)</br>CERT_NAME_STR_ENABLE_PUNYCODE_FLAG--200000 (2097152) |

Вернуться к [содержимому](#BKMK_Contents)

> [!NOTE]
> Субжектнамефлагс позволяет INF-файлу указать, какие поля темы и расширения SubjectAltName должны автоматически заполняться программой Certreq на основе текущего пользователя или свойств текущего компьютера: DNS-имя, UPN и т. д. Использование шаблона Literal означает, что вместо них используются флаги имени шаблона. Это позволяет использовать один файл INF в нескольких контекстах для создания запросов с информацией о теме, зависящей от контекста.
>
> X500NameFlags указывает флаги, которые должны быть переданы непосредственно в API CertStrToName, когда значение раздела INF-файла темы преобразуется в различающееся имя в кодировке ASN. 1.

Чтобы запросить сертификат на основе с помощью certreq-new, выполните действия из примера ниже.

> [!WARNING]
> Содержимое этого раздела основано на параметрах по умолчанию для Windows Server 2008 AD CS; Например, можно задать длину ключа 2048, выбрать поставщик хранилища ключей программного обеспечения Майкрософт в качестве CSP и использовать алгоритм SHA-1 (SHA1). Оцените эти варианты в соответствии с требованиями политики безопасности вашей компании.

Чтобы создать файл политики (. INF), сохраните пример ниже в блокноте и сохраните его как Рекуестконфиг. INF:
```
[NewRequest] 
Subject = CN=<FQDN of computer you are creating the certificate> 
Exportable = TRUE 
KeyLength = 2048 
KeySpec = 1 
KeyUsage = 0xf0 
MachineKeySet = TRUE 
[RequestAttributes]
CertificateTemplate=WebServer
[Extensions] 
OID = 1.3.6.1.5.5.7.3.1 
OID = 1.3.6.1.5.5.7.3.2  
```
На компьютере, для которого запрашивается сертификат, введите следующую команду:
```
CertReq –New RequestConfig.inf CertRequest.req 
```
В следующем примере демонстрируется реализация синтаксиса раздела [Strings] для идентификаторов объектов и другие трудные для интерпретации данных. Новый пример синтаксиса {Text} для расширения EKU, в котором используется список идентификаторов объектов с разделителями-запятыми:
```
[Version]
Signature=$Windows NT$

[Strings]
szOID_ENHANCED_KEY_USAGE = 2.5.29.37
szOID_PKIX_KP_SERVER_AUTH = 1.3.6.1.5.5.7.3.1
szOID_PKIX_KP_CLIENT_AUTH = 1.3.6.1.5.5.7.3.2

[NewRequest]
Subject = CN=TestSelfSignedCert
Requesttype = Cert

[Extensions]
%szOID_ENHANCED_KEY_USAGE%={text}%szOID_PKIX_KP_SERVER_AUTH%,
_continue_ = %szOID_PKIX_KP_CLIENT_AUTH%
```
Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--accept"></a><a name=BKMK_accept></a>Certreq — Accept

```
CertReq -accept [Options] [CertChainFileIn | FullResponseFileIn | CertFileIn]
```
Параметр – accept связывает ранее созданный закрытый ключ с выданным сертификатом и удаляет ожидающий запрос сертификата из системы, в которой запрошен сертификат (при наличии соответствующего запроса).

Этот пример можно использовать для приема сертификата вручную:
```
certreq -accept certnew.cer 
```

> [!WARNING]
> Команда-Accept, параметры-User и – Machine указывают, должен ли установленный сертификат устанавливаться в контексте пользователя или компьютера. Если в любом контексте, соответствующем установленному открытому ключу, имеется необработанный запрос, эти параметры не нужны. Если нет необработанных запросов, необходимо указать один из них.

Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--policy"></a><a name=BKMK_policy></a>Certreq — политика

```
certreq -policy [-attrib AttributeString] [-binary] [-cert CertID] [RequestFileIn [PolicyFileIn [RequestFileOut [PKCS10FileOut]]]]
```
-   Файл конфигурации, определяющий ограничения, применяемые к сертификату ЦС при определении квалифицированного подчинения, называется Policy. INF.
-   Пример файла Policy. inf можно найти в [приложении а о планировании и реализации в техническом документе о перекрестной сертификации и квалифицированном подчинении](https://technet.microsoft.com/library/cc738878(WS.10).aspx) .
-   Если вы вводите параметр certreq-Policy без дополнительных параметров, откроется диалоговое окно, в котором можно выбрать запрошенный файлом (req, CMC, txt, Der, CER или CRT). После выбора запрошенного файла и нажатия кнопки Открыть откроется другое диалоговое окно для выбора INF-файла.

Этот пример можно использовать для создания запроса перекрестного сертификата:
```
certreq -policy Certsrv.req Policy.inf newcertsrv.req 
```
Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--sign"></a><a name=BKMK_sign></a>Certreq-Sign

```
certreq -sign [Options] [RequestFileIn [RequestFileOut]]
```
-   Если ввести certreq-Sign без дополнительных параметров, откроется диалоговое окно, в котором можно выбрать требуемый файл (req, CMC, txt, Der, CER или CRT).
-   Для подписывания запроса на квалифицированное подчинение может потребоваться учетные данные администратора предприятия. Это рекомендуемый способ выдачи сертификатов подписи для квалифицированного подчинения.
-   Сертификат, используемый для подписания запроса на квалифицированное подчинение, создается с помощью шаблона квалифицированного подчинения. Администраторы предприятия должны подписать запрос или предоставить разрешения пользователя для тех, кто будет подписывать сертификат.
-   При подписывании запроса CMC может потребоваться несколько сотрудников подписать этот запрос в зависимости от уровня гарантии, связанного с квалифицированным подчиненным.
-   Если родительский ЦС устанавливаемого квалифицированного подчиненного ЦС находится в автономном режиме, необходимо получить сертификат ЦС для квалифицированного подчиненного ЦС из автономного родительского сайта. Если родительский ЦС находится в сети, укажите сертификат ЦС для квалифицированного подчиненного ЦС в мастере установки служб сертификатов.

В приведенной ниже последовательности команд будет показано, как создать новый запрос на сертификат, подписать его и отправить:
```
certreq -new policyfile.inf MyRequest.req
certreq -sign MyRequest.req MyRequest_Sign.req
certreq -submit MyRequest_Sign.req MyRequest_cert.cer 
```
Вернуться к [содержимому](#BKMK_Contents)

## <a name="certreq--enroll"></a><a name=BKMK_enroll></a>Certreq — регистрация

Регистрация в сертификате
```
certreq –enroll [Options] TemplateName
```
Обновление существующего сертификата
```
certreq –enroll –cert CertId [Options] Renew [ReuseKeys]
```
Можно продлить только сертификаты, срок действия которых исследуется. Сертификаты с истекшим сроком действия не могут быть обновлены. их необходимо заменить новым сертификатом.

Ниже приведен пример продления сертификата с помощью серийного номера:
```
certreq –enroll -machine –cert 61 2d 3c fe 00 00 00 00 00 05 Renew
```
Ниже приведен пример регистрации в шаблоне сертификата с именем "имя-сервера" с помощью звездочки (*) для выбора сервера политики через U/I:
```
certreq -enroll –machine –policyserver * WebServer
```
Вернуться к [содержимому](#BKMK_Contents)

## <a name="options"></a><a name=BKMK_Options></a>Параметры

|Параметры|Описание|
|-------|-----------|
|-Any|Принудительно интерфейса ICertRequest:: Submit для определения типа кодировки.|
|-ATTRIB \<Аттрибутестринг >|Задает пары строк имя и значение, разделенные двоеточием.</br>Отдельные пары "имя-значение" и строки значений с \n (например, Name1: Value1\nName2: value2).|
|-Binary|Форматирует выходные файлы в двоичном виде, а не в кодировке Base64.|
|-Полицисервер *\<полицисервер >*|LDAP: *\<путь >*</br>Вставьте универсальный код ресурса (URI) или уникальный идентификатор для компьютера, на котором работает веб-служба политик регистрации сертификатов.</br>Чтобы указать, что вы хотите использовать файл запроса при просмотре, просто используйте знак "минус" (-) для *\<полицисервер >* .|
|-config \<ConfigString >|Обрабатывает операцию с помощью центра сертификации, указанного в строке конфигурации, которая является Кахостнаме\канаме. Для подключения по протоколу HTTPS укажите URI сервера регистрации. Для центра сертификации локального компьютера используйте знак "минус" (-).|
|— Анонимный|Используйте анонимные учетные данные для веб-служб регистрации сертификатов.|
|— Kerberos|Используйте учетные данные Kerberos (домен) для веб-служб регистрации сертификатов.|
|-ClientCertificate *\<клиентцертид >*|*\<клиентцертид >* можно заменить на отпечаток сертификата, CN, EKU, шаблона, электронной почты, имени участника-пользователя и в новом синтаксисе name = value.|
|-UserName *\<имя пользователя >*|Используется с веб-службами регистрации сертификатов. Можно заменить *\<UserName >* именем SAM или доменом. Этот параметр предназначен для использования с параметром-p.|
|-p *\<пароль >*|Используется с веб-службами регистрации сертификатов. Замените *\<password >* паролем текущего пользователя. Этот параметр предназначен для использования с параметром-UserName.|
|пользователь|Настраивает контекст пользователя для нового запроса на сертификат или задает контекст для приема сертификата. Это контекст по умолчанию, если в INF-файле или шаблоне не указано ни одного.|
|-Machine|Настраивает новый запрос на сертификат или задает контекст для приема сертификата для контекста компьютера. Для новых запросов он должен соответствовать ключу INF-файла MachineKeyset и контексту шаблона. Если этот параметр не указан и шаблон не задает контекст, то по умолчанию используется контекст пользователя.|
|— список отзыва сертификатов|Включает списки отзыва сертификатов (CRL) в выходные данные в файл PKCS #7 в кодировке Base64, заданный параметром Цертчаинфилеаут или в файл в кодировке Base64, заданный параметром Рекуестфилеаут.|
|-RPC|Предписывает Active Directory службам сертификации (AD CS) использовать подключение сервера удаленного вызова процедур (RPC) вместо распределенного COM.|
|-Админфорцемачине|Используйте службу ключей или олицетворение, чтобы отправить запрос из контекста локальной системы. Требует, чтобы пользователь, вызывающий этот параметр, был членом локальных администраторов.|
|-Реневонбехалфоф|Отправьте продление от имени субъекта, указанного в сертификате для подписи. Это задает CR_IN_ROBO при вызове [интерфейса ICertRequest:: submit](https://technet.microsoft.com/subscriptions/aa385040.aspx)|
|-f|Принудительная перезапись существующих файлов. Это также обходит шаблоны кэширования и политики.|
|-q|Использовать режим молчания; подавлять все интерактивные запросы.|
|— Юникод|Записывает выходные данные в Юникоде, когда стандартный вывод перенаправляется или передается другой команде, что помогает при вызове из сценариев Windows PowerShell®).|
|-Уникодетекст|Отправляет выходные данные в формате Юникод при записи больших двоичных объектов данных в кодировке Base64 в файлы.|

Вернуться к [содержимому](#BKMK_Contents)

## <a name="formats"></a><a name=BKMK_Formats></a>Форматирование

|Форматирование|Описание|
|-------|-----------|
|рекуестфилеин|Имя входного файла в кодировке Base64: запрос сертификата PKCS #10, запрос на сертификат CMS, запрос на продление сертификата PKCS #7, сертификат X. 509 для перекрестной сертификации или запрос сертификата в формате тега KeyGen.|
|рекуестфилеаут|Имя выходного файла в кодировке Base64|
|цертфилеаут|Имя файла X-509 в кодировке Base64.|
|PKCS10FileOut|Для использования только с командой [certreq-Policy](#BKMK_policy) . Имя выходного файла PKCS10 в кодировке Base64.|
|цертчаинфилеаут|Имя файла PKCS #7 в кодировке Base64.|
|фуллреспонсефилеаут|Полное имя файла ответа в кодировке Base64.|
|полицифилеин|Для использования только с командой [certreq-Policy](#BKMK_policy) . INF-файл, содержащий текстовое представление расширений, используемых для уточнения запроса.|

## <a name="additional-certreq-examples"></a><a name=BKMK_Examples></a>Дополнительные примеры Certreq

В следующих статьях содержатся примеры использования certreq:
-   [Как запросить сертификат с пользовательским альтернативным именем субъекта](https://technet.microsoft.com/library/ff625722.aspx)
-   [Руководство по тестированию: развертывание иерархии PKI на основе двух уровней AD CS](https://technet.microsoft.com/library/hh831348.aspx)
-   [Приложение 3. синтаксис Certreq. exe](https://technet.microsoft.com/library/cc736326.aspx)
-   [Как создать сертификат SSL веб-сервера вручную](https://blogs.technet.com/b/pki/archive/2009/08/05/how-to-create-a-web-server-ssl-certificate-manually.aspx)
-   [Запрос сертификата инициализации AMT с помощью центра сертификации Windows Server 2008](https://social.technet.microsoft.com/wiki/contents/articles/request-an-amt-provisioning-certificate-using-a-windows-server-2008-ca.aspx)
-   [Регистрация сертификата для агента System Center Operations Manager](https://social.technet.microsoft.com/wiki/contents/articles/certificate-enrollment-for-system-center-operations-manager-agent.aspx)
-   [Пошаговое руководство по службам AD CS: развертывание иерархии PKI на двух уровнях](https://social.technet.microsoft.com/wiki/contents/articles/15037.ad-cs-step-by-step-guide-two-tier-pki-hierarchy-deployment.aspx)
-   [Включение LDAP по протоколу SSL с помощью стороннего центра сертификации](https://support.microsoft.com/kb/321051)

Вернуться к [содержимому](#BKMK_Contents)
