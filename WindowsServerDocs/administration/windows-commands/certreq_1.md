---
title: certreq
description: 'Раздел Windows команды для ***- '
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: manage-windows-commands
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 7a04e51f-f395-4bff-b57a-0e9efcadf973
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: 2b947a231228d66084bc61146f7347a76cf41406
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66434516"
---
# <a name="certreq"></a>certreq



Certreq может использоваться для запроса сертификатов из центра сертификации (ЦС), для получения ответа на предыдущий запрос от центра сертификации, чтобы создать новый запрос из INF-файл, чтобы принять и установить ответ на запрос, для создания перекрестной сертификации или Квалифицированное подчинение из существующего сертификата ЦС или запрос, а также для подписи запроса перекрестной сертификации и квалифицированного подчинения.

> [!WARNING]
> - Более ранние версии certreq может не предоставлять все параметры, описанные в этом документе. Вы увидите все параметры, которые предоставляет определенную версию certreq, выполнив команды, показанные в разделе "синтаксис" нотации.
> - Certreq не поддерживает создание новый запрос сертификата на основе шаблона в среде обработки сложных СОБЫТИЙ/CES Аттестация ключей

## <a name="BKMK_Contents"></a>Содержимое

Ниже приведены основные разделы этой статьи.
1.  [Команды](#BKMK_Verbs)
2.  [Обозначения синтаксиса](#BKMK_notation)
3.  [Параметры](#BKMK_Options)
4.  [Форматы](#BKMK_Formats)
5.  [Примеры дополнительных certreq](#BKMK_Examples)

## <a name="BKMK_Verbs"></a>Команды

Существует в приведенной ниже таблице описаны команды, которые могут использоваться с помощью команды certreq

|Параметр|Описание|
|------|-----------|
|-Submit|Отправляет запрос в ЦС. Дополнительные сведения см. в разделе [Certreq-Отправка](#BKMK_Submit).|
|-получить *RequestID*|Получение ответа на предыдущий запрос в центре сертификации. Дополнительные сведения см. в разделе [Certreq-получить](#BKMK_Retrieve).|
|-New|Создает новый запрос на основе INF-файл. Дополнительные сведения см. в разделе [Certreq-новый](#BKMK_New).|
|-Accept|Принимает и устанавливает ответ на запрос на сертификат. Дополнительные сведения см. в разделе [Certreq-принять](#BKMK_accept).|
|-Policy|Задает политику для запроса. Дополнительные сведения см. в разделе [Certreq-политики](#BKMK_policy).|
|-Входа|Подписывает запрос перекрестной сертификации и квалифицированного подчинения. Дополнительные сведения см. в разделе [Certreq-входа](#BKMK_sign).|
|-Регистрация|Для регистрации или обновлении сертификата. Дополнительные сведения см. в разделе [Certreq-регистрация](#BKMK_enroll).|
|-?|Отображает список certreq синтаксис, параметры и описания.|
|*\<Команда >* -?|Отображает справку по указанная команда.|
|-v -?|Отображает подробный список certreq синтаксис, параметры и описания.|

Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_notation"></a>Обозначения синтаксиса

-   Базовый синтаксис командной строки запустите `certreq -?`
-   Синтаксис, об использовании определенной команды certutil, выполните **certreq**  *\<глагол >* **-?**
-   Чтобы отправить certutil синтаксиса, в текстовый файл, выполните следующие команды:  
    -   `certreq -v -? > certreqhelp.txt`
    -   `notepad certreqhelp.txt`

В следующей таблице описаны представления, используемые в синтаксисе командной строки.

|Нотация|Описание|
|--------|-----------|
|Текст без квадратных или фигурных скобок|Элементы, которые необходимо указать, как показано|
|\<Текст в угловых скобках >|Заполнитель, для которого необходимо указать значение|
|[Текст в квадратных скобках]|Необязательные элементы|
|{Текст в фигурных скобках}|Набор обязательных элементов Выберите один|
|Вертикальная черта (&#124;)|Разделитель для элементов взаимно исключают друг друга. Выберите один|
|Кнопку с многоточием (...)|Элементы, которые могут быть повторены|

Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_Submit"></a>Certreq-отправки

Это certreq.exe параметра по умолчанию, если параметры не указаны явно в командной строке командной строки certreq.exe попытается отправить запрос сертификата в ЦС.
```
CertReq [-Submit] [Options] [RequestFileIn [CertFileOut [CertChainFileOut [FullResponseFileOut]]]]
```
При использовании запроса на сертификат необходимо указать отправить параметр. Если этот параметр указан, отображается распространенных Открытие файла окно, в котором можно выбрать файл запроса на сертификат, соответствующий.

Эти примеры можно использовать в качестве отправной точки для создания отправить запрос сертификата:

Для отправки простого запроса сертификата используйте следующий пример:
```
certreq –submit certRequest.req certnew.cer certnew.pfx
```
Чтобы запросить сертификат с помощью атрибута по сети SAN, см. Подробные инструкции в статье базы знаний Майкрософт 931351 [как добавить дополнительное имя субъекта сертификата безопасного LDAP](https://support.microsoft.com/kb/931351) в разделе «Использование программы Certreq.exe для Создание и отправка запроса на сертификат, включающий по сети SAN» раздела.

Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_Retrieve"></a>Certreq-извлечения

```
certreq -retrieve [Options] RequestId [CertFileOut [CertChainFileOut [FullResponseFileOut]]]
```
-   Если вы не укажете Имякомпьютерацс или Имя_цс в CAComputerName\CANamea - config-диалоговое окно появляется и отображает список всех доступных ЦС.
-   Если вы используете - config - вместо - config CAComputerName\CAName, эта операция обрабатывается с помощью центра сертификации по умолчанию.
-   Можно использовать certreq-получить *RequestID* для получения сертификата после ЦС он выдан. *RequestID*PKC может быть десятичное или шестнадцатеричное с 0 x префикс и он может быть серийный номер сертификата, без префикса 0 x. Также можно получить любой сертификат, который когда-либо был выдан центром сертификации, включая отозванные или просроченные сертификаты, вне зависимости от запроса на сертификат, была ли когда-либо в состоянии ожидания.
-   Если вы отправить запрос в ЦС, модуль политики ЦС может оставить запрос в состоянии ожидания и возврат *RequestID* вызывающему Certreq для отображения. Со временем администратор ЦС будет выдавать сертификат или отклонить запрос.

Приведенную ниже команду извлекает идентификатор сертификата 20 и создает файл сертификата (.cer):
```
certreq -retrieve 20 MyCertificate.cer 
```
Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_New"></a>Certreq-new

```
certreq -new [Options] [PolicyFileIn [RequestFileOut]]
```
Так как файл INF допускает широкий набор параметров и задавать параметры, трудно определить шаблон по умолчанию, администраторам следует использовать для любых целей. Таким образом в этом разделе описываются все параметры, чтобы можно было создать файл INF, адаптированные под конкретные потребности. Следующие ключевые слова используются для описания структуры файла INF.
1.  Объект *разделе* представляет собой область, в файле INF, охватывающую логической группы ключей. Раздел всегда отображается в скобках в файле INF.
2.  Объект *ключ* — параметр, который находится слева от знака равенства.
3.  Объект *значение* — параметр, который находится справа от знака равенства.

Например минимального INF-файла будет выглядеть следующим образом:
```
[NewRequest] 
; At least one value must be set in this section 
Subject = "CN=W2K8-BO-DC.contoso2.com"
```
Ниже приведены некоторые из возможных разделов, которые могут быть добавлены в файл INF.

**[NewRequest]**

В этом разделе является обязательным для INF-файла, который выступает в качестве шаблона для запроса нового сертификата. В этом разделе требуется по крайней мере один ключ со значением.

|Ключ|Определение|Значение|Пример|
|---|----------|-----|-------|
|Subject|Некоторые приложения зависят от сведений о субъекте в сертификате. Таким образом рекомендуется указать значение для этого ключа. Если субъект не задано, рекомендуется обеспечить входит в состав расширение альтернативного имени субъекта сертификата имя субъекта.|Относительное различающееся имя строковые значения|Тема = «CN=computer1.contoso.com» Subject = "CN = John Smith, CN = Users, DC = Contoso, DC = com»|
|Exportable|Если этот атрибут имеет значение TRUE, можно экспортировать закрытый ключ с сертификатом. Чтобы обеспечить высокий уровень безопасности, закрытые ключи не должен быть доступен для экспорта; Однако в некоторых случаях он может потребоваться сделать закрытый ключ экспортируемым в том случае, если несколько компьютеров или пользователей должны совместно использовать один и тот же закрытый ключ.|значение равно true, false|Экспортируемый = TRUE. Это может различать ключей CNG и plaintext экспортируемым. Не удается CAPI1 ключи.|
|ExportableEncrypted|Указывает, следует ли установить для экспорта закрытого ключа.|значение равно true, false|ExportableEncrypted = true</br>Совет. Не все размеры открытого ключа и алгоритмов, будут работать с всех хэш-алгоритмов. Tamehe указанный CSP должен также поддерживать указанного алгоритма хэширования. Чтобы просмотреть список Поддерживаемые алгоритмы хэширования, можно выполнить команду <code>certutil -oid 1 &#124; findstr pwszCNGAlgid &#124; findstr /v CryptOIDInfo</code>|
|HashAlgorithm|Хэш-алгоритм, используемый для данного запроса.|Sha256, sha384, sha512, sha1, md5, md4, md2|HashAlgorithm = sha1. Чтобы просмотреть список поддерживаемых хэш-алгоритмов использовать: certutil - oid 1 &#124; findstr pwszCNGAlgid &#124; findstr /v CryptOIDInfo|
|KeyAlgorithm|Алгоритм, который будет использоваться поставщик услуг для создания пары открытого и закрытого ключей.|RSA, DH, DSA, ECDH_P256, ECDH_P521, ECDSA_P256, ECDSA_P384, ECDSA_P521|KeyAlgorithm = RSA|
|KeyContainer|Не рекомендуется установить этот параметр для новых запросов, в которой создается новый материал ключа. Контейнер ключей автоматически создается и сохраняется в системе. Для запросов, где следует использовать существующий ключевой материал это значение может быть присвоено имя контейнера ключа существующий ключ. С помощью команды certutil – ключа команду, чтобы отобразить список доступных контейнеров ключей для контекста компьютера. С помощью команды certutil – ключа команды пользователя для контекста текущего пользователя.|Произвольное строковое значение</br>Совет. Следует использовать двойные кавычки, все значения ключа INF, который содержит пробелы или специальные символы, чтобы избежать возможных проблем анализа INF.|KeyContainer = {C347BD28-7F69-4090-AA16-BC58CF4D749C}|
|Значение KeyLength|Определяет длину открытого и закрытого ключей. Длина ключа оказывает влияние на уровень безопасности сертификата. Больше длина ключа обычно обеспечивает более высокий уровень безопасности; Тем не менее некоторые приложения могут иметь ограничения на длину ключа.|Любой действительный размер ключа, поддерживаемых поставщиком служб шифрования.|Значение KeyLength = 2048|
|KeySpec|Определяет, если ключ можно использовать для подписи, а также для Exchange (шифрование) или для обоих.|AT_NONE, AT_SIGNATURE, AT_KEYEXCHANGE|KeySpec = AT_KEYEXCHANGE|
|Займется|Определяет, что ключ сертификата должен использоваться.|CERT_DIGITAL_SIGNATURE_KEY_USAGE--80 (128)</br>Совет. Показанные значения являются шестнадцатеричные значения (десятичное значение) для каждого определения бит. Также можно использовать старый синтаксис: одно шестнадцатеричное значение с несколькими битами набора, а символические представление. Например, KeyUsage = сообщения 0xa0.</br>CERT_NON_REPUDIATION_KEY_USAGE--40 (64)</br>CERT_KEY_ENCIPHERMENT_KEY_USAGE — 20 (32)</br>CERT_DATA_ENCIPHERMENT_KEY_USAGE--10 (16)</br>CERT_KEY_AGREEMENT_KEY_USAGE -- 8</br>CERT_KEY_CERT_SIGN_KEY_USAGE -- 4</br>CERT_OFFLINE_CRL_SIGN_KEY_USAGE -- 2</br>CERT_CRL_SIGN_KEY_USAGE -- 2</br>CERT_ENCIPHER_ONLY_KEY_USAGE--1</br>CERT_DECIPHER_ONLY_KEY_USAGE — 8000 (32768)|KeyUsage = "CERT_DIGITAL_SIGNATURE_KEY_USAGE &#124; CERT_KEY_ENCIPHERMENT_KEY_USAGE"</br>Совет. Несколько значений использование канала (&#124;) символ разделителя. Убедитесь, что при использовании нескольких значений, чтобы избежать ошибок при анализе INF использовать двойные кавычки.|
|KeyUsageProperty|Извлекает значение, идентифицирующее определенной цели, для которого используется закрытый ключ.|NCRYPT_ALLOW_DECRYPT_FLAG -- 1</br>NCRYPT_ALLOW_SIGNING_FLAG -- 2</br>NCRYPT_ALLOW_KEY_AGREEMENT_FLAG -- 4</br>NCRYPT_ALLOW_ALL_USAGES -- ffffff (16777215)|KeyUsageProperty = "NCRYPT_ALLOW_DECRYPT_FLAG &#124; NCRYPT_ALLOW_SIGNING_FLAG"|
|MachineKeySet|Этот ключ важно в тех случаях, когда вам нужно создать сертификаты, принадлежащие компьютера и не пользователя. Материал ключа, который создается сохраняется в контексте безопасности участника безопасности (учетная запись пользователя или компьютера), создал запрос. Когда администратор создает запрос на сертификат от имени компьютера, материал ключа должны создаваться в контексте безопасности компьютера и не контекста безопасности администратора. В противном случае компьютера нет доступа к его закрытый ключ, так как было бы в контексте безопасности администратора.|значение равно true, false|MachineKeySet = true</br>Совет. Значение по умолчанию — false.|
|NotBefore|Указывает дату или даты и времени, перед которым запрос не может быть выполнена. NotBefore может использоваться с ValidityPeriod и ValidityPeriodUnits.|Дата или дата и время|NotBefore = «7/24/2012 10:31 AM»</br>Совет. NotBefore и NotAfter, предназначены для RequestType = только для сертификата. Синтаксический анализ даты пытается быть зависящие от языкового стандарта. С помощью месяц имен позволяет различать и должен работать в каждом регионе.|
|NotAfter|Указывает дату или даты и времени, после которого запрос не может быть выполнена. NotAfter не может использоваться с ValidityPeriod или ValidityPeriodUnits.|Дата или дата и время|NotAfter = «9/23/2014 10:31 AM»</br>Совет. NotBefore и NotAfter, предназначены для RequestType = только для сертификата. Синтаксический анализ даты пытается быть зависящие от языкового стандарта. С помощью месяц имен позволяет различать и должен работать в каждом регионе.|
|PrivateKeyArchive|Параметр PrivateKeyArchive работает только в том случае, если соответствующий RequestType имеет значение «CMC», поскольку только сертификат управления сообщения, по сравнению с форматом запроса CMS (CMC) позволяет безопасно передачи инициатора закрытого ключа ЦС для архивации ключа.|значение равно true, false|PrivateKeyArchive = True|
|EncryptionAlgorithm|Используемый алгоритм шифрования.|Возможные варианты зависят от версии операционной системы и набора установленных поставщиков служб шифрования. Чтобы просмотреть список доступных алгоритмов, выполните команду <code>certutil -oid 2 &#124; findstr pwszCNGAlgid</code> используется указанный CSP должен также поддерживать указанный симметричный алгоритм шифрования и длины.|EncryptionAlgorithm = 3des|
|EncryptionLength|Длина алгоритма шифрования для использования.|Любой длины, допускаемых указанного EncryptionAlgorithm.|EncryptionLength = 128|
|ProviderName|Имя поставщика — отображаемое имя поставщика службы шифрования...|Если вы не знаете имя поставщика CSP, вы используете, запустите certutil – csplist из командной строки. Команда отображает имена всех поставщиков облачных решений, которые доступны в локальной системе|ProviderName = "Microsoft RSA SChannel Cryptographic Provider"|
|ProviderType|Тип поставщика используется для выбора отдельных поставщиков данных на основе конкретного алгоритма возможности, такие как «RSA-Full».|Если вы не знаете тип поставщика CSP, вы используете, запустите certutil – csplist из запроса окна командной строки. Команда отображает тип поставщика всех поставщиков облачных решений, которые доступны в локальной системе.|ProviderType = 1|
|RenewalCert|Если вам нужно обновить сертификат, который существует в системе, где создается запрос на сертификат, необходимо указать его хэш сертификата как значение для этого ключа.|Хэш сертификата любой сертификат, который доступен на компьютере, где создается запрос на сертификат. Если вы не знаете хэш сертификата, используйте оснастку MMC Сертификаты и просмотрите сертификат, который должен быть обновлен. Откройте свойства сертификата и проверьте атрибут «Отпечаток» сертификата. Продление сертификата требуется иметь формат запроса CMC или PKCS #7.|RenewalCert = 4EDF274BD2919C6E9EC6A522F0F3B153E9B1582D|
|RequesterName</br>Примечание. Это делает запрос на регистрацию от имени другого пользователя запроса. Запрос также должен быть подписан сертификат агента регистрации, или ЦС отклонит запрос. Используйте параметр cert, чтобы указать сертификат агента регистрации.|Можно указать имя инициатора запроса для запросов на сертификаты, если RequestType имеет значение PKCS #7 или CMC. Если RequestType имеет значение PKCS #10, то этот ключ будет игнорироваться. Requestername может устанавливаться только как часть запроса. Не удается управлять Requestername в ожидающий запрос.|"Домен\имя пользователя"|Requestername = «Contoso\BSmith»|
|RequestType|Определяет стандарт, который используется для создания и отправки запроса на сертификат.|PKCS10 -- 1</br>PKCS7 -- 2</br>CMC — 3</br>Сертификат — 4</br>SCEP — fd00 (64768)</br>Совет. Этот параметр указывает самозаверяющий или самостоятельно выданный сертификат. Он не создает запрос, но вместо нового сертификата и последующей установки сертификата. Самозаверяющий используется по умолчанию. Указать сертификат подписи с помощью параметра – cert создать самостоятельно выданный сертификат, который не является самозаверяющим.|RequestType = CMC|
|SecurityDescriptor</br>Совет. Это касается только ключи смарт-карты контекст компьютера.|Содержит сведения о безопасности, связанные с защищаемыми объектами. Наиболее защищаемых объектов можно указать в вызов функции, которая создает объект дескриптора безопасности объекта.|Строк на основе [языка определения дескрипторов безопасности](https://msdn.microsoft.com/library/aa379567(v=vs.85).aspx).|SecurityDescriptor = "D:P(A;;GA;;;SY)(A;;GA;;;BA)"|
|AlternateSignatureAlgorithm|Задает и возвращает логическое значение, указывающее, является ли подпись алгоритм идентификатор объекта (OID) для подписи запроса или сертификата PKCS #10 дискретными или объединенный.|значение равно true, false|AlternateSignatureAlgorithm = false</br>Совет. Для подписи RSA значение false указывает Pkcs1 v1.5. Значение true указывает v2.1 подписи.|
|Автоматически|По умолчанию этот параметр позволяет CSP доступ к интерактивного пользователя рабочего стола и запроса информации, такие как ПИН-код смарт-карты, от пользователя. Если этот ключ имеет значение TRUE, CSP не должно взаимодействовать с рабочим столом и будет заблокирован отображения пользовательского интерфейса для пользователя.|значение равно true, false|Автоматическая = true|
|SMIME|Если этот параметр имеет значение TRUE, расширение со значением идентификатора объекта 1.2.840.113549.1.9.15 добавляется к запросу. Число в идентификаторах объектов зависит от на версию операционной системы, установить и возможность CSP, которые указывают симметричных алгоритмов шифрования, которые могут использоваться приложениями Secure Multipurpose Internet Mail Extensions (S/MIME), например Outlook.|значение равно true, false|SMIME = true|
|UseExistingKeySet|Этот параметр используется для указания, что существующей пары ключей следует использовать при создании запроса на сертификат. Если этот ключ имеет значение TRUE, необходимо также указать значение для ключа RenewalCert или KeyContainer имени. Экспортируемый ключ должен не задано, так как нельзя изменять свойства существующего ключа. В этом случае нет материал ключа создается при построении запроса на сертификат.|значение равно true, false|UseExistingKeySet = true|
|KeyProtection|Задает значение, указывающее, как защищается закрытый ключ перед использованием.|XCN_NCRYPT_UI_NO_PROTCTION_FLAG -- 0</br>XCN_NCRYPT_UI_PROTECT_KEY_FLAG -- 1</br>XCN_NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG -- 2|KeyProtection = NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG|
|SuppressDefaults|Указывает логическое значение, указывающее, включаются ли в запросе расширения по умолчанию и атрибуты. Значения по умолчанию представлены их идентификаторов объекта (OID).|значение равно true, false|SuppressDefaults = true|
|FriendlyName|Понятное имя для нового сертификата.|Text|FriendlyName = "Server1"|
|ValidityPeriodUnits</br>Примечание. Используется только при запросе введите = сертификата.|Указывает число единиц, который должен использоваться с ValidityPeriod.|Numeric|ValidityPeriodUnits = 3|
|ValidityPeriod</br>Примечание. Используется только при запросе введите = сертификата.|VValidityPeriod должен быть английского (США) во множественном числе период времени.|Годы, месяцы, недели, дни, часы, минуты, секунды|ValidityPeriod = лет|

Вернитесь к [содержимое](#BKMK_Contents)

**[Расширений]**

Этот раздел является необязательным.


|  Расширение OID   | Определение | Значение |                                                                                                                                                                                                                                                                                                                                                                                                                      Пример                                                                                                                                                                                                                                                                                                                                                                                                                       |
|------------------|------------|-------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|    2.5.29.17     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                                2.5.29.17 = «{text}»                                                                                                                                                                                                                                                                                                                                                                                                                |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                        *по-прежнему* = «имя участника-пользователя =User@Domain.com&»                                                                                                                                                                                                                                                                                                                                                                                                         |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                       *по-прежнему* = «электронная почта =User@Domain.com&»                                                                                                                                                                                                                                                                                                                                                                                                        |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                        *по-прежнему* = «DNS=host.domain.com &»                                                                                                                                                                                                                                                                                                                                                                                                         |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                               *по-прежнему* = «имя_каталога = CN = Name, DC = Domain, DC = com &»                                                                                                                                                                                                                                                                                                                                                                                               |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                             *по-прежнему* = «URL-адрес =<http://host.domain.com/default.html&>"                                                                                                                                                                                                                                                                                                                                                                                              |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                         *по-прежнему* = «IP-адрес = 10.0.0.1 &»                                                                                                                                                                                                                                                                                                                                                                                                         |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                       *по-прежнему* = «RegisteredId = 1.2.3.4.5 &»                                                                                                                                                                                                                                                                                                                                                                                                       |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                      *по-прежнему* = «1.2.3.4.6.1={utf8}String &»                                                                                                                                                                                                                                                                                                                                                                                                      |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                  *по-прежнему* = «1.2.3.4.6.2={octet}AAECAwQFBgc= &»                                                                                                                                                                                                                                                                                                                                                                                                   |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                          *по-прежнему* = «1.2.3.4.6.2={octet}{hex}00 01 02 03 04 05 06 07 &»                                                                                                                                                                                                                                                                                                                                                                                           |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                 *по-прежнему* = «1.2.3.4.6.3={asn}BAgAAQIDBAUGBw== &»                                                                                                                                                                                                                                                                                                                                                                                                  |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                           *по-прежнему* = «1.2.3.4.6.3={hex}04 08 00 01 02 03 04 05 06 07»                                                                                                                                                                                                                                                                                                                                                                                            |
|    2.5.29.37     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                                 2.5.29.37="{Text}»                                                                                                                                                                                                                                                                                                                                                                                                                 |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                            *по-прежнему* = «1.3.6.1.5.5.7.                                                                                                                                                                                                                                                                                                                                                                                                            |
|    *Продолжить*    |            |       |                                                                                                                                                                                                                                                                                                                                                                                                          *по-прежнему* = «1.3.6.1.5.5.7.3.1»                                                                                                                                                                                                                                                                                                                                                                                                          |
|    2.5.29.19     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                              "{text}ca=0pathlength=3"                                                                                                                                                                                                                                                                                                                                                                                                              |
|     Критическое     |            |       |                                                                                                                                                                                                                                                                                                                                                                                                                 Критические = 2.5.29.19                                                                                                                                                                                                                                                                                                                                                                                                                 |
|     KeySpec      |            |       |                                                                                                                                                                                                                                                                                                                                                                                             AT_NONE -- 0</br>AT_SIGNATURE, КОТОРОЕ--2</br>AT_KEYEXCHANGE -- 1                                                                                                                                                                                                                                                                                                                                                                                             |
|   RequestType    |            |       |                                                                                                                                                                                                                                                                                                                                                                                   PKCS10 -- 1</br>PKCS7 -- 2</br>CMC — 3</br>Сертификат — 4</br>SCEP — fd00 (64768)                                                                                                                                                                                                                                                                                                                                                                                   |
|     Займется     |            |       |                                                                                                                                                                                                       CERT_DIGITAL_SIGNATURE_KEY_USAGE--80 (128)</br>CERT_NON_REPUDIATION_KEY_USAGE--40 (64)</br>CERT_KEY_ENCIPHERMENT_KEY_USAGE — 20 (32)</br>CERT_DATA_ENCIPHERMENT_KEY_USAGE--10 (16)</br>CERT_KEY_AGREEMENT_KEY_USAGE -- 8</br>CERT_KEY_CERT_SIGN_KEY_USAGE -- 4</br>CERT_OFFLINE_CRL_SIGN_KEY_USAGE -- 2</br>CERT_CRL_SIGN_KEY_USAGE -- 2</br>CERT_ENCIPHER_ONLY_KEY_USAGE--1</br>CERT_DECIPHER_ONLY_KEY_USAGE — 8000 (32768)                                                                                                                                                                                                       |
| KeyUsageProperty |            |       |                                                                                                                                                                                                                                                                                                                                            NCRYPT_ALLOW_DECRYPT_FLAG -- 1</br>NCRYPT_ALLOW_SIGNING_FLAG -- 2</br>NCRYPT_ALLOW_KEY_AGREEMENT_FLAG -- 4</br>NCRYPT_ALLOW_ALL_USAGES -- ffffff (16777215)                                                                                                                                                                                                                                                                                                                                             |
|  KeyProtection   |            |       |                                                                                                                                                                                                                                                                                                                                                                NCRYPT_UI_NO_PROTECTION_FLAG -- 0</br>NCRYPT_UI_PROTECT_KEY_FLAG -- 1</br>NCRYPT_UI_FORCE_HIGH_PROTECTION_FLAG -- 2                                                                                                                                                                                                                                                                                                                                                                 |
| SubjectNameFlags |  шаблон  |       |                                                                           CT_FLAG_SUBJECT_REQUIRE_COMMON_NAME -- 40000000 (1073741824)</br>CT_FLAG_SUBJECT_REQUIRE_DIRECTORY_PATH -- 80000000 (2147483648)</br>CT_FLAG_SUBJECT_REQUIRE_DNS_AS_CN -- 10000000 (268435456)</br>CT_FLAG_SUBJECT_REQUIRE_EMAIL -- 20000000 (536870912)</br>CT_FLAG_OLD_CERT_SUPPLIES_SUBJECT_AND_ALT_NAME -- 8</br>CT_FLAG_SUBJECT_ALT_REQUIRE_DIRECTORY_GUID -- 1000000 (16777216)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_DNS -- 8000000 (134217728)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_DOMAIN_DNS -- 400000 (4194304)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_EMAIL -- 4000000 (67108864)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_SPN -- 800000 (8388608)</br>CT_FLAG_SUBJECT_ALT_REQUIRE_UPN -- 2000000 (33554432)                                                                            |
|  X500NameFlags   |            |       | CERT_NAME_STR_NONE -- 0</br>CERT_OID_NAME_STR -- 2</br>CERT_X500_NAME_STR -- 3</br>CERT_NAME_STR_SEMICOLON_FLAG -- 40000000 (1073741824)</br>CERT_NAME_STR_NO_PLUS_FLAG -- 20000000 (536870912)</br>CERT_NAME_STR_NO_QUOTING_FLAG -- 10000000 (268435456)</br>CERT_NAME_STR_CRLF_FLAG -- 8000000 (134217728)</br>CERT_NAME_STR_COMMA_FLAG -- 4000000 (67108864)</br>CERT_NAME_STR_REVERSE_FLAG--2000000 (33554432)</br>CERT_NAME_STR_FORWARD_FLAG--1000000 (16777216)</br>CERT_NAME_STR_DISABLE_IE4_UTF8_FLAG -- 10000 (65536)</br>CERT_NAME_STR_ENABLE_T61_UNICODE_FLAG -- 20000 (131072)</br>CERT_NAME_STR_ENABLE_UTF8_UNICODE_FLAG -- 40000 (262144)</br>CERT_NAME_STR_FORCE_UTF8_DIR_STR_FLAG -- 80000 (524288)</br>CERT_NAME_STR_DISABLE_UTF8_DIR_STR_FLAG -- 100000 (1048576)</br>CERT_NAME_STR_ENABLE_PUNYCODE_FLAG -- 200000 (2097152) |

Вернитесь к [содержимое](#BKMK_Contents)

> [!NOTE]
> SubjectNameFlags позволяет указать, какие темы и SubjectAltName расширение поля должны быть заполнены автоматически, исходя из текущего пользователя или текущего свойства машины certreq файл INF: DNS-имя, имя участника-пользователя и т. д. С помощью литерала «шаблон» означает, что вместо них используются флаги имя шаблона. Это позволяет один файл INF для использования в нескольких контекстах для создания запросов с помощью сведений о субъекте зависящего от контекста.
>
> X500NameFlags указывает флаги, которые должны передаваться непосредственно CertStrToName API при преобразовании значения ключей субъекта INF ASN.1 в кодировке различающееся имя.

Чтобы запросить сертификат на основе с помощью программы certreq-new выполните действия в приведенном ниже примере:

> [!WARNING]
> Содержимое этого раздела основана на значения по умолчанию для Windows Server 2008 AD CS; Например если длина ключа 2048, выбрав Microsoft Software Key Storage Provider как CSP и используя Secure Hash Algorithm 1 (SHA1). Оцените выбранные соответствие требованиям политики безопасности вашей компании.

Чтобы создать файл политики (INF-файл) скопируйте и сохраните приведенный ниже пример в Блокнот и сохраните как RequestConfig.inf:
```
[NewRequest] 
Subject = "CN=<FQDN of computer you are creating the certificate>" 
Exportable = TRUE 
KeyLength = 2048 
KeySpec = 1 
KeyUsage = 0xf0 
MachineKeySet = TRUE 
[RequestAttributes]
CertificateTemplate="WebServer"
[Extensions] 
OID = 1.3.6.1.5.5.7.3.1 
OID = 1.3.6.1.5.5.7.3.2  
```
На компьютере, для которого запрашивается сертификат введите следующую команду:
```
CertReq –New RequestConfig.inf CertRequest.req 
```
Ниже приведен пример реализации синтаксис раздела [Strings] для идентификаторов объектов и других сложно для интерпретации данных. Новый пример синтаксиса {текста} для расширения EKU, которое использует разделенный запятыми список идентификаторов объектов:
```
[Version]
Signature="$Windows NT$

[Strings]
szOID_ENHANCED_KEY_USAGE = "2.5.29.37"
szOID_PKIX_KP_SERVER_AUTH = "1.3.6.1.5.5.7.3.1"
szOID_PKIX_KP_CLIENT_AUTH = "1.3.6.1.5.5.7.3.2"

[NewRequest]
Subject = "CN=TestSelfSignedCert"
Requesttype = Cert

[Extensions]
%szOID_ENHANCED_KEY_USAGE%="{text}%szOID_PKIX_KP_SERVER_AUTH%,"
_continue_ = "%szOID_PKIX_KP_CLIENT_AUTH%"
```
Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_accept"></a>Certreq-принять

```
CertReq -accept [Options] [CertChainFileIn | FullResponseFileIn | CertFileIn]
```
Примите параметр связывает ранее созданный закрытый ключ с выданный сертификат и удаляет ожидающий запрос сертификата из системы, где запрашивается сертификат (если есть такой же запрос).

В этом примере можно использовать для вручную принятия запроса сертификата:
```
certreq -accept certnew.cer 
```

> [!WARNING]
> Принятия команды, параметры пользователя и – компьютера определяют, следует ли устанавливать сертификат устанавливается в контексте компьютера или пользователя. Если в любом контексте, который соответствует открытому ключу, который устанавливается невыполненного запроса, эти параметры не требуются. Если нет Невыполненный запрос, затем один из них необходимо указать.

Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_policy"></a>Certreq-политики

```
certreq -policy [-attrib AttributeString] [-binary] [-cert CertID] [RequestFileIn [PolicyFileIn [RequestFileOut [PKCS10FileOut]]]]
```
-   Файл конфигурации, который определяет ограничения, применяемые к сертификата ЦС при определении квалифицированного подчинения называется Policy.inf...
-   Вы найдете пример файла файла CAPolicy.inf в [приложение из планирование и реализация перекрестной сертификации и квалифицированного подчинения](https://technet.microsoft.com/library/cc738878(WS.10).aspx) Технический документ.
-   При вводе certreq-политики без любой дополнительный параметр откроется диалоговое окно для выбора запрошенного отображенного (req, cmc, txt, der, cer или crt). После выберите нужный файл и нажмите кнопку "Открыть", чтобы выбрать файл INF откроется другое диалоговое окно.

В этом примере можно использовать для построения запроса перекрестный сертификат:
```
certreq -policy Certsrv.req Policy.inf newcertsrv.req 
```
Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_sign"></a>Certreq-входа

```
certreq -sign [Options] [RequestFileIn [RequestFileOut]]
```
-   При вводе certreq-входа без любой дополнительный параметр откроется диалоговое окно для выбора запрошенный файл (req, cmc, txt, der, cer или crt).
-   Подписи квалифицированного подчинения может потребоваться учетные данные администратора предприятия. Это рекомендуется для выдачи сертификатов подписи для квалифицированного подчинения.
-   Сертификат, используемый для подписывания квалифицированного подчинения создается с использованием шаблона квалифицированного подчинения. "Администраторы предприятия" необходимо подписать запрос или предоставление пользователю разрешений для отдельных пользователей, которые произведет подпись сертификата.
-   При подписании запроса CMC, может потребоваться несколько личных подписей для этого запроса, в зависимости от уровня Software assurance, который связан с квалифицированного подчинения.
-   Если полное подчиненного ЦС, устанавливается родительский ЦС отключен от сети, необходимо получить сертификат ЦС для квалифицированного подчиненного ЦС от автономного. Если родительский ЦС подключен к сети, укажите сертификат ЦС для квалифицированного подчиненного ЦС в процессе работы мастера установки служб сертификатов.

Последовательность команд, ниже показано, как создать новый запрос на сертификат, подписать его и отправьте его:
```
certreq -new policyfile.inf MyRequest.req
certreq -sign MyRequest.req MyRequest_Sign.req
certreq -submit MyRequest_Sign.req MyRequest_cert.cer 
```
Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_enroll"></a>Certreq-регистрация

Регистрация сертификата
```
certreq –enroll [Options] TemplateName
```
Чтобы обновить существующий сертификат
```
certreq –enroll –cert CertId [Options] Renew [ReuseKeys]
```
Можно обновить только сертификаты, которые являются допустимое время. Просроченные сертификаты невозможно обновить и необходимо заменить на новый сертификат.

Ниже приведен пример продления сертификата с помощью его серийный номер:
```
certreq –enroll -machine –cert "61 2d 3c fe 00 00 00 00 00 05" Renew
```
Здесь пример регистрации для шаблона сертификата вызвать веб-сервера с помощью звездочки (*) для выбора сервера политики с помощью U/I:
```
certreq -enroll –machine –policyserver * "WebServer"
```
Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_Options"></a>Параметры

|Параметры|Описание|
|-------|-----------|
|-все|ICertRequest::Submit force, чтобы определить тип кодировки.|
|-attrib \<AttributeString >|Указывает пары имен и значение строки, разделенные двоеточием.</br>Отдельные строки имени и значения в виде пары с \n (например, Name1:Value1\nName2:Value2).|
|-двоичный|Форматы выходных файлов в двоичном формате, а не с кодировкой base64.|
|-PolicyServer  *\<PolicyServer >*|"ldap: *\<path>* "</br>Вставьте URI или уникальный идентификатор для компьютера под управлением веб-служба политик регистрации сертификатов.</br>Чтобы указать, что вы хотите использовать файл запроса путем просмотра, просто используйте минус (-) входа для  *\<policyserver >* .|
|-config \<ConfigString >|Обрабатывает операцию, используя Центр сертификации, указанный в строке конфигурации, который является CAHostName\CAName. Для подключения https укажите URI сервера регистрации. Для локального компьютера хранения ЦС, используйте знак минус (-) входа.|
|-Анонимный|Используйте анонимные учетные данные для веб-службы регистрации сертификатов.|
|-Kerberos|Используйте учетные данные Kerberos (домен) для веб-службы регистрации сертификатов.|
|-ClientCertificate  *\<ClientCertId >*|Вы можете заменить  *\<ClientCertID >* с отпечаток сертификата, CN, EKU, шаблон, электронной почты, имя участника-пользователя и новое имя = значение синтаксис.|
|-UserName  *\<имя пользователя >*|Используется с веб-службы регистрации сертификатов. Можно заменить  *\<имя пользователя >* с именем SAM или "домен\пользователь". Этот параметр предназначен для использования с помощью параметра -p.|
|-p  *\<пароль >*|Используется с веб-службы регистрации сертификатов. Substitute  *\<пароль >* с фактический пароль. Этот параметр предназначен для использования с параметром - UserName.|
|-пользователя|Настраивает - контекст пользователя для запроса нового сертификата или указывает контекст для принятие сертификата. Это контекст по умолчанию, если ничего не указано в INF или шаблоне.|
|-machine|Настраивает новый запрос на сертификат или задает контекст для принятие сертификата для контекста компьютера. Для новых запросов должны быть согласованы с ключом MachineKeyset INF и контексте шаблона. Если шаблон не задан контекст, этот параметр не указан, то по умолчанию используется контекст пользователя.|
|-crl|Включает сертификатов списков отзыва (CRL) в кодировке base 64 файл PKCS #7, указанный Выходной_файл_цепочки_сертификатов или файл в кодировке base64, указанный Выходной_файл_запроса выходных данных.|
|-rpc|Указывает, что службы сертификатов Active Directory (AD CS) для использования подключения к серверу удаленной процедуры (RPC) вызова вместо протокола DCOM.|
|-AdminForceMachine|Используйте ключ службы или олицетворение для отправки запроса в контексте локальной системы. Требует, чтобы вызовом этого параметра пользователь был членом локальной группы администраторов.|
|-RenewOnBehalfOf|Отправьте обновление от имени субъекта, определяемого в сертификате подписи. Таким образом задается CR_IN_ROBO при вызове [ICertRequest::Submit](https://technet.microsoft.com/subscriptions/aa385040.aspx)|
|-f|Принудительно нужно перезаписать существующие файлы. Это также позволяет обойти кэширование шаблонов и политик.|
|-q|Перейти в автоматический режим; отключить все интерактивные запросы.|
|-Юникода|Записывает выходные данные Юникода при стандартного потока вывода перенаправление или передать в другую команду, которая помогает при вызове из скриптов Windows PowerShell®).|
|-UnicodeText|Отправляет выходные данные Юникода, при написании текст в кодировке base64 в кодировке данных больших двоичных объектов для файлов.|

Вернитесь к [содержимое](#BKMK_Contents)

## <a name="BKMK_Formats"></a>Форматы

|Форматы|Описание|
|-------|-----------|
|Входной_файл_запроса|Имя входного файла с кодировкой Base64 или двоичные: Запрос на сертификат PKCS #10, запрос на сертификат CMS, запрос обновления сертификата PKCS #7, сертификат X.509, быть перекрестно сертифицированным или запрос сертификата в формате тега KeyGen.|
|Выходной_файл_запроса|Имя файла с кодировкой Base64 выходных данных|
|CertFileOut|64 разрядной кодировки x-509 имя файла.|
|PKCS10FileOut|Для использования с [Certreq-политики](#BKMK_policy) только команда. 64 разрядной кодировки PKCS10 имя выходного файла.|
|Выходной_файл_цепочки_сертификатов|64 разрядной кодировки PKCS #7 имя файла.|
|Выходной_файл_полного_ответа|Имя файла с кодировкой Base64 полный ответ.|
|Входной_файл_политики|Для использования с [Certreq-политики](#BKMK_policy) только команда. INF-файл, содержащий текстовое представление расширений, используемых для уточнения запроса.|

## <a name="BKMK_Examples"></a>Примеры дополнительных certreq

Следующие статьи содержат примеры использования certreq:
-   [Как запросить сертификат с пользовательским альтернативным именем темы](https://technet.microsoft.com/library/ff625722.aspx)
-   [Руководство по лаборатории тестирования. Развертывание двухуровневой иерархии инфраструктуры открытых КЛЮЧЕЙ](https://technet.microsoft.com/library/hh831348.aspx)
-   [Приложение 3. Синтаксис Certreq.exe](https://technet.microsoft.com/library/cc736326.aspx)
-   [Как создать сертификат SSL веб-сервера вручную](http://blogs.technet.com/b/pki/archive/2009/08/05/how-to-create-a-web-server-ssl-certificate-manually.aspx)
-   [Запрос с помощью Windows Server 2008 ЦС сертификат подготовки AMT](https://social.technet.microsoft.com/wiki/contents/articles/request-an-amt-provisioning-certificate-using-a-windows-server-2008-ca.aspx)
-   [Регистрация сертификата для агента System Center Operations Manager](https://social.technet.microsoft.com/wiki/contents/articles/certificate-enrollment-for-system-center-operations-manager-agent.aspx)
-   [AD CS Пошаговое руководство по: Двухуровневое развертывание иерархии PKI](https://social.technet.microsoft.com/wiki/contents/articles/15037.ad-cs-step-by-step-guide-two-tier-pki-hierarchy-deployment.aspx)
-   [Активация LDAP через SSL с центром сертификации сторонних](https://support.microsoft.com/kb/321051)

Вернитесь к [содержимое](#BKMK_Contents)
