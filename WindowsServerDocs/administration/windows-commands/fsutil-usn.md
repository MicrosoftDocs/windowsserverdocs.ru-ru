---
ms.assetid: faad34aa-4ba1-4129-bc1f-08088399e2fa
title: fsutil usn
ms.prod: windows-server-threshold
manager: dmoss
ms.author: toklima
author: toklima
ms.technology: storage
audience: IT Pro
ms.topic: article
ms.date: 10/16/2017
ms.openlocfilehash: 4bef63f4938b5ce786bbbfdbf3bdd2081280ce95
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59829985"
---
# <a name="fsutil-usn"></a>fsutil usn
>Область применения. Windows Server (полугодовой канал), Windows Server 2016, Windows 10, Windows Server 2012 R2, Windows 8.1, Windows Server 2012, Windows 8, Windows Server 2008 R2, Windows 7

Управляет журнала обновления порядковый номер (USN).

## <a name="syntax"></a>Синтаксис

```
fsutil usn [createjournal] m=<MaxSize> a=<AllocationDelta> <VolumePath>
fsutil usn [deletejournal] {/D | /N} <volumepath>
fsutil usn [enablerangetracking] <volumepath> [options]
fsutil usn [enumdata] <FileRef> <LowUSN> <HighUSN> <VolumePath>
fsutil usn [queryjournal] <VolumePath>
fsutil usn [readdata] <FileName>
fsutil usn [readjournal] [c= <chunk-size> s=<file-size-threshold>] <volumepath>
```

## <a name="parameters"></a>Параметры

|Параметр|Описание|
|-------------|---------------|
|createjournal|Создает отдельный журнал изменений USN.|
|m =\<MaxSize >|Указывает максимальный размер в байтах, NTFS выделяет для журнала изменений.|
|=\<Дельта_выделения >|Указывает размер в байтах, выделения памяти, добавляемый в конец и удаляется из начала журнала изменений.|
|\<VolumePath >|Указывает букву диска (двоеточие).|
|deletejournal|Удаляет или отключает активный журнал USN. **Внимание!** Удаление журнала влияет на службы репликации файлов (FRS) и службу индексирования, потому что это потребовало эти службы, чтобы выполнить проверку полного (и требует много времени) тома. Это в свою очередь, отрицательно влияет на репликацию FRS SYSVOL и репликацию между изменяется ссылки DFS повторная проверка тома.|
|/d|Отключает активный журнал USN и возвращает элемент управления ввода вывода (I/O) во время отключения журнала.|
|/n|Отключает активный журнал USN и возвращает элемент управления ввода-вывода, только в том случае, после отключения журнала.|
|enablerangetracking|Позволяет USN записи диапазон отслеживания для тома.|
|c=\<chunk-size>|Указывает размер блока для отслеживания на томе.|
|s =\<пороговое значение размера файла >|Указывает пороговое значение размера файла для отслеживания диапазона.|
|enumdata|Перечисляет и перечисляет записи журнала изменений между двух заданных границ.|
|\<FileRef >|Указывает порядковый номер внутри файлов на томе, с которого будет начато перечисление.|
|\<LowUSN >|Задает нижнюю границу значений диапазона USN, используемых для фильтрации записей, которые возвращаются. Только те записи журнала USN не между больше *LowUSN* и *Верхняя_граница* возвращаются значения членов.|
|\<Верхняя_граница >|Задает верхнюю границу значений диапазона USN, используемых для фильтрации файлов, которые возвращаются.|
|queryjournal|Запрашивает данные на томе USN для сбора сведений о текущему состоянию журнала, записи и его емкость.|
|ReadData|Считывает данные USN для файла.|
|\<Имя файла >|Указывает полный путь к файлу, включая имя файла и расширение, например: C:\documents\filename.txt|
|readjournal|Считывает USN записи в журнале USN.|
|MinVer =\<номер >|Минимальный основной номер версии USN_RECORD для возврата. По умолчанию = 2.|
|MaxVer =\<номер >|Максимум основной номер версии USN_RECORD для возврата. По умолчанию = 4.|
|startusn =\<номер USN >|USN следует начинать чтение из журнала USN. По умолчанию = 0.|


## <a name="remarks"></a>Примечания

-   О журнале изменений USN

    Журнал изменений USN обеспечивает постоянный журнал всех изменений, внесенных в файлы на томе. Мере файлов, каталогов и другие объекты NTFS добавления, удаления и изменения, NTFS система заносит записи в журнал изменений USN, по количеству томов на компьютере. В каждой записи указывается тип изменения и измененный объект. Новые записи добавляются в конец потока.

    Программы могут обращаться к журнал изменений USN, чтобы определить, все изменения, внесенные в набор файлов. Журнал изменений USN гораздо более эффективен, чем проверка штампов времени или регистрация для получения уведомлений в файл. Журнал изменений USN включить и использовать службы индексирования, служба репликации файлов (FRS), службы удаленной установки (RIS) и внешнее хранилище.

-   С помощью **createjournal**

    Если журнал существует на томе, **createjournal** параметр обновляет журнал изменений *MaxSize* и *Дельта_выделения* параметров. Это позволяет расширить число записей, которые поддерживает активный журнал, не отключая его.

-   С помощью **m**

    Журнал изменений может превысить это целевое значение, но журнала обрезается до следующей контрольной точки NTFS меньше, чем это значение. Проверяет журнал изменений NTFS и усекает его, если его размер превышает значение *MaxSize* плюс значение *Дельта_выделения*. В контрольных точках NTFS операционная система сохраняет записи в файл журнала NTFS, позволяющие NTFS определить, какие обработка не требуется для восстановления после сбоя.

-   С помощью ****

    Журнал изменений может достигать больше, чем сумма значений *MaxSize* и *Дельта_выделения* перед проведением усечения.

-   С помощью **deletejournal**

    Удаление или отключение активного журнала слишком много времени, так как системе необходимо обработать все записи в основной таблицы файлов (MFT) и указать последний атрибут номера последовательного обновления в 0 (ноль). Этот процесс может занять несколько минут, и может продолжить после перезагрузки системы, если необходима перезагрузка. В ходе этого процесса журнала изменений не считается активным, а также он отключен. При выполнении отключения журнала, он не был доступен, и все операции журнала возвращает ошибки. Следует использовать предельную осторожность при отключении активный журнал, поскольку это негативно влияет на другие приложения, использующие журнала.

## <a name="BKMK_examples"></a>Примеры
Чтобы создать журнал USN на диске C, введите:

```
fsutil usn createjournal m=1000 a=100 c:
```

Чтобы удалить активный журнал USN на диске C, введите:

```
fsutil usn deletejournal /d c:
```

Чтобы включить диапазон отслеживания с указанным размер блока и пороговое значение размера файла, введите следующую команду:

```
fsutil usn enablerangetracking c=16384 s=67108864 C:
```

Для перечисления и перечисления записи журнала изменений между двух указанных границ на диске C, введите следующую команду:

```
fsutil usn enumdata 1 0 1 c:
```

Чтобы запросить номера последовательного обновления данных для тома на диске C, введите следующую команду:

```
fsutil usn queryjournal c:
```

Чтобы считать данные USN для файла в папке \Temp на диске C, введите следующую команду:

```
fsutil usn readdata c:\temp\sample.txt
```

Для чтения журнала USN определенное USN, введите следующую команду:

```
fsutil usn readjournal startusn=0xF00
```

#### <a name="additional-references"></a>Дополнительная справка
[Ключ синтаксиса командной строки](Command-Line-Syntax-Key.md)

[fsutil](Fsutil.md)


