---
title: fsutil usn
description: Справочная статья по команде fsutil USN, которая управляет журналом изменений с порядковыми номерами обновлений (USN).
manager: dmoss
ms.author: toklima
author: toklima
ms.assetid: faad34aa-4ba1-4129-bc1f-08088399e2fa
ms.topic: article
ms.date: 10/16/2017
ms.openlocfilehash: c2bbd130902812f9a44d2d762a074b67de5e8dac
ms.sourcegitcommit: 53d526bfeddb89d28af44210a23ba417f6ce0ecf
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/06/2020
ms.locfileid: "87889775"
---
# <a name="fsutil-usn"></a>fsutil usn

> Область применения: Windows Server (половина ежегодного канала), Windows Server 2019, Windows Server 2016, Windows 10, Windows Server 2012 R2, Windows 8.1, Windows Server 2012, Windows 8

Управляет журналом изменений номеров последовательных обновлений (USN). Журнал изменений USN обеспечивает постоянный журнал всех изменений, внесенных в файлы на томе. По мере добавления, удаления и изменения файлов, каталогов и других объектов NTFS система NTFS вводит записи в журнал изменений USN, по одному для каждого тома на компьютере. В каждой записи указывается тип изменения и измененный объект. Новые записи добавляются в конец потока.

## <a name="syntax"></a>Синтаксис

```
fsutil usn [createjournal] m=<maxsize> a=<allocationdelta> <volumepath>
fsutil usn [deletejournal] {/d | /n} <volumepath>
fsutil usn [enablerangetracking] <volumepath> [options]
fsutil usn [enumdata] <fileref> <lowUSN> <highUSN> <volumepath>
fsutil usn [queryjournal] <volumepath>
fsutil usn [readdata] <filename>
fsutil usn [readjournal] [c= <chunk-size> s=<file-size-threshold>] <volumepath>
```

### <a name="parameters"></a>Параметры

| Параметр | Описание: |
| --------- | ----------- |
| креатежаурнал | Создает журнал изменений USN. |
| m =`<maxsize>` | Указывает максимальный размер (в байтах), выделяемый файловой системой NTFS для журнала изменений. |
| a =`<allocationdelta>` | Задает размер (в байтах) выделения памяти, который добавляется в конец и удаляется из начала журнала изменений. |
| `<volumepath>` | Указывает букву диска (с последующим двоеточием). |
| делетежаурнал | Удаляет или отключает активный журнал изменений USN.<p>**Внимание!** Удаление журнала изменений влияет на службу репликации файлов (FRS) и службу индексирования, так как требует от этих служб выполнения полного (и длительного) просмотра тома. Это, в свою очередь, негативно влияет на репликацию FRS SYSVOL и репликацию между альтернативными ссылками DFS во время повторного сканирования тома. |
| /d | Отключает активный журнал USN и возвращает управление входными и выходными данными (I/O) во время отключения журнала изменений. |
| /n | Отключает активный журнал изменений USN и возвращает управление вводом-выводом только после отключения журнала изменений. |
| енаблеранжетраккинг | Включает отслеживание диапазона записи USN для тома. |
| c =`<chunk-size>` | Указывает размер фрагмента для записи в томе. |
| s =`<file-size-threshold>` | Указывает пороговое значение размера файла для отслеживания диапазона. |
| енумдата | Перечисляет и перечисляет записи журнала изменений между двумя указанными границами. |
| `<fileref>` | Задает порядковый номер в файлах на томе, с которого начинается перечисление. |
| `<lowUSN>` | Задает нижнюю границу диапазона значений USN, используемых для фильтрации возвращаемых записей. Возвращаются только записи, USN журнала последнего изменения которых находится между или равными значениям элементов *ловусн* и *хигхусн* . |
| `<highUSN>` | Задает верхнюю границу диапазона значений USN, используемых для фильтрации возвращаемых файлов. |
| куерижаурнал | Запрашивает данные USN тома, чтобы собрать сведения о текущем журнале изменений, его записях и его емкости. |
| ReadData | Считывает данные USN для файла. |
| `<filename>` | Указывает полный путь к файлу, включая имя файла и расширение, например: *C:\documents\filename.txt*. |
| реаджаурнал | Считывает записи USN в журнале USN. |
| минвер =`<number>` | Минимальная основная версия USN_RECORD, которую необходимо вернуть. Значение по умолчанию — 2. |
| максвер =`<number>` | Максимальная основная версия USN_RECORD, которую необходимо вернуть. Значение по умолчанию — 4. |
| стартусн =`<USN number>` | USN, с которого начинается чтение журнала USN. По умолчанию равно 0. |

#### <a name="remarks"></a>Remarks

- Программы могут обратиться к журналу изменений USN, чтобы определить все изменения, внесенные в набор файлов. Журнал изменений USN гораздо эффективнее, чем проверка меток времени или регистрация для получения уведомлений о файлах. Журнал изменений USN включается и используется службой индексирования, службой репликации файлов (FRS), службами удаленной установки (RIS) и удаленным хранилищем.

- Если журнал изменений уже существует на томе, параметр **креатежаурнал** обновляет параметры **MAXSIZE** и **аллокатионделта** журнала изменений. Это позволяет увеличить число записей, поддерживаемых активным журналом, без необходимости его отключения.

- Размер журнала изменений может увеличиваться, чем это целевое значение, но журнал изменений усекается на следующей контрольной точке NTFS до меньшего значения. NTFS проверяет журнал изменений и обрезает его, если его размер превышает значение **MAXSIZE** плюс значение **аллокатионделта**. В контрольных точках NTFS операционная система записывает записи в файл журнала NTFS, который позволяет системе NTFS определить, какая обработка необходима для восстановления после сбоя.

- Журнал изменений может увеличиться до суммы значений **MAXSIZE** и **аллокатионделта** перед усечением.

- Удаление или отключение активного журнала изменений занимает много времени, поскольку система должна получить доступ ко всем записям в главной таблице файлов (MFT) и установить последний атрибут USN равным 0 (нулю). Этот процесс может занять несколько минут, и он может продолжать работу после перезагрузки системы, если требуется перезагрузка. В ходе этого процесса журнал изменений не считается активным или отключен. При отключении журнала система недоступна, и все операции с журналом возвращают ошибки. При отключении активного журнала следует использовать крайне осторожно, поскольку он неблагоприятно влияет на другие приложения, использующие журнал.

### <a name="examples"></a>Примеры

Чтобы создать журнал изменений USN на диске C, введите:

```
fsutil usn createjournal m=1000 a=100 c:
```

Чтобы удалить активный журнал изменений USN на диске C, введите:

```
fsutil usn deletejournal /d c:
```

Чтобы включить отслеживание диапазона с заданным размером фрагмента и порогом размера файла, введите:

```
fsutil usn enablerangetracking c=16384 s=67108864 C:
```

Чтобы перечислить и вывести записи журнала изменений между двумя указанными границами на диске C, введите:

```
fsutil usn enumdata 1 0 1 c:
```

Чтобы запросить данные USN для тома на диске C, введите:

```
fsutil usn queryjournal c:
```

Чтобы прочитать данные USN для файла в папке \Temp на диске C, введите:

```
fsutil usn readdata c:\temp\sample.txt
```

Чтобы прочитать журнал USN с указанным начальным USN, введите:

```
fsutil usn readjournal startusn=0xF00
```

## <a name="additional-references"></a>Дополнительные ссылки

- [Условные обозначения синтаксиса команд командной строки](command-line-syntax-key.md)

- [fsutil](fsutil.md)
