---
title: рефсутил
description: Рефсутил — это средство, включенное в Windows и Windows Server, которое пытается диагностировать сильно поврежденные тома ReFS, определять оставшиеся файлы и копировать эти файлы на другой том.
author: laknight5
ms.author: laknight
ms.date: 6/29/2020
ms.prod: windows-server
ms.technology: storage-file-systems
ms.topic: article
ms.openlocfilehash: 0d7c1bf79695c2ddd03943744ebf1df4827d365c
ms.sourcegitcommit: 457e88e5aa6be13a2bffdb8e434a8efc3698678f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/30/2020
ms.locfileid: "85549169"
---
# <a name="refsutil"></a>рефсутил

>Применяется к: Windows Server 2019, Windows 10

Рефсутил — это средство, включенное в Windows и Windows Server, которое пытается диагностировать сильно поврежденные тома ReFS, определять оставшиеся файлы и копировать эти файлы на другой том. Это происходит в Windows 10 в папке%SystemRoot%\Windows\System32 или в Windows Server в папке% SystemRoot% \\ System32.

Функция восстановления ReFS является основной функцией Рефсутил в настоящее время и полезна для восстановления данных с томов, которые отображаются как необработанные в оснастке «Управление дисками». В "остаточная_стоимость" ReFS есть два этапа: этап сканирования и стадия копирования. В автоматическом режиме этап сканирования и этап копирования будут выполняться последовательно. В ручном режиме каждый этап можно запустить отдельно. Ход выполнения и журналы сохраняются в рабочем каталоге, чтобы можно было выполнять этапы отдельно, а также для приостановки и возобновления этапа сканирования. Рефсутил не нужно использовать, если только том не является ИСХОДным. Если доступ только для чтения, данные по-прежнему доступны.

## <a name="automatic-mode-command-line-usage"></a>Использование командной строки в автоматическом режиме

### <a name="quick-automatic-mode-command-line-usage"></a>Быстрый режим использования командной строки в автоматическом режиме

```dos
refsutil salvage -QA <source volume> <working directory> <target directory> <options>
```
Будет выполнен этап быстрой проверки, за которым следует фаза копирования. Этот режим выполняется быстрее, так как предполагается, что некоторые критические структуры тома не повреждены, поэтому нет необходимости сканировать весь том для их поиска. Это также сокращает вероятность восстановления устаревших файлов, каталогов или томов.

### <a name="full-automatic-mode-command-line-usage"></a>Полный режим использования командной строки в автоматическом режиме

```dos
refsutil salvage -FA <source volume> <working directory> <target directory> <options>
```

Будет выполнен этап полной проверки, за которым следует фаза копирования. Этот режим может занять много времени, так как будет проверять весь том на наличие восстанавливаемых файлов, каталогов и томов.

## <a name="manual-mode-command-line-usage"></a>Использование командной строки в ручном режиме

### <a name="diagnose-phase-command-line-usage"></a>Анализ использования командной строки этапа диагностики

```dos
refsutil salvage -D <source volume> <working directory> <options>
```

Во-первых, попробуйте определить, является ли том \<source volume\> томом ReFS, и определите, можно ли подключить том. Если том не может быть подключен, будут определены причины. Это автономный этап.

### <a name="quick-scan-phase-command-line-usage"></a>Использование командной строки этапа быстрой проверки

```dos
refsutil salvage -QS <source volume> <working directory> <options>
```

Быстрая проверка \<source volume\> файлов для восстановления. Этот режим выполняется быстрее, так как предполагается, что некоторые критические структуры тома не повреждены, поэтому нет необходимости сканировать весь том для их поиска. Это также сокращает вероятность восстановления устаревших файлов, каталогов или томов. Обнаруженные файлы будут занесены в журнал "фаундфилес. \<volume signature\> .. txt "в разделе \<working directory\> . Если фаза сканирования была остановлена ранее, при повторном запуске с помощью флага-QS будет возобновлена предыдущая проверка.

### <a name="full-scan-phase-command-line-usage"></a>Использование командной строки этапа полной проверки

```dos
refsutil salvage -FS <source volume> <working directory> <options>
```

Сканирование всего \<source volume\> восстанавливаемых файлов. Этот режим может занять много времени, так как будет проверять весь том на наличие восстанавливаемых файлов.
Обнаруженные файлы будут занесены в журнал "фаундфилес. \<volume signature\> .. txt "в разделе \<working directory\> . Если фаза сканирования была остановлена ранее, при повторном запуске с помощью флага-FS будет возобновлена предыдущая проверка.

### <a name="copy-phase-command-line-usage"></a>Использование командной строки этапа копирования

```dos
refsutil salvage -C <source volume> <working directory> <target directory>
<options>
```

Скопируйте все файлы, описанные в разделе " \<volume signature\> фаундфилес. txt "в \<target
directory\> . Если фаза сканирования остановлена слишком рано, "фаундфилес. \<volume
signature\> . txt ", возможно, еще не записан, поэтому файл не будет скопирован в \<target directory\> .

### <a name="copy-phase-with-list-command-line-usage"></a>Этап копирования со списком использования командной строки

```dos
refsutil salvage -SL <source volume> <working directory> <target
directory> <file list> <options>
```

Скопируйте все файлы из в \<file list\> \<source volume\> \<target
directory\> . Файлы в \<file list\> должны быть сначала идентифицированы на этапе просмотра, хотя проверка не должна быть выполнена до завершения. \<file list\>можно создать путем копирования " \<volume signature\> фаундфилес. txt "в новый файл, удаление строк, ссылающихся на файлы, которые не должны быть восстановлены, и сохранение файлов, которые следует восстановить. Командлет PowerShell Select-String может быть полезен при фильтрации "фаундфилес. \<volume signature\> . txt, чтобы включить только нужные пути, расширения или имена файлов.

### <a name="copy-phase-with-interactive-console"></a>Фаза копирования с помощью интерактивной консоли

```dos
refsutil salvage -IC <source volume> <working directory> <options>
```

Возможность восстановления файлов в интерактивной консоли для опытных пользователей. Этот режим также требует наличия файлов, созданных на любом этапе сканирования.

## <a name="parameters"></a>Параметры

| Параметр             | Описание                                                                     |
| --------------------- | --------------------------------------------------------------------------------------- |
| \<source volume\>     | Том ReFS для обработки. Буква диска в формате "L:" или путь к точке подключения тома.           |
| \<working directory\> | Расположение для хранения временных данных и журналов. Он **не** должен располагаться на \<source volume\> .  |
| \<target directory\>  | Расположение, в которое будут копироваться указанные файлы. Он **не** должен располагаться на \<source volume\> . |
| \- м.         | Восстановление всех возможных файлов, включая удаленные. Этот параметр будет проигнорирован в рефсутил остаточная_стоимость v1. ВНИМАНИЕ! не только это займет больше времени, но может привести к непредвиденному результату. |
| \-3,3         | Подробный режим                                                                                           |
| \-x         | При необходимости принудительно отключите том. Все открытые дескрипторы тома станут недействительными. Пример: рефсутил остаточная_стоимость-QA R: N: \\ Working N: \\ Data-x                                  |
