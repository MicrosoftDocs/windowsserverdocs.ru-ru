---
title: рефсутил
description: Справочная статья по средству Рефсутил, которая пытается диагностировать сильно поврежденные тома ReFS, определять оставшиеся файлы и копировать эти файлы на другой том.
author: laknight5
ms.author: laknight
ms.date: 6/29/2020
ms.prod: windows-server
ms.technology: storage-file-systems
ms.topic: article
ms.openlocfilehash: c84aaed5b34c535221247dcdd6ab0a5462fd4aad
ms.sourcegitcommit: 2afed2461574a3f53f84fc9ec28d86df3b335685
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/02/2020
ms.locfileid: "85931101"
---
# <a name="refsutil"></a>рефсутил

>Применяется к: Windows Server 2019, Windows 10

Рефсутил — это средство, включенное в Windows и Windows Server, которое пытается диагностировать сильно поврежденные тома ReFS, определять оставшиеся файлы и копировать эти файлы на другой том. Это происходит в Windows 10 в `%SystemRoot%\Windows\System32` папке или в Windows Server в `%SystemRoot%\\System32` папке.

Функция восстановления ReFS является основной функцией Рефсутил и полезна для восстановления данных с томов, которые отображаются как необработанные в оснастке «Управление дисками». В "остаточная_стоимость" ReFS есть два этапа: этап сканирования и стадия копирования. В автоматическом режиме этап сканирования и этап копирования будут выполняться последовательно. В ручном режиме каждый этап можно запустить отдельно. Ход выполнения и журналы сохраняются в рабочем каталоге, чтобы можно было выполнять этапы отдельно, а также для приостановки и возобновления этапа сканирования. Не следует использовать средство Рефсутил, если только том не является ИСХОДным. Если доступ только для чтения, данные по-прежнему доступны.

## <a name="parameters"></a>Параметры

| Параметр | Описание |
|--|--|
| `<source volume>` | Указывает том ReFS для обработки. Буква диска должна иметь формат "L:" или необходимо указать путь к точке подключения тома. |
| `<working directory>` | Указывает расположение для хранения временных данных и журналов. Он **не** должен располагаться на `<source volume>` . |
| `<target directory>` | Указывает расположение, в которое копируются идентифицированные файлы. Он **не** должен располагаться на `<source volume>` . |
| \- м. | Восстанавливает все возможные файлы, включая удаленные.<p>**Предупреждение:** Этот параметр не только приводит к тому, что процесс займет больше времени, но также может привести к непредвиденным результатам. |
| \-3,3 | Задает использование режима подробных сведений. |
| \-x | Принудительное отключение тома при необходимости. Все открытые дескрипторы тома являются недопустимыми. Например, `refsutil salvage -QA R: N:\\WORKING N:\\DATA -x`. |

## <a name="usage-and-available-options"></a>Использование и доступные параметры

### <a name="quick-automatic-mode-command-line-usage"></a>Быстрый режим использования командной строки в автоматическом режиме

Выполняет этап быстрой проверки, за которым следует этап копирования. Этот режим работает быстрее, так как предполагается, что некоторые критические структуры тома не повреждены, поэтому нет необходимости сканировать весь том для их поиска. Это также сокращает вероятность восстановления устаревших файлов, каталогов или томов.

```
refsutil salvage -QA <source volume> <working directory> <target directory> <options>
```

### <a name="full-automatic-mode-command-line-usage"></a>Полный режим использования командной строки в автоматическом режиме

Выполняет полную фазу сканирования с последующим этапом копирования. Этот режим может занять много времени, так как будет проверять весь том на наличие восстанавливаемых файлов, каталогов и томов.

```
refsutil salvage -FA <source volume> <working directory> <target directory> <options>
```

### <a name="diagnose-phase-command-line-usage-manual-mode"></a>Контроль использования командной строки этапа диагностики (ручной режим)

Во-первых, попробуйте определить, `<source volume>` является ли том томом ReFS, и определите, можно ли подключить том. Если том не подключается, будут предоставлены причины. Это автономный этап.

```
refsutil salvage -D <source volume> <working directory> <options>
```

### <a name="quick-scan-phase-command-line-usage"></a>Использование командной строки этапа быстрой проверки

Выполняет быструю проверку `<source volume>` для всех восстанавливаемых файлов. Этот режим выполняется быстрее, так как предполагается, что некоторые критические структуры тома не повреждены, поэтому нет необходимости сканировать весь том для их поиска. Это также сокращает вероятность восстановления устаревших файлов, каталогов или томов. Обнаруженные файлы записываются в `foundfiles.<volume signature>.txt` файл, расположенный в папке `<working directory>` . Если фаза сканирования была остановлена ранее, при запуске с помощью флага **-QS** снова возобновляет проверку с места остановки.

```
refsutil salvage -QS <source volume> <working directory> <options>
```

### <a name="full-scan-phase-command-line-usage"></a>Использование командной строки этапа полной проверки

Сканирует все `<source volume>` восстанавливаемые файлы. Этот режим может занять много времени, так как будет проверять весь том на наличие восстанавливаемых файлов. Обнаруженные файлы будут записаны в `foundfiles.<volume signature>.txt` файл, расположенный в папке `<working directory>` . Если фаза сканирования была остановлена ранее, то при запуске с флагом **-FS** снова возобновляет проверку с места остановки.

```
refsutil salvage -FS <source volume> <working directory> <options>
```

### <a name="copy-phase-command-line-usage"></a>Использование командной строки этапа копирования

Копирует все файлы, описанные в `foundfiles.<volume signature>.txt` файле, в файл `<target directory>` . Если стадия сканирования слишком рано останавливается, возможно, `foundfiles.<volume signature>.txt` файл еще не существует, поэтому файл не копируется в `<target directory>` .

```
refsutil salvage -C <source volume> <working directory> <target directory> <options>
```

### <a name="copy-phase-with-list-command-line-usage"></a>Этап копирования со списком использования командной строки

Копирует все файлы из в в `<file list>` `<source volume>` `<target directory>` . Файлы в `<file list>` должны сначала определяться этапом сканирования, хотя проверка не должна быть выполнена до завершения. `<file list>`Можно создать путем копирования `foundfiles.<volume signature>.txt` в новый файл, удаления строк, ссылающихся на файлы, которые не должны быть восстановлены, и сохранения файлов, которые следует восстановить. Командлет PowerShell **Select-String** может быть полезен в фильтрации `foundfiles.<volume signature>.txt` для включения только нужных путей, расширений или имен файлов.

```
refsutil salvage -SL <source volume> <working directory> <target directory> <file list> <options>
```

### <a name="copy-phase-with-interactive-console"></a>Фаза копирования с помощью интерактивной консоли

Опытные пользователи могут спасти файлы с помощью интерактивной консоли. Этот режим также требует наличия файлов, созданных на любом этапе сканирования.

```
refsutil salvage -IC <source volume> <working directory> <options>
```

## <a name="additional-references"></a>Дополнительные ссылки

- [Условные обозначения синтаксиса команд командной строки](command-line-syntax-key.md)
