---
title: defrag
description: Команды Windows для дефрагментации, которые находят и консолидируют фрагментированные файлы на локальных томах для повышения производительности системы.
ms.prod: windows-server
ms.technology: manage-windows-commands
ms.topic: article
ms.assetid: aaf1d1ac-996a-4282-9b4d-1e8245ff162c
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: f8723afc936fa1ea311e275a58a85b20988f92a2
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80846717"
---
# <a name="defrag"></a>defrag

>Область применения: Windows 10, Windows Server (половина ежегодного канала), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Находит и объединяет фрагментированные файлы на локальных томах, чтобы повысить производительность системы.

Членство в группе локальных **администраторов** или эквивалентной является минимальным требованием для выполнения этой команды.

## <a name="syntax"></a>Синтаксис
```
defrag <volumes> | /C | /E <volumes>    [/H] [/M [n]| [/U] [/V]]
defrag <volumes> | /C | /E <volumes> /A [/H] [/M [n]| [/U] [/V]]
defrag <volumes> | /C | /E <volumes> /X [/H] [/M [n]| [/U] [/V]]
defrag <volume> [/<Parameter>]*
```
### <a name="parameters"></a>Параметры

|Параметр|Описание|
|-------|--------|
|`<volume>`|Указывает букву диска или путь к точке подключения тома для дефрагментации или анализа.|
|А|Выполните анализ указанных томов.|
|C|Выполните операцию на всех томах.|
|Г|Выполнить традиционную дефрагментацию (это значение по умолчанию). В многоуровневого тома, однако традиционная дефрагментация выполняется только на уровне емкости.|
|Д|Выполните операцию для всех томов, кроме указанных.|
|G|Оптимизируйте уровни хранилища на указанных томах.|
|H|Выполните операцию с нормальным приоритетом (по умолчанию низкая).|
|Я n|Оптимизация уровней будет выполняться не более n секунд на каждом томе.|
|K|Выполните консолидацию слоев на указанных томах.|
|L|Выполните повторное усечение для указанных томов.|
|M [n]|Выполните операцию на каждом томе параллельно в фоновом режиме. Не более n потоков оптимизируют уровни хранилища параллельно.|
|O|Выполните правильную оптимизацию для каждого типа носителя.|
|T|Отследите, что операция уже выполняется на указанном томе.|
|U|Печать хода выполнения операции на экране.|
|V|Печать подробных выходных данных, содержащих статистику фрагментации.|
|X|Выполните консолидацию свободного пространства на указанных томах.|
|?|Отображает эту справочную информацию.|

## <a name="remarks"></a>Примечания
- Невозможно дефрагментировать определенные типы томов или дисков файловой системы.
  -   Дефрагментация томов, заблокированных файловой системой, невозможна.
  -   Дефрагментацию томов, помеченных файловой системой как "грязная", невозможна, что указывает на возможное повреждение. Необходимо запустить **программу chkdsk** на грязном томе, прежде чем его можно будет дефрагментировать. Можно определить, является ли том "грязным", с помощью команды **fsutil** Dirty Query. Дополнительные сведения о **chkdsk** и **fsutil** Dirty см. в разделе [Дополнительные ссылки](defrag.md#BKMK_additionalRef).
  -   Дефрагментация сетевых дисков невозможна.
  -   Дефрагментацию cdROM невозможно.
  -   Невозможно дефрагментировать тома файловой системы, не являющиеся файлами **NTFS**, **ReFS**, **FAT** или **FAT32**.
- В Windows Server 2008 R2, Windows Server 2008 и Windows Vista можно запланировать дефрагментацию тома. Однако вы не можете запланировать дефрагментацию твердотельного накопителя (SSD) или тома на виртуальном жестком диске (VHD), который находится на SSD.
- Для выполнения этой процедуры необходимо являться членом группы "Администраторы" на локальном компьютере или получить соответствующие полномочия путем делегирования. Если компьютер подключен к домену, члены группы "Администраторы домена", возможно, смогут выполнить эту процедуру. По соображениям безопасности рекомендуется использовать **Запуск от имени** для выполнения этой процедуры.
- Том должен иметь не менее 15% свободного места для **дефрагментации** , чтобы полностью и адекватно дефрагментировать его. **Defrag** использует это пространство как область сортировки для фрагментов файлов. Если объем свободного места на томе меньше 15 **%, Дефрагментация** будет выполнена частично. Чтобы увеличить объем свободного места в томе, удалите ненужные файлы или переместите их на другой диск.
- При анализе и дефрагментации тома в процессе **дефрагментации** отображается мигающий курсор. После завершения анализа и дефрагментации тома в нем отображается отчет об анализе, отчет о дефрагментации или оба отчета **, после чего** выполняется выход из командной строки.
- По умолчанию **Defrag** отображает сводку отчетов об анализе и дефрагментации, если не указаны параметры **/a** или **/v** .
- Отчеты можно отправить в текстовый файл, введя **>** <em>filename. txt</em>, где *filename. txt* — это имя файла, которое вы указали. Пример: `defrag volume /v > FileName.txt`
- Чтобы прервать процесс дефрагментации, в командной строке нажмите клавиши **CTRL + C**.
- Выполнение команды **дефрагментации** и дефрагментации диска являются взаимоисключающими. Если вы используете дефрагментацию диска для дефрагментации тома и выполняете команду **Defrag** в командной строке, команда **defrag** завершается ошибкой. И наоборот, если выполнить команду **Defrag** и открыть средство дефрагментации диска, параметры дефрагментации в дефрагментации диска будут недоступны.

## <a name="examples"></a><a name=BKMK_examples></a>Примеров
Чтобы выполнить дефрагментацию тома на диске C при предоставлении сведений о ходе выполнения и подробных выходных данных, введите:
```
defrag C: /U /V
```
Чтобы дефрагментировать тома на дисках C и D параллельно в фоновом режиме, введите:
```
defrag C: D: /M
```
Чтобы выполнить анализ фрагментации тома, подключенного к диску C, и указать ход выполнения, введите:
```
defrag C: mountpoint /A /U
```
Чтобы дефрагментировать все тома с нормальным приоритетом и предоставить подробные выходные данные, введите:
```
defrag /C /H /V
```

## <a name="scheduled-task"></a><a name=BKMK_scheduledTask></a>Запланированная задача
Запланированная задача дефрагментации запускается как задача обслуживания и обычно запланирована на каждую неделю. Администратор может изменить частоту с помощью приложения для **оптимизации дисков** .
- При запуске из запланированной задачи **Defrag** имеет следующую политику для твердотельных накопителей:
   - **Традиционная Дефрагментация** (т. е. Перемещение файлов, чтобы сделать их непрерывными), а повторное **усечение** выполняется каждый месяц.
   - Если как **традиционная Дефрагментация** **, так и** повторное удаление пропускаются, **анализ** не выполняется.
      - Если пользователь запустил **традиционную дефрагментацию** вручную на SSD, скажем, через 3 недели после выполнения последней запланированной задачи, то следующий запуск запланированной задачи выполняет **анализ** и повторную **усечение** , но пропускает **традиционную дефрагментацию** на этом SSD.
   - Если **анализ** пропускается, время **последнего выполнения** в поле **оптимизировать диски** не обновляется.  Итак, для твердотельных накопителей время **последнего запуска** в поле **Оптимизация дисков** может быть в месяц со старым.
- Эта задача обслуживания может не Дефрагментация всех томов, в то время как эта задача выполняет следующие действия:
   - Не пробуждает компьютер для выполнения дефрагментации
   - Запускается, только если компьютер находится в питании от сети и останавливается, если компьютер переключается на питание от аккумулятора.
   - Останавливается, если компьютер перестает быть активным

## <a name="additional-references"></a><a name=BKMK_additionalRef></a>Дополнительные ссылки
-   [chkdsk](chkdsk.md)
-   [fsutil](fsutil.md)
-   [fsutil dirty](fsutil-dirty.md)
-   - [Условные обозначения синтаксиса команд командной строки](command-line-syntax-key.md)
