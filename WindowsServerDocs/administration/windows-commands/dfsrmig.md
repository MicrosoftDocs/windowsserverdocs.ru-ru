---
title: dfsrmig
description: 'Раздел Windows команды для ***- '
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: manage-windows-commands
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: e1b6a464-6a93-4e66-9969-04f175226d8d
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: da05aec5ca5a5634585c5f5406181c5c90ee3a30
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59856945"
---
# <a name="dfsrmig"></a>dfsrmig

>Область применения. Windows Server (полугодовой канал), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

`dfsrmig` Команда переносит из службы репликации файлов (FRS) репликация SYSvol с репликацией распределенной файловой системы (DFS), предоставляет информацию о ходе выполнения миграции и преобразует объекты active directory доменные службы (AD DS) поддерживает миграцию.
Примеры для использования этой команды, см. в разделе [примеры](#BKMK_examples) настоящего документа.
## <a name="syntax"></a>Синтаксис
```
dfsrmig [/SetGlobalState <state> | /GetGlobalState | /GetMigrationState | /createGlobalObjects | 
/deleteRoNtfrsMember [<read_only_domain_controller_name>] | /deleteRoDfsrMember [<read_only_domain_controller_name>] | /?]
```
## <a name="parameters"></a>Параметры
|Параметр|Описание|
|-------|--------|
|/ SetGlobalState <state>|Задает нужный глобальный миграции состояния для домена в состояние, соответствующее значению, заданному в *состояние*.<br /><br />Чтобы продолжить через миграции или процессов отката, используйте следующую команду для циклического перебора допустимые состояния. Этот параметр позволяет инициировать и контролировать процесс миграции, установив состояние глобального миграции в AD DS на эмулятор основного контроллера домена. Если эмулятор основного контроллера домена недоступен, эта команда не выполняется.<br /><br /> Состояние глобального миграции можно задать только в стабильное состояние. Допустимые значения для *состояние*, следовательно, являются **0** для начальное состояние, **1** для состоянии подготовки, **2** перенаправленный состояния, и **3** для состояния закрыто.<br /><br />Перенос в состояние закрыто является необратимой операцией и возврат данных из этого состояния невозможно, поэтому используйте значение **3** для *состояние* только при использовании полностью committd с помощью репликации DFS для SYSvol репликация.|
|/ GetGlobalState|Получает текущее состояние глобального миграции для домена из локальной копии базы данных AD DS, при запуске в эмуляторе основного контроллера домена.<br /><br />Используйте этот параметр для подтверждения, установить правильный глобального миграции состояния. Только стабильные миграции состояния могут быть глобального миграции состояния, поэтому результаты, **dfsrmig** отчетов с помощью команды **/GetGlobalState** параметр соответствуют состояниям, можно задать с помощью **/SetGlobalState** параметр.<br /><br />Следует запускать **dfsrmig** с **/GetGlobalState** параметр только в эмуляторе основного контроллера домена. репликация Active directory реплицирует глобальное состояние на другие контроллеры домена в домене, но вызывает задержку репликации может привести к несогласованности при запуске **dfsrmig** с **/GetGlobalState**  параметр на контроллере домена, отличного от эмулятор основного контроллера домена. Чтобы проверить состояние переноса локального контроллера домена, отличного от эмулятор основного контроллера домена, используйте **/GetMigrationState** вместо него.|
|/GetMigrationState|Возвращает текущее состояние локальной миграции для всех контроллеров домена в домене и определяет, соответствуют ли эти локального состояния текущего состояния глобального миграции.<br /><br />Используйте этот параметр, чтобы определить, если все контроллеры домена достигли состояние глобального миграции. Выходные данные **dsfrmig** команды при использовании **/GetMigrationState** параметр указывает ли текущее глобальное состояние завершения миграции, он выводит состояние локальной миграции для любого контроллеры домена, которые не достигли текущее состояние глобального миграции. Состояние миграции локальных контроллеров домена может включать состояния перехода для контроллеров домена, которые не достигли текущее состояние глобального миграции.|
|/createGlobalObjects|создает глобальные объекты и параметры в AD DS, которую использует служба репликации DFS.<br /><br />Нет необходимости использовать этот параметр во время обычного переноса, так как служба репликации DFS автоматически создает эти объекты AD DS и параметры во время миграции из начальное состояние в состоянии подготовки. Используйте этот параметр, чтобы вручную создать эти объекты и параметры в следующих ситуациях:<br /><br />-   **Новый контроллер домена только для чтения повышается во время миграции**. Служба репликации DFS автоматически создает объекты AD DS и параметры для репликации DFS во время миграции из начальное состояние в состоянии подготовки. При повышении уровня нового контроллера домена только для чтения в домене после этого перехода, но перед миграцией в состояние закрыто, выберите объекты, соответствующие новому активированному домена только для чтения контроллера не создаются в AD DS, репликации и Сбой миграции.<br />— В этом случае можно запустить **dfsrmig** wth команда **/createGlobalObjects** параметр, чтобы создать объекты на всех контроллерах домена только для чтения, на которые у вас нет их вручную. Данная команда не влияет на контроллеры домена, которые уже есть объекты и параметры для службы репликации DFS.<br />-   **Глобальные параметры для службы репликации DFS отсутствуют или были удалены**. Если эти параметры отсутствуют для определенного контроллера домена, миграции из начальное состояние в состоянии подготовки зависает в состоянии перехода Подготовка для контроллера домена. В этом случае можно использовать **dfsrmig** с **/createGlobalObjects** параметр, чтобы создать параметры вручную. **Примечание.** Из-за создания глобальных параметров AD DS для службы репликации DFS для контроллера домена только для чтения в эмуляторе основного контроллера домена, эти параметры необходимо реплицировать на контроллер домена только для чтения из эмулятора основного контроллера домена, прежде чем служба репликации DFS на Эти параметры можно использовать контроллер домена только для чтения. Из-за задержки репликации active каталога репликация может занять некоторое время выполнение.|
|/deleteRoNtfrsMember [< read_only_domain_controller_name >]|Удаляет глобальных параметров служб AD DS для репликации FRS контроллера указанного домена только для чтения, или удаляет глобальные параметры AD DS для репликации FRS для всех контроллеров домена только для чтения, если значение не указано для *read_only_ имя_контроллера_домена*.<br /><br />Нет необходимости использовать этот параметр во время обычного переноса, так как служба репликации DFS автоматически удаляет эти параметры AD DS во время миграции из перенаправленный состояния в состояние закрыто. Так как контроллеры домена только для чтения не может удалить эти параметры из AD DS, эмулятор основного контроллера домена выполняет эту операцию, и со временем репликацию изменений на контроллеры домена только для чтения после применимо задержки для репликации active directory.<br /><br />Используйте этот параметр, чтобы вручную удалить параметры AD DS только в том случае, если автоматическое удаление происходит сбой на контроллере домена только для чтения и зависает во время перехода из состояния перенаправленный состояние Закрыто на контроллер домена только для чтения длинное ime для.|
|/deleteRoDfsrMember [< read_only_domain_controller_name >]|Удаление глобального AD DS параметров для репликации DFS, которые соответствуют указанного только для чтения контроллера домена, или удаляет глобальные параметры AD DS для репликации DFS для всех контроллеров домена только для чтения, если значение не указано для *read_only_ имя_контроллера_домена*.<br /><br />Используйте этот параметр вручную удалить настройки AD DS только в том случае, когда автоматическое удаление завершается сбоем на контроллере домена только для чтения и зависает контроллера домена только для чтения длительное время, когда откат миграции из состоянии подготовки начальное состояние.|
|/?|Отображение справки в командной строке. Аналогично выполнению **dfsrmig** без параметров.|
## <a name="remarks"></a>Примечания
-   DFSRMIG.exe, средство миграции для службы репликации DFS, входящую в состав службы репликации DFS.
    для нового сервера Windows Server 2008 Dcpromo.exe устанавливает и запускает службы репликации DFS, при повышении роли компьютера к контроллеру домена. При обновления сервера Windows Server 2003 до Windows Server 2008, процесс обновления устанавливает и запускает службу репликации DFS. Необходимо установить службу роли репликации DFS, чтобы служба репликации DFS установлена и запущена.
-   **Dfsrmig** средство поддерживается только на контроллерах домена, работающих на функциональном уровне домена Windows Server 2008, так как миграции SYSvol с FRS на DFS возможен только на контроллерах домена, которые работают на  Режим работы домена Windows Server 2008.
-   Можно запустить **dfsrmig** команду в любой контроллер домена, но операции, которые создают или управлять AD DS объекты разрешены только на контроллерах домена, поддерживающий чтения и записи (не на контроллерах домена только для чтения).
-   Под управлением **dfsrmig** без параметров отображает справку в командной строке.
## <a name="BKMK_examples"></a>Примеры
Для установки состояния миграции глобальных подготовленного (**1**) и инициировать переход на или rollback в состоянии подготовки, тип:
```
dfsrmig /SetGlobalState 1
```
Для задания глобальных миграции состояния для запуска (**0**) и инициировать откат к начальное состояние, тип:
```
dfsrmig /SetGlobalState 0
```
Чтобы отобразить состояние глобального миграции, введите следующую команду:
```
dfsrmig /GetGlobalState
```
В этом примере показаны типовые выходные данные из **dfsrmig /GetGlobalState** команды.
```
Current DFSR global state:  Prepared 
Succeeded.
```
Чтобы отобразить сведения о локальной миграции состояния на всех контроллерах домена, соответствует ли глобальный миграции состояния и состояния миграции локальных контроллеров домена, где локальное состояние не соответствует глобальное состояние, введите:
```
dfsrmig /GetMigrationState
```
В этом примере показаны типовые выходные данные из **dfsrmig /GetMigrationState** команды при миграции локального состояния на все контроллеры домена соответствуют состоянию глобального миграции.
```
All Domain Controllers have migrated successfully to Global state ( Prepared ).
Migration has reached a consistent state on all Domain Controllers.
Succeeded.
```
В этом примере показаны типовые выходные данные из **dfsrmig /GetMigrationState** команды при локальной миграции состояния на некоторые контроллеры домена соответствуют ли состояние глобального миграции.
```
The following Domain Controllers are not in sync with Global state ( Prepared ):
Domain Controller (Local Migration State)   DC type
=========
CONTOSO-DC2 ( start )   ReadOnly DC
CONTOSO-DC3 ( Preparing )   Writable DC
Migration has not yet reached a consistent state on all domain controllers
State information might be stale due to AD latency.
```
Создание глобальных объектов и параметров, которые использует репликация DFS в Доменных службах Active Directory на контроллерах домена, где эти параметры не были созданы автоматически во время миграции или там, где эти параметры не соответствуют, введите:
```
dfsrmig /createGlobalObjects
```
Чтобы удалить глобальных параметров для репликации FRS для контроллера домена только для чтения, с именем contoso-dc2, если эти параметры не были удалены, автоматически удаляются процессом миграции AD DS, введите следующую команду:
```
dfsrmig /deleteRoNtfrsMember contoso-dc2
```
Чтобы удалить глобальные параметры AD DS для репликации FRS для всех контроллеров домена только для чтения, если эти параметры не были автоматически удалены в процессе миграции, введите следующую команду:
```
dfsrmig /deleteRoNtfrsMember
```
Чтобы удалить глобальные параметры AD DS для репликации DFS для контроллера домена только для чтения, с именем contoso-dc2, если эти параметры не были автоматически удалены в процессе миграции, введите следующую команду:
```
dfsrmig /deleteRoDfsrMember contoso-dc2
```
Чтобы удалить глобальные параметры AD DS для репликации DFS для всех контроллеров домена только для чтения, если эти параметры не были автоматически удалены в процессе миграции, введите следующую команду:
```
dfsrmig /deleteRoDfsrMember
```
## <a name="additional-references"></a>Дополнительные ссылки
[Ключ синтаксиса командной строки](https://go.microsoft.com/fwlink/?LinkId=122056)

[Серия миграции SYSvol. Dfsrmig.exe часть 2: Средство миграции SYSvol](https://go.microsoft.com/fwlink/?LinkID=121757)
