---
title: dfsrmig
description: 'Раздел Windows команды для ****- '
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: manage-windows-commands
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: e1b6a464-6a93-4e66-9969-04f175226d8d
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/16/2017
ms.openlocfilehash: b2f8e3d8840be2393ba986babc6a196226c5bb52
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71378392"
---
# <a name="dfsrmig"></a>dfsrmig

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Команда `dfsrmig` переносит репликацию SYSvol из службы репликации файлов (FRS) в репликацию распределенная файловая система (DFS), предоставляет сведения о ходе выполнения миграции и изменяет объекты доменных служб Active Directory (AD DS) для поддержки миграции.
Примеры использования этой команды см. в подразделе " [примеры](#BKMK_examples) " Далее в этом документе.
## <a name="syntax"></a>Синтаксис
```
dfsrmig [/SetGlobalState <state> | /GetGlobalState | /GetMigrationState | /createGlobalObjects | 
/deleteRoNtfrsMember [<read_only_domain_controller_name>] | /deleteRoDfsrMember [<read_only_domain_controller_name>] | /?]
```
## <a name="parameters"></a>Параметры

|                         Параметр                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|-----------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|                  /Сетглобалстате <state>                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Задает требуемое глобальное состояние миграции для домена в состояние, соответствующее значению, заданному параметром *State*.<br /><br />Чтобы выполнить миграцию или процессы отката, используйте эту команду для циклического перехода между допустимыми состояниями. Этот параметр позволяет инициировать процесс миграции и управлять им, настроив глобальное состояние миграции в AD DS эмулятора основного контроллера домена. Если эмулятор основного контроллера домена недоступен, эта команда завершается с ошибкой.<br /><br /> Состояние глобального миграции можно задать в стабильном состоянии. Допустимыми значениями для *состояния*являются **0** для начального состояния, **1** для подготовленного состояния, **2** для перенаправленного состояния и **3** для исключенного состояния.<br /><br />Миграция в удаленное состояние необратима, и откат из этого состояния невозможен, поэтому используйте значение **3** для параметра *State* только при полной фиксации в использовании репликация DFS для репликации SYSvol.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
|                      /жетглобалстате                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Возвращает текущее глобальное состояние миграции для домена из локальной копии AD DS базы данных при запуске в эмуляторе основного контроллера домена.<br /><br />Используйте этот параметр, чтобы убедиться, что задано правильное состояние глобальной миграции. Только стабильные состояния миграции могут быть глобальными состояниями миграции, поэтому результаты, которые команда **Dfsrmig** сообщает с параметром **/жетглобалстате** , соответствуют состояниям, которые можно задать с помощью параметра **/сетглобалстате** .<br /><br />Команда **Dfsrmig** должна быть выполнена с параметром **/жетглобалстате** только в эмуляторе основного контроллера домена. репликация Active Directory реплицирует глобальное состояние на другие контроллеры домена в домене, но задержки репликации могут привести к несогласованности при выполнении команды **Dfsrmig** с параметром **/жетглобалстате** на контроллере домена, отличном от эмулятора PDC. Чтобы проверить состояние локальной миграции контроллера домена, отличного от эмулятора PDC, используйте параметр **/жетмигратионстате** .                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|                    /жетмигратионстате                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Извлекает текущее состояние локальной миграции для всех контроллеров домена в домене и определяет, соответствуют ли эти локальные состояния текущему глобальному состоянию миграции.<br /><br />Используйте этот параметр, чтобы определить, достигло ли все контроллеров домена состояния глобальной миграции. Выходные данные команды **дсфрмиг** при использовании параметра **/жетмигратионстате** указывают, является ли миграция к текущему глобальному состоянию завершенной, и отображает состояние локальной миграции для всех контроллеров домена, которые не достигли текущего состояния глобальной миграции. Состояние локальной миграции для контроллеров домена может включать состояния переходов для контроллеров домена, которые не достигли текущего состояния глобальной миграции.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|                   /креатеглобалобжектс                    | создает глобальные объекты и параметры в AD DS, которые репликация DFS использует.<br /><br />Не нужно использовать этот параметр во время обычного процесса миграции, так как служба репликация DFS автоматически создает эти AD DS объекты и параметры во время миграции из состояния запуска в состояние готовности. Используйте этот параметр, чтобы вручную создать эти объекты и параметры в следующих ситуациях:<br /><br />-   **новый контроллер домена только для чтения повышается во время миграции**. Репликация DFS служба автоматически создает AD DS объекты и параметры для репликация DFS во время миграции из состояния запуска в состояние готовности. Если новый контроллер домена только для чтения повышен в домене после этого перехода, но перед миграцией в удаленное состояние, объекты, соответствующие только что активированному контроллеру домена только для чтения, не создаются в AD DS причиной репликации и сбой миграции.<br />— В этом случае можно выполнить команду **Dfsrmig** , работал параметр **/креатеглобалобжектс** , чтобы вручную создать объекты на всех контроллерах домена только для чтения, в которых их еще нет. Выполнение этой команды не влияет на контроллеры домена, у которых уже есть объекты и параметры службы репликация DFS.<br />-   **глобальные параметры для службы репликация DFS отсутствуют или удалены**. Если эти параметры отсутствуют для определенного контроллера домена, миграция из состояния запуска в состояние "подготовлено" останавливается при подготовке состояния перехода для контроллера домена. В этом случае можно использовать команду **Dfsrmig** с параметром **/креатеглобалобжектс** , чтобы вручную создать параметры. **Примечание.** Поскольку глобальные параметры AD DS для службы репликация DFS для контроллера домена только для чтения создаются на эмуляторе PDC, эти параметры необходимо реплицировать на контроллер домена только для чтения из эмулятора PDC, прежде чем служба репликация DFS на контроллере домена только для чтения сможет использовать эти параметры. Из-за задержки репликации Active каталога эта репликация может занять некоторое время. |
| /Делетеронтфрсмембер [< read_only_domain_controller_name >] |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Удаляет глобальные параметры AD DS для репликации FRS, соответствующие указанному контроллеру домена только для чтения, или удаляет глобальные параметры AD DS репликации FRS для всех контроллеров домена только для чтения, если для *read_only_domain_controller_name*не указано значение.<br /><br />Не нужно использовать этот параметр во время обычного процесса миграции, так как служба репликация DFS автоматически удаляет эти параметры AD DS во время миграции из перенаправленного состояния в удаленное состояние. Так как контроллеры домена только для чтения не могут удалить эти параметры из AD DS, эмулятор основного контроллера домена выполняет эту операцию, и изменения в конечном итоге реплицируются на контроллеры домена только для чтения после подходящих задержек репликации Active Directory.<br /><br />Этот параметр используется для ручного удаления параметров AD DS только в случае сбоя автоматического удаления на контроллере домена только для чтения и зависания контроллера домена только для чтения для длительного IME во время миграции из перенаправленного состояния в удаленное состояние.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| /Делетеродфсрмембер [< read_only_domain_controller_name >]  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          Удаляет глобальные параметры AD DS для репликация DFS, соответствующих указанному контроллеру домена только для чтения, или удаляет глобальные параметры AD DS для репликация DFS для всех контроллеров домена только для чтения, если для *read_only_domain_controller_name*не указано значение.<br /><br />Используйте этот параметр, чтобы вручную удалить параметры AD DS только в случае сбоя автоматического удаления на контроллере домена только для чтения и зависания контроллера домена только для чтения в течение длительного времени при откате миграции с подготовленного состояния на состояние запуска.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|                            /?                             |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              Отображение справки в командной строке. Эквивалентно запуску **Dfsrmig** без параметров.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |

## <a name="remarks"></a>Замечания
- Dfsrmig. exe, средство миграции для службы репликация DFS, устанавливается вместе со службой репликация DFS.
  для нового сервера Windows Server 2008 программа Dcpromo. exe устанавливает и запускает службу репликация DFS при повышении уровня компьютера до контроллера домена. При обновлении сервера с Windows Server 2003 до Windows Server 2008 процесс обновления устанавливает и запускает службу репликация DFS. Чтобы служба репликация DFS была установлена и запущена, не нужно устанавливать службу роли репликация DFS.
- Средство **Dfsrmig** поддерживается только на контроллерах домена, работающих на режиме работы домена windows Server 2008, так как миграция SYSVOL с FRS на репликация DFS возможна только на контроллерах домена, работающих на режиме работы домена windows Server 2008.
- Команду **Dfsrmig** можно выполнить на любом контроллере домена, но операции, создающие или управляющие объектами AD DS, разрешены только на контроллерах домена с поддержкой чтения и записи (не на контроллерах домена только для чтения).
- Выполнение **Dfsrmig** без параметров выводит справку из командной строки.
  ## <a name="BKMK_examples"></a>Примеров
  Чтобы задать для глобального состояния миграции значение подготовлено (**1**) и инициировать миграцию или откат из подготовленного состояния, введите:
  ```
  dfsrmig /SetGlobalState 1
  ```
  Чтобы задать для глобального состояния миграции значение запуск (**0**) и начать откат до начального состояния, введите:
  ```
  dfsrmig /SetGlobalState 0
  ```
  Чтобы отобразить состояние глобальной миграции, введите:
  ```
  dfsrmig /GetGlobalState
  ```
  В этом примере показаны типичные выходные данные команды **Dfsrmig/жетглобалстате** .
  ```
  Current DFSR global state:  Prepared 
  Succeeded.
  ```
  Чтобы отобразить сведения о том, соответствуют ли локальные состояния миграции на всех контроллерах домена состоянию глобальной миграции, а также о состояниях локальной миграции для всех контроллеров домена, в которых локальное состояние не соответствует глобальному состоянию, введите:
  ```
  dfsrmig /GetMigrationState
  ```
  В этом примере показаны стандартные выходные данные команды **Dfsrmig/жетмигратионстате** , когда состояние локальной миграции на всех контроллерах домена соответствует глобальному состоянию миграции.
  ```
  All Domain Controllers have migrated successfully to Global state ( Prepared ).
  Migration has reached a consistent state on all Domain Controllers.
  Succeeded.
  ```
  В этом примере показаны стандартные выходные данные команды **Dfsrmig/жетмигратионстате** , когда состояния локальной миграции на некоторых контроллерах домена не соответствуют глобальному состоянию миграции.
  ```
    The following Domain Controllers are not in sync with Global state ( Prepared ):
    Domain Controller (Local Migration State)   DC type
    =========
    CONTOSO-DC2 ( start )   ReadOnly DC
    CONTOSO-DC3 ( Preparing )   Writable DC
    Migration has not yet reached a consistent state on all domain controllers
    State information might be stale due to AD latency.
  ```
Чтобы создать глобальные объекты и параметры, которые репликация DFS используют в AD DS на контроллерах домена, где эти параметры не были автоматически созданы во время миграции, или если эти параметры отсутствуют, введите:
```
dfsrmig /createGlobalObjects
```
Чтобы удалить глобальные параметры AD DS репликации FRS для контроллера домена только для чтения с именем Contoso-DC2, если эти параметры не были автоматически удалены процессом миграции, введите:
```
dfsrmig /deleteRoNtfrsMember contoso-dc2
```
Чтобы удалить глобальные параметры AD DS для репликации FRS для всех контроллеров домена только для чтения, если эти параметры не были автоматически удалены процессом миграции, введите:
```
dfsrmig /deleteRoNtfrsMember
```
Чтобы удалить глобальные параметры AD DS для репликация DFS контроллера домена только для чтения с именем Contoso-DC2, если эти параметры не были автоматически удалены процессом миграции, введите:
```
dfsrmig /deleteRoDfsrMember contoso-dc2
```
Чтобы удалить глобальные параметры AD DS для репликация DFS для всех контроллеров домена только для чтения, если эти параметры не были автоматически удалены процессом миграции, введите:
```
dfsrmig /deleteRoDfsrMember
```
## <a name="additional-references"></a>Дополнительные ссылки
[Условные обозначения синтаксиса команд командной строки](https://go.microsoft.com/fwlink/?LinkId=122056)

[Серия миграции SYSvol: часть 2 Dfsrmig. exe: средство миграции SYSvol](https://go.microsoft.com/fwlink/?LinkID=121757)
