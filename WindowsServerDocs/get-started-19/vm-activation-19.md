---
title: Автоматическая активация виртуальной машины
TOCTitle: Automatic VM Activation
description: Активация виртуальных машин в Windows Server 2019, Windows Server 2016 и Windows Server 2012 R2
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: server-general
ms.tgt_pltfrm: na
ms.topic: article
author: lizap
ms.author: elizapo
ms.localizationpriority: medium
ms.openlocfilehash: 43c0ce500058bd4115d58b68dc79068a52c0bb3e
ms.sourcegitcommit: b9ec35416a06854c1bc875a2b731d42a436fe313
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73956085"
---
# <a name="automatic-virtual-machine-activation"></a>Автоматическая активация виртуальной машины

> Относится к: Windows Server 2019, Semi-Annual Channel для Windows Server, Windows Server 2016, Windows Server 2012 R2

Автоматическая активация виртуальной машины (AVMA) — это механизм подтверждения законности приобретения, помогающий удостовериться, что продукты Windows используются в соответствии с правами на использование продуктов и условиями лицензионного соглашения на использование программного обеспечения корпорации Майкрософт.

AVMA позволяет устанавливать виртуальные машины на сервере с должным образом активированной ОС Windows, не настраивая ключи продукта для каждой виртуальной машины, даже в отключенных средах. Она привязывает активацию виртуальной машины к лицензированному серверу виртуализации и активирует виртуальную машину при запуске. AVMA также предоставляет отчеты по использованию в реальном времени и данные о состоянии лицензии виртуальной машины за прошлые периоды. Отчеты и данные отслеживания доступны на сервере виртуализации.

## <a name="practical-applications"></a>Практическое применение

AVMA предоставляет ряд преимуществ на серверах виртуализации, активированных с использованием корпоративного лицензирования или лицензирования OEM.

Администраторы серверов в центрах обработки данных могут использовать AVMA для выполнения следующих действий:

  - Активация виртуальных машин в удаленных расположениях

  - Активация виртуальных машин с подключением к Интернету или без него

  - Отслеживание данных об использовании и лицензиях виртуальных машин с сервера виртуализации без прав доступа к виртуализованным системам

Не требуется управлять ключами продукта и читать наклейки на серверах. Виртуальная машина активируется и продолжает работать даже при переносе в массиве серверов виртуализации.

Партнеры с лицензионным соглашением с поставщиком услуг (SPLA) и другие поставщики услуг размещения не обязаны предоставлять ключи продукта арендаторам или активировать виртуальные машины арендаторов. С помощью AVMA клиенты могут легко активировать виртуальные машины. Поставщики услуг размещения могут использовать журналы сервера для проверки соответствия лицензии и отслеживания хронологии использования клиента.

## <a name="system-requirements"></a>Системные требования

Для AVMA требуется Microsoft Virtualization Server с Windows Server 2019 Datacenter, Windows Server 2016 Datacenter или Windows Server 2012 R2. 

Ниже представлен список гостей, которых можно активировать с помощью различных версий серверов узла.

|Версия сервера узла|Windows Server 2019|Windows Server 2016|Windows Server 2012 R2|
|-|-|-|-|
|Windows Server 2019|X|X|X|
|Windows Server 2016| |X|X|
|Windows Server 2012 R2| ||X|

Обратите внимание на то, что они активируют все выпуски (Datacenter, Standard и Essentials).

Это средство не работает с другими технологиями виртуализации сервера.

## <a name="how-to-implement-avma"></a>Реализация AVMA

1.  На сервере виртуализации Windows Server Datacenter установите и настройте роль Microsoft Hyper-V Server. Дополнительную информацию см. в статье об [установке Hyper-V Server](../virtualization/hyper-v/get-started/install-the-hyper-v-role-on-windows-server.md).

2.  [Создайте виртуальную машину](../virtualization/hyper-v/get-started/create-a-virtual-machine-in-hyper-v.md) и установите на ней поддерживаемую серверную операционную систему.

3.  Установите ключ AVMA на виртуальной машине. В командной строке с повышенными привилегиями введите следующую команду:
    
    ``` 
    slmgr /ipk <AVMA_key>  
    ```

Виртуальная машина автоматически активирует лицензию в соответствии с сервером виртуализации.


> [!TIP]
> Можно также использовать ключи AVMA в любом файле установки Unattend.exe.


## <a name="avma-keys"></a>Ключи AVMA

Перечисленные ниже ключи AVMA можно использовать для Windows Server 2019.

|Выпуск|   Ключ AVMA|
|-|-|
|Datacenter|    H3RNG-8C32Q-Q8FRX-6TDXV-WMBMW|
|Standard|  TNK62-RXVTB-4P47B-2D623-4GF74|
|Essentials|    2CTP7-NHT64-BP62M-FV6GG-HFV28|
 
Перечисленные ниже ключи AVMA можно использовать для Windows Server версий 1909, 1903 и 1809.

|Выпуск|   Ключ AVMA|
|-|-|
|Datacenter|    H3RNG-8C32Q-Q8FRX-6TDXV-WMBMW|
|Standard|  TNK62-RXVTB-4P47B-2D623-4GF74|

Перечисленные ниже ключи AVMA можно использовать для Windows Server версии 1803 и 1709.

|Выпуск|Ключ AVMA|
|-|-|
|Datacenter|TMJ3Y-NTRTM-FJYXT-T22BY-CWG3J|
|Standard|C3RCX-M6NRP-6CXC9-TW2F2-4RHYD|


Перечисленные ниже ключи AVMA можно использовать для Windows Server 2016.

|Выпуск|Ключ AVMA|
|-|-|
|Datacenter|TMJ3Y-NTRTM-FJYXT-T22BY-CWG3J|
|Standard|C3RCX-M6NRP-6CXC9-TW2F2-4RHYD|
|Essentials|B4YNW-62DX9-W8V6M-82649-MHBKQ|


Перечисленные ниже ключи AVMA можно использовать для Windows Server 2012 R2.

|Выпуск|Ключ AVMA|
|-|-|
|Datacenter|Y4TGP-NPTV9-HTC2H-7MGQ3-DV4TW|
|Standard|DBGBW-NPF86-BJVTX-K3WKJ-MTB6V|
|Essentials|K2XGM-NMBT3-2R6Q8-WF2FK-P36R2|

## <a name="reporting-and-tracking"></a>Отчетность и отслеживание

Реестр (KVP) на сервере виртуализации предоставляет данные по отслеживанию в реальном времени для операционных систем на виртуальной машине. Поскольку раздел реестра перемещается вместе с виртуальной машиной, можно также получить информацию о лицензии. По умолчанию KVP возвращает данные о виртуальной машине, в том числе:

  - Полное доменное имя

  - Операционную систему и установленные пакеты обновления

  - Архитектуру процессора

  - Сетевые адреса IPv4 и IPv6

  - Адреса RDP

Дополнительные сведения о том, как получить эту информацию, см. в публикации [Hyper-V Script: Looking at KVP GuestIntrinsicExchangeItems](https://blogs.msdn.com/b/virtual_pc_guy/archive/2008/11/18/hyper-v-script-looking-at-kvp-guestintrinsicexchangeitems.aspx) (GuestIntrinsicExchangeItems KVP в скрипте Hyper-V).


> [!NOTE]
> Данные KVP не защищены. Они допускают модификации и не контролируются на предмет изменений.



> [!IMPORTANT]
> Данные KVP следует удалить в случае замены ключа AVMA другим ключом продукта (розничным, OEM или ключом корпоративного лицензирования).


Данные о запросах AVMA за прошлые периоды доступны в файле журнала на сервере виртуализации (EventID 12310).

Поскольку процесс активации AVMA прозрачен, сообщения об ошибках не отображаются. Однако данные о перечисленных ниже событиях записываются в файл журнала на виртуальных машинах (EventID 12309).

|Уведомление|Описание|
|-|-|
|AVMA успешна|Виртуальная машина активирована.|
|Недопустимый узел|Сервер виртуализации не отвечает. Это может произойти, когда на сервере не установлена поддерживаемая версия Windows.|
|Недопустимые данные|Это событие обычно возникает в результате сбоя связи между сервером виртуализации и виртуальной машиной, часто из-за повреждения, шифрования или несоответствия данных.|
|Отказано в активации|Серверу виртуализации не удалось активировать операционную систему на виртуальной машине из-за несоответствия идентификатора AVMA.|

