---
description: Дополнительные сведения см. в статье Развертывание шифрования файлов Office (демонстрация действий).
ms.assetid: 2c76e81a-c2eb-439f-a89f-7d3d70790244
title: Deploy Encryption of Office Files (Demonstration Steps)
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: dbefe3b92a1e400d525b4dc57393cc5189521d44
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "97046552"
---
# <a name="deploy-encryption-of-office-files-demonstration-steps"></a>Deploy Encryption of Office Files (Demonstration Steps)

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В финансовом отделе Contoso имеется несколько файловых серверов, которые хранят свои документы. Это может быть документация общего назначения или документация с высокой степенью важности для бизнеса (HBI). Например, любой документ, содержащий конфиденциальную информацию, считается компанией Contoso особо важным. Contoso необходимо убедиться, что все документы защищены хотя бы минимальными средствами, а особо важные документы доступны только соответствующим пользователям. Для этого компания Contoso изучает использование инфраструктуры классификации файлов (FCI) и AD RMS, доступной в Windows Server 2012. Используя FCI, компания Contoso хочет классифицировать все документы на файловом сервере в зависимости от контента, а затем с помощью службы AD RMS применить соответствующую политику прав.

В этом сценарии вы выполните следующие действия:

|Задача|Описание|
|--------|---------------|
|[Включение свойств ресурсов](Deploy-Encryption-of-Office-Files--Demonstration-Steps-.md#BKMK_1.1)|Включите свойства ресурсов **Влияние** и **Личные сведения**.|
|[Создание правил классификации](Deploy-Encryption-of-Office-Files--Demonstration-Steps-.md#BKMK_2)|Создайте следующие правила классификации: **Правило классификации HBI** и **Правило классификации PII**.|
|[Использование задач управления файлами для автоматической защиты документов с помощью службы AD RMS](Deploy-Encryption-of-Office-Files--Demonstration-Steps-.md#BKMK_3)|Создайте задачу управления файлами, которая автоматически применяет службу AD RMS для защиты документов с личными сведениями (PII). Только у членов группы FinanceAdmin будет доступ к документам с такими данными.|
|[Просмотр результатов](Deploy-Encryption-of-Office-Files--Demonstration-Steps-.md#BKMK_4)|Изучите классификацию документов и посмотрите, как она меняется при редактировании содержимого документа. Также проверьте, как документ защищает служба AD RMS.|
|[Проверка защиты службы AD RMS](Deploy-Encryption-of-Office-Files--Demonstration-Steps-.md#BKMK_5)|Убедитесь, что документ защищает служба AD RMS.|
|||

## <a name="step-1-enable-resource-properties"></a><a name="BKMK_1.1"></a>Шаг 1. Включение свойств ресурсов

#### <a name="to-enable-resource-properties"></a>Включение свойств ресурсов

1. В диспетчере Hyper-V подключитесь к серверу ID_AD_DC1. Войдите на сервер, используя Contoso\Administrator с паролем <strong>pass@word1</strong> .

2. Откройте центр администрирования Active Directory и щелкните **Представление в виде дерева**.

3. Разверните узел **Динамический контроль доступа** и выберите **Свойства ресурса**.

4. Прокрутите экран к свойству **Влияние** в столбце **Отображаемое имя**. Щелкните правой кнопкой **Влияние** и выберите **Включить**.

5. Прокрутите экран к свойству **Личные сведения** в столбце **Отображаемое имя**. Щелкните правой кнопкой мыши **Личные сведения** и выберите команду **Включить**.

6. Чтобы опубликовать свойства ресурсов в **глобальном списке ресурсов**, щелкните в левой области **Списки свойств ресурсов** и дважды щелкните **Глобальный список свойств ресурсов**.

7. Нажмите кнопку **Добавить**, а затем прокрутите экран вниз и щелкните элемент **Влияние**, чтобы добавить его в список. То же самое сделайте для элемента **Личные сведения**. Для завершения два раза нажмите кнопку **ОК**.

![Руководство по решению. ](media/Deploy-Encryption-of-Office-Files--Demonstration-Steps-/PowerShellLogoSmall.gif) * *_<em>эквивалентные команды Windows PowerShell</em>_* _

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

```
Set-ADResourceProperty -Enabled:$true -Identity:"CN=Impact_MS,CN=Resource Properties,CN=Claims Configuration,CN=Services,CN=Configuration,DC=contoso,DC=com"
Set-ADResourceProperty -Enabled:$true -Identity:"CN=PII_MS,CN=Resource Properties,CN=Claims Configuration,CN=Services,CN=Configuration,DC=contoso,DC=com"
```

## <a name="step-2-create-classification-rules"></a><a name="BKMK_2"></a>Шаг 2. Создание правил классификации
На этом шаге объясняется, как создать правило классификации "_ *высокий уровень влияния*". Это правило будет искать содержимое документов и, если строка «конфиденциально» Contoso, будет классифицировать этот документ как имеющий высокое воздействие на бизнес. Эта классификация переопределяет ранее назначенные классификации.

Кроме того, вы создадите правило **Личные сведения**. Это правило выполняет поиск в содержимом документов, и если найден номер социального страхования, документ классифицируется как содержащий личные сведения.

#### <a name="to-create-the-high-impact-classification-rule"></a>Создание правила классификации документов с высокой степенью влияния

1. В диспетчере Hyper-V подключитесь к серверу ID_AD_FILE1. Войдите на сервер, используя Contoso\Administrator с паролем <strong>pass@word1</strong> .

2. Вам необходимо обновить глобальные свойства ресурсов из Active Directory. Откройте Windows PowerShell, введите команду `Update-FSRMClassificationPropertyDefinition`, а затем нажмите клавишу ВВОД. Закройте Windows PowerShell.

3. Откройте диспетчер ресурсов файлового сервера. Чтобы открыть диспетчер ресурсов файлового сервера, нажмите кнопку **Пуск**, введите **диспетчер ресурсов файлового сервера** и щелкните **Диспетчер ресурсов файлового сервера**.

4. В левой области диспетчера ресурсов файлового сервера разверните узел **Управление классификацией** и выберите параметр **Правила классификации**.

5. На панели **Действия** щелкните **Настроить расписание классификации**. На вкладке **Автоматическая классификация** выберите элемент **Включить фиксированное расписание**, щелкните **День недели** и установите флажок **Разрешить постоянную классификацию для новых файлов**. Нажмите кнопку **ОК**.

6. На панели **Действия** щелкните **Создать правило классификации**. Откроется диалоговое окно **Создать правило классификации**.

7. В поле **Имя правила** введите **Высокая степень влияния на бизнес**.

8. В поле **Описание** введите, **Если документ имеет большое влияние на бизнес на наличие строки "конфиденциальная информация Contoso"** .

9. На вкладке **Область действия** щелкните **Задать свойства управления папками**, выберите **Использование папки**, нажмите кнопку **Добавить** и кнопку **Обзор**. Перейдите к папке D:\Finance Documents, нажмите кнопку **ОК**, а затем выберите значение свойства **Файлы группы** и нажмите кнопку **Закрыть**. После установки свойств управления на вкладке **Область действия правила** выберите **Файлы группы**.

10. Перейдите на вкладку **классификация** .  В разделе **выберите метод для назначения свойства файлам** выберите **классификатор содержимого** из раскрывающегося списка.

11. В разделе **Выберите назначаемое свойство** выберите элемент **Влияние** из раскрывающегося списка.

12. В разделе **Укажите значение** выберите элемент **Высокий** из раскрывающегося списка.

13. Щелкните **Настроить** в разделе **Параметры**.  В диалоговом окне **Параметры классификации** в списке **Тип выражения** выберите **Строка**. В поле **Выражение** введите **Contoso Confidential** и нажмите кнопку **ОК**.

14. Перейдите на вкладку **тип оценки** .  Щелкните **Повторная оценка существующих значений свойств**, щелкните **Перезаписать** существующее значение и нажмите кнопку **ОК** для завершения.

![Руководство по решению. ](media/Deploy-Encryption-of-Office-Files--Demonstration-Steps-/PowerShellLogoSmall.gif) * *_<em>эквивалентные команды Windows PowerShell</em>_* _

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

```
Update-FSRMClassificationPropertyDefinition
$date = Get-Date
$AutomaticClassificationScheduledTask = New-FsrmScheduledTask -Time $date -Weekly @(3, 2, 4, 5,1,6,0) -RunDuration 0;
Set-FsrmClassification -Continuous -schedule $AutomaticClassificationScheduledTask
New-FSRMClassificationRule -Name "High Business Impact" -Property "Impact_MS" -Description "Determines if the document has a high business impact based on the presence of the string 'Contoso Confidential'" -PropertyValue "3000" -Namespace @("D:\Finance Documents") -ClassificationMechanism "Content Classifier" -Parameters @("StringEx=Min=1;Expr=Contoso Confidential") -ReevaluateProperty Overwrite
```

#### <a name="to-create-the-high-pii-classification-rule"></a>Создание правила классификации документов с личными сведениями

1. В диспетчере Hyper-V подключитесь к серверу ID_AD_FILE1. Войдите на сервер, используя Contoso\Administrator с паролем <strong>pass@word1</strong> .

2. На рабочем столе откройте папку с именем _ * регулярные выражения * *, а затем откройте текстовый документ с именем **Regex-SSN**. Выделите и скопируйте следующую строку регулярного выражения:  **^ (?! 000) ([0-7] \d {2} | 7 ([0-7] \d | 7 [012])) ([-]?) (?! 00) \d\d\3 (?! 0000) \d {4} $**. Эта строка будет использоваться в дальнейшем, поэтому сохраните ее в буфере обмена.

3. Откройте диспетчер ресурсов файлового сервера. Чтобы открыть диспетчер ресурсов файлового сервера, нажмите кнопку **Пуск**, введите **диспетчер ресурсов файлового сервера** и щелкните **Диспетчер ресурсов файлового сервера**.

4. В левой области диспетчера ресурсов файлового сервера разверните узел **Управление классификацией** и выберите параметр **Правила классификации**.

5. На панели **Действия** щелкните **Настроить расписание классификации**. На вкладке **Автоматическая классификация** выберите элемент **Включить фиксированное расписание**, щелкните **День недели** и установите флажок **Разрешить постоянную классификацию для новых файлов**. Щелкните ОК.

6. В поле **Имя правила** введите **Личные сведения**. В поле **Описание** введите **Определяет, содержит ли документ личные сведения, в зависимости от наличия номера социального страхования**.

7. Перейдите на вкладку **Область действия** и установите флажок **Файлы группы**.

8. Перейдите на вкладку **классификация** .  В разделе **выберите метод для назначения свойства файлам** выберите **классификатор содержимого** из раскрывающегося списка.

9. В разделе **Выберите назначаемое свойство** выберите элемент **Личные сведения** из раскрывающегося списка.

10. В разделе **Укажите значение** выберите элемент **Высокий** из раскрывающегося списка.

11. Щелкните **Настроить** в разделе **Параметры**.
    На панели **Параметры классификации** в списке **Тип выражения** выберите **Регулярное выражение**. В поле **выражение** вставьте текст из буфера обмена: **^ (?! 000) ([0-7] \d {2} | 7 ([0-7] \d | 7 [012])) ([-]?) (?! 00) \d\d\3 (?! 0000) \d {4} $**, а затем нажмите кнопку **ОК**.

    > [!NOTE]
    > Это выражение допускает недопустимые номера социального страхования. Так мы сможем использовать вымышленные номера для демонстрации.

12. Перейдите на вкладку **тип оценки** .  Выберите **повторное вычисление существующих значений свойств**, **перезапишите** существующее значение и нажмите кнопку **ОК** для завершения.

![Руководство по решению. ](media/Deploy-Encryption-of-Office-Files--Demonstration-Steps-/PowerShellLogoSmall.gif) * *_<em>эквивалентные команды Windows PowerShell</em>_* _

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

```
New-FSRMClassificationRule -Name "High PII" -Description "Determines if the document has a high PII based on the presence of a Social Security Number." -Property "PII_MS" -PropertyValue "5000" -Namespace @("D:\Finance Documents") -ClassificationMechanism "Content Classifier" -Parameters @("RegularExpressionEx=Min=1;Expr=^(?!000)([0-7]\d{2}|7([0-7]\d|7[012]))([ -]?)(?!00)\d\d\3(?!0000)\d{4}$") -ReevaluateProperty Overwrite
```

Теперь у нас два правила классификации:

-   Высокий уровень влияния на бизнес

-   Личные сведения

## <a name="step-3-use-file-management-tasks-to-automatically-protect-documents-with-ad-rms"></a><a name="BKMK_3"></a>Шаг 3. Использование задач управления файлами для автоматической защиты документов с помощью службы AD RMS
Теперь, когда вы создали правила для автоматической классификации документов на основе содержимого, следующим шагом является создание задачи управления файлами, которая использует AD RMS для автоматической защиты определенных документов на основе их классификации. На этом шаге вы создадите задачу управления файлами, которая автоматически защищает все документы с личными сведениями. Только у членов группы FinanceAdmin будет доступ к документам с такими данными.

#### <a name="to-protect-documents-with-ad-rms"></a>Защита документов с помощью службы AD RMS

1. В диспетчере Hyper-V подключитесь к серверу ID_AD_FILE1. Войдите на сервер, используя Contoso\Administrator с паролем <strong>pass@word1</strong> .

2. Откройте диспетчер ресурсов файлового сервера. Чтобы открыть диспетчер ресурсов файлового сервера, нажмите кнопку _ * Пуск * *, введите **Диспетчер ресурсов файлового сервера**, а затем щелкните **файловый сервер диспетчер ресурсов**.

3. В левой области выберите элемент **Задачи управления файлами**. В области **Действия** выберите **Создать задачу управления файлами**.

4. В поле **Имя задачи:** введите **Личные сведения**. В поле **Описание** введите **Автоматическая защита RMS для документов с личными сведениями**.

5. Перейдите на вкладку **Область действия** и установите флажок **Файлы группы**.

6. Перейдите на вкладку **действие** . В разделе **тип** выберите **Шифрование RMS**. Нажмите кнопку **Обзор**, чтобы выбрать шаблон, а затем выберите шаблон **Contoso Finance Admin Only**.

7. На вкладке **Условие** нажмите кнопку **Добавить**. В разделе **Свойство** выберите **Личные сведения**. В разделе **Оператор** выберите **Равно**. В разделе **Значение** выберите элемент **Высокий**. Нажмите кнопку **ОК**.

8. Перейдите на вкладку **Расписание** . В разделе **Расписание** щелкните **еженедельно**, а затем выберите **воскресенье**. Выполнение задачи раз в неделю позволит обнаруживать все документы, которые могли быть пропущены из-за простоя службы или другого сбоя.

9. В разделе **Непрерывное выполнение** выберите **Выполнять задачу непрерывно для новых файлов**, а затем нажмите кнопку **ОК**. Вы добавили задачу управления файлами "Личные сведения".

![Руководство по решению. ](media/Deploy-Encryption-of-Office-Files--Demonstration-Steps-/PowerShellLogoSmall.gif) * *_<em>эквивалентные команды Windows PowerShell</em>_* _

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.

```
$fmjRmsEncryption = New-FSRMFmjAction -Type 'Rms' -RmsTemplate 'Contoso Finance Admin Only'
$fmjCondition1 = New-FSRMFmjCondition -Property 'PII_MS' -Condition 'Equal' -Value '5000'
$date = get-date
$schedule = New-FsrmScheduledTask -Time $date -Weekly @('Sunday')
$fmj1=New-FSRMFileManagementJob -Name "High PII" -Description "Automatic RMS protection for high PII documents" -Namespace @('D:\Finance Documents') -Action $fmjRmsEncryption -Schedule $schedule -Continuous -Condition @($fmjCondition1)
```

## <a name="step-4-view-the-results"></a><a name="BKMK_4"></a>Шаг 4. Просмотр результатов
Пора взглянуть на новую автоматическую классификацию и правила защиты AD RMS в действии. На этом шаге вы изучите классификацию документов и посмотрите, как она меняется при редактировании содержимого документа.

#### <a name="to-view-the-results"></a>Просмотр результатов

1. В диспетчере Hyper-V подключитесь к серверу ID_AD_FILE1. Войдите на сервер, используя Contoso\Administrator с паролем <strong>pass@word1</strong> .

2. В проводнике Windows перейдите к папке D:\Finance Documents.

3. Щелкните правой кнопкой мыши документ финансовое авизо и выберите пункт _ * свойства * *. Перейдите на вкладку **классификация** и обратите внимание, что у свойства воздействие в настоящее время нет значения. Щелкните **Отмена**.

4. Щелкните правой кнопкой документ **Request for Approval to Hire** и выберите пункт **Свойства**.

5. Откройте вкладку **Классификация** и обратите внимание на то, что у свойства **Личные сведения** нет значения. Щелкните **Отмена**.

6. Переключитесь на сервер CLIENT1. Выйдите из любого пользователя, выполнившего вход, а затем войдите в систему как Контосо\мреид с паролем <strong>pass@word1</strong> .

7. Откройте общую папку **Finance Documents** на рабочем столе.

8. Откройте документ **Finance Memo**. В нижней части документа вы увидите слово **Confidential**. Измените его на следующую строку: **Contoso Confidential**. Сохраните документ и закройте его.

9. Откройте документ **Request for Approval to Hire**. В разделе **Social Security#:** введите: 777-77-7777. Сохраните документ и закройте его.

    > [!NOTE]
    > Возможно, придется подождать 30 секунд до выполнения классификации.

10. Переключитесь на сервер ID_AD_FILE1. В проводнике Windows перейдите к папке D:\Finance Documents.

11. Правой кнопкой мыши щелкните документ Finance Memo и выберите пункт **Свойства**. Перейдите на вкладку **классификация** . Обратите внимание, что свойство **воздействие** теперь имеет значение **высокий**. Щелкните **Отмена**.

12. Щелкните правой кнопкой документ Request for Approval to Hire и выберите пункт **Свойства**.

13. . Перейдите на вкладку **классификация** . Обратите внимание, что свойство **личные сведения** теперь имеет значение **высокий**. Щелкните **Отмена**.

## <a name="step-5-verify-protection-with-ad-rms"></a><a name="BKMK_5"></a>Шаг 5. Проверка защиты службы AD RMS

#### <a name="to-verify-that-the-document-is-protected"></a>Проверка защиты документы

1.  Переключитесь на сервер ID_AD_CLIENT1.

2.  Откройте документ **Request for Approval to Hire**.

3.  Нажмите кнопку **ОК** , чтобы разрешить документу подключиться к серверу AD RMS.

4.  Теперь можно увидеть, что документ защищен службой AD RMS, так как он содержит номер социального страхования.


