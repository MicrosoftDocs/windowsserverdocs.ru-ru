---
ms.assetid: ee008835-7d3b-4977-adcb-7084c40e5918
title: Deploy Implementing Retention of Information on File Servers (Demonstration Steps)
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: a6b6a5d9e153949db6c89ef503b575039ec6022b
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80861217"
---
# <a name="deploy-implementing-retention-of-information-on-file-servers-demonstration-steps"></a>Deploy Implementing Retention of Information on File Servers (Demonstration Steps)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Вы может задать периоды хранения для папок и поместить файлы на удержание по юридическим причинам, используя инфраструктуру классификации файлов и диспетчер ресурсов файлового сервера.  
  
**В этом документе**  
  
-   [Предварительные условия](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_Prereqs)  
  
-   [Шаг 1. Создание определений свойств ресурсов](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_Step1)  
  
-   [Шаг 2. Настройка уведомлений](Deploy-Implementing-Retention-of-Information-on-File-Servers--Demonstration-Steps-.md#BKMK_Step2)  
  
-   [Шаг 3. Создание задачи управления файлами](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_Step3)  
  
-   [Шаг 4. Классификация файла вручную](Deploy-Implementing-Retention-of-Information-on-File-Servers--Demonstration-Steps-.md#BKMK_Step4)  
  
> [!NOTE]  
> В этом разделе приведены примеры командлетов Windows PowerShell, которые могут быть использованы для автоматизации некоторых описанных процедур. Дополнительные сведения см. в разделе [Командлеты](https://go.microsoft.com/fwlink/p/?linkid=230693).  
  
## <a name="prerequisites"></a>Предварительные требования  
В этом разделе предполагается, что SMTP-сервер настроен для отправки уведомлений об окончания срока действия файла.  
  
## <a name="step-1-create-resource-property-definitions"></a><a name="BKMK_Step1"></a>Шаг 1. Создание определений свойств ресурсов  
На этом шаге мы включим свойства ресурса "Период хранения" и "Обнаруживаемость", чтобы инфраструктура классификации файлов могла их использовать для маркировки файлов, которые проверяются в общей сетевой папке.  
  
[Выполните этот шаг с помощью Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep1)  
  
#### <a name="to-create-resource-property-definitions"></a>Создание определений свойств ресурсов  
  
1.  На контроллере домена войдите на сервер как член группы безопасности "Администраторы домена".  
  
2.  Откройте центр администрирования Active Directory. В диспетчере серверов откройте меню **Сервис** и щелкните **Центр администрирования Active Directory**.  
  
3.  Разверните узел **Динамический контроль доступа** и выберите **Свойства ресурса**.  
  
4.  Щелкните правой кнопкой мыши элемент **Период хранения** и выберите команду **Включить**.  
  
5.  Щелкните правой кнопкой **Обнаруживаемость** и выберите **Включить**.  
  
![решения,](media/Deploy-Implementing-Retention-of-Information-on-File-Servers--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  
  
Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет на отдельной строке. Они могут отображаться с переносом на несколько строк из-за ограничений форматирования.  
  
```  
Set-ADResourceProperty -Enabled:$true -Identity:'CN=RetentionPeriod_MS,CN=Resource Properties,CN=Claims Configuration,CN=Services,CN=Configuration,DC=contoso,DC=com'  
Set-ADResourceProperty -Enabled:$true -Identity:'CN=Discoverability_MS,CN=Resource Properties,CN=Claims Configuration,CN=Services,CN=Configuration,DC=contoso,DC=com'  
```  
  
## <a name="step-2-configure-notifications"></a><a name="BKMK_Step2"></a>Шаг 2. Настройка уведомлений  
На этом шаге мы используем консоль диспетчера ресурсов файлового сервера, чтобы настроить SMTP-сервер, адрес электронной почты администратора по умолчанию и адрес электронной почты по умолчанию, с которого отправляются отчеты.  
  
[Выполните этот шаг с помощью Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep2)  
  
#### <a name="to-configure-notifications"></a>Настройка уведомлений  
  
1.  Войдите на файловый сервер от имени члена локальной группы безопасности "Администраторы".  
  
2.  В командной строке Windows PowerShell введите команду **Update-FsrmClassificationPropertyDefinition** и нажмите клавишу ВВОД. Эта команда синхронизирует определения свойств, созданные на контроллере домена, с файловым сервером.  
  
3.  Откройте диспетчер ресурсов файлового сервера. В диспетчере серверов откройте меню **Сервис** и щелкните **Диспетчер ресурсов файлового сервера**.  
  
4.  Щелкните правой кнопкой элемент **Диспетчер ресурсов файлового сервера (локальный)** и выберите команду **Настроить параметры**.  
  
5.  На вкладке **Уведомления по электронной почте** выполните следующие действия.  
  
    -   В поле **Имя или IP-адрес SMTP-сервера** введите имя SMTP-сервера в вашей сети.  
  
    -   В поле **Администраторы-получатели по умолчанию** введите адрес электронной почты администратора, который будет получать уведомления.  
  
    -   В поле **адрес электронной почты по умолчанию** введите адрес электронной почты, который будет использоваться для отправки уведомлений.  
  
6.  Нажмите кнопку **ОК**.  
  
![решения,](media/Deploy-Implementing-Retention-of-Information-on-File-Servers--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  
  
Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет на отдельной строке. Они могут отображаться с переносом на несколько строк из-за ограничений форматирования.  
  
```  
Set-FsrmSetting -SmtpServer IP address of SMTP server -FromEmailAddress "FromEmailAddress" -AdminEmailAddress "AdministratorEmailAddress"  
```  
  
## <a name="step-3-create-a-file-management-task"></a><a name="BKMK_Step3"></a>Шаг 3. Создание задачи управления файлами  
На этом шаге мы используем консоль диспетчера ресурсов файлового ресурса, чтобы создать задачу управления файлами, которая будет выполняться в последний день месяца и прекращать срок действия файлов, соответствующих следующим критериям:  
  
-   файл не классифицирован как удерживающийся по юридическим причинам;  
  
-   файл классифицирован как файл с долгосрочным периодом хранения;  
  
-   файл изменялся в течение 10 лет.  
  
[Выполните этот шаг с помощью Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep3)  
  
#### <a name="to-create-a-file-management-task"></a>Создание задачи управления файлами  
  
1.  Войдите на файловый сервер от имени члена локальной группы безопасности "Администраторы".  
  
2.  Откройте диспетчер ресурсов файлового сервера. В диспетчере серверов откройте меню **Сервис** и щелкните **Диспетчер ресурсов файлового сервера**.  
  
3.  Щелкните **Задачи управления файлами** правой кнопкой мыши, а затем выберите команду **Создать задачу управления файлами**.  
  
4.  На вкладке **Общие** в поле **Имя задачи** введите имя задачи управления файлами, например "Задача хранения".  
  
5.  На вкладке **Область действия** нажмите кнопку **Добавить** и выберите папки, которые необходимо включить в это правило, например D:\Finance Documents.  
  
6.  На вкладке **Действие** в поле **Тип** введите **Истечение срока действия файла**. В поле **Каталог истечения срока** введите путь к папке на локальном файловом сервере, на который будут перемещены просроченные файлы. Для этой папки должен быть задан список управления доступом, который предоставляет доступ только администраторам файлового сервера.  
  
7.  На вкладке **Уведомления** нажмите кнопку **Добавить**.  
  
    -   Установите флажок **Отправить сообщение электронной почты следующим администраторам**.  
  
    -   Установите флажок **Отправить письмо пользователям, чьи файлы затрагиваются** и нажмите кнопку **ОК**.  
  
8.  На вкладке **Условие** нажмите кнопку **Добавить**, а затем добавьте следующие свойства:  
  
    -   В списке **Свойство** выберите **Обнаруживаемость**. В списке **Оператор** щелкните **Не равно**. В списке **Значение** выберите **Удержание**.  
  
    -   В списке **Свойство** выберите **Период хранения**. В списке **Оператор** щелкните **Равно**. В списке **Значение** выберите **Долгосрочное**.  
  
9. На вкладке **Условие** установите флажок **Число дней после последнего изменения файла** и задайте значение **3650**.  
  
10. На вкладке **Расписание** щелкните параметр **Ежемесячно** и установите флажок **Последний**.  
  
11. Нажмите кнопку **ОК**.  
  
![решения,](media/Deploy-Implementing-Retention-of-Information-on-File-Servers--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  
  
Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет на отдельной строке. Они могут отображаться с переносом на несколько строк из-за ограничений форматирования.  
  
```  
$fmjexpiration = New-FSRMFmjAction -Type 'Expiration' -ExpirationFolder folder  
$fmjNotificationAction = New-FsrmFmjNotificationAction -Type Email -MailTo "[FileOwner],[AdminEmail]"  
$fmjNotification = New-FsrmFMJNotification -Days 10 -Action @($fmjNotificationAction)  
$fmjCondition1 = New-FSRMFmjCondition -Property 'Discoverability_MS' -Condition 'NotEqual' -Value "Hold" 
$fmjCondition2 = New-FSRMFmjCondition -Property 'RetentionPeriod_MS' -Condition 'Equal' -Value "Long-term"  
$fmjCondition3 = New-FSRMFmjCondition -Property 'File.DateLastAccessed' -Condition 'Equal' -Value 3650  
$date = get-date  
$schedule = New-FsrmScheduledTask -Time $date -Monthly @(-1)    
$fmj1=New-FSRMFileManagementJob -Name "Retention Task" -Namespace @('D:\Finance Documents') -Action $fmjexpiration -Schedule $schedule -Notification @($fmjNotification) -Condition @( $fmjCondition1, $fmjCondition2, $fmjCondition3)  
```  
  
## <a name="step-4-classify-a-file-manually"></a><a name="BKMK_Step4"></a>Шаг 4. Классификация файла вручную  
На этом шаге мы вручную классифицируем файл как удерживаемый по юридическим причинам. Родительская папка этого файла будет классифицирована как папка с долгосрочным периодом хранения.  
  
#### <a name="to-manually-classify-a-file"></a>Классификация файла вручную  
  
1.  Войдите на файловый сервер от имени члена локальной группы безопасности "Администраторы".  
  
2.  Перейдите к папке, которая настроена в области действия задачи управления файлами, созданной на шаге 3.  
  
3.  Щелкните правой кнопкой мыши папку, затем щелкните **Свойства**.  
  
4.  На вкладке **Классификация** щелкните **Период хранения**, выберите **Долгосрочное** и нажмите кнопку **ОК**.  
  
5.  Щелкните правой кнопкой мыши файл в этой папке и выберите пункт **Свойства**.  
  
6.  На вкладке **Классификация** щелкните **Обнаруживаемость**, выберите **Удерживание** и нажмите кнопки **Применить** и **ОК**.  
  
7.  На файловом сервере выполните задачу управления файлами, используя консоль диспетчера ресурсов файлового ресурса. После завершения задачи управления файлами проверьте папку и убедитесь, что файл не перемещен в каталог истечения срока.  
  
8.  Щелкните правой кнопкой мыши тот же файл в этой папке и выберите пункт **Свойства**.  
  
9. На вкладке **Классификация** щелкните **Обнаруживаемость**, выберите **Неприменимо** и нажмите кнопки **Применить** и **ОК**.  
  
10. На файловом сервере еще раз выполните задачу управления файлами, используя консоль диспетчера ресурсов файлового ресурса. После завершения задачи управления файлами проверьте папку и убедитесь, что файл перемещен в каталог истечения срока.  
  
## <a name="see-also"></a><a name="BKMK_Links"></a> См. также  
  
-   [Сценарий: реализация хранения информации на файловых серверах](Scenario--Implement-Retention-of-Information-on-File-Servers.md)  
  
-   [Планирование хранения информации на файловых серверах](assetId:///edf13190-7077-455a-ac01-f534064a9e0c)  
  
-   [Динамический контроль доступа: обзор сценария](Dynamic-Access-Control--Scenario-Overview.md)  
  

