---
ms.assetid: b035e9f8-517f-432a-8dfb-40bfc215bee5
title: "Развертывание помощи при отказе в доступе (Поэтапная Демонстрация)"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 5201441ba884fe4658b917919e60c7d20530341b
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="deploy-access-denied-assistance-demonstration-steps"></a>Развертывание помощи при отказе в доступе (Поэтапная Демонстрация)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе объясняется, как настроить помощь при отказе в доступе, и убедитесь, что он работает должным образом.  
  
**В этом документе**  
  
-   [Шаг 1: Настройка помощи при отказе в доступе](Deploy-Access-Denied-Assistance--Demonstration-Steps-.md#BKMK_1)  
  
-   [Шаг 2: Настройка параметров уведомлений по электронной почте](Deploy-Access-Denied-Assistance--Demonstration-Steps-.md#BKMK_2)  
  
-   [Шаг 3: Проверка правильности настройки помощи при отказе в доступе](Deploy-Access-Denied-Assistance--Demonstration-Steps-.md#BKMK_3)  
  
> [!NOTE]  
> Этот раздел содержит пример командлеты Windows PowerShell, который можно использовать для автоматизации некоторых описанных процедур. Дополнительные сведения см. в разделе [использование командлетов](https://go.microsoft.com/fwlink/p/?linkid=230693).  
  
## <a name="BKMK_1"></a>Шаг 1: Настройка помощи при отказе в доступе  
Можно настроить отказом в доступе в домене с помощью групповой политики, или можно настроить помощь по отдельности на каждом файловом сервере с помощью консоли диспетчера ресурсов файлового сервера. Можно также изменить сообщение Отказано в доступе для определенной общей папки на файловом сервере.  
  
Можно настроить помощь при отказе в доступе для домена с помощью групповой политики следующим образом:  
  
[Do this step using Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep1)  
  
#### <a name="to-configure-access-denied-assistance-by-using-group-policy"></a>Настройка помощи при отказе в доступе с помощью групповой политики  
  
1.  Откройте Управление групповой политикой. В диспетчере серверов щелкните **средства**, а затем нажмите кнопку **Управление групповой политикой**.  
  
2.  Щелкните правой кнопкой мыши нужную групповую политику, а затем нажмите кнопку **изменить**.  
  
3.  Нажмите кнопку **Конфигурация компьютера**, нажмите кнопку **политики**, нажмите кнопку **административные шаблоны**, нажмите кнопку **системы**, а затем нажмите кнопку **помощь при отказе в доступе**.  
  
4.  Щелкните правой кнопкой мыши **настроить сообщение для ошибок отказа в доступе**, а затем нажмите кнопку **изменить**.  
  
5.  Выберите **включено** параметр.  
  
6.  Настройте следующие параметры:  
  
    1.  В **отображать следующее сообщение пользователям, отказано в доступе** введите сообщение, которое будут видеть пользователи, если им отказано в доступе к файлу или папке.  
  
        Можно добавить макрос сообщения, который будет вставлять настраиваемый текст. Этот макрос содержит:  
  
        -   **[Original File Path] **Исходный путь к файлу, который выполнялся пользователем.  
  
        -   **[Original File Path Folder] **Родительская папка исходного пути к файлу обращался пользователь.  
  
        -   **[Адрес электронной почты администратора] **Список получателей электронной почты администратора.  
  
        -   **[Data Owner Email] **Список получателей электронной почты владельца данных.  
  
    2.  Выберите **позволяют пользователям запрашивать помощь** флажок.  
  
    3.  Оставьте для оставшихся параметров по умолчанию.  
  
![руководства по решениям](media/Deploy-Access-Denied-Assistance--Demonstration-Steps-/PowerShellLogoSmall.gif)Windows PowerShell эквивалентные команды ***  
  
Следующий командлет Windows PowerShell или командлеты выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет в отдельной строке, несмотря на то, что они могут отображаться по здесь несколько строк словам из-за ограничений форматирования.  
  
```  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName AllowEmailRequests -Type DWORD -value 1  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName GenerateLog -Type DWORD -value 1  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName IncludeDeviceClaims -Type DWORD -value 1  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName IncludeUserClaims -Type DWORD -value 1  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName PutAdminOnTo -Type DWORD -value 1  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName PutDataOwnerOnTo -Type DWORD -value 1  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName ErrorMessage -Type MultiString -value "Type the text that the user will see in the error message dialog box."  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\Software\Policies\Microsoft\Windows\ADR\AccessDenied" -ValueName Enabled -Type DWORD -value 1 
  
```  
  
Кроме того вы можно настроить помощь при отказе в доступе отдельно для каждого файлового сервера с помощью консоли диспетчера ресурсов файлового сервера.  
  
[Do this step using Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep1a)  
  
#### <a name="to-configure-access-denied-assistance-by-using-file-server-resource-manager"></a>Настройка помощи при отказе в доступе с помощью диспетчера ресурсов файлового сервера  
  
1.  Откройте диспетчер ресурсов файлового сервера. In Server Manager, click **Tools**, and then click **File Server Resource Manager**.  
  
2.  Щелкните правой кнопкой мыши **диспетчера ресурсов файлового сервера (локальный)**, а затем нажмите кнопку **настроить параметры**.  
  
3.  Нажмите кнопку **помощь при отказе в доступе** вкладку.  
  
4.  Выберите **включить помощь при отказе в доступе** флажок.  
  
5.  В **отображать следующее сообщение пользователям, которым запрещен доступ к папке или файлу** введите сообщение, которое будут видеть пользователи, если им отказано в доступе к файлу или папке.  
  
    Можно добавить макрос сообщения, который будет вставлять настраиваемый текст. Этот макрос содержит:  
  
    -   **[Original File Path] **Исходный путь к файлу, который выполнялся пользователем.  
  
    -   **[Original File Path Folder] **Родительская папка исходного пути к файлу обращался пользователь.  
  
    -   **[Адрес электронной почты администратора] **Список получателей электронной почты администратора.  
  
    -   **[Data Owner Email] **Список получателей электронной почты владельца данных.  
  
6.  Нажмите кнопку **настроить запросы по электронной почте**выберите **позволяют пользователям запрашивать помощь** флажок и нажмите кнопку **ОК**.  
  
7.  Нажмите кнопку **Preview** Если вы хотите увидеть, как сообщение об ошибке будет отображаться для пользователя.  
  
8.  Нажмите кнопку **ОК**.  
  
![руководства по решениям](media/Deploy-Access-Denied-Assistance--Demonstration-Steps-/PowerShellLogoSmall.gif)Windows PowerShell эквивалентные команды ***  
  
Следующий командлет Windows PowerShell или командлеты выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет в отдельной строке, несмотря на то, что они могут отображаться по здесь несколько строк словам из-за ограничений форматирования.
  
```  
Set-FSRMAdrSetting -Event "AccessDenied" -DisplayMessage "Type the text that the user will see in the error message dialog box." -Enabled:$true -AllowRequests:$true  
```  
  
После настройки помощи при отказе в доступе необходимо включить для всех типов файлов с помощью групповой политики.  
  
[Do this step using Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep1c)  
  
#### <a name="to-configure-access-denied-assistance-for-all-file-types-by-using-group-policy"></a>Настройка помощи при отказе в доступе для всех типов файлов с помощью групповой политики  
  
1.  Откройте Управление групповой политикой. В диспетчере серверов щелкните **средства**, а затем нажмите кнопку **Управление групповой политикой**.  
  
2.  Щелкните правой кнопкой мыши нужную групповую политику, а затем нажмите кнопку **изменить**.  
  
3.  Нажмите кнопку **Конфигурация компьютера**, нажмите кнопку **политики**, нажмите кнопку **административные шаблоны**, нажмите кнопку **системы**, а затем нажмите кнопку **помощь при отказе в доступе**.  
  
4.  Щелкните правой кнопкой мыши **включить помощь при отказе в доступе на клиенте для всех типов файлов**, а затем нажмите кнопку **изменить**.  
  
5.  Нажмите кнопку **включено**, а затем нажмите кнопку **ОК**.  
  
![руководства по решениям](media/Deploy-Access-Denied-Assistance--Demonstration-Steps-/PowerShellLogoSmall.gif)Windows PowerShell эквивалентные команды ***  
  
Следующий командлет Windows PowerShell или командлеты выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет в отдельной строке, несмотря на то, что они могут отображаться по здесь несколько строк словам из-за ограничений форматирования. 
  
```  
Set-GPRegistryValue -Name "Name of GPO" -key "HKLM\SOFTWARE\Policies\Microsoft\Windows\Explore" -ValueName EnableShellExecuteFileStreamCheck -Type DWORD -value 1  
  
```  
  
Можно также указать отдельное сообщение Отказано в доступе для каждой общей папки на файловом сервере с помощью консоли диспетчера ресурсов файлового сервера.  
  
[Do this step using Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep1b)  
  
#### <a name="to-specify-a-separate-access-denied-message-for-a-shared-folder-by-using-file-server-resource-manager"></a>Чтобы указать отдельное сообщение при отказе в доступе для общей папки с помощью диспетчера ресурсов файлового сервера  
  
1.  Откройте диспетчер ресурсов файлового сервера. In Server Manager, click **Tools**, and then click **File Server Resource Manager**.  
  
2.  Разверните **диспетчера ресурсов файлового сервера (локальный)**, а затем нажмите кнопку **управление классификацией**.  
  
3.  Щелкните правой кнопкой мыши **свойства классификации**, а затем нажмите кнопку **задать свойства управления папками**.  
  
4.  В **свойство** выберите **сообщение для помощи при отказе в доступе**, а затем нажмите кнопку **добавить**.  
  
5.  Нажмите кнопку **Обзор**, а затем выберите папку, в которой будет использоваться настраиваемое сообщение Отказано в доступе.  
  
6.  В **значение** введите сообщение, которое будут видеть пользователи при запрете доступа к ресурсу в этой папке.  
  
    Можно добавить макрос сообщения, который будет вставлять настраиваемый текст. Этот макрос содержит:  
  
    -   **[Original File Path] **Исходный путь к файлу, который выполнялся пользователем.  
  
    -   **[Original File Path Folder] **Родительская папка исходного пути к файлу обращался пользователь.  
  
    -   **[Адрес электронной почты администратора] **Список получателей электронной почты администратора.  
  
    -   **[Data Owner Email] **Список получателей электронной почты владельца данных.  
  
7.  Нажмите кнопку **ОК**, а затем нажмите кнопку **закрыть**.  
  
![руководства по решениям](media/Deploy-Access-Denied-Assistance--Demonstration-Steps-/PowerShellLogoSmall.gif)Windows PowerShell эквивалентные команды ***  
  
Следующий командлет Windows PowerShell или командлеты выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет в отдельной строке, несмотря на то, что они могут отображаться по здесь несколько строк словам из-за ограничений форматирования. 
  
```  
Set-FSRMMgmtProperty -Namespace "folder path" -Name "AccessDeniedMessage_MS" -Value "Type the text that the user will see in the error message dialog box."  
```  
  
## <a name="BKMK_2"></a>Шаг 2: Настройка параметров уведомлений по электронной почте  
Параметры уведомлений по электронной почте необходимо настроить на каждом файловом сервере, который будет отправлять сообщения для помощи при отказе в доступе.  
  
[Do this step using Windows PowerShell](assetId:///4a96cdaf-0081-4824-aab8-f0d51be501ac#BKMK_PSstep2)  
  
1.  Откройте диспетчер ресурсов файлового сервера. In Server Manager, click **Tools**, and then click **File Server Resource Manager**.  
  
2.  Щелкните правой кнопкой мыши **диспетчера ресурсов файлового сервера (локальный)**, а затем нажмите кнопку **настроить параметры**.  
  
3.  Нажмите кнопку **уведомления по электронной почте** вкладку.  
  
4.  Настройте следующие параметры:  
  
    -   В **имя SMTP-сервера или IP-адрес** введите имя IP-адрес SMTP-сервера в вашей организации.  
  
    -   В **Администраторы-получатели по умолчанию** и **по умолчанию адрес электронной почты из** введите адрес электронной почты администратора файлового сервера.  
  
5.  Нажмите кнопку **отправить проверочное сообщение электронной почты** помогут правильно настроить уведомления по электронной почте.  
  
6.  Нажмите кнопку **ОК**.  
  
![руководства по решениям](media/Deploy-Access-Denied-Assistance--Demonstration-Steps-/PowerShellLogoSmall.gif)Windows PowerShell эквивалентные команды ***  
  
Следующий командлет Windows PowerShell или командлеты выполняют ту же функцию, что и предыдущая процедура. Введите каждый командлет в отдельной строке, несмотря на то, что они могут отображаться по здесь несколько строк словам из-за ограничений форматирования.
  
```  
set-FSRMSetting -SMTPServer "server1" -AdminEmailAddress "fileadmin@contoso.com" -FromEmailAddress "fileadmin@contoso.com"  
```  
  
## <a name="BKMK_3"></a>Шаг 3: Проверка правильности настройки помощи при отказе в доступе  
Можно проверить, правильно настройки помощи при отказе в доступе, попросив пользователя, который работает под управлением Windows 8 пытаются получить доступ к общей папке или к файлу в этой папке, что у пользователя нет доступа к. Когда появится сообщение Отказано в доступе, пользователь увидит **запрос помощи** кнопки. После нажатия кнопки запросить помощь, пользователь может указать обоснование доступа и отправить сообщение электронной почты владельцу папки или администратору файлового сервера. Владелец папки или администратору файлового сервера могут проверить, пришло ли сообщение и содержит ли оно необходимые сведения.  
  
> [!IMPORTANT]  
> Если вы хотите проверить помощь при отказе в доступе, попросив пользователя, под управлением Windows Server 2012, необходимо установить возможности рабочего стола перед подключением к общему файловому ресурсу.  
  
## <a name="BKMK_Links"></a>См. также:  
  
-   [Сценарий: Помощь при отказе в доступе](Scenario--Access-Denied-Assistance.md)  
  
-   [План помощи при отказе в доступе](assetId:///b169f0a4-8b97-4da8-ae4a-c8f1986d19e1)  
  
-   [Динамического контроля доступа: Обзор сценария](Dynamic-Access-Control--Scenario-Overview.md)  
  

