---
ms.assetid: 8738c03d-6ae8-49a7-8b0c-bef7eab81057
title: Развертывание централизованной политики доступа (демонстрация последовательности действий)
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: 09b7edcd843dfe65d7e2391612f029cf18b633ec
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71357496"
---
# <a name="deploy-a-central-access-policy-demonstration-steps"></a>Развертывание централизованной политики доступа (демонстрация последовательности действий)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом сценарии группа безопасности финансового отдела работает с центральным отделом безопасности, чтобы определить потребность в централизованной политике доступа и защитить архивные финансовые данные на файловых серверах. Доступ для чтения к архивным финансовым данным из каждой страны могут получить только финансисты из той же страны. Центральная группа администраторов может получать доступ к финансовым данным из любой страны.  

Развертывание централизованной политики доступа состоит из следующих этапов:  

|Этап|Описание  
|---------|---------------  
|[План: Указание необходимости в политике и конфигурации, необходимой для развертывания](Deploy-a-Central-Access-Policy--Demonstration-Steps-.md#BKMK_1.2)|Определение необходимости в политике и конфигурации для развертывания. 
|[Реализация: Настройка компонентов и политики](Deploy-a-Central-Access-Policy--Demonstration-Steps-.md#BKMK_1.3)|Настройка компонентов и политики.  
|[Развертывание централизованной политики доступа](Deploy-a-Central-Access-Policy--Demonstration-Steps-.md#BKMK_1.4)|Развертывание политики.  
|[Обслуживание: изменение и размещение политики](Deploy-a-Central-Access-Policy--Demonstration-Steps-.md#BKMK_1.5)|Изменения политик и промежуточное хранение. 

## <a name="BKMK_1.1"></a>Настройка тестовой среды  
Прежде чем приступать, вам необходимо настроить лабораторию для тестирования этого сценария. Шаги по настройке лаборатории подробно описаны в [приложении б: Настройка тестовой среды](Appendix-B--Setting-Up-the-Test-Environment.md).  

## <a name="BKMK_1.2"></a>План: Указание необходимости в политике и конфигурации, необходимой для развертывания  
В этом разделе представлено высокоуровневое описание планирования развертывания.  

||Шаг|Пример|  
|-|--------|-----------|  
|1.1|Компания решает, что необходима централизованная политика доступа|Для защиты финансовых данных на файловых серверах группа безопасности финансового отдела вместе с центральным отделом безопасности определяет потребность в централизованной политике доступа.|  
|1.2|Выражение политики доступа|Финансовые документы должны быть доступны для чтения только сотрудникам финансового отдела. Сотрудники финансового отдела должны получать доступ к документам только в своей стране. Только у администраторов финансового отдела есть доступ для записи. Исключение предоставляется членам группы FinanceException. Эта группа обладает правами для чтения.|  
|1.3|Выразить политику доступа в конструкциях Windows Server 2012|Цель:<br /><br />-Resource. Department содержит финансовый отдел<br /><br />Правила доступа:<br /><br />— Разрешить чтение пользователя. страна = ресурс. страна и пользователь. штат = ресурс. Отдел<br />-Разрешить полный доступ User. MemberOf (Финанцеадмин)<br /><br />Исключение:<br /><br />Allow read memberOf(FinanceException)|  
|1.4|Определение свойств файла, необходимых для политики|Отметьте файлы как:<br /><br />— Отдел<br />-Country|  
|1.5|Определение типов утверждений и групп, необходимых для политики|Типы утверждений:<br /><br />-Country<br />— Отдел<br /><br />Группы пользователей<br /><br />-Финанцеадмин<br />-Финанцеексцептион|  
|1.6|Определение серверов, к которым следует применить эту политику|Примените политику.|  

## <a name="BKMK_1.3"></a>Реализация: Настройка компонентов и политики  
В этом разделе представлен пример, который развертывает централизованную политику доступа для финансовых документов.  

|Нет|Шаг|Пример|  
|------|--------|-----------|  
|2.1|Создание типов утверждений|Создайте следующие типы утверждений:<br /><br />— Отдел<br />-Country|  
|2.2|Создание свойства ресурсов|Создайте и включите следующие свойства ресурсов:<br /><br />— Отдел<br />-Country|  
|2.3|Настройка правила централизованного доступа|Создайте правило "Финансовые документы", которое содержит политику, определенную в предыдущем разделе.|  
|2.4|Настройка централизованной политики доступа (CAP)|Создайте централизованную политику доступа с именем "Финансовая политика" и добавьте в нее правило "Финансовые документы".|  
|2.5|Применение централизованной политики доступа к файловым серверам|Опубликуйте политики "Финансовая политика" на файловых серверах.|  
|2.6|Включите поддержку KDC для утверждений, комплексной проверки подлинности и защиты Kerberos.|Включите поддержку KDC для утверждений, комплексной проверки подлинности и защиты Kerberos для contoso.com.|  

В следующей процедуре создаются два типа утверждений: Country и Department.  

#### <a name="to-create-claim-types"></a>Создание типов утверждений  

1. Откройте сервер DC1 в диспетчере Hyper-V и войдите в систему как CONTOSO\Administrator с паролем <strong>pass@word1</strong>.  

2. Откройте центр администрирования Active Directory.  

3. Щелкните значок **древовидного представления**, разверните узел **Динамический контроль доступа** и выберите **Типы утверждений**.  

   Щелкните правой кнопкой **Типы утверждений**, выберите **Создать**, а затем щелкните **Тип утверждения**.  

   > [!TIP]  
   > Окно **создания типа утверждения** также можно открыть в панели **Задачи**. На панели **Задачи** выберите **Создать** и щелкните **Тип утверждения**.  

4. Прокрутите список **Исходный атрибут** вниз и щелкните **отдел**. После этого в поле **Отображаемое имя** появится **отдел**. Нажмите кнопку **ОК**.  

5. На панели **Задачи** выберите **Создать** и щелкните **Тип утверждения**.  

6. Прокрутите список **Исходный атрибут** вниз и щелкните атрибут **c** (Country-Name). В поле **Отображаемое имя** введите **страна**.  

7. В разделе **Предложенные значения** выберите **Предлагаются следующие значения:** и нажмите кнопку **Добавить**.  

8. В полях **Значение** и **Отображаемое имя** введите **US** и нажмите кнопку **ОК**.  

9. Повторите указанное выше действие. В диалоговом окне **Добавление предложенного значения** введите **JP** в полях **Значение** и **Отображаемое имя**, а затем нажмите кнопку **ОК**.  

![решения,](media/Deploy-a-Central-Access-Policy--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.  


    New-ADClaimType country -SourceAttribute c -SuggestedValues:@((New-Object Microsoft.ActiveDirectory.Management.ADSuggestedValueEntry("US","US","")), (New-Object Microsoft.ActiveDirectory.Management.ADSuggestedValueEntry("JP","JP","")))  
    New-ADClaimType department -SourceAttribute department  



> [!TIP]  
> Вы можете использовать средство просмотра журнала Windows PowerShell в центре администрирования Active Directory для поиска командлетов Windows PowerShell для каждой процедуры, выполняемой в центре администрирования Active Directory. Дополнительные сведения см. в разделе [средство просмотра журнала Windows PowerShell](https://technet.microsoft.com/library/hh831702) .  

Следующий шаг — создание свойств ресурсов. В следующей процедуре вы создадите свойство ресурса, которое автоматически добавляется в список глобальных свойств ресурсов на контроллере домена, чтобы он был доступен на файловом сервере.  

#### <a name="to-create-and-enable-pre-created-resource-properties"></a>Создание и включение предварительно созданных свойств ресурсов  

1.  В левой области центра администрирования Active Directory щелкните **Представление в виде дерева**. Разверните узел **Динамический контроль доступа** и выберите **Свойства ресурса**.  

2.  Щелкните правой кнопкой **Свойства ресурса**, выберите **Создать**, а затем щелкните **Свойство ссылочного ресурса**.  

    > [!TIP]  
    > Вы также можете выбрать свойство ресурса на панели **Задачи**. Нажмите **Создать** и щелкните **Свойство ссылочного ресурса**.  

3.  В разделе **Выбор типа утверждения для использования списка предложенных значений** щелкните **страна**.  

4.  В поле **Отображаемое имя** введите **страна** и нажмите кнопку **OK**.  

5.  Дважды щелкните список **Свойства ресурса** и прокрутите список вниз до свойства **Отдел**. Щелкните правой кнопкой и выберите **Включить**. После этого будет включено свойство ресурса **Отдел**.  

6.  В списке **Свойства ресурса** в области навигации центра администрирования Active Directory теперь будет представлено два активных свойства ресурса:  

    -   Страна  

    -   Отдел  

![решения,](media/Deploy-a-Central-Access-Policy--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.  

```  
New-ADResourceProperty Country -IsSecured $true -ResourcePropertyValueType MS-DS-MultivaluedChoice -SharesValuesWith country  
Set-ADResourceProperty Department_MS -Enabled $true  
Add-ADResourcePropertyListMember "Global Resource Property List" -Members Country  
Add-ADResourcePropertyListMember "Global Resource Property List" -Members Department_MS  

```  

Следующий шаг — создание централизованных правил доступа, которые определяют, кто может получить доступ к ресурсам. В этом сценарии используются следующие бизнес-правила:  

-   Финансовые документы доступны для чтения только сотрудникам финансового отдела.  

-   Сотрудники финансового отдела могут получить доступ к документам только в своей стране.  

-   Только у администраторов финансового отдела есть доступ для записи.  

-   Исключение предоставляется членам группы FinanceException. Эта группа обладает правами для чтения.  

-   Администратор и владелец документа обладают полным доступом.  

Или для выражения правил с помощью конструкций Windows Server 2012:  

Нацеленность: Resource. Department содержит сведения о финансах  

Правила доступа:  

-   Allow Read User.Country=Resource.Country AND User.department = Resource.Department  

-   Allow Full control User.MemberOf(FinanceAdmin)  

-   Allow Read User.MemberOf(FinanceException)  

#### <a name="to-create-a-central-access-rule"></a>Создание правила централизованного доступа  

1. В левой области центра администрирования Active Directory щелкните **Представление в виде дерева**, выберите **Динамический контроль доступа** и щелкните **Централизованные правила доступа**.  

2. Щелкните правой кнопкой **Правила централизованного доступа**, выберите **Создать** и щелкните **Централизованное правило доступа**.  

3. В поле **Имя** введите **Правило финансовых документов**.  

4. В разделе **Целевые ресурсы** нажмите кнопку **Изменить**, а затем в диалогом окне **Централизованное правило доступа** щелкните **Добавить условие**. Добавьте следующее условие:   
   [**Ресурс**] [**Отдел**] [**Равно**] [**Значение**] [**Финансовый**]. Затем нажмите кнопку **ОК**.  

5. В разделе **Разрешения** выберите параметр **Использовать следующие разрешения как текущие**, нажмите кнопку **Изменить** и в диалоговом окне **Дополнительные параметры безопасности для разрешений** нажмите **Добавить**.  

   > [!NOTE]  
   > Параметр **Использовать следующие разрешения как текущие** позволяет создать политику для сверки. Дополнительные сведения о том, как это сделать, см. в разделе Обслуживание: изменение и размещение политики этой статьи.  

6. В диалоговом окне **Ввод разрешений** щелкните **Выбрать субъект**, введите **Прошедшие проверку**, а затем нажмите кнопку **ОК**.  

7. В диалоговом окне **Запись для разрешений** щелкните **Добавить условие** и введите следующие условия:   
   [**Пользователь**] [**страна**] [**Любой из**] [**Ресурс**] [**страна**]   
    Щелкните **Добавить условие**.   
    [**И**]   
   Щелкните [**пользователь**] [**отдел**] [**любой из**] [**ресурс**] [**Отдел**]. Задайте для параметра **Разрешения** значение **Чтение**.  

8. Нажмите кнопку **ОК**, а затем кнопку **Добавить**. Выберите ссылку **Выберите субъект**, введите **FinanceAdmin** и нажмите кнопку **ОК**.  

9. Выберите разрешения для **изменения, чтения и выполнения, чтения, записи**, а затем нажмите кнопку **ОК**.  

10. Нажмите кнопку **Добавить**, щелкните **Выберите субъект**, введите **FinanceException** и нажмите кнопку **ОК**. Выберите разрешения **Чтение** и **Чтение и выполнение**.  

11. Нажмите кнопку **ОК** три раза, чтобы завершить операцию и вернуться в центр администрирования Active Directory.  

    ![решения,](media/Deploy-a-Central-Access-Policy--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  

    Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.  


~~~
$countryClaimType = Get-ADClaimType country  
$departmentClaimType = Get-ADClaimType department  
$countryResourceProperty = Get-ADResourceProperty Country  
$departmentResourceProperty = Get-ADResourceProperty Department  
$currentAcl = "O:SYG:SYD:AR(A;;FA;;;OW)(A;;FA;;;BA)(A;;0x1200a9;;;S-1-5-21-1787166779-1215870801-2157059049-1113)(A;;0x1301bf;;;S-1-5-21-1787166779-1215870801-2157059049-1112)(A;;FA;;;SY)(XA;;0x1200a9;;;AU;((@USER." + $countryClaimType.Name + " Any_of @RESOURCE." + $countryResourceProperty.Name + ") && (@USER." + $departmentClaimType.Name + " Any_of @RESOURCE." + $departmentResourceProperty.Name + ")))"  
$resourceCondition = "(@RESOURCE." + $departmentResourceProperty.Name + " Contains {`"Finance`"})"  
New-ADCentralAccessRule "Finance Documents Rule" -CurrentAcl $currentAcl -ResourceCondition $resourceCondition  
~~~


> [!IMPORTANT]  
> В примере командлета выше идентификаторы безопасности (SID) для группы FinanceAdmin и пользователей определяются во время создания. В вашем примере они будут отличаться. Например, значение SID (S-1-5-21-1787166779-1215870801-2157059049-1113) для FinanceAdmins необходимо заменить фактическим SID группы FinanceAdmin, которую вы создадите в развертывании. Для поиска значения SID этой группы можно использовать Windows PowerShell, присвоить значение переменной, а затем использовать переменную здесь. Дополнительные сведения см. [в подсказке Windows PowerShell: работа с идентификаторами безопасности](https://go.microsoft.com/fwlink/?LinkId=253545).  

Вы создали централизованное правило доступа, которое позволяет пользователям получить доступ к документам из той же страны и того же отдела. Правило позволяет группе FinanceAdmin изменять документы, а группе FinanceException — читать документы. Это правило предназначено только для документов, которые классифицированы как финансовые.  

#### <a name="to-add-a-central-access-rule-to-a-central-access-policy"></a>Добавление централизованного правила доступа в централизованную политику доступа  

1. В левой области центра администрирования Active Directory щелкните **Динамический контроль доступа** и выберите **Централизованные политики доступа**.  

2. В области **задач** щелкните **Создать** и выберите **Централизованная политика доступа**.  

3. В разделе **Создать централизованную политику доступа:** введите **Финансовая политика** в поле **Имя**.  

4. В окне **Централизованные правила доступа члена** нажмите кнопку **Добавить**.  

5. Дважды щелкните **Правило финансовых документов**, чтобы добавить его в список **Добавить следующие централизованные правила доступа**, а затем нажмите кнопку **ОК**.  

6. Для завершения нажмите кнопку **ОК**. Вы добавили централизованную политику доступа "Финансовая политика".  

   ![решения,](media/Deploy-a-Central-Access-Policy--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  

   Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.  

   ```  
   New-ADCentralAccessPolicy "Finance Policy" Add-ADCentralAccessPolicyMember   
   -Identity "Finance Policy"   
   -Member "Finance Documents Rule"  

   ```  

#### <a name="to-apply-the-central-access-policy-across-file-servers-by-using-group-policy"></a>Применение централизованной политики доступа на файловых серверах с помощью групповой политики  

1.  На **начальном экране** в поле **Поиск** введите **Управление групповой политикой**. Дважды щелкните **Управление групповой политикой**.  

    > [!TIP]  
    > Если параметр **Показать средства администрирования** отключен, папка **Администрирование** и ее содержимое не отображаются в списке результатов **Параметры**.  

    > [!TIP]  
    > В производственной среде следует создать подразделение "Файловый сервер" и добавить в него все ваши файловые серверы, к которым будет применена политика. Затем можно создать групповую политику и добавить в нее созданное подразделение.  

2.  На этом этапе вы измените объект групповой политики, созданный в разделе [Создание контроллера домена](Appendix-B--Setting-Up-the-Test-Environment.md#BKMK_Build) в тестовой среде, чтобы добавить созданную централизованную политику доступа. В редактор "Управление групповыми политиками" перейдите к и выберите подразделение в домене (в этом примере — contoso.com): **управление групповая политика**, **лес: contoso.com**, **домены**, **contoso.com**, **contoso**, **филесерверау**.  

3.  Правой кнопкой мыши щелкните элемент **FlexibleAccessGPO** и выберите **Изменить**.  

4.  В редакторе управления групповой политикой щелкните **Конфигурация компьютера**, разверните узел **Политики**, разверните узел **Параметры Windows**, а затем щелкните **Параметры безопасности**.  

5.  Разверните узел **Файловая система**, щелкните правой кнопкой **Централизованная политика доступа** и выберите **Управление централизованными политиками доступа**.  

6.  В диалоговом окне **Настройка централизованных политик доступа** добавьте политику **Финансовая политика**, а затем нажмите кнопку **ОК**.  

7.  Прокрутите экран к элементу **Конфигурация расширенной политики аудита** и разверните его.  

8.  Разверните узел **Политики доступа** и выберите **Доступ к объектам**.  

9. Дважды щелкните **Аудит сверки с централизованной политикой доступа**. Установите все три флажка и нажмите **ОК**. Это позволит системе получать события аудита, связанные со сверкой централизованных политик доступа.  

10. Дважды щелкните **Аудит свойств файловой системы**. Установите все три флажка и нажмите **ОК**.  

11. Закройте редактор управления групповыми политиками. Централизованная политика доступа добавлена в групповую политику.  

Чтобы контроллеры домена домена предоставляющих утверждения или данные авторизации устройства, необходимо настроить контроллеры домена для поддержки динамического контроля доступа.  

#### <a name="to-enable-support-for-claims-and-compound-authentication-for-contosocom"></a>Включение поддержки для утверждений и комплексной проверки подлинности для домена contoso.com  

1.  Откройте оснастку управления групповой политикой, щелкните **contoso.com**, а затем щелкните **Контроллеры домена**.  

2.  Щелкните правой кнопкой мыши **Политика контроллеров домена по умолчанию**, а затем нажмите **Изменить**.  

3.  В окне редактора управления групповой политикой дважды щелкните **Конфигурация компьютера**, дважды щелкните **Политики**, дважды щелкните **Административные шаблоны**, дважды щелкните **Система** и дважды щелкните **KDC**.  

4.  Дважды щелкните **Поддержка KDC для утверждений, комплексной проверки подлинности и защиты Kerberos**. В диалоговом окне **Поддержка KDC для утверждений, комплексной проверки подлинности и защиты Kerberos** щелкните **Включено** и выберите элемент **Поддерживается** из раскрывающегося списка **Параметры**. (Этот параметр необходимо включить, чтобы применять утверждения пользователей в централизованных политиках доступа.)  

5.  Закройте **Управление групповой политикой**.  

6.  Откройте командную строку и введите: `gpupdate /force`.  

## <a name="BKMK_1.4"></a>Развертывание централизованной политики доступа  

||Шаг|Пример|  
|-|--------|-----------|  
|3.1|Назначьте централизованную политику доступа соответствующим общим папкам на файловом сервере.|Назначьте централизованную политику доступа соответствующей общей папке на файловом сервере.|  
|3.2|Убедитесь, что доступ правильно настроен.|Проверьте доступ пользователей из разных стран и отделов.|  

На этом шаге вы назначите централизованную политику доступа к файловому серверу. Вы войдете на файловый сервер, который принимает централизованную политику доступа, созданную ранее, и назначите политику общей папке.  

#### <a name="to-assign-a-central-access-policy-to-a-file-server"></a>Назначение централизованной политики доступа файловому серверу  

1. В диспетчере Hyper-V подключитесь к серверу FILE1. Войдите на сервер, используя CONTOSO\Administrator с паролем: <strong>pass@word1</strong>.  

2. Откройте командную строку с повышенными привилегиями и введите **gpupdate /force**. Эта команда применяет изменения групповой политики на сервере.  

3. Вам также необходимо обновить глобальные свойства ресурсов из Active Directory. Откройте командное окно Windows PowerShell с повышенными привилегиями и введите: `Update-FSRMClassificationpropertyDefinition`. Нажмите клавишу ВВОД и закройте Windows PowerShell.  

   > [!TIP]
   > Вы также можете обновить глобальные свойства ресурсов, войдя на файловый сервер. Чтобы обновить глобальные свойства ресурсов с файлового сервера, выполните следующие действия.  
   > 
   > 1. Вход в файл FILE1 в формате CONTOSO\Administrator с использованием пароля <strong>pass@word1</strong>.  
   > 2. Откройте диспетчер ресурсов файлового сервера. Чтобы открыть диспетчер ресурсов файлового сервера, нажмите кнопку **Пуск**, введите **диспетчер ресурсов файлового сервера**и щелкните **Диспетчер ресурсов файлового сервера**.  
   > 3. В диспетчере ресурсов файлового сервера щелкните **Управление классификацией файлов**, щелкните правой кнопкой **Свойства классификации** и выберите команду **Обновить**.  

4. Откройте проводник и в левой области щелкните диск D. Щелкните правой кнопкой папку **Финансовые документы** и выберите пункт **Свойства**.  

5. Откройте вкладку **Классификация**, щелкните **Страна**, а затем выберите **США** в поле **Значение**.  

6. Щелкните **Отдел**, выберите **Финансовый** в поле **Значение** и нажмите кнопку **Применить**.  

   > [!NOTE]  
   > Помните, что эта централизованная политика доступа была настроена для файлов из финансового отдела. Предыдущие действия отмечают все документы в папке атрибутами "Страна" и "Отдел".  

7. Откройте вкладку **Безопасность** и выберите **Дополнительно**. Щелкните вкладку **Централизованная политика**.  

8. Нажмите кнопку **Изменить**, выберите **Финансовая политика** в раскрывающемся меню и нажмите кнопку **Применить**. В списке правил политик вы увидите **Правило финансовых документов**. Вы можете развернуть его, чтобы просмотреть все разрешения, заданные при создании правила в Active Directory.  

9. Нажмите кнопку **ОК**, чтобы вернуться в проводник.  

На следующем шаге вы убедитесь, что доступ правильно настроен.  Для учетных записей должен быть задан соответствующий атрибут "Отдел" (с помощью центра администрирования Active Directory). Самый простой способ просмотреть результаты новой политики — использовать вкладку **Действующие права доступа** в проводнике Windows. На вкладке **Действующие права доступа** отображаются права доступа для указанной учетной записи.  

#### <a name="to-examine-the-access-for-various-users"></a>Просмотр прав доступа различных пользователей  

1.  В диспетчере Hyper-V подключитесь к серверу FILE1. Войдите на сервер как contoso\administrator. В проводнике перейдите к диску D:\. Щелкните правой кнопкой мыши папку **Finance Documents** и выберите пункт **Свойства**.  

2.  Откройте вкладку **Безопасность**, нажмите кнопку **Дополнительно** и перейдите на вкладку **Действующие права доступа**.  

3.  Чтобы проверить разрешения для пользователя, щелкните **выбрать пользователя**, введите имя пользователя, а затем щелкните **Просмотр действующих прав доступа** , чтобы просмотреть действующие права доступа. Например:  

    -   Myriam Delesalle (MDelesalle) работает в финансовом отделе. У нее должно быть разрешение на чтение папки.  

    -   Miles Reid (MReid) входит в группу FinanceAdmin и у него должно быть разрешение на изменение папки.  

    -   Esther Valle (EValle) не работает в финансовом отделе, однако она является членом группы FinanceException и у нее должен быть доступ для чтения.  

    -   Maira Wenzel (MWenzel) не работает в финансовом отделе и не является членом групп FinanceException и FinanceException. У нее не должно быть никаких прав доступа к папке.  

    Обратите внимание на последний столбец **Ограничения доступа** в окне действующих прав доступа. В этом столбце указывается, какие шлюзы влияют на разрешения пользователя. В этом случае разрешения "Общий доступ" и"NTFS" предоставляют всем пользователям полный доступ. Однако централизованная политика доступа ограничивает разрешения на основе правил, настроенных ранее.  

## <a name="BKMK_1.5"></a>Обслуживание: изменение и размещение политики  

||||  
|-|-|-|  
|Число|Шаг|Пример|  
|4.1|Настройка утверждений устройств для клиентов|Настройка параметра групповой политики для включения утверждений устройств|  
|4.2|Включение утверждений для устройств.|Включите тип утверждений "страна" для устройств.|  
|4.3|Добавьте промежуточную политику в существующее централизованное правило доступа, которое вы хотите изменить.|Измените правило финансового документа, чтобы добавить промежуточную политику.|  
|4.4|Просмотрите результаты применения промежуточной политики.|Проверьте разрешения Естер Велле.|  

#### <a name="to-set-up-group-policy-setting-to-enable-claims-for-devices"></a>Настройка параметра групповой политики для включения утверждений устройств  

1.  Войдите на сервер DC1, откройте оснастку "Управление групповой политикой", щелкните **contoso.com**, щелкните **Политика домена по умолчанию**, щелкните правой кнопкой и выберите команду **Изменить**.  

2.  В окне редактора управления групповой политикой перейдите в раздел **Конфигурация компьютера** > **Политики** > **Административные шаблоны** > **Система** > **Kerberos**.  

3.  Выберите параметр **Поддержка клиента KDC для утверждений, комплексной проверки подлинности и защиты Kerberos** и нажмите кнопку **Включить**.  

#### <a name="to-enable-a-claim-for-devices"></a>Включение утверждений для устройств  

1. Откройте сервер DC1 в диспетчере Hyper-V и войдите в систему как contoso\Administrator с паролем <strong>pass@word1</strong>.  

2. В меню **Средства** щелкните "Центр администрирования Active Directory".  

3. Щелкните **Представление в виде дерева**, разверните узел **Динамический контроль доступа**, дважды щелкните **Типы утверждений**, а затем дважды щелкните утверждение **страна**.  

4. В разделе **Утверждения такого типа можно выдавать для следующих классов** установите флажок **Компьютер**. Нажмите кнопку **ОК**.   
   Флажки **Пользователь** и **Компьютер** теперь установлены. Утверждение "страна" теперь можно использовать и для устройств.  

Следующий шаг — создание правила промежуточной политики. Такие политики можно использовать для отслеживания применения новой записи политики перед ее включением. На следующем шаге вы создадите промежуточную политику и будете отслеживать ее применение к общей папке.  

#### <a name="to-create-a-staging-policy-rule-and-add-it-to-the-central-access-policy"></a>Создание правила промежуточной политики и его добавление в централизованную политику доступа  

1. Откройте сервер DC1 в диспетчере Hyper-V и войдите в систему как contoso\Administrator с паролем <strong>pass@word1</strong>.  

2. Откройте центр администрирования Active Directory.  

3. Щелкните **Представление в виде дерева**, разверните узел **Динамический контроль доступа** и выберите **Централизованные правила доступа**.  

4. Щелкните правой кнопкой **Правило финансовых документов** и выберите пункт **Свойства**.  

5. В разделе **Предложенные разрешения** установите флажок **Включить поэтапную настройку разрешений**, нажмите кнопку **Изменить** и щелкните **Добавить**. В диалоговом окне **Ввод разрешений для предложенных разрешений** щелкните **Выбрать субъект**, введите **Прошедшие проверку**, а затем нажмите кнопку **ОК**.  

6. Щелкните ссылку **Добавить условие** и добавьте следующее условие:   
    [**Пользователь**] [**страна**] [**Любой из**] [**Ресурс**] [**Страна**].  

7. Щелкните ссылку **Добавить условие** еще раз и добавьте следующее условие:  
   [**И**]   
    [**Device**] [**country**] [**Any of**] [**Resource**] [**Country**]  

8. Щелкните ссылку **Добавить условие** еще раз и добавьте следующее условие:  
   Перетаскивани   
    [**Пользователь**] [**Группа**] [**Член любого**] [**Значение**]\(**финанцеексцептион**)  

9. Чтобы настроить группу FinanceException, щелкните **Добавить элементы** и в окне **Выбор пользователей, компьютеров, учетной записи службы или групп** введите **FinanceException**.  

10. Щелкните **Разрешения**, выберите **Полный доступ** и нажмите кнопку **ОК**.  

11. В окне дополнительных параметров безопасности для предложенных разрешений выберите элемент **FinanceException** и нажмите кнопку **Удалить**.  

12. Для завершения два раза нажмите кнопку **ОК**.  

![решения,](media/Deploy-a-Central-Access-Policy--Demonstration-Steps-/PowerShellLogoSmall.gif)***<em>эквивалентные командам Windows PowerShell</em>***  

Следующие командлеты Windows PowerShell выполняют ту же функцию, что и предыдущая процедура. Вводите каждый командлет в одной строке, несмотря на то, что здесь они могут отображаться разбитыми на несколько строк из-за ограничений форматирования.  

```  
Set-ADCentralAccessRule  
-Identity: "CN=FinanceDocumentsRule,CN=CentralAccessRules,CN=ClaimsConfiguration,CN=Configuration,DC=Contoso.com"  
-ProposedAcl: "O:SYG:SYD:AR(A;;FA;;;BA)(A;;FA;;;SY)(A;;0x1301bf;;;S-1-21=1426421603-1057776020-1604)"  
-Server: "WIN-2R92NN8VKFP.Contoso.com"  

```  

> [!NOTE]  
> В примере командлета выше значение параметра Server указывает на сервер в среде лаборатории тестирования. Вы можете использовать средство просмотра журнала Windows PowerShell для поиска командлетов Windows PowerShell для каждой процедуры, выполняемой в центре администрирования Active Directory. Дополнительные сведения см. в разделе [средство просмотра журнала Windows PowerShell](https://technet.microsoft.com/library/hh831702) .  

В этом наборе предложенных разрешений у членов группы FinanceException будет полный доступ к файлам из их страны, если они обращаются к ним с устройства в той же стране, где находится документ. Попытки пользователей финансового отдела получить доступ к файлам записываются в журнал безопасности файловых серверов. Однако параметры безопасности не применяются, пока промежуточный этап политики не завершится.  

В следующей процедуре вы проверите результаты применения промежуточной политики. Вы получаете доступ к общей папке, применяя имя пользователя с разрешениями на основе текущего правила. Esther Valle (EValle) входит в группу FinanceException, и у нее есть права на чтение. Согласно нашей промежуточной политике, у пользователя EValle не должно быть никаких прав.  

#### <a name="to-verify-the-results-of-the-staging-policy"></a>Проверка результатов применения промежуточной политики  

1. Подключитесь к файлу FILE1 файлового сервера в диспетчере Hyper-V и войдите в систему как CONTOSO\Administrator с паролем <strong>pass@word1</strong>.  

2. В окне командной строке введите **gpupdate /force**. Эта команда применяет изменения групповой политики на сервере.  

3. В диспетчере Hyper-V подключитесь к серверу CLIENT1. Завершите сеанс текущего пользователя. Перезапустите виртуальную машину CLIENT1. Затем войдите в систему с помощью Контосо\евалле pass@word1.  

4. Дважды щелкните ярлык на рабочем столе, чтобы \\документы \FILE1\Finance. У пользователя EValle по-прежнему должен быть доступ к файлам. Переключитесь на сервер FILE1.  

5. Откройте **средство просмотра событий** с помощью ярлыка на рабочем столе. Разверните узел **Журналы Windows** и выберите **Безопасность**. Откройте записи с **идентификатором события 4818**в категории **централизованная задача промежуточной политики доступа** . Можно увидеть, что пользователю EValle был предоставлен доступ, однако согласно промежуточной политике в доступе было отказано.  

## <a name="next-steps"></a>Дальнейшие действия  
Если вы используете централизованную систему управления серверами, такую как System Center Operations Manager, вы также можете настроить мониторинг событий. Это позволит администраторам отслеживать влияние централизованных политик доступа перед их применением.  


