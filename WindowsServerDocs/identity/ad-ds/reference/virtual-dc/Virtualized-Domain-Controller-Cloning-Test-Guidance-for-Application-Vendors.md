---
ms.assetid: fde99b44-cb9f-49bf-b888-edaeabe6b88d
title: Руководство по тестированию клонирования виртуализированных контроллеров домена для поставщиков приложений
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 0b2303bc837cdaf9f6e7ebd4b3ccbf6c66aa7ad2
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59879345"
---
# <a name="virtualized-domain-controller-cloning-test-guidance-for-application-vendors"></a>Руководство по тестированию клонирования виртуализированных контроллеров домена для поставщиков приложений

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе объясняется, поставщикам приложений следует рассмотреть возможность удостовериться, что их приложение будет работать должным образом после завершения Виртуализированный контроллер домена (DC) процесс клонирования. Здесь рассматриваются эти аспекты процесса клонирования, интересующих поставщиков приложений и сценарии, которые может потребовать дополнительного тестирования. Поставщики приложений, которые подтвердили, что их приложение работает в виртуализированных контроллеров домена, которые были клонированы, рекомендуется указывать имя приложения, в содержимое сообщества в нижней части в этом разделе, вместе со ссылкой на веб-сайт организации, где пользователям Дополнительные сведения о проверке.  
  
## <a name="overview-of-virtualized-dc-cloning"></a>Обзор клонирования виртуализированного контроллера домена  
Клонирования виртуализированного контроллера домена процесс описан подробно [введение в виртуализацию доменных служб Active Directory (AD DS) (уровень 100)](https://technet.microsoft.com/library/hh831734.aspx) и [виртуализированные технические контроллера домена Справочник по (уровень 300)](https://technet.microsoft.com/library/jj574214.aspx). С точки зрения поставщика приложения ниже приведены некоторые рекомендации, помогающие принять во внимание при оценке влияния клонирования в приложение.  
  
-   Исходный компьютер не уничтожается. Он остается в сети, взаимодействие с клиентами. В отличие от переименования, где будут удалены записи DNS на исходном компьютере остаются исходных записей для исходного контроллера домена.  
  
-   Во время процесса клонирования новый компьютер изначально работал для короткий период времени с использованием идентификатора исходного компьютера, пока не инициируется процесса клонирования и вносит необходимые изменения. Приложения, которые создают записи об узле следует убедиться, что клонированного компьютера не перезаписывают записи о первоначального хост-компьютера во время процесса клонирования.  
  
-   Клонирование является возможностью развертывания только для виртуализированных контроллеров домена, не расширением общего назначения для клонирования других ролей сервера. Некоторые роли сервера не поддерживаются для клонирования:  
  
    -   Протокол DHCP  
  
    -   Службы сертификатов Active Directory (AD CS)  
  
    -   Службы Active Directory облегченного доступа к каталогам (AD LDS)  
  
-   Как часть процесса клонирования копируется всей виртуальной Машины, представляющий исходный контроллер домена, поэтому также копируется и состояние любого приложения на этой виртуальной Машине. Проверить, что приложение адаптируется к это изменение в состоянии локального узла на клонированный контроллер домена, или если требуется, например перезапуск службы какого-либо вмешательства.  
  
-   Как часть клонирования новый контроллер домена получает новый идентификатор машины и подготавливает сам как реплики контроллера домена в топологии. Проверьте, совпадает ли приложение зависит от идентификатора компьютера, например его имя, учетная запись, идентификатор безопасности и т. д. Он автоматически адаптируются к изменению удостоверения машины на клоне? Если это приложение кэширует данные, убедитесь, что он не зависит от машины идентификационных данных, которые могут быть кэшированы.  
  
## <a name="what-is-interesting-for-application-vendors"></a>Самое интересное для поставщиков приложений?  
  
### <a name="customdccloneallowlistxml"></a>CustomDCCloneAllowList.xml  
Не удалось клонировать контроллер домена, который запускает приложение или служба пока приложение или служба является либо:  
  
-   Добавить в файл CustomDCCloneAllowList.xml, используя командлет Get-ADDCCloningExcludedApplicationList Windows PowerShell  
  
-Или-  
  
-   Удален из контроллера домена  
  
Первый раз, когда пользователь запускает командлет Get-ADDCCloningExcludedApplicationList, он возвращает список служб и приложений, которые выполняются на контроллере домена, но не в списке по умолчанию служб и приложений, которые поддерживаются для клонирования. По умолчанию службы или приложения не отображаются. Для добавления службы или приложения в список приложений и служб, которые можно безопасно клонировать, выполняется пользователем, командлет Get-ADDCCloningExcludedApplicationList снова с параметром - GenerateXML, чтобы добавить его в customdccloneallowlist.XML файл. Дополнительные сведения см. в разделе [шаг 2: Выполните командлет Get-ADDCCloningExcludedApplicationList](https://technet.microsoft.com/library/hh831734.aspx#bkmk6_run_get_addccloningexcludedapplicationlist_cmdlet).  
  
### <a name="distributed-system-interactions"></a>Взаимодействия распределенных систем  
Обычно службы изолированной на локальном компьютере пройден или сбой при участии в клонирование. Распределенные службы должны быть беспокоиться о двух экземпляров главного компьютера в сети одновременно для короткий период времени. Это может проявить как экземпляр службы пытается получить информацию от системы партнера, где клона была зарегистрирована в качестве нового поставщика удостоверения. Или оба экземпляра службы могут передать данные в базу данных AD DS в то же время дает различные результаты. Например это не детерминированным какой компьютер, будут связаны с, когда два компьютера, на которых служба тестирования технологии Windows (WTT) входят в сеть с контроллером домена.  
  
Распределенная служба DNS-сервер процесса клонирования тщательно избегает перезаписи записи DNS исходного контроллера домена при запуске клонированного контроллера домена с помощью нового IP-адреса.  
  
Не следует полагаться на компьютере, чтобы удалить все старые удостоверения до завершения клонирования. После того как новый контроллер домена выдвинут внутри новый контекст, выберите Sysprep, поставщики выполняются для очистки дополнительное состояние компьютера. Например это на этом этапе удаляются старые сертификаты компьютера и изменены секреты криптографии, компьютер может получить доступ.  
  
Наибольшее коэффициент, на который зависит от времени клонирование является сколько объектов для репликации с конференции PDC. Более старые мультимедиа увеличивает время, необходимое для завершения клонирования.  
  
Поскольку службы или приложения не известно, он продолжит выполняться. Процесс клонирования не приводит к изменению состояния служб, отличных от Windows.  
  
Кроме того новый компьютер имеет другой IP-адрес исходного компьютера. Эти поведения могут вызвать побочные эффекты к вашей службе или приложению в зависимости от того, как служба или приложение ведет себя в этой среде.  
  
## <a name="additional-scenarios-suggested-for-testing"></a>Дополнительные сценарии, предлагаемые для тестирования  
  
### <a name="cloning-failure"></a>Сбой клонирования  
Поставщиками служб следует протестировать этот сценарий, так как после сбоя клонирования компьютер загружается в служб восстановления режиме каталогов (DSRM), формы безопасного режима. На этом этапе компьютера не было завершено клонирования. Какое-либо состояние может измениться, и какое-либо состояние изменится с исходного контроллера домена. Протестируйте этот сценарий, чтобы понять, какое влияние, он может иметь на приложение.  
  
Чтобы вызвать сбой клонирования, попробуйте клонирования контроллера домена без предоставления ему разрешения на клонирование. В этом случае компьютер будет только новым IP-адреса и по-прежнему имеют большую часть свое состояние из исходного контроллера домена. Дополнительные сведения о предоставление разрешения контроллера домена для клонирования, см. в разделе [шаг 1: Предоставление исходному виртуализованному контроллеру домена разрешение на клонирование](https://technet.microsoft.com/library/hh831734.aspx#bkmk4_grant_source).  
  
### <a name="pdc-emulator-cloning"></a>Клонирование эмулятор основного контроллера домена  
Поставщики службы и приложения следует протестировать этот сценарий, так как нет необходимости дополнительной перезагрузки при клонировании эмулятор основного контроллера домена. Кроме того большая часть клонирование выполняется под временное удостоверение, чтобы разрешить у нового клона для взаимодействия с эмулятором основного контроллера домена во время процесса клонирования.  
  
### <a name="writable-versus-read-only-domain-controllers"></a>Для записи и контроллеры домена только для чтения  
Поставщики службы и приложения необходимо протестировать, клонирование, используя тот же тип контроллера домена (то есть на контроллере домена, доступный для записи или только для чтения) запланированную службы под управлением.  
  


