---
ms.assetid: fde99b44-cb9f-49bf-b888-edaeabe6b88d
title: Руководство по тестированию клонирования виртуализированных контроллеров домена для поставщиков приложений
author: iainfoulds
ms.author: iainfou
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: f8a108226f0aff37cd730a477bd6ee5d865399df
ms.sourcegitcommit: 1dc35d221eff7f079d9209d92f14fb630f955bca
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88940264"
---
# <a name="virtualized-domain-controller-cloning-test-guidance-for-application-vendors"></a>Руководство по тестированию клонирования виртуализированных контроллеров домена для поставщиков приложений

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе объясняется, какие поставщики приложений должны учитывать, чтобы они продолжали работать надлежащим образом после завершения процесса клонирования виртуального контроллера домена (DC). В нем рассматриваются такие аспекты процесса клонирования, которые являются поставщиками приложений и сценариями, которые могут потребовать дополнительного тестирования. Поставщики приложений, которые проверили, что их приложение работает на виртуализированных виртуальных контроллерах домена, которые были клонированы, рекомендуется перечислить имя приложения в содержимом сообщества в нижней части этого раздела, а также ссылку на веб-сайт вашей организации, где пользователи могут получить дополнительные сведения о проверке.

## <a name="overview-of-virtualized-dc-cloning"></a>Обзор виртуализированного клонирования контроллеров домена
Процесс клонирования виртуализованного контроллера домена подробно описан в статье [Общие сведения о виртуализации домен Active Directory Services (AD DS) (уровень 100)](../../introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100.md) и [техническом справочнике по виртуальному контроллеру домена (уровень 300)](../../deploy/virtual-dc/virtualized-domain-controller-technical-reference--level-300-.md). С точки зрения поставщика приложения при оценке влияния клонирования на приложение необходимо учитывать следующие моменты.

-   Исходный компьютер не уничтожается. Он остается в сети и взаимодействует с клиентами. В отличие от переименования при удалении DNS-записей исходного компьютера, исходные записи для исходного контроллера домена остаются.

-   В процессе клонирования новый компьютер изначально выполняется в течение короткого периода времени под удостоверением старого компьютера до инициации процесса клонирования и внесения необходимых изменений. Приложения, создающие записи о узле, должны гарантировать, что клонированный компьютер не перезаписывает записи о первоначальном узле в процессе клонирования.

-   Клонирование — это конкретная возможность развертывания только для виртуализированных контроллеров домена, а не для расширения общего назначения для клонирования других ролей сервера. Некоторые роли сервера специально не поддерживаются для клонирования:

    -   Протокол DHCP

    -   Службы сертификатов Active Directory (AD CS)

    -   Службы Active Directory облегченного доступа к каталогам (AD LDS)

-   В рамках процесса клонирования копируется вся виртуальная машина, представляющая исходный контроллер домена, поэтому все состояния приложения на этой виртуальной машине также копируются. Убедитесь, что приложение адаптируется к этому изменению в состоянии локального узла на клонированном контроллере домена или если требуется вмешательство, например перезапуск службы.

-   В процессе клонирования новый контроллер домена получает новое удостоверение компьютера и подготавливает себя в качестве реплики контроллера домена в топологии. Проверьте, зависит ли приложение от удостоверения компьютера, например его имени, учетной записи, идентификатора безопасности и т. д. Она автоматически адаптируется к изменению удостоверения компьютера в клоне? Если это приложение кэширует данные, убедитесь, что они не полагаются на данные удостоверения компьютера, которые могут быть кэшированы.

## <a name="what-is-interesting-for-application-vendors"></a>Что интересно для поставщиков приложений?

### <a name="customdccloneallowlistxml"></a>CustomDCCloneAllowList.xml
Контроллер домена, на котором выполняется приложение или служба, не может быть клонирован, пока приложение или служба не будут иметь одно из следующих действий:

-   Добавляется в файл CustomDCCloneAllowList.xml с помощью командлета Windows PowerShell Get-Аддкклонинжексклудедаппликатионлист.

-Или-

-   Удалено из контроллера домена

Когда пользователь впервые запускает командлет Get-Аддкклонинжексклудедаппликатионлист, он возвращает список служб и приложений, которые выполняются на контроллере домена, но не входят в список служб и приложений, которые поддерживают клонирование, по умолчанию. По умолчанию служба или приложение не будут перечислены в списке. Чтобы добавить службу или приложение в список приложений и служб, которые можно безопасно клонировать, пользователь снова запускает командлет Get-Аддкклонинжексклудедаппликатионлист с параметром-Женератексмл, чтобы добавить его в файл CustomDCCloneAllowList.xml. Дополнительные сведения см. в разделе [Шаг 2. выполнение командлета Get-аддкклонинжексклудедаппликатионлист](/powershell/module/addsadministration/get-addccloningexcludedapplicationlist).

### <a name="distributed-system-interactions"></a>Взаимодействие распределенных систем
Обычно службы, изолированные к локальному компьютеру, либо проходят, либо завершаются ошибкой при клонировании. Распределенные службы должны быть уверены в том, что в течение короткого периода времени два экземпляра главного компьютера находятся в сети одновременно. Это может быть экземпляром службы, пытающимся извлечь сведения из системы партнера, где клон зарегистрирован как новый поставщик удостоверений. Или оба экземпляра службы могут отправлять сведения в базу данных AD DS в одно и то же время с разными результатами. Например, Недетерминированный компьютер будет обмениваться данными, когда два компьютера, на которых установлена служба "технологии тестирования Windows" (ВТТ), находятся в сети с контроллером домена.

Для службы распределенного DNS-сервера процесс клонирования следует тщательно избегать перезаписи записей DNS исходного контроллера домена, если клонированный контроллер домена начинается с нового IP-адреса.

Не следует полагаться на компьютер, чтобы удалить все старые удостоверения до окончания клонирования. После того как новый контроллер домена будет выдвинут в новом контексте, выберите поставщики Sysprep, чтобы очистить дополнительное состояние компьютера. Например, на этом этапе удаляются старые сертификаты компьютера, а также изменяются криптографические секреты, к которым компьютер может получить доступ.

Наибольший фактор, который изменяет время клонирования, — это количество объектов, которые нужно реплицировать с основного контроллера домена. Более старый носитель увеличивает время, необходимое для выполнения клонирования.

Так как служба или приложение неизвестны, они остаются работающими. Процесс клонирования не изменяет состояние служб, отличных от Windows.

Кроме того, новый компьютер имеет IP-адрес, отличный от того, на котором находится исходный компьютер. Такое поведение может вызвать побочные эффекты для службы или приложения в зависимости от поведения службы или приложения в этой среде.

## <a name="additional-scenarios-suggested-for-testing"></a>Дополнительные сценарии, предлагаемые для тестирования

### <a name="cloning-failure"></a>Сбой клонирования
Поставщики услуг должны протестировать этот сценарий, так как в случае сбоя клонирования компьютер загружается в режим восстановления служб каталогов (DSRM) в виде безопасного режима. На этом этапе компьютер не завершил клонирование. Некоторые состояния могли быть изменены, и некоторые состояния могут остаться на исходном контроллере домена. Протестируйте этот сценарий, чтобы понять, какое влияние он может иметь в вашем приложении.

Чтобы вызвать сбой клонирования, попытайтесь клонировать контроллер домена, не предоставив ему разрешение на клонирование. В этом случае компьютер будет только изменять IP-адреса и по-прежнему имеет большую часть своего состояния от исходного контроллера домена. Дополнительные сведения о предоставлении клонированного разрешения на контроллер домена см. в разделе [Шаг 1. предоставление исходному виртуальному контроллеру домена разрешения на клонирование](../../get-started/virtual-dc/virtualized-domain-controller-deployment-and-configuration.md).

### <a name="pdc-emulator-cloning"></a>Клонирование эмулятора PDC
Поставщики услуг и приложений должны протестировать этот сценарий, так как при клонировании эмулятора основного контроллера домена требуется дополнительная перезагрузка. Кроме того, большая часть клонирования выполняется с временным удостоверением, что позволяет новому клону взаимодействовать с эмулятором основного контроллера домена во время процесса клонирования.

### <a name="writable-versus-read-only-domain-controllers"></a>Доступ для записи и контроллеров домена только для чтения
Поставщики услуг и приложений должны протестировать Клонирование с использованием того же типа контроллера домена (то есть на контроллере домена с возможностью записи или только для чтения), на котором запланирована работа службы.
