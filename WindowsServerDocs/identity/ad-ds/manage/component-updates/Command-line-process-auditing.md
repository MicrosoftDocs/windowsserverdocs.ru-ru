---
ms.assetid: c8597cc8-bdcb-4e59-a09e-128ef5ebeaf8
title: "Аудит процесса командной строки"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 61e7a5ca2b9c00c9976e6032bb10adb1974020b0
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="command-line-process-auditing"></a>Аудит процесса командной строки

>Область применения: Windows Server 2016, Windows Server 2012 R2

**Автор**: Джастин Тернер, старший инженер по улучшению поддержки с группой Windows  
  
> [!NOTE]  
> Этот материал создан инженером поддержки клиентов Майкрософт и предназначен для опытных администраторов и архитекторов систем, которым нужны более глубокие технические сведения о функциях и решениях в Windows Server 2012 R2, чем обычно предоставляют разделов на TechNet. Однако он не проходил же редактирования этапах, поэтому некоторые формулировки могут быть то, что обычно станицах на сайте TechNet.  
  
## <a name="overview"></a>Обзор  
  
-   Имеющийся событие создания процесса аудита 4688 идентификатор будет содержать данные аудита процессов командной строки.  
  
-   Также занесет хэш SHA1/2 исполняемого файла в журнал событий Applocker  
  
    -   Application and Services Logs\Microsoft\Windows\AppLocker  
  
-   Включите через объект групповой Политики, но она отключена по умолчанию  
  
    -   «Включить командной строки в событий создания процессов»  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_Event4688.gif)  
  
**Рис. SEQ Figure \\\ * ARABIC 16 событие 4688**  
  
Просмотрите обновленные событие 4688 идентификатор в REF _Ref366427278 \h рисунок 16.  До этого не обновлять сведения о **процесса командной строки** получает войти в систему.  Из-за этого дополнительные функции ведения журналов теперь можно увидеть, не только wscript.exe процесса запуска, но также была использована для выполнения сценария VB.  
  
## <a name="configuration"></a>Конфигурации  
Чтобы увидеть влияние этого обновления, необходимо включить два параметра политики.  
  
### <a name="you-must-have-audit-process-creation-auditing-enabled-to-see-event-id-4688"></a>Необходимо иметь аудит создания процессов аудит включен событие 4688 идентификатор.  
Чтобы включить аудит процесс создания политики, измените следующую групповую политику:  
  
**Размещение политики:** Конфигурация компьютера > политики > Параметры Windows > Параметры безопасности > Расширенная настройка аудита > Подробное отслеживание  
  
**Имя политики:** аудит создания процессов  
  
**Поддерживается в:** Windows 7 и более поздней версии  
  
**Описание и справки:**  
  
Этот параметр политики безопасности определяет, создает ли операционная система события аудита при создании процесса (запуска) и имя программы или пользователь, создавший его.  
  
Эти события аудита помогут понять, как использовать компьютер и для отслеживания действий пользователя.  
  
Объем событий: низкий или средний в зависимости от использования системы  
  
**По умолчанию:** не настроен  
  
### <a name="in-order-to-see-the-additions-to-event-id-4688-you-must-enable-the-new-policy-setting-include-command-line-in-process-creation-events"></a>Чтобы просмотреть дополнения к событие 4688 код, необходимо включить новый параметр политики: включить командной строки в событий создания процессов  
**Таблица SEQ Table \\\ * параметр политики процесса ARABIC 19 командной строки**  
  
|Настройка политик|Сведения о|  
|------------------------|-----------|  
|**Путь**|Создание процесса администрирования Templates\System\Audit|  
|**Параметр**|**Включить в событий создания процессов командной строки**|  
|**По умолчанию**|Не настроено (не включено)|  
|**Поддерживается в:**|?|  
|**Описание**|Этот параметр политики определяет, какие сведения регистрируется в события аудита безопасности, когда был создан новый процесс.<br /><br />Этот параметр действует только в том случае, если включена политика Аудит создания процессов. Если включить этот параметр политики, которые данные командной строки для каждого процесса будут занесены в виде обычного текста в журнале событий безопасности в рамках аудит создания процессов событие 4688 «новый процесс создания» на рабочих станциях и серверах, в которых применяется эта политика.<br /><br />Если отключить или не настраивать этот параметр политики, сведения о командной строки процесса, не включается в событиях аудит создания процессов.<br /><br />По умолчанию: Не настроен<br /><br />Примечание: Если этот параметр политики включен, любой пользователь с доступом для чтения события безопасности будут иметь возможность считывать аргументы командной строки для любого успешно создан процесса. Аргументы командной строки может содержать важных или конфиденциальных сведений, например пароли и данные пользователя.|  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_IncludeCLISetting.gif)  
  
При использовании параметров Конфигурация расширенной политики аудита, вы должны убедиться, что эти параметры не перезаписываются, параметры базовой политики аудита.  Событие 4719 регистрируется, когда параметры перезаписываются.  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_Event4719.gif)  
  
Описанную ниже показано, как избежать конфликтов, блокируя приложения любые параметры базовой политики аудита.  
  
### <a name="to-ensure-that-advanced-audit-policy-configuration-settings-are-not-overwritten"></a>Чтобы убедиться, что параметры конфигурация расширенной политики аудита не перезаписаны  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_AdvAuditPolicy.gif)  
  
1.  Откройте консоль управления групповыми политиками  
  
2.  Щелкните правой кнопкой мыши политику домена по умолчанию и нажмите кнопку Изменить.  
  
3.  Дважды щелкните Конфигурация компьютера, затем дважды щелкните политики и параметры Windows.  
  
4.  Дважды щелкните параметры безопасности, дважды щелкните локальные политики и выберите параметры безопасности.  
  
5.  Дважды щелкните аудита: Параметрами подкатегории политики Force аудита (Windows Vista или более поздней версии) переопределяет параметры категории политики аудита, а затем нажмите кнопку определить этот параметр политики.  
  
6.  Переключатель включен и нажмите кнопку ОК.  
  
## <a name="additional-resources"></a>Дополнительные ресурсы  
[Аудит создания процессов](https://technet.microsoft.com/library/dd941613(v=WS.10).aspx)  
  
[Пошаговое руководство по политике аудита безопасности расширенной](https://technet.microsoft.com/library/dd408940(v=WS.10).aspx)  
  
[AppLocker: Вопросы и ответы](https://technet.microsoft.com/library/ee619725(v=ws.10).aspx)  
  
## <a name="try-this-explore-command-line-process-auditing"></a>Выполните следующие действия: Изучите аудит процесса командной строки  
  
1.  Включить **аудит создания процессов** события и того, конфигурации расширенные политики аудита не перезаписаны  
  
2.  Создайте сценарий, который будет создавать некоторые события и выполните сценарий.  Наблюдать за событиями.  Сценарий, используемый для создания события в ходе урока выглядит следующим образом:  
  
    ```  
    mkdir c:\systemfiles\temp\commandandcontrol\zone\fifthward  
    copy \\192.168.1.254\c$\hidden c:\systemfiles\temp\hidden\commandandcontrol\zone\fifthward  
    start C:\systemfiles\temp\hidden\commandandcontrol\zone\fifthward\ntuserrights.vbs  
    del c:\systemfiles\temp\*.* /Q  
    ```  
  
3.  Включить аудит процесса командной строки  
  
4.  Выполнение тот же сценарий и просмотрите события  
  


