---
ms.assetid: c8597cc8-bdcb-4e59-a09e-128ef5ebeaf8
title: Аудит процесса командной строки
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 66ae6992775319cf614b0cb4c21f864150746687
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59859555"
---
# <a name="command-line-process-auditing"></a>Аудит процесса командной строки

>Область применения. Windows Server 2016, Windows Server 2012 R2

**Автор**: Джастин Тернер, старший инженер по улучшению поддержки с группой Windows  
  
> [!NOTE]  
> Этот материал создан инженером службы поддержки клиентов Майкрософт и предназначен для опытных администраторов и архитекторов систем, которым нужны более глубокие технические сведения о функциях и решениях в Windows Server 2012 R2, а не обычная информация, доступная в статьях на сайте TechNet. Однако он не был отредактирован согласно требованиям сайта, поэтому некоторые формулировки могут быть не такими выверенными, как на станицах TechNet.  
  
## <a name="overview"></a>Обзор  
  
-   Существующие событие создания процесса аудита ID 4688 теперь будет включать сведения аудита процессов командной строки.  
  
-   Он также добавляет в журнал хэш SHA1/2 исполняемого файла в журнале событий Applocker  
  
    -   Приложения и службы Logs\Microsoft\Windows\AppLocker  
  
-   Включить через объект групповой Политики, но она отключена по умолчанию  
  
    -   «Включить командной строки в события создания процессов»  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_Event4688.gif)  
  
**Рис. SEQ Figure \\ \* ARABIC 16 событий 4688**  
  
Просмотрите обновленное событие ID 4688 в \h _Ref366427278 REF рис. 16.  До этого не обновлять сведения о **Командная строка процесса** возвращает в журнал.  Из-за этого дополнительное ведение журнала теперь видно, что не только был запущен процесс wscript.exe, но также было использовать для выполнения скрипта VB.  
  
## <a name="configuration"></a>Конфигурация  
Чтобы увидеть влияние этого обновления, необходимо включить два параметра политики.  
  
### <a name="you-must-have-audit-process-creation-auditing-enabled-to-see-event-id-4688"></a>Необходимо иметь аудит создания процессов аудит включен для событий ID 4688 см. в разделе.  
Чтобы включить аудит создания процессов политику, измените следующую групповую политику.  
  
**Размещение политики:** Конфигурация компьютера > политики > Параметры Windows > Параметры безопасности > Расширенная настройка аудита > Подробное отслеживание  
  
**Имя политики:** Аудит создания процессов  
  
**Поддерживается в:** Windows 7 и более поздних версий  
  
**Описание: Справка:**  
  
Этот параметр политики безопасности определяет, создает ли операционная система событий аудита при создании процесса (запуска) и имя программы или пользователь, создавший его.  
  
Эти события аудита может помочь вам понять, как компьютер используется и для отслеживания действий пользователей.  
  
Объем событий: Низкий, средний, в зависимости от использования системы  
  
**Значение по умолчанию:** Не задано  
  
### <a name="in-order-to-see-the-additions-to-event-id-4688-you-must-enable-the-new-policy-setting-include-command-line-in-process-creation-events"></a>Чтобы просмотреть дополнения к событию ID 4688, необходимо включить новый параметр политики: Включить в события создания процессов командной строки  
**Таблицы SEQ таблицы \\ \* параметр политики процесс ARABIC 19 командной строки**  
  
|Настройка политики|Подробности|  
|------------------------|-----------|  
|**путь**|Создание процессов администрирования Templates\System\Audit|  
|**Параметр**|**Включить в события создания процессов командной строки**|  
|**По умолчанию**|Не настроено (не включена)|  
|**Поддерживается в:**|?|  
|**Описание**|Этот параметр политики определяет, какие сведения регистрируется в событиях аудита безопасности при создании нового процесса.<br /><br />Этот параметр применяется только в том случае, если включена политика Аудит создания процессов. Если включить этот параметр командной строки сведения для каждого процесса будет записываться в виде обычного текста в журнале событий безопасности как часть событий Аудит создания процессов 4688 политики, «новый процесс создания» на рабочих станциях и серверах, на котором эта политика применяется политика.<br /><br />Если отключить или не настраивать этот параметр политики, сведения процесса командной строки не будет включаться в события создания процесса аудита.<br /><br />Default: Не задано<br /><br />Примечание. Если этот параметр политики включен, любой пользователь с доступом для чтения, что события безопасности будет иметь возможность читать аргументы командной строки для любого успешного создания процесса. Аргументы командной строки могут содержать важные и конфиденциальные сведения, такие как пароли или данным пользователя.|  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_IncludeCLISetting.gif)  
  
При использовании параметров конфигурации расширенной политики аудита необходимо убедиться, что эти параметры не заменены на параметры базовой политики.  Событие 4719 регистрируется в том случае, если параметры будут перезаписаны.  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_Event4719.gif)  
  
В описанной ниже процедуре показано, как можно предотвратить конфликты путем блокирования применения любых параметров базовой политики аудита.  
  
### <a name="to-ensure-that-advanced-audit-policy-configuration-settings-are-not-overwritten"></a>Проверка того, что параметры конфигурации расширенной политики аудита не перезаписаны  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_AdvAuditPolicy.gif)  
  
1.  Откройте консоль управления групповыми политиками  
  
2.  Щелкните правой кнопкой мыши политику домена по умолчанию и нажмите кнопку Изменить.  
  
3.  Дважды щелкните файл конфигурации компьютера, политики и дважды щелкните параметры Windows.  
  
4.  Дважды щелкните параметры безопасности, дважды щелкните локальные политики и выберите параметры безопасности.  
  
5.  Дважды щелкните аудита: Принудительно параметрами подкатегории политики аудита (Windows Vista или более поздней версии) переопределяет параметры категории политики аудита, а затем нажмите кнопку определить этот параметр политики.  
  
6.  Переключатель включен и нажмите кнопку ОК.  
  
## <a name="additional-resources"></a>Дополнительные ресурсы  
[Аудит создания процессов](https://technet.microsoft.com/library/dd941613(v=WS.10).aspx)  
  
[Пошаговое руководство по политике аудита безопасности расширенной](https://technet.microsoft.com/library/dd408940(v=WS.10).aspx)  
  
[AppLocker: Часто задаваемые вопросы](https://technet.microsoft.com/library/ee619725(v=ws.10).aspx)  
  
## <a name="try-this-explore-command-line-process-auditing"></a>Попробуйте выполните следующее: Изучите аудит процесса командной строки  
  
1.  Включить **аудит создания процессов** события и конфигурацию Advance политики аудита не перезаписаны  
  
2.  Создайте скрипт, который создаст некоторые события и выполнить скрипт.  Просмотрите события.  Скрипт, используемый для генерации события на занятии выглядело следующим образом:  
  
    ```  
    mkdir c:\systemfiles\temp\commandandcontrol\zone\fifthward  
    copy \\192.168.1.254\c$\hidden c:\systemfiles\temp\hidden\commandandcontrol\zone\fifthward  
    start C:\systemfiles\temp\hidden\commandandcontrol\zone\fifthward\ntuserrights.vbs  
    del c:\systemfiles\temp\*.* /Q  
    ```  
  
3.  Включить аудит процесса командной строки  
  
4.  Выполните тот же сценарий и просмотрите события  
  


