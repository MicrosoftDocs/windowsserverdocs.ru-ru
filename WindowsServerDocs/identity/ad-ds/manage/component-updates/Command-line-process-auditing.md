---
ms.assetid: c8597cc8-bdcb-4e59-a09e-128ef5ebeaf8
title: Аудит процесса командной строки
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: 5d5ab971327ab7ec16bf2748571882458cc38f72
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71368995"
---
# <a name="command-line-process-auditing"></a>Аудит процесса командной строки

>Область применения: Windows Server 2016, Windows Server 2012 R2

**Автор**: Джастин Тернер, старший инженер по расширению поддержки с группой Windows  
  
> [!NOTE]  
> Этот материал создан инженером службы поддержки клиентов Майкрософт и предназначен для опытных администраторов и архитекторов систем, которым нужны более глубокие технические сведения о функциях и решениях в Windows Server 2012 R2, а не обычная информация, доступная в статьях на сайте TechNet. Однако он не был отредактирован согласно требованиям сайта, поэтому некоторые формулировки могут быть не такими выверенными, как на станицах TechNet.  
  
## <a name="overview"></a>Обзор  
  
-   Предварительно существующий событие аудита создания процесса с ИДЕНТИФИКАТОРом 4688 теперь включает сведения об аудите для процессов командной строки.  
  
-   Он также регистрирует хэш SHA1/2 исполняемого файла в журнале событий AppLocker.  
  
    -   Логс\микрософт\виндовс\апплоккер приложений и служб  
  
-   Вы включаете через GPO, но по умолчанию отключено.  
  
    -   "Включить командную строку в события создания процесса"  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_Event4688.gif)  
  
**Рисунок SEQ. рис. \\\* Арабской 16 события 4688**  
  
Ознакомьтесь с обновленным событием с ИДЕНТИФИКАТОРом 4688 в REF _Ref366427278 \h рис. 16.  До этого обновления ни одна из сведений о **командной строке процесса** не заносится в журнал.  В связи с этим дополнительным протоколированием теперь можно увидеть, что процесс WScript. exe запущен не только при запуске, но и в том, что он также использовался для выполнения сценария VB.  
  
## <a name="configuration"></a>Настройка  
Чтобы увидеть последствия этого обновления, необходимо включить два параметра политики.  
  
### <a name="you-must-have-audit-process-creation-auditing-enabled-to-see-event-id-4688"></a>Для просмотра события с ИДЕНТИФИКАТОРом 4688 необходимо включить аудит создания процессов аудита.  
Чтобы включить политику создания процесса аудита, измените следующую групповую политику:  
  
**Расположение политики:** Конфигурация компьютера политики > > Параметры Windows > Параметры безопасности > Расширенная настройка аудита > Подробное отслеживание  
  
**Имя политики:** Аудит создания процесса  
  
**Поддерживается в:** Windows 7 и более поздние версии  
  
**Описание/Справка:**  
  
Этот параметр политики безопасности определяет, создает ли операционная система события аудита при создании процесса (запускается) и имя программы или пользователя, создавшего его.  
  
Эти события аудита могут помочь понять, как используется компьютер и как отслеживать действия пользователей.  
  
Объем событий: низкий или средний в зависимости от использования системы  
  
**По умолчанию:** Не настроено  
  
### <a name="in-order-to-see-the-additions-to-event-id-4688-you-must-enable-the-new-policy-setting-include-command-line-in-process-creation-events"></a>Чтобы увидеть дополнения к событию с ИДЕНТИФИКАТОРом 4688, необходимо включить новый параметр политики: включить командную строку в события создания процесса  
**Таблица SEQ таблица \\\* параметром политики обработки командной строки на арабском 19**  
  
|Настройка политики|Подробности|  
|------------------------|-----------|  
|**Путь**|Создание административного Темплатес\систем\аудит процесса|  
|**Задав**|**Включить командную строку в события создания процесса**|  
|**Параметр по умолчанию**|Не настроено (не включено)|  
|**Поддерживается в:**|?|  
|**Описание**|Этот параметр политики определяет, какие сведения регистрируются в событиях аудита безопасности при создании нового процесса.<br /><br />Этот параметр применяется только при включенной политике создания процессов аудита. Если включить этот параметр политики, сведения о командной строке для каждого процесса будут регистрироваться в виде обычного текста в журнале событий безопасности в рамках события создания процесса аудита 4688, "новый процесс создан" на рабочих станциях и серверах, на которых эта политика применяется параметр.<br /><br />Если вы отключаете или не настраиваете этот параметр политики, сведения о командной строке процесса не будут включаться в события создания процесса аудита.<br /><br />По умолчанию: не настроено<br /><br />Примечание. Если этот параметр политики включен, любой пользователь, имеющий доступ для чтения событий безопасности, сможет считывать аргументы командной строки для всех успешно созданных процессов. Аргументы командной строки могут содержать конфиденциальную или закрытую информацию, например пароли или данные пользователя.|  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_IncludeCLISetting.gif)  
  
При использовании параметров конфигурации расширенной политики аудита необходимо убедиться, что эти параметры не заменены на параметры базовой политики.  Событие 4719 регистрируется при перезаписи параметров.  
  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_Event4719.gif)  
  
В описанной ниже процедуре показано, как можно предотвратить конфликты путем блокирования применения любых параметров базовой политики аудита.  
  
### <a name="to-ensure-that-advanced-audit-policy-configuration-settings-are-not-overwritten"></a>Проверка того, что параметры конфигурации расширенной политики аудита не перезаписаны  
![Аудит командной строки](media/Command-line-process-auditing/GTR_ADDS_AdvAuditPolicy.gif)  
  
1.  Открытие консоли управления групповая политика  
  
2.  Щелкните правой кнопкой мыши Политика домена по умолчанию и выберите команду Изменить.  
  
3.  Дважды щелкните Конфигурация компьютера, дважды щелкните политики, а затем дважды щелкните Параметры Windows.  
  
4.  Дважды щелкните Параметры безопасности, дважды щелкните Локальные политики, а затем выберите параметры безопасности.  
  
5.  Дважды щелкните Аудит: принудительно настроить параметры подкатегории политики аудита (Windows Vista или более поздней версии) для переопределения параметров категории политики аудита, а затем щелкните определить этот параметр политики.  
  
6.  Щелкните включено, а затем нажмите кнопку ОК.  
  
## <a name="additional-resources"></a>Дополнительные ресурсы  
[Аудит создания процесса](https://technet.microsoft.com/library/dd941613(v=WS.10).aspx)  
  
[Пошаговое руководств по расширенной политике аудита безопасности](https://technet.microsoft.com/library/dd408940(v=WS.10).aspx)  
  
[AppLocker: часто задаваемые вопросы](https://technet.microsoft.com/library/ee619725(v=ws.10).aspx)  
  
## <a name="try-this-explore-command-line-process-auditing"></a>Попробуйте сделать это: обзор процесса командной строки аудит  
  
1.  Включите **Аудит событий создания процесса аудита** и убедитесь, что конфигурация политики расширенного аудита не перезаписана.  
  
2.  Создайте скрипт, который будет создавать некоторые интересующие события и выполнять скрипт.  Обратите внимание на события.  Скрипт, используемый для создания события в занятии, выглядит следующим образом:  
  
    ```  
    mkdir c:\systemfiles\temp\commandandcontrol\zone\fifthward  
    copy \\192.168.1.254\c$\hidden c:\systemfiles\temp\hidden\commandandcontrol\zone\fifthward  
    start C:\systemfiles\temp\hidden\commandandcontrol\zone\fifthward\ntuserrights.vbs  
    del c:\systemfiles\temp\*.* /Q  
    ```  
  
3.  Включение аудита обработки командной строки  
  
4.  Выполните тот же сценарий, что и раньше, и просмотрите события.  
  


