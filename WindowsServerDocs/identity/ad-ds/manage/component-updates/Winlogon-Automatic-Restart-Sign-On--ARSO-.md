---
ms.assetid: cb834273-828a-4141-9387-37dd8270e932
title: Вход автоматического перезапуска Winlogon (АРСО)
description: Использование автоматического перезапуска Windows для повышения производительности пользователей.
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.reviewer: cahick
ms.date: 08/20/2019
ms.topic: article
ms.openlocfilehash: 711a3fc22977d7aa9751c8e200524f4cd295110b
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87943311"
---
# <a name="winlogon-automatic-restart-sign-on-arso"></a>Вход автоматического перезапуска Winlogon (АРСО)

Во время Центр обновления Windows для завершения обновления должны выполняться определенные пользователем процессы. Для этих процессов требуется, чтобы пользователь вошел в систему на своем устройстве. При первом входе после запуска обновления пользователи должны дождаться завершения этих пользовательских процессов, прежде чем они смогут начать использовать свое устройство.

## <a name="how-does-it-work"></a>Как это работает?

Когда Центр обновления Windows инициирует автоматическую перезагрузку, АРСО извлекает полученные в данный момент учетные данные пользователя, сохраняет их на диск и настраивает автоматический вход пользователя в систему. Центр обновления Windows, выполняющиеся от имени системы с правами TCB, будут инициировать вызов RPC для этого.

После последней перезагрузки Центр обновления Windows пользователь будет автоматически входить в систему через механизм автоматического входа, а сеанс пользователя будет восстановлен с помощью сохраненных секретов. Кроме того, устройство блокируется для защиты сеанса пользователя. Блокировка будет инициирована с помощью Winlogon, тогда как управление учетными данными выполняется локальным администратором безопасности (LSA). После успешной настройки АРСО и входа сохраненные учетные данные немедленно удаляются с диска.

Автоматически войдя в систему и блокируя пользователя в консоли, Центр обновления Windows может завершить определенные пользователем процессы, прежде чем пользователь вернется на устройство. Таким образом, пользователь может сразу приступить к работе с устройством.

АРСО обрабатывает неуправляемые и управляемые устройства по-разному. Для неуправляемых устройств шифрование устройств используется, но не требуется, чтобы пользователь получил АРСО. Для конфигураций АРСО требуются управляемые устройства, TPM 2,0, безопасной загрузки и BitLocker. ИТ – администраторы могут переопределить это требование с помощью групповая политика. АРСО для управляемых устройств в настоящее время доступно только для устройств, присоединенных к Azure Active Directory.

| Центр обновления Windows | Завершение работы — g-t 0 | Перезагрузки, инициированные пользователем | API-интерфейсы с флагами SHUTDOWN_ARSO и EWX_ARSO |
|--|--|--|--|
| Управляемые устройства — да<p>Неуправляемые устройства — да | Управляемые устройства — да<p>Неуправляемые устройства — да | Управляемые устройства — нет<p>Неуправляемые устройства — да | Управляемые устройства — да<p>Неуправляемые устройства — да |

> [!NOTE]
> После Центр обновления Windows принудительной перезагрузки последний интерактивный пользователь автоматически входит в систему, и сеанс блокируется. Это дает возможность приложениям экрана блокировки по-прежнему работать, несмотря на Центр обновления Windows перезагрузки.

![Страница «Параметры»](media/Winlogon-Automatic-Restart-Sign-On--ARSO-/gtr-adds-lockscreenapp.png)

## <a name="policy-1"></a>#1 политики

### <a name="sign-in-and-lock-last-interactive-user-automatically-after-a-restart"></a>Автоматический вход и блокировка последнего интерактивного пользователя после перезагрузки

В Windows 10 АРСО отключена для номеров SKU сервера и отказывается от номеров SKU клиентов.

**Расположение групповой политики:** Конфигурация компьютера > административные шаблоны > компонентов Windows > параметры входа Windows

**Политика Intune:**

- Платформа. Windows 10 и более поздней версии
- Тип профиля: административные шаблоны
- Путь: \Windows \ параметры входа в систему

**Поддерживается в:** Не ниже Windows 10 версии 1903

**Описание:**

Этот параметр политики определяет, будет ли устройство автоматически входить в систему и блокировать последнего интерактивного пользователя после перезагрузки системы или после завершения работы и холодной загрузки.

Это происходит только в том случае, если последний интерактивный пользователь не выйдет перед перезапуском или завершением работы.

Если устройство присоединено к Active Directory или Azure Active Directory, эта политика применяется только к перезапускам Центр обновления Windows. В противном случае это будет применяться и к перезапуску Центр обновления Windows, и к перезапуску и завершению работы, инициированной пользователем.

Если этот параметр политики не настроен, по умолчанию он включен. Если политика включена, пользователь автоматически выполняет вход, и сеанс автоматически блокируется всеми приложениями экрана блокировки, настроенными для этого пользователя после загрузки устройства.

После включения этой политики можно настроить ее параметры с помощью политики Конфигаутоматикрестартсигнон, которая настраивает режим автоматического входа и блокировку последнего интерактивного пользователя после перезагрузки или холодной загрузки.

Если вы отключаете этот параметр политики, устройство не настраивает автоматический вход. После перезагрузки системы приложения блокировки экрана пользователя не перезапускаются.

**Редактор реестра:**

| Имя значения | Тип | Данные |
| --- | --- | --- |
| дисаблеаутоматикрестартсигнон | DWORD | 0 (включить АРСО) |
|   |   | 1 (отключить АРСО) |

**Расположение реестра политики:** хклм\софтваре\микрософт\виндовс\куррентверсион\полиЦиес\систем

**Тип:** DWORD

![процессу](media/Winlogon-Automatic-Restart-Sign-On--ARSO-/gtr-adds-signinpolicy.png)

## <a name="policy-2"></a>#2 политики

### <a name="configure-the-mode-of-automatically-signing-in-and-locking-last-interactive-user-after-a-restart-or-cold-boot"></a>Настройка режима автоматического входа и блокировки последнего интерактивного пользователя после перезагрузки или холодного запуска

**Расположение групповой политики:** Конфигурация компьютера > административные шаблоны > компонентов Windows > параметры входа Windows

**Политика Intune:**

- Платформа. Windows 10 и более поздней версии
- Тип профиля: административные шаблоны
- Путь: \Windows \ параметры входа в систему

**Поддерживается в:** Не ниже Windows 10 версии 1903

**Описание:**

Этот параметр политики управляет конфигурацией, в которой автоматический перезапуск и вход и блокировка выполняются после перезагрузки или холодной загрузки. Если в политике "Автоматический вход и блокировка последнего интерактивного пользователя после перезапуска выбрано значение" отключено ", автоматический вход не будет выполняться, и эту политику не нужно настраивать.

Если этот параметр политики включен, можно выбрать один из следующих двух вариантов:

1. "Включено, если BitLocker включен и не приостановлен" указывает, что автоматический вход и блокировка будут выполняться только в том случае, если BitLocker активен и не приостановлен во время перезагрузки или завершения работы. В настоящее время на жестком диске устройства можно получить доступ к личным данным, если BitLocker не включен или не приостановлен во время обновления. Приостановка BitLocker временно снимает защиту системных компонентов и данных, но может потребоваться в определенных обстоятельствах для успешного обновления критически важных для загрузки компонентов.
   - BitLocker приостанавливается во время обновления, если:
      - На устройстве не установлен TPM 2,0 и PCR7 или
      - Устройство не использует средство защиты только TPM
2. Параметр "всегда включено" указывает, что автоматический вход будет выполняться, даже если BitLocker отключен или приостановлен во время перезагрузки или завершения работы. Если BitLocker не включен, личные данные доступны на жестком диске. Автоматический перезапуск и вход в систему следует выполнять только при условии, что настроенное устройство находится в надежном физическом расположении.

Если вы отключаете или не настраиваете этот параметр политики, автоматический вход будет по умолчанию включен в режим "включено, если BitLocker включен и не приостановлен".

**Редактор реестра**

| Имя значения | Тип | Данные |
| --- | --- | --- |
| аутоматикрестартсигнонконфиг | DWORD | 0 (включить АРСО, если оно защищено) |
|   |   | 1 (включить АРСО Always) |

**Расположение реестра политики:** хклм\софтваре\микрософт\виндовс\куррентверсион\полиЦиес\систем

**Тип:** DWORD

![процессу](media/Winlogon-Automatic-Restart-Sign-On--ARSO-/arso-policy-setting.png)

## <a name="troubleshooting"></a>Диагностика

При автоматической блокировке WinLogon трассировка состояния WinLogon будет храниться в журнале событий WinLogon.

Регистрируется состояние попытки настройки автоматического входа в систему

- В случае успеха
   - записывает его как таковое
- В случае сбоя:
   - Записывает сведения об ошибке
- При изменении состояния BitLocker:
   - Удаление учетных данных будет зарегистрировано
   - Они будут храниться в операционном журнале LSA.

### <a name="reasons-why-autologon-might-fail"></a>Причины, по которым может произойти сбой автоматического входа

Существует несколько случаев, в которых пользователь не может достичь автоматического входа.  Этот раздел предназначен для записи известных сценариев, в которых это может произойти.

### <a name="user-must-change-password-at-next-login"></a>Пользователь должен сменить пароль при следующем входе

Пользователь может войти в состояние блокировки, если требуется сменить пароль при следующем входе.  Это может быть обнаружено до перезапуска в большинстве случаев, но не все (например, может быть достигнут срок действия пароля при завершении работы и следующем входе в систему).

### <a name="user-account-disabled"></a>Учетная запись пользователя отключена

Существующий сеанс пользователя можно поддерживать, даже если он отключен.  Перезапуск для учетной записи, которая отключена, может быть обнаружена локально в большинстве случаев заранее. в зависимости от групповой политики он может не быть учетными записями домена (некоторые сценарии входа в систему в кэше работают, даже если учетная запись отключена на контроллере домена).

### <a name="logon-hours-and-parental-controls"></a>Время входа и родительский контроль

Время входа и родительский контроль могут препятствовать созданию нового сеанса пользователя.  Если перезагрузка происходила в этом окне, пользователю запрещено выполнять вход.  Существует дополнительная политика, которая вызывает блокировку или выход из системы в качестве действия соответствия. Регистрируется состояние попытки настройки автоматического входа в систему.

## <a name="security-details"></a>Сведения о безопасности

### <a name="credentials-stored"></a>Хранимые учетные данные

| Хэш пароля | Ключ учетных данных | Билет предоставления билета | Основной маркер обновления |
|--|--|--|--|
| Локальная учетная запись — Да | Локальная учетная запись — Да | Локальная учетная запись — нет | Локальная учетная запись — нет |
| Учетная запись MSA — да | Учетная запись MSA — да | Учетная запись MSA — нет | Учетная запись MSA — нет |
| Учетная запись присоединения к Azure AD — да | Учетная запись присоединения к Azure AD — да | Учетная запись присоединения к Azure AD — Да (если гибридная) | Учетная запись присоединения к Azure AD — да |
| Учетная Запись присоединена к домену — да | Учетная Запись присоединена к домену — да | Учетная Запись присоединена к домену — да | Учетная Запись присоединена к домену — Да (если гибридная) |

### <a name="credential-guard-interaction"></a>Взаимодействие с Credential Guard

Если на устройстве включено Credential Guard, то производные секреты пользователя шифруются с ключом, относящимся к текущему сеансу загрузки. Таким образом, АРСО в настоящее время не поддерживается на устройствах с включенным Credential Guard.

## <a name="additional-resources"></a>Дополнительные ресурсы

Автоматический вход в систему — это функция, которая присутствовала в Windows для нескольких выпусков. Это документированная функция Windows, которая даже содержит такие средства, как автоматический вход в Windows [http:/TechNet. Microsoft. com/Sysinternals/bb963905. aspx](/sysinternals/downloads/autologon). Это позволяет одному пользователю устройства автоматически выполнять вход без ввода учетных данных. Учетные данные настраиваются и хранятся в реестре как зашифрованный секрет LSA. Это может быть проблематичным для многих дочерних случаев, когда блокировка учетной записи может происходить между временем и пробуждением, особенно если период обслуживания в это время обычно встречается.
