---
ms.assetid: 709353b0-b913-4367-8580-44745183e2bc
title: "Проверка работоспособности DNS для поддержки репликации каталогов"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.service: 
ms.suite: na
ms.technology: identity-adds
ms.author: billmath
ms.date: 05/31/2017
ms.tgt_pltfrm: na
author: Femila
ms.openlocfilehash: 49f2795e1042438a50850fcb7fd8224eff2cca37
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="verify-dns-functionality-to-support-directory-replication"></a>Проверка работоспособности DNS для поддержки репликации каталогов

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

 Чтобы проверить параметры доменных имен (DNS), которые могут конфликтовать с репликацией Active Directory, можно начать, запустив базовая проверка, который обеспечивает работоспособность DNS-сервера для домена. После запуска базовая проверка, вы можете проверить другие аспекты DNS функциональные возможности, включая регистрации записи ресурсов и динамического обновления.

Хотя этот тест основные функциональные возможности DNS-сервера можно запускать на любом контроллере домена, обычно можно выполнять этот тест на контроллерах домена, которые вы считаете, что может наблюдаться проблем репликации, например, контроллеры домена отчета о 1844 событий идентификаторами 1925, 2087 или 2088 в журнале службы каталогов просмотра DNS событий.



## <a name="running-the-domain-controller-basic-dns-testtitle"></a>Под управлением контроллера домена, базовая проверка DNS</title>

Базовая проверка DNS проверяет следующие аспекты возможностей DNS-сервера:


- **Подключение:** тест определяет, доступен ли зарегистрированных в службе DNS, контроллеры домена <system>ping</system> команда, и у протокола LDAP / удаленного вызова процедур подключение (LDAP/RPC). В случае сбоя проверки подключения на контроллере домена, другие тесты не выполняются на этом контроллере домена. Проверка подключения выполняется автоматически перед запуском любого другого теста DNS.
- **Основных служб:** тест подтверждает, что следующие службы находятся в запущен и доступен на контроллере домена протестированных: служба DNS-клиента, службы сетевого входа в систему, служба центра распространения ключей (KDC) и службы DNS-сервера (если DNS-сервера установлена на контроллере домена).
- **Конфигурация клиента DNS:** тест подтверждает, что DNS-серверы, на всех сетевых адаптеров компьютера DNS-клиента, доступны.
- **Регистрации записей ресурсов:** тест подтверждает, что зарегистрировано записи ресурса узла (A) для каждого контроллера домена по крайней мере один DNS-серверов, которые настроены на клиентском компьютере.
- **Зоны и начальной записи зоны (SOA):** Если контроллер домена работает под управлением службу DNS-сервера, тест подтверждает, что присутствуют зону домена Active Directory и начала записи ресурсов (SOA) для доменной зоны Active Directory.
- **Корневая зона:** проверяет, присутствует ли зоны корневой (.).

Минимальным требованием для выполнения этих процедур является членство в группе "Администраторы предприятия" или наличие эквивалентных прав.

Можно использовать следующую процедуру, чтобы проверить основные функциональные возможности DNS-сервера.
     
### <a name="to-verify-basic-dns-functionality"></a>Чтобы проверить основные функциональные возможности DNS-сервера:


1. На контроллере домена, который вы хотите протестировать или на компьютер домена с установленными средствами доменных служб Active Directory (AD DS) откройте командную строку от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку **запустить**. 
2. В поле поиска введите командную строку. 
3. В верхней части меню «Пуск» щелкните правой кнопкой мыши командную строку и выберите пункт Запуск от имени администратора. Если появляется диалоговое окно контроля учетных записей, убедитесь, что действие, которое отображает — то, что нужно, и нажмите кнопку Продолжить.
4. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s: &lt;DCName&gt; /DnsBasic f:/dcdiagreport.txt`
</br></br>Замените фактическое различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. В качестве альтернативы Вы можете проверить все контроллеры домена в лесу, введя/e: вместо/s:. Параметр /f указывает имя файла, который в предыдущей команде является dcdiagreport.txt. Если вы хотите поместить файл в расположение, отличное от текущего рабочего каталога, можно указать путь к файлу, например /f:c:reportsdcdiagreport.txt.

5. Откройте файл dcdiagreport.txt в блокноте или аналогичном текстовом редакторе. Чтобы открыть файл в блокноте, в командной строке, введите dcdiagreport.txt "Блокнот" и нажмите клавишу ВВОД. Если файл размещен в другой рабочий каталог, включите путь к файлу. Например если файл размещен в c:reports, введите c:reportsdcdiagreport.txt «Блокнот» и нажмите клавишу ВВОД.
6. Прокрутите до сводные таблицы в нижней части файла. 
</br></br>Запишите имена всех контроллеров домена отчета о состоянии «Warn» или «Сбой» в сводной таблице.  Попытайтесь определить, имеется проблема контроллера домена путем поиска в разделе подробных отдельных, выполнив поиск строки «DCName: контроллера домена», где DCName — фактическое имя контроллера домена.

Если вы видите изменения очевидным конфигурации, которые являются обязательными, сделайте их, соответствующим образом. Например если вы обнаружите, что один из контроллеров домена имеет неправильный очевидно, что IP-адрес, то ее можно устранить. Запустите тест.

Чтобы проверить изменения конфигурации, повторно команды Dcdiag/Test: DNS /v с параметром/e: или/s: соответствующим образом. Если у вас IP версии 6 (IPv6) на контроллере домена, следует ожидать часть к сбою проверки узла (AAAA), но если вы не используете IPv6 в сети, эти записи не требуются.
            
## <a name="verifying-resource-record-registration"></a>Проверка регистрации записей ресурсов
    
На конечный контроллер домена использует запись ресурса псевдонима (CNAME) DNS для поиска исходном партнере репликации контроллера домена. Несмотря на то, что контроллеры домена под управлением Windows Server (начиная с Windows Server 2003 с пакетом обновления 1 (SP1)) можно найти партнеров источника репликации, используя полные доменные имена (FQDN) или, если это не помогло, наличие namesthe NetBIOS записи ресурса псевдонима (CNAME) является нормальным и должен быть проверен для правильного DNS работает. 
      
Проверка регистрации записей ресурсов, включая регистрацию записи ресурса псевдонима (CNAME), можно использовать следующую процедуру.
      
### <a name="to-verify-resource-record-registrationtitle"></a>Проверка регистрации записи ресурса</title>


1. Откройте командную строку от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку "Пуск". В поле поиска введите командную строку. 
2. В верхней части меню «Пуск» щелкните правой кнопкой мыши командную строку и выберите пункт Запуск от имени администратора. Если появляется диалоговое окно контроля учетных записей, убедитесь, что действие, которое отображает — то, что нужно, и нажмите кнопку Продолжить.  </br></br>Можно использовать средство Dcdiag, чтобы проверить регистрацию всех записей ресурсов, которые необходимы для расположение контроллера домена, выполнив `dcdiag /test:dns /DnsRecordRegistration` команды.

Эта команда проверяет регистрации следующих записей ресурсов в DNS:


- **псевдоним (CNAME):** глобальный уникальный идентификатор (GUID) — на основе записи ресурса, которая находит партнера репликации
- **узел (A):** записи ресурса узла, содержащего IP-адрес контроллера домена
- **LDAP SRV:** записей ресурсов обнаружения службы (SRV), найдите LDAP-сервера
- **GC SRV**: записей ресурсов обнаружения службы (SRV), найдите глобального каталога
- **PDC SRV**: записей ресурсов обнаружения службы (SRV), найдите хозяева эмулятора операций основного домена (PDC) контроллеру

Можно использовать следующую процедуру для проверки псевдонима (CNAME) регистрации записи ресурсов отдельно.

### <a name="to-verify-alias-cname-resource-record-registration"></a>Проверка регистрации записи ресурса псевдонима (CNAME)

1. Откройте оснастку DNS. Чтобы открыть DNS, нажмите кнопку "Пуск". В поле поиска введите dnsmgmt.msc и нажмите клавишу ВВОД. Если появляется диалоговое окно контроля учетных записей, убедитесь, что его действие и нажмите кнопку Продолжить.
2. Найдите любой контроллер домена, на котором выполняется служба DNS-сервера, о том, где на сервере размещается зоны DNS с тем же именем, как домен Active Directory контроллера домена, используйте оснастку DNS.
3. В дереве консоли щелкните зону, которая называется _msdcs. Dns_Domain_Name.
4. В области сведений убедитесь, что присутствуют следующие записи ресурса: запись ресурса псевдонима (CNAME), который называется Dsa_Guid._msdcs. <placeholder>Dns_Domain_Name</placeholder> и соответствующую запись узла (A ресурсов для имени DNS-сервера).

Если запись ресурса псевдонима (CNAME) не зарегистрирован, убедитесь, что это динамическое обновление выполняется правильно. Проверка динамического обновления, используйте тест в следующем разделе.
    
## <a name="verifying-dynamic-update"></a>Проверка динамического обновления
    
Если базовая проверка DNS показывает, что записи ресурсов не существует в DNS, нажмите динамическое обновление тестирования, чтобы определить, почему служба сетевого входа в систему регистрация не записи ресурсов автоматически. Чтобы убедиться, что зону домена Active Directory настроена для принятия безопасных динамических обновлений и выполнение регистрации тестовой записи (_dcdiag_test_record), выполните следующую процедуру. Тестовую запись автоматически удаляется после выполнения проверки.

### <a name="to-verify-dynamic-updatetitle"></a>Проверка динамического обновления</title>


1. Откройте командную строку от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку "Пуск". В поле поиска введите командную строку. В верхней части меню «Пуск» щелкните правой кнопкой мыши командную строку и выберите пункт Запуск от имени администратора. Если появляется диалоговое окно контроля учетных записей, убедитесь, что действие, которое отображает — то, что нужно, и нажмите кнопку Продолжить.
2. В командной строке введите следующую команду и нажмите клавишу ВВОД: 

    / s: /v dcdiag/test: DNS&lt;DCName&gt; /DnsDynamicUpdate
</br></br>Замените различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. В качестве альтернативы Вы можете проверить все контроллеры домена в лесу, введя/e: вместо/s:. Если у вас на контроллере домена включен протокол IPv6, следует ожидать узла (AAAA) ресурсов записи часть теста неудачей, которая является нормальным состоянием в том случае, если не включена поддержка IPv6.

Если безопасное динамическое обновление не настроены, можно использовать следующую процедуру для их настройки.

### <a name="to-enable-secure-dynamic-updates"></a>Чтобы включить безопасных динамических обновлений


1. Откройте оснастку DNS. Чтобы открыть DNS, нажмите кнопку "Пуск". 
2. В поле поиска введите dnsmgmt.msc и нажмите клавишу ВВОД. Если появляется диалоговое окно контроля учетных записей, убедитесь, что его действие и нажмите кнопку Продолжить.
3. В дереве консоли щелкните правой кнопкой мыши соответствующую зону и выберите пункт Свойства.
4. На вкладке "Общие" Убедитесь, что тип зоны, интегрированной в Active Directory.
5. В динамические обновления и только нажмите кнопку "Безопасность".

## <a name="registering-dns-resource-records"></a>Регистрация записей ресурсов DNS
    
Если записей ресурсов DNS не отображаются в DNS для исходного контроллера домена, вы проверили динамические обновления и вы хотите немедленно регистрации записей ресурсов DNS, принудительно регистрации вручную с помощью следующей процедуры. Служба сетевого входа в систему на контроллере домена регистрирует записи ресурсов DNS, которые требуются для контроллера домена будет расположен в сети. Служба DNS-клиент регистрирует запись ресурса узла (A), который указывает записи псевдонима (CNAME).

### <a name="to-register-dns-resource-records-manuallytitle"></a>Для регистрации записей ресурсов DNS вручную</title>


1. Откройте командную строку от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку "Пуск". 
2. В поле поиска введите командную строку. 
3. В верхней части начального щелкните правой кнопкой мыши командную строку и выберите пункт Запуск от имени администратора. Если появляется диалоговое окно контроля учетных записей, убедитесь, что действие, которое отображает — то, что нужно, и нажмите кнопку Продолжить.
4. Чтобы начать регистрацию ресурсов локатора контроллера домена записей вручную на исходном контроллере домена, в командной строке введите следующую команду и нажмите клавишу ВВОД: `net stop net logon &amp; net start net logon`
5. Для запуска регистрации узла (A) записи ресурса вручную, в командной строке введите следующую команду и нажмите клавишу ВВОД: `ipconfig /flushdns &amp; ipconfig /registerdns`
6. В командной строке введите следующую команду и нажмите клавишу ВВОД: / s: /v dcdiag/test: DNS&lt;DCName&gt; </br>,</br>Замените различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. Просмотрите результат выполнения тестирования, чтобы убедиться, что DNS тесты были пройдены. Если у вас на контроллере домена включен протокол IPv6, следует ожидать узла (AAAA) ресурсов записи часть теста неудачей, которая является нормальным состоянием в том случае, если не включена поддержка IPv6.
