---
ms.assetid: 709353b0-b913-4367-8580-44745183e2bc
title: Проверка работоспособности DNS для поддержки репликации каталогов
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.service: ''
ms.suite: na
ms.technology: identity-adds
ms.author: joflore
ms.date: 05/31/2017
ms.tgt_pltfrm: na
author: Femila
ms.openlocfilehash: a55b95ee516abda8bdbae6e9829a161ef060012e
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59871875"
---
# <a name="verify-dns-functionality-to-support-directory-replication"></a>Проверка работоспособности DNS для поддержки репликации каталогов

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

 Чтобы проверить параметры доменных имен (DNS), которые могут конфликтовать с репликацией Active Directory, можно начать, выполнив простой тест, который гарантирует, что DNS работает правильно для вашего домена. После запуска базовый тест, можно проверить другие аспекты функциональности DNS, включая регистрации записи ресурсов и динамического обновления.

Несмотря на то, что можно выполнить этот тест основные функциональные возможности DNS на контроллерах домена, обычно необходимо выполнить этот тест на контроллеры домена, которые вы считаете могут возникать проблемы репликации, например, контроллеры домена, которые сообщают 1844 идентификаторы событий, 1925, 2087, или 2088 в журнале событий средства просмотра Directory службы DNS.



## <a name="running-the-domain-controller-basic-dns-testtitle"></a>Запуск контроллера домена, базовая проверка DNS</title>

Базовая проверка DNS проверяет следующие аспекты работоспособности DNS:


- **Подключение:** Тест определяет ли домена контроллеры зарегистрированы в DNS, может подключиться к <system>ping</system> команды, а также иметь Lightweight Directory Access Protocol / удаленного вызова процедур подключение (LDAP/RPC). Если на контроллере домена в случае сбоя проверки подключения, другие тесты не запускаются на этом контроллере домена. Проверка подключения выполняется автоматически перед запуском любых других тестов DNS.
- **Базовые службы:** Тест подтверждает, что следующие службы, работают и доступны на контроллере домена, протестированных: Служба DNS-клиента, служба сетевого входа в систему, служба центра распространения ключей (KDC) и службы DNS-сервера (если DNS установлен на контроллере домена).
- **Настройка клиента DNS:**  Тест подтверждает, что DNS-серверы на все сетевые адаптеры компьютера DNS-клиента доступны.
- **Регистрации записей:** Тест подтверждает, что запись ресурса узла (A) каждого контроллера домена зарегистрирован по крайней мере один DNS-серверов, которые настроены на клиентском компьютере.
- **Зоны и начальной записи зоны (SOA):** Если контроллер домена работает под управлением службы DNS-сервера, тест подтверждает зону домена Active Directory и центр (SOA) начальной записи зоны домена Active Directory, присутствуют.
- **Корневая зона:** Проверяет, присутствует ли зона корневой (.).

Минимальным требованием для выполнения этих процедур является членство в группе "Администраторы предприятия" или наличие эквивалентных прав.

Чтобы проверить основные функциональные возможности DNS можно использовать следующую процедуру.
     
### <a name="to-verify-basic-dns-functionality"></a>Чтобы проверить основные функциональные возможности DNS:


1. На контроллере домена, который требуется протестировать или членом домена, где установлены средства доменных служб Active Directory (AD DS) откройте командную строку с правами администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку **Пуск**. 
2. В поле поиска введите командную строку. 
3. В верхней части меню "Пуск" щелкните правой кнопкой мыши командную строку и нажмите кнопку Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.
4. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s:<DCName> /DnsBasic /f:dcdiagreport.txt`
</br></br>Замените фактическое различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. Кроме того можно проверить все контроллеры домена в лесу, введя/e: вместо/s:. Параметр /f указывает имя файла, являющегося в предыдущей команде dcdiagreport.txt. Если вы хотите поместить файл в расположение, отличное от текущего рабочего каталога, можно указать путь к файлу, например /f:c:reportsdcdiagreport.txt.

5. Откройте файл dcdiagreport.txt в блокноте или аналогичном текстовом редакторе. Чтобы открыть файл в блокноте, в командной строке, введите dcdiagreport.txt Блокнот и нажмите клавишу ВВОД. Если файл размещен в другой рабочий каталог, включите путь к файлу. Например если файл размещен в c:reports, введите c:reportsdcdiagreport.txt Блокнот и нажмите клавишу ВВОД.
6. Перейдите к сводной таблице в нижней части файла. 
</br></br>Запишите имена всех контроллеров домена этого отчета о состоянии «Предупреждение» или «Сбой» в сводной таблице.  Чтобы выяснить, имеется ли контроллер домена проблему путем поиска в разделе подробные семинаров, выполнив поиск строки «DC: DCName, «где DCName — фактическое имя контроллера домена.

Если вы видите изменения очевидным конфигурации, которые необходимы, сделать это, соответствующим образом. Например если вы заметили, что один из контроллеров домена имеет очевидно, что неверный IP-адрес, можно устранить ее. Затем повторно выполните тест.

Для проверки изменений конфигурации, повторно выполните команду Dcdiag генерацию /v с параметром/e: или/s: соответствующим образом. Если у вас IP версии 6 (IPv6) включен на контроллере домена, следует ожидать часть сбой теста проверки узла (AAAA), но если вы не используете IPv6 в сети, эти записи не обязательны.
            
## <a name="verifying-resource-record-registration"></a>Проверка регистрации записи ресурса
    
Конечный контроллер домена использует запись ресурса псевдонима (CNAME) DNS для поиска его исходного партнера репликации контроллера домена. Несмотря на то, что контроллеры домена под управлением Windows Server (начиная с Windows Server 2003 с пакетом обновления 1 (SP1)) можно найти партнеров репликации источника с помощью полные доменные имена (FQDN) или в случае неудачи присутствия namesthe NetBIOS псевдонима (CNAME) запись ресурса ожидается и должны быть соблюдены для правильного DNS работает. 
      
Можно использовать следующую процедуру, чтобы проверить регистрацию записей ресурсов, включая регистрации записи ресурса псевдонима (CNAME).
      
### <a name="to-verify-resource-record-registrationtitle"></a>Чтобы проверить правильность регистрации записи ресурса</title>


1. Откройте окно командной строки от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку "Пуск". В поле поиска введите командную строку. 
2. В верхней части меню "Пуск" щелкните правой кнопкой мыши командную строку и нажмите кнопку Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.  </br></br>Можно использовать средство Dcdiag, чтобы проверить регистрацию всех записей ресурсов, которые необходимы для обнаружения контроллера домена, выполнив `dcdiag /test:dns /DnsRecordRegistration` команды.

Эта команда проверяет регистрацию в следующих записей в DNS:


- **псевдоним (CNAME):** глобально уникальный идентификатор (GUID) — на основе записи ресурса, который находит партнера репликации
- **узел (A):** запись ресурса узла, который содержит IP-адрес контроллера домена
- **LDAP SRV:** записи ресурса службы (SRV), найдите LDAP-серверов
- **GC SRV**: записи ресурса службы (SRV), найдите глобального каталога
- **PDC SRV**: записи ресурса службы (SRV), найдите Хозяева операций эмулятора основного контроллера основного домена

Можно использовать следующую процедуру для проверки псевдонима (CNAME) регистрации записи ресурса отдельно.

### <a name="to-verify-alias-cname-resource-record-registration"></a>Чтобы проверить правильность регистрации записи ресурса псевдонима (CNAME)

1. Откройте оснастку DNS. Чтобы открыть DNS, нажмите кнопку "Пуск". В поле поиска введите dnsmgmt.msc и нажмите клавишу ВВОД. Если появится диалоговое окно контроля учетных записей, убедитесь, что отобразилась его действие и нажмите кнопку Продолжить.
2. Используйте оснастку DNS для поиска любой контроллер домена, на котором выполняется служба сервера DNS, о том, где на сервере размещаются зоны DNS с тем же именем, как домен Active Directory контроллера домена.
3. В дереве консоли щелкните зону с именем _msdcs. Dns_Domain_Name.
4. В области сведений убедитесь, что следующие записи ресурсов: записи ресурса псевдонима (CNAME), которая называется Dsa_Guid._msdcs. <placeholder>Dns_Domain_Name</placeholder> и соответствующая запись узла (A ресурса для имени DNS-сервера).

Если запись ресурса псевдонима (CNAME) не зарегистрирован, убедитесь, что это динамическое обновление работает правильно. Тест в следующем разделе можно используйте для проверки динамического обновления.
    
## <a name="verifying-dynamic-update"></a>Проверка динамического обновления
    
Если базовая проверка DNS показывает, что записи ресурсов не существуют в DNS, используйте тест динамического обновления, чтобы определить, почему служба сетевого входа в систему не зарегистрировало записей ресурсов автоматически. Чтобы убедиться, что зону домена Active Directory настроен на прием безопасных динамических обновлений и выполнение регистрации записи теста (_dcdiag_test_record), используйте следующую процедуру. Запись теста будет автоматически удалена после теста.

### <a name="to-verify-dynamic-updatetitle"></a>Чтобы проверить динамического обновления</title>


1. Откройте окно командной строки от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку "Пуск". В поле поиска введите командную строку. В верхней части меню "Пуск" щелкните правой кнопкой мыши командную строку и нажмите кнопку Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.
2. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s:<DCName> /DnsDynamicUpdate`
   </br></br>Замените различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. Кроме того можно проверить все контроллеры домена в лесу, введя/e: вместо/s:. Если у вас на контроллере домена включен протокол IPv6, следует ожидать узла (AAAA) ресурсов записи часть невыполнения теста, который является нормальным состоянием при IPv6 не включена.

Если не настроены безопасных динамических обновлений, можно использовать следующую процедуру для их настройки.

### <a name="to-enable-secure-dynamic-updates"></a>Чтобы включить безопасных динамических обновлений


1. Откройте оснастку DNS. Чтобы открыть DNS, нажмите кнопку "Пуск". 
2. В поле поиска введите dnsmgmt.msc и нажмите клавишу ВВОД. Если появится диалоговое окно контроля учетных записей, убедитесь, что отобразилась его действие требуется и нажмите кнопку Продолжить.
3. В дереве консоли щелкните правой кнопкой мыши соответствующую зону и выберите пункт Свойства.
4. На вкладке "Общие" Убедитесь, что тип зоны, интегрированной в Active Directory.
5. В динамические обновления и только нажмите кнопку "Безопасность".

## <a name="registering-dns-resource-records"></a>Регистрировать записи ресурсов DNS
    
Если записи ресурсов DNS не отображаются в DNS для исходного контроллера домена, вы подтвердили динамические обновления и вы хотите сразу зарегистрировать записи ресурсов DNS, можно принудительно регистрации вручную, используя следующую процедуру. Служба сетевого входа в систему на контроллере домена регистрирует записи ресурсов DNS, которые требуются для контроллера домена, который необходимо найти в сети. Служба DNS-клиент регистрирует запись ресурса узла (A), который указывает запись псевдонима (CNAME).

### <a name="to-register-dns-resource-records-manuallytitle"></a>Для регистрации записей ресурсов DNS вручную</title>


1. Откройте окно командной строки от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку "Пуск". 
2. В поле поиска введите командную строку. 
3. В верхней части запуска щелкните правой кнопкой мыши командную строку и нажмите кнопку Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.
4. Чтобы инициировать регистрацию ресурсов локатора контроллера домена записей вручную на исходном контроллере домена, в командной строке введите следующую команду и нажмите клавишу ВВОД: `net stop netlogon && net start netlogon`
5. Чтобы инициировать регистрацию узла (A) записи ресурса вручную, в командной строке введите следующую команду и нажмите клавишу ВВОД: `ipconfig /flushdns && ipconfig /registerdns`
6. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s:<DCName>` </br></br>Замените различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. Просмотрите выходные данные теста, чтобы убедиться, что переданный тестами DNS. Если у вас на контроллере домена включен протокол IPv6, следует ожидать узла (AAAA) ресурсов записи часть невыполнения теста, который является нормальным состоянием при IPv6 не включена.
