---
ms.assetid: 709353b0-b913-4367-8580-44745183e2bc
title: Проверка работоспособности DNS для поддержки репликации каталогов
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.service: ''
ms.suite: na
ms.technology: identity-adds
ms.author: joflore
ms.date: 05/31/2017
ms.tgt_pltfrm: na
author: Femila
ms.openlocfilehash: 066f7ebe1cd8f981344e059797daa9d3f86bdf49
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71409051"
---
# <a name="verify-dns-functionality-to-support-directory-replication"></a>Проверка работоспособности DNS для поддержки репликации каталогов

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

 Чтобы проверить параметры системы доменных имен (DNS), которые могут помешать репликации Active Directory, можно начать с выполнения базового теста, обеспечивающего правильную работу DNS для вашего домена. После выполнения базового теста можно протестировать другие аспекты функций DNS, включая регистрацию записей ресурсов и динамическое обновление.

Хотя вы можете выполнять этот тест основных функций DNS на любом контроллере домена, обычно этот тест выполняется на контроллерах домена, на которых могут возникать проблемы репликации, например контроллеры домена, которые сообщают о событиях с идентификаторами 1844, 1925, 2087 или 2088 в журнале DNS службы каталогов Просмотр событий.



## <a name="running-the-domain-controller-basic-dns-testtitle"></a>Запуск тестового</title> Basic DNS контроллера домена

Основная проверка DNS проверяет следующие аспекты функциональности DNS:


- **Подключение:** Тест определяет, зарегистрированы ли контроллеры домена в DNS, может ли быть обращена команда <system>ping</system> , а также подключение к серверу Lightweight Directory (протокол LDAP/RPC). Если проверка подключения завершается сбоем на контроллере домена, другие тесты для этого контроллера домена не выполняются. Проверка подключения выполняется автоматически перед запуском любого другого теста DNS.
- **Ключевые службы:** Тест подтверждает, что следующие службы работают и доступны на проверенном контроллере домена: служба клиента DNS, служба сетевого входа в систему, служба центр распространения ключей (KDC) и служба DNS-сервера (если служба DNS установлена на контроллере домена).
- **Конфигурация клиента DNS:**  Тест подтверждает доступность DNS-серверов на всех сетевых адаптерах клиентского компьютера DNS.
- **Регистрация записей ресурсов:** Тест подтверждает, что запись ресурса узла (A) каждого контроллера домена зарегистрирована по крайней мере на одном из DNS-серверов, настроенных на клиентском компьютере.
- **Зона и начало центра (SOA):** Если на контроллере домена работает служба DNS-сервера, тест подтверждает, что Active Directory зона домена и запись ресурса начальной зоны (SOA) для зоны домена Active Directory.
- **Корневая зона:** Проверяет наличие корневой зоны (.).

Членство в группах "Администраторы предприятия" (или эквивалентное) является минимальным требованием для выполнения этих процедур.

Для проверки основных функций DNS можно использовать следующую процедуру.
     
### <a name="to-verify-basic-dns-functionality"></a>Чтобы проверить основные функциональные возможности DNS:


1. На контроллере домена, который требуется протестировать, или на компьютере, входящем в домен, на котором установлены средства домен Active Directory Services (AD DS), откройте командную строку от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку **Пуск**. 
2. В окне "начать поиск" введите Командная строка. 
3. В верхней части меню Пуск щелкните правой кнопкой мыши пункт Командная строка и выберите команду Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.
4. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s:<DCName> /DnsBasic /f:dcdiagreport.txt`
</br></br>Замените фактическое различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. В качестве альтернативы можно проверить все контроллеры домена в лесу, введя/e: вместо/s:. Параметр/f указывает имя файла, которое в предыдущей команде — дкдиагрепорт. txt. Если требуется поместить файл в расположение, отличное от текущего рабочего каталога, можно указать путь к файлу, например/f: к:репортсдкдиагрепорт.ткст.

5. Откройте файл дкдиагрепорт. txt в блокноте или в аналогичном текстовом редакторе. Чтобы открыть файл в блокноте, в командной строке введите Notepad дкдиагрепорт. txt и нажмите клавишу ВВОД. Если файл помещен в другой рабочий каталог, укажите путь к файлу. Например, если вы поместили файл в к:Репортс, введите Notepad к:репортсдкдиагрепорт.ткст и нажмите клавишу ВВОД.
6. Перейдите к сводной таблице в нижней части файла. 
</br></br>Обратите внимание на имена всех контроллеров домена, которые сообщают о состоянии "предупреждать" или "ошибка" в сводной таблице.  Попробуйте определить, существует ли проблемный контроллер домена, выполнив поиск по строке "DC: DCName", где DCName — фактическое имя контроллера домена.

При появлении очевидных изменений конфигурации внесите необходимые изменения. Например, если вы заметили, что один из контроллеров домена имеет очевидно неверный IP-адрес, его можно исправить. Затем повторно запустите тест.

Чтобы проверить изменения конфигурации, повторно выполните команду Dcdiag/test: DNS/v с параметром/e: или/s:, как нужно. Если на контроллере домена не включена версия IP 6 (IPv6), то следует рассчитывать на сбой проверки узла (AAAA) в тесте, но если IPv6 не используется в сети, эти записи не требуются.
            
## <a name="verifying-resource-record-registration"></a>Проверка регистрации записи ресурса
    
Конечный контроллер домена использует запись ресурса DNS-псевдонима (CNAME) для указания партнера по репликации исходного контроллера домена. Хотя контроллеры домена под управлением Windows Server (начиная с Windows Server 2003 с пакетом обновления 1 (SP1)) могут обнаружить исходные партнеры репликации с помощью полных доменных имен или, если это не удается, NetBIOS-намессе имеет псевдоним (CNAME). ожидается запись ресурса, которая должна быть проверена для правильной работы DNS. 
      
Для проверки регистрации записей ресурсов, включая регистрацию записи ресурса псевдонима (CNAME), можно использовать следующую процедуру.
      
### <a name="to-verify-resource-record-registrationtitle"></a>Проверка</title> регистрации записей ресурсов


1. Откройте окно командной строки от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку Пуск. В окне "начать поиск" введите Командная строка. 
2. В верхней части меню Пуск щелкните правой кнопкой мыши пункт Командная строка и выберите команду Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.  </br></br>С помощью средства Dcdiag можно проверить регистрацию всех записей ресурсов, необходимых для расположения контроллера домена, выполнив команду `dcdiag /test:dns /DnsRecordRegistration`.

Эта команда проверяет регистрацию следующих записей ресурсов в DNS:


- **псевдоним (CNAME):** запись ресурса на основе глобального уникального идентификатора (GUID), которая находит партнера репликации.
- **узел (A):** запись ресурса узла, которая содержит IP-адрес контроллера домена.
- Записи ресурсов **LDAP SRV:** службы (SRV), которые находят LDAP-серверы.
- **GC SRV**: записи ресурсов службы (SRV), которые находят серверы глобального каталога
- **PDC SRV**: записи ресурсов службы (SRV), которые находят хозяева операций эмулятора основного контроллера домена.

Для проверки регистрации записи ресурса псевдонима (CNAME) можно использовать следующую процедуру.

### <a name="to-verify-alias-cname-resource-record-registration"></a>Проверка регистрации записи ресурса псевдонима (CNAME)

1. Откройте оснастку DNS. Чтобы открыть службу DNS, нажмите кнопку Пуск. В окне начать поиск введите днсмгмт. msc и нажмите клавишу ВВОД. Если откроется диалоговое окно Контроль учетных записей пользователей, убедитесь, что оно отображает нужное действие, и нажмите кнопку продолжить.
2. Используйте оснастку DNS, чтобы выбрать любой контроллер домена, на котором работает служба DNS-сервера, где на сервере размещается зона DNS с тем же именем, что и домен Active Directory контроллера домена.
3. В дереве консоли щелкните зону с именем _msdcs. Dns_Domain_Name.
4. В области сведений убедитесь, что имеются следующие записи ресурсов: запись ресурса псевдонима (CNAME) с именем Dsa_Guid. _msdcs. <placeholder>Dns_Domain_Name</placeholder> и соответствующую запись ресурса узла (a) для имени DNS-сервера.

Если запись ресурса псевдонима (CNAME) не зарегистрирована, убедитесь, что динамическое обновление работает правильно. Используйте тест в следующем разделе, чтобы проверить динамическое обновление.
    
## <a name="verifying-dynamic-update"></a>Проверка динамического обновления
    
Если основная проверка DNS показывает, что записи ресурсов не существуют в DNS, используйте динамический тест обновления, чтобы определить, почему служба сетевого входа в систему не зарегистрировала записи ресурсов автоматически. Чтобы убедиться, что Active Directory зона домена настроена на принятие безопасных динамических обновлений и на регистрацию тестовой записи (_dcdiag_test_record), выполните следующую процедуру. Тестовая запись удаляется автоматически после теста.

### <a name="to-verify-dynamic-updatetitle"></a>Проверка</title> динамического обновления


1. Откройте окно командной строки от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку Пуск. В окне "начать поиск" введите Командная строка. В верхней части меню Пуск щелкните правой кнопкой мыши пункт Командная строка и выберите команду Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.
2. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s:<DCName> /DnsDynamicUpdate`
   </br></br>Замените различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. В качестве альтернативы можно проверить все контроллеры домена в лесу, введя/e: вместо/s:. Если IPv6 не включен на контроллере домена, следует рассчитывать на сбой записи ресурса узла (AAAA) в тесте, что является нормальным условием, когда IPv6 не включен.

Если безопасные динамические обновления не настроены, для их настройки можно использовать следующую процедуру.

### <a name="to-enable-secure-dynamic-updates"></a>Включение безопасных динамических обновлений


1. Откройте оснастку DNS. Чтобы открыть службу DNS, нажмите кнопку Пуск. 
2. В окне начать поиск введите днсмгмт. msc и нажмите клавишу ВВОД. Если откроется диалоговое окно Контроль учетных записей пользователей, убедитесь, что оно отображает нужное действие, и нажмите кнопку продолжить.
3. В дереве консоли щелкните правой кнопкой мыши соответствующую зону и выберите пункт Свойства.
4. На вкладке Общие убедитесь, что тип зоны — интегрированная Active Directory.
5. В меню динамические обновления щелкните только безопасные.

## <a name="registering-dns-resource-records"></a>Регистрация записей ресурсов DNS
    
Если записи ресурсов DNS не отображаются в DNS для исходного контроллера домена, вы проверили динамические обновления и хотите зарегистрировать записи ресурсов DNS немедленно, можно принудительно выполнить регистрацию вручную с помощью следующей процедуры. Служба сетевого входа в систему на контроллере домена регистрирует записи ресурсов DNS, необходимые для того, чтобы контроллер домена находился в сети. Служба DNS-клиента регистрирует запись ресурса узла (A), на которую указывает запись псевдонима (CNAME).

### <a name="to-register-dns-resource-records-manuallytitle"></a>Регистрация записей ресурсов DNS вручную</title>


1. Откройте окно командной строки от имени администратора. Чтобы открыть командную строку от имени администратора, нажмите кнопку Пуск. 
2. В окне "начать поиск" введите Командная строка. 
3. В верхней части меню Пуск щелкните правой кнопкой мыши пункт Командная строка и выберите команду Запуск от имени администратора. Если отобразится диалоговое окно Контроль учетных записей пользователей, подтвердите, что отображаемое в нем действие - то, которое требуется, и нажмите кнопку Продолжить.
4. Чтобы вручную инициировать регистрацию записей ресурсов локатора контроллеров домена на исходном контроллере домена, в командной строке введите следующую команду и нажмите клавишу ВВОД: `net stop netlogon && net start netlogon`
5. Чтобы инициировать регистрацию записи ресурса узла (A) вручную, в командной строке введите следующую команду и нажмите клавишу ВВОД: `ipconfig /flushdns && ipconfig /registerdns`
6. В командной строке введите следующую команду и нажмите клавишу ВВОД: `dcdiag /test:dns /v /s:<DCName>` </br></br>Замените различающееся имя, имя NetBIOS или DNS-имя контроллера домена для &lt;DCName&gt;. Проверьте выходные данные теста, чтобы убедиться, что тесты DNS пройдены. Если IPv6 не включен на контроллере домена, следует рассчитывать на сбой записи ресурса узла (AAAA) в тесте, что является нормальным условием, когда IPv6 не включен.
