---
ms.assetid: b11f7a65-ec7b-4c11-8dc4-d7cabb54cd94
title: Устранение неполадок репликации Active Directory
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: ffc0933f70a2ab518c575a944efdac4c2dcd6a1a
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59869425"
---
# <a name="troubleshooting-active-directory-replication-problems"></a>Устранение неполадок репликации Active Directory

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Проблемы с репликацией Active Directory может иметь несколько различных источников. Например проблемы доменных имен (DNS), сетевых проблем или проблем безопасности может все привести к отказу репликации Active Directory. 

Остальной части этого раздела описываются средства и общая методика для исправления ошибок репликации Active Directory. Симптомы, причины и способы устранения ошибки репликации, определенных, рассматриваются следующие подразделы:

## <a name="introduction-and-resources-for-troubleshooting-active-directory-replication"></a>Общие сведения и ресурсы для устранения неполадок репликации Active Directory

Входящего трафика или вызывает сбой исходящую репликацию Active Directory объекты, представляющие топологию репликации, расписание репликации, контроллеры домена, пользователей, компьютеров, пароли, группы безопасности, членства в группах и групповой политики несогласованное между контроллерами домена. Сбой репликации и несогласованности Directory операционных сбоев или несогласованные результаты в зависимости от контроллера домена, к которому производится обращения для операции и избежать применения групповой политики и разрешения доступа. Доменных служб Active Directory (AD DS) зависит от сетевого подключения, разрешение имен, проверки подлинности и авторизации, база данных каталогов, топологии репликации и механизм репликации. При первопричину проблемы репликации не сразу очевидно, определение причины многих возможными причинами требует систематический исключения потенциальных причин.

Средство Пользовательским интерфейсом для наблюдения за репликацией и диагностировать ошибки, см. в разделе [средства состояния репликации Active Directory](https://www.microsoft.com/download/details.aspx?id=30005)

Для полный документ, который описывает, как можно использовать средство Repadmin для устранения неполадок Active Directory Репликация доступна; см. в разделе [мониторинг и устранение неполадок Active Directory репликации с помощью Repadmin](https://go.microsoft.com/fwlink/?LinkId=122830).

Сведения о работе репликации Active Directory см. следующие технические справочники:

- [Технический справочник по модели репликации Active Directory](https://go.microsoft.com/fwlink/?LinkId=65958)
- [Технический справочник по топологии репликации Active Director](https://go.microsoft.com/fwlink/?LinkId=93578)

## <a name="event-and-tool-solution-recommendations"></a>Рекомендации по решению событий и средства

В идеальном случае красный (ошибка) и желтой (предупреждение) события в журнал событий службы каталогов предложить конкретного ограничения, вызвавших сбой репликации контроллера домена источника или назначения. Если сообщение о событии предлагает действия для решения, выполните действия, описанные в данном событии. Средство Repadmin и другим средствам диагностики также предоставляют сведения, которые могут помочь устранить ошибки репликации. 

Подробные сведения об использовании Repadmin для устранения неполадок репликации, см. в разделе [мониторинг и устранение неполадок Active Directory репликации с помощью Repadmin](https://go.microsoft.com/fwlink/?LinkId=122830).

## <a name="ruling-out-intentional-disruptions-or-hardware-failures"></a>Исключение намеренно нарушений в работе или сбоях оборудования

Иногда ошибки репликации происходят из-за намеренно нарушений в работе. Например при устранении неполадок репликации Active Directory, исключить намеренно отключений и сбоев оборудования или обновления сначала.

### <a name="intentional-disconnections"></a>Намеренное отключений

Если сообщает об ошибках репликации контроллера домена, который пытается репликации с контроллером домена, который будет построен в промежуточный сайт и в автономном режиме, ожидает его развертывания в окончательной рабочего сайта (удаленного сайта, например в филиале ), можно учесть эти ошибки репликации. Отрыв контроллер домена из топологии репликации в течение продолжительного чего непрерывные ошибки до повторного подключения контроллера домена, рассмотрите возможность добавления такие компьютеры, изначально как рядовые серверы и с помощью установки с носителя ( Метод IFM) для установки доменных служб Active Directory (AD DS). Для создания установочного носителя, который можно хранить на съемном носителе (компакт-ДИСК, DVD-диска или другого носителя) и отправки на конечный сайт можно использовать средство командной строки Ntdsutil. Затем можно использовать установочный носитель для установки AD DS на контроллерах домена на сайте, без использования репликации. 

### <a name="hardware-failures-or-upgradestitle"></a>Сбоев оборудования или обновления</title>

Если возникнут проблемы репликации из-за сбоя оборудования (например, сбоя материнской платы, дисковой подсистемы или жесткий диск), следует уведомить владельца сервера таким образом, можно устранить проблемы с оборудованием.

Периодические оборудование также может привести к контроллеров домена до обслуживания. Убедитесь, что ваш сервер владельцы имеют реализацию хорошей системы связи такие простои заранее.

### <a name="firewall-configuration"></a>Конфигурация брандмауэра

По умолчанию Active Directory репликации удаленные вызовы процедур (RPC) происходят динамически через доступный порт через RPC Endpoint Mapper (RPCSS) через порт 135. Убедитесь, что брандмауэр Windows с повышенной безопасности и другие брандмауэры настроены правильно, чтобы разрешить для репликации. Сведения об указании порт для репликации Active Directory и параметров портов, см. в разделе [статьи базы знаний Майкрософт 224196](https://go.microsoft.com/fwlink/?LinkId=22578). 

Сведения о портах, используемых в репликации Active Directory, см. в разделе [средства репликации Active Directory и параметров](https://go.microsoft.com/fwlink/?LinkId=123774).

Сведения об управлении репликации Active Directory через брандмауэры, см. в разделе [репликация Active Directory через брандмауэры](https://go.microsoft.com/fwlink/?LinkId=123775).

## <a name="responding-to-failure-of-an-outdated-server-running-windows-2000-server"></a>Реакция на ошибку устаревшие сервера под управлением Windows 2000 Server

Если контроллер домена под управлением Windows 2000 Server не удалось дольше, чем число дней во времени существования отметки полного удаления, решение всегда одинаков: 

1. Перемещение сервера из корпоративной сети к частной сети.
2. Принудительно удалите Active Directory или переустановить операционную систему.
3. Удаление метаданных сервера из Active Directory, таким образом, объект сервера не восстановлена. 

Можно использовать сценарий для очистки метаданных сервера, в большинстве операционных систем Windows. Сведения об использовании этого скрипта, см. в разделе [удалить Active Directory метаданные контроллера домена](https://go.microsoft.com/fwlink/?LinkID=123599). 

По умолчанию объектов параметров NTDS, удаляются восстановлена автоматически в течение 14 дней. Таким образом Если вы не удалите метаданные сервера (используйте программу Ntdsutil или сценарий, описанный ранее, чтобы выполнить очистку метаданных), метаданные сервера будут восстановлены в каталоге, в котором происходят попытки репликации. В этом случае будут регистрироваться ошибки постоянно из-за невозможности реплицировать с помощью отсутствует контроллер домена.

## <a name="root-causes"></a>Основные причины

Если исключить намеренно отключений, сбоев оборудования и устаревшие контроллеров домена Windows 2000, остальная часть проблем репликации почти всегда необходим один из следующих причин:

- Сетевое подключение: Сетевое подключение может быть недоступна, или неправильно настроены параметры сети.
- Разрешение имен: Неверные настройки DNS являются распространенной причиной сбоев репликации.
- Проверка подлинности и авторизации: Проблемы проверки подлинности и авторизации ошибки «Отказано в доступе» при попытке подключиться к участнику репликации контроллера домена.
- Каталог базы данных (хранилище): Базы данных каталогов не может быть возможность обработки транзакций достаточно быстро справиться с тайм-ауты репликации.
- Механизм репликации: Если расписания межсайтовой репликации, являются слишком короткий, очередей репликации может быть слишком большим для обработки по времени, который необходим для расписания исходящую репликацию. В этом случае репликация некоторых изменений может быть бесконечно потенциально остановленная, long, превышает время жизни захоронения.
- Топология репликации: Контроллеры домена должны межсайтовой ссылки в AD DS, сопоставляются с реальных глобальной сети (WAN) или виртуальной частной сети (VPN). При создании объектов в AD DS для топологии репликации, которые не поддерживаются фактический сайт топологии сети, требующий неправильно настроенные топологии репликации завершается сбоем.

## <a name="general-approach-to-fixing-problems"></a>Общий подход к исправлению проблем

Используйте следующий общий подход к Устранение проблем репликации: 

1. Мониторинг работоспособности репликации ежедневно, или используйте Repadmin.exe, чтобы получить состояние репликации ежедневно.
2. Попытайтесь устранить все ошибки, о которой своевременно с помощью методов, описанных в сообщения о событиях и в этом руководстве. Если программное обеспечение может причиной проблемы, удалите программное обеспечение, прежде чем продолжить с другими решениями.
3. Если неполадки, приводящие к сбою репликации не удается разрешить известные методы, удалите с сервера AD DS, а затем переустановите AD DS. Дополнительные сведения о повторной установки AD DS, см. в разделе [списание контроллера домена](https://go.microsoft.com/fwlink/?LinkId=128290).
4. Если нельзя удалить AD DS обычно, когда сервер подключен к сети, используйте один из следующих методов для устранения проблемы.

   - Принудительное удаление AD DS в службы восстановления режиме каталогов (DSRM), Очистка метаданных сервера, а затем переустановите AD DS.
   - Переустановить операционную систему и перестройте контроллера домена.

Дополнительные сведения о Принудительное удаление AD DS, см. в разделе [Принудительное удаление контроллера домена](https://go.microsoft.com/fwlink/?LinkId=128291).

## <a name="using-repadmin-to-retrieve-replication-statustitle"></a>Получение состояния репликации с помощью Repadmin</title>

Состояние репликации является важным способом для оценки состояния службы каталогов. Если репликация работает без ошибок, вы знаете, контроллеры домена, которые находятся в оперативном режиме. Также вы знаете, что работа следующих систем и служб:


- Инфраструктура DNS
- Протокол проверки подлинности Kerberos
- Служба времени Windows (W32time)
- Удаленный вызов процедур (RPC)
- Сетевое подключение

Используйте Repadmin ежедневно мониторинг состояния репликации, выполнив команду, которая оценивает состояние репликации для всех контроллеров домена в лесу. Процедура создает CSV-файл, который можно открыть в Microsoft Excel и фильтр для сбоев репликации.

Можно использовать следующую процедуру, чтобы получить состояние репликации всех контроллеров домена в лесу. 

Требования

Для выполнения данной процедуры требуется как минимум членство в группе **Администраторы предприятия** или в эквивалентной группе. 

Средства.

- Repadmin.exe
- Excel (Microsoft Office)

### <a name="to-generate-a-repadmin-showrepl-spreadsheet-for-domain-controllers"></a>Чтобы создать таблицу /showrepl repadmin для контроллеров домена

1. Откройте командную строку с правами администратора: В меню «Пуск» щелкните правой кнопкой мыши командную строку и нажмите кнопку Запуск от имени администратора. Если появится диалоговое окно контроля учетных записей, ввод учетных данных "Администраторы предприятия", в том случае, если это необходимо и нажмите кнопку Продолжить.
2. В командной строке введите следующую команду и нажмите клавишу ВВОД: `repadmin /showrepl * /csv > showrepl.csv`
3. Откройте Excel.
4. Нажмите кнопку Office, нажмите кнопку Открыть, перейдите к showrepl.csv и нажмите кнопку Открыть.
5. Скрытие или удаление столбца A, а также столбец тип транспорта, как показано ниже:
6. Выберите столбец, который требуется скрыть или удалить.

   - Чтобы скрыть столбец, щелкните правой кнопкой мыши столбец и нажмите кнопку Hide.
   - Чтобы удалить столбец, щелкните правой кнопкой мыши выбранный столбец и щелкните Удалить.

7. Выберите строку 1 ниже строку заголовков столбцов. На вкладке «Вид» щелкните Закрепить области и нажмите кнопку заморозить верхней строки.
8. Выберите всей таблицы. На вкладке "данные" нажмите кнопку "Фильтр".
9. В столбце время последнего успешного щелкните стрелку вниз и нажмите кнопку сортировки по возрастанию.
10. В столбце исходный контроллер домена выберите фильтр, Стрелка вниз, пункты текстовые фильтры и затем щелкните настраиваемый фильтр.
11. В настраиваемый Автофильтр диалоговом окне в разделе Показать строки, где, нажмите кнопку Нет. В соседнем текстовом поле введите <userInput>del</userInput> можно исключить из представления результатов для удаленных контроллеров домена.
12. Повторите шаг 11 для столбца время последнего сбоя, но значение не равно, а также введите значение 0.
13. Устранение сбоев репликации.

Для каждого контроллера домена в лесу, в таблице показано исходного партнера репликации, время последнего возникновения репликации и время последнего сбоя репликации для каждого контекста именования (раздел каталога). С помощью автофильтра в Excel, вы можете проверить работоспособность репликации для работы только контроллеры домена, не удается только контроллеры домена или контроллерах домена, являющихся минимальных или большинство текущего, и вы увидите партнеров репликации, которые реплицируются успешно.

## <a name="replication-problems-and-resolutions"></a>Проблемы репликации и способы их устранения

Проблемы репликации отображается в сообщения о событиях, а также в различных сообщениях об ошибках, возникающих, когда приложение или служба попытается выполнить операцию. В идеале эти сообщения собираются для мониторинга приложения или при получении состояния репликации.

Большинство проблем репликации, определяются в сообщения о событиях, которые записываются в журнал событий службы каталогов. Проблемы репликации также может быть определено в виде сообщения об ошибках в выходных данных <system>repadmin /showrepl</system> команды.

### <a name="repadmin-showrepl-error-messages-that-indicate-replication-problems"></a>repadmin /showrepl сообщениях об ошибках указывают на проблемы репликации

Чтобы обнаружить проблемы с репликацией Active Directory, используйте <system>repadmin /showrepl</system> команды, как описано в предыдущем разделе. В следующей таблице показаны сообщения об ошибках, эта команда создает, а также основных причин ошибок и ссылки на разделы, которые предоставляют решения для ошибки.

|Ошибка repadmin|Основная причина|Решение|
| --- | --- | --- |
|Время с момента последней репликации с этим сервером превышает время жизни объекта-захоронения.|Контроллер домена не удалось входящей репликации с контроллером домена исходным, long, достаточно для удаления для захоронения, реплицируются и сбора мусора из AD DS.|Событие с Идентификатором 2042 Прошло слишком много времени с момента репликации|
|Не входящий соседей.|Если элементы не отображаются в разделе «Соседей входящего трафика» выходные данные, создаваемые repadmin /showrepl, контроллер домена не удалось установить связи репликации с другим контроллером домена.|Устранение проблем подключения при репликации (событие с идентификатором 1925)| 
|Доступ запрещен.|Существует связь репликации между контроллерами домена, но репликации не может быть выполнена неправильно из-за сбоя проверки подлинности.|Устранение проблем с безопасностью при репликации| 
|Последняя попытка < Дата и время > сбой с «целевой учетной записи указано неверное имя.»|Этой проблемы могут быть связаны с подключением, DNS или проблемами проверки подлинности. Если это ошибка DNS, локальный контроллер домена не удалось разрешить глобально уникальный идентификатор (GUID) — на основе DNS-имя его партнером репликации.|Исправление репликации DNS Lookup проблем (события с идентификаторами 1925, 2087, 2088) исправления безопасности проблем репликации решение проблем с подключением репликации (событие с Идентификатором 1925)| 
|Ошибка LDAP 49.|Учетной записи компьютера контроллера домена не может синхронизироваться с помощью центра распространения ключей (KDC).|Устранение проблем с безопасностью при репликации| 
|Не удается открыть подключение LDAP локальном узле.|Средство администрирования не удалось связаться с AD DS.|Устранение проблем поиска в DNS при репликации (события с идентификаторами 1925, 2087, 2088)| 
|Репликация Active Directory было замещено.|Ход выполнения входящей репликации был прерван запрос репликации с более высоким приоритетом, таких как запрос, который был создан вручную с помощью команды repadmin/sync.|Дождитесь завершения репликации. Это информационное сообщение указывает нормальной работы.| 
|Учтена репликации, ожидающих.| Контроллер домена учтена запрос репликации и ожидает ответа. Выполняется репликация из этого источника.|Дождитесь завершения репликации. Это информационное сообщение указывает нормальной работы.| 

В следующей таблице перечислены распространенные события, которые могут свидетельствовать о проблемах с Active Directory, репликация, вместе с корневой причины проблем и ссылки на разделы, которые предоставляют решения для проблем. 

|Идентификаторы и источники|Основную причину|Решение|
| --- | --- | --- | 
|1311 NTDS KCC|Сведения о конфигурации репликации в Доменных службах Active Directory не точно отражает физической топологии сети.|Устранение проблем топологии репликации (событие с идентификатором 1311)| 
|Репликация 1388 NTDS|Согласованность Strict репликации не действует и устаревший объект будет реплицирована на контроллер домена.|Устранение проблем с устаревшими объектами при репликации (события с идентификаторами 1388, 1988, 2042)|
|1925 NTDS KCC|Не удалось установить связь репликации для записи раздела каталога. Это событие может иметь различные причины, в зависимости от ошибки.| Исправление проблем подключения при репликации проблем (событие с Идентификатором 1925) исправление репликации DNS Lookup (события с идентификаторами 1925, 2087, 2088)| 
|Репликация 1988 NTDS|Локальный контроллер домена попытался реплицировать объект от исходного контроллера домена, который не установлен на локальный контроллер домена, так как была удалена и уже сборщиком мусора. Репликация не начнется для этого раздела каталога с этим партнером, пока ситуация исправлена.|Устранение проблем с устаревшими объектами при репликации (события с идентификаторами 1388, 1988, 2042)|
|2042 NTDS репликации|Репликация не выполнялась с этим партнером для времени жизни захоронения, а не удается продолжить репликацию.|Устранение проблем с устаревшими объектами при репликации (события с идентификаторами 1388, 1988, 2042)| 
|Репликация 2087 NTDS|AD DS не удалось разрешить имя узла DNS исходного контроллера домена на IP-адрес и репликации не удалось.|Устранение проблем поиска в DNS при репликации (события с идентификаторами 1925, 2087, 2088)| 
|2088 NTDS репликации |AD DS не удалось разрешить имя узла DNS исходного контроллера домена в IP-адрес, но репликация выполнена успешно.|Устранение проблем поиска в DNS при репликации (события с идентификаторами 1925, 2087, 2088)|
|5805 сетевого входа в систему|Учетной записи компьютера не удалось пройти проверку подлинности, который обычно вызвано либо несколько экземпляров с тем же именем компьютера или имя компьютера, не реплицируется на все контроллеры доменов.|Устранение проблем с безопасностью при репликации| 

Дополнительные сведения об основных понятиях репликации см. в разделе [технологии репликации Active Directory](https://go.microsoft.com/fwlink/?LinkId=41950).
  
## <a name="next-steps"></a>Следующие шаги

Дополнительные сведения включая поддержку статей, посвященных коды ошибок см. в статье службы поддержки: [Способы устранения распространенных ошибок репликации Active Directory](https://support.microsoft.com/help/3108513)
