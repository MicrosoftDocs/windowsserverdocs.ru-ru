---
ms.assetid: b11f7a65-ec7b-4c11-8dc4-d7cabb54cd94
title: "Устранение неполадок репликации Active Directory"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: eb93ea7cab297d70aa86b71bd5466004e47bfeaf
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="troubleshooting-active-directory-replication-problems"></a>Устранение неполадок репликации Active Directory

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012


Проблемы с репликацией Active Directory может иметь несколько разных источников. Например проблемы доменных имен (DNS), сетевых проблем или проблем с безопасностью можно вызывают сбой репликации Active Directory. 

Остальная часть этого раздела описываются средства и общая методология, чтобы устранить ошибки репликации Active Directory. Практические, демонстрирующий способы устранения проблем репликации Active Directory, в разделе [Виртуальные лаборатории TechNet: Устранение ошибок репликации Active Directory](https://go.microsoft.com/?linkid=9844718)

Следующие разделы рассматриваются проблемы, причины и способы устранения ошибки репликации определенных:
   
[Устранение проблем с устаревшими объектами репликации (события с идентификаторами 1388, 1988, 2042)](https://technet.microsoft.com/library/cc949124.aspx)
  
[Устранение проблем безопасности репликации](https://technet.microsoft.com/library/cc949132.aspx)

[Устранение проблем поиска DNS репликации (события с идентификаторами 1925, 2087, 2088)](https://technet.microsoft.com/library/cc949133.aspx)
  
[Устранение проблем подключения при репликации (событие с Идентификатором 1925)](https://technet.microsoft.com/library/cc949131.aspx)
  
[Устранение проблем топологии репликации (событие с Идентификатором 1311)](https://technet.microsoft.com/library/cc949129.aspx)
  
[Проверка работоспособности DNS для поддержки репликации каталогов](https://technet.microsoft.com/library/dd728017.aspx)
  
[Ошибка репликации 8614: Active нельзя репликацию Directory с этим сервером, поскольку время с момента последней репликации с этим сервером превышает время жизни захоронения](https://technet.microsoft.com/library/replication-error-8614-the-active-directory-cannot-replicate-with-this-server-because-the-time-since-the-last-replication-with-this-server-has-exceeded-the-tombstone-lifetime.aspx)
     
[Ошибка репликации 8524 DSA операция не удается продолжить из-за ошибки поиска в DNS](https://technet.microsoft.com/library/replication-error-8524-the-dsa-operation-is-unable-to-proceed-because-of-a-dns-lookup-failure.aspx)
   
[Ошибка репликации 8456 или 8457: исходный | конечный сервер в настоящий момент отвергает запросы на репликацию](https://technet.microsoft.com/library/replication-error-8456-the-source-server-is-currently-rejecting-replication-requests-or-replication-error-8457-the-destination-server-is-currently-rejecting-replication-requests.aspx)
   
[Было отказано в 8453: репликации доступ к репликации ошибка](https://technet.microsoft.com/library/replication-error-8453-replication-access-was-denied.aspx)
  
[Ошибка репликации 8452: контекст именования находится в процессе удаления или не был реплицирован с указанного сервера](https://technet.microsoft.com/library/replication-error-8452-the-naming-context-is-in-the-process-of-being-removed-or-is-not-replicated-from-the-specified-server.aspx)
   
[Ошибка репликации 5 доступ запрещен](https://technet.microsoft.com/library/replication-error-5-access-is-denied.aspx)
  

      
      

  
[Ошибка репликации-2146893022: главное конечное имя указана неверно](https://technet.microsoft.com/library/replication-error-2146893022-the-target-principal-name-is-incorrect.aspx)
  

      
      

  
[Существует ошибка репликации 1753: нет доступных конечных точек конечных точек](https://technet.microsoft.com/library/replication-error-1753-there-are-no-more-endpoints-available-from-the-endpoint-mapper.aspx)
  

      
      

  
[Ошибка репликации 1722 сервер RPC недоступен](https://technet.microsoft.com/library/replication-error-1722-the-rpc-server-is-unavailable.aspx)
  

      
      

  
[Ошибка репликации 1396 входа в систему не произведен целевой учетная запись указана неверно](https://technet.microsoft.com/library/replication-error-1396-logon-failure-the-target-account-name-is-incorrect.aspx)
  

      
      

  
[Ошибка репликации 1256: удаленная система недоступен](https://technet.microsoft.com/library/replication-error-1256-the-remote-system-is-not-available.aspx)
  

      
      

  
[При обращении к жесткому диску операции диска Ошибка репликации 1127: Зафиксирован многократный сбой](https://technet.microsoft.com/library/replication-error-1127-while-accessing-the-hard-disk-a-disk-operation-failed-even-after-retries.aspx)
  

      
      

  
[Ошибка репликации 8451 операции репликации произошла ошибка базы данных](https://technet.microsoft.com/library/replication-error-8451-the-replication-operation-encountered-a-database-error.aspx)
  

      
      

  
[Репликация ошибка 8606: задано недостаточно атрибутов для создания объекта](https://technet.microsoft.com/library/replication-error-8606-insufficient-attributes-were-given-to-create-an-object.aspx)
  

## <a name="introduction-and-resources-for-troubleshooting-active-directory-replication"></a>Общие сведения и ресурсы для устранения неполадок репликации Active Directory

Входящей или исходящей репликации сбой вызывает объектов Active Directory, представляющие топологию репликации, расписание репликации, контроллеры домена, пользователей, компьютеров, пароли, группы безопасности, членства в группах и групповой политики, будут несогласованными между контроллерами домена. Сбой Directory несогласованность и репликации становятся причиной сбоев рабочей или непредсказуемым результатам, в зависимости от контроллера домена, к которому производится обращения для операции и предотвратить применения групповой политики и разрешения доступа. Зависит от доменных служб Active Directory (AD DS) на сетевое подключение, разрешения имен, проверки подлинности и авторизации, базы данных каталога, топологии репликации и механизм репликации. Когда основной причины неполадки репликации не сразу становится понятно, определения причины среди множество возможных причин требует систематические исключения вероятные причины. 

Средство на основе пользовательского интерфейса для наблюдения за репликацией и диагностики ошибок, в разделе [средства состояние репликации Active Directory](https://www.microsoft.com/download/details.aspx?id=30005). Существует также [лабораторию](https://go.microsoft.com/?linkid=9844718), показано, как использовать состояние репликации Active Directory и другие средства для устранения ошибок. 

Для полный документ, который описывает, как использовать средство Repadmin для устранения неполадок Active Directory Репликация доступна; в разделе [мониторинг и устранение неполадок репликации Active Directory с помощью Repadmin](https://go.microsoft.com/fwlink/?LinkId=122830).

Сведения о том, как работает репликации Active Directory см. в следующих источниках:


- [Технический справочник по модели репликации Active Directory](https://go.microsoft.com/fwlink/?LinkId=65958)
- [Технический справочник по топологии репликации Active Director](https://go.microsoft.com/fwlink/?LinkId=93578)

## <a name="event-and-tool-solution-recommendations"></a>События и средство рекомендации для решения

В идеальном случае красного (ошибка) и желтый (предупреждение) события в журнал событий службы каталогов предложить конкретного ограничения, которая вызывает сбой репликации контроллера домена источника или назначения. Если сообщение о событии предлагаются действия для решения, выполните действия, описанные в данном событии. Средство Repadmin и другие средства диагностики также предоставляют сведения о том, как устранить ошибки репликации. 

Подробные сведения об использовании Repadmin для устранения неполадок репликации см. в разделе [мониторинг и устранение неполадок репликации Active Directory с помощью Repadmin](https://go.microsoft.com/fwlink/?LinkId=122830).

## <a name="ruling-out-intentional-disruptions-or-hardware-failures"></a>Исключение преднамеренного сбоев или отказов оборудования

Иногда случаются ошибки репликации из-за намеренного сбоев. Например при устранении неполадок репликации Active Directory исключения преднамеренного отключениях и сбоев оборудования или обновления сначала.

### <a name="intentional-disconnections"></a>Отключение преднамеренно.

Если отчеты об ошибках репликации на контроллере домена, предпринимается попытка репликации с контроллером домена, который был собран в промежуточном сайте и в автономном режиме, ожидает его развертывание в окончательной рабочего сайта (удаленного сайта, например в офисе филиала), можно учетной записи для этих ошибок репликации. Отрыв контроллера домена от топологии репликации в течение продолжительного, что приводит к возникновению ошибок непрерывной до повторного подключения контроллера домена, рассмотрите возможность добавления такие компьютеры изначально как рядовых серверах и с помощью установки с носителя (IFM) метод для установки доменных служб Active Directory (AD DS). Для создания установочного носителя, который можно сохранить на съемном носителе (компакт-ДИСК, DVD-диска или другого носителя) и поставляется на конечный сайт можно использовать средство командной строки Ntdsutil. Затем можно использовать установочный носитель для установки AD DS на контроллерах домена на сайте без использования репликации. 

### <a name="hardware-failures-or-upgradestitle"></a>Сбои оборудования или установки обновлений</title>

При возникновении проблем репликации из-за сбоя оборудования (например, ошибка системную плату, дисковой подсистемы или жесткий диск), следует уведомите владельца сервера, можно устранить проблемы с оборудованием.

Обновления периодические оборудования также могут вызвать контроллеров домена для обслуживания. Убедитесь, что ваш сервер владельцев хорошо системы заранее информирования такие сбои в работе.

### <a name="firewall-configuration"></a>Конфигурация брандмауэра

По умолчанию Active Directory репликация удаленные вызовы процедур (RPC) выполняются динамически через доступный порт через сопоставления конечных точек RPC (RPCSS) через порт 135. Убедитесь, что брандмауэр Windows в режиме повышенной безопасности и других брандмауэров правильно настроены для репликации. Сведения об указании порта для репликации Active Directory и параметров портов см. в разделе [статьи базы знаний Майкрософт 224196](https://go.microsoft.com/fwlink/?LinkId=22578). 

Сведения о портах, используемых репликации Active Directory см. в разделе [средства репликации Active Directory и параметров](https://go.microsoft.com/fwlink/?LinkId=123774). 

Сведения об управлении репликации Active Directory через брандмауэры см. в разделе [репликации Active Directory через брандмауэры](https://go.microsoft.com/fwlink/?LinkId=123775).

## <a name="responding-to-failure-of-an-outdated-server-running-windows-2000-server"></a>Реакция на ошибку устаревшие сервера под управлением Windows 2000 Server

Если контроллер домена под управлением Windows 2000 Server произошел сбой дольше, чем число дней в время жизни захоронения, решение остается неизменным: 

1. Перенос сервера из корпоративной сети к частной сети.
2. Принудительно удалить Active Directory, либо переустановить операционную систему.
3. Удаление метаданных сервера из Active Directory, чтобы объект-сервер не восстановлена. 

Очистка метаданных сервера в большинстве операционных систем Windows, можно использовать сценарий. Сведения об использовании этого сценария см. в разделе [удалить Active Directory метаданные контроллера домена](https://go.microsoft.com/fwlink/?LinkID=123599). 

По умолчанию объектов параметров NTDS, которые удаляются восстановлен автоматически в течение 14 дней. Таким образом Если вы не удалите метаданные сервера (используйте программу Ntdsutil или сценария, упоминалось ранее, чтобы выполнить очистку метаданных), в каталог, который запрашивает попытки репликации возникает активирует метаданные сервера. В этом случае записи ошибок постоянно в результате невозможность репликация с контроллера домена отсутствует.

## <a name="root-causes"></a>Основные причины

Если правило преднамеренного отключениях, сбои оборудования и устаревших контроллеры домена Windows 2000, дальнейших проблем с репликацией почти всегда иметь один из следующих причин: 


- Сетевого подключения: сетевое подключение может быть не доступны, или неправильно настроены параметры сети.
- Разрешение имен: неверные настройки DNS — это распространенная причина сбоя репликации.
- Проверка подлинности и авторизация: проблемы проверки подлинности и авторизации ошибки «Доступ запрещен» при попытке подключения к его партнером репликации контроллера домена.
- Базы данных каталога (хранилище): базы данных каталога не может быть возможность обработки транзакций достаточно быстро справиться с тайм-аутов репликации.
- Механизм репликации: Если слишком короткий расписания межсайтовой репликации, репликация очереди могут быть слишком большим, чтобы обработать за время, необходимое для расписания исходящей репликации. В этом случае репликация некоторые изменения могут быть остановленная indefinitelypotentially достаточно большим, чтобы превышает время жизни захоронения.
- Топология репликации: контроллеров домена должен быть межсайтовой ссылки в Доменных службах Active Directory, сопоставления реальных глобальной сети (WAN) или подключения к виртуальной частной сети (VPN). При создании объектов в AD DS для топологии репликации, не поддерживаемые топологии сайта сети, требующей неверной настройки топологии репликации не удается.

## <a name="general-approach-to-fixing-problems"></a>Общий подход к Устранение проблем

Используйте следующие общий подход к Устранение проблем репликации. 


1. Отслеживать работоспособность репликации ежедневно или используйте Repadmin.exe для получения информации о состоянии репликации ежедневно.
2. Попробуйте устранить все ошибки, о которой своевременно с помощью методов, описанных в сообщения о событиях и в этом руководстве. Если программное обеспечение может причиной проблемы, удалите программное обеспечение, прежде чем продолжить с другими решениями.
3. Если не удается разрешить проблему, вызывающую сбой репликации с использованием любых известных методов, удалите AD DS с сервера, а затем переустановите AD DS. Дополнительные сведения о переустановке AD DS см. в разделе [списание контроллера домена](https://go.microsoft.com/fwlink/?LinkId=128290).
4. Если в Доменных службах Active Directory невозможно удалить обычным способом, когда данный сервер подключен к сети, используйте один из следующих методов для устранения проблемы:
 

    - Принудительное удаление AD DS в службы восстановления режим (Каталогов), очистить метаданные сервера, а затем переустановите AD DS.
    - Переустановить операционную систему и заново создайте контроллера домена.

Дополнительные сведения о Принудительное удаление AD DS см. в разделе [Принудительное удаление контроллера домена](https://go.microsoft.com/fwlink/?LinkId=128291).

## <a name="using-repadmin-to-retrieve-replication-statustitle"></a>С помощью Repadmin, чтобы получить информацию о состоянии репликации</title>

Состояние репликации является важным способом для оценки состояния службы каталогов. Если репликация работает без ошибок, знаете, контроллеры домена, которые находятся в оперативном режиме. Также вы знаете, что работают следующие системы и служб:


- Инфраструктура службы DNS
- Протокол проверки подлинности Kerberos
- Служба времени Windows (W32time).
- Удаленный вызов процедур (RPC)
- Подключение к сети

Используйте Repadmin ежедневно мониторинг состояния репликации, выполнив команду, которая оценивает состояние репликации всех контроллеров домена в лесу. Процедура создает CSV-файл, который можно открыть в Microsoft Excel и фильтр для сбоев репликации.

Можно использовать следующую процедуру, чтобы получить состояние репликации всех контроллеров домена в лесу. 
      
Требования к
      
Членство в группе **"Администраторы предприятия"**, или в эквивалентной минимальным требованием для выполнения этой процедуры. 

Средства: 


- Repadmin.exe 
- Excel (Microsoft Office)

### <a name="to-generate-a-repadmin-showrepl-spreadsheet-for-domain-controllers"></a>Для создания repadmin /showrepl электронную таблицу для контроллеров домена



1. Откройте командную строку с правами администратора: меню "Пуск", щелкните правой кнопкой мыши командную строку и выберите пункт Запуск от имени администратора. Если появляется диалоговое окно контроля учетных записей, учетные данные администраторов предприятия, если требуется и нажмите кнопку Далее. 
2. В командной строке введите следующую команду и нажмите клавишу ВВОД:`repadmin /showrepl * /csv &gt;showrepl.csv`
3. Откройте Microsoft Excel.
4. Нажмите кнопку "Office", нажмите кнопку Открыть, перейдите к showrepl.csv и нажмите кнопку Открыть.
5. Скрыть или удалить столбец А, а также тип транспорта столбца, как показано ниже:
6. Выберите столбец, который вы хотите скрыть или удалить.
      

    - Чтобы скрыть столбец, щелкните правой кнопкой мыши столбец и нажмите кнопку Скрыть.
    - Чтобы удалить столбец, щелкните правой кнопкой мыши выбранный столбец и нажмите клавишу Delete.
7. Выберите строку 1 под строку заголовков столбцов. На вкладке «Вид» щелкните Закрепить области и нажмите кнопку Закрепить верхнюю строку.
8. Выберите всей таблицы. На вкладке «данные» нажмите кнопку "Фильтр".
9. В столбце время последнего успешного щелкните стрелку вниз и нажмите кнопку Сортировка по возрастанию.
10. В столбце исходный контроллер домена выберите фильтр, Стрелка вниз, точки фильтры текст и выберите пункт пользовательский фильтр.
11. В пользовательский Автофильтр диалоговом окне, в разделе Показать строки, где, нажмите кнопку не содержит. Введите в текстовом поле рядом, <userInput>del</userInput> чтобы исключить из представления результатов для удаленные контроллеры домена.
12. Повторите шаг 11 для последнего сбоя времени столбец, но используйте значение не равно, а также введите значение 0.
13. Разрешить сбои репликации.

Для каждого контроллера домена в лесу, электронную таблицу показаны исходного партнера репликации, время последнего произошла репликации и время последнего сбой репликации для каждого контекста именования (раздел directory). С помощью автофильтра в Excel, можно просмотреть работоспособность репликации для работы только контроллеры домена, его только для контроллеров домена и контроллерами домена, как минимум или большинство текущего и вы увидите партнеров репликации, которые реплицируются успешно.

## <a name="replication-problems-and-resolutions"></a>Проблемы репликации и способы их устранения
    
Проблемы репликации, отображаются в сообщения о событиях и различные сообщения об ошибках, которые возникают, когда приложение или служба попытается выполнить операцию. В идеальном случае эти сообщения собираются мониторинга приложения или при получить информацию о состоянии репликации.

Большинство проблем репликации определяются в событий сообщений, которые записываются в журнал событий службы каталогов. Проблемы репликации также могут быть выявлены в форме сообщений об ошибках в выходных данных <system>repadmin /showrepl</system> команды. 

### <a name="repadmin-showrepl-error-messages-that-indicate-replication-problems"></a>REPADMIN /showrepl сообщения об ошибках, которые указывают на проблемы репликации

Чтобы идентифицировать проблемы с репликацией Active Directory, используйте <system>repadmin /showrepl</system> команды, как описано в предыдущем разделе. В следующей таблице показаны сообщения об ошибках, эта команда создает, а также основных причин возникновения ошибок и ссылки на разделы, которые предоставляют решения для ошибки.


|Ошибка repadmin|Основной причины|Решение|
| --- | --- | --- |
|Время с момента последней репликации с этим сервером превышает время жизни захоронения.|Контроллер домена не удалось выполнить входящая репликация с контроллера домена исходным длинный, достаточно для удаления, захоронения, реплицировать и в качестве мусора из AD DS.|Событие с Идентификатором 2042: Прошло слишком много времени с момента репликации этого компьютера|
|Входящий соседей нет.|Если элементы не отображаются в разделе «Входящих соседей» выходных данных, который создан с помощью repadmin /showrepl, контроллер домена не удалось установить связи репликации с другим контроллером домена.|Устранение проблем подключения при репликации (событие с Идентификатором 1925)| 
|Отказано в доступе.|Существует связь репликации между контроллерами домена, но репликации не может быть правильно выполнена из-за сбоя проверки подлинности.|Устранение проблем безопасности репликации| 
|Последняя попытка < Дата и время > не удалось «целевой учетная запись указана неверно.»|Эта проблема может связанные с подключением, DNS или проблем с проверкой подлинности. В случае ошибки DNS локального контроллера домена не удалось разрешить глобальный уникальный идентификатор (GUID) — на основе DNS-имя партнером репликации.|Исправление репликации проблем поиска в DNS проблемы (события с идентификаторами 1925, 2087, 2088) исправление репликации безопасности Устранение проблем подключения при репликации (событие с Идентификатором 1925)| 
|Ошибка LDAP 49.|Учетной записи компьютера контроллера домена может не синхронизировано с помощью центра распространения ключей (KDC).|Устранение проблем безопасности репликации| 
|Не удается открыть подключение LDAP к локальным узлом|Средство администрирования не удалось связаться со AD DS.|Устранение проблем поиска DNS репликации (события с идентификаторами 1925, 2087, 2088)| 
|Репликация Active Directory был прерван.|Ход выполнения входящая репликация была прервана по запросу репликации с более высоким приоритетом, например, запрос, который был создан вручную с помощью команды repadmin /sync.|Дождитесь завершения репликации. Это информационное сообщение указывает нормальной работе.| 
|Публикации репликации, ожидания.| Контроллер домена учтена запрос на репликацию и ожидание ответа. Репликация выполняется из этого источника.|Дождитесь завершения репликации. Это информационное сообщение указывает нормальной работе.| 

В следующей таблице перечислены часто используемых событий, которые могут указывать на проблемы с Active Directory, репликации, а также корневой причины проблемы и ссылки на разделы, которые предоставляют решения для проблем. 

|Идентификаторы и источники|Основной причины|Решение|
| --- | --- | --- | 
|ПРИ ПРОВЕРКЕ СОГЛАСОВАННОСТИ ЗНАНИЙ NTDS 1311|Сведения о конфигурации репликации в Доменных службах Active Directory не точно отражать физической топологии сети.|Устранение проблем топологии репликации (событие с Идентификатором 1311)| 
|Репликация 1388 NTDS|Согласованность Strict репликации не действует, и устаревший объект были реплицированы на контроллере домена.|Устранение проблем с устаревшими объектами репликации (события с идентификаторами 1388, 1988, 2042)|
|ПРИ ПРОВЕРКЕ СОГЛАСОВАННОСТИ ЗНАНИЙ NTDS 1925|Не удалось установить связь репликации для записи раздела каталога. Это событие может иметь различные причины, в зависимости от ошибки.| Устранение проблем подключения при репликации проблем (событие с Идентификатором 1925) исправление репликации DNS поиска (события с идентификаторами 1925, 2087, 2088)| 
|Репликация 1988 NTDS|Локальный контроллер домена попытался реплицировать объект с исходного контроллера домена, нет на локальном контроллере домена, поскольку был удален и уже сбора мусора. Репликация не выполняется для данного раздела каталога с помощью этого партнера до разрешения ситуации.|Устранение проблем с устаревшими объектами репликации (события с идентификаторами 1388, 1988, 2042)|
|2042 NTDS репликации|Репликация не произошло с этого партнера для времени жизни захоронения и не удается продолжить репликацию.|Устранение проблем с устаревшими объектами репликации (события с идентификаторами 1388, 1988, 2042)| 
|Репликация 2087 NTDS|AD DS не удалось разрешить имя DNS-узла исходного контроллера домена для IP-адрес и произошел сбой репликации.|Устранение проблем поиска DNS репликации (события с идентификаторами 1925, 2087, 2088)| 
|2088 NTDS репликации |AD DS не удалось разрешить имя DNS-узла исходного контроллера домена для IP-адреса, но репликация выполнена успешно.|Устранение проблем поиска DNS репликации (события с идентификаторами 1925, 2087, 2088)|
|5805 сетевого входа в систему|Учетной записи компьютера не прошел проверку подлинности, который обычно вызывается либо несколько экземпляров одного имени компьютера или имени компьютера, не реплицируется на каждом контроллере домена.|Устранение проблем безопасности репликации| 

Дополнительные сведения об основных понятиях репликации см. в разделе [технологии репликации Active Directory](https://go.microsoft.com/fwlink/?LinkId=41950).
  
