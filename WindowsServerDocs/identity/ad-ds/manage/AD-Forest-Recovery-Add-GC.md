---
title: Восстановление леса AD — Добавление сборщик Мусора
description: ''
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 08/09/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.technology: identity-adds
ms.openlocfilehash: 156a4a64d9c3bb8261bd603b72ae11b81ff1d152
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59825635"
---
# <a name="ad-forest-recovery---adding-the-gc"></a>Восстановление леса AD — Добавление сборщик Мусора

>Область применения. Windows Server 2016, Windows Server 2012 и 2012 R2, Windows Server 2008 и 2008 R2

Используйте следующую процедуру для добавления глобального каталога на контроллер домена.  
  
## <a name="to-add-the-global-catalog"></a>Чтобы добавить глобальный каталог  
  
1. Нажмите кнопку **запустить**, пункты **все программы**, пункты **Администрирование**, а затем нажмите кнопку **Active Directory — сайты и службы**.  
2. В дереве консоли разверните **сайты** контейнера, а затем выберите соответствующий сайт, содержащий целевой сервер.  
3. Разверните **серверы** контейнера, а затем разверните объект сервера для контроллера домена, к которому вы хотите добавить глобальный каталог.  
4. Щелкните правой кнопкой мыши **параметров NTDS**, а затем нажмите кнопку **свойства**.  
5. Выберите **глобального каталога** "флажок".  
![Добавление глобального Каталога](media/AD-Forest-Recovery-Add-GC/addgc1.png)

## <a name="to-add-the-global-catalog-using-repadmin"></a>Чтобы добавить глобальный каталог, с помощью Repadmin  

- Откройте командную строку с повышенными правами, введите следующую команду и нажмите клавишу ВВОД:  

   ```  
   repadmin.exe /options DC_NAME +IS_GC  
   ```  

Ниже приведены способы ускорить процесс добавления глобального каталога на контроллер домена в корневом домене.  

- В идеальном случае контроллер домена в корневом домене должен быть партнера репликации восстановленного контроллеров домена в доменах, отличного от root. Если это так, убедитесь, что средство проверки согласованности знаний (KCC) соответствующий **repsFrom** объекта для исходного контроллера домена и секции в корневом каталоге контроллера домена. Это можно проверить, выполнив **repadmin/showreps /v** команды. 

- Если не **repsFrom** объект создан, создайте этот объект для раздела конфигурации. Таким образом, контроллер домена в корневом домене можно определить, какие контроллеры домена в домене, отличного от root были удалены. Это можно сделать, выполнив следующие команды:  

   ```
   repadmin /add ConfigurationNamingContext DestinationDomainController SourceDomainControllerCNAME  
   ```

   ```
   repadmin /options DSA -Disable_NTDSCONN_XLATE  
   ```

   Формат *SourceDomainControllerCNAME* является:  

   ```
  
   sourceDCGuid._msdcs.root domain  
   ```

   Например, repadmin / add команды для раздела конфигурации домен contoso.com может быть:  

   ```
   repadmin /add cn=configuration,DC=contoso,DC=com DC01 937ef930-7356-43c8-88dc-8baaaa781cf6._msdcs.dDSP17A22.contoso.com  
   ```

- Если **repsFrom** объект присутствует, попытайтесь синхронизировать контроллер домена в корневом домене с контроллером домена в домене, отличного от root, следующим образом:  

   ```
   Repadmin /sync DomainNamingContext DestinationDomainController SourceDomainControllerGUID  
   ```

   Где *DestinationDomainController* контроллер домена в корневом домене и *SourceDomainController* восстановленный контроллер домена в домене, отличного от root. 

- Корневой домен DNS-сервер должен иметь записей ресурсов псевдонимов (CNAME) для исходного контроллера домена. Убедитесь, что в зону DNS содержит записи ресурсов делегирования (имя сервера (NS) и записи ресурсов узла (A)) для правильного контроллеров домена (контроллеры домена, которые были восстановлены из резервной копии) в дочерней зоне. 
- Убедитесь, что контроллер домена в корневом домене пытается связаться с правильный центр распространения ключей (KDC) в домене, отличного от root. Чтобы проверить это, в командной строке, введите следующую команду и нажмите клавишу ВВОД:  

   ```
   nltest /dsgetdc:nonroot domain name /KDC /Force  
   ```

## <a name="next-steps"></a>Следующие шаги

- [Руководство по восстановлению из леса AD](AD-Forest-Recovery-Guide.md)
- [Восстановление леса AD - процедуры](AD-Forest-Recovery-Procedures.md)  
