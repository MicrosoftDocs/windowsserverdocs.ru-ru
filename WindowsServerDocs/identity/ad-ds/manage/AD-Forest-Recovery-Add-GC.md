---
title: Восстановление леса AD — Добавление сборки мусора
ms.author: daveba
author: iainfoulds
manager: daveba
ms.date: 08/09/2018
ms.topic: article
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.openlocfilehash: 91f638c5a73b334c63a1ce765aaf0fb776806d5d
ms.sourcegitcommit: b115e5edc545571b6ff4f42082cc3ed965815ea4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2020
ms.locfileid: "93067996"
---
# <a name="ad-forest-recovery---adding-the-gc"></a>Восстановление леса AD — Добавление сборки мусора

>Область применения: Windows Server 2016, Windows Server 2012 и 2012 R2, Windows Server 2008 и 2008 R2

Используйте следующую процедуру, чтобы добавить глобальный каталог к контроллеру домена.

## <a name="to-add-the-global-catalog"></a>Добавление глобального каталога

1. Нажмите кнопку **Пуск** , укажите пункт **все программы** , затем **Администрирование** и выберите **Active Directory сайты и службы** .
2. В дереве консоли разверните контейнер **сайты** , а затем выберите соответствующий сайт, содержащий целевой сервер.
3. Разверните контейнер **серверы** , а затем разверните объект сервера для контроллера домена, к которому необходимо добавить глобальный каталог.
4. Щелкните правой кнопкой мыши **Параметры NTDS** и выберите пункт **свойства** .
5. Установите флажок **глобальный каталог** .
![Добавить GC](media/AD-Forest-Recovery-Add-GC/addgc1.png)

## <a name="to-add-the-global-catalog-using-repadmin"></a>Добавление глобального каталога с помощью средства Repadmin

- Откройте командную строку с повышенными привилегиями, введите следующую команду и нажмите клавишу ВВОД:

   ```
   repadmin.exe /options DC_NAME +IS_GC
   ```

Ниже приведены способы ускорения процесса добавления глобального каталога к контроллеру домена в корневом домене.

- В идеале контроллер домена в корневом домене должен быть партнером репликации восстановленных контроллеров домена, наявляющихся некорневыми. Если да, убедитесь, что в ходе проверки согласованности знаний создан соответствующий объект **репсфром** для исходного контроллера домена и раздела в КОРНЕВом контроллере домена. Это можно проверить, выполнив команду **repadmin/showreps/v** .

- Если объект **репсфром** не создан, создайте этот объект для раздела конфигурации. Таким образом, контроллер домена в корневом домене может определить, какие контроллеры домена в некорневом домене были удалены. Это можно сделать с помощью следующих команд:

   ```
   repadmin /add ConfigurationNamingContext DestinationDomainController SourceDomainControllerCNAME
   ```

   ```
   repadmin /options DSA -Disable_NTDSCONN_XLATE
   ```

   Формат для *саурцедомаинконтроллеркнаме* :

   ```

   sourceDCGuid._msdcs.root domain
   ```

   Например, команда repadmin/Add для раздела конфигурации в домене contoso.com может иметь следующее значение:

   ```
   repadmin /add cn=configuration,DC=contoso,DC=com DC01 937ef930-7356-43c8-88dc-8baaaa781cf6._msdcs.dDSP17A22.contoso.com
   ```

- Если объект **репсфром** имеется, попробуйте синхронизировать контроллер домена в корневом ДОМЕНЕ с контроллером домена в некорневом домене следующим образом:

   ```
   Repadmin /sync DomainNamingContext DestinationDomainController SourceDomainControllerGUID
   ```

   Где *дестинатиондомаинконтроллер* — это контроллер домена в корневом домене, а *саурцедомаинконтроллер* — восстановленный контроллер домена в некорневом домене.

- DNS-сервер корневого домена должен иметь записи ресурсов псевдонима (CNAME) для исходного контроллера домена. Убедитесь, что родительская зона DNS содержит записи ресурсов делегирования (записи сервера имен (NS) и узла (A)) для правильных контроллеров домена (контроллеры домена, которые были восстановлены из резервной копии) в дочерней зоне.
- Убедитесь, что контроллер домена в корневом домене подключен к правильному центр распространения ключей (KDC) в некорневом домене. Чтобы проверить это, в командной строке введите следующую команду и нажмите клавишу ВВОД:

   ```
   nltest /dsgetdc:nonroot domain name /KDC /Force
   ```

## <a name="next-steps"></a>Next Steps

- [Руководство по восстановлению леса AD](AD-Forest-Recovery-Guide.md)
- [Восстановление леса AD — процедуры](AD-Forest-Recovery-Procedures.md)
