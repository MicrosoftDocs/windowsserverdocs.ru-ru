---
ms.assetid: 249ba1be-b0d3-4a77-99af-3699074a2b6e
title: "Виртуализированных домена контроллера, устранение неполадок"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 63f96e7a3035bc25f7a7a349acb6bf26f62a2a3f
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="virtualized-domain-controller-troubleshooting"></a>Виртуализированных домена контроллера, устранение неполадок

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе приведена подробная методология диагностики компонента виртуализированных контроллеров домена.  
  
-   [Устранение неполадок клонировании виртуализированного контроллера домена](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_TshootVDCCloning)  
  
-   [Диагностика при безопасном восстановлении контроллера домена виртуализированных](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_TshootVDCSafeRestore)  
  
## <a name="BKMK_Intro"></a>Введение  
Самый эффективный способ повышения навыков по диагностике заключается в создании лаборатории тестирования и всестороннем изучении обычных рабочих сценариев. Если вы столкнетесь с ошибками, они являются гораздо очевиднее и проще для понимания Благодаря полученным вами знаниям о принципах повышения уровня контроллера домена. Это также позволяет вам выработать навыки обычного анализа анализа и сети. Это распространяется на все технологии распределенных систем, развертывание не просто виртуализированных контроллеров домена.  
  
Являются важными аспектами, расширяющими возможности диагностики для конфигурации контроллера домена:  
  
1.  Линейный анализ в сочетании с концентрацией и вниманием к деталям.  
  
2.  Общее представление о анализа зафиксированных данных сети  
  
3.  Общее представление о со встроенными журналами  
  
Первый и второй аспекты выходят за рамки этой статьи, а третий можно разобрать подробнее. Диагностики виртуализированного контроллера домена требуется логичный и линейный подход. Ключ — это решение проблемы с использованием имеющихся данных и прибегать к сложным средствам и анализу полно обработав предоставленные выходные данные и ведения журнала.  
  
## <a name="BKMK_TshootVDCCloning"></a>Устранение неполадок клонировании виртуализированного контроллера домена  
Содержание раздела:  
  
-   [Средства для диагностики](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_Tools)  
  
-   [Параметры ведения журнала](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_LoggingOptions)  
  
-   [Общая методология диагностики при домена при клонировании контроллера](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_GeneralMethodology)  
  
-   [Основные серверные компоненты и журнал событий](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_ServerCoreEvents)  
  
-   [Диагностика определенных проблем](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_SpecificProblems)  
  
Стратегия диагностики для клонирования виртуализированного контроллера домена имеет следующий формат:  
  
![Устранение неполадок виртуального контроллера домена](media/Virtualized-Domain-Controller-Troubleshooting/ADDS_VDC_TroublehsootingFlowchart.png)  
  
### <a name="BKMK_Tools"></a>Средства для диагностики  
  
#### <a name="BKMK_LoggingOptions"></a>Параметры ведения журнала  
Встроенные журналы представляют собой наиболее важное средство устранения неполадок, связанных с клонированием контроллера домена. Все эти журналы включены и настроена максимальная степень подробности по умолчанию.  
  
|||  
|-|-|  
|**Операция**|**Журнал**|  
|**Клонирование**|-Просмотр событий\журналы windows\система событий<br />-Событие Просмотр событий\журналы приложений и Служб\служба каталогов<br />-%systemroot%\debug\dcpromo.log|  
|**Повышение роли**|-%systemroot%\debug\dcpromo.log<br />-Событие Просмотр событий\журналы приложений и Служб\служба каталогов<br />-Просмотр событий\журналы windows\система событий<br />-Событие Просмотр событий\журналы приложений и служб\Служба репликации<br />-Событие Просмотр событий\журналы приложений и служб\репликация DFS|  
  
#### <a name="tools-and-commands-for-troubleshooting-domain-controller-configuration"></a>Средства и команды для диагностики конфигурации контроллера домена  
Чтобы диагностировать не поясненные в журналах проблемы, используйте следующие средства в качестве отправной точки:  
  
-   Dcdiag.exe  
  
-   Repadmin.exe  
  
-   Сетевой монитор 3.4  
  
### <a name="BKMK_GeneralMethodology"></a>Общая методология диагностики при домена при клонировании контроллера  
  
1.  Виртуальная машина загружается в режим восстановления службы Каталогов (DSRM)? Это указывает на потребность в диагностике. Чтобы войти в режиме DSRM, используйте **. \Administrator** учетной записи и укажите пароль DSRM.  
  
    1.  Изучите Dcpromo.log.  
  
        1.  Были выполнены действия по начальному клонированию, однако сбой повышения роли контроллера домена?  
  
        2.  Указывают ли ошибки проблемы с локального контроллера домена или в среде AD DS, такие как ошибки, возвращенные из эмулятора PDC?  
  
    2.  Изучите журналы событий системы и служб каталогов и файл dccloneconfig.xml и CustomDCCloneAllowList.xml  
  
        1.  Нужна ли несовместимое приложение в CustomDCCloneAllowList.xml список разрешенных?  
  
        2.  Является ли IP адрес или имя компьютера дублированным или недопустимым в dccloneconfig.xml?  
  
        3.  Является ли сайт Active Directory недопустимым в dccloneconfig.xml?  
  
        4.  IP-адрес не задан в dccloningconfig.xml и DHCP-сервер доступен?  
  
        5.  Включен ли эмулятор PDC и доступен через протокол RPC?  
  
        6.  Является членом группы клонируемые контроллеры домена контроллера домена? Это разрешение, **разрешить контроллеру домена клонировать себя** в корне домена для этой группы?  
  
        7.  Содержит ли файл Dccloneconfig.xml ошибки синтаксиса, мешающие правильному анализу?  
  
        8.  Поддерживается ли низкоуровневая оболочка?  
  
        9. Было сбой повышения роли контроллера домена после успешного начала клонирования?  
  
        10. Была имена контроллеров домена, автоматически созданный (9999) превышено максимальное количество?  
  
        11. Дублируется ли MAC-адрес?  
  
2.  — Имя узла клона так же, как у исходного контроллера домена?  
  
    1.  Существует ли файл Dccloneconfig.xml в одном из разрешенных расположений?  
  
3.  Виртуальная машина загружается в обычном режиме, клонирование завершается, однако контроллер домена работает неправильно?  
  
    1.  Сначала проверьте, изменено ли имя узла на клоне. Если имя узла отличается, клонирование хотя бы частично завершено.  
  
    2.  Контроллер домена имеет дублирующийся IP-адрес исходного контроллера домена из dccloneconfig.xml, однако исходный контроллер домена находился в автономном режиме во время клонирования?  
  
    3.  Если контроллер домена рассылает объявления, устраняйте проблему, как любую обычную проблему после повышения уровня, которая возникла без клонирования.  
  
    4.  Если контроллер домена не отправляет объявления, изучите журналы событий службы каталогов, системы, приложений, репликации файлов и репликации DFS для поиска ошибок после повышения уровня.  
  
#### <a name="disabling-dsrm-boot"></a>Отключение загрузки DSRM  
После загрузки в режиме DSRM в связи с возникновением ошибки диагностики причину ошибки и если в dcpromo.log не указано, что попытку клонирования нельзя повторить, устраните причину ошибки и выполните сброс флага DSRM. Со сбоем клон не возвращается в обычный режим самостоятельно при следующей перезагрузке; необходимо удалить флаг загрузки режима восстановления служб Каталогов, чтобы повторить попытку клонирования. Все эти действия требуется с правами администратора с повышенными привилегиями.  
  
##### <a name="removing-dsrm-with-msconfigexe"></a>Удаление DSRM с помощью Msconfig.exe  
Чтобы выключить загрузку DSRM с помощью графического интерфейса пользователя, используйте средство конфигурации системы:  
  
1.  Запустите msconfig.exe.  
  
2.  На **загрузки** в разделе **параметры загрузки**, снимите флажок **безопасной загрузки** (он уже выделен с параметром **исправление Active Directory** включена)  
  
3.  Нажмите кнопку ОК затем выполните перезагрузку  
  
##### <a name="removing-dsrm-with-bcdeditexe"></a>Удаление DSRM с помощью Bcdedit.exe  
Чтобы выключить загрузку DSRM из командной строки, используйте редактор хранилище данных конфигурации загрузки:  
  
1.  Откройте Командную строку и выполните следующую команду:  
  
    ```  
    Bcdedit.exe /deletevalue safeboot  
    ```  
  
2.  Перезагрузите компьютер с помощью команды:  
  
    ```  
    Shutdown.exe /t /0 /r  
    ```  
  
> [!NOTE]  
> Bcdedit.exe также работает в консоли Windows PowerShell. Команды, существует:  
>   
> Bcdedit.exe/deletevalue safeboot  
>   
> Перезагрузка компьютера  
  
### <a name="BKMK_ServerCoreEvents"></a>Основные серверные компоненты и журнал событий  
Журналы событий содержат множество полезной информации об операциях клонирования контроллера домена виртуализированных. По умолчанию установку на компьютере Windows Server 2012 является установки основных серверных компонентов, это означает, что есть графический интерфейс отсутствует и поэтому нельзя запустить локальную оснастку просмотра событий.  
  
Для просмотра журналов событий на сервере, выполняющем установку основных серверных компонентов:  
  
-   Запустите средство Wevtutil.exe локально  
  
-   Запустите PowerShell cmdlet Get-WinEvent локально  
  
-   Если вы включили расширенных правилах брандмауэра Windows для групп «Удаленное управление журналом событий» (или аналогичных портах), чтобы разрешить входящий трафик, можно управлять удаленно с помощью Eventvwr.exe, wevtutil.exe или Get-Winevent журнал событий. Это можно сделать в установке основных серверных компонентов с помощью NETSH.exe, групповой политики или нового командлета Set-NetFirewallRule в Windows PowerShell 3.0.  
  
> [!WARNING]  
> Не пытайтесь добавить графической оболочки обратно на компьютер, пока оно находится в режиме восстановления служб Каталогов. (Модель CBS) стек обслуживания Windows не может работать правильно в безопасном режиме или режиме DSRM. Попытки добавить компоненты или роли в режиме DSRM не завершится и оставить компьютер в нестабильное состояние, до его загрузки в обычном режиме. Поскольку клон виртуализированного домена контроллера в режиме DSRM не удается нормально загрузиться, а не должен загружаться в обычном режиме в большинстве случаев, это невозможно, безопасное Добавление графической оболочки. Это не поддерживается и может привести к нестабильной работе сервера.  
  
### <a name="BKMK_SpecificProblems"></a>Диагностика определенных проблем  
  
#### <a name="events"></a>События  
Все события клонирования контроллера домена виртуализированных записи в журнал событий служб каталогов виртуальной Машины клонированного контроллера домена. Журналы событий приложений, службы репликации файлов и репликации DFS также могут содержать ценные диагностические данные по завершившемуся с ошибкой клонированию. Ошибки во время вызова RPC в эмуляторе PDC могут быть доступны в журнале событий эмулятора PDC.  
  
Ниже указаны связанные с клонированием события Windows Server 2012 в журнале событий служб каталогов с примечаниями и предлагаемыми способами устранения ошибок.  
  
##### <a name="directory-services-event-log"></a>Журнал событий служб каталогов  
  
|||  
|-|-|  
|**Код события**|**2160**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Локальный * <COMPUTERNAME> * обнаружил файл конфигурации клонирования контроллера домена.<br /><br />Файл конфигурации клонирования контроллера домена находится на: %1<br /><br />Существование виртуального клонирования файл конфигурации контроллера домена указывает, что локальный виртуальный контроллер домена является клоном другого виртуального контроллера домена. * <COMPUTERNAME> * Запустит клонирование самого себя.|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная. Проверьте рабочий каталог DSA, % systemroot%\ntds и корень всех локальных или съемных дисков на наличие файла dcclconeconfig.xml.|  
  
|||  
|-|-|  
|**Код события**|**2161**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Локальный * <COMPUTERNAME> * не удалось найти файл конфигурации клонирования контроллера домена. Локальный компьютер не является клонированным контроллером домена.|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная. Проверьте рабочий каталог DSA, % systemroot%\ntds и корень всех локальных или съемных дисков на наличие файла dcclconeconfig.xml.|  
  
|||  
|-|-|  
|**Код события**|**2162**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Сбой клонирования виртуального контроллера домена.<br /><br />Просмотрите события, записанные в журналах событий системы и %systemroot%\debug\dcpromo.log Дополнительные сведения об ошибках при попытке клонирования контроллера домена.<br /><br />Код ошибки: %1|  
|**Примечания и решение**|Следуйте инструкциям в сообщении, эта ошибка является общего характера.|  
  
|||  
|-|-|  
|**Код события**|**2163**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Запущена служба DsRoleSvc для клонирования локального виртуального контроллера домена.|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная. Проверьте рабочий каталог DSA, % systemroot%\ntds и корень всех локальных или съемных дисков на наличие файла dcclconeconfig.xml.|  
  
|||  
|-|-|  
|**Код события**|**2164**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось запустить службу DsRoleSvc для клонирования локального виртуального контроллера домена.|  
|**Примечания и решение**|Изучите параметры службы сервера с ролью DS (DsRoleSvc) и убедитесь, что тип запуска настроено на ручной режим. Проверьте, не программа сторонних разработчиков препятствует запуску данной службы.|  
  
|||  
|-|-|  
|**Код события**|**2165**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось запустить поток в ходе клонирования локального виртуального контроллера домена.<br /><br />Код ошибки: % 1<br /><br />Сообщение об ошибке: % 2<br /><br />Имя потока: % 3|  
|**Примечания и решение**|Обратитесь в службу технической поддержки Майкрософт|  
  
|||  
|-|-|  
|**Код события**|**2166**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*требуется служба RPCSS, чтобы начать перезагрузку в режиме DSRM. Ожидании инициализации RPCSS в состоянии выполнения не удалось.<br /><br />Код ошибки: % 1|  
|**Примечания и решение**|Изучите журнал событий системы и параметры службы сервера RPC (Rpcss)|  
  
|||  
|-|-|  
|**Код события**|**2167**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось инициализировать виртуальном контроллере домена. В разделе предыдущие записи в журнале событий Дополнительные сведения.<br /><br />Дополнительные данные<br /><br />Код ошибки: % 1|  
|**Примечания и решение**|Следуйте инструкциям в сообщении, эта ошибка является общего характера.|  
  
|||  
|-|-|  
|**Код события**|**2168**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Microsoft-Windows-ActiveDirectory_DomainService<br /><br />Контроллер домена запущен на поддерживаемой низкоуровневой оболочке. Обнаружен ИД создания виртуальной Машины.<br /><br />Текущее значение ИД создания виртуальной Машины: %1|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|**Код события**|**2169**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Нет ИД создания виртуальной Машины не обнаружен. Контроллер домена развернут на физическом компьютере, предыдущей версии Hyper-V или низкоуровневой оболочке, которая не поддерживает ИД создания виртуальной Машины.<br /><br />Дополнительные данные<br /><br />Код ошибки при проверке возвращен виртуальной Машины поколения 1|  
|**Примечания и решение**|Это событие успешного выполнения операции, если вы не собираетесь выполнить клонирование. В противном случае просмотрите журнал событий системы и ознакомьтесь с вспомогательной документацией по продукту низкоуровневой оболочки.|  
  
|||  
|-|-|  
|**Код события**|**2170**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Предупреждение|  
|**Сообщение**|Обнаружено изменение ИД создания.<br /><br />ИД создания в доменных Службах (старое значение): %1<br /><br />Текущий ИД создания в виртуальной Машине (новое значение): %2<br /><br />ИД создания изменяется после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции. *<COMPUTERNAME>*создаст новый ИД вызова для восстановления контроллера домена. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, созданной с помощью доменных служб Active Directory приложение резервного копирования.|  
|**Примечания и решение**|Это событие успешного выполнения операции, если вы собираетесь выполнить клонирование. В противном случае — проверьте журнал системных событий.|  
  
|||  
|-|-|  
|**Код события**|**2171**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Обнаружено не изменение ИД создания.<br /><br />ИД создания в доменных Службах (старое значение): %1<br /><br />Текущий ИД создания в виртуальной Машине (новое значение): %2|  
|**Примечания и решение**|Это событие успешного выполнения операции, если вы не собираетесь выполнить клонирование и должно возникать при каждой загрузке виртуализированного контроллера домена. В противном случае — проверьте журнал системных событий.|  
  
|||  
|-|-|  
|**Код события**|**2172**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Прочтите атрибут msDS-GenerationId объекта-компьютера контроллера домена.<br /><br />значение атрибута msDS-GenerationId: % 1|  
|**Примечания и решение**|Это событие успешного выполнения операции, если вы собираетесь выполнить клонирование. В противном случае — проверьте журнал системных событий.|  
  
|||  
|-|-|  
|**Код события**|**2173**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Не удалось прочитать атрибут msDS-GenerationId объекта-компьютера контроллера домена. Возможно, произошел сбой транзакции базы данных или не удалось найти ИД создания в локальной базе данных. Атрибут msDS-GenerationId отсутствовал во время первой перезагрузки после dcpromo, или контроллер домена не виртуального контроллера домена.<br /><br />Дополнительные данные<br /><br />Код ошибки: % 1|  
|**Примечания и решение**|Это событие успешного выполнения операции, если вы собираетесь выполнить клонирование; оно указывает первую перезагрузку виртуальной Машины после завершения клонирования. Кроме того, его можно игнорировать невиртуальные контроллерах домена. В противном случае — проверьте журнал системных событий.|  
  
|||  
|-|-|  
|**Код события**|**2174**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Контроллер домена не является восстановленные снимком виртуального контроллера домена ни клоном виртуального домена контроллера.|  
|**Примечания и решение**|Это событие успешного выполнения операции, если вы не собираетесь выполнить клонирование. В противном случае — проверьте журнал системных событий.|  
  
|||  
|-|-|  
|**Код события**|**2175**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Файл конфигурации клона контроллера домена существует на неподдерживаемой платформе.|  
|**Примечания и решение**|Это происходит, когда файл dccloneconfig.xml найден, но ИД создания виртуальной Машины — не найден, например, когда файл dccloneconfig.xml найден на физическом компьютере или в низкоуровневой оболочке, которая не поддерживает ИД создания виртуальной Машины.|  
  
|||  
|-|-|  
|**Код события**|**2176**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Файл конфигурации клона контроллера домена переименован.<br /><br />Дополнительные данные<br /><br />Старое имя файла: % 1<br /><br />Новое имя файла: % 2|  
|**Примечания и решение**|Переименование ожидается при загрузке резервной копии исходной виртуальной Машины, так как ИД создания виртуальной Машины не изменился. Это не позволяет исходному контроллеру домена для клонирования.|  
  
|||  
|-|-|  
|**Код события**|**2177**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Сбой переименования файла конфигурации клона виртуального домена контроллера.<br /><br />Дополнительные данные<br /><br />Имя файла: % 1<br /><br />Код ошибки: % 2 %3|  
|**Примечания и решение**|Попытка переименования ожидается при загрузке резервной копии исходной виртуальной Машины, так как ИД создания виртуальной Машины не изменился. Это не позволяет исходному контроллеру домена для клонирования. Вручную переименуйте файл и выполните поиск продуктов сторонних разработчиков, которые могли воспрепятствовать переименованию файла.|  
  
|||  
|-|-|  
|**Код события**|**2178**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Обнаружен файл конфигурации клона виртуального домена контроллера, но ИД создания виртуальной Машины не был изменен. Локальный контроллер домена является клоном исходного контроллера домена. Переименуйте файл конфигурации клона.|  
|**Примечания и решение**|Ожидается при загрузке резервной копии исходной виртуальной Машины, так как ИД создания виртуальной Машины не изменился. Это не позволяет исходному контроллеру домена для клонирования.|  
  
|||  
|-|-|  
|**Код события**|**2179**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Атрибут msDS-GenerationId объекта-компьютера контроллера домена задан следующий параметр:<br /><br />Атрибут GenerationID: % 1|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|**Код события**|**2180**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Предупреждение|  
|**Сообщение**|Не удалось задать атрибут msDS-GenerationId объекта-компьютера контроллера домена.<br /><br />Дополнительные данные<br /><br />Код ошибки: % 1|  
|**Примечания и решение**|Проверьте журнал системных событий и файл Dcpromo.log. Поиск соответствующую ошибку на сайте MS TechNet, базе знаний и блогах корпорации Майкрософт определить ее Обычное значение, а затем устраните неполадки на основе этих результатов.|  
  
|||  
|-|-|  
|**Код события**|**2182**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Внутреннее событие: служба каталогов поступил запрос на клонирование удаленного DSA:|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|**Код события**|**2183**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Внутреннее событие: * <COMPUTERNAME> * выполнил запрос на клонирование удаленного системного агента каталога.<br /><br />Исходное имя контроллера домена: % 3<br /><br />Запросить клона имя контроллера домена: % 4<br /><br />Сайт клонируемого запросе контроллера домена: % 5<br /><br />Дополнительные данные<br /><br />Значение ошибки: % 1 %2|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|**Код события**|**2184**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось создать учетную запись контроллера домена для клонированного контроллера домена.<br /><br />Исходное имя контроллера домена: % 1<br /><br />Разрешенное число клонированного контроллеров домена: % 2<br /><br />Ограничение на число учетных записей контроллера домена, которые можно создать путем клонирования * <COMPUTERNAME> *превышено.|  
|**Примечания и решение**|Контроллеры домена не понизить уровень на основе соглашению об именовании отдельное имя исходного домена контроллера можно создать автоматически всего 9999 раз. Используйте <computername> элемент в XML-КОДЕ для создания нового уникального имени или выполните клонирование из контроллера домена другим именем.|  
  
|||  
|-|-|  
|**Код события**|**2191**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*Задайте следующий параметр реестра для отключения обновлений DNS.<br /><br />Раздел реестра: % 1<br /><br />Значение реестра: %2<br /><br />Значение параметра реестра: %3<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании. Процесс клонирования DNS вновь включит обновление после завершения клонирования.|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|**Код события**|**2192**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось задать следующий параметр реестра для отключения обновлений DNS.<br /><br />Раздел реестра: % 1<br /><br />Значение реестра: %2<br /><br />Значение параметра реестра: %3<br /><br />Код ошибки: % 4<br /><br />Сообщение об ошибке: % 5<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании.|  
|**Примечания и решение**|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать обновлениям реестра.|  
  
|||  
|-|-|  
|**Код события**|**2193**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*Установите следующее значение реестра для включения обновлений DNS.<br /><br />Раздел реестра: % 1<br /><br />Значение реестра: %2<br /><br />Значение параметра реестра: %3<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании.|  
|**Примечания и решение**|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|**Код события**|**2194**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось задать следующий параметр реестра для включения обновлений DNS.<br /><br />Раздел реестра: % 1<br /><br />Значение реестра: %2<br /><br />Значение параметра реестра: %3<br /><br />Код ошибки: % 4<br /><br />Сообщение об ошибке: % 5<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании.|  
|**Примечания и решение**|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать обновлениям реестра.|  
  
|||  
|-|-|  
|**Код события**|**2195**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Не удалось задать режим загрузки DSRM.<br /><br />Код ошибки: % 1<br /><br />Сообщение об ошибке: % 2<br /><br />При клонировании виртуального контроллера домена не удалось или файл конфигурации клона виртуального домена контроллера отображается на неподдерживаемой низкоуровневой оболочке, локальный компьютер будет перезагружен в режиме DSRM для устранения неполадок. Сбой установки режима загрузки DSRM.|  
|**Примечания и решение**|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать обновлениям реестра.|  
  
|||  
|-|-|  
|**Код события**|**2196**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Не удалось включить привилегию завершения работы.<br /><br />Код ошибки: % 1<br /><br />Сообщение об ошибке: % 2<br /><br />При клонировании виртуального контроллера домена не удалось или файл конфигурации клона виртуального домена контроллера отображается на неподдерживаемой низкоуровневой оболочке, локальный компьютер будет перезагружен в режиме DSRM для устранения неполадок. Не удалось включить привилегию завершения работы.|  
|**Примечания и решение**|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать использованию привилегий.|  
  
|||  
|-|-|  
|**Код события**|**2197**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Не удалось инициировать завершение работы системы.<br /><br />Код ошибки: % 1<br /><br />Сообщение об ошибке: % 2<br /><br />При клонировании виртуального контроллера домена не удалось или файл конфигурации клона виртуального домена контроллера отображается на неподдерживаемой низкоуровневой оболочке, локальный компьютер будет перезагружен в режиме DSRM для устранения неполадок. Сбой инициализации завершения работы системы.|  
|**Примечания и решение**|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать использованию привилегий.|  
  
|||  
|-|-|  
|**Код события**|**2198**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось создать или изменить следующий объект клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />Объект:<br /><br />%1<br /><br />Значение ошибки: %2<br /><br />%3|  
|**Примечания и решение**|Поиск соответствующую ошибку на сайте MS TechNet, базе знаний и блогах корпорации Майкрософт определить ее Обычное значение, а затем устраните неполадки на основе этих результатов.|  
  
|||  
|-|-|  
|**Код события**|**2199**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось создать следующий объект клонированного контроллера домена, так как объект уже существует.<br /><br />Дополнительные данные:<br /><br />Исходный контроллер домена:<br /><br />%1<br /><br />Объект:<br /><br />%2|  
|**Примечания и решение**|Проверьте файл dccloneconfig.xml не был указан существующего контроллера домена, или что копии dccloneconfig.xml используются на нескольких клонах без изменения имени. Если конфликт остается неожиданным, определите, какой администратор повысил его; уровень связаться с ними, чтобы обсудить следует понизить уровень контроллера домена, очистить метаданные существующего контроллера домена или если клона должен использовать другое имя.|  
  
|||  
|-|-|  
|**Код события**|**2203**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Сбой последнего клонирования виртуального контроллера домена. Это первая перезагрузка после сбоя, и поэтому должно быть перезапущено клонирования. Тем не менее, ни файл конфигурации клона контроллера домена не существует, а обнаружено изменение ИД создания виртуальной машины. Загрузку в режиме DSRM.<br /><br />Сбой последнего клонирования виртуального контроллера домена: %1<br /><br />Файл конфигурации клона контроллера домена существует: %2<br /><br />Обнаружено изменение ИД создания виртуальной машины: %3|  
|**Примечания и решение**|Ожидается, если сбой клонирования ранее, связи с отсутствующим или недопустимым файлом dccloneconfig.xml|  
  
|||  
|-|-|  
|Код события|2210|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|<COMPUTERNAME> не удалось создать объекты для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %6<br /><br />Имя клонированного контроллера домена: %1<br /><br />Число повторных попыток: %2<br /><br />Значение исключения: %3<br /><br />Значение ошибки: %4<br /><br />DSID: %5|  
|Примечания и решение|Просмотрите журналы событий системы и служб каталогов, а также dcpromo.log для получения сведений о причинах сбоя клонирования.|  
  
|||  
|-|-|  
|Код события|2211|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создал объекты для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %3<br /><br />Имя клонированного контроллера домена: %1<br /><br />Число повторных попыток: %2|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2212|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> начал создавать объекты для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Имя клона: %2<br /><br />Сайт клона: %3<br /><br />RODC клона: %4|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2213|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создать новый объект KrbTgt для клонирования контроллера домена только для чтения.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Guid нового объекта KrbTgt: %2|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2214|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создаст объект-компьютер для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Исходный контроллер домена: %2<br /><br />Клонированный контроллер домена: %3|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2215|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> добавит клонированный контроллер домена в следующий сайт.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Узел: %2|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2216|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создаст контейнер серверов для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Контейнер серверов: %2|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2217|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создаст объект-сервер для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Объект-сервер: %2|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2218|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> Создает объект параметров NTDS для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Объект: %2|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2219|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создаст объекты подключения для клонированного контроллера домена только для чтения.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2220|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> создаст объекты SYSVOL для клонированного контроллера домена только для чтения.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2221|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|<COMPUTERNAME> не удалось создать случайный пароль для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Имя клонированного контроллера домена: %2<br /><br />Ошибка: %3 %4|  
|Примечания и решение|Изучите журнал событий системы для получения сведений о почему не удается создать пароль учетной записи компьютера.|  
  
|||  
|-|-|  
|Код события|2222|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|<COMPUTERNAME> не удалось задать пароль для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Имя клонированного контроллера домена: %2<br /><br />Ошибка: %3 %4|  
|Примечания и решение|Изучите журнал событий системы для получения сведений о том, почему не удается задать пароль учетной записи компьютера.|  
  
|||  
|-|-|  
|Код события|2223|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|<COMPUTERNAME> успешно установлены пароль учетной записи компьютера для клонированного контроллера домена.<br /><br />Дополнительные данные:<br /><br />ИД клона: %1<br /><br />Имя клонированного контроллера домена: %2<br /><br />Общее число повторных попыток: %3|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2224|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|Сбой клонирования виртуального контроллера домена. Следующие %1 на клонируемом компьютере есть управляемые учетные записи служб:<br /><br />%2<br /><br />Для успешного клонирования удалите все управляемые учетные записи служб. Это можно сделать с помощью командлета PowerShell Remove-ADComputerServiceAccount.|  
|Примечания и решение|Ожидается при использовании автономных управляемых учетных записей служб (не групповых MSA). Выполните *не* следуйте содержащейся в сообщении для удаления учетной записи — она неправильная. Используйте Uninstall-AdServiceAccount - [https://technet.microsoft.com/library/hh852310](https://technet.microsoft.com/library/hh852310).<br /><br />Автономные управляемые учетные записи служб, - впервые появились в Windows Server 2008 R2 - в Windows Server 2012 с помощью группы, управляемые учетные записи служб (gMSA) были заменены. Gmsa поддерживают клонирование.|  
  
|||  
|-|-|  
|Код события|2225|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|Кэшированные секреты следующего субъекта безопасности были успешно удалены с локального контроллера домена:<br /><br />%1<br /><br />После клонирования контроллера домена только для чтения, секреты, кэшированные на клонирования исходный контроллер домена только для чтения будут удалены на клонированный контроллер домена.|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|2226|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|Не удалось удалить кэшированные секреты следующего субъекта безопасности с локального контроллера домена:<br /><br />%1<br /><br />Ошибка: %2 (%3)<br /><br />После клонирования контроллера домена только для чтения, секреты, кэшированные на нем исходного домена только для чтения контроллера, необходимо удалить с клона, чтобы снизить риск, что злоумышленник может получить учетные данные с украденного или скомпрометированного клона. Если субъект безопасности является учетной записью высоким уровнем привилегий и должны быть защищены от этого, пожалуйста помощью операции rODCPurgeAccount в rootDSE вручную очистите секреты на локальном контроллере домена.|  
|Примечания и решение|Просмотрите журналы событий системы и служб каталогов для получения дополнительных сведений.|  
  
|||  
|-|-|  
|Код события|2227|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|Возникло исключение при попытке удалить кэшированные секреты с локального контроллера домена.<br /><br />Дополнительные данные:<br /><br />Значение исключения: %1<br /><br />Значение ошибки: %2<br /><br />DSID: %3<br /><br />После клонирования контроллера домена только для чтения, секреты, кэшированные на нем исходного домена только для чтения контроллера, необходимо удалить с клона, чтобы снизить риск, что злоумышленник может получить учетные данные с украденного или скомпрометированного клона. Если какие-либо из этих субъектов безопасности является учетной записью высоким уровнем привилегий, должны быть защищены от этого Пожалуйста помощью операции rODCPurgeAccount в rootDSE вручную очистите секреты на локальном контроллере домена.|  
|Примечания и решение|Просмотрите журналы событий системы и служб каталогов для получения дополнительных сведений.|  
  
|||  
|-|-|  
|Код события|2228|  
|Источник|Microsoft-Windows-ActiveDirectory_DomainService|  
|Уровень серьезности|Ошибка|  
|Сообщение|ИД создания виртуальной машины в базе данных Active Directory этого контроллера домена отличается от секущего значения этой виртуальной машины. Однако файл конфигурации клона виртуального домена контроллера (DCCloneConfig.xml) не удалось найти, поэтому клонирование контроллера домена не выполнялась. Если операция клонирования контроллера домена предполагалась, убедитесь, что файл DCCloneConfig.xml предоставлен в любом из поддерживаемых расположений. Кроме того IP-адрес этого контроллера домена конфликтует с IP-адресом другого контроллера домена. Для обеспечения бесперебойного службы, контроллер домена был настроен на загрузку в режиме восстановления служб Каталогов.<br /><br />Дополнительные данные:<br /><br />Повторяющийся IP-адрес: %1|  
|Примечания и решение|Этот защитный механизм останавливает дублирующиеся контроллеры домена, когда это возможно (не при использовании он делает DHCP, например). Добавьте допустимый файл DcCloneConfig.xml, удалите флаг DSRM и повторите попытку клонирования.|  
  
|||  
|-|-|  
|Код события|29218|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Сбой клонирования виртуального контроллера домена. Не удалось выполнить операцию клонирования и клонированный контроллер домена был перезагружен в режиме восстановления служб каталогов (DSRM).<br /><br />Пожалуйста проверки зарегистрированных ранее события и %systemroot%\debug\dcpromo.log Дополнительные сведения об ошибках для клонирования виртуального контроллера домена попытка и ли этот образ клонирования можно использовать повторно.<br /><br />Если один или несколько записей журнала указывают на то, что клонирования нельзя повторить, образ необходимо безопасно уничтожить. В противном случае может устранить ошибки, снять флаг загрузки DSRM и перезагрузите обычно; После перезагрузки будет повтор операции клонирования.|  
|Примечания и решение|Просмотрите журналы событий системы и служб каталогов, а также dcpromo.log для получения сведений о причинах сбоя клонирования.|  
  
|||  
|-|-|  
|Код события|29219|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|Клонирование виртуального контроллера домена успешно завершено.|  
|Примечания и решение|Это событие успешного выполнения операции неполадкой только если Непредвиденная.|  
  
|||  
|-|-|  
|Код события|29248|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена не удалось получить уведомление Winlogon. Возвращен код ошибки: %1 (%2).<br /><br />Дополнительные сведения об этой ошибке просмотрите %systemroot%\debug\dcpromo.log ошибок, которые соответствуют виртуального контроллера домена попытка клонирования.|  
|Примечания и решение|Обратитесь в службу технической поддержки Майкрософт|  
  
|||  
|-|-|  
|Код события|29249|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена не удалось проанализировать файл конфигурации контроллера домена.<br /><br />Возвращен код HRESULT: %1.<br /><br />Файл конфигурации: %2<br /><br />Исправьте ошибки в файле конфигурации и повторите операцию клонирования.<br /><br />Дополнительные сведения об этой ошибке см. в разделе % systemroot%\debug\dcpromo.log.|  
|Примечания и решение|Просмотрите файл dclconeconfig.xml для ошибок синтаксиса с помощью редактора XML и файла схемы DCCloneConfigSchema.xsd.|  
  
|||  
|-|-|  
|Код события|29250|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Сбой клонирования виртуального контроллера домена. Есть включенные программы или службы, сейчас включена на клонируемом виртуальном контроллере домена, отсутствуют в списке разрешенных приложений для клонирования виртуального контроллера домена.<br /><br />Ниже приведены отсутствующие записи.<br /><br />%2<br /><br />%1 (при наличии) использовано как определенный список включения.<br /><br />Не удается выполнить клонирование, если установлены приложения, не подлежащие клонированию.<br /><br />Запустите Active Directory PowerShell командлет Get-ADDCCloningExcludedApplicationList, чтобы проверить, какие приложения установлены на клонируемом компьютере, но не включены в список разрешенных и добавить их в список разрешенных, если они совместимы с клонированием виртуального контроллера домена. Если какие-либо из этих приложений несовместимы с клонирования виртуального контроллера домена, удалите их, затем повторите попытку клонирования.<br /><br />Клонирования виртуального контроллера домена ищет процесс разрешенных файл списка приложений, CustomDCCloneAllowList.xml, в следующем порядке поиска; первый найденный файл используется, и все остальные игнорируются:<br /><br />1. имя параметра реестра: HKey_Local_Machine\System\CurrentControlSet\Services\NTDS\Parameters\AllowListFolder<br /><br />2. в том же каталоге, в котором находится рабочая папка DSA<br /><br />3. %windir%\NTDS<br /><br />4. съемных чтения и записи мультимедиа в порядке букв в корне диска|  
|Примечания и решение|Следуйте инструкциям в сообщении.|  
  
|||  
|-|-|  
|Код события|29251|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена не удалось сбросить IP-адреса клонированного компьютера.<br /><br />Возвращен код ошибки: %1 (%2).<br /><br />Эта ошибка может быть вызвано неправильной конфигурацией в разделах конфигурации сети в файле конфигурации контроллера домена.<br /><br />См. в разделе %systemroot%\debug\dcpromo.log Дополнительные сведения об ошибках, которые соответствуют сброса во время попытки клонирования виртуального контроллера домена IP-адресов.<br /><br />Сведения о сбросе IP-адресов на клонируемом компьютере можно найти на https://go.microsoft.com/fwlink/?LinkId=208030|  
|Примечания и решение|Проверьте параметры IP, в файле dccloneconfig.xml заданы является допустимым и не дублировать изначального исходного компьютера.|  
  
|||  
|-|-|  
|Код события|29253|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Сбой клонирования виртуального контроллера домена. Клонированный контроллер домена не удалось обнаружить хозяина операций контроллера основного домена в домашнем домене клонируемого компьютера клонированного компьютера.<br /><br />Возвращен код ошибки: %1 (%2).<br /><br />Убедитесь, что основной контроллер домена в домашнем домене клонируемого компьютера назначен действующему контроллеру домена, находится в оперативном режиме и работает. Убедитесь, что на клонируемом компьютере имеется подключение LDAP/RPC к основному контроллеру домена через требуемые порты и протоколы.|  
|Примечания и решение|Проверьте контроллер домена клонированного IP-адресов и задать сведения о DNS-сервера. Использовать Dcdiag.exe /test:locatorcheck для проверки работы pdce, используйте Nltest.exe/Server:* <PDCE> * /dclist:* <domain> * для проверки RPC, получите зафиксированные сети из PDCE сбоя клонирования и проанализируйте трафик.|  
  
|||  
|-|-|  
|Код события|29254|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена не удалось выполнить привязку на основном контроллере домена %1.<br /><br />Возвращен код ошибки: %2 (%3).<br /><br />Убедитесь, что основной контроллер домена %1 находится в оперативном режиме и работает. Убедитесь, что на клонируемом компьютере имеется подключение LDAP/RPC к основному контроллеру домена через требуемые порты и протоколы.|  
|Примечания и решение|Проверьте контроллер домена клонированного IP-адресов и задать сведения о DNS-сервера. Использовать Dcdiag.exe /test:locatorcheck для проверки работы pdce, используйте Nltest.exe/Server:* <PDCE> * /dclist:* <domain> * для проверки RPC, получите зафиксированные сети из PDCE сбоя клонирования и проанализируйте трафик.|  
  
|||  
|-|-|  
|Код события|29255|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Сбой клонирования виртуального контроллера домена.<br /><br />При попытке создать объекты на основном контроллере домена %1 для клонирования образа, возвращена ошибка %2 (%3).<br /><br />Убедитесь, что клонированный контроллер домена имеет право на клонирование самого себя. Проверьте наличие связанных событий в журнал событий службы каталогов для основного контроллера домена %1.|  
|Примечания и решение|Поиск соответствующую ошибку на сайте MS TechNet, базе знаний и блогах корпорации Майкрософт определить ее Обычное значение, а затем устраните неполадки на основе этих результатов.|  
  
|||  
|-|-|  
|Код события|29256|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Чтобы задать режим загрузки в режиме восстановления служб каталогов флаг ошибка с кодом ошибки %1.<br /><br />См. в разделе %systemroot%\debug\dcpromo.log Дополнительные сведения об ошибках.|  
|Примечания и решение|Просмотрите журнал службы каталогов и файл dcpromo.log подробные сведения. Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать использованию привилегий.|  
  
|||  
|-|-|  
|Код события|29257|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена выполнено. Перезагрузка компьютера ошибка с кодом ошибки %1.<br /><br />Перезагрузите компьютер для завершения операции клонирования.|  
|Примечания и решение|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать использованию привилегий.|  
  
|||  
|-|-|  
|Код события|29264|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Снимите флажок загрузки в режиме восстановления служб каталогов флаг ошибка с кодом ошибки %1.<br /><br />См. в разделе %systemroot%\debug\dcpromo.log Дополнительные сведения об ошибках.|  
|Примечания и решение|Просмотрите журнал службы каталогов и файл dcpromo.log подробные сведения. Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать использованию привилегий.|  
  
|||  
|-|-|  
|Код события|29265|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Информационное сообщение|  
|Сообщение|Клонирование виртуального контроллера домена успешно завершено. Файл виртуального контроллера домена клонирования конфигурации %1 был переименован в %2.|  
|Примечания и решение|Н/д, это событие успешного выполнения операции.|  
  
|||  
|-|-|  
|Код события|29266|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена успешно завершено. При попытке переименовать файл виртуального контроллера домена клонирования конфигурации %1 сбой с кодом ошибки %2 (%3).|  
|Примечания и решение|Вручную переименуйте файл dccloneconfig.xml.|  
  
|||  
|-|-|  
|Код события|29267|  
|Источник|Microsoft-Windows-DirectoryServices-DSROLE-Server|  
|Уровень серьезности|Ошибка|  
|Сообщение|Клонирование виртуального контроллера домена не удалось проверить клонирования виртуального контроллера домена список разрешенных приложений.<br /><br />Возвращен код ошибки: %1 (%2).<br /><br />Это могло быть вызвано синтаксической ошибкой в клона файле списка разрешений (проверяемый файл в настоящее время является: %3). Дополнительные сведения об этой ошибке см. в разделе % systemroot%\debug\dcpromo.log.|  
|Примечания и решение|Следуйте инструкциям для события|  
  
##### <a name="error-messages"></a>Сообщения об ошибках  
Не прямой интерактивные ошибки для сбоя клонирования виртуализированного контроллера домена; Вся информация о клонировании в системе и служб каталогов и входа повышения роли контроллера домена в файле dcpromo.log. Тем не менее при загрузке сервера в режиме восстановления служб Каталогов, проверьте сразу же, как произошел сбой повышения уровня или клонирования.  
  
Файл dcpromo.log это первое место, чтобы проверить наличие ошибки клонирования. В зависимости от указанного сбоя может потребоваться просмотреть журналы системы для проведения дальнейшей диагностики и служб каталогов.  
  
#### <a name="known-issues-and-support-scenarios"></a>Известные проблемы и сценарии поддержки  
Ниже приведены распространенные проблемы, возникающие в процессе разработки Windows Server 2012. Все эти проблемы «по проектированию» и имеется либо обходной, либо иная методика во избежание их в первую очередь. Некоторые из них будут устранены в последующих выпусках Windows Server 2012.  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирования, DSRM**|  
|**Симптомы**|Клон загружается в режиме восстановления служб каталогов|  
|**Решение и примечания**|Проверьте всех действий, описанных в разделах "Развертывание виртуализированного контроллера домена" и [общая методология диагностики при клонировании контроллера домена](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_GeneralMethodology)<br /><br />Описанные в KB 2742844.|  
  
|||  
|-|-|  
|**Проблема**|**Дополнительные аренды IP-адресов при использовании DHCP для клонирования**|  
|**Симптомы**|После успешного клонирования контроллера домена и использования DHCP первая загрузка клона осуществляет аренду DHCP. После переименования сервера и его перезапуска в качестве контроллера домена он осуществляет вторую аренду DHCP. Первый IP-адрес не освобождается, и вы получаете «фантомную» аренду.|  
|**Решение и примечания**|Вручную удалите неиспользуемую аренду адреса в DHCP или дождитесь истечения ее срока. Описанные в КБ 2742836.|  
  
|||  
|-|-|  
|**Проблема**|**Клонирование в режиме DSRM завершается со сбоем после очень длинной задержки**|  
|**Симптомы**|Клонирования отображается на шаге «клонирование контроллера домена находится на X % завершения» для от 8 до 15 минут. После этого клонирование завершается сбоем и загружается в режиме DSRM.|  
|**Решение и примечания**|Клонированного компьютера не может получить динамический IP-адрес от DHCP или SLAAC, используется повторяющийся IP-адрес или не удается найти PDC. Несколько попыток путем клонирования приводит к задержке. Устраните проблемы в сети, чтобы выполнить клонирование.<br /><br />Описанные в KB 2742844.|  
  
|||  
|-|-|  
|**Проблема**|**Процесс клонирования не воссоздает все имена участников-служб**|  
|**Симптомы**|Если набор *трех частей* имена участников-служб (SPN) включает в себя как имя NetBIOS с портом, так и идентичное имя NetBIOS без порта, запись без порта не воссоздается с новым именем компьютера. Например:<br /><br />customspn / DC1: 200 / app1 INVALID USE OF SYMBOLS *это воссоздается с новым именем компьютера*<br /><br />customspn/DC1/app1 INVALID USE OF SYMBOLS *это не воссоздается с новым именем компьютера*<br /><br />Полные имена воссоздаются, а имена субъектов-служб без трех частей воссоздаются независимо от портов. Например эти элементы успешно воссоздаются на клоне:<br /><br />customspn / DC1: 202 INVALID USE OF SYMBOLS *это воссоздается*<br /><br />customspn/DC1 INVALID USE OF SYMBOLS *это воссоздается*<br /><br />customspn/DC1.corp.contoso.com:202 INVALID USE OF SYMBOLS *это воссозданное имя*<br /><br />customspn/DC1.corp.contoso.com INVALID USE OF SYMBOLS *это воссоздается*|  
|**Решение и примечания**|Это ограничение всего процесса переименования контроллеров домена в Windows, а не только копирования. Имена участников-СЛУЖБ для трех частей обрабатываются такой логической схемой переименования при любом сценарии. Большинство служб Windows не подвержены влиянию это, как они воссоздают все отсутствующие имена субъектов-служб по мере необходимости. Другие приложения может потребоваться вручную ввести имя участника-службы для устранения проблемы.<br /><br />Описанные в КБ 2742874.|  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирования, загрузка в режиме DSRM, общие ошибки сети**|  
|**Симптомы**|Клон загружается в режиме восстановления служб каталогов. Имеются общие ошибки сети.|  
|Решение и примечания|Убедитесь, что у нового клона нет дублирующегося статического MAC-адреса назначенного с исходного контроллера домена; можно увидеть, использует ли виртуальная машина статический MAC-адрес, выполните следующую команду на узле низкоуровневой оболочки как исходный, так и клона виртуальной машины:<br /><br />Get-VM - VMName *test-vm* & #124; Get-VMNetworkAdapter & #124; fl *<br /><br />Измените MAC-адрес на уникальный статический адрес или переключитесь на использование динамических MAC-адресов.<br /><br />Описанные в KB 2742844|  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирования, загрузка в режиме DSRM в качестве дубликата исходного контроллера домена**|  
|**Симптомы**|Новый клон загружается без клонирования. Файл dccloneconfig.xml не переименовывается, и сервер запускается в режиме восстановления служб Каталогов. Журнал событий служб каталогов показывает ошибку 2164:<br /><br />*<COMPUTERNAME>*не удалось запустить службу DsRoleSvc для клонирования локального виртуального контроллера домена.|  
|**Решение и примечания**|Изучите параметры службы сервера с ролью DS (DsRoleSvc) и убедитесь, что тип запуска настроено на ручной режим. Проверьте, не программа сторонних разработчиков препятствует запуску данной службы.<br /><br />Дополнительные сведения о том, как освободить этот дополнительный контроллер домена, гарантируя, что исходящую репликацию обновлений, см. в статье базы Знаний Майкрософт 2742970.|  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирования, загрузка в режиме DSRM, ошибка 8610**|  
|**Симптомы**|Клон загружается в режиме восстановления служб каталогов. Файл Dcpromo .log показывает ошибку 8610 (ERROR_DS_ROLE_NOT_VERIFIED 8610 или 0x21A2)|  
|**Решение и примечания**|Это происходит, когда PDC доступен для обнаружения, но не выполнил достаточный объем репликации взять роль на себя. Например, когда клонирование запущено, а другой администратор перемещает роль PDCE FSMO на новый контроллер домена.<br /><br />Описанные в КБ 2742916.|  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирования, загрузка в режиме DSRM, общие ошибки сети**|  
|**Симптомы**|Клон загружается в режиме восстановления служб каталогов. Имеются общие ошибки сети.|  
|**Решение и примечания**|Убедитесь, что у нового клона нет дублирующегося статического MAC-адреса назначенного с исходного контроллера домена; можно определить, использует ли виртуальная машина статический MAC-адрес, выполните следующую команду на узле Hyper-V для виртуальных машин как исходный, так и для клонированной:<br /><br />Get-VM - VMName *test-vm* & #124; Get-VMNetworkAdapter & #124; fl *<br /><br />Измените MAC-адрес на уникальный статический адрес или переключитесь на использование динамических MAC-адресов.<br /><br />Описанные в KB 2742844.|  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирования, загрузка в режиме DSRM**|  
|**Симптомы**|Клон загружается в режиме восстановления служб каталогов|  
|**Решение и примечания**|Убедитесь, что dccloneconfig.xml содержит определение схемы (см. sampledccloneconfig.xml, строка 2):<br /><br />**< d3c:DCCloneConfig xmlns:d3c="uri:microsoft.com:schemas:DCCloneConfig» >**<br /><br />Описанные в KB 2742844|  
  
|||  
|-|-|  
|Проблема|**Отсутствуют серверы, которые доступны ошибка ведения журнала в режиме DSRM**|  
|**Симптомы**|Клон загружается в режиме восстановления служб каталогов. Вы пытаетесь выполнить вход и получаете ошибку:<br /><br />**В настоящее время нет доступных серверов нет входа в систему для обслуживания запроса на вход в систему**|  
|**Решение и примечания**|Убедитесь, что вы выполняете вход с использованием учетной записи администратора DSRM, а не учетной записи домена. Используйте стрелку влево и введите имя пользователя:<br /><br />**. \administrator**<br /><br />Описанные в КБ 2742908|  
  
|||  
|-|-|  
|**Проблема**|**В режиме DSRM, ошибка сбой источника клонирования**|  
|**Симптомы**|Во время клонирования, происходит сбой 8437 «создание объектов клонированного контроллера домена на PDC» (0x20f5)|  
|**Решение и примечания**|Повторяющееся имя компьютера было задано в DCCloneConfig.xml как исходного контроллера домена или имеющегося контроллера домена. Имя компьютера также должно быть в формате имени компьютера NetBIOS (15 или меньше символов, не полное доменное имя).<br /><br />Исправьте файл dccloneconfig.xml, задав уникальное и допустимое имя.<br /><br />Описанные в КБ 2742959|  
  
|||  
|-|-|  
|**Проблема**|**Новый addccloneconfigfile ошибка «индекс находился вне допустимого диапазона»**|  
|**Симптомы**|При выполнении командлета new-addccloneconfigfile, возникает ошибка:<br /><br />Индекс находился вне допустимого диапазона. Должен быть неотрицательным и меньшим, чем размер коллекции.|  
|**Решение и примечания**|Необходимо запустить командлет в консоли Windows PowerShell для администратора с повышенными правами. Эта ошибка вызвана отсутствием членства в группе локальных администраторов на компьютере.<br /><br />Описанные в КБ 2742927|  
  
|||  
|-|-|  
|**Проблема**|**Сбой клонирование, дублирующийся контроллер домена**|  
|**Симптомы**|Клон загружается без клонирования, дублируется имеющийся исходный контроллер домена|  
|**Решение и примечания**|Компьютер был скопирован и запущен, но не содержит файл DcCloneConfig.xml в одном из поддерживаемых расположений и не имеет дублирующийся IP-адрес с исходным контроллером домена. Чтобы избежать потери данных необходимо надлежащим образом удалить контроллер домена.<br /><br />Описанные в КБ 2742970|  
  
|||  
|-|-|  
|**Проблема**|**Сбой New-ADDCCloneConfigFile с сервера не сбои в работе, при проверке того, если исходный контроллер домена является членом группы контроллеры домена клонируемые, если сервер глобального Каталога недоступен.**|  
|**Симптомы**|При выполнении New-ADDCCloneConfigFile для создания файла dccloneconfig.xml, возникает ошибка:<br /><br />Код - сервер не работает|  
|**Решение и примечания**|Проверьте связь с глобальным каталогом с сервера, где выполняется New-ADDCCloneConfigFile и убедитесь, что членство исходного контроллера домена в группе клонируемые контроллеры домена было реплицировано в этот глобальный Каталог.<br /><br />С точки зрения очистке кэша указателя контроллера домена для случаев, когда глобальный Каталог или контроллер домена может переведены в автономный режим недавно, выполните следующую команду:<br /><br />Код - nltest/dsgetdc: /GC/force|  
  
### <a name="advanced-troubleshooting"></a>Дополнительные возможности устранения неполадок  
В этом модуле рассматривается расширенная Диагностика с использованием *работа* журналов в качестве примеров с некоторыми пояснениями возникшей ситуации. Если вы понимаете, как выглядит успешной работе виртуализированного контроллера домена, легко сможете выявить сбои в своей среде. Эти журналы сгруппированы по источнику, упорядоченные по возрастанию *ожидается* события (даже если они находятся, предупреждения и ошибки), связанные с клонированным контроллером домена в пределах каждого из журналов.  
  
#### <a name="cloning-a-domain-controller"></a>Клонирование контроллера домена  
В данном примере клонированный контроллер домена использует DHCP для получения IP-адреса, реплицирует SYSVOL с помощью FRS или DFSR (при необходимости, обратитесь к соответствующему журналу,) является глобальным каталогом и использует пустой файл dccloneconfig.xml.  
  
##### <a name="directory-services-event-log"></a>Журнал событий служб каталогов  
Журнал службы каталогов содержит основную часть на основе событий информации об операциях клонирования. Низкоуровневая оболочка изменяет ИД создания Виртуальной машины и службы NTDS регистрирует это, делает пул RID недействительным и изменяет ИД вызова. Задается новый ИД создания Виртуальной машины, и сервер реплицирует входящие данные Active Directory. Служба DFSR останавливается и его базы данных, где размещается SYSVOL, удаляется, что вызывает непринудительную синхронизацию входящего трафика. Выполняется корректировка верхнего предела номера последовательного обновления.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**2160**|ActiveDirectory_DomainService|Локальные доменные службы Active Directory обнаружили файл виртуального контроллера домена клонирования конфигурации.<br /><br />Файл клонирования конфигурации контроллера домена находится на:<br /><br />*<path>*\DCCloneConfig.XML<br /><br />Существование виртуального клонирования файл конфигурации контроллера домена указывает, что локальный виртуальный контроллер домена является клоном другого виртуального контроллера домена. В доменных службах Active Directory запустит клонирование самого себя.|  
|**2191**|ActiveDirectory_DomainService|Доменные службы Active Directory задать следующий параметр реестра для отключения обновлений DNS.<br /><br />Раздел реестра:<br /><br />SYSTEM\CurrentControlSet\Services\Netlogon\Parameters<br /><br />Значение реестра:<br /><br />UseDynamicDns<br /><br />Данные параметра реестра:<br /><br />0<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании. Процесс клонирования DNS вновь включит обновление после завершения клонирования.|  
|**2191**|ActiveDirectory_DomainService|Доменные службы Active Directory задать следующий параметр реестра для отключения обновлений DNS.<br /><br />Раздел реестра:<br /><br />SYSTEM\CurrentControlSet\Services\Dnscache\Parameters<br /><br />Значение реестра:<br /><br />RegistrationEnabled<br /><br />Данные параметра реестра:<br /><br />0<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании. Процесс клонирования DNS вновь включит обновление после завершения клонирования.<br /><br />«Сведения 2/7/2012 3:12:49 PM Microsoft-Windows-ActiveDirectory_DomainService 2191 Internal Configuration» доменные службы Active Directory задать следующий параметр реестра для отключения обновлений DNS.<br /><br />Раздел реестра:<br /><br />SYSTEM\CurrentControlSet\Services\Tcpip\Parameters<br /><br />Значение реестра:<br /><br />DisableDynamicUpdate<br /><br />Данные параметра реестра:<br /><br />1<br /><br />В ходе клонирования локальный компьютер может иметь именем компьютера клонируемый компьютер на короткое время. DNS A и AAAA регистрации записи отключены в течение этого периода, поэтому клиенты не могут отправлять запросы на локальный компьютер, участвующий в клонировании. Процесс клонирования DNS вновь включит обновление после завершения клонирования.|  
|**2172**|ActiveDirectory_DomainService|Прочтите атрибут msDS-GenerationId объекта-компьютера контроллера домена.<br /><br />значение атрибута msDS-GenerationId:<br /><br />*<Number>*|  
|**2170**|ActiveDirectory_DomainService|Обнаружено изменение ИД создания.<br /><br />ИД создания в доменных Службах (старое значение):<br /><br />*<Number>*<br /><br />Текущий ИД создания в виртуальной Машине (новое значение):<br /><br />*<Number>*<br /><br />ИД создания изменяется после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции. Доменные службы Active Directory создаст новый ИД вызова для восстановления контроллера домена. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, созданной с помощью доменных служб Active Directory приложение резервного копирования.|  
|**1109**|ActiveDirectory_DomainService|Атрибут invocationID для данного сервера каталогов изменен. Наибольший номер последовательного обновления на момент создания резервной копии выглядит следующим образом:<br /><br />Атрибут InvocationID (старое значение):<br /><br />*<GUID>*<br /><br />Атрибут InvocationID (новое значение):<br /><br />*<GUID>*<br /><br />Номер последовательного обновления:<br /><br />*<Number>*<br /><br />Атрибут invocationID изменяется при восстановлении сервера каталогов с резервного носителя, настроен для хранения раздела каталога приложений для записи, возобновил моментальный снимок виртуальной машины после установки, после операции импорта виртуальной машины или после операции динамической миграции. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, созданной с помощью домен Active Directory поддерживающего службы приложения резервного копирования.|  
|**1000**|ActiveDirectory_DomainService|Завершен запуск доменных служб Active Directory корпорации Майкрософт.|  
|**1394**|ActiveDirectory_DomainService|Были устранены все проблемы, мешавшие обновлению базы данных доменных служб Active Directory. Успешно выполняются обновления базы данных доменных служб Active Directory. Служба сетевого входа в систему перезапущена.|  
|**2163**|ActiveDirectory_DomainService|Запущена служба DsRoleSvc для клонирования локального виртуального контроллера домена.|  
|**326**|NTDS ISAM|NTDS (536) NTDSA: Ядро СУБД присоединило базу данных (1, C:\Windows\NTDS\ntds.dit). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], [5] 0.000, 0.016 [6], 0.000 [7], [8] 0.000, 0.000 [9], [10] 0.000, 0.000 [11], [12] 0.000.<br /><br />Сохраненные кэша: 1|  
|**103**|NTDS ISAM|NTDS (536) NTDSA: Ядром СУБД остановлен экземпляр (0).<br /><br />Неправильное отключение: 0<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], 0.032 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.031 [9], 0.000 [10], 0.000 [11], 0.000 [12], [13] 0.000, 0.000 [14], [15] 0.000.|  
|**102**|NTDS ISAM|NTDS (536) NTDSA: Ядро СУБД (6.02.8225.0000) запускает новый экземпляр (0).|  
|**105**|NTDS ISAM|NTDS (536) NTDSA: Ядро СУБД запустило новый экземпляр (0). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.016 [1], 0.000 [2], 0.015 [3], [4] 0.078, 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.046 [9], 0.000 [10], 0.000 [11].|  
|**1004**|ActiveDirectory_DomainService|Доменные службы Active Directory успешно завершена.|  
|**102**|NTDS ISAM|NTDS (536) NTDSA: Ядро СУБД (6.02.8225.0000) запускает новый экземпляр (0).|  
|**326**|NTDS ISAM|NTDS (536) NTDSA: Ядро СУБД присоединило базу данных (1, C:\Windows\NTDS\ntds.dit). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.015 [2], 0.016 [3], 0.000 [4], [5] 0.031, 0.000 [6], 0.000 [7], [8] 0.000, 0.000 [9], [10] 0.000, 0.000 [11], [12] 0.000.<br /><br />Сохраненные кэша: 1|  
|**105**|NTDS ISAM|NTDS (536) NTDSA: Ядро СУБД запустило новый экземпляр (0). (Время = 1 секунды)<br /><br />Последовательность внутренней синхронизации: 0.031 [1], 0.000 [2], 0.000 [3], [4] 0.391, 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.031 [9], 0.000 [10], 0.000 [11].|  
|**1109**|ActiveDirectory_DomainService|Атрибут invocationID для данного сервера каталогов изменен. Наибольший номер последовательного обновления на момент создания резервной копии выглядит следующим образом:<br /><br />Атрибут InvocationID (старое значение):<br /><br />*<GUID>*<br /><br />Атрибут InvocationID (новое значение):<br /><br />*<GUID>*<br /><br />Номер последовательного обновления:<br /><br />*<Number>*<br /><br />Атрибут invocationID изменяется при восстановлении сервера каталогов с резервного носителя, настроен для хранения раздела каталога приложений для записи, возобновил моментальный снимок виртуальной машины после установки, после операции импорта виртуальной машины или после операции динамической миграции. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, созданной с помощью домен Active Directory поддерживающего службы приложения резервного копирования.|  
|**1168**|ActiveDirectory_DomainService|Внутренняя ошибка: произошла ошибка доменных служб Active Directory.<br /><br />Дополнительные данные<br /><br />Значение ошибки (десятичное):<br /><br />2<br /><br />Значение ошибки (шестнадцатеричное):<br /><br />2<br /><br />Внутренний идентификатор:<br /><br />7011658|  
|**1110**|ActiveDirectory_DomainService|Повышение роли данного контроллера домена до глобального каталога будет отложено на следующее время.<br /><br />Интервал (мин):<br /><br />5<br /><br />Эта задержка необходима необходимых разделов каталога могут быть для подготовки к работе в режиме глобального каталога. В реестре можно указать количество секунд ожидания системного агента каталога до повышения роли локального контроллера домена до глобального каталога. Дополнительные сведения о значении реестра Global Catalog Delay Advertisement см. в руководстве распределенных систем ресурса пакета|  
|**103**|NTDS ISAM|NTDS (536) NTDSA: Ядром СУБД остановлен экземпляр (0).<br /><br />Неправильное отключение: 0<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], 0.047 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.016 [9], 0.000 [10], 0.000 [11], 0.000 [12], [13] 0.000, 0.000 [14], [15] 0.000.|  
|**1004**|ActiveDirectory_DomainService|Доменные службы Active Directory успешно завершена.|  
|**1539**|ActiveDirectory_DomainService|Доменные службы Active Directory не удается отключить программный кэш записи на следующий жесткий диск.<br /><br />Жесткий диск:<br /><br />c:<br /><br />Данные могут быть потеряны во время сбоев|  
|**2179**|ActiveDirectory_DomainService|Атрибут msDS-GenerationId объекта-компьютера контроллера домена задан следующий параметр:<br /><br />Атрибут GenerationID:<br /><br />*<Number>*|  
|**2173**|ActiveDirectory_DomainService|Не удалось прочитать атрибут msDS-GenerationId объекта-компьютера контроллера домена. Возможно, произошел сбой транзакции базы данных или не удалось найти ИД создания в локальной базе данных. Атрибут msDS-GenerationId отсутствовал во время первой перезагрузки после dcpromo, или контроллер домена не виртуального контроллера домена.<br /><br />Дополнительные данные<br /><br />Код ошибки:<br /><br />6|  
|**1000**|ActiveDirectory_DomainService|Завершен запуск доменных служб Active Directory корпорации Майкрософт, версии 6.2.8225.0.|  
|**1394**|ActiveDirectory_DomainService|Были устранены все проблемы, мешавшие обновлению базы данных доменных служб Active Directory. Успешно выполняются обновления базы данных доменных служб Active Directory. Перезапуска службы сетевого входа в систему.|  
|**1128**|ActiveDirectory_DomainService|1128 проверка согласованности знаний «создано подключение репликации из следующих исходный сервер службы каталогов для локальной службы каталогов.<br /><br />Исходный сервер службы каталогов:<br /><br />CN = NTDS Settings,*<Domain Controller DN>*<br /><br />Сервер службы каталогов:<br /><br />CN = NTDS Settings,*<Domain Controller DN>*<br /><br />Дополнительные данные<br /><br />Код причины:<br /><br />0x2<br /><br />Точка создания внутреннего кода:<br /><br />f0a025d|  
|**1999**|ActiveDirectory_DomainService|Исходный сервер службы каталогов оптимизировал последовательный номер обновления (USN) предъявленный конечным сервером службы каталогов. Исходный и конечный серверы службы каталогов имеют общего партнера репликации. Конечный сервер службы каталогов синхронизирован с общим партнером репликации, а исходный сервер службы каталогов был восстановлен из архивной копии этого партнера.<br /><br />ИД конечного службы каталогов:<br /><br />*<GUID> (<FQDN>)*<br /><br />ИД общего службы каталогов:<br /><br />*<GUID>*<br /><br />USN общего свойства:<br /><br />*<Number>*<br /><br />В результате вектор синхронизации конечного сервера службы каталогов имеет следующие параметры.<br /><br />Предыдущий USN объекта:<br /><br />0<br /><br />Предыдущий USN свойства:<br /><br />0<br /><br />GUID базы данных:<br /><br />*<GUID>*<br /><br />USN объекта:<br /><br />*<Number>*<br /><br />USN свойства:<br /><br />*<Number>*|  
  
##### <a name="system-event-log"></a>Журнал системных событий  
Сведения об операциях клонирования указаны в журнале системных событий. Как низкоуровневая оболочка сообщает гостевому компьютеру о том, что он клонировать или восстановлен из моментального снимка, контроллер домена сразу же делает недействительным пул относительных ИДЕНТИФИКАТОРОВ, чтобы предотвратить дублирование субъектов безопасности в дальнейшем. Мере продолжения клонирования выполняются ожидаемые операции и сообщения, главным образом вокруг появятся запуск и остановка служб и ожидаемые ошибок, вызванных это. После завершения журнал событий системы регистрирует успешное выполнение клонирования.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**16654**|Directory-Services-SAM|Пул идентификаторов учетных записей (относительных идентификаторов) сделан недействительным. Это может произойти в следующих ожидаемых случаях:<br /><br />1. контроллер домена восстановлен из резервной копии.<br /><br />2. контроллер домена работает на виртуальной машине, восстановлен из моментального снимка.<br /><br />3. администратор вручную сделал пул|  
|**7036**|Диспетчер управления службами|Служба доменных служб Active Directory запущена.|  
|**7036**|Диспетчер управления службами|Служба центра распространения ключей Kerberos запущена.|  
|**3096**|Службы Netlogon|Не удалось найти основной контроллер домена для данного домена.|  
|**7036**|Диспетчер управления службами|Служба диспетчера учетных записей безопасности запущена.|  
|**7036**|Диспетчер управления службами|Служба сервера запущена.|  
|**7036**|Диспетчер управления службами|Служба Netlogon запущена.|  
|**7036**|Диспетчер управления службами|Служба веб-службы Active Directory запущена.|  
|**7036**|Диспетчер управления службами|Служба репликации DFS запущена.|  
|**7036**|Диспетчер управления службами|Служба репликации файлов запущена.|  
|**14533**|Microsoft-Windows-DfsSvc|В DFS закончено построение всех пространств имен.|  
|**14531**|Microsoft-Windows-DfsSvc|Сервер DFS закончил инициализацию.|  
|**7036**|Диспетчер управления службами|Служба пространства имен DFS запущена.|  
|**7023**|Диспетчер управления службами|Служба межсайтовых сообщений завершена со следующей ошибкой:<br /><br />Указанный сервер не может выполнить запрошенную операцию.|  
|**7036**|Диспетчер управления службами|Служба межсайтовых сообщений находится в режиме остановки.|  
|**5806**|Службы Netlogon|Динамическое обновление отключено вручную на этом контроллере домена.<br /><br />ДЕЙСТВИЯ ПОЛЬЗОВАТЕЛЯ<br /><br />Перенастроить данный контроллер домена динамическое обновление или вручную добавьте записи DNS из файла «% SystemRoot%\System32\Config\Netlogon.dns» в базе данных DNS».|  
|**16651**|Directory-Services-SAM|Не удалось выполнить запрос нового пула идентификаторов учетных записей. Операционная система будет повторять до успешного выполнения запроса. Ошибка<br /><br />Ошибка требуемой операции FSMO. Не удается связаться с текущим владельцем FSMO.|  
|**7036**|Диспетчер управления службами|Служба DNS-сервера запущена.|  
|**7036**|Диспетчер управления службами|Служба сервера с ролью DS запущена.|  
|**7036**|Диспетчер управления службами|Служба Netlogon перешла в остановленное состояние.|  
|**7036**|Диспетчер управления службами|Служба репликации файлов находится в режиме остановки.|  
|**7036**|Диспетчер управления службами|Служба центра распространения ключей Kerberos находится в режиме остановки.|  
|**7036**|Диспетчер управления службами|Служба DNS-сервера находится в режиме остановки.|  
|**7036**|Диспетчер управления службами|Служба доменных служб Active Directory перешла в остановленное состояние.|  
|**7036**|Диспетчер управления службами|Служба Netlogon запущена.|  
|**7040**|Диспетчер управления службами|Тип запуска службы доменных служб Active Directory был изменен с автоматического на отключенный.|  
|**7036**|Диспетчер управления службами|Служба Netlogon перешла в остановленное состояние.|  
|**7036**|Диспетчер управления службами|Служба репликации файлов запущена.|  
|**29219**|DirectoryServices-DSROLE-сервера|Клонирование виртуального контроллера домена успешно завершено.|  
|**29223**|DirectoryServices-DSROLE-сервера|Этот сервер теперь является контроллером домена.|  
|**29265**|DirectoryServices-DSROLE-сервера|Клонирование виртуального контроллера домена успешно завершено. Виртуального контроллера домена файл C:\Windows\NTDS\DCCloneConfig.xml конфигурации клонирования переименован в C:\Windows\NTDS\DCCloneConfig.20120207-151533.xml.|  
|**1074**|User32|Процесс C:\Windows\system32\lsass.exe (DC2) инициировал перезапуск DC2 компьютера от имени пользователя NT AUTHORITY\SYSTEM по следующей причине: операционной системы: повторная настройка (Запланированная)<br /><br />Код причины: 0x80020004<br /><br />Тип выключения: перезапуск<br /><br />Примечание:»|  
  
##### <a name="dcpromolog"></a>DCPROMO. ЖУРНАЛ  
Файл Dcpromo.log содержит повышении уровня во время клонирования, которые журнал событий служб каталогов. Поскольку журнал не обеспечивают нужный уровень данном приведено слишком пояснений записей журнала событий, в этом разделе модуля приведен дополнительные комментарии.  
  
Процесс повышения уровня означает, что начинается клонирование, контроллер домена теряет текущую конфигурацию и затем повторно повышается с использованием существующей базы данных AD (это очень похоже на повышение IFM), а затем контроллер домена реплицирует входящих изменений для AD Active и SYSVOL, после чего клонирование завершается.  
  
> [!NOTE]  
> Журнал был изменен в этом модуле для упрощения восприятия — него удален столбец дат.  
  
> [!NOTE]  
> Дополнительные пояснения к Dcpromo.log см. Общие сведения и диагностика упрощенном администрировании AD DS в Windows Server 2012.  
>   
> [https://go.microsoft.com/fwlink/p/?LinkId=237244](https://go.microsoft.com/fwlink/p/?LinkId=237244)  
  
-   Запустите повышение уровня для клона  
  
-   Установите флаг режима восстановления служб каталогов, чтобы сервер не загружал резервную копию обычно качестве исходного клона и причина конфликты именования и службы каталогов  
  
-   Обновите журнал событий служб каталогов  
  
```  
15:14:01 [INFO] vDC Cloneing: Setting Boot into DSRM flag succeeded.  
15:14:01 [WARNING] Cannot get user Token for Format Message: 1725l  
15:14:01 [INFO] vDC Cloning: Created vDCCloningUpdate event.  
15:14:01 [INFO] vDC Cloning: Created vDCCloningComplete event.  
```  
  
-   Остановите службу входа в сеть, чтобы контроллер домена не объявляет  
  
```  
15:14:01 [INFO] Stopping service NETLOGON  
15:14:01 [INFO] ControlService(STOP) on NETLOGON returned 1(gle=0)  
15:14:01 [INFO] DsRolepWaitForService: waiting for NETLOGON to enter one of 7 states  
15:14:01 [INFO] DsRolepWaitForService: QueryServiceStatus on NETLOGON returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:02 [INFO] DsRolepWaitForService: QueryServiceStatus on NETLOGON returned 1 (gle=0), SvcStatus.dwCS=1  
15:14:02 [INFO] DsRolepWaitForService: exiting because NETLOGON entered STOPPED state  
15:14:02 [INFO] DsRolepWaitForService(for any end state) on NETLOGON service returned 0  
15:14:02 [INFO] ControlService(STOP) on NETLOGON returned 0(gle=1062)  
15:14:02 [INFO] Exiting service-stop loop after service NETLOGON entered STOPPED state  
15:14:02 [INFO] StopService on NETLOGON returned 0  
15:14:02 [INFO] Configuring service NETLOGON to 1 returned 0  
15:14:02 [INFO] Updating service status to 4  
15:14:02 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Просмотрите файл dccloneconfig.xml для настроек, заданным администратором.  
  
-   В данном примере фал это пустой файл, поэтому все параметры создаются автоматически и автоматическая IP-адресация необходима из сети  
  
```  
15:14:02 [INFO] vDC Cloning: Clone config file C:\Windows\NTDS\DCCloneConfig.xml is considered to be a blank file (containing 0 bytes)  
15:14:02 [INFO] vDC Cloning: Parsing clone config file C:\Windows\NTDS\DCCloneConfig.xml returned HRESULT 0x0  
```  
  
-   Проверьте, что не существует службы или установленные программы, которые не являются частью DefaultDCCloneAllowList.xml или CustomDCCloneAllowList.xml  
  
```  
15:14:02 [INFO] vDC Cloning: Checking allowed list:  
15:14:03 [INFO] vDC Cloning: Completed checking allowed list:  
15:14:03 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Включите DHCP на сетевых адаптерах, поскольку администратор не указал информацию об IP  
  
```  
15:14:03 [INFO] vDC Cloning: Enable DHCP:  
15:14:03 [INFO] WMI Instance: Win32_NetworkAdapterConfiguration.Index=12  
15:14:03 [INFO] Method: EnableDHCP  
15:14:03 [INFO] HRESULT code: 0x0 (0)  
15:14:03 [INFO] Return Value: 0x0 (0)  
15:14:03 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:03 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Найдите эмулятор PDC  
  
-   Задайте сайт клона (в данном случае создается автоматически)  
  
-   Задайте имя клона (в данном случае создается автоматически)  
  
```  
15:14:03 [INFO] vDC Cloning: Found PDC. Name: DC1.root.fabrikam.com  
15:14:04 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:04 [INFO] vDC Cloning: Winlogon UI Notification #1: Domain Controller cloning is at 5% completion...  
15:14:05 [INFO] vDC Cloning: Winlogon UI Notification #2: Domain Controller cloning is at 10% completion...  
15:14:05 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:05 [INFO] Site of the cloned DC: Default-First-Site-Name  
```  
  
-   Создайте новый объект-компьютер клона  
  
-   Переименуйте клон в соответствии с новым именем  
  
```  
15:14:05 [INFO] vDC Cloning: Clone DC objects are created on PDC.  
15:14:05 [INFO] Name of the cloned DC: DC2-CL0001  
15:14:05 [INFO] DsRolepSetRegStringValue on System\CurrentControlSet\Services\NTDS\Parameters\CloneMachineName to DC2-CL0001 returned 0  
15:14:05 [INFO] vDC Cloning: Save CloneMachineName in registry: 0x0 (0)  
```  
  
-   Укажите параметры повышения уровня, на основе предыдущий файл dccloneconfig.xml или правила автоматического создания  
  
```  
15:14:05 [INFO] vDC Cloning: Promotion parameters setting:  
15:14:05 [INFO] DNS Domain Name: root.fabrikam.com  
15:14:05 [INFO] Replica Partner: \\DC1.root.fabrikam.com  
15:14:05 [INFO] Site Name: Default-First-Site-Name  
15:14:05 [INFO] DS Database Path: C:\Windows\NTDS  
15:14:05 [INFO] DS Log Path: C:\Windows\NTDS  
15:14:05 [INFO] SysVol Root Path: C:\Windows\SYSVOL  
15:14:05 [INFO] Account: root.fabrikam.com\DC2-CL0001$  
15:14:05 [INFO] Options: DSROLE_DC_CLONING (0x800400)  
```  
  
-   Запустите повышение уровня  
  
```  
15:14:05 [INFO] Promote DC as a clone  
15:14:05 [INFO] vDC Cloning: Winlogon UI Notification #3: Domain Controller cloning is at 15% completion...  
15:14:05 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:05 [INFO] vDC Cloning: Winlogon UI Notification #4: Domain Controller cloning is at 16% completion...  
15:14:05 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:05 [INFO] Validate supplied paths  
15:14:05 [INFO] Validating path C:\Windows\NTDS.  
15:14:05 [INFO] Path is a directory  
15:14:05 [INFO] Path is on a fixed disk drive.  
15:14:05 [INFO] Validating path C:\Windows\NTDS.  
15:14:05 [INFO] Path is a directory  
15:14:05 [INFO] Path is on a fixed disk drive.  
15:14:05 [INFO] Validating path C:\Windows\SYSVOL.  
15:14:05 [INFO] Path is on a fixed disk drive.  
15:14:05 [INFO] Path is on an NTFS volume  
15:14:05 [INFO] vDC Cloning: Winlogon UI Notification #5: Domain Controller cloning is at 17% completion...  
15:14:05 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:05 [INFO] Start the worker task  
15:14:05 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:14:05 [INFO] vDC Cloning: Winlogon UI Notification #6: Domain Controller cloning is at 20% completion...  
15:14:05 [INFO] Request for promotion returning 0  
15:14:05 [INFO] vDC Cloning: Winlogon UI Notification #7: Domain Controller cloning is at 21% completion...  
15:14:05 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Остановите и настройте все AD DS-службы, связанные с (NTDS, NTFRS/DFSR, KDC, DNS)  
  
> [!NOTE]  
> В данном сценарии ожидается, что требуется много времени для завершения работы службы DNS, как используется зон, интегрированных в AD, которые перестали быть доступны еще до остановки службы NTDS — см. события DNS, описанные ниже в этом разделе модуля.  
  
```  
15:14:15 [INFO] Stopping service NTDS  
15:14:15 [INFO] Stopping service NtFrs  
15:14:15 [INFO] ControlService(STOP) on NtFrs returned 1(gle=0)  
15:14:15 [INFO] DsRolepWaitForService: waiting for NtFrs to enter one of 7 states  
15:14:15 [INFO] DsRolepWaitForService: QueryServiceStatus on NtFrs returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:16 [INFO] DsRolepWaitForService: QueryServiceStatus on NtFrs returned 1 (gle=0), SvcStatus.dwCS=1  
15:14:16 [INFO] DsRolepWaitForService: exiting because NtFrs entered STOPPED state  
15:14:16 [INFO] DsRolepWaitForService(for any end state) on NtFrs service returned 0  
15:14:16 [INFO] ControlService(STOP) on NtFrs returned 0(gle=1062)  
15:14:16 [INFO] Exiting service-stop loop after service NtFrs entered STOPPED state  
15:14:16 [INFO] StopService on NtFrs returned 0  
15:14:16 [INFO] Configuring service NtFrs to 1 returned 0  
15:14:16 [INFO] Stopping service Kdc  
15:14:16 [INFO] ControlService(STOP) on Kdc returned 1(gle=0)  
15:14:16 [INFO] DsRolepWaitForService: waiting for Kdc to enter one of 7 states  
15:14:16 [INFO] DsRolepWaitForService: QueryServiceStatus on Kdc returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:17 [INFO] DsRolepWaitForService: QueryServiceStatus on Kdc returned 1 (gle=0), SvcStatus.dwCS=1  
15:14:17 [INFO] DsRolepWaitForService: exiting because Kdc entered STOPPED state  
15:14:17 [INFO] DsRolepWaitForService(for any end state) on Kdc service returned 0  
15:14:17 [INFO] ControlService(STOP) on Kdc returned 0(gle=1062)  
15:14:17 [INFO] Exiting service-stop loop after service Kdc entered STOPPED state  
15:14:17 [INFO] StopService on Kdc returned 0  
15:14:17 [INFO] Configuring service Kdc to 1 returned 0  
15:14:17 [INFO] Stopping service DNS  
15:14:17 [INFO] ControlService(STOP) on DNS returned 1(gle=0)  
15:14:17 [INFO] DsRolepWaitForService: waiting for DNS to enter one of 7 states  
15:14:17 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:18 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:19 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:20 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:21 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:22 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:23 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:24 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:25 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:26 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:27 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:28 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:29 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:30 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:31 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:32 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:33 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:34 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:35 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:36 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:37 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:38 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:39 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:40 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:41 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:42 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:43 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:44 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:45 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:46 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:47 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:48 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:49 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:50 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:51 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:52 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:53 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:54 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:55 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:56 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:57 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:58 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:14:59 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=3  
15:15:00 [INFO] DsRolepWaitForService: QueryServiceStatus on DNS returned 1 (gle=0), SvcStatus.dwCS=1  
15:15:00 [INFO] DsRolepWaitForService: exiting because DNS entered STOPPED state  
15:15:00 [INFO] DsRolepWaitForService(for any end state) on DNS service returned 0  
15:15:00 [INFO] ControlService(STOP) on DNS returned 0(gle=1062)  
15:15:00 [INFO] Exiting service-stop loop after service DNS entered STOPPED state  
15:15:00 [INFO] StopService on DNS returned 0  
15:15:00 [INFO] Configuring service DNS to 1 returned 0  
15:15:00 [INFO] ControlService(STOP) on NTDS returned 1(gle=1062)  
15:15:00 [INFO] DsRolepWaitForService: waiting for NTDS to enter one of 7 states  
15:15:00 [INFO] DsRolepWaitForService: QueryServiceStatus on NTDS returned 1 (gle=0), SvcStatus.dwCS=3  
15:15:01 [INFO] DsRolepWaitForService: QueryServiceStatus on NTDS returned 1 (gle=0), SvcStatus.dwCS=1  
15:15:01 [INFO] DsRolepWaitForService: exiting because NTDS entered STOPPED state  
15:15:01 [INFO] DsRolepWaitForService(for any end state) on NTDS service returned 0  
15:15:01 [INFO] ControlService(STOP) on NTDS returned 0(gle=1062)  
15:15:01 [INFO] Exiting service-stop loop after service NTDS entered STOPPED state  
15:15:01 [INFO] StopService on NTDS returned 0  
15:15:01 [INFO] Configuring service NTDS to 1 returned 0  
15:15:01 [INFO] Configuring service NTDS  
15:15:01 [INFO] Configuring service NTDS to 64 returned 0  
15:15:01 [INFO] vDC Cloning: Winlogon UI Notification #8: Domain Controller cloning is at 22% completion...  
15:15:01 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:01 [INFO] vDC Cloning: Winlogon UI Notification #9: Domain Controller cloning is at 25% completion...  
15:15:01 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Принудительно выполните синхронизацию времени NT5DS (NTP) с другим контроллером домена (обычно это PDCE)  
  
```  
15:15:02 [INFO] Forcing time sync  
```  
  
-   Связаться с контроллером домена, который содержит запись исходного контроллера домена для клона  
  
-   Очистить все имеющиеся билеты Kerberos  
  
```  
15:15:02 [INFO] Searching for a domain controller for the domain root.fabrikam.com that contains the account DC2$  
15:15:02 [INFO] Located domain controller DC1.root.fabrikam.com for domain root.fabrikam.com  
15:15:02 [INFO] vDC Cloning: Winlogon UI Notification #10: Domain Controller cloning is at 26% completion...  
15:15:02 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:02 [INFO] Directing kerberos authentication to DC1.root.fabrikam.com returns 0  
15:15:02 [INFO] DsRolepFlushKerberosTicketCache() successfully flushed the Kerberos ticket cache  
15:15:02 [INFO] vDC Cloning: Winlogon UI Notification #11: Domain Controller cloning is at 27% completion...  
15:15:02 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:02 [INFO] Using site Default-First-Site-Name for server \\DC1.root.fabrikam.com  
15:15:02 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:02 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Остановите службу входа в сеть и задайте для нее тип запуска  
  
```  
15:15:02 [INFO] Stopping service NETLOGON  
15:15:02 [INFO] Stopping service NETLOGON  
15:15:02 [INFO] vDC Cloning: Winlogon UI Notification #12: Domain Controller cloning is at 29% completion...  
15:15:02 [INFO] ControlService(STOP) on NETLOGON returned 1(gle=0)  
15:15:02 [INFO] DsRolepWaitForService: waiting for NETLOGON to enter one of 7 states  
15:15:02 [INFO] DsRolepWaitForService: QueryServiceStatus on NETLOGON returned 1 (gle=0), SvcStatus.dwCS=3  
15:15:03 [INFO] DsRolepWaitForService: QueryServiceStatus on NETLOGON returned 1 (gle=0), SvcStatus.dwCS=1  
15:15:03 [INFO] DsRolepWaitForService: exiting because NETLOGON entered STOPPED state  
15:15:03 [INFO] DsRolepWaitForService(for any end state) on NETLOGON service returned 0  
15:15:03 [INFO] ControlService(STOP) on NETLOGON returned 0(gle=1062)  
15:15:03 [INFO] Exiting service-stop loop after service NETLOGON entered STOPPED state  
15:15:03 [INFO] StopService on NETLOGON returned 0  
15:15:03 [INFO] Configuring service NETLOGON to 1 returned 0  
15:15:03 [INFO] Stopped NETLOGON  
15:15:03 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:03 [INFO] vDC Cloning: Winlogon UI Notification #13: Domain Controller cloning is at 30% completion...  
```  
  
-   Настройте службы DFSR/NTFRS на автоматический запуск  
  
-   Удалите их существующие файлы базы данных, чтобы выполнить непринудительную синхронизацию SYSVOL при следующем запуске службы  
  
```  
15:15:03 [INFO] Configuring service DFSR  
15:15:03 [INFO] Configuring service DFSR to 256 returned 0  
15:15:03 [INFO] Configuring service NTFRS  
15:15:03 [INFO] Configuring service NTFRS to 256 returned 0  
15:15:03 [INFO] Removing DFSR Database files for SysVol  
15:15:03 [INFO] Removing FRS Database files in C:\Windows\ntfrs\jet  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\log\edb.log  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\log\edbres00001.jrs  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\log\edbres00002.jrs  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\log\edbtmp.log  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\ntfrs.jdb  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\sys\edb.chk  
15:15:03 [INFO] Removed C:\Windows\ntfrs\jet\temp\tmp.edb  
15:15:04 [INFO] Created system volume path  
15:15:04 [INFO] Configuring service DFSR  
15:15:04 [INFO] Configuring service DFSR to 128 returned 0  
15:15:04 [INFO] Configuring service NTFRS  
15:15:04 [INFO] Configuring service NTFRS to 128 returned 0  
15:15:04 [INFO] vDC Cloning: Winlogon UI Notification #14: Domain Controller cloning is at 40% completion...  
15:15:04 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
```  
  
-   Запустите процесс повышения, используя имеющийся файл базы данных NTDS  
  
-   Связаться с хозяином RID  
  
> [!NOTE]  
> Служба AD DS здесь не установлены фактически, упомянут устаревший инструментарий в журнале  
  
```  
15:15:04 [INFO] Installing the Directory Service  
15:15:04 [INFO] Calling NtdsInstall for root.fabrikam.com  
15:15:04 [INFO] Starting Active Directory Domain Services installation  
15:15:04 [INFO] Validating user supplied options  
15:15:04 [INFO] Determining a site in which to install  
15:15:04 [INFO] Examining an existing forest...  
15:15:04 [INFO] Starting a replication cycle between DC1.root.fabrikam.com and the RID operations master (2008r2-01.root.fabrikam.com), so that the new replica will be able to create users, groups, and computer objects...  
15:15:04 [INFO] Configuring the local computer to host Active Directory Domain Services  
15:15:04 [INFO] EVENTLOG (Warning): NTDS General / Service Control : 1539  
Active Directory Domain Services could not disable the software-based disk write cache on the following hard disk.  
Hard disk:  
c:  
Data might be lost during system failures.  
15:15:10 [INFO] EVENTLOG (Informational): NTDS General / Internal Processing : 2041  
Duplicate event log entries were suppressed.  
See the previous event log entry for details. An entry is considered a duplicate if  
the event code and all of its insertion parameters are identical. The time period for  
this run of duplicates is from the time of the previous event to the time of this event.  
Event Code:  
80000603  
Number of duplicate entries:   
2  
15:15:10 [INFO] EVENTLOG (Informational): NTDS General / Internal Configuration : 2121  
This Active Directory Domain Services server is disabling the Recycle Bin. Deleted objects may not be undeleted at this time.  
```  
  
-   Измените имеющийся ИД вызова, который присутствовал в базе данных исходных компьютеров  
  
-   Создайте новый объект параметров NTDS для этого клона  
  
-   Реплицируйте в AD разность объектов с партнерского контроллера домена  
  
> [!NOTE]  
> Несмотря на то, что все объекты указаны как реплицированные, это просто метаданные, необходимые для разделения обновлений на категории. Все Неизменившиеся объекты в клонированной базе данных NTDS уже существуют и не требуют повторной репликации, так же, как с повышением на базе IFM.  
  
```  
15:15:10 [INFO] EVENTLOG (Informational): NTDS Replication / Replication : 1109  
The invocationID attribute for this directory server has been changed. The highest update sequence number at the time the backup was created is as follows:  
InvocationID attribute (old value):  
24e7b22f-4706-402d-9b4f-f2690f730b40  
InvocationID attribute (new value):  
f74cefb2-89c2-442c-b1ba-3234b0ed62f8  
Update sequence number:  
20520  
The invocationID is changed when a directory server is restored from backup media, is configured to host a writeable application directory partition, has been resumed after a virtual machine snapshot has been applied, after a virtual machine import operation, or after a live migration operation. Virtualized domain controllers should not be restored using virtual machine snapshots. The supported method to restore or rollback the content of an Active Directory Domain Services database is to restore a system state backup made with an Active Directory Domain Services-aware backup application.  
15:15:10 [INFO] EVENTLOG (Error): NTDS General / Internal Processing : 1168  
Internal error: An Active Directory Domain Services error has occurred.  
Additional Data  
Error value (decimal):  
2  
Error value (hexadecimal):  
2  
Internal ID:  
7011658  
15:15:11 [INFO] Creating the NTDS Settings object for this Active Directory Domain Controller on the remote AD DC DC1.root.fabrikam.com...  
15:15:11 [INFO] Replicating the schema directory partition  
15:15:11 [INFO] Replicated the schema container.  
15:15:12 [INFO] Active Directory Domain Services updated the schema cache.  
15:15:12 [INFO] Replicating the configuration directory partition  
15:15:12 [INFO] Replicating data CN=Configuration,DC=root,DC=fabrikam,DC=com: Received 2612 out of approximately 2612 objects and 94 out of approximately 94 distinguished name (DN) values...  
15:15:12 [INFO] Replicated the configuration container.  
15:15:13 [INFO] Replicating critical domain information...  
15:15:13 [INFO] Replicating data DC=root,DC=fabrikam,DC=com: Received 109 out of approximately 109 objects and 35 out of approximately 35 distinguished name (DN) values...  
15:15:13 [INFO] Replicated the critical objects in the domain container.  
```  
  
-   Заполните разделы глобального Каталога отсутствующими обновлениями  
  
-   Выполните критически важных Доменных служб Active Directory часть повышения  
  
```  
15:15:13 [INFO] EVENTLOG (Informational): NTDS General / Global Catalog : 1110  
Promotion of this domain controller to a global catalog will be delayed for the following interval.  
Interval (minutes):  
5  
This delay is necessary so that the required directory partitions can be prepared before the global catalog is advertised. In the registry, you can specify the number of seconds that the directory system agent will wait before promoting the local domain controller to a global catalog. For more information about the Global Catalog Delay Advertisement registry value, see the Resource Kit Distributed Systems Guide.  
15:15:14 [INFO] EVENTLOG (Informational): NTDS General / Service Control : 1000  
Microsoft Active Directory Domain Services startup complete, version 6.2.8225.0   
15:15:15 [INFO] Creating new domain users, groups, and computer objects  
15:15:16 [INFO] Completing Active Directory Domain Services installation  
15:15:16 [INFO] NtdsInstall for root.fabrikam.com returned 0  
15:15:16 [INFO] DsRolepInstallDs returned 0  
15:15:16 [INFO] Installed Directory Service  
```  
  
-   Выполните входящую репликацию SYSVOL  
  
```  
15:15:16 [INFO] vDC Cloning: Winlogon UI Notification #15: Domain Controller cloning is at 60% completion...  
15:15:16 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] Completed system volume replication  
15:15:18 [INFO] vDC Cloning: Winlogon UI Notification #16: Domain Controller cloning is at 70% completion...  
15:15:18 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] SetProductType to 2 [LanmanNT] returned 0  
15:15:18 [INFO] Set the product type  
15:15:18 [INFO] vDC Cloning: Winlogon UI Notification #17: Domain Controller cloning is at 71% completion...  
15:15:18 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] vDC Cloning: Winlogon UI Notification #18: Domain Controller cloning is at 72% completion...  
15:15:18 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] Set the system volume path for NETLOGON  
15:15:18 [INFO] vDC Cloning: Winlogon UI Notification #19: Domain Controller cloning is at 73% completion...  
15:15:18 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] Replicating non critical information  
15:15:18 [INFO] User specified to not replicate non-critical data  
15:15:18 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] vDC Cloning: Winlogon UI Notification #20: Domain Controller cloning is at 80% completion...  
15:15:18 [INFO] Stopped the DS  
15:15:18 [INFO] vDC Cloning: Set vDCCloningUpdate event.  
15:15:18 [INFO] vDC Cloning: Winlogon UI Notification #21: Domain Controller cloning is at 90% completion...  
15:15:18 [INFO] Configuring service NTDS  
15:15:18 [INFO] Configuring service NTDS to 16 returned 0  
```  
  
-   Включите регистрацию DNS клиентов  
  
```  
15:15:18 [INFO] vDC Cloning: Set DisableDynamicUpdate reg value to 0 to enable dynamic update records registration.  
15:15:18 [INFO] vDC Cloning: Set UseDynamicDns reg value to 1 to enable dynamic update records registration.  
15:15:18 [INFO] vDC Cloning: Set RegistrationEnabled reg value to 1 to enable dynamic update records registration.  
```  
  
-   Запустите модули SYSPREP, указанные в DefaultDCCloneAllowList.xml <SysprepInformation> элемента.  
  
```  
15:15:18 [INFO] vDC Cloning: Running sysprep providers.  
15:15:32 [INFO] vDC Cloning: Completed running sysprep providers.  
```  
  
-   Повышение уровня клонирования выполнено  
  
-   Удалите флаг загрузки DSRM, чтобы обычно следующий раз сервер загрузился  
  
-   Переименуйте файл dccloneconfig.xml, чтобы не считывался повторно при следующей перезагрузке  
  
-   Перезагрузите компьютер  
  
```  
15:15:32 [INFO] The attempted domain controller operation has completed  
15:15:32 [INFO] Updating service status to 4  
15:15:32 [INFO] DsRolepSetOperationDone returned 0  
15:15:32 [INFO] vDC Cloning: Set vDCCloningComplete event.  
15:15:32 [INFO] vDC Cloneing: Clearing Boot into DSRM flag succeeded.  
15:15:32 [INFO] vDC Cloning: Winlogon UI Notification #22: Cloning Domain Controller succeeded. Now rebooting...  
15:15:33 [INFO] vDC Cloning: Renamed vDC clone configuration file.  
15:15:33 [INFO] vDC Cloning: The old name is: C:\Windows\NTDS\DCCloneConfig.xml  
15:15:33 [INFO] vDC Cloning: The new name is: C:\Windows\NTDS\DCCloneConfig.20120207-151533.xml  
15:15:34 [INFO] vDC Cloning: Release Ipv4 on interface 'Wired Ethernet Connection 2', result=0.  
15:15:34 [INFO] vDC Cloning: Release Ipv6 on interface 'Wired Ethernet Connection 2', result=0.  
15:15:34 [INFO] Rebooting machine  
```  
  
##### <a name="active-directory-web-services-event-log"></a>Журнал событий веб-служб Active Directory  
Во время клонирования, NTDS. Базу данных DIT чаще всего автономном режиме достаточно долгое время. ВЕБ-служба регистрирует по крайней мере одно событие для этого. После завершения клонирования веб-служба запускаются, регистрируют отсутствие еще не допустимого сертификата компьютера еще (он может или не может быть, в зависимости от среды развертывания PKI корпорации Майкрософт с автоматической регистрацией или нет) и затем запускают экземпляр для нового контроллера домена.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**1202**|События экземпляра веб-служба|Этот компьютер теперь расположен указанный каталог экземпляр, но веб-служб Active Directory не удалось обработать его. Веб-службы Active Directory будут периодически пытаться повторить эту операцию.<br /><br />Экземпляр Active Directory: NTDS<br /><br />LDAP-порт экземпляра Active Directory: 389<br /><br />SSL-порт экземпляра Active Directory: 636|  
|**1000**|События экземпляра веб-служба|Запуск веб-служб Active Directory|  
|**1008**|События экземпляра веб-служба|Веб-службы Active Directory успешно снижены привилегии безопасности|  
|**1100**|События экземпляра веб-служба|Значения, указанные в <appsettings> раздела файла конфигурации веб-служб Active Directory, загружены без ошибок.|  
|**1400**|События экземпляра веб-служба|События сертификата «веб-служб Active Directory не удалось найти сертификат сервера с указанным именем. Сертификат необходим для использования подключений SSL/TLS. Чтобы использовать подключения SSL/TLS, убедитесь, что на компьютере установлен действительный сертификат проверки подлинности из доверенного центра сертификации (ЦС).<br /><br />Имя сертификата:*<Server FQDN>*|  
|**1100**|События экземпляра веб-служба|Значения, указанные в <appsettings> раздела файла конфигурации веб-служб Active Directory, загружены без ошибок.|  
|**1200**|События экземпляра веб-служба|Веб-службы Active Directory перешла экземпляр указанного каталога.<br /><br />Экземпляр Active Directory: NTDS<br /><br />LDAP-порт экземпляра Active Directory: 389<br /><br />SSL-порт экземпляра Active Directory: 636|  
  
##### <a name="dns-server-event-log"></a>Журнал событий DNS-сервера  
Служба DNS будет иметь кратковременные периоды недоступности ожидаемого во время клонирования, как служба DNS все еще выполняется, когда базы данных AD DS находится в автономном режиме. Это происходит, если используется интегрированный DNS Active Directory, но не при использовании основной или дополнительной DNS. Эти ошибки регистрируются в журнале несколько раз. После завершения клонирования DNS возвращается в режим нормально.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**4013**|Служба DNS-сервера|DNS-сервер ожидает от доменных служб Active Directory (AD DS) сигнала, что первичная Синхронизация каталога завершена. Служба DNS-сервера не удается запустить до завершения начальной синхронизации, так как критические данные DNS могут не еще реплицироваться на этот контроллер домена. Если события в журнал событий AD DS показывает, что существует проблема с разрешением DNS-имя, рассмотрите возможность добавления IP-адреса другого DNS-сервера для данного домена в список DNS-серверов в свойствах протокола IP этого компьютера. Это событие регистрируется каждые две минуты, пока AD DS сообщит об успешного завершения начальной синхронизации.|  
|**4015**|Служба DNS-сервера|DNS-сервер обнаружил критическую ошибку Active Directory. Проверьте работоспособность Active Directory. Расширенное сообщение об ошибке отладочная информация (может отсутствовать):»»». Данные о событии содержат сведения об ошибке.|  
|**4000**|Служба DNS-сервера|DNS-серверу не удалось открыть Active Directory.  Этот DNS-сервер настроен для получения и использования данных из каталога для указанной зоны и не удается загрузить зону без него.  Проверьте работоспособность Active Directory и перезагрузите зону. Данные о событии является код ошибки.|  
|**4013**|Служба DNS-сервера|DNS-сервер ожидает от доменных служб Active Directory (AD DS) сигнала, что первичная Синхронизация каталога завершена. Служба DNS-сервера не удается запустить до завершения начальной синхронизации, так как критические данные DNS могут не еще реплицироваться на этот контроллер домена. Если события в журнал событий AD DS показывает, что существует проблема с разрешением DNS-имя, рассмотрите возможность добавления IP-адреса другого DNS-сервера для данного домена в список DNS-серверов в свойствах протокола IP этого компьютера. Это событие регистрируется каждые две минуты, пока AD DS сообщит об успешного завершения начальной синхронизации.|  
|**2**|Служба DNS-сервера|DNS-сервер запущен.|  
|**4**|Служба DNS-сервера|DNS-сервер завершил фоновую загрузку зон. Все зоны теперь доступны для обновлений DNS и передачи зон, как их индивидуальной конфигурацией.|  
  
##### <a name="file-replication-service-event-log"></a>Журнал событий службы репликации файлов  
Служба репликации файлов непринудительно синхронизирует от партнера во время операции клонирования. Клонирование это достигается путем удаления файлов базы данных NTFRS и оставляя содержимое SYSVOL без изменений для использования в качестве данных для предварительного задания начальных значений. Ожидаются две попытки синхронизации.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**13562**|NtFrs|Ниже следует сводка предупреждений и ошибок, обнаруженных службой репликации файлов, домен контроллера DC2.root.Fabrikam.com репликации FRS сведений конфигурации набора.<br /><br />Не удалось выполнить привязку к контроллеру домена. Попытка будет повторена в следующем цикле опроса.|  
|**13502**|NtFrs|Остановка службы репликации файлов.|  
|**13565**|NtFrs|Служба репликации файлов инициализирует системный том с данными с другого контроллера домена. Компьютер DC2 не может стать контроллером домена, до завершения этого процесса. Системный том станет общим ресурсом под именем SYSVOL.<br /><br />Чтобы проверить наличие общего ресурса SYSVOL, в командной строке введите:<br /><br />команду net share<br /><br />После завершения процесса инициализации службой репликации файлов, должен появиться общий ресурс SYSVOL.<br /><br />Для инициализации системного тома может занять некоторое время. Время зависит от объема системного тома, наличия других контроллеров домена и интервал репликации между контроллерами домена.|  
|**13501**|NtFrs|Запуск службы репликации файлов.|  
|**13502**|NtFrs|Остановка службы репликации файлов.|  
|**13503**|NtFrs|Служба репликации файлов остановлена.|  
|**13565**|NtFrs|Служба репликации файлов инициализирует системный том с данными с другого контроллера домена. Компьютер DC2 не может стать контроллером домена, до завершения этого процесса. Системный том станет общим ресурсом под именем SYSVOL.<br /><br />Чтобы проверить наличие общего ресурса SYSVOL, в командной строке введите:<br /><br />команду net share<br /><br />После завершения процесса инициализации службой репликации файлов, должен появиться общий ресурс SYSVOL.<br /><br />Для инициализации системного тома может занять некоторое время. Время зависит от объема системного тома, наличия других контроллеров домена и интервал репликации между контроллерами домена.|  
|**13501**|NtFrs|Запуск службы репликации файлов.|  
|**13553**|NtFrs|Служба репликации файлов успешно добавила этот компьютер к следующему набору репликации:<br /><br />«СИСТЕМНЫЙ ТОМ ДОМЕНА (ОБЩИЙ РЕСУРС SYSVOL)»<br /><br />Ниже приводится информация, относящаяся к данному событию.<br /><br />DNS-имя компьютера*<Domain Controller FQDN>*<br /><br />Имя набора репликации —*<Domain Controller>*<br /><br />Корневой путь набора репликации —*<path>*<br /><br />Путь конечной папки репликации —*<path>*<br /><br />Путь рабочей папки репликации —*<path>*|  
|**13520**|NtFrs|Служба репликации файлов переместила ранее существовавшие файлы из <path>для * <path> *\NtFrs_PreExisting___See_EventLog.<br /><br />Служба репликации файлов может удалить файлы в * <path> *\NtFrs_PreExisting___See_EventLog в любой момент. Файлы можно сохранить от удаления копируя их из * <path> *\NtFrs_PreExisting___See_EventLog. Копирование этих файлов в c:\windows\sysvol\domain может привести к конфликту имен, если эти файлы уже существуют на другие партнером репликации.<br /><br />В некоторых случаях служба репликации файлов может скопировать файл из * <path> *\NtFrs_PreExisting___See_EventLog в * <path> * вместо реплицировать его с другим партнером репликации.<br /><br />Можно освободить место на диске в любой момент, удалив файлы в * <path> *\NtFrs_PreExisting___See_EventLog.»|  
|**13508**|NtFrs|он служба репликации файлов не удается разрешить репликацию с * \\\\ <Domain Controller FQDN> * для * <Domain Controller> * для * <path> * с помощью<br /><br />DNS name *\\\\<Domain Controller FQDN>*. FRS будет повторять.<br /><br />Ниже перечислены некоторые причины, по которым может выдаваться это предупреждение.<br /><br />[1] FFRS не может разрешить DNS-имя * \\\\ <Domain Controller FQDN> * с этого компьютера.<br /><br />[2] FRS не запущена на * \\\\ <Domain Controller FQDN> *.<br /><br />[3] сведения о топологии в доменных службах Active Directory для этой реплики имеет реплицированы еще не на все контроллеры домена.<br /><br />Это сообщение журнала событий будут отображаться только для каждого подключения, после устранения проблемы появится другое сообщение, указывающее на то, что соединение установлено.|  
|**13509**|NtFrs|Служба репликации файлов разрешила репликацию с * \\\\ <Domain Controller FQDN> * для * <Domain Controller> * для * <Path> * после нескольких повторных попыток.|  
|**13516**|NtFrs|Служба репликации файлов больше не препятствует компьютеру * <Domain Controller> * стать контроллером домена. Инициализация системного тома и службы Netlogon уведомление о том, что системный том теперь готов к общим ресурсом под именем SYSVOL.<br /><br />Введите команду «net share», чтобы проверить наличие общего ресурса SYSVOL.»|  
  
##### <a name="dfs-replication-event-log"></a>Журнал событий репликации DFS  
Службы DFSR непринудительно синхронизирует от партнера во время операции клонирования. Клонирование это достигается путем удаления файлов базы данных DFSR и оставляя содержимое SYSVOL без изменений для использования в качестве данных для предварительного задания начальных значений. Ожидаются две попытки синхронизации.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**1004**|DFSR|Служба репликации DFS запущена.|  
|**1314**|DFSR|Служба репликации DFS успешно настроила файлы журнала отладки.<br /><br />Дополнительные сведения:<br /><br />Путь к файлу журнала отладки: C:\Windows\debug|  
|**6102**|DFSR|Служба репликации DFS успешно зарегистрировала поставщика WMI|  
|**1206**|DFSR|Служба репликации DFS успешно связалась с контроллером домена DC2.corp.contoso.com для получения сведений о конфигурации о.|  
|**1210**|DFSR|Служба репликации DFS успешно настроила прослушиватель RPC на принятие запросов на репликацию.<br /><br />Дополнительные сведения:<br /><br />Порт: 0"|  
|**4614**|DFSR|Служба репликации DFS инициализировала SYSVOL по локальному пути C:\Windows\SYSVOL\domain и готова к начальной репликации. Реплицированная папка останется в состоянии начальной синхронизации, до выполнения репликации со своим партнером. Сервер не выполняет выдвинут на роль контроллера домена, контроллер домена не объявления и функционировать как контроллер домена, пока эта проблема не будет устранена. Это может произойти, если указанный партнер также находится в состоянии начальной синхронизации или обнаружены нарушения общего доступа на этом сервере или партнере синхронизации. Если данное событие произошло в результате миграции SYSVOL от службы репликации файлов (FRS) к репликации DFS, изменения не будут реплицироваться пока эта проблема не будет устранена. Это может привести к папке SYSVOL на данном сервере может стать не синхронизированной с другими контроллерами домена.<br /><br />Дополнительные сведения:<br /><br />Имя реплицированной папки: Общий ресурс SYSVOL<br /><br />Идентификатор реплицированной папки:*<GUID>*<br /><br />Имя группы репликации: Системный том домена<br /><br />Идентификатор группы репликации:*<GUID>*<br /><br />КОД участника:*<GUID>*<br /><br />Только для чтения: 0|  
|**4604**|DFSR|Служба репликации DFS успешно инициализировала реплицированную папку SYSVOL по локальному пути C:\Windows\SYSVOL\domain. Этот участник завершил начальную синхронизацию SYSVOL с партнером dc1.corp.contoso.com. Чтобы проверить наличие общего ресурса SYSVOL, откройте окно командной строки и введите ««net share».<br /><br />Дополнительные сведения:<br /><br />Имя реплицированной папки: Общий ресурс SYSVOL<br /><br />Идентификатор реплицированной папки:*<GUID>*<br /><br />Имя группы репликации: Системный том домена<br /><br />Идентификатор группы репликации:*<GUID>*<br /><br />КОД участника:*<GUID>*<br /><br />Партнер синхронизации:*<domain controller FQDN>*|  
  
## <a name="BKMK_TshootVDCSafeRestore"></a>Диагностика при безопасном восстановлении контроллера домена виртуализированных  
  
### <a name="tools-for-troubleshooting"></a>Средства для диагностики  
  
#### <a name="logging-options"></a>Параметры ведения журнала  
Встроенные журналы представляют собой наиболее важное средство устранения неполадок, связанных с восстановлением моментального снимка безопасном контроллера домена. Все эти журналы включены и настроена максимальная степень подробности по умолчанию.  
  
|||  
|-|-|  
|**Операция**|**Журнал**|  
|**Создание моментального снимка**|-Событие Просмотр событий\журналы приложений и служб служб\microsoft\windows\hyper V-Worker|  
|**Восстановление моментального снимка**|-Событие Просмотр событий\журналы приложений и Служб\служба каталогов<br />-Просмотр событий\журналы windows\система событий<br />-Просмотр событий\журналы windows\приложение событий<br />-Событие Просмотр событий\журналы приложений и служб\Служба репликации<br />-Событие Просмотр событий\журналы приложений и служб\репликация DFS<br />-Просмотр событий\журналы приложений и служб\dns событий<br />-Событие Просмотр событий\журналы приложений и служб служб\microsoft\windows\hyper V-Worker|  
  
#### <a name="tools-and-commands-for-troubleshooting-domain-controller-configuration"></a>Средства и команды для диагностики конфигурации контроллера домена  
Чтобы диагностировать не поясненные в журналах проблемы, используйте следующие средства в качестве отправной точки:  
  
-   Dcdiag.exe  
  
-   Repadmin.exe  
  
-   Сетевой монитор 3.4  
  
#### <a name="BKMK_TshhotSafeRestore"></a>Общая методология диагностики при безопасном восстановлении контроллера домена  
  
1.  Безопасное восстановление снимка ожидается, но у вас возникли проблемы?  
  
    1.  Просмотрите журнал событий служб каталогов  
  
        1.  Возникают ошибки восстановления моментального снимка?  
  
        2.  Возникают ошибки репликации AD?  
  
    2.  Изучите журнал событий системы  
  
        1.  Возникают ошибки связи?  
  
        2.  Возникают ошибки AD?  
  
2.  Безопасное восстановление снимка является непредвиденным?  
  
    1.  Просмотрите журналы аудита низкоуровневой оболочки, чтобы определить причину отката  
  
    2.  Свяжитесь со всеми администраторами низкоуровневой оболочки и выясните, кто выполнил откат виртуальной Машины без уведомления  
  
3.  Сервер реализует защита от отката USN и не выполняет безопасное восстановление?  
  
    1.  Просмотрите журнал событий служб каталогов для неподдерживаемой низкоуровневой оболочки или служб интеграции  
  
    2.  Изучите операционной системы и убедитесь в под управлением Windows Server 2012?  
  
### <a name="BKMK_TshootSpecificSafeRestore"></a>Диагностика определенных проблем  
  
#### <a name="events"></a>События  
Все домена безопасного восстановления снимка виртуализированного контроллера события записываются в журнал событий служб каталогов виртуальной Машины контроллера домена, восстановление. Журналы событий приложений, системы, службы репликации файлов и репликации DFS также могут содержать ценные диагностические данные по завершившемуся с ошибкой восстановлению.  
  
Ниже перечислены события безопасного восстановления конкретных Windows Server 2012 в журнале событий служб каталогов.  
  
|||  
|-|-|  
|**Код события**|**2170**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Предупреждение|  
|**Сообщение**|Обнаружено изменение ИД создания.<br /><br />ИД создания в доменных Службах (старое значение): %1<br /><br />Текущий ИД создания в виртуальной Машине (новое значение): %2<br /><br />ИД создания изменяется после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции. *<COMPUTERNAME>*создаст новый ИД вызова для восстановления контроллера домена. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, созданной с помощью доменных служб Active Directory приложение резервного копирования.|  
|**Примечания и решение**|Это событие успешного выполнения операции, если снимок был ожидаемым. В противном случае Изучите журнал событий Hyper-V-Worker или свяжитесь с администратором низкоуровневой оболочки.|  
  
|||  
|-|-|  
|**Код события**|**2174**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Контроллер домена не является восстановленные снимком виртуального контроллера домена ни клоном виртуального домена контроллера.|  
|**Примечания и решение**|Ожидаемое событие при запуске физических контроллеров домена или виртуализированных контроллеров домена не восстановленных из моментального снимка.|  
  
|||  
|-|-|  
|**Код события**|**2181**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Транзакция была прервана из-за была возвращена в предыдущее состояние виртуальной машины.  Это происходит после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Транзакции отслеживают изменение ИД создания виртуальной Машины|  
  
|||  
|-|-|  
|**Код события**|**2185**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*остановить службу FRS или DFSR, используемую для репликации папки SYSVOL.<br /><br />Имя службы: % 1<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*необходимо инициализировать не заслуживающее доверия восстановление в локальной реплике SYSVOL. Это выполняется путем остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а затем запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление. После перезапуска службы FRS или DFSR, будет зарегистрировано событие 2187.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Все данные SYSVOL на этом контроллере домена заменяются копией с партнерского контроллера домена.|  
|**Код события**|2186|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось остановить службу FRS или DFSR, используемую для репликации папки SYSVOL.<br /><br />Имя службы: % 1<br /><br />Код ошибки: % 2<br /><br />Сообщение об ошибке: % 3<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*необходимо инициализировать не заслуживающее доверия восстановление в локальной реплике SYSVOL. Это делается остановки службу FRS или DFSR репликации, используемую для репликации папки SYSVOL, а затем запустить ее с помощью соответствующих разделов реестра и значения, чтобы инициализировать восстановление. *<COMPUTERNAME>*не удалось остановить запущенную службу и завершить не заслуживающее доверия восстановление. Выполните непринудительное восстановление вручную.|  
|**Примечания и решение**|Просмотрите журналы событий системы и служб FRS и DFSR для получения дополнительных сведений.|  
  
|||  
|-|-|  
|**Код события**|**2187**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*запустить службу FRS или DFSR, используемую для репликации папки SYSVOL.<br /><br />Имя службы: % 1<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*требовалось инициализировать не заслуживающее доверия восстановление в локальной реплике SYSVOL. Это было сделано по остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а затем запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Все данные SYSVOL на этом контроллере домена заменяются копией с партнерского контроллера домена.|  
  
|||  
|-|-|  
|**Код события**|**2188**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось запустить службу FRS или DFSR, используемую для репликации папки SYSVOL.<br /><br />Имя службы: % 1<br /><br />Код ошибки: % 2<br /><br />Сообщение об ошибке: % 3<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*требуется инициализировать непринудительное восстановление в локальной реплике SYSVOL. Для этого остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а также запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление. *<COMPUTERNAME>*не удалось запустить службу FRS или DFSR, используемую для репликации папки SYSVOL и завершить не заслуживающее доверия восстановление. Выполните непринудительное восстановление вручную и перезапустите службу.|  
|**Примечания и решение**|Просмотрите журналы событий системы и служб FRS и DFSR для получения дополнительных сведений.|  
  
|||  
|-|-|  
|**Код события**|**2189**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*Задайте следующие значения реестра для инициализации реплики SYSVOL во время непринудительного восстановления:<br /><br />Раздел реестра: % 1<br /><br />Значение реестра: %2<br /><br />Значение параметра реестра: %3<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*требуется инициализировать непринудительное восстановление в локальной реплике SYSVOL. Для этого необходимо остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а также запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Все данные SYSVOL на этом контроллере домена заменяются копией с партнерского контроллера домена.|  
  
|||  
|-|-|  
|**Код события**|**2190**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось задать следующие параметры реестра для инициализации реплики SYSVOL во время непринудительного восстановления:<br /><br />Раздел реестра: % 1<br /><br />Значение реестра: %2<br /><br />Значение параметра реестра: %3<br /><br />Код ошибки: % 4<br /><br />Сообщение об ошибке: % 5<br /><br />Active Directory обнаружил, что виртуальную машину, на котором размещена роль контроллера домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*требуется инициализировать непринудительное восстановление в локальной реплике SYSVOL. Для этого необходимо остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а также запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление. *<COMPUTERNAME>*не удалось задать перечисленные выше параметры реестра и завершить не заслуживающее доверия восстановление. Выполните непринудительное восстановление вручную.|  
|**Примечания и решение**|Просмотрите журналы событий системы и приложений. Выполните поиск приложений сторонних разработчиков, которые могли воспрепятствовать обновлениям реестра.|  
  
|||  
|-|-|  
|**Код события**|**2200**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*Инициализирует репликацию для обновления контроллера домена. После завершения репликации, будет зарегистрировано событие 2201.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Отмечает начало входящей репликации AD.|  
  
|||  
|-|-|  
|**Код события**|**2201**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*завершил репликацию для обновления контроллера домена.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Отмечает конец входящей репликации AD.|  
  
|||  
|-|-|  
|**Код события**|**2202**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*Сбой репликацию для обновления контроллера домена. Контроллер домена будет обновлен после следующей репликации по расписанию.|  
|**Примечания и решение**|Просмотрите журналы событий служб каталогов и системы. Используйте repadmin.exe, чтобы попытаться выполнить репликацию принудительно и отметьте произошедшие сбои.|  
  
|||  
|-|-|  
|**Код события**|**2204**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*обнаружил изменение идентификатора создания виртуальной машины. Изменение означает, что виртуальный контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*будет выполнять следующие операции для защиты возвращенного контроллера домена от возможного расхождения в данных и для предотвращения создания субъектов безопасности с одинаковыми идентификаторами безопасности:<br /><br />Создание нового идентификатора вызова<br /><br />Сделать недействительным текущий пул относительных ИДЕНТИФИКАТОРОВ<br /><br />Владение ролями FSMO будет проверено при следующей входящей репликации. В течение этого периода Если контроллера домена была роль FSMO, она будет недоступна.<br /><br />Запуск операции восстановления службы репликации SYSVOL.<br /><br />Запуск репликации для перевода контроллера домена, возвращенного в актуальное состояние.<br /><br />Запрос нового пула относительных ИДЕНТИФИКАТОРОВ.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Здесь поясняются все различные операции сброса, которые будут выполнены в рамках процесса безопасного восстановления.|  
  
|||  
|-|-|  
|**Код события**|**2205**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*недействительным текущий пул относительных ИДЕНТИФИКАТОРОВ после виртуального контроллера домена был возвращен в предыдущее состояние.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Необходимо удалить локальный пул относительных ИДЕНТИФИКАТОРОВ, так как контроллер домена перенесся время, и они могут уже состоялся.|  
  
|||  
|-|-|  
|**Код события**|**2206**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|ОШИБКА|  
|**Сообщение**|*<COMPUTERNAME>*не удалось сделать недействительным текущий пул относительных ИДЕНТИФИКАТОРОВ после виртуального контроллера домена был возвращен в предыдущее состояние.<br /><br />Дополнительные данные:<br /><br />Код ошибки: %1<br /><br />Значение ошибки: %2|  
|**Примечания и решение**|Просмотрите журналы событий служб каталогов и системы. Проверить, хозяин RID находится в оперативном режиме можно связаться с этим сервером с использованием Dcdiag.exe/Test: RidManager|  
  
|||  
|-|-|  
|**Код события**|**2207**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|ОШИБКА|  
|**Сообщение**|*<COMPUTERNAME>*Ошибка при восстановлении после виртуального контроллера домена был возвращен в предыдущее состояние. Был запрошен перезапуск в режиме DSRM. Проверьте предыдущие события Дополнительные сведения.|  
|**Примечания и решение**|Просмотрите журналы событий служб каталогов и системы.|  
  
|||  
|-|-|  
|**Код события**|**2208**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Информационное сообщение|  
|**Сообщение**|*<COMPUTERNAME>*удалить базы данных DFSR для инициализации реплики SYSVOL во время непринудительного восстановления.|  
|**Примечания и решение**|Ожидается при восстановлении снимка. Это гарантирует, что DFSR непринудительно синхронизирует SYSVOL с партнерского контроллера домена. Обратите внимание, что все другие реплицированные DFSR папки на одном томе с SYSVOL также непринудительно будут синхронизированы (не рекомендуется, чтобы контроллеры размещали настраиваемые наборы DFSR на одном томе с SYSVOL домена).|  
  
|||  
|-|-|  
|**Код события**|**2209**|  
|**Источник**|Microsoft-Windows-ActiveDirectory_DomainService|  
|**Уровень серьезности**|Ошибка|  
|**Сообщение**|*<COMPUTERNAME>*не удалось удалить базы данных DFSR.<br /><br />Дополнительные данные:<br /><br />Код ошибки: %1<br /><br />Значение ошибки: %2<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. *<COMPUTERNAME>*требуется инициализировать непринудительное восстановление в локальной реплике SYSVOL. При использовании DFSR для этого необходимо остановить службу DFSR, удалить базы данных DFSR и перезапустить службу. После этого Служба DFSR перестроит базы данных и запустит начальную синхронизацию.|  
|**Примечания и решение**|Просмотрите журнал событий DFSR.|  
  
#### <a name="error-messages"></a>Сообщения об ошибках  
Нет никаких прямых интерактивный ошибок, не контроллера безопасном восстановлении снимка виртуализированного домена; все информация о клонировании регистрируется в журналах событий служб каталогов. Естественно все ошибки критически важной репликации или сервер рекламы проявляются в качестве симптомов в других местах.  
  
#### <a name="known-issues-and-support-scenarios"></a>Известные проблемы и сценарии поддержки  
[Общая методология диагностики безопасном восстановлении контроллера домена](../../../ad-ds/manage/virtual-dc/Virtualized-Domain-Controller-Troubleshooting.md#BKMK_TshootSpecificSafeRestore) обычно достаточно для диагностики большинства ошибок.  
  
|||  
|-|-|  
|**Проблема**|**Не удается создать новые субъекты безопасности на контроллере домена, недавно выполнялось безопасное восстановление**|  
|**Симптомы**|После восстановления снимка попытки создать новый субъект безопасности (пользователя, компьютер, группу) на этом контроллере домена завершаются ошибкой с:<br /><br />Ошибка 0x2010<br /><br />Службе каталогов не удалось выделить относительный идентификатор.|  
|**Решение и примечания**|Эта проблема может быть вызвано восстановленный компьютер располагает устаревшими сведениями о роли FSMO хозяина RID. Если роль перемещена на этот или другой контроллер домена после был выполнены и последующего восстановления моментального снимка, восстановленный контроллер домена не будет сведениями о хозяине RID до завершения начальной репликации.<br /><br />Чтобы устранить проблему, необходимо разрешить завершения репликации AD входящего трафика для восстановленного контроллера домена. Если по-прежнему не работает, проверьте, все контроллеры домена располагают такими же достоверными сведениями, которые контроллере домена размещается хозяин RID.|  
  
|||  
|-|-|  
|**Проблема**|**Восстановленные контроллеры домена общий доступ к SYSVOL и не отправляют объявления**|  
|**Симптомы**|После восстановления снимка один или несколько контроллеров домена не отправляют объявления, имеют sysvol и не имеют актуальным содержимым SYSVOL|  
|**Решение и примечания**|Восходящие партнеры контроллера домена не имеют рабочей реплики SYSVOL, которая правильно реплицируется с DFSR или FRS. Эта проблема не связана с безопасным восстановлением, однако, вероятнее всего манифеста как проблема с безопасным восстановлением, поскольку клиент не знал о другой проблеме репликации, затрагивающей невосстановленные контроллеры домена|  
  
### <a name="advanced-troubleshooting"></a>Дополнительные возможности устранения неполадок  
В этом модуле рассматривается расширенная Диагностика с использованием *работа* журналов в качестве примеров с некоторыми пояснениями возникшей ситуации. Если вы понимаете, как выглядит успешной работе виртуализированного контроллера домена, легко сможете выявить сбои в своей среде. Эти журналы сгруппированы по источнику, упорядоченные по возрастанию *ожидается* события, связанные с клонированным контроллером домена в пределах каждого из журналов.  
  
#### <a name="restoring-a-domain-controller-that-replicates-sysvol-using-dfsr"></a>Восстановление контроллера домена, Реплицирующего SYSVOL с помощью DFSR  
  
##### <a name="directory-services-event-log"></a>Журнал событий служб каталогов  
Журнал службы каталогов содержит основную часть информации об операциях безопасного восстановления. Низкоуровневая оболочка изменяет ИД создания Виртуальной машины и службы NTDS регистрирует это, делает пул RID недействительным и изменяет ИД вызова. Новый ИД создания Виртуальной машины, а серверы реплицируют входящие данные AD. Служба DFSR останавливается и его базы данных, где размещается SYSVOL, удаляется, что вызывает непринудительную синхронизацию входящего трафика. Выполняется корректировка верхнего предела номера последовательного обновления.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**2170**|ActiveDirectory_DomainService|Обнаружено изменение ИД создания.<br /><br />ИД создания в доменных Службах (старое значение):<br /><br />*<number>*<br /><br />Текущий ИД создания в виртуальной Машине (новое значение):<br /><br />*<number>*<br /><br />ИД создания изменяется после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции. Доменные службы Active Directory создаст новый ИД вызова для восстановления контроллера домена. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, созданной с помощью доменных служб Active Directory приложение резервного копирования.»|  
|**2181**|ActiveDirectory_DomainService|Транзакция была прервана из-за была возвращена в предыдущее состояние виртуальной машины.  Это происходит после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции.|  
|**2204**|ActiveDirectory_DomainService|Доменные службы Active Directory обнаружили изменение идентификатора создания виртуальной машины. Изменение означает, что виртуальный контроллер домена был возвращен в предыдущее состояние. Доменные службы Active Directory будет выполнять следующие операции для защиты возвращенного контроллера домена от возможного расхождения в данных и для предотвращения создания субъектов безопасности с одинаковыми идентификаторами безопасности:<br /><br />Создание нового идентификатора вызова<br /><br />Сделать недействительным текущий пул относительных ИДЕНТИФИКАТОРОВ<br /><br />Владение ролями FSMO будет проверено при следующей входящей репликации. В течение этого периода Если контроллера домена была роль FSMO, она будет недоступна.<br /><br />Запуск операции восстановления службы репликации SYSVOL.<br /><br />Запуск репликации для перевода контроллера домена, возвращенного в актуальное состояние.<br /><br />Запрос нового пула относительных ИДЕНТИФИКАТОРОВ.»|  
|**2181**|ActiveDirectory_DomainService|Транзакция была прервана из-за была возвращена в предыдущее состояние виртуальной машины.  Это происходит после применения моментального снимка виртуальной машины, после операции импорта виртуальной машины или после операции динамической миграции.|  
|**1109**|ActiveDirectory_DomainService|Атрибут invocationID для данного сервера каталогов изменен. Наибольший номер последовательного обновления на момент создания резервной копии выглядит следующим образом:<br /><br />Атрибут InvocationID (старое значение):<br /><br />*<GUID>*<br /><br />Атрибут InvocationID (новое значение):<br /><br />*<GUID>*<br /><br />Номер последовательного обновления:<br /><br />*<number>*<br /><br />Атрибут invocationID изменяется при восстановлении сервера каталогов с резервного носителя, настроен для хранения раздела каталога приложений для записи, возобновил моментальный снимок виртуальной машины после установки, после операции импорта виртуальной машины или после операции динамической миграции. Виртуализированные контроллеры домена не должен быть восстановлен с помощью моментальных снимков виртуальной машины. Поддерживаемый метод восстановления или отката содержимого базы данных доменных служб Active Directory — восстановление резервной копии состояния системы, совершенные в домен Active Directory службы резервного копирования приложение, поддерживающее.»|  
|**2179**|ActiveDirectory_DomainService|Атрибут msDS-GenerationId объекта-компьютера контроллера домена задан следующий параметр:<br /><br />Атрибут GenerationID:<br /><br />*<number>*|  
|**2200**|ActiveDirectory_DomainService|Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. Доменные службы Active Directory инициализируют репликацию для обновления контроллера домена. После завершения репликации, будет зарегистрировано событие 2201.|  
|**2201**|ActiveDirectory_DomainService|Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. Доменные службы Active Directory завершили репликацию для обновления контроллера домена.|  
|**2185**|ActiveDirectory_DomainService|Доменные службы Active Directory остановить службу FRS или DFSR, используемую для репликации папки SYSVOL.<br /><br />Имя службы:<br /><br />DFSR<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. Доменные службы Active Directory должны инициализировать не заслуживающее доверия восстановление в локальной реплике SYSVOL. Это выполняется путем остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а затем запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление. Зарегистрировано событие 2187 будет после перезапуска службы FRS или DFSR.»|  
|**2208**|ActiveDirectory_DomainService|Доменных служб Active Directory удалили базы данных DFSR для инициализации реплики SYSVOL во время непринудительного восстановления.<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. Доменные службы Active Directory требуется инициализировать непринудительное восстановление в локальной реплике SYSVOL. При использовании DFSR для этого необходимо остановить службу DFSR, удалить базы данных DFSR и перезапустить службу. После этого Служба DFSR перестроит базы данных и запустит начальную синхронизацию. "|  
|**2187**|ActiveDirectory_DomainService|Доменные службы Active Directory запустить службу FRS или DFSR, используемую для репликации папки SYSVOL.<br /><br />Имя службы:<br /><br />DFSR<br /><br />Active Directory обнаружил, что виртуальную машину, на которой размещен контроллер домена был возвращен в предыдущее состояние. Доменные службы Active Directory требовалось инициализировать не заслуживающее доверия восстановление в локальной реплике SYSVOL. Это было сделано по остановить службу FRS или DFSR, используемую для репликации папки SYSVOL, а затем запустить ее с соответствующие разделы реестра и значения, чтобы инициализировать восстановление. "|  
|**1587**|ActiveDirectory_DomainService|Службе каталогов был восстановлен или настроен для размещения раздел каталога приложения. В результате его идентификатор репликации изменился. Партнер запросил изменения репликации, используя его старый идентификатор. Начальный последовательный номер был изменен.<br /><br />Конечный сервер службы каталогов соответствующий следующего объекта GUID запросил изменения, начиная с USN, предшествующего USN, с которой локальной службы каталогов был восстановлен с архивного носителя.<br /><br />GUID объекта:<br /><br />*<GUID> (<FQDN of partner domain controller>)*<br /><br />USN во время восстановления:<br /><br />*<number>*<br /><br />В результате вектор синхронизации конечного сервера службы каталогов имеет следующие параметры.<br /><br />Предыдущий GUID базы данных:<br /><br />*<GUID>*<br /><br />Предыдущий USN объекта:<br /><br />*<number>*<br /><br />Предыдущий USN свойства:<br /><br />*<number>*<br /><br />Новый GUID базы данных:<br /><br />*<GUID>*<br /><br />Новый USN объекта:<br /><br />*<number>*<br /><br />Новый USN свойства:<br /><br />*<number>*|  
  
##### <a name="system-event-log"></a>Журнал системных событий  
Журнал событий системы регистрирует, что прошло определенное машинное время при включении отключенной виртуальной машины обратно в оперативный режим и синхронизации с временем узла. Пул относительных ИДЕНТИФИКАТОРОВ становится недействительным, а службы DFSR или FRS перезапускаются.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**1**|Общие ядра|Системное время изменено с *?<now>* из *< время/Дата снимка >*.<br /><br />Причина изменения: Приложением или компонентом системы время изменено.|  
|**16654**|Directory-Services-SAM|Пул идентификаторов учетных записей (относительных идентификаторов) сделан недействительным. Это может произойти в следующих ожидаемых случаях:<br /><br />1. контроллер домена восстановлен из резервной копии.<br /><br />2. контроллер домена работает на виртуальной машине, восстановлен из моментального снимка.<br /><br />3. администратор вручную недействительным пул.<br /><br />В разделе https://go.microsoft.com/fwlink/?LinkId=226247 Дополнительные сведения.|  
|**7036**|Диспетчер управления службами|Служба репликации DFS находится в режиме остановки.|  
|**7036**|Диспетчер управления службами|Служба репликации DFS запущена.|  
  
##### <a name="application-event-log"></a>Журнал событий приложений  
Журнал событий приложений регистрирует остановку и запуск базы данных DFSR.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**103**|ESENT|\\\.\C:\System Volume Information\DFSR\database DFSRs (1360)*_<GUID>*\dfsr.db: ядром СУБД остановлен экземпляр (0).<br /><br />Неправильное отключение: 0<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], 0.141 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.000 [9], 0.000 [10], 0.016 [11], 0.000 [12], [13] 0.000, 0.000 [14], [15] 0.000.|  
|**102**|ESENT|\\\.\C:\System Volume Information\DFSR\database DFSRs (532)*_<GUID>*\dfsr.db: СУБД (6.02.8189.0000) запускает новый экземпляр (0).|  
|**105**|ESENT|\\\.\C:\System Volume Information\DFSR\database DFSRs (532)*_<GUID>*\dfsr.db: ядро СУБД запустило новый экземпляр (0). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], [4] 0.000, 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.031 [9], 0.000 [10], 0.000 [11].|  
|||\\\.\C:\System Volume Information\DFSR\database DFSRs (532)*_<GUID>*\dfsr.db: СУБД создана новая база данных (1, \\\.\C:\System Volume Information\DFSR\database*_<GUID>*\dfsr.db). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.016 [3], [4] 0.062, 0.000 [5], [6] 0.016, 0.000 [7], [8] 0.000, 0.015 [9], 0.000 [10], 0.000 [11].|  
  
##### <a name="dfs-replication-event-log"></a>Журнал событий репликации DFS  
Служба DFSR останавливается, а базы данных, которая содержит SYSVOL, удаляется, что вызывает непринудительную синхронизацию входящего трафика.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**1006**|DFSR|Остановка службы репликации DFS.|  
|**1008**|DFSR|Служба репликации DFS остановлена.|  
|**1002**|DFSR|Запуск службы репликации DFS.|  
|**1004**|DFSR|Служба репликации DFS запущена.|  
|**1314**|DFSR|Служба репликации DFS успешно настроила файлы журнала отладки.<br /><br />Дополнительные сведения:<br /><br />Путь к файлу журнала отладки: C:\Windows\debug|  
|**6102**|DFSR|Служба репликации DFS успешно зарегистрировала поставщика WMI.|  
|**1206**|DFSR|Репликация DFS служба успешно связалась с контроллером домена * <domain controller FQDN> * для получения сведений о конфигурации.|  
|**1210**|DFSR|Служба репликации DFS успешно настроила прослушиватель RPC на принятие запросов на репликацию.<br /><br />Дополнительные сведения:<br /><br />Порт: 0|  
|**4614**|DFSR|Служба репликации DFS инициализировала SYSVOL по локальному пути C:\Windows\SYSVOL\domain и готова к начальной репликации. Реплицированная папка останется в состоянии начальной синхронизации, до выполнения репликации со своим партнером. Сервер не выполняет выдвинут на роль контроллера домена, контроллер домена не объявления и функционировать как контроллер домена, пока эта проблема не будет устранена. Это может произойти, если указанный партнер также находится в состоянии начальной синхронизации или обнаружены нарушения общего доступа на этом сервере или партнере синхронизации. Если данное событие произошло в результате миграции SYSVOL от службы репликации файлов (FRS) к репликации DFS, изменения не будут реплицироваться пока эта проблема не будет устранена. Это может привести к папке SYSVOL на данном сервере может стать не синхронизированной с другими контроллерами домена.<br /><br />Дополнительные сведения:<br /><br />Имя реплицированной папки: Общий ресурс SYSVOL<br /><br />Идентификатор реплицированной папки:*<GUID>*<br /><br />Имя группы репликации: Системный том домена<br /><br />Идентификатор группы репликации:*<GUID>*<br /><br />КОД участника:*<GUID>*<br /><br />Только для чтения: 0|  
|**4604**|DFSR|Служба репликации DFS успешно инициализировала реплицированную папку SYSVOL по локальному пути C:\Windows\SYSVOL\domain. Этот участник завершил начальную синхронизацию SYSVOL с партнером dc1.corp.contoso.com. Чтобы проверить наличие общего ресурса SYSVOL, откройте окно командной строки и введите команду «net share».<br /><br />Дополнительные сведения:<br /><br />Имя реплицированной папки: Общий ресурс SYSVOL<br /><br />Идентификатор реплицированной папки:*<GUID>*<br /><br />Имя группы репликации: Системный том домена<br /><br />Идентификатор группы репликации:*<GUID>*<br /><br />КОД участника:*<GUID>*<br /><br />Партнер синхронизации:*<partner domain controller FQDN>*|  
  
#### <a name="restoring-a-domain-controller-that-replicates-sysvol-using-frs"></a>Восстановление контроллера домена, Реплицирующего SYSVOL с помощью FRS  
Журнал событий репликации файлов используется в этом случае вместо журнала событий DFSR. Журнал событий приложений также регистрирует различные события, связанные с FRS. В противном случае, службы каталогов и журнале системных событий сообщений, обычно те же и в том же порядок, как было описано выше.  
  
##### <a name="file-replication-service-event-log"></a>Журнал событий службы репликации файлов  
Служба FRS останавливается и перезапускается со значением D2 BURFLAGS для выполнения непринудительной синхронизации SYSVOL.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**13502**|NTFRS|Остановка службы репликации файлов.|  
|**13503**|NTFRS|Служба репликации файлов остановлена.|  
|**13501**|NTFRS|Запуск службы репликации файлов.|  
|**13512**|NTFRS|Служба репликации файлов обнаружила используемый кэш записи данных на диске, содержащем каталог c:\windows\ntfrs\jet на компьютере DC4. Служба репликации файлов может не суметь выполнить восстановление при диск питания и потери критических обновлений.|  
|**13565**|NTFRS|Служба репликации файлов инициализирует системный том с данными с другого контроллера домена. DC4 компьютер не может стать контроллером домена, до завершения этого процесса. Системный том станет общим ресурсом под именем SYSVOL.<br /><br />Чтобы проверить наличие общего ресурса SYSVOL, в командной строке введите:<br /><br />команду net share<br /><br />После завершения процесса инициализации службой репликации файлов, должен появиться общий ресурс SYSVOL.<br /><br />Для инициализации системного тома может занять некоторое время. Время зависит от объема системного тома доступности другие контроллеры домена и от частоты репликаций между контроллерами домена.»|  
|**13520**|NTFRS|Служба репликации файлов переместила ранее существовавшие файлы из * <path> * для * <path> *\NtFrs_PreExisting___See_EventLog.<br /><br />Служба репликации файлов может удалить файлы в * <path> *\NtFrs_PreExisting___See_EventLog в любой момент. Файлы можно сохранить от удаления копируя их из * <path> *\NtFrs_PreExisting___See_EventLog. Копирование файлов в * <path> * может привести к конфликту имен, если эти файлы уже существуют на другие партнером репликации.<br /><br />В некоторых случаях служба репликации файлов может скопировать файл из * <path> *\NtFrs_PreExisting___See_EventLog в * <path> * вместо реплицировать его с другим партнером репликации.<br /><br />Можно освободить место на диске в любой момент, удалив файлы в * <path> *\NtFrs_PreExisting___See_EventLog.|  
|**13553**|NTFRS|Служба репликации файлов успешно добавила этот компьютер к следующему набору репликации:<br /><br />«СИСТЕМНЫЙ ТОМ ДОМЕНА (ОБЩИЙ РЕСУРС SYSVOL)»<br /><br />Ниже приводится информация, относящаяся к данному событию.<br /><br />DNS-имя компьютера»*<domain controller FQDN>*»<br /><br />Имя набора репликации — "*<domain controller name>*»<br /><br />Корневой путь набора репликации — "*<path>*»<br /><br />Путь конечной папки репликации — "* <path> * »<br /><br />Путь рабочей папки репликации — "*<path>*»|  
|**13554**|NTFRS|Служба репликации файлов успешно добавила перечисленные ниже подключения к набору репликации:<br /><br />«СИСТЕМНЫЙ ТОМ ДОМЕНА (ОБЩИЙ РЕСУРС SYSVOL)»<br /><br />Приходит от "*<partner domain controller FQDN>*»<br /><br />Исходит на "*<partner domain controller FQDN>*»<br /><br />Дополнительная информация может появиться в последующих сообщениях журнала событий.|  
|**13516**|NTFRS|Служба репликации файлов больше не препятствует компьютеру DC4 стать контроллером домена. Инициализация системного тома и службы Netlogon уведомление о том, что системный том теперь готов к общим ресурсом под именем SYSVOL.<br /><br />Введите команду «net share», чтобы проверить наличие общего ресурса SYSVOL.|  
  
##### <a name="application-event-log"></a>Журнал событий приложений  
База данных FRS останавливается и запускается и очищается операции D2 BURFLAGS.  
  
||||  
|-|-|-|  
|**Код события**|**Источник**|**Сообщение**|  
|**327**|ESENT|Служба NTFRS (1424) ядро СУБД отсоединенный базы данных (1, c:\windows\ntfrs\jet\ntfrs.jdb). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.015 [2], 0.000 [3], 0.000 [4], [5] 0.000, 0.516 [6], 0.000 [7], [8] 0.000, 0.000 [9], [10] 0.000, 0.063 [11], [12] 0.000.<br /><br />Восстановлена кэша: 0|  
|**103**|ESENT|Служба NTFRS (1424) ядром СУБД остановлен экземпляр (0).<br /><br />Неправильное отключение: 0<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.031 [9], 0.000 [10], 0.016 [11], 0.000 [12], [13] 0.000, 0.047 [14], [15] 0.000.|  
|**102**|ESENT|Служба NTFRS (3000) СУБД (6.02.8189.0000) запускает новый экземпляр (0).|  
|**105**|ESENT|Служба NTFRS (3000) ядро СУБД запустило новый экземпляр (0). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], [4] 0.000, 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.062 [9], 0.000 [10], 0.141 [11].|  
|**103**|ESENT|Служба NTFRS (3000) ядром СУБД остановлен экземпляр (0).<br /><br />Неправильное отключение: 0<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.000 [9], 0.000 [10], 0.000 [11], 0.000 [12], [13] 0.015, 0.000 [14], [15] 0.000.|  
|**102**|ESENT|Служба NTFRS (3000) СУБД (6.02.8189.0000) запускает новый экземпляр (0).|  
|**105**|ESENT|Служба NTFRS (3000) ядро СУБД запустило новый экземпляр (0). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], [4] 0.000, 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.078 [9], 0.000 [10], 0.109 [11].|  
|**325**|ESENT|Служба NTFRS (3000) СУБД создана новая база данных (1, c:\windows\ntfrs\jet\ntfrs.jdb). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.016 [3], [4] 0.016, 0.000 [5], [6] 0.015, 0.000 [7], [8] 0.000, 0.078 [9], 0.016 [10], 0.000 [11].|  
|**103**|ESENT|Служба NTFRS (3000) ядром СУБД остановлен экземпляр (0).<br /><br />Неправильное отключение: 0<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.000 [2], 0.000 [3], 0.000 [4], 0.078 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0,125 [9], 0.016 [10], 0.000 [11], 0.000 [12], [13] 0.000, 0.000 [14], [15] 0.000.|  
|**102**|ESENT|Служба NTFRS (3000) СУБД (6.02.8189.0000) запускает новый экземпляр (0).|  
|**105**|ESENT|Служба NTFRS (3000) ядро СУБД запустило новый экземпляр (0). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.016 [1], 0.000 [2], 0.000 [3], [4] 0.094, 0.000 [5], [6] 0.000, 0.000 [7], [8] 0.000, 0.032 [9], 0.000 [10], 0.000 [11].|  
|**326**|ESENT|Служба NTFRS (3000) ядро СУБД присоединило базу данных (1, c:\windows\ntfrs\jet\ntfrs.jdb). (Время = 0 с)<br /><br />Последовательность внутренней синхронизации: 0.000 [1], 0.015 [2], 0.000 [3], 0.000 [4], [5] 0.016, 0.015 [6], 0.000 [7], [8] 0.000, 0.000 [9], [10] 0.000, 0.000 [11], [12] 0.000.<br /><br />Сохраненные кэша: 1|  
  


