---
ms.assetid: a7ef2fba-b05c-4be2-93b2-b9456244c3ad
title: Мониторинг Active Directory для обнаружения признаков компрометации
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: 2924b04e0853549f86934f0145f2cb46f07a4939
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "86966586"
---
# <a name="monitoring-active-directory-for-signs-of-compromise"></a>Мониторинг Active Directory для обнаружения признаков компрометации

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

*Номер закона 5. нескончаемые бдительности — это стоимость безопасности.* - [10 неизменяемых законов по администрированию безопасности](/previous-versions//cc722488(v=technet.10))  
  
Надежная система мониторинга журнала событий является важной частью любой безопасной Active Directory разработки. Многие компромиссы безопасности компьютера могут быть обнаружены на ранних этапах мероприятия, если жертви применяют соответствующий мониторинг журнала событий и оповещения. Этот заключение поддерживается независимыми отчетами. Например, [отчет о нарушении данных 2009 Verizon](http://www.verizonbusiness.com/resources/security/reports/2009_databreach_rp.pdf) сообщает:  
  
«Очевидность неэффективности отслеживания событий и анализа журналов остается неенигмай. Возможности обнаружения таковы. исследования отметили, что 66 процентов жертв имели достаточный доступ к доказательству в своих журналах, чтобы обнаружить, что они были более тщательно изучены при анализе таких ресурсов. "  
  
Отсутствие активных журналов событий для мониторинга остается единообразным недостатком во многих планах защиты компаний. [Отчет о нарушении целостности данных 2012 Verizon](http://www.verizonbusiness.com/resources/reports/rp_data-breach-investigations-report-2012_en_xg.pdf) обнаружил, что несмотря на то, что на 85 процентов нарушений заняло несколько недель, в течение 84% жертвами было очевидно о нарушении в журналах событий.  
  
## <a name="windows-audit-policy"></a>Политика аудита Windows

Ниже приведены ссылки на блог о официальной корпоративной поддержке Майкрософт. Содержимое этих блогов содержит советы, рекомендации и рекомендации по аудиту, которые помогут вам повысить безопасность инфраструктуры Active Directory и являются ценным ресурсом при проектировании политики аудита.  
  
* [Аудит доступа к глобальным объектам — это магическая](/archive/blogs/askds/global-object-access-auditing-is-magic) процедура управления, которая называется расширенной конфигурацией политики аудита, добавленной в Windows 7 и windows Server 2008 R2, которая позволяет задать типы данных, которые вы хотите легко проследить, а также не изменять сценарии и auditpol.exe.  
* [Введение в аудит изменений в windows 2008](/archive/blogs/askds/introducing-auditing-changes-in-windows-2008) — введение в аудит изменений, внесенных в windows Server 2008.  
* Полезные [Советы по аудиту в Vista и 2008](/archive/blogs/askds/cool-auditing-tricks-in-vista-and-2008) . объясняются интересные функции аудита Windows Vista и windows Server 2008, которые можно использовать для устранения неполадок или для просмотра того, что происходит в вашей среде.  
* [Один и тот же магазин для аудита в Windows server 2008 и Windows Vista](/archive/blogs/askds/one-stop-shop-for-auditing-in-windows-server-2008-and-windows-vista) — содержит компиляцию функций аудита и информации, содержащейся в windows Server 2008 и Windows Vista.  
  
Следующие ссылки содержат сведения об улучшениях аудита Windows в Windows 8 и Windows Server 2012, а также сведения об аудите AD DS в Windows Server 2008.  
  
* [Новые возможности аудита безопасности](/previous-versions/orphan-topics/ws.11/hh849638(v=ws.11)) . содержит общие сведения о новых функциях аудита безопасности в Windows 8 и windows Server 2012.  
* [AD DS аудит](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731607(v=ws.10)) пошаговых руководств. Описание новой функции аудита домен Active Directory Services (AD DS) в Windows Server 2008. В нем также приводятся процедуры для реализации этой новой функции.  
  
### <a name="windows-audit-categories"></a>Категории аудита Windows

До Windows Vista и Windows Server 2008 в Windows имелись только девять категорий политики аудита журнала событий:  
  
* События входа в учетную запись  
* Управление учетными записями  
* Доступ к службе каталогов  
* События входа  
* Доступ к объектам  
* Изменение политики  
* Использование привилегий  
* Отслеживание процессов  
* Системные события  
  
Эти девять традиционных категорий аудита составляют политику аудита. Каждая категория политики аудита может быть включена для событий успешного выполнения, сбоя или успехов и сбоев. Их описания содержатся в следующем разделе.  
  
#### <a name="audit-policy-category-descriptions"></a>Описания категорий политики аудита  
Категории политики аудита включают следующие типы сообщений журнала событий.  
  
##### <a name="audit-account-logon-events"></a>Аудит событий входа в учетную запись  
Сообщает каждый экземпляр субъекта безопасности (например, пользователя, компьютера или учетной записи службы), который выполняет вход или выход из системы на одном компьютере, где используется другой компьютер для проверки учетной записи. События входа в учетную запись создаются при проверке подлинности учетной записи субъекта безопасности домена на контроллере домена. При проверке подлинности локального пользователя на локальном компьютере создается событие входа в систему, регистрируемое в локальном журнале безопасности. События выхода из учетной записи не регистрируются.  
  
Эта категория создает много «шума», так как Windows постоянно ведет учетные записи на локальных и удаленных компьютерах во время обычного предприятия. Все же план безопасности должен включать в себя успех и неудачу этой категории аудита.  
  
##### <a name="audit-account-management"></a>Аудит управления учетными записями  
Этот параметр аудита определяет, следует ли отслеживать Управление пользователями и группами. Например, пользователи и группы должны быть отслеживаниются при создании, изменении или удалении учетной записи пользователя или компьютера, группы безопасности или группы рассылки. При переименовании, отключении или включении учетной записи пользователя или компьютера; или при изменении пароля пользователя или компьютера. Событие может быть создано для пользователей или групп, которые добавляются или удаляются из других групп.  
  
##### <a name="audit-directory-service-access"></a>Аудит доступа к службе каталогов  

Этот параметр политики определяет, следует ли выполнять аудит доступа субъекта безопасности к объекту Active Directory, имеющему собственный указанный системный список управления доступом (SACL). Как правило, эта категория должна быть включена только на контроллерах домена. Если этот параметр включен, это приводит к большому количеству шумов.  
  
##### <a name="audit-logon-events"></a>Аудит событий входа в систему  
События входа создаются при проверке подлинности локального субъекта безопасности на локальном компьютере. События входа в систему записывают входы в домен, которые выполняются на локальном компьютере. События выхода учетной записи не создаются. Если этот параметр включен, события входа создают много "шума", но по умолчанию они должны быть включены в любом плане аудита безопасности.  
  
##### <a name="audit-object-access"></a>Аудит доступа к объектам  
Доступ к объектам может создавать события при доступе к определенным объектам с включенным аудитом (например, открытие, чтение, переименование, удаление или закрытие). После включения основной категории аудита администратор должен отдельно определить, какие объекты будут включены в аудите. Многие системные объекты Windows поставляются с включенным аудитом, поэтому включение этой категории обычно начнет создавать события до того, как администратор определит какие – либо.  
  
Эта категория очень «шумный» и создаст пять и десять событий для доступа к каждому объекту. Для получения полезной информации администраторам может быть сложно создать аудит объектов. Его следует включать только при необходимости.  
  
##### <a name="auditing-policy-change"></a>Аудит изменений политики  
Этот параметр политики определяет, следует ли выполнять аудит всех изменений в политиках назначения прав пользователя, политиках брандмауэра Windows, политиках доверия или изменениях в политике аудита. Эта категория должна быть включена на всех компьютерах. Он создает очень маленький шум.  
  
##### <a name="audit-privilege-use"></a>Аудит использования привилегий  

В Windows есть десятки прав и разрешений пользователя (например, вход в качестве пакетного задания и работа в составе операционной системы). Этот параметр политики определяет, следует ли выполнять аудит каждого экземпляра субъекта безопасности, используя права пользователя или привилегии. Включение этой категории приводит к большому количеству шума, но может быть полезным для отслеживания учетных записей субъекта безопасности с повышенными привилегиями.  
  
##### <a name="audit-process-tracking"></a>Аудит отслеживания процессов  
Этот параметр политики определяет, следует ли выполнять аудит подробных сведений об отслеживании процесса для таких событий, как активация программы, завершение процесса, дублирование обработки и косвенный доступ к объектам. Он полезен для отслеживания вредоносных пользователей и используемых ими программ.  
  
При включении отслеживания процессов аудита создается большое количество событий, поэтому обычно для него устанавливается значение **без аудита**. Однако этот параметр может предоставить значительные преимущества во время реагирования на инциденты от подробного журнала запущенных процессов и времени их запуска. Для контроллеров домена и других серверов инфраструктуры с одной ролью эта категория может быть безопасно включена во время. Одноролевые серверы не создают много трафика отслеживания процессов в течение обычного курса их обязанностей. Таким образом, они могут быть включены для захвата несанкционированных событий в случае их возникновения.  
  
##### <a name="system-events-audit"></a>Аудит системных событий  

Системные события — это всего лишь универсальная Категория «Catch-All», которая регистрирует различные события, влияющие на компьютер, безопасность системы или журнал безопасности. Он включает события для завершения работы компьютера и перезапуска, сбоев питания, изменения системного времени, инициализации пакетов проверки подлинности, очистки журнала аудита, проблем с олицетворением и узла других общих событий. Как правило, включение этой категории аудита приводит к созданию большого количества шумов, но создает достаточное количество очень полезных событий, которые не рекомендуется включать.  
  
#### <a name="advanced-audit-policies"></a>Расширенные политики аудита

Начиная с Windows Vista и Windows Server 2008, Майкрософт улучшена возможность выбора категории журнала событий путем создания подкатегорий в каждой основной категории аудита. Подкатегории позволяют выполнять аудит гораздо более детально, чем в противном случае, с помощью основных категорий. С помощью подкатегорий можно включить только части определенной основной категории и пропустить создание событий, для которых не используется. Каждую подкатегорию политики аудита можно включить для отслеживания событий успеха, отказа либо успеха и отказа.  
  
Чтобы получить список всех доступных подкатегорий аудита, просмотрите контейнер расширенной политики аудита в групповая политика объекте или введите следующую команду в командной строке на любом компьютере под управлением Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008, Windows 8, Windows 7 или Windows Vista.  
  
`auditpol /list /subcategory:*`
  
Чтобы получить список настроенных на данный момент подкатегорий аудита на компьютере под Windows Server 2012, Windows Server 2008 R2 или Windows 2008, введите следующее:  
  
`auditpol /get /category:*`
  
На следующем снимке экрана показан пример auditpol.exe списка текущей политики аудита.  
  
![наблюдение за AD](media/Monitoring-Active-Directory-for-Signs-of-Compromise/SAD_5.gif)  
  
> [!NOTE]  
> Групповая политика не всегда точно сообщает о состоянии всех включенных политик аудита, в то время как auditpol.exe имеет значение. Дополнительные сведения см. [в статье получение эффективной политики аудита в Windows 7 и 2008 R2](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731607(v=ws.10)) .  
  
Каждая основная категория имеет несколько подкатегорий. Ниже приведен список категорий, их подкатегорий и описание их функций.  
  
### <a name="auditing-subcategories-descriptions"></a>Описания подкатегорий аудита  
Подкатегории аудита политики включают следующие типы сообщений журнала событий:  
  
#### <a name="account-logon"></a>Вход в учетную запись  
  
##### <a name="credential-validation"></a>Проверка учетных данных.  
Эта подкатегория сообщает результаты проверок на учетные данные, отправленные для запроса на вход в учетную запись пользователя. Эти события происходят на компьютере, который является полномочным для учетных данных. Для учетных записей домена контроллер домена является полномочным, в то время как для локальных учетных записей локальный компьютер является полномочным.  
  
В средах домена большая часть событий входа в учетную запись регистрируется в журнале безопасности контроллеров домена, которые являются полномочными для учетных записей домена. Однако эти события могут возникать на других компьютерах в Организации, когда для входа в систему используются локальные учетные записи.  
  
##### <a name="kerberos-service-ticket-operations"></a>Операции с билетом службы Kerberos  
Эта подкатегория сообщает о событиях, создаваемых процессами запросов билетов Kerberos на контроллере домена, который является полномочным для учетной записи домена.  
  
##### <a name="kerberos-authentication-service"></a>Служба проверки подлинности Kerberos  
Эта подкатегория сообщает о событиях, создаваемых службой проверки подлинности Kerberos. Эти события происходят на компьютере, который является полномочным для учетных данных.  
  
##### <a name="other-account-logon-events"></a>Другие события входа в учетную запись  
Эта подкатегория сообщает о событиях, происходящих в ответ на учетные данные, отправленные для запроса на вход в учетную запись пользователя, которые не связаны с проверкой учетных данных или билетами Kerberos. Эти события происходят на компьютере, который является полномочным для учетных данных. Для учетных записей домена контроллер домена является полномочным, в то время как для локальных учетных записей локальный компьютер является полномочным.  
  
В средах доменов большинство событий входа в систему регистрируются в журнале безопасности контроллеров домена, которые являются полномочными для учетных записей домена. Однако эти события могут возникать на других компьютерах в Организации, когда для входа в систему используются локальные учетные записи. Примеры могут включать следующие.  
  
* Отключение службы удаленных рабочих столов сеансов  
* Новые сеансы службы удаленных рабочих столов  
* Блокировка и разблокировка рабочей станции  
* Вызов экранной заставки  
* Отклонения заставки  
* Обнаружение атаки на воспроизведение Kerberos, при которой два раза получают запрос Kerberos с одинаковыми сведениями  
* Доступ к беспроводной сети, предоставленной учетной записи пользователя или компьютера  
* Доступ к сети проводной 802.1 x, предоставленной учетной записи пользователя или компьютера  
  
#### <a name="account-management"></a>Управление учетными записями  
  
##### <a name="user-account-management"></a>Управление учетными записями пользователей  
Эта подкатегория сообщает о каждом событии управления учетными записями пользователей, например о создании, изменении или удалении учетной записи пользователя. Учетная запись пользователя переименована, отключена или включена; или пароль установлен или изменен. Если этот параметр политики аудита включен, администраторы могут отслеживать события для обнаружения вредоносного, случайного и полномочного создания учетных записей пользователей.  
  
##### <a name="computer-account-management"></a>Управление учетными записями компьютеров  
Эта подкатегория сообщает о каждом событии управления учетными записями компьютеров, например, когда создается, изменяется, удаляется, переименована, отключена или включена учетная запись компьютера.  
  
##### <a name="security-group-management"></a>Управление группами безопасности  
Эта подкатегория сообщает о каждом событии управления группами безопасности, например при создании, изменении или удалении группы безопасности, а также при добавлении или удалении члена группы безопасности. Если этот параметр политики аудита включен, администраторы могут отслеживать события для обнаружения вредоносного, случайного и полномочного создания учетных записей групп безопасности.  
  
##### <a name="distribution-group-management"></a>Управление группами распространения  
Эта подкатегория сообщает о каждом событии управления группами распространения, например при создании, изменении или удалении группы рассылки, а также при добавлении или удалении участника из группы рассылки. Если этот параметр политики аудита включен, администраторы могут отслеживать события для обнаружения вредоносного, случайного и полномочного создания учетных записей групп.  
  
##### <a name="application-group-management"></a>Управление группой приложений  
Эта подкатегория сообщает о каждом событии управления группами приложений на компьютере, например при создании, изменении или удалении группы приложений, а также при добавлении или удалении члена группы приложений. Если этот параметр политики аудита включен, администраторы могут отслеживать события для обнаружения вредоносного, случайного и полномочного создания учетных записей групп приложений.  
  
##### <a name="other-account-management-events"></a>Другие события управления учетными записями  
Эта подкатегория сообщает о других событиях управления учетными записями.  
  
#### <a name="detailed-process-tracking"></a>Подробное отслеживание процессов  
  
##### <a name="process-creation"></a>Создание процесса  
Эта подкатегория сообщает о создании процесса и имени пользователя или программы, создавшей его.  
  
##### <a name="process-termination"></a>Завершение процесса  
Эта подкатегория сообщает о завершении процесса.  
  
##### <a name="dpapi-activity"></a>Действие DPAPI  
Эта подкатегория сообщает о шифровании или расшифровке вызовов в интерфейсе прикладного программирования защиты данных (DPAPI). DPAPI используется для защиты секретных данных, таких как сохраненный пароль и сведения о ключе.  
  
##### <a name="rpc-events"></a>События RPC  
Эта подкатегория сообщает о событиях подключения удаленного вызова процедур (RPC).  
  
#### <a name="directory-service-access"></a>Доступ к службе каталогов  
  
##### <a name="directory-service-access"></a>Доступ к службе каталогов  
Эта подкатегория сообщает, когда осуществляется доступ к объекту AD DS. Только объекты с настроенными списками SACL вызывают создание событий аудита и только тогда, когда доступ к ним осуществляется способом, соответствующим записям SACL. Эти события похожи на события доступа к службе каталогов в более ранних версиях Windows Server. Эта подкатегория применяется только к контроллерам домена.  
  
##### <a name="directory-service-changes"></a>Изменения службы каталогов  
Эта подкатегория сообщает об изменениях в объектах в AD DS. Типы изменений, о которых сообщается, — это операции создания, изменения, перемещения и отмены удаления, выполняемые над объектом. Аудит изменений службы каталогов, где это необходимо, указывает старое и новое значения измененных свойств объектов, которые были изменены. Только объекты, имеющие SACL, вызывают создание событий аудита и только при обращении к ним в соответствии с их записями SACL. Некоторые объекты и свойства не вызывают создание событий аудита из-за параметров класса Object в схеме. Эта подкатегория применяется только к контроллерам домена.  
  
##### <a name="directory-service-replication"></a>Репликация службы каталогов  
Эта подкатегория сообщает о начале и окончании репликации между двумя контроллерами домена.  
  
##### <a name="detailed-directory-service-replication"></a>Подробная репликация службы каталогов  
Эта подкатегория возвращает подробные сведения о данных, реплицированных между контроллерами домена. Эти события могут быть очень высокими в том же объеме.  
  
#### <a name="logonlogoff"></a>Вход и выход из системы  
  
##### <a name="logon"></a>Вход в систему  
Эта подкатегория сообщает, когда пользователь пытается войти в систему. Эти события происходят на доступном компьютере. Для интерактивного входа создание этих событий происходит на компьютере, который вошел в систему. Если для доступа к общему ресурсу используется сетевой вход, эти события создаются на компьютере, на котором размещен ресурс, к которому осуществляется доступ. Если этот параметр имеет значение **без аудита**, трудно или невозможно определить, какой пользователь получил доступ к компьютерам организации или попытался получить к ним доступа.  
  
##### <a name="network-policy-server"></a>Сервер политики сети  
Эта подкатегория сообщает о событиях, создаваемых запросами доступа пользователей RADIUS (IAS) и защиты доступа к сети (NAP). Эти запросы могут быть **предоставлены**, **отклонены**, **удалены**, **помещены в карантин**, **заблокированы**и **разблокированы**. Аудит этого параметра приведет к появлению среднего или большого объема записей на серверах NPS и IAS.  
  
##### <a name="ipsec-main-mode"></a>Основной режим IPsec  
Эта подкатегория сообщает результаты протокола протокол IKE (IKE) и аутентифицированного протокола Интернета (AuthIP) во время согласований в основном режиме.  
  
##### <a name="ipsec-extended-mode"></a>Расширенный режим IPsec  
Эта подкатегория сообщает результаты AuthIP во время согласований расширенного режима.  
  
##### <a name="other-logonlogoff-events"></a>Другие события входа в систему и выхода из системы  
Эта подкатегория сообщает о других событиях входа и выхода из системы, таких как службы удаленных рабочих столов сеанс отключается и повторно подключается с помощью RunAs для выполнения процессов под другой учетной записью, а также для блокировки и разблокировки рабочей станции.  
  
##### <a name="logoff"></a>Выполнен  
Эта подкатегория сообщает, когда пользователь выходит из системы. Эти события происходят на доступном компьютере. Для интерактивного входа создание этих событий происходит на компьютере, который вошел в систему. Если для доступа к общему ресурсу используется сетевой вход, эти события создаются на компьютере, на котором размещен ресурс, к которому осуществляется доступ. Если этот параметр имеет значение **без аудита**, трудно или невозможно определить, какой пользователь получил доступ к компьютерам организации или попытался получить к ним доступа.  
  
##### <a name="account-lockout"></a>Блокировка учетной записи  
Эта подкатегория сообщает, когда учетная запись пользователя заблокирована в результате слишком большого числа неудачных попыток входа.  
  
##### <a name="ipsec-quick-mode"></a>Быстрый режим IPsec  
Эта подкатегория сообщает результаты протокола IKE и AuthIP во время согласований быстрого режима.  
  
##### <a name="special-logon"></a>Специальный вход  
Эта подкатегория сообщает о том, что используется специальный вход в систему. Специальный вход в систему — это вход с правами администратора, который можно использовать для повышения уровня процесса до более высокого.  
  
#### <a name="policy-change"></a>Изменение политики  
  
##### <a name="audit-policy-change"></a>Аудит изменений политики  
Эта подкатегория сообщает об изменениях в политике аудита, включая изменения списка SACL.  
  
##### <a name="authentication-policy-change"></a>Изменение политики проверки подлинности  
Эта подкатегория сообщает об изменениях в политике проверки подлинности.  
  
##### <a name="authorization-policy-change"></a>Изменение политики авторизации  
Эта подкатегория сообщает об изменениях в политике авторизации, включая изменения разрешений (DACL).  
  
##### <a name="mpssvc-rule-level-policy-change"></a>Изменение политики на уровне правил MPSSVC  
Эта подкатегория сообщает об изменениях в правилах политики, используемых службой защиты Майкрософт (MPSSVC.exe). Эта служба используется брандмауэром Windows.  
  
##### <a name="filtering-platform-policy-change"></a>Изменение политики платформы фильтрации  
Эта подкатегория сообщает о добавлении и удалении объектов из WFP, включая фильтры запуска. Эти события могут быть очень высокими в том же объеме.  
  
##### <a name="other-policy-change-events"></a>Другие события изменения политики  
Эта подкатегория сообщает о других типах изменений политики безопасности, таких как конфигурация доверенный платформенный модуль (TPM) (доверенный платформенный модуль) или поставщики служб шифрования.  
  
#### <a name="privilege-use"></a>Использование привилегий  
  
##### <a name="sensitive-privilege-use"></a>Использование конфиденциальных прав  
Эта подкатегория сообщает, когда учетная запись пользователя или служба использует конфиденциальную привилегию. Конфиденциальная привилегия включает следующие права пользователя: работа в составе операционной системы, резервное копирование файлов и каталогов, создание объекта маркера, Отладка программ, включение доверенных учетных записей компьютеров и пользователей для делегирования, создание аудита безопасности, олицетворение клиента после проверки подлинности, Загрузка и выгрузка драйверов устройств, Управление аудитом и журналом безопасности, изменение значений среды встроенного по, , восстанавливать файлы и каталоги, а также становиться владельцами файлов или других объектов. Аудит этой подкатегории создаст большой объем событий.  
  
##### <a name="nonsensitive-privilege-use"></a>Использование неконфиденциальных привилегий  
Эта подкатегория сообщает, когда учетная запись пользователя или служба использует неконфиденциальную привилегию. Неконфиденциальная привилегия включает следующие права пользователя: доступ к диспетчеру учетных данных как доверенный вызывающий объект, доступ к этому компьютеру из сети, Добавление рабочих станций в домен, Настройка квот памяти для процесса, локальный вход в систему, разрешение входа в систему с помощью службы удаленных рабочих столов, обход перекрестной проверки, изменение системного времени, создание файла подкачки, создание глобальных объектов, создание постоянных общих объектов, создание , запрет доступа к компьютеру из сети, запрет входа в систему в качестве пакетного задания, запрет входа в систему в качестве службы, запрет локального входа в систему, запрет входа в систему с помощью службы удаленных рабочих столов, принудительное завершение работы от удаленной системы, увеличение рабочего набора процесса, повышение приоритета, блокировку страниц в памяти, вход в систему в качестве пакетного задания, вход в качестве службы, изменение метки объекта , выполнение задач по обслуживанию томов, Профилирование одного процесса, профилирование производительности системы, удаление компьютера из стыковочного узла, завершение работы системы и синхронизация данных службы каталогов. Аудит этой подкатегории создаст очень большой объем событий.  
  
##### <a name="other-privilege-use-events"></a>Другие события использования привилегий  
Этот параметр политики безопасности в настоящее время не используется.  
  
#### <a name="object-access"></a>Доступ к объектам  
  
##### <a name="file-system"></a>Файловая система  
Эта подкатегория сообщает, когда осуществляется доступ к объектам файловой системы. Только объекты файловой системы с SACL вызывают создание событий аудита и только тогда, когда доступ к ним осуществляется способом, соответствующим их записям SACL. Сам по себе этот параметр политики не приведет к аудиту каких бы то ни было событий. Он определяет, следует ли выполнять аудит событий пользователя, обращающегося к объекту файловой системы, имеющему указанный системный список управления доступом (SACL), фактически позволяя выполнять аудит.  
  
Если параметр аудита доступа к объектам настроен на **успешное выполнение**, запись аудита создается каждый раз, когда пользователь успешно обращается к объекту с указанным списком SACL. Если для этого параметра политики задано значение **сбой**, запись аудита создается каждый раз, когда пользователь не пытается получить доступ к объекту с указанным списком SACL.  
  
##### <a name="registry"></a>Реестр  
Эта подкатегория сообщает об обращении к объектам реестра. Только объекты реестра с SACL вызывают создание событий аудита и только тогда, когда доступ к ним осуществляется способом, соответствующим их записям SACL. Сам по себе этот параметр политики не приведет к аудиту каких бы то ни было событий.  
  
##### <a name="kernel-object"></a>Объект ядра  
Эта подкатегория сообщает, когда осуществляется доступ к объектам ядра, таким как процессы и мьютексы. Только объекты ядра с SACL вызывают создание событий аудита и только тогда, когда доступ к ним осуществляется способом, соответствующим их записям SACL. Обычно объекты ядра получают только списки SACL, если включены параметры аудита Аудитбасеобжектс или Аудитбаседиректориес.  
  
##### <a name="sam"></a>SAM  
Эта подкатегория сообщает, когда осуществляется доступ к объектам базы данных локальной проверки подлинности диспетчера учетных записей безопасности (SAM).  
  
##### <a name="certification-services"></a>Службы сертификации  
Эта подкатегория сообщает о выполнении операций служб сертификации.  
  
##### <a name="application-generated"></a>Созданное приложение  
Эта подкатегория сообщает, когда приложения пытаются создать события аудита с помощью программных интерфейсов аудита Windows (API).  
  
##### <a name="handle-manipulation"></a>Обработка обработки  
Эта подкатегория сообщает об открытии или закрытии маркера объекта. Только объекты, имеющие SACL, вызывают создание этих событий и только в том случае, если операция с запрошенным обработчиком соответствует записям SACL. События манипуляции с обработчиками формируются только для тех типов объектов, для которых включена соответствующая Подкатегория доступа к объекту (например, файловая система или реестр).  
  
##### <a name="file-share"></a>Общая папка  
Эта подкатегория сообщает, когда осуществляется доступ к общей папке. Сам по себе этот параметр политики не приведет к аудиту каких бы то ни было событий. Он определяет, следует ли выполнять аудит событий пользователя, обращающегося к объекту файлового ресурса, имеющему указанный системный список управления доступом (SACL), фактически позволяя выполнять аудит.  
  
##### <a name="filtering-platform-packet-drop"></a>Удаление пакета платформы для фильтрации  
Эта подкатегория сообщает о том, что пакеты отбрасываются платформой фильтрации Windows (WFP). Эти события могут быть очень высокими в том же объеме.  
  
##### <a name="filtering-platform-connection"></a>Подключение платформы фильтрации  
Эта подкатегория сообщает о том, что подключения разрешены или заблокированы WFP. Эти события могут иметь высокий уровень в том же объеме.  
  
##### <a name="other-object-access-events"></a>Другие события доступа к объекту  
Эта подкатегория сообщает другие связанные с доступом к объектам события, такие как задания планировщик задач и объекты COM+.  
  
#### <a name="system"></a>Система  
  
##### <a name="security-state-change"></a>Изменение состояния безопасности  
Эта подкатегория сообщает об изменениях в состоянии безопасности системы, например о запуске и остановке подсистемы безопасности.  
  
##### <a name="security-system-extension"></a>Расширение системы безопасности  
Эта подкатегория сообщает о загрузке кода расширения, например пакетов проверки подлинности, с помощью подсистемы безопасности.  
  
##### <a name="system-integrity"></a>Целостность системы  
Эта подкатегория сообщает о нарушениях целостности подсистемы безопасности.  
  
Драйвер IPsec  
  
Эта подкатегория сообщает о действиях, связанных с драйвером Internet Protocol Security (IPsec).  
  
##### <a name="other-system-events"></a>Другие системные события  
Эта подкатегория сообщает о других системных событиях.  
  
Дополнительные сведения об описаниях подкатегории см. в разделе [Диспетчер соответствия безопасности Microsoft](/previous-versions/tn-archive/cc677002(v=technet.10)).  
  
В каждой организации должны быть рассмотрены предыдущие категории и подкатегории и включены те, которые лучше подходят для их среды. Изменения политики аудита следует всегда проверять перед развертыванием в рабочей среде.  
  
## <a name="configuring-windows-audit-policy"></a>Настройка политики аудита Windows

Политику аудита Windows можно задать с помощью групповых политик, auditpol.exe, API или редактирования реестра. Рекомендуемые методы настройки политики аудита для большинства компаний групповая политика или auditpol.exe. Для настройки политики аудита системы требуются разрешения учетной записи администратора или соответствующие делегированные разрешения.  
  
> [!NOTE]  
> Права на **Управление аудитом и журналом безопасности** должны быть предоставлены субъектам безопасности (по умолчанию администраторам), чтобы разрешить изменение параметров аудита доступа к объектам для отдельных ресурсов, таких как файлы, Active Directory объекты и разделы реестра.  
  
### <a name="setting-windows-audit-policy-by-using-group-policy"></a>Настройка политики аудита Windows с помощью групповая политика

Чтобы настроить политику аудита с помощью групповых политик, настройте соответствующие категории аудита, расположенные в разделе **Конфигурация компьютера \ параметры безопасности \ локальные политики \ Политика полиЦиес\аудит** (см. следующий снимок экрана для примера из редактор локальных групповых политик (gpedit. msc)). Каждая категория политики аудита может быть включена для событий **успешного выполнения**, **сбоя**или **успехов** и сбоев.  
  
![наблюдение за AD](media/Monitoring-Active-Directory-for-Signs-of-Compromise/SAD_6.gif)  
  
Расширенную политику аудита можно задать с помощью Active Directory или локальных групповых политик. Чтобы задать расширенную политику аудита, настройте соответствующие подкатегории, расположенные в разделе **Конфигурация компьютера \ параметры безопасности \ Сеттингс\адванцед аудита политики** (см. следующий снимок экрана для примера из редактор локальных групповых политик (gpedit. msc)). Каждая подкатегория политики аудита может быть включена для событий **успешного выполнения**, **сбоя**или **успехов** и **сбоев** .  
  
![наблюдение за AD](media/Monitoring-Active-Directory-for-Signs-of-Compromise/SAD_7.gif)  
  
### <a name="setting-windows-audit-policy-using-auditpolexe"></a>Настройка политики аудита Windows с помощью Auditpol.exe

Auditpol.exe (для настройки политики аудита Windows) появился в Windows Server 2008 и Windows Vista. Изначально для задания расширенной политики аудита можно использовать только auditpol.exe, но групповая политика может использоваться в Windows Server 2012, Windows Server 2008 R2 или Windows Server 2008, Windows 8 и Windows 7.  
  
Auditpol.exe — это служебная программа командной строки. Синтаксис:  
  
`auditpol /set /<Category|Subcategory>:<audit category> /<success|failure:> /<enable|disable>`
  
Примеры синтаксиса Auditpol.exe:  
  
`auditpol /set /subcategory:"user account management" /success:enable /failure:enable`
  
`auditpol /set /subcategory:"logon" /success:enable /failure:enable`
  
`auditpol /set /subcategory:"IPSEC Main Mode" /failure:enable`
  
> [!NOTE]  
> Auditpol.exe задает локальную политику аудита в локальной среде. Если локальная политика конфликтует с Active Directory или локальными групповая политика, групповая политика параметры обычно имеют приоритет над параметрами auditpol.exe. Если существует несколько конфликтов групп или локальных политик, то приоритетом будет только одна политика (то есть заменить). Политики аудита не будут объединены.  
  
#### <a name="scripting-auditpol"></a>Создание скрипта Auditpol

Корпорация Майкрософт предоставляет [Пример скрипта](https://support.microsoft.com/kb/921469) для администраторов, желающих задать расширенную политику аудита с помощью сценария вместо того, чтобы вручную вводить каждую команду auditpol.exe.  
  
**Примечание** . Групповая политика не всегда точно сообщает о состоянии всех включенных политик аудита, в то время как auditpol.exe имеет значение. Дополнительные сведения см. [в статье получение эффективной политики аудита в Windows 7 и windows 2008 R2](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc731607(v=ws.10)) .  
  
#### <a name="other-auditpol-commands"></a>Другие команды auditpol

Auditpol.exe можно использовать для сохранения и восстановления локальной политики аудита, а также для просмотра других команд, связанных с аудитом. Ниже приведены другие команды **auditpol** .  
  
`auditpol /clear`— Используется для очистки и сброса локальных политик аудита;  
  
`auditpol /backup /file:<filename>`— Используется для резервного копирования текущей локальной политики аудита в двоичный файл.  
  
`auditpol /restore /file:<filename>`— Используется для импорта ранее сохраненного файла политики аудита в локальную политику аудита.  
  
`auditpol /<get/set> /option:<CrashOnAuditFail> /<enable/disable>`— Если этот параметр политики аудита включен, система немедленно останавливается (с сообщением об ОСТАНОВКе: C0000244 {Audit Failed}), если аудит безопасности не может быть зарегистрирован по какой-либо причине. Как правило, событие не регистрируется при переполнении журнала аудита безопасности, и метод хранения, указанный для журнала безопасности, **не перезаписывает события** или **переписывают события по дням**. Обычно он включается только средами, которым требуется более высокий уровень гарантии того, что журнал безопасности регистрируется. Если этот флажок включен, администраторы должны внимательно наблюдать за размером журнала безопасности и поворачивать журналы по мере необходимости. Его также можно задать с помощью групповая политика, изменив параметр безопасности **Аудит: немедленное завершение работы системы, если не удается зарегистрировать аудит безопасности** (по умолчанию — отключено).  
  
`auditpol /<get/set> /option:<AuditBaseObjects> /<enable/disable>`— Этот параметр политики аудита определяет, следует ли выполнять аудит доступа к глобальным системным объектам. Если эта политика включена, то системные объекты, такие как мьютексы, события, семафоры и устройства DOS, будут создаваться с системным списком управления доступом (SACL) по умолчанию. Большинство администраторов рассмотрите возможность аудита глобальных системных объектов, чтобы они были слишком "шумными", и они будут включать их только в случае возникновения вредоносных атак. SACL получает только именованные объекты. Если также включена политика аудита доступа к объектам аудита (или Подкатегория аудита объектов ядра), доступ к этим системным объектам будет проводиться. При настройке этого параметра безопасности изменения вступят в силу только после перезапуска Windows. Эту политику также можно задать с помощью групповая политика, изменив параметр безопасности Аудит доступа к глобальным системным объектам (по умолчанию — отключено).  
  
`auditpol /<get/set> /option:<AuditBaseDirectories> /<enable/disable>`— Этот параметр политики аудита указывает, что именованные объекты ядра (например, мьютексы и семафоры) должны получать списки SACL при их создании. Аудитбаседиректориес влияет на объекты контейнеров, а Аудитбасеобжектс влияет на объекты, которые не могут содержать другие объекты.  
  
`auditpol /<get/set> /option:<FullPrivilegeAuditing> /<enable/disable>`— Этот параметр политики аудита указывает, создает ли клиент событие, когда одному или нескольким из этих привилегий назначен маркер безопасности пользователя: Ассигнпримаритокенпривилеже, Аудитпривилеже, Баккуппривилеже, Креатетокенпривилеже, DebugPrivilege, EnableDelegationPrivilege, ImpersonatePrivilege, LoadDriverPrivilege, RestorePrivilege, SecurityPrivilege, SystemEnvironmentPrivilege, TakeOwnershipPrivilege и TcbPrivilege. Если этот параметр не включен (по умолчанию отключен), права доступа Баккуппривилеже и Ресторепривилеже не записываются. Включение этого параметра может сделать журнал безопасности чрезвычайно шумным (иногда сотни событий — секунды) во время операции резервного копирования. Эту политику также можно задать с помощью групповая политика, изменив параметр безопасности **Аудит: аудит использования резервного копирования и восстановления прав**.  
  
> [!NOTE]  
> Некоторые сведения, предоставленные здесь, взяты из [типа Microsoft Audit](/openspecs/windows_protocols/ms-gpac/262a2bed-93d4-4c04-abec-cf06e9ec72fd) и средства Microsoft SCM.  
  
## <a name="enforcing-traditional-auditing-or-advanced-auditing"></a>Применение традиционного аудита или расширенного аудита

В Windows Server 2012, Windows Server 2008 R2, Windows Server 2008, Windows 8, Windows 7 и Windows Vista администраторы могут включить девять традиционных категорий или использовать подкатегории. Это двоичный вариант, который должен быть сделан в каждой системе Windows. Можно включить либо основные категории, либо субкатегориесит.  
  
Чтобы предотвратить перезапись подкатегорий политики аудита устаревшими традиционными политиками категорий, необходимо включить параметр **принудительно изменить параметры категории политики аудита (Windows Vista или более поздней версии), который** находится в разделе **Конфигурация компьютера**\ параметры Windows \ политики безопасности \ локальные политики.  
  
Рекомендуется включить и настроить подкатегории вместо девяти основных категорий. Для этого необходимо включить параметр групповая политика (чтобы разрешить подкатегории переопределять категории аудита) вместе с настройкой различных подкатегорий, поддерживающих политики аудита.  
  
Подкатегории аудита можно настроить с помощью нескольких методов, в том числе групповая политика и программы командной строки auditpol.exe.  
  
## <a name="next-steps"></a>Дальнейшие действия
  
* [Расширенный аудит безопасности в Windows 7 и Windows Server 2008 R2](https://social.technet.microsoft.com/wiki/contents/articles/advanced-security-auditing-in-windows-7-and-windows-server-2008-r2.aspx)  
  
* [Аудит и соответствие требованиям в Windows Server 2008](/previous-versions/technet-magazine/cc194392(v=msdn.10))  
  
* [Использование групповая политика для настройки подробных параметров аудита безопасности для компьютеров под управлением Windows Vista и Windows Server 2008 в домене Windows Server 2008, в домене Windows Server 2003 или в домене Windows 2000](https://support.microsoft.com/kb/921469)  
  
* [Пошаговое руководство по расширенной политике аудита безопасности](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd408940(v=ws.10))  
