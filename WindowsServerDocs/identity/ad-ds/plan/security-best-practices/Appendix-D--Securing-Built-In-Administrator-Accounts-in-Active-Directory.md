---
ms.assetid: 11f36f2b-9981-4da0-9e7c-4eca78035f37
title: Приложение г. Защита встроенных учетных записей администраторов в Active Directory
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: cc91ccd00c951863f4f9802f3d669e36ff3f3d9a
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71367844"
---
# <a name="appendix-d-securing-built-in-administrator-accounts-in-active-directory"></a>Приложение Г. Защита встроенных учетных записей администраторов в Active Directory

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012


## <a name="appendix-d-securing-built-in-administrator-accounts-in-active-directory"></a>Приложение Г. Защита встроенных учетных записей администраторов в Active Directory  
В каждом домене Active Directory учетная запись администратора создается как часть создания домена. Эта учетная запись по умолчанию является членом групп "Администраторы домена" и "Администраторы" в домене. Если домен является корневым доменом леса, учетная запись также является членом группы "Администраторы предприятия".

Использование учетной записи администратора домена должно быть зарезервировано только для начальных действий сборки и, возможно, сценариев аварийного восстановления. Чтобы гарантировать, что учетная запись администратора может быть использована для восстановления в случае, если другие учетные записи не могут использоваться, не следует изменять членство в учетной записи администратора по умолчанию в любом домене леса. Вместо этого следует защитить учетную запись администратора в каждом домене леса, как описано в следующем разделе, и подробно пошаговые инструкции см. ниже. 

> [!NOTE]
> Это краткое справочное по используется для рекомендуемого отключения учетной записи. Это было удалено, так как в техническом документе по восстановлению леса используется учетная запись администратора по умолчанию. Причина в том, что это единственная учетная запись, которая разрешает вход без сервера глобального каталога.


#### <a name="controls-for-built-in-administrator-accounts"></a>Элементы управления для встроенных учетных записей администраторов  
Для встроенной учетной записи администратора в каждом домене леса необходимо настроить следующие параметры.  

-   Включите **учетную запись конфиденциально и не может быть делегирована** в учетной записи.  

-   Включите **смарт-карту в качестве флага интерактивного входа** в учетную запись.  

-   Настройте объекты групповой политики, чтобы ограничить использование учетной записи администратора в системах, присоединенных к домену:  

    -   В одном или нескольких объектах групповой политики, которые вы создаете и связываете с подразделениями рабочей станции и рядового сервера в каждом домене, добавьте учетную запись администратора каждого домена в следующие права пользователя в **Computer \ политики \ параметры безопасности \ локальные политики Policies\User назначения прав**:  

        -   Отказ в доступе к компьютеру из сети  

        -   Отказ во входе в качестве пакетного задания  

        -   Отказать во входе в качестве службы  

        -   Запретить вход в систему через службу удаленных рабочих столов  

> [!NOTE]  
> При добавлении учетных записей в этот параметр необходимо указать, следует ли настраивать учетные записи локального администратора или администратора домена. Например, чтобы добавить учетную запись администратора домена НВТРАДЕРС к этим запрещенным правам, необходимо ввести учетную запись как Нвтрадерс\администратор или перейти к учетной записи администратора для домена НВТРАДЕРС. Если ввести "Administrator" в этих параметрах прав пользователя в редактор объектов групповой политики, учетная запись локального администратора будет ограничена на каждом компьютере, к которому применяется объект групповой политики.
>   
> Рекомендуется ограничивать учетные записи локального администратора на рядовых серверах и рабочих станциях так же, как учетные записи администратора на основе домена. Поэтому, как правило, необходимо добавить учетную запись администратора для каждого домена в лесу и учетную запись администратора для локальных компьютеров на эти параметры прав пользователя. На следующем снимке экрана показан пример настройки этих прав пользователя для блокировки учетных записей локального администратора и учетной записи администратора домена для выполнения входа в систему, которые не требуются для этих учетных записей.  


![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_23.gif)  

-   Настройка объектов групповой политики для ограничения учетных записей администраторов на контроллерах домена  
    -   В каждом домене леса следует изменить объект групповой политики контроллеров домена по умолчанию или политику, связанную с подразделением контроллеров домена, чтобы добавить учетную запись администратора каждого домена в следующие права пользователя в **Computer \ политики \ конфигурация безопасности \ локальные политики Policies\User назначения прав**:   
        -   Отказ в доступе к компьютеру из сети  

        -   Отказ во входе в качестве пакетного задания  

        -   Отказать во входе в качестве службы  

        -   Запретить вход в систему через службу удаленных рабочих столов  

> [!NOTE]  
> Эти параметры гарантируют, что встроенную учетную запись администратора домена нельзя использовать для подключения к контроллеру домена, хотя учетная запись, если она включена, может локально войти в систему на контроллерах домена. Поскольку эта учетная запись должна быть включена и использоваться только в сценариях аварийного восстановления, предполагается, что будет доступен физический доступ по крайней мере к одному контроллеру домена или другие учетные записи с разрешениями на удаленный доступ к контроллерам домена могут быть используется.  

-   Настройка аудита учетных записей администраторов  

    Если учетная запись администратора домена защищена и отключена, следует настроить аудит для отслеживания изменений в учетной записи. Если учетная запись включена, ее пароль сбрасывается или вносятся любые другие изменения в учетную запись. оповещения должны отправляться пользователям или группам, ответственным за администрирование Active Directory, в дополнение к командам реагирования на инциденты в Организации.  

#### <a name="step-by-step-instructions-to-secure-built-in-administrator-accounts-in-active-directory"></a>Пошаговые инструкции по обеспечению безопасности встроенных учетных записей администратора в Active Directory  

1.  В **Диспетчер сервера**щелкните **средства**и выберите **Active Directory пользователи и компьютеры**.  

2.  Чтобы предотвратить атаки, использующие делегирование для использования учетных данных учетной записи в других системах, выполните следующие действия.  

    1.  Щелкните правой кнопкой мыши учетную запись **администратора** и выберите пункт **свойства**.  

    2.  Перейдите на вкладку **учетная запись** .  

    3.  В разделе **Параметры учетной записи**выберите **учетная запись конфиденциальная и не может быть делегирована** , как показано на следующем снимке экрана, и нажмите кнопку **ОК**.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_24.gif)  

3.  Чтобы включить **смарт-карту для флага интерактивного входа** в учетную запись, выполните следующие действия.  

    1.  Щелкните правой кнопкой мыши учетную запись **администратора** и выберите пункт **свойства**.  

    2.  Перейдите на вкладку **учетная запись** .  

    3.  В разделе Параметры **учетной записи** выберите **смарт-карту, необходимую для флага интерактивного входа** , как показано на следующем снимке экрана, и нажмите кнопку **ОК**.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_25.gif) 

##### <a name="configuring-gpos-to-restrict-administrator-accounts-at-the-domain-level"></a>Настройка объектов групповой политики для ограничения учетных записей администраторов на уровне домена  

> [!WARNING]  
> Этот объект групповой политики никогда не должен быть связан на уровне домена, так как он может сделать встроенную учетную запись администратора непригодной для использования даже в сценариях аварийного восстановления.  

1.  В **Диспетчер сервера**щелкните **средства**и выберите **Групповая политика управление**.  

2.  В дереве консоли разверните узел <Forest>\Домаинс\\<Domain>, а затем **Групповая политика объекты** (где <Forest> — это имя леса, а <Domain> — имя домена, в котором нужно создать групповая политика).  

3.  В дереве консоли щелкните правой кнопкой мыши элемент **Групповая политика объекты**и выберите команду **создать**.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_27.gif)  

4.  В диалоговом окне **Создание объекта групповой политики** введите <GPO Name>и нажмите кнопку **ок** (где <GPO Name> — это имя этого объекта групповой политики), как показано на следующем снимке экрана.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_28.gif)  

5.  В области сведений щелкните правой кнопкой мыши <GPO Name>и выберите команду **изменить**.  

6.  Перейдите к компьютеру \ политики \ **Параметры безопасности Локальные политики**и щелкните **Назначение прав пользователя**.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_29.gif)  

7.  Настройте права пользователя, чтобы запретить учетной записи администратора доступ к серверам и рабочим станциям по сети, выполнив следующие действия.  

    1.  Дважды щелкните " **запретить доступ к этому компьютеру из сети"** и выберите " **определить параметры политики**".  

    2.  Нажмите кнопку **Добавить пользователя или группу** и нажмите кнопку **Обзор**.  

    3.  Введите **Администратор**, щелкните **Проверить имена**и нажмите кнопку **ОК**. Убедитесь, что учетная запись отображается в <DomainName>формате \Усернаме, как показано на следующем снимке экрана.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_30.gif)  

    4.  Нажмите кнопку **ОК**, а затем **ОК** еще раз.  

8.  Настройте права пользователя, чтобы запретить учетной записи администратора входить в систему в качестве пакетного задания, выполнив следующие действия.  

    1.  Дважды щелкните **отклонить вход в качестве пакетного задания** и выберите **определить эти параметры политики**.  

    2.  Нажмите кнопку **Добавить пользователя или группу** и нажмите кнопку **Обзор**.  

    3.  Введите **Администратор**, щелкните **Проверить имена**и нажмите кнопку **ОК**. Убедитесь, что учетная запись отображается в <DomainName>формате \Усернаме, как показано на следующем снимке экрана.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_31.gif)  

    4.  Нажмите кнопку **ОК**, а затем **ОК** еще раз.  

9. Настройте права пользователя, чтобы запретить учетной записи администратора вход в качестве службы, выполнив следующие действия.  

    1.  Дважды щелкните **запретить вход в качестве службы** и выберите **определить эти параметры политики**.  

    2.  Нажмите кнопку **Добавить пользователя или группу** и нажмите кнопку **Обзор**.  

    3.  Введите **Администратор**, щелкните **Проверить имена**и нажмите кнопку **ОК**. Убедитесь, что учетная запись отображается в <DomainName>формате \Усернаме, как показано на следующем снимке экрана.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_32.gif)  

    4.  Нажмите кнопку **ОК**, а затем **ОК** еще раз.  

10. Настройте права пользователя, чтобы запретить учетной записи Ба доступ к рядовым серверам и рабочим станциям с помощью службы удаленных рабочих столов, выполнив следующие действия.  

    1.  Дважды щелкните элемент **запретить вход через службы удаленных рабочих столов** и выберите **определить эти параметры политики**.  

    2.  Нажмите кнопку **Добавить пользователя или группу** и нажмите кнопку **Обзор**.  

    3.  Введите **Администратор**, щелкните **Проверить имена**и нажмите кнопку **ОК**. Убедитесь, что учетная запись отображается в <DomainName>формате \Усернаме, как показано на следующем снимке экрана.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_33.gif)  

    4.  Нажмите кнопку **ОК**, а затем **ОК** еще раз.  

11. Чтобы выйти из **редактор "Управление групповыми политиками"** , в меню **файл**выберите команду **выход**.  

12. В **Групповая политика управления**свяжите объект групповой политики с подразделениями рядового сервера и рабочей станции, выполнив следующие действия.  

    1.  Перейдите в <Forest>\Домаинс\\<Domain> (где <Forest> — имя леса, а <Domain> — имя домена, в котором вы хотите задать групповая политика).  

    2.  Щелкните правой кнопкой мыши подразделение, к которому будет применен объект GPO, и выберите команду **связать существующий объект GPO**.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_34.gif)  

    3.  Выберите созданный объект групповой политики и нажмите кнопку **ОК**.  

        ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_35.gif)  

    4.  Создайте ссылки на все подразделения, содержащие рабочие станции.  

    5.  Создайте ссылки на все подразделения, содержащие рядовые серверы.  

> [!IMPORTANT]  
> При добавлении учетной записи администратора к этим параметрам указывается, выполняется ли настройка учетной записи локального администратора или администратора домена с помощью метки учетных записей. Например, чтобы добавить учетную запись администратора домена ТАИЛСПИНТОЙС к этим отклонениям прав, перейдите к учетной записи администратора домена ТАИЛСПИНТОЙС, который будет выглядеть как Таилспинтойс\администратор. Если ввести "Administrator" в этих параметрах прав пользователя в редактор объектов групповой политики, учетная запись локального администратора будет ограничена на каждом компьютере, к которому применяется объект групповой политики, как описано выше.  

#### <a name="verification-steps"></a>Шаги проверки  
Действия по проверке, описанные здесь, относятся только к Windows 8 и Windows Server 2012.  

##### <a name="verify-smart-card-is-required-for-interactive-logon-account-option"></a>Убедитесь, что для параметра учетной записи интерактивного входа требуется смарт-карта.  

1.  С любого рядового сервера или рабочей станции, затрагиваемого изменениями объекта групповой политики, попробуйте войти в систему в интерактивном режиме, используя встроенную учетную запись администратора домена. После попытки входа в систему появится диалоговое окно, похожее на следующее.  

![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_36.gif)  

##### <a name="verify-account-is-disabled-account-option"></a>Проверка параметра учетной записи "учетная запись отключена"  

1.  С любого рядового сервера или рабочей станции, затрагиваемого изменениями объекта групповой политики, попробуйте войти в систему в интерактивном режиме, используя встроенную учетную запись администратора домена. После попытки входа в систему появится диалоговое окно, похожее на следующее.  

![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_37.gif)  

##### <a name="verify-deny-access-to-this-computer-from-the-network-gpo-settings"></a>Проверьте параметры объекта групповой политики "запретить доступ к этому компьютеру из сети"  
С любого рядового сервера или рабочей станции, на который не влияют изменения объекта групповой политики (например, сервер переходов), попытайтесь получить доступ к рядовому серверу или рабочей станции по сети, на которую влияет изменение объекта групповой политики. Чтобы проверить параметры объекта групповой политики, попытайтесь выполнить сопоставление системного диска с помощью команды **net use** , выполнив следующие действия.  

1.  Войдите в домен, используя встроенную учетную запись администратора домена.  

2.  С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.  

3.  В поле **поиска** введите **командную строку**, щелкните правой кнопкой мыши пункт **Командная строка**и выберите команду **Запуск от имени администратора** , чтобы открыть командную строку с повышенными привилегиями.  

4.  При появлении запроса на подтверждение повышения прав нажмите кнопку **Да**.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_38.gif)  

5.  В окне **командной строки** введите **net use \\\\\<имя сервера\>\c $** , где \<имя сервера\> — это имя рядового сервера или рабочей станции, к которой вы пытаетесь получить доступ по сети.  

6.  На следующем снимке экрана показано сообщение об ошибке, которое должно появиться.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_39.gif)  

##### <a name="verify-deny-log-on-as-a-batch-job-gpo-settings"></a>Проверка параметров объекта групповой политики "запретить вход в систему в качестве пакетного задания"  

Войдите в систему с любого рядового сервера или рабочей станции, затронутой изменением объектов групповой политики.  

###### <a name="create-a-batch-file"></a>Создание пакетного файла  

1.  С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.  

2.  В поле **поиска** введите **Блокнот**и щелкните **Блокнот**.  

3.  В **блокноте**введите **dir c:** .  

4.  Щелкните **файл** и выберите **Сохранить как**.  

5.  В поле **filename (имя файла** ) введите **<Filename>. bat** (где <Filename> — имя нового пакетного файла).  

###### <a name="schedule-a-task"></a>Планирование задачи  

1.  С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.  

2.  В поле **поиска** введите **Task Scheduler (планировщик заданий**) и нажмите кнопку **планировщик задач**.  

    > [!NOTE]  
    > На компьютерах под управлением Windows 8 в поле поиска введите **Schedule Tasks (расписание задач**) и щелкните **Schedule Tasks (планирование задач**).  

3.  На **планировщик задач**щелкните **действие**и выберите **создать задачу**.  

4.  В диалоговом окне **Создание задачи** введите **<Task Name>** (где **<Task Name>** — имя новой задачи).  

5.  Перейдите на вкладку **действия** и нажмите кнопку **создать**.  

6.  В разделе **действие:** выберите **запустить программу**.  

7.  В разделе **Программа/сценарий:** нажмите кнопку **Обзор**, найдите и выберите пакетный файл, созданный в разделе "Создание пакетного файла", и нажмите кнопку **Открыть**.  

8.  Нажмите кнопку **ОК**.  

9. Перейдите на вкладку **Общие**.  

10. В разделе Параметры **безопасности** щелкните **изменить пользователя или группу**.  

11. Введите имя учетной записи Ба на уровне домена, щелкните **Проверить имена**и нажмите кнопку **ОК**.  

12. Выберите **выполнить, если пользователь вошел в систему или не** **хранит пароль**. Задача будет иметь доступ только к локальным ресурсам компьютера.  

13. Нажмите кнопку **ОК**.  

14. Появится диалоговое окно, запрашивающее учетные данные пользователя для выполнения задачи.  

15. После ввода учетных данных нажмите кнопку **ОК**.  

16. Появится диалоговое окно, похожее на следующее.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_40.gif)  

##### <a name="verify-deny-log-on-as-a-service-gpo-settings"></a>Проверка параметров объекта групповой политики "запретить вход в качестве службы"  

1.  Войдите в систему с любого рядового сервера или рабочей станции, затронутой изменением объектов групповой политики.  

2.  С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.  

3.  В поле **поиска** введите **Services**и щелкните **службы**.  

4.  Выберите и дважды щелкните **Диспетчер очереди печати**.  

5.  Перейдите на вкладку **Вход в систему**.  

6.  В разделе **вход как:** выберите **Эта учетная запись**.  

7.  Нажмите кнопку **Обзор**, введите имя учетной записи Ба на уровне домена, щелкните **Проверить имена**и нажмите кнопку **ОК**.  

8.  В разделе **пароль:** и **Подтверждение пароля**введите пароль учетной записи администратора и нажмите кнопку **ОК**.  

9. Еще три раза нажмите кнопку **ОК** .  

10. Щелкните правой кнопкой мыши **службу диспетчера очереди печати** и выберите **перезапустить**.  

11. При перезапуске службы появится диалоговое окно, похожее на следующее.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_41.gif)  

##### <a name="revert-changes-to-the-printer-spooler-service"></a>Отмена изменений в службе диспетчера очереди печати  

1.  Войдите в систему с любого рядового сервера или рабочей станции, затронутой изменением объектов групповой политики.  

2.  С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.  

3.  В поле **поиска** введите **Services**и щелкните **службы**.  

4.  Выберите и дважды щелкните **Диспетчер очереди печати**.  

5.  Перейдите на вкладку **Вход в систему**.  

6.  В разделе **вход как:** выберите **локальную системную** учетную запись и нажмите кнопку **ОК**.  

##### <a name="verify-deny-log-on-through-remote-desktop-services-gpo-settings"></a>Проверка параметров объекта групповой политики "запретить вход в систему с помощью службы удаленных рабочих столов"

1.  С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.  

2.  В поле **поиска** введите **Подключение к удаленному рабочему столу**и нажмите кнопку **Подключение к удаленному рабочему столу**.  

3.  В поле **компьютер** введите имя компьютера, к которому требуется подключиться, и нажмите кнопку **подключить**. (Можно также ввести IP-адрес вместо имени компьютера.)  

4.  При появлении запроса введите учетные данные для имени учетной записи Ба на уровне домена.  

5.  Появится диалоговое окно, похожее на следующее.  

    ![Защита встроенных учетных записей администратора](media/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory/SAD_42.gif)  
