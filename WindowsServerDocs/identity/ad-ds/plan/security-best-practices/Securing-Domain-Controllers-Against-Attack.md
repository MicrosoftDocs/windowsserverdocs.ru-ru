---
ms.assetid: ba28bd05-16e6-465f-982b-df49633cfde4
title: Защита контроллеров домена от атак
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 06/18/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: 1b156701090acc79a63afab26653f42044a23741
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "86966546"
---
# <a name="securing-domain-controllers-against-attack"></a>Защита контроллеров домена от атак

> Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

*Номер закона 3. Если у злоумышленника есть неограниченный физический доступ к вашему компьютеру, он больше не находится на вашем компьютере.* - [Десять неизменяемых законов безопасности (версия 2,0)](https://www.microsoft.com/en-us/msrc?rtc=1)

Контроллеры домена предоставляют физическое хранилище для AD DS базы данных, помимо предоставления служб и данных, позволяющих предприятиям эффективно управлять своими серверами, рабочими станциями, пользователями и приложениями. Если привилегированный доступ к контроллеру домена получает злоумышленник, этот пользователь может изменить, повредить или уничтожить базу данных AD DS и, по своему расширению, все системы и учетные записи, управляемые Active Directory.

Так как контроллеры домена могут считывать данные из базы данных AD DS и записывать их в любые данные, компрометация контроллера домена означает, что лес Active Directory не может считаться доверенным повторно, если вы не сможете восстановиться с помощью известной хорошей резервной копии и закрыть пропуски, которые позволили бы снизить безопасность процесса.

В зависимости от подготовки злоумышленника, инструментария и навыка, изменение или даже неустранимогоные AD DS повреждения базы данных могут быть выполнены за несколько минут, а не дней или недель. Важно то, что у злоумышленника есть привилегированный доступ к Active Directory, но сколько у злоумышленника запланирована на момент получения привилегированного доступа. Поставная безопасность контроллера домена может обеспечить наибольший укороченного путь к распространению уровня доступа или самый прямой путь к уничтожению рядовых серверов, рабочих станций и Active Directory. По этой причине контроллеры домена должны быть защищены по отдельности и более жестко, чем общая инфраструктура Windows.

## <a name="physical-security-for-domain-controllers"></a>Физическая безопасность для контроллеров домена

В этом разделе содержатся сведения о физической защите контроллеров домена, будь то контроллеры домена: физические или виртуальные машины, расположения центров обработки данных, офисы филиалов и даже удаленные расположения только с базовыми элементами управления инфраструктурой.

### <a name="datacenter-domain-controllers"></a>Контроллеры домена центра обработки данных

#### <a name="physical-domain-controllers"></a>Физические контроллеры домена

В центрах обработки данных физические контроллеры домена должны быть установлены в выделенные защищенные стойки или отсеки, которые отделены от общего заполнения сервера. По возможности контроллеры домена должны быть настроены с использованием микропроцессоров доверенный платформенный модуль (TPM) (TPM), а все тома на серверах контроллеров домена должны быть защищены с помощью шифрование диска BitLocker. BitLocker обычно увеличивает затраты на производительность в процентах, состоящих из одной цифры, но защищает каталог от компрометации, даже если диски удаляются с сервера. BitLocker также помогает защитить системы от атак, таких как rootkit-программы, поскольку изменение загрузочных файлов приведет к загрузке сервера в режиме восстановления, чтобы можно было загрузить исходные двоичные файлы. Если контроллер домена настроен для использования программного RAID-массива, подключенного через последовательный порт SCSI, хранилища SAN/NAS или динамических томов, BitLocker не может быть реализован, поэтому в контроллерах домена по возможности следует использовать локально подключенное хранилище (с аппаратным RAID-массивом или без него).

#### <a name="virtual-domain-controllers"></a>Виртуальные контроллеры домена

При реализации виртуальных контроллеров домена следует убедиться, что контроллеры домена работают на разных физических узлах, а не на других виртуальных машинах в среде. Даже если вы используете платформу виртуализации стороннего производителя, рассмотрите возможность развертывания виртуальных контроллеров домена на сервере Hyper-V в Windows Server 2012 или Windows Server 2008 R2, который обеспечивает минимальную поверхность атак и может управляться с помощью контроллеров домена, на котором он размещен, а не управлять с помощью остальных узлов виртуализации. При реализации System Center Virtual Machine Manager (SCVMM) для управления инфраструктурой виртуализации можно делегировать администрирование физическим узлам, на которых находятся виртуальные машины контроллера домена, и контроллерами домена для полномочных администраторов. Также следует рассмотреть возможность разделения хранилища виртуальных контроллеров домена, чтобы предотвратить доступ администраторов хранилища к файлам виртуальных машин.

### <a name="branch-locations"></a>Расположения ветвей

#### <a name="physical-domain-controllers-in-branches"></a>Физические контроллеры домена в ветвях

В расположениях, в которых несколько серверов находятся, но физически не защищены в степени, когда серверы центра обработки данных защищены, физические контроллеры домена должны быть настроены с использованием микросхемы TPM и шифрование диска BitLocker для всех томов сервера. Если контроллер домена не может храниться в заблокированной комнате в расположениях филиалов, следует рассмотреть возможность развертывания RODC в этих расположениях.

#### <a name="virtual-domain-controllers-in-branches"></a>Виртуальные контроллеры домена в ветвях

По возможности следует запускать виртуальные контроллеры домена в филиалах на разных физических узлах, а не на других виртуальных машинах сайта. В филиалах, в которых виртуальные контроллеры домена не могут работать на разных физических узлах из оставшейся части заполнения Virtual Server, следует реализовать микросхемы TPM и шифрование диска BitLocker на узлах, где виртуальные контроллеры домена работают как минимум, и все узлы, если это возможно. В зависимости от размера филиала и безопасности физических узлов следует рассмотреть возможность развертывания RODC в расположениях ветвей.

### <a name="remote-locations-with-limited-space-and-security"></a>Удаленные расположения с ограниченным пространством и безопасностью

Если в инфраструктуре есть расположения, в которых можно установить только один физический сервер, сервер, на котором выполняются рабочие нагрузки виртуализации, должен быть установлен в удаленном расположении, а шифрование диска BitLocker должны быть настроены для защиты всех томов на сервере. Одна виртуальная машина на сервере должна работать под управлением RODC, а другие серверы, работающие как отдельные виртуальные машины на узле. Сведения о планировании развертывания RODC приведены в [руководств по планированию и развертыванию контроллера домена только для чтения](/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/cc771744(v=ws.10)). Дополнительные сведения о развертывании и защите виртуализованных контроллеров домена см. [в статье работа с контроллерами домена в Hyper-V](/previous-versions/windows/it-pro/windows-server-2008-r2-and-2008/dd363553(v=ws.10)). Более подробные инструкции по усилению защиты Hyper-V, делегирования управления виртуальными машинами и защите виртуальных машин см. в статье акселератор решений для [руководства по безопасности Hyper-v](https://www.microsoft.com/download/details.aspx?id=16650) на веб-сайте Майкрософт.

## <a name="domain-controller-operating-systems"></a>Операционные системы контроллера домена

Необходимо запустить все контроллеры домена в последней версии Windows Server, поддерживаемой в Организации, и расставить приоритеты в списании устаревших операционных систем в совокупности контроллера домена. Сохраняя контроллеры домена в актуальном виде и исключая устаревшие контроллеры домена, часто можно воспользоваться преимуществами новых функций и безопасности, которые могут быть недоступны в доменах или лесах с контроллерами домена, работающими под управлением устаревшей операционной системы. Контроллеры домена должны устанавливаться и повышаться, а не обновляться с предыдущих операционных систем или ролей сервера. то есть не следует выполнять обновления на месте контроллеров домена или запускать мастер установки AD DS на серверах, на которых операционная система не установлена. Устанавливая новые контроллеры домена, вы гарантируете, что устаревшие файлы и параметры не будут оставлены на контроллерах домена, и вы упростите принудительную установку надежной конфигурации контроллера домена.

## <a name="secure-configuration-of-domain-controllers"></a>Защита конфигурации контроллеров домена

Ряд свободно доступных средств, некоторые из которых устанавливаются по умолчанию в Windows, можно использовать для создания базового шаблона базовой конфигурации безопасности для контроллеров домена, которые впоследствии могут быть принудительно применены с помощью объектов групповой политики. Эти средства описаны здесь.

### <a name="security-configuration-wizard"></a>Мастер настройки безопасности

Во время первоначальной сборки все контроллеры домена должны быть заблокированы. Это можно сделать с помощью мастера настройки безопасности, который поставляется в Windows Server изначально для настройки параметров службы, реестра, системы и брандмауэра на контроллере домена базовой сборки. Параметры можно сохранить и экспортировать в объект групповой политики, который можно связать с подразделением контроллеров домена в каждом домене леса, чтобы обеспечить последовательную настройку контроллеров домена. Если ваш домен содержит несколько версий операционных систем Windows, можно настроить фильтры инструментарий управления Windows (WMI) (WMI), чтобы применять объекты групповой политики только к контроллерам домена под управлением соответствующей версии операционной системы.

### <a name="microsoft-security-compliance-toolkit"></a>Набор средств обеспечения соответствия безопасности (Майкрософт)

Параметры контроллера домена [набора средств обеспечения соответствия безопасности (Майкрософт](https://microsoft.com/download/details.aspx?id=55319) ) можно сочетать с параметрами мастера настройки безопасности для создания комплексных базовых показателей конфигурации для контроллеров домена, развернутых и принудительно применяемых объектами групповой политики, развернутыми в подразделении контроллеров домена в Active Directory.

### <a name="rdp-restrictions"></a>Ограничения RDP

Групповая политика объекты, которые связываются со всеми подразделениями контроллеров домена в лесу, должны быть настроены на разрешение подключений по протоколу RDP только от полномочных пользователей и систем (например, серверы переходят). Это можно сделать с помощью сочетания параметров прав пользователей и конфигурации с ПОВЫШЕНной настройкой, которые должны быть реализованы в объектах групповой политики для согласованного применения политики. Если это не так, при следующем групповая политика обновления возвращается система к соответствующей конфигурации.

### <a name="patch-and-configuration-management-for-domain-controllers"></a>Управление исправлениями и конфигурациями для контроллеров домена

Хотя это может показаться нелогичным, следует рассмотреть возможность исправления контроллеров домена и других критических компонентов инфраструктуры отдельно от общей инфраструктуры Windows. Если вы используете программное обеспечение для управления конфигурацией предприятия для всех компьютеров в вашей инфраструктуре, для компрометации или уничтожения всех компонентов инфраструктуры, управляемых этим программным обеспечением, может быть использована компрометация программного обеспечения управления системами. Разделяя управление исправлениями и системами для контроллеров домена из общей совокупности, можно уменьшить объем программного обеспечения, установленного на контроллерах домена, в дополнение к тесному управлению ими.

### <a name="blocking-internet-access-for-domain-controllers"></a>Блокировка доступа к Интернету для контроллеров домена

Одной из проверок, выполняемых в рамках оценки безопасности Active Directory, является использование и Настройка Internet Explorer на контроллерах домена. Internet Explorer (или любой другой веб-браузер) не следует использовать на контроллерах домена, но анализ тысяч контроллеров домена обнаружил множество случаев, в которых привилегированные пользователи использовали Internet Explorer для просмотра интрасети организации или Интернета.

Как было описано в разделе "недопущенная Настройка", подключаясь [к компрометации](../../../ad-ds/plan/security-best-practices/Avenues-to-Compromise.md), просмотрев Интернет (или зараженную интрасеть) от одного из самых мощных компьютеров в инфраструктуре Windows, используя учетную запись с высоким уровнем привилегий (по умолчанию единственными учетными записями, которым разрешено локальное подключение к контроллерам домена), повышается риск обеспечения безопасности Организации. Независимо от того, есть ли у диска Загрузка или загрузка зараженных вредоносными программами программ, злоумышленник может получить доступ ко всем необходимым, чтобы полностью ослабить или уничтожить Active Directoryную среду.

Хотя Windows Server 2012, Windows Server 2008 R2, Windows Server 2008 и текущие версии Internet Explorer предлагают ряд средств защиты от вредоносных загрузок, в большинстве случаев, когда контроллеры домена и привилегированные учетные записи использовались для просмотра Интернета, контроллеры домена работали под управлением Windows Server 2003, или защита, предлагаемая более новыми операционными системами и браузерами, была намеренно отключена.

Запуск веб-браузеров на контроллерах домена должен быть запрещен не только политикой, но и техническими элементами управления, и контроллеры домена не должны иметь разрешения на доступ к Интернету. Если контроллеры домена должны реплицироваться между сайтами, следует реализовать безопасные подключения между сайтами. Хотя подробные инструкции по конфигурации выходят за рамки этого документа, можно реализовать ряд элементов управления, чтобы ограничить возможности контроллеров домена неправильно используемыми или ненастроенными и скомпрометированными.

### <a name="perimeter-firewall-restrictions"></a>Ограничения брандмауэра периметра

Брандмауэры периметра должны быть настроены для блокировки исходящих подключений от контроллеров домена к Интернету. Несмотря на то, что контроллерам домена может потребоваться взаимодействовать через границы сайта, брандмауэры периметра можно настроить таким способом, чтобы разрешить межсайтовую связь, следуя указаниям в руководстве [Настройка брандмауэра для Active Directory доменов и отношений доверия](https://support.microsoft.com/kb/179442) на веб-сайте Служба поддержки Майкрософт.

### <a name="dc-firewall-configurations"></a>Конфигурации брандмауэра контроллера домена

Как было сказано ранее, следует использовать мастер настройки безопасности для записи параметров конфигурации брандмауэра Windows в повышенной безопасности на контроллерах домена. Следует проверить выходные данные мастера настройки безопасности, чтобы убедиться, что параметры конфигурации брандмауэра соответствуют требованиям Организации, а затем использовать объекты групповой политики для применения параметров конфигурации.

### <a name="preventing-web-browsing-from-domain-controllers"></a>Предотвращение веб-обзора с контроллеров домена

Для предотвращения доступа контроллеров домена к Интернету и предотвращения использования веб-браузеров на контроллерах домена можно использовать сочетание конфигурации AppLocker, конфигурации прокси-сервера "Черная дыра" и конфигурации с WFAS.
