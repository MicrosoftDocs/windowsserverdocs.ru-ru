---
ms.assetid: 7a7ab95c-9cb3-4a7b-985a-3fc08334cf4f
title: Реализация административных моделей с наименьшим количеством прав
description: ''
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 08/09/2018
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: c8ad9b00070d5daef2e5aee43cfdee2d192bddae
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71367729"
---
# <a name="implementing-least-privilege-administrative-models"></a>Реализация административных моделей с наименьшим количеством прав

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Следующий фрагмент относится [к руководству по планированию безопасности учетных записей администратора](https://technet.microsoft.com/library/cc162797.aspx), которое было опубликовано 1 апреля 1999 г.

> "Большинство учебных курсов и документов, связанных с безопасностью, обсуждают реализацию принципа минимальных привилегий, но в некоторых организациях они редко следуют за ней. Принцип прост, и последствия его применения правильно увеличивают безопасность и снижают риск. Принцип утверждает, что все пользователи должны входить в систему с учетной записью пользователя, обладающей абсолютными минимальными разрешениями, необходимыми для выполнения текущей задачи, и ничего больше. Это обеспечивает защиту от вредоносного кода, помимо других атак. Этот принцип применяется к компьютерам и пользователям этих компьютеров.   
> «Одна из причин этого принципа работает так, что она заставляет выполнять некоторые внутренние исследования. Например, необходимо определить права доступа, которые действительно требуются для компьютера или пользователя, а затем реализовать их. Во многих организациях эта задача, как и прежде, может показаться довольно эффективной. Однако это важный шаг для успешного обеспечения безопасности сетевой среды.
> "Необходимо предоставить всем администраторам домена права доступа к домену по принципу наименьших привилегий. Например, если администратор входит в систему с привилегированной учетной записью и случайно запускает антивирусную программу, этот вирус имеет административный доступ к локальному компьютеру и ко всему домену. Если администратор вошел в систему с непривилегированной (неадминистративной) учетной записью, то область повреждения вируса будет иметь только локальный компьютер, так как он выполняется от имени пользователя локального компьютера.
> "В другом примере учетные записи, которым вы предоставляете права администратора на уровне домена, не должны иметь повышенных прав в другом лесу, даже если между лесами есть доверительные отношения. Это способов помогает предотвратить распространенный ущерб, если злоумышленник управляет нарушением одного управляемого леса. Организации должны регулярно проводить аудит своей сети, чтобы защититься от несанкционированного укрупнения прав. "  

Следующий фрагмент взят из [пакета Microsoft Windows Security Resource Kit](https://www.microsoftpressstore.com/store/microsoft-windows-security-resource-kit-9780735621749), который сначала опубликован в 2005:  

> «Всегда думайте о безопасности с точки зрения предоставления минимального количества привилегий, необходимых для выполнения задачи. Если приложение, имеющее слишком много привилегий, должно быть скомпрометировано, злоумышленник может расширить возможности атаки, помимо того, что было бы, если бы приложение имело минимально допустимое количество привилегий. Например, изучите последствия сетевого администратора, непреднамеренно открыв вложение электронной почты, запускающее вирус. Если администратор вошел в систему с учетной записью администратора домена, он получит права администратора на всех компьютерах в домене и, таким же, неограниченный доступ практически ко всем данным в сети. Если администратор вошел в систему с учетной записью локального администратора, он будет обладать правами администратора на локальном компьютере и таким образом сможет получить доступ к любым данным на компьютере и установить вредоносные программы, такие как программное обеспечение ведения журнала с помощью ключевых штрихов. компьютер. Если администратор вошел в систему с обычной учетной записью пользователя, вирус будет иметь доступ только к данным администратора и не сможет устанавливать вредоносные программы. Используя минимальные привилегии, необходимые для чтения электронной почты, в этом примере потенциальная область нарушения безопасности значительно снизилась. "  

## <a name="the-privilege-problem"></a>Проблема с правами доступа

Принципы, описанные в предыдущих фрагментах, не изменились, но при оценке Active Directory установок мы неизменно найти чрезмерное количество учетных записей, которым были предоставлены права и разрешения, превышающие те, которые необходимы для выполнения повседневных работ. рабочего. Размер среды влияет на необработанные учетные записи с чрезмерным уровнем привилегий, но не в каталогах пропортионмидсизед могут быть десятки учетных записей в группах с высоким уровнем привилегий, тогда как крупные установки могут иметь сотни или даже тысячи. За некоторыми исключениями, независимо от сложности опыта и арсеналу злоумышленника, злоумышленники обычно следуют по пути наименее сопротивления. Они увеличивают сложность своих инструментов и подходов только в том случае, если более простые механизмы завершаются сбоем или отменяются средствами защиты.  

К сожалению, путь по крайней мере сопротивления во многих средах является чрезмерным числом учетных записей с широкими и глубокими привилегиями. Широкие привилегии — права и разрешения, которые позволяют учетной записи выполнять определенные действия в большом кросс-разделе среды. Например, сотрудникам службы поддержки могут быть предоставлены разрешения, позволяющие сбрасывать пароли для многих учетных записей пользователей.  

Глубокие привилегии — это мощные привилегии, применяемые к узким сегментам населения, такие как предоставление администратору прав администратора на сервере, чтобы они могли выполнять ремонт. Ни широкая привилегия, ни глубокая привилегия не обязательно опасна, но если многие учетные записи в домене постоянно получают широкие и глубокие привилегии, то, если только одна из учетных записей скомпрометирована, ее можно быстро использовать для перенастройки среды на Злоумышленник или даже для уничтожения больших сегментов инфраструктуры.  

Атаки типа "успех-ответ", которые являются типом атаки кражи учетных данных, являются повсеместными, так как средства их выполнения доступны бесплатно и просты в использовании, так как многие среды уязвимы для атак. Тем не менее, атаки Pass-The-hash не являются реальной проблемой. Основополагающей проблемы — двойная:  

1. Как правило, злоумышленник может легко получить глубокую привилегию на одном компьютере, а затем распространить эту привилегию на другие компьютеры.  
2. Обычно существует слишком много постоянных учетных записей с высоким уровнем привилегий в масштабной компьютерной ориентации.

Даже при устранении атак типа "успех-ответ-хэш" злоумышленники просто используют разные тактики, а не другую стратегию. Вместо плантинг вредоносных программ, содержащих средства кражи учетных данных, они могут подавать вредоносные программы, которые регистрируют нажатия клавиш, или использовать любое количество других подходов для записи учетных данных, которые являются мощными в среде. Независимо от тактики, целевые объекты остаются неизменными: учетные записи с широкими и глубокими привилегиями.  

Предоставление чрезмерных прав доступа не только в Active Directory в скомпрометированных средах. Если организация разработала привычку предоставления более прав доступа, чем требуется, она обычно обнаруживается в инфраструктуре, как описано в следующих разделах.  

## <a name="in-active-directory"></a>В Active Directory

В Active Directory обычно можно обнаружить, что группы EA, DA и BA содержат чрезмерное количество учетных записей. Как правило, Группа EA в организации содержит наименьшее число участников, группы DA обычно содержат множитель числа пользователей в группе EA, а группы администраторов обычно содержат больше элементов, чем заполнение других групп. Часто это обусловлено тем, что администраторы по каким-то причинам не являются "менее привилегированными", чем DAs или EAs. Хотя права и разрешения, предоставляемые каждой из этих групп, различаются, они должны считаться одинаковыми мощными группами, так как член одной из них может быть членом двух других.  

## <a name="on-member-servers"></a>На рядовых серверах

Когда мы получаем членство локальных групп администраторов на рядовых серверах во многих средах, мы получаем членство в диапазоне от нескольких локальных и доменных учетных записей до десятков вложенных групп, которые, когда развернут, раскрывают сотни, даже тысячи, учетные записи с правами локального администратора на серверах. Во многих случаях группы домена с большим членством вкладываются в группы локальных администраторов рядовых серверов, не учитывая, что любой пользователь, который может изменять членство в этих группах в домене, может получить административное управление всеми системами. , на котором группа была вложена в локальную группу администраторов.  

## <a name="on-workstations"></a>На рабочих станциях

Несмотря на то что рабочие станции обычно имеют гораздо меньше членов локальных групп администраторов, чем рядовые серверы, во многих средах пользователям предоставляется членство в локальной группе администраторов на своих персональных компьютерах. В этом случае, даже если включен контроль учетных записей, эти пользователи предоставляют повышенный риск для целостности рабочих станций.  

> [!IMPORTANT]  
> Следует тщательно продумать, требуются ли пользователям права администратора на своих рабочих станциях. в противном случае лучше создать отдельную локальную учетную запись на компьютере, который является членом группы "Администраторы". Когда пользователям требуется повышение прав, они могут представлять учетные данные этой локальной учетной записи для повышения прав, но так как учетная запись является локальной, ее нельзя использовать для взлома других компьютеров или доступа к ресурсам домена. Однако, как и в случае с любыми локальными учетными записями, учетные данные локальной привилегированной учетной записи должны быть уникальными. Если вы создаете локальную учетную запись с теми же учетными данными на нескольких рабочих станциях, вы предоставляете этим компьютерам атаки типа "Pass-By-Hash".  

## <a name="in-applications"></a>В приложениях

В атаках, в которых целью является интеллектуальная собственность Организации, учетные записи, которым были предоставлены эффективные привилегии в приложениях, могут быть нацелены на предоставление утечка данных. Несмотря на то что учетным записям, имеющим доступ к конфиденциальным данным, могут быть предоставлены привилегированные права в домене или операционной системе, учетные записи, которые могут управлять конфигурацией приложения или получить доступ к информации, предоставляемой приложением. предоставление риска.  

## <a name="in-data-repositories"></a>В репозиториях данных

Как и в случае с другими целями, злоумышленники, которые обращаются к интеллектуальной собственности в виде документов и других файлов, могут ориентироваться на учетные записи, которые управляют доступом к хранилищам файлов, учетным записям, имеющим прямой доступ к файлам, или даже к группам или ролям, имеющим доступ к файлам. Например, если файловый сервер используется для хранения документов контрактов, а доступ к документам предоставляется с помощью группы Active Directory, злоумышленник, который может изменить членство в группе, может добавить скомпрометированные учетные записи в группу и получить доступ к контракту. документаци. В случаях, когда доступ к документам осуществляется такими приложениями, как SharePoint, злоумышленники могут ориентироваться на приложения, как описано выше.  

## <a name="reducing-privilege"></a>Сокращение прав доступа

Чем больше и сложнее среда, тем сложнее управлять и обеспечивать безопасность. В небольших организациях проверка и уменьшение привилегий может быть относительно простым предложением, но каждый дополнительный сервер, Рабочая станция, учетная запись пользователя и приложение, используемые в Организации, добавляют другой объект, который должен быть защищен. Поскольку может быть трудно или даже невозможно надлежащим образом защитить все аспекты ИТ-инфраструктуры Организации, необходимо сначала сосредоточиться на учетных записях, привилегии которых создают наибольший риск, что обычно являются встроенными привилегированными учетными записями и группы в Active Directory и привилегированные локальные учетные записи на рабочих станциях и рядовых серверах.  

### <a name="securing-local-administrator-accounts-on-workstations-and-member-servers"></a>Защита учетных записей локального администратора на рабочих станциях и рядовых серверах

Несмотря на то, что в этом документе основное внимание уделяется обеспечению безопасности Active Directory, как было сказано выше, большинство атак на каталог начинается как атаки на отдельные узлы. Полные рекомендации по защите локальных групп в системах участников не могут быть предоставлены, но для защиты учетных записей локального администратора на рабочих станциях и рядовых серверах можно использовать следующие рекомендации.  

#### <a name="securing-local-administrator-accounts"></a>Защита учетных записей локального администратора

Во всех версиях Windows, в настоящее время включенной в основную поддержку, учетная запись локального администратора по умолчанию отключена, что делает учетную запись непригодной для атак Pass-The-hash и других злоумышленников по краже учетных данных. Однако в доменах, содержащих устаревшие операционные системы или в которых включены учетные записи локального администратора, эти учетные записи можно использовать, как описано выше, для распространения компромисса между рядовыми серверами и рабочими станциями. По этой причине рекомендуется использовать следующие элементы управления для всех учетных записей локального администратора в системах, присоединенных к домену.  

Подробные инструкции по реализации этих элементов управления приведены в [приложении H: защита учетных записей и групп локального администратора](../../../ad-ds/plan/security-best-practices/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups.md). Однако перед реализацией этих параметров убедитесь, что учетные записи локального администратора в настоящее время не используются в среде для запуска служб на компьютерах или выполнения других действий, для которых эти учетные записи не должны использоваться. Тщательно проверяйте эти параметры перед их реализацией в рабочей среде.  

#### <a name="controls-for-local-administrator-accounts"></a>Элементы управления для учетных записей локального администратора

Встроенные учетные записи администратора никогда не следует использовать в качестве учетных записей служб на рядовых серверах, а также для входа на локальные компьютеры (за исключением безопасного режима, который разрешен даже в том случае, если учетная запись отключена). Цель реализации описанных здесь параметров заключается в предотвращении использования учетной записи локального администратора каждого компьютера, если только защитные элементы управления не будут отменены. Реализуя эти элементы управления и отслеживая изменения в учетных записях администратора, можно значительно снизить вероятность успеха атаки, которая нацелена на учетные записи локального администратора.  

##### <a name="configuring-gpos-to-restrict-administrator-accounts-on-domain-joined-systems"></a>Настройка объектов групповой политики для ограничения учетных записей администраторов в системах, присоединенных к домену

В одном или нескольких объектах групповой политики, которые вы создаете и связываете с подразделениями рабочей станции и рядового сервера в каждом домене, добавьте учетную запись администратора к следующим правам пользователя в **Computer \ политики \ параметры безопасности \ локальные политики Policies\User назначения прав**:  

- Отказ в доступе к компьютеру из сети
- Отказ во входе в качестве пакетного задания
- Отказать во входе в качестве службы
- Запретить вход в систему через службу удаленных рабочих столов

При добавлении учетных записей администратора к этим правам пользователя укажите, следует ли добавить учетную запись локального администратора или учетную запись администратора домена способом, которым вы помечаем учетную запись. Например, чтобы добавить учетную запись администратора домена НВТРАДЕРС к этим запрещенным правам, введите учетную запись как **нвтрадерс\администратор**или перейдите к учетной записи администратора для домена нвтрадерс. Чтобы ограничить учетную запись локального администратора, введите " **Administrator** " в этих параметрах прав пользователя в редактор объектов групповой политики.  

> [!NOTE]  
> Даже при переименовании учетных записей локального администратора политики по-прежнему будут применяться.  

Эти параметры гарантируют, что учетная запись администратора компьютера не может быть использована для подключения к другим компьютерам, даже если она была случайно или злонамеренно включена. Локальные входы с учетной записью локального администратора не могут быть полностью отключены, и не следует пытаться сделать это, так как учетная запись локального администратора компьютера предназначена для использования в сценариях аварийного восстановления.  

Если сервер или рабочая станция будут отключены от домена, а другие локальные учетные записи не имеют прав администратора, компьютер может быть загружен в безопасный режим, учетная запись администратора может быть включена, а учетная запись может быть использована для вступления в силу. восстановление на компьютере. После завершения восстановления учетная запись администратора снова будет отключена.  

### <a name="securing-local-privileged-accounts-and-groups-in-active-directory"></a>Защита локальных привилегированных учетных записей и групп в Active Directory

*Закон номер 6. компьютер защищен так же, как и администратор заслуживает доверия.* - [десять неизменяемых законов безопасности (версия 2,0)](https://technet.microsoft.com/security/hh278941.aspx)  

Приведенные здесь сведения предназначены для предоставления общих рекомендаций по обеспечению безопасности встроенных учетных записей и групп с наивысшими правами в Active Directory. Подробные пошаговые инструкции также приведены в [приложении г: защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md), [Приложение E. Защита групп администраторов предприятия в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-E--Securing-Enterprise-Admins-Groups-in-Active-Directory.md), [приложение е. защита групп администраторов домена в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-F--Securing-Domain-Admins-Groups-in-Active-Directory.md)и в [приложении G: защита групп администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-G--Securing-Administrators-Groups-in-Active-Directory.md).  

Перед реализацией любого из этих параметров следует тщательно протестировать все параметры, чтобы определить, подходит ли они для вашей среды. Не все организации смогут реализовать эти параметры.  

#### <a name="securing-built-in-administrator-accounts-in-active-directory"></a>Защита встроенных учетных записей администраторов в Active Directory

В каждом домене Active Directory учетная запись администратора создается как часть создания домена. Эта учетная запись по умолчанию является членом групп администраторов домена и администраторов в домене. Если домен является корневым доменом леса, учетная запись также является членом группы "Администраторы предприятия". Использование учетной записи локального администратора домена должно быть зарезервировано только для начальных действий сборки и, возможно, сценариев аварийного восстановления. Чтобы гарантировать, что встроенная учетная запись администратора может быть использована для восстановления в случае, если другие учетные записи не могут использоваться, не следует изменять членство в учетной записи администратора по умолчанию в любом домене леса. Вместо этого следует следовать указаниям по защите учетной записи администратора в каждом домене леса. Подробные инструкции по реализации этих элементов управления приведены в [приложении г: защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  

#### <a name="controls-for-built-in-administrator-accounts"></a>Элементы управления для встроенных учетных записей администраторов

Цель реализации описанных здесь параметров заключается в предотвращении использования учетной записи администратора каждого домена (не группы), если не будет отменено несколько элементов управления. Реализуя эти элементы управления и отслеживая изменения в учетных записях администратора, можно значительно снизить вероятность успешной атаки, используя учетную запись администратора домена. Для учетной записи администратора в каждом домене леса необходимо настроить следующие параметры.  

##### <a name="enable-the-account-is-sensitive-and-cannot-be-delegated-flag-on-the-account"></a>Включить в учетной записи флаг "учетная запись является конфиденциальным и не может быть делегирован"

По умолчанию все учетные записи в Active Directory могут быть делегированы. Делегирование позволяет компьютеру или службе представлять учетные данные для учетной записи, которая проходила проверку подлинности на компьютере или в службе, на другие компьютеры для получения служб от имени учетной записи. Если **учетная запись включена и не может быть делегирован** атрибут для учетной записи на основе домена, учетные данные учетной записи не могут быть представлены другим компьютерам или службам в сети, что ограничивает атаки, использующие делегирование для использования учетных данных учетной записи в других системах.  

##### <a name="enable-the-smart-card-is-required-for-interactive-logon-flag-on-the-account"></a>Включите для учетной записи флаг "смарт-карта необходима для интерактивного входа".

Если для атрибута интерактивного входа в учетной записи **требуется включить смарт-карту** , Windows сбрасывает пароль учетной записи на 120-символьное случайное значение. Устанавливая этот флаг для встроенных учетных записей администратора, вы гарантируете, что пароль учетной записи не только длинный и сложный, но неизвестен пользователю. Не рекомендуется создавать смарт-карты для учетных записей перед включением этого атрибута, но если это возможно, для каждой учетной записи администратора следует создать смарт-карты, прежде чем настраивать ограничения учетной записи, и смарт-карты должны храниться в безопасные расположения.  

Несмотря на то, что настройка **смарт-карты необходима для интерактивного** флага входа в систему, она не запрещает пользователю с правами сбрасывать пароль учетной записи на известное значение и использует имя учетной записи и новый пароль для доступа к ресурсам в сети. Поэтому в учетной записи следует реализовать следующие дополнительные элементы управления.  

##### <a name="configuring-gpos-to-restrict-domains-administrator-accounts-on-domain-joined-systems"></a>Настройка объектов групповой политики для ограничения учетных записей администраторов доменов в системах, присоединенных к домену

Несмотря на то, что отключение учетной записи администратора в домене приводит к эффективному использованию учетной записи, следует реализовать дополнительные ограничения на учетную запись в случае случайной или злонамеренной активации учетной записи. Хотя эти элементы управления в конечном итоге могут быть обращены к учетной записи администратора, целью является создание элементов управления, которые замедляют выполнение злоумышленника и ограничивают ущерб, который может наноситься учетной записи.  

В одном или нескольких объектах групповой политики, которые вы создаете и связываете с подразделениями рабочей станции и рядового сервера в каждом домене, добавьте учетную запись администратора каждого домена в следующие права пользователя в **Computer \ политики \ параметры безопасности \ локальные политики Policies\User назначения прав**:  

- Отказ в доступе к компьютеру из сети  
- Отказ во входе в качестве пакетного задания  
- Отказать во входе в качестве службы  
- Запретить вход в систему через службу удаленных рабочих столов  

> [!NOTE]  
> При добавлении учетных записей локального администратора в этот параметр необходимо указать, следует ли настраивать учетные записи локального администратора или администратора домена. Например, чтобы добавить учетную запись локального администратора домена НВТРАДЕРС к этим запрещенным правам, необходимо либо ввести учетную запись как **нвтрадерс\администратор**, либо перейти к учетной записи локального администратора для домена нвтрадерс. Если ввести « **Administrator** » в этих параметрах прав пользователя в редактор объектов групповой политики, учетная запись локального администратора будет ограничена на каждом компьютере, к которому применяется объект групповой политики.  
>
> Рекомендуется ограничивать учетные записи локального администратора на рядовых серверах и рабочих станциях так же, как учетные записи администратора на основе домена. Поэтому, как правило, необходимо добавить учетную запись администратора для каждого домена в лесу и учетную запись администратора для локальных компьютеров на эти параметры прав пользователя. 

##### <a name="configuring-gpos-to-restrict-administrator-accounts-on-domain-controllers"></a>Настройка объектов групповой политики для ограничения учетных записей администраторов на контроллерах домена

В каждом домене леса политика контроллеров домена по умолчанию или политика, связанная с подразделением контроллеров домена, должны быть изменены, чтобы добавить учетную запись администратора каждого домена в следующие права пользователя в **Computer \ политики \ параметры безопасности \ локальные политики Policies\User назначения прав**:  

- Отказ в доступе к компьютеру из сети  
- Отказ во входе в качестве пакетного задания  
- Отказать во входе в качестве службы  
- Запретить вход в систему через службу удаленных рабочих столов  

> [!NOTE]  
> Эти параметры гарантируют, что учетную запись локального администратора нельзя использовать для подключения к контроллеру домена, хотя учетная запись, если она включена, может локально войти в систему на контроллерах домена. Поскольку эта учетная запись должна быть включена и использоваться только в сценариях аварийного восстановления, предполагается, что будет доступен физический доступ по крайней мере к одному контроллеру домена или другие учетные записи с разрешениями на удаленный доступ к контроллерам домена могут быть используется.  

##### <a name="configure-auditing-of-built-in-administrator-accounts"></a>Настройка аудита встроенных учетных записей администраторов

Если учетная запись администратора домена защищена и отключена, следует настроить аудит для отслеживания изменений в учетной записи. Если учетная запись включена, ее пароль сбрасывается или вносятся любые другие изменения в учетную запись. оповещения должны отправляться пользователям или группам, ответственным за администрирование AD DS, в дополнение к командам реагирования на инциденты в Организации.  

### <a name="securing-administrators-domain-admins-and-enterprise-admins-groups"></a>Защита администраторов, администраторов домена и групп администраторов предприятия

#### <a name="securing-enterprise-admin-groups"></a>Защита групп администраторов предприятия

Группа "Администраторы предприятия", размещенная в корневом домене леса, не должна содержать пользователей ежедневно, за исключением учетной записи локального администратора домена, при условии, что она защищена, как описано выше, и в [приложении г: защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  

Если требуется доступ EA, пользователи, чьи учетные записи требуют права и разрешения EA, должны временно помещаться в группу "Администраторы предприятия". Хотя пользователи используют учетные записи с высоким уровнем привилегий, их действия должны проводить аудит и, желательно, выполняться с одним пользователем, выполняющим изменения, и другим пользователем, которые отслеживают изменения, чтобы максимально ограничить вероятность случайного непреднамеренного использования или неправильной настройки. . После завершения действий учетные записи должны быть удалены из группы EA. Это можно сделать с помощью ручных процедур и документированных процессов, программного обеспечения сторонних поставщиков удостоверений и управления доступом (PIM/PAM) или их комбинации. Рекомендации по созданию учетных записей, которые можно использовать для управления членством в привилегированных группах в Active Directory, предоставляются в [привлекательных учетных записях для кражи учетных данных](../../../ad-ds/plan/security-best-practices/Attractive-Accounts-for-Credential-Theft.md) и подробные инструкции приведены в [приложении I. Создание учетных записей управления для защищенных учетных записей и групп в Active Directory](../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md).  

Администраторы предприятия по умолчанию являются членами встроенной группы администраторов в каждом домене леса. Удаление группы "Администраторы предприятия" из групп администраторов в каждом домене является недопустимым изменением, так как в случае аварийного восстановления леса права EA, скорее всего, будут требоваться. Если группа "Администраторы предприятия" была удалена из групп администраторов в лесу, она должна быть добавлена в группу администраторов в каждом домене, а также должны быть реализованы следующие дополнительные элементы управления:  

- Как было сказано ранее, Группа "Администраторы предприятия" не должна содержать пользователей ежедневно, за исключением учетной записи администратора корневого домена леса, которая должна быть защищена, как описано в [приложении г: защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  
- В объектах групповой политики, связанных с подразделениями, содержащими рядовые серверы и рабочие станции в каждом домене, Группа EA должна быть добавлена к следующим правам пользователя:  
   - Отказ в доступе к компьютеру из сети  
   - Отказ во входе в качестве пакетного задания  
   - Отказать во входе в качестве службы  
   - Запретить локальный вход  
   - Запретите вход в систему через службы удаленных рабочих столов.  

Это предотвратит вход членов группы EA на рядовые серверы и рабочие станции. Если для администрирования контроллеров домена и Active Directory используются серверы переходов, убедитесь, что серверы переходов расположены в подразделении, к которому не привязаны объекты групповой политики.  

- Аудит следует настроить для отправки предупреждений при внесении любых изменений в свойства или членство в группе EA. Эти оповещения должны отправляться как минимум пользователям или командам, ответственным за Active Directory администрирование и реагирование на инциденты. Необходимо также определить процессы и процедуры для временного заполнения группы EA, включая процедуры уведомления при допустимом заполнении группы.  
  
#### <a name="securing-domain-admins-groups"></a>Защита групп администраторов домена

Как и в случае с группой "Администраторы предприятия", членство в группах "Администраторы домена" должно быть обязательным только в сценариях сборки или аварийного восстановления. В группе DA не должно быть повседневных учетных записей пользователей, за исключением учетной записи локального администратора домена, если она защищена, как описано в [приложении г: защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  
  
Если требуется доступ к DA, учетные записи, которым необходим этот уровень доступа, должны временно помещаться в группу DA для рассматриваемого домена. Несмотря на то, что пользователи используют привилегированные учетные записи, действия должны проводить аудит и, желательно, выполняться с одним пользователем, выполняющим изменения, и другим пользователем, которые отслеживают изменения, чтобы максимально ограничить вероятность случайного непреднамеренного использования или неправильной настройки. После завершения действий учетные записи должны быть удалены из группы "Администраторы домена". Это можно сделать с помощью ручных процедур и документированных процессов с помощью программного обеспечения для управления привилегированными пользователями (PIM и PAM) сторонних разработчиков или сочетанием обоих. Рекомендации по созданию учетных записей, которые можно использовать для управления членством в привилегированных группах в Active Directory предоставлены в [приложении I: создание учетных записей управления для защищенных учетных записей и групп в Active Directory](../../../ad-ds/manage/component-updates/../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md).  
  
Администраторы домена по умолчанию являются членами локальных групп администраторов на всех рядовых серверах и рабочих станциях в соответствующих доменах. Это вложение по умолчанию не следует изменять, так как оно влияет на возможности поддержки и аварийного восстановления. Если группы администраторов домена были удалены из групп локальных администраторов на рядовых серверах, они должны быть добавлены в группу администраторов на каждом рядовом сервере и рабочей станции в домене с помощью параметров ограниченной группы в связанных объектах GPO. Следующие общие элементы управления, которые подробно описаны в [приложении F: защита групп администраторов домена в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-F--Securing-Domain-Admins-Groups-in-Active-Directory.md) , также должны быть реализованы.  

Для группы Администраторы домена в каждом домене леса:  

1. Удалите всех членов группы DA с возможным исключением встроенной учетной записи администратора для домена, если оно защищено, как описано в [приложении г. Защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  
2. В объектах групповой политики, связанных с подразделениями, содержащими рядовые серверы и рабочие станции в каждом домене, Группа DA должна быть добавлена к следующим правам пользователя:  
   - Отказ в доступе к компьютеру из сети  
   - Отказ во входе в качестве пакетного задания  
   - Отказать во входе в качестве службы  
   - Запретить локальный вход  
   - Запретить вход в систему через службу удаленных рабочих столов  
  
   Это предотвратит вход членов группы DA на рядовые серверы и рабочие станции. Если для администрирования контроллеров домена и Active Directory используются серверы переходов, убедитесь, что серверы переходов расположены в подразделении, к которому не привязаны объекты групповой политики.  

3. Аудит следует настроить для отправки оповещений при внесении любых изменений в свойства или членство в группе DA. Эти оповещения должны отправляться как минимум пользователям или командам, ответственным за AD DS администрирование и реагирование на инциденты. Необходимо также определить процессы и процедуры для временного заполнения группы DA, включая процедуры уведомления при допустимом заполнении группы.  

#### <a name="securing-administrators-groups-in-active-directory"></a>Защита групп администраторов в Active Directory

Как и в случае с группами EA и DA, членство в группе Администраторы (BA) должно быть обязательным только в сценариях сборки или аварийного восстановления. В группе администраторов не должно быть повседневных учетных записей пользователей, за исключением учетной записи локального администратора домена, если она защищена, как описано в [приложении г: защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  

Если требуется доступ к администраторам, учетные записи, которым необходим этот уровень доступа, должны временно помещаться в группу администраторов для рассматриваемого домена. Несмотря на то, что пользователи используют привилегированные учетные записи, действия должны быть проверены и, желательно, выполняться с пользователем, выполняющим изменения, и другим пользователем, которые отслеживают изменения, чтобы максимально ограничить вероятность случайного непреднамеренного использования или неправильной настройки. После завершения действий учетные записи должны быть немедленно удалены из группы администраторов. Это можно сделать с помощью ручных процедур и документированных процессов с помощью программного обеспечения для управления привилегированными пользователями (PIM и PAM) сторонних разработчиков или сочетанием обоих.  

Администраторы по умолчанию являются владельцами большинства объектов AD DS в соответствующих доменах. Членство в этой группе может потребоваться в сценариях сборки и аварийного восстановления, в которых требуется владение или возможность стать владельцем объектов. Кроме того, DAs и EAs наследуют ряд прав и разрешений, используя членство по умолчанию в группе администраторов. Вложенность групп по умолчанию для привилегированных групп в Active Directory не должна изменяться, и группа администраторов каждого домена должна быть защищена, как описано в [приложении ж: защита групп администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-G--Securing-Administrators-Groups-in-Active-Directory.md)и в общих инструкциях ниже.  

1. Удалите всех членов группы "Администраторы" с возможным исключением учетной записи локального администратора для домена, если оно защищено, как описано в [приложении г. Защита встроенных учетных записей администраторов в Active Directory](../../../ad-ds/plan/security-best-practices/Appendix-D--Securing-Built-In-Administrator-Accounts-in-Active-Directory.md).  
2. Членам группы администраторов домена никогда не нужно выполнять вход на рядовые серверы или рабочие станции. В одном или нескольких объектах групповой политики, связанных с рабочими станциями и рядовыми серверами в каждом домене, Группа администраторов должна быть добавлена к следующим правам пользователя:  
   - Отказ в доступе к компьютеру из сети  
   - Запретить вход в систему в качестве пакетного задания,  
   - Отказать во входе в качестве службы  
   - Это предотвратит использование членов группы "Администраторы" для входа или подключения к рядовым серверам или рабочим станциям (если только несколько элементов управления не были изначально нарушены), где их учетные данные могут кэшироваться и, соответственно, скомпрометированы. Привилегированную учетную запись никогда не следует использовать для входа в систему с меньшими правами, и применение этих элементов управления обеспечивает защиту от нескольких атак.  

3. В подразделении контроллеров домена в каждом домене леса группе Администраторы должны быть предоставлены следующие права пользователя (если они еще не имеют этих прав), что позволит членам группы "Администраторы" выполнять функции, необходимые для сценарий аварийного восстановления на уровне леса:  
   - Доступ к этому компьютеру из сети  
   - Локальный вход в систему  
   - Разрешить вход в систему через службу удаленных рабочих столов  

4. Аудит следует настроить для отправки оповещений при внесении любых изменений в свойства или членство в группе "Администраторы". Эти оповещения должны отправляться как минимум членам группы, ответственным за AD DS администрирование. Оповещения также должны отправляться членам группы безопасности, а процедуры должны быть определены для изменения членства в группе администраторов. В частности, эти процессы должны включать процедуру, с помощью которой группа безопасности получает уведомление о том, что Группа администраторов будет изменяться, чтобы при отправке предупреждений они были ожидаемыми, а оповещение не порождается. Кроме того, процессы для уведомления группы безопасности о завершении использования группы «Администраторы» и удалении учетных записей, удаленных из группы, должны быть реализованы.  

> [!NOTE]  
> При реализации ограничений группы администраторов в объектах групповой политики Windows применяет параметры к членам локальной группы администраторов компьютера в дополнение к группе администраторов домена. Поэтому следует соблюдать осторожность при реализации ограничений для группы администраторов. Несмотря на то, что запрещено выполнять вход в сеть, пакет и службу для членов группы «Администраторы», не следует ограничивать локальные входы и входы с помощью службы удаленных рабочих столов. Блокирование этих типов входа в систему может заблокировать законное администрирование компьютера членами локальной группы "Администраторы". На следующем снимке экрана показаны параметры конфигурации, которые блокируют неправильное использование встроенных локальных учетных записей и администраторов домена, а также неправильное использование встроенных локальных групп или группы «Администраторы домена». Обратите внимание, что право " **запретить вход в службы удаленных рабочих столов** пользователя" не включает в себя группу "Администраторы", так как она включает в себя этот параметр, а также запрещает эти входы для учетных записей, являющихся членами группы "Администраторы" локального компьютера. Если службы на компьютерах настроены для работы в контексте любой из привилегированных групп, описанных в этом разделе, реализация этих параметров может привести к сбою служб и приложений. Поэтому, как и в случае со всеми рекомендациями в этом разделе, необходимо тщательно проверить параметры для применения в вашей среде.  
>
> ![наименее права модели администрирования](media/Implementing-Least-Privilege-Administrative-Models/SAD_3.gif)  

### <a name="role-based-access-controls-rbac-for-active-directory"></a>Управление доступом на основе ролей (RBAC) для Active Directory

В целом, управление доступом на основе ролей (RBAC) — это механизм группирования пользователей и предоставления доступа к ресурсам на основе бизнес-правил. В случае Active Directory реализация RBAC для AD DS — это процесс создания ролей, которым делегируются права и разрешения, позволяющие членам роли выполнять повседневные административные задачи без предоставления им чрезмерных прав. RBAC для Active Directory можно разрабатывать и реализовывать с помощью собственных средств и интерфейсов, используя программное обеспечение, которое вы уже можете приобретать, приобретяя сторонние продукты или любое сочетание этих подходов. В этом разделе не приводятся пошаговые инструкции по реализации RBAC для Active Directory, а также обсуждаются факторы, которые следует учитывать при выборе подхода к реализации RBAC в установках AD DS.  

#### <a name="native-approaches-to-rbac-for-active-directory"></a>Собственные подходы к RBAC для Active Directory

В простейшей реализации RBAC роли можно реализовать как группы AD DS и делегировать права и разрешения группам, которые позволяют выполнять ежедневное администрирование в рамках определенной области действия роли.  

В некоторых случаях существующие группы безопасности в Active Directory можно использовать для предоставления прав и разрешений, подходящих для функции задания. Например, если определенные сотрудники ИТ-организации несут ответственность за управление и обслуживание зон и записей DNS, то делегирование этих обязанностей может быть так же простым, как создание учетной записи для каждого администратора DNS и добавление их в DNS. Группа "Администраторы" в Active Directory. Группа "Администраторы DNS", в отличие от более привилегированных групп, имеет несколько мощных прав в Active Directory, хотя члены этой группы были делегированы разрешения, которые позволяют им администрировать DNS и по-прежнему подвержены атакам и нарушениям повышение привилегий.

В других случаях может потребоваться создать группы безопасности и делегировать права и разрешения для Active Directory объектов, объектов файловой системы и объектов реестра, чтобы члены групп могли выполнять назначенные задачи администрирования. Например, если операторы службы поддержки отвечают за сброс забытых паролей, помощь пользователям с проблемами подключения и устранение неполадок с параметрами приложения, может потребоваться объединить параметры делегирования для объектов пользователя в Active Directory с привилегиями, которые позволяют пользователям службы поддержки удаленно подключаться к компьютерам пользователей для просмотра или изменения параметров конфигурации пользователей. Для каждой определяемой роли следует определить:  

1. Задачи, выполняемые участниками роли в повседневной работе, и задачи, которые выполняются реже.  
2. На каких системах и в каких приложениях членам роли должны быть предоставлены права и разрешения.  
3. Пользователей, которым следует предоставить членство в роли.  
4. Как будут выполняться управление членством в ролях.  

Во многих средах управление доступом на основе ролей вручную для администрирования среды Active Directory может быть трудно реализовать и поддерживать. Если вы четко определили роли и обязанности по администрированию ИТ-инфраструктуры, вам может потребоваться использовать дополнительные средства, которые помогут вам создать управляемое собственное развертывание RBAC. Например, если в вашей среде используется Forefront Identity Manager (FIM), вы можете использовать FIM для автоматизации создания и заполнения административных ролей, что упрощает непрерывное администрирование. При использовании System Center Configuration Manager (SCCM) и System Center Operations Manager (SCOM) можно использовать роли конкретных приложений для делегирования функций управления и мониторинга, а также обеспечить согласованную настройку и аудит для всех систем в домен. Если вы реализовали инфраструктуру открытых ключей (PKI), вы можете выдавать и требовать смарт-карты для специалистов по ИТ, ответственных за администрирование среды. С помощью управления учетными данными FIM (FIM CM) можно даже сочетать управление ролями и учетными данными для административного персонала.  

В других случаях может быть предпочтительнее организация раслагаться на развертывание стороннего программного обеспечения RBAC, предоставляющего возможности "встроенных" функций. Коммерческие, готовые решения (Котс) для RBAC для Active Directory, Windows, а также каталогов и операционных систем, отличных от Windows, предлагаются несколькими поставщиками. При выборе между собственными решениями и продуктами сторонних производителей следует учитывать следующие факторы.  

1. Бюджет. благодаря инвестиционной разработке RBAC с помощью программного обеспечения и средств, которые вы уже можете присвоить, вы можете уменьшить затраты на программное обеспечение, связанное с развертыванием решения. Тем не менее, если у вас нет сотрудников, создающих и развернутых в собственных решениях RBAC, вам может потребоваться привлечь консультационные материалы для разработки решения. Следует тщательно взвесить ожидаемые затраты на специально разработанное решение с учетом затрат на развертывание встроенного решения, особенно в том случае, если бюджет ограничен.  
2. Композиция ИТ-среды. Если ваша среда состоит в основном из систем Windows или если вы уже используете Active Directory для управления системами и учетными записями, отличными от Windows, пользовательские решения могут предоставить оптимальное решение для Ваши потребности. Если ваша инфраструктура содержит множество систем, которые не работают под управлением Windows и не управляются с помощью Active Directory, может потребоваться рассмотреть возможность управления системами, отличными от Windows, отдельно от среды Active Directory.  
3. Модель привилегий в решении. Если продукт полагается на размещение учетных записей служб в группах с высоким уровнем привилегий в Active Directory и не предлагает параметры, не требующие чрезмерных прав, предоставленных программному обеспечению RBAC, вы не сократили Ваша Active Directoryная контактная зона изменила только структуру наиболее привилегированных групп в каталоге. Если поставщик приложения не может предоставлять элементы управления для учетных записей служб, которые снижают вероятность компрометации и злонамеренного использования учетных записей, вы можете рассмотреть другие варианты.  

### <a name="privileged-identity-management"></a>Управление привилегированными пользователями

Управление привилегированными пользователями (PIM), иногда называемое управлением привилегированными учетными записями (PAM) или управлением привилегированными учетными данными (PCM), — это проектирование, создание и реализация подходов к управлению привилегированными учетными записями в Infrastructure. В общем случае PIM предоставляет механизмы, с помощью которых учетным записям предоставляются временные права и разрешения, необходимые для выполнения функций исправления сборки или прерывания, а не для постоянного подключения к учетным записям. Могут ли быть доступны функции PIM, созданные вручную или реализованные с помощью развертывания стороннего программного обеспечения, возможны следующие функции:  
  
- Учетные данные "хранилища", где "пароли для привилегированных учетных записей" извлечены "и получают исходный пароль, а затем" возвращен "после завершения действий, в течение которых пароли снова сбрасываются в учетных записях.  
- Ограничения ограниченного времени при использовании привилегированных учетных данных  
- Учетные данные одноразового использования  
- Созданное рабочим процессом предоставление привилегий с мониторингом и созданием отчетов о действиях, выполненных и автоматических при завершении действий, или выделенном времени истекло.  
- Замена жестко запрограммированных учетных данных, таких как имена пользователей и пароли, в скриптах с помощью прикладных программных интерфейсов (API), которые позволяют получать учетные данные из хранилищ по мере необходимости  
- Автоматическое управление учетными данными учетной записи службы  

### <a name="creating-unprivileged-accounts-to-manage-privileged-accounts"></a>Создание непривилегированных учетных записей для управления привилегированными учетными записями

Одной из задач управления привилегированными учетными записями является то, что по умолчанию учетные записи, которые могут управлять привилегированными и защищенными учетными записями и группами, являются привилегированными и защищенными. Если вы реализуете соответствующие решения RBAC и PIM для установки Active Directory, решения могут включать в себя подходы, позволяющие эффективно располнять членство в группах с наибольшим количеством привилегированных пользователей в каталоге, заполняя только группы временно и при необходимости.  

Однако при реализации собственных RBAC и PIM следует рассмотреть возможность создания учетных записей, не имеющих привилегий, и с помощью единственной функции заполнения и дезаполнения привилегированных групп в Active Directory при необходимости. [Приложение I. Создание учетных записей управления для защищенных учетных записей и групп в Active Directory](../../../ad-ds/manage/component-updates/../../../ad-ds/manage/component-updates/Appendix-I--Creating-Management-Accounts-for-Protected-Accounts-and-Groups-in-Active-Directory.md) содержит пошаговые инструкции, которые можно использовать для создания учетных записей для этой цели.  

### <a name="implementing-robust-authentication-controls"></a>Реализация надежных элементов управления аутентификацией

*Номер шестого закона. на самом деле, кто-то пытается угадать пароли.* - [10 непреложных законов по администрированию безопасности](https://technet.microsoft.com/library/cc722488.aspx)  

Атаки Pass-a-hash и других атак с кражой учетных данных не относятся к операционным системам Windows и не являются новыми. Первая атака Pass-a-hash была создана в 1997. Однако исторически эти атаки требовали специальных средств, были пройдены или пропускают их успешно, а необходимые злоумышленники имеют относительно высокий уровень квалификации. Введение в бесплатное, простое в использовании средство, которое изначально извлекает учетные данные, привело к экспоненциальному увеличению числа и успешности атак с хищением учетных данных за последние годы. Однако атаки методом кражи учетных данных не являются единственными механизмами, в которых учетные данные нацелены и скомпрометированы.  

Хотя необходимо реализовать элементы управления для защиты от атак с хищением учетных данных, следует также определить учетные записи в среде, которые, скорее всего, будут использоваться злоумышленниками, и реализовать надежные элементы управления аутентификацией для этих организаций. Если наиболее привилегированные учетные записи используют однофакторную проверку подлинности, например имена пользователей и пароли (то есть что-то известное, то есть один фактор проверки подлинности), эти учетные записи будут слабее защищены. Все, что необходимо злоумышленнику, — знание имени пользователя и знаний о пароле, связанном с учетной записью, а атаки типа Pass-The-hash не требуются, чтобы злоумышленник мог пройти проверку подлинности в качестве пользователя для любых систем, принимающих учетные данные одного фактора.  

Несмотря на то, что реализация многофакторной проверки подлинности не защищает вас от атак Pass-of-Hash, реализация многофакторной проверки подлинности в сочетании с защищенными системами может быть реализована. Дополнительные сведения о реализации защищенных систем приведены в разделе [Реализация безопасных административных узлов](../../../ad-ds/plan/security-best-practices/Implementing-Secure-Administrative-Hosts.md), а параметры проверки подлинности обсуждаются в следующих разделах.  

#### <a name="general-authentication-controls"></a>Общие элементы управления аутентификацией

Если вы еще не реализовали многофакторную проверку подлинности, например смарт-карты, попробуйте сделать это. Смарт-карты реализуют аппаратную защиту закрытых ключей в паре открытого и закрытого ключей, предотвращая доступ к закрытому ключу пользователя или его использование, если только пользователь не представит правильный ПИН-код, секретный код или биометрический идентификатор для смарт-карты. Даже если ПИН-код пользователя или секретный код перехватывается средством ведения журнала нажатия клавиш на скомпрометированном компьютере, для повторного использования ПИН-кода или секретного кода карта должна быть также физически представлена.

В случаях, когда длительные сложные пароли были сложно реализовать из-за сопротивления пользователя, Интеллектуальные карты предоставляют механизм, с помощью которого пользователи могут реализовывать относительно простые ПИН или секретные коды без уязвимых учетных данных для принудительного подбора или атаки на таблицу Радуга. Крепления смарт-карт не хранятся в Active Directory или в локальных базах данных SAM, хотя хэши учетных данных по-прежнему могут храниться в защищенной памяти LSASS на компьютерах, на которых смарт-карты использовались для проверки подлинности.  

#### <a name="additional-controls-for-vip-accounts"></a>Дополнительные элементы управления для учетных записей виртуального IP-адреса

Еще одним преимуществом реализации смарт-карт или других механизмов проверки подлинности на основе сертификатов является возможность использования гарантии механизма проверки подлинности для защиты конфиденциальных данных, доступных пользователям виртуальных IP-адресов. Механизм проверки подлинности доступен в доменах, в которых установлен функциональный уровень Windows Server 2012 или Windows Server 2008 R2. Если включено, механизм проверки подлинности добавляет административное членство в маркер Kerberos пользователя при проверке подлинности учетных данных пользователя во время входа с помощью метода входа на основе сертификата.  

Это позволяет администраторам ресурсов управлять доступом к ресурсам, таким как файлы, папки и принтеры, в зависимости от того, входит ли пользователь в систему с помощью метода входа на основе сертификата, а также от типа используемого сертификата. Например, когда пользователь входит в систему с помощью смарт-карты, доступ пользователя к ресурсам в сети можно указать так, как если бы пользователь не использовал смарт-карту (то есть когда пользователь входит в систему, вводя имя пользователя и пароль). Дополнительные сведения о механизме проверки подлинности см. в пошаговом пошаговом [руководству по механизму проверки подлинности для AD DS в Windows Server 2008 R2](https://technet.microsoft.com/library/dd378897.aspx).  

#### <a name="configuring-privileged-account-authentication"></a>Настройка проверки подлинности привилегированной учетной записи

В Active Directory для всех учетных записей администратора включите атрибут **требовать смарт-карту для интерактивного входа в систему** и аудит изменений (как минимум) для всех атрибутов на вкладке **учетной записи** учетной записи (например, CN, имя, SamAccountName, userPrincipalName и userAccountControl) объекты пользователя с правами администратора.  

Несмотря на то, что при настройке параметра **требовать смарт-карту для интерактивного входа** в систему для учетных записей выполняется сброс пароля учетной записи на 120-символьное случайное значение, а для интерактивного входа в систему требуются смарт-карты, этот атрибут по-прежнему может быть перезаписан пользователями с разрешениями, которые позволяют им изменять пароли учетных записей.  

В других случаях, в зависимости от конфигурации учетных записей в Active Directory и параметров сертификатов в Active Directory служб сертификации (AD CS) или сторонней PKI, можно ориентироваться на атрибуты имени участника-пользователя (UPN) для учетных записей администратора или виртуального IP-адреса. для атаки определенного типа, как описано здесь.  

##### <a name="upn-hijacking-for-certificate-spoofing"></a>Захват имени участника-пользователя для подмены сертификатов

Хотя подробное обсуждение атак на инфраструктуру открытых ключей (PKI) выходит за рамки этого документа, атаки с общедоступного и частного PKI увеличиваются в экспоненциальном масштабе с 2008. Нарушения общедоступного PKI были широко общедоступными, но атаки на внутреннюю PKI Организации, возможно, еще больше плодотворным. Одна из таких атак использует Active Directory и сертификаты, чтобы позволить злоумышленнику подменить учетные данные других учетных записей способом, который может быть трудно обнаружить.  

Если сертификат предоставляется для проверки подлинности в системе, присоединенной к домену, то содержимое субъекта или атрибут альтернативного имени субъекта (SAN) в сертификате используется для того, чтобы сопоставлять сертификат с объектом пользователя в Active Directory. В зависимости от типа сертификата и способа его создания атрибут subject в сертификате обычно содержит общее имя пользователя (CN), как показано на следующем снимке экрана.  

![наименее права модели администрирования](media/Implementing-Least-Privilege-Administrative-Models/SAD_4.gif)  

По умолчанию Active Directory конструирует CN пользователя, объединяя имя и фамилию учетной записи. Однако компоненты CN объектов-пользователей в Active Directory не обязательно должны быть уникальными, и перемещение учетной записи пользователя в другое расположение в каталоге изменяет различающееся имя учетной записи (DN), то есть полный путь к объекту в Каталог, как показано в нижней области предыдущего снимка экрана.  

Так как имена субъектов сертификатов не обязательно должны быть статическими или уникальными, содержимое альтернативного имени субъекта часто используется для нахождение объекта пользователя в Active Directory. Атрибут SAN для сертификатов, выдаваемых пользователям из центров сертификации предприятия (Active Directory интегрированных ЦС), обычно содержит имя участника-пользователя или адрес электронной почты. Так как имена участников-пользователей гарантированно уникальны в лесу AD DS, Поиск объекта пользователя по имени участника обычно выполняется как часть проверки подлинности с сертификатами, вовлеченными в процесс проверки подлинности или без них.  

Использование UPN в атрибутах SAN в сертификатах проверки подлинности может быть использовано злоумышленниками для получения мошеннических сертификатов. Если злоумышленник выскомпрометирован учетную запись, имеющую право на чтение и запись имен участников-пользователей для объектов пользователя, то атака реализуется следующим образом:  

Атрибут UPN для объекта пользователя (например, пользователя виртуального IP-адреса) временно изменен на другое значение. Кроме того, в настоящее время можно изменить атрибут имени учетной записи SAM и CN, хотя это необязательно по причинам, описанным выше.  

При изменении атрибута UPN в целевой учетной записи устаревшая, включенная учетная запись пользователя или атрибут UPN новой учетной записи пользователя изменяется на значение, первоначально назначенное целевой учетной записи. Устаревшие, включенные учетные записи пользователей — это учетные записи, которые не входили в систему в течение длительного времени, но не были отключены. Они предназначены для злоумышленников, которые предписывают «скрыть в простой информации» по следующим причинам.  

1. Так как учетная запись включена, но не использовалась недавно, использование учетной записи вряд ли вызовет предупреждения способом включения отключенной учетной записи пользователя.  
2. Использование существующей учетной записи не требует создания новой учетной записи пользователя, которая может быть замечена административным персоналом.  
3. Устаревшие учетные записи пользователей, которые по-прежнему включены, обычно являются членами различных групп безопасности и получают доступ к ресурсам в сети, упрощая доступ и "смешивание" с существующим пользователем заполнением.  

Учетная запись пользователя, на которой настроен целевой UPN-сервер, используется для запроса одного или нескольких сертификатов от служб сертификатов Active Directory.  

Если для учетной записи злоумышленника были получены сертификаты, имена участников в учетной записи "Новая" и целевой учетной записи возвращаются к их исходным значениям.  

Теперь у злоумышленника есть один или несколько сертификатов, которые можно представить для проверки подлинности в ресурсах и приложениях, как если бы пользователь был пользователем виртуальной ЛС, учетная запись которого была временно изменена. Несмотря на полное обсуждение всех способов, с помощью которых сертификаты и PKI могут быть нацелены злоумышленниками вне области этого документа, этот механизм атаки позволяет продемонстрировать, почему необходимо отслеживать привилегированные и виртуальные IP-адреса в AD DS для внесения изменений, особенно для внесения изменений в какие-либо атрибуты на вкладке **учетной записи** (например, CN, Name, SamAccountName, userPrincipalName и userAccountControl). В дополнение к наблюдению за учетными записями следует ограничить круг пользователей, которые могут изменять учетные записи, как можно меньшему набору административных прав. Аналогичным образом учетные записи пользователей с правами администратора должны быть защищены и отслеживаться на наличие несанкционированных изменений.  
