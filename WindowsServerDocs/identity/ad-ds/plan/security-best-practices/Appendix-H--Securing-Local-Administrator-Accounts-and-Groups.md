---
description: 'Дополнительные сведения о: Приложение H. Защита учетных записей и групп локального администратора'
ms.assetid: ea015cbc-dea9-4c72-a9d8-d6c826d07608
title: Приложение H. Защита учетных записей и групп локального администратора
author: iainfoulds
ms.author: daveba
manager: daveba
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: 5f208291301159f305e6d497f01b273c71478089
ms.sourcegitcommit: e2dadc9b0c227a489a945bbc531aca5e101f18cd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/29/2020
ms.locfileid: "97801778"
---
# <a name="appendix-h-securing-local-administrator-accounts-and-groups"></a>Приложение З. Защита учетных записей и групп локальных администраторов

> Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012


## <a name="appendix-h-securing-local-administrator-accounts-and-groups"></a>Приложение З. Защита учетных записей и групп локальных администраторов

Во всех версиях Windows, в настоящее время включенной в основную поддержку, учетная запись локального администратора по умолчанию отключена, что делает учетную запись непригодной для атак Pass-The-hash и других злоумышленников по краже учетных данных. Однако в средах, содержащих устаревшие операционные системы или в которых включены учетные записи локального администратора, эти учетные записи можно использовать, как описано выше, для распространения компромисса между рядовыми серверами и рабочими станциями. Каждая учетная запись локального администратора и группа должны быть защищены, как описано в следующих пошаговых инструкциях.

Подробные сведения о защите встроенных групп администраторов (BA) см. в статье [реализация Least-Privilege административных моделей](../../../ad-ds/plan/security-best-practices/Implementing-Least-Privilege-Administrative-Models.md).

#### <a name="controls-for-local-administrator-accounts"></a>Элементы управления для учетных записей локального администратора

Для учетной записи локального администратора в каждом домене леса необходимо настроить следующие параметры.

- Настройка объектов групповой политики для ограничения использования учетной записи администратора домена в системах, присоединенных к домену
    - В одном или нескольких объектах групповой политики, которые вы создаете и связываете с подразделениями рабочей станции и рядового сервера в каждом домене, добавьте учетную запись администратора к следующим правам пользователя в **Computer \ политики \ параметры безопасности \ локальные политики Policies\User назначения прав**:

        - Запретить сетевой доступ к этому компьютеру.

        - Отказ во входе в качестве пакетного задания

        - Отказать во входе в качестве службы

        - Запретить вход в систему через службу удаленных рабочих столов

#### <a name="step-by-step-instructions-to-secure-local-administrators-groups"></a>Пошаговые инструкции по обеспечению безопасности групп локальных администраторов

###### <a name="configuring-gpos-to-restrict-administrator-account-on-domain-joined-systems"></a>Настройка объектов групповой политики для ограничения учетной записи администратора в Domain-Joinedных системах

1. В **Диспетчер сервера** щелкните **средства** и выберите **Групповая политика управление**.

2. В дереве консоли разверните узел \<Forest\> \домаинс \\<домен \> , а затем **Групповая политика объекты** (где \<Forest\> — имя леса, а \<Domain\> — имя домена, в котором вы хотите задать групповая политика).

3. В дереве консоли щелкните правой кнопкой мыши элемент **Групповая политика объекты** и выберите команду **создать**.

    ![Снимок экрана, на котором показана вкладка "члены" для настройки объектов групповой политики для ограничения учетной записи администратора в системах, присоединенных к домену.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_101.png)

4. В диалоговом окне **Создание объекта групповой политики** введите **\<GPO Name\>** и нажмите кнопку **ОК** (где \<GPO Name\> — это имя этого объекта групповой политики).

    ![Снимок экрана, на котором показано, где можно присвоить имя объекту групповой политики, чтобы настроить объекты групповой политики для ограничения учетной записи администратора в системах, присоединенных к домену](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_102.png)

5. В области сведений щелкните правой кнопкой мыши **\<GPO Name\>** и выберите команду **изменить**.

6. Перейдите к компьютеру \ политики \ **Параметры безопасности Локальные политики** и щелкните **Назначение прав пользователя**.

    ![Снимок экрана, на котором показано, где можно перемещаться, чтобы настроить объекты групповой политики для ограничения учетной записи администратора в системах, присоединенных к домену.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_103.png)

7. Настройте права пользователя, чтобы запретить учетной записи локального администратора доступ к серверам и рабочим станциям в сети, выполнив следующие действия.

    1. Дважды щелкните " **запретить доступ к этому компьютеру из сети"** и выберите " **определить параметры политики**".

    2. Нажмите кнопку **Добавить пользователя или группу**, введите имя пользователя учетной записи локального администратора и нажмите кнопку **ОК**. Это имя пользователя будет **администратором** по умолчанию при установке Windows.

        ![Снимок экрана, показывающий, как убедиться, что вы настроили права пользователя, чтобы запретить учетной записи локального администратора доступ к серверам и рабочим станциям по сети.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_104.png)

    3. Щелкните ОК.

        > [!IMPORTANT]
        > При добавлении учетной записи администратора к этим параметрам указывается, выполняется ли настройка учетной записи локального администратора или администратора домена с помощью метки учетных записей. Например, чтобы добавить учетную запись администратора домена ТАИЛСПИНТОЙС к этим отклонениям прав, перейдите к учетной записи администратора домена ТАИЛСПИНТОЙС, который будет выглядеть как Таилспинтойс\администратор. При вводе права **администратора** в этих параметрах прав пользователя в редактор объектов групповой политики будет ограничена учетная запись локального администратора на каждом компьютере, к которому применяется объект групповой политики, как описано выше.

8. Настройте права пользователя, чтобы предотвратить вход учетной записи локального администратора в качестве пакетного задания, выполнив следующие действия.

    1. Дважды щелкните **отклонить вход в качестве пакетного задания** и выберите **определить эти параметры политики**.

    2. Нажмите кнопку **Добавить пользователя или группу**, введите имя пользователя учетной записи локального администратора и нажмите кнопку **ОК**. Это имя пользователя будет **администратором** по умолчанию при установке Windows.

        ![Снимок экрана, показывающий, как проверить, настроены ли права пользователя для запрета входа учетной записи локального администратора в качестве пакетного задания.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_105.png)

    3. Нажмите кнопку **ОК**.

        > [!IMPORTANT]
        > При добавлении учетной записи администратора к этим параметрам вы указываете, следует ли настраивать учетную запись локального администратора или администратора домена с помощью метки учетных записей. Например, чтобы добавить учетную запись администратора домена ТАИЛСПИНТОЙС к этим отклонениям прав, перейдите к учетной записи администратора домена ТАИЛСПИНТОЙС, который будет выглядеть как Таилспинтойс\администратор. При вводе права **администратора** в этих параметрах прав пользователя в редактор объектов групповой политики будет ограничена учетная запись локального администратора на каждом компьютере, к которому применяется объект групповой политики, как описано выше.

9. Настройте права пользователя, чтобы запретить вход в систему в качестве службы с учетной записью локального администратора, выполнив следующие действия.

    1. Дважды щелкните **запретить вход в качестве службы** и выберите **определить эти параметры политики**.

    2. Нажмите кнопку **Добавить пользователя или группу**, введите имя пользователя учетной записи локального администратора и нажмите кнопку **ОК**. Это имя пользователя будет **администратором** по умолчанию при установке Windows.

        ![Снимок экрана, показывающий, как убедиться, что вы настроили права пользователя, чтобы запретить вход в систему в качестве службы для учетной записи локального администратора.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_106.png)

    3. Нажмите кнопку **ОК**.

        > [!IMPORTANT]
        > При добавлении учетной записи администратора к этим параметрам вы указываете, следует ли настраивать учетную запись локального администратора или администратора домена с помощью метки учетных записей. Например, чтобы добавить учетную запись администратора домена ТАИЛСПИНТОЙС к этим отклонениям прав, перейдите к учетной записи администратора домена ТАИЛСПИНТОЙС, который будет выглядеть как Таилспинтойс\администратор. При вводе права **администратора** в этих параметрах прав пользователя в редактор объектов групповой политики будет ограничена учетная запись локального администратора на каждом компьютере, к которому применяется объект групповой политики, как описано выше.

10. Настройте права пользователя, чтобы запретить учетной записи локального администратора доступ к рядовым серверам и рабочим станциям с помощью службы удаленных рабочих столов, выполнив следующие действия.

    1. Дважды щелкните элемент **запретить вход через службы удаленных рабочих столов** и выберите **определить эти параметры политики**.

    2. Нажмите кнопку **Добавить пользователя или группу**, введите имя пользователя учетной записи локального администратора и нажмите кнопку **ОК**. Это имя пользователя будет **администратором** по умолчанию при установке Windows.

        ![Снимок экрана, показывающий, как проверить, настроены ли права пользователя для запрета доступа учетной записи локального администратора к рядовым серверам и рабочим станциям с помощью службы удаленных рабочих столов.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_107.png)

    3. Нажмите кнопку **ОК**.

        > [!IMPORTANT]
        > При добавлении учетной записи администратора к этим параметрам вы указываете, следует ли настраивать учетную запись локального администратора или администратора домена с помощью метки учетных записей. Например, чтобы добавить учетную запись администратора домена ТАИЛСПИНТОЙС к этим отклонениям прав, перейдите к учетной записи администратора домена ТАИЛСПИНТОЙС, который будет выглядеть как Таилспинтойс\администратор. При вводе права **администратора** в этих параметрах прав пользователя в редактор объектов групповой политики будет ограничена учетная запись локального администратора на каждом компьютере, к которому применяется объект групповой политики, как описано выше.

11. Чтобы выйти из **редактор "Управление групповыми политиками"**, в меню **файл** выберите команду **выход**.

12. В **Групповая политика управления** свяжите объект групповой политики с подразделениями рядового сервера и рабочей станции, выполнив следующие действия.

    1. Перейдите в \<Forest\> домен \домаинс \\<\> (где \<Forest\> — имя леса, а \<Domain\> — имя домена, в котором нужно задать групповая политика).

    2. Щелкните правой кнопкой мыши подразделение, к которому будет применен объект GPO, и выберите команду **связать существующий объект GPO**.

        ![Снимок экрана, на котором показана ссылка на существующий пункт меню GPO при попытке связать объект GPO с подразделениями рядового сервера и рабочей станции.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_108.png)

    3. Выберите созданный объект групповой политики и нажмите кнопку **ОК**.

        ![Снимок экрана, на котором показано, где выбрать объект групповой политики, который вы только что создали при связывании объекта групповой политики с подразделениями рядового сервера и рабочей станции.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_109.png)

    4. Создайте ссылки на все подразделения, содержащие рабочие станции.

    5. Создайте ссылки на все подразделения, содержащие рядовые серверы.

#### <a name="verification-steps"></a>Этапы проверки

##### <a name="verify-deny-access-to-this-computer-from-the-network-gpo-settings"></a>Проверьте параметры объекта групповой политики "запретить доступ к этому компьютеру из сети"

С любого рядового сервера или рабочей станции, на который не влияют изменения объекта групповой политики (например, сервер переходов), попытайтесь получить доступ к рядовому серверу или рабочей станции по сети, на которую влияет изменение объекта групповой политики. Чтобы проверить параметры объекта групповой политики, попытайтесь выполнить сопоставление системного диска с помощью команды **net use** .

1. Локальный вход на любой рядовой сервер или рабочую станцию, на которые не влияют изменения объекта групповой политики.

2. С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.

3. В поле **поиска** введите **командную строку**, щелкните правой кнопкой мыши пункт **Командная строка** и выберите команду **Запуск от имени администратора** , чтобы открыть командную строку с повышенными привилегиями.

4. При появлении запроса на подтверждение повышения прав нажмите кнопку **Да**.

    ![Снимок экрана, посвященный диалоговому окну "контроль учетных записей", которое будет отображаться при проверке параметров объекта групповой политики.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_110.png)

5. В окне **командной строки** введите `net use \\<Server Name>\c$ /user:<Server Name>\Administrator` , где \<Server Name\> — имя рядового сервера или рабочей станции, к которой вы пытаетесь получить доступ по сети.

    > [!NOTE]
    > Учетные данные локального администратора должны находиться в той же системе, к которой вы пытаетесь получить доступ по сети.

6. На следующем снимке экрана показано сообщение об ошибке, которое должно появиться.

    ![Снимок экрана, на котором выводится сообщение об ошибке при входе в систему при проверке параметров объекта групповой политики.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_111.png)

##### <a name="verify-deny-log-on-as-a-batch-job-gpo-settings"></a>Проверка параметров объекта групповой политики "запретить вход в систему в качестве пакетного задания"

Войдите в систему с любого рядового сервера или рабочей станции, затронутой изменением объектов групповой политики.

###### <a name="create-a-batch-file"></a>Создание пакетного файла

1. С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.

2. В поле **поиска** введите **Блокнот** и щелкните **Блокнот**.

3. В **блокноте** введите **dir c:**.

4. Щелкните **файл** и выберите **Сохранить как**.

5. В поле **имя файла** введите `<Filename>.bat` (где \<Filename\> — имя нового пакетного файла).

###### <a name="schedule-a-task"></a>Планирование задачи

1. С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.

2. В поле **поиска** введите Task Scheduler (планировщик заданий) и нажмите кнопку **планировщик задач**.

    > [!NOTE]
    > На компьютерах под управлением Windows 8 в поле **поиска** введите **Schedule Tasks (расписание задач**) и щелкните **Schedule Tasks (планирование задач**).

3. Щелкните **действие** и выберите **создать задачу**.

4. В диалоговом окне **Создание задачи** введите **\<Task Name\>** (где \<Task Name\> — имя новой задачи).

5. Перейдите на вкладку **действия** и нажмите кнопку **создать**.

6. В поле **действие** щелкните **запустить программу**.

7. В поле **Программа/сценарий** нажмите кнопку **Обзор**, найдите и выберите пакетный файл, созданный в разделе **Создание пакетного файла** , и нажмите кнопку **Открыть**.

8. Нажмите кнопку **ОК**.

9. Перейдите на вкладку **Общие** .

10. В поле **Параметры безопасности** щелкните **изменить пользователя или группу**.

11. Введите имя учетной записи локального администратора системы, нажмите кнопку **Проверить имена** и нажмите кнопку **ОК**.

12. Выберите **выполнить, если пользователь вошел в систему или не** **хранит пароль**. Задача будет иметь доступ только к локальным ресурсам компьютера.

13. Нажмите кнопку **ОК**.

14. Появится диалоговое окно, запрашивающее учетные данные пользователя для выполнения задачи.

15. После ввода учетных данных нажмите кнопку **ОК**.

16. Появится диалоговое окно, похожее на следующее.

    ![Снимок экрана, на котором выделено диалоговое окно планировщик задач, которое появляется при планировании задачи.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_112.png)

###### <a name="verify-deny-log-on-as-a-service-gpo-settings"></a>Проверка параметров объекта групповой политики "запретить вход в качестве службы"

1. Войдите в систему с любого рядового сервера или рабочей станции, затронутой изменением объектов групповой политики.

2. С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.

3. В поле **поиска** введите **Services** и щелкните **службы**.

4. Выберите и дважды щелкните **Диспетчер очереди печати**.

5. Перейдите на вкладку **Вход в систему**.

6. В поле **Вход в качестве** щелкните **эту учетную запись**.

7. Нажмите кнопку **Обзор**, введите учетную запись локального администратора системы, нажмите кнопку **Проверить имена** и нажмите кнопку **ОК**.

8. В полях **пароль** и **Подтверждение пароля** введите пароль выбранной учетной записи и нажмите кнопку **ОК**.

9. Еще три раза нажмите кнопку **ОК** .

10. Щелкните правой кнопкой мыши **Диспетчер очереди печати** и выберите команду **перезапустить**.

11. При перезапуске службы появится диалоговое окно, похожее на следующее.

    ![Снимок экрана, показывающий, что Windows не удалось запустить диспетчер очереди печати на локальном компьютере.](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_113.png)

###### <a name="revert-changes-to-the-printer-spooler-service"></a>Отмена изменений в службе диспетчера очереди печати

1. Войдите в систему с любого рядового сервера или рабочей станции, затронутой изменением объектов групповой политики.

2. С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.

3. В поле **поиска** введите **Services** и щелкните **службы**.

4. Выберите и дважды щелкните **Диспетчер очереди печати**.

5. Перейдите на вкладку **Вход в систему**.

6. В поле **вход как**: выберите **Локальная системная учетная запись** и нажмите кнопку **ОК**.

###### <a name="verify-deny-log-on-through-remote-desktop-services-gpo-settings"></a>Проверка параметров объекта групповой политики "запретить вход в систему с помощью службы удаленных рабочих столов"

1. С помощью мыши переместите указатель в правый верхний или правый нижний угол экрана. Когда появится панель **чудо** , нажмите кнопку **Поиск**.

2. В поле **поиска** введите **Подключение к удаленному рабочему столу** и нажмите кнопку **Подключение к удаленному рабочему столу**.

3. В поле **компьютер** введите имя компьютера, к которому требуется подключиться, и нажмите кнопку **подключить**. (Можно также ввести IP-адрес вместо имени компьютера.)

4. При появлении запроса укажите учетные данные для учетной записи локального **администратора** системы.

5. Появится диалоговое окно, похожее на следующее.

    ![Защита учетных записей и групп локального администратора](media/Appendix-H--Securing-Local-Administrator-Accounts-and-Groups/SAD_114.png)
