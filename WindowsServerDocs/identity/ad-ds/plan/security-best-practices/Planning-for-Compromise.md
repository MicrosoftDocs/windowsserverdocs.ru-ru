---
ms.assetid: 6f50476c-a1f1-48fb-999b-76c4c3816496
title: Планирование при компрометации
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: d3d08e954b7a2a9ce58eb61dec54f2848ab68c12
ms.sourcegitcommit: 083ff9bed4867604dfe1cb42914550da05093d25
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/14/2020
ms.locfileid: "75949164"
---
# <a name="planning-for-compromise"></a>Планирование при компрометации

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

*Номер закона один: никто не считает, что в них есть неисправность, пока это не произойдет.* - [10 непреложных законов по администрированию безопасности](https://technet.microsoft.com/library/cc722488.aspx)  
  
Планы аварийного восстановления во многих организациях сосредоточены на восстановлении от региональных аварий или сбоев, приводящих к утрате вычислительных служб. Однако при работе с скомпрометированными клиентами мы часто обнаружили, что восстановление после намеренной компрометации отсутствует в планах аварийного восстановления. Это особенно справедливо, когда нарушение безопасности приводит к краже интеллектуальной собственности или намеренному уничтожению, которое использует логические границы (например, удаление всех Active Directory доменов или всех серверов), а не физические границы (например, уничтожение центра обработки данных). Несмотря на то, что в организации могут быть планы реагирования на инциденты, определяющие начальные действия при обнаружении компромисса, эти планы часто опускаются, чтобы избежать компромисса, влияющего на всю вычислительную инфраструктуру.  
  
Так как Active Directory предоставляет широкие возможности управления удостоверениями и доступом для пользователей, серверов, рабочих станций и приложений, неизменно нацелены злоумышленниками. Если злоумышленник получит высокопривилегированный доступ к домену Active Directory или контроллеру домена, то этот доступ можно использовать для доступа, управления или даже уничтожения всего Active Directory леса.  
  
В этом документе обсуждаются некоторые из наиболее распространенных атак на Windows, Active Directory и контрмеры, которые можно реализовать для сокращения уязвимой зоны, но единственным способом восстановления в случае полной компрометации Active Directory является подготовилась к компрометации перед поступающей. В этом разделе основное внимание уделяется меньшему уровню технической реализации по сравнению с предыдущими разделами этого документа, а также более подробными рекомендациями, которые можно использовать для создания комплексного комплексного подхода к защите и управлению критически важной Организации. Бизнес и ИТ-активы.  
  
Независимо от того, была ли ваша инфраструктура несанкционированной, она попыталась попытаться устранить нарушения или суккумбед атаки и полностью скомпрометирована, следует запланировать неизбежную реальность, что вы будете атаковать снова и снова. Предотвратить атаки невозможно, но в действительности может быть возможно предотвратить значительные нарушения или компромисс. Каждая организация должна тщательно оценить существующие программы управления рисками и внести необходимые изменения, чтобы снизить общий уровень уязвимости за счет предоставления сбалансированных инвестиций в целях предотвращения, обнаружения, включения и восстановления.  
  
Для создания эффективных средств защиты и предоставления служб пользователям и предприятиям, которые зависят от инфраструктуры и приложений, может потребоваться использовать романские способы предотвращения, обнаружения и нарушения безопасности в среде, а затем восстанавливать из Компрометация. Подходы и рекомендации, приведенные в этом документе, могут не помочь при восстановлении скомпрометированной Active Directoryной установки, но помогут вам защитить следующий.  
  
Рекомендации по восстановлению Active Directory леса представлены в [Windows Server 2012: планирование восстановления леса Active Directory](https://www.microsoft.com/download/details.aspx?id=16506). Вы можете предотвратить ненадежную атаку новой среды, но даже если это не так, у вас будут средства для восстановления и возможного управления средой.  
  
## <a name="rethinking-the-approach"></a>Пересмотр подхода  
*Номер закона восемь: сложность защиты сети прямо пропорциональна ее сложности.* - [10 непреложных законов по администрированию безопасности](https://technet.microsoft.com/library/cc722488.aspx)  
  
Как правило, это хорошо принимается, если злоумышленник получил доступ к компьютеру, администратору, корневому или эквивалентному ему, независимо от операционной системы, что этот компьютер больше не считается надежным, независимо от того, сколько усилий сделано для очистки системой. Active Directory не отличается. Если злоумышленник получил привилегированный доступ к контроллеру домена или учетной записи с высоким уровнем привилегий в Active Directory, если у вас нет записи о всех изменениях, которые создает злоумышленник, или на известной хорошей резервной копии, вы никогда не сможете полностью восстановить каталог. состояние доверия.  
  
При компрометации и изменении рядового сервера или рабочей станции компьютер больше не заслуживает доверия, но соседние нескомпрометированные серверы и рабочие станции все равно могут быть доверенными. Компрометация одного компьютера не означает, что все компьютеры скомпрометированы.  
  
Однако в домене Active Directory все контроллеры домена размещают реплики одной и той же AD DS базы данных. Если один контроллер домена скомпрометирован и злоумышленник изменяет AD DS базу данных, эти изменения реплицируются на каждый другой контроллер домена в домене и в зависимости от раздела, в котором сделаны изменения, в лесу. Даже если переустановить каждый контроллер домена в лесу, вы просто переустанавливаете узлы, на которых находится база данных AD DS. Вредоносные изменения Active Directory будут реплицироваться на недавно установленные контроллеры домена так же легко, как они будут реплицироваться на контроллеры домена, работающие в течение нескольких лет.  
  
В ходе оценки скомпрометированных сред мы обычно обнаружили, что, как было бы, что оно стало первым нарушением "Event", действительно было активировано по прошествии недель, месяцев или даже лет после того, как злоумышленники подверглись атакам в среде. Злоумышленники обычно получают учетные данные для высокопривилегированных учетных записей до обнаружения нарушения, а также используют эти учетные записи для нарушения безопасности каталога, контроллеров домена, рядовых серверов, рабочих станций и даже подключенных не в Windows x64.  
  
Эти выводы согласуются с несколькими результатами в отчете об исследовании нарушений данных Verizon 2012, в котором говорится, что:  
  
-   98 процентов нарушений данных из внешних агентов  
  
-   85 процентов нарушений данных заняло несколько недель или больше для обнаружения  
  
-   92% случаев обнаружено третьим лицом;  
  
-   97 процентов нарушений были предотвращены, несмотря на простые или промежуточные элементы управления.  
  
Нарушение степени, описанной выше, эффективно неустранимого, а стандартное рекомендуемое для "спрямления и перестроения" каждая скомпрометированная система просто нецелесообразна или даже невозможна, если Active Directory скомпрометирована или уничтожена. Даже восстановление до известного работоспособного состояния не устраняет недостатки, которые позволили бы снизить безопасность среды.  
  
Несмотря на то, что необходимо защищать все аспекты инфраструктуры, злоумышленнику нужно лишь найти достаточное количество уязвимостей в защите, чтобы получить необходимую цель. Если ваша среда относительно проста и поддерживаласьа и тщательно управляется, реализация рекомендаций, приведенных ранее в этом документе, может быть простым предложением.  
  
Однако мы обнаружили, что более старая, крупная и более сложная среда, тем более вероятно, что рекомендации в этом документе станут невозможными или даже невозможно реализовать. Обеспечение безопасности инфраструктуры становится намного сложнее, чем на самом деле, а с целью создания среды, устойчивой к атакам и компрометации. Но, как было сказано ранее, перестроение всего Active Directory леса не является небольшим задачей. По этим причинам рекомендуется использовать более специализированный ориентированный подход к защите Active Directory лесов.  
  
Вместо того, чтобы сосредоточиться на неисправностях и пытаться устранить все неработающие вещи, рассмотрите подход, в котором приоритет зависит от того, что важнее для вашего бизнеса и в вашей инфраструктуре. Вместо того, чтобы пытаться исправить среду, заполненную устаревшими, неправильно настроенными системами и приложениями, рассмотрите возможность создания новой небольшой защищенной среды, в которой можно безопасно перенести пользователей, системы и данные, которые наиболее важны для разделение.  
  
В этом разделе мы рассмотрим подход, с помощью которого можно создать поддерживалась AD DS лес, который служит в качестве срока жизни или защищенной ячейки для основной бизнес-инфраструктуры. Лес поддерживалась — это просто недавно установленный лес Active Directory, который обычно ограничен размером и областью действия, а также, который создается с помощью текущих операционных систем, приложений и принципов, описанных в разделе [уменьшение Active Directory уязвимой зоны](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md).  
  
Реализуя Рекомендуемые параметры конфигурации в новом составе леса, можно создать AD DSную установку, созданную с нуля с помощью защищенных параметров и методик, а также снизить сложность, связанную с поддержкой устаревших систем и приложений. Хотя подробные инструкции по проектированию и реализации установки поддерживалась AD DS выходят за рамки этого документа, необходимо следовать некоторым общим принципам и рекомендациям по созданию "защищенной ячейки", в которую можно разместить наиболее важные Основное. Ниже приведены эти рекомендации.  
  
1.  Выявление принципов разделения и защиты критически важных ресурсов.  
  
2.  Определите ограниченный план миграции на основе рисков.  
  
3.  Используйте "непереносимые" миграции, если это необходимо.  
  
4.  Реализуйте "творческое уничтожение".  
  
5.  Изолируйте устаревшие системы и приложения.  
  
6.  Упростите безопасность для конечных пользователей.  
  
### <a name="identifying-principles-for-segregating-and-securing-critical-assets"></a>Определение принципов разделения и защиты критически важных ресурсов  

Характеристики среды поддерживалась, создаваемой для размещения критически важных ресурсов, могут сильно различаться. Например, вы можете создать лес поддерживалась, в который будут перенесены только те пользователи виртуальных IP-адресов и конфиденциальные данные, к которым имеют доступ только пользователи. Вы можете создать лес поддерживалась, в котором вы перенесете не только пользователей виртуальных IP-адресов, но которые вы реализуете в качестве административного леса, реализуя принципы, описанные в разделе [сокращение Active Directory уязвимой области](../../../ad-ds/plan/security-best-practices/../../../ad-ds/plan/security-best-practices/Reducing-the-Active-Directory-Attack-Surface.md) для создания безопасных административных учетных записей и узлов, которые можно использовать для управления устаревшими лесами из леса поддерживалась. Вы можете реализовать лес, предназначенный для назначения, который содержит учетные записи виртуальных IP-адресов, привилегированные учетные записи и системы, требующие дополнительной защиты, такие как серверы, работающие Active Directory служб сертификации (AD CS), с единственной целью разделения их от менее безопасных. лесу. Наконец, вы можете реализовать лес поддерживалась, который станет местом де-факто для всех новых пользователей, систем, приложений и данных, что позволяет в конечном итоге списать устаревший лес через аттритион.  
  
Независимо от того, содержит ли лес поддерживалась несколько пользователей и систем или формирует базу для более агрессивной миграции, следует следовать этим принципам в планировании:  
  
1.  Предположим, что ваши устаревшие леса были скомпрометированы.  
  
2.  Не настраивайте среду поддерживалась для доверия к устаревшему лесу, хотя устаревшую среду можно настроить для доверия к лесу поддерживалась.  
  
3.  Не переносите учетные записи пользователей или группы из устаревшего леса в среду поддерживалась, если есть вероятность, что членство в группах, Журнал идентификаторов безопасности или другие атрибуты могут быть изменены злоумышленником. Вместо этого используйте "непереносимые" подходы для заполнения леса поддерживалась. (Подходы к непереносимости описаны далее в этом разделе.)  
  
4.  Не переносите компьютеры из устаревших лесов в поддерживалась леса. Реализуйте новые серверы в лесу поддерживалась, устанавливайте приложения на обновленных серверах и перенесите данные приложений в новые системы. Для файловых серверов скопируйте данные на обновленные установленные серверы, настройте списки управления доступом с помощью пользователей и групп в новом лесу, а затем создайте серверы печати аналогичным образом.  
  
5.  Не разрешите установку устаревших операционных систем или приложений в лесу поддерживалась. Если приложение не может быть обновлено и установлено заново, оставьте его в старом лесу и рассмотрите возможность творческого уничтожения, чтобы заменить функциональные возможности приложения.  
  
### <a name="defining-a-limited-risk-based-migration-plan"></a>Определение ограниченного плана миграции на основе рисков  
Создание ограниченного плана миграции на основе рисков просто означает, что при принятии решения о том, какие пользователи, приложения и данные будут перенесены в лес поддерживалась, следует определить цели миграции в зависимости от степени риска, в соответствии с которым Организация будет доступна, если одно из Пользователи или системы скомпрометированы. Пользователи виртуальных IP-адресов, учетные записи которых с наибольшей вероятностью будут использоваться злоумышленниками, должны быть размещены в лесу поддерживалась. Приложения, предоставляющие важнейшие бизнес-функции, должны быть установлены на новых серверах в лесу поддерживалась, а конфиденциальные данные должны быть перемещены на защищенные серверы в лесу поддерживалась.  
  
Если у вас еще нет четкой картины наиболее важных для бизнеса пользователей, систем, приложений и данных в среде Active Directory, то для их обнаружения следует работать с бизнес-подразделениями. Все приложения, необходимые для работы бизнеса, должны быть идентифицированы так, как если бы какие-либо серверы, на которых хранятся критические приложения, или важные данные. Определив пользователей и ресурсы, необходимые вашей организации для продолжения работы, вы создадите набор ресурсов с естественными приоритетами, на которых вы хотите сосредоточиться на своих усилиях.  
  
### <a name="leveraging-nonmigratory-migrations"></a>Использование "непереносимых" миграций  
Известно ли, что ваша среда была скомпрометирована, подозреваете, что она скомпрометирована, или просто предпочитаете не переносить устаревшие данные и объекты из устаревшей Active Directoryной установки в новую, рассмотрите подходы к миграции, которые не технически Перенесите объекты.  
  
### <a name="user-accounts"></a>"Ученые записи пользователей"  
В традиционном Active Directory миграции из одного леса в другой атрибут SIDHistory (журнал SID) для объектов User используется для хранения идентификатора безопасности пользователя и идентификаторов безопасности групп, в которые пользователи являлись членами в лесу прежних версий. Если учетные записи пользователей переносятся в новый лес и обращаются к ресурсам в старом лесу, идентификаторы SID в журнале SID используются для создания маркера доступа, который позволяет пользователям получить доступ к ресурсам, к которым у них есть доступ до переноса учетных записей.  
  
Однако поддержание журнала SID в некоторых средах доказано, так как заполнение маркеров доступа пользователей текущими и историческими идентификаторами SID может привести к чрезмерному появлению маркера. Неравномерное использование токенов является проблемой, при которой количество идентификаторов SID, которые должны храниться в маркере доступа пользователя, использует или превышает объем свободного места в маркере.  
  
Несмотря на то, что размеры токенов можно увеличить до ограниченного экстента, максимальная вероятность увеличения размера токенов заключается в уменьшении числа идентификаторов безопасности, связанных с учетными записями пользователей, от участия в группах рационализацию, за исключением журнала идентификаторов безопасности или их комбинации. Дополнительные сведения о чрезмерном появлении маркера см. в разделе [MaxTokenSize и токен Kerberos с чрезмерным](https://blogs.technet.com/b/shanecothran/archive/2010/07/16/maxtokensize-and-kerberos-token-bloat.aspx)использованием.  
  
Вместо того, чтобы выполнять миграцию пользователей из устаревшей среды (особенно в том случае, если членство в группах и журналы SID могут быть скомпрометированы) с помощью журнала SID, рассмотрите возможность использования приложений метакаталога для "переноса" пользователей без ведения журналов SID. в новый лес. При создании учетных записей пользователей в новом лесу можно использовать приложение метакаталога, чтобы сопоставлять учетные записи с соответствующими учетными записями в лесу прежних версий.  
  
Чтобы предоставить новым учетным записям пользователей доступ к ресурсам в лесу прежних версий, можно использовать инструментарий метакаталога для указания групп ресурсов, к которым были предоставлены устаревшие учетные записи пользователей, а затем добавить новые учетные записи пользователей в эти группы. В зависимости от стратегии групп в лесу прежних версий может потребоваться создать локальные группы домена для доступа к ресурсам или преобразовать существующие группы в локальные группы домена, чтобы разрешить добавление новых учетных записей в группы ресурсов. Прежде чем сосредоточиться на самых важных приложениях и данных и перенести их в новую среду (с журналом SID или без него), можно ограничить объем усилий в устаревшей среде.  
  

  
### <a name="servers-and-workstations"></a>Серверы и рабочие станции  
В традиционном переносе из одного Active Directory леса в другой, миграция компьютеров зачастую сравнительно проста по сравнению с миграцией пользователей, групп и приложений. В зависимости от роли компьютера миграция в новый лес может быть простой, как отсоединить старый домен и присоединиться к новому. Однако миграция учетных записей компьютеров в лес поддерживалась нарушает назначение новой среды. Вместо переноса (потенциально скомпрометированных, неправильно настроенных или устаревших) учетных записей компьютеров в новый лес необходимо в новой среде установить серверы и рабочие станции. Вы можете перенести данные из систем из старого леса в системы в лесу поддерживалась, но не в системы, в которых размещены данные.  
  
### <a name="applications"></a>Приложения  

Приложения могут представлять наиболее серьезную сложность при любом переносе из одного леса в другой, но в случае миграции с помощью непереносимого варианта одним из самых основных принципов является то, что приложения в лесу поддерживалась должны быть актуальными, поддерживаются и устанавливаются недавно. Данные могут быть перенесены из экземпляров приложения в старом лесу, где это возможно. В ситуациях, когда приложение не может быть воссоздано в лесу поддерживалась, следует рассмотреть такие подходы, как творческое уничтожение или изоляция устаревших приложений, как описано в следующем разделе.  
  
### <a name="implementing-creative-destruction"></a>Реализация творческого уничтожения  
Творческое уничтожение — это экономический термин, описывающий экономическое развитие, созданное при уничтожении предыдущих заказов. В последние годы этот термин был применен к информационной технологии. Как правило, он относится к механизмам, с помощью которых старая инфраструктура исключается, а не обновляется, но замена ее на что-то новое. 2011 [Gartner SYMPOSIUM иткспо](http://www.gartner.com/technology/symposium/orlando/) для руководителей и СТАРШих ИТ, которые были признаны творческими, представляют собой одну из ключевых тем, чтобы сократить расходы и повысить эффективность. Улучшения безопасности можно реализовать в виде естественного роста процесса.  

Например, Организация может состоять из нескольких подразделений, использующих различные приложения, которые выполняют аналогичные функции с различной степенью современного и поддержки поставщиков. Исторически это может быть ответственным за поддержание отдельного приложения подразделения отдельно, а усилия по консолидации состояли в попытках выяснить, какое приложение предлагает лучшие функции, а затем перенести данные в эти из других приложений.  
  
При творческом уничтожении вместо поддержки устаревших или избыточных приложений вы реализуете совершенно новые приложения для замены старого, переноса данных в новые приложения и списания старых приложений и систем, на которых они выполняются. В некоторых случаях можно реализовать творческое уничтожение устаревших приложений, развернув новое приложение в собственной инфраструктуре, но везде, где это возможно, следует рассмотреть возможность переноса приложения в облачное решение.  
  
Развертывая облачные приложения для замены устаревших внутренних приложений, вы не только сокращаете усилия и затраты на обслуживание, но снижаете вероятность атак, устраняя устаревшие системы и приложения, которые представляют уязвимости , чтобы злоумышленники можно было использовать. Такой подход обеспечивает более быстрый способ получения необходимой функциональности для Организации и одновременного удаления устаревших целей в инфраструктуре. Хотя принцип творческого уничтожения не относится ко всем ИТ-ресурсам, он предоставляет часто приемлемый вариант для устранения устаревших систем и приложений, одновременно развертывая надежные и безопасные облачные приложения.  
  
### <a name="isolating-legacy-systems-and-applications"></a>Изоляция устаревших систем и приложений  
Естественным росту миграции критически важных для бизнеса пользователей и систем на поддерживалась, безопасная среда заключается в том, что устаревший лес будет содержать менее ценные сведения и системы. Несмотря на то, что устаревшие системы и приложения, которые остаются в менее защищенной среде, могут представлять повышенный риск компрометации, они также представляют сниженную серьезность компрометации. Изменяя и модернизации важные бизнес-активы, вы можете сосредоточиться на развертывании эффективного управления и мониторинга, не используя устаревшие параметры и протоколы.  
  
После перенастройки важных данных в лес поддерживалась можно оценить параметры для дальнейшей изоляции устаревших систем и приложений в "основной" AD DS лесу. Несмотря на то, что вы можете реализовать творческое уничтожение для замены одного приложения и серверов, на которых оно выполняется, в других случаях может потребоваться дополнительная изоляция наименее защищенных систем и приложений. Например, приложение, которое используется несколькими пользователями, но для которого требуются устаревшие учетные данные, такие как хэши LAN Manager, можно перенести в небольшой домен, созданный для поддержки систем, для которых нет вариантов замены.  
  
Удаляя эти системы из доменов, в которых были принудительно реализованы устаревшие параметры, можно впоследствии повысить уровень безопасности доменов, настроив их для поддержки только текущих операционных систем и приложений. Несмотря на это, предпочтительнее выпустить устаревшие системы и приложения, когда это возможно. Если списание является просто нецелесообразным для небольшого сегмента устаревшей совокупности, разделение его на отдельный домен (или лес) позволяет выполнять добавочные улучшения в оставшейся части устаревшей установки.  
  
### <a name="simplifying-security-for-end-users"></a>Упрощение безопасности для конечных пользователей  
В большинстве организаций пользователи, имеющие доступ к наиболее конфиденциальным сведениям из-за особенностей их ролей в Организации, часто имеют наименее много времени для изучения сложных ограничений доступа и элементов управления. Хотя у вас должна быть комплексная программа по обеспечению безопасности для всех пользователей в Организации, необходимо также сосредоточиться на обеспечении безопасности как можно более простой, реализуя элементы управления, которые являются прозрачными и упрощают принципы работы пользователей. соответствовать.  
  
Например, вы можете определить политику, в которой руководители и другие виртуальные IP-адреса должны использовать защищенные рабочие станции для доступа к конфиденциальным данным и системам, что позволит им использовать другие устройства для доступа к менее конфиденциальным данным. Это простой принцип, который пользователи могут запомнить, но можно реализовать ряд серверных элементов управления, чтобы обеспечить применение этого подхода.  

Вы можете использовать [механизм проверки подлинности](https://technet.microsoft.com/library/dd391847(v=WS.10).aspx) для предоставления пользователям доступа к конфиденциальным данным только в том случае, если они входили в защищенные системы с помощью смарт-карт, и могут использовать IPSec и ограничения прав пользователя для управления системами, с которых они могут подключаться к конфиденциальным хранилищам данных. Вы можете использовать [набор средств классификации данных Майкрософт](https://www.microsoft.com/download/details.aspx?id=27123) для создания надежной инфраструктуры классификации файлов, а также реализовать [Динамическое управление доступом](https://blogs.technet.com/b/windowsserver/archive/2012/05/22/introduction-to-windows-server-2012-dynamic-access-control.aspx) для ограничения доступа к данным на основе характеристик попытки доступа, преобразования бизнес-правил в технические элементы управления.  
  
С точки зрения пользователя, доступ к конфиденциальным данным из защищенной системы "просто работает" и попытка сделать это из незащищенной системы "просто нет". Однако с точки зрения мониторинга и управления средой вы помогаете создавать идентифицируемые шаблоны в том, как пользователи обращаются к конфиденциальным данным и системам, что упрощает обнаружение аномальных попыток доступа.  
  
В средах, в которых пользователь применяет длительные атаки, сложные пароли приводят к недостаточным политикам паролей, особенно для пользователей виртуальных IP-адресов, рассмотрите альтернативные подходы к проверке подлинности, будь то через Интеллектуальные карты (которые поставляются с несколькими конструктивными факторами и с дополнительными функциями для усиления проверки подлинности), биометрические элементы управления, такие как считывание пальцами, или даже данные проверки подлинности, защищенные микросхемами доверенного платформенного модуля (TPM) на компьютерах пользователей. Хотя многофакторная проверка подлинности не мешает атакам кражи учетных данных, если компьютер уже скомпрометирован, предоставление пользователям удобных средств проверки подлинности позволяет назначать более надежные пароли учетным записям пользователей, для которых обычный пользователь элементы управления "имя" и "пароль" неудобно.  
