---
ms.assetid: 65ed5956-6140-4e06-8d99-8771553637d1
title: "Понижение уровня контроллеров домена и доменов (уровень 200)"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: c254a01da5534c1ddc673bc1e60382c166ddeda7
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="demoting-domain-controllers-and-domains-level-200"></a>Понижение уровня контроллеров домена и доменов (уровень 200)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе объясняется, как для удаления AD DS с помощью диспетчера серверов или Windows PowerShell.  
  
-   [Процесс удаления AD DS](../../ad-ds/deploy/Demoting-Domain-Controllers-and-Domains--Level-200-.md#BKMK_Workflow)  
  
-   [Понижение и удаление роли Windows с помощью PowerShell](../../ad-ds/deploy/Demoting-Domain-Controllers-and-Domains--Level-200-.md#BKMK_PS)  
  
-   [Понижение уровня](../../ad-ds/deploy/Demoting-Domain-Controllers-and-Domains--Level-200-.md#BKMK_Demote)  
  
## <a name="BKMK_Workflow"></a>Процесс удаления AD DS  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/adds_demotedomainforest.png)  
  
> [!CAUTION]  
> Удаление ролей AD DS с помощью Dism.exe или модуля Windows PowerShell DISM после повышения роли до контроллера домена не поддерживается и не позволит сервер перестает загружаться нормально.  
>   
> В отличие от диспетчера сервера или модуля ADDSDeployment для Windows PowerShell DISM — это собственная система обслуживания, которая не распознает AD DS или их конфигурацию. Не используйте Dism.exe или модуля Windows PowerShell DISM для удаления роли AD DS, если сервер больше не является контроллером домена.  
  
## <a name="BKMK_PS"></a>Понижение и удаление роли Windows с помощью PowerShell  
  
|||  
|-|-|  
|**Командлеты ADDSDeployment и ServerManager**|Аргументы (**Полужирный** требуются аргументы. *Курсивом* аргументов можно указать с помощью Windows PowerShell или мастера настройки AD DS.)|  
|Uninstall-AddsDomainController|-SkipPreChecks<br /><br />*-LocalAdministratorPassword*<br /><br />-Подтверждения<br /><br />***-Credential***<br /><br />-DemoteOperationMasterRole<br /><br />*-DNSDelegationRemovalCredential*<br /><br />-Force<br /><br />*-ForceRemoval*<br /><br />*-IgnoreLastDCInDomainMismatch*<br /><br />*-IgnoreLastDNSServerForZone*<br /><br />*-LastDomainControllerInDomain*<br /><br />-Norebootoncompletion<br /><br />*-RemoveApplicationPartitions*<br /><br />*-RemoveDNSDelegation*<br /><br />-RetainDCMetadata|  
|Удаление WindowsFeature/Remove-WindowsFeature|***-Имя***<br /><br />***-IncludeManagementTools***<br /><br />*-Перезапуска*<br /><br />-Remove<br /><br />-Force<br /><br />-ComputerName<br /><br />-Credential<br /><br />-LogPath<br /><br />-Vhd|  
  
> [!NOTE]  
> **-Credential** аргумент доступен только требуется, если вы уже вошли на как член группы администраторов предприятия (при понижении роли последнего контроллера домена в домене) или группы администраторов домена (при понижении роли реплики контроллера домена DC).The **- includemanagementtools** только требуется, если вы хотите удалить все служебные программы управления AD DS.  
  
## <a name="BKMK_Demote"></a>Понижение уровня  
  
### <a name="remove-roles-and-features"></a>Удаление ролей и компонентов  
В диспетчере сервера имеется два интерфейса для удаления роли доменных служб Active Directory:  
  
-   **Управление** меню на главной информационной панели, с помощью **удалить роли и компоненты**  
  
 ![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_Manage.png)  
  
-   Нажмите кнопку **AD DS** или **все серверы** на панели навигации. Прокрутите вниз до **роли и компоненты** раздела. Щелкните правой кнопкой мыши **доменных служб Active Directory** в **роли и компоненты** списке и нажмите кнопку **удалить роль или компонент **. Этот интерфейс пропускает **Выбор сервера** страницы.  
  
 ![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_ServerSelection.png)  
  
Командлеты ServerManager **Uninstall-WindowsFeature** и **Remove-WindowsFeature** не позволяют удалить роль AD DS, пока не будет понижена роль контроллера домена.  
  
### <a name="server-selection"></a>Выбор сервера  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_ServerSelection2.png)  
  
**Выбор сервера** диалоговое окно позволяет выбрать один из серверов, ранее добавленных в пул, как оно доступно. Локальный сервер диспетчер сервера доступен всегда.  
  
### <a name="server-roles-and-features"></a>Роли и компоненты сервера  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_ServerRoles.png)  
  
Очистить **доменных служб Active Directory** флажок, чтобы понизить роль контроллера домена; Если сервер в настоящее время является контроллером домена, это не удаляется роли AD DS, а вместо этого переключается на **результаты проверки** диалоговое окно с предложением понизить роль. В противном случае, он просто двоичные файлы удаляются так же, как любые другие роли.  
  
-   Не удаляйте любые другие AD DS связанных ролей или компоненты, такие как DNS, консоль управления групповыми Политиками или средства удаленного администрирования сервера - Если вы планируете немедленно повысить роль контроллера домена. Удаление дополнительных ролей и компонентов увеличивает время, необходимое для повторного повышения роли, так как диспетчер сервера повторно устанавливает их при переустановке роли.  
  
-   Если вы планируете понизить роль контроллера домена навсегда, удалите ненужные роли AD DS и компоненты по собственному усмотрению. Для этого необходимо снять флажки для этих ролей и компонентов.  
  
    Полный список AD DS связанных ролей и компонентов:  
  
    -   Функции Active Directory модуль для Windows PowerShell  
  
    -   AD DS средства и AD LDS  
  
    -   Центр администрирования Active Directory  
  
    -   AD DS оснастки и программы командной строки  
  
    -   DNS-сервера  
  
    -   Консоль управления групповыми политиками  
  
Эквивалентные командлеты модулей ADDSDeployment и ServerManager Windows PowerShell являются:  
  
```  
Uninstall-addsdomaincontroller  
Uninstall-windowsfeature  
  
```  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_RemoveFeatures.png)  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_Demote.png)  
  
### <a name="credentials"></a>Учетные данные  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_Credentials.png)  
  
Параметры понижения уровня настраиваются на **учетные данные** страницы. Учетные данные, необходимые для понижения уровня из следующего списка:  
  
-   Для понижения уровня дополнительного контроллера домена требуются учетные данные администратора домена. Выбор **принудительно удалить контроллер домена** можно понизить уровень контроллера домена без удаления метаданных объекта контроллера домена из Active Directory.  
  
    > [!WARNING]  
    > Не выбирайте этот параметр, если контроллер домена не удается связаться с другими контроллерами домена и *нет другого способа* чтобы разрешить эту сетевую проблему. Принудительное понижение уровня оставляет потерянные метаданные в Active Directory на оставшихся контроллерах домена в лесу. Кроме того все нереплицированные изменения на этом контроллере домена, например пароли и новые учетные записи пользователей, навсегда теряются. Потерянные метаданные — это основная причина обращения в значительный процент обращений в службу поддержки пользователей Майкрософт AD DS, Exchange, SQL и другого программного обеспечения.  
    >   
    > При принудительном понижении уровня контроллера домена, вы *необходимо* вручную немедленно почистить метаданные. Действия, просмотрите [Очистка метаданных сервера](https://technet.microsoft.com/library/cc816907(WS.10).aspx).  
  
   ![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_ForceDemote.png)  
  
-   Понижение роли последнего контроллера домена в домене требуется членство в группе администраторов предприятия, так как при этом удаляется сам домен (если это последний домен леса, при этом удаляется лес). Диспетчер сервера сообщает, если текущий контроллер домена является последний контроллер домена в домене. Выберите **последний контроллер домена в домене** флажок, чтобы подтвердить контроллер домена является последний контроллер домена в домене.  
  
Эквивалентные аргументы ADDSDeployment Windows PowerShell являются:  
  
```  
-credential <pscredential>  
-forceremoval <{ $true | false }>  
-lastdomaincontrollerindomain <{ $true | false }>  
  
```  
  
### <a name="warnings"></a>Предупреждения  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_Warnings.png)  
  
**Предупреждения** страницы предупреждают о возможных последствиях удаления контроллера домена. Чтобы продолжить, необходимо выбрать **продолжить удаление**.  
  
> [!WARNING]  
> Если ранее был выбран **принудительно удалить контроллер домена** на **учетные данные** страницы, а затем **предупреждения** страницы показаны все роли гибкого одним хозяина операций, размещенные на этом контроллере домена. Вы *необходимо* захватить роли с другого контроллера домена *немедленно* после понижения роли этого сервера. Дополнительные сведения о захвате ролей FSMO см. в разделе [захват роли хозяина операций](https://technet.microsoft.com/library/cc816779(WS.10).aspx).  
  
На этой странице нет эквивалентного аргумента ADDSDeployment Windows PowerShell.  
  
### <a name="removal-options"></a>Параметры удаления  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_ReviewOptions.png)  
  
**Параметры удаления** страница появляется в зависимости от выбора ранее **последний контроллер домена в домене** на **учетные данные** страницы. На этой странице можно настроить дополнительные параметры удаления. Выберите **пропустить последний DNS-сервер для зоны**, **удалить разделы приложений**, и **удалить делегирования DNS** для предоставления доступа к **Далее** кнопки.  
  
Параметры выводятся, только если это применимо к этому контроллеру домена. Например если делегирование DNS для этого сервера не затем, соответствующий флажок не отображаются.  
  
Нажмите кнопку **изменение** чтобы указать альтернативные учетные данные администратора, DNS-сервера. Нажмите кнопку **Просмотр разделов** для просмотра дополнительных разделов, которые мастер удалит во время понижения роли. По умолчанию единственными дополнительными разделами являются зоны DNS леса домена и DNS. Все остальные разделы не относятся к Windows.  
  
Аргументы командлета ADDSDeployment, эквивалентные являются:  
  
```  
-ignorelastdnsserverforzone <{ $true | false }>  
-removeapplicationpartitions <{ $true | false }>  
-removednsdelegation <{ $true | false }>  
-dnsdelegationremovalcredential <pscredential>  
```  
  
### <a name="new-administrator-password"></a>Новый пароль администратора  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_NewAdminPwd.png)  
  
**Новый пароль администратора** странице необходимо указать пароль для учетной записи администратора встроенных локального компьютера, после завершения понижения роли, и компьютер стал рядовым сервером домена или компьютером рабочей группы.  
  
**Uninstall-ADDSDomainController** командлет и аргументы выполните того же значения по умолчанию в диспетчере сервера, если не указано.  
  
**LocalAdministratorPassword** аргумент специальные:  
  
-   Если *не указан* в качестве аргумента, командлет предлагает ввести и подтвердить Скрытый пароль. Это предпочтительный вариант использования при интерактивном выполнении командлета.  
  
-   Если указан *со значением*, то значение должно быть защищенной строкой. Это не является предпочтительным при интерактивном выполнении командлета.  
  
Например, можно вручную ввести запрос пароля с помощью **Read-Host** командлету предложить пользователю ввести защищенную строку  
  
```  
-localadministratorpassword (read-host -prompt "Password:" -assecurestring)  
  
```  
  
> [!WARNING]  
> Поскольку в предыдущих вариантах пароль не подтверждается, соблюдайте повышенную осторожность: пароль невидим.  
  
Можно также ввести защищенную строку в переменной с преобразованным открытым текстом, хотя это не рекомендуется. Например:  
  
```  
-localadministratorpassword (convertto-securestring "Password1" -asplaintext -force)  
  
```  
  
> [!WARNING]  
> Ввод или хранение пароля в виде открытого текста не рекомендуется. Любой пользователь, выполняющий эту команду в сценарии или заглядывающий через ваше плечо, сможет узнать пароль локального администратора этого компьютера. Зная пароль они имеют доступ ко всем данным на нем и сможет персонифицировать сам сервер.  
  
### <a name="confirmation"></a>Подтверждение  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_Confirmation.png)  
  
**Подтверждения** странице отображается описание запланированного понижения роли; страницы не содержит параметры конфигурации понижения уровня. Это последняя страница мастера, отображаемая перед началом понижения роли. Кнопку "просмотреть сценарий" создается сценарий понижения роли Windows PowerShell.  
  
Нажмите кнопку **понизить уровень** для выполнения следующего командлета развертывания AD DS:  
  
```  
Uninstall-DomainController  
  
```  
  
Используйте дополнительный **Whatif** аргумент с **Uninstall-ADDSDomainController** для просмотра сведений о конфигурации. Это позволяет просмотреть явные и неявные значения аргументов командлета.  
  
Например:  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstall.png)  
  
Запрос на перезапуск это последняя возможность отменить эту операцию при использовании ADDSDeployment Windows PowerShell. Чтобы подавить этот запрос, используйте **-принудительно** или **подтверждение: $false** аргументы.  
  
### <a name="demotion"></a>Понижение уровня  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_Demotion.png)  
  
Когда **понижения роли** отображает страницу, конфигурации контроллера домена начинается и невозможно остановить или отменить. Подробная информация об операциях выводится на этой странице и записи в журналы:  
  
-   %systemroot%\debug\dcpromo.log  
  
-   %systemroot%\debug\dcpromoui.log  
  
Так как **Uninstall-AddsDomainController** и **Uninstall-WindowsFeature** только по одному действию каждый, они показаны здесь на этапе подтверждения с минимальным необходимым набором аргументов. Нажмите клавишу ВВОД запускается процесс понижения и перезагружает компьютер.  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstallConfirm.png)  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstallWindowsFeature.png)  
  
Чтобы напоминание о перезагрузке автоматически, используйте **-принудительно** или **-подтверждение: $false** аргументы с любым командлетом ADDSDeployment Windows PowerShell. Чтобы предотвратить автоматическую перезагрузку по завершении повышения роли сервера, используйте **- norebootoncompletion: $false** аргумент.  
  
> [!WARNING]  
> Отключать перезагрузку не рекомендуется. Для правильной работы рядовой сервер должен перезагрузиться.  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstallFinished.png)  
  
Вот пример принудительного понижения с его минимальным необходимым набором аргументов: **- forceremoval** и **- demoteoperationmasterrole**. **-Credential** аргумент не является обязательным, поскольку пользователь выполнил вход как член группы администраторов предприятия:  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstallExampleForce.png)  
  
Ниже приведен пример удаления последнего контроллера домена в домене, используя его минимальным необходимым набором аргументов: **- lastdomaincontrollerindomain** и **- removeapplicationpartitions**:  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstallExampleLastDC.png)  
  
Если вы попытаетесь удалить роль Доменных службах Active Directory перед понижением роли сервера, среда Windows PowerShell блокирует сообщение о внутренней ошибке:  
  
```  
Uninstall-WindowsFeature : An uninstallation prerequisite step failed duringthe removal of AD-Domain-Services, and uninstallation cannot continue.1. The domain controller needs to be demoted before the Active DirectoryDomain Services Role can be uninstalled.  
```  
  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_PSUninstallError.png)  
  
> [!IMPORTANT]  
> Необходимо перезапустить компьютер после понижения роли сервера, прежде чем удалить двоичные файлы роли доменных служб AD.  
  
### <a name="results"></a>Результаты  
![Понижение роли контроллера домена](media/Demoting-Domain-Controllers-and-Domains--Level-200-/ADDS_RRW_TR_DemoteSignoff.png)  
  
**Результатов** странице отображается успешном или неудачном повышение роли, а также все важные данные администратора. Контроллер домена автоматически перезагрузится через 10 секунд.  
  

