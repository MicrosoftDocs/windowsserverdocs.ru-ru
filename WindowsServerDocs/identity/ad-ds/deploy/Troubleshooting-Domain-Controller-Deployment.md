---
ms.assetid: 5ab76733-804d-4f30-bee6-cb672ad5075a
title: "Устранение неполадок развертывания контроллера домена"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: 254209b0da6a7bc0cd5f3880e14a7e5b16822cdd
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="troubleshooting-domain-controller-deployment"></a>Устранение неполадок развертывания контроллера домена

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе подробно рассматривается методика устранения неполадок, связанных с конфигурацией контроллеров домена и развертывания.  
  
-   [Общие сведения об устранении неполадок](../../ad-ds/deploy/Troubleshooting-Domain-Controller-Deployment.md#BKMK_Intro)  
  
-   [Способы устранения неполадок](../../ad-ds/deploy/Troubleshooting-Domain-Controller-Deployment.md#BKMK_Options)  
  
## <a name="BKMK_Intro"></a>Общие сведения об устранении неполадок  
![Устранение неполадок](media/Troubleshooting-Domain-Controller-Deployment/adds_deploy_troubleshooting.png)  
  
## <a name="BKMK_Options"></a>Способы устранения неполадок  
  
### <a name="logging-options"></a>Параметры ведения журнала  
Встроенные журналы — это самый важный инструмент устранения неполадок, связанных с повышением роли контроллера домена и понижения роли. Все эти журналы включены и настроена максимальная степень подробности по умолчанию.  
  
|Этап|Журнал|  
|---------|-------|  
|Операции с диспетчером сервера или ADDSDeployment Windows PowerShell|-%systemroot%\debug\dcpromoui.log<br /><br />-%systemroot%\debug\dcpromoui*.log|  
|Установка или повышение роли контроллера домена|-%systemroot%\debug\dcpromo.log<br /><br />-%systemroot%\debug\dcpromo*.log<br /><br />-Просмотр событий\журналы windows\система событий<br /><br />-Просмотр событий\журналы windows\приложение событий<br /><br />-Событие Просмотр событий\журналы приложений и Служб\служба каталогов<br /><br />-Событие Просмотр событий\журналы приложений и служб\Служба репликации<br /><br />-Событие Просмотр событий\журналы приложений и служб\репликация DFS|  
|Обновление леса или домена|-%systemroot%\debug\adprep\\<datetime>\adprep.log<br /><br />-%systemroot%\debug\adprep\\<datetime>\csv.log<br /><br />-%systemroot%\debug\adprep\\<datetime>\dspecup.log<br /><br />-%systemroot%\debug\adprep\\<datetime>\ldif.log*|  
|Модуль развертывания Windows PowerShell ADDSDeployment диспетчера сервера|-Событие Просмотр событий\журналы приложений и служб служб\microsoft\windows\directoryservices Deployment\Operational|  
|Обслуживания Windows|-%systemroot%\Logs\CBS\\*<br /><br />-%systemroot%\servicing\sessions\sessions.xml<br /><br />-%systemroot%\winsxs\poqexec.log<br /><br />-%systemroot%\winsxs\pending.xml|  
  
### <a name="tools-and-commands-for-troubleshooting-domain-controller-configuration"></a>Средства и команды для диагностики конфигурации контроллера домена  
Чтобы диагностировать не поясненные в журналах проблемы, используйте следующие средства в качестве отправной точки:  
  
-   Dcdiag.exe  
  
-   Repadmin.exe  
  
-   [AutoRuns.exe](https://technet.microsoft.com/sysinternals/bb963902.aspx), диспетчер задач и MSInfo32.exe  
  
-   [Network Monitor 3.4](https://www.microsoft.com/download/en/details.aspx?displaylang=en&id=4865) (или средство отслеживания и анализа сети сторонних производителей)  
  
### <a name="general-methodology-for-troubleshooting-domain-controller-configuration"></a>Общая методология диагностики конфигурации контроллера домена  
  
1.  Вызвала ли простой синтаксис неточность ошибка?  
  
    1.  Ли вы допустили или забудьте предоставить аргумента ADDSDeployment Windows PowerShell? Например, если с помощью ADDSDeployment Windows PowerShell, возможно, вы забыли добавить обязательный аргумент **- domainname** с допустимым именем?  
  
    2.  Проверьте выходные данные в консоли Windows PowerShell тщательно, чтобы увидеть, точно почему не удается разобрать введенную команду.  
  
2.  Связана ли ошибка с невыполнением?  
  
    1.  Многие ошибки, которые отображались Неустранимая повышения роли теперь предотвращаются средством проверки готовности к установке.  
  
    2.  Текст готовности к установке ошибки тщательно изучите, они приводятся необходимые инструкции по устранению большинства проблем, являющихся контролируемыми сценариями.  
  
3.  Связана ли ошибка с повышением роли и поэтому является неустранимой?  
  
    1.  Тщательно изучите результаты: многие ошибки объясняются просто, например неправильными паролями, с разрешением сетевых имен или критически важных автономного контроллеров домена.  
  
    2.  Проверьте Dcpromoui.log и dcpromo.log, наличие ошибок, указанных в выходных данных, и, отталкиваясь от них, попытайтесь найти указания на то, почему произошел сбой.  
  
        1.  Всегда выполняйте сравнение с рабочим журналом  
  
        2.  Обратитесь к журналам ADPrep для ошибок, только в том случае, если результаты указывают на проблемы, в расширением схемы или подготовкой леса или домена.  
  
        3.  Просмотрите журнал событий DirectoryServices-Deployment ошибок, только в том случае, если Dcpromoui.log отсутствуют подробные сведения или он внезапно прерывается из-за необработанного исключения в процессе настройки.  
  
    3.  Просмотрите журналы событий служб каталогов, системы и приложения для других индикаторов проблемы с конфигурацией. Во многих случаях повышение роли контроллера домена — это Симптом других ошибок в конфигурации сети, могут влиять на все распределенные системы.  
  
    4.  Используйте dcdiag.exe и repadmin.exe, чтобы проверить общую работоспособность леса и выявить неявные ошибки в конфигурации, могут препятствовать повышению роли контроллера домена.  
  
    5.  Чтобы проверить компьютер на наличие стороннего программного обеспечения, которое может мешать используйте AutoRuns.exe, MSinfo32.exe или диспетчер задач.  
  
        1.  Удалите стороннее программное обеспечение (просто отключить программное обеспечение; не может помешать драйверы продолжат загружаться).  
  
    6.  Установите сетевой монитор версии 3.4 на компьютере, на котором не удается повысить роль контроллера домена партнера репликации и проанализируйте процесс повышения роли с помощью записей двухстороннего сетевого мониторинга.  
  
        1.  Сравните эти данные с рабочей лабораторной среды, чтобы понять, как выглядит выполняться успешное повышение роли и где происходит сбой.  
  
        2.  На этом этапе ошибки, скорее всего, с объектами леса, изменения нестандартные безопасности или сетью, и этот новый контроллер домена является жертвой неверные настройки в DNS, брандмауэров, программного обеспечения защиты от вторжения узла или иными внешними факторами.  
  
### <a name="troubleshooting-specific-problems"></a>Диагностика определенных проблем  
  
#### <a name="events-and-error-messages"></a>События и сообщения об ошибках  
Повышение роли контроллера домена или понижения всегда возвращается код, по завершении операции и в отличие от большинства программ, не равен нулю в случае успешного выполнения. Чтобы просмотреть код результата настройки контроллера домена, у вас есть несколько вариантов:  
  
1.  При использовании диспетчера сервера изучите результат повышения роли десять секунд перед автоматической перезагрузкой.  
  
2.  При использовании ADDSDeployment Windows PowerShell, изучите результат повышения роли отображается десять секунд перед автоматической перезагрузкой. Кроме того выберите автоматическую перезагрузку по завершении операции. Следует добавить **Format-List** конвейера, чтобы сделать выходные данные более удобными для восприятия. Например:  
  
    ```  
    Install-addsdomaincontroller <options> -norebootoncompletion:$true | format-list  
  
    ```  
  
    Выявлены перезагрузки, не производится ошибки при проверке необходимых условий, поэтому они доступны во всех случаях. Например:  
  
  ![Устранение неполадок](media/Troubleshooting-Domain-Controller-Deployment/ADDS_PSPrereqError.png)  
  
3.  В любом сценарии изучите dcpromo.log и dcpromoui.log.  
  
    > [!NOTE]  
    > Некоторые из перечисленных ниже ошибок больше не возможны из-за операционной системы и домена контроллера изменений в более поздних операционных системах. Новые коды ADDSDeployment Windows PowerShell также позволяет избежать определенных ошибок, а dcpromo.exe//unattend нет; Это еще одна убедительная причина для перехода с автоматизации устаревшего средства DCPromo на ADDSDeployment Windows PowerShell.  
  
Операции повышения и понижения роли возвращают успех следующие коды.  
  
|Код ошибки|Объяснение|Примечание|  
|--------------|---------------|--------|  
|1|Выход, успешное выполнение|По-прежнему должен перезагрузиться, это указывает на том, что флаг автоматической перезагрузки был снят|  
|2|Выход, успешное выполнение, необходимо выполнить перезагрузку||  
|3|Выход, успешное выполнение с некритическим сбоем|Обычно появляется при получении предупреждения о делегировании DNS. Если делегирование DNS не настраивается, используйте:<br /><br />-creatednsdelegation: $false|  
|4|Выход, успешное выполнение с некритическим сбоем, необходимо выполнить перезагрузку|Обычно появляется при получении предупреждения о делегировании DNS. Если делегирование DNS не настраивается, используйте:<br /><br />-creatednsdelegation: $false|  
  
Операции повышения и понижения роли возвращают указанные ниже ошибок коды сообщений. Существует также может быть расширенное сообщение об ошибке; всегда читайте все сообщение, не только числовой код.  
  
|Код ошибки|Объяснение|Рекомендуемое решение|  
|--------------|---------------|------------------------|  
|11|Повышение роли контроллера домена уже выполняется|Не выполняйте более одной операции повышения роли контроллера домена, в то же время для одного целевого компьютера|  
|12|Пользователь должен быть администратором|Вход в систему как член встроенной группы администраторов и убедитесь, что вы с контролем учетных Записей|  
|13|Установлен центр сертификации|Нельзя понизить роль этого контроллера домена, как он является центром сертификации. Не удаляйте ЦС, проверив тщательно, его использование - если он выдает сертификаты, удаление роли приведет к прерыванию работы. Устанавливать ЦС на контроллерах домена не рекомендуется.|  
|14|В режиме безопасной загрузки|Загрузите сервер в обычном режиме|  
|15|Изменение роли выполняется или требует перезагрузки|Необходимо перезапустить сервер (из-за предыдущих изменений в конфигурации) перед повышением роли|  
|16|Запуск на неверной платформе|*Вероятность этой ошибки*|  
|17|Нет дисков NTFS 5|Эта ошибка невозможна в Windows Server 2012, который требуется по крайней мере диск % systemdrive % файловой системой NTFS|  
|18|Недостаточно места в windir|Освободите место на томе % systemdrive % с помощью cleanmgr.exe|  
|19|Ожидание смены имени, требуется перезагрузка|Перезагрузите сервер.|  
|20|Имя компьютера имеет недопустимый синтаксис|Присвойте компьютеру допустимое имя.|  
|21|Этот контроллер домена имеет роли FSMO, является глобальным Каталогом и/или DNS-сервера|Добавить **- demoteoperationmasterrole** при использовании **- forceremoval**.|  
|22|TCP/IP должен быть установлен или не работает|Убедитесь, что компьютер имеет TCP/IP настроен, привязан и работает правильно.|  
|23|Необходимо сначала настроить DNS-клиент|При добавлении нового контроллера домена домена задайте основной DNS-сервер|  
|24|Предоставленные учетные данные, недействительны или не содержат необходимых элементов|Проверьте правильность имени пользователя и пароля|  
|25|Не удается найти контроллер домена для указанного домена|Проверьте параметры DNS-клиента, правила брандмауэра|  
|26|Не удалось прочесть список доменов в лесу|Проверьте параметры DNS-клиента, функциональность LDAP и правила брандмауэра|  
|27|Отсутствует имя домена|При повышении или понижении роли Укажите домен.|  
|28|Неправильное доменное имя|При повышении роли выберите другое, допустимое имя домена DNS|  
|29|Родительский домен не существует.|Проверьте родительский домен, указанный при создании нового дочернего домена или домена дерева|  
|30|Домен не входит в лес|Проверьте указанное имя домена.|  
|31|Дочерний домен уже существует|Укажите другое доменное имя.|  
|32|Неверное имя домена NetBIOS|Укажите допустимое доменное имя NetBIOS|  
|33|Недопустимый путь к файлам IFM|Проверьте путь к папке установки с носителя|  
|34|База данных IFM|Используйте правильный установки с носителя для этой операционной системы и роли (версия операционной системы и тип контроллера домена — RODC или rwdc — должны Совпадать)|  
|35|Отсутствует SYSKEY|Папка установки с носителя зашифрована и необходимо указать действительный ключ SYSKEY его использовать|  
|37|Недопустимый путь к базе данных NTDS или ее журналам|Изменить путь к базе данных и журналам фиксированному тому NTFS, а не подключенный диск или UNC-путь|  
|38|Том не имеет достаточно места для базы данных NTDS или ее журналов|Освободите место с помощью cleanmgr.exe, увеличьте дисковое пространство, освободите место вручную, переместив ненужные данные в другое место|  
|39|Недопустимый путь к SYSVOL|Изменить путь к папке SYSVOL к фиксированному тому NTFS, а не подключенный диск или UNC-путь|  
|40|Недопустимое имя сайта|Укажите существующее имя сайта|  
|41|Необходимо указать пароль для безопасного режима|Укажите пароль для учетной записи DSRM, он не может быть пустым вне зависимости от того, как настроена политика паролей|  
|42|Пароль безопасного режима не отвечает условиям (только при повышении роли)|Укажите пароль для учетной записи DSRM, отвечающий правилам, настроенным для политики паролей.|  
|43|Пароль администратора не отвечает условиям (только при понижении роли)|Укажите пароль для учетной записи локального администратора, который соответствует требованиям политики паролей, настроенным правила|  
|44|Недопустимый указанное имя для леса|Укажите имя домена DNS для корневого допустимый лес|  
|45|Лес с указанным именем уже существует|Выберите имя домена DNS для корневого другого леса|  
|46|Недопустимый указанное имя для дерева|Укажите допустимое дерево DNS-имя домена|  
|47|Дерево с указанным именем уже существует|Выберите доменное имя DNS другое дерево|  
|48|Имя дерева не соответствует структуре леса|Выберите доменное имя DNS другое дерево|  
|49|Указанный домен не существует.|Проверьте введенное доменное имя.|  
|50|При понижении роли последнего контроллера домена обнаружена даже в том случае, если нет, или последний контроллер домена был указан, но это не так|Не указывайте **последний контроллер домена в домене** (**- lastdomaincontrollerindomain**), если он имеет значение true. Используйте **- ignorelastdcindomainmismatch** для переопределения, если это действительно последний контроллер домена, а фантомные метаданные контроллера домена|  
|51|На этом контроллере домена есть разделы приложений|Укажите для **удалить разделы приложений** (**- removeapplicationpartitions**)|  
|52|Пропущен обязательный аргумент командной строки (то есть файл ответов должен быть в командной строке указать)|*Появляется только при dcpromo//unattend, который является устаревшим. См. документацию к предыдущим версиям*|  
|53|Повышение или понижение роли не удается, компьютер необходимо перезагрузить для очистки|Изучите расширенное сообщение об ошибке и журналы.|  
|54|Повышение или понижение роли не удалось|Изучите расширенное сообщение об ошибке и журналы.|  
|55|Повышение или понижение роли было отменено пользователем|Изучите расширенное сообщение об ошибке и журналы.|  
|56|Повышение или понижение роли было отменено пользователем, для очистки компьютер необходимо перезагрузить|Изучите расширенное сообщение об ошибке и журналы.|  
|58|При повышении роли RODC необходимо указать имя сайта.|Необходимо указать сайт для RODC, не обнаруживается автоматически, как rwdc — должны Совпадать|  
|59|При понижении роли контроллер домена является последним DNS-сервером для одной из зон|Укажите, что это **последним DNS-сервером в домене** или использовать **- ignorelastdnsserverfordomain**|  
|60|Для повышения роли контроллера RODC в домене должен быть контроллер домена под управлением Windows Server 2008 или более поздней версии|Продвижения по крайней мере один Windows Server 2008 или более поздней версии модели контроллера домена для записи|  
|61|Не удается установить доменные службы Active Directory с DNS в существующем домене, который не содержит DNS|*Эта ошибка произойти не может*|  
|62|Файле ответов отсутствует секция [DCInstall]|*Появляется только при dcpromo//unattend, который является устаревшим. См. документацию к предыдущим версиям.*|  
|63|Функциональный уровень леса не ниже windows server 2003|По крайней мере повысить режим работы леса до Windows Server 2003 собственный. Windows 2000 и Windows NT 4.0 больше не поддерживаемых операционных систем|  
|64|Не удалось повысить уровень из-за сбоя обнаружены двоичные файлы компонентов|Установка роли AD DS|  
|65|Не удалось повысить уровень из-за сбоя установки двоичных файлов компонентов|Установка роли AD DS|  
|66|Не удалось повысить уровень из-за сбоя определения операционной системы.|Изучите расширенное сообщение об ошибке и журналы; сервер не возвращает версию операционной системы. Вполне вероятно, компьютер потребуется переустановить, как его общая работоспособность под большим подозрением|  
|68|Недопустимый партнер репликации|Используйте repadmin.exe или **Get-ADReplication\ *** Windows PowerShell, чтобы проверить работоспособность контроллера домена партнера|  
|69|Требуемый порт уже используется другим приложением|Используйте **netstat.exe - anob** для поиска процессов, которые ошибочно назначены зарезервированным портам Доменных службах Active Directory|  
|70|Корневой контроллер домена в лесу должен быть глобальным Каталогом|*Появляется только при dcpromo//unattend, который является устаревшим. См. документацию к предыдущим версиям*|  
|71|DNS-сервер уже установлен|Не указывайте для установки DNS-сервера (**- installDNS**) Если уже установлена служба DNS-сервера|  
|72|Компьютер работает под управлением служб удаленных рабочих столов в режиме без прав администратора.|Нельзя повысить роль этого контроллера домена, как он также является сервером служб удаленных рабочих СТОЛОВ, настроенным для более чем двух администраторов. Не удаляйте службы удаленных рабочих СТОЛОВ проверив тщательно, его использование - если он используется с приложениями или конечными пользователями, удаление приведет к прерыванию работы|  
|73|Недопустимый заданного режима работы леса.|Укажите допустимый режим работы леса.|  
|74|Недопустимый режим работы указанного домена.|Укажите допустимый режим работы домена.|  
|75|Не удается определить политику репликации паролей по умолчанию.|Убедитесь в том, что политики репликации паролей RODC существует и доступна|  
|76|Указанные реплицированные или нереплицированные группы безопасности недопустимы|Убедитесь в том, что вы ввели допустимый домен и учетные записи пользователей, при указании политики репликации паролей|  
|77|Недопустимый аргумент указанного|Изучите расширенное сообщение об ошибке и журналы.|  
|78|Не удалось проанализировать лес Active Directory|Изучите расширенное сообщение об ошибке и журналы.|  
|79|RODC нельзя повысить роль, так как команда rodcprep не выполнена|Используйте Windows Server 2012 для подготовки леса или выполните **adprep.exe/rodcprep**|  
|80|Команда domainprep не была выполнена|Используйте Windows Server 2012 для подготовки домена или использовать **adprep.exe/domainprep**|  
|81|Команда forestprep не была выполнена|Используйте Windows Server 2012 для подготовки леса или выполните **adprep.exe/forestprep**|  
|82|Несоответствие схемы леса|Используйте Windows Server 2012 для подготовки леса или выполните **adprep.exe/forestprep**|  
|83|Неподдерживаемый номер SKU|*Вероятность этой ошибки*|  
|84|Не удается определить учетную запись контроллера домена|Убедитесь, что существующие контроллеры домена имеют набор атрибутов контроля учетной записи пользователя.|  
|85|Не удалось выбрать учетную запись контроллера домена для этапа 2|Происходит, если вы указали «Использовать существующую учетную запись», но либо учетная запись не найден, либо есть ошибка во время поиска учетной записи. Убедитесь, что вы указали правильный учетной записи RODC подготовленной|  
|86|Необходимо выполнить повышение до этапа 2|При повышении роли дополнительного контроллера домена, но учетная запись уже существует и «Разрешить переустановку» не указан|  
|87|Существует учетная запись контроллера домена конфликтующего типа|Переименуйте компьютер перед повышением роли, если вы не пытаетесь подключиться к незанятому контроллеру домена. Необходимо подключить к учетной записи контроллера домена незанятой используя **- useexistingaccount** и правильный только для чтения или доступный для записи аргумент, в зависимости от типа учетной записи|  
|88|К администратору указанного сервера не является допустимым|Указан недопустимый учетную запись для делегирования администрирования контроллера RODC. Убедитесь, что учетная запись, указанная допустимого пользователя или группы|  
|89|Хозяин RID для указанного домена находится в автономном режиме.|Используйте **netdom.exe query fsmo** чтобы обнаружить хозяина RID. Подключите его к сети и сделайте его доступным для контроллера домена, для которого вы повышаете|  
|90|Хозяин именования доменов находится в автономном режиме.|Используйте **netdom.exe query fsmo** чтобы обнаружить хозяина именования доменов. Подключите его к сети и сделайте его доступным для контроллера домена, для которого вы повышаете|  
|91|Не удалось определить, является ли процесс процессом wow64|*Эта ошибка произойти не может больше, операционная система 64-разрядная версия*|  
|92|Процесс WOW64 не поддерживается.|*Эта ошибка произойти не может больше, операционная система 64-разрядная версия*|  
|93|Служба контроллера домена не запущена для непринудительного понижения роли|Запуск службы AD DS|  
|94|Пароль локального администратора не отвечает требованиям: либо пуст, либо необязателен|Укажите непустой пароль и убедитесь в том, что с локальной политикой паролей пароль обязателен|  
|95|Нельзя понизить роль последнего Windows Server 2008 или более поздней версии контроллера домена в домене, где существует динамической RODC|Сначала необходимо понизить все RODC, прежде чем понизить все Windows Server 2008 или более поздних версий для записи контроллеры домена|  
|96|Невозможно удалить двоичные файлы доменных служб Active Directory|*Появляется только при dcpromo//unattend, который является устаревшим. См. документацию к предыдущим версиям*|  
|97|Версия леса работы версия выше, чем операционной системы дочернего домена|Укажите режим работы дочернего домена, же или больше, чем функциональный уровень леса|  
|98|Компонент Установка или удаление двоичных файлов выполняется.|*Появляется только при dcpromo//unattend, который является устаревшим. См. документацию к предыдущим версиям*|  
|99|Режим работы леса слишком низок (Эта ошибка возможна Windows Server 2012 только)|По крайней мере повысить режим работы леса до Windows Server 2003 основной. Windows 2000 и Windows NT 4.0 больше не поддерживаемых операционных систем|  
|100|Режим работы домена слишком низок (Эта ошибка возможна Windows Server 2012 только)|По крайней мере Повышение режима работы домена в основном Windows Server 2003. Windows 2000 и Windows NT 4.0 больше не поддерживаемых операционных систем|  
  
#### <a name="knownlikely-issues-and-support-scenarios"></a>Известные/возможные неполадки и сценарии поддержки  
Ниже приведены распространенные проблемы, возникающие в процессе разработки Windows Server 2012. Все эти проблемы «по проектированию» и имеется либо обходной, либо иная методика во избежание их в первую очередь. Многие из этих особенностей поведения одинаковы в Windows Server 2008 R2 и более поздних версиях, но переделке развертывания Доменных повышенных уязвимость к проблемы.  
  
|Проблема|После понижения роли контроллера домена остается без зон DNS|  
|---------|-----------------------------------------------------------------|  
|Симптомы|Сервер по-прежнему отвечает на запросы DNS, но сведения о зонах отсутствуют|  
|Решение и примечания|При удалении роли Доменных службах Active Directory также удалите роль DNS-сервера или служба DNS-сервера отключено. Не забудьте сопоставить DNS-клиента на другой сервер, отличным от самого. При использовании Windows PowerShell, выполните следующую команду, после понижения роли сервера:<br /><br />Код - удалить windowsfeature dns<br /><br />или<br /><br />Код - set-service dns - starttype отключена<br />остановить службу dns|  
  
|Проблема|Повышение роли Windows Server 2012 до существующего одноуровневого домена не задан параметр updatetopleveldomain = 1 или allowsinglelabeldnsdomain = 1|  
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------|  
|Симптомы|Динамическая регистрация записей DNS не выполняется.|  
|Решение и примечания|Установите значения с помощью Netlogon и групповых политик DNS. Корпорация Майкрософт начала блокировать создание одноуровневых доменов в Windows Server 2008; Чтобы изменить к одобренной структуре доменов DNS можно использовать ADMT или средство переименования доменов.|  
  
|Проблема|Понижение роли последнего контроллера домена в домене завершается сбоем, если есть предварительно созданные незанятые RODC учетные записи|  
|---------|------------------------------------------------------------------------------------------------------------|  
|Симптомы|Понижение роли завершается сбоем с сообщением:<br /><br />**Dcpromo.General.54**<br /><br />Доменные службы Active Directory не удалось найти другой контроллер Active Directory-домена для передачи оставшихся в разделе CN = Schema, CN = Configuration, DC = corp, DC = contoso, DC = com.<br /><br />«Недопустимый формат имени домена».|  
|Решение и примечания|Удалите все оставшиеся предварительно созданные учетные записи RODC перед понижением роли домена, с помощью **Dsa.msc** или **очистку метаданных Ntdsutil.exe**.|  
  
|Проблема|При автоматической подготовке леса и домена средство GPPREP не запускается.|  
|---------|---------------------------------------------------------------|  
|Симптомы|Функция междоменного планирования групповой политики, режим планирования результирующей политики (RSOP), требует обновления файловой системы и разрешений Active Directory для существующего глобального Каталога. Без средства Gpprep нельзя использовать планирование результирующей ПОЛИТИКИ между доменами.|  
|Решение и примечания|Запустите **adprep.exe/gpprep** вручную для всех доменов, которые не были ранее подготовлены для Windows Server 2003, Windows Server 2008 или Windows Server 2008 R2. Администраторам следует запустить средство GPPrep только один раз за историю домена, а не при каждом обновлении. Она не выполняется при автоматической подготовке, так как если вы уже задали соответствующие настраиваемые разрешения, все содержимое SYSVOL будет повторно реплицировано во всех контроллерах домена.|  
  
|Проблема|Установка с носителя не удается выполнить проверку, если указан UNC-путь|  
|---------|------------------------------------------------------------------|  
|Симптомы|Возвращаемая ошибка:<br /><br />Код, — не удалось проверить пути носителя. Исключение при вызове «GetDatabaseInfo», «2» аргументов. Недопустимая папка.|  
|Решение и примечания|Файлы IFM на локальном диске, не удаленному UNC-пути, следует хранить. Эта Преднамеренная Блокировка предотвращает частичное повышение роли сервера из-за перебоев в работе сети.|  
  
|Проблема|Предупреждение о делегировании DNS выводится дважды во время повышения роли контроллера домена|  
|---------|-------------------------------------------------------------------------|  
|Симптомы|Предупреждение выводится *дважды* при повышении роли с помощью ADDSDeployment Windows PowerShell:<br /><br />Код - «не удается создать делегирование для этого DNS-сервера, так как не удается найти полномочным родительской зоны или он не работает Windows DNS сервера. При интеграции с имеющуюся инфраструктуру DNS, необходимо вручную создать делегирование для этого DNS-сервера в родительскую зону, чтобы обеспечить надежное разрешение из за пределами домена. В противном случае, никаких действий не требуется.»|  
|Решение и примечания|Можно пропустите. ADDSDeployment Windows PowerShell выводит предупреждение сперва при проверке готовности к установке, а затем еще раз при настройке контроллера домена. Если вы не хотите настраивать делегирование DNS, используйте следующий аргумент:<br /><br />Код - - creatednsdelegation: $false<br /><br />Выполните *не* пропускайте проверки необходимых условий, чтобы подавить это сообщение|  
  
|Проблема|Указание имени участника-пользователя или учетные данные, не принадлежащих к домену во время настройки возвращает пользователя в заблуждение ошибки|  
|---------|--------------------------------------------------------------------------------------------|  
|Симптомы|Диспетчер сервера возвращает следующую ошибку:<br /><br />Код - исключение при вызове «DNSOption», «6» аргументов<br /><br />ADDSDeployment Windows PowerShell возвращает следующую ошибку:<br /><br />Ошибка кода - проверка разрешений пользователя. Необходимо указать имя домена, к которому принадлежит эта учетная запись пользователя.|  
|Решение и примечания|Убедитесь, что необходимо указать действительные учетные данные домена в виде **домен\пользователь**.|  
  
|Проблема|Удаление роли DirectoryServices-DomainController с помощью Dism.exe приводит к тому, что сервер|  
|---------|---------------------------------------------------------------------------------------------------|  
|Симптомы|Если с помощью Dism.exe для удаления роли Доменных службах Active Directory перед понижением роли контроллера домена, сервер перестает загружаться нормально и отображается ошибка:<br /><br />Код - состояние: 0x000000000<br />Информация: Произошла непредвиденная ошибка.|  
|Решение и примечания|Загрузку в режиме восстановления служб каталогов с помощью *Shift + F8*. Верните роль Доменных службах Active Directory и затем принудительно понизьте роль контроллера домена. Также можно восстановите состояние системы из резервной копии. Не используйте Dism.exe для удаления роли AD DS; служебной программы она не распознает контроллеры домена.|  
  
|Проблема|Сбой установки нового леса, при Win2012|  
|---------|--------------------------------------------------------------------|  
|Симптомы|Повышения роли с помощью ADDSDeployment Windows PowerShell возвращает следующую ошибку:<br /><br />Код - Test.VerifyDcPromoCore.DCPromo.General.74<br /><br />Не удалось проверить необходимые условия для повышения роли контроллера домена. Недопустимый заданного режима работы домена|  
|Решение и примечания|Не указывайте режим работы леса win2012, не *также* указание режим работы домена Win2012. Вот пример, в котором будет работать без ошибок.<br /><br />Код - Win2012 - domainmode Win2012 - forestmode]|  
  
|||  
|-|-|  
|Проблема|Щелкнув проверить в области Установка с носителя выбора отображается ничего|  
|Симптомы|Если указать путь к папке IFM, то при нажатии **проверка** кнопки никогда не возвращает сообщение или не происходит никаких действий.|  
|Решение и примечания|**Проверка** кнопка сообщения выводятся, только если возникают проблемы. В противном случае, он предоставляет **Далее** кнопки, доступного в том случае, если вы указали путь к папке IFM. Необходимо щелкнуть **проверка** для продолжения, если вы выбрали папку IFM.|  
  
|||  
|-|-|  
|Проблема|Понижении роли с помощью диспетчера сервера не выводится до завершения.|  
|Симптомы|При удалении роли AD DS и понизить роль контроллера домена с помощью диспетчера сервера, существует текущая информация не выводится, пока не завершится успешно или сбоем.|  
|Решение и примечания|Это ограничение диспетчера сервера. Для обратной связи используйте командлет ADDSDeployment Windows PowerShell:<br /><br />Код - Uninstall-addsdomaincontroller|  
  
|||  
|-|-|  
|Проблема|Установка с носителя убедитесь, не определяет, что RODC носитель для записи контроллеру домена или наоборот.|  
|Симптомы|При повышении роли нового контроллера домена с помощью IFM и предоставлении неправильного носителя для Носителя для записи контроллеру домена, носителя, или наоборот, после НАЖАТИЯ для RODC - кнопки "Проверить" не возвращает сообщение об ошибке. Более поздней версии происходит сбой с ошибкой:<br /><br />Код - произошла ошибка при попытке настроить этот компьютер как контроллер домена. <br />Повышение Install-From-Media Read-Only контроллера домена не удается запустить, потому что указанной исходной базе данных не разрешена. Только для баз данных из других RODC может использоваться для продвижения IFM RODC.|  
|Решение и примечания|Проверьте проверяется только общая целостность папки IFM. Не предоставляют носитель IFM неправильного типа на сервере. Перед тем как пытаться повысить роль еще раз, используя правильный носитель, перезапустите сервер.|  
  
|||  
|-|-|  
|Проблема|Повышение роли контроллера RODC в предварительно созданной учетной записи компьютера завершается сбоем|  
|Симптомы|При повышении роли нового контроллера RODC с помощью промежуточной учетной записи компьютера с помощью ADDSDeployment Windows PowerShell, возникает ошибка:<br /><br />Код - набор параметров не удается разрешить с помощью указанных именованных параметров.    <br />InvalidArgument: ParameterBindingException<br />    + FullyQualifiedErrorId: AmbiguousParameterSet, Microsoft.DirectoryServices.Deployment.PowerShell.Commands.Install|  
|Решение и примечания|Не указывайте параметры, уже определены в предварительно созданной учетной записи RODC. К ним относятся:<br /><br />Код - - readonlyreplica<br />-installdns<br />-donotconfigureglobalcatalog<br />-sitename<br />-installdns|  
  
|||  
|-|-|  
|Проблема|Отмена выбора и выбрав «Конечного сервера автоматический перезапуск при необходимости» не выполняет никаких действий|  
|Симптомы|При выборе (или не устанавливать) в диспетчере серверов параметр **автоматический перезапуск конечного сервера, если требуется** whendemoting контроллера домена путем удаления роли, сервер всегда перезагружается вне зависимости от выбора.|  
|Решение и примечания|Это сделано намеренно. Процесс понижения роли перезагружает сервер вне зависимости от этого параметра.|  
  
|||  
|-|-|  
|Проблема|Показывает Dcpromo.log «[ошибка] setting Security on защиты файлов сервера не удалось 2»|  
|Симптомы|Понижение роли контроллера домена завершается без проблем, но в журнале dcpromo log содержится ошибка:<br /><br />Ошибка кода - [ошибка] Настройка безопасности для файлов сервера с 2|  
|Решение и примечания|Игнорируйте сообщение, ошибка ожидаема и носит формальный характер.|  
  
|||  
|-|-|  
|Проблема|При проверке необходимых условий adprep происходит ошибка «Не удается выполнить проверку конфликтов схемы с Exchange»|  
|Симптомы|При попытке повысить роль контроллера домена Windows Server 2012 до существующего Windows Server 2003, Windows Server 2008 или Windows Server 2008 R2 леса, проверка необходимых условий завершается с ошибкой:<br /><br />Ошибка кода - проверка необходимых компонентов для подготовки AD. Не удалось выполнить проверку конфликтов схемы с Exchange для домена *<domain name>* (исключение: сервер RPC недоступен)<br /><br />Файл adprep.log регистрируется ошибка:<br /><br />Код - программы Adprep не удалось получить данные с сервера*<domain controller>*<br /><br />через инструментарий управления Windows (WMI).|  
|Решение и примечания|Новый контроллер домена не имеют доступа к WMI через протоколы DCOM или RPC от контроллеров домена. На сегодняшний день выявлены три возможные причины этого:<br /><br />-Правило брандмауэра блокирует доступ для существующих контроллеров домена.<br /><br />-«Вход в качестве службы» отсутствует учетная запись СЕТЕВОЙ службы прав (SeServiceLogonRight) для существующих контроллеров домена.<br /><br />-Протокол NTLM отключен в контроллерах домена с помощью политик безопасности, описанных в [Знакомство ограниченного использования программ для проверки подлинности NTLM](https://technet.microsoft.com/library/dd560653(WS.10).aspx)|  
  
|||  
|-|-|  
|Проблема|При создании нового леса Доменных служб Active Directory всегда выводится предупреждение DNS|  
|Симптомы|При создании леса Доменных службах Active Directory и собственной зоны DNS в новом контроллере домена, вы всегда появляется следующее предупреждение:<br /><br />Код - ошибка обнаружена в конфигурации DNS. <br />Ни один DNS-серверы, используемые данным компьютером ответил в течение интервала времени ожидания.<br />(код ошибки 0x000005B4 «ERROR_TIMEOUT»)|  
|Решение и примечания|Можно пропустите. Это предупреждение выводится преднамеренно на первом контроллере домена в корневом домене нового леса, на случай, если вы намеревались указать существующий DNS-сервер и зону.|  
  
|||  
|-|-|  
|Проблема|Аргумент Windows PowerShell - whatif возвращает неправильную информацию о сервере DNS-сервера|  
|Симптомы|Если вы используете **- whatif** аргумент при настройке контроллера домена с явным или неявным **- installdns: $true**, то в итоговых выходных данных будет указано:<br /><br />Код - «DNS-сервер: нет»|  
|Решение и примечания|Можно пропустите. DNS установлена и настроена правильно.|  
  
|||  
|-|-|  
|Проблема|После повышения роли заканчивается неудачно с «недостаточно памяти для обработки команды»|  
|Симптомы|После повышения роли нового контроллера домена и выйдите из системы и выполните вход в систему интерактивно, происходит следующая ошибка:<br /><br />Код - недостаточно памяти для выполнения этой команды|  
|Решение и примечания|Контроллер домена не был перезагружен после повышения роли, либо из-за ошибки или потому, что был указан аргумент ADDSDeployment Windows PowerShell **- norebootoncompletion **. Перезапустите контроллер домена.|  
  
|||  
|-|-|  
|Проблема|Кнопка "Далее" не доступен на странице параметров контроллера домена|  
|Симптомы|Несмотря на то, что вы установили пароль, **Далее** кнопки **параметры контроллера домена** страницу в диспетчере сервера недоступна. Сайт, не указанные в **имя сайта** меню.|  
|Решение и примечания|Имеется несколько сайтов Доменных службах Active Directory и по крайней мере у одного нет подсетей; создаваемый контроллер домена принадлежит к одной из этих подсетей. Необходимо вручную выбрать подсеть в раскрывающемся меню имя сайта. Следует также просмотреть все сайты AD, с помощью DSSITE.MSC или используйте следующую команду Windows PowerShell, чтобы найти все сайты отсутствует подсетей:<br /><br />Код - get-adreplicationsite-фильтр *-свойства подсетей & #124; WHERE-object {! $_.subnets - eq «\ *»} & #124; командлет Format-table имя|  
  
|||  
|-|-|  
|Проблема|Повышение или понижение роли завершается сбоем с сообщением» не удается запустить службу»|  
|Симптомы|При попытке повысить роль, понизить роль или клонировать контроллер домена происходит следующая ошибка:<br /><br />Код - не удается запустить службу, либо поскольку отключен, или он имеет ни одного включенного устройства, связанные с ним» (0x80070422)<br /><br />Ошибка может быть интерактивной, событие или регистрироваться в журнале, например dcpromoui.log или dcpromo.log|  
|Решение и примечания|Служба сервера с ролью DS (DsRoleSvc) отключена. По умолчанию эта служба устанавливается при установке роли AD DS и установлен тип запуска вручную. Не отключайте эту службу. Снова задайте для нее вручную и разрешите операциям роли доменных служб Active Directory, запускать и останавливать ее по требованию. Это сделано намеренно.|  
  
|||  
|-|-|  
|Проблема|Диспетчер сервера по-прежнему предупреждает о том, что необходимо повысить роль контроллера домена|  
|Симптомы|Если повысить роль контроллера домена с помощью устаревших dcpromo.exe//unattend или обновление на месте существующего контроллера домена Windows Server 2008 R2 до Windows Server 2012 в диспетчере сервера по-прежнему отображается задача настройки после развертывания **повысить роль этого сервера до уровня контроллера домена **.|  
|Решение и примечания|Щелкните ссылку в предупреждении и сообщение исчезнет навсегда. Это поведение является ожидаема и носит формальный характер.|  
  
|||  
|-|-|  
|Проблема|Сценарий развертывания в диспетчере сервера отсутствует операция установки роли|  
|Симптомы|При повышении роли контроллера домена с помощью диспетчера сервера и сохранении сценария развертывания Windows PowerShell, его отсутствует командлет установки роли и его аргументы (install-windowsfeature-name ad-domain-services - includemanagementtools). Без этой роли не может настроить контроллер домена.|  
|Решение и примечания|Добавьте вручную этот командлет и аргументы в любые сценарии. Это поведение ожидаемо и реализовано намеренно.|  
  
|||  
|-|-|  
|Проблема|Сценарий развертывания в диспетчере сервера имеет имя, отличное от PS1|  
|Симптомы|Если повысить роль контроллера домена, с помощью диспетчера сервера и сохранении сценария развертывания Windows PowerShell файлу присваивается случайное временное имя, отличное от PS1-файл.|  
|Решение и примечания|Переименуйте файл вручную. Это поведение ожидаемо и реализовано намеренно.|  
  
|Проблема|Dcpromo//unattend допускает неподдерживаемые режимы работы|  
|-|-|  
|Симптомы|При повышении роли контроллера домена с помощью команды dcpromo//unattend с помощью следующего примера файл ответов:<br /><br />Кода.<br /><br />[DCInstall]<br />НовыйДомен = леса<br /><br />ReplicaOrNewDomain = домена<br /><br />NewDomainDNSName = corp.contoso.com<br /><br />SafeModeAdminPassword =Safepassword@6<br /><br />DomainNetbiosName = corp<br /><br />DNSOnNetwork = Да<br /><br />AutoConfigDNS = Да<br /><br />RebootOnSuccess = NoAndNoPromptEither<br /><br />RebootOnCompletion = нет<br /><br />*DomainLevel = 0*<br /><br />*ForestLevel = 0*<br /><br />Происходит сбой в dcpromoui.log следующие ошибки:<br /><br />Код - dcpromoui EA4.5B8 0089 13:31:50.783 DomainLevel CArgumentsSpec::ValidateArgument ввод<br /><br />Dcpromoui EA4.5B8 008A 13:31:50.783 DomainLevel значение равно 0<br /><br />Dcpromoui EA4.5B8 008B 13:31:50.783 код выхода — 77<br /><br />Dcpromoui EA4.5B8 008C 13:31:50.783 указанный аргумент является недопустимым.<br /><br />Dcpromoui EA4.5B8 008D 13:31:50.783 закрытия журнала<br /><br />Dcpromoui 13:31:50.830 EA4.5B8 0032 код выхода — 77<br /><br />Уровень 0 соответствует Windows 2000, которая не поддерживается в Windows Server 2012.|  
|Решение и примечания|Не используйте устаревшую команду dcpromo//unattend и не понять, что он позволяет указывать недопустимые параметры, позднее приводят к сбою. Это поведение ожидаемо и реализовано намеренно.|  

|Проблема|Повышение роли «зависает» при создании объекта параметров NTDS, не завершается|  
|-|-|  
|Симптомы|При повышении роли реплики контроллера домена или контроллера RODC, повышение роли достигает «создание объекта параметров NTDS» и никогда не выполняется или завершения. Журналы перестают обновляться также.|  
|Решение и примечания|Это известная проблема, из-за предоставление учетных данных встроенной учетной записи локального администратора предоставляются с паролем встроенной учетной записи администратора домена. Это приводит к сбою работы в основном модуле настройки, который не ошибка вместо переходит в бесконечное ожидание (псевдоцикл). Это ожидаемое - хотя и нежелательное - поведение.<br /><br />Чтобы устранить сервера:<br /><br />1. Перезагрузите сервер.<br /><br />1. в AD удалите запись компьютера для этого сервера (он еще не стала учетной записью контроллера домена)<br /><br />1. на этом сервере принудительно отсоедините его от домена<br /><br />1. на этом сервере удалите роли AD DS.<br /><br />1. перезагрузка<br /><br />1. повторно добавьте AD DS роль и удвоит, всегда указывайте ***домен\администратор*** учетные данные для повышения роли контроллера домена, а не просто имя встроенной учетной записи локального администратора учетной записи в формате|  
