---
ms.assetid: b3d6fb87-c4d4-451c-b3de-a53d2402d295
title: Установка нового леса Active Directory в Windows Server 2012 (уровень 200)
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: a9bdc3b237d0d0f44995f2c359cc3ef6ed8568a3
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71400370"
---
# <a name="install-a-new-windows-server-2012-active-directory-forest-level-200"></a>Установка нового леса Active Directory в Windows Server 2012 (уровень 200)

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе на базовом уровне описывается новая функция повышения роли контроллера домена в доменных службах Active Directory Windows Server 2012. В доменных службах Active Directory в Windows Server 2012 средство Dcpromo заменено диспетчером сервера и системой развертывания на основе Windows PowerShell.  
  
-   [Упрощенное администрирование служб домен Active Directory Services](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_SimplifiedAdmin)  
  
-   [Технический обзор](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_TechOverview)  
  
-   [Развертывание леса с диспетчер сервера](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_SMForest)  
  
-   [Развертывание леса с помощью Windows PowerShell](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_PSForest)  
  
## <a name="BKMK_SimplifiedAdmin"></a>Упрощенное администрирование служб домен Active Directory Services  
В Windows Server 2012 реализовано упрощенное администрирование доменных служб Active Directory нового поколения, которое представляет собой наиболее радикальную модернизацию системы управления доменами с момента выпуска Windows Server 2000. Упрощенное администрирование доменных служб Active Directory было разработано с учетом двенадцатилетнего опыта работы с Active Directory. Оно улучшает поддержку административных возможностей для архитекторов и администраторов, делает их более гибкими и интуитивно понятными. Достигнуто это было путем создания новых версий существующих технологий, а также расширения возможностей компонентов, появившихся в Windows Server 2008 R2.  
  
### <a name="what-is-ad-ds-simplified-administration"></a>Что такое упрощенное администрирование доменных служб Active Directory?  
Упрощенное администрирование доменных служб Active Directory — это новый подход к развертыванию доменов. Ниже перечислены некоторые новые возможности.  
  
-   Развертывание роли доменных служб Active Directory теперь является частью архитектуры диспетчера сервера и допускает удаленную установку.  
  
-   Модуль развертывания и настройки доменных служб Active Directory теперь основан на Windows PowerShell даже при использовании графического интерфейса установки.  
  
-   При повышении роли теперь проводится проверка предварительных требований, с помощью которой подтверждается готовность леса и домена к установке нового контроллера домена, что снижает вероятность сбоев.  
  
-   В режиме работы леса Windows Server 2012 новые функции не реализуются, а режим работы домена необходим только для подмножества новых функций Kerberos, что упрощает создание однородных сред контроллеров доменов для администраторов.  
  
### <a name="purpose-and-benefits"></a>Назначение и преимущества  
Может показаться, что эти изменения лишь повысили сложность. Однако при переработке процесса развертывания доменных служб Active Directory появилась возможность объединить многие этапы и рекомендации, сократив число необходимых действий и упростив их. Это означает, например, что при настройке новой реплики контроллера домена с помощью графического интерфейса теперь требуются восемь диалоговых окон вместо двенадцати. Для создания леса Active Directory требуется *одна* команда Windows PowerShell со всего лишь *одним* аргументом: именем домена.  
  
Почему в Windows Server 2012 сделан упор на Windows PowerShell? По мере развития распределенных вычислений среда Windows PowerShell обеспечивает единый модуль для настройки и обслуживания как с помощью графического интерфейса, так и с помощью интерфейса командной строки. Она обеспечивает создание полнофункциональных сценариев для любого компонента, предоставляя ИТ-специалистам те же первоклассные возможности, какие интерфейсы API дают разработчикам. По мере широкого распространения облачных вычислений среда Windows PowerShell также дает возможность удаленного администрирования сервера. При этом компьютером без графического интерфейса можно управлять так же эффективно, как и компьютером с монитором и мышью.  
  
Опытный администратор доменных служб Active Directory сможет с успехом применять накопленные знания. Для начинающего администратора кривая обучения стала гораздо более пологой.  
  
## <a name="BKMK_TechOverview"></a>Технический обзор  
  
### <a name="what-you-should-know-before-you-begin"></a>Что следует знать перед началом работы  
В этом разделе предполагается, что вы знакомы с предыдущими выпусками доменных служб Active Directory, поэтому в нем не приводятся базовые сведения об их назначении и функциональных возможностях. Дополнительную информацию о доменных службах Active Directory можно найти на страницах портала TechNet, ссылки на которые приведены ниже:  
  
-   [Службы домен Active Directory для Windows Server 2008 R2](https://technet.microsoft.com/library/dd378801(WS.10).aspx)  
  
-   [Службы домен Active Directory для Windows Server 2008](https://technet.microsoft.com/library/dd378891(WS.10).aspx)  
  
-   [Технический справочник по Windows Server](https://technet.microsoft.com/library/cc739127(WS.10).aspx)  
  
### <a name="functional-descriptions"></a>Описания функций  
  
#### <a name="ad-ds-role-installation"></a>Установка роли доменных служб Active Directory  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_SelectServerRoles.gif)  
  
Для установки доменных служб Active Directory, так же как для установки всех остальных ролей сервера и компонентов в Windows Server 2012, используются диспетчер сервера и среда Windows PowerShell. Программа Dcpromo.exe больше не предоставляет графический интерфейс пользователя с параметрами настройки.  
  
Графический мастер в диспетчере сервера или модуль ServerManager для Windows PowerShell используются как для локальной, так и для удаленной установки. Запуская несколько экземпляров этого мастера или командлетов для разных серверов, можно одновременно развертывать доменные службы Active Directory в нескольких контроллерах домена из единой консоли. Хотя эти новые функции не имеют обратной совместимости с Windows Server 2008 R2 или более ранними операционными системами, вы по-прежнему можете использовать программу Dism.exe, появившуюся в Windows Server 2008 R2, для локальной установки роли из классической командной строки.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSAddWindowsFeature.png)  
  
#### <a name="ad-ds-role-configuration"></a>Настройка роли доменных служб Active Directory  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_DeploymentConfiguration_Forest.gif)  
  
Настройка служб домен Active Directory "ранее называлась DCPROMO" теперь является отдельной операцией при установке роли. После установки роли доменных служб Active Directory администратор настраивает сервер в качестве контроллера домена с помощью отдельного мастера в диспетчере сервера или с помощью модуля Windows PowerShell ADDSDeployment.  
  
Настройка роли доменных служб Active Directory осуществляется на основе двенадцатилетнего практического опыта. Контроллеры домена настраиваются в соответствии с новейшими рекомендациями Майкрософт. Например, служба доменных имен (DNS) и глобальные каталоги устанавливаются по умолчанию в каждом контроллере домена.  
  
Мастер настройки диспетчер сервера AD DS объединяет множество отдельных диалоговых окон в меньшее количество запросов и больше не скрывает параметры в расширенном режиме. Весь процесс повышения роли осуществляется в ходе установки с помощью одного раскрывающегося диалогового окна. Мастер и модуль Windows PowerShell ADDSDeployment выводят информацию о существенных изменениях и проблемах безопасности, а также ссылки на дополнительные материалы.  
  
Программа Dcpromo.exe сохранена в Windows Server 2012 только для автоматической установки посредством командной строки. Она больше не используется для запуска графического мастера установки. Настоятельно рекомендуется отказаться от использования программы Dcpromo.exe в целях автоматической установки, заменив ее модулем ADDSDeployment, так как соответствующий исполняемый файл не будет включен в следующую версию Windows.  
  
Эти новые функции не имеют обратной совместимости с Windows Server 2008 R2 или более поздними операционными системами.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallADDSForest.png)  
  
> [!IMPORTANT]
> Программа Dcpromo.exe больше не предоставляет графический мастер и не используется для установки двоичных файлов роли или компонента. При попытке запустить Dcpromo.exe из проводника происходит ошибка:  
> 
> "Мастер установки доменных служб Active Directory перемещается в диспетчер сервера. Дополнительные сведения см. в разделе <https://go.microsoft.com/fwlink/?LinkId=220921>».  
> 
> При попытке выполнить команду Dcpromo.exe /unattend двоичные файлы по-прежнему устанавливаются, как в предыдущих операционных системах, но выводится предупреждение:  
> 
> "Автоматическая операция Dcpromo заменена модулем Аддсдеплоймент для Windows PowerShell. Дополнительные сведения см. в разделе <https://go.microsoft.com/fwlink/?LinkId=220924>».  
> 
> В Windows Server 2012 использовать программу dcpromo.exe не рекомендуется. Она не будет включена в будущие версии Windows и не будет улучшаться далее в текущей. Администраторам следует прекратить ее использование и перейти на поддерживаемые модули Windows PowerShell для создания контроллеров домена из командной строки.  
  
#### <a name="prerequisite-checking"></a>Проверка предварительных требований  
Настройка контроллера домена также включает этап проверки предварительных требований, на котором проводится оценка леса и домена перед повышением роли контроллера домена. При этом проверяются доступность роли FSMO, права пользователей, совместимость расширенной схемы и другие требования. Новая структура процесса позволяет уменьшить число проблем, при которых повышение роли контроллера домена прерывается посередине из-за неустранимой ошибки конфигурации. Это снижает вероятность образования потерянных метаданных контроллеров домена в лесу или возникновения серверов, которые считают себя контроллерами домена, хотя не являются ими.  
  
## <a name="BKMK_SMForest"></a>Развертывание леса с диспетчер сервера  
В этом разделе описывается, как установить первый контроллер домена в корневом домене леса с помощью диспетчера сервера на компьютере Windows Server 2012 с графическим интерфейсом.  
  
### <a name="server-manager-ad-ds-role-installation-process"></a>Процесс установки роли доменных служб Active Directory с помощью диспетчера сервера  
На схеме ниже показан процесс установки роли доменных служб Active Directory, начиная с запуска ServerManager.exe и заканчивая моментом перед повышением роли контроллера домена.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/adds_servermanagerdeployment.png)  
  
#### <a name="server-pool-and-add-roles"></a>Пул серверов и добавление ролей  
Объединить в пул можно любые компьютеры с ОС Windows Server 2012, доступные с компьютера, на котором запущен диспетчер сервера. После объединения в пул эти серверы можно использовать для удаленной установки доменных служб Active Directory или любых других вариантов конфигурации, возможных в диспетчере сервера.  
  
Чтобы добавить серверы, выполните одно из указанных ниже действий.  
  
-   На плитке приветствия на информационной панели щелкните **Добавить другие серверы для управления** .  
  
-   В меню **Управление** выберите пункт **Добавление серверов**.  
  
-   Щелкните правой кнопкой мыши **Все серверы** и выберите пункт **Добавление серверов**.  
  
Откроется диалоговое окно "Добавление серверов".  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddServers.png)  
  
В нем можно добавить серверы в пул для использования или группировки тремя способами:  
  
-   поиск в Active Directory (используется LDAP, компьютеры должны принадлежать к домену, разрешена фильтрация ОС, поддерживаются подстановочные знаки);  
  
-   Поиск по DNS (используется DNS-псевдоним или IP-адрес посредством передачи ARP или NetBIOS либо просмотра WINS; операционной системе запрещена фильтрация и поддержка подстановочных знаков);  
  
-   Импорт (используется список серверов в виде текстового файла с разделителями CR/LF)  
  
Щелкните **Найти** для получения списка серверов из домена Active Directory, к которому присоединен компьютер, а затем щелкните одно или несколько имен серверов в списке. Нажмите кнопку со стрелкой вправо, чтобы добавить серверы в список **Выбранные**. Используйте диалоговое окно **Добавление серверов** для добавления выбранных серверов в группы ролей на информационной панели. Чтобы создать настраиваемые группы серверов, выберите в меню **Управление** пункт **Создание группы серверов** или щелкните элемент **Создание группы серверов** на плитке **Вас приветствует диспетчер серверов** информационной панели.  
  
> [!NOTE]  
> Процедура "Добавление серверов" не выполняет проверку подключения сервера или его доступности. Однако при следующем обновлении недоступные серверы будут помечены в представлении "Управляемость" диспетчера сервера.  
  
Вы можете установить роли удаленно на любые компьютеры Windows Server 2012, добавленные в пул, как показано на снимке экрана:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/tADDS_SMI_TR_AddRolesFeatures.png)  
  
Вы не можете полностью управлять серверами с более ранними операционными системами, чем Windows Server 2012. При выборе пункта **Добавить роли и компоненты** выполняется командлет **Install-WindowsFeature**из модуля Windows PowerShell ServerManager.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddADDSToAnotherServer.png)  
  
Вы также можете выбрать установку доменных служб Active Directory на удаленном сервере с предварительно выбранной ролью с помощью информационной панели диспетчера сервера на существующем контроллере домена, щелкнув плитку на информационной панели правой кнопкой мыши и выбрав пункт **Добавить AD DS на другой сервер**. Будет вызван командлет **Install-WindowsFeature AD-Domain-Services**.  
  
Компьютер с запущенным диспетчером сервера автоматически включает себя в пул. Чтобы установить на нем роль доменных служб Active Directory, просто откройте меню **Управление** и выберите пункт **Добавить роли и компоненты**.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ManageAddRoles.png)  
  
#### <a name="installation-type"></a>Тип установки  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectInstallationType.png)  
  
В диалоговом окне **Тип установки** есть вариант, при котором доменные службы Active Directory не поддерживаются: **Установка на основе служб удаленных рабочих столов**. При выборе этого варианта возможно использование только служб удаленных рабочих столов в распределенной среде с несколькими серверами. Установить доменные службы Active Directory в этом случае нельзя.  
  
При установке доменных служб Active Directory всегда оставляйте вариант по умолчанию: **Установка ролей или компонентов**.  
  
#### <a name="server-selection"></a>Server Selection  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectDestinationServer.png)  
  
В диалоговом окне **Выбор сервера** можно выбрать один из серверов, ранее добавленных в пул, если он доступен. Локальный сервер, на котором запущен диспетчер сервера, доступен автоматически.  
  
Кроме того, вы можете выбрать автономные VHD-файлы Hyper-V с операционной системой Windows Server 2012, и диспетчер сервера добавит в них роль напрямую с помощью системы предоставления компонентов. Таким образом можно предоставлять виртуальным серверам необходимые компоненты перед их дальнейшей настройкой.  
  
#### <a name="server-roles-and-features"></a>"Роли сервера" и "Компоненты"  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectServerRoles.png)  
  
Если необходимо повысить роль контроллера домена, выберите роль **Доменные службы Active Directory**. Все функции администрирования Active Directory и необходимые службы устанавливаются автоматически, даже если они являются частью другой роли или не выбраны в интерфейсе диспетчера сервера.  
  
В диспетчере сервера также выводится информационное диалоговое окно, в котором показаны компоненты управления, неявно устанавливаемые вместе с этой ролью. Это равноценно использованию аргумента **-IncludeManagementTools**.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddFeaturesDialog.gif)  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectFeatures.png)  
  
При необходимости здесь можно добавить дополнительные **компоненты** .  
  
#### <a name="active-directory-domain-services"></a>Доменные службы Active Directory  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ADDSIntro.png)  
  
В диалоговом окне **Доменные службы Active Directory** приводится ограниченная информация о требованиях и рекомендациях. В основном он выступает в качестве подтверждения того, что выбрана роль AD DS "Если этот экран не отображается, значит не выбрано AD DS.  
  
#### <a name="confirmation"></a>Подтверждение операций  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_Confirmation.png)  
  
Диалоговое окно **Подтверждение** — это последний этап перед установкой роли. С его помощью можно указать, что компьютер необходимо перезагрузить после установки роли, однако установка доменных служб Active Directory не требует перезагрузки.  
  
Нажимая кнопку **Установить**, вы подтверждаете готовность к установке роли. После того как установка роли начнется, отменить ее будет невозможно.  
  
#### <a name="results"></a>Результаты  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_Results.png)  
  
В диалоговом окне **Результаты** показан ход установки и ее текущее состояние. Установка роли продолжится, даже если закрыть диспетчер сервера.  
  
Рекомендуется проверять результат установки. Если вы закрыли диалоговое окно **Результаты** до того, как установка завершилась, результаты можно проверить с помощью флага уведомления в диспетчере сервера. В диспетчере сервера также выводятся предупреждения для всех серверов, на которых установлена роль доменных служб Active Directory, но которые не были затем настроены как контроллеры домена.  
  
**Уведомления о задачах**  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_TaskNotofications.png)  
  
**Сведения о AD DS**  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ADDSDetails.png)  
  
**Сведения о задаче**  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_TaskDetails.png)  
  
#### <a name="promote-to-domain-controller"></a>Повышение роли до контроллера домена  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_Promote.png)  
  
После того как установка роли доменных служб Active Directory завершится, можно продолжить настройку с помощью ссылки **Повысить роль этого сервера до уровня контроллера домена** . Это необходимо для того, чтобы сделать сервер контроллером домена, однако мастер настройки запускать сразу необязательно. Например, может потребоваться предоставить серверам двоичные файлы роли доменных служб Active Directory, а затем отправить их в другой филиал для дальнейшей настройки. Добавив роль доменных служб Active Directory перед отправкой, можно сэкономить время, требуемое для настройки на месте назначения. При этом также выполняется рекомендация, в соответствии с которой контроллер домена не следует отключать на несколько дней или недель. Наконец, это позволяет обновить компоненты перед повышением роли контроллера домена и уменьшить число последующих перезагрузок по крайней мере на одну.  
  
При выборе этой ссылки вызываются следующие командлеты ADDSDeployment: **install-addsforest**, **install-addsdomain**или **install-addsdomaincontroller**.  
  
### <a name="uninstallingdisabling"></a>Удаление или отключение  
Роль доменных служб Active Directory удаляется так же, как любая другая роль, вне зависимости от того, была ли роль сервера повышена до контроллера домена. Однако по завершении удаления роли доменных служб Active Directory необходимо перезапустить сервер.  
  
Удаление роли доменных служб Active Directory отличается от установки тем, что для его завершения необходимо понизить роль контроллера домена. Это требуется для того, чтобы удаление двоичных файлов роли в контроллере домена сопровождалось надлежащей очисткой метаданных в лесу. Дополнительные сведения см. в статье [понижение роли контроллеров &#40;домена и&#41;доменов уровня 200](../../ad-ds/deploy/Demoting-Domain-Controllers-and-Domains--Level-200-.md).  
  
> [!WARNING]  
> Удаление ролей доменных служб Active Directory с помощью программы Dism.exe или модуля Windows PowerShell DISM после повышения роли до контроллера домена не поддерживается и приводит к тому, что сервер перестает загружаться нормально.  
>   
> В отличие от диспетчер сервера или модуля развертывания AD DS для Windows PowerShell, DISM — это собственная система обслуживания, которая не имеет ведомых AD DS или его конфигурации. Не используйте программу Dism.exe или модуль Windows PowerShell DISM для удаления роли доменных служб Active Directory, если сервер все еще является контроллером домена.  
  
### <a name="create-an-ad-ds-forest-root-domain-with-server-manager"></a>Создание корневого домена леса доменных служб Active Directory с помощью диспетчера сервера  
На схеме ниже показан процесс настройки доменных служб Active Directory. Предполагается, что вы ранее установили роль доменных служб Active Directory и запустили **мастер настройки доменных служб Active Directory** с помощью диспетчера сервера.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/adds_forestdeploy2.png)  
  
#### <a name="deployment-configuration"></a>Deployment Configuration  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddNewForest.png)  
  
Повышение роли каждого контроллера домена начинается в диспетчере сервера на странице **Конфигурация развертывания** . Оставшиеся параметры и обязательные поля меняются на этой и последующих страницах в зависимости от того, какая операция развертывания выбрана.  
  
Чтобы создать лес Active Directory, установите переключатель в положение **Добавить новый лес**. Необходимо указать допустимое имя корневого домена. Оно не может быть однокомпонентным (например, имя должно иметь вид *contoso.com*, а не просто *contoso*) и должно соответствовать требованиям к разрешенным доменным именам DNS.  
  
Подробнее о допустимых доменных именах см. в статье базы знаний [Соглашения об именовании в Active Directory для компьютеров, доменов, сайтов и подразделений](https://support.microsoft.com/kb/909264).  
  
> [!WARNING]  
> Имена лесов Active Directory не должны совпадать с внешними именами DNS. Например, если URL-адрес DNS имеет http://contoso.com, необходимо выбрать другое имя для внутреннего леса, чтобы избежать будущих проблем совместимости. Данное имя должно быть уникальным и достаточно редким для веб-трафика, например corp.contoso.com.  
  
В новом лесу не требуются новые учетные данные для учетной записи администратора домена. Процесс повышения роли контроллера домена использует учетные данные встроенной учетной записи администратора из первого контроллера домена, применяемого для создания корневого домена леса. Не существует стандартного способа отключить или заблокировать встроенную учетную запись администратора, и она может быть единственной точкой входа в лес, если другие учетные записи администраторов домена использовать невозможно. Перед развертыванием нового леса необходимо знать пароль.  
  
Аргумент**DomainName** обязателен, и ему должно быть присвоено полное доменное имя DNS.  
  
#### <a name="domain-controller-options"></a>Параметры контроллера домена  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_DCOptions_Forest.gif)  
  
На странице **Параметры контроллера домена** можно настроить **режим работы леса** и **режим работы домена** для нового корневого домена леса. По умолчанию эти параметры являются Windows Server 2012 в новом корневом домене леса. Функциональный уровень леса Windows Server 2012 не предоставляет никаких новых функциональных возможностей по отношению к режиму работы леса Windows Server 2008 R2. Режим работы домена Windows Server 2012 является обязательным только для реализации новых параметров Kerberos "всегда предоставлять утверждения" и "отказ в незащищенных запросах проверки подлинности". В основном использование функциональных уровней в Windows Server 2012 заключается в ограничении участия в домене контроллерами домена, которые удовлетворяют минимально разрешенным требованиям к операционной системе. Иными словами, можно указать только контроллеры домена Windows Server 2012, на которых выполняется Windows Server 2012, может размещаться домен.  В Windows Server 2012 реализован новый флаг контроллера домена с именем **DS_WIN8_REQUIRED** в функции **DSGetDcName** службы Netlogon, которая только находит контроллеры домена Windows Server 2012. Это позволяет более гибко создавать однородные или разнородные леса с учетом операционных систем, под управлением которых могут работать контроллеры домена.  
  
Подробнее о расположении контроллеров домена см. в статье [Функции службы каталогов](https://msdn.microsoft.com/library/ms675900(VS.85).aspx).  
  
Единственной настраиваемой возможностью контроллера домена является служба DNS-сервера. Корпорация Майкрософт рекомендует, чтобы все контроллеры домена предоставляли службы DNS для обеспечения высокой доступности в распределенных средах. Поэтому этот параметр выбран по умолчанию при установке контроллера домена в любом режиме или домене. Параметры "Глобальный каталог" и "Контроллер домена только для чтения" недоступны при создании корневого домена леса, потому что первый контроллер домена должен быть глобальным каталогом и не может быть контроллером домена только для чтения.  
  
Назначаемый **пароль режима восстановления служб каталогов** должен соответствовать применяемой к серверу политике паролей, которая по умолчанию не требует надежного пароля — допускается любой непустой пароль. Необходимо всегда выбирать надежный и сложный пароль, предпочтительно парольную фразу.  
  
#### <a name="dns-options-and-dns-delegation-credentials"></a>Параметры DNS и учетные данные для делегирования DNS  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestDNSOptions.png)  
  
На странице **Параметры DNS** можно настроить делегирование DNS и указать альтернативные учетные данные администратора DNS.  
  
Вы не можете настроить параметры или делегирование DNS в мастере настройки доменных служб Active Directory при установке нового корневого домена леса Active Directory, если на странице **Параметры контроллера домена** был выбран параметр **DNS-сервер**. Параметр **Создать DNS-делегирование** доступен при создании корневой зоны DNS леса в существующей инфраструктуре DNS-серверов. Он позволяет указать альтернативные учетные данные администратора DNS с правами на обновление зоны DNS.  
  
Подробнее о необходимости создания DNS-делегирования см. в статье [Общее представление о делегировании зоны](https://technet.microsoft.com/library/cc771640.aspx).  
  
#### <a name="additional-options"></a>Дополнительные параметры  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestAdditionalOptions.png)  
  
На странице **Дополнительные параметры** приводится NetBIOS-имя домена, которое вы можете переопределить. По умолчанию NetBIOS-имя домена совпадает с крайним левым компонентом полного доменного имени, указанного на странице **Конфигурация развертывания** . Например, если указано полное доменное имя corp.contoso.com, NetBIOS-имя домена по умолчанию — CORP.  
  
Если имя содержит не более 15 символов и не конфликтует с другим NetBIOS-именем, оно остается без изменений. Если оно конфликтует с другим NetBIOS-именем, к нему добавляется число. Если длина имени больше 15 символов, мастер предоставляет уникальный усеченный вариант. В любом случае мастер сначала проверяет, не занято ли имя, с помощью просмотра WINS и широковещательной рассылки NetBIOS.  
  
Подробнее о допустимых доменных именах см. в статье базы знаний [Соглашения об именовании в Active Directory для компьютеров, доменов, сайтов и подразделений](https://support.microsoft.com/kb/909264).  
  
#### <a name="paths"></a>Paths  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestPaths.png)  
  
Страница **Пути** позволяет переопределить расположение папок по умолчанию для базы данных AD DS, журналов транзакций базы данных и общего доступа к SYSVOL. Расположение по умолчанию всегда в подкаталогах %systemroot% (т. е. C:\Windows).  
  
#### <a name="review-options-and-view-script"></a>"Просмотреть параметры" и "Просмотреть скрипт"  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestReviewOptions.png)  
  
Страница **Просмотреть параметры** позволяет проверить параметры перед установкой и убедиться, что они отвечают требованиям. Позднее установку также можно будет остановить с помощью диспетчера сервера. Эта страница позволяет подтвердить параметры перед продолжением настройки.  
  
На странице **Просмотреть параметры** диспетчера сервера расположена дополнительная кнопка **Просмотреть скрипт** , предназначенная для создания текстового файла в кодировке Юникод, содержащего текущую конфигурацию развертывания ADDSDeployment в виде единого скрипта Windows PowerShell. Это позволяет использовать графический интерфейс диспетчера сервера в качестве студии развертывания Windows PowerShell. С помощью мастера настройки доменных служб Active Directory необходимо настроить параметры, экспортировать конфигурацию и затем отменить мастер. Во время этого процесса создается допустимый и синтаксически верный образец для дальнейшего изменения или прямого использования. Пример:  
  
```powershell 
#  
# Windows PowerShell Script for AD DS Deployment  
#  
  
Import-Module ADDSDeployment  
Install-ADDSForest `  
-CreateDNSDelegation `  
-DatabasePath "C:\Windows\NTDS" `  
-DomainMode "Win2012" `  
-DomainName "corp.contoso.com" `  
-DomainNetBIOSName "CORP" `  
-ForestMode "Win2012" `  
-InstallDNS:$true `  
-LogPath "C:\Windows\NTDS" `  
-NoRebootOnCompletion:$false `  
-SYSVOLPath "C:\Windows\SYSVOL"  
-Force:$true  
  
```  
  
> [!NOTE]  
> Диспетчер сервера обычно задает значения для всех аргументов при повышении роли, не полагаясь на значения по умолчанию (так как они могут изменяться в будущих версиях Windows или пакетах обновления). Единственным исключением является аргумент **-safemodeadministratorpassword** (который намеренно опущен в скрипте). Для принудительного вывода запроса на подтверждение не указывайте значение при интерактивном выполнении командлета.  
  
#### <a name="prerequisites-check"></a>Проверка готовности к установке  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestPrereqCheck.png)  
  
**Проверка предварительных требований** — это новая функция настройки доменных служб Active Directory. На этом новом этапе проверяется возможность поддержки нового леса доменных служб Active Directory конфигурацией сервера.  
  
При установке нового корневого домена леса мастер настройки доменных служб Active Directory в диспетчере сервера выполняет серию модульных тестов. При этом предлагаются рекомендуемые способы восстановления. Тесты можно выполнять необходимое число раз. Установка контроллера домена не может продолжаться, пока все проверки предварительных требований не будут пройдены.  
  
На странице **Проверка предварительных требований** также приводится важная информация, например сведения об изменениях в системе безопасности, затрагивающих предыдущие операционные системы.  
  
Подробнее о проверках предварительных требований см. в разделе [Prerequisite Checking](../../ad-ds/manage/AD-DS-Simplified-Administration.md#BKMK_PrereuisiteChecking).  
  
#### <a name="installation"></a>Установка  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestInstallation.png)  
  
Когда появляется страница **Установка** , это означает, что настройка контроллера домена началась и ее нельзя остановить или отменить. Подробная информация об операциях выводится на этой странице и записывается в следующие журналы:  
  
-   %systemroot%\debug\dcpromo.log  
  
-   %systemroot%\debug\dcpromoui.log  
  
> [!NOTE]  
> Из одной консоли диспетчера сервера можно одновременно запустить несколько мастеров установки роли и настройки доменных служб Active Directory.  
  
#### <a name="results"></a>Результаты  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestSignOff.png)  
  
На странице **Результаты** показано, успешно ли было выполнено повышение роли, а также приводится важная для администраторов информация. Контроллер домена автоматически перезагрузится через 10 секунд.  
  
## <a name="BKMK_PSForest"></a>Развертывание леса с помощью Windows PowerShell  
В этом разделе описывается, как установить первый контроллер домена в корневом домене леса с помощью Windows PowerShell на компьютере с базовыми компонентами Windows Server 2012.  
  
### <a name="windows-powershell-ad-ds-role-installation-process"></a>Процесс установки роли доменных служб Active Directory с помощью Windows PowerShell  
Включив несколько простых командлетов из модуля ServerManager в процесс развертывания, можно еще более упростить администрирование доменных служб Active Directory.  
  
На схеме ниже показан процесс установки роли доменных служб Active Directory, начиная с запуска **PowerShell.exe** и заканчивая моментом перед повышением роли контроллера домена.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/adds_servermanagerdeployment_powershell.png)  
  
|||  
|-|-|  
|Командлет ServerManager|Аргументы (аргументы, выделенные**жирным шрифтом** , являются обязательными. Аргументы, выделенные*курсивом* , можно указать с помощью Windows PowerShell или мастера настройки доменных служб Active Directory).|  
|Install-WindowsFeature/Add-WindowsFeature|***-Имя***<br /><br />*-Restart*<br /><br />*-Инклудеаллсубфеатуре*<br /><br />*-IncludeManagementTools*<br /><br />-Source<br /><br />*-ComputerName*<br /><br />-Credential<br /><br />-LogPath<br /><br />*— Виртуальный жесткий диск*<br /><br />*-Конфигуратионфилепас*|  
  
> [!NOTE]  
> Хотя аргумент **-IncludeManagementTools** необязателен, его настоятельно рекомендуется использовать при установке двоичных файлов роли доменных служб Active Directory.  
  
Модуль ServerManager предоставляет доступ к частям нового модуля DISM для Windows PowerShell, предназначенным для установки, отслеживания состояния и удаления роли. Такая структура упрощает большинство задач и уменьшает потребность в прямом использовании эффективного (но опасного при неправильном применении) модуля DISM.  
  
Для экспорта псевдонимов и командлетов ServerManager используйте командлет **Get-Command** .  
  
```powershell  
Get-Command -module ServerManager  
```  
  
Пример:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSGetCommand.png)  
  
Чтобы добавить роль доменных служб Active Directory, просто выполните командлет **Install-WindowsFeature** с именем этой роли в качестве аргумента. Так же как при использовании диспетчера сервера, все службы, необходимые для роли доменных служб Active Directory, устанавливаются автоматически.  
  
```powershell  
Install-WindowsFeature -name AD-Domain-Services  
```  
  
Если также требуется установить средства управления доменными службами Active Directory (настоятельно рекомендуем сделать это), укажите аргумент **-IncludeManagementTools** :  
  
```powershell  
Install-WindowsFeature -name AD-Domain-Services -IncludeManagementTools  
```  
  
Пример:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallWinFeature.png)  
  
Чтобы вывести список всех компонентов и ролей с состоянием их установки, используйте командлет **Get-WindowsFeature** без аргументов. Чтобы получить состояние установки с удаленного сервера, укажите аргумент **-ComputerName**.  
  
```powershell  
Get-WindowsFeature  
```  
  
Так как командлет **Get-WindowsFeature** не имеет механизма фильтрации, чтобы найти определенные компоненты, необходимо использовать командлет **Where-Object** с конвейером. Конвейер — это канал, по которому данные передаются между несколькими командлетами, а командлет Where-Object выступает в роли фильтра. Встроенная переменная **$_** содержит текущий объект со всеми свойствами, передаваемый через конвейер.  
  
```powershell  
Get-WindowsFeature | where-object <options>  
```  
  
Например, чтобы найти все компоненты, в свойстве **Отображаемое имя** которых имеется строка Active Dir, выполните следующую команду:  
  
```powershell  
Get-WindowsFeature | where displayname -like "*active dir*"  
```  
  
Ниже приведены дополнительные примеры.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSGetWindowsFeature.png)  
  
Подробнее о дополнительных операциях с конвейерами в Windows PowerShell и командлете Where-Object см. в статье [Конвейерная передача и конвейер в Windows PowerShell](https://technet.microsoft.com/library/ee176927.aspx).  
  
Также обратите внимание на то, что в Windows PowerShell 3.0 значительно упростились аргументы командной строки, необходимые для выполнения этой конвейерной операции. В Windows PowerShell 2.0 потребовалась бы следующая команда:  
  
```powershell  
Get-WindowsFeature | where {$_.displayname - like "*active dir*"}  
```  
  
С помощью конвейера Windows PowerShell можно получить удобные для восприятия результаты. Пример:  
  
```powershell  
Install-WindowsFeature | Format-List  
Install-WindowsFeature | select-object | Format-List  
  
```  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallADDS.png)  
  
Обратите внимание на интересные данные, которые возвращает командлет **Select-Object** с аргументом **-expandproperty**:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallADDSWithTools.png)  
  
> [!NOTE]  
> Аргумент **Select-Object -expandproperty** немного снижает общую производительность установки.  
  
### <a name="BKMK_PS"></a>Создание AD DS корневого домена леса с помощью Windows PowerShell  
Чтобы установить новый лес Active Directory с помощью модуля ADDSDeployment, используйте следующий командлет:  
  
```powershell  
Install-addsforest  
```  
  
Выполнение командлета **Install-AddsForest** включает только два этапа (проверка предварительных требований и установка). На двух иллюстрациях ниже показан этап установки с единственным необходимым аргументом **-domainname**.  
  
|||  
|-|-|  
|Командлет ADDSDeployment|Аргументы (аргументы, выделенные**жирным шрифтом** , являются обязательными. Аргументы, выделенные*курсивом* , можно указать с помощью Windows PowerShell или мастера настройки доменных служб Active Directory).|  
|install-addsforest|-Confirm<br /><br />*-Креатеднсделегатион*<br /><br />*-DatabasePath*<br /><br />*-Домаинмоде*<br /><br />***-Имя_домена***<br /><br />***-Домаиннетбиоснаме***<br /><br />*-Днсделегатионкредентиал*<br /><br />*-Леса*<br /><br />-Force<br /><br />*-Инсталлднс*<br /><br />*-LogPath*<br /><br />-NoDnsOnNetwork<br /><br />-NoRebootOnCompletion<br /><br />*-SafeModeAdministratorPassword*<br /><br />-SkipAutoConfigureDNS<br /><br />-SkipPreChecks<br /><br />*-Сисволпас*<br /><br />*-WhatIf*|  
  
> [!NOTE]  
> Аргумент **-DomainNetBIOSName** является обязательным, если требуется изменить 15-значное имя, созданное автоматически на базе префикса доменного имени DNS, или если длина имени превышает 15 символов.  
  
Командлет и аргументы модуля ADDSDeployment, эквивалентные параметрам на странице **Конфигурация развертывания** в диспетчере сервера:  
  
```powershell  
Install-ADDSForest  
-DomainName <string>  
```  
  
Аргументы командлета ADDSDeployment, эквивалентные параметрам на странице "Параметры контроллера домена" в диспетчере сервера:  
  
```powershell  
-ForestMode <{Win2003 | Win2008 | Win2008R2 | Win2012 | Default}>  
-DomainMode <{Win2003 | Win2008 | Win2008R2 | Win2012 | Default}>  
-InstallDNS <{$false | $true}>  
-SafeModeAdministratorPassword <secure string>  
  
```  
  
Если аргументы **Install-ADDSForest** не заданы, они имеют те же значения по умолчанию, что и параметры в диспетчере сервера.  
  
Аргумент **SafeModeAdministratorPassword** действует особым образом.  
  
-   Если этот аргумент *не указан* , командлет предлагает ввести и подтвердить скрытый пароль. Это предпочтительный вариант использования при интерактивном выполнении командлета.  
  
    Например, чтобы создать лес с именем corp.contoso.com с выводом запроса на ввод и подтверждение скрытого пароля, выполните следующую команду:  
  
    ```powershell  
    Install-ADDSForest "DomainName corp.contoso.com  
    ```  
  
-   Если аргумент указан *со значением*, это значение должно быть защищенной строкой. Это не является предпочтительным вариантом использования при интерактивном выполнении командлета.  
  
Например, можно вручную ввести запрос пароля с помощью командлета **Read-Host**, чтобы запрашивать у пользователя ввод защищенной строки.  
  
```powershell  
-safemodeadministratorpassword (read-host -prompt "Password:" -assecurestring)  
```  
  
> [!WARNING]  
> Поскольку в предыдущем варианте пароль не подтверждается, соблюдайте повышенную осторожность: пароль невидим.  
  
Можно также ввести защищенную строку в качестве переменной с преобразованным открытым текстом, хотя использовать такой вариант настоятельно не рекомендуется.  
  
```powershell  
-safemodeadministratorpassword (convertto-securestring "Password1" -asplaintext -force)  
```  
  
Наконец, можно сохранить скрытый пароль в файле, а затем использовать его повторно, никогда не отображая пароль в виде открытого текста. Пример:  
  
```powershell  
$file = "c:\pw.txt"  
$pw = read-host -prompt "Password:" -assecurestring  
$pw | ConvertFrom-SecureString | Set-Content $file  
  
-safemodeadministratorpassword (Get-Content $File | ConvertTo-SecureString)  
  
```  
  
> [!WARNING]  
> Ввод или хранение пароля в виде открытого или скрытого текста не рекомендуется. Любой пользователь, выполняющий эту команду в скрипты или заглядывающий через ваше плечо, сможет узнать пароль DSRM этого доменного контроллера. Любой пользователь, имеющий доступ к файлу, сможет восстановить скрытый пароль. Зная пароль, он сможет войти в контроллер домена, запущенный в режиме восстановления служб каталогов, и персонифицировать сам контроллер домена, повысив уровень собственных привилегий в лесу Active Directory до максимального уровня. Рекомендуется выполнить дополнительные действия для шифрования данных текстового файла с помощью **System.Security.Cryptography**, однако их рассмотрение выходит за рамки этой статьи. Лучше всего полностью отказаться от хранения паролей.  
  
Командлет ADDSDeployment предлагает дополнительную возможность пропустить автоматическую настройку параметров DNS-клиента, серверов пересылки и корневых ссылок. При использовании диспетчера сервера пропустить эту настройку нельзя. Этот аргумент имеет значение только в том случае, если роль DNS-сервера была установлена до настройки контроллера домена:  
  
```powershell  
-SkipAutoConfigureDNS  
```  
  
Аргумент **DomainNetBIOSName** также действует особым образом.  
  
-   Если в аргументе **DomainNetBIOSName** не задано NetBIOS-имя домена, а длина однокомпонентного доменного имени в аргументе **DomainName** не превышает 15 символов, повышение роли продолжает выполняться с использованием автоматически созданного имени.  
  
-   Если в аргументе **DomainNetBIOSName** не задано NetBIOS-имя домена, а длина однокомпонентного доменного имени в аргументе **DomainName** превышает 16 символов, происходит сбой повышения роли.  
  
-   Если в аргументе **DomainNetBIOSName** задано NetBIOS-имя домена длиной не более 15 символов, повышение роли продолжает выполняться с использованием указанного имени.  
  
-   Если в аргументе **DomainNetBIOSName** задано NetBIOS-имя домена длиной более 16 символов, происходит сбой повышения роли.  
  
Аргументы командлета ADDSDeployment, эквивалентные параметрам на странице "Дополнительные параметры" в диспетчере сервера:  
  
```powershell  
-domainnetbiosname <string>  
```  
  
Аргументы командлета ADDSDeployment, эквивалентные параметрам на странице **Пути** в диспетчере сервера:  
  
```powershell  
-databasepath <string>  
-logpath <string>  
-sysvolpath <string>  
  
```  
  
Для просмотра информации о конфигурации используйте необязательный аргумент **Whatif** с командлетом **Install-ADDSForest** . Это позволит просмотреть явные и неявные значения аргументов командлета.  
  
Пример:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSPaths.png)  
  
При использовании диспетчера сервера пропустить **проверку предварительных требований** нельзя, однако это можно сделать при использовании командлета развертывания доменных служб Active Directory с помощью следующего аргумента:  
  
```powershell  
-skipprechecks  
```  
  
> [!WARNING]  
> Корпорация Майкрософт не рекомендует пропускать проверку предварительных требований, так как это может привести к частичному повышению роли контроллера домена или повреждению леса Active Directory.  
  
Обратите внимание на то, что командлет **Install-ADDSForest** , как и диспетчер сервера, напоминает об автоматической перезагрузке сервера после повышения роли:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSReboot.png)  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallProgress.png)  
  
Чтобы автоматически закрывать напоминание о перезагрузке, используйте аргументы **-force** или **-confirm:$false** с любым командлетом Windows PowerShell ADDSDeployment. Чтобы предотвратить автоматическую перезагрузку сервера по завершении повышения роли, используйте аргумент **-norebootoncompletion** .  
  
> [!WARNING]  
> Отключать перезагрузку не рекомендуется. Для правильной работы контроллер домена должен перезагрузиться.  
  
## <a name="see-also"></a>См. также  
[Службы домен Active Directory (портал TechNet)](https://technet.microsoft.com/library/cc770946(WS.10).aspx)  
[Службы домен Active Directory для Windows Server 2008 R2](https://technet.microsoft.com/library/dd378801(WS.10).aspx)  
[Службы домен Active Directory для Windows Server 2008](https://technet.microsoft.com/library/dd378891(WS.10).aspx)  
[Техническое руководство по Windows Server (Windows Server 2003)](https://technet.microsoft.com/library/cc739127(WS.10).aspx)  
Центр администрирования каталога [Active: Начало работы (Windows Server 2008 R2) ](https://technet.microsoft.com/library/dd560651(WS.10).aspx)  
[Active Directory администрирования с помощью Windows PowerShell (Windows Server 2008 R2)](https://technet.microsoft.com/library/dd378937(WS.10).aspx)  
[Обратитесь к группе по службам каталогов (официальный блог по технической поддержке корпорации Майкрософт)](http://blogs.technet.com/b/askds)  
  

