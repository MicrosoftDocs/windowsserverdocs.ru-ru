---
ms.assetid: b3d6fb87-c4d4-451c-b3de-a53d2402d295
title: "Установка нового Active Directory леса Windows Server 2012 (уровень 200)"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: b8a7502a1b9d27b0f61353f2544182a64d311496
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="install-a-new-windows-server-2012-active-directory-forest-level-200"></a>Установка нового Active Directory леса Windows Server 2012 (уровень 200)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описывается функция повышения роли контроллера домена новый Windows Server 2012 Active Directory доменных служб на базовом уровне. В Windows Server 2012 AD DS заменяет средство Dcpromo заменено диспетчером сервера и системой развертывания на основе Windows PowerShell.  
  
-   [Упрощенное администрирование служб домена Active Directory](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_SimplifiedAdmin)  
  
-   [Технический обзор](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_TechOverview)  
  
-   [Развертывание леса с помощью диспетчера серверов](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_SMForest)  
  
-   [Развертывание леса с помощью Windows PowerShell](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-.md#BKMK_PSForest)  
  
## <a name="BKMK_SimplifiedAdmin"></a>Упрощенное администрирование служб домена Active Directory  
Windows Server 2012 представляет новое поколение Active Directory упрощенное администрирование доменных служб и является наиболее радикальную модернизацию системы управления доменами с момента выпуска Windows 2000 Server. Упрощенном администрировании AD DS принимает выводов из двенадцатилетнего Active Directory и предоставляет более простую в обслуживании более гибкими и интуитивно понятной административных возможностей для архитекторов и администраторов. Это означало, создания новых версий существующих технологий, а также для расширения возможностей компонентов, появившихся в Windows Server 2008 R2.  
  
### <a name="what-is-ad-ds-simplified-administration"></a>Что такое AD DS упрощенное администрирование?  
Упрощенном администрировании AD DS представляет новый подход к развертыванию доменов. Ниже перечислены некоторые из этих возможностей.  
  
-   Развертывание роли AD DS теперь является частью архитектуры диспетчера сервера и допускает удаленную установку.  
  
-   Модуль развертывания и настройки AD DS теперь основан на Windows PowerShell, даже при использовании графического интерфейса установки.  
  
-   При повышении роли теперь проводится проверка предварительных требований которой подтверждается готовность леса и домена для нового контроллера домена, что снижает вероятность сбоев.  
  
-   Для среде с контроллером домена, чтобы осуществить однородное требуется режим работы, уровень новые функции не реализуются, а режим работы домена необходим только для подмножества новых функций Kerberos, что упрощает администраторов леса Windows Server 2012.  
  
### <a name="purpose-and-benefits"></a>Назначение и преимущества  
Эти изменения могут показаться сложными не. При переработке процесса развертывания Доменных службах Active Directory появилась возможность объединить многие этапы и рекомендации проще, сократив число необходимых действий. Это означает, например, что настройке графического интерфейса новую реплику контроллера домена теперь требуются восемь диалоговых окон вместо двенадцати. Для создания нового леса Active Directory необходимо *один* команда Windows PowerShell со всего лишь *один* аргумента: имя домена.  
  
Почему нет сделан упор на Windows PowerShell в Windows Server 2012? По мере развития распределенных вычислений среда Windows PowerShell обеспечивает единый модуль для настройки и обслуживания как графический с и интерфейса командной строки. Она обеспечивает создание полнофункциональных сценариев для любого компонента же первоклассные для ИТ-специалистов, которая предоставляет API-Интерфейс для разработчиков. По мере облачных вычислений широкого, Windows PowerShell также дает возможность удаленного администрирования сервера, где компьютером без графического интерфейса имеет те же возможности управления, как и компьютером с монитором и мышью.  
  
Опытный администратор Доменных службах Active Directory необходимо выяснить накопленные знания. Для начинающего администратора найдет гораздо более пологой обучения.  
  
## <a name="BKMK_TechOverview"></a>Технический обзор  
  
### <a name="what-you-should-know-before-you-begin"></a>Что следует знать перед началом  
В этом разделе предполагается, что вы знакомы с предыдущими выпусками доменных служб Active Directory, а не приводятся базовые сведения об их назначении и функциональных возможностях. Дополнительные сведения о Доменных службах Active Directory см. на страницах портала TechNet, ссылки ниже:  
  
-   [Доменные службы Active Directory для Windows Server 2008 R2](https://technet.microsoft.com/library/dd378801(WS.10).aspx)  
  
-   [Доменные службы Active Directory для Windows Server 2008](https://technet.microsoft.com/library/dd378891(WS.10).aspx)  
  
-   [Технический справочник по Windows Server](https://technet.microsoft.com/library/cc739127(WS.10).aspx)  
  
### <a name="functional-descriptions"></a>Описание работы  
  
#### <a name="ad-ds-role-installation"></a>Установка роли доменных Служб AD  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_SelectServerRoles.gif)  
  
Домен Установка служб Active Directory используются диспетчер сервера и Windows PowerShell, как и другие роли сервера и функций в Windows Server 2012. Программа Dcpromo.exe больше не предоставляет параметры конфигурации графического интерфейса пользователя.  
  
Используйте графический мастер в диспетчере сервера или модуль ServerManager для Windows PowerShell в локальной или удаленной установки. Запуская несколько экземпляров этого мастера или командлетов и для разных серверов, вы можно одновременно развертывать Доменные в нескольких контроллерах домена, из одной консоли. Несмотря на то, что эти новые функции не имеют обратной совместимости с Windows Server 2008 R2 или более ранних операционных систем, вы можете по-прежнему использовать программу Dism.exe, появившуюся в Windows Server 2008 R2 для локальной установки роли из классической командной строки.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSAddWindowsFeature.png)  
  
#### <a name="ad-ds-role-configuration"></a>Настройка роли доменных служб Active Directory AD  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_DeploymentConfiguration_Forest.gif)  
  
Домен Настройка служб Active Directory «ранее называвшаяся DCPROMO» является теперь является отдельной операцией от установки роли. После установки роли AD DS, администратор настраивает сервер в качестве контроллера домена с помощью отдельного мастера в диспетчере сервера или с помощью модуля ADDSDeployment Windows PowerShell.  
  
Настройка роли AD DS основана на двенадцатилетнего практического опыта и контроллеры домена, на основе последних лучших рекомендаций Майкрософт настраиваются. Например системе доменных имен и глобальные каталоги устанавливаются по умолчанию в каждом контроллере домена.  
  
Мастер конфигурации диспетчера сервера AD DS объединяет множество отдельных диалоговые окна в меньшее число запросов и больше не скрывает параметров в режиме «Дополнительно». Весь процесс повышения роли осуществляется в одного раскрывающегося диалогового в ходе установки. Мастер и модуль ADDSDeployment Windows PowerShell отображаем существенных изменениях и проблемах безопасности, а также ссылки на дополнительные материалы.  
  
Dcpromo.exe сохранена в Windows Server 2012 командной строки только для автоматической установки и больше нет используется для запуска графического мастера установки. Настоятельно рекомендуется отказаться от использования программы Dcpromo.exe в целях автоматической установки и замените его на модуль ADDSDeployment как неподдерживаемые исполняемый файл не будет включен в следующую версию Windows.  
  
Эти новые функции не имеют обратной совместимости с Windows Server 2008 R2 или более старыми операционными системами.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallADDSForest.png)  
  
> [!IMPORTANT]  
> Dcpromo.exe больше не предоставляет графический мастер и больше не устанавливает двоичных файлов роли или компонента. При попытке запустить Dcpromo.exe из проводника происходит ошибка:  
>   
> «Мастер установки доменных служб Active Directory перемещен в диспетчер серверов. Дополнительные сведения см. в разделе https://go.microsoft.com/fwlink/?LinkId=220921.»  
>   
> При попытке запустить Dcpromo.exe / unattend по-прежнему устанавливаются двоичные файлы, как в предыдущих операционных системах, но выводится предупреждение:  
>   
> «Dcpromo Автоматическая операция заменена модулем ADDSDeployment для Windows PowerShell. Дополнительные сведения см. в разделе https://go.microsoft.com/fwlink/?LinkId=220924.»  
>   
> Windows Server 2012, мы отказались от dcpromo.exe и он не будет включена в будущие версии Windows не будет улучшаться далее в этой операционной системе. Администраторам следует прекратить ее использование и перейти на поддерживаемые модули Windows PowerShell для создания контроллеров домена из командной строки.  
  
#### <a name="prerequisite-checking"></a>Проверка предварительных требований  
Настройка контроллера домена также включает этап проверки предварительных требований, оценивающее леса и домена перед повышением роли контроллера домена. Это включает в себя доступность роли FSMO, права пользователей, совместимость расширенной схемы и другие требования. Новая структура процесса позволяет уменьшить число проблем, при которых повышение роли контроллера домена прерывается посередине из-за неустранимой ошибки конфигурации. Это снижает вероятность образования потерянных метаданных контроллеров домена в лесу или сервера, которые считают себя является контроллером домена.  
  
## <a name="BKMK_SMForest"></a>Развертывание леса с помощью диспетчера серверов  
В этом разделе описывается установка первого контроллера домена в корневом домене леса, с помощью диспетчера сервера на компьютере Windows Server 2012 с графическим интерфейсом.  
  
### <a name="server-manager-ad-ds-role-installation-process"></a>Процесс установки роли AD DS диспетчера сервера  
На схеме ниже показан процесс установки роли доменных служб Active Directory, начиная с запуска ServerManager.exe и заканчивая моментом перед повышением роли контроллера домена.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/adds_servermanagerdeployment.png)  
  
#### <a name="server-pool-and-add-roles"></a>Сервер пула и Добавление ролей  
Любые компьютеры Windows Server 2012, доступную для компьютера, на котором запущен диспетчер сервера, подходят для пула. После объединения в пул эти серверы для удаленной установки Доменных службах Active Directory или любых других вариантов конфигурации возможных в диспетчере сервера.  
  
Чтобы добавить серверы, выполните одно из следующих:  
  
-   Нажмите кнопку **добавить другие серверы для управления** на плитке приветствия панели мониторинга  
  
-   Нажмите кнопку **управление** и выбрать пункт **Добавление серверов**  
  
-   Щелкните правой кнопкой мыши **все серверы** и выберите **Добавление серверов**  
  
Откроется диалоговое окно добавления серверов.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddServers.png)  
  
В нем можно добавить серверы в пул для использования или группировки тремя способами:  
  
-   Поиск в Active Directory (используется LDAP, необходимо, чтобы компьютеры должны принадлежать к домену, разрешена фильтрация ОС поддерживаются подстановочные знаки)  
  
-   Поиск по DNS (используется DNS-псевдоним или IP-адрес посредством передачи ARP или NetBIOS либо просмотра WINS запрещена фильтрация и поддержка подстановочных знаков операционной системы)  
  
-   Импорт (используется список текстового файла с разделителями CR/LF серверов)  
  
Нажмите кнопку **найти** для получения списка серверов из домена, компьютер будет присоединен к Active Directory, щелкните один или несколько имен серверов из списка серверов. Нажмите кнопку со стрелкой вправо, чтобы добавить серверы в **выбранные** списка. Используйте **Добавление серверов** диалоговое окно, чтобы добавить выбранные серверы в группы ролей на панели мониторинга. Или щелкните **управление**, а затем нажмите кнопку **Создание группы серверов**, или нажмите кнопку **Создание группы серверов** на информационной панели **вас приветствует Диспетчер серверов** плитку, чтобы создать настраиваемые группы серверов.  
  
> [!NOTE]  
> Процедура добавления серверов не проверяет, что сервер или его доступности. Тем не менее недоступные серверы будут помечены в представлении управляемости в диспетчере сервера, при следующем обновлении  
  
Вы можете установить роли удаленно Windows Server 2012 с любым компьютеры добавленные в пул, как показано:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/tADDS_SMI_TR_AddRolesFeatures.png)  
  
Вы не можете полностью управлять серверами под управлением операционных систем, более старая, чем Windows Server 2012. **Добавить роли и компоненты** выбора под управлением модуля Windows PowerShell ServerManager **Install-WindowsFeature**.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddADDSToAnotherServer.png)  
  
Также можно использовать панель мониторинга диспетчера сервера на существующем контроллере домена выбрать установку доменных служб Active Directory на удаленном сервере с предварительно выбранной ролью с правой кнопкой мыши плитку на информационной панели Доменные службы Active Directory и выбрав **добавить AD DS на другой сервер**. Будет вызван командлет **Install-WindowsFeature AD-Domain-Services**.  
  
Компьютер, на которой работает сервер диспетчер включает себя в пул автоматически. Чтобы установить роли AD DS, просто щелкните **управление** меню и нажмите кнопку **Добавить роли и компоненты**.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ManageAddRoles.png)  
  
#### <a name="installation-type"></a>Тип установки  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectInstallationType.png)  
  
**Типа установки** диалоговое окно содержит параметр, который не поддерживает доменных служб Active Directory: **служб удаленных рабочих столов сценарий Установка на основе**. Этот параметр использование только служб удаленных рабочих столов в распределенной среде с несколькими серверами. Если выбрать его, не удается установить AD DS.  
  
Всегда оставляйте вариант по умолчанию в месте, при установке AD DS: **Установка на основе ролей или компонентов**.  
  
#### <a name="server-selection"></a>Выбор сервера  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectDestinationServer.png)  
  
**Выбор сервера** диалоговое окно позволяет выбрать один из серверов, ранее добавленных в пул, как оно доступно. Локальный сервер диспетчер сервера доступен автоматически.  
  
Кроме того вы можете выбрать автономные файлы виртуального жесткого диска Hyper-V с операционной системой Windows Server 2012, и диспетчер сервера добавит в роль их непосредственно с помощью системы предоставления компонентов. Это позволяет предоставлять виртуальным серверам необходимые компоненты перед их дальнейшей настройкой.  
  
#### <a name="server-roles-and-features"></a>Роли и компоненты сервера  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectServerRoles.png)  
  
Выберите **доменных служб Active Directory** роли, если вы планируете повысить роль контроллера домена. Все функции администрирования Active Directory и необходимые службы устанавливаются автоматически, даже если они являются частью другой роли или не выбраны в интерфейсе диспетчера сервера.  
  
Диспетчер сервера также выводится информационное диалоговое окно, которое показано, какие функции управления, неявно установит эту роль; Это эквивалентно **- IncludeManagementTools** аргумент.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddFeaturesDialog.gif)  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_SelectFeatures.png)  
  
Дополнительные **функции** здесь можно добавить при необходимости.  
  
#### <a name="active-directory-domain-services"></a>Доменные службы Active Directory  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ADDSIntro.png)  
  
**Доменных служб Active Directory** диалоговом окне приводится ограниченная информация о требованиях и рекомендациях. Оно служит главным образом подтверждением того, что выбрана роль Доменных службах Active Directory «, если этот экран не отображается, вы не установили AD DS.  
  
#### <a name="confirmation"></a>Подтверждение  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_Confirmation.png)  
  
**Подтверждения** диалоговое окно — это последний этап перед установкой роли. Он обеспечивает возможность перезагрузить компьютер после установки роли, но процесс установки AD DS требует перезагрузки.  
  
Щелкнув **установить**, вы подтверждаете готовность к установке роли. Установка роли нельзя отменить после ее начала.  
  
#### <a name="results"></a>Результаты  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_Results.png)  
  
**Результатов** диалогового окна показан ход установки и текущее состояние. Установка роли продолжится, даже если закрыть диспетчер сервера.  
  
Проверка результатов установки по-прежнему является рекомендуемым подходом. Если вы закроете **результатов** диалоговое окно до завершения установки можно проверить результаты, с помощью флага уведомления в диспетчере сервера. Диспетчер сервера также выводятся все предупреждения, для всех серверов, на которых установлена роль AD DS, но не были затем настроены как контроллеры домена.  
  
**Уведомления о задачах**  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_TaskNotofications.png)  
  
**Сведения AD DS**  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ADDSDetails.png)  
  
**Сведения о задаче**  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_TaskDetails.png)  
  
#### <a name="promote-to-domain-controller"></a>Повышение роли до контроллера домена  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_Promote.png)  
  
В конце установки роли AD DS, то можно продолжить настройку с помощью **повысить роль этого сервера до уровня контроллера домена** ссылку. Это необходимо, чтобы сделать сервер контроллером домена, но не требуется, чтобы немедленно запустить мастер настройки. Например только может потребоваться предоставить серверам двоичные файлы Доменных службах Active Directory перед отправкой их в другой филиал для дальнейшей настройки. Добавив роль Доменных службах Active Directory перед отправкой, можно сэкономить время, когда он достигает места назначения. При этом также выполняется рекомендация, не своевременно контроллера домена в автономный режим на несколько дней или недель. Наконец это позволяет обновить компоненты перед повышением роли контроллера домена и уменьшить число последующих перезагрузок по крайней мере один.  
  
При выборе этой ссылки вызываются следующие командлеты ADDSDeployment: **install-addsforest**, **install-addsdomain**, или **install-addsdomaincontroller**.  
  
### <a name="uninstallingdisabling"></a>Удаление или отключение  
Удаление роли AD DS, такие как любая другая роль, независимо от того, является ли вы роль сервера повышена до контроллера домена. Тем не менее удаления роли AD DS необходимо перезапустить сервер после завершения.  
  
Удаление роли Active Directory доменные службы отличается от установки, что необходимо понизить роль контроллера домена, перед его завершением. Это необходимо предотвратить удаление сопровождалось надлежащей очисткой метаданных в лесу двоичных файлов роли контроллера домена. Дополнительные сведения см. в разделе [понижение уровня контроллеров домена и доменов & #40; Уровень 200 & #41; ](../../ad-ds/deploy/Demoting-Domain-Controllers-and-Domains--Level-200-.md).  
  
> [!WARNING]  
> Удаление ролей AD DS с помощью Dism.exe или модуля Windows PowerShell DISM после повышения роли до контроллера домена не поддерживается и не позволит сервер перестает загружаться нормально.  
>   
> В отличие от диспетчера сервера или модуля Addsdeployment для Windows PowerShell DISM — это собственная система обслуживания, которая не распознает AD DS или их конфигурацию. Не используйте Dism.exe или модуля Windows PowerShell DISM для удаления роли AD DS, если сервер больше не является контроллером домена.  
  
### <a name="create-an-ad-ds-forest-root-domain-with-server-manager"></a>Создание корневого домена леса доменных служб Active Directory AD с помощью диспетчера серверов  
Следующая диаграмма иллюстрирует процесс настройки доменных служб Active Directory, в случае, где вы ранее установки роли AD DS и запуска **мастер настройки доменных служб Active Directory** с помощью диспетчера сервера.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/adds_forestdeploy2.png)  
  
#### <a name="deployment-configuration"></a>Конфигурация развертывания  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_AddNewForest.png)  
  
Диспетчер серверов начинает повышение роли каждого контроллера домена с **конфигурации развертывания** страницы. Оставшиеся параметры и обязательные поля меняются на этой странице и последующих страницах в зависимости от того, какая операция развертывания выбрана.  
  
Чтобы создать новый лес Active Directory, нажмите кнопку **добавить новый лес**. Необходимо указать допустимое имя корневого домена; Имя не может быть однокомпонентным (например, имя должно быть *contoso.com* или аналогичные, а не просто *contoso*) и необходимо использовать допустимое требования именования домена DNS.  
  
Дополнительные сведения о допустимых доменных именах см. статье БАЗЫ знаний [соглашения об именовании в Active Directory для компьютеров, доменов, узлов и подразделений](https://support.microsoft.com/kb/909264).  
  
> [!WARNING]  
> Не создавайте лесов Active Directory с тем же именем, как внешними именами DNS. Например если URL-адрес DNS Интернета — http://contoso.com, необходимо выбрать другое имя для своего внутреннего леса избежать проблем с совместимостью в дальнейшем. Данное имя должно быть уникальным и достаточно редким для веб-трафика. Например: corp.contoso.com.  
  
В новом лесу не требуются новые учетные данные для учетной записи администратора домена. Процесс повышения роли контроллера домена использует учетные данные встроенной учетной записи администратора из первого контроллера домена, который используется для создания корня леса. Нет способа (по умолчанию), чтобы отключить или заблокировать встроенную учетную запись администратора, и она может быть единственной точкой входа в лес, если другие учетные записи администраторов домена использовать невозможно. Очень важно знать пароль перед развертыванием нового леса.  
  
**Имя_домена** требует допустимое полное доменное имя DNS-сервера и не требуется.  
  
#### <a name="domain-controller-options"></a>Параметры контроллера домена  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_DCOptions_Forest.gif)  
  
**Параметры контроллера домена** позволяет настраивать **режим работы леса** и **функциональный уровень домена** для нового корневого домена леса. По умолчанию эти параметры, Windows Server 2012 в новом корневом домене леса. Режим работы леса Windows Server 2012 не предоставляет никаких новых функциональных возможностей по сравнению с Windows Server 2008 R2 режим работы леса. Режим работы домена Windows Server 2012 необходим только для использования новых параметров Kerberos «всегда предоставлять утверждения» и «Отказывать незащищенным проверкам подлинности». Основное назначение режимов работы в Windows Server 2012 — ограничение участия в контроллеры домена для домена, которые удовлетворяют требованиям к минимальной допустимой операционной системы. Другими словами можно указать, что Windows Server 2012 домена функционального уровня только для контроллеров домена под управлением Windows Server 2012 можно размещать домена.  Windows Server 2012 реализован новый флаг контроллера домена под названием **DS_WIN8_REQUIRED** в **DSGetDcName** функции NetLogon, который контроллеры домена Windows Server 2012. Это позволяет гибко более создавать однородные или разнородные леса с учетом операционных систем могут быть запущены на контроллерах домена.  
  
Дополнительные сведения о расположении контроллеров домена, просмотрите [функции службы каталогов](https://msdn.microsoft.com/library/ms675900(VS.85).aspx).  
  
Только настраиваемой возможностью контроллера домена является DNS-сервера. Корпорация Майкрософт рекомендует, чтобы все контроллеры домена предоставляли службы DNS для обеспечения высокой доступности в распределенных средах, поэтому этот параметр выбран по умолчанию при установке контроллера домена в любом режиме или домене. Глобальный каталог и чтения только параметры контроллера домена недоступны при создании нового корневого домена леса; Первый контроллер домена должен быть глобальным Каталогом и не может быть единственным контроллером домена чтения (RODC).  
  
Указанный **пароль режима восстановления служб каталогов** должен соответствовать политике паролей, действующей для сервера, которая по умолчанию не требует надежного пароля — Допускается любой непустой пароль. Всегда выбирайте надежный, сложный пароль, предпочтительно парольную фразу.  
  
#### <a name="dns-options-and-dns-delegation-credentials"></a>Параметры DNS и учетные данные для делегирования DNS  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestDNSOptions.png)  
  
**Параметры DNS** странице можно настроить делегирование DNS и указать альтернативные учетные данные администратора, DNS-сервера.  
  
Вы не можете настроить параметры или делегирование DNS в мастер настройки доменных служб Active Directory при установке нового леса корневого домена Active Directory где выбран **DNS-сервер** на **параметры контроллера домена** страницы. **Создать DNS-делегирование** доступен при создании корневой зоны DNS леса в существующей инфраструктуре DNS-серверов. Этот параметр позволяет указать альтернативные учетные данные администратора DNS с правами на обновление зоны DNS.  
  
Дополнительные сведения о необходимости создания делегирования DNS см. в разделе [общее представление о делегировании зоны](https://technet.microsoft.com/library/cc771640.aspx).  
  
#### <a name="additional-options"></a>Дополнительные параметры  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestAdditionalOptions.png)  
  
**Дополнительные параметры** страница отображает NetBIOS-имя домена и позволяет переопределить ее. По умолчанию, NetBIOS-имя домена совпадает с крайним левым метки полное доменное имя, содержащееся в **конфигурации развертывания** страницы. Например если указано полное доменное имя corp.contoso.com, NetBIOS-имя домена по умолчанию — CORP.  
  
Если имя не более 15 символов или меньше и не конфликтует с другим NetBIOS-именем, оно остается без изменений. Если оно конфликтует с другим NetBIOS-именем, к имени добавляется номер. Если имя более 15 символов, мастер предоставляет уникальный усеченный вариант. В любом случае мастер сначала проверяет имя еще не с помощью просмотра WINS и широковещательной рассылки NetBIOS.  
  
Дополнительные сведения о допустимых доменных именах см. статье БАЗЫ знаний [соглашения об именовании в Active Directory для компьютеров, доменов, узлов и подразделений](https://support.microsoft.com/kb/909264).  
  
#### <a name="paths"></a>Пути  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestPaths.png)  
  
**Пути** страницы позволяет переопределить расположение папок по умолчанию для базы данных AD DS, журналов транзакций базы данных и общего доступа к SYSVOL. Расположение по умолчанию, всегда в подкаталогах % systemroot % (т. е. C:\Windows).  
  
#### <a name="review-options-and-view-script"></a>Просмотрите параметры и просмотреть сценарий  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestReviewOptions.png)  
  
**Просмотреть параметры** странице можно проверить параметры и убедиться, они отвечают требованиям, прежде чем начать установку. Это последняя возможность прервать установку, при использовании диспетчера сервера. Это просто параметр, чтобы подтвердить параметры перед продолжением настройки  
  
**Просмотреть параметры** страницу в диспетчере сервера расположена дополнительная **просмотреть сценарий** кнопку, чтобы создать текстовый файл в кодировке Юникод, содержащего текущую конфигурацию развертывания ADDSDeployment в виде единого скрипта Windows PowerShell. Это позволяет использовать графический интерфейс диспетчера сервера в качестве студии развертывания Windows PowerShell. Используйте мастер настройки доменных служб Active Directory, чтобы настроить параметры, экспортировать конфигурацию и затем отменить мастер. Этого процесса создается допустимый и синтаксически верный образец для дальнейшего изменения или прямого использования. Например:  
  
```powershell 
#  
# Windows PowerShell Script for AD DS Deployment  
#  
  
Import-Module ADDSDeployment  
Install-ADDSForest `  
-CreateDNSDelegation `  
-DatabasePath "C:\Windows\NTDS" `  
-DomainMode "Win2012" `  
-DomainName "corp.contoso.com" `  
-DomainNetBIOSName "CORP" `  
-ForestMode "Win2012" `  
-InstallDNS:$true `  
-LogPath "C:\Windows\NTDS" `  
-NoRebootOnCompletion:$false `  
-SYSVOLPath "C:\Windows\SYSVOL"  
-Force:$true  
  
```  
  
> [!NOTE]  
> Диспетчер сервера обычно задает все значения аргументов при повышении роли, не зависит от значения по умолчанию (как они могут изменяться в будущих версиях Windows или пакетах обновления). Единственным исключением является **- safemodeadministratorpassword** аргумент (который намеренно опущен в скрипте). Для принудительного вывода запроса на подтверждение, не указывайте значение при интерактивном выполнении командлета.  
  
#### <a name="prerequisites-check"></a>Проверка готовности к установке  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestPrereqCheck.png)  
  
**Проверка предварительных требований** — это новая функция в конфигурации домена AD DS. На этом новом этапе проверяется конфигурации сервера возможность поддержки нового леса AD DS.  
  
При установке нового корневого домена леса, Server Manager Active Directory домена мастер настройки служб выполняет серию модульных тестов. Эти предлагаются рекомендуемые способы восстановления. Тесты можно выполнять необходимое число раз. Домен контроллера не может продолжаться, пока все проверки предварительных требований передачи.  
  
**Проверка предварительных требований** также поверхности важные сведения, такие как изменения безопасности, затрагивающих предыдущие операционные системы.  
  
Дополнительные сведения о проверках предварительных требований см. в разделе [проверка предварительных требований](../../ad-ds/manage/AD-DS-Simplified-Administration.md#BKMK_PrereuisiteChecking).  
  
#### <a name="installation"></a>Установка  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestInstallation.png)  
  
Когда **установки** отображает страницу, конфигурации контроллера домена начинается и невозможно остановить или отменить. Подробная информация об операциях выводится на этой странице и записывается в журналы:  
  
-   %systemroot%\debug\dcpromo.log  
  
-   %systemroot%\debug\dcpromoui.log  
  
> [!NOTE]  
> Из одной консоли диспетчера сервера можно одновременно запустить несколько мастеров установки роли и AD DS конфигурации.  
  
#### <a name="results"></a>Результаты  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_SMI_TR_ForestSignOff.png)  
  
**Результатов** странице отображается успешном или неудачном повышение роли, а также все важные данные администратора. Контроллер домена автоматически перезагрузится через 10 секунд.  
  
## <a name="BKMK_PSForest"></a>Развертывание леса с помощью Windows PowerShell  
В этом разделе описывается установка первого контроллера домена в корневом домене леса, с помощью Windows PowerShell на компьютере основных компонентов Windows Server 2012.  
  
### <a name="windows-powershell-ad-ds-role-installation-process"></a>Процесс установки роли доменных служб Active Directory в Windows PowerShell AD  
Включив несколько простых командлетов ServerManager в процесс развертывания, можно дополнительно понимаем, что службы AD DS упростить администрирование.  
  
Следующий рисунок иллюстрирует процесс установки роли доменных служб Active Directory, начиная с запуска **PowerShell.exe** и заканчивая моментом перед повышением роли контроллера домена.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/adds_servermanagerdeployment_powershell.png)  
  
|||  
|-|-|  
|Командлет ServerManager|Аргументы (**Полужирный** требуются аргументы. *Курсивом* аргументов можно указать с помощью Windows PowerShell или мастера настройки AD DS.)|  
|Install-WindowsFeature/Add-WindowsFeature|***-Имя***<br /><br />*-Перезапуска*<br /><br />*-IncludeAllSubFeature*<br /><br />*-IncludeManagementTools*<br /><br />-Источника<br /><br />*-ComputerName*<br /><br />-Credential<br /><br />-LogPath<br /><br />*-Vhd*<br /><br />*Параметр-ConfigurationFilePath*|  
  
> [!NOTE]  
> Время не требуется, аргумент **- IncludeManagementTools** настоятельно рекомендуется использовать при установке двоичных файлов роли AD DS  
  
Модуль ServerManager предоставляет роли установки, состояние и удалению частям нового модуля DISM для Windows PowerShell. Такая структура упрощает большинство задач и уменьшает потребность в прямом использовании эффективного (но опасного при неправильном применении) модуля DISM.  
  
Используйте **Get-Command** для экспорта псевдонимов и командлетов ServerManager.  
  
```powershell  
Get-Command -module ServerManager  
```  
  
Например:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSGetCommand.png)  
  
Чтобы добавить роль доменных служб Active Directory, просто выполните **Install-WindowsFeature** с именем роли AD DS в качестве аргумента. Как диспетчер серверов автоматически устанавливать все службы, необходимые для роли AD DS.  
  
```powershell  
Install-WindowsFeature -name AD-Domain-Services  
```  
  
Если требуется установить - средства управления AD DS, настоятельно рекомендуется - затем указать **- IncludeManagementTools** аргумента:  
  
```powershell  
Install-WindowsFeature -name AD-Domain-Services -IncludeManagementTools  
```  
  
Например:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallWinFeature.png)  
  
Для получения списка всех компонентов и ролей с состоянием их установки, используйте **Get-WindowsFeature** без аргументов. Укажите **- ComputerName** аргумент состояние установки с удаленного сервера.  
  
```powershell  
Get-WindowsFeature  
```  
  
Так как **Get-WindowsFeature** нет фильтрации механизм, необходимо использовать **Where-Object** с помощью конвейера, чтобы найти определенные компоненты. Конвейер — это канал между несколькими командлетами для обмена данными, а командлет Where-Object выступает в качестве фильтра. Встроенный **$_** переменная действует как текущий объект, передаваемый через конвейер со всеми свойствами, оно может содержать.  
  
```powershell  
Get-WindowsFeature | where-object <options>  
```  
  
Например, чтобы найти все возможности содержащего» Active Dir» их **отображаемое имя** свойство, используйте:  
  
```powershell  
Get-WindowsFeature | where displayname -like "*active dir*"  
```  
  
Ниже приведены дополнительные примеры:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSGetWindowsFeature.png)  
  
Дополнительные сведения о других операциях Windows PowerShell с конвейерами и Where-Object см. в разделе [конвейерная передача и конвейер в Windows PowerShell](https://technet.microsoft.com/library/ee176927.aspx).  
  
Обратите внимание, что Windows PowerShell 3.0 значительно упростились аргументы командной строки, необходимые для выполнения этой конвейерной операции. Windows PowerShell 2.0 потребовалась бы:  
  
```powershell  
Get-WindowsFeature | where {$_.displayname - like "*active dir*"}  
```  
  
С помощью конвейера Windows PowerShell, можно создать для восприятия результаты. Например:  
  
```powershell  
Install-WindowsFeature | Format-List  
Install-WindowsFeature | select-object | Format-List  
  
```  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallADDS.png)  
  
Примечание как использование **Select-Object** командлет с **- expandproperty** аргумент возвращает интересные данные:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallADDSWithTools.png)  
  
> [!NOTE]  
> **Select-Object - expandproperty** аргумент немного снижает общую производительность установки.  
  
### <a name="BKMK_PS"></a>Создание корневого домена леса доменных служб Active Directory AD с помощью Windows PowerShell  
Чтобы установить новый лес Active Directory, с помощью модуля ADDSDeployment, используйте следующий командлет:  
  
```powershell  
Install-addsforest  
```  
  
**Install-AddsForest** командлет включает только два этапа (проверка предварительных требований и установка). На двух иллюстрациях ниже показан этап установки с единственным необходимым аргументом **- domainname**.  
  
|||  
|-|-|  
|Командлет ADDSDeployment|Аргументы (**Полужирный** требуются аргументы. *Курсивом* аргументов можно указать с помощью Windows PowerShell или мастера настройки AD DS.)|  
|Install-Addsforest|-Подтверждения<br /><br />*-CreateDNSDelegation*<br /><br />*-DatabasePath*<br /><br />*-DomainMode*<br /><br />***-DomainName***<br /><br />***-DomainNetBIOSName***<br /><br />*-DNSDelegationCredential*<br /><br />*-ForestMode*<br /><br />-Force<br /><br />*-InstallDNS*<br /><br />*-LogPath*<br /><br />-NoDnsOnNetwork<br /><br />-NoRebootOnCompletion<br /><br />*-SafeModeAdministratorPassword*<br /><br />-SkipAutoConfigureDNS<br /><br />-SkipPreChecks<br /><br />*-SYSVOLPath*<br /><br />*-Whatif*|  
  
> [!NOTE]  
> **- DomainNetBIOSName** аргумент является обязательным, если требуется изменить 15-значное имя, созданное автоматически на основе префикса имени домена DNS или если длина имени превышает 15 символов.  
  
Эквивалент диспетчера сервера **конфигурации развертывания** ADDSDeployment командлет и аргументы:  
  
```powershell  
Install-ADDSForest  
-DomainName <string>  
```  
  
Эквивалентные аргументы командлета ADDSDeployment домена контроллера параметры для сервера диспетчер являются:  
  
```powershell  
-ForestMode <{Win2003 | Win2008 | Win2008R2 | Win2012 | Default}>  
-DomainMode <{Win2003 | Win2008 | Win2008R2 | Win2012 | Default}>  
-InstallDNS <{$false | $true}>  
-SafeModeAdministratorPassword <secure string>  
  
```  
  
**Install-ADDSForest** аргументы выполните того же значения по умолчанию в диспетчере сервера, если не указано.  
  
**SafeModeAdministratorPassword** аргумента действует особым:  
  
-   Если *не указан* аргумента, командлет предлагает ввести и подтвердить Скрытый пароль. Это предпочтительный вариант использования при интерактивном выполнении командлета.  
  
    Например чтобы создать новый лес с именем corp.contoso.com с выводом запроса на ввод и подтверждение скрытого пароля:  
  
    ```powershell  
    Install-ADDSForest "DomainName corp.contoso.com  
    ```  
  
-   Если указан *со значением*, значение должно быть защищенной строкой. Это не является предпочтительным при интерактивном выполнении командлета.  
  
Например, можно вручную ввести запрос пароля с помощью **Read-Host** командлету предложить пользователю ввести защищенную строку:  
  
```powershell  
-safemodeadministratorpassword (read-host -prompt "Password:" -assecurestring)  
```  
  
> [!WARNING]  
> Поскольку в предыдущем варианте пароль не подтверждается, соблюдайте повышенную осторожность: пароль невидим.  
  
Можно также ввести защищенную строку в переменной с преобразованным открытым текстом, хотя это не рекомендуется.  
  
```powershell  
-safemodeadministratorpassword (convertto-securestring "Password1" -asplaintext -force)  
```  
  
Наконец можно сохранить Скрытый пароль в файле и затем использовать его повторно, никогда не отображая пароль открытым текстом. Например:  
  
```powershell  
$file = "c:\pw.txt"  
$pw = read-host -prompt "Password:" -assecurestring  
$pw | ConvertFrom-SecureString | Set-Content $file  
  
-safemodeadministratorpassword (Get-Content $File | ConvertTo-SecureString)  
  
```  
  
> [!WARNING]  
> Ввод или хранение пароля в виде открытого или скрытого текста не рекомендуется. Любой пользователь, выполняющий эту команду в сценарии или заглядывающий через ваше плечо, сможет узнать пароль DSRM этого доменного контроллера. Все, кто имеет доступ к файлу, сможет восстановить Скрытый пароль. Зная пароль они могут войти в контроллер домена запущен в режиме DSRM и персонифицировать сам контроллер домена, повысив уровень собственных привилегий самый высокий уровень в лесу Active Directory. Дополнительный набор действия, используя **System.Security.Cryptography** для шифрования текстового файла данных рекомендуется, но вне области действия. Рекомендуется полностью отказаться от хранения паролей.  
  
Командлет ADDSDeployment предлагает дополнительную возможность пропустить автоматическую настройку параметров DNS-клиента, серверов пересылки и корневых ссылок. При использовании диспетчера сервера пропустить эту настройку нельзя. Этот аргумент имеет значение только в том случае, если установлена роль DNS-сервера до настройки контроллера домена:  
  
```powershell  
-SkipAutoConfigureDNS  
```  
  
**DomainNetBIOSName** также действует особым:  
  
-   Если **DomainNetBIOSName** аргумент не задано NetBIOS-имя домена и имя домена однокомпонентного в **DomainName** превышает 15 символов, а затем повышение роли продолжает выполняться с использованием автоматически созданного имени.  
  
-   Если **DomainNetBIOSName** аргумент не задано NetBIOS-имя домена и имя домена однокомпонентного в **DomainName** превышает 16 символов, происходит сбой повышения роли.  
  
-   Если **DomainNetBIOSName** аргумент указан с помощью NetBIOS-имя домена длиной не более 15 символов, а затем повышение роли продолжает выполняться с использованием указанного имени.  
  
-   Если **DomainNetBIOSName** аргумент задано NetBIOS-имя домена 16 символов или более, происходит сбой повышения роли.  
  
— Server Manager Дополнительные параметры командлета addsdeployment, эквивалентные:  
  
```powershell  
-domainnetbiosname <string>  
```  
  
Эквивалент диспетчера сервера **пути** аргументы командлета ADDSDeployment:  
  
```powershell  
-databasepath <string>  
-logpath <string>  
-sysvolpath <string>  
  
```  
  
Используйте дополнительный **Whatif** аргумент с **Install-ADDSForest** для просмотра сведений о конфигурации. Это позволяет просмотреть явные и неявные значения аргументов командлета.  
  
Например:  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSPaths.png)  
  
Нельзя **проверка готовности к установке** при с помощью диспетчера сервера, но вы можете пропустить при использовании командлета развертывания AD DS, с помощью следующего аргумента:  
  
```powershell  
-skipprechecks  
```  
  
> [!WARNING]  
> Корпорация Майкрософт не рекомендует пропускать проверку предварительных требований, так как это может привести к повышению роли контроллера домена частичная или повреждению леса AD DS.  
  
Обратите внимание, что так же, как диспетчер сервера **Install-ADDSForest** напоминает о том, что повышения уровня сервер автоматически перезагрузится.  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSReboot.png)  
  
![Установка нового леса](media/Install-a-New-Windows-Server-2012-Active-Directory-Forest--Level-200-/ADDS_PSInstallProgress.png)  
  
Чтобы напоминание о перезагрузке автоматически, используйте **-принудительно** или **-подтверждение: $false** аргументы с любым командлетом ADDSDeployment Windows PowerShell. Чтобы предотвратить автоматическую перезагрузку по завершении повышения роли сервера, используйте **- norebootoncompletion** аргумент.  
  
> [!WARNING]  
> Отключать перезагрузку не рекомендуется. Для правильной работы контроллер домена должен перезагрузиться.  
  
## <a name="see-also"></a>См. также:  
[Доменные службы Active Directory (портал TechNet)](https://technet.microsoft.com/library/cc770946(WS.10).aspx)  
[Доменные службы Active Directory для Windows Server 2008 R2](https://technet.microsoft.com/library/dd378801(WS.10).aspx)  
[Доменные службы Active Directory для Windows Server 2008](https://technet.microsoft.com/library/dd378891(WS.10).aspx)  
[Технический справочник по Windows Server (Windows Server 2003)](https://technet.microsoft.com/library/cc739127(WS.10).aspx)  
[Центр администрирования Active Directory: Начало работы (Windows Server 2008 R2)](https://technet.microsoft.com/library/dd560651(WS.10).aspx)  
[Администрирование Active Directory с помощью Windows PowerShell (Windows Server 2008 R2)](https://technet.microsoft.com/library/dd378937(WS.10).aspx)  
[Попросите команды разработчиков служб каталогов (официальный Microsoft Commercial блог технической поддержки)](http://blogs.technet.com/b/askds)  
  

