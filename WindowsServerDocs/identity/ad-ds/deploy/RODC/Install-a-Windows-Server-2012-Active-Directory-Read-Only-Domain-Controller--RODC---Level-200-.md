---
ms.assetid: 66fa945e-598d-4f18-b603-97a39ce0d836
title: Установка контроллера домена только для чтения (RODC) Active Directory в Windows Server 2012 (уровень 200)
description: В этом разделе описывается, как поэтапно создать учетную запись контроллера домена только для чтения (RODC), а затем подключить к ней сервер во время установки RODC. В нем также объясняется, как установить учетную запись только для чтения, не выполняя поэтапную установку.
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: dd3cc1c112560e77d0ab166ffb10a677b62f32e8
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80825487"
---
# <a name="install-a-windows-server-2012-active-directory-read-only-domain-controller-rodc-level-200"></a>Установка контроллера домена только для чтения (RODC) Active Directory в Windows Server 2012 (уровень 200)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе описывается, как поэтапно создать учетную запись контроллера домена только для чтения (RODC), а затем подключить к ней сервер во время установки RODC. В нем также объясняется, как установить учетную запись только для чтения, не выполняя поэтапную установку.  
  
## <a name="stage-rodc-workflow"></a>Рабочий процесс поэтапной установки RODC  
Поэтапная установка контроллера домена только для чтения (RODC) состоит из двух отдельных этапов:  
  
1.  подготовка незанятой учетной записи компьютера;  
  
2.  подключение контроллера домена только для чтения к этой учетной записи во время повышения роли.  
  
На схеме ниже показан процесс поэтапного создания контроллера домена только для чтения в доменных службах Active Directory, при котором пустая учетная запись компьютера RODC создается в домене с помощью центра администрирования Active Directory (Dsac.exe).  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/adds_stagedcreation.png)  
  
## <a name="stage-rodc-windows-powershell"></a><a name=BKMK_StagePS></a>Этап Windows PowerShell для RODC  
  
|||  
|-|-|  
|**Командлет ADDSDeployment**|Аргументы (аргументы, выделенные**жирным шрифтом** , являются обязательными. Аргументы, выделенные*курсивом* , можно указать с помощью Windows PowerShell или мастера настройки доменных служб Active Directory).|  
|Add-addsreadonlydomaincontrolleraccount|-SkipPreChecks<p>***-Домаинконтроллераккаунтнаме***<p>***-Имя_домена***<p>***-SiteName***<p>*-Алловпассвордрепликатионаккаунтнаме*<p>***-Credential***<p>*-Делегатедадминистратораккаунтнаме*<p>*-Денипассвордрепликатионаккаунтнаме*<p>*-Ноглобалкаталог*<p>*-Инсталлднс*<p>-ReplicationSourceDC|  
  
> [!NOTE]  
> Аргумент **-credential** является обязательным только в том случае, если вы на данный момент не вошли в систему как член группы администраторов домена.  
  
## <a name="attach-rodc-workflow"></a>Рабочий процесс подключения RODC  
На схеме ниже показан процесс настройки доменных служб Active Directory. Предполагается, что вы уже установили роль доменных служб Active Directory, подготовили учетную запись RODC и запустили процесс **Повысить роль этого сервера до уровня контроллера домена** с помощью диспетчера сервера для создания контроллера RODC в существующем домене и его подключения к промежуточной учетной записи компьютера.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/adds_stageddeploy_beta1.png)  
  
## <a name="attach-rodc-windows-powershell"></a><a name=BKMK_AttachPS></a>Подключение RODC Windows PowerShell  
  
|||  
|-|-|  
|**Командлет ADDSDeployment**|Аргументы (аргументы, выделенные**жирным шрифтом** , являются обязательными. Аргументы, выделенные*курсивом* , можно указать с помощью Windows PowerShell или мастера настройки доменных служб Active Directory).|  
|Install-AddsDomaincontroller|-SkipPreChecks<p>***-Имя_домена***<p>*-SafeModeAdministratorPassword*<p>*-Аппликатионпартитионсторепликате*<p>*-Креатеднсделегатион*<p>***-Credential***<p>-CriticalReplicationOnly<p>*-DatabasePath*<p>*-Днсделегатионкредентиал*<p>*-Инсталлатионмедиапас*<p>*-LogPath*<p>-Norebootoncompletion<p>*-Репликатионсаурцедк*<p>*-Системкэй*<p>*-Сисволпас*<p>***-Усиксистингаккаунт***|  
  
> [!NOTE]  
> Аргумент **-credential** является обязательным только в том случае, если вы на данный момент не вошли в систему как член группы администраторов домена.  
  
## <a name="staging"></a>Промежуточный  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_PreCreateRODC.png)  
  
Чтобы выполнить поэтапное создание учетной записи компьютера для контроллера домена только для чтения, откройте центр администрирования Active Directory (**Dsac.exe**). На панели навигации щелкните имя домена. В списке управления дважды щелкните элемент **Контроллеры домена**. На панели задач щелкните **Предварительное создание учетной записи контроллера домена только для чтения**.  
  
Дополнительные сведения о центр администрирования Active Directory см. в разделе [Расширенное управление AD DS с &#40;помощью центр администрирования Active Directory&#41; уровня 200](../../../ad-ds/get-started/adac/Advanced-AD-DS-Management-Using-Active-Directory-Administrative-Center--Level-200-.md) и просмотрите [центр администрирования Active Directory: Начало работы](https://technet.microsoft.com/library/dd560651(WS.10).aspx).  
  
Если у вас есть опыт создания контроллеров домена только для чтения, вы заметите, что мастер установки имеет такой же графический интерфейс, что и оснастка "Пользователи и компьютеры Active Directory" в Windows Server 2008, и в нем используется такой же код, включая экспорт конфигурации в формате файла автоматической установки, используемом устаревшим средством dcpromo.  
  
В Windows Server 2012 появился новый командлет ADDSDeployment для поэтапного создания учетных записей компьютеров RODC, однако при выполнении мастера он не используется. В следующих разделах приводится эквивалентный командлет и его аргументы, что позволит лучше понять связанную с ними информацию.  
  
Ссылка " **предварительное создание учетной записи контроллера домена только для чтения** " в области задач центр администрирования Active Directory эквивалентна командлету Windows PowerShell аддсдеплоймент:  
  
```  
Add-addsreadonlydomaincontrolleraccount  
  
```  
  
### <a name="welcome"></a>Приветствие  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_WelcomeStage1.png)  
  
В диалоговом окне **Вас приветствует мастер установки доменных служб Active Directory** есть один параметр под названием **Использовать расширенный режим установки**. Выберите его и нажмите кнопку **Далее**, чтобы просмотреть параметры политики репликации паролей. Чтобы использовать значения по умолчанию для параметров политики репликации паролей (рассматриваются подробнее далее в этом разделе), отключите этот параметр.  
  
### <a name="network-credentials"></a>Сетевые учетные данные  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1Creds.png)  
  
В диалоговом окне **Сетевые учетные данные** в поле доменного имени указан целевой домен по умолчанию для центра администрирования Active Directory. По умолчанию используются ваши текущие учетные данные. Если они не входят в группу администраторов домена, установите переключатель в положение **Альтернативные учетные данные** и нажмите кнопку **Задать**, чтобы предоставить мастеру имя пользователя и пароль члена группы "Администраторы домена".  
  
Эквивалентный аргумент Windows PowerShell ADDSDeployment:  
  
```  
-credential <pscredential>  
```  
  
Имейте в виду, что система поэтапного создания была напрямую перенесена из Windows Server 2008 R2 и не предоставляет новых функциональных возможностей Adprep. Если вы планируете развертывать поэтапно создаваемые учетные записи RODC, необходимо предварительно развернуть в этом домене контроллер RODC без поэтапного создания, что позволит автоматически выполнять операцию rodcprep, или вручную выполнить команду adprep.exe /rodcprep.  
  
В противном случае появится сообщение об ошибке, в котором не удастся установить контроллер домена только для чтения в этом домене, так как программа Adprep/родкпреп еще не запущена.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCPrepNotRunError.png)  
  
### <a name="specify-the-computer-name"></a>Задайте имя компьютера  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1CompName.png)  
  
В диалоговом окне **Задайте имя компьютера** необходимо ввести однокомпонентное **имя компьютера** для домена контроллера, которое еще не используется. Контроллер домена, который вы настроите и подключите к этой учетной записи позднее, должен иметь это же имя. В противном случае операции повышения роли не удастся обнаружить промежуточную учетную запись.  
  
Эквивалентный аргумент Windows PowerShell ADDSDeployment:  
  
```  
-domaincontrolleraccountname <string>  
```  
  
### <a name="select-a-site"></a>Выбор сайта  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1Site.png)  
  
В диалоговом окне **Выберите сайт** приводится список сайтов Active Directory для текущего леса. Операция поэтапного создания контроллера домена только для чтения требует выбора одного сайта из списка. Контроллер RODC использует эту информацию для создания собственного объекта параметров NTDS в разделе конфигурации и подключения к соответствующему сайту при первом запуске после развертывания.  
  
Эквивалентный аргумент Windows PowerShell ADDSDeployment:  
  
```  
-sitename <string>  
```  
  
### <a name="additional-domain-controller-options"></a>Дополнительные параметры контроллера домена  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1DCOptions.png)  
  
В диалоговом окне **Дополнительные параметры контроллера домена** можно указать, что контроллер домена должен также выступать в роли **DNS-сервера** и **глобального каталога**. Корпорация Майкрософт рекомендует использовать контроллеры домена только для чтения для предоставления служб DNS и глобального каталога, поэтому обе эти роли устанавливаются по умолчанию. Одно из предназначений роли RODC — сценарии использования в филиалах, в которых глобальная сеть может быть недоступна, а без служб DNS и глобального каталога компьютеры филиала не смогут использовать ресурсы и функциональные возможности доменных служб Active Directory.  
  
Параметр **Контроллер домена только для чтения (RODC)** выбран по умолчанию, и отключить его нельзя. Эквивалентные аргументы Windows PowerShell ADDSDeployment:  
  
```  
-installdns <string>  
-NoGlobalCatalog <{$true | $false}>  
  
```  
  
> [!NOTE]  
> По умолчанию параметр **-ноглобалкаталог** имеет значение $false. Это означает, что контроллер домена будет сервером глобального каталога, если аргумент не указан.  
  
### <a name="specify-the-password-replication-policy"></a>Задайте политику репликации паролей  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1PRP.png)  
  
Диалоговое окно **Задайте политику репликации паролей** позволяет изменить список учетных записей по умолчанию, которым разрешено кэшировать пароли в этом контроллере домена только для чтения. Учетные записи, для которых в списке задано значение **Запретить** или которые отсутствуют в списке (неявный запрет), не кэшируют свои пароли. Учетные записи, которым не разрешено кэшировать пароли в контроллере RODC и которые не могут подключиться к доступному для записи контроллеру домена для проверки подлинности, не имеют доступа к ресурсам и функциональным возможностям Active Directory.  
  
> [!IMPORTANT]  
> Это диалоговое окно мастера выводится только в том случае, если на экране приветствия был установлен флажок **Использовать расширенный режим установки**. Если этот флажок снят, то в мастере используются следующие группы и значения по умолчанию:  
>   
> -   Администраторы — Запретить  
> -   Операторы сервера — Запретить  
> -   Операторы архива — Запретить  
> -   Операторы учета — Запретить  
> -   Группа с запрещением репликации паролей RODC — Запретить  
> -   Группа с разрешением репликации паролей RODC — Разрешить  
  
Эквивалентные аргументы Windows PowerShell ADDSDeployment:  
  
```  
-allowpasswordreplicationaccountname <string []>  
-denypasswordreplicationaccountname <string []>  
```  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1PRPAllow.png)  
  
### <a name="delegation-of-rodc-installation-and-administration"></a>Делегирование установки и администрирования RODC  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1DelegateAdmin.png)  
  
Диалоговое окно **Делегирование установки и администрирования RODC** позволяет настроить пользователя, которому разрешено подключать сервер к учетной записи компьютера RODC, или группу таких пользователей. Чтобы выбрать пользователя или группу в домене, нажмите кнопку **Задать**. Пользователь или группа, указанные в этом диалоговом окне, получают доступ к RODC с разрешениями локального администратора. Указанный пользователь или члены указанной группы могут выполнять операции на RODC с привилегиями, эквивалентными группе администраторов компьютера. Они *не* являются членами группы администраторов домена или встроенной группы "Администраторы" домена.  
  
С помощью этого параметра можно делегировать права на администрирование филиала, не предоставляя администраторам филиала членство в группе администраторов домена. Делегировать администрирование RODC необязательно.  
  
Эквивалентный аргумент Windows PowerShell ADDSDeployment:  
  
```  
-delegatedadministratoraccountname <string>  
```  
  
### <a name="summary"></a>Сводка  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1Summary.png)  
  
Диалоговое окно **Сводка** позволяет подтвердить параметры. Это последняя возможность прервать установку, прежде чем мастер создаст промежуточную учетную запись. Когда вы будете готовы создать промежуточную учетную запись компьютера RODC, нажмите кнопку **Далее**.  Чтобы сохранить файл ответов в устаревшем формате файла автоматической установки dcpromo, нажмите кнопку **Экспорт параметров**.  
  
### <a name="creation"></a>Создание  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1InstallProgress.png)  
  
**Мастер установки доменных служб Active Directory** поэтапно создает контроллер домена только для чтения в Active Directory. Отменить эту операцию после того, как она началась, нельзя.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage1Complete.png)  
  
Чтобы поэтапно создать учетную запись компьютера для контроллера домена только для чтения с помощью модуля Windows PowerShell ADDSDeployment, используйте следующий командлет:  
  
```  
Add-addsreadonlydomaincontrolleraccount  
  
```  
  
Список обязательных и необязательных аргументов см. в разделе [Поэтапная установка RODC с помощью Windows PowerShell](../../../ad-ds/deploy/RODC/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-.md#BKMK_StagePS).  
  
Так как командлет **Add-addsreadonlydomaincontrolleraccount** выполняет только одно действие, состоящее из двух этапов (проверка необходимых условий и установка), на приведенных ниже снимках экрана показан этап установки с минимальными необходимыми аргументами.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSAddRODC.png)  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSAddRODCValidating.png)  
  
Операция поэтапной установки контроллера RODC создает учетную запись компьютера RODC в Active Directory. В центре администрирования Active Directory свойство **Тип контроллера домена** имеет значение **Незанятая учетная запись контроллера домена**. Этот тип контроллера домена указывает на то, что промежуточная учетная запись RODC готова к подключению сервера в качестве контроллера домена только для чтения.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Unoccupied.png)  
  
> [!IMPORTANT]  
> Центр администрирования Active Directory больше не нужен для подключения сервера к учетной записи контроллера домена только для чтения. Чтобы подключить контроллер RODC к промежуточной учетной записи, используйте диспетчер сервера и мастер настройки доменных служб Active Directory или командлет **Install-AddsDomainController** из модуля Windows PowerShell ADDSDeployment. Порядок действий при этом тот же, что и при добавлении нового доступного для чтения контроллера домена в существующий домен, за тем исключением, что предварительно подготовленная учетная запись RODC содержит параметры конфигурации, заданные при поэтапном создании учетной записи компьютера RODC.  
  
## <a name="attaching"></a>присоединения  
  
### <a name="deployment-configuration"></a>Deployment Configuration  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCDeployConfig.png)  
  
Повышение роли каждого контроллера домена начинается в диспетчере сервера на странице **Конфигурация развертывания** . Оставшиеся параметры и обязательные поля меняются на этой и последующих страницах в зависимости от того, какая операция развертывания выбрана.  
  
Чтобы добавить контроллер домена только для чтения в существующий домен, установите переключатель в положение **Добавить контроллер домена в существующий домен** и нажмите кнопку **Выбрать** в разделе **Укажите сведения о домене для этой операции**. Диспетчер сервера автоматически запросит у вас действительные учетные данные. Вы также можете нажать кнопку **Изменить**.  
  
Для подключения контроллера RODC необходимо членство в группе администраторов домена в Windows Server 2012. Мастер настройки доменных служб Active Directory позднее выдает предупреждение, если у текущих учетных данных нет соответствующих разрешений или если они не включены в группы.  
  
Командлет и аргументы для управления **конфигурацией развертывания** в модуле Windows PowerShell ADDSDeployment:  
  
```  
Install-AddsDomainController  
-domainname <string>   
-credential <pscredential>  
```  
  
### <a name="domain-controller-options"></a>Параметры контроллера домена  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2DCOptions.png)  
  
На странице **Параметры контроллера домена** показаны параметры нового контроллера домена. При загрузке этой страницы мастер настройки доменных служб Active Directory отправляет существующему контроллеру домена запрос LDAP для проверки незанятых учетных записей. Если запрос находит незанятую учетную запись компьютера контроллера домена, имеющую то же имя, что и текущий компьютер, мастер выводит информационное сообщение в верхней части страницы, которое считывает **предварительно созданную учетную запись RODC, совпадающую с именем целевого сервера, существует в каталоге. Выберите, следует ли использовать существующую учетную запись RODC или переустановите этот контроллер домена**. По умолчанию в мастере используется параметр **Использовать существующую учетную запись RODC**.  
  
> [!IMPORTANT]  
> Если в контроллере домена произошла физическая неполадка и он не может восстановить работоспособность, вы можете использовать параметр **Переустановить этот контроллер домена**. Это позволит сэкономить время при настройке контроллера домена для замены благодаря тому, что учетная запись компьютера контроллера домена и метаданные объекта остаются в Active Directory. Установите новый компьютер с *тем же именем* повысьте его роль до контроллера домена. Параметр **переустановить этот контроллер домена** недоступен, если метаданные объекта контроллера домена удалены из Active Directory (очистка метаданных).  
  
Настроить параметры контроллера домена при подключении сервера к учетной записи компьютера RODC нельзя. Параметры контроллера домена настраиваются при создании предварительно подготовленной учетной записи компьютера RODC.  
  
Указанный **пароль для режима восстановления служб каталогов** должен соответствовать политике паролей, действующей для сервера. Необходимо всегда выбирать надежный и сложный пароль, предпочтительно парольную фразу.  
  
Аргументы Windows PowerShell ADDSDeployment, эквивалентные параметрам на странице **Параметры контроллера домена**:  
  
```  
-UseExistingAccount <{$true | $false}>  
-SafeModeAdministratorPassword <secure string>  
```  
  
> [!IMPORTANT]  
> Имя сайта уже должно существовать на момент ввода в качестве аргумента для **-sitename**. Командлет **install-AddsDomainController** не создает имена сайтов. Для создания сайтов можно использовать командлет **new-adreplicationsite**.  
  
Если аргументы **Install-ADDSDomainController** не заданы, они имеют те же значения по умолчанию, что и параметры в диспетчере сервера.  
  
Аргумент **SafeModeAdministratorPassword** действует особым образом.  
  
-   Если этот аргумент *не указан* , командлет предлагает ввести и подтвердить скрытый пароль. Это предпочтительный вариант использования при интерактивном выполнении командлета.  
  
    Например, чтобы создать контроллер RODC в домене corp.contoso.com с выводом запроса на ввод и подтверждением скрытого пароля, выполните следующую команду:  
  
    ```  
    Install-ADDSDomainController -DomainName corp.contoso.com -credential (get-credential)  
    ```  
  
-   Если аргумент указан *со значением*, это значение должно быть защищенной строкой. Это не является предпочтительным вариантом использования при интерактивном выполнении командлета.  
  
Например, можно вручную ввести запрос пароля с помощью командлета **Read-Host**, чтобы запрашивать у пользователя ввод защищенной строки.  
  
```  
-safemodeadministratorpassword (read-host -prompt Password: -assecurestring)  
  
```  
  
> [!WARNING]  
> Поскольку в предыдущем варианте пароль не подтверждается, соблюдайте повышенную осторожность: пароль невидим.  
  
Можно также ввести защищенную строку в качестве переменной с преобразованным открытым текстом, хотя использовать такой вариант настоятельно не рекомендуется.  
  
```  
-safemodeadministratorpassword (convertto-securestring Password1 -asplaintext -force)  
```  
  
Наконец, можно сохранить скрытый пароль в файле, а затем использовать его повторно, никогда не отображая пароль в виде открытого текста. Например:  
  
```  
$file = c:\pw.txt  
$pw = read-host -prompt Password: -assecurestring  
$pw | ConvertFrom-SecureString | Set-Content $file  
  
-safemodeadministratorpassword (Get-Content $File | ConvertTo-SecureString)  
  
```  
  
> [!WARNING]  
> Ввод или хранение пароля в виде открытого или скрытого текста не рекомендуется. Любой пользователь, выполняющий эту команду в скрипты или заглядывающий через ваше плечо, сможет узнать пароль DSRM этого доменного контроллера.  Любой пользователь, имеющий доступ к файлу, сможет восстановить скрытый пароль. Зная пароль, он сможет войти в контроллер домена, запущенный в режиме восстановления служб каталогов, и персонифицировать сам контроллер домена, повысив уровень собственных привилегий в лесу Active Directory до максимального уровня. Рекомендуется выполнить дополнительные действия для шифрования данных текстового файла с помощью **System.Security.Cryptography**, однако их рассмотрение выходит за рамки этой статьи. Лучше всего полностью отказаться от хранения паролей.  
  
### <a name="additional-options"></a>Дополнительные параметры  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2AdditionalOptions.png)  
  
На странице **Дополнительные параметры** приводятся параметры конфигурации, позволяющие указать имя контроллера домена, используемого в качестве источника репликации.  
  
Также можно установить контроллер домена с помощью архивированных носителей, использовав параметр установки с носителя (IFM). При установке флажка **Установка с носителя** появляется возможность выбора носителя. Чтобы убедиться в том, что указанный путь является действительным путем к носителю, необходимо нажать кнопку **Проверить** .

Рекомендации для источника IFM:
*    Носитель, используемый параметром IFM, создается с cистема архивации данных Windows Server или Ntdsutil. exe из другого существующего контроллера домена Windows Server с той же версией операционной системы. Например, нельзя использовать Windows Server 2008 R2 или предыдущую операционную систему для создания носителя для контроллера домена Windows Server 2012.
*    Исходные данные IFM должны быть из контроллера домена с возможностью записи. Хотя источник из RODC технически будет работать для создания нового RODC, возникают ложные срабатывания предупреждений репликации, которые не реплицируются источником IFM RODC.

Подробнее об изменениях в IFM см. в разделе [Изменения, касающиеся установки с носителя с помощью Ntdsutil.exe](../../../ad-ds/deploy/Simplified-Administration-Appendix.md#BKMK_IFM). Если носители защищены SYSKEY, диспетчер сервера запрашивает пароль образа во время проверки. 
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_StagedIFM.png)  
  
Ниже перечислены аргументы командлета ADDSDeployment, эквивалентные параметрам на странице **Дополнительные параметры** .  
  
```  
-replicationsourcedc <string>  
-installationmediapath <string>  
-systemkey <secure string>  
```  
  
### <a name="paths"></a>Paths  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2Paths.png)  
  
Страница **Пути** позволяет переопределить расположение папок по умолчанию для базы данных AD DS, журналов транзакций базы данных и общего доступа к SYSVOL. Расположение по умолчанию всегда в подкаталогах %systemroot%. Аргументы командлета ADDSDeployment, эквивалентные параметрам на странице **Пути** :  
  
```  
-databasepath <string>  
-logpath <string>  
-sysvolpath <string>  
```  
  
### <a name="review-options-and-view-script"></a>"Просмотреть параметры" и "Просмотреть скрипт"  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2ReviewOptions.png)  
  
Страница **Просмотреть параметры** позволяет проверить параметры перед установкой и убедиться, что они отвечают требованиям. Позднее установку также можно будет остановить с помощью диспетчера сервера. Эта страница позволяет просмотреть и подтвердить параметры перед продолжением конфигурации. На странице **Просмотреть параметры** диспетчера сервера расположена дополнительная кнопка **Просмотреть скрипт** , предназначенная для создания текстового файла в кодировке Юникод, содержащего текущую конфигурацию развертывания ADDSDeployment в виде единого скрипта Windows PowerShell. Это позволяет использовать графический интерфейс диспетчера сервера в качестве студии развертывания Windows PowerShell. С помощью мастера настройки доменных служб Active Directory необходимо настроить параметры, экспортировать конфигурацию и затем отменить мастер. Во время этого процесса создается допустимый и синтаксически верный образец для дальнейшего изменения или прямого использования. Например:  
  
```  
#  
# Windows PowerShell Script for AD DS Deployment  
#  
  
Import-Module ADDSDeployment  
Install-ADDSDomainController `  
-Credential (Get-Credential) `  
-CriticalReplicationOnly:$false `  
-DatabasePath C:\Windows\NTDS `  
-DomainName corp.contoso.com `  
-LogPath C:\Windows\NTDS `  
-SYSVOLPath C:\Windows\SYSVOL `  
-UseExistingAccount:$true `  
-Norebootoncompletion:$false  
-Force:$true  
  
```  
  
> [!NOTE]  
> Диспетчер сервера обычно задает значения для всех аргументов при повышении роли, не полагаясь на значения по умолчанию (так как они могут изменяться в будущих версиях Windows или пакетах обновления). Единственным исключением является аргумент **-safemodeadministratorpassword** . Для принудительного вывода запроса на подтверждение не указывайте значение при интерактивном выполнении командлета.  
  
Для просмотра сведений о конфигурации воспользуйтесь необязательным аргументом **Whatif** с командлетом **Install-ADDSDomainController**. Это позволит просмотреть явные и неявные значения аргументов командлета.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2WhatIf.png)  
  
### <a name="prerequisites-check"></a>Проверка предварительных требований  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2PrereqCheck.png)  
  
**Проверка предварительных требований** — это новая функция настройки доменных служб Active Directory. На этом новом этапе проверяется возможность поддержки нового леса доменных служб Active Directory конфигурацией сервера.  
  
При установке нового корневого домена леса мастер настройки доменных служб Active Directory в диспетчере сервера последовательно выполняет серию модульных тестов. При этом предлагаются рекомендуемые способы восстановления. Тесты можно выполнять необходимое число раз. Установка контроллера домена не может продолжаться, пока все проверки предварительных требований не будут пройдены.  
  
На странице **Проверка предварительных требований** также приводится важная информация, например сведения об изменениях в системе безопасности, затрагивающих предыдущие операционные системы. Подробнее о проверках предварительных требований см. в разделе [Проверка предварительных требований](../../../ad-ds/manage/AD-DS-Simplified-Administration.md#BKMK_PrereuisiteChecking).  
  
При использовании диспетчера сервера пропустить **проверку предварительных требований** нельзя, однако это можно сделать при использовании командлета развертывания доменных служб Active Directory с помощью следующего аргумента:  
  
```  
-skipprechecks  
  
```  
  
> [!WARNING]  
> Корпорация Майкрософт не рекомендует пропускать проверку предварительных требований, так как это может привести к частичному повышению роли контроллера домена или повреждению леса Active Directory.  
  
Чтобы начать повышение роли контроллера домена, нажмите кнопку **Установить** . Это последняя возможность отменить установку. После того как процесс повышения роли начнется, отменить его будет невозможно. По завершении повышения роли компьютер автоматически перезагрузится вне зависимости от результата процесса.  
  
### <a name="installation"></a>Установка  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_Stage2Installation.png)  
  
При отображении страницы "Установка" начинается настройка доменного контроллера, которую невозможно остановить или отменить. Подробная информация об операциях выводится на этой странице и записывается в следующие журналы:  
  
-   %systemroot%\debug\dcpromo.log  
  
-   %systemroot%\debug\dcpromoui.log  
  
Чтобы установить новый лес Active Directory с помощью модуля ADDSDeployment, используйте следующий командлет:  
  
```  
Install-addsdomaincontroller  
  
```  
  
Список обязательных и необязательных аргументов см. в разделе [Подключение RODC с помощью Windows PowerShell](../../../ad-ds/deploy/RODC/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-.md#BKMK_AttachPS).  
  
Выполнение командлета **Install-addsdomaincontroller** включает только два этапа (проверка предварительных требований и установка). На двух иллюстрациях ниже показан этап установки с минимальным необходимым набором аргументов: **-domainname**, **-useexistingaccount** и **-credential**. Обратите внимание на то, что командлет **Install-ADDSDomainController**, как и диспетчер сервера, напоминает об автоматической перезагрузке сервера после повышения роли:  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSStage2.png)  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSStage2Complete.png)  
  
Чтобы автоматически закрывать напоминание о перезагрузке, используйте аргументы **-force** или **-confirm:$false** с любым командлетом Windows PowerShell ADDSDeployment. Чтобы предотвратить автоматическую перезагрузку сервера по завершении повышения роли, используйте аргумент **-norebootoncompletion** .  
  
> [!WARNING]  
> Отключать перезагрузку не рекомендуется. Для правильной работы контроллер домена должен перезагрузиться.  
  
### <a name="results"></a>Результаты  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_ForestSignOff.png)  
  
На странице **Результаты** показано, успешно ли было выполнено повышение роли, а также приводится важная для администраторов информация. Контроллер домена автоматически перезагрузится через 10 секунд.  
  
## <a name="rodc-without-staging-workflow"></a>Процесс создания RODC без предварительной подготовки  
На схеме показан процесс настройки доменных служб Active Directory. Предполагается, что вы ранее установили роль доменных служб Active Directory и запустили мастер настройки доменных служб Active Directory с помощью диспетчера сервера, чтобы создать контроллер домена только для чтения без предварительной подготовки в существующем домене Windows Server 2012.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/adds_rodcdeploy.png)  
  
## <a name="rodc-without-staging-windows-powershell"></a>Создание RODC без предварительной подготовки с помощью Windows PowerShell  
  
|||  
|-|-|  
|**Командлет ADDSDeployment**|Аргументы (аргументы, выделенные**жирным шрифтом** , являются обязательными. Аргументы, выделенные*курсивом* , можно указать с помощью Windows PowerShell или мастера настройки доменных служб Active Directory).|  
|Install-AddsDomainController|-SkipPreChecks<p>***-Имя_домена***<p>*-SafeModeAdministratorPassword*<p>***-SiteName***<p>*-Аппликатионпартитионсторепликате*<p>*-Креатеднсделегатион*<p>***-Credential***<p>*-Критикалрепликатиононли*<p>*-DatabasePath*<p>*-Днсделегатионкредентиал*<p>-DNSOnNetwork<p>*-Инсталлатионмедиапас*<p>*-Инсталлднс*<p>*-LogPath*<p>-MoveInfrastructureOperationMasterRoleIfNecessary<p>*-Ноглобалкаталог*<p>-Norebootoncompletion<p>*-Репликатионсаурцедк*<p>-SkipAutoConfigureDNS<p>*-Системкэй*<p>*-Сисволпас*<p>*-Алловпассвордрепликатионаккаунтнаме*<p>*-Делегатедадминистратораккаунтнаме*<p>*-Денипассвордрепликатионаккаунтнаме*<p>***-Реадонлиреплика***|  
  
> [!NOTE]  
> Аргумент **-credential** является обязательным только в том случае, если вы на данный момент не вошли в систему как член группы администраторов домена.  
  
## <a name="rodc-without-staging-deployment"></a>Развертывание RODC без предварительной подготовки  
  
### <a name="deployment-configuration"></a>Deployment Configuration  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCDeployConfig.png)  
  
Повышение роли каждого контроллера домена начинается в диспетчере сервера на странице **Конфигурация развертывания** . Оставшиеся параметры и обязательные поля меняются на этой и последующих страницах в зависимости от того, какая операция развертывания выбрана.  
  
Чтобы добавить контроллер домена только для чтения без предварительной подготовки в существующий домен Windows Server 2012, установите переключатель в положение **Добавить контроллер домена в существующий домен** и нажмите кнопку **Выбрать** в разделе **Укажите сведения о домене для этой операции**. Диспетчер сервера автоматически запросит у вас действительные учетные данные. Вы также можете нажать кнопку **Изменить**.  
  
Для подключения контроллера RODC необходимо членство в группе администраторов домена в Windows Server 2012. Мастер настройки доменных служб Active Directory позднее выдает предупреждение, если у текущих учетных данных нет соответствующих разрешений или если они не включены в группы.  
  
Командлет и аргументы для управления **конфигурацией развертывания** в модуле Windows PowerShell ADDSDeployment:  
  
```  
Install-AddsDomainController  
-domainname <string>   
-credential <pscredential>  
```  
  
### <a name="domain-controller-options"></a>Параметры контроллера домена  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCDCOptions.png)  
  
На странице **Параметры контроллера домена** показаны возможности настройки нового контроллера домена. Они включают в себя **DNS-сервер**, **Глобальный каталог** и **Контроллер домена только для чтения**. Корпорация Майкрософт рекомендует, чтобы все контроллеры домена предоставляли службы DNS и глобального каталога для обеспечения высокой доступности в распределенных средах. Глобальный каталог всегда выбран по умолчанию, а DNS-сервер выбран по умолчанию в том случае, если в текущем домене уже размещены службы DNS в контроллерах домена на основе запроса начальной записи зоны.  
  
Страница **Параметры контроллера домена** также позволяет выбрать из конфигурации леса соответствующее логичное **имя сайта** Active Directory. По умолчанию выбирается сайт с наиболее подходящей подсетью. Если существует только один сайт, он выбирается автоматически.  
  
> [!IMPORTANT]  
> Если сервер не входит в подсеть Active Directory и имеется несколько сайтов Active Directory, выбор не производится и кнопка **Далее** останется неактивной до тех пор, пока не будет выбран сайт из списка.  
  
Указанный **пароль для режима восстановления служб каталогов** должен соответствовать политике паролей, действующей для сервера. Всегда выбирайте надежный, сложный пароль или, что еще лучше, парольную фразу. Аргументы Windows PowerShell ADDSDeployment, эквивалентные параметрам на странице **Параметры контроллера домена**:  
  
```  
-UseExistingAccount <{$true | $false}>  
-SafeModeAdministratorPassword <secure string>  
```  
  
> [!IMPORTANT]  
> Имя сайта уже должно существовать на момент ввода в качестве аргумента для **-sitename**. Командлет **install-AddsDomainController** не создает имена сайтов. Для создания сайтов можно использовать командлет **new-adreplicationsite**.  
  
Если аргументы **Install-ADDSDomainController** не заданы, они имеют те же значения по умолчанию, что и параметры в диспетчере сервера.  
  
Аргумент **SafeModeAdministratorPassword** действует особым образом.  
  
-   Если этот аргумент *не указан* , командлет предлагает ввести и подтвердить скрытый пароль. Это предпочтительный вариант использования при интерактивном выполнении командлета.  
  
    Например, чтобы создать контроллер RODC в домене corp.contoso.com с выводом запроса на ввод и подтверждением скрытого пароля, выполните следующую команду:  
  
    ```  
    Install-ADDSDomainController -DomainName corp.contoso.com -credential (get-credential)  
    ```  
  
-   Если аргумент указан *со значением*, это значение должно быть защищенной строкой. Это не является предпочтительным вариантом использования при интерактивном выполнении командлета.  
  
Например, можно вручную ввести запрос пароля с помощью командлета **Read-Host**, чтобы запрашивать у пользователя ввод защищенной строки.  
  
```  
-safemodeadministratorpassword (read-host -prompt Password: -assecurestring)  
  
```  
  
> [!WARNING]  
> Поскольку в предыдущем варианте пароль не подтверждается, соблюдайте повышенную осторожность: пароль невидим.  
  
Можно также ввести защищенную строку в качестве переменной с преобразованным открытым текстом, хотя использовать такой вариант настоятельно не рекомендуется.  
  
```  
-safemodeadministratorpassword (convertto-securestring Password1 -asplaintext -force)  
```  
  
Наконец, можно сохранить скрытый пароль в файле, а затем использовать его повторно, никогда не отображая пароль в виде открытого текста. Например:  
  
```  
$file = c:\pw.txt  
$pw = read-host -prompt Password: -assecurestring  
$pw | ConvertFrom-SecureString | Set-Content $file  
  
-safemodeadministratorpassword (Get-Content $File | ConvertTo-SecureString)  
  
```  
  
> [!WARNING]  
> Ввод или хранение пароля в виде открытого или скрытого текста не рекомендуется. Любой пользователь, выполняющий эту команду в скрипты или заглядывающий через ваше плечо, сможет узнать пароль DSRM этого доменного контроллера.  Любой пользователь, имеющий доступ к файлу, сможет восстановить скрытый пароль. Зная пароль, он сможет войти в контроллер домена, запущенный в режиме восстановления служб каталогов, и персонифицировать сам контроллер домена, повысив уровень собственных привилегий в лесу Active Directory до максимального уровня. Рекомендуется выполнить дополнительные действия для шифрования данных текстового файла с помощью **System.Security.Cryptography**, однако их рассмотрение выходит за рамки этой статьи. Лучше всего полностью отказаться от хранения паролей.  
  
### <a name="rodc-options"></a>RODC Options  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCOptions.png)  
  
На странице **Параметры RODC** можно изменить следующие параметры:  
  
-   Делегированная учетная запись администратора.  
  
-   Учетные записи, которым разрешено реплицировать пароли в RODC.  
  
-   Учетные записи, которым запрещено реплицировать пароли в RODC.  
  
Делегированные учетные записи администратора получают локальные права администратора для RODC. Эти пользователи могут действовать с привилегиями, эквивалентными группе администраторов локального компьютера.  Они не являются членами групп администраторов домена или встроенных учетных записей администраторов домена. Этот параметр полезен при делегировании администрирования филиалом без выдачи разрешения на администрирование домена. Настройка делегирования прав администратора не требуется.  
  
Эквивалентный аргумент Windows PowerShell ADDSDeployment:  
  
```  
-delegatedadministratoraccountname <string>  
```  
  
Учетные записи, которым не разрешено кэшировать пароли в контроллере RODC и которые не могут подключиться к доступному для записи контроллеру домена для проверки подлинности, не имеют доступа к ресурсам и функциональным возможностям Active Directory.  
  
> [!IMPORTANT]  
> Если параметр не изменяется, используются группы и значения по умолчанию:  
>   
> -   Администраторы — Запретить  
> -   Операторы сервера — Запретить  
> -   Операторы архива — Запретить  
> -   Операторы учета — Запретить  
> -   Группа с запрещением репликации паролей RODC — Запретить  
> -   Группа с разрешением репликации паролей RODC — Разрешить  
  
Эквивалентные аргументы Windows PowerShell ADDSDeployment:  
  
```  
-allowpasswordreplicationaccountname <string []>  
-denypasswordreplicationaccountname <string []>  
```  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_SelectDelAdmin.png)  
  
### <a name="additional-options"></a>Дополнительные параметры  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCAdditionalOptions.png)  
  
На странице **Дополнительные параметры** приводятся параметры конфигурации, позволяющие указать имя контроллера домена, используемого в качестве источника репликации.  
  
Также можно установить контроллер домена с помощью архивированных носителей, использовав параметр установки с носителя (IFM). При установке флажка **Установка с носителя** появляется возможность выбора носителя. Чтобы убедиться в том, что указанный путь является действительным путем к носителю, необходимо нажать кнопку **Проверить** .

Рекомендации для источника IFM:
*    Носитель, используемый параметром IFM, создается с cистема архивации данных Windows Server или Ntdsutil. exe из другого существующего контроллера домена Windows Server с той же версией операционной системы. Например, нельзя использовать Windows Server 2008 R2 или предыдущую операционную систему для создания носителя для контроллера домена Windows Server 2012.
*    Исходные данные IFM должны быть из контроллера домена с возможностью записи. Хотя источник из RODC технически будет работать для создания нового RODC, возникают ложные срабатывания предупреждений репликации, которые не реплицируются источником IFM RODC.

Подробнее об изменениях в IFM см. в разделе [Изменения, касающиеся установки с носителя с помощью Ntdsutil.exe](../../../ad-ds/deploy/Simplified-Administration-Appendix.md#BKMK_IFM). Если носители защищены SYSKEY, диспетчер сервера запрашивает пароль образа во время проверки.
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSIFM.png)  
  
Аргументы командлета ADDSDeployment, эквивалентные параметрам на странице "Дополнительные параметры":  
  
```  
-replicationsourcedc <string>  
-installationmediapath <string>  
-systemkey <secure string>  
```  
  
### <a name="paths"></a>Paths  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCPaths.png)  
  
Страница **Пути** позволяет переопределить расположение папок по умолчанию для базы данных AD DS, журналов транзакций базы данных и общего доступа к SYSVOL. Расположение по умолчанию всегда в подкаталогах %systemroot%. Аргументы командлета ADDSDeployment, эквивалентные параметрам на странице **Пути** :  
  
```  
-databasepath <string>  
-logpath <string>  
-sysvolpath <string>  
```  
  
### <a name="preparation-options"></a>Параметры подготовки  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCPrepOptions.png)  
  
На странице **Параметры подготовки** выводится оповещение о том, что настройка доменных служб Active Directory включает в себя расширение схемы (forestprep) и обновление домена (domainprep). Эта страница появляется только в том случае, если лес или домен не были подготовлены в ходе предыдущей установки контроллера домена Windows Server 2012 или путем запуска средства Adprep.exe вручную. Например, мастер настройки доменных служб Active Directory подавляет эту страницу, если вы добавляете новую реплику контроллера домена в существующий корневой домен леса Windows Server 2012.  
  
Расширение схемы и обновление домена не производятся после нажатия кнопки **Далее**. Эти операции выполняются только во время этапа установки. На этой странице просто сообщается о событиях, которые будут происходить позднее в ходе установки.  
  
На этой странице также проверяется, является ли текущий пользователь членом групп "Администраторы схемы" и "Администраторы предприятия". Членство в этих группах необходимо для расширения схемы и подготовки домена. Если на странице указано, что текущие учетные данные не дают необходимых разрешений, нажмите кнопку **Изменить**, чтобы предоставить соответствующие учетные данные пользователя.  
  
Аргумент командлета ADDSDeployment, эквивалентный параметрам на странице "Дополнительные параметры":  
  
```  
-adprepcredential <pscredential>  
```  
  
> [!IMPORTANT]  
> Так же как и в предыдущих версиях Windows Server, при автоматической подготовке домена в Windows Server 2012 средство GPPREP не запускается. Выполните команду **adprep.exe /gpprep** вручную для всех доменов, которые не были ранее подготовлены для Windows Server 2003, Windows Server 2008 или Windows Server 2008 R2. Средство GPPrep следует запустить только один раз за историю домена, а не при каждом обновлении. Средство Adprep.exe не выполняет команду /gpprep автоматически, так как это может привести к повторной репликации всех файлов и папок из тома SYSVOL во всех контроллерах домена.  
>   
> Средство RODCPrep запускается автоматически при повышении роли первого контроллера RODC без предварительной подготовки в домене. Этого не происходит при повышении роли первого доступного для записи контроллера домена Windows Server 2012. Если планируется развертывать контроллеры домена только для чтения, команду **adprep.exe /rodcprep** также можно выполнить вручную.  
  
### <a name="review-options-and-view-script"></a>"Просмотреть параметры" и "Просмотреть скрипт"  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCReviewOptions.png)  
  
Страница **Просмотреть параметры** позволяет проверить параметры перед установкой и убедиться, что они отвечают требованиям. Позднее установку также можно будет остановить с помощью диспетчера сервера. Эта страница позволяет просмотреть и подтвердить параметры перед продолжением конфигурации.  
  
На странице **Просмотреть параметры** диспетчера сервера расположена дополнительная кнопка **Просмотреть скрипт** , предназначенная для создания текстового файла в кодировке Юникод, содержащего текущую конфигурацию развертывания ADDSDeployment в виде единого скрипта Windows PowerShell. Это позволяет использовать графический интерфейс диспетчера сервера в качестве студии развертывания Windows PowerShell. С помощью мастера настройки доменных служб Active Directory необходимо настроить параметры, экспортировать конфигурацию и затем отменить мастер. Во время этого процесса создается допустимый и синтаксически верный образец для дальнейшего изменения или прямого использования. Например:  
  
```  
#  
# Windows PowerShell Script for AD DS Deployment  
#  
  
Import-Module ADDSDeployment  
Install-ADDSDomainController `  
-AllowPasswordReplicationAccountName @(CORP\Allowed RODC Password Replication Group, CORP\Chicago RODC Admins, CORP\Chicago RODC Users and Computers) `  
-Credential (Get-Credential) `  
-CriticalReplicationOnly:$false `  
-DatabasePath C:\Windows\NTDS `  
-DelegatedAdministratorAccountName CORP\Chicago RODC Admins `  
-DenyPasswordReplicationAccountName @(BUILTIN\Administrators, BUILTIN\Server Operators, BUILTIN\Backup Operators, BUILTIN\Account Operators, CORP\Denied RODC Password Replication Group) `  
-DomainName corp.contoso.com `  
-InstallDNS:$true `  
-LogPath C:\Windows\NTDS `  
-ReadOnlyReplica:$true `  
-SiteName Default-First-Site-Name `  
-SYSVOLPath C:\Windows\SYSVOL  
-Force:$true  
  
```  
  
> [!NOTE]  
> Диспетчер сервера обычно задает значения для всех аргументов при повышении роли, не полагаясь на значения по умолчанию (так как они могут изменяться в будущих версиях Windows или пакетах обновления). Единственным исключением является аргумент **-safemodeadministratorpassword** . Для принудительного вывода запроса на подтверждение не указывайте значение при интерактивном выполнении командлета.  
  
Для просмотра информации о конфигурации используйте необязательный аргумент Whatif с командлетом Install-ADDSDomainController. Это позволит просмотреть явные и неявные значения аргументов командлета.  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCWhatIf.png)  
  
### <a name="prerequisites-check"></a>Проверка предварительных требований  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCPrereqCheck.png)  
  
**Проверка предварительных требований** — это новая функция настройки доменных служб Active Directory. На этом новом этапе проверяется возможность поддержки нового леса доменных служб Active Directory конфигурацией сервера.  
  
При установке нового корневого домена леса мастер настройки доменных служб Active Directory в диспетчере сервера последовательно выполняет серию модульных тестов. При этом предлагаются рекомендуемые способы восстановления. Тесты можно выполнять необходимое число раз. Установка контроллера домена не может продолжаться, пока все проверки предварительных требований не будут пройдены.  
  
На странице **Проверка предварительных требований** также приводится важная информация, например сведения об изменениях в системе безопасности, затрагивающих предыдущие операционные системы.  
  
При использовании диспетчера сервера пропустить **проверку предварительных требований** нельзя, однако это можно сделать при использовании командлета развертывания доменных служб Active Directory с помощью следующего аргумента:  
  
```  
-skipprechecks  
  
```  
  
Чтобы начать повышение роли контроллера домена, нажмите кнопку **Установить** . Это последняя возможность отменить установку. После того как процесс повышения роли начнется, отменить его будет невозможно. По завершении повышения роли компьютер автоматически перезагрузится вне зависимости от результата процесса.  
  
### <a name="installation"></a>Установка  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCInstallation.png)  
  
Когда появляется страница **Установка** , это означает, что настройка контроллера домена началась и ее нельзя остановить или отменить. Подробная информация об операциях выводится на этой странице и записывается в следующие журналы:  
  
-   %systemroot%\debug\dcpromo.log  
  
-   %systemroot%\debug\dcpromoui.log  
  
Чтобы установить новый лес Active Directory с помощью модуля ADDSDeployment, используйте следующий командлет:  
  
```  
Install-addsdomaincontroller  
  
```  
  
Список обязательных и необязательных аргументов см. в таблице **Командлет ADDSDeployment** в начале этого раздела.  
  
Выполнение командлета **Install-addsdomaincontroller** включает только два этапа (проверка предварительных требований и установка). На двух иллюстрациях ниже показан этап установки с минимальным необходимым набором аргументов: **-domainname**, **-readonlyreplica**, **-sitename** и **-credential**. Обратите внимание на то, что командлет **Install-ADDSDomainController**, как и диспетчер сервера, напоминает об автоматической перезагрузке сервера после повышения роли:  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSInstallRODC.png)  
  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_PSInstallRODCProgress.png)  
  
Чтобы автоматически закрывать напоминание о перезагрузке, используйте аргументы **-force** или **-confirm:$false** с любым командлетом Windows PowerShell ADDSDeployment. Чтобы предотвратить автоматическую перезагрузку сервера по завершении повышения роли, используйте аргумент **-norebootoncompletion** .  
  
> [!WARNING]  
> Отключать перезагрузку не рекомендуется. Для правильной работы контроллер домена должен перезагрузиться. Если выйти из контроллера домена, то снова войти в него в интерактивном режиме не удастся, пока он не будет перезапущен.  
  
### <a name="results"></a>Результаты  
![Установить RODC](media/Install-a-Windows-Server-2012-Active-Directory-Read-Only-Domain-Controller--RODC---Level-200-/ADDS_SMI_TR_RODCSignoff.png)  
  
На странице **Результаты** показано, успешно ли было выполнено повышение роли, а также приводится важная для администраторов информация. Контроллер домена автоматически перезагрузится через 10 секунд.  
  

