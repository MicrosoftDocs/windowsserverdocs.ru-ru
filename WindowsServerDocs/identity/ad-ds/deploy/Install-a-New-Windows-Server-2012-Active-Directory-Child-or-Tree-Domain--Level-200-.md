---
ms.assetid: e3d55565-ad45-4504-ad73-8103d1a92170
title: "Установка нового дочернего Active Directory Windows Server 2012 или домена дерева (уровень 200)"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adds
ms.openlocfilehash: fc0eecc44bbc5f7459f22aceb5ebe41cd61948b6
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="install-a-new-windows-server-2012-active-directory-child-or-tree-domain-level-200"></a>Установка нового дочернего Active Directory Windows Server 2012 или домена дерева (уровень 200)

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

В этом разделе объясняется, как добавить дочерние домены и домены дерева в существующий лес Windows Server 2012, с помощью диспетчера сервера или Windows PowerShell.  
  
-   [Добавление дочернего домена и порядок домена дерева](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-.md#BKMK_Workflow)  
  
-   [Добавление дочернего домена и домена дерева с Windows PowerShell](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-.md#BKMK_PS)  
  
-   [Развертывания](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-.md#BKMK_Deployment)  
  
## <a name="BKMK_Workflow"></a>Добавление дочернего домена и порядок домена дерева  
Схеме ниже показан процесс настройки доменных служб Active Directory, если вы ранее установили роль Доменных служб Active Directory и запустили Active Directory мастер настройки доменных служб с помощью диспетчера сервера для создания нового домена в существующем лесу.  
  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/adds_childtreedeploy_beta1.png)  
  
## <a name="BKMK_PS"></a>Добавление дочернего домена и домена дерева с Windows PowerShell  
  
|||  
|-|-|  
|**Командлет ADDSDeployment**|Аргументы (**Полужирный** требуются аргументы. *Курсивом* аргументов можно указать с помощью Windows PowerShell или мастера настройки AD DS.)|  
|**Install-AddsDomain**|-SkipPreChecks<br /><br />***-NewDomainName***<br /><br />***-ParentDomainName***<br /><br />***-SafeModeAdministratorPassword***<br /><br />*-ADPrepCredential*<br /><br />-AllowDomainReinstall<br /><br />-Подтверждения<br /><br />*-CreateDNSDelegation*<br /><br />***-Credential***<br /><br />*-DatabasePath*<br /><br />*-DNSDelegationCredential*<br /><br />-NoDNSOnNetwork<br /><br />*-DomainMode*<br /><br />***-DomainType***<br /><br />-Force<br /><br />*-InstallDNS*<br /><br />*-LogPath*<br /><br />*-NewDomainNetBIOSName*<br /><br />*-NoGlobalCatalog*<br /><br />-NoNorebootoncompletion<br /><br />*-ReplicationSourceDC*<br /><br />*-SiteName*<br /><br />-SkipAutoConfigureDNS<br /><br />*-SYSVOLPath*<br /><br />*-Whatif*|  
  
> [!NOTE]  
> **-Credential** только требуется, если вы не в настоящее время вход в качестве члена группы администраторов предприятия. **- NewDomainNetBIOSName** аргумент является обязательным, если требуется изменить 15-значное имя, созданное автоматически на основе префикса имени домена DNS или если длина имени превышает 15 символов.  
  
## <a name="BKMK_Deployment"></a>Развертывания  
  
### <a name="deployment-configuration"></a>Конфигурация развертывания  
На следующем снимке экрана показаны параметры добавления дочернего домена:  
  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildDeployConfig.png)  
  
На следующем снимке экрана показаны параметры добавления домена дерева:  
  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_TreeDeployConfig.png)  
  
Диспетчер серверов начинает повышение роли каждого контроллера домена с **конфигурации развертывания** страницы. Оставшиеся параметры и обязательные поля меняются на этой странице и последующих страницах в зависимости от того, какая операция развертывания выбрана.  
  
В этом разделе объединены две отдельные операции: повышение роли дочернего домена и повышение роли домена дерева. Единственное различие между ними заключается в типе домена, которые вы решили создать. Все остальные действия идентичны между ними.  
  
-   Чтобы создать новый дочерний домен, выберите **добавить домен в существующий лес** и выберите **дочернего домена**. Для **имя родительского домена**введите или выберите имя родительского домена. Затем введите имя нового домена в **новое имя домена** поле. Укажите допустимое однокомпонентное дочернего домена имя; Имя должно соответствовать требованиям DNS-имени домена.  
  
-   Чтобы создать домен дерева в существующем лесу, выберите **добавить домен в существующий лес** и выберите **домена дерева**. Введите имя корневого домена леса, а затем введите имя нового домена. Укажите имя допустимое полное имя корневого домена; Имя не может быть однокомпонентным и должно отвечать требованиям имя домена DNS.  
  
Дополнительные сведения об именах DNS см. в разделе [соглашения об именовании в Active Directory для компьютеров, доменов, узлов и подразделений](https://support.microsoft.com/kb/909264).  
  
Диспетчер Active Directory домена мастер настройки служб сервера запросит учетные данные домена, если текущие учетные данные не из домена. Нажмите кнопку **изменение** для предоставления учетных данных домена для операции повышения роли.  
  
Командлет ADDSDeployment конфигурации развертывания и аргументы приведены ниже.  
  
```  
Install-AddsDomain  
-domaintype <{childdomain | treedomain}>  
-parentdomainname <string>  
-newdomainname <string>  
-credential <pscredential>  
```  
  
### <a name="domain-controller-options"></a>Параметры контроллера домена  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_DCOptions_Child.gif)  
  
**Параметры контроллера домена** страница задает параметры контроллера домена для нового контроллера домена. Настраиваемые параметры контроллера домена включают **DNS-сервер** и **глобального каталога**; как первый контроллер домена в новом домене, нельзя назначить контроллер домена только для чтения.  
  
Корпорация Майкрософт рекомендует, чтобы все контроллеры домена предоставляли службы DNS и глобального Каталога для обеспечения высокой доступности в распределенных средах. Глобальный Каталог всегда выбран по умолчанию и DNS-сервер выбран по умолчанию, если текущий домен размещены службы DNS на контроллерах домена, на основе запроса Start из центра. Необходимо также указать **функциональный уровень домена**. Режим работы по умолчанию — Windows Server 2012, и можно выбрать любое другое значение, равным или больше, чем текущий режим работы леса.  
  
**Параметры контроллера домена** страницы также можно выбрать соответствующий Active Directory логических **имя сайта** из конфигурации леса. По умолчанию выбран сайт с наиболее подходящей подсетью. Если имеется только один сайт, он выбирается автоматически.  
  
> [!IMPORTANT]  
> Если сервер не входит в подсеть Active Directory и имеется несколько сайтов Active Directory, выбор не производится и **Далее** кнопка недоступна, пока не будет выбран сайт из списка.  
  
Указанный **пароль режима восстановления служб каталогов** должен соответствовать политике паролей, действующей для сервера. Всегда выбирайте надежный, сложный пароль, предпочтительно парольную фразу.  
  
**Параметры контроллера домена** аргументы командлета ADDSDeployment:  
  
```  
-InstallDNS <{$false | $true}>  
-NoGlobalCatalog <{$false | $true}>  
-DomainMode <{Win2003 | Win2008 | Win2008R2 | Win2012 | Default}>  
-Sitename <string>  
-SafeModeAdministratorPassword <secure string>  
-Credential <pscredential>  
```  
  
> [!IMPORTANT]  
> Имя сайта уже должно существовать на момент ввода в качестве значения для **sitename** аргумент. **Install-AddsDomainController** командлет не создает имена сайтов. Можно использовать **новый adreplicationsite** командлет для создания сайтов.  
  
**Install-ADDSDomainController** аргументы командлета выполните того же значения по умолчанию в диспетчере сервера, если не указано.  
  
**SafeModeAdministratorPassword** аргумента действует особым:  
  
-   Если *не указан* аргумента, командлет предлагает ввести и подтвердить Скрытый пароль. Это предпочтительный вариант использования при интерактивном выполнении командлета.  
  
    Например для создания нового дочернего домена с именем NorthAmerica в домене Contoso.com и запрос на ввод и подтверждение скрытого пароля:  
  
    ```  
    Install-ADDSDomain "NewDomainName NorthAmerica "ParentDomainName Contoso.com "DomainType Child  
    ```  
  
-   Если указан *со значением*, значение должно быть защищенной строкой. Это не является предпочтительным при интерактивном выполнении командлета.  
  
Например, можно вручную ввести запрос пароля с помощью **Read-Host** командлету предложить пользователю ввести защищенную строку:  
  
```  
-safemodeadministratorpassword (read-host -prompt "Password:" -assecurestring)  
  
```  
  
> [!WARNING]  
> Поскольку в предыдущем варианте пароль не подтверждается, соблюдайте повышенную осторожность: пароль невидим.  
  
Можно также ввести защищенную строку в переменной с преобразованным открытым текстом, хотя это не рекомендуется.  
  
```  
-safemodeadministratorpassword (convertto-securestring "Password1" -asplaintext -force)  
  
```  
  
Наконец можно сохранить Скрытый пароль в файле и затем использовать его повторно, никогда не отображая пароль открытым текстом. Например:  
  
```  
$file = "c:\pw.txt"  
$pw = read-host -prompt "Password:" -assecurestring  
$pw | ConvertFrom-SecureString | Set-Content $file  
  
-safemodeadministratorpassword (Get-Content $File | ConvertTo-SecureString)  
  
```  
  
> [!WARNING]  
> Ввод или хранение пароля в виде открытого или скрытого текста не рекомендуется. Любой пользователь, выполняющий эту команду в сценарии или заглядывающий через ваше плечо, сможет узнать пароль DSRM этого доменного контроллера.  Все, кто имеет доступ к файлу, сможет восстановить Скрытый пароль. Зная пароль они могут войти в контроллер домена запущен в режиме DSRM и персонифицировать сам контроллер домена, повысив уровень собственных привилегий самый высокий уровень в составе леса AD. Дополнительный набор действия, используя **System.Security.Cryptography** для шифрования текстового файла данных рекомендуется, но вне области действия. Рекомендуется полностью отказаться от хранения паролей.  
  
Модуль ADDSDeployment предлагает дополнительную возможность пропустить автоматическую настройку параметров DNS-клиента, серверов пересылки и корневых ссылок. Такой возможности нет при использовании диспетчера сервера. Этот аргумент имеет значение только в том случае, если вы уже установили службу DNS-сервера до настройки контроллера домена:  
  
```  
-SkipAutoConfigureDNS  
  
```  
  
### <a name="dns-options-and-dns-delegation-credentials"></a>Параметры DNS и учетные данные для делегирования DNS  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildDNSOptions.png)  
  
**Параметры DNS** странице можно указать альтернативные учетные данные администратора DNS для делегирования.  
  
При установке нового домена в существующем лесу, если вы выбрали установку DNS на **параметры контроллера домена** страница — не удается настроить любые параметры; Делегирование выполняется автоматически и отменить его нельзя. Вы можете указать альтернативные учетные данные администратора, DNS-сервера с правами на обновление этой структуры.  
  
**Параметры DNS** аргументы ADDSDeployment Windows PowerShell:  
  
```  
-creatednsdelegation   
-dnsdelegationcredential <pscredential>  
```  
  
Дополнительные сведения о делегировании DNS см. в разделе [общее представление о делегировании зоны](https://technet.microsoft.com/library/cc771640.aspx).  
  
### <a name="additional-options"></a>Дополнительные параметры  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildAdditionalOptions.png)  
  
**Дополнительные параметры** страница отображает NetBIOS-имя домена и позволяет переопределить ее. По умолчанию, NetBIOS-имя домена совпадает с крайним левым метки полное доменное имя, содержащееся в **конфигурации развертывания** страницы. Например если указано полное доменное имя corp.contoso.com, NetBIOS-имя домена по умолчанию — CORP.  
  
Если имя не более 15 символов или меньше и не конфликтует с другим NetBIOS-именем, оно остается без изменений. Если оно конфликтует с другим NetBIOS-именем, к имени добавляется номер. Если имя более 15 символов, мастер предоставляет уникальный усеченный вариант. В любом случае мастер сначала проверяет имя еще не с помощью просмотра WINS и широковещательной рассылки NetBIOS.  
  
Дополнительные сведения об именах DNS см. в разделе [соглашения об именовании в Active Directory для компьютеров, доменов, узлов и подразделений](https://support.microsoft.com/kb/909264).  
  
**Install-AddsDomain** аргументы выполните того же значения по умолчанию в диспетчере сервера, если не указано. **DomainNetBIOSName** особым:  
  
1.  Если **NewDomainNetBIOSName** аргумент не задано NetBIOS-имя домена и имя домена однокомпонентного в **DomainName** превышает 15 символов, а затем повышение роли продолжает выполняться с использованием автоматически созданного имени.  
  
2.  Если **NewDomainNetBIOSName** аргумент не задано NetBIOS-имя домена и имя домена однокомпонентного в **DomainName** превышает 16 символов, происходит сбой повышения роли.  
  
3.  Если **NewDomainNetBIOSName** аргумент указан с помощью NetBIOS-имя домена длиной не более 15 символов, а затем повышение роли продолжает выполняться с использованием указанного имени.  
  
4.  Если **NewDomainNetBIOSName** аргумент задано NetBIOS-имя домена 16 символов или более, происходит сбой повышения роли.  
  
**Дополнительные параметры** командлета addsdeployment таков:  
  
```  
-newdomainnetbiosname <string>  
```  
  
### <a name="paths"></a>Пути  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_UpgradePaths.png)  
  
**Пути** страницы позволяет переопределить расположение папок по умолчанию базы данных AD DS, журналов транзакций базы данных и общего ресурса SYSVOL. Расположение по умолчанию, всегда в подкаталогах % systemroot %.  
  
**Пути** аргументы командлета ADDSDeployment:  
  
```  
-databasepath <string>  
-logpath <string>  
-sysvolpath <string>  
```  
  
### <a name="review-options-and-view-script"></a>Просмотрите параметры и просмотреть сценарий  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildReviewOptions.png)  
  
**Просмотреть параметры** странице можно проверить параметры и убедиться, они отвечают требованиям, прежде чем начать установку. Это последняя возможность прервать установку, при использовании диспетчера сервера. Это просто параметр, чтобы подтвердить параметры перед продолжением настройки  
  
**Просмотреть параметры** страницу в диспетчере сервера расположена дополнительная **просмотреть сценарий** кнопку, чтобы создать текстовый файл в кодировке Юникод, содержащего текущую конфигурацию развертывания ADDSDeployment в виде единого скрипта Windows PowerShell. Это позволяет использовать графический интерфейс диспетчера сервера в качестве студии развертывания Windows PowerShell. Используйте мастер настройки доменных служб Active Directory, чтобы настроить параметры, экспортировать конфигурацию и затем отменить мастер.  Этого процесса создается допустимый и синтаксически верный образец для дальнейшего изменения или прямого использования. Например:  
  
```  
#  
# Windows PowerShell Script for AD DS Deployment  
#  
  
Import-Module ADDSDeployment  
Install-ADDSDomain `  
-NoGlobalCatalog:$false `  
-CreateDNSDelegation `  
-Credential (Get-Credential) `  
-DatabasePath "C:\Windows\NTDS" `  
-DomainMode "Win2012" `  
-DomainType "ChildDomain" `  
-InstallDNS:$true `  
-LogPath "C:\Windows\NTDS" `  
-NewDomainName "research" `  
-NewDomainNetBIOSName "RESEARCH" `  
-ParentDomainName "corp.contoso.com" `  
-Norebootoncompletion:$false `  
-SiteName "Default-First-Site-Name" `  
-SYSVOLPath "C:\Windows\SYSVOL"  
-Force:$true  
  
```  
  
> [!NOTE]  
> Диспетчер сервера обычно задает все значения аргументов при повышении роли, не зависит от значения по умолчанию (как они могут изменяться в будущих версиях Windows или пакетах обновления). Единственным исключением является **- safemodeadministratorpassword** аргумент (который намеренно опущен в скрипте). Для принудительного вывода запроса на подтверждение, не указывайте значение при интерактивном выполнении командлета.  
  
Используйте дополнительный **Whatif** аргумент с **Install-ADDSForest** для просмотра сведений о конфигурации. Это позволяет просмотреть явные и неявные значения аргументов командлета.  
  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildWhatIf.png)  
  
### <a name="prerequisites-check"></a>Проверка готовности к установке  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildPrereqCheck.png)  
  
**Проверка предварительных требований** — это новая функция в конфигурации домена AD DS. На этом новом этапе проверяется конфигурации сервера возможность поддержки нового домена AD DS.  
  
При установке нового корневого домена леса, Server Manager Active Directory домена мастер настройки служб вызывает ряд сериализованных модульных тестов. Эти предлагаются рекомендуемые способы восстановления. Тесты можно выполнять необходимое число раз. Домен контроллера не может продолжаться, пока все проверки предварительных требований передачи.  
  
**Проверка предварительных требований** также поверхности важные сведения, такие как изменения безопасности, затрагивающих предыдущие операционные системы.  
  
Дополнительные сведения о проверках предварительных требований см. в разделе [проверка предварительных требований](../../ad-ds/manage/AD-DS-Simplified-Administration.md#BKMK_PrereuisiteChecking).  
  
Нельзя **проверка готовности к установке** при с помощью диспетчера сервера, но вы можете пропустить при использовании командлета развертывания AD DS, с помощью следующего аргумента:  
  
```  
-skipprechecks  
```  
  
> [!WARNING]  
> Корпорация Майкрософт не рекомендует пропускать проверку предварительных требований, так как это может привести к повышению роли контроллера домена частичная или повреждению леса AD DS.  
  
Нажмите кнопку **установить** начинается процесс повышения роли контроллера домена. Это последняя возможность отменить установку. Процесс повышения роли нельзя отменить после ее начала. По завершении повышения роли, вне зависимости от результата повышения роли компьютер перезагрузится автоматически.  
  
### <a name="installation"></a>Установка  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ChildInstallation.png)  
  
Когда **установки** отображает страницу, конфигурации контроллера домена начинается и невозможно остановить или отменить. Подробная информация об операциях выводится на этой странице и записывается в журналы:  
  
-   %systemroot%\debug\dcpromo.log  
  
-   %systemroot%\debug\dcpromoui.log  
  
Чтобы установить новый домен Active Directory, с помощью модуля ADDSDeployment, используйте следующий командлет:  
  
```  
Install-addsdomain  
```  
  
В разделе [добавление дочернего домена и домена дерева с Windows PowerShell](../../ad-ds/deploy/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-.md#BKMK_PS) для обязательных и необязательных аргументов. **Install-addsdomain** командлет включает только два этапа (проверка предварительных требований и установка). На двух иллюстрациях ниже показан этап установки с минимальным необходимым набором аргументов **- domaintype**, **- newdomainname**, **- parentdomainname**, и **-credential**. Обратите внимание, что так же, как диспетчер сервера **Install-ADDSDomain** напоминает о том, что повышения уровня сервер автоматически перезагрузится.  
  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_PSInstallADDSDomain.png)  
  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_PSInstallADDSDomainProgress.png)  
  
Чтобы напоминание о перезагрузке автоматически, используйте **-принудительно** или **-подтверждение: $false** аргументы с любым командлетом ADDSDeployment Windows PowerShell. Чтобы предотвратить автоматическую перезагрузку по завершении повышения роли сервера, используйте **- norebootoncompletion** аргумент.  
  
> [!WARNING]  
> Отключать перезагрузку не рекомендуется. Для правильной работы контроллер домена должен перезагрузиться  
  
### <a name="results"></a>Результаты  
![Установка нового дочернего AD](media/Install-a-New-Windows-Server-2012-Active-Directory-Child-or-Tree-Domain--Level-200-/ADDS_SMI_TR_ForestSignOff.png)  
  
**Результатов** странице отображается успешном или неудачном повышение роли, а также все важные данные администратора. Контроллер домена автоматически перезагрузится через 10 секунд.  
  

