---
ms.assetid: 4cc9c16c-1928-4dce-a3a8-6229be28eb65
title: Понятия репликации Active Directory
description: ''
author: MicrosoftGuyJFlo
ms.author: joflore
manager: mtillman
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adds
ms.openlocfilehash: ccc1801ba325fec4d7273b503ccb799966122b99
ms.sourcegitcommit: 9a6a692a7b2a93f52bb9e2de549753e81d758d28
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/18/2019
ms.locfileid: "72591073"
---
# <a name="active-directory-replication-concepts"></a>Понятия репликации Active Directory

>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Прежде чем проектировать топологию сайта, ознакомьтесь с некоторыми Active Directory концепциями репликации.  
  
-   [Объект Connection](#BKMK_1)  
  
-   [NПОПЫТКА](#BKMK_2)  
  
-   [Функции отработки отказа](#BKMK_3)  
  
-   [Сетей](#BKMK_4)  
  
-   [Места](#BKMK_5)  
  
-   [Связь сайтов](#BKMK_6)  
  
-   [Мост связей сайтов](#BKMK_7)  
  
-   [Транзитивность связи сайтов](#BKMK_8)  
  
-   [Сервер глобального каталога](#BKMK_9)  
  
-   [Кэширование членства в универсальных группах](#BKMK_10)  
  
## <a name="BKMK_1"></a>Объект Connection  
Объект Connection — это Active Directory объект, представляющий подключение репликации с исходного контроллера домена к целевому контроллеру домена. Контроллер домена является членом одного сайта и представлен на сайте объектом сервера в службах домен Active Directory Services (AD DS). Каждый объект сервера имеет дочерний объект параметров NTDS, представляющий реплицируемый контроллер домена на сайте.  
  
Объект Connection является дочерним по отношению к объекту параметров NTDS на целевом сервере. Чтобы репликация выполнялась между двумя контроллерами домена, объект сервера одного из них должен иметь объект Connection, представляющий входящую репликацию из другого. Все подключения репликации для контроллера домена хранятся в объекте параметров NTDS в виде объектов соединения. Объект Connection определяет исходный сервер репликации, содержит расписание репликации и указывает транспорт репликации.  
  
Средство проверки согласованности знаний (KCC) автоматически создает объекты подключения, но их также можно создать вручную. Объекты подключения, созданные КСС, отображаются в оснастке "Active Directory сайты и службы" как **<automatically generated>** и считаются достаточными при нормальных условиях работы. Объекты соединения, созданные администратором, создаются вручную. Объект подключения, созданный вручную, определяется по имени, назначенному администратором при его создании. При изменении объекта подключения **<automatically generated>** он преобразуется в объект подключения, измененный административно, и объект отображается в виде идентификатора GUID. KCC не вносит изменения в ручные или измененные объекты подключения.  
  
## <a name="BKMK_2"></a>NПОПЫТКА  
KCC — это встроенный процесс, который выполняется на всех контроллерах домена и создает топологию репликации для Active Directory леса. KCC создает отдельные топологии репликации в зависимости от того, выполняется ли репликация на сайте (внутрисайтовая) или между сайтами (межсайтовой). KCC также динамически корректирует топологию, чтобы она соответствовала добавлению новых контроллеров домена, удалению существующих контроллеров домена, перемещению контроллеров домена на сайты, изменяющимся затратам и расписаниям, а также к контроллерам домена, временно недоступен или находится в состоянии ошибки.  
  
В пределах сайта подключения между контроллерами домена с возможностью записи всегда упорядочиваются по двунаправленному кругу с дополнительными подключениями для уменьшения задержки на больших сайтах. С другой стороны, межсайтовая топология является слоем распределения деревьев. Это означает, что между двумя сайтами каждого раздела каталога существует одно межсайтическое соединение, которое обычно не содержит ярлыки. Дополнительные сведения о охвате деревьев и Active Directory топологии репликации см. в статье Технический справочник по топологии репликации Active Directory ([https://go.microsoft.com/fwlink/?LinkID=93578](https://go.microsoft.com/fwlink/?LinkID=93578)).  
  
На каждом контроллере домена KCC создает маршруты репликации, создавая односторонние объекты входящих подключений, которые определяют подключения других контроллеров домена. Для контроллеров домена на одном сайте KCC автоматически создает объекты подключения без вмешательства администратора. При наличии нескольких сайтов вы настраиваете связи сайтов между сайтами, а единое средство проверки согласованности знаний на каждом сайте автоматически создает подключения между сайтами.  
  
### <a name="kcc-improvements-for-windows-server-2008-rodcs"></a>Улучшения KCC для Windows Server 2008 RODC  

Существует ряд улучшений KCC для размещения нового доступного контроллера домена только для чтения (RODC) в Windows Server 2008. Типичным сценарием развертывания для RODC является филиал. Топология репликации Active Directory, наиболее часто развернутая в этом сценарии, основана на конструкции «звезда», где контроллеры домена ветви на нескольких сайтах реплицируются с небольшим количеством серверов-плацдармов на сайте концентратора.  
  
Одним из преимуществ развертывания RODC в этом сценарии является однонаправленная репликация. Серверы-плацдармы не должны реплицироваться с RODC, что снижает нагрузку на администрирование и использование сети.  
  
Однако одна из задач администрирования, выделенная топологией Hub в предыдущих версиях операционной системы Windows Server, заключается в том, что после добавления нового контроллера домена-плацдарма в концентратор отсутствует автоматический механизм для повторного распространения подключения репликации между контроллерами домена ветви и контроллерами домена концентратора, чтобы воспользоваться преимуществами нового контроллера домена концентратора.  
  
Для контроллеров домена Windows Server 2003 можно перераспределить рабочую нагрузку с помощью таких средств, как Адлб. exe, из руководств по развертыванию Windows Server 2003 Branch Office ([https://go.microsoft.com/fwlink/?LinkID=28523](https://go.microsoft.com/fwlink/?LinkID=28523)).  
  
Для Windows Server 2008 RODC нормальная работа KCC обеспечивает некоторую перераспределение, что устраняет необходимость в использовании дополнительного средства, такого как Адлб. exe. Новые функции включены по умолчанию. Его можно отключить, добавив следующий набор разделов реестра на RODC:  
  
**HKEY_LOCAL_MACHINE \Систем\куррентконтролсет\сервицес\нтдс\параметерс**  
  
**"Random BH LoadBalancing Allowed"**  
**1 = включено (по умолчанию), 0 = отключено**  
  
Дополнительные сведения о том, как работают эти улучшения KCC, см. в разделе Планирование и развертывание служб домен Active Directory для филиалов ([https://go.microsoft.com/fwlink/?LinkId=107114](https://go.microsoft.com/fwlink/?LinkId=107114)).  
  
## <a name="BKMK_3"></a>Функции отработки отказа  
Сайты обеспечивают маршрутизацию репликации по сетевым ошибкам и контроллерам домена вне сети. Проверка согласованности знаний выполняется с указанными интервалами, чтобы настроить топологию репликации для изменений, происходящих в AD DS, например при добавлении новых контроллеров домена и создании новых сайтов. KCC проверяет состояние репликации существующих соединений, чтобы определить, не работают ли какие либо подключения. Если подключение не работает из-за сбоя контроллера домена, KCC автоматически создает временные подключения к другим партнерам репликации (если они доступны), чтобы убедиться в том, что репликация выполняется. Если все контроллеры домена в сайте недоступны, KCC автоматически создает подключения репликации между контроллерами домена с другого сайта.  
  
## <a name="BKMK_4"></a>Сетей  
Подсеть — это сегмент сети TCP/IP, к которому назначаются наборы логических IP-адресов. Подсети группируют компьютеры таким образом, чтобы определить их физическое сходство в сети. Объекты подсети в AD DS определяют сетевые адреса, используемые для подключения компьютеров к сайтам.  
  
## <a name="BKMK_5"></a>Места  
Сайты — это Active Directory объекты, представляющие одну или несколько подсетей TCP/IP с высокой надежностью и быстрыми сетевыми подключениями. Сведения о сайте позволяют администраторам настраивать Active Directory доступ и репликацию для оптимизации использования физической сети. Объекты сайта связаны с набором подсетей, и каждый контроллер домена в лесу связан с Active Directory сайтом в соответствии с его IP-адресом. Сайты могут размещать контроллеры домена из нескольких доменов, а домен может быть представлен более чем одним сайтом.  
  
## <a name="BKMK_6"></a>Связь сайтов  
Связи сайтов — это Active Directory объекты, которые представляют логические пути, используемые КСС для установления соединения для репликации Active Directory. Объект связи сайтов представляет собой набор сайтов, которые могут обмениваться данными с одинаковыми затратами через указанный межсайтовый транспорт.  
  
Все сайты, содержащиеся в связи сайтов, считаются подключенными посредством одного типа сети. Сайты должны быть связаны с другими сайтами вручную с помощью связей сайтов, чтобы контроллеры домена на одном сайте могли реплицировать изменения каталога с контроллеров домена на другом сайте. Поскольку связи сайтов не соответствуют фактическому пути, принятому сетевыми пакетами в физической сети во время репликации, вам не нужно создавать избыточные связи сайтов для повышения эффективности репликации Active Directory.  
  
При соединении двух сайтов с помощью связи сайтов система репликации автоматически создает подключения между конкретными контроллерами домена на каждом сайте, который называется серверами-плацдармами. В Windows Server 2008 все контроллеры домена в сайте, на котором размещен один и тот же раздел каталога, являются кандидатами для выбора в качестве серверов-плацдармов. Подключения репликации, созданные KCC, случайным образом распределяются между всеми потенциальными серверами-плацдармами на сайте для совместного использования рабочей нагрузки репликации. По умолчанию процесс случайного выбора выполняется только один раз, когда объекты соединения впервые добавляются на сайт.  
  
## <a name="BKMK_7"></a>Мост связей сайтов  
Мост связи сайтов — это объект Active Directory, представляющий набор связей сайтов, все сайты которых могут обмениваться данными с помощью общего транспорта. Мосты связей сайтов позволяют подключать контроллеры домена, которые не соединены напрямую через канал связи для репликации друг с другом. Как правило, мост связей сайтов соответствует маршрутизатору (или набору маршрутизаторов) в IP-сети.  
  
По умолчанию KCC может формировать транзитный маршрут через все связи сайтов, на которых имеются общие сайты. Если такое поведение отключено, каждая связь сайтов представляет собственную отдельную и изолированную сеть. Наборы связей сайтов, которые можно рассматривать как один маршрут, выражаются через мост связей сайтов. Каждый мост представляет среду изолированного взаимодействия для сетевого трафика.  
  
Мосты связей сайтов — это механизм, логически отражающий транзитивное физическое подключение между сайтами. Мост связей сайтов позволяет KCC использовать любое сочетание входящих в него связей сайтов, чтобы определить наименее дорогостоящий маршрут к разделам каталога Interconnect, которые хранятся на этих сайтах. Мост связей сайтов не обеспечивает фактическое подключение к контроллерам домена. Если мост связей сайтов удален, репликация по Объединенным связям сайтов будет продолжаться до тех пор, пока не будут удалены ссылки.  
  
Мосты связей сайтов необходимы только в том случае, если сайт содержит контроллер домена, на котором размещается раздел каталога, который также не размещается на контроллере домена соседнего сайта, но контроллер домена, на котором размещен этот раздел каталога, находится на одном или нескольких сайтах в лес. Смежные сайты определяются как любые два или больше сайтов, входящих в одну связь сайтов.  
  
Мост связей сайтов создает логическое подключение между двумя связями сайтов, предоставляя транзитный путь между двумя отключенными сайтами с помощью промежуточного сайта. В целях создания межсайтовых топологий (ISTG) мост подразумевает физическое подключение с использованием промежуточного сайта. Мост не подразумевает, что контроллер домена на промежуточном сайте предоставит путь репликации. Тем не менее, если промежуточный сайт содержал контроллер домена, на котором размещен раздел каталога для репликации, в этом случае мост связей сайтов не требуется.  
  
Добавляется стоимость каждой связи сайтов, что приводит к созданию суммированных затрат для итогового пути. Мост связей сайтов будет использоваться, если промежуточный сайт не содержит контроллер домена, на котором размещается раздел каталога, а ссылка с более низкими затратами не существует. Если промежуточный сайт содержал контроллер домена, на котором размещается раздел каталога, два отключенных сайта настроили подключения репликации к промежуточному контроллеру домена и не используют мост.  
  
## <a name="BKMK_8"></a>Транзитивность связи сайтов  
По умолчанию все связи сайтов являются транзитивными или "моста". Если связи сайтов проходят мост и расписания перекрываются, KCC создает подключения репликации, которые определяют партнеров по репликации контроллеров домена между сайтами, где сайты не подключаются напрямую по связям сайтов, но подключаются через набор общих сайтов. Это означает, что можно подключить любой сайт к любому другому сайту, используя сочетание связей сайтов.  
  
Как правило, для полностью перенаправленной сети нет необходимости создавать мосты связей сайтов, если не требуется управлять потоком изменений репликации. Если сеть не была полностью направляться, необходимо создать мосты связей сайтов, чтобы избежать невозможности попыток репликации. Все связи сайтов для определенного транспорта неявно принадлежат одному мосту связей сайтов для этого транспорта. Мост по умолчанию для связей сайтов происходит автоматически, и ни один объект Active Directory не представляет этот мост. Параметр **мост все связи сайтов** , который находится в свойствах межсайтовых транспортных контейнеров (IP и SMTP), реализует автоматическую маршрутизацию связей сайтов.  
  
> [!NOTE]  
> Репликация SMTP не будет поддерживаться в будущих версиях AD DS; Поэтому не рекомендуется создавать объекты связей сайтов в контейнере SMTP.  
  
## <a name="BKMK_9"></a>Сервер глобального каталога  
Сервер глобального каталога — это контроллер домена, в котором хранятся сведения обо всех объектах в лесу, чтобы приложения могли выполнять поиск AD DS, не ссылаясь на конкретные контроллеры домена, в которых хранятся запрошенные данные. Как и все контроллеры домена, сервер глобального каталога хранит полные, доступные для записи реплики и разделы каталога конфигурации, а также полную доступную для записи реплику раздела каталога домена для домена, в котором он размещен. Кроме того, сервер глобального каталога сохраняет частичную реплику, доступную только для чтения, для каждого домена в лесу. Частичные реплики домена только для чтения содержат каждый объект в домене, но только подмножество атрибутов (эти атрибуты чаще всего используются для поиска объекта).  
  
## <a name="BKMK_10"></a>Кэширование членства в универсальных группах  
Кэширование членства в универсальных группах позволяет контроллеру домена кэшировать сведения о членстве в универсальных группах для пользователей. Контроллеры домена под управлением Windows Server 2008 можно включить для кэширования членства в универсальных группах с помощью оснастки "Active Directory сайты и службы".  
  
Включение кэширования членства в универсальных группах устраняет потребность в сервере глобального каталога на каждом сайте в домене, что сводит к минимуму использование полосы пропускания сети, поскольку контроллеру домена не требуется реплицировать все объекты, расположенные в лесу. Это также сокращает время входа в систему, так как контроллерам домена, выполняющим аутентификацию, не всегда требуется доступ к глобальному каталогу для получения сведений о членстве в универсальных группах. Дополнительные сведения об использовании кэширования членства в универсальных группах см. в разделе [Планирование размещения сервера глобального каталога](../../../ad-ds/plan/Planning-Global-Catalog-Server-Placement.md).  
  


