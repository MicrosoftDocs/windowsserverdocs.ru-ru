---
title: Обнаружение циклов устранения неполадок AD FS
description: В этом документе описывается устранение неполадок при обнаружении циклов
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.openlocfilehash: e3d654f44ba75d9b647c0c1d9db7345c7ea75435
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87953094"
---
# <a name="ad-fs-troubleshooting---loop-detection"></a>Обнаружение циклов устранения неполадок AD FS

Цикл в AD FS возникает, когда проверяющая сторона постоянно отклоняет действительный маркер безопасности и перенаправляется обратно в AD FS.

## <a name="loop-detection-cookie"></a>Файл cookie определения цикла
Чтобы предотвратить это, AD FS реализовал, что называется файлом cookie определения цикла. По умолчанию AD FS записывает файлы cookie в пассивные веб-клиенты с именем **мсислупдетектионкукие**. Этот файл Cookie содержит значение метки времени и число выданных токенов.  Это позволяет AD FS отследить, как часто и сколько раз клиент посетит служба федерации в определенном интервале времени.

Если пассивный клиент посещает служба федерации для маркера 5 (5) раз в течение 20 секунд, AD FS выдает следующую ошибку:

**MSIS7042: тот же сеанс браузера клиента сделал запросы " {0} " за последние "" {1} секунд. Для получения дополнительных сведений обратитесь к администратору.**

Вход в бесконечные циклы часто вызывается неправильным поведением приложения проверяющей стороны, которое не использует маркер, выданный AD FS, и приложение отправляет пассивный клиент обратно в AD FS, каждый раз для нового маркера.  AD FS будет выдавать пассивный клиент новый маркер каждый раз, если он не превышает 5 запросов в течение 20 секунд.

## <a name="adjusting-the-loop-detection-cookie"></a>Настройка файла cookie для определения цикла
С помощью PowerShell можно изменить число выданных токенов и значение TimeSpan.

```powershell
Set-AdfsProperties -LoopDetectionMaximumTokensIssuedInterval 5  -LoopDetectionTimeIntervalInSeconds 20
```
Минимальное значение для **лупдетектионмаксимумтокенсиссуединтервал** равно 1.

Минимальное значение для **лупдетектионтимеинтервалинсекондс** — 5.

Кроме того, при тестировании производительности можно отключить обнаружение циклов.

```powershell
Set-AdfsProperties -EnableLoopDetection $false
```

>[!IMPORTANT]
>Не рекомендуется постоянно отключать обнаружение циклов, так как это не позволяет пользователям переходить в бесконечное состояние цикла.


## <a name="next-steps"></a>Next Steps

- [Устранение неполадок в AD FS](ad-fs-tshoot-overview.md)



