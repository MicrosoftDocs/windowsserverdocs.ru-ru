---
title: Обнаружение циклов устранения неполадок AD FS
description: В этом документе описывается устранение неполадок при обнаружении циклов
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 2f8842dc53756cc4f65b6d6794a8c4952e111c00
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71385342"
---
# <a name="ad-fs-troubleshooting---loop-detection"></a>Обнаружение циклов устранения неполадок AD FS 
 
Цикл в AD FS возникает, когда проверяющая сторона постоянно отклоняет действительный маркер безопасности и перенаправляется обратно в AD FS.

## <a name="loop-detection-cookie"></a>Файл cookie определения цикла
Чтобы предотвратить это, AD FS реализовал, что называется файлом cookie определения цикла. По умолчанию AD FS записывает файлы cookie в пассивные веб-клиенты с именем **мсислупдетектионкукие**. Этот файл Cookie содержит значение метки времени и число выданных токенов.  Это позволяет AD FS отследить, как часто и сколько раз клиент посетит служба федерации в определенном интервале времени.

Если пассивный клиент посещает служба федерации для маркера 5 (5) раз в течение 20 секунд, AD FS выдает следующую ошибку:

@NO__T 0MSIS7042: Один сеанс браузера клиента сделал "{0}" запросами за последние "{1}" секунд. Для получения дополнительных сведений обратитесь к администратору. **

Вход в бесконечные циклы часто вызывается неправильным поведением приложения проверяющей стороны, которое не использует маркер, выданный AD FS, и приложение отправляет пассивный клиент обратно в AD FS, каждый раз для нового маркера.  AD FS будет выдавать пассивный клиент новый маркер каждый раз, если он не превышает 5 запросов в течение 20 секунд. 

## <a name="adjusting-the-loop-detection-cookie"></a>Настройка файла cookie для определения цикла
С помощью PowerShell можно изменить число выданных токенов и значение TimeSpan.

```powershell
Set-AdfsProperties -LoopDetectionMaximumTokensIssuedInterval 5  -LoopDetectionTimeIntervalInSeconds 20
```
Минимальное значение для **лупдетектионмаксимумтокенсиссуединтервал** равно 1.

Минимальное значение для **лупдетектионтимеинтервалинсекондс** — 5.

Кроме того, при тестировании производительности можно отключить обнаружение циклов.

```powershell
Set-AdfsProperties -EnableLoopDetection $false
```

>[!IMPORTANT]
>Не рекомендуется постоянно отключать обнаружение циклов, так как это не позволяет пользователям переходить в бесконечное состояние цикла.


## <a name="next-steps"></a>Следующие шаги

- [Устранение неполадок в AD FS](ad-fs-tshoot-overview.md)



