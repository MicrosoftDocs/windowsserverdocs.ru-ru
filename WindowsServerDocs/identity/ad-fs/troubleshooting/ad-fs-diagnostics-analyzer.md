---
title: Средство анализа данных диагностики AD FS
description: В этом документе описывается, AD FS анализатор диагностики справки и как он может выполнять основные проверки с помощью модуля AD FS диагностики PowerShell.
author: billmath
ms.author: billmath
manager: mtillman
ms.reviewer: anandyadavMSFT
ms.date: 03/29/2019
ms.topic: article
ms.openlocfilehash: e6d6063d3d01cda48a662160c9ad661169371677
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87956201"
---
# <a name="ad-fs-help-diagnostics-analyzer"></a>Средство анализа данных диагностики AD FS

AD FS имеет множество параметров, которые поддерживают широкий спектр функций, предоставляемых для проверки подлинности и разработки приложений. Во время устранения неполадок рекомендуется убедиться, что все параметры AD FS настроены правильно. Ручная проверка этих параметров иногда может занять много времени. Анализатор диагностики справки AD FS может помочь выполнить основные проверки с помощью модуля PowerShell Адфстулбокс. После выполнения проверок AD FS Справка предоставляет [анализатор диагностики](https://aka.ms/adfsdiagnosticsanalyzer) , помогающий легко визуализировать результаты и предложить действия по исправлению.

Полная операция выполняет три простых шага:

1. Настройка модуля Адфстулбокс на основном сервере AD FS или сервере WAP
2. Выполните диагностику и отправьте файл в AD FS справку.
3. Просмотр диагностического анализа и устранение проблем

Чтобы начать устранение неполадок, перейдите в раздел [AD FS Справка анализатор https://aka.ms/adfsdiagnosticsanalyzer) диагностики](https://aka.ms/adfsdiagnosticsanalyzer) .

![Анализатор диагностики AD FS в справке AD FS](media/ad-fs-diagonostics-analyzer/home.png)

## <a name="step-1-setup-the-adfstoolbox-module-on-ad-fs-server"></a>Шаг 1. Настройка модуля Адфстулбокс на сервере AD FS

Для запуска [анализатора диагностики](https://aka.ms/adfsdiagnosticsanalyzer)необходимо установить модуль PowerShell адфстулбокс. Если сервер AD FS имеет подключение к Интернету, модуль Адфстулбокс можно установить непосредственно из коллекции PowerShell. Если подключение к Интернету отсутствует, его можно установить вручную.

[!WARNING]
При использовании AD FS 2,1 или более ранней версии необходимо установить версию 1.0.13 Адфстулбокс. Адфстулбокс больше не поддерживает AD FS 2,1 или более поздней версии в последних версиях.

![Анализатор диагностики AD FS — установка](media/ad-fs-diagonostics-analyzer/step1_v2.png)

### <a name="setup-using-powershell-gallery"></a>Установка с помощью коллекции PowerShell

Если сервер AD FS имеет подключение к Интернету, рекомендуется установить модуль Адфстулбокс непосредственно из коллекции PowerShell с помощью команд PowerShell, приведенных ниже.

   ```powershell
    Install-Module -Name ADFSToolbox -force
    Import-Module ADFSToolbox -force
   ```

### <a name="setup-manually"></a>Установка вручную

Модуль Адфстулбокс необходимо вручную скопировать на серверы AD FS или WAP. Выполните приведенные далее инструкции.

1. Запустите окно PowerShell с повышенными привилегиями на компьютере, который имеет доступ к Интернету.
2. Установите модуль AD FS панели элементов.

    ```powershell
    Install-Module -Name ADFSToolbox -Force
    ```
3. Скопируйте папку Адфстулбокс, расположенную `%SYSTEMDRIVE%\Program Files\WindowsPowerShell\Modules\` на локальном компьютере, в то же расположение на AD FS или на компьютере WAP.

4. Запустите окно PowerShell с повышенными привилегиями на компьютере AD FS и выполните следующий командлет, чтобы импортировать модуль.

    ```powershell
    Import-Module ADFSToolbox -Force
    ```

## <a name="step-2-execute-the-diagnostics-cmdlet"></a>Шаг 2. выполнение командлета диагностики

![Анализатор диагностики AD FS — выполнение и отправка результатов](media/ad-fs-diagonostics-analyzer/step2_v2.png)

Для удобного выполнения диагностических тестов на всех AD FS серверах фермы можно использовать одну команду. Модуль PowerShell будет использовать удаленные сеансы PS для выполнения диагностических тестов на разных серверах фермы.

```powershell
    Export-AdfsDiagnosticsFile [-ServerNames <list of servers>]
```

На сервере 2016 или более поздней версии AD FS ферме команда будет считывать список серверов AD FS из конфигурации AD FS. Затем выполняется проверка диагностики для каждого сервера в списке. Если список серверов AD FS недоступен (например, 2012 R2), тесты выполняются на локальном компьютере. Чтобы указать список серверов, на которых должны выполняться тесты, используйте аргумент **ServerName** для предоставления списка серверов. Пример приведен ниже

```powershell
    Export-AdfsDiagnosticsFile -ServerNames @("adfs1.contoso.com", "adfs2.contoso.com")
```

Результатом является JSON-файл, который создается в том же каталоге, в котором выполнялась команда. Имя файла — Адфсдиагностиксфиле- \<timestamp\> . Пример имени файла — AdfsDiagnosticsFile-07312019-184201.js.

## <a name="step-3-upload-the-diagnostics-file"></a>Шаг 3. Отправка диагностического файла

На шаге 3 на странице [https://aka.ms/adfsdiagnosticsanalyzer](https://aka.ms/adfsdiagnosticsanalyzer) Использование браузера файлов для выбора файла результатов для отправки.

Нажмите кнопку **Отправить** , чтобы завершить отправку.

Выполнив вход с учетная запись Майкрософт, можно сохранить результаты диагностики для последующей точки просмотра и отправить в службу поддержки Майкрософт. Если в любой момент вы откроете обращение в службу поддержки, корпорация Майкрософт сможет просматривать результаты анализа диагностики и быстрее устранять неполадки.

![Анализатор диагностики AD FS — вход](media/ad-fs-diagonostics-analyzer/sign_in_step.png)

## <a name="step-4-view-diagnostics-analysis-and-resolve-any-issues"></a>Шаг 4. Просмотр диагностического анализа и устранение проблем

Существует пять разделов результатов теста:

1. Сбой: в этом разделе содержится список невыполненных тестов. Каждый результат состоит из следующих элементов:
2. Внимание! в этом разделе содержится список тестов, которые привели к появлению предупреждения. Эти проблемы, скорее всего, не приведут к возникновению проблем с проверкой подлинности на более широком масштабе, но их следует устранять наиболее ранним образом.
3. Пройдено: Этот раздел содержит список пройденных тестов и не имеет элемента действия для пользователя.
4. Не запущено: в этом разделе содержится список тестов, которые не удалось выполнить из-за отсутствия сведений.
5. Неприменимо. в этом разделе содержится список тестов, которые не были выполнены, так как они не были применимы для конкретного сервера, на котором выполнялась команда.

![Средство анализатора диагностики AD FS — список результатов теста ](media/ad-fs-diagonostics-analyzer/step3a_v3.png) с подробными сведениями, описывающими тест, и разрешением шагов.

1. Имя теста: имя выполненного теста.
2. Описание: описание теста.
3. Сведения: описание общей операции, выполненной во время теста
4. Действия по устранению: предлагаемые шаги по устранению проблемы, выделенной для теста

![Средство анализа диагностики AD FS — Устранение сбоев](media/ad-fs-diagonostics-analyzer/step3b_v3.png)

## <a name="next"></a>Следующая

- [Использование AD FS справочных руководств траублехшутинг](https://aka.ms/adfshelp/troubleshooting )
- [Устранение неполадок в AD FS](ad-fs-tshoot-overview.md)
