---
title: Сертификаты AD FS Устранение неполадок.
description: В этом документе описываются типичные сертификат проблемы.
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 02/21/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 42fdce936bb4a6f25b456c4a96c7b99f650e6033
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59860585"
---
# <a name="ad-fs-troubleshooting---certificates"></a>Сертификаты AD FS Устранение неполадок.
AD FS требует следующие сертификаты для правильной работы.  Если любой из этих не настроена или неправильно настроена, могут возникнуть проблемы.  

## <a name="required-certificates"></a>Необходимые сертификаты
AD FS требуются следующие сертификаты:



- **Доверие федерации** – это требует сертификата, привязаны к корневому доверенной Интернет центра сертификации (ЦС) в доверенном корневом хранилище поставщика утверждений и проверяющей стороной серверов федерации перекрестная сертификация разработки реализована, в котором каждая сторона состоит обмен корневому центру сертификации со своим партнером или самозаверяющие сертификаты, импортированные на каждой стороне, где это необходимо.
- **Подписи маркера** — каждая служба федерации компьютера требуется сертификат подписи маркера.  Сертификат подписи токена утверждений поставщика должен быть доверенным проверяющей стороной сервера федерации. Доверяющая сторона сертификат для подписи маркера должен быть доверенным на все приложения, получать маркеры от сервера федерации RP.
- **Secure Sockets Layer (SSL)** — SSL-сертификат для службы федерации, должно присутствовать в надежном хранилище на компьютере прокси-сервера федерации и имеет допустимую цепочку в надежном хранилище центра сертификации (ЦС).
- **Список отзыва (CRL) сертификата** — для любой сертификат, имеющий список отзыва Сертификатов публикации списка отзыва Сертификатов должен быть доступен для всех клиентов и серверов, которым требуется доступ к сертификату.

Если любой из указанных выше настроены неправильно, AD FS не будет работать.

## <a name="common-things-to-check-with-certificates"></a>Что нужно проверить с помощью сертификатов
Ниже приведен список требований, которые могут возникнуть и подтвердить при попытке разрешить проблемы с сертификатом.

- Убедитесь, что сертификат является доверенным
    - SSL-сертификаты должны быть доверенным для клиентов
    - Сертификат для подписи маркера должны быть доверенным для проверяющих сторон
- Проверяет цепочку доверия - каждый сертификат в цепочке, должна быть допустимым.
- Проверьте настройку даты окончания срока действия сертификата
- Проверить специальные возможности списка отзыва сертификатов (CRL)
    - Убедитесь, что будет заполнено CDP
    - Вручную перейти к CDP
- Убедитесь, что сертификат не отозван

## <a name="common-certificate-errors"></a>Распространенные ошибки сертификата
Ниже приведен список распространенных ошибок и возможные причины.

|Событие|Причина|Разрешение
|-----|-----|-----|
|Событие 249 - сертификат не удалось найти в хранилище сертификатов. В сценариев переключения сертификатов это потенциально могут вызвать сбой, когда служба федерации подписи или расшифровки с помощью этого сертификата.|Этот сертификат отсутствует в локальном хранилище сертификатов, или учетная запись службы не имеет разрешения для закрытого ключа сертификата.|Убедитесь, что сертификат установлен в хранилище LocalMAchine\My на сервере AD FS. Убедитесь, что учетная запись службы AD FS имеет доступ на чтение к закрытому ключу сертификата.|
|Событие 315 - произошла ошибка при попытке создать цепочку сертификатов для сертификата для подписи доверия поставщика утверждений.|Сертификат отозван.</br></br>Не удается проверить цепочку сертификатов.</br></br>Сертификат просрочен или еще не вступил в силу.|Убедитесь, что сертификат является допустимым и не был отозван.</br></br>Убедитесь, что он доступен.|
|Событие 316 - произошла ошибка при попытке создать цепочку сертификатов для доверия с проверяющей стороной сертификат для подписи.|Сертификат отозван.</br></br>Не удается проверить цепочку сертификатов.</br></br>Сертификат просрочен или еще не вступил в силу.|Убедитесь, что сертификат является допустимым и не был отозван.</br></br>Убедитесь, что он доступен.|
|Событие 317 - произошла ошибка при попытке создать цепочку сертификатов для сертификата шифрования доверия проверяющей стороны субъекта.|Сертификат отозван.</br></br>Не удается проверить цепочку сертификатов.</br></br>Сертификат просрочен или еще не вступил в силу.|Убедитесь, что сертификат является допустимым и не был отозван.</br></br>Убедитесь, что он доступен.|
|Событие 319 - произошла ошибка цепочки сертификатов для сертификата клиента создан.|Сертификат отозван.</br></br>Не удается проверить цепочку сертификатов.</br></br>Сертификат просрочен или еще не вступил в силу.|Убедитесь, что сертификат является допустимым и не был отозван.</br></br>Убедитесь, что он доступен.|
|Событие 360 - был сделан запрос к конечной точке транспортного сертификат, но запрос не содержит сертификат клиента.|Корневой ЦС, выдавшего сертификат клиента не является доверенным.</br></br>Срок действия сертификата клиента.</br></br>Клиентский сертификат является самозаверяющим и не является доверенным.|Убедитесь, что корневой ЦС, выдавшего сертификат клиента в доверенном корневом хранилище.</br></br>Убедитесь, что сертификат клиента не истек.</br></br>Если клиентский сертификат является самозаверяющим, убедитесь, что оно было добавлено в список доверенных сертификатов или заменить самозаверяющий сертификат доверенным сертификатом.|
|Событие 374 - ошибка при построении цепочки сертификатов для поставщика утверждений доверия сертификата шифрования.|Сертификат отозван.</br></br>Не удается проверить цепочку сертификатов.</br></br>Сертификат просрочен или еще не вступил в силу.|Убедитесь, что сертификат является допустимым и не был отозван.</br></br>Убедитесь, что он доступен.|
|Событие 381 - произошла ошибка при попытке создать цепочку сертификатов для сертификата конфигурации.|Один из сертификатов, настроенный для использования на сервере AD FS истек или был отозван.|Убедитесь, что все настроенные сертификаты не был отозван и не истек.|
|Событие 385 — AD FS обнаруживается, что один или несколько сертификатов в базе данных конфигурации AD FS должен быть обновлен вручную.|Один из сертификатов, настроенный для использования на сервере AD FS истек или близко к датой истечения срока действия.|Обновление сертификата истек или скоро к закончится с заменой. (Если вы используете самозаверяющие сертификаты и включена автоматическая смена сертификатов, эта ошибка может быть пропущено он будет самостоятельно решить проблему.)|
|Событие 387 - AD FS обнаруживается, что один или несколько сертификатов, указанных в службе федерации не были доступными для учетной записи службы, которая используется службой AD FS Windows.|Учетная запись службы AD FS нет разрешения на чтение к закрытому ключу из одного или нескольких настроенных сертификатов.|Убедитесь, что учетная запись службы AD FS разрешение на чтение к закрытому ключу всех настроенных сертификатов.|
|Событие 389 - AD FS обнаруживается, что один или несколько отношений доверия с вашей требуют свои сертификаты, чтобы обновить вручную, так как они являются истек или скоро истечет.|Один из настроенных партнера сертификатов истек или истекает срок действия. Это можно применить либо доверия с поставщиком утверждений или с проверяющей стороной.|Если вы вручную создали этого отношения доверия, вручную обновите конфигурацию сертификата. При использовании метаданных федерации для создания отношения доверия сертификата будут обновляться автоматически, как только партнер обновляет сертификат.|




## <a name="next-steps"></a>Следующие шаги

- [Устранение неполадок AD FS](ad-fs-tshoot-overview.md)
 