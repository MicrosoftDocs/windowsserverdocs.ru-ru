---
ms.assetid: a2f23877-30a7-439f-817d-387da9e00e86
title: Настройка компьютера для роли прокси-сервера сервера федерации
description: ''
author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.author: billmath
ms.openlocfilehash: d47f7d3985aa779276f0712347eb9030857cefdb
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71359797"
---
# <a name="configure-a-computer-for-the-federation-server-proxy-role"></a>Настройка компьютера для роли прокси-сервера сервера федерации

После настройки компьютера с необходимыми сертификатами и установки службы роли прокси-агент службы федерации можно приступать к настройке компьютера в качестве прокси-сервера федерации. Чтобы назначить компьютеру роль прокси-сервера федерации, выполните указанные ниже действия.  
  
> [!IMPORTANT]  
> Прежде чем использовать эту процедуру для настройки компьютера прокси-сервера федерации, убедитесь, что выполнены все действия, описанные в разделе [Checklist: Настройка прокси-сервера федерации @ no__t-0 в том порядке, в котором они перечислены. Убедитесь, что развернут по крайней мере один сервер федерации и что реализованы все необходимые для создания конфигурации прокси-сервера федерации учетные данные. Необходимо также настроить привязки SSL \(SSL @ no__t-1 на веб-сайте по умолчанию, иначе мастер не запустится. Прежде чем данный прокси-сервер федерации сможет функционировать, все эти задачи должны быть выполнены.  
  
После настройки компьютера проверьте работоспособность прокси-сервера федерации. Дополнительные сведения см. в разделе [Проверка функционирования прокси-сервера федерации](Verify-That-a-Federation-Server-Proxy-Is-Operational.md).  
  
Для выполнения этой процедуры минимальным требованием является членство в группе **Администраторы** или эквивалентные права на локальном компьютере.  Просмотрите сведения об использовании соответствующих учетных записей и членстве в группах в [локальной среде и группах домена по умолчанию](https://go.microsoft.com/fwlink/?LinkId=83477).   
  
### <a name="to-configure-a-computer-for-the-federation-server-proxy-role"></a>Настройка компьютера для роли прокси-сервера сервера федерации  
  
1.  Запустить мастер настройки сервера федерации AD FS можно двумя способами. Чтобы запустить мастер, выполните одно из следующих действий.  
  
    -   На **начальном** экране введите**AD FS мастер настройки прокси-сервера федерации**и нажмите клавишу ВВОД.  
  
    -   В любое время после завершения работы мастера установки откройте проводник Windows, перейдите в папку **C: \\Windows @ no__t-2ADFS** , а затем дважды @ no__t-3click **фспконфигвизард. exe**.  
  
2.  Используя любой из методов, запустите мастер, а затем на странице **Приветствие** нажмите кнопку **Далее**.  
  
3.  На странице **Указание имени службы федерации** в разделе **Имя службы федерации** введите имя, представляющее службу федерации, для которой данный компьютер будет функционировать в роли прокси-сервера.  
  
4.  С учетом конкретных сетевых требований определите, потребуется ли использовать прокси-сервер HTTP для пересылки запросов в службу федерации. Если да, установите флажок **Использовать прокси-сервер HTTP при отправке запросов в эту службу федерации**, в поле **Адрес прокси-сервера HTTP** введите адрес прокси-сервера, щелкните **Проверка соединения**, чтобы убедиться в исправности подключения, а затем нажмите кнопку **Далее**.  
  
5.  В ответ на соответствующий запрос укажите учетные данные, необходимые для установки отношений доверия между этим прокси-сервером федерации и службой федерации.  
  
    По умолчанию прокси-сервер федерации может авторизовать только учетная запись службы, используемая служба федерации или членом локальной ВСТРОЕНной группы @ no__t-0Administrators.  
  
6.  Просмотрите подробные сведения на странице **Готовность к применению настроек**. Если параметры указаны верно, нажмите кнопку **Далее**, чтобы начать настройку данного компьютера с указанными параметрами прокси-сервера.  
  
7.  Просмотрите результаты на странице **Результаты конфигурации** . Завершив все действия по настройке конфигурации, щелкните **Закрыть**  , чтобы выйти из мастера.  
  
    Отсутствует консоль управления Microsoft \(MMC @ no__t-1 Snap @ no__t-2in, которая используется для администрирования прокси-серверов федерации. Чтобы настроить параметры для каждого из прокси-серверов федерации в Организации, используйте командлеты Windows PowerShell.  
  
## <a name="configuring-an-alternate-tcpip-port-for-proxy-operations"></a>Настройка альтернативного порта TCP @ no__t-0IP для операций прокси-сервера  
По умолчанию служба прокси-сервера федерации настроена для использования порта TCP 443 для HTTPS-трафика и порта 80 для трафика HTTP для связи с сервером федерации. Для настройки других портов, например TCP-порта 444 для HTTPS и порта 81 для HTTP, необходимо выполнить следующие действия.  
  
> [!NOTE]  
> Если вы планируете изначально развернуть AD FS для работы с альтернативными портами TCP @ no__t-0IP, сначала следует изменить порты в привязках протокола IIS для HTTP и HTTPS на серверах федерации и прокси-серверах федерации. Это должно произойти перед запуском мастеров настройки AD FS для начальной настройки. Если вы настроили службы IIS \(IIS @ no__t-1 First, то другие параметры порта TCP @ no__t-2IP будут обнаружены при выполнении конфигурации Wizard @ no__t-3based в AD FS, а следующая процедура не требуется. Если впоследствии требуется изменить параметры порта, сначала обновите IIS-привязки протокола, а затем с помощью следующей процедуры обновите параметры порта соответствующим образом. Дополнительные сведения об изменении привязок IIS см. в [статье 149605](https://go.microsoft.com/fwlink/?LinkId=190275) базы знаний Майкрософт.  
  
#### <a name="to-configure-alternate-tcpip-ports-for-the-federation-server-proxy-to-use"></a>Настройка альтернативных портов TCP @ no__t-0IP для использования прокси-сервером федерации  
  
1.  Настройте сервер федерации для использования портов, отличных от портов по умолчанию.  
  
    Для этого укажите номер порта, отличный от используемого по умолчанию, путем включения параметров *HttpsPort* и *HttpPort* как часть командлета **Set @ no__t-3ADFSProperties** . Например, чтобы настроить эти порты, используйте следующие команды в сеансе Windows PowerShell на компьютере сервера федерации:  
  
    ```  
    Set-ADFSProperties -HttpsPort 444  
    Set-ADFSProperties -HttpPort 81  
    ```  
  
2.  Настройте прокси-сервер федерации для использования порта, не используемого по умолчанию.  
  
    Для этого укажите номер порта, отличный от используемого по умолчанию, путем включения параметров *HttpsPort* и *HttpPort* как часть командлета **Set @ no__t-3ADFSProxyProperties** . Например, чтобы настроить эти порты, используйте следующие команды в сеансе Windows PowerShell на компьютере сервера федерации:  
  
    ```  
    Set-ADFSProxyProperties -HttpsPort 444  
    Set-ADFSProxyProperties -HttpPort 81  
    ```  
  
    > [!NOTE]  
    > URL-адреса конечных точек не включены по умолчанию для прокси-службы сервера федерации. При настройке новой установки сервера федерации необходимо сначала включить конечные точки прокси-службы сервера федерации. Например, предполагается, что для всех конечных точек, на которые ссылается пример в этой процедуре, вы включили их для прокси-сервера, выбрав их в AD FS Management Snap @ no__t-0in, а затем выбрав **Enable on Proxy (включить на прокси-сервере**).  
  
3.  Обновите установку IIS на прокси-сервере федерации, чтобы язык разметки зявлений системы безопасности (SAML) \(SAML @ no__t-1 и WS @ no__t-2Trust были настроены для отображения обновленного номера порта. Для этого можно использовать Блокнот, чтобы внести изменения в файл Web. config, который находится в папке systemdrive% \\inetpub @ no__t-1adfs @ no__t-2Ls @ no__t-3 на компьютере прокси-сервера федерации. Например, если у вас есть сервер федерации с именем sts1.contoso.com, а новый номер порта — 444, найдите и откройте файл Web. config в блокноте на компьютере прокси-сервера федерации, найдите следующий раздел, измените номер порта на Выделите ниже, а затем сохраните и закройте Блокнот.  
  
    ```  
    <securityTokenService samlProtocolEndpoint="https://sts1.contoso.com:444/adfs/services/trust/samlprotocol/proxycertificatetransport"  
          wsTrustEndpoint="https://sts1.contoso.com:444/adfs/services/trust/proxycertificatetransport" />  
    ```  
  
4.  Добавьте учетную запись пользователя службы прокси-сервера федерации в список управления доступом \(ACL @ no__t-1 для соответствующих URL-адресов конечной точки. Например, если номер порта — 1234, а учетная запись пользователя, используемая для запуска службы прокси-сервера AD Фсфедератион в, — это созданная учетная запись сетевой службы @ no__t-0in, введите в командной строке следующую команду:  
  
    ```  
    netsh http add urlacl https://+:444/adfs/fs/federationserverservice.asmx/ user="NT Authority\Network Service"  
    netsh http add urlacl https://+:444/FederationMetadata/2007-06/ user="NT Authority\Network Service"  
    netsh http add urlacl https://+:444/adfs/services/ user="NT Authority\Network Service"  
  
    netsh http add urlacl http://+:81/adfs/services/ user="NT Authority\Network Service"  
    ```  
  
    Предыдущие команды должны выполняться как на сервере федерации, так и на прокси-серверах федерации.  
  
## <a name="additional-references"></a>Дополнительная справка  
[Контрольный список. Настройка прокси-сервера федерации](Checklist--Setting-Up-a-Federation-Server-Proxy.md)  
  

