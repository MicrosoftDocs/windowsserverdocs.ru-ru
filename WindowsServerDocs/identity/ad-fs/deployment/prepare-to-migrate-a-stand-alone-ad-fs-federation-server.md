---
title: "Подготовка к миграции изолированного сервера федерации AD FS"
description: "Содержит сведения о подготовке к миграции изолированного сервера AD FS в Windows Server 2012."
author: billmath
ms.author: billmath
manager: femila
ms.date: 06/28/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 0c1fd2bc1026d9aee25c591cf5c91a1c59f66ee0
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2017
---
#  <a name="prepare-to-migrate-a-stand-alone-ad-fs-federation-server-or-a-single-node-ad-fs-farm"></a>Подготовка к миграции изолированного сервера федерации AD FS или фермы AD FS с одним узлом  
 
Изолированный сервер AD FS 2.0 федерации или фермы AD FS с одним узлом на Windows Server 2012 для подготовки к миграции (того же сервера) необходимо экспортировать и выполнить резервное копирование данных конфигурации AD FS с этого сервера.  
  
Чтобы экспортировать данные конфигурации AD FS, выполните следующие задачи:  
  
-   [Шаг 1: Экспорт параметров службы](#step-1-export-service-settings)  
  
-   [Шаг 2: Экспорт отношений доверия поставщика утверждений](#step-2-export-claims-provider-trusts)  
  
-   [Шаг 3: Экспорт отношений доверия с проверяющей стороной](#step-3-export-relying-party-trusts)  
  
-   [Шаг 4: Резервное копирование хранилищ настраиваемых атрибутов](#step-4-back-up-custom-attribute-stores)  
  
-   [Шаг 5: Резервное копирование пользовательских настроек веб-страницы](#step-5-back-up-webpage-customizations)  
  
## <a name="step-1-export-service-settings"></a>Шаг 1: Экспорт параметров службы  
 Чтобы экспортировать параметры службы, выполните следующую процедуру.  
  
### <a name="to-export-service-settings"></a>Экспорт параметров службы  
  
1.  Запишите значение субъекта сертификата имя и отпечаток сертификата SSL, используемого службой федерации. Чтобы найти SSL-сертификат, откройте Internet Information Services (IIS) управления консоли, выберите команду **веб-сайт по умолчанию** в левой области щелкните **привязки...** в **действие** , найдите и выберите https-привязки, нажмите кнопку **изменить**, а затем нажмите кнопку **представление**.  
  
> [!NOTE]
>  Кроме того вы также можете экспортировать SSL-сертификат, используемый службой федерации и его закрытый ключ в PFX-файл. Дополнительные сведения см. в разделе [Экспорт части сертификата аутентификации сервера с закрытым ключом ](Export-the-Private-Key-Portion-of-a-Server-Authentication-Certificate.md).  
>   
>  Экспорт SSL-сертификат является обязательным, потому что этот сертификат хранится в хранилище личных сертификатов на локальном компьютере и сохраняется при обновлении операционной системы.  
  
2.  Зафиксируйте конфигурацию сертификатов взаимодействия служб AD FS, сертификатов расшифровки и подписи токенов.  Для просмотра всех сертификатов, которые используются, откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell:`PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду для создания списка всех сертификатов, используемых в файл `PSH:>Get-ADFSCertificate | Out-File “.\certificates.txt”`  
  
> [!NOTE]
>  Кроме того можно также экспортировать любые сертификаты подписи токена, шифрования токена или взаимодействия служб и ключи, которые не создаются внутри организации, помимо самозаверяющих сертификатов. Можно просмотреть все сертификаты, используемые на сервере с помощью Windows PowerShell. Откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell:`PSH:>add-pssnapin “Microsoft.adfs.powershell`. Затем выполните следующую команду для просмотра всех сертификатов, используемых на сервере `PSH:>Get-ADFSCertificate`. Выходные данные этой команды содержит значения StoreLocation и StoreName, указывающие на расположение хранилища каждого сертификата. Затем можно воспользоваться инструкциями в [Экспорт части сертификата аутентификации сервера с закрытым ключом](Export-the-Private-Key-Portion-of-a-Server-Authentication-Certificate.md) Чтобы экспортировать каждый сертификат и его закрытый ключ в PFX-файл.  
>   
>  Экспорт этих сертификатов является обязательным, потому что все внешние сертификаты во время обновления операционной системы сохраняются.  
  
3.  Экспорт AD FS 2.0 свойства службы федерации, такие как имя службы федерации, отображаемое имя службы федерации и идентификатор службы федерации в файл.  
  
Чтобы экспортировать свойства службы федерации, откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell:`PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду, чтобы экспортировать свойства службы федерации:`PSH:> Get-ADFSProperties | Out-File “.\properties.txt”`.  
  
Выходной файл будет содержать следующие важные значения конфигурации:  
  
    
|**Имя свойства службы федерации, возвращенное командой Get-ADFSProperties**|**Имя свойства службы федерации в консоли управления AD FS**|
|------|------|
|Имя узла|Имя службы федерации|  
|Идентификатор|Идентификатор службы федерации|  
|Отображаемое имя|Отображаемое имя службы федерации|  
  
4.  Создайте резервную копию файла конфигурации приложения. Вместе с другими параметрами этот файл содержит строку подключения к базе данных политик.  
  
Чтобы создать резервную копию файла конфигурации приложения, необходимо вручную скопировать `%programfiles%\Active Directory Federation Services 2.0\Microsoft.IdentityServer.Servicehost.exe.config` надежное расположение на резервном сервере.  
  
> [!NOTE]
>  Запишите строку подключения к базе данных в этот файл, расположенный сразу после «policystore connectionstring =»). Если строка подключения указывает на базу данных SQL Server, то это значение понадобится при восстановлении исходной конфигурации AD FS на сервере федерации.  
>   
>  Ниже приводится пример строки подключения к внутренней базы данных Windows: `“Data Source=\\.\pipe\mssql$microsoft##ssee\sql\query;Initial Catalog=AdfsConfiguration;Integrated Security=True"`. Ниже приводится пример строки подключения к SQL Server: `"Data Source=databasehostname;Integrated Security=True"`.  
  
5.  Запишите удостоверение учетной записи службы AD FS 2.0 federation и пароль этой учетной записи.  
  
Чтобы найти значение удостоверения, просмотрите **вход в систему** столбец **AD Windows служб федерации Active Directory 2.0** в **службы** Запишите это значение.  
  
> [!NOTE]
>  Для автономной службы федерации использовать встроенную учетную запись СЕТЕВОЙ службы.  В этом случае не нужно иметь пароль.  
  
6.  Экспортируйте список задействованных конечных точек AD FS в файл.  
  
Для этого откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell:`PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду для экспорта списка активированных конечных точек AD FS в файл:`PSH:> Get-ADFSEndpoint | Out-File “.\endpoints.txt”`.  
  
7.  Экспортируйте все пользовательские описания утверждений в файл.  
  
Для этого откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell:`PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду, чтобы экспортировать описания пользовательских утверждений в файл:`Get-ADFSClaimDescription | Out-File “.\claimtypes.txt”`.  
  
##  <a name="step-2-export-claims-provider-trusts"></a>Шаг 2: Экспорт отношений доверия поставщика утверждений  
 Чтобы экспортировать отношения доверия поставщика утверждений, выполните следующие действия.  
  
### <a name="to-export-claims-provider-trusts"></a>Чтобы экспортировать отношения доверия с поставщиком утверждений  
  
1.  Можно использовать Windows PowerShell для экспорта всех отношений с поставщиком утверждений. Откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell: `PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду для экспорта всех отношений с поставщиками утверждений:`PSH:>Get-ADFSClaimsProviderTrust | Out-File “.\cptrusts.txt”`.  
  
## <a name="step-3-export-relying-party-trusts"></a>Шаг 3: Экспорт отношений доверия с проверяющей стороной  
 Чтобы экспортировать отношения доверия с проверяющей стороной, выполните следующую процедуру.  
  
### <a name="to-export-relying-party-trusts"></a>Чтобы экспортировать отношения доверия с проверяющей стороной  
  
1.  Чтобы экспортировать отношения доверия всех проверяющей стороной, откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell:`PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду, чтобы экспортировать отношения доверия всех проверяющей стороной:`PSH:>Get-ADFSRelyingPartyTrust | Out-File “.\rptrusts.txt”`.  
  
## <a name="step-4-back-up-custom-attribute-stores"></a>Шаг 4: Резервное копирование хранилищ настраиваемых атрибутов  
 Сведения о хранилищах настраиваемых атрибутов можно найти в используемых ролью AD FS с помощью Windows PowerShell. Откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell: `PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду, чтобы найти сведения о хранилищах настраиваемых атрибутов:`PSH:>Get-ADFSAttributeStore`. Действия по обновлению или переносу пользовательских хранилищ атрибутов могут быть разными.  
  
## <a name="step-5-back-up-webpage-customizations"></a>Шаг 5: Резервное копирование пользовательских настроек веб-страницы  
 Чтобы выполнить резервное копирование пользовательских настроек веб-страницы, копируйте веб-страницы AD FS и **web.config** из каталога, сопоставленного виртуальному пути **«/ adfs/ls»** в службах IIS. По умолчанию он находится в **%systemdrive%\inetpub\adfs\ls** каталога.  

## <a name="next-steps"></a>Дальнейшие действия
 [Подготовка к миграции сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-server.md)   
 [Подготовка к миграции прокси-сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-proxy.md)   
 [Перенос сервера AD FS 2.0 Federation](migrate-the-ad-fs-fed-server.md)   
 [Перенос прокси-сервера AD FS 2.0 Federation](migrate-the-ad-fs-2-fed-server-proxy.md)   
 [Перенос 1.1 веб-агенты AD FS](migrate-the-ad-fs-web-agent.md)