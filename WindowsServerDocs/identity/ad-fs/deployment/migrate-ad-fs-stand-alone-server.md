---
title: "Миграция изолированного сервера федерации AD FS или фермы AD FS с одним узлом"
description: "Содержит сведения о миграции сервера подставки отдельно или одним узлом AD FS 2.0 в Windows Server 2012"
author: billmath
ms.author: billmath
manager: femila
ms.date: 06/28/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 10371349fe19be92fb997c9c28f19def0ecad7e9
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2017
---
# <a name="migrate-a-stand-alone-ad-fs-federation-server-or-a-single-node-ad-fs-farm"></a>Миграция изолированного сервера федерации AD FS или фермы AD FS с одним узлом  
В этом документе приведены подробные сведения о миграции AD FS 2.0 подставки только сервера Windows Server 2012.

## <a name="migrate-a-stand-alone-ad-fs-20-server"></a>Миграция изолированного AD FS 2.0 сервера

Используйте следующую процедуру для переноса AD FS 2.0 сервера в Windows Server 2012.
  
1.  Изучите и выполните процедуры, описанные в [Подготовка к миграции изолированного сервера федерации AD FS или фермы AD FS с одним узлом](prepare-to-migrate-a-stand-alone-ad-fs-federation-server.md).  
  
2.  Выполните обновление на месте операционной системы на сервере с Windows Server 2008 R2 или Windows Server 2008 на Windows Server 2012. Дополнительные сведения см. в разделе [Установка Windows Server 2012](https://technet.microsoft.com/library/jj134246.aspx).  
  
> [!IMPORTANT]
>  В результате обновления ОС конфигурация AD FS на этом сервере была утрачена, а затем удаляется 2.0 серверной роли AD FS. Вместо этого установлена роль сервера Windows Server 2012 AD FS, но она не настроена. Необходимо вручную создать исходную конфигурацию AD FS и восстановить остальные параметры AD FS, чтобы завершить миграцию сервера федерации.  
  
3.  Создайте исходную конфигурацию AD FS. Можно создать исходную конфигурацию AD FS с помощью любого из следующих методов:  
  
-   Используйте **мастера конфигурации сервера федерации AD FS** для создания нового сервера федерации. Дополнительные сведения см. в разделе [создание первого сервера федерации в ферме серверов федерации](Create-the-First-Federation-Server-in-a-Federation-Server-Farm.md).  
  
По мере выполнения мастера, используйте информацию, полученную в ходе подготовки к миграции сервера федерации AD FS, следующим образом:  
  
 |**Вводный параметр мастера конфигурации сервера федерации**|**Используйте следующее значение**| 
|-----|-----| 
|**SSL-сертификат** на **Указание имени службы федерации** страницы|Выберите SSL-сертификат, имя субъекта и отпечаток, записанные в ходе подготовки к миграции сервера федерации AD FS.|  
|**Учетная запись службы** и **пароль** на **указать учетную запись службы** страницы|Введите сведения об учетной записи службы, записанные в ходе подготовки к миграции сервера федерации AD FS. **Примечание:** при выборе автономного сервера федерации на второй странице мастера сетевая служба автоматически используется как учетная запись службы.|  
  
> [!IMPORTANT] 
> Этот метод можно использовать только в том случае, если вы используете внутренней базы данных Windows (WID) для хранения базы данных конфигурации AD FS для изолированного сервера федерации или фермы AD FS с одним узлом.  
>
>  Если вы используете SQL Server для хранения базы данных конфигурации AD FS для одного узла фермы AD FS, необходимо использовать Windows PowerShell для создания исходной конфигурации AD FS на сервере федерации.  
  
-   С помощью Windows PowerShell  
  
> [!IMPORTANT]
>  Если вы используете SQL Server для хранения базы данных конфигурации AD FS для изолированного сервера федерации или фермы AD FS с одним узлом, необходимо использовать Windows PowerShell.  
  
Ниже приведен пример того, как использовать Windows PowerShell для создания исходной конфигурации AD FS на сервере федерации в ферме SQL Server с одним узлом.  Откройте модуль Windows PowerShell и выполните следующую команду: `$fscredential = Get-Credential`. Введите имя и пароль учетной записи службы, записанные в ходе подготовки фермы серверов SQL к миграции. Затем выполните следующую команду: `C:\PS> Add-AdfsFarmNode -ServiceAccountCredential $fscredential -SQLConnectionString "Data Source=<Data Source>;Integrated Security=True"` где `Data Source` — это значение источника данных в значении строки подключения политики магазина в следующем файле: `%programfiles%\Active Directory Federation Services 2.0\Microsoft.IdentityServer.Servicehost.exe.config`.  
  
4.  Восстановите остальные параметры службы AD FS и отношения доверия. Этот шаг выполняется вручную во время которых можно использовать экспортированные файлы и значения, которые собираются при подготовке к миграции AD FS. Подробные инструкции см. в разделе Восстановление остальной конфигурации AD FS фермы.  
  
> [!NOTE]
>  Этот шаг необходим только при миграции изолированного сервера федерации или фермы внутренней базы данных Windows с одним узлом.  Если сервер федерации использует базы данных SQL Server в качестве хранилища конфигурации, параметры службы и отношения доверия сохраняются в базе данных.  
  
5.  Обновите веб-страницы AD FS. Этот шаг выполняется вручную. Если вы выполнили резервное копирование настроенных веб-страниц AD FS при подготовке к миграции, воспользуйтесь резервными данными для перезаписи веб-страницы AD FS, созданных по умолчанию в по умолчанию **%systemdrive%\inetpub\adfs\ls** каталог, в результате конфигурации AD FS в Windows Server 2012.  
  
6.  Восстановите остальные пользовательские настройки AD FS, например хранилища настраиваемых атрибутов.  
  
## <a name="restoring-the-remaining-ad-fs-farm-configuration"></a>Восстановление остальной конфигурации AD FS фермы  
  
-   Восстановите следующие параметры службы AD FS фермы внутренней базы данных Windows одним узлом или изолированную службу федерации следующим образом:  
  
    -   В консоли управления AD FS выберите **службы** и нажмите кнопку **изменить службу федерации... **. Проверьте параметры службы федерации, сопоставляя каждое значение со значениями, со значениями, экспортированными в файл properties.txt при подготовке к миграции.  
  
    
|**Имя свойства службы федерации, возвращенное командой Get-ADFSProperties**|**Имя свойства службы федерации в консоли управления AD FS**|  
|-----|-----|
|Отображаемое имя|Отображаемое имя службы федерации|  
|Имя узла|Имя службы федерации|  
|Идентификатор|Идентификатор службы федерации|  
  
-   В консоли управления AD FS выберите **сертификаты**. Проверьте сообщения службы, сертификатов расшифровки и подписи токенов, сопоставляя каждое значение со значениями, экспортированными в файл certificates.txt при подготовке к миграции.  
  
Чтобы изменить сертификаты шифрования маркеров или для подписи маркера самозаверяющие сертификаты по умолчанию на внешние сертификаты, сначала необходимо отключить функцию автоматического сертификатов смены, включенный по умолчанию.  Чтобы сделать это, можно использовать следующую команду Windows PowerShell: `PSH: Set-ADFSProperties –AutoCertificateRollover $false`.  
  
-   В консоли управления AD FS выберите **конечные точки**. Проверьте задействованные конечные точки AD FS по списку задействованных конечных точек AD FS, который был экспортирован в файл при подготовке к миграции AD FS.  
  
-   В консоли управления AD FS выберите **описания утверждений**. Сверьте список описаний утверждений AD FS со списком описаний утверждений, который был экспортирован в файл при подготовке к миграции AD FS. Добавьте все пользовательские описания утверждений содержащиеся в вашем файле, но не включены в список по умолчанию в AD FS.  Обратите внимание, что свойство утверждения identifier на консоли управления соответствует свойству claimtype в файле.  Дополнительные сведения о добавлении описаний утверждений см. в разделе [Добавление описания утверждения](../operations/add-a-claim-description.md). Дополнительные сведения см. в разделе «Шаг 1 — экспорт параметров службы» в подготовке к переносу AD FS 2.0 Federation Server.  
  
-   В консоли управления AD FS выберите **отношения доверия поставщиков утверждений**. Необходимо воссоздать каждое отношение доверия поставщика утверждений вручную с помощью **мастера установки доверия поставщика утверждений**.  Воспользуйтесь списком отношений доверия с поставщиком утверждений, экспортированным и записанным при подготовке к миграции AD FS. Вы можете игнорировать доверия с поставщиком утверждений с идентификатором «Центр AD» в файле, поскольку это доверия поставщика утверждений «Active Directory», который является частью конфигурации AD FS по умолчанию.  Тем не менее проверьте все правила настраиваемых утверждений, которые, возможно, были добавлены в отношения доверия Active Directory до миграции. Дополнительные сведения о создании отношений доверия поставщика утверждений, см. в разделе [создание утверждений поставщика отношений доверия с помощью метаданных федерации](../operations/create-a-claims-provider-trust.md#to-create-a-claims-provider-trust-using-federation-metadata) или [с поставщиком утверждений доверия вручную создать](../operations/create-a-claims-provider-trust.md#to-create-a-claims-provider-trust-manually).  
  
-   В консоли управления AD FS **выберите доверия с проверяющей стороной**. Необходимо воссоздать каждое отношение доверия с проверяющей стороной вручную с помощью **проверяющей стороной мастер добавления отношений доверия**. Воспользуйтесь списком доверия с проверяющей стороной, экспортированным и записанным при подготовке к миграции AD FS. Дополнительные сведения о создании отношений доверия с проверяющей стороной см. в разделе [создать проверяющей стороной отношений доверия с помощью метаданных федерации](../operations/create-a-relying-party-trust.md#to-create-a-claims-aware-relying-party-trust-using-federation-metadata) или [с проверяющей стороной доверия вручную создать](../operations/create-a-relying-party-trust.md#to-create-a-claims-aware-relying-party-trust-manually). 

## <a name="next-steps"></a>Дальнейшие действия
 [Подготовка к миграции сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-server.md)   
 [Подготовка к миграции прокси-сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-proxy.md)   
 [Перенос сервера AD FS 2.0 Federation](migrate-the-ad-fs-fed-server.md)   
 [Перенос прокси-сервера AD FS 2.0 Federation](migrate-the-ad-fs-2-fed-server-proxy.md)   
 [Перенос 1.1 веб-агенты AD FS](migrate-the-ad-fs-web-agent.md)




-   
-    