---
title: Миграция изолированного сервера федерации AD FS или фермы AD FS с одним узлом
description: Предоставляет сведения о переносе сервера ADFS 2.0 автономные AD отдельно или в одном узле с Windows Server 2012
author: billmath
ms.author: billmath
manager: femila
ms.date: 06/28/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 10371349fe19be92fb997c9c28f19def0ecad7e9
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59851935"
---
# <a name="migrate-a-stand-alone-ad-fs-federation-server-or-a-single-node-ad-fs-farm"></a>Миграция изолированного сервера федерации AD FS или фермы AD FS с одним узлом  
Этот документ содержит подробные сведения о миграции только сервер AD FS 2.0 stand в Windows Server 2012.

## <a name="migrate-a-stand-alone-ad-fs-20-server"></a>Миграция изолированного AD FS 2.0 server

Используйте следующую процедуру для переноса AD FS 2.0 server до Windows Server 2012.
  
1.  Просмотрите и выполните процедуры, описанные в [Подготовка к миграции изолированного сервера федерации AD FS или фермы AD FS с одним узлом](prepare-to-migrate-a-stand-alone-ad-fs-federation-server.md).  
  
2.  Выполните обновление на месте операционной системы на сервере с Windows Server 2008 R2 или Windows Server 2008 до Windows Server 2012. Дополнительные сведения см. в разделе [Установка Windows Server 2012](https://technet.microsoft.com/library/jj134246.aspx).  
  
> [!IMPORTANT]
>  В результате обновления операционной системы конфигурация AD FS на этом сервере была утрачена, а роли AD FS 2.0 сервера удаляется. Вместо этого установить роль сервера Windows Server 2012 AD FS, но она не настроена. Необходимо вручную создать исходную конфигурацию AD FS и восстановить остальные параметры AD FS, чтобы завершить миграцию сервера федерации.  
  
3.  Создайте исходную конфигурацию AD FS. Можно создать исходную конфигурацию AD FS с помощью любого из следующих методов:  
  
-   Используйте **мастер настройки сервера федерации для AD FS** для создания нового сервера федерации. Дополнительные сведения см. в разделе [Создание первого сервера федерации на ферме серверов федерации](Create-the-First-Federation-Server-in-a-Federation-Server-Farm.md).  
  
Выполняя действия в мастере, используйте информацию, полученную в ходе подготовки к миграции сервера федерации AD FS, следующим образом.  
  
 |**Вводный параметр мастера конфигурации сервера федерации**|**Используйте следующее значение**| 
|-----|-----| 
|**SSL-сертификат** на странице **Указание имени службы федерации**|Выберите SSL-сертификат, имя субъекта и отпечаток которого были записаны в ходе подготовки к миграции сервера федерации AD FS.|  
|**Учетная запись службы** и **Пароль** на странице **Указание учетной записи службы**|Введите сведения об учетной записи службы, записанные в ходе подготовки к миграции сервера федерации AD FS. **Примечание.**  Если на второй странице мастера выбран изолированный сервер федерации, СЕТЕВАЯ СЛУЖБА автоматически используется как учетная запись службы.|  
  
> [!IMPORTANT] 
> Этот метод можно использовать только в том случае, если вы используете внутреннюю базу данных Windows (WID) для хранения базы данных конфигурации AD FS для изолированного сервера федерации или фермы AD FS с одним узлом.  
>
>  Если вы используете SQL Server для хранения базы данных конфигурации AD FS для фермы AD FS одним узлом, необходимо использовать Windows PowerShell для создания исходной конфигурации AD FS на сервере федерации.  
  
-   Использование Windows PowerShell  
  
> [!IMPORTANT]
>  Если вы используете SQL Server для хранения базы данных конфигурации AD FS для изолированного сервера федерации или фермы AD FS с одним узлом, необходимо использовать Windows PowerShell.  
  
Ниже приведен пример того, как использовать Windows PowerShell для создания исходной конфигурации AD FS на сервере федерации в ферме SQL Server одним узлом.  Откройте модуль Windows PowerShell и выполните следующую команду: `$fscredential = Get-Credential`. Введите имя и пароль учетной записи службы, записанные в ходе подготовки фермы серверов SQL к миграции. Затем выполните следующую команду: `C:\PS> Add-AdfsFarmNode -ServiceAccountCredential $fscredential -SQLConnectionString "Data Source=<Data Source>;Integrated Security=True"` где `Data Source` — это значение источника данных в значении строки подключения хранилища политики в следующем файле: `%programfiles%\Active Directory Federation Services 2.0\Microsoft.IdentityServer.Servicehost.exe.config`.  
  
4.  Восстановите остальные параметры службы AD FS и отношения доверия. Этот шаг выполняется вручную и позволяет использовать экспортированные файлы и собранные значения при подготовке к миграции AD FS. Подробные инструкции см. в разделе "Восстановление остальной конфигурации фермы AD FS".  
  
> [!NOTE]
>  Этот шаг необходим только при миграции изолированного сервера федерации или фермы внутренней базы данных Windows с одним узлом.  Если сервер федерации использует базу данных SQL Server в качестве хранилища конфигурации, параметры службы и отношения доверия сохраняются в базе данных.  
  
5.  Обновите веб-страниц AD FS. Этот шаг выполняется вручную. Если вы резервное копирование настроенных веб-страниц AD FS при подготовке к миграции, воспользуйтесь резервными данными для перезаписи веб-страниц AD FS, которые были созданы по умолчанию в по умолчанию **%systemdrive%\inetpub\adfs\ls** каталог, в результате использования Конфигурация AD FS в Windows Server 2012.  
  
6.  Восстановите остальные пользовательские настройки AD FS, например хранилища настраиваемых атрибутов.  
  
## <a name="restoring-the-remaining-ad-fs-farm-configuration"></a>Восстановление оставшиеся конфигурации фермы AD FS  
  
-   Восстановите следующие параметры службы AD FS, создав ферму внутренней базы данных Windows с одним узлом или изолированную службу федерации следующим образом:  
  
    -   На консоли управления AD FS выберите **Служба** и щелкните **Изменить службу федерации…** Проверьте параметры службы федерации, сопоставляя каждое значение со значениями, экспортированными в файл properties.txt при подготовке к миграции.  
  
    
|**Имя свойства службы федерации, предоставленное Get-ADFSProperties**|**Имя свойства службы федерации в консоли управления AD FS**|  
|-----|-----|
|DisplayName|Отображаемое имя службы федерации|  
|HostName|Имя службы федерации|  
|Идентификатор|Идентификатор службы федерации|  
  
-   В консоли управления AD FS выберите пункт **Сертификаты**. Проверьте сертификаты взаимодействия служб, расшифровки и подписи токенов, сопоставляя каждое значение со значениями, экспортированными в файл certificates.txt при подготовке к миграции.  
  
Чтобы заменить самозаверяющие сертификаты для шифрования или для подписи маркера по умолчанию на внешние сертификаты, необходимо предварительно отключить функцию автоматического переключения сертификатов, которая по умолчанию включена.  Чтобы сделать это, можно использовать следующую команду Windows PowerShell: `PSH: Set-ADFSProperties –AutoCertificateRollover $false`.  
  
-   В консоли управления AD FS выберите элемент **Конечные точки**. Проверьте задействованные конечные точки AD FS по списку задействованных конечных точек AD FS, который был экспортирован в файл в процессе подготовки к переносу AD FS.  
  
-   В консоли управления AD FS выберите элемент **Описания утверждений**. Сверьте список описаний утверждений AD FS со списком описаний утверждений, который был экспортирован в файл при подготовке к переносу AD FS. Добавьте все пользовательские описания утверждений, содержащиеся в вашем файле, но не включенные в список по умолчанию AD FS.  Обратите внимание, что свойство утверждения Identifier на консоли управления соответствует свойству ClaimType в файле.  Дополнительные сведения о добавлении описаний утверждений см. в разделе [Добавление описания утверждения](../operations/add-a-claim-description.md). Дополнительные сведения см. в разделе "Шаг 1. Экспорт параметров службы" статьи "Подготовка к миграции сервера федерации AD FS 2.0".  
  
-   На консоли управления AD FS выберите **Отношения доверия поставщика утверждений**. Необходимо вручную воссоздать каждое отношение доверия с поставщиком утверждений, используя **мастер добавления отношений доверия с поставщиком утверждений**.  Воспользуйтесь списком отношений доверия с поставщиками утверждений, экспортированным и записанным при подготовке к миграции AD FS. Можно игнорировать отношения доверия с поставщиком утверждений с идентификатором AD AUTHORITY в этом файле, поскольку это отношение доверия с поставщиком утверждений Active Directory, которое является частью конфигурации AD FS по умолчанию.  Тем не менее проверьте все правила настраиваемых утверждений, которые, возможно, были добавлены в отношения доверия Active Directory до миграции. Дополнительные сведения о создании отношений доверия с поставщиком утверждений см. в разделе [Создание отношений доверия с поставщиком утверждений с использованием метаданных федерации](../operations/create-a-claims-provider-trust.md#to-create-a-claims-provider-trust-using-federation-metadata) или [Создание отношений доверия с поставщиком утверждений вручную](../operations/create-a-claims-provider-trust.md#to-create-a-claims-provider-trust-manually).  
  
-   На консоли управления AD FS **выберите отношения доверия с проверяющей стороной**. Необходимо вручную воссоздать каждое отношение доверия с проверяющей стороной, используя **мастер добавления отношений доверия с проверяющей стороной**. Воспользуйтесь списком отношений доверия с проверяющими сторонами, экспортированным и записанным при подготовке к миграции AD FS. Дополнительные сведения о создании отношений доверия с проверяющими сторонами см. в разделе [Создание отношений доверия с проверяющей стороной с использованием метаданных федерации](../operations/create-a-relying-party-trust.md#to-create-a-claims-aware-relying-party-trust-using-federation-metadata) или [Создание отношений доверия с проверяющей стороной вручную](../operations/create-a-relying-party-trust.md#to-create-a-claims-aware-relying-party-trust-manually). 

## <a name="next-steps"></a>Следующие шаги
 [Подготовка к миграции сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-server.md)   
 [Подготовка к миграции прокси-сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-proxy.md)   
 [Перенос сервера AD FS 2.0 Federation](migrate-the-ad-fs-fed-server.md)   
 [Перенос прокси-сервера AD FS 2.0 Federation](migrate-the-ad-fs-2-fed-server-proxy.md)   
 [Миграция 1.1 веб-агентов AD FS](migrate-the-ad-fs-web-agent.md)




-   
-    