---
title: "Обновление до AD FS в Windows Server 2016 с SQL Server"
description: 
author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: 70f279bf-aea1-4f4f-9ab3-e9157233e267
ms.technology: identity-adfs
ms.author: billmath
ms.openlocfilehash: 034d4f1f8d81cf105ba94bff34b180555702acde
ms.sourcegitcommit: 33c1f4965cd2eed7d384a096cfa5c883467b16a4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/02/2017
---
# <a name="upgrading-to-ad-fs-in-windows-server-2016-with-sql-server"></a>Обновление до AD FS в Windows Server 2016 с SQL Server

>Область применения: Windows Server 2016


## <a name="moving-from-a-windows-server-2012-r2-ad-fs-farm-to-a-windows-server-2016-ad-fs-farm"></a>Перемещение из фермы Windows Server 2012 R2 AD FS в ферме Windows Server 2016 AD FS  
Следующий документ будет описано, как обновить ферму AD FS Windows Server 2012 R2 AD FS в Windows Server 2016, при использовании SQL Server для базы данных AD FS.  

### <a name="upgrading-ad-fs-to-windows-server-2016-fbl"></a>Обновление до Windows Server 2016 FBL AD FS  
Новые возможности AD FS в Windows Server 2016 функция уровня поведение фермы (FBL).   Эти функции всю ферму и определяет функции, которые можно использовать в ферме AD FS.   По умолчанию FBL в ферме Windows Server 2012 R2 AD FS является Windows Server 2012 R2 FBL.  

Сервер Windows Server 2016 AD FS можно добавить в ферму Windows Server 2012 R2, и он будет работать на одном FBL как Windows Server 2012 R2.  При наличии Windows Server 2016 AD FS сервер, работающий таким образом, считается, что ферме «смешивать».  Тем не менее вы не сможете воспользоваться преимуществами новых возможностей Windows Server 2016 до возникновения FBL на Windows Server 2016.  С помощью смешанного фермы:  

-   Администраторы могут добавлять новые, Windows Server 2016 серверов федерации в существующей ферме Windows Server 2012 R2.  В результате ферма в «смешанный режим» и работает на уровне поведение Windows Server 2012 R2 фермы.  Чтобы обеспечить согласованное поведение в ферме, новые функции Windows Server 2016 не настроен или используемых в этом режиме.  

-   После того как все серверы федерации Windows Server 2012 R2 были удалены из фермы смешанном режиме и в случае ферме внутренней базы данных Windows, один из новых серверов федерации Windows Server 2016 выдвинут на роль основного узла, администратор может затем изменить FBL с Windows Server 2012 R2 на Windows Server 2016.  В результате все новые возможности AD FS Windows Server 2016 можно затем настроить и использовать.  

-   В результате функцию смешанного фермы AD FS Windows Server 2012 R2, организаций, которым для обновления до Windows Server 2016, не требуется развертывать ферму совершенно новые экспорта и импорта данных конфигурации.  Вместо этого можно добавить узлы Windows Server 2016 в существующую ферму подключенной сети и только взимается относительно небольшой простой, участвующие в повышение FBL.  

Имейте в виду, что в режиме смешанных фермы фермы AD FS не может любой новые компоненты или функциональные возможности, появившиеся в AD FS в Windows Server 2016.  Это означает, что организаций, желающих попробовать новые функции не может это сделать, до возникновения FBL.  Поэтому если организации требуется для тестирования новых компонентов до rasing FBL, будет необходимо развернуть отдельный фермы для этого.  

Оставшаяся часть является документ содержит шаги для добавления сервера федерации Windows Server 2016 в среде Windows Server 2012 R2 и затем вызова FBL на Windows Server 2016.  Эти действия были выполнены в тестовой среде, изложенным в Архитектурная схема ниже.  

> [!NOTE]  
> Перед перемещением на AD FS в Windows Server 2016 FBL, необходимо удалить все узлы Windows 2012 R2.  Нельзя просто обновление ОС Windows Server 2012 R2 до Windows Server 2016 и его становятся узел 2016.  Необходимо удалить его и замените его на новый узел 2016.  

В следующем Архитектурная схема показывает установки, который использовался для проверки и запишите указанные ниже действия.

![Архитектура](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/arch.png) 


#### <a name="join-the-windows-2016-ad-fs-server-to-the-ad-fs-farm"></a>Присоединение сервера AD FS 2016 Windows к ферме AD FS

1.  С помощью диспетчера сервера установить роль служб федерации Active Directory в Windows Server 2016  

2.  С помощью мастера конфигурации AD FS, присоединение нового сервера Windows Server 2016 к существующей ферме AD FS.  На **приветствия** откройте **Далее**.
 ![Присоединение фермы](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/configure1.png)  
3.  На **подключение к доменных служб Active Directory** экрана, s**Задание учетной записи администратора** с разрешениями для выполнения настройки служб федерации и нажмите кнопку **Далее**.
4.  На **указать фермы** экрана, введите имя и экземпляр сервера SQL и нажмите кнопку **Далее**.
![Присоединение фермы](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/configure3.png)
5.  На **SSL-сертификат, укажите** экрана, укажите сертификат и нажмите кнопку **Далее**.
![Присоединение фермы](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/configure4.png)
6.  На **укажите учетную запись службы** экрана, укажите учетную запись службы и нажмите кнопку **Далее**. 
7.  На **просмотреть параметры** экрана, проверьте параметры и нажмите кнопку **Далее**. 
8.  На **проверяет необходимые компоненты** убедитесь, что все необходимые проверки пройдены и нажмите кнопку **Настройка**.
9.  На **результатов** экрана и убедитесь, что сервер успешно настроен в **закрыть**.
 
   
#### <a name="remove-the-windows-server-2012-r2-ad-fs-server"></a>Удаление сервера Windows Server 2012 R2 AD FS

>[!NOTE]
>Необходимо задать основного сервера AD FS с помощью набора AdfsSyncProperties-роли, при использовании в качестве базы данных SQL.  Это так, как все узлы, считаются основной в этой конфигурации.

1.  На сервере Windows Server 2012 R2 AD FS используется диспетчер серверов **удалить роли и компоненты** под **управление**. 
![Удаление сервера](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/remove1.png)
2.  На **прежде чем начать** нажмите кнопку **Далее**.
3.  На **Выбор сервера** экрана, нажмите кнопку **Далее**.
4.  На **ролей сервера** экрана, снимите флажок рядом с пунктом **служб федерации Active Directory** и нажмите кнопку **Далее**.
![Удаление сервера](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/remove2.png)
5.  На **функции** экрана, нажмите кнопку **Далее**.
6.  На **подтверждения** экрана, нажмите кнопку **удалить**.
7.  После завершения проверки, перезапустите сервер.
     
#### <a name="raise-the-farm-behavior-level-fbl"></a>Повышение уровня поведение фермы (FBL)
До этого этапа необходимо убедиться, что команды forestprep и domainprep запускался в среде Active Directory и в наличии схемы Windows Server 2016 Active Directory.  В этом документе работы с контроллером домена Windows 2016 и не требуют выполнения этих, так как они были запущены во время установки AD.

1. Теперь на сервере Windows Server 2016 откройте PowerShell и выполните следующую команду: **$cred = Get-Credential** и нажмите клавишу ВВОД.
2. Введите учетные данные, которые имеют права администратора на сервере SQL Server.
3. Теперь в PowerShell, введите следующее: **Invoke AdfsFarmBehaviorLevelRaise-Credential $cred**
2. При появлении запроса введите **Y**. Повышение уровня начнется.  После выполнения этой процедуры были успешно поднять FBL.  
![Обновление готово](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/finish1.png)
3. Теперь Если вы откроете управления AD FS, вы увидите новых узлов, которые были добавлены для AD FS в Windows Server 2016  
4. Аналогичным образом, можно использовать командлет PowerShell: Get-AdfsFarmInformation, показывающего текущее FBL.  
![Обновление готово](media/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL/finish2.png)
