---
description: 'Дополнительные сведения: Настройка учетной записи службы для фермы серверов федерации вручную'
ms.assetid: 5a1ae56b-adcb-447e-9e34-c0629d7cb241
title: Настройка учетной записи службы для фермы серверов федерации вручную
author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.author: billmath
ms.openlocfilehash: afedde422f0a46975fcbb61912773a992c688309
ms.sourcegitcommit: 65b6de6b44d41f1180c45db11cdd60cb2a093b46
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/10/2020
ms.locfileid: "97043332"
---
# <a name="manually-configure-a-service-account-for-a-federation-server-farm"></a>Настройка учетной записи службы для фермы серверов федерации вручную

Если вы планируете настроить среду фермы серверов федерации в службы федерации Active Directory (AD FS) \( AD FS \) , необходимо создать и настроить выделенную учетную запись службы в домен Active Directory Services \( AD DS, \) где будет размещаться ферма. Затем каждый сервер федерации в ферме настраивается для использования этой учетной записи. Если нужно разрешить клиентским компьютерам в корпоративной сети проходить проверку подлинности на любом из серверов федерации в AD FS ферме с использованием встроенной проверки подлинности Windows, необходимо выполнить следующие задачи в Организации.

> [!IMPORTANT]
> Начиная с AD FS 3,0 (Windows Server 2012 R2) AD FS поддерживает использование [групповой управляемой учетной записи службы](../../../security/group-managed-service-accounts/group-managed-service-accounts-overview.md) \( gMSA в \) качестве учетной записи службы.  Это рекомендуемый вариант, поскольку он устраняет необходимость в управлении паролем учетной записи службы с течением времени.  В этом документе рассматривается альтернативный вариант использования традиционной учетной записи службы, например, в доменах, где все еще выполняется режим работы домена Windows Server 2008 R2 или более ранней версии \( ДФЛ \) .

> [!NOTE]
> Задачи в рамках этой процедуры выполняются только один раз для всей фермы. Далее при создании сервера федерации с использованием мастера конфигурации сервера федерации AD FS необходимо указать ту же самую учетную запись на странице мастера **учетной записи службы** каждого сервера федерации фермы.

#### <a name="create-a-dedicated-service-account"></a>Создание специальной учетной записи службы

1.  Создайте выделенную \/ учетную запись службы пользователя в Active Directory лесу, расположенном в организации поставщика удостоверений. Эта учетная запись необходима для того, чтобы протокол проверки подлинности Kerberos работал в ферме и позволял проходить \- проверку подлинности на каждом из серверов федерации. Используйте эту учетную запись только в целях фермы серверов федерации.

2.  Отредактируйте свойства учетной записи пользователя и установите флажок **Срок действия пароля не ограничен**. Это действие гарантирует, что функционирование учетной записи службы не будет прервано вследствие требований о смене доменного пароля.

    > [!NOTE]
    > Использование учетной записи сетевых служб для данной специальной учетной записи может стать причиной случайных сбоев при попытке доступа через интегрированную аутентификацию Windows из-за невозможности проверить билеты Kerberos на серверах.

#### <a name="to-set-the-spn-of-the-service-account"></a>Настройка SPN учетной записи службы

1.  Так как удостоверение пула приложений для AD FS AppPool выполняется как \/ учетная запись службы пользователя домена, необходимо настроить имя субъекта-службы \( \) для этой учетной записи в домене с помощью средства командной \- строки Setspn.exe. Setspn.exe устанавливается по умолчанию на компьютерах под управлением Windows Server 2008. Выполните следующую команду на компьютере, присоединенном к тому же домену, где \/ находится учетная запись службы пользователя:

    ```
    setspn -a host/<server name> <service account>
    ```

    Например, в сценарии, в котором все серверы федерации находятся в кластере с именем DNS-узла системы доменных имен \( \) FS.fabrikam.com, а имя учетной записи службы, назначенной AD FS AppPool, называется adfs2farm, введите команду следующим образом и нажмите клавишу ВВОД:

    ```
    setspn -a host/fs.fabrikam.com adfs2farm
    ```

    Для этой учетной записи необходимо выполнить эту задачу только один раз.

2.  После изменения удостоверения AD FS AppPool на учетную запись службы установите списки управления доступом для списков \( ACL в \) базе данных SQL Server, чтобы разрешить доступ на чтение к этой новой учетной записи, чтобы AD FS AppPool могла считывать данные политики.

