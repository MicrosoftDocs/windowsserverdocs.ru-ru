---
ms.assetid: 5a1ae56b-adcb-447e-9e34-c0629d7cb241
title: Настройка учетной записи службы для фермы серверов федерации вручную
description: ''
author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.author: billmath
ms.openlocfilehash: 8240903b3c446d4f02ca93dc053e520480f5e8ca
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71359488"
---
# <a name="manually-configure-a-service-account-for-a-federation-server-farm"></a>Настройка учетной записи службы для фермы серверов федерации вручную

Если вы планируете настроить среду фермы серверов федерации в службы федерации Active Directory (AD FS) \(AD FS @ no__t-1, необходимо создать и настроить выделенную учетную запись службы в домен Active Directory Services \(AD DS @ no__t-3, где ферма будет размещен. Затем каждый сервер федерации в ферме настраивается для использования этой учетной записи. Если нужно разрешить клиентским компьютерам в корпоративной сети проходить проверку подлинности на любом из серверов федерации в AD FS ферме с использованием встроенной проверки подлинности Windows, необходимо выполнить следующие задачи в Организации.  

> [!IMPORTANT]
> Начиная с AD FS 3,0 (Windows Server 2012 R2) AD FS поддерживает использование [групповой управляемой учетной записи службы](https://docs.microsoft.com/windows-server/security/group-managed-service-accounts/group-managed-service-accounts-overview) \(gMSA @ no__t-2 в качестве учетной записи службы.  Это рекомендуемый вариант, поскольку он устраняет необходимость в управлении паролем учетной записи службы с течением времени.  В этом документе рассматривается альтернативный вариант использования традиционной учетной записи службы, например, в доменах, где все еще выполняется режим работы домена Windows Server 2008 R2 или более ранней версии \(DFL @ no__t-1.

> [!NOTE]  
> Задачи в рамках этой процедуры выполняются только один раз для всей фермы. Позже при создании сервера федерации с помощью мастера настройки сервера AD FS Федерации необходимо указать эту же учетную запись на странице мастера **учетной записи службы** на каждом сервере федерации в ферме.  
  
#### <a name="create-a-dedicated-service-account"></a>Создание специальной учетной записи службы  
  
1.  Создайте выделенную учетную запись пользователя @ no__t-0service в лесу Active Directory, который находится в организации поставщика удостоверений. Эта учетная запись необходима для того, чтобы протокол проверки подлинности Kerberos работал в ферме и позволял передавать @ no__t-0through проверку подлинности на каждом из серверов федерации. Используйте эту учетную запись только в целях фермы серверов федерации.  
  
2.  Отредактируйте свойства учетной записи пользователя и установите флажок **Срок действия пароля не ограничен** . Это действие гарантирует, что функционирование учетной записи службы не будет прервано вследствие требований о смене доменного пароля.  
  
    > [!NOTE]  
    > Использование учетной записи сетевых служб для данной специальной учетной записи может стать причиной случайных сбоев при попытке доступа через интегрированную аутентификацию Windows из-за невозможности проверить билеты Kerberos на серверах.  
  
#### <a name="to-set-the-spn-of-the-service-account"></a>Настройка SPN учетной записи службы  
  
1.  Так как удостоверение пула приложений для AD FS AppPool выполняется как учетная запись пользователя домена @ no__t-0service, необходимо настроить имя субъекта-службы @no__t — 1SPN @ no__t-2 для этой учетной записи в домене с помощью команды SetSPN. exe @ no__t-3line. Программа Setspn. exe устанавливается по умолчанию на компьютерах под управлением Windows Server 2008. Выполните следующую команду на компьютере, присоединенном к тому же домену, где находится учетная запись пользователя @ no__t-0service:  
  
    ```  
    setspn -a host/<server name> <service account>  
    ```  
  
    Например, в сценарии, в котором все серверы федерации кластеризованы в системе доменных имен \(DNS @ no__t-1 имя узла fs.fabrikam.com, а имя учетной записи службы, назначенной AD FS AppPool, называется adfs2farm, введите команду следующим образом. нажмите клавишу ВВОД:  
  
    ```  
    setspn -a host/fs.fabrikam.com adfs2farm  
    ```  
  
    Для этой учетной записи необходимо выполнить эту задачу только один раз.  
  
2.  После изменения удостоверения AD FS AppPool на учетную запись службы установите списки управления доступом \(ACLs @ no__t-1 в базе данных SQL Server, чтобы разрешить доступ на чтение к этой новой учетной записи, чтобы AD FS AppPool могла считывать данные политики.  
  

