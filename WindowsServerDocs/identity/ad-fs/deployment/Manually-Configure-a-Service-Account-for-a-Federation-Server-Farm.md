---
ms.assetid: 5a1ae56b-adcb-447e-9e34-c0629d7cb241
title: Настройка учетной записи службы для фермы серверов федерации вручную
description: ''
author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.author: billmath
ms.openlocfilehash: 7d215c80c03236df9479aff8046981741dfc83e2
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59838155"
---
# <a name="manually-configure-a-service-account-for-a-federation-server-farm"></a>Настройка учетной записи службы для фермы серверов федерации вручную

>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

Если вы собираетесь настроить среду фермы серверов федерации в службах федерации Active Directory \(AD FS\), необходимо создать и настроить специальную учетную запись службы в доменных службах Active Directory \(AD DS\) где будет располагаться ферма. Затем каждый сервер федерации в ферме настраивается для использования этой учетной записи. Если вы хотите разрешить клиентским компьютерам в корпоративной сети осуществлять проверку подлинности в любой из серверов федерации в ферме AD FS, используя встроенную проверку подлинности Windows, необходимо выполнить следующие задачи в вашей организации.  

> [!IMPORTANT]
> Начиная с AD FS 3.0 (Windows Server 2012 R2), AD FS поддерживает использование [групповой управляемой учетной записи службы](https://docs.microsoft.com/windows-server/security/group-managed-service-accounts/group-managed-service-accounts-overview) \(gMSA\) как учетная запись службы.  Это рекомендуемый параметр, поскольку она удаляет потребность в управлении пароль учетной записи службы со временем.  В этом документе рассматриваются альтернативные случай использования записью традиционные службы, такие как в доменах, по-прежнему под управлением Windows Server 2008 R2 или более ранних функциональный уровень домена \(DFL\).

> [!NOTE]  
> Задачи в рамках этой процедуры выполняются только один раз для всей фермы. Позже, при создании сервера федерации с помощью мастера конфигурации сервера AD FS федерации, необходимо указать эту учетную запись на **учетной записи службы** страница мастера на каждом сервере федерации в ферме.  
  
#### <a name="create-a-dedicated-service-account"></a>Создание специальной учетной записи службы  
  
1.  Создание выделенного пользователя\/учетной записи в лесу Active Directory, расположенном в организации поставщика удостоверений службы. Эта учетная запись необходима для проверки подлинности Kerberos для работы в сценарии с фермой и чтобы разрешить проход\-через проверку подлинности на всех серверах федерации. Используйте эту учетную запись только в рамках фермы серверов федерации.  
  
2.  Отредактируйте свойства учетной записи пользователя и установите флажок **Срок действия пароля не ограничен** . Это действие гарантирует, что функционирование учетной записи службы не будет прервано вследствие требований о смене доменного пароля.  
  
    > [!NOTE]  
    > Использование учетной записи сетевых служб для данной специальной учетной записи может стать причиной случайных сбоев при попытке доступа через интегрированную аутентификацию Windows из-за невозможности проверить билеты Kerberos на серверах.  
  
#### <a name="to-set-the-spn-of-the-service-account"></a>Настройка SPN учетной записи службы  
  
1.  Так как удостоверение пула приложений для AD FS AppPool работает как пользователь домена\/учетной записи службы, необходимо настроить имя участника-службы \(SPN\) для этой учетной записи в домене с помощью команды Setspn.exe\-линия. Setspn.exe устанавливается по умолчанию на компьютерах под управлением Windows Server 2008. Выполните следующую команду на компьютере, который присоединен к тому же домену где пользователь\/находится учетная запись службы:  
  
    ```  
    setspn -a host/<server name> <service account>  
    ```  
  
    Например, в сценарии, в которых все федерации серверов сгруппированы под доменных имен \(DNS\) имен fs.fabrikam.com, а также имя учетной записи службы, присвоенный AD FS AppPool имеет вид adfs2farm, введите команду как и в случае ниже и нажмите клавишу ВВОД:  
  
    ```  
    setspn -a host/fs.fabrikam.com adfs2farm  
    ```  
  
    Для этой учетной записи необходимо выполнить эту задачу только один раз.  
  
2.  После изменения учетной записи службы AD FS AppPool удостоверение задать списки управления доступом \(ACL\) в базе данных SQL Server, чтобы разрешить доступ на чтение для этой новой учетной записи, таким образом, чтобы AD FS AppPool можно считывать данные о политике.  
  

