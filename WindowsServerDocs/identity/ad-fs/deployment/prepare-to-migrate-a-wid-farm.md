---
title: "Подготовка к миграции фермы внутренней базы данных Windows AD FS 2.0"
description: "Содержит сведения о подготовке к миграции фермы внутренней базы данных Windows 2.0 сервера AD FS в Windows Server 2012."
author: billmath
ms.author: billmath
manager: femila
ms.date: 06/28/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 4985a8d16614bd12bce991e196d105464d37634d
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2017
---
# <a name="prepare-to-migrate-an-ad-fs-20-wid-farm"></a>Подготовка к миграции фермы внутренней базы данных Windows AD FS 2.0  
 Чтобы подготовиться к миграции AD FS серверов федерации 2.0, относящихся к ферме внутренней базы данных Windows (WID) в Windows Server 2012, необходимо экспортировать и выполнить резервное копирование данных конфигурации AD FS с этих серверов.  
  
 Чтобы экспортировать данные конфигурации AD FS, выполните следующие задачи:  
  
-   [Шаг 1. — Экспорт параметров службы](#step-1-export-service-settings)  
  
-   [Шаг 2: Резервное копирование хранилищ настраиваемых атрибутов](#step-2-back-up-custom-attribute-stores)  
  
-   [Шаг 3: Резервное копирование пользовательских настроек веб-страницы](#step-3-back-up-webpage-customizations)  
  
## <a name="step-1-export-service-settings"></a>Шаг 1: Экспорт параметров службы  
 Чтобы экспортировать параметры службы, выполните следующую процедуру.  
  
### <a name="to-export-service-settings"></a>Экспорт параметров службы  
  
1.  Запишите значение субъекта сертификата имя и отпечаток сертификата SSL, используемого службой федерации. Чтобы найти SSL-сертификат, откройте консоль управления Internet Information Services (IIS), выберите **веб-сайт по умолчанию** в левой области щелкните **привязки...** в **действие**, найдите и выберите https-привязки, нажмите кнопку **изменить**, нажмите кнопку **представление **.  
  
> [!NOTE]
>  Кроме того можно также экспортировать SSL-сертификат и его закрытый ключ в PFX-файл. Дополнительные сведения см. в разделе [Экспорт части сертификата аутентификации сервера с закрытым ключом ](Export-the-Private-Key-Portion-of-a-Server-Authentication-Certificate.md).  
>   
>  Этот шаг является необязательным, так как этот сертификат хранится в хранилище личных сертификатов на локальном компьютере и сохраняется при обновлении операционной системы.  
  
2.  Экспортируйте любые сертификаты подписи токена, шифрования токена или взаимодействия служб и ключи, которые не создаются внутри организации, помимо самозаверяющих сертификатов.  
  
Можно просмотреть все сертификаты, используемые на сервере с помощью Windows PowerShell. Откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell: `PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду для просмотра всех сертификатов, используемых на сервере `PSH:>Get-ADFSCertificate`. Выходные данные этой команды содержит значения StoreLocation и StoreName, указывающие на расположение хранилища каждого сертификата.  Затем можно воспользоваться инструкциями в [Экспорт части сертификата аутентификации сервера с закрытым ключом](Export-the-Private-Key-Portion-of-a-Server-Authentication-Certificate.md) Чтобы экспортировать каждый сертификат и его закрытый ключ в PFX-файл.  
  
> [!NOTE]
>  Этот шаг необязателен, потому что все внешние сертификаты сохраняются во время обновления операционной системы.  
  
3.  Запишите удостоверение учетной записи службы AD FS 2.0 federation и пароль этой учетной записи.  
  
Чтобы найти значение удостоверения, просмотрите **вход в систему** столбец **AD Windows служб федерации Active Directory 2.0** в **службы** консоли и запишите это значение вручную.  
  
## <a name="step-2-back-up-custom-attribute-stores"></a>Шаг 2: Резервное копирование хранилищ настраиваемых атрибутов  
 Сведения о хранилищах настраиваемых атрибутов можно найти в используемых ролью AD FS с помощью Windows PowerShell. Откройте Windows PowerShell и выполните следующую команду, чтобы добавить командлеты AD FS в сеанс Windows PowerShell: `PSH:>add-pssnapin “Microsoft.adfs.powershell”`. Затем выполните следующую команду, чтобы найти сведения о хранилищах настраиваемых атрибутов:`PSH:>Get-ADFSAttributeStore`. Действия по обновлению или переносу пользовательских хранилищ атрибутов могут быть разными.  
  
## <a name="step-3-back-up-webpage-customizations"></a>Шаг 3: Резервное копирование пользовательских настроек веб-страницы  
 Чтобы выполнить резервное копирование пользовательских настроек веб-страницы, копируйте веб-страницы AD FS и **web.config** из каталога, сопоставленного виртуальному пути **«/ adfs/ls»** в службах IIS. По умолчанию он находится в **%systemdrive%\inetpub\adfs\ls** каталога.  

## <a name="next-steps"></a>Дальнейшие действия
 [Подготовка к миграции сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-server.md)   
 [Подготовка к миграции прокси-сервера AD FS 2.0 Federation](prepare-to-migrate-ad-fs-fed-proxy.md)   
 [Перенос сервера AD FS 2.0 Federation](migrate-the-ad-fs-fed-server.md)   
 [Перенос прокси-сервера AD FS 2.0 Federation](migrate-the-ad-fs-2-fed-server-proxy.md)   
 [Перенос 1.1 веб-агенты AD FS](migrate-the-ad-fs-web-agent.md)