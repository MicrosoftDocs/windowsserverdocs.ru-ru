---
ms.assetid: f0cbdd78-f5ae-47ff-b5d3-96faf4940f4a
title: "Настройка альтернативного идентификатора входа"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 12/04/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: fb4c98ff1090a9d3c35654614a43e12db99d691d
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="configuring-alternate-login-id"></a>Настройка альтернативного идентификатора входа

>Область применения: Windows Server 2016, Windows Server 2012 R2

Пользователи могут войти в приложений включены службы Active Directory федерации (AD FS), с помощью идентификатора пользователя, которая принимается доменными службами Active Directory (AD DS) в любой форме. К ним относятся имена участника-пользователя (UPN) (johndoe@contoso.com) или домена полные имена учетной записи sam (contoso\johndoe или contoso.com\johndoe).

В некоторых средах, из-за корпоративной политики или локальной зависимости бизнес-приложения конечные пользователи могут только учитывайте их по электронной почте, адрес не их имени участника-пользователя или учетной записи sam имя. В некоторых случаях имя участника-пользователя также Немаршрутизируемых (jdoe@contoso.local) и используется только для проверки подлинности в приложениях в корпоративной сети.

С момента Немаршрутизируемых доменов (например) Не удается проверить владение Contoso.local), Office 365 требует, чтобы все идентификаторы для полного internet маршрутизируемый входа пользователя. Если имя участника-пользователя локальной использует Немаршрутизируемых домена (например) Contoso.local), или существующего имени участника-пользователя нельзя изменить из-за зависимости локального приложения, рекомендуется настроить идентификатора альтернативного входа. Альтернативного идентификатора входа позволяет настроить знак взаимодействие с приложением, где пользователи выполнить вход с атрибут, отличных от их имени участника-пользователя, например почта.

Одним из преимуществ этой функции является позволяет внедрить поставщики SaaS, такие как Office 365, не изменяя имен участников-пользователей вашей локальной. Он также обеспечивает поддержку службы бизнес-приложений с подготовкой потребителя удостоверениями.

> [!IMPORTANT]
> С помощью альтернативного идентификатора в гибридных средах с Exchange и/или Скайп для бизнеса поддерживается, но не рекомендуется. С помощью тот же набор учетных данных (например имя участника-пользователя) для локальных и online предоставляет наилучшее взаимодействие с пользователем в гибридной среде.  Корпорация Майкрософт рекомендует клиентам изменения их имен участников-пользователей, если это возможно Чтобы избежать необходимости другой идентификатор. С помощью альтернативного идентификатора с помощью Lync или Скайп для бизнеса требуется Lync Server 2013 или более поздней версии. Пользователи, использующие альтернативного идентификатора, рекомендуется включить [современных проверки подлинности](https://support.office.com/article/using-office-365-modern-authentication-with-office-clients-776c0036-66fd-41cb-8928-5495c0f9168a) для Exchange в Office 365 для улучшенное взаимодействие с пользователем. Кроме того клиентов, использующих Скайп для бизнеса с мобильных клиентов необходимо убедиться, что SIP-адрес идентична и пользователя почтовый адрес (альтернативного идентификатора). 

Обратитесь к таблице ниже для взаимодействия с пользователем с помощью альтернативного идентификатора, с помощью различных клиентов Office 365 с обычной проверки подлинности, современные проверки подлинности и сертификат проверки подлинности с помощью (требует включения современных проверки подлинности).

|**Типы клиентов**|**Дополнительные сведения**|**Поддерживает оператор - регулярных и современные проверки подлинности**|**Описание**|
|--------------------|------------------------------|------------------------------|------------------------------|
|Outlook|Регулярные проверки подлинности:, Должен быть присоединен к домену и подключенных к корпоративной сети<br /><br />Современные проверки подлинности: поддерживается|Альтернативного идентификатора можно использовать только в средах, которые не позволяют внешний доступ для почтовых ящиков пользователей. Это означает, что пользователи могут только пройти проверку подлинности есть почтовый ящик таким образом, поддерживаемые при их подключены и присоединен к корпоративной сети, для VPN или подключены через прямой доступ. Если вы решили настроить современных проверку подлинности (известных как ADAL) вы используете Outlook с присоединен подключенных компьютеров вне домена, но вы получите несколько дополнительных запросов и сообщений, при настройке профиля Outlook.<br /><br />См. первый образ следующей таблице для демонстрации взаимодействие с пользователем.|[Современные проверки подлинности в Office 2013](https://blogs.office.com/2015/03/23/office-2013-modern-authentication-public-preview-announced/)|
|Гибридные общих папок|Обычной проверки подлинности: Не поддерживается<br /><br />Современные проверки подлинности: поддерживается|Гибридные общие папки не должна иметь возможность разверните, если используются альтернативные идентификаторов и поэтому не следует использовать сегодня с помощью методов обычной проверки подлинности. Если вы хотите иметь возможность использовать общую папку в гибридной необходимо настроить проверку подлинности на современных (известных как ADAL).<br /><br />См. первый образ следующей таблице для демонстрации взаимодействие с пользователем.|[Современные проверки подлинности в Office 2013](https://blogs.office.com/2015/03/23/office-2013-modern-authentication-public-preview-announced/)|
|Межплатформенные локального делегирования|Не поддерживается|В настоящее время межплатформенных локального разрешения не поддерживаются в гибридной конфигурации, но они также не будут работать при использовании AltID.||
|Доступ к почтовому ящику архив (почтового ящика локальной - архив в облаке)|Поддерживается|Пользователи получат дополнительный запрос учетных данных при доступе к архив, им необходимо будет предоставить существует дополнительный код, при появлении соответствующего запроса.<br /><br />См. первый образ следующей таблице для демонстрации взаимодействие с пользователем.||
|Страница Активация Office 365 Pro Plus|Поддерживаемые - рекомендуется реестра клиентской|С альтернативного идентификатора настроена, вы увидите, что имя участника-пользователя локальной заполняется в поле проверки. Это должно быть изменено на альтернативный удостоверение, которое используется. Рекомендуется использовать раздел реестра стороне клиента, указанных в столбце ссылку.<br /><br />См. во второй образ в следующей таблице для демонстрации взаимодействие с пользователем.|[Office 2013 и Lync 2013 периодически запрос учетных данных для SharePoint Online, OneDrive и Lync Online](https://support.microsoft.com/en-us/kb/2913639)|
|Рабочие группы Майкрософт|Поддерживается|Рабочие группы Майкрософт поддерживает AD FS (SAML-P, WS-Fed WS-Trust и OAuth) и современных проверки подлинности.<br/><br/> Основной специалистами Майкрософт, такие как каналы, чатах и файлы функции будут работать с идентификатором Altnernate входа. </br></br>1-й и сторонних приложений требуют отдельно проверки клиента. Это, поскольку каждое приложение имеет свои собственные возможности поддержки протоколов проверки подлинности.| 
|Скайп для бизнеса или Lync|Поддерживается (за исключением описанных), но существует вероятность путаницы пользователя.  На мобильных клиентов альтернативного идентификатора поддерживается только в том случае, если SIP-адрес = адрес электронной почты = другой идентификатор.|Пользователям может потребоваться выполнять вход в два раза, чтобы Скайп бизнеса клиента рабочего стола, сначала с помощью имя участника-пользователя локально, а затем с помощью другой идентификатор. (Обратите внимание, что «вход адрес» фактически SIP-адрес которого может не совпадать с именем «имя пользователя», если часто существует).  Когда сначала потребуется ввести имя пользователя, пользователь должен ввести имя участника-пользователя, даже если он неправильно предварительно заполняется альтернативного идентификатора или SIP-адрес. После того как пользователь щелкнет войти, используя имя участника-пользователя, появится запрос имени пользователя, на этот раз заполнены данными имя участника-пользователя. Для выполнения входа в процессе этого времени пользователь должен замените альтернативного идентификатора и нажмите кнопку вход. Мобильные клиенты пользователей следует введите идентификатор пользователя локальной в страницу с дополнительными параметрами, с использованием стиля SAM формата (домен\имя пользователя), не формат имени участника-пользователя.<br /><br />После успешного входа в систему Если Скайп для бизнеса или Lync сообщение «Exchange необходимы учетные данные», вы должны предоставить учетные данные, которые допустимы для где находится почтовый ящик. Если почтовый ящик находится в облаке, вы должны предоставить другой идентификатор. Если почтовый ящик находится локальными необходимо указать имя участника-пользователя локальной.|[Современные проверки подлинности в Office 2013](https://blogs.office.com/2015/03/23/office-2013-modern-authentication-public-preview-announced/)|
|Outlook Web Access|Поддерживается|||
|Мобильные приложения Outlook для Android, IOS и Windows Phone|Поддерживается|||
|OneDrive для бизнеса|Поддерживаемые - рекомендуется реестра клиентской|С альтернативного идентификатора настроена, вы увидите, что имя участника-пользователя локальной заполняется в поле проверки. Это должно быть изменено на альтернативный удостоверение, которое используется. Рекомендуется использовать раздел реестра стороне клиента, указанных в столбце ссылку.<br /><br />См. во второй образ в следующей таблице для демонстрации взаимодействие с пользователем.|[Office 2013 и Lync 2013 периодически запрос учетных данных для SharePoint Online, OneDrive и Lync Online](https://support.microsoft.com/en-us/kb/2913639)|
|OneDrive для бизнеса мобильных клиентов|Поддерживается|||

![Альтернативное имя входа](media/Configure-Alternate-Login-ID/ADFS_Alt_ID1.png)

![Альтернативное имя входа](media/Configure-Alternate-Login-ID/ADFS_Alt_ID2.png)

![Альтернативное имя входа](media/Configure-Alternate-Login-ID/ADFS_Alt_ID3.png)

Ниже следующие снимки экрана — это дополнительный пример с помощью Скайп для бизнеса.  В примере используются следующие сведения


- SIP:userA@contoso.com 
- ИМЯ УЧАСТНИКА-ПОЛЬЗОВАТЕЛЯ:userA@contoso.local
- Отправить по электронной почте:userA@contoso.com
- AltId:userA@contoso.com 

Введите SIP-адрес в поле вход.

![Skype](media/Configure-Alternate-Login-ID/SkypeA.png)

![Skype](media/Configure-Alternate-Login-ID/SkypeB.png)

![Skype](media/Configure-Alternate-Login-ID/SkypeC.png)

## <a name="to-configure-alternate-login-id"></a>Настройка альтернативного идентификатора входа
Для настройки альтернативного идентификатора входа, необходимо выполнить следующие задачи:

Настройка отношений доверия поставщика утверждений AD FS для включения альтернативного идентификатора входа

1.  Установка [KB2919355](https://go.microsoft.com/fwlink/?LinkID=396590).  Можно получить посредством службы обновления Windows или загрузить его напрямую.

2.  Обновление конфигурации Служб федерации Active Directory, выполнив следующий командлет PowerShell на любом из серверов федерации в ферме (при наличии фермы внутренней базы данных Windows, необходимо запустить эту команду на основном сервере AD FS в ферме):

    ```
    Set-AdfsClaimsProviderTrust -TargetIdentifier "AD AUTHORITY" -AlternateLoginID <attribute> -LookupForests <forest domain>

    ```

    **AlternateLoginID** LDAP имя атрибута, который вы хотите использовать для входа в систему.

    **LookupForests** перечень леса DNS, которому принадлежат пользователи.

    Для включения компонента идентификатор альтернативного входа, необходимо настроить параметры - AlternateLoginID и - LookupForests отличное от null, допустимое значение.

    В следующем примере включается функциональность идентификатор альтернативное имя входа таким образом, что ваши пользователи с учетными записями в contoso.com и fabrikam.com леса могут входить в для AD FS приложений с поддержкой их атрибут «почта».

    ```
    Set-AdfsClaimsProviderTrust -TargetIdentifier "AD AUTHORITY" -AlternateLoginID mail -LookupForests contoso.com,fabrikam.com
    ```

3.  Чтобы отключить эту функцию, установите значение для обоих параметров должен иметь значение null.

    ```
    Set-AdfsClaimsProviderTrust -TargetIdentifier "AD AUTHORITY" -AlternateLoginID $NULL -LookupForests $NULL
    ```

4.  Чтобы включить альтернативного идентификатора входа с Azure AD, нет дополнительных конфигураций действия необходимы, при использовании Azure AD Connect.   Альтернативные Идентификаторы можно настроить непосредственно из мастера.  В разделе уникальной идентификации пользователей в разделе [подключение к Azure AD](https://azure.microsoft.com/en-us/documentation/articles/active-directory-aadconnect-get-started-custom/#connect-to-azure-ad).

## <a name="additional-details--considerations"></a>Дополнительные сведения и рекомендации

-   Функция идентификатор альтернативного входа доступна только для федеративных сред с AD FS развертывается.  Не поддерживается в следующих случаях:
    -   Маршрутизируемый не доменов (например, Contoso.local), не удается проверить с Azure AD.
    -   Управляемые среды, у которых нет AD FS развертывается.


-   При включении альтернативного входа идентификатор функция доступна только для проверки подлинности имя пользователя и пароль для всех пользователей имя и пароль проверки подлинности протоколов, поддерживаемых AD FS (SAML P, WS-Fed WS-Trust и OAuth).


-   При выполнении встроенной проверки подлинности Windows (WIA) (например, когда пользователи пытаются получить доступ к корпоративным приложения на компьютере, присоединенном к домену из интрасети и AD FS администратор настроил политики проверки подлинности для использования WIA для интрасети) для проверки подлинности будет использоваться имя участника-пользователя. Если вы настроили правил для утверждений для проверяющих сторон для альтернативного имени входа идентификатор компонента, вы убедитесь, что эти правила по-прежнему действует в случае WIA.

-   При включении функции Идентификаторов альтернативное имя входа требуется по крайней мере один сервер глобального каталога в доступен с сервера Служб федерации Active Directory для каждого леса учетной записи пользователя, поддерживающий AD FS. Доступ к серверу глобального каталога в лесу учетных записей пользователей будет передана в AD FS возвратом к использовать имя участника-пользователя. По умолчанию все контроллеры домена, серверы глобального каталога.

-   Когда включена, если сервер Служб федерации Active Directory находит более одного объекта-пользователя с одинаковым значением идентификатора альтернативное имя входа для всех лесов учетных записей пользователя, оно завершится ошибкой входа.

-   При включении функции Идентификаторов альтернативного входа Служб федерации Active Directory попытается сначала пройти проверку подлинности пользователя с помощью альтернативного идентификатора входа и затем переключиться на использование имя участника-пользователя, если не удается найти учетную запись, которая может быть идентифицирован идентификатора альтернативного входа. Вы убедитесь, что существует нет конфликтов между альтернативного идентификатора входа и имя участника-пользователя, если вы хотите по-прежнему поддерживать имя участника-пользователя для входа. Например установка одного элемента почты атрибута с другой стороны имя участника-пользователя будет блокировать других пользователей с входа с помощью своих имени участника-пользователя.

-   Если один из лесов, настроенных администратором отключен, службы федерации Active Directory продолжит поиска учетной записи пользователя с помощью альтернативного идентификатора входа в других лесах, которые настроены. Если сервер AD FS находит уникального пользователя объектов в лесах, которые его поиск, пользователь будет успешного входа.

-   Кроме того, можно настроить страницы входа AD FS чтобы дать пользователям некоторые подсказку о идентификатора альтернативного входа. Это делается путем добавления описание настроенной страницы (Дополнительные сведения см. в разделе [Customizing the AD FS Sign-in Pages](https://technet.microsoft.com/library/dn280950.aspx) или Настройка строки «Вход с учетной записью организации» над полем имени пользователя (Дополнительные сведения см. в разделе [Advanced Customization of AD FS Sign-in Pages](https://technet.microsoft.com/library/dn636121.aspx).

-   Тип утверждения, содержащего значение идентификатора альтернативного входа является **http:schemas.microsoft.com/ws/2013/11/alternateloginid**

## <a name="events-and-performance-counters"></a>Счетчики производительности и событий
Для измерения производительности серверов AD FS, при включении альтернативного идентификатора входа были добавлены следующие счетчики производительности:

-   Альтернативный код проверки подлинности входа в систему: количество проверок подлинности проводится с использованием альтернативного идентификатора входа

-   Дополнительный идентификатор входа проверки подлинности в секунду: количество проверок подлинности проводится с использованием альтернативного идентификатора входа в секунду

-   Среднее время задержки поиска для альтернативного идентификатора входа: среднее время задержки поиска в лесах, которые администратор настроил для альтернативного идентификатора входа

Ниже приведены различные сообщений об ошибках и соответствующие влияние на пользователя входа в систему с помощью событий, регистрируемых с помощью AD FS.



**Сообщений об ошибках**|**Влияние на процесс входа в систему**|**Событие**|
---------|---------|---------
Не удается получить значение для SAMAccountName для объекта-пользователя|Ошибка входа|Событие с Идентификатором 364 с сообщением об исключении MSIS8012: не удается найти samAccountName для пользователя: «{0}».|
Атрибут CanonicalName недоступен|Ошибка входа|Событие с Идентификатором 364 с сообщением об исключении MSIS8013: CanonicalName: «{0}» пользователя: «{1}» имеет неправильный формат.|
Несколько объектов-пользователей находятся в одной лесов|Ошибка входа|Событие с Идентификатором 364 с сообщением об исключении MSIS8015: найдено несколько учетных записей пользователей с удостоверением «{0}» в лесу «{1}» с удостоверениями: {2}|
Несколько объектов-пользователей находятся в нескольких лесах|Ошибка входа|Событие с Идентификатором 364 с сообщением об исключении MSIS8014: найдено несколько учетных записей пользователей с удостоверением «{0}» в лесах: {1}|

## <a name="see-also"></a>См. также:
[Операции AD FS](../../ad-fs/AD-FS-2016-Operations.md)


