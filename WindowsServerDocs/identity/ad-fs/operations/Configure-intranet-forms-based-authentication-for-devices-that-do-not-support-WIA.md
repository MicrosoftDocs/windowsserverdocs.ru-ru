---
ms.assetid: d562ef46-f240-48be-bbd4-fd88fc6bbbdc
title: Настройка проверки подлинности на основе форм интрасети для устройств, не поддерживающих WIA
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 6a730483f99e1c937c3618853ee6d3dbd175356b
ms.sourcegitcommit: 6f968368c12b9dd699c197afb3a3d13c2211f85b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/26/2019
ms.locfileid: "68544590"
---
# <a name="configuring-intranet-forms-based-authentication-for-devices-that-do-not-support-wia"></a>Настройка проверки подлинности на основе форм интрасети для устройств, не поддерживающих WIA


По умолчанию встроенная проверка подлинности Windows (WIA) включена в службы федерации Active Directory (AD FS) (AD FS) в Windows Server 2012 R2 для запросов проверки подлинности, которые выполняются в внутренней сети организации для любого приложения, использующего браузер для проверки подлинности. Например, это могут быть приложения на основе браузера, использующие протоколы WS-Federation или SAML, а также полнофункциональные приложения, использующие протокол OAuth. WIA предоставляет конечным пользователям возможность простого входа в приложения без необходимости ввода учетных данных вручную. Однако некоторые устройства и браузеры не поддерживают WIA, и в результате чего запросы проверки подлинности от этих устройств завершаются сбоем. Кроме того, не рекомендуется работать с определенными браузерами, которые согласовываются с NTLM. Рекомендуемым подходом является откат к проверке подлинности на основе форм для таких устройств и браузеров.

AD FS в Windows Server 2016 и Windows Server 2012 R2 предоставляют администраторам возможность настройки списка агентов пользователей, поддерживающих откат для проверки подлинности на основе форм. Откат становится возможным в двух конфигурациях:


- Свойство **виасуппортедусеражентстрингс** объекта `Set-ADFSProperties` командлет
- Свойство **виндовсинтегратедфаллбаккенаблед** объекта `Set-AdfsGlobalAuthenticationPolicy` командлет

**Виасуппортедусеражентстрингс** определяет агенты пользователя, поддерживающие WIA. AD FS анализирует строку агента пользователя при выполнении входа в браузере или элементе управления браузера. Если компонент строки агента пользователя не соответствует ни одному из компонентов строк агента пользователя, настроенных в свойстве **виасуппортедусеражентстрингс** , AD FS будет обеспечивать проверку подлинности на основе форм при условии, что  **Флаг Виндовсинтегратедфаллбаккенаблед** имеет значение true.

По умолчанию при установке новой AD FS создается набор строк агента пользователя. Однако они могут устареть в зависимости от изменений в браузерах и устройствах. В частности, устройства Windows имеют аналогичные строки агента пользователя с дополнительными вариациями в маркерах. Следующий пример Windows PowerShell предоставляет лучшие рекомендации для текущего набора устройств на рынке, поддерживающих беспрепятственное WIA:

    Set-AdfsProperties -WIASupportedUserAgents @("MSIE 6.0", "MSIE 7.0; Windows NT", "MSIE 8.0", "MSIE 9.0", "MSIE 10.0; Windows NT 6", "Windows NT 6.3; Trident/7.0", "Windows NT 6.3; Win64; x64; Trident/7.0", "Windows NT 6.3; WOW64; Trident/7.0", "Windows NT 6.2; Trident/7.0", "Windows NT 6.2; Win64; x64; Trident/7.0", "Windows NT 6.2; WOW64; Trident/7.0", "Windows NT 6.1; Trident/7.0", "Windows NT 6.1; Win64; x64; Trident/7.0", "Windows NT 6.1; WOW64; Trident/7.0", "MSIPC", "Windows Rights Management Client")

Приведенная выше команда обеспечит AD FS только для следующих вариантов использования WIA:

Агенты пользователя|Варианты использования|
-----|-----|
MSIE 6,0|IE 6,0|
MSIE 7,0; Windows NT|IE 7, IE в зоне интрасети. Фрагмент "Windows NT" отправляется операционной системой рабочего стола.|
MSIE 8,0|IE 8,0 (устройства не отправляются, поэтому необходимо сделать более конкретным).|
MSIE 9,0|IE 9,0 (устройства не отправляются, поэтому нет необходимости делать это более конкретным).|
MSIE 10,0; Windows NT 6|IE 10,0 для Windows XP и более новых версий настольной операционной системы</br></br>Устройства Windows Phone 8,0 (с установленным параметром "мобильные") исключаются, так как они отправляют</br></br>Агент пользователя: Mozilla/5.0 (совместимый; MSIE 10,0; Windows Phone 8,0; Trident/6.0; Иемобиле/10.0; АКТИВАЦИИ Персонифицирован КЛАВИАТУРА Lumia 920)|
Windows NT 6,3; Trident/7.0</br></br>Windows NT 6,3; Платформе х Trident/7.0</br></br>Windows NT 6,3; WOW64 Trident/7.0| Windows 8.1 классических операционных систем, различных платформ|
Windows NT 6,2; Trident/7.0</br></br>Windows NT 6,2; Платформе х Trident/7.0</br></br>Windows NT 6,2; WOW64 Trident/7.0|Операционная система Windows 8 Desktop, различные платформы|
Windows NT 6,1; Trident/7.0</br></br>Windows NT 6,1; Платформе х Trident/7.0</br></br>Windows NT 6,1; WOW64 Trident/7.0|Операционная система Windows 7 Desktop, различные платформы|
MSIPC| Клиент Microsoft технология защиты и контроля информации|
Клиент Windows Rights Management|Клиент Windows Rights Management|

Чтобы включить откат для использования проверки подлинности для агентов пользователя, отличных от упомянутых в строке Виасуппортедусеражентс, установите для флага Виндовсинтегратедфаллбаккенаблед значение true.

    Set-AdfsGlobalAuthenticationPolicy -WindowsIntegratedFallbackEnabled $true

Также убедитесь, что проверка подлинности на основе форм включена для интрасети.

## <a name="configuring-wia-for-chrome"></a>Настройка WIA для Chrome
Можно добавить Chrome или другие пользовательские агенты в конфигурацию AD FS, поддерживающую WIA. Это обеспечивает простой вход в приложения без необходимости вручную вводить учетные данные при доступе к ресурсам, защищенным AD FS. Выполните следующие действия, чтобы включить WIA на Chrome:

В AD FS конфигурации добавьте строку агента пользователя для Chrome на платформах под управлением Windows:

    Set-AdfsProperties -WIASupportedUserAgents ((Get-ADFSProperties | Select -ExpandProperty WIASupportedUserAgents) + "Mozilla/5.0 (Windows NT")

Аналогичным образом для Chrome в Apple macOS добавьте следующую строку агента пользователя в конфигурацию AD FS:

    Set-AdfsProperties -WIASupportedUserAgents ((Get-ADFSProperties | Select -ExpandProperty WIASupportedUserAgents) + "Mozilla/5.0 (Macintosh; Intel Mac OS X")

Убедитесь, что строка агента пользователя для Chrome теперь задана в свойствах AD FS:

    Get-AdfsProperties | Select -ExpandProperty WIASupportedUserAgents

(Вам понадобится новый снимок экрана) ![Настройка проверки подлинности](media/Configure-intranet-forms-based-authentication-for-devices-that-do-not-support-WIA/chrome1.png) 

>[!NOTE]   
> По мере выпуска новых браузеров и устройств рекомендуется согласовать возможности этих агентов пользователей и обновить конфигурацию AD FS соответствующим образом, чтобы оптимизировать процедуру проверки подлинности пользователя при использовании говорят о браузере и устройствах. В частности, рекомендуется повторно оценить параметр **виасуппортедусеражентс** в AD FS при добавлении нового устройства или типа браузера в матрицу поддержки для WIA.


