---
ms.assetid: a0f7bb11-47a5-47ff-a70c-9e6353382b39
title: "Управление рисками с использованием условного управления доступом"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: e2ad7d1467abd6d69077b515b8c69a65f7e70f19
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="manage-risk-with-conditional-access-control"></a>Управление рисками с использованием условного управления доступом

>Область применения: Windows Server 2012 R2


-   [Доступ к ключу условных принципы управления в AD FS](../../ad-fs/operations/Manage-Risk-with-Conditional-Access-Control.md#BKMK_1)

-   [Управление рисками с использованием условного управления доступом](../../ad-fs/operations/Manage-Risk-with-Conditional-Access-Control.md#BKMK_2)

## <a name="BKMK_1"></a>Ключевые понятия. условное управление доступом в AD FS
Основное назначение службы федерации Active Directory — предоставление маркера доступа, содержащего набор утверждений. Решение относительно того, какие утверждения AD FS принимает, а затем выдает, принимается в соответствии с правилами утверждений.

Управление доступом в AD FS реализуется с помощью правил утверждений авторизации выдачи, используемых для выдачи разрешающих или запрещающих утверждений, которые определяют, будет ли пользователь или группа пользователей, смогут получить доступ к AD FS защищенным ресурсам или не. Правила авторизации можно настроить только в отношениях доверия с проверяющей стороной.

|Правило|Логика правила|
|---------------|--------------|
|Разрешить всем пользователям|Если входящее утверждение имеет тип *любой тип утверждения* и значение равно *любое значение*, выдается утверждение со значением *разрешить*|
|Разрешить доступ пользователям с данным входящим утверждением|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *заданное значение утверждения*, выдается утверждение со значением *разрешить*|
|Запретить доступ пользователям с данным входящим утверждением|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *заданное значение утверждения*, выдается утверждение со значением *запретить*|

Дополнительные сведения об этих параметрах и логике правил см. в разделе [When to Use an Authorization Claim Rule](https://technet.microsoft.com/library/ee913560.aspx).

В AD FS в Windows Server 2012 R2 управление доступом дополнено несколькими факторами, включая пользователя, устройства, расположения и данных проверки подлинности. Это стало возможным благодаря множеству типов утверждений для правил утверждений авторизации.  Другими словами, в AD FS в Windows Server 2012 R2, вы можете принудительно условного управления доступом на основе удостоверения пользователя или группы членства, сетевого расположения, устройства (Дополнительные сведения, присоединенных к рабочему месту в разделе [присоединение к рабочему месту с любого устройства для единого входа и эффективной двухфакторной проверки подлинности между приложениями компании](../../ad-fs/operations/Join-to-Workplace-from-Any-Device-for-SSO-and-Seamless-Second-Factor-Authentication-Across-Company-Applications.md)) и состояния проверки подлинности (ли выполнение многофакторной проверки подлинности (MFA)).

Управление условным доступом в AD FS в Windows Server 2012 R2 предлагает следующие преимущества:

-   Политики гибкие и ясные авторизации для каждого приложения, благодаря которым можно разрешить или запретить доступ в зависимости от пользователя, устройства, сетевого расположения и состояния проверки подлинности.

-   Создание правил авторизации для приложений проверяющей стороны выдачи

-   Широкий Набор средств взаимодействия для общих сценариев условного управления доступом

-   Поддержка языка форматированного утверждений и Windows PowerShell для дополнительных сценариев условного управления доступом

-   Настраиваемые (каждой проверяющей стороной приложения) сообщения «Отказано в доступе». Дополнительные сведения см. в разделе [Customizing the AD FS Sign-in Pages](https://technet.microsoft.com/library/dn280950.aspx). С помощью этих сообщений, можно объяснить, почему пользователю отказано в доступе, а также ускорить процесс самостоятельного устранения ошибок там, где это возможно, например, запрашивать у пользователей к рабочему месту присоединить свои устройства. Дополнительные сведения см. в разделе [присоединение к рабочему месту с любого устройства для единого входа и эффективной двухфакторной проверки подлинности между приложениями компании](../../ad-fs/operations/Join-to-Workplace-from-Any-Device-for-SSO-and-Seamless-Second-Factor-Authentication-Across-Company-Applications.md).

В следующей таблице представлены все типы утверждений, доступные в AD FS в Windows Server 2012 R2 можно использовать для реализации условного управления доступом.

|Тип утверждения|Описание|
|--------------|---------------|
|Адрес электронной почты|Адрес электронной почты пользователя.|
|Заданное имя|Заданное имя пользователя.|
|Имя|Уникальное имя пользователя.|
|ИМЯ УЧАСТНИКА-ПОЛЬЗОВАТЕЛЯ|Основной имя пользователя (UPN) пользователя.|
|Общее имя|Общее имя пользователя.|
|AD FS 1 x адрес электронной почты|Адрес электронной почты пользователя при взаимодействии с AD FS 1.1 или AD FS 1.0.|
|Группы|Группа, членом которого является пользователь.|
|AD FS 1 x UPN|Имя участника-пользователя пользователя при взаимодействии с AD FS 1.1 или AD FS 1.0.|
|Роли|Роль пользователя.|
|Фамилия|Фамилия пользователя.|
|PPID|Частный идентификатор пользователя.|
|Идентификатор имени|Идентификатор имени SAML пользователя.|
|Метка времени проверки подлинности|Используется для отображения даты и времени проверки подлинности пользователя.|
|Метод проверки подлинности|Метод, используемый для проверки подлинности пользователя.|
|Запретить только SID группы|Только запрет SID группы пользователя.|
|Основной SID "только запрет"|Только основной SID пользователя.|
|Запретить только основной SID группы|Только запрет SID основной группы пользователя.|
|SID группы|SID группы пользователя.|
|SID основной группы|SID основной группы пользователя.|
|Основной SID|Основной SID пользователя.|
|Имя учетной записи Windows|Имя учетной записи домена пользователя в формате "домен\пользователь".|
|— Зарегистрированный пользователь|Пользователь зарегистрирован для использования данного устройства.|
|Идентификатор устройства|Идентификатор устройства.|
|Регистрационный номер устройства|Идентификатор для регистрации устройства.|
|Отображаемое регистрационное имя устройства|Отображаемое имя при регистрации устройства.|
|Тип ОС устройства|Тип операционной системы устройства.|
|Версия ОС устройства|Версия операционной системы устройства.|
|— Управляемых устройств|Устройство управляется службой управления.|
|Пересылаются клиента IP|IP-адрес пользователя.|
|Клиентское приложение|Тип клиентского приложения.|
|Агент пользователя клиента|Тип устройства клиента используется для доступа к приложению.|
|Клиент IP|IP-адрес клиента.|
|Путь к конечной точке|Абсолютный путь конечной точки, который можно использовать для определения активных и пассивных клиентов.|
|Прокси-сервера|DNS-имя прокси-сервера федерации, передавшего запрос.|
|Идентификатор приложения|Идентификатор проверяющей стороны.|
|Политики применения|Политики применения сертификата.|
|Идентификатор ключа центра сертификатов|Идентификатор ключа центра расширение сертификата, которым подписан выданный сертификат.|
|Основное ограничение|Одна из основных ограничений сертификата.|
|Расширенное использование ключа|Описывает один из вариантов расширенного использования ключа сертификата.|
|Издатель|Имя центра сертификации, выдавшего сертификат X.509.|
|Имя поставщика|Различающееся имя издателя сертификата.|
|Использование ключа|Один из вариантов использования ключа сертификата.|
|Дата окончания срока действия|Дата в формате местного времени, после чего сертификат является допустимым.|
|Дата вступления в силу|Дата вступления силу сертификата по местному времени.|
|Политики сертификата|Политики, согласно которым выдается сертификат.|
|Открытый ключ|Открытый ключ сертификата.|
|Необработанные данные сертификата|Необработанные данные сертификата.|
|Альтернативное имя субъекта|Одно из альтернативных имен сертификата.|
|Серийный номер|Серийный номер сертификата.|
|Алгоритм подписи|Алгоритм, используемый для создания подписи сертификата.|
|Тема|Субъект сертификата.|
|Идентификатор ключа субъекта|Идентификатор ключа субъекта сертификата.|
|Имя субъекта|Различающееся имя субъекта сертификата.|
|V2 Имя шаблона|Имя шаблона сертификата версии 2, используемое при выдаче или обновлении сертификата. Это значение характерно для продуктов Майкрософт.|
|V1 Имя шаблона|Имя шаблона сертификата версии 1, используемое при выдаче или обновлении сертификата. Это значение характерно для продуктов Майкрософт.|
|Отпечаток|Отпечаток сертификата.|
|Версия x 509|Формат X.509 версии сертификата.|
|В корпоративной сети|Используется для указания того, если запрос отправлен из корпоративной сети.|
|Истечение срока действия пароля|Используется для указания времени истечения срока действия пароля.|
|Дней срок действия пароля|Используется для указания количества дней до истечения срока действия пароля.|
|URL-адреса для обновления пароля|Используется для отображения веб-адреса службы обновления паролей.|
|Ссылки на методы проверки подлинности|Используется для указания всех методов проверки подлинности, используемый для проверки подлинности пользователя.|

## <a name="BKMK_2"></a>Управление рисками с использованием условного управления доступом
Благодаря разнообразию параметров, существует множество способов, в которых для управления рисками путем реализации условного управления доступом.

### <a name="common-scenarios"></a>Общие сценарии
Например представим простой сценарий реализации условного управления доступом на основе данных членства в группах пользователя для конкретного приложения (доверия с проверяющей стороной). Другими словами, можно выполнить настройку правило авторизации выдачи на сервере федерации, чтобы предоставить пользователям, принадлежащим к определенной группе в AD домена доступ к конкретному приложению, защищаемому AD FS.  Подробные пошаговые инструкции (с помощью пользовательского интерфейса и Windows PowerShell) по реализации этого сценария описаны в [Пошаговое руководство: управление рисками с использованием условного управления доступом](../../ad-fs/operations/Walkthrough-Guide--Manage-Risk-with-Conditional-Access-Control.md). Чтобы выполнить действия, описанные в этом пошаговом руководстве, необходимо настроить лабораторную среду и выполнить действия, описанные в [Настройка лабораторной среды для служб AD FS в Windows Server 2012 R2](../../ad-fs/deployment/Set-up-the-lab-environment-for-AD-FS-in-Windows-Server-2012-R2.md).

### <a name="advanced-scenarios"></a>Сложные сценарии
Другие примеры реализации условного управления доступом в AD FS в Windows Server 2012 R2 включают следующие:

-   Предоставление доступа к приложению, защищаемому AD FS, только если удостоверение пользователя проверено с помощью многофакторной проверки Подлинности

    Можно использовать следующий код:

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "PermitAccessWithMFA"
    c:[Type == "https://schemas.microsoft.com/claims/authnmethodsreferences", Value =~ "^(?i)https://schemas\.microsoft\.com/claims/multipleauthn$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

-   Предоставление доступа к приложению, защищаемому AD FS, только в том случае, если запрос на доступ поступает с присоединенного к рабочему месту устройства, зарегистрированного пользователя

    Можно использовать следующий код:

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "PermitAccessFromRegisteredWorkplaceJoinedDevice"
    c:[Type == "https://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser", Value =~ "^(?i)true$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

-   Предоставление доступа к приложению, защищаемому AD FS, только в том случае, если запрос на доступ поступает с присоединенного к рабочему месту устройства, зарегистрированного пользователя, удостоверение которого проверено с помощью многофакторной проверки Подлинности

    Можно использовать следующий код

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "RequireMFAOnRegisteredWorkplaceJoinedDevice"
    c1:[Type == "https://schemas.microsoft.com/claims/authnmethodsreferences", Value =~ "^(?i)http://schemas\.microsoft\.com/claims/multipleauthn$"] &&
    c2:[Type == "https://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser", Value =~ "^(?i)true$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

-   Предоставление доступа из экстрасети к приложению, защищаемому AD FS, только если запрос на доступ поступает от пользователя, удостоверение которого проверено с помощью многофакторной проверки Подлинности.

    Можно использовать следующий код:

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "RequireMFAForExtranetAccess"
    c1:[Type == "https://schemas.microsoft.com/claims/authnmethodsreferences", Value =~ "^(?i)http://schemas\.microsoft\.com/claims/multipleauthn$"] &&
    c2:[Type == "https://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork", Value =~ "^(?i)false$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

## <a name="see-also"></a>См. также:
[Пошаговое руководство: Управление рисками с использованием условного управления доступом](../../ad-fs/operations/Walkthrough-Guide--Manage-Risk-with-Conditional-Access-Control.md)<ph x="2">
</ph>[Настройка лабораторной среды для служб AD FS в Windows Server 2012 R2](../../ad-fs/deployment/Set-up-the-lab-environment-for-AD-FS-in-Windows-Server-2012-R2.md)



