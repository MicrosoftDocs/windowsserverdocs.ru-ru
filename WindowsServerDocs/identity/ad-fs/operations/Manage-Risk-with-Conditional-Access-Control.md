---
ms.assetid: a0f7bb11-47a5-47ff-a70c-9e6353382b39
title: Управление рисками с использованием условного управления доступом
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: e2ad7d1467abd6d69077b515b8c69a65f7e70f19
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59865595"
---
# <a name="manage-risk-with-conditional-access-control"></a>Управление рисками с использованием условного управления доступом

>Область применения. Windows Server 2012 R2


-   [Управление ключевые понятия: условный доступ в AD FS](../../ad-fs/operations/Manage-Risk-with-Conditional-Access-Control.md#BKMK_1)

-   [Управление рисками с использованием условного управления доступом](../../ad-fs/operations/Manage-Risk-with-Conditional-Access-Control.md#BKMK_2)

## <a name="BKMK_1"></a>Ключевые понятия. условное управление доступом в AD FS
Основное назначение службы федерации Active Directory — Отправка маркера доступа, содержащий набор утверждений. Решение относительно того, какие утверждения AD FS принимает, а затем выдает регулируется правил для утверждений.

Управление доступом в AD FS реализуется с помощью правил утверждений авторизации выдачи, которые используются для выдачи разрешающих или запрещающих утверждений, которые определяют, будет ли пользователя или группы пользователей могут получить доступ к AD FS защищенные ресурсы, или нет. Правила авторизации можно настроить только в отношениях доверия с проверяющей стороной.

|Параметр правила|Логика правила|
|---------------|--------------|
|Разрешить всем пользователям|Если входящее утверждение имеет тип *любой тип утверждения* и значение равно *любое значение*, выдается утверждение со значением *Разрешить*.|
|Разрешить доступ пользователям с данным входящим утверждением|Если входящее утверждение имеет тип *заданный тип утверждения* и значение равно *заданное значение утверждения*, выдается утверждение со значением *Разрешить*.|
|Отказать в доступе пользователям с данным входящим утверждением|Если входящее утверждение имеет тип *заданный тип утверждения* и значение равно *заданное значение утверждения*, выдается утверждение со значением *Отказать*.|

Дополнительные сведения об этих параметрах правил и логике см. в разделе [When to Use an Authorization Claim Rule](https://technet.microsoft.com/library/ee913560.aspx).

В AD FS в Windows Server 2012 R2 управление доступом дополнено несколькими факторами, включая пользователя, устройства, расположение и данные проверки подлинности. Это стало возможно благодаря множеству типов утверждений, доступных для правил утверждений авторизации.  Другими словами, в AD FS в Windows Server 2012 R2, можно принудительно задать условного управления доступом на основе пользователя удостоверения или членство в группах, сетевого расположения, устройства (является ли он к рабочему месту, Дополнительные сведения см. в разделе [присоединение к рабочему месту с любого Устройства для единого входа и эффективная двухфакторная проверка подлинности между компании приложениях](../../ad-fs/operations/Join-to-Workplace-from-Any-Device-for-SSO-and-Seamless-Second-Factor-Authentication-Across-Company-Applications.md)) и состояние проверки подлинности (ли выполняется многофакторная Идентификация (MFA)).

Условное управление доступом в AD FS в Windows Server 2012 R2 предлагает следующие преимущества:

-   Гибкие и ясные политики авторизации для каждого приложения, благодаря которым можно разрешить или отказать в доступе на основе пользователя, устройства, сетевого расположения и состояния проверки подлинности.

-   Создание правил авторизации выдачи для приложений проверяющей стороны.

-   Широкий набор средств взаимодействия пользователей для общих сценариев условного управления доступом.

-   Широкая поддержка языка утверждений и Windows PowerShell для сложных сценариев условного управления доступом.

-   Custom (каждой проверяющей стороны приложения) сообщений «Отказано в доступе». Дополнительные сведения см. в разделе [Customizing the AD FS Sign-in Pages](https://technet.microsoft.com/library/dn280950.aspx). С помощью этих сообщений можно объяснить, почему пользователю отказано в доступе, и по возможности ускорить процесс самостоятельного устранения ошибок, например напомнить пользователю о необходимости присоединиться к рабочему месту на устройстве. Дополнительные сведения см. в разделе [Join to Workplace from Any Device for SSO and Seamless Second Factor Authentication Across Company Applications](../../ad-fs/operations/Join-to-Workplace-from-Any-Device-for-SSO-and-Seamless-Second-Factor-Authentication-Across-Company-Applications.md).

Следующая таблица содержит все типы утверждений, доступные в AD FS в Windows Server 2012 R2, используемый для реализации условного управления доступом.

|Тип утверждения|Описание|
|--------------|---------------|
|Адрес электронной почты|Адрес электронной почты пользователя.|
|Заданное имя|Заданное имя пользователя.|
|Имя|Уникальное имя пользователя.|
|имя участника-пользователя|Имя участника-пользователя.|
|Общее имя|Общее имя пользователя.|
|AD FS 1 x адрес электронной почты|Адрес электронной почты пользователя при взаимодействии с AD FS 1.1 или AD FS 1.0.|
|Группа|Группа, членом которой является пользователь.|
|AD FS 1 x имя участника-пользователя|Имя участника-пользователя при взаимодействии с AD FS 1.1 или AD FS 1.0.|
|Роль|Роль пользователя.|
|Фамилия|Фамилия пользователя.|
|PPID|Частный идентификатор пользователя.|
|Идентификатор имени|Идентификатор имени SAML пользователя.|
|Метка времени проверки подлинности|Используется для отображения даты и времени проверки подлинности пользователя.|
|Метод проверки подлинности|Метод, используемый для проверки подлинности пользователя.|
|SID группы "только запрет"|ИД безопасности (SID) группы "только запрет" пользователя.|
|Основной SID "только запрет"|Основной ИД безопасности (SID) "только запрет" пользователя.|
|SID основной группы "только запрет"|ИД безопасности (SID) основной группы "только запрет" пользователя.|
|SID группы|ИД безопасности (SID) группы пользователя.|
|SID основной группы|ИД безопасности (SID) основной группы пользователя.|
|Основной SID|Основной ИД безопасности (SID) пользователя.|
|Имя учетной записи Windows|Имя учетной записи домена пользователя в виде "домен\пользователь".|
|Зарегистрированный пользователь|Пользователь зарегистрирован для использования данного устройства.|
|Идентификатор устройства|Идентификатор устройства.|
|Регистрационный номер устройства|Идентификатор для регистрации устройства.|
|Отображаемое регистрационное имя устройства|Отображаемое имя при регистрации устройства.|
|Тип ОС устройства|Тип операционной системы устройства.|
|Версия ОС устройства|Версия операционной системы устройства.|
|Управляемое устройство|Устройство управляется службой управления.|
|Перенаправленный IP-адрес клиента|IP-адрес пользователя.|
|Клиентское приложение|Тип клиентского приложения.|
|Агент пользователя клиента|Тип устройства, используемого клиентом для доступа к приложению.|
|IP-адрес клиента|IP-адрес клиента.|
|Путь к конечной точке|Абсолютный путь к конечной точке, который можно использовать для определения активных и пассивных клиентов.|
|Proxy (Прокси)|Имя DNS прокси-сервера федерации, передавшего запрос.|
|Идентификатор приложения|Идентификатор проверяющей стороны.|
|Политики применения|Политики применения сертификата.|
|Идентификатор ключа центра сертификации|Расширение сертификата, которым подписан выданный сертификат.|
|Основное ограничение|Одно из основных ограничений сертификата.|
|Расширенное использование ключа|Описывает один из вариантов расширенного использования ключа сертификата.|
|Издатель|Имя центра сертификации, выдавшего сертификат X.509.|
|Имя издателя|Различающееся имя издателя сертификата.|
|Использование ключа|Один из вариантов использования сертификата.|
|Дата окончания срока действия|Дата окончания срока действия сертификата по местному времени.|
|Дата вступления в силу|Дата вступления в силу сертификата по местному времени.|
|Политики сертификата|Политики, согласно которым выдается сертификат.|
|Открытый ключ|Открытый ключ сертификата.|
|Необработанные данные сертификата|Необработанные данные сертификата.|
|Альтернативное имя субъекта|Одно из альтернативных имен сертификата.|
|Серийный номер|Серийный номер сертификата.|
|Алгоритм подписи|Алгоритм, используемый для создания подписи сертификата.|
|Субъект|Субъект сертификата.|
|Идентификатор ключа субъекта|Идентификатор ключа субъекта сертификата.|
|Имя субъекта|Различающееся имя субъекта сертификата.|
|Имя шаблона V2|Имя шаблона сертификата версии 2, используемое при выдаче или обновлении сертификата. Это значение характерно для продуктов Майкрософт.|
|Имя шаблона V1|Имя шаблона сертификата версии 1, используемое при выдаче или обновлении сертификата. Это значение характерно для продуктов Майкрософт.|
|Отпечаток|Отпечаток сертификата.|
|Версия X 509|Версия сертификата в формате X.509.|
|В корпоративной сети|Используется для указания того, что запрос отправлен из корпоративной сети.|
|Истечение срока действия пароля — время|Используется для указания времени истечения срока действия пароля.|
|Истечение срока действия пароля — дни|Используется для указания количества дней, оставшихся до истечения срока действия пароля.|
|URL-адрес для обновления пароля|Используется для отображения веб-адреса службы обновления паролей.|
|Ссылки на методы проверки подлинности|Используются для указания всех методов проверки подлинности, используемых для проверки подлинности пользователя.|

## <a name="BKMK_2"></a>Управление рисками с использованием условного управления доступом
Благодаря разнообразию параметров существует множество способов управления рисками путем реализации условного управления доступом.

### <a name="common-scenarios"></a>Общие сценарии
Например представим простой сценарий реализации условного управления доступом на основе данных членства в группах пользователя для конкретного приложения (доверия с проверяющей стороной). Другими словами, можно настроить правило авторизации выдачи на сервере федерации, чтобы предоставить пользователям, принадлежащим к определенной группе в AD доступ к домену для конкретного приложения, который защищен с помощью AD FS.  Подробные пошаговые инструкции (с помощью пользовательского интерфейса и Windows PowerShell) по реализации этого сценария описаны в [Пошаговое руководство: Управление рисками с использованием условного управления доступом](../../ad-fs/operations/Walkthrough-Guide--Manage-Risk-with-Conditional-Access-Control.md). Чтобы выполнить действия, описанные в этом пошаговом руководстве, необходимо настроить лабораторную среду и выполните действия, описанные в [Настройка лабораторной среды для AD FS в Windows Server 2012 R2](../../ad-fs/deployment/Set-up-the-lab-environment-for-AD-FS-in-Windows-Server-2012-R2.md).

### <a name="advanced-scenarios"></a>Расширенные сценарии
Другие примеры реализации условного управления доступом в AD FS в Windows Server 2012 R2 включают следующее:

-   Разрешить доступ к приложению с AD FS с защитой, только в том случае, если удостоверение пользователя проверено с помощью многофакторной проверки Подлинности

    Можно использовать следующий код.

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "PermitAccessWithMFA"
    c:[Type == "https://schemas.microsoft.com/claims/authnmethodsreferences", Value =~ "^(?i)https://schemas\.microsoft\.com/claims/multipleauthn$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

-   Разрешить доступ к приложению с AD FS с защитой, только в том случае, если запрос на доступ поступает с рабочему месту устройства, зарегистрированного пользователя

    Можно использовать следующий код.

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "PermitAccessFromRegisteredWorkplaceJoinedDevice"
    c:[Type == "https://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser", Value =~ "^(?i)true$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

-   Разрешить доступ к приложению с AD FS с защитой, только в том случае, если запрос на доступ поступает с рабочему месту устройства, зарегистрированного пользователя, удостоверение которого проверено с помощью многофакторной проверки Подлинности

    Можно использовать следующий код.

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "RequireMFAOnRegisteredWorkplaceJoinedDevice"
    c1:[Type == "https://schemas.microsoft.com/claims/authnmethodsreferences", Value =~ "^(?i)http://schemas\.microsoft\.com/claims/multipleauthn$"] &&
    c2:[Type == "https://schemas.microsoft.com/2012/01/devicecontext/claims/isregistereduser", Value =~ "^(?i)true$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

-   Разрешить доступ к экстрасети к приложению, защищенных с помощью AD FS, только в том случае, если запрос на доступ поступает от пользователя, удостоверение которого проверено с помощью многофакторной проверки Подлинности.

    Можно использовать следующий код.

    ```
    @RuleTemplate = "Authorization"
    @RuleName = "RequireMFAForExtranetAccess"
    c1:[Type == "https://schemas.microsoft.com/claims/authnmethodsreferences", Value =~ "^(?i)http://schemas\.microsoft\.com/claims/multipleauthn$"] &&
    c2:[Type == "https://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork", Value =~ "^(?i)false$"] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "PermitUsersWithClaim");

    ```

## <a name="see-also"></a>См. также
[Пошаговое руководство: Управление рисками с помощью Conditional Access Control](../../ad-fs/operations/Walkthrough-Guide--Manage-Risk-with-Conditional-Access-Control.md)
[Настройка лабораторной среды для AD FS в Windows Server 2012 R2](../../ad-fs/deployment/Set-up-the-lab-environment-for-AD-FS-in-Windows-Server-2012-R2.md)



