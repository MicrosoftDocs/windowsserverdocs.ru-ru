---
title: Дополнительные методы проверки подлинности в AD FS 2019
description: В этом документе описаны новые методы проверки подлинности в AD FS 2019.
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 09/19/2018
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: ff129f2b049d3e17e6b39d653cc3962eba75090b
ms.sourcegitcommit: 2cc251eb5bc3069bf09bc08e06c3478fcbe1f321
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/03/2020
ms.locfileid: "84333905"
---
# <a name="configure-3rd-party-authentication-providers-as-primary-authentication-in-ad-fs-2019"></a>Настройка поставщиков проверки подлинности сторонних производителей в качестве основной проверки подлинности в AD FS 2019


Организации сталкиваются с атаками, которые пытаются перераспределить учетные записи пользователей с помощью запросов на проверку подлинности на основе паролей.  Чтобы защитить организации от компрометации, AD FS предлагает такие возможности, как "интеллектуальная" Блокировка экстрасети и блокировка на основе IP-адресов.  

Однако эти способы устранения рисков будут активными.  Чтобы обеспечить упреждающий способ, чтобы снизить серьезность этих атак, AD FS может запрашивать факторы, не имеющие пароля, перед сбором пароля.  

Например, AD FS 2016 представил Azure MFA как основную проверку подлинности, чтобы коды OTP из приложения Authenticator могли использоваться в качестве первого фактора.
Основываясь на этом, с AD FS 2019 можно настроить внешние поставщики проверки подлинности в качестве основных факторов проверки подлинности.

Существует два ключевых сценария, которые позволяют:

## <a name="scenario-1-protect-the-password"></a>Сценарий 1. Защита пароля
Защитите имя входа на основе пароля от атак методом подбора и блокировки, запрашивая дополнительный внешний фактор.  При успешном завершении внешней проверки подлинности пользователь увидит запрос на ввод пароля.  Это позволяет избежать попыток взлома или отключения учетных записей злоумышленниками.

Этот сценарий состоит из двух компонентов:
- Запрос Azure MFA (доступен в AD FS 2016) или внешний фактор проверки подлинности в качестве основной проверки подлинности
- Имя пользователя и пароль в качестве дополнительной проверки подлинности в AD FS

## <a name="scenario-2-password-free"></a>Сценарий 2. бесплатный пароль!
Полностью исключите пароли, но выполняя строгую многофакторную проверку подлинности, используя только методы на основе пароля в AD FS
- Azure MFA с приложением для проверки подлинности
- Windows 10 Hello для бизнеса
- Проверка подлинности на основе сертификата
- Внешние поставщики проверки подлинности

## <a name="concepts"></a>Основные понятия
**Первичная проверка подлинности** действительно означает, что это метод, который пользователь сначала запрашивает перед дополнительными факторами.  Ранее единственными основными методами, доступными в AD FS, были встроенные методы для Active Directory или Azure MFA или других хранилищ аутентификации LDAP.  Внешние методы можно настроить как "дополнительные" проверки подлинности, которые выполняются после успешного завершения основной проверки подлинности.

В AD FS 2019 внешняя проверка подлинности как основная возможность означает, что все внешние поставщики проверки подлинности, зарегистрированные в AD FS ферме (с помощью Register-Адфсаусентикатионпровидер), становятся доступны для первичной аутентификации, а также для дополнительной проверки подлинности. Они могут быть включены так же, как встроенные поставщики, такие как проверка подлинности с помощью форм и проверка подлинности на основе сертификатов, для интрасети и (или) экстрасети.

![проверка подлинности](media/Additional-Authentication-Methods-AD-FS/auth1.png)

После включения внешнего поставщика для экстрасети, интрасети или обоих пользователей он становится доступным для использования.  Если включен более одного метода, пользователи увидят страницу выбора и смогут выбрать основной метод так же, как и для дополнительной проверки подлинности.

## <a name="pre-requisites"></a>Предварительные требования
Перед настройкой внешних поставщиков проверки подлинности в качестве первичного убедитесь, что у вас есть следующие предварительные требования.
- Уровень поведения AD FS фермы (ФБЛ) был повышен до "4" (это значение преобразуется в AD FS 2019)
    - Это значение ФБЛ по умолчанию для новых ферм AD FS 2019
    - Для AD FS ферм, основанных на Windows Server 2012 R2 или 2016, ФБЛ можно создавать с помощью PowerShell командлет Invoke-Адфсфармбехавиорлевелраисе.  Дополнительные сведения об обновлении фермы AD FS см. в статье обновление фермы для ферм SQL или ферм WID. 
    - Значение ФБЛ можно проверить с помощью командлета Get-Адфсфарминформатион.
- Ферма AD FS 2019 настроена на использование новых страниц, разбиваемых на страницы 2019.
    - Это поведение по умолчанию для новых ферм AD FS 2019
    - Для AD FS ферм, обновленных с Windows Server 2012 R2 или 2016, постраничные потоки включаются автоматически при внешней проверке подлинности в качестве первичной (функция, описанная в этом документе) включается, как описано ниже.

## <a name="enable-external-authentication-methods-as-primary"></a>Включить внешние методы проверки подлинности в качестве основных
После проверки предварительных требований существует два способа настройки AD FS дополнительных поставщиков проверки подлинности в качестве основных:

### <a name="using-powershell"></a>Использование PowerShell


```powershell
PS C:\> Set-AdfsGlobalAuthenticationPolicy -AllowAdditionalAuthenticationAsPrimary $true
``` 


После включения или отключения дополнительной проверки подлинности в качестве основной необходимо перезапустить службу AD FS.

### <a name="using-the-ad-fs-management-console"></a>Использование консоли управления AD FS
В консоли управления AD FS в разделе **Service**  ->  **методы проверки подлинности**службы в разделе **основные методы проверки подлинности**нажмите кнопку Изменить.

Установите флажок **Разрешить дополнительным поставщикам проверки подлинности в качестве основного**.

После включения или отключения дополнительной проверки подлинности в качестве основной необходимо перезапустить службу AD FS.

## <a name="enable-username-and-password-as-additional-authentication"></a>Включение имени пользователя и пароля в качестве дополнительной проверки подлинности
Чтобы выполнить сценарий "Защита пароля", включите имя пользователя и пароль в качестве дополнительной проверки подлинности с помощью PowerShell или консоли управления AD FS.
### <a name="using-powershell"></a>Использование PowerShell



```powershell
PS C:\> $providers = (Get-AdfsGlobalAuthenticationPolicy).AdditionalAuthenticationProvider

PS C:\>$providers = $providers + "FormsAuthentication"

PS C:\>Set-AdfsGlobalAuthenticationPolicy -AdditionalAuthenticationProvider $providers
``` 

### <a name="using-the-ad-fs-management-console"></a>Использование консоли управления AD FS
В консоли управления AD FS в разделе методы проверки подлинности **службы**  ->  **Authentication Methods**в разделе **Дополнительные методы проверки подлинности**нажмите кнопку **изменить** .

Установите флажок для **проверки подлинности с помощью форм** , чтобы включить имя пользователя и пароль в качестве дополнительной проверки подлинности.
