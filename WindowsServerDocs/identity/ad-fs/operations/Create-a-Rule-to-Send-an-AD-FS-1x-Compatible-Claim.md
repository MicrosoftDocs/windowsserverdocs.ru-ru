---
ms.assetid: 0039fbbb-b981-4526-a550-f3456ff27635
title: Создание правила для преобразования входящего утверждения
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: d4e3a59ff9154a948143cef32103cae9f1f2d235
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71407598"
---
# <a name="create-a-rule-to-send-an-ad-fs-1x-compatible-claim"></a>Создание правила для отправки утверждения, совместимого с AD FS 1. x

В ситуациях, когда вы используете службы федерации Active Directory (AD FS) \(AD FS @ no__t-1 для выдаче утверждений, которые будут приниматься серверами федерации под управлением AD FS 1,0 \(Windows Server 2003 R2 @ no__t-3 или AD FS 1,1 \(Windows Server 2008 или Windows Сервер 2008 R2 @ no__t-5, необходимо выполнить следующие действия.  
  
-   Создайте правило, которое будет отправлять тип утверждения идентификатора имени в формате имени участника-пользователя, адреса электронной почты или общего имени.  
  
-   Все другие отправленные утверждения должны иметь один из следующих типов утверждений:  
  
    -   AD FS 1. Адрес электронной почты *x*  
  
    -   AD FS 1. имя участника-пользователя ( *x* )  
  
    -   Общее имя  
  
    -   Группа  
  
    -   Любой другой тип утверждения, который начинается с https://schemas.xmlsoap.org/claims/, например https://schemas.xmlsoap.org/claims/EmployeeID  
  
В зависимости от потребностей Организации используйте одну из следующих процедур, чтобы создать AD FS 1. утверждение *x* , совместимое с NameID:  
  
-   Создайте это правило, чтобы выдать утверждение идентификатора имени AD FS 1. x с помощью **шаблона "передать" или "фильтровать" входящего утверждения** .  
  
-   Создайте это правило, чтобы выдать утверждение идентификатора имени AD FS 1. x с помощью **шаблона правила преобразования входящего утверждения**. Этот шаблон правила можно использовать в ситуациях, когда необходимо изменить существующий тип утверждения на новый тип, который будет работать с AD FS 1. утверждения  *x* .  
  
> [!NOTE]  
> Чтобы это правило работало должным образом, убедитесь, что отношение доверия с проверяющей стороной или поставщик утверждений, в котором создается это правило, настроено для использования **профиля AD FS 1,0 и 1,1**. 

## <a name="to-create-a-rule-to-issue-an-adfs1x-name-id-claim-using-the-pass-through-or-filter-an-incoming-claim-rule-template-on-a-relying-party-trust-in-windows-server-2016"></a>Создание правила для выдаче AD FS 1. утверждение идентификатора имени *x* с использованием шаблона прохождения или фильтрации входящего утверждения для отношения доверия с проверяющей стороной в Windows Server 2016 

1.  В диспетчер сервера щелкните **Сервис**, а затем выберите **AD FS управление**.  
  
2.  В дереве консоли в разделе **AD FS**щелкните **отношения доверия с проверяющей стороной**. 
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule9.PNG)  
  
3.  Щелкните\-выбранное отношение доверия правой кнопкой мыши и выберите пункт **изменить политику выдачи утверждений**.
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule10.PNG)   
  
4.  В диалоговом окне **изменение политики выдачи утверждений** в разделе **правила преобразования выдачи** щелкните **Добавить правило** , чтобы запустить мастер правил. 
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule11.PNG)    

5.  На странице **Выбор шаблона правила** в разделе **шаблон правила утверждения**выберите **передать или отфильтровать входящее утверждение** из списка, а затем нажмите кнопку **Далее**.  
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule4.PNG)    

6.  На странице **Настройка правила** введите имя правила утверждения.  
  
7.  В поле **тип входящего утверждения**выберите **имя идентификатор** в списке.  
  
8.  В поле **Формат ВХОДЯЩЕГО идентификатора имени**выберите один из следующих AD FS 1. форматы утверждений *x*\-compatible из списка:  
  
    -   **УЧАСТНИКА**  
  
    -   **E @ no__t — 1Mail**  
  
    -   **Общее имя**  
  
9. Выберите один из следующих вариантов в зависимости от потребностей Организации.  
  
    -   **Пройти по всем значениям утверждений**  
  
    -   **Передавать только определенное значение утверждения**  
  
    -   **Передавать только значения утверждений, соответствующие определенному значению суффикса электронной почты**  
  
    -   **Проходить только по значениям утверждений, начинающимся с определенного значения**  
![создать правило](media/Create-a-Rule-to-Send-an-AD-FS-1x-Compatible-Claim/adfs3.PNG)   

10. Нажмите кнопку **Готово**, а затем кнопку **ОК** , чтобы сохранить правило.  

  
## <a name="to-create-a-rule-to-issue-an-adfs1x-name-id-claim-using-the-pass-through-or-filter-an-incoming-claim-rule-template-on-a-claims-provider-trust-in-windows-server-2016"></a>Создание правила для выдаче AD FS 1. утверждение идентификатора имени *x* с помощью шаблона прохождения или фильтрации входящего утверждения для отношения доверия поставщика утверждений в Windows Server 2016 
  
1.  В диспетчер сервера щелкните **Сервис**, а затем выберите **AD FS управление**.  
  
2.  В дереве консоли в разделе **AD FS**щелкните **отношения доверия поставщиков утверждений**. 
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule1.PNG)  
  
3.  Щелкните\-выбранное отношение доверия правой кнопкой мыши и выберите команду **изменить правила утверждений**.
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule2.PNG)   
  
4.  В диалоговом окне **изменение правил утверждений** в разделе **правила преобразования принятия** нажмите кнопку **Добавить правило** , чтобы запустить мастер правил.
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule3.PNG)    

5.  На странице **Выбор шаблона правила** в разделе **шаблон правила утверждения**выберите **передать или отфильтровать входящее утверждение** из списка, а затем нажмите кнопку **Далее**.  
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule4.PNG)    

6.  На странице **Настройка правила** введите имя правила утверждения.  
  
7.  В поле **тип входящего утверждения**выберите **имя идентификатор** в списке.  
  
8.  В поле **Формат ВХОДЯЩЕГО идентификатора имени**выберите один из следующих AD FS 1. форматы утверждений *x*\-compatible из списка:  
  
    -   **УЧАСТНИКА**  
  
    -   **E @ no__t — 1Mail**  
  
    -   **Общее имя**  
  
9. Выберите один из следующих вариантов в зависимости от потребностей Организации.  
  
    -   **Пройти по всем значениям утверждений**  
  
    -   **Передавать только определенное значение утверждения**  
  
    -   **Передавать только значения утверждений, соответствующие определенному значению суффикса электронной почты**  
  
    -   **Проходить только по значениям утверждений, начинающимся с определенного значения**  
![создать правило](media/Create-a-Rule-to-Send-an-AD-FS-1x-Compatible-Claim/adfs3.PNG)

10. Нажмите кнопку **Готово**, а затем кнопку **ОК** , чтобы сохранить правило.  


## <a name="to-create-a-rule-to-transform-an-incoming-claim-on-a-relying-party-trust-in-windows-server-2016"></a>Создание правила для преобразования входящего утверждения в отношении отношения доверия с проверяющей стороной в Windows Server 2016 

1.  В диспетчер сервера щелкните **Сервис**, а затем выберите **AD FS управление**.  
  
2.  В дереве консоли в разделе **AD FS**щелкните **отношения доверия с проверяющей стороной**. 
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule9.PNG)  
  
3.  Щелкните\-выбранное отношение доверия правой кнопкой мыши и выберите пункт **изменить политику выдачи утверждений**.
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule10.PNG)
  
4.  В диалоговом окне **изменение политики выдачи утверждений** в разделе **правила преобразования выдачи** щелкните **Добавить правило** , чтобы запустить мастер правил. 
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule11.PNG)

5.  На странице **Выбор шаблона правила** в разделе **шаблон правила утверждения**выберите **преобразовать входящее утверждение** в список, а затем нажмите кнопку **Далее**.  
![создать правило](media/Create-a-Rule-to-Transform-an-Incoming-Claim/transform3.PNG)

6.  На странице **Настройка правила** введите имя правила утверждения.  
  
7.  В поле **тип входящего утверждения**выберите тип входящего утверждения, которое требуется преобразовать в список.  
  
8.  В поле **Тип исходящего утверждения**выберите **имя идентификатор** в списке.  
  
9. В поле **Формат идентификатора исходящего имени**выберите один из следующих AD FS 1. форматы утверждений *x*\-compatible из списка:  
  
    -   **УЧАСТНИКА**  
  
    -   **E @ no__t — 1Mail**  
  
    -   **Общее имя**  
  
10. Выберите один из следующих вариантов в зависимости от потребностей Организации.  
  
    -   **Пройти по всем значениям утверждений**  
  
    -   **Замена входящего значения утверждения другим значением исходящего утверждения**  
  
    -   **Замена входящего суффикса e @ no__t-1mail на новый суффикс e @ no__t-2mail**  
![создать правило](media/Create-a-Rule-to-Send-an-AD-FS-1x-Compatible-Claim/adfs4.PNG)

11. Нажмите кнопку **Готово**, а затем кнопку **ОК** , чтобы сохранить правило.  

  


## <a name="to-create-a-rule-to-transform-an-incoming-claim-on-a-claims-provider-trust-in-windows-server-2016"></a>Создание правила для преобразования входящего утверждения в отношении доверия поставщика утверждений в Windows Server 2016 
  
1.  В диспетчер сервера щелкните **Сервис**, а затем выберите **AD FS управление**.  
  
2.  В дереве консоли в разделе **AD FS**щелкните **отношения доверия поставщиков утверждений**. 
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule1.PNG)  
  
3.  Щелкните\-выбранное отношение доверия правой кнопкой мыши и выберите команду **изменить правила утверждений**.
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule2.PNG)   
  
4.  В диалоговом окне **изменение правил утверждений** в разделе **правила преобразования принятия** нажмите кнопку **Добавить правило** , чтобы запустить мастер правил.
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule3.PNG)    

5.  На странице **Выбор шаблона правила** в разделе **шаблон правила утверждения**выберите **преобразовать входящее утверждение** в список, а затем нажмите кнопку **Далее**.  
![создать правило](media/Create-a-Rule-to-Transform-an-Incoming-Claim/transform3.PNG)      

6.  На странице **Настройка правила** введите имя правила утверждения.  
  
7.  В поле **тип входящего утверждения**выберите тип входящего утверждения, которое требуется преобразовать в список.  
  
8.  В поле **Тип исходящего утверждения**выберите **имя идентификатор** в списке.  
  
9. В поле **Формат идентификатора исходящего имени**выберите один из следующих AD FS 1. форматы утверждений *x*\-compatible из списка:  
  
    -   **УЧАСТНИКА**  
  
    -   **E @ no__t — 1Mail**  
  
    -   **Общее имя**  
  
10. Выберите один из следующих вариантов в зависимости от потребностей Организации.  
  
    -   **Пройти по всем значениям утверждений**  
  
    -   **Замена входящего значения утверждения другим значением исходящего утверждения**  
  
    -   **Замена входящего суффикса e @ no__t-1mail на новый суффикс e @ no__t-2mail**  
![создать правило](media/Create-a-Rule-to-Send-an-AD-FS-1x-Compatible-Claim/adfs4.PNG)    

11. Нажмите кнопку **Готово**, а затем кнопку **ОК** , чтобы сохранить правило.  













  
## <a name="to-create-a-rule-to-issue-an-adfs1x-name-id-claim-using-the-pass-through-or-filter-an-incoming-claim-rule-template-on-windows-server-2012-r2"></a>Создание правила для выдаче AD FS 1. утверждение идентификатора имени *x* с помощью шаблона прохождения или фильтрации входящего утверждения в Windows Server 2012 R2
  
1.  В диспетчер сервера выберите **Сервис**, а затем — **Управление AD FS**.  
  
2.  В дереве консоли в разделе **AD FS\\доверительные отношения**выберите отношения **доверия поставщиков утверждений** или **отношения доверия с проверяющей стороной**, а затем щелкните определенное отношение доверия в списке, в котором необходимо создать это правило.  
  
3.  Щелкните\-выбранное отношение доверия правой кнопкой мыши и выберите команду **изменить правила утверждений**.  
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule6.PNG) 
  
4.  В диалоговом окне **изменение правил утверждений** выберите одну из следующих вкладок в зависимости от редактируемого отношения доверия и набора правил, в котором необходимо создать это правило, а затем нажмите кнопку **Добавить правило** , чтобы запустить мастер правил, связанный с этим набором правил. :  
  
    -   **Правила преобразования принятия**  
  
    -   **Правила преобразования выдачи**  
  
    -   **Правила авторизации выдачи**  
  
    -   **Правила авторизации делегирования**  
![создать правило](media/Create-a-Rule-to-Permit-All-Users/permitall5.PNG)    

5.  На странице **Выбор шаблона правила** в разделе **шаблон правила утверждения**выберите **передать или отфильтровать входящее утверждение** из списка, а затем нажмите кнопку **Далее**.  
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule7.PNG)  
  
6.  На странице **Настройка правила** введите имя правила утверждения.  
  
7.  В поле **тип входящего утверждения**выберите **имя идентификатор** в списке.  
  
8.  В поле **Формат ВХОДЯЩЕГО идентификатора имени**выберите один из следующих AD FS 1. форматы утверждений *x*\-compatible из списка:  
  
    -   **УЧАСТНИКА**  
  
    -   **E @ no__t — 1Mail**  
  
    -   **Общее имя**  
  
9. Выберите один из следующих вариантов в зависимости от потребностей Организации.  
  
    -   **Пройти по всем значениям утверждений**  
  
    -   **Передавать только определенное значение утверждения**  
  
    -   **Передавать только значения утверждений, соответствующие определенному значению суффикса электронной почты**  
  
    -   **Проходить только по значениям утверждений, начинающимся с определенного значения**  
![создать правило](media/Create-a-Rule-to-Send-an-AD-FS-1x-Compatible-Claim/adfs1.PNG)

10. Нажмите кнопку **Готово**, а затем кнопку **ОК** , чтобы сохранить правило.  

  
## <a name="to-create-a-rule-to-issue-an-adfs1x-name-id-claim-using-the-transform-an-incoming-claim-rule-template-in-windows-server-2012-r2"></a>Создание правила для выдаче AD FS 1. утверждение идентификатора имени *x* с помощью шаблона преобразования входящего утверждения в Windows Server 2012 R2  
  
1.  В диспетчер сервера выберите **Сервис**, а затем — **Управление AD FS**.  
  
2.  В дереве консоли в разделе **AD FS\\доверительные отношения**выберите отношения **доверия поставщиков утверждений** или **отношения доверия с проверяющей стороной**, а затем щелкните определенное отношение доверия в списке, в котором необходимо создать это правило.  
  
3.  Щелкните\-выбранное отношение доверия правой кнопкой мыши и выберите команду **изменить правила утверждений**.  
![создать правило](media/Create-a-Rule-to-Pass-Through-or-Filter-an-Incoming-Claim/claimrule6.PNG) 
  
4.  В диалоговом окне **изменение правил утверждений** выберите одну из следующих вкладок, которые зависят от редактируемого отношения доверия и набора правил, для которого необходимо создать это правило, а затем нажмите кнопку **Добавить правило** , чтобы запустить мастер правил, связанный с этим набором правил. :  
  
    -   **Правила преобразования принятия**  
  
    -   **Правила преобразования выдачи**  
  
    -   **Правила авторизации выдачи**  
  
    -   **Правила авторизации делегирования**  
![создать правило](media/Create-a-Rule-to-Permit-All-Users/permitall5.PNG)
  
5.  На странице **Выбор шаблона правила** в разделе **шаблон правила утверждения**выберите **преобразовать входящее утверждение** в список, а затем нажмите кнопку **Далее**.  
![создать правило](media/Create-a-Rule-to-Transform-an-Incoming-Claim/transform1.PNG)   
  
6.  На странице **Настройка правила** введите имя правила утверждения.  
  
7.  В поле **тип входящего утверждения**выберите тип входящего утверждения, которое требуется преобразовать в список.  
  
8.  В поле **Тип исходящего утверждения**выберите **имя идентификатор** в списке.  
  
9. В поле **Формат идентификатора исходящего имени**выберите один из следующих AD FS 1. форматы утверждений *x*\-compatible из списка:  
  
    -   **УЧАСТНИКА**  
  
    -   **E @ no__t — 1Mail**  
  
    -   **Общее имя**  
  
10. Выберите один из следующих вариантов в зависимости от потребностей Организации.  
  
    -   **Пройти по всем значениям утверждений**  
  
    -   **Замена входящего значения утверждения другим значением исходящего утверждения**  
  
    -   **Замена входящего суффикса e @ no__t-1mail на новый суффикс e @ no__t-2mail**  
![создать правило](media/Create-a-Rule-to-Send-an-AD-FS-1x-Compatible-Claim/adfs2.PNG)    

11. Нажмите кнопку **Готово**, а затем кнопку **ОК** , чтобы сохранить правило.  

## <a name="additional-references"></a>Дополнительная справка 
[Настройка правил для утверждения](Configure-Claim-Rules.md)  
 
[Контрольный список. Создание правил утверждений для отношений доверия с проверяющей стороной](https://technet.microsoft.com/library/ee913578.aspx)  

[Контрольный список. Создание правил утверждений для отношений доверия с поставщиком утверждений](https://technet.microsoft.com/library/ee913564.aspx)  
  
[Когда следует использовать правило утверждения авторизации](../../ad-fs/technical-reference/When-to-Use-an-Authorization-Claim-Rule.md)  

[Роль утверждений](../../ad-fs/technical-reference/The-Role-of-Claims.md)  
  
[Роль правил утверждений](../../ad-fs/technical-reference/The-Role-of-Claim-Rules.md) 
