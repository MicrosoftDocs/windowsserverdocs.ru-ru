---
ms.assetid: 1a443181-7ded-4912-8e40-5aa447faf00c
title: Параметры единого входа AD FS 2016
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 08/17/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 0b0d4d085a94631b70df81fd53bff974d8425611
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59877765"
---
# <a name="ad-fs-single-sign-on-settings"></a>Параметры единого входа AD FS одним

>Область применения. Windows Server 2016, Windows Server 2012 R2

Single Sign-On (SSO) позволяет пользователям единственную проверку подлинности и доступ к различным ресурсам, не вводя дополнительные учетные данные.  В этой статье описывает по умолчанию поведение AD FS для единого входа, а также параметры конфигурации, вы сможете настроить это поведение.  

## <a name="supported-types-of-single-sign-on"></a>Поддерживаемые типы из единого входа

Службы федерации Active Directory поддерживает несколько типов возможности единого входа:  
  
-   **Сеанс единого входа**  
  
     Файлы cookie сеанса единого входа, записываются для прошедшего проверку подлинности пользователя, который избавляет от дополнительных запросов, когда пользователь переключает приложений во время определенного сеанса. Тем не менее если оканчивается определенным сеансом, пользователь будет запрашиваться свои учетные данные повторно.  
  
     AD FS будет устанавливать сеанс файлы cookie для единого входа по умолчанию если незарегистрированных устройствах пользователей. Если сеанс браузера завершен и перезапускается, этот сеансовый cookie удаляется, а не допускается больше.  
  
-   **Единый вход постоянно**  
  
     Постоянные файлы cookie SSO написаны для прошедшего проверку подлинности пользователя, что устраняет дополнительные запросы, при переключении приложений для до тех пор, пока постоянный файл cookie единого входа является допустимым. Разница между постоянные единого входа и сеанса единого входа — что в разных сеансах можно поддерживать единый вход постоянно.  
  
     AD FS будет устанавливать постоянные файлы cookie для единого входа, если устройство зарегистрировано. AD FS будет устанавливать постоянный файл cookie единого входа также в том случае, если пользователь выбирает параметр «оставаться в системе». Если постоянный файл cookie единого входа больше не прошла, оно будет отклонено и удален.  
  
-   **Единый вход для конкретного приложения**  
  
     В случае OAuth маркер обновления используется для поддержания состояния единого входа пользователя в пределах конкретного приложения.  
  
     Если устройство зарегистрировано, AD FS будет задайте срок действия маркера обновления на основе постоянного времени жизни файлов cookie единого входа для зарегистрированного устройства, которое составляет 7 дней по умолчанию для AD FS 2012 R2 и не более 90 дней с AD FS 2016 в том случае, если они используют свои устройства для доступ к ресурсам службы федерации Active Directory в пределах этого периода 14 дней. 

Если устройство не зарегистрировано, но пользователь выбирает параметр «оставаться в системе», время существования постоянных файлов cookie единого входа для «оставаться в системе» будет иметь значение времени истечения срока действия маркера обновления — 1 день по умолчанию не более 7 дней. В противном случае время существования маркера equals сеанса единого входа cookie время существования обновления которой составляет 8 часов по умолчанию  
  
 Как упоминалось выше, пользователей на зарегистрированных устройствах всегда будет единый вход постоянно, пока не будет отключен постоянных единый вход. Отмена регистрации устройств, единый вход постоянно можно сделать, включив «оставаться в системе» компонент (Оставаться). 
 
 Для Windows Server 2012 R2, чтобы включить PSSO для сценария «Оставаться в системе», необходимо установить это [исправление](https://support.microsoft.com/en-us/kb/2958298/) который также является частью объекта [август 2014 г. накопительный пакет обновления для Windows RT 8.1, Windows 8.1 и Windows Server 2012 R2](https://support.microsoft.com/en-us/kb/2975719).   

Задача | PowerShell | Описание
------------ | ------------- | -------------
Включить или отключить единый вход постоянно | ```` Set-AdfsProperties –EnablePersistentSso <Boolean> ````| Единый вход постоянно включена по умолчанию. Если она отключена, cookie не PSSO будут записаны.
«Включение и отключение «оставаться в системе» | ```` Set-AdfsProperties –EnableKmsi <Boolean> ```` | Функция «Оставаться в системе» отключена по умолчанию. Если он включен, конечный пользователь увидит Выбор «оставаться в системе» на странице входа AD FS



## <a name="ad-fs-2016---single-sign-on-and-authenticated-devices"></a>AD FS 2016 - единого входа и прошедшие проверку подлинности устройств
AD FS 2016 изменяет PSSO при прохождении проверки подлинности запрашивающей стороне с зарегистрированного устройства, увеличение максимального 90 дней, но требующих authenticvation (окно использования устройства) в течение 14 дней.
После ввода учетных данных в первый раз, по умолчанию пользователи с зарегистрированными устройствами получить единый вход для максимальный период 90 дней, если они используют устройство для доступа к ресурсам AD FS по крайней мере один раз каждые 14 дней.  Если они ждут, 15 дней после предоставления учетных данных, пользователи будут запрашиваться учетные данные повторно.  

Единый вход постоянно включена по умолчанию. Если она отключена, будут записаны cookie не PSSO. |  

``` powershell
Set-AdfsProperties –EnablePersistentSso <Boolean\>
```     
  
Окно использования устройства (по умолчанию 14 дней) регулируется с помощью свойства служб AD FS **DeviceUsageWindowInDays**.

``` powershell
Set-AdfsProperties -DeviceUsageWindowInDays
```   
Максимальный единый вход на период (90 дней по умолчанию) регулируется с помощью свойства служб AD FS **PersistentSsoLifetimeMins**.

``` powershell
Set-AdfsProperties -PersistentSsoLifetimeMins
```    

## <a name="keep-me-signed-in-for-unauthenticated-devices"></a>Сохранить в системе для не прошедших проверку подлинности устройств 
Для незарегистрированных устройств, определяется один период вход **сохранить мне подписи в Оставаться** параметры функции.  Оставаться отключена по умолчанию и можно включить, задав свойство AD FS KmsiEnabled значение True.

``` powershell
Set-AdfsProperties -EnableKmsi $true  
```    

С Оставаться отключена период по умолчанию единый вход — 8 часов.  Это можно настроить с помощью свойства SsoLifetime.  Свойство измеряется в минутах, поэтому его значение по умолчанию — 480.  

``` powershell
Set-AdfsProperties –SsoLifetime <Int32\> 
```   

С помощью Оставаться включен период по умолчанию единый вход составляет 24 часа.  Это можно настроить с помощью свойства KmsiLifetimeMins.  Свойство измеряется в минутах, поэтому его значение по умолчанию — 1440.

``` powershell
Set-AdfsProperties –KmsiLifetimeMins <Int32\> 
```   

## <a name="multi-factor-authentication-mfa-behavior"></a>Поведение многофакторной проверки подлинности (MFA)  
Важно отметить, что, предоставляя относительно длительного единого входа в AD FS предложит ввести дополнительной проверки подлинности (многофакторной проверки подлинности) при предыдущем вход был основан на основных учетных данных и не многофакторной проверки Подлинности, но текущий входить в требуется многофакторная Идентификация.  Это происходит независимо от конфигурации единого входа. AD FS, когда он получает запрос на проверку подлинности, сначала определяет, является ли это контекст единого входа (например, файл cookie) и затем, если обязательна многофакторная проверка Подлинности (например, если запрос поступает из вне) он оценивает ли контекст единого входа содержит многофакторной проверки Подлинности.  В противном случае запрос многофакторной проверки Подлинности.  


  
## <a name="psso-revocation"></a>PSSO отзыва  
 Для обеспечения безопасности, AD FS будет отклонять любые постоянный файл cookie единого входа, выданный при соблюдении следующих условий. Это потребует пользователю вводить свои учетные данные для проверки подлинности с помощью AD FS. 
  
-   Изменения пароля пользователя  
  
-   Постоянные единый вход отключен в AD FS  
  
-   Устройство отключено администратором в случае утери  
  
-   Службы федерации Active Directory получает постоянный файл cookie единого входа, который выдается для зарегистрированного пользователя, но пользователь или устройство больше не зарегистрирована  
  
-   Службы федерации Active Directory получает постоянный файл cookie единого входа для зарегистрированного пользователя, но пользователь повторно зарегистрировать.  
  
-   Службы федерации Active Directory получает постоянный файл cookie единого входа, который выдается в результате «оставаться в системе», но «оставаться в системе» отключен в AD FS  
  
-   Службы федерации Active Directory получает постоянный файл cookie единого входа, который выдается для зарегистрированного пользователя, но сертификат устройства отсутствует или измененную во время проверки подлинности  
  
-   Администратор AD FS задал пороговое значение времени для постоянных единого входа. Если это настроено, AD FS будет отклонять любые постоянный файл cookie единого входа, выданные до этого времени  
  
 Чтобы задать время прекращения, выполните следующий командлет PowerShell:  
  

``` powershell
Set-AdfsProperties -PersistentSsoCutoffTime <DateTime>
```
  
## <a name="enable-psso-for-office-365-users-to-access-sharepoint-online"></a>Включить PSSO для пользователей Office 365 для доступа к SharePoint Online  
 После PSSO включена и настроена в AD FS, AD FS будет записывать постоянный файл cookie после аутентификации пользователя. В следующий раз приходит пользователя, если все еще действителен, постоянный файл cookie пользователя не нужно предоставить учетные данные снова пройти проверку подлинности. Вы также можете предотвратить запрос дополнительной проверки подлинности для Office 365 и SharePoint Online пользователи, настроив следующие два утверждения правила в AD FS для сохраняемости триггера в Microsoft Azure AD и SharePoint Online.  Чтобы включить PSSO для пользователей Office 365 для доступа к SharePoint online, необходимо установить это [исправление](https://support.microsoft.com/en-us/kb/2958298/) который также является частью из [август 2014 г. накопительный пакет обновления для Windows RT 8.1, Windows 8.1 и Windows Server 2012 R2](https://support.microsoft.com/en-us/kb/2975719).  
  
 Правило преобразования выдачи проходить через InsideCorporateNetwork утверждения  
  
```  
@RuleTemplate = "PassThroughClaims"  
@RuleName = "Pass through claim - InsideCorporateNetwork"  
c:[Type == "http://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork"]  
=> issue(claim = c);   
A custom Issuance Transform rule to pass through the persistent SSO claim  
@RuleName = "Pass Through Claim - Psso"  
c:[Type == "http://schemas.microsoft.com/2014/03/psso"]  
=> issue(claim = c);  
  
```
  
Подведем итоги.
<table>
  <tr>
    <th colspan="1">Интерфейс единого входа</th>
    <th colspan="3">ADFS 2012 R2 <br> Устройство зарегистрировано?</th>
        <th colspan="1"></th>
    <th colspan="3">ADFS 2016 <br> Устройство зарегистрировано?</th>
  </tr>

  <tr align="center">
    <th></th>
    <th>НЕТ</th>
    <th>Нет, но Оставаться</th>
    <th>ДА</th>
    <th></th>
    <th>НЕТ</th>
    <th>Нет, но Оставаться</th>
    <th>ДА</th>
  </tr>
 <tr align="center">
    <td>Единый вход = > задайте токен обновления = ></td>
    <td>8 часов</td>
    <td>Н/Д</td>
    <td>Н/Д</td>
    <th></th>
    <td>8 часов</td>
    <td>Н/Д</td>
    <td>Н/Д</td>
  </tr>

 <tr align="center">
    <td>PSSO = > задайте токен обновления = ></td>
    <td>Н/Д</td>
    <td>24 часа</td>
    <td>7 дней</td>
    <th></th>
    <td>Н/Д</td>
    <td>24 часа</td>
    <td>Максимум 90 дней с окном 14 дней</td>
  </tr>

 <tr align="center">
    <td>Время существования маркера</td>
    <td>1 ч</td>
    <td>1 ч</td>
    <td>1 ч</td>
    <th></th>
    <td>1 ч</td>
    <td>1 ч</td>
    <td>1 ч</td>
  </tr>
</table>

**Регистрации устройства?** Вы получаете PSSO / постоянные единого входа <br>
**Не зарегистрированного устройства?** Вы получаете единого входа <br>
**Устройство не зарегистрировано, но Оставаться?** Вы получаете PSSO / постоянные единого входа <p>
ЕСЛИ:
 - [x] администратор включил функцию Оставаться [и]
 - [x] пользователь нажимает кнопку "флажок" Оставаться на странице входа в формах
 
**Хорошо, чтобы знать:** <br>
Федеративные пользователи, не имеющие **LastPasswordChangeTimestamp** атрибута выдаются файлы cookie сеанса и токены обновления, которые имеют **максимальный возраст значение 12 часов**.<br>
Это происходит потому, что Azure AD не может определить, когда отменять маркеры, относящиеся к старым учетным данным (например, пароля, который был изменен). Таким образом Azure AD необходимо проверить чаще, убедитесь, что имя пользователя и связанные с ним маркеры по-прежнему в хорошем состоянии.
