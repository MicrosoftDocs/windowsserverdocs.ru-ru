---
ms.assetid: 39ecc468-77c5-4938-827e-48ce498a25ad
title: Приложение A. Проверка требований AD FS
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: ad4275bf7b6231692171209b19c4c60190e30126
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87942980"
---
# <a name="appendix-a-reviewing-ad-fs-requirements"></a>Приложение A. Анализ требований AD FS

Чтобы партнеры Организации в развертывании службы федерации Active Directory (AD FS) (AD FS) могли успешно работать, сначала необходимо убедиться, что инфраструктура корпоративной сети настроена на поддержку требований AD FS для учетных записей, разрешения имен и сертификатов. AD FS предусматривает следующие типы требований.

> [!TIP]
> Дополнительные AD FS ссылки на ресурсы можно найти в [разделе Общие сведения о ключевых AD FS концепциях](https://docs.microsoft.com/windows-server/identity/ad-fs/technical-reference/understanding-key-ad-fs-concepts).

## <a name="hardware-requirements"></a>Требования к оборудованию
Следующие минимальные и рекомендуемые требования к оборудованию применяются к компьютерам Федерации и прокси-серверам федерации.

|Требования к оборудованию|Минимальное требование|Рекомендуемое требование|
|------------------------|-----------------------|---------------------------|
|Скорость ЦП|Одноядерный, 1 ГГц|четырехъядерный с частотой 2 ГГц|
|ОЗУ|1 ТБ|4 ГБ|
|Место на диске|50 МБ|100 МБ|

## <a name="software-requirements"></a>Требования к программному обеспечению
AD FS полагается на функции сервера, встроенные в &reg; операционную систему Windows server 2012.

> [!NOTE]
> Службы ролей службы федерации и прокси-сервера службы федерации не могут сосуществовать на одном и том же компьютере.

## <a name="certificate-requirements"></a>Требования к сертификатам
Сертификаты играют ключевую роль в обеспечении безопасности связи между серверами федерации, прокси-серверами федерации, приложениями с поддержкой утверждений и веб-клиентами. Требования к сертификатам варьируются в зависимости от того, идет ли речь о настройке компьютера сервера федерации или прокси-сервера федерации (см. информацию далее в этом разделе).

### <a name="federation-server-certificates"></a>Сертификаты сервера федерации
В следующей таблице перечислены сертификаты, необходимые серверам федерации.

|Тип сертификата|Описание|Что требуется знать до начала развертывания|
|--------------------|---------------|------------------------------------------|
|Сертификат SSL|Это стандартный SSL-сертификат, используемый для обеспечения безопасности связи между серверами федерации и клиентами.|Этот сертификат должен быть связан с веб-сайтом по умолчанию в службах IIS для сервера федерации или прокси-сервера федерации.  Необходимо настроить в IIS привязку для прокси-сервера федерации — только после этого будет работать мастер настройки прокси-сервера федерации.<p>**Рекомендация.** Поскольку этому сертификату должны доверять клиенты  AD FS, используйте сертификат аутентификации сервера, выданный публичным центром сертификации (сторонним), например VeriSign. **Совет.** Имя субъекта этого сертификата используется, чтобы представлять имя службы федерации для каждого развертываемого экземпляра AD FS. По этой причине имеет смысл выбрать имя субъекта на вновь изданных ЦС сертификатах, наиболее полно отражающее имя компании или организации для партнеров.|
|Сертификат взаимодействия служб|Этот сертификат обеспечивает безопасность сообщений WCF для обеспечения безопасного взаимодействия серверов федерации.|По умолчанию в качестве сертификата взаимодействия служб используется сертификат SSL.  Изменить эту настройку можно с помощью консоли управления AD FS.|
|Сертификат подписи токена|Это стандартный сертификат X509, используемый для безопасного подписания всех токенов, издаваемых сервером федерации.|Сертификат подписи токена должен содержать закрытый ключ и быть связанным по цепочке с доверенной корневой папкой службы федерации. По умолчанию AD FS создает самозаверяющий сертификат. Однако впоследствии с учетом потребностей вашей организации эту настройку можно изменить и использовать выданный ЦС сертификат. Изменение настройки осуществляется с помощью оснастки управления AD FS.|
|Сертификат расшифровки токенов|Это стандартный SSL-сертификат, используемый для расшифровки входящих токенов, зашифрованных партнерским сервером федерации. Он также публикуется в метаданных федерации.|По умолчанию AD FS создает самозаверяющий сертификат. Однако впоследствии с учетом потребностей вашей организации эту настройку можно изменить и использовать выданный ЦС сертификат. Изменение настройки осуществляется с помощью оснастки управления AD FS.|

> [!CAUTION]
> Сертификаты, используемые для подписи и расшифровки токенов, играют критически важную роль для стабильности службы федерации. Поскольку потеря или незапланированное удаление любых сертификатов, настроенных для этой цели, может привести к сбоям в работе службы, необходимо создать резервную копию настроенных для этой цели сертификатов.

Дополнительные сведения об используемых серверами федерации сертификатах см. в статье [Требования к сертификатам для серверов федерации](Certificate-Requirements-for-Federation-Servers.md).

### <a name="federation-server-proxy-certificates"></a>Сертификаты прокси-серверов федерации
В следующей таблице перечислены сертификаты, необходимые прокси-серверам федерации.

|Тип сертификата|Описание|Что требуется знать до начала развертывания|
|--------------------|---------------|------------------------------------------|
|Сертификат проверки подлинности сервера|Это стандартный SSL-сертификат, используемый для обеспечения безопасности связи между прокси-сервером федерации и клиентскими компьютерами в Интернете.|Этот сертификат должен быть связан с веб-сайтом по умолчанию в службах IIS — только после этого можно приступать к работе с мастером конфигурации прокси-сервера федерации AD FS.<p>**Рекомендация.** Поскольку этому сертификату должны доверять клиенты  AD FS, используйте сертификат аутентификации сервера, выданный публичным центром сертификации (сторонним), например VeriSign.<p>**Совет.** Имя субъекта этого сертификата используется, чтобы представлять имя службы федерации для каждого развертываемого экземпляра AD FS. По этой причине имеет смысл выбрать имя субъекта, наиболее полно отражающее имя компании или организации для партнеров.|

Дополнительные сведения об используемых прокси-серверами федерации сертификатах см. в статье [Требования к сертификатам для прокси-серверов федерации](Certificate-Requirements-for-Federation-Server-Proxies.md).

## <a name="browser-requirements"></a>Требования к браузеру
Несмотря на то что любой веб-браузер с поддержкой JavaScript можно настроить в качестве клиента AD FS, веб-страницы, предоставляемые по умолчанию, протестированы только для версий Internet Explorer 7.0, 8.0 и 9.0, Mozilla Firefox 3.0 и Safari 3.1 в Windows. Для входа и выхода через браузер необходимо включить JavaScript и файлы cookie.

Группа разработчиков продуктов AD FS корпорации Майкрософт успешно проверила конфигурации браузера и операционной системы, приведенные в следующей таблице.

|Браузер|Windows 7|Windows Vista|
|-----------|-------------|-----------------|
|Internet Explorer 7.0|X|X|
|Internet Explorer 8.0|X|X|
|Internet Explorer 9.0|X|Не тестировалось|
|FireFox 3.0|X|X|
|Safari 3.1|X|X|

> [!NOTE]
> AD FS поддерживает 32- и 64-разрядные версии всех указанных в таблице выше браузеров.

### <a name="cookies"></a>Файлы cookie
AD FS создает файлы cookie для отдельных сеансов и сохраняемые файлы cookie, которые необходимо сохранять на клиентских компьютерах для использования функций входа, выхода, единого входа и т. д. Следовательно, необходимо настроить клиентский браузер для приема файлов cookie. Файлы cookie, используемые для аутентификации, всегда представляют собой файлы cookie HTTPS-сеанса, которые записываются для исходного сервера. Если клиентский браузер не настроен для поддержки этих файлов cookie, AD FS не сможет функционировать правильно. Сохраняемые файлы cookie используются для сохранения выбранного пользователем поставщика утверждений. Их можно отключить, воспользовавшись параметром конфигурации в файле конфигурации для страниц входа AD FS.

По соображениям безопасности требуется поддержка TLS/SSL.

## <a name="network-requirements"></a>Требования к сети
Надлежащая настройка следующих сетевых служб является необходимым условием для успешного развертывания AD FS в организации.

### <a name="tcpip-network-connectivity"></a>Сетевое подключение TCP/IP
Для AD FS функции сетевое подключение TCP/IP должно существовать между клиентом. контроллер домена; и на компьютерах, на которых размещается служба федерации, прокси-агент службы федерации (при использовании) и веб-агент службы федерации Active Directory.

### <a name="dns"></a>DNS
Основной сетевой службой, которая важна для работы AD FS, кроме служб домен Active Directory (AD DS), является система доменных имен (DNS). Если развернута служба DNS, пользователи могут использовать удобные имена компьютеров, которые легко запомнить, для подключения к компьютерам и другим ресурсам в IP-сетях.

 В Windows Server 2008 для разрешения имен используется DNS, а не разрешение имен NetBIOS, которое было использовано в сетях под управлением Windows NT 4.0. Для приложений, требующих этого, по-прежнему можно использовать систему WINS. Однако для AD DS и AD FS требуется разрешение имен DNS.

Процесс настройки DNS для поддержки AD FS зависит от того, что:

-   В вашей организации уже существует готовая инфраструктура DNS. В большинстве сценариев DNS уже настроена для всей сети, так что клиенты веб-браузера в корпоративной сети имеют доступ к Интернету. Так как доступ к Интернету и разрешение имен являются требованиями AD FS, предполагается, что эта инфраструктура настроена для развертывания AD FS.

-   Планируется добавление федеративного сервера в корпоративную сеть. В целях аутентификации пользователей в корпоративной сети внутренние DNS-серверы в лесу корпоративной сети должны быть настроены для возвращения имени CNAME внутреннего сервера, на котором выполняется служба федерации. Дополнительные сведения см. в разделе [Требования к разрешению имен для серверов федерации](Name-Resolution-Requirements-for-Federation-Servers.md).

-   Планируется добавить в сеть периметра федеративный прокси-сервер. Если требуется проверить подлинность учетных записей пользователей, расположенных в корпоративной сети вашей организации партнера по удостоверениям, внутренние DNS-серверы в лесу корпоративной сети должны быть настроены для возврата CNAME внутреннего прокси-сервера федерации. Сведения о настройке DNS в соответствии с добавлением прокси-серверов федерации см. в разделе [требования к разрешению имен для прокси](Name-Resolution-Requirements-for-Federation-Server-Proxies.md)-серверов федерации.

-   Система DNS настраивается для тестовой лабораторной среды. Если вы планируете использовать AD FS в тестовой среде, где ни один корневой DNS-сервер не является полномочным, вероятно, придется настроить серверы пересылки DNS таким образом, чтобы запросы имен между двумя или более лесами перенаправлялись соответствующим образом. Общие сведения о настройке лабораторной среды тестирования AD FS см. в разделе AD FS пошаговые [инструкции и руководства](https://go.microsoft.com/fwlink/?LinkId=180357).

## <a name="attribute-store-requirements"></a>Требования к хранилищу атрибутов
Для AD FS требуется по крайней мере одно хранилище атрибутов для проверки подлинности пользователей и извлечения утверждений безопасности для этих пользователей. Список поддерживаемых AD FS хранилищ атрибутов см. в статье [Роль хранилищ атрибутов](../../ad-fs/technical-reference/The-Role-of-Attribute-Stores.md) руководства по разработке AD FS.

> [!NOTE]
> AD FS автоматически создает хранилище атрибутов Active Directory по умолчанию.

Требования к хранилищу атрибутов зависят от того, функционирует ли ваша организация как партнер по учетным записям (где размещены федеративные пользователи) или партнер по ресурсам (где размещено федеративное приложение).

### <a name="adds"></a>Доменные службы Active Directory
Для успешного функционирования AD FS контроллеры домена в организации партнера по учетным записям или в организации партнера по ресурсам должны работать под управлением Windows Server 2003 с пакетом обновления 1 (SP1), Windows Server 2003 R2, Windows Server 2008 или Windows Server 2012.

Если AD FS устанавливается и настраивается на объединенном в домен компьютере, хранилище учетных записей пользователей Active Directory для этого домена предоставляется как хранилище атрибутов с возможностью выбора.

> [!IMPORTANT]
> Поскольку AD FS требует установки службы IIS (IIS), рекомендуется не устанавливать AD FS программного обеспечения на контроллере домена в рабочей среде в целях безопасности. Однако эта конфигурация поддерживается службой технической поддержки клиентов Майкрософт.

#### <a name="schema-requirements"></a>Требования к схеме
AD FS не требует изменения схемы или изменения функционального уровня для AD DS.

#### <a name="functional-level-requirements"></a>Требования функционального уровня
Для использования большинства функций AD FS не требуются модификации AD FS функционального уровня. Однако для успешной аутентификации клиентских сертификатов (если сертификат явно сопоставлен учетной записи пользователя в AD DS) требуется функциональный уровень домена Windows Server 2008 или выше.

#### <a name="service-account-requirements"></a>Требования к учетным записям служб
Если создается ферма серверов федерации, необходимо сначала создать специальную доменную учетную запись службы в AD DS, которую сможет использовать служба федерации. Впоследствии можно настроить для использования этой учетной записи каждый сервер федерации на ферме. Дополнительные сведения об этом см. в статье [Настройка учетной записи службы для фермы серверов федерации вручную](../../ad-fs/deployment/Manually-Configure-a-Service-Account-for-a-Federation-Server-Farm.md) в руководстве по развертыванию AD FS.

### <a name="ldap"></a>LDAP
При работе с другими хранилищами атрибутов на базе протокола LDAP необходимо подключаться к серверу LDAP, поддерживающему интегрированную аутентификацию Windows. Строка подключения LDAP должна записываться в формате URL-адреса LDAP в соответствии со стандартом RFC 2255.

### <a name="sql-server"></a>SQL Server
Для успешной работы AD FS компьютеры, на которых размещается хранилище атрибутов сервера язык SQL (SQL), должны работать под управлением Microsoft SQL Server 2005 или SQL Server 2008. При работе с хранилищами атрибутов на базе SQL необходимо также настроить строку подключения.

### <a name="custom-attribute-stores"></a>Пользовательские хранилища атрибутов.
Хранилища настраиваемых атрибутов позволяют реализовывать более сложные сценарии. Язык политик, интегрированный в AD FS, может ссылаться на хранилища настраиваемых атрибутов, тем самым расширяя возможности перечисленных ниже сценариев.

-   Создание утверждений для прошедшего локальную аутентификацию пользователя

-   Добавление утверждений для прошедшего внешнюю аутентификацию пользователя

-   Авторизация пользователя на получение токена

-   Авторизация службы на получение токена для поведения пользователя

При работе с хранилищем настраиваемых атрибутов может также потребоваться настроить строку подключения. В этой ситуации можно ввести любой пользовательский код, обеспечивающий подключение к хранилищу настраиваемых атрибутов. Строки подключения в этом случае представляют собой набор пар "имя-значение", которые интерпретируются как реализованные разработчиком хранилища настраиваемых атрибутов.

Дополнительные сведения о разработке и использовании настраиваемых хранилищ атрибутов см. в разделе [Общие сведения о хранилище атрибутов](https://go.microsoft.com/fwlink/?LinkId=190782).

## <a name="application-requirements"></a>Требования приложений
Серверы федерации могут взаимодействовать с федеративными приложениями (например, приложениями с поддержкой утверждений) и обеспечивать их безопасность.

## <a name="authentication-requirements"></a>Требования к проверке подлинности
AD FS интегрируется с существующей проверкой подлинности Windows, например с помощью проверки подлинности Kerberos, NTLM, смарт-карт и сертификатов X. 509 v3 на стороне клиента. Серверы федерации используют стандартную аутентификацию Kerberos для аутентификации пользователя в домене. Клиенты могут выполнить аутентификацию на базе форм, смарт-карт, а также интегрированную аутентификацию Windows в зависимости от настроек аутентификации.

Роль прокси-сервера федерации AD FS делает возможным сценарий, в котором пользователь проходит внешнюю аутентификацию с использованием SSL-аутентификации клиента. Можно также настроить роль сервера федерации для требования SSL-аутентификации клиента, хотя наивысшее удобство для пользователей обеспечивается настройкой сервера федерации учетных записей для интегрированной аутентификации Windows. В данном случае AD FS не контролирует, какие учетные данные пользователь использует для входа на рабочий стол Windows.

### <a name="smart-card-logon"></a>Вход по смарт-карте
Хотя AD FS может принудительно применять тип учетных данных, используемых для проверки подлинности (пароли, аутентификацию клиента SSL или встроенной проверки подлинности Windows), он не применяет проверку подлинности напрямую с помощью смарт-карт. Таким образом, AD FS не предоставляет пользовательский интерфейс (UI) на стороне клиента для получения учетных данных для личного идентификационного номера (ПИН) смарт-карты. Это обусловлено тем, что клиенты под управлением Windows намеренно не предоставляют сведения об учетных данных пользователя для серверов федерации или веб-серверов.

### <a name="smart-card-authentication"></a>Аутентификация по смарт-карте
Проверка подлинности смарт-карты использует протокол Kerberos для проверки подлинности на сервере федерации учетных записей. AD FS нельзя расширить для добавления новых методов проверки подлинности. Для связи по цепочке с доверенным корневым расположением на клиентском компьютере сертификат в смарт-карте не требуется. Использование сертификата, основанного на смарт-карте, с AD FS требует следующих условий.

-   Считывающий механизм и поставщик служб шифрования (CSP) для смарт-карты должен работать на компьютере, на котором расположен браузер.

-   Сертификат смарт-карты должен быть связан с доверенным корнем на сервере федерации учетных записей и прокси-сервером федерации учетной записи.

-   Сертификат должен сопоставляться с учетной записью пользователя в AD DS одним из следующих методов.

    -   Имя субъекта сертификата соответствует различающемуся имени LDAP учетной записи пользователя в AD DS.

    -   Расширение altname субъекта сертификата имеет имя участника-пользователя (UPN) учетной записи пользователя в AD DS.

Для удовлетворения определенных требований в отношении строгости аутентификации в некоторых сценариях также возможно настроить AD FS для создания утверждения, указывающего на способ аутентификации пользователя. Затем проверяющая сторона может использовать это утверждение для принятия решения об авторизации.

## <a name="see-also"></a>См. также:
[Руководство по разработке служб федерации Active Directory в Windows Server 2012](AD-FS-Design-Guide-in-Windows-Server-2012.md)
