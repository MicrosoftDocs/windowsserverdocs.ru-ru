---
ms.assetid: 98c5ef45-2bcb-4f87-86c8-5ac6c16a6097
title: Сертификаты подписи токена
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 24b095827ad074dbe249a9d4decd8edeecbb3603
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80858787"
---
# <a name="token-signing-certificates"></a>Сертификаты подписи токена

Чтобы предотвратить несанкционированный доступ к федеративным ресурсам, для серверов федерации требуется токен\-сертификатов для подписи. Пара открытого ключа закрытого\/, используемая с маркерами\-подписи, является наиболее важным механизмом проверки любой Федеративной связи, так как эти ключи подтверждают, что маркер безопасности был выдан действительным сервером федерации партнера и что маркер не был изменен во время передачи.  
  
## <a name="token-signing-certificate-requirements"></a>Требования к сертификату для подписи маркера\-  
Для работы с AD FS маркер подписи\-сертификат должен соответствовать следующим требованиям:  
  
-   Для успешного подписания маркера безопасности маркера\-сертификат подписи токен\-должен содержать закрытый ключ.  
  
-   Учетная запись службы AD FS должна иметь доступ к маркеру\-закрытый ключ сертификата подписи в личном хранилище локального компьютера. Это выполняется программой установки. Вы также можете использовать\-оснастки управления AD FS в, чтобы обеспечить этот доступ при последующем изменении маркера\-сертификата подписи.  
  
> [!NOTE]  
> Это инфраструктура открытых ключей \(PKI\) рекомендуется не использовать закрытый ключ для нескольких целей. Поэтому не используйте сертификат связи службы, установленный на сервере федерации в качестве маркера\-сертификат подписи.  
  
## <a name="how-token-signing-certificates-are-used-across-partners"></a>Использование маркеров\-сертификатов для подписи в партнерах  
Каждый маркер подписи\-сертификат содержит криптографические закрытые ключи и открытые ключи, используемые для цифровой подписи \(с помощью закрытого ключа\) маркера безопасности. Позже, после получения сервером федерации партнера, эти ключи проверяют подлинность \(с помощью открытого ключа\) зашифрованного маркера безопасности.  
  
Так как каждый маркер безопасности имеет цифровую подпись партнера по учетным записям, партнер по ресурсам может проверить, что маркер безопасности на самом деле выдан партнером по учетной записи и что он не был изменен. Цифровые подписи проверяются частью открытого ключа маркера партнера\-сертификат подписи. После проверки подписи сервер федерации ресурсов создает собственный маркер безопасности для своей организации и подписывает маркер безопасности с помощью собственного маркера\-сертификат подписи.  
  
Для партнерских сред Федерации, когда центр сертификации выдавал маркер\-сертификат подписи, убедитесь, что:  
  
1.  Списки отзыва сертификатов \(списков отзыва сертификатов\) сертификата доступны проверяющим сторонам и веб-серверам, которые доверяют серверу федерации.  
  
2.  Сертификат корневого ЦС является доверенным для проверяющих сторон и веб-серверов, которые доверяют серверу федерации.  
  
Веб-сервер в партнере по ресурсам использует открытый ключ маркера\-сертификат подписи, чтобы убедиться, что маркер безопасности подписан сервером федерации ресурсов. Затем веб-сервер обеспечивает соответствующий доступ к клиенту.  
  
## <a name="deployment-considerations-for-token-signing-certificates"></a>Рекомендации по развертыванию\-сертификатов подписи маркеров  
При развертывании первого сервера федерации в новой установке AD FS необходимо получить маркер\-сертификат подписи и установить его в личное хранилище сертификатов локального компьютера на этом сервере федерации. Вы можете получить маркер\-сертификата для подписи, запросив его из центра сертификации предприятия или из общедоступного центра сертификации или создав самозаверяющий сертификат\-.  
  
При развертывании AD FS фермы сертификаты подписи\-устанавливаются по-разному в зависимости от способа создания фермы серверов.  
  
Существует два варианта фермы серверов, которые можно учитывать при получении маркера\-сертификатах подписи для развертывания.  
  
-   Закрытый ключ из одного маркера\-сертификат подписывания является общим для всех серверов федерации в ферме.  
  
    В среде фермы серверов федерации рекомендуется, чтобы все серверы федерации совместно использовали \(или повторно используют\) один и тот же токен\-сертификат подписи. Вы можете установить один маркер\-сертификат подписи из центра сертификации на сервере федерации, а затем экспортировать закрытый ключ, если выданный сертификат помечен как экспортируемый.  
  
    Как показано на следующем рисунке, закрытый ключ из одного маркера\-сертификат подписи может быть общим для всех серверов федерации в ферме. Этот параметр — по сравнению со следующим параметром "уникальный маркер\-подписи сертификата" — сокращает затраты, если вы планируете получить маркер\-сертификат подписи из общедоступного центра сертификации.  
  
![подпись токена](media/adfs2_fedserver_certstory_3.gif)  
  
-   Для каждого сервера федерации в ферме существует уникальный маркер\-сертификат подписи.  
  
    При использовании нескольких уникальных сертификатов в ферме каждый сервер в этой ферме подписывает токены с собственным уникальным закрытым ключом.  
  
    Как показано на следующем рисунке, можно получить отдельный маркер\-сертификат подписи для каждого отдельного сервера федерации в ферме. Этот вариант является более затратным, если вы планируете получить маркер\-сертификаты для подписи из общедоступного ЦС.  
  
![подпись токена](media/adfs2_fedserver_certstory_4.gif)  
  
Сведения об установке сертификата при использовании служб сертификации Майкрософт в качестве ЦС предприятия см. [в статье iis 7,0: создание сертификата сервера домена в iis 7,0](https://go.microsoft.com/fwlink/?LinkId=108548).  
  
Сведения об установке сертификата из общедоступного ЦС см. в разделе [IIS 7,0: запрос сертификата Интернет-сервера](https://go.microsoft.com/fwlink/?LinkId=108549).  
  
Сведения об установке самозаверяющего сертификата\-см. [в разделе iis 7,0: Создание самозаверяющего\-сертификата сервера в iis 7,0](https://go.microsoft.com/fwlink/?LinkID=108271).  
  
## <a name="see-also"></a>См. также
[Руководство по разработке служб федерации Active Directory в Windows Server 2012](AD-FS-Design-Guide-in-Windows-Server-2012.md)
