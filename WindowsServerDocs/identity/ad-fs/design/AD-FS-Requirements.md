---
ms.assetid: 8ce6e7c4-cf8e-4b55-980c-048fea28d50f
title: Ферма серверов федерации с использованием SQL Server
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 720c20437f7e6da875b809b2816f0d4df5d210d6
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71359186"
---
# <a name="ad-fs-requirements"></a>Требования AD FS

Ниже приведены различные требования, которые должны быть соблюдены при развертывании AD FS.  
  
-   [Требования к сертификатам](AD-FS-Requirements.md#BKMK_1)  
  
-   [Требования к оборудованию](AD-FS-Requirements.md#BKMK_2)  
  
-   [Требования к программному обеспечению](AD-FS-Requirements.md#BKMK_3)  
  
-   [Требования к AD DS](AD-FS-Requirements.md#BKMK_4)  
  
-   [Требования к базе данных конфигурации](AD-FS-Requirements.md#BKMK_5)  
  
-   [Требования к браузеру](AD-FS-Requirements.md#BKMK_6)  
  
-   [Требования к экстрасети](AD-FS-Requirements.md#BKMK_extranet)  
  
-   [Требования к сети](AD-FS-Requirements.md#BKMK_7)  
  
-   [Требования к хранилищу атрибутов](AD-FS-Requirements.md#BKMK_8)  
  
-   [Требования к приложениям](AD-FS-Requirements.md#BKMK_9)  
  
-   [Требования к проверке подлинности](AD-FS-Requirements.md#BKMK_10)  
  
-   [Требования к присоединению к рабочей области](AD-FS-Requirements.md#BKMK_11)  
  
-   [Требования к шифрованию](AD-FS-Requirements.md#BKMK_12)  
  
-   [Требования к разрешениям](AD-FS-Requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>Требования к сертификатам  
Сертификаты играют наиболее важную роль в защите обмена данными между серверами федерации, прокси веб-приложений, приложениями\-, поддерживающими утверждения, и веб-клиентами. Требования к сертификатам различаются в зависимости от того, выполняется ли настройка сервера федерации или прокси-компьютера, как описано в этом разделе.  
  
**Сертификаты сервера федерации**  
  
|||  
|-|-|  
|**Тип сертификата**|**Требования, поддержка & вещи**|  
|**SSL \(SSL\) -сертификат:** Это Стандартный SSL-сертификат, используемый для защиты обмена данными между серверами федерации и клиентами.|— Этот сертификат должен быть общедоступным\* доверенным сертификатом X509 v3.<br />— Все клиенты, обращающиеся к любой конечной точке AD FS, должны доверять этому сертификату. Настоятельно рекомендуется использовать \(сертификаты, выпущенные общедоступным ЦС\)\) стороннего\-центра \(сертификации. Можно успешно использовать самозаверяющий\-SSL-сертификат на серверах федерации в лабораторной тестовой среде. Однако для рабочей среды рекомендуется получить сертификат из общедоступного центра сертификации.<br />— Поддерживает любой размер ключа, поддерживаемый Windows Server 2012 R2 для SSL-сертификатов.<br />— Не поддерживает сертификаты, использующие ключи CNG.<br />При совместном использовании со службой\/регистрации устройств Workplace JOIN в качестве альтернативного имени субъекта SSL-сертификата для службы AD FS должно быть указано значение enterpriseregistration, за которым следует имя \(участника-пользователя.Суффикс\) имени участника-пользователя организации, например enterpriseregistration.contoso.com.<br />— Поддерживаются подстановочные сертификаты. При создании фермы AD FS вам будет предложено указать имя службы AD FS \(, например **ADFS.contoso.com**.<br />— Настоятельно рекомендуется использовать для прокси веб-приложения тот же сертификат SSL. При поддержке встроенных конечных точек проверки подлинности Windows с помощью прокси-приложения и при включении \(параметра\)по умолчанию расширенная проверка подлинности должна быть одинаковой.<br />— Имя субъекта этого сертификата используется для представления имени служба федерации для каждого развертываемого экземпляра AD FS. По этой причине можно выбрать имя субъекта во всех новых сертификатах, выданных центром\-сертификации, которые лучше представлять имя вашей компании или организации партнерам.<br />    Удостоверение сертификата должно соответствовать имени \(службы федерации, например FS.contoso.com.\) Удостоверение — это либо расширение альтернативного имени субъекта типа dNSName, либо, если отсутствуют записи альтернативного имени субъекта, имя субъекта указано как общее имя. В сертификате могут присутствовать несколько записей альтернативного имени субъекта, если один из них соответствует имени службы федерации.<br />-   **Важно.** настоятельно рекомендуется использовать один и тот же SSL-сертификат для всех узлов AD FS фермы, а также для всех прокси в ферме AD FS.|  
|**Сертификат связи службы:** Этот сертификат обеспечивает безопасность сообщений WCF для обеспечения безопасного взаимодействия серверов федерации.|— По умолчанию в качестве сертификата связи службы используется SSL-сертификат.  Но у вас также есть возможность настроить другой сертификат в качестве сертификата связи службы.<br />-   **Важно!** если вы используете SSL-сертификат в качестве сертификата связи службы, то по истечении срока действия SSL-сертификата обязательно настройте ПРОДЛЕНный SSL-сертификат в качестве сертификата связи службы. Это не происходит автоматически.<br />— Этот сертификат должен быть доверенным для клиентов AD FS, использующих безопасность сообщений WCF.<br />— Рекомендуется использовать сертификат проверки подлинности \(сервера, выпущенный общедоступным ЦС\)\) стороннего\-центра \(сертификации.<br />— Сертификат связи службы не может быть сертификатом, использующим ключи CNG.<br />— Управление этим сертификатом осуществляется с помощью консоли управления AD FS.|  
|**Сертификат\-для подписи маркера:** Это стандартный сертификат X509, используемый для безопасного подписания всех токенов, издаваемых сервером федерации.|— По умолчанию AD FS создает самозаверяющий\-сертификат с 2048-разрядными ключами.<br />Сертификаты, выданные ЦС, также поддерживаются и могут быть изменены с помощью оснастки\-управления AD FS в<br />— Сертификаты, выданные ЦС, должны храниться & доступа с помощью поставщика криптографии CSP.<br />— Сертификат для подписи маркера не может быть сертификатом, использующим ключи CNG.<br />-AD FS не требует наличия внешних зарегистрированных сертификатов для подписи маркеров.<br />    AD FS автоматически обновляет эти самозаверяющие\-сертификаты до истечения срока их действия, сначала настраивает новые сертификаты в качестве вторичных сертификатов, чтобы позволить партнерам использовать их, а затем переносить в основной процесс, называемый автоматическим. Смена сертификата. Для подписи маркеров рекомендуется использовать автоматически созданные сертификаты по умолчанию.<br />    Если в Организации есть политики, для которых требуется, чтобы для подписывания маркеров были настроены разные сертификаты, можно указать сертификаты во время \(установки с помощью PowerShell, используя параметр – сигнингцертификатесумбпринт установки. \-Командлет\)адфсфарм.  После установки вы можете просматривать сертификаты для подписи маркеров и управлять ими с помощью консоли управления AD FS или командлетов\-PowerShell Set AdfsCertificate\-и Get AdfsCertificate.<br />    Если для подписи маркеров используются сертификаты с внешней регистрацией, AD FS не выполняет автоматическое продление сертификата или смену ключей.  Этот процесс должен выполняться администратором.<br />    Чтобы разрешить смену сертификата, когда срок действия одного сертификата близок к истечению, можно настроить дополнительный сертификат для подписи маркера в AD FS. По умолчанию все сертификаты для подписи маркеров публикуются в метаданных федерации, но только основной сертификат\-для подписи маркера используется AD FS для фактического подписания маркеров.|  
|**Сертификат\-\/шифрования для расшифровки маркера:** Это стандартный сертификат X509, который используется для расшифровки\/шифрования всех входящих маркеров. Он также публикуется в метаданных федерации.|— По умолчанию AD FS создает самозаверяющий\-сертификат с 2048-разрядными ключами.<br />Сертификаты, выданные ЦС, также поддерживаются и могут быть изменены с помощью оснастки\-управления AD FS в<br />— Сертификаты, выданные ЦС, должны храниться & доступа с помощью поставщика криптографии CSP.<br />— Сертификат\/шифрования\-для расшифровки маркера не может быть сертификатом, использующим ключи CNG.<br />По умолчанию AD FS создает и использует собственные, созданные внутренне и самозаверяющие\-сертификаты для расшифровки маркера.  Для этой цели AD FS не требует сертификатов с внешней регистрацией.<br />    Кроме того, AD FS автоматически обновляет эти самозаверяющие\-сертификаты до истечения срока их действия.<br />    **Для расшифровки маркера рекомендуется использовать автоматически созданные сертификаты по умолчанию.**<br />    Если в Организации есть политики, для которых требуется, чтобы для расшифровки маркера были настроены разные сертификаты, можно указать сертификаты во время \(установки с помощью PowerShell, используя параметр – декриптионцертификатесумбпринт Установите\-командлет\)адфсфарм.  После установки можно просматривать сертификаты расшифровки маркеров и управлять ими с помощью консоли управления AD FS или командлетов PowerShell Set\-AdfsCertificate и Get\-AdfsCertificate.<br />    **Если для расшифровки маркера используются сертификаты с внешней регистрацией, AD FS не выполняет автоматическое продление сертификата.  Этот процесс должен выполняться администратором**.<br />— Учетная запись службы AD FS должна иметь доступ к закрытому ключу сертификата для подписи маркера\-в личном хранилище локального компьютера. Это выполняется программой установки. Вы также можете использовать оснастку\-управления AD FS в, чтобы обеспечить этот доступ, если впоследствии вы измените сертификат подписи маркера.\-|  
  
> [!CAUTION]  
> Сертификаты, используемые для подписи маркера\-и расшифровки\/маркера\-, крайне важны для стабильности служба Федерации. Клиенты, управляющие собственной\-подписью маркера\-&\/расшифровке сертификатов шифрование, должны обеспечить их резервное копирование и доступность во время события восстановления.  
  
> [!NOTE]  
> В AD FS можно изменить \(уровень SHA\) для алгоритма безопасного хэширования, который используется для цифровых подписей:\-SHA 1 или\-SHA \(256\). AD FS не поддерживает использование сертификатов с другими методами хэширования, например MD5 \(— алгоритм хэширования по умолчанию, используемый с программой\)командной\-строки Makecert. exe. По соображениям безопасности рекомендуется использовать SHA\-256 \(, который по умолчанию\) задан для всех подписей. SHA\-1 рекомендуется использовать только в сценариях, в которых необходимо взаимодействовать с продуктом, который не поддерживает обмен данными с помощью SHA\-256, например не\-в продуктах Майкрософт или в устаревших версиях AD FS.  
  
> [!NOTE]  
> После получения сертификата из центра сертификации необходимо убедиться, что все сертификаты импортированы в хранилище личных сертификатов на локальном компьютере. Сертификаты можно импортировать в личное хранилище с помощью оснастки\-MMC "сертификаты" в.  
  
## <a name="BKMK_2"></a>Требования к оборудованию  
Следующие минимальные и рекомендуемые требования к оборудованию относятся к серверам AD FS Федерации в Windows Server 2012 R2:  
  
||||  
|-|-|-|  
|**Требования к оборудованию**|**Минимальное требование**|**Рекомендуемое требование**|  
|Скорость ЦП|Процессор 1,4 ГГц\-64 bit|Четырехъядерный\-процессор с тактовой частотой 2 ГГц|  
|ОЗУ|512 МБ|4 ГБ|  
|Место на диске|32 ГБ|100 ГБ|  
  
## <a name="BKMK_3"></a>Требования к программному обеспечению  
Следующие AD FS требования предназначены для функций сервера, встроенных в операционную систему Windows Server® 2012 R2:  
  
-   Для доступа к экстрасети необходимо развернуть компонент службы роли прокси-сервера \- для служб Windows Server® 2012 R2. Предыдущие версии прокси-сервера федерации не поддерживаются AD FS в Windows Server® 2012 R2.  
  
-   Сервер федерации и служба роли прокси веб-приложения не могут быть установлены на одном компьютере.  
  
## <a name="BKMK_4"></a>Требования к AD DS  
**Требования к контроллеру домена**  
  
Контроллеры домена во всех доменах пользователей и доменах, к которым присоединены серверы AD FS, должны работать под Windows Server 2008 или более поздней версии.  
  
> [!NOTE]  
> Поддержка сред с контроллерами домена Windows Server 2003 будет завершена после даты окончания расширенной поддержки для Windows Server 2003. Клиентам настоятельно рекомендуется как можно скорее обновить контроллеры домена. Дополнительные сведения о жизненном цикле служба поддержки Майкрософт см. на [этой странице](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO) . При обнаружении проблем, характерных для сред контроллера домена Windows Server 2003, исправления будут выдаваться только для проблем безопасности и если исправление может быть выпущено до истечения срока действия расширенной поддержки Windows Server 2003.  
  
**Требования к\-функциональному уровню домена**  
  
Все домены учетных записей пользователей и домены, к которым присоединены серверы AD FS, должны работать на функциональном уровне домена Windows Server 2003 или более поздней версии.  
  
Большинство функций AD FS не требует от AD DS изменения\-функционального уровня для успешной работы. Однако для успешной аутентификации клиентских сертификатов (если сертификат явно сопоставлен учетной записи пользователя в AD DS) требуется функциональный уровень домена Windows Server 2008 или выше.  
  
**Требования к схеме**  
  
-   AD FS не требует изменения схемы или изменения функционального\-уровня для AD DS.  
  
-   Для использования Workplace Join функциональности схема леса, к которому присоединены AD FS серверы, должна быть установлена в Windows Server 2012 R2.  
  
**Требования к учетной записи службы**  
  
-   Любую стандартную учетную запись службы можно использовать в качестве учетной записи службы для AD FS. Также поддерживаются групповые управляемые учетные записи служб. Для этого требуется по крайней мере \(один контроллер домена. рекомендуется развернуть два или более\) операционные системы под Windows Server 2012 или более поздней версии.  
  
-   Чтобы проверка подлинности Kerberos функционировала между присоединенными\-к домену клиентами и AD FS, в учетной записи службы имя службы "узел\/< службу\_ADFS\_>" должно быть зарегистрировано как SPN. По умолчанию AD FS будет настроена при создании новой фермы AD FS, если она имеет достаточные разрешения для выполнения этой операции.  
  
-   Учетная запись службы AD FS должна быть доверенной в каждом домене пользователя, который содержит пользователей, прошедших проверку подлинности в службе AD FS.  
  
**Требования к домену**  
  
-   Все AD FS серверы должны быть присоединены к домену AD DS.  
  
-   Все серверы AD FS в ферме должны быть развернуты в одном домене.  
  
-   Домен, к которому присоединены серверы AD FS, должен доверять каждому домену учетной записи пользователя, содержащему пользователей, которые проходят проверку подлинности в службе AD FS.  
  
**Требования к нескольким лесам**  
  
-   Домен, к которому присоединены серверы AD FS, должен доверять каждому домену учетной записи пользователя или лесу, содержащему пользователей, которые проходят проверку подлинности в службе AD FS.  
  
-   Учетная запись службы AD FS должна быть доверенной в каждом домене пользователя, который содержит пользователей, прошедших проверку подлинности в службе AD FS.  
  
## <a name="BKMK_5"></a>Требования к базе данных конфигурации  
Ниже приведены требования и ограничения, которые применяются в зависимости от типа хранилища конфигурации.  
  
**WID**  
  
-   Ферма WID имеет ограничение в 30 серверов федерации, если у вас 100 или меньше отношений доверия проверяющей стороны.  
  
-   Профиль разрешения артефактов в SAML 2,0 не поддерживается в базе данных конфигурации WID.  Определение воспроизведения токенов не поддерживается в базе данных конфигурации WID. Эта функция используется только в сценариях, где AD FS выступает в качестве поставщика Федерации и использует маркеры безопасности от внешних поставщиков утверждений.  
  
-   Развертывание серверов AD FS в отдельных центрах обработки данных для отработки отказа или географической балансировки нагрузки поддерживается, если число серверов не превышает 30.  
  
Следующая таблица содержит сводку по использованию фермы WID.  Используйте его для планирования реализации.  
  
||||  
|-|-|-|  
||1 \- 100 доверия RP|Более 100 доверий RP|  
|1 \- 30 AD FS узлов|Поддерживается WID|Не поддерживается при использовании \- WID SQL обязательно|  
|Более 30 AD FS узлов|Не поддерживается при использовании \- WID SQL обязательно|Не поддерживается при использовании \- WID SQL обязательно|  
  
**SQL Server**  
  
Для AD FS в Windows Server 2012 R2 можно использовать SQL Server 2008 и более поздние версии.  
  
## <a name="BKMK_6"></a>Требования к браузеру  
Если проверка подлинности AD FS выполняется через браузер или элемент управления браузера, браузер должен соответствовать следующим требованиям.  
  
-   Необходимо включить JavaScript  
  
-   Файлы cookie должны быть включены  
  
-   Должен \(поддерживаться указание имени сервера SNI\)  
  
-   Для сертификата пользователя & функции \(\)присоединения к рабочему месту с помощью сертификата устройства в браузере должна поддерживаться проверка подлинности SSL-сертификата клиента.  
  
Несколько ключевых браузеров и платформ прошли проверку на предмет подготовки к просмотру и функциональности, сведения о которых перечислены ниже. Браузеры и устройства, которые не включены в эту таблицу, по-прежнему поддерживаются, если они соответствуют приведенным выше требованиям:  
  
|||  
|-|-|  
|**Версиях**|**Платформ**|  
|IE 10,0|Windows 7, Windows 8.1, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2|  
|IE 11,0|Windows7, Windows 8.1, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2|  
|Брокер веб-проверки подлинности Windows|Windows 8.1|  
|V21 \[Firefox\]|Windows 7, Windows 8.1|  
|Safari \[версии 7\]|iOS 6, Mac OS\-X 10,7|  
|Chrome \[v27\]|Windows 7, Windows 8.1, Windows Server 2012, Windows Server 2012 R2, Mac OS\-X 10,7|  
  
> [!IMPORTANT]  
> Известная \- ошибка Firefox: Функции Workplace Join, идентифицирующие устройство с помощью сертификата устройства, не работают на платформах Windows. В настоящее время Firefox не поддерживает проверку подлинности SSL-сертификата клиента с помощью сертификатов, подготовленных для хранилища сертификатов пользователей на клиентах Windows.  
  
**Сеанс**  
  
AD FS создает\-основанные на сеансах и постоянные файлы cookie, которые должны храниться на клиентских компьютерах, чтобы обеспечить вход\-,\-выход \(,\)единый вход\-и другие функциональные возможности. Следовательно, необходимо настроить клиентский браузер для приема файлов cookie. Файлы cookie, используемые для проверки подлинности, всегда \(защищают\) файлы cookie сеанса HTTPS, записанные для исходного сервера. Если клиентский браузер не настроен для поддержки этих файлов cookie, AD FS не сможет функционировать правильно. Сохраняемые файлы cookie используются для сохранения выбранного пользователем поставщика утверждений. Их можно отключить с помощью параметра конфигурации в файле конфигурации для AD FS страниц входа\-. В целях безопасности\/требуется поддержка TLS SSL.  
  
## <a name="BKMK_extranet"></a>Требования к экстрасети  
Чтобы предоставить доступ в экстрасети к службе AD FS, необходимо развернуть службу роли прокси-службы веб приложения в качестве роли, развернутой в экстрасети, которая безопасно передает запросы проверки подлинности в службу AD FS. Это обеспечивает изоляцию конечных точек службы AD FS, а также изоляцию всех ключей \(безопасности, таких как сертификаты\) для подписи маркеров, от запросов, исходящих из Интернета. Кроме того, для таких функций, как обратимая блокировка учетных записей в экстрасети, требуется использовать прокси-сервер. Дополнительные сведения о прокси веб-приложения см. в разделе [прокси веб-приложения](https://technet.microsoft.com/library/dn584107.aspx).  
  
Если вы хотите использовать третий прокси-сервер @ no__t-0party для доступа к экстрасети, этот третий прокси-сервер @ no__t-1party должен поддерживать протокол, определенный в [http: @no__t -3\/download.microsoft.com @ no__t-5download @ no__t-69 @ no__t-75 @ no__t-](https://download.microsoft.com/download/9/5/E/95EF66AF-9026-4BB0-A41D-A4F81802D92C/%5bMS-ADFSPIP%5d.pdf)8E @ no__t-995EF66AF @ no__t-109026 @ no__t-114BB0 @ no__t-12A41D  
  
## <a name="BKMK_7"></a>Требования к сети  
Правильная настройка следующих сетевых служб очень важна для успешного развертывания AD FS в Организации:  
  
**Настройка корпоративного брандмауэра**  
  
Брандмауэру, расположенному между прокси веб-приложения и фермой серверов федерации, а также брандмауэром между клиентами и прокси-приложением, должен быть включен порт TCP 443.  
  
Кроме того, если требуется проверка \(подлинности сертификата пользователя клиента проверка с использованием сертификатов\) пользователя X509, AD FS в Windows Server 2012 R2 требует включения TCP-порта 49443 в брандмауэре между Клиенты и прокси веб-приложения. Это не является обязательным в брандмауэре между прокси веб-приложения и серверами\)Федерации.  
  
**Настройка DNS**  
  
-   Для доступа к интрасети все клиенты, обращающиеся к службе AD FS в \(\) интрасети внутренней корпоративной сети, должны иметь возможность \(разрешить имя AD FS службы, предоставленное\) SSL-сертификатом для загрузки. балансировщик для AD FS серверов или сервера AD FS.  
  
-   Для доступа к экстрасети все клиенты, обращающиеся к AD FS службе извне \(экстрасети\) \/Интернет-сети, должны \(иметь возможность разрешить имя AD FS службы, предоставленное SSL-сертификатом.\) в подсистему балансировки нагрузки серверов прокси веб-приложений или сервера прокси веб-приложения.  
  
-   Для правильного доступа к экстрасети каждый сервер прокси-сервера в сети периметра должен иметь возможность разрешения имени AD FS имени \(службы, предоставленного SSL-сертификатом\) , в подсистему балансировки нагрузки для серверов AD FS или сервера AD FS. Это можно сделать с помощью альтернативного DNS-сервера в сети DMZ или путем изменения разрешения локального сервера с помощью файла HOSTs.  
  
-   Чтобы встроенная проверка подлинности Windows работала в сети и вне сети для подмножества конечных точек, доступных через прокси-приложение, необходимо использовать запись \(a, не CNAME\) , для указания подсистем балансировки нагрузки.  
  
Сведения о настройке корпоративных DNS для службы федерации и службы регистрации устройств см. в статье [Настройка корпоративных DNS для служба Федерации и DRS](https://technet.microsoft.com/library/dn486786.aspx).  
  
Сведения о настройке корпоративных DNS для прокси веб-приложений см. в разделе "Настройка DNS" раздела [шаг 1. Настройка инфраструктуры](https://technet.microsoft.com/library/dn383644.aspx)прокси веб-приложения.  
  
Сведения о том, как настроить IP-адрес кластера или полное доменное имя кластера с помощью балансировки сетевой нагрузки, см. в разделе Указание параметров кластера по адресу [\/http:\/\/go.Microsoft.com\/fwlink? LinkId\=75282](https://go.microsoft.com/fwlink/?LinkId=75282).  
  
## <a name="BKMK_8"></a>Требования к хранилищу атрибутов  
Для AD FS требуется по крайней мере одно хранилище атрибутов для проверки подлинности пользователей и извлечения утверждений безопасности для этих пользователей. Список хранилищ атрибутов, поддерживаемых AD FS, см. в разделе [роль хранилищ атрибутов](../../ad-fs/technical-reference/The-Role-of-Attribute-Stores.md).  
  
> [!NOTE]  
> По умолчанию AD FS автоматически создает хранилище атрибутов "Active Directory". Требования к хранилищу атрибутов зависят от того, выступает ли ваша организация \(в качестве партнера по\) учетным записям, где размещаются Федеративные\)пользователи, или партнера \(по ресурсам, в котором размещено федеративное приложение  
  
**Хранилища атрибутов LDAP**  
  
При работе с другими хранилищами атрибутов на основе \(LDAP\)\-с доступом к каталогу Active Directory необходимо подключиться к серверу LDAP, поддерживающему встроенную проверку подлинности Windows. Строка подключения LDAP должна записываться в формате URL-адреса LDAP в соответствии со стандартом RFC 2255.  
  
Также требуется, чтобы учетная запись службы для службы AD FS была иметь право на получение сведений о пользователях в хранилище атрибутов LDAP.  
  
**SQL Server хранилищами атрибутов**  
  
Для успешной работы AD FS в Windows Server 2012 R2 компьютеры, на которых размещается хранилище атрибутов SQL Server, должны работать под управлением Microsoft SQL Server 2008 или более поздней версии. При работе с хранилищами\-атрибутов на основе SQL также необходимо настроить строку подключения.  
  
**Пользовательские хранилища атрибутов**  
  
Хранилища настраиваемых атрибутов позволяют реализовывать более сложные сценарии.  
  
-   Язык политик, интегрированный в AD FS, может ссылаться на хранилища настраиваемых атрибутов, тем самым расширяя возможности перечисленных ниже сценариев.  
  
    -   Создание утверждений для прошедшего локальную аутентификацию пользователя  
  
    -   Добавление утверждений для прошедшего внешнюю аутентификацию пользователя  
  
    -   Авторизация пользователя на получение токена  
  
    -   Авторизация службы на получение токена для поведения пользователя  
  
    -   Выдача дополнительных данных в маркерах безопасности, выдаваемых AD FS проверяющим сторонам.  
  
-   Все хранилища настраиваемых атрибутов должны быть построены на основе .NET 4,0 или более поздней версии.  
  
При работе с хранилищем настраиваемых атрибутов может также потребоваться настроить строку подключения. В этом случае можно ввести произвольный код, который позволяет подключиться к хранилищу настраиваемых атрибутов. Строка подключения в этой ситуации представляет собой набор пар «имя\/-значение», интерпретируемый разработчиком пользовательского хранилища атрибутов. Дополнительные сведения о разработке и использовании настраиваемых хранилищ атрибутов см. в разделе [Общие сведения о хранилище атрибутов](https://go.microsoft.com/fwlink/?LinkId=190782).  
  
## <a name="BKMK_9"></a>Требования к приложениям  
AD FS поддерживает приложения\-с поддержкой утверждений, которые используют следующие протоколы:  
  
-   WS\-Federation  
  
-   Доверие\-WS  
  
-   Протокол SAML 2,0, использующий Идплите, разделите профили & егов 1.5.  
  
-   Профиль предоставления авторизации OAuth 2,0  
  
AD FS также поддерживает проверку подлинности и авторизацию\-для любых приложений, не\-поддерживающих утверждения, которые поддерживаются прокси-службой.  
  
## <a name="BKMK_10"></a>Требования к проверке подлинности  
**\(Первичная проверка подлинности AD DS\)**  
  
Для доступа к интрасети поддерживаются следующие стандартные механизмы проверки подлинности для AD DS.  
  
-   Встроенная проверка подлинности Windows с помощью Negotiate для Kerberos & NTLM  
  
-   Проверка подлинности\/с помощью форм с использованием пароля пользователя  
  
-   Проверка подлинности сертификата с помощью сертификатов, сопоставленных учетным записям пользователей в AD DS  
  
Для доступа к экстрасети поддерживаются следующие механизмы проверки подлинности:  
  
-   Проверка подлинности\/с помощью форм с использованием пароля пользователя  
  
-   Проверка подлинности сертификата с помощью сертификатов, сопоставленных с учетными записями пользователей в AD DS  
  
-   Встроенная проверка подлинности Windows\) с использованием\-Negotiate \(NTLM только для конечных точек WS Trust, которые принимают встроенную проверку подлинности  
  
Для проверки подлинности сертификата:  
  
-   Расширяется на SmartCards, который может быть защищен ПИН-кодом.  
  
-   Графический интерфейс пользователя для ввода ПИН-кода не предоставляется AD FS и должен быть частью клиентской операционной системы, которая отображается при использовании клиентского TLS.  
  
-   Модуль чтения и CSP \(\) поставщика службы шифрования для смарт-карты должны работать на компьютере, где находится браузер.  
  
-   Сертификат смарт-карты должен быть связан с доверенным корневым каталогом на всех AD FS серверах и прокси-серверах веб приложения.  
  
-   Сертификат должен сопоставляться с учетной записью пользователя в AD DS одним из следующих методов.  
  
    -   Имя субъекта сертификата соответствует различающемуся имени LDAP учетной записи пользователя в AD DS.  
  
    -   Расширение алтнаме субъекта сертификата имеет имя \(участника-пользователя UPN\) учетной записи пользователя в AD DS.  
  
Для простой встроенной проверки подлинности Windows с помощью Kerberos в интрасети  
  
-   Необходимо, чтобы имя службы было частью доверенных сайтов или сайтов локальной интрасети.  
  
-   Кроме того, в учетной записи службы\_, на которой работает ферма AD FS, должно быть задано имя службы < узла\/служб ADFS\_> SPN.  
  
**\-Многофакторная проверка подлинности**  
  
AD FS поддерживает дополнительную проверку \(подлинности по сравнению\) с основной проверкой подлинности, поддерживаемой AD DS помощью\-модели поставщика\/, в которой клиенты могут создавать собственные адаптеры многофакторной идентификации. Администратор может зарегистрироваться и использовать во время входа.  
  
Каждый адаптер MFA должен быть построен на основе .NET 4,5.  
  
Дополнительные сведения о MFA см. в статье [Управление рисками с помощью дополнительной многофакторной проверки подлинности для конфиденциальных приложений](../../ad-fs/operations/Manage-Risk-with-Additional-Multi-Factor-Authentication-for-Sensitive-Applications.md).  
  
**Проверка подлинности устройства**  
  
AD FS поддерживает проверку подлинности устройства с помощью сертификатов, подготовленных службой регистрации устройств в ходе рабочего места конечного пользователя, присоединенного к устройству.  
  
## <a name="BKMK_11"></a>Требования к присоединению к рабочей области  
Конечные пользователи могут присоединять свои устройства к Организации с помощью AD FS. Эта служба поддерживается службой регистрации устройств в AD FS. В результате конечные пользователи получают дополнительное преимущество единого входа для приложений, поддерживаемых AD FS. Кроме того, администраторы могут управлять рисками, запретив доступ к приложениям только тем устройствам, которые были присоединены к Организации. Ниже приведены требования для включения этого сценария.  
  
-   AD FS поддерживает присоединение к рабочей области для устройств\+ Windows 8.1 и iOS 5  
  
-   Чтобы использовать функции Workplace Join, схема леса, к которой присоединены AD FS серверы, должна быть Windows Server 2012 R2.  
  
-   Альтернативное имя субъекта SSL-сертификата для службы AD FS должно содержать значение enterpriseregistration, за которым следует суффикс UPN \(\) имени участника-пользователя вашей организации, например enterpriseregistration.corp.contoso.com.  
  
## <a name="BKMK_12"></a>Требования к шифрованию  
В следующей таблице приведены дополнительные сведения о поддержке криптографии для подписи маркеров AD FS, функции\/расшифровки шифрования маркеров.  
  
||||  
|-|-|-|  
|**Microsof**|**Длина ключей**|**Комментарии\/к\/приложениям протоколов**|  
|TripleDES — по умолчанию 192 \(поддерживаемые 192 – 256 \- \) [http:\/\/\/\/\/www.w3.org 2001 04 ксмленкTripleDES\#CBC\-](http://www.w3.org/2001/04/xmlenc#tripledes-cbc)|>\=192|Поддерживаемый алгоритм для расшифровки маркера безопасности. Шифрование маркера безопасности с помощью этого алгоритма не поддерживается.|  
|AES128 \- [http:\/www.w3.org\/200104\/ксмленкAES128\#CBC\/\/\-](http://www.w3.org/2001/04/xmlenc#aes128-cbc)|128|Поддерживаемый алгоритм для расшифровки маркера безопасности. Шифрование маркера безопасности с помощью этого алгоритма не поддерживается.|  
|Aes192 \- [http:\/www.w3.org\/200104\/ксмленкAes192\#CBC\/\/\-](http://www.w3.org/2001/04/xmlenc#aes192-cbc)|192|Поддерживаемый алгоритм для расшифровки маркера безопасности. Шифрование маркера безопасности с помощью этого алгоритма не поддерживается.|  
|AES256 \- [http:\/www.w3.org\/200104\/ксмленкAES256\#CBC\/\/\-](http://www.w3.org/2001/04/xmlenc#aes256-cbc)|256|**По умолчанию**. Поддерживаемый алгоритм шифрования маркера безопасности.|  
|Трипледескэйврап \- [http:\/www.w3.org\/200104\/ксмленккВт*\#TripleDES\/\/\-](http://www.w3.org/2001/04/xmlenc#kw-tripledes)|Все размеры ключей, поддерживаемые .NET 4,0\+|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|AES128KeyWrap \- [http:\/www.w3.org\/200104\/ксмленккВт\#AES128\/\/\-](http://www.w3.org/2001/04/xmlenc#kw-aes128)|128|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|AES192KeyWrap \- [http:\/www.w3.org\/200104\/ксмленккВт\#Aes192\/\/\-](http://www.w3.org/2001/04/xmlenc#kw-aes192)|192|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|AES256KeyWrap \- [http:\/www.w3.org\/200104\/ксмленккВт\#AES256\/\/\-](http://www.w3.org/2001/04/xmlenc#kw-aes256)|256|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|RsaV15KeyWrap \- [http:\/www.w3.org\/200104\/ксмленкRSA1\-5\/\/\#\_](http://www.w3.org/2001/04/xmlenc#rsa-1_5)|1024|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|Рсаоаепкэйврап \- [http:\/www.w3.org\/200104\/ксмленкRSAOAEP\-mgf1p\/\/\#\-](http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p)|1024|По умолчанию. Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|SHA1\-[http:\/www.w3.org\/picsдсиг\/SHA110.\_HTML\/\/\_](http://www.w3.org/PICS/DSig/SHA1_1_0.html)|N\/A|Используется сервером AD FS в создании SourceId артефакта:  В этом сценарии STS использует SHA1 \(согласно рекомендации в стандарте\) SAML 2,0, чтобы создать короткое 160-разрядное значение для sourceiD артефакта.<br /><br />Также используется устаревшим компонентом веб \(-агента ADFS из\) WS2003, чтобы определить изменения в значении времени последнего обновления, чтобы оно знало, когда следует обновлять информацию от STS.|  
|SHA1withRSA\-<br /><br />[http:\/\/www.w3.orgpicsдсиг\/RSA SHA1 10\_. HTML\-\/\/\_](http://www.w3.org/PICS/DSig/RSA-SHA1_1_0.html)|N\/A|Используется в случаях, когда AD FS Server проверяет подпись SAML аусентикатионрекуест, подписывание запроса на разрешение артефакта или ответа, создание сертификата\-для подписи маркера.<br /><br />В таких случаях SHA256 используется по умолчанию, а SHA1 используется только в том случае, \(если проверяющая\) сторона партнера не поддерживает SHA256 и должна использовать SHA1.|  
  
## <a name="BKMK_13"></a>Требования к разрешениям  
Администратор, выполняющий установку и начальную настройку AD FS, должен иметь разрешения администратора домена в локальном домене \(другими словами, домен, к которому присоединен сервер федерации.\)  
  
## <a name="see-also"></a>См. также  
[Руководство по разработке служб федерации Active Directory в Windows Server 2012 R2](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)  
  

