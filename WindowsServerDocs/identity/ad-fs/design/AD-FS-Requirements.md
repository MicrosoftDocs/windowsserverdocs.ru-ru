---
ms.assetid: 8ce6e7c4-cf8e-4b55-980c-048fea28d50f
title: Ферма серверов федерации с использованием SQL Server
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: b299ddc823b3fbbd5818f96202e3c01faf0762d7
ms.sourcegitcommit: 0a0a45bec6583162ba5e4b17979f0b5a0c179ab2
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2020
ms.locfileid: "79323106"
---
# <a name="ad-fs-requirements"></a>Требования AD FS

Ниже приведены различные требования, которые должны быть соблюдены при развертывании AD FS.  
  
-   [Требования к сертификатам](AD-FS-Requirements.md#BKMK_1)  
  
-   [Требования к оборудованию](AD-FS-Requirements.md#BKMK_2)  
  
-   [Требования к программному обеспечению](AD-FS-Requirements.md#BKMK_3)  
  
-   [Требования к AD DS](AD-FS-Requirements.md#BKMK_4)  
  
-   [Требования к базе данных конфигурации](AD-FS-Requirements.md#BKMK_5)  
  
-   [Требования к браузерам](AD-FS-Requirements.md#BKMK_6)  
  
-   [Требования к экстрасети](AD-FS-Requirements.md#BKMK_extranet)  
  
-   [Сетевые требования](AD-FS-Requirements.md#BKMK_7)  
  
-   [Требования к хранилищу атрибутов](AD-FS-Requirements.md#BKMK_8)  
  
-   [Требования к приложениям](AD-FS-Requirements.md#BKMK_9)  
  
-   [Требования к проверке подлинности](AD-FS-Requirements.md#BKMK_10)  
  
-   [Требования к присоединению к рабочей области](AD-FS-Requirements.md#BKMK_11)  
  
-   [Требования к шифрованию](AD-FS-Requirements.md#BKMK_12)  
  
-   [Требования к разрешениям](AD-FS-Requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>Требования к сертификатам  
Сертификаты играют наиболее важную роль в защите обмена данными между серверами федерации, прокси веб-приложений, утверждениями,\-приложениями, а также веб-клиентами. Требования к сертификатам различаются в зависимости от того, выполняется ли настройка сервера федерации или прокси-компьютера, как описано в этом разделе.  
  
**Сертификаты сервера федерации**  
  
|||  
|-|-|  
|**Тип сертификата**|**Требования, поддержка & вещи**|  
|**SSL \(сертификат\) SSL:** Это Стандартный SSL-сертификат, используемый для защиты обмена данными между серверами федерации и клиентами.|— Этот сертификат должен быть общедоступным доверенным\* сертификатом X509 v3.<br />— Все клиенты, обращающиеся к любой конечной точке AD FS, должны доверять этому сертификату. Настоятельно рекомендуется использовать сертификаты, выданные общедоступной \(третьим\-\) центром сертификации \(ЦС\). Вы можете успешно использовать самозаверяющий\-сертификат SSL на серверах федерации в тестовой лабораторной среде. Однако для рабочей среды рекомендуется получить сертификат из общедоступного центра сертификации.<br />— Поддерживает любой размер ключа, поддерживаемый Windows Server 2012 R2 для SSL-сертификатов.<br />— Не поддерживает сертификаты, использующие ключи CNG.<br />При использовании совместно с Workplace Join службы регистрации устройств\/. Альтернативное имя субъекта SSL-сертификата для службы AD FS должно содержать значение enterpriseregistration, за которым следует имя участника-пользователя \(UPN\) суффикса вашей организации, например enterpriseregistration.contoso.com.<br />— Поддерживаются подстановочные сертификаты. При создании фермы AD FS вам будет предложено указать имя службы для службы AD FS \(например, **ADFS.contoso.com**.<br />— Настоятельно рекомендуется использовать для прокси веб-приложения тот же сертификат SSL. При поддержке встроенных конечных точек проверки подлинности Windows с помощью прокси веб-приложения и при включении расширенной проверки подлинности \(\)параметр по умолчанию **, он должен** быть одинаковым.<br />— Имя субъекта этого сертификата используется для представления имени служба федерации для каждого развертываемого экземпляра AD FS. По этой причине можно выбрать имя субъекта на любом новом ЦС\-выданных сертификатов, которые лучше представлять имя вашей компании или организации партнерам.<br />    Удостоверение сертификата должно соответствовать имени службы федерации \(например, fs.contoso.com\). Удостоверение — это либо расширение альтернативного имени субъекта типа dNSName, либо, если отсутствуют записи альтернативного имени субъекта, имя субъекта указано как общее имя. В сертификате могут присутствовать несколько записей альтернативного имени субъекта, если один из них соответствует имени службы федерации.<br />-   **важно.** настоятельно рекомендуется использовать один и тот же SSL-сертификат для всех узлов фермы AD FS, а также для всех прокси в ферме AD FS.|  
|**Сертификат связи службы:** Этот сертификат обеспечивает безопасность сообщений WCF для защиты обмена данными между серверами федерации.|— По умолчанию в качестве сертификата связи службы используется SSL-сертификат.  Но у вас также есть возможность настроить другой сертификат в качестве сертификата связи службы.<br />-   **важно.** если SSL-сертификат используется в качестве сертификата связи службы, то после истечения срока действия SSL-сертификата необходимо настроить ПРОДЛЕНный SSL-сертификат в качестве сертификата связи службы. Это не происходит автоматически.<br />— Этот сертификат должен быть доверенным для клиентов AD FS, использующих безопасность сообщений WCF.<br />— Рекомендуется использовать сертификат проверки подлинности сервера, выданный общедоступным \(третьим\-\) центре сертификации \(ЦС\).<br />— Сертификат связи службы не может быть сертификатом, использующим ключи CNG.<br />— Управление этим сертификатом осуществляется с помощью консоли управления AD FS.|  
|**Сертификат\-подписи токена:** Это стандартный сертификат X509, который используется для безопасной подписи всех токенов, которые выдает сервер федерации.|По умолчанию AD FS создает самозаверяющий сертификат\-с 2048-битным ключом.<br />Сертификаты, выданные ЦС, также поддерживаются и могут быть изменены с помощью оснастки управления AD FS\-в<br />— Сертификаты, выданные ЦС, должны храниться & доступа с помощью поставщика криптографии CSP.<br />— Сертификат для подписи маркера не может быть сертификатом, использующим ключи CNG.<br />-AD FS не требует наличия внешних зарегистрированных сертификатов для подписи маркеров.<br />    AD FS автоматически обновляет эти самозаверяющие\-подписанные сертификаты до истечения срока их действия, сначала настраивает новые сертификаты в качестве вторичных сертификатов, чтобы позволить партнерам использовать их, а затем переключается на первичный процесс в процессе, который называется автоматической сменой сертификатов. Для подписи маркеров рекомендуется использовать автоматически созданные сертификаты по умолчанию.<br />    Если в Организации есть политики, для которых требуется, чтобы для подписывания маркеров были настроены разные сертификаты, можно указать сертификаты во время установки с помощью PowerShell \(используйте параметр – Сигнингцертификатесумбпринт командлета Install\-Адфсфарм\).  После установки можно просматривать сертификаты для подписи маркеров и управлять ими с помощью консоли управления AD FS или командлетов PowerShell, настроенных\-AdfsCertificate и Get\-AdfsCertificate.<br />    Если для подписи маркеров используются сертификаты с внешней регистрацией, AD FS не выполняет автоматическое продление сертификата или смену ключей.  Этот процесс должен выполняться администратором.<br />    Чтобы разрешить смену сертификата, когда срок действия одного сертификата близок к истечению, можно настроить дополнительный сертификат для подписи маркера в AD FS. По умолчанию все сертификаты для подписи маркеров публикуются в метаданных федерации, но только основной маркер\-сертификат подписи используется AD FS для фактического подписывания маркеров.|  
|**\/сертификата шифрования токена\-:** Это стандартный сертификат X509, который используется для расшифровки\/шифрования всех входящих токенов. Он также публикуется в метаданных федерации.|По умолчанию AD FS создает самозаверяющий сертификат\-с 2048-битным ключом.<br />Сертификаты, выданные ЦС, также поддерживаются и могут быть изменены с помощью оснастки управления AD FS\-в<br />— Сертификаты, выданные ЦС, должны храниться & доступа с помощью поставщика криптографии CSP.<br />— Токен\-расшифровки\/сертификат шифрования не может быть сертификатом, использующим ключи CNG.<br />По умолчанию AD FS создает и использует собственные, созданные внутренне и само\-подписанные сертификаты для расшифровки маркера.  Для этой цели AD FS не требует сертификатов с внешней регистрацией.<br />    Кроме того, AD FS автоматически обновляет эти самозаверяющие\-подписанные сертификаты до истечения срока их действия.<br />    **Для расшифровки маркера рекомендуется использовать автоматически созданные сертификаты по умолчанию.**<br />    Если в Организации есть политики, для которых требуется, чтобы для расшифровки маркера были настроены разные сертификаты, можно указать сертификаты во время установки с помощью PowerShell \(используйте параметр – Декриптионцертификатесумбпринт командлета Install\-Адфсфарм\).  После установки можно просматривать сертификаты расшифровки маркеров и управлять ими с помощью консоли управления AD FS или командлетов PowerShell, настроенных\-AdfsCertificate и Get\-AdfsCertificate.<br />    **Если для расшифровки маркера используются сертификаты с внешней регистрацией, AD FS не выполняет автоматическое продление сертификата.  Этот процесс должен выполняться администратором**.<br />— Учетная запись службы AD FS должна иметь доступ к маркеру\-закрытый ключ сертификата подписи в личном хранилище локального компьютера. Это выполняется программой установки. Вы также можете использовать\-оснастки управления AD FS в, чтобы обеспечить этот доступ при последующем изменении маркера\-сертификата подписи.|  
  
> [!CAUTION]  
> Сертификаты, используемые для\-подписи и шифрования/расшифровки\-токенов,\/играют критически важную роль для стабильности службы федерации. Клиенты, которые самостоятельно управляют сертификатами для\-подписи маркера и (или) для \-шифрования/расшифровки сертификатов,\/должны обеспечить их резервное копирование и независимую доступность во время событий восстановления.  
  
> [!NOTE]  
> В AD FS можно изменить \(алгоритм SHA\), используемый для цифровых подписей с помощью SHA\-1 или SHA\-256 \(более безопасным\). AD FS не поддерживает использование сертификатов с другими методами хэширования, например MD5 \(алгоритма хэширования по умолчанию, который используется со средством командной\-Line для Makecert. exe\). Для обеспечения безопасности рекомендуется использовать SHA\-256 \(который по умолчанию установлен в\) для всех подписей. SHA\-1 рекомендуется использовать только в сценариях, в которых необходимо взаимодействовать с продуктом, который не поддерживает обмен данными с помощью SHA\-256, например, не\-продуктов Майкрософт или устаревших версий AD FS.  
  
> [!NOTE]  
> После получения сертификата из центра сертификации необходимо убедиться, что все сертификаты импортированы в хранилище личных сертификатов на локальном компьютере. Сертификаты можно импортировать в личное хранилище с помощью оснастки MMC "сертификаты"\-в.  
  
## <a name="BKMK_2"></a>Требования к оборудованию  
Следующие минимальные и рекомендуемые требования к оборудованию относятся к серверам AD FS Федерации в Windows Server 2012 R2:  
  
||||  
|-|-|-|  
|**Требования к оборудованию**|**Минимальное значение**|**Рекомендуемое значение**|  
|Скорость ЦП|1,4 ГГц 64\-разрядный процессор|Четырехъядерный\-Core, 2 ГГц|  
|ОЗУ|512 МБ|4 ГБ|  
|Место на диске|32 ГБ|100 ГБ|  
  
## <a name="BKMK_3"></a>Требования к программному обеспечению  
Следующие AD FS требования предназначены для функций сервера, встроенных в операционную систему Windows Server® 2012 R2:  
  
-   Для доступа к экстрасети необходимо развернуть службу роли прокси веб-приложения \- части роли сервера удаленного доступа Windows Server® 2012 R2. Предыдущие версии прокси-сервера федерации не поддерживаются AD FS в Windows Server® 2012 R2.  
  
-   Сервер федерации и служба роли прокси-службы веб-приложений не могут быть установлены на одном компьютере.  
  
## <a name="BKMK_4"></a>Требования к AD DS  
**Требования к контроллеру домена**  
  
Контроллеры домена во всех доменах пользователей и доменах, к которым присоединены серверы AD FS, должны работать под Windows Server 2008 или более поздней версии.  
  
> [!NOTE]  
> Поддержка сред с контроллерами домена Windows Server 2003 будет завершена после даты окончания расширенной поддержки для Windows Server 2003. Клиентам настоятельно рекомендуется как можно скорее обновить контроллеры домена. Дополнительные сведения о жизненном цикле служба поддержки Майкрософт см. на [этой странице](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO) . При обнаружении проблем, характерных для сред контроллера домена Windows Server 2003, исправления будут выдаваться только для проблем безопасности и если исправление может быть выпущено до истечения срока действия расширенной поддержки Windows Server 2003.  



>[!NOTE]
> Для работы AD FS требуется контроллер домена с возможностью записи в отличие от контроллера домена, доступного только для чтения. Если запланированная топология включает контроллер домена только для чтения, для проверки подлинности можно использовать контроллер домена только для чтения, но для обработки утверждений LDAP потребуется подключение к контроллеру домена с возможностью записи.
  
**Требования к функциональному уровню домена\-  
  
Все домены учетных записей пользователей и домены, к которым присоединяются серверы AD FS, должны работать на функциональном уровне домена Windows Server 2003 или более поздней версии.  
  
Для успешной работы большинство функций AD FS не требует AD DS изменения функциональных\-уровня. Однако для успешной аутентификации клиентских сертификатов (если сертификат явно сопоставлен учетной записи пользователя в AD DS) требуется функциональный уровень домена Windows Server 2008 или выше.  
  
**Требования к схеме**  
  
-   AD FS не требует изменения схемы или функциональных изменений уровня\-для AD DS.  
  
-   Для использования Workplace Join функциональности схема леса, к которому присоединены AD FS серверы, должна быть установлена в Windows Server 2012 R2.  
  
**Требования к учетным записям служб**  
  
-   Любую стандартную учетную запись службы можно использовать в качестве учетной записи службы для AD FS. Поддерживаются также групповые управляемые учетные записи служб. Для этого требуется по крайней мере один контроллер домена \(рекомендуется развернуть два или более\), работающих под Windows Server 2012 или более поздней версии.  
  
-   Для проверки подлинности Kerberos между доменами, присоединенными к домену\-и AD FS, узел\/< ADFS\_Service\_name > "должен быть зарегистрирован как имя СУБЪЕКТа-службы в учетной записи служб. По умолчанию AD FS будет настроена при создании новой фермы AD FS, если она имеет достаточные разрешения для выполнения этой операции.  
  
-   Учетная запись службы AD FS должна быть доверенной в каждом домене пользователя, который содержит пользователей, прошедших проверку подлинности в службе AD FS.  
  
**Требования к домену**  
  
-   Все серверы AD FS должны быть присоединены к домену AD DS.  
  
-   Все серверы AD FS в ферме должны быть развернуты в одном домене.  
  
-   Домен, к которому присоединены серверы AD FS, должен доверять каждому домену учетной записи пользователя, содержащему пользователей, которые проходят проверку подлинности в службе AD FS.  
  
**Требования к нескольким лесам**  
  
-   Домен, к которому присоединены серверы AD FS, должен доверять каждому домену учетной записи пользователя или лесу, содержащему пользователей, которые проходят проверку подлинности в службе AD FS.  
  
-   Учетная запись службы AD FS должна быть доверенной в каждом домене пользователя, который содержит пользователей, прошедших проверку подлинности в службе AD FS.  
  
## <a name="BKMK_5"></a>Требования к базе данных конфигурации  
Ниже приведены требования и ограничения, которые применяются в зависимости от типа хранилища конфигурации.  
  
**WID**  
  
-   Ферма WID имеет ограничение в 30 серверов федерации, если у вас 100 или меньше отношений доверия проверяющей стороны.  
  
-   Профиль разрешения артефактов в SAML 2,0 не поддерживается в базе данных конфигурации WID.  Определение воспроизведения токенов не поддерживается в базе данных конфигурации WID. Эта функция используется только в сценариях, где AD FS выступает в качестве поставщика Федерации и использует маркеры безопасности от внешних поставщиков утверждений.  
  
-   Развертывание серверов AD FS в отдельных центрах обработки данных для отработки отказа или географической балансировки нагрузки поддерживается, если число серверов не превышает 30.  
  
Следующая таблица содержит сводку по использованию фермы WID.  Используйте его для планирования реализации.  
  
||||  
|-|-|-|  
||1 \- 100 отношений доверия RP|Более 100 доверий RP|  
|1 \- 30 AD FS узлов|Поддерживается для WID|Не поддерживается с использованием WID \- требуется SQL|  
|Более 30 AD FS узлов|Не поддерживается с использованием WID \- требуется SQL|Не поддерживается с использованием WID \- требуется SQL|  
  
**SQL Server**  
  
Для AD FS в Windows Server 2012 R2 можно использовать SQL Server 2008 и более поздние версии.  
  
## <a name="BKMK_6"></a>Требования к браузерам  
Если проверка подлинности AD FS выполняется через браузер или браузерный элемент управления, этот браузер должен соответствовать следующим требованиям.  
  
-   Должно быть разрешено выполнение JavaScript.  
  
-   Файлы cookie должны быть включены  
  
-   Должен поддерживаться индикатор имени сервера (\(SNI\)).  
  
-   Для сертификата пользователя & аутентификация сертификата устройства \(функция присоединения к рабочему месту\), браузер должен поддерживать проверку подлинности SSL-сертификата клиента.  
  
Несколько ключевых браузеров и платформ прошли проверку на предмет подготовки к просмотру и функциональности, сведения о которых перечислены ниже. Браузеры и устройства, которые не включены в эту таблицу, по-прежнему поддерживаются, если они соответствуют приведенным выше требованиям:  
  
|||  
|-|-|  
|**Версиях**|**Платформ**|  
|IE 10,0|Windows 7, Windows 8.1, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2|  
|IE 11,0|Windows7, Windows 8.1, Windows Server 2008 R2, Windows Server 2012, Windows Server 2012 R2|  
|Брокер веб-проверки подлинности Windows|Windows 8.1|  
|Firefox \[V21\]|Windows 7, Windows 8.1|  
|Safari \[версии 7\]|iOS 6, Mac OS\-X 10,7|  
|Chrome \[v27\]|Windows 7, Windows 8.1, Windows Server 2012, Windows Server 2012 R2, Mac OS\-X 10,7|  
  
> [!IMPORTANT]  
> Известная ошибка \- Firefox: функции Workplace Join, идентифицирующие устройство с помощью сертификата устройства, не работают на платформах Windows. В настоящее время Firefox не поддерживает проверку подлинности SSL-сертификата клиента с помощью сертификатов, подготовленных для хранилища сертификатов пользователей на клиентах Windows.  
  
**Сеанс**  
  
AD FS создает\-сеанса на основе и постоянные файлы cookie, которые должны храниться на клиентских компьютерах, чтобы обеспечить вход\-, подписывать\-, единый вход\-в \(единого входа\)и другие функциональные возможности. Следовательно, необходимо настроить клиентский браузер для приема файлов cookie. Файлы cookie, используемые для проверки подлинности, всегда имеют защищенный протокол HTTP \(HTTPS\) сеансовые файлы cookie, записанные для сервера источника. Если клиентский браузер не настроен для поддержки этих файлов cookie, AD FS не сможет функционировать правильно. Сохраняемые файлы cookie используются для сохранения выбранного пользователем поставщика утверждений. Их можно отключить с помощью параметра конфигурации в файле конфигурации для AD FS знака\-на страницах. В целях безопасности требуется поддержка TLS\/SSL.  
  
## <a name="BKMK_extranet"></a>Требования к экстрасети  
Чтобы предоставить доступ в экстрасети к службе AD FS, необходимо развернуть службу роли прокси-службы веб приложения в качестве роли, развернутой в экстрасети, которая безопасно передает запросы проверки подлинности в службу AD FS. Это обеспечивает изоляцию конечных точек службы AD FS, а также изоляцию всех ключей безопасности \(таких как сертификаты подписи маркера\) от запросов, полученных из Интернета. Кроме того, для таких функций, как обратимая блокировка учетных записей в экстрасети, требуется использовать прокси-сервер. Дополнительные сведения о прокси веб-приложения см. в разделе [прокси веб-приложения](https://technet.microsoft.com/library/dn584107.aspx).  
  
Если вы хотите использовать третий прокси-сервер субъекта\-для доступа к экстрасети, этот третий прокси-сервер\-должен поддерживать протокол, определенный в [http:\/\/download.microsoft.com\/download\/9\/5\/E\/95EF66AF\-9026\-4BB0\-A41D\-A4F81802D92C\/% 5bMS\-адфспип %5 d. PDF](https://download.microsoft.com/download/9/5/E/95EF66AF-9026-4BB0-A41D-A4F81802D92C/%5bMS-ADFSPIP%5d.pdf).  
  
## <a name="BKMK_7"></a>Требования к сети  
Правильная настройка следующих сетевых служб очень важна для успешного развертывания AD FS в Организации:  
  
**Настройка корпоративного брандмауэра**  
  
На брандмауэрах, которые расположены между прокси-службой веб-приложений и фермой серверов федерации, а также между клиентами и прокси-службой веб-приложений, должен быть открыт порт TCP 443 для входящих подключений.  
  
Кроме того, если требуется проверка подлинности на основе сертификата пользователя клиента \(проверка проверку подлинности с помощью сертификатов пользователя X509\), AD FS в Windows Server 2012 R2 требует, чтобы TCP-порт 49443 был включен в брандмауэре на межсетевом экране между клиентами и прокси приложения. Это не является обязательным для брандмауэра между прокси-службой веб-приложений и серверами федерации\).  

> [!NOTE]
> также убедитесь, что порт 49443 не используется какими-либо другими службами на AD FS и прокси-сервере веб – приложения.

**Настройка DNS**  
  
-   Для доступа к интрасети все клиенты, обращающиеся к AD FS службе внутри внутренней корпоративной сети \(\) интрасети, должны иметь возможность разрешить имя \(AD FS службы, предоставленное\) SSL-сертификатом, в подсистему балансировки нагрузки для серверов AD FS или сервера AD FS.  
  
-   Для доступа к экстрасети все клиенты, обращающиеся к AD FSным службам извне корпоративной сети \(экстрасеть\/Интернет-\), должны иметь возможность разрешить AD FS имя \(службы, предоставленное\) SSL-сертификатом, в подсистему балансировки нагрузки серверов прокси или прокси веб-приложения.  
  
-   Чтобы доступ к экстрасети функционировал правильно, каждый сервер прокси-сервера в сети периметра должен иметь возможность разрешения имени AD FS службы \(имени, предоставленного SSL-сертификатом,\) подсистеме балансировки нагрузки для серверов AD FS или сервера AD FS. Это можно сделать с помощью альтернативного DNS-сервера в сети DMZ или путем изменения разрешения локального сервера с помощью файла HOSTs.  
  
-   Чтобы встроенная проверка подлинности Windows работала в сети и вне сети для подмножества конечных точек, доступных через прокси-приложение, необходимо использовать запись A \(не CNAME\), чтобы указывать на подсистемы балансировки нагрузки.  
  
Сведения о настройке корпоративных DNS для службы федерации и службы регистрации устройств см. в статье [Настройка корпоративных DNS для служба Федерации и DRS](https://technet.microsoft.com/library/dn486786.aspx).  
  
Сведения о настройке корпоративных DNS для прокси веб-приложений см. в подразделе "Настройка DNS" раздела [Шаг 1. Настройка инфраструктуры прокси-сервера приложений](https://technet.microsoft.com/library/dn383644.aspx).  
  
Сведения о том, как настроить IP-адрес кластера или полное доменное имя кластера с помощью балансировки сетевой нагрузки, см. в разделе Указание параметров кластера по адресу [http:\/\/go.microsoft.com\/fwlink\/? LinkId\=75282](https://go.microsoft.com/fwlink/?LinkId=75282).  
  
## <a name="BKMK_8"></a>Требования к хранилищу атрибутов  
Для AD FS требуется по крайней мере одно хранилище атрибутов для проверки подлинности пользователей и извлечения утверждений безопасности для этих пользователей. Список хранилищ атрибутов, поддерживаемых AD FS, см. в разделе [роль хранилищ атрибутов](../../ad-fs/technical-reference/The-Role-of-Attribute-Stores.md).  
  
> [!NOTE]  
> По умолчанию AD FS автоматически создает хранилище атрибутов "Active Directory". Требования к хранилищу атрибутов зависят от того, выступает ли ваша организация в качестве партнера по учетным записям \(размещения федеративных пользователей\) или партнера по ресурсам \(размещения федеративных приложений\).  
  
**Хранилища атрибутов LDAP**  
  
При работе с другим протоколом упрощенного доступа к каталогу \(хранилищами атрибутов LDAP\)\-необходимо подключиться к серверу LDAP, поддерживающему встроенную проверку подлинности Windows. Строка подключения LDAP должна записываться в формате URL-адреса LDAP в соответствии со стандартом RFC 2255.  
  
Также требуется, чтобы учетная запись службы для службы AD FS была иметь право на получение сведений о пользователях в хранилище атрибутов LDAP.  
  
**SQL Server хранилищами атрибутов**  
  
Для успешной работы AD FS в Windows Server 2012 R2 компьютеры, на которых размещается хранилище атрибутов SQL Server, должны работать под управлением Microsoft SQL Server 2008 или более поздней версии. При работе с хранилищами атрибутов на основе SQL\-необходимо также настроить строку подключения.  
  
**Пользовательские хранилища атрибутов**  
  
Хранилища настраиваемых атрибутов позволяют реализовывать более сложные сценарии.  
  
-   Язык политик, интегрированный в AD FS, может ссылаться на хранилища настраиваемых атрибутов, тем самым расширяя возможности перечисленных ниже сценариев.  
  
    -   Создание утверждений для прошедшего локальную аутентификацию пользователя  
  
    -   Добавление утверждений для прошедшего внешнюю аутентификацию пользователя  
  
    -   Авторизация пользователя на получение токена  
  
    -   Авторизация службы на получение токена для поведения пользователя  
  
    -   Выдача дополнительных данных в маркерах безопасности, выдаваемых AD FS проверяющим сторонам.  
  
-   Все хранилища настраиваемых атрибутов должны быть построены на основе .NET 4,0 или более поздней версии.  
  
При работе с хранилищем настраиваемых атрибутов может также потребоваться настроить строку подключения. В этом случае можно ввести произвольный код, который позволяет подключиться к хранилищу настраиваемых атрибутов. Строка подключения в этой ситуации представляет собой набор пар "имя\/значение", интерпретируемый разработчиком пользовательского хранилища атрибутов. Дополнительные сведения о разработке и использовании настраиваемых хранилищ атрибутов см. в разделе [Общие сведения о хранилище атрибутов](https://go.microsoft.com/fwlink/?LinkId=190782).  
  
## <a name="BKMK_9"></a>Требования к приложениям  
AD FS поддерживает утверждения\-приложений, которые используют следующие протоколы:  
  
-   Федерация\-WS  
  
-   Доверие WS\-  
  
-   Протокол SAML 2,0, использующий Идплите, разделите профили & егов 1.5.  
  
-   Профиль предоставления авторизации OAuth 2,0  
  
AD FS также поддерживает проверку подлинности и авторизацию для любых не\-утверждений,\-приложений, которые поддерживаются прокси-службой.  
  
## <a name="BKMK_10"></a>Требования к проверке подлинности  
**AD DS проверка подлинности \(Первичная проверка подлинности\)**  
  
Для доступа к интрасети поддерживаются следующие стандартные механизмы проверки подлинности для AD DS.  
  
-   Встроенная проверка подлинности Windows с помощью Negotiate для Kerberos & NTLM  
  
-   Проверка подлинности на основе форм с использованием имени пользователя\/пароли  
  
-   Проверка подлинности сертификата с помощью сертификатов, сопоставленных учетным записям пользователей в AD DS  
  
Для доступа к экстрасети поддерживаются следующие механизмы проверки подлинности:  
  
-   Проверка подлинности на основе форм с использованием имени пользователя\/пароли  
  
-   Проверка подлинности сертификата с помощью сертификатов, сопоставленных с учетными записями пользователей в AD DS  
  
-   Встроенная проверка подлинности Windows с использованием Negotiate \(NTLM\) только для конечных точек доверия WS\-, принимающих встроенную проверку подлинности Windows  
  
Для проверки подлинности сертификата:  
  
-   Расширяется на SmartCards, который может быть защищен ПИН-кодом.  
  
-   Графический интерфейс пользователя для ввода ПИН-кода не предоставляется AD FS и должен быть частью клиентской операционной системы, которая отображается при использовании клиентского TLS.  
  
-   Модуль чтения и поставщик служб шифрования \(\) CSP для смарт-карты должны работать на компьютере, где находится браузер.  
  
-   Сертификат смарт-карты должен быть связан с доверенным корневым каталогом на всех AD FS серверах и прокси-серверах веб приложения.  
  
-   Сертификат должен сопоставляться с учетной записью пользователя в AD DS одним из следующих методов.  
  
    -   Имя субъекта сертификата соответствует различающемуся имени LDAP учетной записи пользователя в AD DS.  
  
    -   Расширение алтнаме субъекта сертификата имеет имя участника-пользователя \(\) UPN учетной записи пользователя в AD DS.  
  
Для простой встроенной проверки подлинности Windows с помощью Kerberos в интрасети  
  
-   Необходимо, чтобы имя службы было частью доверенных сайтов или сайтов локальной интрасети.  
  
-   Кроме того, в учетной записи службы, на которой работает ферма >, необходимо задать имя субъекта-\_службы\/< служб ADFS\_Service Name AD FS SPN.  
  
**Многофакторная проверка подлинности\-**  
  
AD FS поддерживает дополнительную проверку подлинности \(помимо основной проверки подлинности, поддерживаемой AD DS\) помощью модели поставщика, в которой поставщики\/клиентов могут создать собственный адаптер многофакторной проверки подлинности\-, который администратор может зарегистрировать и использовать во время входа.  
  
Каждый адаптер MFA должен быть построен на основе .NET 4,5.  
  
Дополнительные сведения о MFA см. в статье [Управление рисками с помощью дополнительной многофакторной проверки подлинности для конфиденциальных приложений](../../ad-fs/operations/Manage-Risk-with-Additional-Multi-Factor-Authentication-for-Sensitive-Applications.md).  
  
**Проверка подлинности устройства**  
  
AD FS поддерживает проверку подлинности устройства с помощью сертификатов, подготовленных службой регистрации устройств в ходе рабочего места конечного пользователя, присоединенного к устройству.  
  
## <a name="BKMK_11"></a>Требования к присоединению к рабочей области  
Конечные пользователи могут присоединять свои устройства к Организации с помощью AD FS. Эта служба поддерживается службой регистрации устройств в AD FS. В результате конечные пользователи получают дополнительное преимущество единого входа для приложений, поддерживаемых AD FS. Кроме того, администраторы могут управлять рисками, запретив доступ к приложениям только тем устройствам, которые были присоединены к Организации. Ниже приведены требования для включения этого сценария.  
  
-   AD FS поддерживает присоединение к рабочей области для устройств Windows 8.1 и iOS 5\+  
  
-   Чтобы использовать функции Workplace Join, схема леса, к которой присоединены AD FS серверы, должна быть Windows Server 2012 R2.  
  
-   Альтернативное имя субъекта SSL-сертификата для службы AD FS должно содержать значение enterpriseregistration, за которым следует имя участника-пользователя \(UPN\) суффикс вашей организации, например enterpriseregistration.corp.contoso.com.  
  
## <a name="BKMK_12"></a>Требования к шифрованию  
В следующей таблице приведены дополнительные сведения о поддержке криптографии для подписи маркеров AD FS, шифрование маркеров\/функции расшифровки:  
  
||||  
|-|-|-|  
|**Microsof**|**Длина ключей**|**Протоколы\/приложения\/комментарии**|  
|TripleDES — по умолчанию 192 \(поддерживаемые 192 – 256\) \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#tripledes\-CBC](http://www.w3.org/2001/04/xmlenc#tripledes-cbc)|>\= 192|Поддерживаемый алгоритм для расшифровки маркера безопасности. Шифрование маркера безопасности с помощью этого алгоритма не поддерживается.|  
|AES128 \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#AES128\-CBC](http://www.w3.org/2001/04/xmlenc#aes128-cbc)|128|Поддерживаемый алгоритм для расшифровки маркера безопасности. Шифрование маркера безопасности с помощью этого алгоритма не поддерживается.|  
|AES192 \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#AES192\-CBC](http://www.w3.org/2001/04/xmlenc#aes192-cbc)|192|Поддерживаемый алгоритм для расшифровки маркера безопасности. Шифрование маркера безопасности с помощью этого алгоритма не поддерживается.|  
|AES256 \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#AES256\-CBC](http://www.w3.org/2001/04/xmlenc#aes256-cbc)|256|**По умолчанию**. Поддерживаемый алгоритм шифрования маркера безопасности.|  
|Трипледескэйврап \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#квт *\-TripleDES](http://www.w3.org/2001/04/xmlenc#kw-tripledes)|Все размеры ключей, поддерживаемые .NET 4,0\+|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|AES128KeyWrap \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#квт *\-AES128](http://www.w3.org/2001/04/xmlenc#kw-aes128)|128|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|AES192KeyWrap \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#квт *\-Aes192](http://www.w3.org/2001/04/xmlenc#kw-aes192)|192|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|AES256KeyWrap \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#квт *\-AES256](http://www.w3.org/2001/04/xmlenc#kw-aes256)|256|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|RsaV15KeyWrap \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#rsa\-1\_5](http://www.w3.org/2001/04/xmlenc#rsa-1_5)|1024|Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|Рсаоаепкэйврап \- [http:\/\/www.w3.org\/2001\/04\/ксмленк\#rsa\-oaep\-mgf1p](http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p)|1024|По умолчанию. Поддерживаемый алгоритм для шифрования симметричного ключа, который шифрует маркер безопасности.|  
|SHA1\-[http:\/\/www.w3.org\/PICS\/дсиг\/SHA1\_1\_0. HTML](http://www.w3.org/PICS/DSig/SHA1_1_0.html)|N\/A|Используется сервером AD FS в процессе создания SourceId артефакта: в этом сценарии STS использует SHA1 \(в соответствии с рекомендацией в\) стандарте SAML 2,0, чтобы создать короткое 160-разрядное значение для sourceiD артефакта.<br /><br />Также используется веб-агентом ADFS \(устаревший компонент из WS2003,\) для идентификации изменений в значении времени последнего обновления, чтобы он знал, когда следует обновлять сведения от STS.|  
|SHA1withRSA\-<br /><br />[http:\/\/www.w3.org\/PICS\/Дсиг\/RSA\-SHA1\_1\_0. HTML](http://www.w3.org/PICS/DSig/RSA-SHA1_1_0.html)|N\/A|Используется в случаях, когда AD FS Server проверяет подпись SAML Аусентикатионрекуест, подписывает запрос на разрешение артефакта или ответ, создает маркер\-сертификат подписи.<br /><br />В таких случаях SHA256 используется по умолчанию, а SHA1 используется только в том случае, если партнер \(проверяющей стороны\) не поддерживает SHA256 и должен использовать SHA1.|  
  
## <a name="BKMK_13"></a>Требования к разрешениям  
Администратор, выполняющий установку и начальную настройку AD FS, должен иметь разрешения администратора домена в локальном домене \(иными словами, домен, к которому присоединен сервер федерации.\)  
  
## <a name="see-also"></a>См. также  
[Руководство по разработке служб федерации Active Directory в Windows Server 2012 R2](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)  
  
