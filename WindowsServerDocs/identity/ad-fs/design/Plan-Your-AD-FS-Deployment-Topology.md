---
ms.assetid: 5c8c6cc0-0d22-4f27-a111-0aa90db7d6c8
title: Планирование топологии развертывания AD FS
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 7e41f7728c42912ec6ce680e1ed0c6a906a33392
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59821715"
---
# <a name="plan-your-ad-fs-deployment-topology"></a>Планирование топологии развертывания AD FS

>Область применения. Windows Server 2016, Windows Server 2012 R2

Первым шагом в планировании развертывания служб федерации Active Directory \(AD FS\) является определение правильной топологии развертывания в соответствии с потребностями вашей организации.  
  
Прежде чем приступить к чтению этого раздела, проверьте, как хранятся и реплицируются на другие серверы федерации в ферме серверов федерации AD FS данных и убедитесь, что вы понимаете, назначение и методы репликации, которые могут использоваться для базовых данных, которые хранятся в AD FS con База данных конфигурации.  
  
Существует два типа базы данных, которые можно использовать для хранения данных конфигурации AD FS: Внутренняя база данных Windows \(WID\) и Microsoft SQL Server. Дополнительные сведения см. в разделе [Роль базы данных конфигурации AD FS](../../ad-fs/technical-reference/The-Role-of-the-AD-FS-Configuration-Database.md). Просмотрите различные преимущества и ограничения, связанные с использованием WID или SQL Server в качестве базы данных конфигурации AD FS, а также различные сценарии приложений, что они поддерживают и затем выберите объект.  
  
> [!IMPORTANT]  
> Для реализации базовой избыточности, балансировки нагрузки и возможность развернуть службу федерации \(при необходимости\), мы рекомендуем развернуть по крайней мере два сервера федерации на ферму серверов федерации для всех рабочих средах независимо от типа базы данных, который будет использоваться.  
  
## <a name="determining-which-type-of-adfs-configuration-database-to-use"></a>Определение требуемого типа базы данных конфигурации AD FS  
AD FS использует базу данных для хранения конфигурации и — в некоторых случаях — данные о транзакциях, связанных со службой федерации. Программное обеспечение AD FS можно использовать для выбора либо встроенный\-во внутренней базе данных Windows \(WID\) или Microsoft SQL Server 2008 или более поздней версии для хранения данных в службе федерации.  
  
Для большинства целей эти два типа баз данных относительно эквивалентны. Тем не менее существуют некоторые различия, которые следует учитывать, прежде чем начинать изучать дополнительные о различных топологиях развертывания, которые можно использовать с AD FS. В таблице ниже описаны различия в поддерживаемых функциях между внутренней базой данных Windows и базой данных SQL Server.  
  
||Компонент|Поддерживается внутренней базой данных Windows?|Поддерживается SQL Server?
| --- | --- | --- |--- |
|Функции AD FS|Развертывание фермы серверов федерации|Да. Фермы внутренней базы данных Windows имеет ограничение в 30 серверов федерации, при наличии 100 или меньше доверия с проверяющей стороной.</br></br>Фермы внутренней базы данных Windows не поддерживает повторного использования токенов артефакта для обнаружения и разрешения (часть протокола Security Assertion Markup Language (SAML)). |Да. Действующих ограничений на число серверов федерации, которые можно развернуть на одной ферме, не существует  
|Функции AD FS|Разрешение артефактов SAML </br></br>**Примечание.** Эта функция не требуется для сценариев Microsoft Online Services, Microsoft Office 365, Microsoft Exchange или Microsoft Office SharePoint.|Нет|Да  
|Функции AD FS|SAML\/WS\-обнаружение воспроизведения токенов федерации|Нет|Да  
|Функции базы данных|С помощью избыточность баз данных Basic репликация по запросу, где одно или дополнительные серверы, размещающие чтения\-единственная копия изменения запроса базы данных, которые выполняются на исходном сервере, на котором размещена чтения\/записи копию базы данных|Да|Нет 
|Функции базы данных|Избыточность базы данных, с помощью высокой\-доступности решения, например отказоустойчивой кластеризации или зеркального отображения \(только на уровне базы данных\) **Примечание:** Все топологии развертывания AD FS поддерживают кластеризацию на уровне службы AD FS.|Нет|Да  

  
## <a name="sql-server-considerations"></a>Особенности SQL Server  
При выборе SQL Server в качестве базы данных конфигурации для развертываемой системы AD FS необходимо учитывать следующие факты о развертывании.  
  
-   **Функции SAML и их влияние на размер и рост базы данных**. Если включено разрешение артефактов SAML или обнаружение воспроизведения токенов SAML, AD FS сохраняет информацию в базе данных конфигурации SQL Server для каждого выданного токена AD FS. В результате этого наблюдается незначительный рост базы данных SQL Server, масштабы которого зависят от настроенного периода хранения воспроизведения токена. Каждая запись артефакта имеет размер около 30 килобайт \(КБ\).  
  
-   **Число необходимых для развертывания серверов**. Необходимо будет добавить по крайней мере один дополнительный сервер \(общего числа серверов, необходимых для развертывания инфраструктуры AD FS\) который будет функционировать как выделенный узел экземпляра SQL Server. Если планируется использовать отказоустойчивую кластеризацию или зеркальное отображение, чтобы обеспечить отказоустойчивость и масштабируемость базы данных конфигурации SQL Server, необходимо по меньшей мере два сервера SQL Server.  
  
## <a name="how-the-configuration-database-type-you-select-may-impact-hardware-resources"></a>Влияние выбранного типа базы данных конфигурации на аппаратные ресурсы  
Влияние аппаратных ресурсов на сервер федерации, развернутый в ферме с использованием внутренней базы данных Windows, и сервер федерации, развернутый на ферме с использованием базы данных SQL Server, незначительно. Однако важно помнить, что при использовании внутренней базы данных Windows для фермы каждый сервер федерации на этой ферме должен сохранять, обслуживать изменения репликации для своей локальной копии базы данных конфигурации AD FS и управлять ими, продолжая при этом обеспечивать нормальное функционирование службы федерации.  
  
В отличие от этого серверы федерации, развернутые на ферме, использующей базу данных SQL Server, не обязательно содержат локальный экземпляр базы данных конфигурации AD FS. Следовательно, требования к аппаратным ресурсам в этом случае несколько ниже.  
  
## <a name="BKMK_1"></a>Размещение сервера федерации  
В целях безопасности рекомендаций, размещения серверов федерации AD FS перед брандмауэром и подключайте их к корпоративной сети для предотвращения прямого доступа из Интернета. Это важно, так как серверы федерации имеют полную авторизацию для предоставления маркеров безопасности. Следовательно, они должны иметь ту же защиту, что и контроллер домена. Если сервер федерации будет скомпрометирована, пользователь-злоумышленник имеет возможность выдавать маркеры доступа для всех веб-приложений и серверов федерации, которые защищены AD FS.  
  
> [!NOTE]  
> В целях безопасности рекомендуется, избежать необходимости прямого доступа серверы федерации в Интернете. Рекомендуется дать вашим серверам федерации прямой доступ к Интернету, только в том случае, при настройке тестовой лабораторной среде или если вашей организации нет сети периметра.  
  
Для обычных корпоративных сетей, интрасети\-с выходом брандмауэра устанавливается между корпоративной сети и сети периметра и Интернет\-с выходом брандмауэра часто устанавливается между сетью периметра и Интернет. В этом случае располагается на сервере федерации в корпоративной сети, и это не прямой доступ к Интернет-клиентов.  
  
> [!NOTE]  
> Клиентские компьютеры, подключенные к корпоративной сети могут взаимодействовать напрямую с сервера федерации, через встроенную проверку подлинности Windows.  
  
Прокси-сервера федерации должны находиться в сети периметра перед настройкой серверов брандмауэра для использования с AD FS.  
  
## <a name="supported-deployment-topologies"></a>Поддерживаемые топологии развертывания  
Ниже описаны разнообразные топологии развертывания, которые можно использовать с AD FS. Здесь же описаны преимущества и ограничения каждой топологии развертывания, что позволяет выбрать наиболее подходящую для конкретных условий ведения бизнеса.  
  
-   [Ферма серверов федерации с использованием WID](Federation-Server-Farm-Using-WID.md)  
  
-   [Ферма серверов федерации с использованием WID и прокси-серверы](Federation-Server-Farm-Using-WID-and-Proxies.md)  
  
-   [Ферма серверов федерации с помощью SQL Server](Federation-Server-Farm-Using-SQL-Server.md)  
  
## <a name="see-also"></a>См. также  
[Руководство по разработке AD FS в Windows Server 2012 R2](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)  
  

