---
ms.assetid: 5c8c6cc0-0d22-4f27-a111-0aa90db7d6c8
title: "Планирование топологии развертывания AD FS"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 7e41f7728c42912ec6ce680e1ed0c6a906a33392
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2017
---
# <a name="plan-your-ad-fs-deployment-topology"></a>Планирование топологии развертывания AD FS

>Область применения: Windows Server 2016, Windows Server 2012 R2

Первым шагом в планировании развертывания служб федерации Active Directory \(AD FS\) является определение правильной топологии развертывания для удовлетворения потребностей вашей организации.  
  
Перед прочтением этого раздела, проверьте, как хранятся и реплицируются на другие серверы федерации в ферме серверов федерации AD FS данных и убедитесь, что вы понимаете, назначение и методы репликации, которые могут использоваться для базовых данных, хранящихся в базе данных конфигурации AD FS.  
  
Существует два типа баз данных, которые можно использовать для хранения данных конфигурации AD FS: \(WID\) внутренней базы данных Windows и Microsoft SQL Server. Дополнительные сведения см. в разделе [роль базы данных конфигурации AD FS](../../ad-fs/technical-reference/The-Role-of-the-AD-FS-Configuration-Database.md). Проанализируйте разные преимущества и ограничения, связанные с WID или SQL Server в качестве базы данных конфигурации AD FS, а также различные сценарии приложений, что они поддерживают и затем выбрать.  
  
> [!IMPORTANT]  
> Для реализации базовой избыточности, балансировки нагрузки и возможности масштабировать службу федерации \(if required\), рекомендуется развернуть по крайней мере два сервера федерации на каждой ферме серверов федерации для всех рабочих средах независимо от типа базы данных, который будет использоваться.  
  
## <a name="determining-which-type-of-ad-fs-configuration-database-to-use"></a>Определение требуемого типа базы данных конфигурации AD FS для использования  
Службы федерации Active Directory использует базу данных для хранения конфигурации и — в некоторых случаях — транзакционных данных, связанных со службой федерации. Программное обеспечение службы федерации Active Directory можно использовать для выбора встроенных \(WID\) внутренней базы данных Windows или Microsoft SQL Server 2008 или выше для хранения данных в службе федерации.  
  
Для большинства целей два типа баз данных относительно эквивалентны. Однако существуют некоторые различия, которые следует учитывать, прежде чем начинать изучать дополнительные сведения о различных топологиях развертывания, которые можно использовать с AD FS. В следующей таблице описаны различия в поддерживаемых функциях между Внутренней базой данных и базы данных SQL Server.  
  
||Функция|Поддерживается внутренней базой данных Windows?|Поддерживается SQL Server?
| --- | --- | --- |--- |
|Функции AD FS|Развертывание фермы серверов федерации|Да. На ферме внутренней базы данных Windows с ограничением 30 серверов федерации, при наличии 100 доверия с проверяющей стороной.</br></br>На ферме внутренней базы данных Windows не поддерживает воспроизведения токена обнаружения или артефактов разрешение (часть протокола безопасности SAML Assertion Markup Language ()). |Да. Не ограничено, применяемая для число серверов федерации, которые можно развернуть на одной ферме  
|Функции AD FS|Разрешение артефактов SAML </br></br>**Примечание:** эта функция не требуется для сценариев Microsoft Online Services, Microsoft Office 365, Microsoft Exchange или Microsoft Office SharePoint.|Нет|Да  
|Функции AD FS|Обнаружение воспроизведения токенов SAML\ и наличия WS-Federation|Нет|Да  
|Компоненты базы данных|Избыточность основной базы данных с помощью репликации по запросу, когда один или несколько серверов, где размещена только для чтения копия базы данных, запрос изменения, внесенные на исходном сервере, на котором расположена для чтения и записи копия базы данных|Да|Нет 
|Компоненты базы данных|Избыточность базы данных с помощью решений сценарии высокой доступности, например отказоустойчивой кластеризации или зеркального отображения \ (на only\ уровень базы данных) **Примечание:** все топологии развертывания Служб федерации Active Directory поддерживают кластеризацию на уровне служб AD FS.|Нет|Да  

  
## <a name="sql-server-considerations"></a>Особенности SQL Server  
При выборе SQL Server для базы данных конфигурации для развертывания Служб федерации Active Directory, необходимо учитывать следующие факты.  
  
-   **SAML функции и их влияние на размер базы данных и рост**. Если включено разрешение артефактов SAML или функции обнаружение воспроизведения токенов SAML, AD FS сохраняет информацию в базе данных конфигурации SQL Server для каждого выданного токена AD FS. Рост базы данных SQL Server, в результате этого действия не могут быть очень высока и зависит от настроенного периода воспроизведения токена хранения. Каждая запись артефакта имеет размер около 30 килобайт \(KB\).  
  
-   **Количество серверов, необходимых для развертывания**. Необходимо добавить хотя бы один дополнительный сервер \ (на общее число серверов, необходимых для развертывания на infrastructure\ AD FS), будет функционировать как выделенный узел экземпляра SQL Server. Если планируется использовать отказоустойчивую кластеризацию или зеркальное отображение, чтобы обеспечить отказоустойчивость и масштабируемость базы данных конфигурации SQL Server, требуется как минимум два сервера SQL.  
  
## <a name="how-the-configuration-database-type-you-select-may-impact-hardware-resources"></a>Влияние выбранного типа базы данных конфигурации аппаратных ресурсов  
Влияние аппаратных ресурсов на сервере федерации, развернутый в ферме с использованием WID сервера федерации, развернутый в ферме с использованием базы данных SQL Server не имеет значения. Однако важно помнить, что при использовании внутренней базы данных Windows для фермы каждый сервер федерации в ферме необходимо хранить, контролировать и обслуживать изменения репликации для своей локальной копии базы данных конфигурации AD FS, продолжая предоставлять нормальное функционирование службы федерации.  
  
В отличие от этого серверы федерации, развернутые на ферме, использующей базу данных SQL Server не обязательно содержит локальный экземпляр базы данных конфигурации AD FS. Таким образом он может вносить немного снижает требования к аппаратным ресурсам.  
  
## <a name="BKMK_1"></a>Размещение сервера федерации  
В целях обеспечения безопасности лучше всего Контрольное, размещения серверов федерации AD FS перед брандмауэром и подключите их к корпоративной сети, чтобы предотвратить уязвимость прямого доступа из Интернета. Это важно, так как серверы федерации имеют полные права для предоставления токенов безопасности. Следовательно они должны иметь ту же защиту, как контроллер домена. В случае компрометации сервера федерации, пользователь-злоумышленник имеет возможность выдать токены полного доступа для всех веб-приложений и серверов федерации, которые защищены с помощью AD FS.  
  
> [!NOTE]  
> В целях обеспечения безопасности рекомендуется, избегайте серверы федерации напрямую доступны в Интернете. Рассмотрите возможность предоставления серверы федерации прямого доступа из Интернета, только в том случае, если вы настраиваете настройке тестовой лабораторной среды или если в вашей организации нет сети периметра.  
  
Для обычных корпоративных сетей intranet\ брандмауэру устанавливается между корпоративной сетью и сетью периметра и модулю брандмауэру часто устанавливается между сетью периметра и Интернетом. В этом случае находится на сервере федерации в корпоративной сети, а не прямой доступ в Интернет-клиентов.  
  
> [!NOTE]  
> Клиентские компьютеры, подключенные к корпоративной сети могут взаимодействовать напрямую с сервера федерации, через встроенную проверку подлинности Windows.  
  
Прокси-сервер федерации должны быть помещены в сети периметра перед настройкой серверов брандмауэра для использования со службами AD FS.  
  
## <a name="supported-deployment-topologies"></a>Поддерживаемые топологии развертывания  
Ниже описаны разнообразные топологии развертывания, которые можно использовать с AD FS. Они также описаны преимущества и ограничения каждой топологии развертывания, можно выбрать наиболее подходящую для вашей организации.  
  
-   [Ферма серверов федерации с использованием WID](Federation-Server-Farm-Using-WID.md)  
  
-   [Ферма серверов федерации с использованием WID и прокси-серверов](Federation-Server-Farm-Using-WID-and-Proxies.md)  
  
-   [Ферма серверов федерации с использованием SQL Server](Federation-Server-Farm-Using-SQL-Server.md)  
  
## <a name="see-also"></a>См. также:  
[Руководство по разработке служб AD FS в Windows Server 2012 R2](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)  
  

