---
ms.assetid: 5c8c6cc0-0d22-4f27-a111-0aa90db7d6c8
title: Планирование топологии развертывания AD FS
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 9cd036e9dd0b249197fb475504c9cad532ead0ea
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71408037"
---
# <a name="plan-your-ad-fs-deployment-topology"></a>Планирование топологии развертывания AD FS

Первым шагом в планировании развертывания службы федерации Active Directory (AD FS) \(AD FS @ no__t-1 является определение правильной топологии развертывания в соответствии с потребностями Организации.  
  
Перед прочтением этого раздела ознакомьтесь с тем, как AD FS данные хранятся и реплицируются на другие серверы федерации в ферме серверов федерации, и убедитесь, что вы понимаете назначение и методы репликации, которые можно использовать для базовых данных, хранящихся в AD FS Con. база данных конфигурации.  
  
Существует два типа баз данных, которые можно использовать для хранения AD FS данных конфигурации. Внутренняя база данных Windows \(WID @ no__t-1 и Microsoft SQL Server. Дополнительные сведения см. в разделе [Роль базы данных конфигурации AD FS](../../ad-fs/technical-reference/The-Role-of-the-AD-FS-Configuration-Database.md). Ознакомьтесь с различными преимуществами и ограничениями, связанными с использованием WID или SQL Server в качестве базы данных конфигурации AD FS, а также различных сценариев приложений, которые они поддерживают, а затем делают выбор.  
  
> [!IMPORTANT]  
> Чтобы реализовать базовую избыточность, балансировку нагрузки и возможность масштабирования служба федерации \(if Required @ no__t-1, рекомендуется развернуть по крайней мере два сервера федерации на ферму серверов федерации для всех рабочих сред, независимо от Тип базы данных, которая будет использоваться.  
  
## <a name="determining-which-type-of-adfs-configuration-database-to-use"></a>Определение требуемого типа базы данных конфигурации AD FS  
AD FS использует базу данных для хранения конфигурации и, в некоторых случаях, данные о транзакциях, связанные с служба федерации. AD FS программное обеспечение можно использовать для выбора встроенной внутренней базы данных @ no__t-0in Windows \(WID @ no__t-2 или Microsoft SQL Server 2008 или более новой версии для хранения данных в служба федерации.  
  
Для большинства целей эти два типа баз данных относительно эквивалентны. Тем не менее, прежде чем приступить к ознакомлению с различными топологиями развертывания, которые можно использовать с AD FS, необходимо помнить о некоторых различиях. В таблице ниже описаны различия в поддерживаемых функциях между внутренней базой данных Windows и базой данных SQL Server.  
  
||Компонент|Поддерживается внутренней базой данных Windows?|Поддерживается SQL Server?
| --- | --- | --- |--- |
|AD FS функции|Развертывание фермы серверов федерации|Да. Ферма WID имеет ограничение в 30 серверов федерации, если у вас 100 или меньше отношений доверия проверяющей стороны.</br></br>Ферма WID не поддерживает определение воспроизведения маркеров или разрешение артефактов (входит в состав протокола язык разметки зявлений системы безопасности (SAML) (SAML)). |Да. Действующих ограничений на число серверов федерации, которые можно развернуть на одной ферме, не существует  
|AD FS функции|Разрешение артефактов SAML </br></br>**Примечание.** Эта функция не требуется для сценариев Microsoft Online Services, Microsoft Office 365, Microsoft Exchange или Microsoft Office SharePoint.|Нет|Да  
|AD FS функции|SAML @ no__t-0WS @ no__t — обнаружение воспроизведения токенов 1Federation|Нет|Да  
|Функции базы данных|Базовая избыточность базы данных с использованием опрашивающей репликации, где один или несколько серверов, на которых размещается копия копии @ no__t-0only запроса базы данных, изменили изменения, внесенные на исходном сервере, где размещена копия базы данных Read @ no__t-1write.|Да|Нет 
|Функции базы данных|Избыточность базы данных с помощью решений High no__t-0availability, таких как отказоустойчивая кластеризация или зеркальное отображение @no__t — 1AT уровень базы данных только @ no__t-2 **Примечание.** Все топологии развертывания AD FS поддерживают кластеризацию на уровне служб AD FS.|Нет|Да  

  
## <a name="sql-server-considerations"></a>Особенности SQL Server  
При выборе SQL Server в качестве базы данных конфигурации для развертываемой системы AD FS необходимо учитывать следующие факты о развертывании.  
  
-   **Функции SAML и их влияние на размер и рост базы данных**. Если включено разрешение артефактов SAML или обнаружение воспроизведения токенов SAML, AD FS сохраняет информацию в базе данных конфигурации SQL Server для каждого выданного токена AD FS. В результате этого наблюдается незначительный рост базы данных SQL Server, масштабы которого зависят от настроенного периода хранения воспроизведения токена. Размер каждой записи артефакта составляет примерно 30 КБ \(KB @ no__t-1.  
  
-   **Число необходимых для развертывания серверов**. Необходимо добавить хотя бы один дополнительный сервер \(to общее количество серверов, необходимое для развертывания инфраструктуры AD FS @ no__t-1, которая будет служить выделенным узлом экземпляра SQL Server. Если планируется использовать отказоустойчивую кластеризацию или зеркальное отображение, чтобы обеспечить отказоустойчивость и масштабируемость базы данных конфигурации SQL Server, необходимо по меньшей мере два сервера SQL Server.  
  
## <a name="how-the-configuration-database-type-you-select-may-impact-hardware-resources"></a>Влияние выбранного типа базы данных конфигурации на аппаратные ресурсы  
Влияние аппаратных ресурсов на сервер федерации, развернутый в ферме с использованием внутренней базы данных Windows, и сервер федерации, развернутый на ферме с использованием базы данных SQL Server, незначительно. Однако важно помнить, что при использовании внутренней базы данных Windows для фермы каждый сервер федерации на этой ферме должен сохранять, обслуживать изменения репликации для своей локальной копии базы данных конфигурации AD FS и управлять ими, продолжая при этом обеспечивать нормальное функционирование службы федерации.  
  
В отличие от этого серверы федерации, развернутые на ферме, использующей базу данных SQL Server, не обязательно содержат локальный экземпляр базы данных конфигурации AD FS. Следовательно, требования к аппаратным ресурсам в этом случае несколько ниже.  
  
## <a name="BKMK_1"></a>Место размещения сервера федерации  
В целях безопасности рекомендуется размещать AD FS серверы федерации перед брандмауэром и подключать их к корпоративной сети для предотвращения раскрытия из Интернета. Это важно, так как серверы федерации имеют полную авторизацию для предоставления маркеров безопасности. Следовательно, они должны иметь ту же защиту, что и контроллер домена. В случае компрометации сервера федерации злоумышленник может выдавать полные маркеры доступа всем веб-приложениям и серверам федерации, защищенным AD FS.  
  
> [!NOTE]  
> В целях безопасности рекомендуется избегать непосредственного доступа к серверам федерации через Интернет. Рассмотрите возможность предоставления серверам федерации прямого доступа к Интернету только при настройке тестовой среды или в том случае, если у вашей организации нет сети периметра.  
  
Для типичных корпоративных сетей брандмауэр @ no__t-0facing устанавливается между корпоративной сетью и сетью периметра, а брандмауэр Internet @ no__t-1facing часто устанавливается между сетью периметра и Интернетом. В этом случае сервер федерации находится в корпоративной сети и недоступен для интернет-клиентов напрямую.  
  
> [!NOTE]  
> Клиентские компьютеры, подключенные к корпоративной сети, могут напрямую взаимодействовать с сервером федерации через встроенную проверку подлинности Windows.  
  
Перед настройкой серверов брандмауэра для использования с AD FS необходимо поместить прокси-сервер федерации в сеть периметра.  
  
## <a name="supported-deployment-topologies"></a>Поддерживаемые топологии развертывания  
В следующих разделах описываются различные топологии развертывания, которые можно использовать с AD FS. Здесь же описаны преимущества и ограничения каждой топологии развертывания, что позволяет выбрать наиболее подходящую для конкретных условий ведения бизнеса.  
  
-   [Ферма серверов федерации с использованием WID](Federation-Server-Farm-Using-WID.md)  
  
-   [Ферма серверов федерации с использованием WID и прокси-серверов](Federation-Server-Farm-Using-WID-and-Proxies.md)  
  
-   [Ферма серверов федерации с использованием SQL Server](Federation-Server-Farm-Using-SQL-Server.md)  
  
## <a name="see-also"></a>См. также  
[Руководство по разработке служб федерации Active Directory в Windows Server 2012 R2](AD-FS-Design-Guide-in-Windows-Server-2012-R2.md)  
  

