---
ms.assetid: 9831b421-8fb7-4e15-ac27-c013cbca6d05
title: Требования к сертификатам для серверов федерации
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.openlocfilehash: fcf78fa6242c10d469320ce3803da94134576c8b
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87954370"
---
# <a name="certificate-requirements-for-federation-servers"></a>Требования к сертификатам для серверов федерации

В любой службы федерации Active Directory (AD FS) \( AD FS \) необходимо использовать различные сертификаты для защиты обмена данными и упрощения проверки подлинности пользователей между Интернетом и серверами федерации. Каждый сервер федерации должен иметь сертификат связи службы и сертификат подписи маркера, \- прежде чем он сможет участвовать в AD FS связи. В следующей таблице описаны типы сертификатов, связанные с сервером федерации.

|Тип сертификата|Описание|
|--------------------|---------------|
|Сертификат для подписи токена \-|Сертификат для \- подписи маркера — это сертификат X509. Серверы федерации используют связанные \/ пары открытого закрытого ключа для цифровой подписи всех выдающихся маркеров безопасности. Сюда относится подписывание опубликованных метаданных федерации и запросов на разрешение артефактов.<p>Можно \- настроить несколько сертификатов подписи маркера в оснастке управления AD FS \- в, чтобы разрешить смену сертификатов, когда срок действия одного из сертификатов близок к истечению. По умолчанию все сертификаты в списке публикуются, но только основной \- сертификат для подписи маркера используется AD FS для фактического подписания маркеров. Все выбранные сертификаты должны иметь соответствующий закрытый ключ.<p>Дополнительные сведения см. в статьях [Сертификаты подписи токенов](Token-Signing-Certificates.md) и [Добавление сертификата подписи токенов](../../ad-fs/deployment/Add-a-Token-Signing-Certificate.md).|
|Сертификат взаимодействия служб|Серверы федерации используют сертификат проверки подлинности сервера, который также называется связью службы для \( Windows Communication Foundation \) безопасности сообщений WCF. По умолчанию это тот же сертификат, который используется сервером федерации в качестве SSL \( SSL- \) сертификата в службы IIS \( IIS \) . **Примечание.** Оснастка управления AD FS \- в относится к сертификатам проверки подлинности сервера для серверов федерации в качестве сертификатов связи служб.<p>Дополнительные сведения см. в разделе [сертификаты связи служб](Service-Communications-Certificates.md) и [Настройка сертификата связи службы](../../ad-fs/deployment/Set-a-Service-Communications-Certificate.md).<p>Так как сертификат связи служб должен быть доверенным для клиентских компьютеров, рекомендуется использовать сертификат, подписанный ЦС доверенного центра сертификации \( \) . Все выбранные сертификаты должны иметь соответствующий закрытый ключ.|
|SSL \( SSL- \) сертификат|Серверы федерации используют сертификат SSL для обеспечения безопасности трафика веб-служб при обмене данными SSL с веб-клиентами и прокси-серверами федерации.<p>Поскольку сертификату SSL должны доверять клиентские компьютеры, рекомендуется использовать сертификат, подписанный доверенным центром сертификации. Все выбранные сертификаты должны иметь соответствующий закрытый ключ.|
|\-Сертификат расшифровки маркера|Этот сертификат используется для расшифровки токенов, полученных этим сервером федерации.<p>Можно использовать несколько сертификатов расшифровки. Это позволяет серверу федерации ресурсов расшифровывать маркеры, выпущенные с помощью старого сертификата, после того как новый сертификат будет установлен в качестве основного сертификата расшифровки. Для расшифровки можно использовать все сертификаты, но \- в метаданных федерации фактически публикуется только сертификат расшифровки основного маркера. Все выбранные сертификаты должны иметь соответствующий закрытый ключ.<p>Дополнительные сведения см. [в разделе Добавление сертификата для расшифровки маркера](../../ad-fs/deployment/Add-a-Token-Decrypting-Certificate.md).|

Вы можете запросить и установить сертификат SSL или сертификат связи службы, запросив сертификат связи службы с помощью \( оснастки MMC консоли управления \) \- для IIS. Дополнительные общие сведения об использовании SSL-сертификатов см. [в разделе iis 7,0: настройка SSL в iis 7,0](https://go.microsoft.com/fwlink/?LinkID=108544) и [IIS 7,0: Настройка сертификатов сервера в IIS 7,0](https://go.microsoft.com/fwlink/?LinkID=108545) .

> [!NOTE]
> В AD FS можно изменить уровень SHA для алгоритма безопасного хэширования \( \) , который используется для цифровых подписей: SHA \- 1 или SHA \- 256 \( \) . AD Фсдоес не поддерживает использование сертификатов с другими методами хэширования, например MD5 — \( алгоритм хэширования по умолчанию, используемый в \- средстве командной строки Makecert.exe \) . По соображениям безопасности рекомендуется использовать SHA \- 256, \( который по умолчанию задан \) для всех подписей. SHA \- 1 рекомендуется использовать только в сценариях, в которых необходимо взаимодействовать с продуктом, который не поддерживает обмен данными с помощью SHA \- 256, например, не от \- продукта Майкрософт или AD FS 1. *x*.

## <a name="determining-your-ca-strategy"></a>Определение стратегии центра сертификации
AD FS не требует, чтобы сертификаты выдавались центром сертификации. Однако сертификат SSL, \( который также используется по умолчанию как сертификат связи служб, \) должен быть доверенным для клиентов AD FS. \-Для этих типов сертификатов не рекомендуется использовать самозаверяющие сертификаты.

> [!IMPORTANT]
> Использование самозаверяющих \- сертификатов SSL в рабочей среде может позволить злонамеренному пользователю в организации партнера по учетным записям получить контроль над серверами федерации в организации партнера по ресурсам. Такая угроза безопасности существует, поскольку самозаверяющие \- сертификаты являются корневыми. Они должны быть добавлены в доверенное корневое хранилище другого сервера федерации, \( например, на сервере федерации ресурсов \) , который может оставить этот сервер уязвимым для атак.

После получения сертификата из центра сертификации необходимо убедиться, что все сертификаты импортированы в хранилище личных сертификатов на локальном компьютере. Сертификаты можно импортировать в личное хранилище с помощью оснастки MMC "сертификаты" \- в.

В качестве альтернативы использованию оснастки "сертификаты" \- в можно также ИМПОРТИРОВАТЬ SSL-сертификат с помощью оснастки "Диспетчер IIS" \- в момент назначения сертификата SSL веб сайту по умолчанию. Дополнительные сведения см. в разделе [Импорт сертификата проверки подлинности сервера на веб-сайт по умолчанию](../../ad-fs/deployment/Import-a-Server-Authentication-Certificate-to-the-Default-Web-Site.md).

> [!NOTE]
> Перед установкой AD FS программного обеспечения на компьютер, который станет сервером федерации, убедитесь, что оба сертификата находятся в хранилище личных сертификатов локального компьютера и что сертификат SSL назначен веб-сайту по умолчанию. Дополнительные сведения о порядке задач, необходимых для настройки сервера федерации, см. в разделе [Контрольный список: Настройка сервера федерации](../../ad-fs/deployment/Checklist--Setting-Up-a-Federation-Server.md).

В зависимости от требований безопасности и бюджетных ограничений необходимо тщательно продумать, какие из сертификатов будут присваиваться публичным или корпоративным центром сертификации. На рисунке ниже показаны рекомендованные издатели (центры сертификации) определенных типов сертификатов. Эта рекомендация отражает оптимальный \- подход к безопасности и затратам.

![требования к сертификатам](media/adfs2_fedserver_certstory_1.png)

## <a name="certificate-revocation-lists"></a>Списки отзыва сертификатов
Если у какого-либо используемого сертификата есть списки отзыва сертификатов (CRL), сервер с настроенным сертификатом должен иметь возможность связаться с сервером, распространяющим CRL.

## <a name="see-also"></a>См. также:
[Руководство по разработке служб федерации Active Directory в Windows Server 2012](AD-FS-Design-Guide-in-Windows-Server-2012.md)
