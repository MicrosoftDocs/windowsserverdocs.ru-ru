---
ms.assetid: 606df285-259c-4c6b-8583-9aca1d614c43
title: Когда следует использовать правило пропуска или фильтрации утверждений
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server
ms.technology: identity-adfs
ms.openlocfilehash: 005f2544b8064e35f9bec1e9d814b49c46512414
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80853817"
---
# <a name="when-to-use-a-pass-through-or-filter-claim-rule"></a>Когда следует использовать правило пропуска или фильтрации утверждений
Это правило можно использовать в службы федерации Active Directory (AD FS) \(AD FS\), когда необходимо получить определенный тип входящего утверждения, а затем применить действие, которое определит, какие выходные данные должны выполняться на основе значений во входящем утверждении. При использовании этого правила вы пропускаете или фильтруете все утверждения, соответствующие логике правила в следующей таблице, на основе параметров, настроенных в правиле.  
  
|Параметр правила|Логика правила|  
|---------------|--------------|  
|пропуск всех значений утверждений;|Если тип входящего утверждения равен *указанному типу утверждения*, а значение равно *любому значению*, то следует пропустить утверждение.|  
|пропуск только конкретного значения утверждения;|Если тип входящего утверждения равен *указанному типу утверждения*, а значение равно *указанному значению утверждения*, то следует пропустить утверждение.|  
|Передавать только значения утверждений, соответствующие конкретному значению\-суффикса электронной почты|Если тип входящего утверждения равен *указанному типу утверждения*, а значение равно *указанному значению суффикса*, то следует пропустить утверждение.|  
|Пропускать только значения утверждения, начинающиеся с указанного значения|Если тип входящего утверждения равен *указанному типу утверждения*, а значение начинается с *указанного значения утверждения*, то следует пропустить утверждение.|  
  
В следующих разделах содержатся основные сведения о правилах утверждений и предоставляются дополнительные сведения об использовании этого правила.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, который будет принимать входящее утверждение, применить к нему условие \(если x then y\) и создать исходящее утверждение на основе параметров условия. В следующем списке перечислены важные рекомендации в отношении правил утверждений, с которыми следует ознакомиться перед прочтением дальнейших сведений в этом разделе.  
  
-   В\-е оснастки "Управление AD FS" правила утверждений можно создавать только с помощью шаблонов правил утверждений.  
  
-   Правила утверждений обрабатывают входящие утверждения либо непосредственно из поставщика утверждений, \(например Active Directory, либо другой служба федерации\) или из выходных данных правил преобразования принятия в отношении доверия поставщика утверждений.  
  
-   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнить или отфильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
  
-   Шаблоны правил утверждения всегда требуют указывать тип входящего утверждения. Тем не менее, можно обрабатывать несколько значений утверждений с одним типом утверждения, используя одно правило.  
  
Дополнительные сведения о правилах утверждений и наборах правил для утверждений см. [в разделе роль правил утверждений](The-Role-of-Claim-Rules.md). Дополнительные сведения о том, как правила обрабатываются, см. [в разделе роль подсистемы утверждений](The-Role-of-the-Claims-Engine.md). Дополнительные сведения о том, как обрабатываются наборы правил для утверждений, см. [в разделе роль конвейера утверждений](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="pass-through-all-claim-values"></a>пропуск всех значений утверждений;  
При использовании этого действия все значения входящих утверждений для указанного типа утверждений пропускаются как исходящие утверждения. Например, когда тип входящего утверждения указан как тип утверждения роли, все значения входящих утверждений индивидуально копируются в новые исходящие утверждения с типом роли.  
  
## <a name="filtering-a-claim"></a>Фильтрация утверждения  
В AD FS термин *Фильтрация утверждений* означает фильтрацию или ограничение входящих значений утверждения, чтобы только определенные значения передавались или отправлялись в качестве исходящих утверждений. Существует шаблон правила **Пропуск или фильтрация входящего утверждения**, делающий эту функцию возможной. В свойствах этого правила можно задать условия для фильтрации входящих значений, чтобы пропускались только значения, удовлетворяющие заданным условиям.  
  
Например, вы можете использовать это правило для пропуска только утверждений, соответствующих значению утверждения "Покупатель" и имеющих тип входящего утверждения "Роль", или выдавать только утверждения об имени пользователя, но не утверждения, содержащие номер социального страхования пользователя.  
  
Когда вы применяете условие фильтра с этим правилом, все входящие утверждения проверяются, чтобы определить, какие из них соответствуют критерию, установленному правилом. Все остальные утверждения игнорируются; таким образом, пропускаются только указанные значения утверждений, соответствующие типу выбранного утверждения.  
  
Например, как показано на следующем рисунке, если правило задано с условием для фильтрации только входящих утверждений, которые имеют тип утверждения имени участника-пользователя, а также заканчиваются @fabrikam.com, все остальные входящие утверждения игнорируются, если не соответствуют этим критериям. Сюда входит входящее утверждение с типом утверждения E\-адрес электронной почты, несмотря на то, что значение утверждения заканчивается в @fabrikam.com. В этом случае проверяющей стороне отправляется только утверждение, содержащее значение Nick@fabrikam.com.  
  
![Когда следует использовать Pass](media/adfs2_filter.gif)  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>Настройка этого правила для отношения доверия с поставщиком утверждений  
При использовании отношений доверия с поставщиком утверждений это правило можно настроить для пропуска только входящих утверждений от поставщика утверждений, удовлетворяющих определенным ограничениям. Например, может потребоваться принять только\-утверждений электронной почты от поставщика утверждений. Таким образом, этот шаблон правила используется для приема сообщений e\-mail, которые оканчиваются в системе доменных имен поставщика утверждений \(DNS-\) имя.  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>Настройка этого правила в отношениях доверия с проверяющей стороной  
При использовании отношений доверия с проверяющей стороной это правило можно настроить для пропуска или фильтрации исходящих утверждений, которые будут отправляться проверяющей стороне. Некоторые проверяющие стороны могут не понимать определенные типы утверждений, или некоторые утверждения могут содержать конфиденциальные сведения, которые не должны отправляться определенным проверяющим сторонам. Данный шаблон правила помогает осуществить эти политики для конкретных отношений доверия с проверяющей стороной.  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
Это правило создается с помощью языка правил утверждений или шаблона "пройти через" или "Фильтрация входящего утверждения" в\-е оснастки "Управление AD FS" в. Этот шаблон правила предоставляет следующие возможности настройки:  
  
-   указание имени правила утверждения;  
  
-   указание типа входящего утверждения;  
  
-   пропуск всех значений утверждений;  
  
-   пропуск только конкретного значения утверждения;  
  
-   Передавать только значения утверждений, соответствующие конкретному значению\-суффикса электронной почты  
  
-   Пропускать только значения утверждения, начинающиеся с указанного значения  
  
Дополнительные инструкции по созданию этого шаблона см. в разделе [Создание правила для передачи или фильтрации входящего утверждения](https://technet.microsoft.com/library/dd807060.aspx) в AD FS руководство по развертыванию.  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
Если утверждение должно отправляться только в том случае, когда значение утверждения соответствует настраиваемому шаблону, необходимо использовать настраиваемое правило. Дополнительные сведения см. в разделе "Когда следует использовать правила утверждений".  
  
### <a name="examples-of-how-to-construct-a-pass-through-or-filter-rule-syntax"></a>Примеры создания синтаксиса правила пропуска или фильтрации  
Простое правило фильтрации будет выполнять фильтрацию на основе одного из свойств, описанных выше. Например, следующее правило будет проходить через все утверждения e\-mail.  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"]  => issue(claim  = c);  
```  
  
Фильтры могут быть логическими и\-ED вместе. Например, следующее правило примет все утверждения e\-mail со значением johndoe@fabrikam.com:  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", value == "johndoe@fabrikam.com "]  => issue(claim  = c);  
```  
  
В приведенных выше примерах в фильтрах всегда используется оператор равенства. Язык правил утверждений поддерживает следующие операторы:  
  
-   \=\= \- равно \(\-с учетом регистра\)  
  
-   \!\= \- не равно \(\-с учетом регистра\)  
  
-   \=~\- сопоставление регулярных выражений  
  
-   \!~ \- регулярных выражений\-совпадений  
  
Например, следующее правило примет все утверждения электронной почты\-, не выданные локальным сервером федерации с суффиксом boeing.com:  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress", value =~ "^.*@boeing\.com$" , issuer != "LOCAL AUTHORITY"]  => issue(claim  = c);  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>Рекомендации по созданию настраиваемых правил  
Фильтр может применяться для одного или нескольких свойств каждого утверждения, как описано в следующей таблице.  
  

| Свойство утверждения |                                                                                                                                                                                                                                                                                                                                                  Описание                                                                                                                                                                                                                                                                                                                                                  |
|----------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|      Тип      |                                                                                                                                                                                        Тип утверждения \(обычно представляется в виде URI\) отражающее неявное соглашение между партнерами в Федерации о том, какой тип информации передается в заявке. Например, утверждения типа http:\/\/schemas.xmlsoap.org\/WS\/2005\/05\/Identity\/Claims\/EmailAddress будет содержать адрес электронной почты пользователя\-.                                                                                                                                                                                         |
|     Значение      |                                                                                                                                                                                                                                                                   Значение утверждения. Например, утверждение типа http:\/\/schemas.xmlsoap.org\/WS\/2005\/05\/Identity\/Claims\/EmailAddress может иметь значение johndoe@fabrikam.com                                                                                                                                                                                                                                                                    |
|   ValueType    |                                                                                                                                                                                                  Значение ValueType представляет способ интерпретации информации, содержащейся в значении утверждения. Обычно для ValueType будет задано значение http:\/\/www.w3.org\/2001\/XMLSchema\#String, но значение утверждения может содержать данные в кодировке Base64Binary \(например, изображение\) или Дата, логическое значение и т. д.                                                                                                                                                                                                  |
|     Издатель     | Издатель представляет сторону, ранее выдавшую утверждения о пользователе. Если утверждения получены на сервере федерации поставщика утверждений, то издателю всех заявок будет присвоено значение "локальный центр". Если утверждения были получены сервером федерации поставщика федерации, в качестве издателя утверждений будет установлен идентификатор поставщика утверждений, подписавшего токен. Таким образом, при обработке правил в утверждениях, полученных от поставщика утверждений, в качестве издателя всех утверждений будет установлено одно и то же значение. При создании правил для проверяющей стороны свойство Issuer (издатель) может использоваться, чтобы различать утверждения, исходящие от разных поставщиков утверждений. |
| OriginalIssuer |                                                                                                   Это свойство утверждения предназначено для передачи сведений о сервере федерации, изначально выдавшем утверждение. Так как свойство Issuer утверждений установлено на последний сервер федерации, подписавший маркер, первоначальный издатель полезен в сценариях, где утверждение поступает через несколько серверов федерации \(например, проверяющей стороной, получающей маркер от сервера федерации поставщика Федерации, может быть интересно, какой именно сервер федерации поставщика утверждений проходил проверку подлинности пользователя\)                                                                                                   |
|   Свойства   |                                                                                                                             Помимо пяти свойств, описанных выше, каждое утверждение также имеет контейнер свойств, в котором могут храниться названные свойства. Эти свойства не сериализуются в токене и имеют смысл только для передачи сведений между компонентами конвейера выдачи утверждений в рамках области одного сервера федерации. Например, можно задать свойство во время обработки правил поставщика утверждений, а затем ссылаться на это свойство в правилах проверяющей стороны.                                                                                                                              |

