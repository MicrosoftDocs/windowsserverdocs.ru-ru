---
ms.assetid: 606df285-259c-4c6b-8583-9aca1d614c43
title: "Когда следует использовать пропуска или фильтрации правил утверждений"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: aa205c46bf67dc25a55232b799bdd39fee4ac3c6
ms.sourcegitcommit: 70c1b6cedad55b9c7d2068c9aa4891c6c533ee4c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/03/2017
---
>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

# <a name="when-to-use-a-pass-through-or-filter-claim-rule"></a>Когда следует использовать пропуска или фильтрации правил утверждений
Это правило можно использовать в службах федерации Active Directory, \(AD FS\) когда требуется принять определенный тип входящего утверждения и затем применить действие, которое будет определять, какой результат должен возникать на основе значений во входящем утверждении. При использовании этого правила вы пропускаете или фильтруете все утверждения, соответствующие логике правила в следующей таблице, на основе одного из параметров, настроенных в правиле.  
  
|Правило|Логика правила|  
|---------------|--------------|  
|Пропуск всех значений утверждений|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *любое значение*, то следует пропустить утверждение|  
|Пропускать только значения утверждения определенной|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *заданное значение утверждения*, то следует пропустить утверждение|  
|Пропускать только значения утверждения, соответствующие указанному значению суффикса сообщений определенного e\|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *указанному значению суффикса*, то следует пропустить утверждение|  
|Пропускать только значения утверждения, начинающиеся с указанного значения|Если входящее утверждение имеет тип *указанному типу утверждения* а значение начинается с *заданное значение утверждения*, то следует пропустить утверждение|  
  
В следующих разделах содержатся основные сведения о правилах утверждений и предоставляются дополнительные сведения об использовании этого правила.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, который будет делать входящее утверждение, применяет к нему условие \ (если x затем y\) и создает исходящее утверждения на основе параметров условия. В следующем списке перечислены важные советы, которые нужно знать о правилах утверждений, перед прочтением дальнейших в этом разделе:  
  
-   В оснастка управления AD FS правил для утверждений можно создавать только с помощью шаблонов правил для утверждений  
  
-   Процесс правил утверждений входящие утверждения либо непосредственно от поставщика утверждений \ (например, Active Directory или другим служба\текущих федерации), либо из выходных данных принятия преобразования правила для отношения доверия поставщика утверждений.  
  
-   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнить или отфильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
  
-   Шаблоны правил утверждения всегда требуют указывать тип входящего утверждения. Тем не менее можно обрабатывать несколько значений утверждений с одним типом утверждения, используя одно правило.  
  
Дополнительные сведения о правилах утверждений и наборах правил утверждений см. в разделе [роль правил утверждений](The-Role-of-Claim-Rules.md). Дополнительные сведения об обработке правил см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md). Дополнительные сведения об обработке наборов правил утверждений см. в разделе [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="pass-through-all-claim-values"></a>Пропуск всех значений утверждений  
При использовании этого действия все значения входящих утверждений для указанного типа утверждений пропускаются как исходящие утверждения. Например когда тип входящего утверждения указан как тип утверждения роли, все значения входящих утверждений индивидуально копируются в новые исходящие утверждения с типом исходящего утверждения роли.  
  
## <a name="filtering-a-claim"></a>Фильтрация утверждений  
В AD FS, термин *утверждений фильтрации* означает фильтрацию или ограничение входящих значений утверждений, чтобы только определенные значения передавались или посылались как исходящие утверждения. Это **пропуск или Фильтрация входящего утверждения** шаблон правила, делающий эту функцию возможной. В свойствах этого правила можно задать условия для фильтрации входящих значений, чтобы пропускались только значения, удовлетворяющие заданным условиям.  
  
Например можно использовать это правило для пропуска только утверждений, соответствующих значению утверждения покупатель, когда тип входящего утверждения тип утверждения роли, или вам может потребоваться выдавать только утверждения об имени пользователя, но не утверждения, содержащие номер социального страхования пользователя.  
  
Если вы применяете условие фильтра с этим правилом, все входящие утверждения проверяются, чтобы определить, какие из них соответствуют критерию, установленному правилом. Все остальные утверждения игнорируются, чтобы пропускались только указанные значения утверждений, соответствующие типу выбранного утверждения.  
  
Например, как показано на следующем рисунке, если правило установлено с условием для фильтрации только входящие утверждения, которые участника-пользователя тип утверждения, а также заканчиваться @fabrikam.com, все остальные входящие утверждения игнорируются, если они критериям. Сюда входит и входящее утверждение с типом E\ почтовый адрес, несмотря на то, что его значение заканчивается на @fabrikam.com. В этом случае только утверждение, содержащее значение Nick@fabrikam.comпроверяющей стороне отправляется.  
  
![Когда следует использовать проход через](media/adfs2_filter.gif)  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>Настройка этого правила для отношения доверия с поставщиком утверждений  
При использовании отношения доверия с поставщиком утверждений это правило можно настроить для пропуска только входящих утверждений от поставщика утверждений, удовлетворяющих определенным ограничениям. Например может потребоваться принимать только утверждения e\ почты от поставщика утверждений; Таким образом следует использовать этот шаблон правила, чтобы принимать типы утверждений e\ почты, заканчивающиеся на имя поставщика утверждений \(DNS\) доменных имен.  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>Настройка этого правила для отношения доверия с проверяющей стороной  
При использовании отношения доверия с проверяющей стороной это правило можно настроить для пропуска или фильтрации исходящих утверждений, которые будут отправляться проверяющей стороны. Некоторые проверяющие стороны могут не понимать определенные типы утверждений, или некоторые утверждения могут содержать конфиденциальные сведения, которые не должны отправляться определенным проверяющим сторонам. Этот шаблон правила помогает осуществить эти политики для конкретного доверия с проверяющей стороной.  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
Создание правила с помощью языка правил утверждений или с помощью пропуск или Фильтрация входящего утверждения шаблона правила в управления AD FS оснастка. Этот шаблон правила предоставляет следующие параметры конфигурации:  
  
-   Указание имени правила утверждения  
  
-   Указание типа входящего утверждения  
  
-   Пропуск всех значений утверждений  
  
-   Пропускать только значения утверждения определенной  
  
-   Пропускать только значения утверждения, соответствующие указанному значению суффикса сообщений определенного e\  
  
-   Пропускать только значения утверждения, начинающиеся с указанного значения  
  
Дополнительные инструкции по созданию этого шаблона см. в разделе [Создание правила для пропуска или фильтрации входящего утверждения](https://technet.microsoft.com/library/dd807060.aspx) в руководстве по развертыванию AD FS.  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
Если утверждение должно отправляться только в том случае, когда значение утверждения соответствует настраиваемому шаблону, необходимо использовать настраиваемое правило. Дополнительные сведения см. в разделе когда следует использовать настраиваемое правило.  
  
### <a name="examples-of-how-to-construct-a-pass-through-or-filter-rule-syntax"></a>Примеры создания пропуска или фильтрации правила синтаксиса  
Простое правило фильтрации будет выполнять фильтрацию на основе одного из свойств, описанных выше. Например следующее правило будет пропускать все утверждения электронной почты e\:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”]  => issue(claim  = c);  
```  
  
Фильтры можно логически AND\ ed друг с другом. Например следующее правило будет принимать все утверждения e\ почты со значением johndoe@fabrikam.com:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value == “johndoe@fabrikam.com “]  => issue(claim  = c);  
```  
  
В приведенных выше примерах в фильтрах всегда используется оператор равенства. Язык правил утверждений поддерживает следующие операторы:  
  
-   \ = \ = \-равно \(case\-sensitive\)  
  
-   \! \ = \-не равно \(case\-sensitive\)  
  
-   \ = ~ \ — соответствует регулярному выражению  
  
-   \! ~ \-отличных соответствует регулярному выражению  
  
Например следующее правило будет принимать все e\ почты утверждения не были выданы сервером федерации, имеющие суффикс boeing.com:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value =~ “^.*@boeing\.com$” , issuer != “LOCAL AUTHORITY”]  => issue(claim  = c);  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>Рекомендации по созданию настраиваемых правил  
Фильтр может применяться для одного или нескольких свойств каждого утверждения, как описано в следующей таблице.  
  
|Свойство утверждения|Описание|  
|------------------|---------------|  
|Тип|Тип утверждения \ (обычно в виде Uri\) отражает неявное соглашение между партнерами в федерации о какого рода информация передается в утверждении. Например утверждения типа http:///\/schemas.xmlsoap.org\/ws\/2005\/05\/identity\/claims\/emailaddress будет содержать e\ почтовый адрес пользователя.|  
|Значение|Значение утверждения. Например утверждение типа http:///\/schemas.xmlsoap.org\/ws\/2005\/05\/identity\/claims\/emailaddress может иметь значение johndoe@fabrikam.com|  
|ValueType|Свойство ValueType указывает, как — интерпретироваться сведения, содержащиеся в значении утверждения. Обычно свойство ValueType устанавливается http:///\/www.w3.org\/2001\/XMLSchema\#string, но значение утверждения может содержать данные в кодировке Base64Binary данных \ (например, image\) или дату, логическое значение и т. д.|  
|Издатель|Издатель представляет сторону, ранее выдавшую утверждения о пользователе. Если утверждения Получает сервер федерации поставщика утверждений в качестве издателя всех утверждений будет иметь значение «ЛОКАЛЬНЫЙ АДМИНИСТРАТОР». Если утверждения были получены сервером федерации поставщика федерации, в качестве издателя утверждений будет будет установлен идентификатор поставщика утверждений поставщика утверждений, подписавшего токен. Таким образом при обработке правил в утверждениях, полученных от поставщика утверждений в качестве издателя всех утверждений будет устанавливаться в то же значение. При создании правил для проверяющей стороны, можно использовать в качестве свойства issuer, чтобы различать утверждения, исходящие от разных поставщиков утверждений.|  
|OriginalIssuer|Это свойство утверждения предназначено для передачи сведений о сервере федерации, изначально выдавшем утверждение. Поскольку в качестве свойства issuer утверждений устанавливается на последний сервер федерации, подписавший токен, об исходном издателе полезны в сценариях, когда утверждение проходит через несколько серверов федерации \ (например, проверяющей стороне, которая получает токен от сервера федерации поставщика федерации может быть заинтересован какой конкретный сервер федерации поставщика с проверкой подлинности определяемые утверждений)|  
|Свойства|Помимо пяти свойств, описанных выше каждое утверждение также имеет контейнер свойств, в котором могут храниться названные свойства. Эти свойства не сериализуются в токене и имеют смысл только для передачи сведений между компонентами конвейера выдачи утверждений в рамках области одного сервера федерации. Например можно задать свойство во время утверждения поставщика правил обработки, а затем ссылаться на него в правилах проверяющей стороны.|  
  

