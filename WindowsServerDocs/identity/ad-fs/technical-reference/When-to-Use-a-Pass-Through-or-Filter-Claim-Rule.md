---
ms.assetid: 606df285-259c-4c6b-8583-9aca1d614c43
title: Когда следует использовать правило пропуска или фильтрации утверждений
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: aa205c46bf67dc25a55232b799bdd39fee4ac3c6
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59812215"
---
>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

# <a name="when-to-use-a-pass-through-or-filter-claim-rule"></a>Когда следует использовать правило пропуска или фильтрации утверждений
Это правило можно использовать в службах федерации Active Directory \(AD FS\) при необходимости использовать определенный тип входящего утверждения, а затем применить действие, которое будет определять, какой результат должен возникать на основе значений во входящем утверждении. При использовании этого правила вы пропускаете или фильтруете все утверждения, соответствующие логике правила в следующей таблице, на основе параметров, настроенных в правиле.  
  
|Параметр правила|Логика правила|  
|---------------|--------------|  
|пропуск всех значений утверждений;|Если тип входящего утверждения равен *указанному типу утверждения*, а значение равно *любому значению*, то следует пропустить утверждение.|  
|пропуск только конкретного значения утверждения;|Если тип входящего утверждения равен *указанному типу утверждения*, а значение равно *указанному значению утверждения*, то следует пропустить утверждение.|  
|Пропускать только значения утверждений, соответствующих конкретному e\-почты значение суффикса|Если тип входящего утверждения равен *указанному типу утверждения*, а значение равно *указанному значению суффикса*, то следует пропустить утверждение.|  
|Пропускать только значения утверждения, начинающиеся с указанного значения|Если тип входящего утверждения равен *указанному типу утверждения*, а значение начинается с *указанного значения утверждения*, то следует пропустить утверждение.|  
  
В следующих разделах содержатся основные сведения о правилах утверждений и предоставляются дополнительные сведения об использовании этого правила.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, будет к входящему утверждению, применить условие к нему \(if x, то y\) и Создание исходящего утверждения на основе параметров условия. В следующем списке перечислены важные рекомендации в отношении правил утверждений, с которыми следует ознакомиться перед прочтением дальнейших сведений в этом разделе.  
  
-   В консоли управления AD FS\-, утверждения, правила могут создаваться только с помощью шаблонов правил для утверждений  
  
-   Процесс правила утверждений входящие утверждения либо непосредственно от поставщика утверждений \(например Active Directory или другой службы федерации\) или из выходных данных принятия отношения доверия поставщика утверждений правил преобразования.  
  
-   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнить или отфильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
  
-   Шаблоны правил утверждения всегда требуют указывать тип входящего утверждения. Тем не менее, можно обрабатывать несколько значений утверждений с одним типом утверждения, используя одно правило.  
  
Более подробные сведения о правилах для утверждений и наборах правил утверждений, см. в разделе [The Role of Claim Rules](The-Role-of-Claim-Rules.md). Дополнительные сведения об обработке правил см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md). Дополнительные сведения, как обрабатываются наборов правил утверждений, см. в разделе [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="pass-through-all-claim-values"></a>пропуск всех значений утверждений;  
При использовании этого действия все значения входящих утверждений для указанного типа утверждений пропускаются как исходящие утверждения. Например, когда тип входящего утверждения указан как тип утверждения роли, все значения входящих утверждений индивидуально копируются в новые исходящие утверждения с типом роли.  
  
## <a name="filtering-a-claim"></a>Фильтрация утверждения  
В AD FS, термин *утверждений фильтрации* значения означает фильтрацию или ограничение входящих утверждений таким образом, чтобы только определенные значения передавались или посылались как исходящие утверждения. Существует шаблон правила **Пропуск или фильтрация входящего утверждения**, делающий эту функцию возможной. В свойствах этого правила можно задать условия для фильтрации входящих значений, чтобы пропускались только значения, удовлетворяющие заданным условиям.  
  
Например, вы можете использовать это правило для пропуска только утверждений, соответствующих значению утверждения "Покупатель" и имеющих тип входящего утверждения "Роль", или выдавать только утверждения об имени пользователя, но не утверждения, содержащие номер социального страхования пользователя.  
  
Когда вы применяете условие фильтра с этим правилом, все входящие утверждения проверяются, чтобы определить, какие из них соответствуют критерию, установленному правилом. Все остальные утверждения игнорируются; таким образом, пропускаются только указанные значения утверждений, соответствующие типу выбранного утверждения.  
  
Например, как показано на следующем рисунке, когда набор правил с условием для фильтрации только входящие утверждения, которые соответствуют участника-пользователя тип утверждения и также заканчиваться @fabrikam.com, все остальные входящие утверждения игнорируются, только если они отвечают этому критерию. Сюда входят входящее утверждение с типом утверждения для E\-несмотря на то, что его значение заканчивается на адрес электронной почты @fabrikam.com. В данном случае только утверждение, содержащее значимость Nick@fabrikam.com отправляется доверяющей стороне.  
  
![Когда следует использовать проход через](media/adfs2_filter.gif)  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>Настройка этого правила для отношения доверия с поставщиком утверждений  
При использовании отношений доверия с поставщиком утверждений это правило можно настроить для пропуска только входящих утверждений от поставщика утверждений, удовлетворяющих определенным ограничениям. Например, может потребоваться принимать только e\-mail утверждений от поставщика утверждений; таким образом, будет использовать этот шаблон правила, чтобы принять e\-почты типы утверждений, которые заканчиваются на доменных имен для поставщика утверждений \(DNS\) имя.  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>Настройка этого правила в отношениях доверия с проверяющей стороной  
При использовании отношений доверия с проверяющей стороной это правило можно настроить для пропуска или фильтрации исходящих утверждений, которые будут отправляться проверяющей стороне. Некоторые проверяющие стороны могут не понимать определенные типы утверждений, или некоторые утверждения могут содержать конфиденциальные сведения, которые не должны отправляться определенным проверяющим сторонам. Данный шаблон правила помогает осуществить эти политики для конкретных отношений доверия с проверяющей стороной.  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
Создать это правило с помощью языка правил утверждений или пропуск или Фильтрация входящего утверждения шаблон правила в консоли управления AD FS\-в. Этот шаблон правила предоставляет следующие возможности настройки:  
  
-   указание имени правила утверждения;  
  
-   указание типа входящего утверждения;  
  
-   пропуск всех значений утверждений;  
  
-   пропуск только конкретного значения утверждения;  
  
-   Пропускать только значения утверждений, соответствующих конкретному e\-почты значение суффикса  
  
-   Пропускать только значения утверждения, начинающиеся с указанного значения  
  
Дополнительные инструкции по созданию этого шаблона см. в разделе [создать правило, чтобы пропуск или Фильтрация входящего утверждения](https://technet.microsoft.com/library/dd807060.aspx) в руководстве по развертыванию AD FS.  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
Если утверждение должно отправляться только в том случае, когда значение утверждения соответствует настраиваемому шаблону, необходимо использовать настраиваемое правило. Дополнительные сведения см. в разделе "Когда следует использовать правила утверждений".  
  
### <a name="examples-of-how-to-construct-a-pass-through-or-filter-rule-syntax"></a>Примеры создания синтаксиса правила пропуска или фильтрации  
Простое правило фильтрации будет выполнять фильтрацию на основе одного из свойств, описанных выше. Например, следующее правило будет проходить через все e\-почты утверждения:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”]  => issue(claim  = c);  
```  
  
Фильтры можно логически AND\-ed вместе. Например, следующее правило будет принимать все e\-почты утверждения со значением johndoe@fabrikam.com:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value == “johndoe@fabrikam.com “]  => issue(claim  = c);  
```  
  
В приведенных выше примерах в фильтрах всегда используется оператор равенства. Язык правил утверждений поддерживает следующие операторы:  
  
-   \=\= \- равняется \(случай\-конфиденциальных\)  
  
-   \!\= \- не равно \(случай\-конфиденциальных\)  
  
-   \=~\- Сопоставление регулярному выражению  
  
-   \!~ \- регулярное выражение не\-соответствует  
  
Например, следующее правило будет принимать все e\-почты утверждений, которые не передаются с локального сервера федерации, которые имеют суффикс boeing.com:  
  
```  
c:[type == “http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress”, value =~ “^.*@boeing\.com$” , issuer != “LOCAL AUTHORITY”]  => issue(claim  = c);  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>Рекомендации по созданию настраиваемых правил  
Фильтр может применяться для одного или нескольких свойств каждого утверждения, как описано в следующей таблице.  
  
|Свойство утверждения|Описание|  
|------------------|---------------|  
|Тип|Тип утверждения \(обычно в виде Uri\) отражает неявное соглашение между партнерами в федерации о какого рода информация передается в утверждении. Например, утверждения тип HTTP:\/\/schemas.xmlsoap.org\/ws\/2005\/05\/удостоверений\/утверждений\/emailaddress будет содержать e\-почтовый адрес пользователя.|  
|Значение|Значение утверждения. Например, утверждение типа http:\/\/schemas.xmlsoap.org\/ws\/2005\/05\/удостоверений\/утверждений\/emailaddress может иметь значение johndoe@fabrikam.com|  
|ValueType|Свойство ValueType указывает, как должны интерпретироваться сведения, содержащиеся в значении утверждения. Обычно свойство ValueType будет содержать префикс протокола http:\/\/www.w3.org\/2001\/XMLSchema\#строки, но значение утверждения может содержать данные в кодировке Base64Binary \(например, изображение \) или дату, логическое значение и т. д.|  
|Издатель|Издатель представляет сторону, ранее выдавшую утверждения о пользователе. Если утверждения получает сервер федерации поставщика утверждений, для всех утверждений будет установлен издатель LOCAL AUTHORITY (локальный центр). Если утверждения были получены сервером федерации поставщика федерации, в качестве издателя утверждений будет установлен идентификатор поставщика утверждений, подписавшего токен. Таким образом, при обработке правил в утверждениях, полученных от поставщика утверждений, в качестве издателя всех утверждений будет установлено одно и то же значение. При создании правил для проверяющей стороны свойство Issuer (издатель) может использоваться, чтобы различать утверждения, исходящие от разных поставщиков утверждений.|  
|OriginalIssuer|Это свойство утверждения предназначено для передачи сведений о сервере федерации, изначально выдавшем утверждение. Так как издатель утверждений свойству до последнего сервера федерации, подписавшего токен, исходный издатель удобен в сценариях, где утверждения доставлена через несколько серверов федерации \(к примеру, проверяющая сторона, получающий маркер от поставщика федерации сервера федерации может быть заинтересован сервер федерации поставщика утверждений какой конкретный проверку подлинности пользователя\)|  
|Свойства|Помимо пяти свойств, описанных выше, каждое утверждение также имеет контейнер свойств, в котором могут храниться названные свойства. Эти свойства не сериализуются в токене и имеют смысл только для передачи сведений между компонентами конвейера выдачи утверждений в рамках области одного сервера федерации. Например, можно задать свойство во время обработки правил поставщика утверждений, а затем ссылаться на это свойство в правилах проверяющей стороны.|  
  

