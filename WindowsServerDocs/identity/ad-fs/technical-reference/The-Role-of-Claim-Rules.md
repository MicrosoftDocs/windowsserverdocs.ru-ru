---
ms.assetid: 65e474b5-3076-4ba3-809d-a09160f7c2bd
title: Роль правил утверждений
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 06f2f0d1fb48c6b9dea89762a30fdf77643d0e53
ms.sourcegitcommit: 0b5fd4dc4148b92480db04e4dc22e139dcff8582
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/24/2019
ms.locfileid: "66188571"
---
# <a name="the-role-of-claim-rules"></a>Роль правил утверждений
Основное назначение службы федерации в службах федерации Active Directory \(AD FS\) — Отправка маркер, содержащий набор утверждений. Решение относительно того, какие утверждения AD FS принимает, а затем выдает регулируется правил для утверждений.  
  
## <a name="what-are-claim-rules"></a>Что такое правила утверждений  
Правило утверждения представляет экземпляр бизнес-логику, которая будет принимать один или несколько входящих утверждений, применяет к ним условия \(if x, то y\) и создают один или несколько исходящих утверждений на основе параметров условия. Дополнительные сведения о входящих и исходящих утверждений, см. в разделе [The Role of Claims](The-Role-of-Claims.md).  
  
Правила утверждений используются, когда необходимо реализовать бизнес-логику, контролирующую поток утверждений через конвейер утверждений. Хотя конвейер утверждений — более логическое понятие окончания\-для\-завершить процесс для передачи утверждений, утверждений, правила являются более реальным административным элементом, который можно использовать для настройки потока заявок через процесс выдачи утверждений.  
  
Дополнительные сведения о конвейере утверждений, см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md).  
  
Правила утверждений обеспечивают следующие преимущества:  
  
-   Предоставляет механизм для администраторов применить выполнения\-времени бизнес-логики за доверие утверждений от поставщиков утверждений  
  
-   предоставляют администраторам механизм определения утверждений, которые должны предоставляться проверяющим сторонам;  
  
-   Предоставлять утверждения, широкие\-возможностям авторизации для администраторов, которые нужно разрешить или запретить доступ определенным пользователям на основе  
  
### <a name="how-claim-rules-are-processed"></a>Порядок обработки правил утверждений  
Правила утверждений обрабатываются посредством конвейера утверждений с помощью *модуля утверждений*. Модуль утверждений — это логический компонент службы федерации, который проверяет набор входящих утверждений, представленный пользователем, и в соответствии с логикой каждого правила создает выходной набор утверждений.  
  
Вместе модуль утверждений и набор правил утверждений, связанный с данным федеративным отношением доверия, определяют, следует ли передать входящие утверждения в исходном виде, отфильтровать в соответствии с определенным условием или преобразовать в совершенно новый набор утверждений, прежде чем они будут выпущены службой федерации как исходящие утверждения.  
  
Дополнительные сведения об этом процессе см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md).  
  
## <a name="what-are-claim-rule-templates"></a>Что такое шаблоны правил утверждений  
AD FS включает стандартный набор правил утверждений, шаблоны, которые призваны помочь вам легко выбрать и создать наиболее подходящих правил утверждений для определенной бизнес-требований. Шаблоны правил утверждений используются только в процессе создания правил утверждений.  
  
В консоли управления AD FS\-, правила могут создаваться только с помощью шаблонов правил для утверждений. После использования оснастки\-в чтобы выбрать шаблон правила утверждения, входные данные, необходимые для логики правила и сохраните его в базу данных конфигурации, он будет \(с этого момента\) называется в пользовательском Интерфейсе, как правило утверждения.  
  
### <a name="how-claim-rule-templates-work"></a>Как работают шаблоны правил утверждений  
Утверждения, на первый взгляд шаблоны правил, по-видимому, обычными формами ввода, предоставляемые привязать\-in для сбора данных и применения логики ко входящим утверждениям. Однако если взглянуть глубже, окажется, что в шаблонах правил утверждений хранятся языковые структуры правил утверждений, которые образуют базовую логику, необходимую для быстрого создания правила без близкого знакомства с языком.  
  
Каждый шаблон, предоставляемый в пользовательском интерфейсе \(пользовательского интерфейса\) представляет предварительно заполненных синтаксиса языка правил утверждений, на основе наиболее распространенных административных задач. Однако один шаблон правил представляет исключение. Он называется настраиваемым шаблонов правил. В этом шаблоне синтаксис не заполнен. Вместо этого вам надо самостоятельно составить синтаксическую структуру языка правил утверждений в теле формы шаблона.  
  
Дополнительные сведения об использовании синтаксиса языка правил утверждений см. в разделе [роль языка правил утверждений](The-Role-of-the-Claim-Rule-Language.md) в руководстве по развертыванию AD FS.  
  
> [!TIP]  
> В любой момент можно просмотреть язык правила утверждения, связанный с правилом, нажав кнопку **Просмотреть язык правила** в свойствах правила утверждения.  
  
### <a name="how-to-create-a-claim-rule"></a>Создание правила утверждения  
Правила утверждений создаются отдельно для каждого федеративного отношения доверия в службе федерации и не используются совместно несколькими отношениями. Вы можете создать правило на основе шаблона правил утверждений, создать правило с нуля с помощью языка правил утверждений или настроить правило с помощью Windows PowerShell.  
  
Все эти варианты доступны одновременно, что обеспечивает гибкость при выборе подходящего способа для конкретного сценария. Дополнительные сведения о том, как создать правило для утверждений см. в разделе [Настройка правил для утверждений](https://technet.microsoft.com/library/ee913571.aspx) FSDeployment руководства по AD.  
  
#### <a name="using-claim-rule-templates"></a>Использование шаблонов правил утверждений  
Шаблоны правил утверждений используются только в процессе создания правил утверждений. Для создания правила утверждения можно использовать любой из следующих шаблонов:  
  
-   Пропуск или фильтрация входящего утверждения  
  
-   Преобразование входящего утверждения  
  
-   Отправка атрибутов LDAP как утверждений  
  
-   Отправка членства в группах в качестве утверждения  
  
-   Отправка утверждений с помощью настраиваемого правила  
  
-   Разрешать или запрещать пользователям на основании входящего утверждения  
  
-   Разрешить всем пользователям  
  
Дополнительные сведения, описание каждого из этих шаблонов правил для утверждений, см. в разделе [определить тип из утверждения шаблон правила для использования](Determine-the-Type-of-Claim-Rule-Template-to-Use.md).  
  
#### <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
Для бизнес-правил, не охватываемых стандартными шаблонами правил утверждений, можно использовать настраиваемый шаблон правила для выражения сложных условий логики с помощью языка правил утверждений. Дополнительные сведения об использовании настраиваемого правила см. в разделе [когда следует использовать настраиваемое правило утверждения](When-to-Use-a-Custom-Claim-Rule.md).  
  
#### <a name="using-windowspowershell"></a>Использование Windows PowerShell  
Можно также использовать объект командлета ADFSClaimRuleSet с помощью Windows PowerShell для создания и администрирования правил в AD FS. Дополнительные сведения об использовании Windows PowerShell с помощью этого командлета см. в разделе [Администрирование AD FS с помощью Windows PowerShell](https://go.microsoft.com/fwlink/?LinkID=179634).  
  
## <a name="what-is-a-claim-rule-set"></a>Что такое набор правил утверждений  
Как показано на рисунке ниже, набор правил утверждений — это группа из одного или нескольких правил для определенного федеративного отношения доверия, которая определяет способ обработки утверждений модулем утверждений. Когда служба федерации получает входящее утверждение, модуль утверждений применяет логику, заданную в соответствующем наборе правил утверждений. То, как будут выпущены утверждения для всего отношения доверия, определяется общим результатом применения логики из каждого правила в наборе.  
  
![Роли AD FS](media/adfs2_claimruleset.gif)  
  
Правила утверждений обрабатываются модулем утверждений в хронологическом порядке в пределах заданного набора правил. Этот порядок важен, так как выходные данные одного правила могут служить входными данными для следующего правила в наборе.  
  
## <a name="what-are-claim-rule-set-types"></a>Типы наборов правил утверждений  
Тип набора правил утверждений — это логическая часть федеративного отношения доверия, которая категорически определяет, будет ли набор правил утверждений, связанный с отношением доверия, использоваться для выдачи, авторизации или принятия утверждений. С каждым федеративным отношением доверия может быть связан один или несколько типов наборов правил утверждений в зависимости от типа этого отношения.  
  
В таблице ниже описываются различные типы наборов правил утверждений и объясняется их связь с отношением доверия с поставщиком утверждений или с отношением доверия с проверяющей стороной.  
  
|Тип набора правил утверждений|Описание|Область применения|  
|-----------------------|---------------|-----------|  
|Набор правил преобразования принятия|Набор правил утверждений, применяющийся к определенному отношению доверия с поставщиком утверждений для указания входящих утверждений, которые будут приняты от организации поставщика утверждений, и исходящих утверждений, которые будут отправлены в отношение доверия с проверяющей стороной.<br /><br />Входящие утверждения, служащие источником для этого набора правил, будут выходными утверждениями набора правил преобразования выдачи, определенного в организации поставщика утверждений.<br /><br />По умолчанию узел отношений доверия с поставщиком утверждений содержит отношение с именем **Active Directory**, которое представляет исходное хранилище атрибутов для набора правил преобразования принятия. Этот объект отношения доверия представляет связь службы федерации с базой данных Active Directory в вашей сети. Именно это отношение доверия по умолчанию обрабатывает утверждения для пользователей, прошедших аутентификацию в Active Directory, и его нельзя удалить.|Отношения доверия с поставщиком утверждений|  
|Набор правил преобразования выдачи|Набор правил утверждений, который применяется к отношению доверия с проверяющей стороной для указания утверждений, которые будут выданы проверяющей стороне.<br /><br />Входящие утверждения, служащие источником для этого набора правил, изначально будут выходными утверждениями правил преобразования принятия.|Отношения доверия с проверяющей стороной|  
|Набор правил авторизации выдачи|Набор правил утверждений, который применяется к отношению доверия с проверяющей стороной для указания пользователей, которым будет разрешено получить токен для проверяющей стороны.<br /><br />Эти правила определяют, может ли пользователь получать утверждения для проверяющей стороны и, таким образом, получать доступ к ней.<br /><br />Если правило авторизации выдачи не задано, по умолчанию доступ запрещен для всех пользователей.|Отношения доверия с проверяющей стороной|  
|Набор правил авторизации делегирования|Набор правил утверждений, который применяется к отношению доверия с проверяющей стороной для указания пользователей, которым будет разрешено выступать в роли делегатов других пользователей для проверяющей стороны.<br /><br />Эти правила определяют, разрешено ли инициатору запроса выступать от лица пользователя. При этом инициатор запроса указывается в токене, отправляемом проверяющей стороне.<br /><br />Если правило авторизации выдачи не задано, по умолчанию ни один из пользователей не может выступать в роли делегата.|Отношения доверия с проверяющей стороной|  
|Набор правил авторизации олицетворения|Набор правил утверждений, который настраивается с помощью Windows PowerShell для определения того, может ли пользователь полностью олицетворять другого пользователя для проверяющей стороны.<br /><br />Эти правила определяют, разрешено ли инициатору запроса олицетворять пользователя без указания инициатора в токене, отправляемом проверяющей стороне.<br /><br />Такое олицетворение пользователя — это очень эффективная возможность, так как проверяющей стороне будет неизвестно, что пользователь олицетворяется.|Отношения доверия с проверяющей стороной|  
  
Дополнительные сведения о выборе подходящих правил утверждений для использования в вашей организации, см. в разделе [определить тип из утверждения шаблон правила для использования](Determine-the-Type-of-Claim-Rule-Template-to-Use.md).  
  

