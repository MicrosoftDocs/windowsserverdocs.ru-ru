---
ms.assetid: 77aa61bf-9c04-4889-a5d2-6f45bc1b8bd2
title: Когда следует использовать правила преобразования утверждений
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: c7b7ea2c8d9a08a4cbf6c89c2de2482043efe25b
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59885565"
---
>Область применения. Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

# <a name="when-to-use-a-transform-claim-rule"></a>Когда следует использовать правила преобразования утверждений
Это правило можно использовать в службах федерации Active Directory \(AD FS\) Если вам нужно сопоставить тип входящего утверждения для типа исходящего утверждения и затем применить действие, которое будет определять, какой результат должен возникать на основе значений, была создана во входящем утверждении. При использовании этого правила вы пропускаете или преобразуете все утверждения, соответствующие следующей логике правила, на основе параметров, настроенных в правиле, как показано в следующей таблице.  
  
|Параметр правила|Логика правила|  
|---------------|--------------|  
|Пропуск всех входящих утверждений|Если входящее утверждение имеет *указанный тип утверждения*, а значение соответствует *любому значению*, то следует пропустить это утверждение с типом исходящего утверждения, равным *указанному типу утверждения*.|  
|Замена значения входящего утверждения на значение другого исходящего утверждения|Если входящее утверждение имеет *указанный тип утверждения*, а значение соответствует *заданному значению утверждения*, следует преобразовать утверждение, установив новое значение исходящего утверждения, соответствующее *заданному значению утверждения*, а тип исходящего утверждения соответствующим *указанному типу утверждения*|  
|Замена входящие электронные\-суффикс утверждения с новой электронной почты\-суффикс электронной почты|Если входящее утверждение имеет *указанный тип утверждения*, а значение соответствует *любому значению суффикса*, следует преобразовать утверждение, установив новое значение исходящего утверждения, соответствующее *заданному значению суффикса*, а тип исходящего утверждения соответствующим *указанному типу утверждения*|  
  
В следующих разделах содержатся основные сведения о правилах утверждений и предоставляются дополнительные сведения об использовании этого правила.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, будет к входящему утверждению, применить условие к нему \(if x, то y\) и Создание исходящего утверждения на основе параметров условия. В следующем списке перечислены важные рекомендации в отношении правил утверждений, с которыми следует ознакомиться перед прочтением дальнейших сведений в этом разделе.  
  
-   В консоли управления AD FS\-, утверждения, правила могут создаваться только с помощью шаблонов правил для утверждений  
  
-   Процесс правила утверждений входящие утверждения либо непосредственно от поставщика утверждений \(например Active Directory или другой службы федерации\) или из выходных данных принятия отношения доверия поставщика утверждений правил преобразования.  
  
-   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнить или отфильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
  
-   Шаблоны правил утверждения всегда требуют указывать тип входящего утверждения. Тем не менее, можно обрабатывать несколько значений утверждений с одним типом утверждения, используя одно правило.  
  
Более подробные сведения о правилах для утверждений и наборах правил утверждений, см. в разделе [The Role of Claim Rules](The-Role-of-Claim-Rules.md). Дополнительные сведения об обработке правил см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md). Дополнительные сведения, как обрабатываются наборов правил утверждений, см. в разделе [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="pass-through-all-claim-values"></a>пропуск всех значений утверждений;  
При использовании этого действия все значения входящих утверждений, соответствующие указанному типу входящего утверждения, сопоставляются с указанным типом исходящего утверждения перед их отправкой в качестве исходящих утверждений в токены, подписанные вашей службой федерации.  
  
Например, если правило установлено с вариантом логики **Пропускать все значения утверждений**, а также задан тип "Группа" для входящего утверждения и тип "Группа"группы и тип "Роль" для исходящего утверждения, то все значения входящих утверждений, поступающие от издателя, по отдельности копируются в новые исходящие утверждения с типом "Роль".  
  
## <a name="transforming-a-claim"></a>Преобразование утверждения  
В AD FS, термин *преобразования утверждений* означает замену одного значения входящего утверждения на значение на значение другого исходящего утверждения. Эту функциональность обеспечивает правило преобразования входящего утверждения. В свойствах этого правила можно задать условия для замены входящих значений на значение другого исходящего утверждения на основе указанного типа входящего утверждения.  
  
Например, как показано на следующем рисунке, когда устанавливается правило с условием замены входящего значения на значение другого исходящего утверждения, все входящие утверждения с типом "Группа" сопоставляются с новыми типами исходящих утверждений "Роль". В этом случае значение входящего утверждения "Покупатель" заменяется на новое значение исходящего утверждения "Администратор".  
  
![Когда следует использовать преобразование](media/adfs2_transform.gif)  
  
Это правило также можно использовать для применения условия, которое приводит к замене всех входящих утверждений указанного e\-почты значение суффикса с новым значением. Например, можно задать в этом правиле условие для изменения всех значений утверждений с суффиксом sales.corp.fabrikam.com на fabrikam.com.  
  
## <a name="configuring-this-rule-on-a-claims-provider-trust"></a>Настройка этого правила для отношения доверия с поставщиком утверждений  
При использовании отношения доверия с поставщиком утверждений это правило можно настроить для преобразования входящих утверждений от поставщика утверждений в надежные эквиваленты. Типы утверждений или значения утверждений в вашей организации могут иметь другое значение, чем в организациях поставщика утверждений. Это правило можно использовать для нормализации типов и значений утверждений, полученных от поставщика утверждений, чтобы проверяющая сторона могла понимать их эквиваленты исходящих утверждений.  
  
## <a name="configuring-this-rule-on-a-relying-party-trust"></a>Настройка этого правила в отношениях доверия с проверяющей стороной  
При использовании отношения доверия с проверяющей стороной это правило можно настроить для преобразования утверждений для определенной проверяющей стороны. Типы или значения утверждений могут иметь другое значение для определенной проверяющей стороны, и это правило позволяет изменять типы и значения исходящих утверждений для одной проверяющей стороны.  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
При создании правила с помощью языка правил утверждений или **преобразование входящего утверждения** шаблон правила в консоли управления AD FS\-в. Этот шаблон правила предоставляет следующие возможности настройки:  
  
-   указание имени правила утверждения;  
  
-   преобразование определенного типа входящего утверждения в указанный тип исходящего утверждения;  
  
-   пропуск всех значений утверждений;  
  
-   Замена значения входящего утверждения на значение другого исходящего утверждения  
  
-   Замените входящие электронные\-суффикс утверждения с новой электронной почты\-суффикс электронной почты  
  
Дополнительные инструкции по созданию этого шаблона см. в разделе [создайте правило для преобразования входящего утверждения](https://technet.microsoft.com/library/dd807068.aspx) в руководстве по развертыванию AD FS.  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
Если исходящее утверждение должно состоять из содержимого нескольких входящих утверждений, необходимо использовать настраиваемое правило. Если значение исходящего утверждения должно строиться на значении входящего утверждения, но с дополнительным содержимым, в этом контексте также следует использовать настраиваемое правило. Дополнительные сведения см. в разделе [When to Use a Custom Claim Rule](When-to-Use-a-Custom-Claim-Rule.md).  
  
### <a name="examples-of-how-to-construct-a-transform-rule-syntax"></a>Примеры создания синтаксиса правила преобразования  
При использовании синтаксиса языка правил утверждений для преобразования утверждений можно задать в свойстве преобразованного утверждения новое литеральное значение. Например, следующее правило изменяет значение утверждений роли с "Администраторы" на root, сохраняя тот же тип утверждения:  
  
```  
c:[type == “https://schemas.microsoft.com/ws/2008/06/identity/claims/role”, value == “Administrators”]  => issue(type = c.type, value = “root”);  
```  
  
Для преобразования утверждений также можно использовать регулярные выражения. Например, следующее правило будет задайте домен в утверждениях имени пользователя windows в ДОМЕНЕ\\ПОЛЬЗОВАТЕЛЕМ формата для FABRIKAM:  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] => issue(type = c.type, value = regexreplace(c.value, "(?<domain>[^\\]+)\\(?<user>.+)", "FABRIKAM\${user}"));  
```  
  
### <a name="best-practices-for-creating-custom-rules"></a>Рекомендации по созданию настраиваемых правил  
Преобразования утверждений можно выборочно применять к утверждениям, выбранным с помощью основных возможностей фильтрации. Каждому из свойств утверждения, используемых для фильтрации, можно присвоить значения, со следующими оговорками.  
  
|Свойство утверждения|Описание|  
|------------------|---------------|  
|Type, Value, ValueType|Эти свойства наиболее часто используются для назначения. Для итогового преобразованного утверждения должны быть заданы как минимум тип и значение.|  
|Издатель|Хотя язык правил утверждений позволяет настроить издателя утверждения, это обычно не рекомендуется. Издатель утверждения не сериализуется в токене. При получении токена издателя всех утверждений свойству Issuer всех утверждений присваивается идентификатор сервера федерации, подписавшего токен. Таким образом, настройка издателя утверждения в правилах не повлияет на содержимое токена, и эта настройка будет потеряна после упаковки утверждения в токене. Единственный сценарий, где настройка издателя утверждения имеет смысл, — когда задано конкретное значение в наборе правил поставщика утверждений и набор правил проверяющей стороны создается из правил, которые ссылаются на это конкретное значение. Если свойству Issuer явно не присвоено значение в правиле утверждения, подсистема выдачи утверждений устанавливает значение LOCAL AUTHORITY (локальный центр).|  
|OriginalIssuer|Как и свойству Issuer, свойству OriginalIssuer значение обычно не назначается явно. В отличие от Issuer, свойство OriginalIssuer сериализуется в токене, но потребители токена ожидают, что если оно задано, то будет содержать идентификатор сервера федерации, изначально выдавшего утверждение.|  
|Свойства|Как описано в предыдущем разделе, контейнер свойств утверждения не сохраняется в токене, поэтому назначения свойств должны выполняться, только если последующие локальные политики будут ссылаться на данные, хранящиеся в свойстве.|  
  
Дополнительные сведения об использовании языка правил утверждений см. в разделе [роль языка правил утверждений](The-Role-of-the-Claim-Rule-Language.md).  
  

