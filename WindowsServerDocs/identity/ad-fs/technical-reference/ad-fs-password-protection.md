---
title: Защита от атак с паролем AD FS
description: В этом документе описано, как защитить пользователей AD FS от атак с использованием пароля.
author: billmath
manager: mtillman
ms.reviewer: andandyMSFT
ms.date: 11/15/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.author: billmath
ms.openlocfilehash: c446ec86d426148836267e29610f86691cf0798a
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/10/2019
ms.locfileid: "70865458"
---
# <a name="ad-fs-password-attack-protection"></a>Защита от атак с паролем AD FS

## <a name="what-is-a-password-attack"></a>Что такое атака с помощью пароля?

Требование федеративного единого входа — это доступность конечных точек для проверки подлинности через Интернет. Доступность конечных точек проверки подлинности в Интернете позволяет пользователям получать доступ к приложениям, даже если они не находятся в корпоративной сети. 

Однако это также означает, что некоторые недопустимые субъекты могут использовать преимущества федеративных конечных точек, доступных в Интернете, и использовать эти конечные точки для проверки паролей или создания атак типа "отказ в обслуживании". Одна из таких атак, которая становится более распространенной, называется **атакой**с помощью пароля. 

Существует два типа распространенных атак на пароли. Парольная атака на распыление паролей & атака методом подбора пароля. 

### <a name="password-spray-attack"></a>Парольная атака на распылителя
При атаке на распылителе пароля эти плохие субъекты будут пытаться использовать наиболее распространенные пароли для многих разных учетных записей и служб, чтобы получить доступ к любым защищенным паролем ресурсам, которые они могут найти. Обычно они охватывают множество различных организаций и поставщиков удостоверений. Например, злоумышленник будет использовать часто доступный набор средств для перечисления всех пользователей в нескольких организациях, а затем попробуем "P @ $ $w 0rd" и "password1" по всем этим учетным записям. Чтобы дать вам идею, атака может выглядеть следующим образом:


|  Целевой пользователь   | Целевой пароль |
|----------------|-----------------|
| User1@org1.com |    Password1    |
| User2@org1.com |    Password1    |
| User1@org2.com |    Password1    |
| User2@org2.com |    Password1    |
|       …        |        …        |
| User1@org1.com |    P @ $ $w 0rd     |
| User2@org1.com |    P @ $ $w 0rd     |
| User1@org2.com |    P @ $ $w 0rd     |
| User2@org2.com |    P @ $ $w 0rd     |

Этот шаблон атаки евадес большинство методов обнаружения, поскольку из точки разных отдельного пользователя или компании атака просто выглядит как изолированный неудачный вход.

Для злоумышленников это номер игры: они узнают, что есть некоторые пароли, которые очень распространены.  Злоумышленник получит несколько успешных попыток для каждой из тысяч учетных записей, и это достаточно для эффективной работы. Они используют эти учетные записи для получения данных из сообщений электронной почты, сбора контактных сведений и отправки фишинговых ссылок или просто расширения целевой группы распылителя паролей. Злоумышленники не очень важны для тех, кто является первоначальными целями — просто они могут использовать их.

Но, выполнив несколько действий для правильной настройки AD FS и сети, AD FS конечные точки могут быть защищены от атак такого типа. В этой статье рассматриваются три области, которые должны быть правильно настроены для защиты от атак.

### <a name="brute-force-password-attack"></a>Принудительная атака методом подбора пароля 
В такой форме злоумышленник будет пытаться выполнить несколько попыток ввода пароля для целевого набора учетных записей. Во многих случаях эти учетные записи будут нацелены на пользователей, имеющих более высокий уровень доступа в Организации. Это могут быть руководители организации или Администраторы, которые управляют критической инфраструктурой.  

Такой тип атаки также может привести к появлению шаблонов DOS. Это может быть на уровне службы, где ADFS не может обработать большое количество запросов из-за недостаточного количества серверов или на уровне пользователя, где пользователь заблокирован из своей учетной записи.  

## <a name="securing-ad-fs-against-password-attacks"></a>Защита AD FS от атак с использованием пароля 

Но, выполнив несколько действий для правильной настройки AD FS и сети, AD FS конечные точки могут быть защищены от атак такого типа. В этой статье рассматриваются три области, которые должны быть правильно настроены для защиты от атак. 


- Уровень 1, базовый: Это основные параметры, которые должны быть настроены на сервере AD FS, чтобы гарантировать, что неправильные субъекты не смогут подвергнуться атаке федеративных пользователей. 
- Уровень 2. Защита экстрасети: Это параметры, которые должны быть настроены для обеспечения доступа к экстрасети для использования безопасных протоколов, политик проверки подлинности и соответствующих приложений. 
- Уровень 3, перемещение к паролю без доступа к экстрасети: Это дополнительные параметры и рекомендации для обеспечения доступа к федеративным ресурсам с более безопасными учетными данными, а не паролями, которые подвержены атакам. 

## <a name="level-1-baseline"></a>Уровень 1. Название

1. Если ADFS 2016, реализуйте интеллектуальную блокировку экстрасети с [Smart-блокировкой](../../ad-fs/operations/Configure-AD-FS-Extranet-Smart-Lockout-Protection.md) экстрасеть, отслеживая привычные расположения и предложит действительному пользователю пройти, если ранее он был успешно зарегистрирован в этом расположении. С помощью Smart-блокировки экстрасети можно гарантировать, что незаконные субъекты не смогут переделать атаки методом подбора, а пользователи и в то же время будут работать с легальным пользователем.
    - Если вы не используете AD FS 2016, настоятельно рекомендуем выполнить [Обновление](../../ad-fs/deployment/upgrading-to-ad-fs-in-windows-server.md) до AD FS 2016. Это простой способ обновления от AD FS 2012 R2. Если вы используете AD FS 2012 R2, реализуйте [блокировку экстрасети](../../ad-fs/operations/Configure-AD-FS-Extranet-Soft-Lockout-Protection.md). Одним из недостатков этого подхода является то, что действительные пользователи могут блокировать доступ к экстрасети, если вы используете шаблон принудительной силы. AD FS на сервере 2016 не имеет этого недостатка.

2. Мониторинг & блокировать подозрительные IP-адреса 
    - Если у вас Azure AD Premium, реализуйте работоспособность Connect для ADFS и используйте уведомления [о рискованных IP-адресах](https://docs.microsoft.com/azure/active-directory/connect-health/active-directory-aadconnect-health-adfs#risky-ip-report-public-preview) , которые он предоставляет.

        1\. Лицензирование не предназначено для всех пользователей и требует 25 лицензий/ADFS/WAP Server, что может быть просто для клиента.

        2\. Теперь вы можете исследовать IP-адреса, создающие большое число неудачных попыток входа.

        В. Для этого потребуется включить аудит на серверах ADFS.

3.  Блокировать подозрительные IP-адреса.  Это потенциально блокирует атаки DOS.

    1\. Если значение равно 2016, используйте функцию [*запрещенные IP-адреса в экстрасети*](../../ad-fs/operations/configure-ad-fs-banned-ip.md) для блокировки запросов с IP-адресов, помеченных #3 (или ручным анализом).

    2\. Если вы используете AD FS 2012 R2 или более ранней версии, заблокируйте IP-адрес непосредственно в Exchange Online и при необходимости в брандмауэре.

4. Если у вас Azure AD Premium, используйте [защиту паролей Azure AD](https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad-on-premises) , чтобы не допустить получение паролей в Azure AD.  

    1\. Обратите внимание, что при наличии подходящих паролей их можно взломать всего за 1-3 попыток. Эта функция не позволяет получить их из набора. 

    2\. Из статистики предварительной версии почти 20-50% новых паролей не заблокировались. Это означает, что% пользователей уязвимы для легкого подбора паролей.

## <a name="level-2-protect-your-extranet"></a>Уровень 2: Защита экстрасети

5. Перейдите к современной проверке подлинности для всех клиентов, обращающихся из экстрасети. Почтовые клиенты являются большой частью этого. 

    1\. Вам потребуется использовать Outlook Mobile для мобильных устройств. Новое почтовое приложение iOS также поддерживает современную проверку подлинности. 

    2\. Необходимо использовать Outlook 2013 (с последними исправлениями CU) или Outlook 2016.

6. Включите MFA для всех обращений в экстрасеть. Это обеспечивает дополнительную защиту доступа к экстрасети.

   1\.  Если у вас есть Azure AD Premium, используйте [политики условного доступа Azure AD](https://docs.microsoft.com/azure/active-directory/conditional-access/overview) для управления этим.  Это лучше, чем реализовать правила на AD FS.  Это связано с тем, что современные клиентские приложения применяются более часто.  Это происходит в Azure AD при запросе нового маркера доступа (обычно каждый час) с помощью маркера обновления.  

   2\.  Если у вас нет Azure AD Premium или у вас есть дополнительные приложения на AD FS, которые разрешают доступ на основе Интернета, реализуйте MFA (это может быть Azure MFA, а также AD FS 2016) и выполните [глобальную политику MFA](../../ad-fs/operations/configure-authentication-policies.md#to-configure-multi-factor-authentication-globally) для всех обращений в экстрасеть.

## <a name="level-3-move-to-password-less-for-extranet-access"></a>Уровень 3. Перейти к паролю меньше для доступа к экстрасети

7. Перейдите в окно 10 и используйте [Hello для бизнеса](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-identity-verification).

8. Для других устройств, если на AD FS 2016, вы можете использовать [OTP Azure MFA](../../ad-fs/operations/configure-ad-fs-and-azure-mfa.md) в качестве первого фактора и пароля в качестве второго фактора. 

9. Для мобильных устройств, если разрешены только управляемые устройства MDM, для входа пользователя в систему можно использовать [Сертификаты](../../ad-fs/operations/configure-user-certificate-authentication.md) . 

## <a name="urgent-handling"></a>Срочное Управление

Если среда AD FS находится в режиме активной атаки, следующие шаги должны быть реализованы в самом раннем случае.

 - Отключите конечную точку U/P в ADFS и попросите каждого пользователя VPN получить доступ или находиться в сети. Для этого требуется, чтобы #1a был выполнен шаг **2** . В противном случае все внутренние запросы Outlook будут по-прежнему направляться через облако через ЕКСО proxy auth.
 - Если атака поступает только через ЕКСО, можно отключить обычную проверку подлинности для протоколов Exchange (POP, IMAP, SMTP, EWS и т. д.) с помощью политик проверки подлинности. Эти протоколы и методы проверки подлинности используются в большинстве этих атак. Кроме того, правила клиентского доступа в ЕКСО и включения протокола почтовых ящиков оцениваются после проверки подлинности и не помогают устранить атаки. 
 - Выборочно предлагать доступ к экстрасети, используя уровень 3 #1-3.

## <a name="next-steps"></a>Следующие шаги

- [Обновление до AD FS Server 2016](../../ad-fs/deployment/upgrading-to-ad-fs-in-windows-server.md) 
- [Интеллектуальная блокировка экстрасети в AD FS 2016](../../ad-fs/operations/Configure-AD-FS-Extranet-Smart-Lockout-Protection.md)
- [Настройка политик условного доступа](https://docs.microsoft.com/azure/active-directory/conditional-access/overview)
- [Защита паролем в Azure AD](https://docs.microsoft.com/azure/active-directory/authentication/howto-password-ban-bad-on-premises)
