---
title: Защита AD FS пароль атаки
description: В этом документе описывается, как для защиты пользователей AD FS от атаки для взлома пароля
author: billmath
manager: mtillman
ms.reviewer: andandyMSFT
ms.date: 11/15/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.author: billmath
ms.openlocfilehash: 5666943138070cfa8cfe62f1ba932c2793daa003
ms.sourcegitcommit: cd12ace92e7251daaa4e9fabf1d8418632879d38
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2019
ms.locfileid: "66501601"
---
# <a name="ad-fs-password-attack-protection"></a>Защита AD FS пароль атаки

## <a name="what-is-a-password-attack"></a>Что такое атака пароля?

Требования для федеративного единого входа заключается в доступности конечных точек для проверки подлинности через Интернет. Доступность конечных точек проверки подлинности в Интернете позволяет пользователям доступ к приложениям, даже если они не находятся в корпоративной сети. 

Тем не менее это также означает, что некоторые недобросовестные можно воспользоваться преимуществами федеративные конечные точки, доступные в Интернете и использовать эти конечные точки, чтобы определить, пароли или создать атак отказа в обслуживании. Одна из таких атак, становится все более распространенной называется **атака пароля**. 

Есть 2 типа распространенных атаках на пароль. Пароль Распылитель атаки & грубой принудительно пароля. 

### <a name="password-spray-attack"></a>Атака пароля Распылитель
Распылитель атаке пароль эти недобросовестных сторон попробует наиболее распространенных простых паролей для многих различных учетных записей и служб для получения доступа к любой ресурсов защищен паролем, которые можно найти. Обычно они охватывают множество разных организаций и поставщиков удостоверений. Например злоумышленник будет использовать это обычно доступен набор средств для перечисления всех пользователей в нескольких организациях, а затем повторите «P@$$w0rd» и «Password1» для всех этих учетных записей. Чтобы предоставить вам идея, атака может выглядеть так:


|  Целевого пользователя   | Целевой объект пароль |
|----------------|-----------------|
| User1@org1.com |    Password1    |
| User2@org1.com |    Password1    |
| User1@org2.com |    Password1    |
| User2@org2.com |    Password1    |
|       …        |        …        |
| User1@org1.com |    P@$$w0rd     |
| User2@org1.com |    P@$$w0rd     |
| User1@org2.com |    P@$$w0rd     |
| User2@org2.com |    P@$$w0rd     |

Этот шаблон атаки просочившихся через большинства методов обнаружения, потому что с точки зрения отдельного пользователя или компании, атака просто выглядит как изолированное неудачных попыток входа.

Для злоумышленников, это игра чисел: они знают, что существуют некоторые пароли, по, которые являются очень общими.  Для каждого тысяч учетных записей атаке злоумышленник получит несколько успешных выполнений и этого достаточно, чтобы быть эффективным. Чтобы получить данные из сообщений электронной почты, собирать контактные данные и отправлять ссылки фишинга или просто разверните целевую группу Распылитель пароль, они используют учетные записи. Злоумышленники не волнует гораздо кто эти начальные целевые объекты — просто, что они имеют некоторые старания, которое они могут использовать.

Но, выполнив несколько шагов, чтобы настроить AD FS и сеть правильно, конечных точек AD FS могут быть защищены от подобных атак. В этой статье рассматриваются 3 области, которые должны быть правильно настроены для защиты от таких атак.

### <a name="brute-force-password-attack"></a>Атака методом подбора пароля 
В такой форме атаки злоумышленник попытается многократные попытки ввода пароля для набора целевых учетных записей. Во многих случаях эти учетные записи будут применяться к пользователям, имеющим более высокий уровень доступа в организации. Это могут быть руководители в рамках организации или "Администраторы", которые управляют критически важной инфраструктуры.  

Этот тип атаки также может привести шаблоны DOS. Это может быть на уровне службы, где не удается обработать большое число запросов из-за недостатка Кол-во серверов служб федерации Active Directory, или может быть на уровне пользователя, где пользователь заблокирован в своей учетной записью.  

## <a name="securing-ad-fs-against-password-attacks"></a>Защита AD FS от атак пароля 

Но, выполнив несколько шагов, чтобы настроить AD FS и сеть правильно, конечных точек AD FS могут быть защищены от подобных атак. В этой статье рассматриваются 3 области, которые должны быть правильно настроены для защиты от таких атак. 


- Уровень 1 базовых показателей. Ниже приведены основные параметры, которые должны быть настроены на сервере AD FS, чтобы убедиться, что недобросовестных сторон нельзя подбора атаки федеративных пользователей. 
- Уровень 2, защита за пределами корпоративной сети. Это параметры, которые должны быть настроены, чтобы убедиться, что доступ к экстрасети настроен для использования безопасных протоколов, политики проверки подлинности и соответствующих приложений. 
- Уровень 3, переход на без пароля для доступа к экстрасети: Это — Дополнительные параметры и правила для включения доступа к федеративным ресурсам с помощью более безопасные учетные данные, а не как пароли, которые являются уязвимым для атак. 

## <a name="level-1-baseline"></a>Уровень 1. Базовый план

1. Если реализовать ADFS 2016 г., [смарт-блокировка экстрасети](../../ad-fs/operations/Configure-AD-FS-Extranet-Smart-Lockout-Protection.md) экстрасети смарт-блокировка отслеживает знакомых и позволит действительным пользователем, которого были переданы через, если они ранее успешно выполнил вход из этого расположения. С помощью смарт-блокировка экстрасети, можно убедиться, что недобросовестных сторон не будет иметь возможность подбора атаках пользователей и в то же время позволит продуктивной законного пользователя.
    - Если вы не в AD FS 2016, мы настоятельно рекомендуем [обновление](../../ad-fs/deployment/upgrading-to-ad-fs-in-windows-server.md) в AD FS 2016. Это простой путь обновления из AD FS 2012 R2. Если вы используете AD FS 2012 R2, реализовать [экстрасети](../../ad-fs/operations/Configure-AD-FS-Extranet-Soft-Lockout-Protection.md). Недостаток этого подхода — допустимые пользователи, которые может блокироваться внешних пользователей, в шаблон подбора. AD FS на Server 2016 не имеет такого недостатка.

2. Монитор & блок подозрительных IP-адресов 
    - Если у вас есть Azure AD Premium, реализовать Connect Health для служб федерации Active Directory и использование [ненадежном IP-адресе отчета](https://docs.microsoft.com/azure/active-directory/connect-health/active-directory-aadconnect-health-adfs#risky-ip-report-public-preview) уведомления, которые он предоставляет.

        1. Лицензирование не для всех пользователей и требует 25 лицензий и ADFS и WAP сервер, который может быть простым для клиента.

        2. Теперь можно изучить IP-адреса, создается большое число неудачных попыток входа

        В. Это потребует для включения аудита на серверах служб федерации Active Directory.

3.  Блокировать подозрительные IP-адреса.  Это потенциально блокирует DOS-атак.

    1. Если на 2016, использовать [ *экстрасети заблокированных IP-адреса* ](../../ad-fs/operations/configure-ad-fs-banned-ip.md) позволяет блокировать все запросы от IP-адреса отмеченные #3 (или ручного анализа).

    2. Если вы используете AD FS 2012 R2 или более ранней версии, блокировать IP-адрес непосредственно в Exchange Online и при необходимости в брандмауэре.

4. Если у вас есть Azure AD Premium, использовать [защиты паролей Azure AD](https://docs.microsoft.com/azure/active-directory/authentication/concept-password-ban-bad-on-premises) и предотвратить угадать пароли с Azure AD  

    1. Обратите внимание на то, что при наличии угадать пароли с попыток только 1 – 3 можно взломать их. Эта функция предотвращает их из начало набора. 

    2. Из наших stats предварительной версии почти 20-50% от новые пароли блокируются предотвратить настройку. Это означает, что % пользователей уязвимым к паролям, легко подобрать.

## <a name="level-2-protect-your-extranet"></a>Уровень 2. Защита вашей экстрасети

5. Переместите современную проверку подлинности для всех клиентов, доступ из экстрасети. Почтовые клиенты являются важной частью. 

    1. Необходимо будет использовать Outlook Mobile для мобильных устройств. Новый встроенное почтовое приложение iOS поддерживает также современная проверка подлинности. 

    2. Необходимо будет использовать Outlook 2013 (с последними исправлениями накопительное обновление) или Outlook 2016.

6. Включите многофакторную проверку Подлинности для всех доступа через экстрасеть. Это предоставляет дополнительные возможности защиты для любого доступа к экстрасети.

   1.  Если у вас есть Azure AD уровня "премиум", используйте [политики условного доступа Azure AD](https://docs.microsoft.com/azure/active-directory/conditional-access/overview) для управления этим процессом.  Это лучше, чем реализация правилами в AD FS.  Это обусловлено тем, современные клиентские приложения, действуют на более регулярной основе.  В этом случае в Azure AD, при запросе нового маркера доступа (обычно каждый час) с помощью токена обновления.  

   2.  Если у вас нет Azure AD premium, имеют доступ на основе дополнительных приложений в AD FS, которые позволяют internet реализации многофакторной проверки Подлинности (может быть Azure MFA также в AD FS 2016) и выполните [глобальную политику многофакторной проверки Подлинности](../../ad-fs/operations/configure-authentication-policies.md#to-configure-multi-factor-authentication-globally) для всех доступа через экстрасеть.

## <a name="level-3-move-to-password-less-for-extranet-access"></a>Уровень 3. Переход на пароль меньше для доступа к экстрасети

7. Переместите в Windows 10 и используйте [Hello для бизнеса](https://docs.microsoft.com/windows/security/identity-protection/hello-for-business/hello-identity-verification).

8. Для других устройств, если в AD FS 2016, можно использовать [Azure многофакторной проверки Подлинности OTP](../../ad-fs/operations/configure-ad-fs-and-azure-mfa.md) как первый фактор и пароль, что второй фактор. 

9. Для мобильных устройств, если допускается только управляемым устройствам MDM, можно использовать [сертификаты](../../ad-fs/operations/configure-user-certificate-authentication.md) вход пользователя. 

## <a name="urgent-handling"></a>Срочной обработки

Если среда AD FS находится под атакой active, как можно скорее должны быть реализованы следующие действия:

 - Отключить конечную точку U/P в службах ADFS и требуют все виртуальной частной сети, чтобы получить доступ, либо быть локальной сети. Это требует наличия шаг **уровня 2 #1a** завершена. В противном случае все внутренних запросов Outlook по-прежнему проходит через облако с помощью проверки подлинности прокси-сервера EXO
 - Если атака только поступают через EXO, вы можете отключить обычную проверку подлинности для протоколов обмена (POP, IMAP, SMTP, EWS т. д) с помощью политики проверки подлинности, эти протоколы и методы проверки подлинности, используемых на большинство из этих атак. Кроме того правила клиентского доступа в EXO и -mailbox Включение протокола, вычисленное после проверки подлинности и она не поможет на Противостояние атакам. 
 - Выборочно предоставляют доступ к экстрасети с помощью уровня 3 #1-3.

## <a name="next-steps"></a>Следующие шаги

- [Обновление до сервера AD FS 2016](../../ad-fs/deployment/upgrading-to-ad-fs-in-windows-server.md) 
- [Блокировка экстрасети смарт-в AD FS 2016](../../ad-fs/operations/Configure-AD-FS-Extranet-Smart-Lockout-Protection.md)
- [Настройка политик условного доступа](https://docs.microsoft.com/azure/active-directory/conditional-access/overview)
- [Защита паролей Azure AD](https://docs.microsoft.com/azure/active-directory/authentication/howto-password-ban-bad-on-premises)
