---
ms.assetid: b734cbcb-342c-4a28-8ab5-b9cd990bb1c2
title: "Когда следует использовать правило авторизации утверждений"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 144e382692e8f2a6732f8c7c5b8a1dd6049192cb
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

# <a name="when-to-use-an-authorization-claim-rule"></a>Когда следует использовать правило авторизации утверждений
Это правило можно использовать в \(AD FS\) служб федерации Active Directory, когда вам нужно принять тип входящего утверждения и затем применить действие, которое определяет, будет ли пользователь будет разрешен или запрещен доступ на основе значения, указанного в правиле. При использовании этого правила вы пропускаете или преобразования утверждений, которые соответствуют следующей логике правила, на основе одного из параметров, настроенных в правиле:  
  
|Правило|Логика правила|  
|---------------|--------------|  
|Разрешить всем пользователям|Если входящее утверждение имеет тип *любой тип утверждения* и значение равно *любое значение*, выдается утверждение со значением *разрешить*|  
|Разрешить доступ пользователям с данным входящим утверждением|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *заданное значение утверждения*, выдается утверждение со значением *разрешить*|  
|Запретить доступ пользователям с данным входящим утверждением|Если входящее утверждение имеет тип *указанному типу утверждения* и значение равно *заданное значение утверждения*, выдается утверждение со значением *запретить*|  
  
В следующих разделах содержатся основные сведения о правилах утверждений и предоставляются дополнительные сведения об использовании этого правила.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, который будет делать входящее утверждение, применяет к нему условие \ (если x затем y\) и создает исходящее утверждения на основе параметров условия. В следующем списке перечислены важные советы, которые нужно знать о правилах утверждений, перед прочтением дальнейших в этом разделе:  
  
-   В оснастка управления AD FS правил для утверждений можно создавать только с помощью шаблонов правил для утверждений  
  
-   Процесс правил утверждений входящие утверждения либо непосредственно от поставщика утверждений \ (например, Active Directory или другим служба\текущих федерации), либо из выходных данных принятия преобразования правила для отношения доверия поставщика утверждений.  
  
-   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнить или отфильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
  
-   Шаблоны правил утверждения всегда требуют указывать тип входящего утверждения. Тем не менее можно обрабатывать несколько значений утверждений с одним типом утверждения, используя одно правило.  
  
Дополнительные сведения о правилах утверждений и наборах правил утверждений см. в разделе [роль правил утверждений](The-Role-of-Claim-Rules.md). Дополнительные сведения об обработке правил см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md). Дополнительные сведения об обработке наборов правил утверждений см. в разделе [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="permit-all-users"></a>Разрешить всем пользователям  
При использовании шаблона правила разрешения всех пользователей, все пользователи будут иметь доступ к проверяющей стороне. Тем не менее можно использовать дополнительные правила авторизации для ограничения доступа. Если хотя бы одно правило разрешает пользователю доступ к проверяющей стороне, а другое правило запрещает пользователю доступ к проверяющей стороне, в результате отказа переопределяет в результате разрешения, и пользователю будет отказано в доступе.  
  
Пользователи, которым разрешен доступ к проверяющей стороне из службы федерации могут по-прежнему будет отказ в обслуживании проверяющей стороной.  
  
## <a name="permit-access-to-users-with-this-incoming-claim"></a>Разрешить доступ пользователям с данным входящим утверждением  
При использовании разрешать или запрещать пользователям на основе на основе шаблона правила входящего утверждения для создания правила и установки условия для разрешения, вы можете разрешить доступ конкретного пользователя к проверяющей стороне на основе типа и значения входящего утверждения. Например этот шаблон правила можно использовать для создания правила, которое разрешает доступ только пользователям, имеющим утверждение о группе со значением "Администраторы домена". Если хотя бы одно правило разрешает пользователю доступ к проверяющей стороне, а другое правило запрещает пользователю доступ к проверяющей стороне, в результате отказа переопределяет в результате разрешения, и пользователю будет отказано в доступе.  
  
Пользователи, которым разрешен доступ к проверяющей стороне из службы федерации могут по-прежнему будет отказ в обслуживании проверяющей стороной. Если вы хотите разрешить всем пользователям доступ к проверяющей стороне, используйте шаблона правила разрешения всех пользователей.  
  
## <a name="deny-access-to-users-with-this-incoming-claim"></a>Запретить доступ пользователям с данным входящим утверждением  
При использовании разрешать или запрещать пользователям на основе на основе шаблона правила входящего утверждения для создания правила и установки условия для запрета, вы можете запретить доступ пользователя к проверяющей стороне на основе типа и значения входящего утверждения. Например можно использовать этот шаблон правила, чтобы создать правило, которое запрещает доступ всем пользователям, имеющим группу утверждение со значением пользователей домена.  
  
Если вы хотите использовать условие запрета, но также предоставить доступ к проверяющей стороне для конкретных пользователей, необходимо позднее явно добавить правила авторизации с условием разрешения, чтобы разрешить этим пользователям доступ к проверяющей стороне.  
  
Если пользователю отказано в доступе при подсистема выдачи утверждений обрабатывает набор правил, дальнейшие обработка правил завершает работу и AD FS возвращает ошибку «Доступ запрещен» запроса пользователя.  
  
## <a name="authorizing-users"></a>Авторизация пользователей  
В AD FS правил авторизации используются для выдачи запрещающего или разрешающего утверждения, которое определяет, будет ли пользователь или группа пользователей \ (в зависимости от used\ тип утверждения) будет разрешен доступ к веб-ресурсам в данной проверяющей стороны или нет. Правила авторизации можно настроить только в отношениях доверия с проверяющей стороной.  
  
### <a name="authorization-rule-sets"></a>Наборы правил авторизации  
Разные наборы правил авторизации существуют в зависимости от типа операций разрешения или запрещения, которые необходимо настроить. Эти наборы правил включают следующие:  
  
-   **Правила авторизации выдачи**: эти правила определяют, является ли пользователь получать утверждения для проверяющей стороны и, таким образом, получать доступ к проверяющей стороне.  
  
-   **Правила авторизации делегирования**: эти правила определяют, может ли пользователь выступать от имени другого пользователя для проверяющей стороны. Когда пользователь действует от имени другого пользователя, утверждения о запрашивающем пользователе по-прежнему помещаются в токен.  
  
-   **Правила авторизации олицетворения**: эти правила определяют, является ли пользователь полностью олицетворять другого пользователя для проверяющей стороны. Олицетворение другого пользователя — очень мощная возможность, поскольку проверяющая сторона не знает, что пользователь олицетворяется.  
  
Дополнительные сведения о том, как процесс правил авторизации применяется в конвейере выдачи утверждений см. в разделе роль подсистемы выдачи утверждений.  
  
### <a name="supported-claim-types"></a>Поддерживаемые типы утверждений  
AD FSdefines два утверждений типов, которые используются для определения, разрешен или запрещен пользователь. Эти типы универсальные коды ресурсов \(URIs\) таковы утверждений.  
  
1.  **Разрешить**: http:///\/schemas.microsoft.com\/authorization\/claims\/permit  
  
2.  **Запретить**: http:///\/schemas.microsoft.com\/authorization\/claims\/deny  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
Можно создать оба правила авторизации с помощью языка правил утверждений или **разрешить всем пользователям** шаблона правила или **разрешать или запрещать пользователям на основании входящего утверждения** шаблона правила в управления AD FS оснастка. Шаблон правила разрешить всем пользователям, не поддерживает все параметры конфигурации. Тем не менее разрешать или запрещать пользователям на основании шаблона правила входящего утверждения предоставляет следующие параметры конфигурации.  
  
-   Указание имени правила утверждения  
  
-   Укажите тип входящего утверждения  
  
-   Введите значение входящего утверждения  
  
-   Разрешить доступ пользователям с данным входящим утверждением  
  
-   Запретить доступ пользователям с данным входящим утверждением  
  
Дополнительные инструкции по созданию этого шаблона см. в разделе [создать правило, чтобы разрешить всем пользователям](https://technet.microsoft.com/library/ee913577.aspx) или [создать правило для разрешения или запрета пользователям на основе входящего утверждения](https://technet.microsoft.com/library/ee913594.aspx) в руководстве по развертыванию AD FS.  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
Если утверждение должно отправляться только в том случае, когда значение утверждения соответствует настраиваемому шаблону, необходимо использовать настраиваемое правило. Дополнительные сведения см. в разделе [When to Use a Custom Claim Rule](When-to-Use-a-Custom-Claim-Rule.md).  
  
### <a name="example-of-how-to-create-an-authorization-rule-based-on-multiple-claims"></a>Пример создания правила авторизации на основе нескольких утверждений  
При использовании синтаксиса языка правил утверждений для авторизации утверждений, утверждения могут выдаваться на основе наличия нескольких утверждений в исходных утверждениях пользователя. Следующее правило выдает утверждение авторизации только в том случае, если пользователь является членом группы редакторов и прошел проверку подлинности Windows:  
  
```  
[type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/authenticationmethod",   
value == "urn:federation:authentication:windows" ]  
&& [type == "http://schemas.xmlsoap.org/claims/Group ", value == “editors”]   
=> issue(type = "http://schemas.xmlsoap.org/claims/authZ", value = "Granted");  
```  
  
### <a name="example-of-how-to-create-authorization-rules-that-will-delegate-who-can-create-or-remove-federation-server-proxy-trusts"></a>Пример для создания авторизации правил, которые будут делегировать, кто может создавать или удалять отношения доверия прокси-сервера сервера федерации  
Прежде чем служба федерации сможет использовать прокси-сервера федерации для перенаправления клиентских запросов, отношения доверия должны быть установлены между службой федерации и прокси-серверов федерации. По умолчанию отношение доверия прокси-сервера устанавливается при предоставлении либо из следующих учетных данных успешно мастер настройки прокси-сервера AD FS федерации:  
  
-   Учетную запись службы, используемый службой федерации, которую будет защищать прокси-сервера  
  
-   Учетной записи домена Active Directory, которая является членом локальной группы администраторов на всех серверах федерации в ферме серверов федерации  
  
Если требуется указать, какие пользователи могут создавать доверия прокси-сервера для конкретной службы федерации, можно использовать любой из следующих методов делегирования. Этот список методов составлен в порядке приоритета на основе рекомендаций группы разработчиков AD FS по наиболее безопасным и наименее проблемным методам делегирования. Это необходимо использовать только один из этих методов, в зависимости от потребностей вашей организации:  
  
1.  Создайте группу безопасности домена в Active Directory \ (например, FSProxyTrustCreators\), добавьте ее в группе локальных администраторов на каждом из серверов федерации в ферме, а затем добавьте только учетные записи пользователей, для которых вы хотите делегировать это право, в новую группу. Это предпочтительный метод.  
  
2.  Добавьте учетную запись пользователя домена в группу администраторов на каждом из серверов федерации в ферме.  
  
3.  Если по какой-либо причине не может использовать один из этих методов, можно также создать правило авторизации для этой цели. Хотя это не рекомендуется — из-за вероятных сложностей, которые могут возникнуть, если это правило не записано правильно — правило настраиваемой авторизации можно использовать для делегирования какие Active Directory, можно также создать или даже удаления отношений доверия между всех прокси-серверов федерации, связанные с данной службой федерации учетных записей пользователей домена.  
  
    При выборе метода 3, можно использовать следующий синтаксис правила для выдачи утверждения авторизации, которое позволит указанному пользователю \ (в данном случае contoso\\frankm\) создавать отношения доверия для одного или нескольких федерации, прокси-серверов в службе федерации. Вы должны применить это правило, с помощью команды Windows PowerShell **Set\-ADFSProperties AddProxyAuthorizationRules**.  
  
    ```  
    c:[Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname", issuer=~"^AD AUTHORITY$" value == "contoso\frankm" ] => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "true")  
  
    exists([Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid", Value == "S-1-5-32-544", Issuer =~ "^AD AUTHORITY$"])   
    => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "true");  
  
    c:[Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid", Issuer =~ "^AD AUTHORITY$" ] => issue(store="_ProxyCredentialStore",types=("https://schemas.microsoft.com/authorization/claims/permit"),query="isProxyTrustManagerSid({0})", param= c.Value );  
  
    c:[Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/proxytrustid", Issuer =~ "^SELF AUTHORITY$" ] => issue(store="_ProxyCredentialStore",types=("https://schemas.microsoft.com/authorization/claims/permit"),query="isProxyTrustProvisioned({0})", param=c.Value );  
    ```  
  
    Позже Если вы хотите удалить пользователя, чтобы пользователь больше не мог создавать отношения доверия прокси-сервера, можно вернуться к правилу авторизации доверия прокси-сервера по умолчанию для удаления право пользователя на создание отношений доверия прокси-сервера для службы федерации. Вы также должны применить это правило с помощью команды Windows PowerShell **Set\-ADFSProperties AddProxyAuthorizationRules**.  
  
    ```  
    exists([Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid", Value == "S-1-5-32-544", Issuer =~ "^AD AUTHORITY$"])   
    => issue(Type = "https://schemas.microsoft.com/authorization/claims/permit", Value = "true");  
  
    c:[Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid", Issuer =~ "^AD AUTHORITY$" ] => issue(store="_ProxyCredentialStore",types=("https://schemas.microsoft.com/authorization/claims/permit"),query="isProxyTrustManagerSid({0})", param= c.Value );  
  
    c:[Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/proxytrustid", Issuer =~ "^SELF AUTHORITY$" ] => issue(store="_ProxyCredentialStore",types=("https://schemas.microsoft.com/authorization/claims/permit"),query="isProxyTrustProvisioned({0})", param=c.Value );  
    ```  
  
Дополнительные сведения об использовании языка правил утверждений см. в разделе [роль языка правил утверждений](The-Role-of-the-Claim-Rule-Language.md).  
  

