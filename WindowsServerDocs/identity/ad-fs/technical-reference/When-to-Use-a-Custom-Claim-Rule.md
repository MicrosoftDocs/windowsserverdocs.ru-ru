---
ms.assetid: 20d183f0-ef94-44bb-9dfc-ed93799dd1a6
title: "Когда следует использовать настраиваемое правило для утверждений"
description: 
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: f5398f0b10d9e62548145fdde0354a3d047eb0ae
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
>Область применения: Windows Server 2016, Windows Server 2012 R2, Windows Server 2012

# <a name="when-to-use-a-custom-claim-rule"></a>Когда следует использовать настраиваемое правило для утверждений
Запись настраиваемое правило для утверждений в \(AD FS\) служб федерации Active Directory с помощью языка правил утверждений, являющегося платформой, которая используется подсистемой выдачи утверждений для программного создания, преобразования, пропуска и фильтрации утверждений. С помощью настраиваемого правила, можно создавать правила с более сложной логикой, чем со стандартным шаблоном правила. Рассмотрите возможность использования настраиваемого правила, когда требуется:  
  
-   Отправьте утверждения на основе значений, извлекаемых из хранилища атрибутов языка SQL \(SQL\).  
  
-   Отправьте утверждения на основе значений, извлекаемых из хранилища атрибутов протокола LDAP \(LDAP\), с помощью настраиваемого фильтра LDAP.  
  
-   Отправьте утверждения на основе значений, извлекаемых из настраиваемого хранилища атрибутов.  
  
-   Отправка утверждения только в том случае, если имеется не менее двух входящих утверждений.  
  
-   Отправка утверждения только в том случае, если входящее значение утверждения соответствует сложному шаблону.  
  
-   Отправьте утверждения со сложными изменениями входящего утверждения на значение.  
  
-   Создайте утверждения для использования только в последующих правилах, без фактической отправки этих утверждений.  
  
-   Стройте исходящее утверждение на основе содержимого нескольких входящих утверждений.  
  
Можно также использовать настраиваемое правило, когда значение исходящего утверждения должно строиться на значении входящего утверждения, но его необходимо также включить дополнительное содержимое.  
  
Язык правил для утверждений — на основе правил. Он имеет часть условий и выполняемую часть. Можно использовать синтаксис языка правил утверждений для перечислять, добавлять, удалять или изменять утверждения в соответствии с потребностями вашей организации. Дополнительные сведения о том, как они работают части см. в разделе [роль языка правил утверждений ](The-Role-of-the-Claim-Rule-Language.md).  
  
В следующих разделах содержатся основные сведения о правилах утверждений. В них также говорится о том, когда следует использовать настраиваемое правило для утверждений.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, который принимает входящее утверждение, применяет к нему условие \ (если x, затем y\) и создает исходящее утверждения на основе параметров условия.  
  
> [!IMPORTANT]  
> -   В оснастка управления AD FS утверждений, правила можно создавать только с помощью шаблонов правил для утверждений  
> -   Процесс правил утверждений входящие утверждения либо непосредственно от поставщика утверждений \ (например, Active Directory или другим служба\текущих федерации), либо из выходных данных принятия преобразования правила для отношения доверия поставщика утверждений.  
> -   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнить или отфильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
> -   Шаблоны правил утверждения всегда требуют указывать тип входящего утверждения. Тем не менее можно обрабатывать несколько значений утверждений с одним типом утверждения с помощью одного правила.  
  
Дополнительные сведения о правилах утверждений и наборах правил утверждений см. в разделе [роль правил утверждений](The-Role-of-Claim-Rules.md). Дополнительные сведения об обработке правил см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md). Дополнительные сведения об обработке наборов правил утверждений см. в разделе [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
При создании правила сначала разрабатывается синтаксис, необходимый для операции, с помощью языка правил утверждений и затем этот результат вставляется в текстовое поле, которое предоставляется в отправки утверждений с помощью настраиваемого правила в свойствах поставщика утверждений доверия или доверия проверяющей стороны в управления AD FS оснастка.  
  
Этот шаблон правила предоставляет следующие параметры:  
  
-   Указание имени правила утверждения  
  
-   Введите один или несколько необязательных условий и инструкцию выдачи с помощью Служб федерации Active Directory языка правил для утверждений  
  
Дополнительные инструкции для создания настраиваемого правила с помощью этого шаблона см. в разделе [Создание правила для отправки утверждений с помощью настраиваемого правила](https://technet.microsoft.com/library/dd807049.aspx) в руководстве по развертыванию AD FS.  
  
Для лучшего понимания принципов работы языка правил утверждений, просмотрите синтаксис языка правил утверждений в других правилах, которые уже существуют в оснастка, щелкнув **Просмотр языка правила** в окне свойств для этого правила. Используя сведения данного раздела и информацию о синтаксисе на этой вкладке можно глубже понять процесс создания собственных настраиваемых правил.  
  
Дополнительные сведения об использовании языка правил утверждений см. в разделе [роль языка правил утверждений](The-Role-of-the-Claim-Rule-Language.md).  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
  
### <a name="example-how-to-combine-first-and-last-names-based-on-a-users-name-attribute-values"></a>: Пример объединение имени и фамилии на основе значений атрибутов имени пользователя  
Следующий синтаксис правила объединяет имена и фамилии из значений атрибутов в указанном хранилище атрибутов. Обработчик политик формируют декартово произведение совпадений для каждого условия. Например выходные данные для имен {«Михаил», «Алексей»} и фамилий {«Иванов», «Климов»} — {«Михаил Иванов», «Михаил Климов», «Алексей Иванов», «Алексей Климов»}:  
  
```  
c1:[type == "http://exampleschema/firstname" ]  
&&  c2:[type == "http://exampleschema/lastname",]   
=> issue(type = "http://exampleschema/name", value = c1.value + “  “ + c2.value);  
```  
  
### <a name="example-how-to-issue-a-manager-claim-based-on-whether-users-have-direct-reports"></a>: Пример выдача утверждения manager, в зависимости от наличия у пользователей подчиненных  
Следующее правило выдает руководителе только в том случае, если пользователь имеет подчиненных.  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] => add(store = "SQL Store", types = ("http://schemas.xmlsoap.org/claims/Reports"), query = "SELECT Reports FROM dbo.DirectReports WHERE UserName = {0}", param = c.value );  
count([type == “http://schemas.xmlsoap.org/claims/Reports“] ) > 0 => issue(= "http://schemas.xmlsoap.org/claims/ismanager", value = "true");  
```  
  
### <a name="example-how-to-issue-a-ppid-claim-based-on-an-ldap-attribute"></a>: Пример выдача утверждения PPID на основе атрибута LDAP  
Следующее правило выдает утверждение частного личный идентификатор \(PPID\), на основе **windowsaccountname** и **originalissuer** атрибутов пользователей в хранилище атрибутов LDAP:  
  
```  
c:[Type == "https://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname"]  
 => issue(store = "_OpaqueIdStore", types = ("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier"), query = "{0};{1};{2}", param = "ppid", param = c.Value, param = c.OriginalIssuer);  
```  
  
Следующие общие атрибуты, которые можно использовать для однозначной идентификации пользователя для данного запроса.  
  
-   **SID пользователя**  
  
-   **windowsaccountname**  
  
-   **samAccountName**  
  

