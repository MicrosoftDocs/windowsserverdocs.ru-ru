---
ms.assetid: 20d183f0-ef94-44bb-9dfc-ed93799dd1a6
title: Когда следует использовать настраиваемое правило для утверждений
description: ''
author: billmath
ms.author: billmath
manager: femila
ms.date: 05/31/2017
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: e566de4df2895dfa2ed1104f85c1429881ff5bbf
ms.sourcegitcommit: 0b5fd4dc4148b92480db04e4dc22e139dcff8582
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/24/2019
ms.locfileid: "66188289"
---
# <a name="when-to-use-a-custom-claim-rule"></a>Когда следует использовать настраиваемое правило для утверждений
Написать пользовательское правило утверждения в службах федерации Active Directory \(AD FS\) с помощью языка правил утверждений, являющегося платформой, который использует подсистема выдачи утверждений программное создание, преобразование, проходят через и фильтрации утверждения. Используя настраиваемое правило, вы можете создавать правила с более сложной логикой, чем с помощью стандартного шаблона правил. Рассмотрите возможность использования настраиваемого правила, когда требуется выполнять следующее.  
  
-   Отправлять утверждения на основе значений, извлеченных из языка SQL \(SQL\) хранилище атрибутов.  
  
-   Отправлять утверждения на основе значений, извлеченных из Lightweight Directory Access Protocol \(LDAP\) хранилище атрибутов, используя настраиваемый фильтр LDAP.  
  
-   Отправлять утверждения на основе значений, извлекаемых из настраиваемого хранилища атрибутов.  
  
-   Отправлять утверждения только в том случае, если имеется не менее двух входящих утверждений.  
  
-   Отправка утверждения только в том случае, если значение входящего утверждения соответствует сложному шаблону.  
  
-   Отправлять утверждения со сложными изменениями значения входящего утверждения.  
  
-   Создавать утверждения для использования только в последующих правилах, без фактической отправки этих утверждений.  
  
-   Строить исходящее утверждение на основе содержимого нескольких входящих утверждений.  
  
Вы также можете использовать настраиваемое правило, когда значение исходящего утверждения должно строиться на значении входящего утверждения, но с дополнительным содержимым.  
  
Язык правил для утверждений основывается на правилах. Он имеет часть условий и выполняемую часть. Используя синтаксис языка правил для утверждений, вы можете перечислять, добавлять, удалять или изменять утверждения в соответствии с потребностями вашей организации. Дополнительные сведения о том, как эти части работает, см. в разделе [роль языка правил утверждений](The-Role-of-the-Claim-Rule-Language.md).  
  
В следующих разделах содержатся основные сведения о правилах утверждений. В них также говорится о том, когда следует использовать настраиваемые правила для утверждений.  
  
## <a name="about-claim-rules"></a>Общие сведения о правилах утверждения  
Правило утверждения представляет экземпляр бизнес-логики, который принимает входящее утверждение, применить условие к нему \(if x, то y\) и Создание исходящего утверждения на основе параметров условия.  
  
> [!IMPORTANT]  
> -   В консоли управления AD FS\-, утверждения, правила можно создавать только с помощью шаблонов правил для утверждений  
> -   Процесс правила утверждений входящие утверждения либо непосредственно от поставщика утверждений \(например Active Directory или другой службы федерации\) или из выходных данных принятия отношения доверия поставщика утверждений правил преобразования.  
> -   Правила утверждений обрабатываются подсистемой выдачи утверждений в хронологическом порядке в пределах заданного набора правил. Установив приоритет правил, можно дополнительно уточнять или фильтровать утверждения, созданные предыдущими правилами в данном наборе правил.  
> -   Шаблоны правил для утверждений всегда требуют указывать тип входящего утверждения. Однако вы можете обрабатывать несколько значений утверждений с одним типом утверждения, используя одно правило.  
  
Более подробные сведения о правилах для утверждений и наборах правил утверждений, см. в разделе [The Role of Claim Rules](The-Role-of-Claim-Rules.md). Дополнительные сведения об обработке правил см. в разделе [The Role of the Claims Engine](The-Role-of-the-Claims-Engine.md). Дополнительные сведения, как обрабатываются наборов правил утверждений, см. в разделе [The Role of the Claims Pipeline](The-Role-of-the-Claims-Pipeline.md).  
  
## <a name="how-to-create-this-rule"></a>Создание правила  
Создании этого правила сначала разрабатывается синтаксис, необходимый для операции с помощью языка правил утверждений и затем вставить результат в текстовое поле, то есть в отправки утверждений с помощью настраиваемого правила шаблона от поставщика утверждений свойств tr ust или проверяющая сторона доверия в консоли управления AD FS\-в.  
  
Этот шаблон правил предоставляет следующие возможности.  
  
-   указание имени правила утверждения;  
  
-   Введите один или несколько дополнительных условий и заявление на размещение с помощью AD FS языка правил для утверждений  
  
Дополнительные сведения о создании настраиваемого правила с помощью этого шаблона, см. в разделе [создать правило, чтобы отправлять утверждения с помощью настраиваемого правила](https://technet.microsoft.com/library/dd807049.aspx) в руководстве по развертыванию AD FS.  
  
Для лучшего понимания принципов работы языка правил утверждений, просмотр синтаксиса языка правил утверждений других правил, которые уже существуют в консоли\-в, щелкнув **Просмотр языка правила** окна свойств для этого правила. Используя сведения данного раздела и информацию о синтаксисе на этой вкладке, можно глубже понять процесс создания собственных настраиваемых правил.  
  
Дополнительные сведения об использовании языка правил утверждений см. в разделе [роль языка правил утверждений](The-Role-of-the-Claim-Rule-Language.md).  
  
## <a name="using-the-claim-rule-language"></a>С помощью языка правил утверждений  
  
### <a name="example-how-to-combine-first-and-last-names-based-on-a-users-name-attribute-values"></a>Пример. Объединение имени и фамилии на основе значений атрибутов имени пользователя  
Следующий синтаксис правила объединяет имена и фамилии из значений атрибутов в указанном хранилище атрибутов. Обработчик политик формируют декартово произведение совпадений для каждого условия. Например, выходной результат для имен {«Михаил», «Алексей»} и фамилий {«Иванов», «Климов»} — {«Михаил Иванов», «Михаил Климов», «Алексей Иванов», «Алексей Климов»}.  
  
```  
c1:[type == "http://exampleschema/firstname" ]  
&&  c2:[type == "http://exampleschema/lastname",]   
=> issue(type = "http://exampleschema/name", value = c1.value + “  “ + c2.value);  
```  
  
### <a name="example-how-to-issue-a-manager-claim-based-on-whether-users-have-direct-reports"></a>Пример. Выдача утверждения о руководителе на основе наличия у пользователей подчиненных  
Следующее правило выдает утверждение о руководителе только в том случае, если пользователь имеет подчиненных.  
  
```  
c:[type == "http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name"] => add(store = "SQL Store", types = ("http://schemas.xmlsoap.org/claims/Reports"), query = "SELECT Reports FROM dbo.DirectReports WHERE UserName = {0}", param = c.value );  
count([type == “http://schemas.xmlsoap.org/claims/Reports“] ) > 0 => issue(= "http://schemas.xmlsoap.org/claims/ismanager", value = "true");  
```  
  
### <a name="example-how-to-issue-a-ppid-claim-based-on-an-ldap-attribute"></a>Пример. Выдача утверждения PPID на основе атрибута LDAP  
Следующее правило выдает идентификатор Personal Private \(PPID\) на основе утверждений **windowsaccountname** и **originalissuer** атрибутов пользователей в атрибут LDAP хранилище:  
  
```  
c:[Type == "http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname"]  
 => issue(store = "_OpaqueIdStore", types = ("http://schemas.xmlsoap.org/ws/2005/05/identity/claims/privatepersonalidentifier"), query = "{0};{1};{2}", param = "ppid", param = c.Value, param = c.OriginalIssuer);  
```  
  
Ниже перечислены общие атрибуты, которые могут использоваться для идентификации пользователя для данного запроса.  
  
-   **Идентификатор безопасности пользователя**  
  
-   **windowsaccountname**  
  
-   **samAccountName**  
  

