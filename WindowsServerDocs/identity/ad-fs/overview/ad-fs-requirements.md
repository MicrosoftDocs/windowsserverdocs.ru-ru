---
ms.assetid: 28f4a518-1341-4a10-8a4e-5f84625b314b
title: Требования к AD FS 2016
description: Требования для установки служб федерации Active Directory.
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 03/06/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: e62032533b15ec3d93896d242273612faafdca58
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66444105"
---
# <a name="ad-fs-requirements"></a>Требования AD FS



Ниже приведены требования к развертыванию AD FS.  
  
-   [Требования к сертификатам](ad-fs-requirements.md#BKMK_1)  
  
-   [Требования к оборудованию](ad-fs-requirements.md#BKMK_2)  
  
-   [Требования к прокси-сервера](ad-fs-requirements.md#BKMK_3)  
  
-   [Требования к AD DS](ad-fs-requirements.md#BKMK_4)  
  
-   [Требования к базе данных конфигурации](ad-fs-requirements.md#BKMK_5)  
  
-   [Требования к браузеру](ad-fs-requirements.md#BKMK_6)  

-   [Требования к сети](ad-fs-requirements.md#BKMK_7)  
  
-   [Требования к разрешениям](ad-fs-requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>Требования к сертификатам  
  
### <a name="ssl-certificates"></a>SSL-сертификаты

Каждый сервер AD FS и прокси веб-приложения имеет сертификат SSL для обслуживания запросов HTTPS в службу федерации.  Прокси веб-приложения может иметь дополнительные сертификаты SSL для обслуживания запросов к опубликованным приложениям.

**Рекомендация:** Используйте один и тот же сертификат SSL для всех серверов федерации AD FS и прокси-серверы веб-приложения. 

**Требования:**

SSL-сертификаты на серверах федерации должен соответствовать следующим требованиям
- Сертификат является общедоступный доверенный (для развертывания в рабочей среде)
- Сертификат содержит значение сервера проверки подлинности расширенного использования ключа (EKU)
- Сертификат содержит имя службы федерации, например «fs.contoso.com» в теме или альтернативного имени субъекта (SAN)
- Для проверки подлинности сертификата пользователя через порт 443 сертификат содержит «certauth. \<имя службы федерации\>«, например «certauth.fs.contoso.com» в сети SAN
- Для регистрации устройств или для современной проверки подлинности для локальных ресурсов с помощью клиентов пред-Windows 10 сети хранения данных должен содержать «enterpriseregistration. \<суффикс имени участника-пользователя\>«для каждого суффикса имени участника-пользователя, для которого используется в вашей организации.

SSL-сертификатов на прокси веб-приложения должен соответствовать следующим требованиям
- Если прокси-сервер используется для запросов прокси-сервера AD FS, которые используют Windows встроенной проверки подлинности, SSL-сертификат прокси-сервера должен совпадать с (использовать тот же ключ) SSL-сертификата сервера федерации
- Если свойство AD FS — «ExtendedProtectionTokenCheck» включено (по умолчанию в AD FS), SSL-сертификат прокси-сервера должен совпадать с (использовать тот же ключ) SSL-сертификата сервера федерации
- В противном случае требования к SSL-сертификат прокси-сервера одинаковы как для SSL-сертификата сервера федерации

### <a name="service-communication-certificate"></a>Сертификат взаимодействия служб
Этот сертификат не является обязательным для большинства сценариев AD FS, включая Azure AD и Office 365. По умолчанию AD FS настраивает SSL-сертификат, после начальной настройки, как сертификат взаимодействия служб.

**Рекомендация:**
- Используйте тот же сертификат, как для SSL.  

### <a name="token-signing-certificate"></a>Сертификат подписи маркера
Этот сертификат используется для подписи выданных маркеров для проверяющих сторон, поэтому приложениям проверяющей стороны должна распознавать сертификат и связанные с ней ключ как известным и надежным. Если токена подписи сертификата изменения, например при истечении и настроить новый сертификат, необходимо обновить всем проверяющим сторонам.

**Рекомендация:** Используйте AD FS по умолчанию, созданная внутри структура, самозаверяющие сертификаты для подписи маркеров.  

**Требования:**
- Если ваша организация требует использования сертификатов PKI предприятия для подписи маркеров, это можно сделать с помощью параметра SigningCertificateThumbprint командлета Install-AdfsFarm.
- Ли использовать сертификаты внутри формируемые по умолчанию, или извне зарегистрированных сертификатов, в том случае, если сертификат для подписи маркера изменяется необходимо убедиться, что всем проверяющим сторонам, обновляются с использованием данных нового сертификата.  В противном случае не удастся входов доверяющей стороне, не обновляется.

### <a name="token-encryptingdecrypting-certificate"></a>Сертификат шифрования/расшифровки маркера
Этот сертификат используется поставщиками утверждений, использующих шифрование маркеров, выдаваемых AD FS.

**Рекомендация:** Используйте AD FS по умолчанию, созданная внутри структура, самозаверяющего маркера расшифровки сертификаты.  

**Требования:**
- Если ваша организация требует использования сертификатов PKI предприятия для подписи маркеров, это можно сделать с помощью параметра DecryptingCertificateThumbprint командлета Install-AdfsFarm.
- Ли использовать сертификаты внутри формируемые по умолчанию, или извне зарегистрированные сертификаты, когда изменяется сертификат расшифровки маркера необходимо убедиться, что все поставщики утверждений будут обновлены с учетом данных нового сертификата.  В противном случае удастся входы в систему с помощью любой утверждений поставщики не обновляется.
  
> [!CAUTION]  
> Сертификаты, используемые для токена\-подписи и маркером\-расшифровки\/шифрования крайне важны для стабильности службы федерации. Пользователей, управляющих их собственный маркер\-подписи & маркера\-расшифровки\/шифрования сертификаты следует убедитесь, что эти сертификаты архивируются и доступны в независимо друг от друга во время события восстановления.  

### <a name="user-certificates"></a>Сертификаты пользователей
- При использовании x509, проверка подлинности сертификата пользователя с AD FS, все сертификаты пользователей необходимо по цепочке корневого центра сертификации, которому доверяют серверы AD FS и прокси веб-приложения.

## <a name="BKMK_2"></a>Требования к оборудованию  
AD FS и прокси веб-приложения требования к оборудованию (физический или виртуальный) проверки на ЦП, поэтому размер фермы для мощности обработки необходимо.  
- Используйте [таблице планирования емкости AD FS 2016](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx) для определения числа серверов AD FS и прокси веб-приложения, вам потребуется.

Требования к памяти и дисков для AD FS достаточно статичны, см. в следующей таблице:


|**Требования к оборудованию**|**Минимальное требование**|**Рекомендуемым требованиям**|
|----- | ----- |-----|
|ОЗУ|2 ГБ|4 ГБ |
|Место на диске|32 ГБ|100 ГБ |

**Требования к оборудованию сервера SQL**

Если вы используете SQL Server для базы данных конфигурации AD FS, размер SQL Server в соответствии с наиболее основные рекомендации по SQL Server.  Слишком мало, размер базы данных AD FS и AD FS не помещать значительные вычислительной нагрузки на экземпляр базы данных.  AD FS тем не менее, соединиться с базой данных несколько раз во время проверки подлинности, поэтому сетевого подключения должны быть надежными.  К сожалению SQL Azure не поддерживается для базы данных конфигурации AD FS.
  
## <a name="BKMK_3"></a>Требования к прокси-сервера  
  
-   Для доступа через экстрасеть, необходимо развернуть службы роли прокси веб-приложения \- частью роли сервера удаленного доступа. 

-   Прокси-серверы сторонних должен поддерживать [протокола MS-ADFSPIP](https://msdn.microsoft.com/en-us/library/dn392811.aspx) поддерживаться в качестве прокси-сервер AD FS.  Перечень сторонних поставщиков см. в разделе [часто задаваемые вопросы о](AD-FS-FAQ.md#what-third-party-proxies-are-available-for-ad-fs-that-support-ms-adfspip).

-   AD FS 2016 требует серверы прокси веб-приложения в Windows Server 2016.  Невозможно настроить прокси-сервер нижнего уровня для фермы AD FS 2016 под управлением на уровне поведения фермы 2016.
  
-   Сервера федерации и службы роли прокси веб-приложения не может устанавливаться на одном компьютере.  
  
## <a name="BKMK_4"></a>Требования к AD DS  
**Требования к контроллеру домена**  
  
- Службы федерации Active Directory требуются контроллеры домена под управлением Windows Server 2008 или более поздней версии.

- По крайней мере один контроллер домена Windows Server 2016 является обязательным для Microsoft Passport for Work.
  
> [!NOTE]  
> Все для сред с контроллерами домена Windows Server 2003 поддерживаются. Посетите [эту страницу](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO) Дополнительные сведения о жизненном цикле поддержки Майкрософт.  
  
**Работы домена\-уровня требования**  
  
 - Все домены учетной записи пользователя и домен, к которому присоединены серверы AD FS должен работать на функциональном уровне домена Windows Server 2003 или более поздней версии.  
  
 - Работы домена Windows Server 2008 уровень или более поздней версии необходим для проверки подлинности сертификата клиента, если сертификат явно сопоставлен учетной записи пользователя в AD DS.  
  
**Требования к схеме**  
  
-   Новые установки AD FS 2016 требуется схема Active Directory 2016 (Минимальная версия 85).

-   Вызов на уровне поведения фермы AD FS (FBL) на уровень 2016 требуется схема Active Directory 2016 (Минимальная версия 85).  

  
**Требования к учетной записи службы**  
  
-   Любой учетной записи домена standard можно использовать как учетная запись службы для AD FS. Также поддерживаются групповые учетные записи управляемой службы. Разрешения, необходимые во время выполнения будут добавляться автоматически при настройке AD FS.

-   Назначение прав пользователя, необходимых для учетной записи службы AD, «Вход в качестве службы»

-   Назначение прав пользователя, необходимые для «NT Service\adfssrv» и «NT Service\drs», «Создание аудитов безопасности» и «Вход в качестве службы».

-   Групповые управляемые учетные записи служб требуется по крайней мере один контроллер домена под управлением Windows Server 2012 или более поздней версии.  Эта учетная запись должны быть расположены в папке по умолчанию "CN = контейнер управляемые учетные записи служб.  

-   Для проверки подлинности Kerberos, имя субъекта-службы "`HOST/<adfs\_service\_name>`" должен быть зарегистрирован на учетную запись службы AD FS. По умолчанию AD FS настроите это при создании новой фермы AD FS.  В случае сбоя, такие как в случае конфликта имен или недостаточно разрешений, вы увидите предупреждение, и добавьте ее вручную.  
   
**Требования к домену**  
  
-   Все серверы AD FS должны быть присоединенных к домену AD DS.  
  
-   Все серверы AD FS в ферме должны быть развернуты в одном домене.  
   
**Несколько лесов требования**  
  
-   Домен, к которому присоединены серверы AD FS, должны доверять каждого домена или леса, содержащего пользователей, проверка подлинности в службе AD FS.  

-   Лес, в которой находится учетная запись службы AD FS является членом, должны доверять все леса входа пользователя. 
  
-   Учетная запись службы AD FS необходимы разрешения на чтение атрибутов пользователя в каждом домене, содержащий прошедшие проверки подлинности для службы AD FS.  
  
## <a name="BKMK_5"></a>Требования к базе данных конфигурации  
В этом разделе описываются требования и ограничения для фермы AD FS, использован соответственно внутренней базы данных Windows (WID) или SQL Server для базы данных:  
  
**ВНУТРЕННЯЯ БАЗА ДАННЫХ WINDOWS**  
  
-   Профиль разрешение артефактов SAML 2.0 не поддерживается на ферме внутренней базы данных Windows.    

-   Обнаружение воспроизведения токенов не поддерживается ферме внутренней базы данных Windows. (Эта функция только используется только в сценариях, где в качестве поставщика федерации AD FS и использование токенов безопасности от поставщиков внешних утверждений.)  
  
Следующая таблица содержит сводку числа серверов AD FS поддерживается в WID vs ферме SQL Server.    
  
  
|| 1 - 100, с проверяющей стороной (RP) отношения доверия в AD FS | Настроить более чем 100 отношениями доверия RP  |
| --- |--- | --- |
|Серверы 1-30 AD FS|Поддерживается внутренней базы данных Windows|Не поддерживается с использованием WID - требуется SQL Server |
|Серверы более чем 30 AD FS|Не поддерживается с использованием WID - требуется SQL Server|Не поддерживается с использованием WID - требуется SQL Server  
  
**SQL Server**  
  
- Для AD FS в Windows Server 2016 SQL Server 2008 и более поздних версиях поддерживаются.

- Разрешение артефактов SAML и обнаружения воспроизведения маркеров, поддерживаются в ферме SQL Server.  
  
## <a name="BKMK_6"></a>Требования к браузеру  
При проверке подлинности AD FS с помощью браузера или элемента управления браузера, в браузере должны соответствовать следующим требованиям:  
  
- Необходимо включить JavaScript  
  
- Для единого входа браузер клиента необходимо разрешить файлы cookie  
  
- Указание имени сервера \(SNI\) должен поддерживаться  
  
- Для пользователя устройства & сертификата проверки подлинности сертификата браузер должен поддерживать проверку подлинности сертификата клиента SSL  

- Для простой вход встроенную проверку подлинности Windows, имя службы федерации (например, https:\/\/fs.contoso.com) должен быть настроен в зону локальной интрасети или в зону надежных сайтов.
  ## <a name="BKMK_7"></a>Требования к сети  
 
**Требования к брандмауэру**  
  
Брандмауэр, расположенный между прокси веб-приложения и фермы серверов федерации и брандмауэр между клиентами и прокси веб-приложения должен иметь TCP-порт 443 включен входящего трафика.  
  
Кроме того, если проверка сертификата пользователя клиента \(clientTLS проверки подлинности с помощью X509 сертификатов пользователей\) является обязательным и не включена конечная точка certauth через порт 443, AD FS 2016 требуется включенное TCP-порт 49443 для входящего трафика в брандмауэре между клиентами и прокси веб-приложения. Это не является обязательным в брандмауэре между прокси веб-приложения и серверами федерации\). 

Дополнительные сведения о гибридных порт требования см. в разделе [гибридных удостоверений порты и протоколы](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports). 

Дополнительные сведения см. в разделе [рекомендацию по обеспечению безопасности служб федерации Active Directory](../deployment/Best-Practices-Securing-AD-FS.md)
  
**Требования к DNS**  
  
-   Для доступа к интрасети, все клиенты, доступ к AD FS службы в пределах внутренней корпоративной сети \(интрасети\) должен быть способен разрешить имя службы AD FS в подсистему балансировки нагрузки для серверов AD FS или сервера AD FS.  
  
-   Для доступа к экстрасети, все клиенты, доступ к AD FS службы из вне корпоративной сети \(экстрасети\/internet\) должен быть способен разрешить имя службы AD FS в подсистему балансировки нагрузки для серверов прокси веб-приложения или сервер прокси веб-приложения.  
  
-   Каждый сервер прокси веб-приложения в сети Периметра должен быть способен разрешить имя службы AD FS в подсистему балансировки нагрузки для серверов AD FS или сервера AD FS. Это можно сделать с помощью Альтернативный DNS-сервер в сети Периметра сети или путем изменения разрешение локального сервера, с помощью файла HOSTS.  
  
-   Windows встроенную проверку подлинности, необходимо использовать запись DNS A \(не CNAME\) для имени службы федерации.  

-   Для проверки подлинности сертификата пользователя через порт 443, «certauth. \<имя службы федерации\>«должен быть настроен в DNS для разрешения прокси федерации сервера или веб-приложения.

-   Для регистрации устройств или для современной проверки подлинности для локальных ресурсов с помощью клиентов пред-Windows 10, «enterpriseregistration. \<суффикс имени участника-пользователя\>«, для каждого суффикса имени участника-пользователя, используемых в вашей организации, необходимо настроить для разрешения в прокси федерации сервера или веб-приложения.

**Требования к подсистеме балансировки нагрузки**
- Подсистема балансировки нагрузки не должна завершить SSL. AD FS поддерживает несколько вариантов использования с проверкой подлинности сертификатов, в которой произойдет останов при прекращении SSL. Завершение SSL в подсистеме балансировки нагрузки не поддерживается для любого варианта использования. 
- Рекомендуется использовать подсистему балансировки нагрузки, которая поддерживает SNI. В случае это не так, используя 0.0.0.0, резервный, привязки к AD FS / server прокси веб-приложения должен предоставить возможное решение.
- Рекомендуется использовать конечные точки проверки работоспособности HTTP (не HTTPS) для выполнения проверки работоспособности подсистемы балансировки нагрузки для маршрутизации трафика. Это позволяет избежать проблем, связанных с SNI. Ответ на эти конечные точки проверки является HTTP 200 OK и обслуживается локально с помощью нет зависимость от серверных служб. Проверка HTTP может осуществляться по протоколу HTTP, используя путь «/ adfs/пробы»
    - http://&lt;прокси веб-приложения имя &gt; /adfs/пробы
    - http://&lt;имя сервера служб федерации Active Directory &gt; /adfs/пробы
    - http://&lt;адрес IP-адрес прокси-сервера приложения Web &gt; /adfs/пробы
    - http://&lt;ADFS IP-адрес &gt; /adfs/пробы
- НЕ рекомендуется использовать DNS циклический перебор как способ балансировки нагрузки. С помощью балансировки нагрузки этого типа не предоставляет способ удаления узла из балансировщика нагрузки, с помощью проверки работоспособности. 
- НЕ рекомендуется использовать сходства сеансов на основе IP-адрес или прикрепленные сеансы для трафика проверки подлинности для AD FS в подсистеме балансировки нагрузки. Это может привести к перегрузке некоторые узлы, при использовании протокола проверки подлинности для почтовых клиентов для подключения к службам электронной почты Office 365 (Exchange Online). 

## <a name="BKMK_13"></a>Требования к разрешениям  
Имя администратора, который выполняет установку и начальная настройка AD FS, необходимо иметь разрешения локального администратора на сервере AD FS.  Если локальный администратор не имеет разрешений на создание объектов в Active Directory, он должен иметь администратора домена создать необходимые объекты AD, а затем настроить с помощью параметра значение AdminConfiguration фермы AD FS.  
  
  

