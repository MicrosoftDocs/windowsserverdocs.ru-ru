---
ms.assetid: 28f4a518-1341-4a10-8a4e-5f84625b314b
title: Требования к AD FS 2016
description: Требования для установки службы федерации Active Directory (AD FS).
author: billmath
ms.author: billmath
manager: mtillman
ms.date: 03/06/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: c330b5f65b2862628fd23e288c95e81653da5c5b
ms.sourcegitcommit: 4fa147d552481d8279a5390f458a9f7788061977
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2019
ms.locfileid: "70009081"
---
# <a name="ad-fs-requirements"></a>Требования AD FS



Ниже приведены требования к развертыванию AD FS.  
  
-   [Требования к сертификатам](ad-fs-requirements.md#BKMK_1)  
  
-   [Требования к оборудованию](ad-fs-requirements.md#BKMK_2)  
  
-   [Требования к прокси-серверу](ad-fs-requirements.md#BKMK_3)  
  
-   [Требования к AD DS](ad-fs-requirements.md#BKMK_4)  
  
-   [Требования к базе данных конфигурации](ad-fs-requirements.md#BKMK_5)  
  
-   [Требования к браузеру](ad-fs-requirements.md#BKMK_6)  

-   [Требования к сети](ad-fs-requirements.md#BKMK_7)  
  
-   [Требования к разрешениям](ad-fs-requirements.md#BKMK_13)  
  
## <a name="BKMK_1"></a>Требования к сертификатам  
  
### <a name="ssl-certificates"></a>SSL-сертификаты

Для каждого AD FS и прокси-сервера для службы федерации (HTTPS) есть сертификат SSL.  Прокси веб-приложения может иметь дополнительные сертификаты SSL для обслуживания запросов к опубликованным приложениям.

**Рекомендуемые** Используйте один и тот же SSL-сертификат для всех AD FS серверов федерации и прокси, использующих веб приложения. 

**Необходимость**

SSL-сертификаты на серверах федерации должны соответствовать следующим требованиям.
- Сертификат является общедоступным (для рабочих развертываний)
- Сертификат содержит значение расширенного использования ключа проверки подлинности сервера (EKU)
- Сертификат содержит имя службы федерации, например "fs.contoso.com" в субъекте или альтернативном имени субъекта (SAN).
- Для проверки подлинности сертификата пользователя на порте 443 сертификат содержит "цертаус. \<имя\>службы федерации, например "certauth.FS.contoso.com" в сети SAN
- Для регистрации устройств или для современной проверки подлинности в локальных ресурсах с использованием пред-Windows 10 клиентов сеть SAN должна содержать "enterpriseregistration". \<суффикс\>имени участника-пользователя для каждого суффикса имени участника-пользователя, используемого в Организации.

Сертификаты SSL на прокси-сервере веб приложения должны соответствовать следующим требованиям.
- Если прокси-сервер используется для прокси-запросов AD FS, использующих встроенную проверку подлинности Windows, прокси-сертификат SSL должен быть одинаковым (используйте тот же ключ), что и сертификат SSL сервера федерации.
- Если свойство AD FS "Екстендедпротектионтокенчекк" включено (параметр по умолчанию в AD FS), SSL-сертификат прокси должен быть одинаковым (используйте тот же ключ), что и сертификат SSL сервера федерации.
- В противном случае требования к SSL-сертификату прокси совпадают с требованиями сертификата SSL сервера федерации.

### <a name="service-communication-certificate"></a>Сертификат связи служб
Этот сертификат не требуется для большинства AD FS сценариев, включая Azure AD и Office 365. По умолчанию AD FS настраивает SSL-сертификат, предоставленный при начальной настройке, в качестве сертификата связи службы.

**Рекомендуемые**
- Используйте тот же сертификат, который используется для SSL.  

### <a name="token-signing-certificate"></a>Сертификат для подписи токена
Этот сертификат используется для подписывания выданных маркеров проверяющей стороны, поэтому приложения проверяющей стороны должны распознать сертификат и связанный с ним ключ как известный и доверенный. При изменении сертификата для подписи маркера, например по истечении срока действия и настройке нового сертификата, все проверяющие стороны должны быть обновлены.

**Рекомендуемые** Используйте AD FS по умолчанию, созданные внутренним образом, самозаверяющие сертификаты подписи маркеров.  

**Необходимость**
- Если ваша организация требует, чтобы сертификаты из корпоративной PKI использовались для подписи маркеров, это можно сделать с помощью параметра Сигнингцертификатесумбпринт командлета Install-Адфсфарм.
- Независимо от того, используются ли используемые по умолчанию внутренние сертификаты или сертификаты с внешними сертификатами, при изменении сертификата для подписи маркера необходимо обеспечить обновление всех проверяющих сторон новыми сведениями о сертификате.  В противном случае вход на любые проверяющие стороны, не обновленные, завершится ошибкой.

### <a name="token-encryptingdecrypting-certificate"></a>Сертификат шифрования и расшифровки маркера
Этот сертификат используется поставщиками утверждений, которые шифруют маркеры, выданные для AD FS.

**Рекомендуемые** Используйте AD FS по умолчанию, созданные внутренним образом самозаверяющие сертификаты расшифровки.  

**Необходимость**
- Если ваша организация требует, чтобы сертификаты из корпоративной PKI использовались для подписи маркеров, это можно сделать с помощью параметра Декриптингцертификатесумбпринт командлета Install-Адфсфарм.
- Независимо от того, используются ли используемые по умолчанию внутренние сертификаты или сертификаты, зарегистрированные извне, при изменении сертификата расшифровки маркера необходимо обеспечить обновление всех поставщиков утверждений новыми сведениями о сертификате.  В противном случае вход с использованием любых поставщиков утверждений, не обновленных, завершится ошибкой.
  
> [!CAUTION]  
> Сертификаты, используемые для подписи маркера\-и расшифровки\/маркера\-, крайне важны для стабильности служба Федерации. Клиенты, управляющие собственной\-подписью маркера\-&\/расшифровке сертификатов шифрование, должны обеспечить их резервное копирование и доступность во время события восстановления.  

### <a name="user-certificates"></a>Сертификаты пользователей
- При использовании проверки подлинности сертификата пользователя x509 с AD FS все сертификаты пользователей должны быть связаны с корневым центром сертификации, который является доверенным для серверов AD FS и прокси веб-приложений.

## <a name="BKMK_2"></a>Требования к оборудованию  
AD FS и требования к оборудованию прокси веб-приложения (физические или виртуальные) настраиваются на ЦП, поэтому необходимо задать размер фермы для обработки емкости.  
- Используйте [электронную таблицу планирования емкости AD FS 2016](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx) , чтобы определить количество AD FS и прокси-серверов для приложений, которые вам понадобятся.

Требования к памяти и диску для AD FS довольно статичны, см. в следующей таблице:


|**Требования к оборудованию**|**Минимальное требование**|**Рекомендуемое требование**|
|----- | ----- |-----|
|ОЗУ|2 ГБ|4 ГБ |
|Место на диске|32 ГБ|100 ГБ |

**Требования к оборудованию SQL Server**

Если вы используете SQL Server для базы данных конфигурации AD FS, измените размер SQL Server в соответствии с самыми основными рекомендациями SQL Server.  Размер базы данных AD FS очень мал, и AD FS не помещает значительных вычислительных нагрузок в экземпляр базы данных.  Однако AD FS может подключиться к базе данных несколько раз во время проверки подлинности, поэтому сетевое подключение должно быть надежным.  К сожалению, SQL Azure не поддерживается для базы данных конфигурации AD FS.
  
## <a name="BKMK_3"></a>Требования к прокси-серверу  
  
-   Для доступа к экстрасети необходимо развернуть часть службы \- роли прокси-сервера для роли "сервер удаленного доступа". 

-   Сторонние прокси должны поддерживать [протокол MS-адфспип](https://msdn.microsoft.com/library/dn392811.aspx) , который должен поддерживаться в качестве прокси-сервера AD FS.  Список сторонних поставщиков см. в разделе [часто задаваемые вопросы](AD-FS-FAQ.md).

-   Для AD FS 2016 требуются прокси-серверы веб приложения на Windows Server 2016.  Невозможно настроить прокси нижнего уровня для фермы AD FS 2016, работающей на уровне поведения фермы 2016.
  
-   Сервер федерации и служба роли прокси веб-приложения не могут быть установлены на одном компьютере.  
  
## <a name="BKMK_4"></a>Требования к AD DS  
**Требования к контроллеру домена**  
  
- Для AD FS требуются контроллеры домена под Windows Server 2008 или более поздней версии.

- Для Microsoft Passport for Work требуется хотя бы один контроллер домена Windows Server 2016.
  
> [!NOTE]  
> Закончилась поддержка сред с контроллерами домена Windows Server 2003. Дополнительные сведения о жизненном цикле служба поддержки Майкрософт см. на [этой странице](https://support.microsoft.com/lifecycle/search/default.aspx?sort=PN&alpha=Windows+Server+2003&Filter=FilterNO) .  
  
**Требования к\-функциональному уровню домена**  
  
 - Все домены учетных записей пользователей и домены, к которым присоединены серверы AD FS, должны работать на функциональном уровне домена Windows Server 2003 или более поздней версии.  
  
 - Для проверки подлинности с помощью сертификата клиента требуется режим работы домена Windows Server 2008 или выше, если сертификат явно сопоставлен с учетной записью пользователя в AD DS.  
  
**Требования к схеме**  
  
-   Для новых установок AD FS 2016 требуется схема Active Directory 2016 (минимальная версия 85).

-   Для повышения уровня поведения AD FS фермы (ФБЛ) на уровне 2016 требуется схема Active Directory 2016 (минимальная версия 85).  

  
**Требования к учетной записи службы**  
  
-   Любую стандартную учетную запись домена можно использовать в качестве учетной записи службы для AD FS. Также поддерживаются групповые управляемые учетные записи служб. Разрешения, необходимые во время выполнения, будут добавлены автоматически при настройке AD FS.

-   Для учетной записи службы AD требуется назначение прав пользователя "вход в качестве службы"

-   Назначения прав пользователя, необходимые для NT Сервице\адфссрв и NT Сервице\дрс, — это "создать Аудиты безопасности" и "вход в качестве службы".

-   Для групповой управляемой учетной записи службы требуется по крайней мере один контроллер домена под управлением Windows Server 2012 или более поздней версии.  GMSA должен находиться в контейнере "CN = Managed Service Accounts" по умолчанию.  

-   Для проверки подлинности Kerberos имя субъекта`HOST/<adfs\_service\_name>`-службы "" должно быть зарегистрировано в учетной записи службы AD FS. По умолчанию AD FS будет настроена при создании новой фермы AD FS.  Если это не удается, например в случае конфликта или недостаточных разрешений, вы увидите предупреждение, и его следует добавить вручную.  
   
**Требования к домену**  
  
-   Все AD FS серверы должны быть присоединены к домену AD DS.  
  
-   Все серверы AD FS в ферме должны быть развернуты в одном домене.  
   
**Требования к нескольким лесам**  
  
-   Домен, к которому присоединяются серверы AD FS, должен доверять каждому домену или лесу, содержащему пользователей, которые проходят проверку подлинности в службе AD FS.  

-   Лес, членом которого является учетная запись службы AD FS, должен доверять всем лесам входа пользователей. 
  
-   Учетная запись службы AD FS должна иметь разрешения на чтение атрибутов пользователей в каждом домене, содержащем пользователей, прошедших проверку подлинности в службе AD FS.  
  
## <a name="BKMK_5"></a>Требования к базе данных конфигурации  
В этом разделе описаны требования и ограничения для AD FS ферм, которые используют соответственно внутреннюю базу данных Windows (WID) или SQL Server в качестве базы данных:  
  
**WID**  
  
-   Профиль разрешения артефактов SAML 2,0 не поддерживается в ферме WID.    

-   Определение воспроизведения токенов не поддерживается фермой WID. (Эта функция используется только в сценариях, где AD FS выступает в качестве поставщика Федерации и использует маркеры безопасности от внешних поставщиков утверждений).  
  
В следующей таблице приведены сведения о количестве AD FS серверов, поддерживаемых в WID и SQL Server ферме.    
  
  
|| 1-100. отношения доверия с проверяющей стороной (RP), настроенные в AD FS | Настроено более 100 доверий RP  |
| --- |--- | --- |
|1-30 AD FS серверы|Поддерживается WID|Не поддерживается при использовании WID-SQL Server требуется |
|Более 30 AD FS серверов|Не поддерживается при использовании WID-SQL Server требуется|Не поддерживается при использовании WID-SQL Server требуется  
  
**SQL Server**  
  
- Для AD FS в Windows Server 2016 поддерживаются SQL Server 2008 и более поздних версий.

- В SQL Server ферме поддерживаются как разрешение артефакта SAML, так и обнаружение воспроизведения маркеров.  
  
## <a name="BKMK_6"></a>Требования к браузеру  
Если проверка подлинности AD FS выполняется через браузер или элемент управления браузера, браузер должен соответствовать следующим требованиям.  
  
- Необходимо включить JavaScript  
  
- Для единого входа необходимо настроить браузер клиента для разрешения файлов cookie  
  
- Должен \(поддерживаться указание имени сервера SNI\)  
  
- Для сертификата пользователя & проверки подлинности сертификата устройства браузер должен поддерживать проверку подлинности SSL-сертификата клиента.  

- Для простого входа с использованием встроенной проверки подлинности Windows имя службы федерации (например,\/HTTPS:\/FS.contoso.com) должно быть настроено в зоне "Местная интрасеть" или "Доверенные сайты".
  ## <a name="BKMK_7"></a>Требования к сети  
 
**Требования к брандмауэру**  
  
Брандмауэру, расположенному между прокси веб-приложения и фермой серверов федерации, а также брандмауэром между клиентами и прокси-приложением, должен быть включен порт TCP 443.  
  
Кроме того, если требуется проверка \(подлинности сертификата пользователя клиента проверка с использованием сертификатов\) пользователя X509, а конечная точка цертаус на порте 443 не включена, AD FS 2016 требует включения TCP-порта 49443. входящий трафик через брандмауэр между клиентами и прокси веб-приложения. Это не является обязательным в брандмауэре между прокси веб-приложения и серверами\)Федерации. 

Дополнительные сведения о требованиях к гибридным портам см. в статье [порты и протоколы гибридной идентификации](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-ports). 

Дополнительные сведения см. в статье рекомендации [по обеспечению безопасности службы федерации Active Directory (AD FS)](../deployment/Best-Practices-Securing-AD-FS.md)
  
**Требования к DNS**  
  
-   Для доступа к интрасети все клиенты, обращающиеся к AD FS службе внутри \(внутренней\) корпоративной сети интрасети, должны иметь возможность разрешить имя AD FS службы в подсистему балансировки нагрузки для серверов AD FS или сервера AD FS.  
  
-   Для доступа к экстрасети все клиенты, обращающиеся к AD FS службе извне \(экстрасети\) \/в Интернете, должны иметь возможность разрешить имя AD FS службы в подсистему балансировки нагрузки для прокси-серверов веб приложения или сервер прокси веб-приложения.  
  
-   Каждый сервер прокси-сервера в сети периметра должен иметь возможность разрешать AD FS имя службы в подсистему балансировки нагрузки для серверов AD FS или сервера AD FS. Это можно сделать с помощью альтернативного DNS-сервера в сети ДЕМИЛИТАРИЗОВАНной зоны или путем изменения разрешения локального сервера с помощью файла HOSTs.  
  
-   Для встроенной проверки подлинности Windows необходимо использовать запись \(DNS a не CNAME\) для имени службы федерации.  

-   Для проверки подлинности сертификата пользователя на порте 443 "цертаус. \<имя\>службы федерации "необходимо настроить в DNS, чтобы разрешить доступ к серверу федерации или прокси веб-приложения.

-   Для регистрации устройств или для современной проверки подлинности в локальных ресурсах с использованием пред-Windows 10 клиентов, "enterpriseregistration. \<суффикс\>имени участника-пользователя (UPN) для каждого суффикса UPN, используемого в Организации, должен быть настроен для разрешения на сервер федерации или прокси приложения.

**Требования к Load Balancer**
- Подсистема балансировки нагрузки не должна завершать работу протокола SSL. AD FS поддерживает несколько вариантов использования с проверкой подлинности на основе сертификата, что приведет к прерыванию при прерывании SSL. Прерывание SSL в подсистеме балансировки нагрузки не поддерживается для любого варианта использования. 
- Рекомендуется использовать подсистему балансировки нагрузки, которая поддерживает SNI. В этом случае в этом случае использование резервной привязки 0.0.0.0 на прокси-сервере AD FS/веб приложения должно обеспечивать обходной путь.
- Рекомендуется использовать конечные точки проверки работоспособности HTTP (не HTTPS) для выполнения проверок работоспособности балансировщика нагрузки для трафика маршрутизации. Это позволяет избежать проблем, связанных с SNI. Ответ на эти конечные точки проверки — HTTP 200 OK и обслуживается локально без зависимости от внутренних серверных служб. Доступ к зонду HTTP можно получить по протоколу HTTP, используя путь "/адфс/пробе"
    - &lt;имя&gt;прокси-службы http://веб приложения/адфс/пробе
    - &lt;имя&gt;сервера http://ADFS/адфс/пробе
    - http://&lt;IP-адрес&gt;/адфс/пробе
    - IP&lt;-адрес&gt;/адфс/пробе http://ADFS
- НЕ рекомендуется использовать циклический перебор DNS в качестве способа балансировки нагрузки. Использование этого типа балансировки нагрузки не предоставляет автоматического способа удаления узла из балансировщика нагрузки с помощью проб работоспособности. 
- НЕ рекомендуется использовать сходство сеансов на основе IP или прикрепленные сеансы для трафика проверки подлинности AD FS в подсистеме балансировки нагрузки. Это может вызвать перегрузку определенных узлов при использовании устаревшего протокола проверки подлинности для подключения почтовых клиентов к почтовым службам Office 365 (Exchange Online). 

## <a name="BKMK_13"></a>Требования к разрешениям  
Администратор, выполняющий установку и начальную настройку AD FS, должен иметь разрешения локального администратора на сервере AD FS.  Если у локального администратора нет разрешений на создание объектов в Active Directory, они должны иметь права администратора домена создать необходимые объекты AD, а затем настроить ферму AD FS с помощью параметра значение adminconfiguration.  
  
  

