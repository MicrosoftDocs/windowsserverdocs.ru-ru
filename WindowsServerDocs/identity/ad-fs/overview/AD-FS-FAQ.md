---
ms.assetid: acc9101b-841c-4540-8b3c-62a53869ef7a
title: "ВОПРОСЫ И ОТВЕТЫ ПО AD FS 2016"
description: "Вопросы и ответы для AD FS 2016"
author: jenfieldmsft
ms.author: billmath
manager: femila
ms.date: 03/06/2018
ms.topic: article
ms.custom: it-pro
ms.prod: windows-server-threshold
ms.technology: identity-adfs
ms.openlocfilehash: 313447d2c92c15505434ec5c39898ca84aef46db
ms.sourcegitcommit: 556361fe7c73c75d6cdc46a67dc88679fbe89c61
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/08/2018
---
# <a name="ad-fs-frequently-asked-questions-faq"></a>Вопросы и ответы по AD FS

>Область применения: Windows Server 2016

Следующий документ является домашней на часто задаваемые вопросы относительно служб федерации Active Directory.  Документ были разделены на группы на основании тип вопроса.

## <a name="deployment"></a>Развертывания 

### <a name="how-can-i-upgrademigrate-from-previous-versions-of-ad-fs"></a>Как можно обновить или перенести из предыдущих версий Служб федерации Active Directory
Можно обновить с помощью одного из следующих Служб федерации Active Directory:


- Windows Server 2012 R2 AD FS в Windows Server 2016 AD FS
    - [Обновление до AD FS в Windows Server 2016 с помощью Внутренней базой данных Windows](../deployment/Upgrading-to-AD-FS-in-Windows-Server-2016.md)
    - [Обновление до AD FS в Windows Server 2016 с помощью базы данных SQL](../deployment/Upgrading-to-AD-FS-in-Windows-Server-2016-SQL.md)
- Windows Server 2012 AD FS в Windows Server 2012 R2 AD FS
    - [Перенос в AD FS на Windows Server 2012 R2](https://technet.microsoft.com/library/dn486815.aspx)
- AD FS 2.0 в Windows Server 2012 AD FS
    - [Перенос в AD FS в Windows Server 2012](https://technet.microsoft.com/library/jj647765.aspx)
- AD FS 1.x в AD FS 2.0 
    - [Обновление с AD FS 1.x в AD FS 2.0](https://technet.microsoft.com/library/ff678035.aspx)

Если вам нужно обновить систему из AD FS 2.0 или 2.1 (Windows Server 2008 R2 или Windows Server 2012), необходимо использовать сценарии в поле (расположен по C:\Windows\ADFS).

### <a name="why-does-ad-fs-installation-require-a-reboot-of-the-server"></a>Почему установки AD FS требуют перезагрузки сервера?

Была добавлена поддержка HTTP/2 в Windows Server 2016, но не может использовать HTTP/2 для проверки подлинности сертификата клиента.  Поскольку многие сценарии AD FS для использования проверки подлинности сертификата клиента и значительное количество клиентов выполните поддерживает повторные попытки запросы с помощью HTTP/1.1 фермы конфигурации Служб федерации Active Directory повторно настраивает параметры HTTP локальный сервер к HTTP/1.1.  Для этого требуется перезагрузка сервера.  

### <a name="is-using-windows-2016-wap-servers-to-publish-the-ad-fs-farm-to-the-internet-without-upgrading-the-back-end-ad-fs-farm-supported"></a>Для публикации фермы AD FS к Интернету без обновления серверной фермы AD FS поддерживается использует WAP серверов Windows 2016?
Да, эта конфигурация поддерживается, но при этом никаких новых функций AD FS 2016 будет поддерживаться в этой конфигурации.  Эта конфигурация предназначена для временного на этапе миграции из AD FS 2012 R2 AD FS 2016 и не будет развернуто длительное время.

## <a name="design"></a>Проектирование

### <a name="what-third-party-multi-factor-authentication-providers-are-available-for-ad-fs"></a>Какие сторонние поставщики многофакторной проверки подлинности доступны для Служб федерации Active Directory? 
Ниже приведен список поставщиков сторонних производителей, которые знает.  Всегда возможно поставщиков, доступных в том, что мы не знаем о, и мы будем обновлять список мы узнаем о них.

- [Удостоверение службы безопасности компании Gemalto](http://www.gemalto.com/identity)
- [Корпоративной проверки подлинности inWebo](http://www.inwebo.com/)
- [Люди многофакторную проверку Подлинности API-соединитель Login](https://www.loginpeople.com)
- [Агент проверки подлинности RSA SecurID для служб федерации Microsoft Active Directory](http://www.emc.com/security/rsa-securid/rsa-authentication-agents/microsoft-ad-fs.htm)
- [Агент службы (SAS) для проверки подлинности SafeNet для служб AD FS](http://www.safenet-inc.com/resources/integration-guide/data-protection/Safenet_Authentication_Service/SafeNet_Authentication_Service__AD_FS_Agent_Configuration_Guide/?langtype=1033)
- [Служба проверки подлинности Swisscom Mobile ID](http://swisscom.ch/mid)
- [Symantec служба проверки и идентификатор защиты (VIP)](http://www.symantec.com/vip-authentication-service) 

### <a name="are-third-party-proxies-supported-with-ad-fs"></a>Поддерживаются ли прокси-серверы сторонних разработчиков с помощью AD FS?
Да, можно разместить прокси-серверы сторонних разработчиков перед прокси веб-приложения, но должны поддерживать все прокси-сервера независимого [протокола MS-ADFSPIP](https://msdn.microsoft.com/library/dn392811.aspx) для использования вместо прокси веб-приложения.

### <a name="what-third-party-proxies-are-available-for-ad-fs-that-support-ms-adfspip"></a>Какие прокси-серверы сторонних производителей, доступно для AD FS, которая поддерживает MS-ADFSPIP?

Ниже приведен список поставщиков сторонних производителей, которые знает.  Всегда возможно поставщиков, доступных в том, что мы не знаем о, и мы будем обновлять список мы узнаем о них.

- [F5 Диспетчер политики Access](https://support.f5.com/kb/en-us/products/big-ip_apm/manuals/product/apm-third-party-integration-13-1-0/12.html#guid-1ee8fbb3-1b33-4982-8bb3-05ae6868d9ee)

### <a name="where-is-the-capacity-planning-sizing-spreadsheet-for-ad-fs-2016"></a>Где находится планирование мощности электронную таблицу масштабов для AD FS 2016?
Можно загрузить версии AD FS 2016 таблицы [здесь](http://adfsdocs.blob.core.windows.net/adfs/ADFSCapacity2016.xlsx).
Это также может использоваться для AD FS в Windows Server 2012 R2.

### <a name="how-can-i-ensure-my-ad-fs-and-wap-servers-support-apples-atp-requirements"></a>Как обеспечить Мои поддержки серверов AD FS и WAP требования к ATP Apple

Apple выпустила набор требований, называемый безопасности транспорта в приложение (ATS), которые могут повлиять на вызовы из приложения для iOS, проверку подлинности AD FS.  Можно обеспечить AD FS и серверы WAP соответствуют, убедившись, что они поддерживают [требования для подключения с использованием ATS](https://developer.apple.com/library/prerelease/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW57).  
В частности необходимо убедиться, что серверов AD FS и WAP поддерживают TLS 1.2, и что согласованного шифров TLS-подключение будет поддерживать безопасной пересылки.

Вы можете включить и отключить SSL 2.0 и 3.0 и TLS версий 1.0, 1.1 и 1.2 с помощью [управление протоколы SSL в Службах федерации Active Directory](../operations/Manage-SSL-Protocols-in-AD-FS.md).

Для обеспечения AD FS и WAP серверов согласования только TLS наборов шифров, поддерживающих ATP, вы можете отключить все наборы шифров, которые не находятся в [список шифров, совместимые с ATP](https://developer.apple.com/library/prerelease/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW57).  Чтобы сделать это, используйте [командлетов Windows TLS PowerShell](https://technet.microsoft.com/itpro/powershell/windows/tls/index). 


## <a name="operations"></a>Операции

### <a name="how-do-i-replace-the-ssl-certificate-for-ad-fs"></a>Как заменить сертификат SSL для Служб федерации Active Directory? 
AD FS SSL-сертификата не совпадает с сертификатом связи со службой AD FS, найти в оснастке управления AD FS.  Чтобы изменить сертификат AD FS SSL, необходимо использовать PowerShell. Следуйте инструкциям, приведенным в статье ниже:

[Управление SSL-сертификатов в AD FS и WAP 2016](../operations/Manage-SSL-Certificates-AD-FS-WAP-2016.md)

### <a name="how-can-i-enable-or-disable-tlsssl-settings-for-ad-fs"></a>Как включить или отключить параметры TLS/SSL для Служб федерации Active Directory
Чтобы отключить или включить протоколы SSL и наборы шифров, используйте следующую команду:

[Управление протоколы SSL в Службах федерации Active Directory](../operations/Manage-SSL-Protocols-in-AD-FS.md)

### <a name="does-the-proxy-ssl-certificate-have-to-be-the-same-as-the-ad-fs-ssl-certificate"></a>Нужно быть так же, как сертификат AD FS SSL SSL-сертификата прокси-сервера?  
Используйте следующие рекомендации в отношении прокси-сервера SSL-сертификат и сертификат AD FS SSL:


- Если прокси-сервер используется для прокси-сервера AD FS запросы, использующие встроенную проверку подлинности Windows, SSL-сертификата прокси-сервера должен совпадать с (использовать тот же ключ) SSL-сертификат сервера федерации
- Если службы федерации Active Directory свойство, которое является «ExtendedProtectionTokenCheck» включен (по умолчанию в AD FS), SSL-сертификата прокси-сервера должны быть одинаковыми (использовать тот же ключ) SSL-сертификата сервера федерации
- В противном случае — SSL-сертификата прокси-сервера может быть другой ключ из сертификата AD FS SSL, но должны соответствовать же [требования](../overview/AD-FS-2016-Requirements.md)

### <a name="how-can-i-configure-promptlogin-behavior-for-ad-fs"></a>Как настроить строки = поведение входа для службы федерации Active Directory?
Сведения о том, как настроить запрос = входа в систему, в разделе [служб федерации Active Directory запрос = поддержки параметр входа в систему](../operations/AD-FS-Prompt-Login.md).

### <a name="how-can-i-configure-browsers-to-use-windows-integrated-authentication-wia-with-ad-fs"></a>Как настроить браузеры, чтобы использовать встроенную проверку подлинности Windows (WIA) с AD FS

Сведения о том, как настройка браузерами см [браузерах настраивается использование встроенной проверки подлинности Windows (WIA) с AD FS](../operations/Configure-AD-FS-Browser-WIA.md).


### <a name="how-long-are-ad-fs-tokens-valid"></a>Как долго допустимых маркеров AD FS?

Часто этот вопрос означает «продолжительность пользователи получают возможность единого входа (SSO) без необходимости введите новые учетные данные и как к администратору контролировать,?»  Это поведение и параметры конфигурации, определяющие, описанные в статье [здесь](https://technet.microsoft.com/en-us/windows-server-docs/identity/ad-fs/operations/ad-fs-2016-single-sign-on-settings).

Ниже перечислены различные файлы cookie и маркеры время жизни по умолчанию (а также параметры, которые отвечают за время существования).

**Зарегистрированные устройства**

- "Cookie" PRT и единый вход: 90 дней максимальный, регулируются PSSOLifeTimeMins. (Предоставленный устройство используется каждые 14 дней, которое контролируется DeviceUsageWindow)

- Токен обновления: вычислены на основании выше, чтобы обеспечить согласованное поведение

- access_token: 1 час по умолчанию, в зависимости от проверяющей стороны

- id_token: то же, что маркер доступа

**Отмена регистрации устройств**

- Файлы cookie для единого входа: 8 часов, по умолчанию принимается в соответствии с SSOLifetimeMins.  При включении Keep мне вход (KMSI) по умолчанию — 24 часа и настраивается с помощью KMSILifetimeMins.


- Токен обновления: по умолчанию — 8 часов. 24 часа с KMSI включена

- access_token: 1 час по умолчанию, в зависимости от проверяющей стороны

- id_token: то же, что маркер доступа

### <a name="does-ad-fs-support-http-strict-transport-security-hsts"></a>Службы федерации Active Directory поддерживает строгой безопасности транспортировки (HSTS) HTTP?  

Строгой безопасности транспортировки (HSTS) HTTP — это механизм политики безопасности web, какие помогает свести протокол перехода на предыдущую атак и перехват файлов cookie для служб, которые имеют конечные точки HTTP и HTTPS. Она позволяет веб-серверы объявить, что веб-браузерах (или другие complying агентов пользователя) необходимо взаимодействовать только с ним с помощью HTTPS и никогда не по протоколу HTTP.

Все конечные точки AD FS для проверки подлинности веб-трафика открываются только по протоколу HTTPS.  В результате AD FS эффективна в снижении угрозы, которые предоставляет механизм политики HTTP строгой безопасности транспортировки (разработки не существует не ранних версий протокола HTTP, поскольку не прослушиватели HTTP). Кроме того службы федерации Active Directory предотвращает отправку на другой сервер с конечными точками протокола HTTP, помечая все файлы cookie с флагом безопасного файлы cookie.

Таким образом реализация HSTS на сервере Служб федерации Active Directory не требуется, так как никогда не будет понижена.  В целях соответствия серверов AD FS удовлетворяет этим требованиям, так как они никогда не может использоваться протокол HTTP, и все файлы cookie помеченные как безопасные.

### <a name="x-ms-forwarded-client-ip-does-not-contain-the-ip-of-the-client-but-contains-ip-of-the-firewall-in-front-of-the-proxy-where-can-i-get-the-right-ip-of-the-client"></a>X-ms пересылаются--IP-адрес клиента не содержит IP-адрес клиента, но содержит IP-адрес брандмауэра перед прокси-сервера. Где получить право IP-адрес клиента
Рекомендуется не выполнять завершение запросов SSL, прежде чем WAP. В случае завершения запросов SSL выполняется перед WAP, X-ms пересылаются--IP-адрес клиента будет содержать IP-адрес сетевого устройства перед WAP. Ниже приводится краткое описание различных IP-адресов, относящиеся к утверждения, которые поддерживаются службами AD FS.
 - x-ms--IP-адрес клиента: сети IP-адрес устройства, которая подключена к службе маркеров безопасности.  В случае запроса экстрасети всегда содержит WAP IP-адреса.
 - x-ms пересылаются--IP-адрес клиента: Многозначный утверждений, который будет содержать значения, направляемые для служб федерации Active Directory Exchange Online, а также IP-адрес устройства, которая подключена к WAP.
 - Userip: Экстрасети запросов это утверждение будет содержать значение x-ms пересылаются--IP-адрес клиента.  Для запросов интрасети это утверждение будет содержать значение x-ms--IP-адрес клиента.

### <a name="i-am-trying-to-get-additional-claims-on-the-user-info-endpoint-but-its-only-returning-subject-how-can-i-get-additional-claims"></a>Я хочу получать дополнительные утверждения в конечной точке данные пользователя, но возвращается только тема. Как получить дополнительные утверждения
Конечная точка службы федерации Active Directory сведений о пользователях всегда возвращает утверждения темы, как указано в стандартах OpenID. Службы федерации Active Directory не поддерживает дополнительные утверждения запроса через конечную точку сведений о пользователях. Если вам нужны дополнительные утверждения код маркера, см. статью [настраиваемые маркеров безопасности в AD FS](../development/custom-id-tokens-in-ad-fs.md).

### <a name="why-do-i-see-alot-of-1021-errors-on-my-ad-fs-servers"></a>Почему я вижу большое количество ошибок 1021 на Мои серверы Служб федерации Active Directory?
Это событие регистрируется обычно недопустимый доступа к ресурсам в службах AD FS для ресурса 00000003-0000-0000-c000-000000000000. Эта ошибка вызвана ошибочная действия клиента, где она попытается получить маркер доступа для службы граф Azure AD. Так как ресурс не существует в службах AD FS, в результате события идентификатор 1021 на серверах Служб федерации Active Directory. Его можно не учитывать предупреждения или ошибки для ресурса 00000003-0000-0000-c000-000000000000 в службах AD FS. 

### <a name="why-am-i-seeing-a-warning-for-failure-to-add-the-ad-fs-service-account-to-the-enterprise-key-admins-group"></a>Почему я вижу предупреждение для ошибки добавить учетную запись службы AD FS в группу администраторов предприятия ключ?
Эта группа создается только в том случае, когда контроллер домена Windows 2016 с ролью FSMO основного контроллера домена существует в домене. Для устранения ошибки, можно вручную создать группу и выполните ниже, чтобы предоставить необходимые разрешения после добавления учетной записи службы в качестве члена группы.
1.  Откройте **Active Directory-пользователи и компьютеры**. 
2.  **Щелкните правой кнопкой мыши** доменного имени в области навигации и **щелкните** свойства.
3.  **Нажмите кнопку** безопасности (Если вкладка "Безопасность" отсутствует, включите дополнительные функции из меню «Вид»).
4.  **Нажмите кнопку** Advanced. **Нажмите кнопку** добавить. **Нажмите кнопку** выберите субъект.
5.  Появится диалоговое окно "Выбор пользователей, компьютеров, учетной записи службы или группу".  В поле введите имя объекта выберите текстовое поле, введите ключ административной группы.  Нажмите кнопку ОК.
6.  В поле применяется в списке, выберите **объектов-потомков пользователей**.
7.  С помощью полосы прокрутки, перейдите в нижнюю часть страницы и **щелкните** "Очистить все".
8.  В **свойства** выберите **чтение msDS-KeyCredentialLink** и **записи msDS-KeyCrendentialLink**.

### <a name="why-does-modern-authentication-from-android-devices-fail-if-the-server-does-not-send-all-the-intermediate-certificates-in-the-chain-with-the-ssl-cert"></a>Почему современных проверки подлинности от устройств Android завершается неудачно, если сервер не отправляет все промежуточные сертификаты в цепочке с SSL-сертификат?

Федеративные пользователи могут замечать проверки подлинности в Azure AD для приложений, использующих Android ADAL сбоя библиотеки. Приложение получит **AuthenticationException** при попытке отображать страницу входа в систему. В AD FS chrome страницы входа в систему могут быть вызваны как небезопасное.

Android - различных все версии и все устройства — не поддерживает загрузки дополнительных сертификатов с **authorityInformationAccess** сертификата. Это также справедливо для браузера Chrome. Если всей цепочки сертификатов не передаются от AD FS любой сертификат проверки подлинности сервера, который отсутствует промежуточные сертификаты приведет к этой ошибки. 

Правильное решение этой проблемы является настройка серверов AD FS и WAP отправлять промежуточных сертификатов, необходимых вместе с SSL-сертификат. 

При экспорте сертификата SSL, с одного компьютера, чтобы импортировать в личном хранилище компьютера серверов AD FS и WAP, убедитесь, что экспорт закрытого ключа и выберите **обмена личной информацией - PKCS #12**. 

Очень важно, что флажок **включить по возможности все сертификаты в путь сертификата** установлен, а также **экспортировать все расширенные свойства**. 

Запустите certlm.msc на серверах Windows и импортировать *. PFX-ФАЙЛ в хранилище личных сертификатов на компьютере. Это приведет к передать библиотеке ADAL всю цепочку сертификатов сервера. 

>[!NOTE]
> Для включения всей цепочки сертификатов при его наличии также должны обновляться сертификата хранилища из сети подсистем балансировки нагрузки

### <a name="does-ad-fs-support-head-requests"></a>Службы федерации Active Directory поддерживает запросы HEAD?
Службы федерации Active Directory не поддерживает запросы HEAD.  Приложения не должны использовать запросы HEAD от конечных точек AD FS.  Это может вызвать сообщения об ошибках HTTP, непредвиденным и (или) задержкой.  Кроме того вы можете увидеть события непредвиденных ошибок в журнале событий Служб федерации Active Directory.

### <a name="why-am-i-not-seeing-a-refresh-token-when-i-am-logging-in-with-a-remote-idp"></a>Почему я не вижу токен обновления при я входа с помощью удаленного IdP?
Токен обновления не будет выдано, если маркера, выданного IdP validty менее 1 часа. Чтобы убедиться, что выдается токен обновления, увеличьте срок действия маркера выданный IdP превышающее 1 час.
