---
title: Диагностика DirectAccess
description: В этом разделе содержатся сведения об устранении неполадок развертывания DirectAccess в Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-da
ms.topic: article
ms.assetid: 61040e19-5960-4eb0-b612-d710627988f7
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 2a705e5768ecdf55aaba99900671cb105ede4607
ms.sourcegitcommit: d5e27c1f2f168a71ae272bebf8f50e1b3ccbcca3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/23/2020
ms.locfileid: "86964656"
---
# <a name="troubleshooting-directaccess"></a>Диагностика DirectAccess

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

Выполните следующие действия, чтобы устранить неполадки удаленного доступа (DirectAccess).  
  
|||  
|-|-|  
|**Проблема**|**Способы устранения:**|  
|Консоли управления удаленным доступом не удается отобразить конфигурацию DirectAccess|**Восстановление отсутствующих сведений о конфигурации**<br />— При устранении неполадок многосайтового развертывания убедитесь, что контроллер домена, ближайший к точке входа, доступен.<br />— Используйте командлет **Get-даентрипоинтдк** , чтобы получить имя контроллера домена, ближайшего к точке входа. Если контроллер домена не работает, используйте командлет **Set-даентрипоинтдк** , чтобы указать другой контроллер домена.<br />— Запустите **gpresult** из командной строки с повышенными привилегиями на сервере, чтобы убедиться, что сервер получает объекты групповая политика DirectAccess.<br />— Включение ведения журнала пользовательского интерфейса.<br />— Используйте следующую команду для запуска ведения журнала Windows PowerShell:<pre>logman create trace ETWTrace -ow -o c:\ETWTrace.etl -p {AAD4C46D-56DE-4F98-BDA2-B5EAEBDD2B04} 0xffffffffffffffff 0xff -nb 16 16 -bs 1024 -mode 0x2 -max 2048 -ets <br />logman update trace ETWTrace -p {62DFF3DA-7513-4FCA-BC73-25B111FBB1DB} 0xffffffffffffffff 0xff -ets</pre><repro>— Закрытие и повторное открытие пользовательского интерфейса.<br />— Отключить ведение журнала Windows PowerShell. Собирайте файлы журнала трассировки событий. Кроме того, собирайте все журналы из папки **% WINDIR%/траЦинг** .|  
|Не удается применить конфигурацию DirectAccess|**Обновление конфигурации DirectAccess**<br />— При устранении неполадок многосайтового развертывания убедитесь, что контроллер домена, ближайший к точке входа, доступен.<br />— Используйте командлет **Get-даентрипоинтдк** , чтобы получить имя контроллера домена, ближайшего к точке входа. Если контроллер домена не работает, используйте командлет **Set-даентрипоинтдк** , чтобы указать другой контроллер домена.<br />— Используйте следующую команду для запуска ведения журнала Windows PowerShell:<br /><pre>logman create trace ETWTrace -ow -o c:\ETWTrace.etl -p {AAD4C46D-56DE-4F98-BDA2-B5EAEBDD2B04} 0xffffffffffffffff 0xff -nb 16 16 -bs 1024 -mode 0x2 -max 2048 -ets<br />logman update trace ETWTrace -p {62DFF3DA-7513-4FCA-BC73-25B111FBB1DB} 0xffffffffffffffff 0xff -ets</pre>    <repro><br />— Нажмите кнопку **Применить**.<br />— После возникновения сбоя отключите ведение журнала Windows PowerShell и собирайте журнал трассировки событий.|  
|DirectAccess настроен, но клиенты не могут подключаться к внутренним ресурсам|**Устранение проблем с подключением клиентов**<br />— Щелкните вкладку **состояние операций** в консоли управления удаленным доступом и убедитесь, что все компоненты отображают зеленый значок. Если нет, проверьте сведения об ошибке и следуйте инструкциям по устранению.<br />— Запуск сервера удаленного доступа анализатор соответствия рекомендациям (BPA). При наличии предупреждений или ошибок выполните действия по устранению проблемы.|  
|Возникновение проблем, связанных с многосайтововой конфигурацией (например, включение многосайтового режима, Добавление точек входа или установка контроллера домена для точки входа)|Выполните действия, описанные в разделе [Устранение неполадок многосайтового развертывания](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj554657(v=ws.11)).|  
|Плитка состояния конфигурации на панели мониторинга отображает предупреждение или ошибку|Выполните действия, описанные в разделе [мониторинг состояния распространения конфигурации сервера удаленного доступа](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj574221(v=ws.11)).|  
|Проблемы, связанные с настройкой балансировки нагрузки (например, сбой конфигурации при включении балансировки нагрузки или при добавлении или удалении серверов из кластера).|Если вы включаете балансировку нагрузки или добавляете узел, а конфигурация обновляется при нажатии кнопки **Применить**, но кластер не был правильно сформирован на сервере, выполните следующую команду: **cmd.exe/c "Reg Add Хклм\систем\куррентконтролсет\сервицес\рамгмтсвк\параметерс/f/v дебугфлаг/t REG_DWORD/d" "0xffffffff" ""** , чтобы получить журналы пользовательского интерфейса на новом сервере.|  
|Состояние операций отображает ошибку или предупреждение после выполнения следующих действий, чтобы исправить ситуацию.|Если в состоянии операций отображаются неверные сведения (например, ошибки — даже после их исправления):<p>— Включите раздел реестра **cmd.exe/c "Reg Add хклм\систем\куррентконтролсет\сервицес\рамгмтсвк\параметерс/f/V енаблетраЦинг/t REG_DWORD/d" "5" "**".<br />— Обновите состояние операций и собирайте журналы из **% WINDIR%/траЦинг**.|  
|Клиентские компьютеры Windows 8 и более поздних версий DirectAccess сообщают об отсутствии Интернета в качестве состояния подключения DirectAccess, а индикатор состояния сетевого подключения (NCSI) сообщает о ограниченном подключении.|Это может произойти, если в конфигурации DirectAccess включено принудительное туннелирование, и в связи с этим используется только IPHTTPS. Чтобы устранить эту проблему, можно создать и настроить прокси-сервер. Затем NCSI использует прокси-сервер для выполнения проверок подключения к Интернету. Рекомендуется добавить статический прокси-сервер в таблица политики разрешения имен (NRPT) с помощью следующей процедуры.<p>Перед выполнением команд в этой процедуре убедитесь, что все доменные имена, имена компьютеров и другие переменные команд Windows PowerShell заменены значениями, подходящими для вашего развертывания.<p>**Настройка статического прокси-сервера для правила NRPT**<br />1. Отображение "." Правило NRPT:`Get-DnsClientNrptRule -GpoName "corp.example.com\DirectAccess Client Settings" -Server <DomainControllerNetBIOSName>`<br />2. Запишите имя (GUID) "." Правило NRPT. Имя (GUID) должно начинаться с **da-{.}**<br />3. Задайте учетную запись-посредник для "." Правило NRPT для **proxy.Corp.example.com:8080**:`Set-DnsClientNrptRule -Name "DA-{..}" -Server <DomainControllerNetBIOSName> -GPOName "corp.example.com\DirectAccess Client Settings" -DAProxyServerName "proxy.corp.example.com:8080" -DAProxyType "UseProxyName"`<br />4. Отображение "." Повторите правило NRPT, выполнив команду `Get-DnsClientNrptRule` , и убедитесь, что **проксифкдн: порт** настроен правильно.<br />5. Обновите групповая политика, запустив `gpupdate /force` на клиенте DirectAccess, когда клиент подключается внутренним образом, отобразите NRPT с помощью `Get-DnsClientNrptPolicy` и убедитесь, что в правиле "." отображается **проксифкдн: Port**.|  
  
