---
title: Планирование мощности DirectAccess
description: Этот раздел можно использовать для отчета о производительности сервера DirectAccess Windows Server 2012, чтобы помочь в планировании емкости для DirectAccess в Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-da
ms.topic: article
ms.assetid: 456e5971-3aa7-4a24-bc5d-0c21fec7687e
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 85ac9d40ec0de0a896e99d56679b325cdfc387ff
ms.sourcegitcommit: 3632b72f63fe4e70eea6c2e97f17d54cb49566fd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/03/2020
ms.locfileid: "87517689"
---
# <a name="directaccess-capacity-planning"></a>Планирование мощности DirectAccess

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

Данный документ представляет собой отчет о производительности сервера DirectAccess в Windows Server 2012. Тестирование выполнялось с целью определения пропускной способности, при этом использовалось компьютерное оборудование с высоким и низким быстродействием. Производительность ЦП с высоким и низким быстродействием зависела от пропускной способности сетевого трафика и типов используемых клиентов. Типичное развертывание DirectAccess (и база для описываемых тестов) на 1/3 (30 %) состоит из IPHTTPS-клиентов, и на 2/3 (70 %) — из клиентов Teredo. Клиенты Teredo отчасти превосходят клиенты IPHTTPS, так как Windows Server 2012 использует технологию масштабирования на стороне приема (RSS), что позволяет использовать все ядра ЦП. В этих тестах технология RSS включена, поэтому технология Hyper Threading отключена. Кроме того, TCP/IP в Windows Server 2012 поддерживает трафик UDP, что позволяет клиентам Teredo распределять нагрузку между несколькими ЦП.

Были собраны данные от сервера с низким быстродействием (4 ядра, 4 ГБ ОЗУ) и от оборудования, которое считается более типичным для высокопроизводительных серверов (8 ядер, 8 ГБ ОЗУ).  Ниже приведен снимок экрана с новым диспетчером задач Windows 8 на оборудовании низкого уровня с 750 клиентами (562 Teredo, 188 IPHTTPS) под управлением ~ 77 Мбит/с. Это предназначено для имитации пользователей, которые не представляют учетные данные смарт-карты.

Эти результаты тестов показывают, что в Windows 8 клиенты Teredo демонстрируют большую производительность, чем клиенты IPHTTPS, но использование пропускной способности по сравнению с Windows 7 улучшено и для Teredo, и для IPHTTPS.

![Результаты испытаний](../../media/DirectAccess-Capacity-Planning/DACapacityPlanning1.gif)

## <a name="high-end-hardware-test-environment"></a>Тестовая среда оборудования с высоким быстродействием
В следующей таблице показаны результаты в тестовой среде оборудования с высоким быстродействием. В этом документе приводится подробное описание и анализ всех результатов тестов.

| Конфигурация — оборудование | Оборудование с низким быстродействием (4 ГБ ОЗУ, 4 ядра) | Оборудование с высоким быстродействием (8 ГБ, 8 ядер) |
|--|--|--|
| Двойной туннель<p>— PKI<p>— Включение DNS64/NAT64 | 750 параллельных подключений при 50 % использовании ЦП, 50 % использовании памяти и пропускной способности сетевого адаптера сети предприятия 75 Мбит/с. Предельная цель — 1000 пользователей при 50 % использовании ЦП. | 1500 параллельных подключений при 50 % использовании ЦП, 50 % использовании памяти и пропускной способности сетевого адаптера сети предприятия 150 Мбит/с. |

## <a name="test-environment"></a>Тестовая среда

**Топология измерения производительности**

![Тестовая среда](../../media/DirectAccess-Capacity-Planning/DACapacityPlanning2.gif)

Среда для тестирования производительности представляет собой установку из 5 компьютеров. Для тестирования на оборудовании с низким быстродействием использовался один 4-ядерный сервер DirectAccess с 4 ГБ ОЗУ. Для тестирования на оборудовании с высоким быстродействием использовался один 8-ядерный сервер DirectAccess c 16 ГБ ОЗУ. Для тестовой среды оборудования с высоким быстродействием и оборудования с низким быстродействием использовалась следующая конфигурация: один сервер (отправитель) и два клиентских компьютера (получатели).  Получатели были распределены между двумя клиентскими компьютерами. В противном случае получатели были бы привязаны к ЦП и ограничивали бы количество клиентов и пропускную способность. На стороне получения — имитатор для имитации сотен клиентов (имитируются либо клиенты HTTPS, либо клиенты Teredo). Настроены протоколы IPsec и DOSp. На сервере DirectAccess включена технология RSS. Размер очереди RSS установлен на 8.  Без настройки RSS одно ядро процессора использовалось бы наиболее интенсивно, а остальные ядра — недостаточно. Следует также отметить, что сервер DirectAccess представляет собой 4-ядерный компьютер с отключенной технологией Hyper Threading.  Технология Hyper Threading отключена потому, что RSS работает только на физических ядрах, а использование этой технологии исказило бы результаты. (То есть не все ядра будут равномерно загружены.)

## <a name="testing-results-for-low-end-hardware"></a>Результаты тестирования для оборудования с низким быстродействием:

Тестирование проводилось с 1000 и с 750 клиентами.  Во всех случаях трафик делился в следующем отношении: 70 % — клиенты Teredo и 30 % — клиенты IPHTTPS.  Во всех тестах использовался TCP-трафик через Nat64 с использованием 2 туннелей IPsec для каждого клиента.  Во всех тестах использование памяти было незначительным, а использование ЦП — приемлемым.

**Результаты отдельных тестов:**

В следующих разделах приводится описание отдельных тестов. В заголовке каждого раздела выделены основные элементы каждого теста с кратким описанием результатов; далее следует таблица с подробной информацией о результатах.

**Низкая производительность:  750 клиентов, разделение трафика — 70/30, пропускная способность — 84,17 Мбит/с:**

Следующие три теста представляют оборудование с низким быстродействием.  Следующие тесты выполнялись с 750 клиентами и пропускной способностью 84,17 Мбит/с и разделением трафика между 562 клиентами Teredo и 188 клиентами IPHTTPS. Для Teredo было установлено значение MTU 1472; функция обхода Teredo была включена. Среднее использование ЦП во всех трех тестах составило 46,42 %, а среднее использование памяти, выраженное в процентах зарегистрированного количества байт от общей доступной памяти в 4 ГБ, — 25,95 %.

||||||||
|-|-|-|-|-|-|-|
|**Сценарий**|**Среднее использование ЦП (по счетчику)**|**Мбит/с (на стороне предприятия)**|**Мбит/с (на стороне Интернета)**|**Активные QMSA**|**Активные MMSA**|**Использование памяти (система с 4 ГБ ОЗУ)**|
|**Низкоуровневое оборудование.  562 клиенты Teredo.  188. клиенты IPHTTPS.**|47,7472542|84,3|119,13|1502,05|1502,1|26,27 %|
|**Низкоуровневое оборудование.  562 клиенты Teredo.  188. клиенты IPHTTPS.**|46,3889778|84,146|118,73|1501,25|1501,2|25,90 %|
|**Низкоуровневое оборудование.  562 клиенты Teredo.  188. клиенты IPHTTPS.**|45,113082|84,0494|118,43|1546,14|1546,1|25,68 %|

**1000 клиентов, разделение трафика 70/30, пропускная способность 78 Мбит/с:**

Следующие три теста представляют производительность на оборудовании с низким быстродействием. В следующих тестах использовалось 1000 клиентов со средней пропускной способностью примерно 78,64 Мбит/с и разделением трафика между 700 клиентами Teredo и 300 клиентами IPHTTPS.  Для Teredo было установлено значение MTU 1472; функция обхода Teredo была включена.  Среднее использование ЦП во всех трех тестах составило около 50,7 %, а среднее использование памяти, выраженное в процентах зарегистрированного количества байт от общей доступной памяти в 4 ГБ, — приблизительно 28,7 %.

||||||||
|-|-|-|-|-|-|-|
|**Сценарий**|**Среднее использование ЦП (по счетчику)**|**Мбит/с (на стороне предприятия)**|**Мбит/с (на стороне Интернета)**|**Активные QMSA**|**Активные MMSA**|**Использование памяти (система с 4 ГБ ОЗУ)**|
|**Низкоуровневое оборудование.  700 клиенты Teredo.  300. клиенты IPHTTPS.**|51,28406247|78,6432|113,19|2002,42|1502,1|25,59 %|
|**Низкоуровневое оборудование.  700 клиенты Teredo.  300. клиенты IPHTTPS.**|51,06993128|78,6402|113,22|2001,4|1501,2|30,87 %|
|**Низкоуровневое оборудование.  700 клиенты Teredo.  300. клиенты IPHTTPS.**|49,75235617|78,6387|113,2|2002,6|1546,1|30,66 %|

**1000 клиентов, разделение трафика 70/30, пропускная способность 109 Мбит/с:**

В следующих трех тестах использовались 1000 клиентов со средней пропускной способностью примерно 109,2 Мбит/с и разделением трафика между 700 клиентами Teredo и 300 клиентами IPHTTPS. Для Teredo было установлено значение MTU 1472; функция обхода Teredo была включена. Среднее использование ЦП во всех трех тестах составило приблизительно 59,06 %, а среднее использование памяти, выраженное в процентах зарегистрированного количества байт от общей доступной памяти в 4 ГБ, — примерно 27,34 %.

||||||||
|-|-|-|-|-|-|-|
|**Сценарий**|**Среднее использование ЦП (по счетчику)**|**Мбит/с (на стороне предприятия)**|**Мбит/с (на стороне Интернета)**|**Активные QMSA**|**Активные MMSA**|**Использование памяти (система с 4 ГБ ОЗУ)**|
|**Низкоуровневое оборудование.  700 клиенты Teredo.  300. клиенты IPHTTPS.**|59,81640675|108,305|153,14|2001,64|2001,6|24,38 %|
|**Низкоуровневое оборудование.  700 клиенты Teredo.  300. клиенты IPHTTPS.**|59,46473798|110,969|157,53|2005,22|2005,2|28,72 %|
|**Низкоуровневое оборудование.  700 клиенты Teredo.  300. клиенты IPHTTPS.**|57,89089768|108,305|153,14|1999,53|2018,3|24,38 %|

## <a name="testing-results-for-high-end-hardware"></a>Результаты тестирования для оборудования с высоким быстродействием:
Тестирование проводилось с 1500 клиентами. Трафик делился в следующем отношении: 70 % — клиенты Teredo и 30 % — клиенты IPHTTPS. Во всех тестах использовался TCP-трафик через Nat64 с использованием 2 туннелей IPsec для каждого клиента. Во всех тестах использование памяти было незначительным, а использование ЦП — приемлемым.

**Результаты отдельных тестов:**

В следующих разделах приводится описание отдельных тестов. В заголовке каждого раздела выделены основные элементы каждого теста с кратким описанием результатов; далее следует таблица с подробной информацией о результатах.

**1500 клиентов, разделение трафика 70/30, пропускная способность 153,2 Мбит/с**

Следующие пять тестов представляют оборудование с высоким быстродействием. В следующих тестах использовались 1500 клиентов со средней пропускной способностью примерно 153,2 Мбит/с и разделением трафика между 1050 клиентами Teredo и 450 клиентами IPHTTPS. Среднее использование ЦП во всех пяти тестах составило 50,68 %, а среднее использование памяти, выраженное в процентах зарегистрированного количества байт от общей доступной памяти в 8 ГБ, — 22,25 %.

||||||||
|-|-|-|-|-|-|-|
|**Сценарий**|**Среднее использование ЦП (по счетчику)**|**Мбит/с (на стороне предприятия)**|**Мбит/с (на стороне Интернета)**|**Активные QMSA**|**Активные MMSA**|**Использование памяти (система с 4 ГБ ОЗУ)**|
|**Высокопроизводительное оборудование.  1050 клиенты Teredo.  450. клиенты IPHTTPS.**|51,712437|157,029|216,29|3000,31|3046|21,58 %|
|**Высокопроизводительное оборудование.  1050 клиенты Teredo.  450. клиенты IPHTTPS.**|48,86020205|151,012|206,53|3002,86|3045,3|21,15 %|
|**Высокопроизводительное оборудование.  1050 клиенты Teredo.  450. клиенты IPHTTPS.**|52,23979519|155,511|213,45|3001,15|3002,9|22,90 %|
|**Высокопроизводительное оборудование.  1050 клиенты Teredo.  450. клиенты IPHTTPS.**|51,26269767|155,09|212,92|3000,74|3002,4|22,91 %|
|**Высокопроизводительное оборудование.  1050 клиенты Teredo.  450. клиенты IPHTTPS.**|50,15751307|154,772|211,92|3000,9|3002,1|22,93 %|
|**Высокопроизводительное оборудование.  1050 клиенты Teredo.  450. клиенты IPHTTPS.**|49,83665607|145,994|201,92|3000,51|3006|22,03 %|

![Результаты тестирования высококачественного оборудования](../../media/DirectAccess-Capacity-Planning/DACapacityPlanning3.gif)



