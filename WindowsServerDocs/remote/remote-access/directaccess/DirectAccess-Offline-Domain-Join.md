---
title: Автономное присоединение к домену DirectAccess
description: В этом руководстве описываются действия для присоединения к домену в автономном режиме с помощью DirectAccess в Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-da
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 55528736-6c19-40bd-99e8-5668169ef3c7
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 59b5933a81c7021e58ea14e6ea4c4da374ce35cb
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67283664"
---
# <a name="directaccess-offline-domain-join"></a>Автономное присоединение к домену DirectAccess

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

В этом руководстве описываются действия для выполнения соединения домену в автономном режиме с помощью DirectAccess. Во время присоединения к домену в автономном режиме компьютер настроен для присоединения к домену без физического или VPN-подключение.  
  
Ниже перечислены разделы данного руководства.  
  
- Общие сведения о присоединения к домену в автономном режиме  
  
- Требования для присоединения к домену в автономном режиме
  
- Процесс присоединения к домену в автономном режиме
  
- Пошаговые инструкции по выполнению Автономное присоединение к домену  
  
## <a name="offline-domain-join-overview"></a>Общие сведения о присоединения к домену в автономном режиме  
Контроллеры домена, появились в Windows Server 2008 R2, входит функция вызывается Автономное присоединение к домену. Программа командной строки с именем Djoin.exe позволяет присоединить компьютер к домену без физически обращения к контроллером домена при завершении операции подключения к домену. Ниже приведены общие действия по использованию Djoin.exe.  
  
1.  Запустите **djoin /provision** для создания метаданных учетной записи компьютера. Выходные данные этой команды является файл .txt, который содержит большой двоичный объект кодировке base-64.  
  
2.  Запустите **djoin /requestODJ** Вставка метаданные учетной записи компьютера из txt-файл в каталоге Windows конечного компьютера.  
  
3.  Перезагрузите конечный компьютер и компьютер будет присоединен к домену.  
  
### <a name="BKMK_ODJOverview"></a>Автономное присоединение к домену с Обзор сценария политики DirectAccess  
DirectAccess Автономное присоединение к домену — это процесс, который можно использовать для присоединения к домену без физического соединения к корпоративной сети компьютеров под управлением Windows Server 2016, Windows Server 2012, Windows 10 и Windows 8 или подключении через VPN. Это делает возможным присоединение компьютеров к домену из расположений там, где отсутствует подключение к корпоративной сети. Автономное присоединение к домену для DirectAccess обеспечивает политики DirectAccess для клиентов, для разрешения удаленной подготовки.  
  
Присоединение к домену создается учетная запись компьютера и устанавливает отношение доверия между компьютером под управлением операционной системы Windows и домен Active Directory.  
  
## <a name="BKMK_ODJRequirements"></a>Подготовка для присоединения к домену в автономном режиме  
  
1.  Создание учетной записи компьютера.  
  
2.  Проведите инвентаризацию членство всех групп безопасности, к которому принадлежит учетной записи компьютера.  
  
3.  Соберите необходимые сертификаты, групповые политики и объекты групповой политики для применения в новых клиентах.  
  
. Требования к операционной системе и требования к учетным данным для выполнения присоединение к домену в автономном режиме DirectAccess с помощью Djoin.exe в следующих разделах.  
  
### <a name="operating-system-requirements"></a>Требования к операционной системе  
Для DirectAccess Djoin.exe запускаются только на компьютерах под управлением Windows Server 2016, Windows Server 2012 или Windows 8. Компьютер, на котором выполняется Djoin.exe чтобы подготавливать данные учетной записи компьютера в Доменных службах Active Directory должны выполняться в Windows Server 2016, Windows 10, Windows Server 2012 или Windows 8. Компьютер, который требуется присоединить к домену также выполняется Windows Server 2016, Windows 10, Windows Server 2012 или Windows 8.  
  
### <a name="credential-requirements"></a>Требования к учетным данным  
Чтобы выполнить Автономное присоединение к домену, необходимо иметь права, необходимые для присоединения рабочих станций к домену. По умолчанию члены группы "Администраторы домена" имеют эти права. Если вы не является членом группы "Администраторы домена", является членом группы "Администраторы домена" необходимо выполнить одно из следующих действий, чтобы можно было присоединить к домену рабочих станций:  
  
-   Используйте групповую политику, чтобы предоставить необходимые права. Этот метод позволяет создать компьютеров в контейнере компьютеров по умолчанию и в любое подразделение (OU), созданный позже (если не запретить записи управления доступом (ACE) добавляются).  
  
-   Измените список управления доступом (ACL) контейнера компьютеров по умолчанию для домена для делегирования разрешений на вас.  
  
-   Создайте Подразделение и изменение списка ACL для этого Подразделения, чтобы он предоставил вам **создать дочерний - Разрешить** разрешение. Передайте **/machineOU** параметр **djoin /provision** команды.  
  
В следующих процедурах показано, как предоставить пользователю права с помощью групповой политики и делегирование разрешений.  
  
#### <a name="granting-user-rights-to-join-workstations-to-the-domain"></a>Предоставление прав пользователя для присоединения к домену рабочих станций  
Консоль управления групповыми политиками (GPMC) можно использовать для изменения политики домена или создайте новую политику, которая имеет параметры, которые предоставляют пользователю право на добавление рабочих станций к домену.  
  
Членство в группе **"Администраторы домена"** , или эквивалентной является минимальным требованием для предоставления прав пользователя.  Просмотрите сведения об использовании соответствующих учетных записей и членства в группах в [локальные и доменные группы по умолчанию](https://go.microsoft.com/fwlink/?LinkId=83477) (https://go.microsoft.com/fwlink/?LinkId=83477).   
  
###### <a name="to-grant-rights-to-join-workstations-to-a-domain"></a>Предоставить права на присоединение к домену рабочих станций  
  
1.  Нажмите кнопку **запустить**, нажмите кнопку **Администрирование**, а затем нажмите кнопку **Управление групповой политикой**.  
  
2.  Дважды щелкните имя леса, дважды щелкните **домены**, дважды щелкните имя домена, в котором вы хотите присоединить компьютер, щелкните правой кнопкой мыши **политика домена по умолчанию**, а затем нажмите кнопку  **Изменить**.  
  
3.  В дереве консоли дважды щелкните **Конфигурация компьютера**, дважды щелкните **политики**, дважды щелкните **параметры Windows**, дважды щелкните **безопасности Параметры**, дважды щелкните **локальные политики**, а затем дважды щелкните **назначение прав пользователя**.  
  
4.  В области сведений дважды щелкните **Добавление рабочих станций к домену**.  
  
5.  Выберите **определить следующие параметры политики** флажок и нажмите кнопку **добавить пользователя или группу**.  
  
6.  Введите имя учетной записи, который требуется предоставить пользователю права на, а затем нажмите кнопку **ОК** дважды.  
  
## <a name="BKMK_ODKSxS"></a>Процесс присоединения к домену в автономном режиме  
Запустите Djoin.exe окно командной строки с повышенными правами, для подготовки метаданные учетной записи компьютера. При выполнении команды подготовки метаданные учетной записи компьютера создается в двоичный файл, который задан как часть команды.  
  
Дополнительные сведения о NetProvisionComputerAccount функция, которая используется для подготовки учетной записи компьютера во время присоединения к домену в автономном режиме, см. в разделе [функция NetProvisionComputerAccount](https://go.microsoft.com/fwlink/?LinkId=162426) (https://go.microsoft.com/fwlink/?LinkId=162426). Дополнительные сведения о функции NetRequestOfflineDomainJoin, работающая локально на конечном компьютере, см. в разделе [функция NetRequestOfflineDomainJoin](https://go.microsoft.com/fwlink/?LinkId=162427) (https://go.microsoft.com/fwlink/?LinkId=162427).  
  
## <a name="BKMK_ODJSteps"></a>Пошаговые инструкции по выполнению DirectAccess Автономное присоединение к домену  
Процесс присоединения к домену в автономном режиме включает следующие шаги:  
  
1.  Создать учетную запись компьютера для каждого из удаленных клиентов и создания пакет подготовки с помощью команды Djoin.exe из уже присоединенные к домену компьютере в корпоративной сети.  
  
2.  Добавить клиентский компьютер в группу безопасности DirectAccessClients  
  
3.  Безопасно перенесите пакет подготовки к удаленным компьютерам (s), которые будут включены в состав домена.  
  
4.  Применить пакет установки и присоединить к домену клиента.  
  
5.  Перезагрузка клиента, чтобы завершить присоединение к домену и установить подключение.  
  
Существует два варианта необходимо учитывать при создании пакета подготовки для клиента. Если вы использовали мастер начальной настройки для установки DirectAccess без инфраструктуры открытых КЛЮЧЕЙ, следует использовать вариант 1 ниже. Если вы использовали мастер расширенной настройки для установки DirectAccess с PKI, следует использовать параметр 2 ниже.  
  
Выполните следующие действия для присоединения к домену в автономном режиме.  
  
##### <a name="option1-create-a-provisioning-package-for-the-client-without-pki"></a>Вариант 1. Создайте пакет подготовки для клиента без инфраструктуры открытого ключа  
  
1.  В командной строке сервера удаленного доступа введите следующую команду, чтобы подготовить учетную запись компьютера:  
  
    ```  
    Djoin /provision /domain <your domain name> /machine <remote machine name> /policynames DA Client GPO name /rootcacerts /savefile c:\files\provision.txt /reuse  
    ```  
  
##### <a name="option2-create-a-provisioning-package-for-the-client-with-pki"></a>Вариант 2: Создайте пакет подготовки для клиента с помощью PKI  
  
1.  В командной строке сервера удаленного доступа введите следующую команду, чтобы подготовить учетную запись компьютера:  
  
    ```  
    Djoin /provision /machine <remote machine name> /domain <Your Domain name> /policynames <DA Client GPO name> /certtemplate <Name of client computer cert template> /savefile c:\files\provision.txt /reuse  
    ```  
  
##### <a name="add-the-client-computer-to-the-directaccessclients-security-group"></a>Добавить клиентский компьютер в группу безопасности DirectAccessClients  
  
1.  На контроллере домена из **запустить** введите **Active** и выберите **Active Directory — пользователи и компьютеры** из **приложений** экрана .  
  
2.  Разверните дерево под именем своего домена и выберите **пользователей** контейнера.  
  
3.  В области сведений щелкните правой кнопкой мыши **DirectAccessClients**и нажмите кнопку **свойства**.  
  
4.  На вкладке **Члены группы** щелкните **Добавить**.  
  
5.  Нажмите кнопку **типы объектов**выберите **компьютеров**, а затем нажмите кнопку **ОК**.  
  
6.  Введите имя клиента, чтобы добавить и нажмите кнопку **ОК**.  
  
7.  Нажмите кнопку **ОК** закрыть **DirectAccessClients** диалоговое окно свойств, а затем закройте **Active Directory — пользователи и компьютеры**.  
  
##### <a name="copy-and-then-apply-the-provisioning-package-to-the-client-computer"></a>Скопируйте и затем применить пакет установки на клиентском компьютере  
  
1.  Скопируйте пакет подготовки из c:\files\provision.txt на сервере удаленного доступа, где он был сохранен, чтобы c:\provision\provision.txt на клиентском компьютере.  
  
2.  На клиентском компьютере откройте командную строку с повышенными правами и введите следующую команду, чтобы запросить присоединение к домену:  
  
    ```  
    Djoin /requestodj /loadfile C:\provision\provision.txt /windowspath %windir% /localos  
    ```  
  
3.  Перезагрузите компьютер клиента. Компьютер будет присоединен к домену. После перезагрузки клиент будет присоединен к домену и иметь возможность подключения к корпоративной сети через DirectAccess.  
  
## <a name="see-also"></a>См. также  
[Функция NetProvisionComputerAccount](https://go.microsoft.com/fwlink/?LinkId=162426)  
[Функция NetRequestOfflineDomainJoin](https://go.microsoft.com/fwlink/?LinkId=162427)  
  


