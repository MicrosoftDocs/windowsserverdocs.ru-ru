---
title: Автономное присоединение к домену DirectAccess
description: В этом руководстве описаны действия по выполнению автономного присоединение к домену с DirectAccess в Windows Server 2016.
manager: brianlic
ms.topic: article
ms.assetid: 55528736-6c19-40bd-99e8-5668169ef3c7
ms.author: jgerend
author: JasonGerend
ms.date: 08/07/2020
ms.openlocfilehash: 7c09fdf397419de3e7a91c923cef71e261241d15
ms.sourcegitcommit: db4c35ebe56d561768d2a657da9e6d6a791457bd
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "101828263"
---
# <a name="directaccess-offline-domain-join"></a>Автономное присоединение к домену DirectAccess

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

В этом руководстве описаны действия по выполнению автономного присоединение к домену с DirectAccess. Во время присоединения к автономному домену компьютер настраивается для присоединения к домену без физического или VPN-подключения.

Ниже перечислены разделы данного руководства.

- Обзор автономного присоединение к домену

- Требования к присоединению автономного домена

- Процесс присоединение к домену вне сети

- Действия по выполнению автономного присоединение к домену

## <a name="offline-domain-join-overview"></a>Обзор автономного присоединение к домену
Контроллеры домена, появившиеся в Windows Server 2008 R2, включают функцию, называемую автономным присоединением к домену. Программа командной строки с именем Djoin.exe позволяет присоединить компьютер к домену, не подключаясь к контроллеру домена при выполнении операции приподключения к домену. Ниже приведены общие действия по использованию Djoin.exe.

1.  Запустите **Djoin/провисион** , чтобы создать метаданные учетной записи компьютера. Выходные данные этой команды представляют собой txt-файл, который содержит большой двоичный объект в кодировке Base 64.

2.  Запустите **Djoin/рекуестодж** , чтобы вставить метаданные учетной записи компьютера из файла. txt в каталог Windows конечного компьютера.

3.  Перезагрузите конечный компьютер, и компьютер будет присоединен к домену.

### <a name="offline-domain-join-with-directaccess-policies-scenario-overview"></a><a name="BKMK_ODJOverview"></a>Обзор сценария автономного присоединение к домену с помощью политик DirectAccess
Автономное присоединение к домену DirectAccess — это процесс, в котором компьютеры под управлением Windows Server 2016, Windows Server 2012, Windows 10 и Windows 8 могут использовать для присоединения к домену без физического соединения с корпоративной сетью или подключения через VPN. Это позволяет присоединять компьютеры к домену из расположений, в которых нет подключения к корпоративной сети. Присоединение автономного домена для DirectAccess предоставляет клиентам политики DirectAccess, разрешающие удаленную подготовку.

Присоединение к домену создает учетную запись компьютера и устанавливает отношение доверия между компьютером под управлением операционной системы Windows и доменом Active Directory.

## <a name="prepare-for-offline-domain-join"></a><a name="BKMK_ODJRequirements"></a>Подготовка к автономному присоединению домена

1.  Создайте учетную запись компьютера.

2.  Инвентаризация членства всех групп безопасности, к которым принадлежит учетная запись компьютера.

3.  Соберите необходимые сертификаты компьютеров, групповые политики и объекты групповой политики, которые будут применяться к новым клиентам.

. В следующих разделах описаны требования к операционной системе и требования к учетным данным для выполнения автономного присоединение к домену DirectAccess с помощью Djoin.exe.

### <a name="operating-system-requirements"></a>Требования к операционной системе
Djoin.exe для DirectAccess можно запускать только на компьютерах под управлением Windows Server 2016, Windows Server 2012 или Windows 8. Компьютер, на котором выполняется Djoin.exe для предоставления данных учетных записей компьютеров в AD DS, должен работать под управлением Windows Server 2016, Windows 10, Windows Server 2012 или Windows 8. Компьютер, который требуется присоединить к домену, также должен работать под Windows Server 2016, Windows 10, Windows Server 2012 или Windows 8.

### <a name="credential-requirements"></a>Требования к учетным данным
Для выполнения автономного присоединение к домену необходимы права, необходимые для приподключения рабочих станций к домену. Члены группы "Администраторы домена" по умолчанию имеют эти права. Если вы не являетесь членом группы "Администраторы домена", член группы "Администраторы домена" должен выполнить одно из следующих действий, чтобы обеспечить присоединение рабочих станций к домену.

-   Используйте групповая политика, чтобы предоставить необходимые права пользователя. Этот метод позволяет создавать компьютеры в контейнере Компьютеры по умолчанию и в любом подразделении (OU), которое создается позже (если запрещены записи управления доступом (ACE)).

-   Измените список управления доступом (ACL) контейнера Компьютеры по умолчанию для домена, чтобы делегировать правильные разрешения.

-   Создайте подразделение и измените список ACL в этом подразделении, чтобы предоставить вам разрешение **Создание дочернего элемента — разрешить** . Передайте параметр **/мачинеау** в команду **Djoin/провисион** .

В следующих процедурах показано, как предоставить права пользователя с помощью групповая политика и делегировать правильные разрешения.

#### <a name="granting-user-rights-to-join-workstations-to-the-domain"></a>Предоставление пользователям прав на присоединение рабочих станций к домену
Можно использовать консоль управления групповыми политиками (GPMC) для изменения политики домена или создания новой политики с параметрами, предоставляющими права пользователя на добавление рабочих станций в домен.

Членство в группах **"Администраторы домена" или "** эквивалентное" является минимальным требованием для предоставления прав пользователя.  Просмотрите сведения об использовании соответствующих учетных записей и членстве в группах в [локальной группе и группах домена по умолчанию](https://go.microsoft.com/fwlink/?LinkId=83477) ( https://go.microsoft.com/fwlink/?LinkId=83477) .

###### <a name="to-grant-rights-to-join-workstations-to-a-domain"></a>Предоставление прав на присоединение рабочих станций к домену

1.  Нажмите кнопку **Пуск**, выберите пункт **Администрирование**, а затем выберите пункт **Управление Групповая политика**.

2.  Дважды щелкните имя леса, дважды щелкните **домены**, дважды щелкните имя домена, в котором необходимо присоединить компьютер, щелкните правой кнопкой мыши **Политика домена по умолчанию** и выберите команду **изменить**.

3.  В дереве консоли дважды щелкните **Конфигурация компьютера**, дважды щелкните **политики**, дважды щелкните **Параметры Windows**, дважды щелкните **Параметры безопасности**, дважды щелкните **Локальные политики**, а затем дважды щелкните **Назначение прав пользователя**.

4.  В области сведений дважды щелкните **Добавить рабочие станции в домен**.

5.  Установите флажок **определить эти параметры политики** и нажмите кнопку **Добавить пользователя или группу**.

6.  Введите имя учетной записи, которой необходимо предоставить права пользователя, а затем дважды нажмите кнопку **ОК** .

## <a name="offline-domain-join-process"></a><a name="BKMK_ODKSxS"></a>Процесс присоединение к домену вне сети
Запустите Djoin.exe в командной строке с повышенными привилегиями, чтобы подготавливать метаданные учетной записи компьютера. При выполнении команды подготовки метаданные учетной записи компьютера создаются в двоичном файле, указанном в качестве части команды.

Дополнительные сведения о функции Нетпровисионкомпутераккаунт, которая используется для предоставления учетной записи компьютера во время приподключения к автономному домену, см. в разделе [функция нетпровисионкомпутераккаунт](https://go.microsoft.com/fwlink/?LinkId=162426) ( https://go.microsoft.com/fwlink/?LinkId=162426) . Дополнительные сведения о функции Нетрекуестоффлинедомаинжоин, которая выполняется локально на конечном компьютере, см. в разделе [функция нетрекуестоффлинедомаинжоин](https://go.microsoft.com/fwlink/?LinkId=162427) ( https://go.microsoft.com/fwlink/?LinkId=162427) .

## <a name="steps-for-performing-a-directaccess-offline-domain-join"></a><a name="BKMK_ODJSteps"></a>Действия по выполнению автономного присоединение к домену DirectAccess
Процесс автономного присоединение к домену включает следующие шаги.

1.  Создайте новую учетную запись компьютера для каждого удаленного клиента и создайте пакет подготовки с помощью команды Djoin.exe из компьютера, присоединенного к домену в корпоративной сети.

2.  Добавление клиентского компьютера в группу безопасности Директакцессклиентс

3.  Безопасно перенесите пакет подготовки на удаленные компьютеры, которые будут присоединены к домену.

4.  Примените пакет подготовки и присоедините клиент к домену.

5.  Перезагрузите клиент, чтобы завершить присоединение к домену и установить подключение.

При создании пакета подготовки для клиента необходимо учитывать два варианта. Если для установки DirectAccess без PKI используется мастер начало работы, следует использовать вариант 1 ниже. Если для установки DirectAccess с помощью PKI использовался мастер расширенной установки, следует использовать вариант 2 ниже.

Чтобы выполнить автономное присоединение к домену, выполните следующие действия.

##### <a name="option1-create-a-provisioning-package-for-the-client-without-pki"></a>Параметр1: создание пакета подготовки для клиента без PKI

1.  В командной строке сервера удаленного доступа введите следующую команду для подготовки учетной записи компьютера:

    ```
    Djoin /provision /domain <your domain name> /machine <remote machine name> /policynames DA Client GPO name /rootcacerts /savefile c:\files\provision.txt /reuse
    ```

##### <a name="option2-create-a-provisioning-package-for-the-client-with-pki"></a>Параметр2: создание пакета подготовки для клиента с помощью PKI

1.  В командной строке сервера удаленного доступа введите следующую команду для подготовки учетной записи компьютера:

    ```
    Djoin /provision /machine <remote machine name> /domain <Your Domain name> /policynames <DA Client GPO name> /certtemplate <Name of client computer cert template> /savefile c:\files\provision.txt /reuse
    ```

##### <a name="add-the-client-computer-to-the-directaccessclients-security-group"></a>Добавление клиентского компьютера в группу безопасности Директакцессклиентс

1.  На **начальном** экране контроллера домена введите **активный** и выберите **Active Directory пользователи и компьютеры** из **приложений** .

2.  Разверните дерево в своем домене и выберите контейнер **Пользователи** .

3.  В области сведений щелкните правой кнопкой мыши **директакцессклиентс** и выберите пункт **свойства**.

4.  На вкладке **Члены группы** щелкните **Добавить**.

5.  Щелкните **типы объектов**, выберите **Компьютеры**, а затем нажмите кнопку **ОК**.

6.  Введите имя добавляемого клиента и нажмите кнопку **ОК**.

7.  Нажмите кнопку **ОК** , чтобы закрыть диалоговое окно свойства **директакцессклиентс** , а затем закройте **Active Directory пользователи и компьютеры**.

##### <a name="copy-and-then-apply-the-provisioning-package-to-the-client-computer"></a>Скопируйте и примените пакет подготовки к клиентскому компьютеру.

1.  Скопируйте пакет подготовки из c:\files\provision.txt на сервере удаленного доступа, где он был сохранен, чтобы c:\provision\provision.txt на клиентском компьютере.

2.  На клиентском компьютере откройте командную строку с повышенными привилегиями и введите следующую команду, чтобы запросить присоединение к домену:

    ```
    Djoin /requestodj /loadfile C:\provision\provision.txt /windowspath %windir% /localos
    ```

3.  Перезагрузите клиентский компьютер. Компьютер будет присоединен к домену. После перезагрузки клиент будет присоединен к домену и иметь возможность подключения к корпоративной сети с DirectAccess.

## <a name="see-also"></a>См. также:
[Функция нетпровисионкомпутераккаунт](https://go.microsoft.com/fwlink/?LinkId=162426) 
 [Функция нетрекуестоффлинедомаинжоин](https://go.microsoft.com/fwlink/?LinkId=162427)



