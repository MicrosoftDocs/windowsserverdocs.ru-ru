---
title: ШАГ 12 проверка DirectAccess подключения
description: Этот раздел входит руководство по лаборатории тестирования — продемонстрировать DirectAccess многосайтового развертывания для Windows Server 2016
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology:
- networking-da
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 65ac1c23-3a47-4e58-888d-9dde7fba1586
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 4e45f0c3c988c86a2428c3beb8bafc29b7b16bc0
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446935"
---
# <a name="step-12-test-directaccess-connectivity"></a>ШАГ 12 проверка DirectAccess подключения

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

Прежде чем можно проверить связь с клиентских компьютеров, когда они находятся в сети Интернет или Homenet, необходимо убедиться в том, что они имеют правильные параметры политики.  
  
- Чтобы проверить клиентов иметь правильные групповой политики  
  
- Проверка подключения к Интернету через EDGE1 DirectAccess  
  
- Переместить в группу безопасности Win7_Clients_Site2 CLIENT2  
  
- Проверка подключения к Интернету через 2-EDGE1 DirectAccess  
  
## <a name="prerequisites"></a>предварительные требования  
Подключение обоих клиентских компьютеров к сети корпоративной сети, а затем перезапустите оба клиентских компьютера.  
  
## <a name="policy"></a>Убедитесь, что клиенты имеют правильный групповой политики  
  
1.  На компьютере CLIENT1 щелкните **запустить**, тип **powershell.exe**, щелкните правой кнопкой мыши **powershell**, нажмите кнопку **Дополнительно**, а затем нажмите кнопку **Запуск от имени администратора**. Если появится диалоговое окно **контроля учетных записей**, подтвердите, что отображаемое в нем действие именно то, которое требуется, и нажмите кнопку **Да**.  
  
2.  В окне Windows PowerShell введите **ipconfig** и нажмите клавишу ВВОД.  
  
    Убедитесь, что адреса IPv4 адаптера корпоративной сети начинается с 10.0.0.  
  
3.  В окне Windows PowerShell введите **Get-DnsClientNrptPolicy** и нажмите клавишу ВВОД. Отобразятся записи таблицы политики разрешения имен для DirectAccess.  
  
    -   . corp.contoso.com-эти параметры указывают, что все подключения к corp.contoso.com должны разрешаться на единицу DirectAccess DNS-серверов, с помощью 2001:db8:1::2 адрес IPv6 или 2001:db8:2::20.  
  
    -   NLS.corp.contoso.com эти параметры о том, что исключения для имени nls.corp.contoso.com.  
  
4.  Не закрывайте окно Windows PowerShell для выполнения следующей процедуры.  
  
5.  В CLIENT2 щелкните **запустить**, нажмите кнопку **все программы**, нажмите кнопку **стандартные**, нажмите кнопку **Windows PowerShell**, щелкните правой кнопкой мыши **Windows PowerShell**, а затем нажмите кнопку **Запуск от имени администратора**. Если появится диалоговое окно **контроля учетных записей**, подтвердите, что отображаемое в нем действие именно то, которое требуется, и нажмите кнопку **Да**.  
  
6.  В окне Windows PowerShell введите **ipconfig** и нажмите клавишу ВВОД.  
  
    Убедитесь, что адреса IPv4 адаптера корпоративной сети начинается с 10.0.0.  
  
7.  В окне Windows PowerShell введите **пространство имен netsh Показать политики** и нажмите клавишу ВВОД.  
  
    В выходных данных должно быть два раздела:  
  
    -   . corp.contoso.com-эти параметры указывают, что все подключения к corp.contoso.com должны разрешаться DirectAccess DNS-сервером, с помощью 2001:db8:1::2 адрес IPv6.  
  
    -   NLS.corp.contoso.com эти параметры о том, что исключения для имени nls.corp.contoso.com.  
  
8.  Не закрывайте окно Windows PowerShell для выполнения следующей процедуры.  
  
## <a name="EDGE1"></a>Проверка подключения к Интернету через EDGE1 DirectAccess  
  
1. Отключите 2-EDGE1 из сети Интернет.  
  
2. Отключите CLIENT1 и CLIENT2 коммутатора корпоративной сети и подключите их к Интернет-коммутатора. Подождите 30 секунд.  
  
3. На компьютере CLIENT1 в основном окне Windows PowerShell, введите **ipconfig/all** и нажмите клавишу ВВОД.  
  
4. Изучите выходные данные из команды ipconfig.  
  
   Клиентский компьютер теперь подключен к Интернету и есть общедоступный адрес IPv4. Когда общедоступный IPv4-адрес у клиента DirectAccess, он использует технологии перехода Teredo или IP-HTTPS IPv6 для туннелирования IPv6 сообщения через протокол Интернета IPv4 между клиентом DirectAccess и сервер удаленного доступа. Обратите внимание на то, что Teredo — это технология предпочтительный перехода.  
  
5. В окне Windows PowerShell введите **ipconfig/flushdns** и нажмите клавишу ВВОД. Это очищает записи разрешения имен, которые по-прежнему могут существовать в кэше клиента DNS со, когда клиентский компьютер был подключен к корпоративной сети.  
  
6. Отключите интерфейс Teredo, чтобы убедиться, что клиентский компьютер использует IP-HTTPS для подключения к корпоративной сети с помощью следующей команды:  
  
   ```  
   netsh interface teredo set state disable  
   ```  
  
7. Убедитесь, что вы подключены через EDGE1. Тип **httpstunnel интерфейса netsh отобразить интерфейсы** и нажмите клавишу ВВОД.  
  
   Выходные данные должны содержать URL-адрес: https://edge1.contoso.com:443/IPHTTPS.  
  
   > [!TIP]  
   > На компьютере CLIENT1 можно также выполнить следующую команду Windows PowerShell: **Get-NetIPHTTPSConfiguration**. Выходные данные показывают, доступные подключения для URL-адрес, а также активный профиль.  
  
8. В окне Windows PowerShell введите **ping app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6, назначенный APP1, который в данном случае является 2001:db8:1::3.  
  
9. В окне Windows PowerShell введите **ping 2 app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6, назначенный 2-APP1, который в данном случае является 2001:db8:2::3.  
  
10. В окне Windows PowerShell введите **ping app2** и нажмите клавишу ВВОД. Должны появиться ответы от адреса NAT64, назначенного EDGE1 для APP2, который в данном случае является fd**c9:9f4e:eb1b**: 7777::a00:4. Обратите внимание, что полужирным значения могут меняться из-за созданием адрес.  
  
    Возможность ping APP2 важно, поскольку успех означает, что вы смогли подключиться с помощью NAT64/DNS64, как APP2 представляет собой ресурс только IPv4.  
  
11. Откройте Internet Explorer и в адресной строке Internet Explorer, введите **https://app1/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP1 по умолчанию.  
  
12. В адресной строке Internet Explorer, введите **https://2-app1/** и нажмите клавишу ВВОД. Вы увидите веб-сайт по умолчанию на компьютере APP1 2.  
  
13. В адресной строке Internet Explorer, введите **https://app2/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP2 по умолчанию.  
  
14. На **запустить** введите<strong>\\\2-App1\Files</strong>, и нажмите клавишу ВВОД. Дважды щелкните образец файла текста.  
  
    Это показывает, что вам удалось подключиться к файловому серверу в домене corp2.corp.contoso.com при подключении через EDGE1.  
  
15. На **запустить** введите<strong>\\\App2\Files</strong>, и нажмите клавишу ВВОД. Дважды щелкните файл "Новый текстовый документ".  
  
    Это показывает, что вы смогли подключиться к серверу только IPv4, с помощью SMB и получить доступ к ресурсу в домене ресурсов.  
  
16. На **запустить** введите**wf.msc**, и нажмите клавишу ВВОД.  
  
17. В **брандмауэр Windows в режиме повышенной безопасности** консоли, обратите внимание, что только **открытый профиль** активен. Для DirectAccess для правильной работы необходимо включить брандмауэр Windows. Если брандмауэр Windows был отключен, подключение DirectAccess не работает.  
  
18. В левой области консоли, разверните **мониторинг** и щелкните **правила безопасности подключений** узла. Вы должны увидеть правил безопасности подключений: **Политики DirectAccess-ClientToCorp**, **политики DirectAccess-ClientToDNS64NAT64PrefixExemption**, **политики DirectAccess-ClientToInfra**, и **DirectAccess Политика ClientToNlaExempt**. Прокрутить вправо, чтобы показать средней области **методы первой проверки подлинности** и **методы второй проверки подлинности** столбцов. Обратите внимание на то, что первое правило (ClientToCorp) использует Kerberos V5 для установления туннеля интрасети и третье правило (ClientToInfra) использует NTLMv2 для установления туннель инфраструктуры.  
  
19. В левой области консоли, разверните **сопоставления безопасности** и щелкните **основного режима** узла. Обратите внимание на то, с помощью NTLMv2 сопоставлений безопасности туннель инфраструктуры и сопоставления безопасности туннель интрасети, с помощью Kerberos V5. Щелкните правой кнопкой мыши строку, в которой показано **пользователя (Kerberos V5)** как **второй метод проверки подлинности** и нажмите кнопку **свойства**. На **Общие** вкладке, обратите внимание, что **второй проверки подлинности локального идентификатора** — **CORP\User1**, указывающее, что Пользователь1 смог успешно проходить проверку подлинности домена CORP с помощью Kerberos.  
  
20. Повторите эту процедуру с шага 3 в CLIENT2.  
  
## <a name="secgroup"></a>Переместить в группу безопасности Win7_Clients_Site2 CLIENT2  
  
1.  На DC1 щелкните **запустить**, тип **dsa.msc**, и нажмите клавишу ВВОД.  
  
2.  В консоли "Active Directory — пользователи и компьютеры", откройте **corp.contoso.com/Users** и дважды щелкните **Win7_Clients_Site1**.  
  
3.  На **свойства Win7_Clients_Site1** диалоговом окне щелкните **члены** щелкните **CLIENT2**, нажмите кнопку **удалить**, щелкните **Да**, а затем нажмите кнопку **ОК**.  
  
4.  Дважды щелкните **Win7_Clients_Site2**, а затем на **Win7_Clients_Site2 свойства** диалоговом окне щелкните **члены** вкладки.  
  
5.  Нажмите кнопку **добавить**и на **Выбор пользователей, контактов, компьютеров или учетных записей служб** диалоговом окне щелкните **типы объектов**выберите **компьютеров**, а затем нажмите кнопку **ОК**.  
  
6.  В **введите имена выбираемых объектов**, тип **CLIENT2**, а затем нажмите кнопку **ОК**.  
  
7.  Перезапустите CLIENT2 и войдите в систему с учетной записи corp/User1.  
  
8.  В CLIENT2 откройте окно с повышенными привилегиями Windows PowerShell, тип **пространство имен netsh Показать политики** и нажмите клавишу ВВОД.  
  
    В выходных данных должно быть два раздела:  
  
    -   . corp.contoso.com-эти параметры указывают, что все подключения к corp.contoso.com должны разрешаться DirectAccess DNS-сервером, с помощью 2001:db8:2::20 адрес IPv6.  
  
    -   NLS.corp.contoso.com эти параметры о том, что исключения для имени nls.corp.contoso.com.  
  
## <a name="DAConnect"></a>Проверка подключения к Интернету через 2-EDGE1 DirectAccess  
  
1. 2-EDGE1 подключиться к сети Интернет.  
  
2. Отключите EDGE1 из сети Интернет.  
  
3. В CLIENT1 откройте окно Windows PowerShell с повышенными привилегиями.  
  
4. В окне Windows PowerShell введите **ipconfig/flushdns** и нажмите клавишу ВВОД. Это очищает записи разрешения имен, которые по-прежнему могут существовать в кэше клиента DNS со, когда клиентский компьютер был подключен к корпоративной сети.  
  
5. Убедитесь, что вы подключены через 2-EDGE1. Тип **httpstunnel интерфейса netsh отобразить интерфейсы** и нажмите клавишу ВВОД.  
  
   Выходные данные должны содержать URL-адрес: https://2-edge1.contoso.com:443/IPHTTPS.  
  
   > [!TIP]  
   > На компьютере CLIENT1 можно также выполните следующую команду: **Get-NetIPHTTPSConfiguration**. Выходные данные показывают, доступные подключения для URL-адрес, а также активный профиль.  
  
   > [!NOTE]  
   > CLIENT1 автоматически Изменение сервера, через который он подключается к корпоративным ресурсам. Если в выходных данных команды показано подключение к EDGE1, подождите примерно через пять минут и повторите попытку.  
  
6. В окне Windows PowerShell введите **ping app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6, назначенный APP1, который в данном случае является 2001:db8:1::3.  
  
7. В окне Windows PowerShell введите **ping 2 app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6, назначенный 2-APP1, который в данном случае является 2001:db8:2::3.  
  
8. В окне Windows PowerShell введите **ping app2** и нажмите клавишу ВВОД. Должны появиться ответы от адреса NAT64, назначенного EDGE1 для APP2, который в данном случае является fd**c9:9f4e:eb1b**: 7777::a00:4. Обратите внимание, что полужирным значения могут меняться из-за созданием адрес.  
  
   Возможность ping APP2 важно, поскольку успех означает, что вы смогли подключиться с помощью NAT64/DNS64, как APP2 представляет собой ресурс только IPv4.  
  
9. Откройте Internet Explorer и в адресной строке Internet Explorer, введите **https://app1/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP1 по умолчанию.  
  
10. В адресной строке Internet Explorer, введите **https://2-app1/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP2 по умолчанию.  
  
11. В адресной строке Internet Explorer, введите **https://app2/** и нажмите клавишу ВВОД. Вы увидите веб-сайт по умолчанию на APP3.  
  
12. На **запустить** введите<strong>\\\App1\Files</strong>, и нажмите клавишу ВВОД. Дважды щелкните образец файла текста.  
  
    Это показывает, что вам удалось подключиться к файловому серверу в домене corp.contoso.com, при подключении через 2-EDGE1.  
  
13. На **запустить** введите<strong>\\\App2\Files</strong>, и нажмите клавишу ВВОД. Дважды щелкните файл "Новый текстовый документ".  
  
    Это показывает, что вы смогли подключиться к серверу только IPv4, с помощью SMB и получить доступ к ресурсу в домене ресурсов.  
  
14. Повторите эту процедуру на CLIENT2 из шага 3.  
  


