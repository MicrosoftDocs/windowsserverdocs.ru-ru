---
title: ШАГ 13 Проверка подключения DirectAccess из-за устройства NAT
description: Этот раздел входит руководство по лаборатории тестирования — продемонстрировать DirectAccess многосайтового развертывания для Windows Server 2016
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology:
- networking-da
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 796825c3-5e3e-4745-a921-25ab90b95ede
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 2d1661d43cd45614dfabc66fd9a737c55ab388ed
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446920"
---
# <a name="step-13-test-directaccess-connectivity-from-behind-a-nat-device"></a>ШАГ 13 Проверка подключения DirectAccess из-за устройства NAT

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

Когда клиент DirectAccess подключается к Интернету из-за устройства NAT или сервера веб-прокси, он использует либо Teredo, либо IP-HTTPS для подключения к серверу удаленного доступа. Если устройство NAT разрешает исходящий порт UDP 3544 на общедоступный IP-адрес сервера удаленного доступа, то используется Teredo. Если доступ через Teredo недоступен, клиент DirectAccess возвращается к подключению IP-HTTPS через TCP-порт номер 443 исходящего трафика, который позволяет получать доступ через брандмауэр или сервер веб-прокси по традиционному SSL-порту. Если веб-прокси требует проверки подлинности, подключение IP-HTTPS завершится сбоем. Подключение IP-HTTPS также завершится сбоем, если веб-прокси проводит проверку исходящего SSL-соединения, поскольку HTTPS-сеанс завершается на веб-прокси, а не на сервере удаленного доступа.  
  
Следующие процедуры выполняются на обоих клиентских компьютерах.  
  
1. Проверка подключения Teredo. Первый набор тестов проводится в том случае, когда в настройках клиента DirectAccess задано использование Teredo. Это задается автоматически, если устройство NAT разрешает исходящий трафик на UDP-порт номер 3544. Сначала запустите тесты на компьютере CLIENT1, а затем выполните тесты в CLIENT2.  
  
2. Проверка подключения IP-HTTPS. Второй набор тестов проводится в том случае, когда клиент DirectAccess настроен на использование IP-HTTPS. Чтобы продемонстрировать возможность подключения IP-HTTPS, Teredo на клиентских компьютерах отключается. Сначала запустите тесты на компьютере CLIENT1, а затем выполните тесты в CLIENT2.  
  
## <a name="prerequisites"></a>предварительные требования  
Запустите EDGE1 и 2 EDGE1, если они еще не запущен и убедитесь, что они подключены к подсети Интернет.  
  
Прежде чем выполнять эти тесты, отключите CLIENT1 и CLIENT2 от Интернет-коммутатора и подключите их к коммутатору Homenet. Если будет задан вопрос, какой тип сети для определения текущей сети, выберите **домашней сети**.  
  
## <a name="TeredoCLIENT1"></a>Проверка подключения Teredo  
  
1. В CLIENT1 откройте окно Windows PowerShell с повышенными привилегиями.  
  
2. Включить адаптер Teredo, тип **teredo интерфейса netsh установлено состояние enterpriseclient**, и нажмите клавишу ВВОД.  
  
3. В окне Windows PowerShell введите **ipconfig/all** и нажмите клавишу ВВОД.  
  
4. Проверьте вывод команды ipconfig.  
  
   Этот компьютер теперь подключен к Интернету из-за устройства NAT и получил частный адрес IPv4. Когда клиент DirectAccess находится за устройством NAT и получает частный адрес IPv4, предпочитаемой технологией туннелирования для IPv6 является Teredo. Если взглянуть на выходных данных команды ipconfig, вы увидите раздел для туннельного адаптера туннельный интерфейс Teredo, а затем описание туннельный адаптер Microsoft Teredo, с IP-адресом, который начинается с 2001: 0, что Teredo адрес. Вы увидите шлюз по умолчанию для туннельного адаптера Teredo, как "::".  
  
5. В окне Windows PowerShell введите **ipconfig/flushdns** и нажмите клавишу ВВОД.  
  
   В результате будут удалены записи разрешения имен, которые могут до сих пор находиться в кэше клиента DNS со времени, когда компьютер был подключен к Интернету.  
  
6. В окне Windows PowerShell введите **ping app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6 для APP1, 2001:db8:1::3.  
  
7. В окне Windows PowerShell введите **ping app2** и нажмите клавишу ВВОД. Должны появиться ответы от адреса NAT64, назначенного EDGE1 для APP2, который в данном случае является fd**c9:9f4e:eb1b**: 7777::a00:4. Обратите внимание, что полужирным значения могут меняться из-за созданием адрес.  
  
8. В окне Windows PowerShell введите **ping 2 app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6 для 2-APP1, 2001:db8:2::3.  
  
9. Откройте Internet Explorer и в адресной строке Internet Explorer, введите **https://2-app1/** и нажмите клавишу ВВОД. Вы увидите веб-сайт IIS по умолчанию на компьютере APP1 2.  
  
10. В адресной строке Internet Explorer, введите **https://app2/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP2 по умолчанию.  
  
11. На **запустить** введите<strong>\\\App2\Files</strong>, и нажмите клавишу ВВОД. Дважды щелкните файл "Новый текстовый документ". Это показывает, что вам удалось подключиться к серверу, работающему только с адресами IPv4, с помощью SMB и получить доступ к ресурсу на узле, работающему только с адресами IPv4.  
  
12. Повторите эту процедуру на CLIENT2.  
  
## <a name="IPHTTPS_CLIENT1"></a>Проверка подключения IP-HTTPS  
  
1. В CLIENT1 откройте повышенными окно Windows PowerShell и введите **teredo интерфейса netsh установлено состояние отключена** и нажмите клавишу ВВОД. Это отключит Teredo на клиентском компьютере и позволит ему настроиться на использование IP-HTTPS. По завершении работы команды появится ответ **Ok**.  
  
2. В окне Windows PowerShell введите **ipconfig/all** и нажмите клавишу ВВОД.  
  
3. Проверьте вывод команды ipconfig. Этот компьютер теперь подключен к Интернету из-за устройства NAT и получил частный адрес IPv4. Туннелирование Teredo отключено, а клиент DirectAccess возвращается к использованию IP-HTTPS. Если взглянуть на вывод команды ipconfig, см. раздел для туннельный адаптер iphttpsinterface с IP-адресом, который начинается с 2001:db8:1:1000 или 2001:db8:2:2000 этот что адресов IP-HTTPS на основании префиксы, которые были настроить при настройке DirectAccess. Вы не увидите шлюз по умолчанию для туннельного адаптера IPHTTPSInterface.  
  
4. В окне Windows PowerShell введите **ipconfig/flushdns** и нажмите клавишу ВВОД. В результате будут удалены записи разрешения имен, которые могут до сих пор находиться в кэше клиента DNS со времени, когда компьютер был подключен к сети предприятия.  
  
5. В окне Windows PowerShell введите **ping app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6 для APP1, 2001:db8:1::3.  
  
6. В окне Windows PowerShell введите **ping app2** и нажмите клавишу ВВОД. Должны появиться ответы от адреса NAT64, назначенного EDGE1 для APP2, который в данном случае является fd**c9:9f4e:eb1b**: 7777::a00:4. Обратите внимание, что полужирным значения могут меняться из-за созданием адрес.  
  
7. В окне Windows PowerShell введите **ping 2 app1** и нажмите клавишу ВВОД. Должны появиться ответы от адреса IPv6 для 2-APP1, 2001:db8:2::3.  
  
8. Откройте Internet Explorer и в адресной строке Internet Explorer, введите **https://2-app1/** и нажмите клавишу ВВОД. Вы увидите веб-сайт IIS по умолчанию на компьютере APP1 2.  
  
9. В адресной строке Internet Explorer, введите **https://app2/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP2 по умолчанию.  
  
10. На **запустить** введите<strong>\\\App2\Files</strong>, и нажмите клавишу ВВОД. Дважды щелкните файл "Новый текстовый документ". Это показывает, что вам удалось подключиться к серверу, работающему только с адресами IPv4, с помощью SMB и получить доступ к ресурсу на узле, работающему только с адресами IPv4.  
  
11. Повторите эту процедуру на CLIENT2.  
  


