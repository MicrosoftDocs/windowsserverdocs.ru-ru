---
title: Шаг 5. Тестирование подключения DirectAccess из Интернета и через кластер
description: Этот раздел является частью руководства по тестовой лаборатории. демонстрация DirectAccess в кластере с Windows NLB для Windows Server 2016
manager: brianlic
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-da
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 8399bdfa-809a-45e4-9963-f9b6a631007f
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 92641ccf19f77becd9ed5476cd8c0178f4090f49
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "80310838"
---
# <a name="step-5-test-directaccess-connectivity-from-the-internet-and-through-the-cluster"></a>Шаг 5. Тестирование подключения DirectAccess из Интернета и через кластер

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Компьютер КЛИЕНТ1 теперь готов к тестированию DirectAccess.  
  
- Проверьте подключение DirectAccess из Интернета. Подключите компьютер КЛИЕНТ1 к имитации Интернета. При подключении к имитируемому Интернету клиенту назначаются общедоступные IPv4-адреса. Когда клиенту DirectAccess назначается общедоступный IPv4-адрес, он пытается установить соединение с сервером удаленного доступа с помощью технологии туннелирования IPv6.  
  
- Проверьте возможность подключения клиентов DirectAccess через кластер. Проверьте функциональность кластера. Перед началом тестирования рекомендуется завершить работу обеих EDGE1 и EDGE2 по крайней мере за пять минут. Для этого существует ряд причин, в том числе время ожидания кэша ARP и изменения, связанные с балансировкой сетевой нагрузки. При проверке конфигурации балансировки сетевой нагрузки в лаборатории тестирования необходимо прождать, так как изменения в конфигурации не будут немедленно отражены в подключении до истечения определенного периода времени. Это важно помнить при выполнении следующих задач.  
  
    > [!TIP]  
    > Рекомендуется очистить кэш Internet Explorer перед выполнением этой процедуры и при каждом тестировании подключения с помощью другого сервера удаленного доступа, чтобы убедиться в том, что вы тестируете подключение и не получаете веб-страницы из кэша.  
  
## <a name="test-directaccess-connectivity-from-the-internet"></a>Проверка подключения DirectAccess из Интернета  
  
1. Отключите компьютер КЛИЕНТ1 от коммутатора корпоративной сети и подключите его к коммутатору Интернета. Подождите 30 секунд.  
  
2. В окне Windows PowerShell с повышенными привилегиями введите **ipconfig/flushdns** и нажмите клавишу ВВОД. При этом записи разрешения имен, которые могут существовать в кэше DNS клиента, будут удалены с момента подключения клиентского компьютера к корпоративной сети.  
  
3. В окне Windows PowerShell введите **Get-днсклиентнрптполици** и нажмите клавишу ВВОД.  
  
   В выводе появятся текущие параметры таблицы политики разрешения имен (NRPT). Эти параметры указывают, что все подключения к. corp.contoso.com должны быть разрешены DNS-сервером удаленного доступа с IPv6-адресом 2001: db8:1:: 2. Кроме того, обратите внимание на запись NRPT, которая указывает на наличие исключения для имени nls.corp.contoso.com. Имена в списке исключений не получают ответа от DNS-сервера удаленного доступа. Можно проверить связь с IP-адресом DNS-сервера удаленного доступа, чтобы подтвердить подключение к серверу удаленного доступа. Например, можно проверить связь с 2001: db8:1:: 2.  
  
4. В окне Windows PowerShell введите **ping APP1** и нажмите клавишу ВВОД. Вы должны увидеть ответы от IPv6-адреса для APP1, который в данном случае — 2001: db8:1:: 3.  
  
5. В окне Windows PowerShell введите **ping** , а затем нажмите клавишу ВВОД. Должны появиться ответы от адреса NAT64, назначенного EDGE1 для APP2, которые в данном случае равны fdc9:9f4e:eb1b:7777::a00:4.  
  
   Возможность проверки связи с этим компьютером очень важна, поскольку успешное завершение означает, что вы смогли установить подключение с помощью NAT64/DNS64, так как в качестве этого ресурса используется только протокол IPv4.  
  
6. Оставьте окно Windows PowerShell открытым для следующей процедуры.  
  
7. Откройте Internet Explorer, в адресной строке Internet Explorer введите **https://app1/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP1 по умолчанию.  
  
8. В адресной строке Internet Explorer введите **https://app2/** и нажмите клавишу ВВОД. Появится веб-сайт IIS на APP2 по умолчанию.  
  
9. На **начальном** экране введите<strong>\\\App2\Files</strong>и нажмите клавишу ВВОД. Дважды щелкните файл "Новый текстовый документ".  
  
    Это показывает, что вы смогли подключиться к серверу только с IPv4 с помощью SMB для получения ресурса в домене ресурсов.  
  
10. На **начальном** экране введите**WF. msc**и нажмите клавишу ВВОД.  
  
11. В консоли **Брандмауэр Windows в режиме повышенной безопасности** Обратите внимание, что активен только **частный** или **Общий профиль** . Для правильной работы DirectAccess необходимо включить брандмауэр Windows. Если брандмауэр Windows отключен, подключение DirectAccess не работает.  
  
12. В левой области консоли разверните узел **мониторинг** и щелкните узел **правила безопасности подключения** . Вы должны увидеть активные правила безопасности подключений: **Политика DirectAccess — клиенттокорп**, **Политика DirectAccess — ClientToDNS64NAT64PrefixExemption**, **Политика DirectAccess — Клиенттоинфра**и **Политика DirectAccess — клиенттонлаексемпт**. Прокрутите среднюю область вправо, чтобы отобразить **первый метод проверки подлинности** и столбцы **2 метода проверки подлинности** . Обратите внимание, что первое правило (Клиенттокорп) использует Kerberos V5 для установки туннеля интрасети, а третье правило (Клиенттоинфра) использует NTLMv2 для создания туннеля инфраструктуры.  
  
13. В левой области консоли разверните узел **ассоциации безопасности** и щелкните узел **основного режима** . Обратите внимание на взаимосвязи безопасности туннеля инфраструктуры, использующие NTLMv2 и сопоставление безопасности туннеля интрасети по протоколу Kerberos V5. Щелкните правой кнопкой мыши запись, которая показывает **пользователя (Kerberos V5)** в качестве **второго метода проверки подлинности** , и выберите пункт **Свойства**. На вкладке **Общие** Обратите внимание, что **второй локальный идентификатор проверки подлинности** — **CORP\User1**, что означает, что Пользователь1 мог успешно пройти проверку подлинности в домене Corp с помощью Kerberos.  
  
## <a name="test-directaccess-client-connectivity-through-the-cluster"></a>Проверка подключения клиента DirectAccess через кластер  
  
1. Выполните корректное завершение работы в EDGE2.  
  
   Диспетчер балансировки сетевой нагрузки можно использовать для просмотра состояния серверов при выполнении этих тестов.  
  
2. На компьютере КЛИЕНТ1 в окне Windows PowerShell введите **команду ipconfig/flushdns** и нажмите клавишу ВВОД. При этом удаляются записи разрешения имен, которые могут по-прежнему существовать в кэше DNS клиента.  
  
3. В окне Windows PowerShell выполните команду ping APP1 и приложение. Вы должны получить ответы из обоих ресурсов.  
  
4. На **начальном** экране введите<strong>\\\app2\files</strong>. Вы должны увидеть общую папку на компьютере с. Возможность открыть общую папку в системе, которая указывает, что второй туннель, требующий проверки подлинности Kerberos для пользователя, работает правильно.  
  
5. Откройте Internet Explorer, а затем откройте веб-сайты https://app1/ и https://app2/. Возможность открытия обоих веб-сайтов подтверждает, что первый и второй туннели работают и работают. Закройте Internet Explorer.  
  
6. Запустите компьютер EDGE2.  
  
7. В EDGE1 выполните корректное завершение работы.  
  
8. Подождите 5 минут, а затем вернитесь на компьютер КЛИЕНТ1. Выполните шаги 2-5. Это подтверждает, что для компьютера КЛИЕНТ1 была возможность прозрачно отработки отказа в EDGE2 после того, как EDGE1 стал недоступным.
