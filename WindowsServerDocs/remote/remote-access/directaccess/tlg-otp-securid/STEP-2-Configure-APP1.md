---
title: Шаг 2. Настройка APP1
description: Узнайте, как создать и развернуть шаблон сертификата, используемый для подписания запросов на сертификаты OTP и один из которых используется для сертификатов OTP, выданных корпоративным ЦС.
manager: brianlic
ms.topic: article
ms.assetid: 19a7a4a6-9a04-42ea-a5d0-ecb28a34dbaa
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: 84d784975cbc5acfb1350ed6840ca3beb433e7cf
ms.sourcegitcommit: f8da45df984f0400922a8306855b0adfdaec71af
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98040074"
---
# <a name="step-2-configure-app1"></a>Шаг 2. Настройка APP1

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

Чтобы подготовить APP1 для поддержки OTP, выполните следующие действия.

1. Создание и развертывание шаблона сертификата, используемого для подписания запросов на сертификаты OTP. Настройте шаблон сертификата, используемый для подписания запросов на сертификаты OTP.

2. Создание и развертывание шаблона сертификата для сертификатов OTP, выданных корпоративным ЦС. Настройте шаблон сертификата для сертификатов OTP, выданных корпоративным ЦС.

> [!WARNING]
> Руководство по тестированию лаборатории включает в себя серверы инфраструктуры, такие как контроллер домена и центр сертификации (ЦС) под управлением Windows Server 2012 R2 или Windows Server 2012. Использование этого лабораторного руководства для настройки серверов инфраструктуры, на которых работают другие операционные системы, не было протестировано, а инструкции по настройке других операционных систем не включены в это руководства.

## <a name="to-create-and-deploy-a-certificate-template-used-to-sign-otp-certificate-requests"></a><a name="DAOTPRA"></a>Создание и развертывание шаблона сертификата, используемого для подписания запросов на сертификаты OTP

1.  Запустите **certtmpl. msc** и нажмите клавишу ВВОД.

2.  В области сведений консоли Шаблоны сертификатов щелкните правой кнопкой мыши шаблон **компьютера** и выберите пункт **дублировать шаблон**.

3.  В диалоговом окне **Свойства нового шаблона** на вкладке **Совместимость** в списке **центр сертификации** выберите нужную операционную систему и в диалоговом окне **результирующие изменения** нажмите кнопку **ОК**. В списке **получателей сертификата** выберите нужную операционную систему и в диалоговом окне **результирующие изменения** нажмите кнопку **ОК**.

4.  В диалоговом окне **Свойства нового шаблона** перейдите на вкладку **Общие** .

5.  На вкладке **Общие** в поле **Отображаемое имя шаблона** введите **даотпра**. Установите срок **действия** 2 дня и установите **период продления** равным 1 дню. Если отобразится предупреждение **шаблоны сертификатов** , нажмите кнопку **ОК**.

6.  Выберите вкладку **Безопасность** и нажмите кнопку **Добавить**.

7.  В диалоговом окне **Выбор пользователей, компьютеров, учетных записей служб или групп** щелкните **типы объектов**. В диалоговом окне **типы объектов** выберите **Компьютеры**, а затем нажмите кнопку **ОК**. В поле **Введите имена объектов для выбора** введите **EDGE1**, нажмите кнопку **ОК**, а в столбце **Разрешить** установите флажки **Чтение**, **Регистрация** и автоматическая **Регистрация** . Щелкните **прошедшие проверку пользователи**, установите флажок **Read** в столбце **Разрешить** и снимите все остальные флажки. Щелкните **Компьютеры домена** и снимите флажок **Регистрация** в столбце **Разрешить** . Щелкните **Администраторы домена** и **Администраторы предприятия** и щелкните **полный** доступ в столбце **Разрешить** для обоих. Нажмите кнопку **Применить**.

8.  Перейдите на вкладку **имя субъекта** и нажмите кнопку **собрать на основе сведений из этой Active Directory**. В списке **Формат имени субъекта** выберите **DNS-имя**, убедитесь, что флажок **DNS-имя** установлен, и нажмите кнопку **Применить**.

9. Перейдите на вкладку **расширения** , выберите **политики приложений** и нажмите кнопку **изменить**. Удалите все существующие политики приложений. Нажмите кнопку **Добавить**, а затем в диалоговом окне **Добавление политики применения** нажмите кнопку **создать**, введите **Da OTP RA** в поле **Имя:** и **1.3.6.1.4.1.311.81.1.1** в поле **идентификатор объекта:** и нажмите кнопку **ОК**. В диалоговом окне **Добавление политики применения** нажмите кнопку **ОК**. На странице **изменение расширения политик применения** нажмите кнопку **ОК**. В диалоговом окне **Свойства нового шаблона** нажмите кнопку **ОК**.

## <a name="to-create-and-deploy-a-certificate-template-for-otp-certificates-issued-by-the-corporate-ca"></a><a name="DAOTPLogon"></a>Создание и развертывание шаблона сертификата для сертификатов OTP, выданных корпоративным ЦС

1.  В области сведений консоли Шаблоны сертификатов щелкните правой кнопкой мыши шаблон входа в смарт- **карту** и выберите пункт **дублировать шаблон**.

2.  В диалоговом окне **Свойства нового шаблона** на вкладке **Совместимость** в списке **центр сертификации** выберите операционную систему, которую требуется использовать, и в диалоговом окне **результирующие изменения** нажмите кнопку **ОК**. В списке **получателей сертификата** выберите операционную систему, которую необходимо использовать, и в диалоговом окне **результирующие изменения** нажмите кнопку **ОК**.

3.  В диалоговом окне **Свойства нового шаблона** перейдите на вкладку **Общие** .

4.  На вкладке **Общие** в поле **Отображаемое имя шаблона** введите **даотплогон**. В поле **срок действия** в раскрывающемся списке выберите пункт **часы**, в диалоговом окне **шаблоны сертификатов** нажмите кнопку **ОК** и убедитесь, что для параметра число часов установлено значение 1. В окне **период продления** введите **0**.

    > [!IMPORTANT]
    > **Центр сертификации Windows Server 2003**. В ситуациях, когда центр сертификации (ЦС) находится на компьютере под Windows Server 2003, шаблон сертификата должен быть настроен на другом компьютере. Это необходимо, поскольку установка **периода действия** в часах невозможна при использовании версий Windows до windows Server 2008 и Windows Vista. Если на компьютере, используемом для настройки шаблона, не установлена роль сервера служб сертификации Active Directory или если это клиентский компьютер, может потребоваться установить оснастку "Шаблоны сертификатов". Дополнительные сведения см. [в разделе Установка оснастки "Шаблоны сертификатов"](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc732445(v=ws.11)).
    >
    > **Центр сертификации Windows Server 2008 R2**. Если вы уже развернули центр сертификации (ЦС), работающий под Windows Server 2008 R2, необходимо настроить **период продления** шаблона сертификата на 1 или 2 часа, а **срок действия** — больше, чем **период продления**, но не более 4 часов. Если настроить **срок действия** шаблона сертификата дольше 4 часов с помощью центра сертификации, работающего под Windows Server 2008 R2, мастер установки DirectAccess не сможет обнаружить шаблон сертификата, и установка DirectAccess завершится сбоем.

5.  Перейдите на вкладку **Безопасность** , выберите **прошедшие проверку пользователи** в столбце **Разрешить** и установите флажки **Чтение** и **Регистрация** . Нажмите **OK**. Щелкните **Администраторы домена** и **Администраторы предприятия** и щелкните **полный** доступ в столбце **Разрешить** для обоих. Нажмите кнопку **Применить**.

6.  Перейдите на вкладку **имя субъекта** и нажмите кнопку **собрать на основе сведений из этой Active Directory**. В списке **Формат имени субъекта** выберите **полное различающееся имя**, убедитесь, что флажок **имя участника-пользователя (UPN)** установлен, и нажмите кнопку **Применить**.

7.  Перейдите на **вкладку сервер** , установите флажок **не хранить сертификаты и запросы в базе данных ЦС** , снимите флажок не **включать сведения об отзыве в выданные сертификаты** , а затем в диалоговом окне **Свойства нового шаблона** нажмите кнопку **Применить**.

8.  Перейдите на вкладку **требования к выдаче** , установите флажок **это число полномочных подписей:** установите значение 1. В списке **тип политики, необходимый для подписи:** выберите **Политика приложения** и в списке **Политика приложения** выберите **Da OTP RA**. В диалоговом окне **Свойства нового шаблона** нажмите кнопку **ОК**.

9. Перейдите на вкладку **расширения** и на вкладке **политики приложений** нажмите кнопку **изменить**. Удалите **проверку подлинности клиента**, не задерживайте **смарткардлогон** и дважды нажмите кнопку **ОК** .

10. Закройте консоль шаблонов сертификатов.

11. На **начальном** экране введите **certsrv. msc** и нажмите клавишу ВВОД.

12. В дереве консоли центра сертификации разверните узел **Corp-APP1-CA-1**, щелкните **шаблоны сертификатов**, щелкните правой кнопкой мыши **шаблоны сертификатов**, наведите указатель на пункт **создать** и выберите пункт **Выдаваемый шаблон сертификата**.

13. В списке шаблонов сертификатов выберите **даотпра** и **даотплогон** и нажмите кнопку **ОК**.

14. В области сведений консоли вы увидите шаблон сертификата **даотпра** с **предназначением** **Da OTP RA** и шаблоном сертификата **Даотплогон** с **целью, предназначенной** для входа с помощью **смарт-карты**.

15. Перезапустите службы.

16. Закройте консоль центра сертификации.

17. Откройте командную строку с повышенными привилегиями. Введите **CertUtil.exe-SetReg дбфлагс + DBFLAGS_ENABLEVOLATILEREQUESTS** и нажмите клавишу ВВОД.

18. Оставьте окно командной строки открытым для следующего шага.

