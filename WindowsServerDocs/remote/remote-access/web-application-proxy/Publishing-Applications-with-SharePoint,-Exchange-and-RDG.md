---
ms.assetid: 61ed00fd-51c7-4728-91fa-8501de9d8f28
title: Публикация приложений с помощью SharePoint, Exchange и RDG
description: ''
author: billmath
manager: mtillman
ms.author: billmath
ms.date: 04/30/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.technology: web-app-proxy
ms.openlocfilehash: 21ea6ecf717392027c1d00f818e230e2fe56a11d
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59826825"
---
# <a name="publishing-applications-with-sharepoint-exchange-and-rdg"></a>Публикация приложений с помощью SharePoint, Exchange и RDG

>Область применения. Windows Server 2016

**Это содержимое относится к локальной версии прокси веб-приложения. Чтобы включить безопасный доступ к локальным приложениям через облако, см. в разделе [содержимое прокси приложения Azure AD](https://azure.microsoft.com/documentation/articles/active-directory-application-proxy-get-started/).**  
  
В этом разделе описываются задачи, необходимые для публикации SharePoint Server, Exchange Server или шлюза удаленного рабочего стола (RDP) через прокси веб-приложения.  

>[!NOTE]
>Эта информация предоставляется в виде — является.  Службы удаленных рабочих столов поддерживает и рекомендует использовать [прокси приложения Azure, чтобы обеспечить безопасный удаленный доступ к локальным приложениям](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-get-started).
  
## <a name="BKMK_6.1"></a>Публикации SharePoint Server  
Если сайт SharePoint настроен для проверки подлинности на основе утверждений или проверки подлинности встроенная Windows можно опубликовать сайт SharePoint через прокси веб-приложения. Если вы хотите использовать федерации службы Active Directory (AD FS) для предварительной проверки подлинности, необходимо настроить проверяющую сторону с помощью одного из мастеров.  
  
-   Если на сайте SharePoint используется аутентификация на основе утверждений, воспользуйтесь мастером добавления отношения доверия с проверяющей стороной, чтобы настроить для приложения отношения доверия с проверяющей стороной.  
  
-   Если на сайте SharePoint используется встроенная аутентификация Windows, воспользуйтесь мастером добавления отношений доверия с проверяющей стороной, не поддерживающей утверждения, чтобы настроить для приложения отношения доверия с проверяющей стороной. Если настроен центр KDC, с веб-приложением, поддерживающим утверждения, можно использовать аутентификацию IWA.  
  
    Чтобы разрешить пользователям проходить проверку подлинности с использованием проверки подлинности встроенная Windows, веб-приложения прокси-сервер должен быть присоединен к домену.  
  
    Необходимо настроить приложение для поддержки ограниченного делегирования Kerberos. Эту настройку можно выполнить на контроллере домена для любого приложения. Можно также настроить приложение непосредственно на внутреннем сервере, если он работает под управлением Windows Server 2012 R2 или Windows Server 2012. Дополнительные сведения см. в разделе [Новые возможности аутентификации Kerberos](https://technet.microsoft.com/library/hh831747.aspx). Также необходимо убедиться в том, что серверы прокси веб-приложения настроены для делегирования именам субъекта-службы внутренних серверов. Пошаговое руководство по настройке прокси веб-приложения для публикации приложения с помощью проверки подлинности встроенная Windows, см. в разделе [настроить сайт для использования проверки подлинности Windows, интегрированный](assetId:///b0788958-627f-450f-877c-209b1bd0db52).  
  
Если сайт SharePoint настроен с помощью альтернативных сопоставлений доступа (AAM) или коллекций сайтов с именем узла, для публикации приложения можно использовать различные URL-адреса внешних и внутренних серверов. Однако если настройка сайта SharePoint с использованием альтернативных сопоставлений доступа или коллекций сайтов с именем узла не выполнена, необходимо использовать те же URL-адреса внешних и внутренних серверов.  
  
## <a name="BKMK_6.2"></a>Публикация Exchange Server  
В следующей таблице описаны службы Exchange, которые можно публиковать через прокси веб-приложения и поддерживаемых предварительную проверку подлинности для этих служб:  
  
|Служба Exchange|Предварительная проверка подлинности|Примечания|  
|--------------------|-----------------------|---------|  
|Outlook Web App|-AD FS с помощью проверки подлинности, не основанных на утверждениях<br />-Сквозной<br />-AD FS с помощью проверки подлинности на основе утверждений для локальных Exchange 2013 пакетом обновлений 1 (SP1)|Подробную информацию см. в следующих разделах: [С помощью проверки подлинности на основе утверждений AD FS с Outlook Web App и EAC](https://go.microsoft.com/fwlink/?LinkId=393723)|  
|Панель управления Exchange|Пропускная аутентификация||  
|Мобильный Outlook|Пропускная аутентификация|Для того чтобы мобильный Outlook работал корректно, необходимо опубликовать три URL-адреса.<br /><br />-URL-адрес автообнаружения.<br />— Имя внешнего узла Exchange Server; то есть URL-адрес, настроенный для подключения для клиентов.<br />— Внутреннее полное ДОМЕННОЕ имя сервера Exchange.|  
|Exchange ActiveSync|Пропускная аутентификация<br/> С помощью протокола HTTP Basic авторизации AD FS|| Дополнительные сведения см.: https://docs.microsoft.com/windows-server/remote/remote-access/web-application-proxy/publishing-applications-using-ad-fs-preauthentication 
  
Чтобы опубликовать приложение Outlook Web App, используя интегрированную аутентификацию Windows, воспользуйтесь мастером добавления отношений доверия с проверяющей стороной, не поддерживающей утверждения, и настройте для приложения отношения доверия с проверяющей стороной.  
  
Чтобы разрешить пользователям проходить проверку подлинности с помощью Kerberos ограниченного делегирования, которые веб-приложения прокси-сервер должен быть присоединен к домену.  
  
Необходимо настроить приложение для поддержки проверки подлинности Kerberos. Кроме того необходимо зарегистрировать имя участника-службы (SPN) в учетную запись, под которой работает служба web. Это можно сделать на контроллере домена или на внутренних серверах. Загрузки с балансировкой среды Exchange, для этого потребуется с помощью альтернативной учетной записи службы, см. в разделе [Настройка проверки подлинности Kerberos для серверов клиентского доступа с балансировкой нагрузки](https://technet.microsoft.com/library/ff808312(v=exchg.150).aspx)  
  
Можно также настроить приложение непосредственно на внутреннем сервере, если он работает под управлением Windows Server 2012 R2 или Windows Server 2012. Дополнительные сведения см. в разделе [Новые возможности аутентификации Kerberos](https://technet.microsoft.com/library/hh831747.aspx). Также необходимо убедиться в том, что серверы прокси веб-приложения настроены для делегирования именам субъекта-службы внутренних серверов.  
  
## <a name="publishing-remote-desktop-gateway-through-web-application-proxy"></a>Публикация шлюза удаленных рабочих столов через прокси веб-приложения  
Если вы хотите ограничить доступ к шлюзу удаленного доступа и добавить предварительную проверку подлинности для удаленного доступа, вы можете развернуть его через прокси веб-приложения. Это очень удобный способ убедиться, что у вас есть широкий предварительной проверки подлинности на RDG, включая многофакторной проверки Подлинности. Публикация без предварительной проверки подлинности также является вариантом и предоставляет единую точку входа в системы.  
  
#### <a name="how-to-publish-an-application-in-rdg-using-web-application-proxy-pass-through-authentication"></a>Как опубликовать приложение в RDG, с помощью сквозной проверки подлинности прокси веб-приложения  
  
1.  Установка будет различаются в зависимости от вашего веб-доступа к удаленному рабочему Столу (/ rdweb) и роли шлюза удаленных рабочих Столов (rpc), на одном сервере или на разных серверах.  
  
2.  Если веб-доступа к удаленным рабочим Столам и шлюза удаленных рабочих Столов роли размещаются на одном сервере RDG, можно просто публиковать корневой полное доменное имя в прокси веб-приложения таким образом, https://rdg.contoso.com/.  
  
    Вы также можете опубликовать две виртуальные каталоги по отдельности например https://rdg.contoso.com/rdweb/ и https://rdg.contoso.com/rpc/.  
  
3.  Если веб-доступ к удаленному рабочему Столу и шлюза удаленных рабочих Столов размещаются на отдельных серверах RDG, вам нужно опубликовать две виртуальные каталоги по отдельности. Можно использовать ту же или другую внешнее полное доменное имя например https://rdweb.contoso.com/rdweb/ и https://gateway.contoso.com/rpc/.  
  
4.  Если отличаются внешних и внутренних полное доменное имя не следует отключать преобразования заголовков запроса в правиле публикации RDWeb. Это можно сделать, выполнив следующий сценарий PowerShell на сервере прокси веб-приложения, но он должен быть включен по умолчанию.
  
    ```  
    Get-WebApplicationProxyApplication applicationname | Set-WebApplicationProxyApplication -DisableTranslateUrlInRequestHeaders:$false  
    ```  
  
    > [!NOTE]  
    > Если требуется поддержка клиентов с расширенными возможностями, такие как RemoteApp и подключение к рабочему столу или iOS к удаленному рабочему столу, они не поддерживают предварительной проверки подлинности, необходимо опубликовать RDG, с помощью сквозной проверки подлинности.  
  
#### <a name="how-to-publish-an-application-in-rdg-using-web-application-proxy-with-pre-authentication"></a>Как опубликовать приложение в RDG, с помощью прокси веб-приложения с помощью предварительной проверки подлинности  
  
1.  Web прокси приложения предварительной проверки подлинности с помощью RDG работает путем передачи предварительной проверки подлинности файла cookie, полученных от Internet Explorer, передаваемые в клиент удаленного рабочего стола (mstsc.exe). Затем используется клиентом удаленного рабочего стола (mstsc.exe). Затем используется клиентом удаленный рабочий стол как доказательство проверки подлинности.  
  
    Следующая процедура объясняет, сервер сбора, чтобы включить необходимые пользовательские свойства протокола удаленного рабочего СТОЛА в удаленного приложения RDP-файлы, отправляемые клиентами. Они указывают, то предварительной проверки подлинности клиент является обязательным и передачи файлов cookie для предварительной проверки подлинности для адрес сервера, к удаленному рабочему столу (mstsc.exe). В сочетании с отключение функции HttpOnly веб-приложения прокси приложения таким образом, клиент удаленного рабочего стола (mstsc.exe) использовать файл cookie прокси веб-приложения, полученные с помощью браузера.  
  
    Проверка подлинности на сервере веб-доступа к удаленному рабочему Столу будет по-прежнему использовать входа формы RD Web Access. Это обеспечивает наименьшее количество проверки подлинности пользователя запрашивает как форме входа в систему веб-доступа к удаленным рабочим Столам создает хранилище учетными данными на стороне клиента, который затем может использоваться клиентом удаленному рабочему столу (mstsc.exe) для любой последующий запуск удаленного приложения.  
  
2.  Во-первых создайте вручную доверия с проверяющей стороной в AD FS так, как если бы публикации приложение, поддерживающее утверждения. Это означает, что вам нужно создать фиктивный с проверяющей стороной, есть ли для принудительного применения предварительной проверки подлинности, чтобы получить предварительная проверка подлинности без ограниченного делегирования Kerberos опубликованный сервер. После аутентификации пользователя, все остальное передается.  
  
    > [!WARNING]  
    > Может показаться, что предпочтительнее с помощью делегирования, но не полностью решает mstsc требованиям единого входа, и существуют проблемы при делегировании в каталог/RPC, так как клиент ожидает, что для обработки проверки подлинности шлюза удаленных рабочих Столов, сам.  
  
3.  Чтобы создать вручную доверия с проверяющей стороной, выполните действия, описанные в консоли управления AD FS.  
  
    1.  Используйте **добавить доверие проверяющей стороны** мастера  
  
    2.  Выберите **ввод данных о проверяющей стороне вручную**.  
  
    3.  Примите все параметры по умолчанию.  
  
    4.  Для идентификатора доверия с проверяющей стороной, введите внешнее полное доменное имя будет использоваться для доступа к RDG, например https://rdg.contoso.com/.  
  
        Это доверия с проверяющей стороной, будет использоваться при публикации приложения в прокси веб-приложения.  
  
4.  Опубликовать корневой каталог сайта (например, https://rdg.contoso.com/ ) в прокси веб-приложения. Установите предварительную проверку подлинности для AD FS и используйте доверия с проверяющей стороной, созданную ранее. Это позволит /rdweb и/RPC для использования одного файла cookie проверки подлинности прокси веб-приложения.  
  
    Можно публиковать /rdweb и/RPC как отдельные приложения и даже использовать различные серверы опубликованной. Необходимо убедиться, что публикуется как с помощью же доверия с проверяющей стороной, как маркер прокси веб-приложения, выдаются для доверия с проверяющей стороной и, соответственно, допустимо в приложениях, опубликованных с помощью же доверия с проверяющей стороной.  
  
5.  Если отличаются внешних и внутренних полное доменное имя не следует отключать преобразования заголовков запроса в правиле публикации RDWeb. Это можно сделать, выполнив следующий сценарий PowerShell на сервере прокси веб-приложения, но он должен быть включен по умолчанию:
  
    ```  
    Get-WebApplicationProxyApplication applicationname | Set-WebApplicationProxyApplication -DisableTranslateUrlInRequestHeaders:$false 
    ```  
  
6.  Отключить свойство HttpOnly файл cookie в прокси веб-приложения на RDG опубликованного приложения. Чтобы разрешить RDG ActiveX управления доступом для файла cookie проверки подлинности прокси веб-приложения, необходимо отключить свойство HttpOnly в файле cookie прокси веб-приложения.  
  
    Для этого следующую команду, чтобы установить [исправление прокси-сервера приложений Web](https://support.microsoft.com/en-gb/kb/3000850) или [ https://support.microsoft.com/en-gb/kb/3000850 ](https://support.microsoft.com/en-gb/kb/3000850).  
  
    После установки исправления выполните следующий сценарий PowerShell на сервере прокси веб-приложения, указав имя соответствующего приложения:  
  
    ```  
    Get-WebApplicationProxyApplication applicationname | Set-WebApplicationProxyApplication -DisableHttpOnlyCookieProtection:$true  
    ```  
  
    Отключение HttpOnly позволяет RDG ActiveX управления доступом для файла cookie проверки подлинности прокси веб-приложения.  
  
7.  Настройте соответствующие коллекции RDG на сервер сбора, чтобы разрешить подключение удаленного рабочего стола клиента (mstsc.exe) о том, что требуется предварительная проверка подлинности в RDP-файл.  
  
    -   В Windows Server 2012 и Windows Server 2012 R2 это можно сделать, выполнив следующий командлет PowerShell на сервере сбора RDG:  
  
        ```
        Set-RDSessionCollectionConfiguration -CollectionName "<yourcollectionname>" -CustomRdpProperty "pre-authentication server address:s: <https://externalfqdn/rdweb/>`nrequire pre-authentication:i:1"
        ```
  
        Обязательно удалите < и > квадратные скобки, при замене собственными значениями, например:
        
        ```
        Set-RDSessionCollectionConfiguration -CollectionName "MyAppCollection" -CustomRdpProperty "pre-authentication server address:s: https://rdg.contoso.com/rdweb/`nrequire pre-authentication:i:1"
        ```
  
    -   В Windows Server 2008 R2:  
  
        1.  Войдите на сервер терминалов с учетной записью, обладающей правами администратора.  
  
        2.  Перейдите к **запустить** >**Администрирование** > **служб терминалов** > **Диспетчер удаленных приложений RemoteApp служб Терминалов.**  
  
        3.  В **Обзор** области TS RemoteApp диспетчера, рядом с параметрами удаленного рабочего СТОЛА, щелкните **изменение**.  
  
        4.  На **особые параметры RDP** вкладке, введите следующие параметры удаленного рабочего СТОЛА в поле Параметры пользовательского протокола удаленного рабочего СТОЛА:  
  
            `pre-authentication server address: s: https://externalfqdn/rdweb/`  
  
            `require pre-authentication:i:1`  
  
        5.  Когда все будет готово, нажмите кнопку **применить**.  
  
            Это указывает на сервер сбора, чтобы включить пользовательские свойства протокола удаленного рабочего СТОЛА в RDP-файлы, отправляемые клиентами. Они указывают, то предварительной проверки подлинности клиент является обязательным и передачи файлов cookie для предварительной проверки подлинности для адрес сервера, к удаленному рабочему столу (mstsc.exe). Это, в сочетании с отключение HttpOnly веб-приложения прокси приложения, позволяет удаленному рабочему столу (mstsc.exe) использовать файл cookie проверки подлинности прокси веб-приложения, полученные с помощью браузера.  
  
            Дополнительные сведения об RDP см. в разделе [настройке сценария OTP шлюза служб Терминалов](https://technet.microsoft.com/library/cc731249(v=ws.10).aspx).  
  
## <a name="BKMK_Links"></a>См. также  
  
-   [Планирование публикации приложений с использованием прокси веб-приложения](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn383650(v=ws.11))  
  
-   [Устранение неполадок прокси веб-приложения](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn770156(v=ws.11))  
  
-   [Web Application Proxy Пошаговое руководство](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/dn280944(v=ws.11))  
