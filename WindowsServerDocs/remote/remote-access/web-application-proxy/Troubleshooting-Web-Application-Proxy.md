---
title: Диагностика прокси-службы веб-приложения
description: ''
author: kgremban
manager: femila
ms.date: 07/13/2016
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: a2fef55d-747b-4e20-8f21-5f8807e7ef87
ms.technology: web-app-proxy
ms.openlocfilehash: c63dbc415765cbe60bfbde7bf180f3dd967d6ab8
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59841585"
---
# <a name="troubleshooting-web-application-proxy"></a>Диагностика прокси-службы веб-приложения

>Область применения. Windows Server 2016

**Это содержимое относится к локальной версии прокси веб-приложения. Чтобы включить безопасный доступ к локальным приложениям через облако, см. в разделе [содержимое прокси приложения Azure AD](https://azure.microsoft.com/documentation/articles/active-directory-application-proxy-get-started/).**  
  
Этот раздел содержит процедуры устранения неполадок для прокси веб-приложения, включая описания событий и решения. Существуют три места, где отображаются ошибки:  
  
-   В консоли администратора прокси веб-приложения  
  
    Можно просмотреть в средстве просмотра событий Windows, а также описание каждого ИД события, перечисленные в консоли администратора и решения можно найти ниже.  
  
    Откройте средство просмотра событий и найдите события, относящиеся к прокси веб-приложения в разделе **журналы приложений и служб** > **Microsoft** > **Windows**  >  **Веб-прокси приложения** > **администратора**  
  
    ![](media/Troubleshooting-Web-Application-Proxy/WebApplicationProxyTroubleshooting.png)  
  
    При необходимости подробные журналы путем включения аналитики и отладки журналы, а также журнал сеансов прокси веб-приложения, см. в средстве просмотра событий Windows в \ Microsoft \ Windows \ прокси веб-приложения \ администратора.  
  
-   В PowerShell ошибки  
  
    События неполадок, возникающих во время настройки отображаются в PowerShell.  
  
    Все ошибки представляются пользователю PowerShell, используя стандартные сообщения об ошибках PowerShell. Все команды PowerShell, регистрируются как события. Все события, возникающие в PowerShell, перечислены в средстве просмотра событий Windows с идентификатором 12016 и определены ниже в разделе PowerShell.  
  
-   В анализатор соответствия рекомендациям  
  
    Эти события описаны в [анализатор соответствия рекомендациям для прокси веб-приложения](assetId:///995f5cea-e334-4ce6-a14c-6a2d03c0c79a)  
  
## <a name="powershell-messages"></a>Сообщения в PowerShell  
  
|Событие или симптом|Возможная причина|Разрешение|  
|--------------------|------------------|--------------|  
|Доверять сертификату ("ADFS ProxyTrust - <WAP machine name>«) не допускается|Это может быть вызвано следующим:<br /><br />-Machine прокси приложения была отключена слишком долго.<br />-Отключений между AD FS и прокси веб-приложения<br />-Проблемы с инфраструктурой certificate<br />— Изменения на компьютере службы федерации Active Directory, или процесс продления между прокси веб-приложения и службы федерации Active Directory не был выполнен, как планируется каждые 8 часов, то их необходимо продлить доверия<br />— Часы компьютера прокси веб-приложения и службы федерации Active Directory не синхронизируются.|Убедитесь, что часы синхронизированы. Выполните командлет Install-WebApplicationProxy.|  
|Данные конфигурации не найден в AD FS|Возможно, прокси веб-приложения не был полностью установлен еще или из-за изменений в базу данных AD FS или повреждение базы данных.|Выполните командлет Install-WebApplicationProxy|  
|Произошла ошибка при попытке чтения конфигурации из AD FS прокси веб-приложения.|Это может означать, что службы федерации Active Directory недоступен, или AD FS, что возникла внутренняя проблема при попытке считать конфигурацию из базы данных AD FS.|Убедитесь, что AD FS доступен и работает должным образом.|  
|Повреждены данные конфигурации, хранящиеся в AD FS или прокси веб-приложения не удалось проанализировать его.<br /><br />ИЛИ<br /><br />Не удалось получить список проверяющим сторонам из AD FS Proxywas приложения Web.|Это может произойти, если данные конфигурации были изменены в AD FS.|Перезапустите Proxyservice приложения Web. Если проблема повторится, выполните командлет Install-WebApplicationProxy.|  
  
## <a name="administrator-console-events"></a>События консоли администратора  
Следующие события консоли администратора обычно указывают на ошибки проверки подлинности, tokes недопустимый или истек срок действия файлов cookie.  
  
|Событие или симптом|Возможная причина|Разрешение|  
|--------------------|------------------|--------------|  
|11005<br /><br />Прокси веб-приложения не удалось создать ключ шифрования файлов cookie, с использованием секрета из конфигурации.|Параметр «AccessCookiesEncryptionKey» Глобальная конфигурация была изменена с помощью команды PowerShell: SET-WebApplicationProxyConfiguration - RegenerateAccessCookiesEncryptionKey|Никаких действий не требуется. Проблемный файл cookie был удален, и пользователь был перенаправлен к STS для проверки подлинности.|  
|12000<br /><br />Прокси веб-приложения не удалось проверить наличие изменений конфигурации в течение 60 минут|Прокси веб-приложения не может получить доступ к конфигурации прокси веб-приложения, с помощью команды Get-WebApplicationProxyConfiguration или приложения. Обычно это вызвано отсутствие связи с AD FS или при необходимости обновите отношение доверия с AD FS.|Проверка возможности подключения с AD FS. Это можно сделать с помощью ссылки https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake действительно есть отношение доверия между AD FS и прокси веб-приложения. Если эти решения не работают, выполните командлет Install-WebApplicationProxy.|  
|12003<br /><br />Прокси веб-приложения не удалось выполнить синтаксический анализ cookie доступа.|Это может означать, что прокси веб-приложения и службы федерации Active Directory не подключены или что они не получают ту же конфигурацию.|Проверка возможности подключения с AD FS. Это можно сделать с помощью ссылки https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake действительно есть отношение доверия между AD FS и прокси веб-приложения. Если эти решения не работают, выполните командлет Install-WebApplicationProxy.|  
|12004<br /><br />Прокси веб-приложения получила запрос с файлом cookie недопустимого доступа.|Это событие может означать, что прокси веб-приложения и службы федерации Active Directory не подключены или что они не получают ту же конфигурацию.<br /><br />Если параметр «AccessCookiesEncryptionKey» был chaged, Set-WebApplicationProxyConfiguration - RegenerateAccessCookiesEncryptionKey команду PowerShell, это событие является нормальным и требует действий по устранению проблемы.|Проверка возможности подключения с AD FS. Это можно сделать с помощью ссылки https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake действительно есть отношение доверия между AD FS и прокси веб-приложения. Если эти решения не работают, выполните командлет Install-WebApplicationProxy.|  
|12008<br /><br />Прокси веб-приложения превышает максимальное количество разрешенных попыток аутентификации Kerberos на внутреннем сервере.|Это событие может означать неправильную конфигурацию между прокси веб-приложения и сервера внутренних приложений или проблему настройки даты и времени на обоих компьютерах.|Внутренний сервер отклонил билет Kerberos, созданный прокси веб-приложения. Убедитесь, что конфигурация прокси веб-приложения и сервера внутренних приложений настроены правильно.<br /><br />Убедитесь, что настройки даты и времени, в прокси веб-приложения и сервера внутренних приложений будут синхронизированы.|  
|12011<br /><br />Прокси веб-приложения получила запрос с подписью файла cookie недопустимого доступа.|Это событие может означать, что прокси веб-приложения и службы федерации Active Directory не подключены или что они не получают ту же конфигурацию. Если параметр «AccessCookiesEncryptionKey» был chaged, Set-WebApplicationProxyConfiguration - RegenerateAccessCookiesEncryptionKey команду PowerShell, это событие является нормальным и требует действий по устранению проблемы.|Проверка возможности подключения с AD FS. Это можно сделать с помощью ссылки https://<FQDN_AD_FS_Proxy>/FederationMetadata/2007-06/FederationMetadata.xmlMake действительно есть отношение доверия между AD FS и прокси веб-приложения. Если эти решения не работают, выполните командлет Install-WebApplicationProxy.|  
|12027<br /><br />Прокси-произошла непредвиденная ошибка при обработке запроса. Указанное имя не является корректным именем пользователя.|Это событие может означать неправильную конфигурацию между прокси веб-приложения и сервера контроллера домена или проблему настройки даты и времени на обоих компьютерах.|Контроллер домена отклонил билет Kerberos, созданный прокси веб-приложения. Убедитесь, что конфигурация прокси веб-приложения и сервера внутренних приложений настроены неверно, особенно конфигурацию имени участника-службы. Убедитесь, что прокси веб-приложения присоединен к тому же домену, что и контроллер домена, чтобы убедиться, что контроллер домена позволяет установить отношения доверия с Web Application Proxy.Make Конечно, настройки даты и времени, в прокси веб-приложения и контроллер домена, синхронизируются.|  
|13012<br /><br />Прокси веб-приложения получено недопустимых edge подписи токена||Убедитесь, что вы обновили прокси веб-приложения с помощью [2955164 КБ](https://go.microsoft.com/fwlink/?LinkId=400701).|  
|13013<br /><br />Прокси веб-приложения получили запрос, содержащий маркер истекшим сроком действия edge.|Прокси веб-приложения и службы федерации Active Directory нет синхронизации часов.|Синхронизируйте часы между прокси веб-приложения и службы федерации Active Directory.|  
|13014<br /><br />Прокси веб-приложения получила запрос с маркером недопустимых edge. Токен является недопустимым, поскольку он не может быть проанализировано.|Это может указывать на проблему с конфигурацией службы федерации Active Directory.|Проверьте конфигурацию AD FS и при необходимости восстановить конфигурацию по умолчанию.|  
|13015<br /><br />Прокси веб-приложения получила запрос с файлом cookie для доступа с истекшим сроком действия.|Это может означать часы не синхронизированы.|При работе с кластером машин прокси веб-приложения, убедитесь, что время и дату машин синхронизированы.|  
|13016<br /><br />Прокси веб-приложения не удается получить билет Kerberos от имени пользователя, из-за отсутствия UPN в граничном маркере или файле cookie доступа.|Возникла проблема с конфигурацией службы маркеров безопасности.|Исправьте конфигурацию утверждения UPN в службе маркеров безопасности.|  
|13019<br /><br />Прокси веб-приложения не может получить билет Kerberos от имени пользователя из-за следующей общей ошибки API|Это событие может означать неправильную конфигурацию между прокси веб-приложения и сервера контроллера домена или проблему настройки даты и времени на обоих компьютерах.|Контроллер домена отклонил билет Kerberos, созданный прокси веб-приложения. Убедитесь, что конфигурация прокси веб-приложения и сервера внутренних приложений настроены неверно, особенно конфигурацию имени участника-службы. Убедитесь, что прокси веб-приложения присоединен к тому же домену, что и контроллер домена, чтобы убедиться, что контроллер домена позволяет установить отношения доверия с Web Application Proxy.Make Конечно, настройки даты и времени, в прокси веб-приложения и контроллер домена, синхронизируются.|  
|13020<br /><br />Прокси веб-приложения не удается получить билет Kerberos от имени пользователя, поскольку SPN внутреннего сервера не определено.|Это событие может означать неправильную конфигурацию между прокси веб-приложения и сервера контроллера домена или проблему настройки даты и времени на обоих компьютерах.|Контроллер домена отклонил билет Kerberos, созданный прокси веб-приложения. Убедитесь, что конфигурация прокси веб-приложения и сервера внутренних приложений настроены неверно, особенно конфигурацию имени участника-службы. Убедитесь, что прокси веб-приложения присоединен к тому же домену, что и контроллер домена, чтобы убедиться, что контроллер домена позволяет установить отношения доверия с Web Application Proxy.Make Конечно, настройки даты и времени, в прокси веб-приложения и контроллер домена, синхронизируются.|  
|13022<br /><br />Прокси веб-приложения не может проверить подлинность пользователя, так как внутренний сервер отвечает на попытки проверки подлинности Kerberos ошибкой HTTP 401.|Это событие может означать неправильную конфигурацию между прокси веб-приложения и сервера внутренних приложений или проблему настройки даты и времени на обоих компьютерах.|Внутренний сервер отклонил билет Kerberos, созданный прокси веб-приложения. Убедитесь, что конфигурация прокси веб-приложения и сервера внутренних приложений настроены правильно. Убедитесь, что настройки даты и времени, в прокси веб-приложения и сервера внутренних приложений будут синхронизированы.|  
|13025<br /><br />Клиент не появляется SSL-сертификата к прокси веб-приложения.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
|13026<br /><br />Клиенты представили SSL-сертификата к прокси веб-приложения, но сертификат не является допустимым: сертификат не соответствует отпечатку.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
|13028<br /><br />Прокси веб-приложения получил запрос, который содержал Граничный токен, который еще не действителен.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory.|  
|13030<br /><br />Клиенты представили SSL-сертификата к прокси веб-приложения, но поставщик доверия не доверяет центр сертификации, выдавший этот сертификат клиента.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
|13031<br /><br />Клиенты представили SSL-сертификата к прокси веб-приложения, но обработка прервана цепочка сертификатов корневого сертификата, который не является доверенным поставщиком доверия.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
|13032<br /><br />Клиенты представили SSL-сертификата к прокси веб-приложения, но сертификат недействителен для запрошенного применения.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
|13033<br /><br />Клиенты представили SSL-сертификата к прокси веб-приложения, но сертификат не был в течение срока его при проверке по системным часам или отметка времени в подписанном файле.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
|13034<br /><br />Клиенты представили SSL-сертификата к прокси веб-приложения, но сертификат не был допустимым.|Это событие может означать проблему настройки даты и времени.|Убедитесь, что инфраструктура сертификатов является допустимым и синхронизацию времени и даты прокси веб-приложения и службы федерации Active Directory. Убедитесь, что отпечаток, настроенный для прокси веб-приложения отображается правильная.|  
  
Следующие события консоли администратора обычно указывают на проблемы, относящиеся к конфигурации, такие как подготовка, запрос, который не было успешным, внутренних серверов, которые недостижимы и переполнения буфера.  
  
|Событие или симптом|Возможная причина|Разрешение|  
|--------------------|------------------|--------------|  
|12019<br /><br />Прокси веб-приложения не удалось создать прослушиватель для следующих URL-адрес.|Возможной причиной для события является то, что другая служба ожидает передачи данных на том же URL-адрес.|Администратору необходимо убедиться в том, что никто не ожидает передачи данных или привязывается к тем же URL-адреса. Чтобы проверить это, выполните команду: netsh http show urlacl. Если этот URL-адрес используется другим компонентом, запущенная на компьютере прокси веб-приложения, удалите его или использовать другой URL-адрес публикации приложений через прокси веб-приложения.|  
|12020<br /><br />Прокси веб-приложения не удалось создать резервирование для следующих URL-адрес.|Возможной причиной для события является наличие резервирование на том же URL-адрес другой службы.|Администратору необходимо убедиться в том, что никто не привязывается к тем же URL-адреса. Чтобы проверить это, выполните команду: netsh http show urlacl. Если этот URL-адрес используется другим компонентом, запущенная на компьютере прокси веб-приложения, удалите его или использовать другой URL-адрес публикации приложений через прокси веб-приложения.|  
|12021<br /><br />Прокси веб-приложения не удалось выполнить привязку SSL-сертификат сервера. Все остальные параметры конфигурации были применены.|Не удалось создать и задать запись конфигурации данные сертификата SSL.|Убедитесь, что отпечатки сертификатов, настроенные для Web Application Proxyapplications установлены на всех компьютерах прокси веб-приложения с закрытым ключом в хранилище локального компьютера.|  
|13001<br /><br />SSL-сертификат сервера, представленных сервером серверной части для прокси веб-приложения не является допустимым; сертификат не является доверенным.|Одна или несколько ошибок найдены в сертификате Secure Sockets Layer (SSL), отправленных сервером. Это может означать, что внутренний сервер предоставляет SSL, который не был допустимым или что нет доверия между прокси веб-приложения и сервера базы данных.|Проверка SSL-сертификата сервера серверной части. Убедитесь, что машина прокси веб-приложения может быть настроена с правом корневых ЦС, чтобы доверять сертификату сервера серверной части.|  
|13006|Если код ошибки-0x80072ee7, failurrre причиной является невозможность разрешения URL-адрес внутреннего сервера. Другие коды ошибок описаны в [https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85)](https://msdn.microsoft.com/library/windows/desktop/aa384110(v=vs.85))|Проверьте, что URL-адрес внутреннего сервера указано правильно и что его имя можно разрешить правильно с компьютера прокси веб-приложения.|  
|13007<br /><br />HTTP-ответа с внутреннего сервера не получен в течение заданного интервала.|Запрос серверной части сервера истекло или он работает медленно или не отвечает.|Проверьте конфигурацию сервера базы данных. Если это очень медленно, проверьте подключение к внутреннему серверу и также рекомендуется изменить параметр командлета глобальную конфигурацию прокси веб-приложения для InactiveTransactionsTimeoutSec.|  
  
## <a name="see-also"></a>См. также  
[Новые возможности в прокси веб-приложения в Windows Server 2016](web-application-proxy-windows-server.md)  
[Работа с прокси веб-приложения](assetId:///b607b717-2172-4271-98d1-fa8162e0bb2e)  
  


