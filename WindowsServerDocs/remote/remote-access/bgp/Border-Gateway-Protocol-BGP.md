---
title: Протокол пограничного шлюза (BGP)
description: С помощью этого раздела можно получить представление о протокол BGP (BGP) в Windows Server 2016, включая топологии развертывания, поддерживаемые BGP, и функции и возможности BGP.
manager: brianlic
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 78cc2ce3-a48e-45db-b402-e480b493fab1
ms.author: pashort
author: shortpatti
ms.openlocfilehash: ae6fddce1564e44ad72a5630c6abb16cdb6735d1
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71388979"
---
# <a name="border-gateway-protocol-bgp"></a>Протокол пограничного шлюза (BGP)

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

В этом разделе вы можете получить представление о протоколе BGP, в том числе о поддерживаемых им топологиях развертывания, а также его компонентах и возможностях.  
  
> [!NOTE]  
> Помимо этого раздела, доступна следующая документация по BGP.  
>   
> -   [Справочник по командам BGP для Windows PowerShell](../../remote-access/bgp/BGP-Windows-PowerShell-Command-Reference.md)  
  
Эта статья содержит следующие разделы.  
  
-   [Поддерживаемые топологии развертывания BGP](#bkmk_top)  
  
-   [Функции BGP](#bkmk_features)  
  
При настройке на шлюзе службы удаленного доступа Windows Server 2016 \(RAS @ no__t-1 в многоклиентский режим протокол BGP (BGP) предоставляет возможность управлять маршрутизацией сетевого трафика между клиентами и их удаленными серверами. черн. Можно также использовать BGP для развертываний шлюза RAS одного клиента и при развертывании удаленного доступа в качестве локальной сети \(LAN @ no__t-1 Router.  
  
Протокол BGP снижает потребность в ручной настройке маршрутов в маршрутизаторах, так как является протоколом динамической маршрутизации и автоматически определяет маршруты между сайтами, связанными с помощью межсайтовых подключений VPN.  
  
Чтобы использовать маршрутизацию BGP, необходимо установить **службу удаленного доступа \(RAS @ no__t-2** и/или службу роли **маршрутизации** роли сервера удаленного доступа на компьютере или ВИРТУАЛЬНОЙ машине \(VM @ no__t-5. тип используемой системы зависит от независимо от того, есть ли у вас многоклиентское развертывание:  
  
-   Для развертывания на нескольких клиентах рекомендуется установить шлюз RAS на одной или нескольких виртуальных машинах. Использование нескольких виртуальных машин обеспечивает высокий уровень доступности. Шлюз RAS способен обрабатывать несколько подключений из нескольких клиентов и состоит из узла Hyper-V и виртуальной машины, которая фактически настроена в качестве шлюза. Для этого шлюза настроено подключение VPN типа "сеть — сеть" в качестве маршрутизатора BGP с несколькими клиентами для клиента Exchange и поставщика облачных служб \(CSP @ no__t-1 маршрутов подсети.  
  
-   Для развертывания одного шлюза пограничных клиентов или развертывания маршрутизатора локальной сети можно установить шлюз RAS на физическом компьютере или на виртуальной машине.  
  
> [!IMPORTANT]  
> При установке шлюза RAS необходимо указать, включен ли протокол BGP для каждого клиента с помощью команды Windows PowerShell **Enable-ремотеакцессраутингдомаин** с параметром **типа** **ALL**. Чтобы установить удаленный доступ в качестве маршрутизатора локальной сети с поддержкой BGP без возможностей клиентов, можно использовать команду **Install-RemoteAccess-VpnType раутингонли**.  
>   
> В следующем примере кода показано, как установить RAS в режиме многоадресной рассылки со всеми компонентами удаленного доступа (VPN-подключение типа "точка — сеть", VPN-подключением типа "сеть — сеть" и маршрутизацией BGP) для двух клиентов, Contoso и Fabrikam.  
  
```  
$Contoso_RoutingDomain = "ContosoTenant"  
$Fabrikam_RoutingDomain = "FabrikamTenant"  
  
Install-RemoteAccess -MultiTenancy  
  
Enable-RemoteAccessRoutingDomain -Name $Contoso_RoutingDomain -Type All -PassThru  
Enable-RemoteAccessRoutingDomain -Name $Fabrikam_RoutingDomain -Type All -PassThru  
```  
  
## <a name="bkmk_top"></a>Поддерживаемые топологии развертывания BGP  
Ниже перечислены поддерживаемые топологии развертывания, в которых сайты предприятия подключены к центру обработки данных поставщика облачных услуг (CSP).  
  
Во всех сценариях шлюз CSP — это шлюз RAS Windows Server 2016 на границе. Шлюз RAS, который способен обрабатывать несколько подключений из нескольких клиентов, состоит из узла Hyper-V и виртуальной машины, которая фактически настроена в качестве шлюза. Этот пограничный шлюз настраивается для межсайтовых подключений VPN как мультитенантный маршрутизатор BGP, служащий для обмена маршрутами между предприятием и подсетью CSP.  
  
Клиенты подключаются к своим ресурсам в центре обработки данных CSP с помощью межсайтовых (S2S) подключений VPN. Кроме того, протокол маршрутизации BGP развертывается для динамического обмена информацией о маршрутизации между предприятием и шлюзами CSP.  
  
Поддерживаются указанные ниже топологии развертывания.  
  
-   [Шлюз VPN типа "сеть — сеть" для RAS с BGP на корпоративном сайте ребра](#bkmk_top1)  
  
-   [Шлюз стороннего производителя с BGP на корпоративном узле](#bkmk_top2)  
  
-   [Несколько корпоративных сайтов со сторонними шлюзами](#bkmk_top3)  
  
-   [Отдельные точки завершения для BGP и VPN](#bkmk_top4)  
  
В дальнейших подразделах приведены дополнительные сведения о каждой поддерживаемой топологии BGP.  
  
### <a name="bkmk_top1"></a>Шлюз VPN типа "сеть — сеть" для RAS с BGP на корпоративном сайте ребра  
В этой топологии представлен сайт предприятия, подключенный к CSP. Топология маршрутизации предприятия включает внутренний маршрутизатор, шлюз RAS сервера Windows Server 2016, настроенный для подключений VPN типа "сеть — сеть" с CSP, и устройство с граничным брандмауэром. Шлюз RAS прерывает подключения S2S VPN и BGP.  
  
![Шлюз VPN типа "сеть — сеть" для RAS](../../media/Border-Gateway-Protocol-BGP/bgp_01.jpg)  
  
Оба сайта подключаются по протоколу eBGP, который позволяет передавать данные между маршрутизаторами с поддержкой BGP в отдельных автономных системах. Для этого необходимо, чтобы у предприятия и CSP были отдельные номера автономных систем (ASN), что является неотъемлемым параметром протокола BGP.  
  
В этом сценарии протокол BGP работает описанным ниже образом.  
  
-   Пограничное устройство сайта предприятия определяет маршруты виртуализованной подсети (10.2.1.0/24), размещенной в облаке, с помощью BGP. Это устройство также объявляет Локальные маршруты подсети (10.1.1.0/24) в многоклиентский шлюз RAS поставщика службы удаленного доступа.  
  
-   Пограничный маршрутизатор клиента определяет внутренние локальные маршруты одним из указанных ниже способов.  
  
    -   Пограничное устройство использует протокол BGP с внутренним маршрутизатором и определяет внутренние маршруты (в этом примере это 10.1.1.0/24). Тем временем внутренний маршрутизатор узнает внутренние маршруты (например, 10.2.1.0/24) от пограничного устройства и должен предоставить эти маршруты другим локальным маршрутизаторам с помощью протокола IGP, такого как OSPF или RIP.  
  
    -   В пограничном устройстве можно настроить статические маршруты или интерфейсы для выбора маршрутов, которые должны объявляться посредством BGP. Пограничное устройство также сообщает внешние маршруты другим локальным маршрутизаторам с помощью IGP.  
  
### <a name="bkmk_top2"></a>Шлюз стороннего производителя с BGP на корпоративном узле  
В этой топологии представлен сайт предприятия, который использует сторонний пограничный маршрутизатор для подключения к CSP. Пограничный маршрутизатор также служит шлюзом для межсайтовых подключений VPN.  
  
![Сторонний шлюз с BGP на границе сайта предприятия](../../media/Border-Gateway-Protocol-BGP/bgp_02.jpg)  
  
Пограничный маршрутизатор предприятия определяет внутренние локальные маршруты одним из указанных ниже способов.  
  
-   Пограничное устройство использует протокол BGP с внутренним маршрутизатором и определяет внутренние маршруты (в этом случае это 10.1.1.0/24).  
  
-   Пограничное устройство реализует протокол IGP и непосредственно участвует во внутренней маршрутизации.  
  
### <a name="bkmk_top3"></a>Несколько корпоративных сайтов, подключающихся к облачному центру обработки данных CSP  
В этой топологии представлено несколько сайтов предприятия, которые используют сторонние шлюзы для подключения к CSP. Сторонние пограничные устройства выступают в роли шлюзов для межсайтовых подключений VPN и в роли маршрутизаторов BGP.  
  
![Несколько корпоративных сайтов, подключающихся к облачному центру обработки данных CSP](../../media/Border-Gateway-Protocol-BGP/bgp_03.jpg)  
  
Пограничные маршрутизаторы клиента определяют внутренние локальные маршруты одним из указанных ниже способов.  
  
-   Пограничное устройство использует протокол BGP с внутренним маршрутизатором и определяет внутренние маршруты (в этом случае это 10.1.1.0/24).  
  
-   Пограничное устройство реализует протокол IGP и непосредственно участвует во внутренней маршрутизации.  
  
Каждый сайт предприятия узнает маршруты от другого сайта посредством прямого подключения eBGP.  
  
Каждый сайт предприятия получает сведения о маршрутах в размещенной сети напрямую и от другого сайта предприятия, а затем выбирает оптимальный маршрут на основе его стоимости.  
  
Если маршрутизатор BGP на корпоративном сайте 1 не может подключиться к маршрутизатору BGP корпоративного сайта 2 из-за сбоя подключения, маршрутизатор BGP сайта 1 динамически начинает изучать маршруты к корпоративной сети сайта 2 от маршрутизатора BGP, а трафик — беспрепятственно. перенаправляется с сайта 1 на сайт 2 через маршрутизатор BGP Windows Server на CSP.  
  
### <a name="bkmk_top4"></a>Отдельные точки завершения для BGP и VPN  
В этой топологии представлено предприятие, в котором в качестве конечной точки BGP и конечной точки межсайтовых подключений VPN используются два разных маршрутизатора. VPN-подключение типа "сеть — сеть" завершается на шлюзе RAS Windows Server 2016, а BGP завершается на внутреннем маршрутизаторе. На стороне поставщика служб шифрования CSP прерывает подключения VPN и BGP к шлюзу RAS. В такой конфигурации оборудование внутреннего стороннего маршрутизатора должно поддерживать повторное распространение маршрутов IGP в BGP, а также повторное распространение маршрутов BGP в IGP.  
  
![Отдельные точки завершения для BGP и VPN](../../media/Border-Gateway-Protocol-BGP/bgp_04.jpg)  
  
Внутренний маршрутизатор определяет маршруты предприятия одним из указанных ниже способов.  
  
-   BGP  
  
-   Протокол IGP, например OSPF или RIP  
  
-   Настройка статических маршрутов  
  
При использовании любого протокола IGP на сайте предприятия внутренний маршрутизатор должен повторно распространять маршруты IGP в BGP, а также повторно распространять маршруты BGP в IGP для обеспечения связи между виртуальными сетями CSP и локальными подсетями предприятия.  
  
В этом развертывании корпоративный шлюз RAS использует VPN-подключение типа "сеть — сеть" с шлюзом RAS CSP, который предоставляет корпоративный шлюз RAS с маршрутами к шлюзу CSP. Затем внутренний маршрутизатор предприятия узнает этот маршрут к шлюзу CSP, используя Ибгп с корпоративным шлюзом RAS. По этой причине внутренний маршрутизатор предприятия может установить сеанс пиринга с маршрутизатором BGP шлюза удаленного доступа CSP.  
  
С этого момента внутренний маршрутизатор предприятия и шлюз RAS обмениваются сведениями о маршрутизации. А корпоративный маршрутизатор BGP для RAS изучает маршруты CSP и корпоративные маршруты, чтобы физически маршрутизировать пакеты между сетями.  
  
## <a name="bkmk_features"></a>Функции BGP  
Ниже приведены функции маршрутизатора BGP шлюза RAS.  
  
**Маршрутизация BGP в качестве службы роли удаленного доступа**. Теперь можно установить службу роли **маршрутизации** роли сервера удаленного доступа, не устанавливая службу роли **службы удаленного доступа (RAS)** , если вы хотите использовать удаленный доступ в качестве маршрутизатора локальной сети BGP.  Это сокращает объем памяти маршрутизатора BGP и устанавливает только компоненты, необходимые для динамической маршрутизации BGP. Служба роли маршрутизации полезна, если требуется только виртуальная машина маршрутизатора BGP и не требуется использование DirectAccess или VPN. Кроме того, использование удаленного доступа в качестве маршрутизатора локальной сети с BGP обеспечивает преимущества динамической маршрутизации BGP во внутренней сети.  
  
**Статистика BGP (счетчики сообщений, счетчики маршрутов)** . Маршрутизатор BGP поддерживает отображение статистики по сообщениями и маршрутам, если это необходимо, с помощью команды **Get-BgpStatistics** среды Windows PowerShell.  
  
**Поддержка маршрутизации на основе множественных маршрутов равной стоимости (ECMP)** . Маршрутизатор BGP поддерживает ECMP, и в его таблице и стеке маршрутизации BGP может быть несколько маршрутов равной стоимости. Если маршрутизация ECMP включена, маршрутизатор BGP выбирает маршрут для передачи пакетов данных случайным образом.  
  
**Настройка значения HoldTime**. Маршрутизатор BGP поддерживает настройку значения HoldTimer в соответствии с требованиями сети. Этот таймер можно динамически изменять для обеспечения взаимодействия с устройствами сторонних производителей или для задания определенного времени ожидания для сеанса пиринга BGP.  
  
**Поддержка iBGP и eBGP**. Маршрутизатор BGP поддерживает пиринг iBGP и eBGP. Для его настройки необходимо назначить соответствующие номера ASN локальному и удаленному маршрутизаторам BGP. Во всех четырех топологиях развертывания BGP используется пиринг eBGP, а в четвертой топологии также применяется пиринг iBGP.  
  
**Взаимодействие с решениями сторонних производителей**. Маршрутизатор BGP основан на последней спецификации BGP версии 4 и был проверен на возможность взаимодействия с большинством основных устройств маршрутизации BGP сторонних производителей. Подробнее см .в документе RFC 4271 [Протокол BGP версии 4](https://tools.ietf.org/html/rfc4271).  
  
**Поддержка пиринга транспорта IPv4 и IPv6**. Маршрутизатор BGP поддерживает пиринг IPv4 и IPv6. Однако идентификатор BGP нужно настроить как IPv4-адрес маршрутизатора BGP. Для всех топологий развертывания маршрутизатора BGP можно использовать любой из двух типов пиринга (IPV4 или IPv6).  
  
**Возможность одноадресного получения и объявления маршрутов IPv4 и IPv6 (мультипротокольная информация сетевого уровня о доступности сети (NLRI))** . Независимо от используемого транспорта маршрутизатор BGP может обмениваться сведениями о маршрутах IPv4 и IPv6, если соответствующая возможность была объявлена другими маршрутизаторами BGP при создании сеанса. Чтобы настроить маршрутизацию IPv6, нужно включить параметр IPv6Routing и настроить локальный глобальный IPv6-адрес на уровне маршрутизатора.  
  
**Пиринг в смешанном и пассивном режимах**. Можно настроить сеансы пиринга BGP в смешанном режиме, где маршрутизатор BGP выступает в качестве инициатора, ответчика или пассивного режима, где маршрутизатор BGP не инициирует пиринг, но отвечает на входящие запросы. Смешанный режим используется по умолчанию и рекомендуется для пиринга BGP. Это верно во всех случаях, кроме тех, когда нужно использовать пассивный режим в целях отладки или диагностики. Во всех топологиях развертывания маршрутизатора BGP пиринг в смешанном режиме необходим для обеспечения автоматического перезапуска в случае сбоев.  
  
**Возможность перезаписи атрибутов маршрутизатора**. С помощью политик маршрутизации BGP можно добавлять, изменять и удалять следующие атрибуты из входящих и исходящих объявлений маршрутов маршрутизатора BGP: Next-Hop, MED, Local-Pref и Community.  
  
**Фильтрация маршрутов**. Маршрутизатор BGP поддерживает фильтрацию входящих и исходящих объявлений маршрутов на основе различных атрибутов маршрутов, таких как Prefix, ASN-Range, Community и Next-Hop.  
  
**Перенаправление (RR) и клиент RR**. Маршрутизатор BGP может действовать в качестве отражателя маршрутизации и клиента RR. Это полезно в сложных топологиях, где RR может упростить сеть, формируя кластеры RR.  
  
**Поддержка обновления маршрутов**. Маршрутизатор BGP поддерживает обновление маршрутов и по умолчанию объявляет эту возможность при пиринге. Он может отправлять новый набор обновлений маршрута при запросе узлом через сообщение об обновлении маршрута, а также отправлять маршрутное обновление для обновления своей таблицы маршрутизации в таких событиях, как изменение политики маршрутизации для однорангового узла. Это позволяет сценарию изменять или обновлять политики маршрутизации BGP в Windows Server 2016 без необходимости перезапуска пиринга.  
  
**Поддержка настройки статических маршрутов**. Статические маршруты и интерфейсы в маршрутизаторе BGP можно настроить с помощью команды **Add-BgpCustomRoute** среды Windows PowerShell. Настраиваемые статические маршруты могут быть префиксами или именами интерфейсов, из которых выбираются маршруты. Однако только маршруты с разрешаемыми следующими прыжками включаются в таблицы маршрутизации BGP и объявляются для одноранговых узлов.  
  
**Поддержка транзитной маршрутизации**. Маршрутизатор BGP поддерживает транзитную маршрутизацию для подключений Ибгп к Ибгп, Ибгп для подключений eBGP, а также eBGP к eBGP подключениям.  
  
**Ослабление Колыханий маршрута**. Ослабление Колыханий маршрута для маршрутизации BGP в Windows Server 2016 обеспечивает поддержку ослабления колыханий маршрута. Например, если маршрут постоянно объявляется и удаляется, что делает таблицу маршрутизации нестабильной, можно настроить маршрутизатор BGP, чтобы назначить для маршрута весовой коэффициент ослабления и отслеживать его для закрылок, и соответствующим образом подавить или отменить его отключение при необходимости. Это помогает поддерживать устойчивую таблицу маршрутизации и меньше обрабатывается маршрутизатором BGP.  
  
**Агрегирование маршрутов**. Объединение маршрутов к маршрутизатору BGP дает возможность настраивать статистические маршруты и заменять более детализированные объявления маршрутов на сводные или статистические маршруты к одноранговым узлам. Это приводит к уменьшению числа сообщений объявления маршрута, переданных по сети.  
  
> [!NOTE]  
> В System Center шлюз RAS называется шлюзом Windows Server.  
  

  

