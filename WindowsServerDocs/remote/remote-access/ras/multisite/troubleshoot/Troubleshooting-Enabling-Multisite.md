---
title: Диагностика подключения многосайтового развертывания
description: Эта статья является частью руководств по развертыванию нескольких серверов удаленного доступа в многосайтовом развертывании в Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 570c81d6-c4f4-464c-bee9-0acbd4993584
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 59db462e3772b551f0d80819e7cd79519e95fb14
ms.sourcegitcommit: da7b9bce1eba369bcd156639276f6899714e279f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/26/2020
ms.locfileid: "80313824"
---
# <a name="troubleshooting-enabling-multisite"></a>Диагностика подключения многосайтового развертывания

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

Этот раздел содержит информацию по устранению проблем, связанных с командой `Enable-DAMultisite`. Чтобы подтвердить, что ваша проблема связана с подключением многосайтового развертывания, проверьте журнал событий Windows на наличие кода события 10051.  
  
## <a name="user-connectivity-issues"></a>Проблемы, связанные с подключением пользователей  
Когда включено многосайтовое развертывание, у пользователей могут возникнуть проблемы с подключением, если конфигурация не верна.  
  
**Причина**  
  
В многосайтовом развертывании клиентские компьютеры Windows 10 и Windows 8 могут перемещаться между разными точками входа.  Клиентские компьютеры с Windows 7 должны быть связаны с определенной точкой входа в многосайтовом развертывании. Если клиентские компьютеры находятся в неверной группе безопасности, они могут получать неправильные параметры групповой политики.  
  
**Решение**  
  
Для DirectAccess требуется по крайней мере одна группа безопасности для всех клиентских компьютеров Windows 10 и Windows 8. рекомендуется использовать одну группу безопасности для всех компьютеров с Windows 10 и Windows 8 на каждый домен. Для каждой точки входа DirectAccess также требуется группа безопасности для клиентских компьютеров Windows 7. Клиентский компьютер должен входить только в одну группу безопасности. Поэтому следует убедиться, что группы безопасности клиентов Windows 10 и Windows 8 содержат только компьютеры под управлением Windows 10 или Windows 8 и что каждый клиентский компьютер Windows 7 принадлежит одной выделенной группе безопасности для соответствующей точки входа и Это значит, что клиенты Windows 10 или Windows 8 не входят в группы безопасности Windows 7.  
  
Настройте группы безопасности Windows 8 на странице **Выбор групп** мастера **установки клиента DirectAccess** . Настройте группы безопасности Windows 7 на странице **Поддержка клиентов** мастера **включения многосайтового развертывания** или на странице **Поддержка клиентов** мастера **добавления точек входа** .  
  
## <a name="kerberos-proxy-authentication"></a>Проверка подлинности прокси Kerberos  
**Произошла ошибка**. Проверка подлинности прокси-сервера Kerberos не поддерживается в многосайтовом развертывании. Для проверки подлинности пользователя IPsec необходимо включить использование сертификатов компьютера.  
  
**Причина**  
  
Проверка подлинности сертификата компьютера должна быть включена перед включением многосайтового развертывания.  
  
**Решение**  
  
Включение проверки подлинности сертификата компьютера  
  
1.  В области сведений консоли управления удаленным доступом нажмите кнопку **Редактировать**, расположенную в рубрике **Шаг 2. Сервер удаленного доступа**.  
  
2.  На странице **Проверки подлинности** мастера **Установки сервера удаленного доступа** отметьте флажком **Использовать сертификаты компьютеров** и выберите корневой или промежуточный центр сертификации, который выдает сертификаты в вашем развертывании.  
  
Чтобы включить проверку подлинности сертификата компьютера с помощью Windows PowerShell, используйте командлет `Set-DAServer` и укажите параметр *ипсекрутцертификате* .  
  
## <a name="ip-https-certificates"></a>Сертификаты IP-HTTPS  
**Произошла ошибка**. Сервер DirectAccess использует самозаверяющий сертификат IP-HTTPS. Настройте IP-HTTPS на использование подписанного сертификата из известного ЦС.  
  
**Причина**  
  
Сертификат IP-HTTPS является самозаверяющим. Самозаверяющие сертификаты нельзя использовать при многосайтовом развертывании.  
  
**Решение**  
  
Выбор сертификата IP-HTTPS  
  
1.  В области сведений консоли управления удаленным доступом нажмите кнопку **Редактировать**, расположенную в рубрике **Шаг 2. Сервер удаленного доступа**.  
  
2.  На странице **Сетевых адаптеров** мастера **Установки сервера удаленного доступа** под рубрикой **Выбрать сертификат, используемый для проверки подлинности соединений IP-HTTPS** убедитесь, что рубрика **Использовать самозаверяющий сертификат, автоматически созданный DirectAccess** не отмечена флажком, и нажмите кнопку **Просмотреть**, чтобы выбрать сертификат, выпущенный доверенным ЦС.  
  
## <a name="network-location-server"></a>Сервер сетевого размещения  
  
-   **Выпуск 1**  
  
    **Произошла ошибка**. DirectAccess настроен на использование самозаверяющего сертификата для сервера сетевых расположений. Настройте сервер сетевых расположений на использование подписанного сертификата из ЦС.  
  
    **Причина**  
  
    Сервер сетевых расположений развертывается на сервере удаленного доступа и использует самозаверяющий сертификат. Самозаверяющие сертификаты нельзя использовать при многосайтовом развертывании.  
  
    **Решение**  
  
    Выбор сертификата сервера сетевых расположений  
  
    1.  В области сведений консоли управления удаленным доступом нажмите кнопку **Редактировать**, расположенную в рубрике **Шаг 3. Серверы инфраструктуры**.  
  
    2.  На странице **Сервера сетевых расположений** мастера **Установки сервера инфраструктуры** под рубрикой **Сервер сетевых расположений развернут на сервере удаленного доступа** убедитесь, что рубрика **Использовать самозаверяющий сертификат** не отмечена флажком, и нажмите кнопку **Просмотреть**, чтобы выбрать сертификат, выпущенный ЦС предприятия.  
  
-   **Выпуск 2**  
  
    **Произошла ошибка**. Чтобы развернуть кластер с балансировкой сетевой нагрузки или развертывание нескольких сайтов, получите сертификат для сервера сетевого расположения с именем субъекта, отличным от внутреннего имени сервера удаленного доступа.  
  
    **Причина**  
  
    Имя субъекта сертификата для веб-сайта сервера сетевых расположений совпадает с внутренним именем сервера удаленного доступа. Это вызывает проблему разрешения имен.  
  
    **Решение**  
  
    Получите сертификат с именем субъекта, отличным от внутреннего имени сервера удаленного доступа.  
  
    Настройка сервера сетевых расположений  
  
    1.  В области сведений консоли управления удаленным доступом нажмите кнопку **Редактировать**, расположенную в рубрике **Шаг 3. Серверы инфраструктуры**.  
  
    2.  На странице **Сервера сетевых расположений** мастера **Установки сервера инфраструктуры** под рубрикой **Сервер сетевых расположений развертывается на сервере удаленного доступа** нажмите **Просмотреть**, чтобы выбрать полученный вами ранее сертификат. Данный сертификат должен иметь имя субъекта, отличное от внутреннего имени сервера удаленного доступа.  
  
## <a name="windows-7-client-computers"></a>Клиентские компьютеры под управлением Windows 7  
**Получено предупреждение**. При включении многосайтовой группы безопасности, настроенные для клиентов DirectAccess, не должны содержать компьютеры под управлением Windows 7. Для поддержки клиентских компьютеров под управлением Windows 7 при многосайтовом развертывании, выберите группу безопасности, включающую клиентов для каждой точки входа.  
  
**Причина**  
  
В существующем развертывании DirectAccess включена поддержка клиентов Windows 7.  
  
**Решение**  
  
Для использования DirectAccess требуется по крайней мере одна группа безопасности для всех клиентских компьютеров с Windows 8 и группа безопасности для клиентских компьютеров Windows 7 для каждой точки входа. Клиентский компьютер должен входить только в одну группу безопасности. Поэтому следует убедиться, что группа безопасности клиентов Windows 8 содержит только компьютеры под управлением Windows 8, и что каждый клиентский компьютер Windows 7 принадлежит к одной выделенной группе безопасности для соответствующей точки входа и не имеет клиентов Windows 8. принадлежат к группам безопасности Windows 7.  
  
## <a name="active-directory-site"></a>Узел Active Directory  
**Произошла ошибка**. Сервер < server_name > не связан с Active Directory сайтом.  
  
**Причина**  
  
DirectAccess не смог определить сайт Active Directory. На консоли сайтов и служб Active Directory можно настроить различные подсети вашей сети и связать каждую подсеть с соответствующим сайтом Active Directory. Эта ошибка может произойти, если IP-адрес сервера удаленного доступа не принадлежит ни к одной подсети или если подсеть, к которой принадлежит данный IP-адрес, не определяется сайтом Active Directory.  
  
**Решение**  
  
Убедитесь, что проблема заключается именно в этом, выполнив команду `nltest /dsgetsite` на вашем сервере удаленного доступа. Если это так, команда вернет ERROR_NO_SITENAME. Чтобы решить эту проблему, убедитесь, что подсеть, содержащая IP-адрес внутреннего сервера, существует на вашем контроллере домена и определена сайтом Active Directory.  
  
## <a name="saving-server-gpo-settings"></a><a name="SaveGPOSettings"></a>Сохранение параметров объекта групповой политики сервера  
**Произошла ошибка**. Произошла ошибка при сохранении параметров удаленного доступа в GPO < GPO_name >.  
  
**Причина**  
  
Изменения в объекте групповой политики сервера не удалось сохранить из-за проблем с подключением или в случае нарушения общего доступа к файлу Registry. pol, например, если файл заблокирован другим пользователем.  
  
**Решение**  
  
Убедитесь, что сервер удаленного доступа подключен к контроллеру домена. Если подключение существует, проверьте, заблокирован ли файл registry.pol для других пользователей на контроллере домена. При необходимости завершите этот сеанс пользователя, чтобы разблокировать файл.  
  
## <a name="internal-error-occurred"></a><a name="InternalServerError"></a>Произошла внутренняя ошибка  
**Произошла ошибка**. Обнаружена внутренняя ошибка.  
  
**Причина**  
  
Это может быть вызвано непредусмотренной конфигурацией таблицы точек входа в объекте групповой политики клиента. Такое может произойти, если администратор использует командлеты клиента DirectAccess, чтобы отредактировать таблицу точек входа в объекте групповой политики клиента.  
  
**Решение**  
  
Просмотрите конфигурацию таблицы точек входа во всех объектах групповой политики клиентов и исправьте несоответствия в конфигурации многосайтового развертывания между различными экземплярами клиентских объектов групповой политики и конфигурацией DirectAccess. Используйте командлет `Get-DaEntryPointTableItem` с именем клиентского объекта групповой политики, чтобы получить таблицу точек входа для клиента. Используйте командлет `Get-NetIPHttpsConfiguration`, чтобы получить все профили IP-HTTPS для всех точек входа.  
  
Дополнительные сведения см. [в разделе командлеты клиента DirectAccess в Windows PowerShell](https://technet.microsoft.com/library/hh848426).  
  


