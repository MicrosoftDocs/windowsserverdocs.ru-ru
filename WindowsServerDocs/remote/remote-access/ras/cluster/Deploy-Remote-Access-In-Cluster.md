---
title: Развертывание удаленного доступа в кластере
description: Этот раздел является частью руководств по развертыванию удаленного доступа в кластере в Windows Server 2016.
manager: dougkim
ms.custom: na
ms.prod: windows-server
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ''
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 5e4108eee0c62ae4d4db31560b31a6f90751c6b8
ms.sourcegitcommit: 6aff3d88ff22ea141a6ea6572a5ad8dd6321f199
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/27/2019
ms.locfileid: "71404649"
---
# <a name="deploy-remote-access-in-a-cluster"></a>Развертывание удаленного доступа в кластере

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

Windows Server 2016 и Windows Server 2012 объединяют службы DirectAccess и удаленного доступа \(RAS @ no__t-1 VPN в одну роль удаленного доступа. Удаленный доступ можно развернуть в ряде корпоративных сценариев. В этом обзоре содержатся общие сведения о корпоративном сценарии развертывания нескольких серверов удаленного доступа в кластерной балансировке нагрузки Windows \(NLB @ no__t-1 или с внешней подсистемой балансировки нагрузки \(ELB @ no__t-3, например F5. Крупный @ no__t-4IP.  

## <a name="BKMK_OVER"></a>Описание сценария  
При развертывании кластера несколько серверов удаленного доступа собираются в единый блок, который выступает в качестве единой точки контакта для удаленных клиентских компьютеров, подключающихся через DirectAccess или VPN к внутренней корпоративной сети с помощью внешнего виртуального IP-адреса @no__ t-0VIP @ no__t-1 адрес кластера удаленного доступа.  Трафик к кластеру распределяется с помощью балансировки сетевой нагрузки Windows или с внешней подсистемой балансировки нагрузки \(such как F5 BIG @ no__t-1IP @ no__t-2.  

## <a name="prerequisites"></a>Предварительные требования  
Перед началом развертывания этого сценария ознакомьтесь со списком важных требований.  

-   Балансировка нагрузки по умолчанию с помощью Windows NLB.  

-   Поддерживаются внешние подсистемы балансировки нагрузки.  

-   Одноадресный режим установлен по умолчанию и рекомендуется для NLB.  

-   Изменение политик вне консоли управления DirectAccess или командлетов PowerShell не поддерживается.  

-   При использовании балансировки сетевой нагрузки или внешней подсистемы балансировки нагрузки невозможно изменить префикс IPHTTPS на любой другой, кроме \/59.  

-   Узлы с балансировкой нагрузки узлы должны находиться в той же подсети IPv4.  

-   В ELB развертываниях, если требуется управление, клиенты DirectAccess не могут использовать @ no__t-0Teredo. Для связи End @ no__t-0to @ no__t-1end можно использовать только IPHTTPS.  

-   Убедитесь, что установлены все известные исправления балансировки сетевой нагрузки @ no__t-0ELB.  

-   ISATAP в корпоративной сети не поддерживается. Если вы используете протокол ISATAP, необходимо удалить его и перейти на собственный IPv6.  

## <a name="in-this-scenario"></a>Содержание сценария  
Сценарий развертывания в кластере включает несколько этапов.  

1.  [Разверните VPN-сервер Always On с дополнительными параметрами](../../vpn/always-on-vpn/deploy/always-on-vpn-adv-options.md). Перед настройкой развертывания кластера необходимо развернуть один сервер удаленного доступа с дополнительными параметрами.  

2.  [Спланируйте развертывание кластера удаленного доступа](plan/Plan-a-Remote-Access-Cluster-Deployment.md). Для создания кластера из развертывания с одним сервером требуется ряд дополнительных действий, включая подготовку сертификатов для развертывания кластера.  

3.  [Настройка кластера удаленного доступа](configure/Configure-a-Remote-Access-Cluster.md). Это состоит из нескольких этапов настройки, включая подготовку одного сервера для Windows NLB или внешней подсистемы балансировки нагрузки, подготовку дополнительных серверов к присоединению кластера и включение балансировки нагрузки.  

## <a name="BKMK_APP"></a>Практические приложения  
Объединение нескольких серверов в кластер серверов предоставляет следующие преимущества.  

-   Масштабируемость. Один сервер удаленного доступа обеспечивает ограниченный уровень надежности сервера и масштабируемой производительности. Посредством объединения ресурсов двух или более серверов в единый кластер вы увеличиваете емкость для количества пользователей и пропускную способность.  

-   Высокий уровень доступности. Кластер обеспечивает высокий уровень доступности всегда @ no__t-0on Access. Если происходит отказ одного из серверов в кластере, то удаленные пользователи могут сохранить доступ к корпоративной сети через другой сервер в кластере. Все серверы в кластере имеют одинаковый набор виртуальных IP-адресов \(VIP @ no__t-1, сохраняя при этом уникальные выделенные IP-адреса для каждого сервера.  

-   Простота @ no__t-0of @ no__t-1management. Кластер позволяет управлять несколькими серверами как единой сущностью. На всех серверах кластера можно легко установить общие параметры. Параметрами удаленного доступа можно управлять с любого сервера в кластере или удаленно с помощью средства удаленного администрирования сервера \(RSAT @ no__t-1. Кроме того, наблюдение за всем кластером можно осуществлять с одной консоли управления удаленным доступом.  

## <a name="BKMK_NEW"></a>Роли и компоненты, входящие в этот сценарий  
В следующей таблице перечислены роли и компоненты, необходимые для сценария.  

|Role @ no__t-0feature|Способ поддержки сценария|  
|---------|-----------------|  
|Роль удаленного доступа|Эта роль устанавливается и удаляется с помощью консоли Диспетчера серверов. Она включает DirectAccess, который ранее был компонентом в Windows Server 2008 R2, а также службами маршрутизации и удаленного доступа \(RRAS @ no__t-1, который ранее был службой роли в службах сетевой политики и доступа \(NPAS @ no__t-3. роль сервера. Роль удаленного доступа включает два компонента.<br /><br />-Always On VPN и службы маршрутизации и удаленного доступа \(RRAS @ no__t-1 VPN — DirectAccess и VPN управляются вместе в консоли управления удаленным доступом.<br />— Маршрутизация RRAS. Управление функциями маршрутизации RRAS осуществляется с помощью устаревшей консоли маршрутизации и удаленного доступа.<br /><br />Существуют следующие зависимости.<br /><br />-Службы IIS \(IIS @ no__t-1 — веб-сервер — эта функция необходима для настройки сервера сетевых расположений и веб-проверки по умолчанию.<br />— Внутренняя база данных Windows — используется для локального учета на сервере удаленного доступа.|  
|Средства управления удаленным доступом|Этот компонент устанавливается описанным ниже образом.<br /><br />— Он устанавливается по умолчанию на сервере удаленного доступа при установке роли удаленного доступа и поддерживает пользовательский интерфейс консоли удаленного управления.<br />— Его можно дополнительно установить на сервере, на котором не запущена роль сервера удаленного доступа. В этом случае компонент используется для удаленного управления компьютером с возможностью удаленного доступа, на котором установлены DirectAccess и VPN.<br /><br />Средства управления удаленным доступом включают следующие элементы:<br /><br />— Графический интерфейс удаленного доступа и средства командной строки<br />— Модуль удаленного доступа для Windows PowerShell<br /><br />Зависимости включают следующее:<br /><br />— Консоль управления групповыми политиками<br />— Пакет администрирования диспетчера подключений RAS \(CMAK @ no__t-1<br />— Windows PowerShell 3,0<br />-Графические средства управления и инфраструктура|  
|Балансировка сетевой нагрузки|Данный компонент обеспечивает балансировку нагрузки в кластере при помощи компонента балансировки сетевой нагрузки Windows.|  

## <a name="BKMK_HARD"></a>Требования к оборудованию  
Для этого сценария действуют следующие требования к оборудованию.  

-   По крайней мере два компьютера соответствуют требованиям к оборудованию для Windows Server 2012.  

-   Для сценария External Load Balancer требуется специальное оборудование \(i. e. F5 BigIP @ no__t-1.  

-   Чтобы протестировать сценарий, необходимо иметь хотя бы один компьютер под управлением Windows 10, настроенный в качестве Always On VPN-клиента.   

## <a name="BKMK_SOFT"></a>Требования к программному обеспечению  
Для этого сценария действуют следующие требования.  

-   Требования к программному обеспечению для развертывания на одном сервере. Дополнительные сведения см. [в статье Развертывание одного сервера DirectAccess с дополнительными параметрами](../../directaccess/single-server-advanced/Deploy-a-Single-DirectAccess-Server-with-Advanced-Settings.md). Один удаленный доступ).  

-   Помимо требований к программному обеспечению для одного сервера, существует ряд требований к кластеру @ no__t-0specific:  

    -   На каждом сервере кластера имя субъекта сертификата IP @ no__t-0HTTPS должно совпадать с адресом ssASnoversion. Развертывание кластера поддерживает использование подстановочных знаков и сертификатов, отличных от @ no__t-0wildcard, на серверах кластера.  

    -   Если на сервере удаленного доступа установлен сервер сетевых расположений, то на каждом сервере кластера сертификат сервера сетевых расположений должен иметь одно и то же имя субъекта. Кроме того, имя сертификата сервера сетевых расположений не должно совпадать с именем какого-либо сервера в развертывании DirectAccess.  

    -   Сертификаты сервера IP @ no__t-0HTTPS и сетевого расположения должны быть выданы с помощью того же метода, с которым был выдан сертификат для одного сервера. Например, если один сервер использует общедоступный центр сертификации \(CA @ no__t-1, все серверы в кластере должны иметь сертификат, выданный общедоступным центром сертификации. Или, если один сервер использует сертификат Self @ no__t-0signed для IP @ no__t-1HTTPS, все серверы в кластере должны выполнять подобную задачу.  

    -   Префикс IPv6, назначенный клиентскому компьютеру DirectAccess в кластере сервера, должен иметь длину 59 бит. Если включена VPN, то префикс VPN тоже должен быть длиной 59 бит.  

## <a name="KnownIssues"></a>Известные проблемы  
Ниже приводятся известные проблемы, возникающие при настройке сценария кластера.  

-   После настройки DirectAccess в развертывании IPv4 @ no__t-0only с одним сетевым адаптером, после чего по умолчанию на сетевом адаптере автоматически настраивается протокол DNS64 \(the IPv6, который содержит ": 3333::" \). при попытке включить Load @ no__t-3balancing через консоль управления удаленным доступом предписывает пользователю выводить запрос на предоставление адреса IPv6 DIP. Если указать DIP IPv6, после нажатия кнопки **Зафиксировать** возникает ошибка: Неверный параметр.  

    Чтобы решить эту проблему, выполните указанные ниже действия.  

    1.  Скачайте сценарии резервного копирования и восстановления из раздела [Настройка резервного копирования и восстановления конфигурации удаленного доступа](https://gallery.technet.microsoft.com/Back-up-and-Restore-Remote-e157e6a6).  

    2.  Резервное копирование объектов групповой политики удаленного доступа с помощью скачанного скрипта Backup @ no__t-0RemoteAccess. ps1  

    3.  Попытайтесь включить балансировку нагрузки, пока не возникнет ошибка. В диалоговом окне Включение балансировки нагрузки разверните область сведения, щелкните правой кнопкой @ no__t-0click в области сведений и выберите команду **Копировать скрипт**.  

    4.  Откройте Блокнот и вставьте содержимое буфера обмена. Пример:  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0','fdc4:29bd:abde:3333::2/128') -InternetVirtualIPAddress @('fdc4:29bd:abde:3333::1/128', '10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    5.  Закройте все открытые диалоговые окна удаленного доступа и закройте консоль управления удаленным доступом.  

    6.  Измените вставленный текст и удалите IPv6-адреса. Пример:  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0') -InternetVirtualIPAddress @('10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    7.  В окне PowerShell с повышенными привилегиями выполните команду из предыдущего шага.  

    8.  Если сбой командлета выполняется \(not из-за неправильных входных значений @ no__t-1, выполните команду RESTORE @ no__t-2RemoteAccess. ps1 и следуйте инструкциям, чтобы убедиться, что целостность исходной конфигурации сохраняется.  

    9. Теперь снова откройте консоль управления удаленным доступом.  
