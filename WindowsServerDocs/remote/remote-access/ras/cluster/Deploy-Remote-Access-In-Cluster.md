---
title: Развертывание удаленного доступа в кластере
description: Этот раздел является частью руководства развертывание удаленного доступа в кластере в Windows Server 2016.
manager: dougkim
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ''
ms.author: pashort
author: shortpatti
ms.openlocfilehash: 853788f20c452391c802f0681fa23978b4892c6a
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67281231"
---
# <a name="deploy-remote-access-in-a-cluster"></a>Развертывание удаленного доступа в кластере

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

Windows Server 2016 и Windows Server 2012 объединить DirectAccess и службы удаленного доступа \(RAS\) VPN в единую роль удаленного доступа. Вы можете развернуть удаленного доступа в нескольких корпоративных сценариях. Данный обзор представляет введение в корпоративный сценарий для развертывания нескольких серверов удаленного доступа в кластере нагрузки балансировать с помощью Windows балансировку сетевой нагрузки \(балансировки сетевой Нагрузки\) или внешний балансировщик нагрузки \(ELB \), например F5 больших\-IP-адрес.  

## <a name="BKMK_OVER"></a>Описание сценария  
Развертывание в кластере объединяет несколько серверов удаленного доступа в единый блок, который действует как единая точка контакта для удаленных клиентских компьютеров, подключающихся к внутренней корпоративной сети с помощью внешнего виртуального IP-адреса черезDirectAccessилиVPN\(Виртуальный IP-адрес\) адрес кластера удаленного доступа.  Трафик в кластер балансируется с помощью Windows NLB или балансировщик нагрузки с внешним \(например F5 больших\-IP-адрес\).  

## <a name="prerequisites"></a>предварительные требования  
Перед началом развертывания этого сценария ознакомьтесь со списком важных требований.  

-   Балансировка нагрузки по умолчанию с помощью Windows NLB.  

-   Поддерживаются внешние подсистемы балансировки нагрузки.  

-   Одноадресный режим установлен по умолчанию и рекомендуется для NLB.  

-   Изменение политик вне консоли управления DirectAccess или командлетов PowerShell не поддерживается.  

-   При использовании NLB или внешней подсистемы балансировки нагрузки префикс IPHTTPS нельзя изменить на что-либо другими от \/59.  

-   Узлы с балансировкой нагрузки узлы должны находиться в той же подсети IPv4.  

-   В развертываниях ELB Если управление требуется, то клиенты DirectAccess не могут использовать&nbsp;Teredo. Для окончания может использоваться только IPHTTPS\-для\-окончания обмена данными.  

-   Убедитесь, все известные балансировки сетевой Нагрузки\/ELB исправлений.  

-   ISATAP в корпоративной сети не поддерживается. Если вы используете протокол ISATAP, необходимо удалить его и перейти на собственный IPv6.  

## <a name="in-this-scenario"></a>Содержание сценария  
Сценарий развертывания в кластере включает несколько этапов.  

1.  [Развертывание всегда на VPN-сервере, с дополнительными параметрами](../../vpn/always-on-vpn/deploy/always-on-vpn-adv-options.md). Перед настройкой развертывания в кластере должны развертываться единого сервера удаленного доступа с расширенными параметрами.  

2.  [Планирование развертывания удаленного доступа в кластере](plan/Plan-a-Remote-Access-Cluster-Deployment.md). Для создания кластера из развертывания одного сервера ряд дополнительных шагов необходимы, включая подготовку сертификатов для развертывания кластера.  

3.  [Настройка кластера удаленного доступа](configure/Configure-a-Remote-Access-Cluster.md). Это состоит из нескольких этапов настройки, в том числе Подготовка одного сервера для Windows NLB или внешней подсистемы балансировки нагрузки, Подготовка дополнительных серверов для присоединения к кластеру и включение балансировки нагрузки.  

## <a name="BKMK_APP"></a>Практическое применение  
Объединение нескольких серверов в кластер серверов предоставляет следующие преимущества.  

-   Масштабируемость. Сервер удаленного доступа обеспечивает ограниченный уровень надежности и масштабируемой производительности. Посредством объединения ресурсов двух или более серверов в единый кластер вы увеличиваете емкость для количества пользователей и пропускную способность.  

-   Высокий уровень доступности. Кластер обеспечивает высокую доступность для всегда\-на доступ. Если происходит отказ одного из серверов в кластере, то удаленные пользователи могут сохранить доступ к корпоративной сети через другой сервер в кластере. Все серверы в кластере имеют тот же набор виртуальных IP-адреса кластера \(виртуального IP-адреса\) адреса, сохраняя при этом уникальный и выделенные IP-адреса для каждого сервера.  

-   Простота\-из\-управления. Кластер позволяет управлять несколькими серверами как единым целым. На всех серверах кластера можно легко установить общие параметры. Можно управлять параметрами удаленного доступа из любого из серверов в кластере или удаленно с помощью средств удаленного администрирования сервера \(RSAT\). Кроме того, наблюдение за всем кластером можно осуществлять с одной консоли управления удаленным доступом.  

## <a name="BKMK_NEW"></a>Роли и компоненты, используемые в данном сценарии  
В следующей таблице перечислены роли и компоненты, необходимые для сценария.  

|Роль\/функция|Способ поддержки сценария|  
|---------|-----------------|  
|Роль удаленного доступа|Эта роль устанавливается и удаляется с помощью консоли Диспетчера серверов. Она включает как DirectAccess, который раньше был компонентом Windows Server 2008 R2 и маршрутизации и удаленного доступа \(RRAS\), который был ранее, служба роли в сетевой политики и доступа к службам \(NPAS\) роли сервера. Роль удаленного доступа включает два компонента.<br /><br />-Всегда VPN и маршрутизации и удаленного доступа \(RRAS\) VPN DirectAccess и VPN осуществляется через одну консоль управления удаленным доступом.<br />-Управление компонентами маршрутизации RRAS маршрутизации-RRAS осуществляется с устаревших консоль маршрутизации и удаленного доступа.<br /><br />Существуют следующие зависимости.<br /><br />-Службы IIS \(IIS\) веб-сервер — данный компонент необходим для настройки сетевого расположения сервера и по умолчанию веб-пробы.<br />-Внутренняя Database-Used Windows для локального учета на сервере удаленного доступа.|  
|Средства управления удаленным доступом|Этот компонент устанавливается описанным ниже образом.<br /><br />— Он устанавливается по умолчанию на сервере удаленного доступа при установке роли удаленного доступа, а также поддерживает пользовательский интерфейс консоли удаленного управления.<br />— Его можно при необходимости установить на сервере, не использующем роль сервера удаленного доступа. В этом случае компонент используется для удаленного управления компьютером с возможностью удаленного доступа, на котором установлены DirectAccess и VPN.<br /><br />Средства управления удаленным доступом включают следующие элементы:<br /><br />-Графический интерфейс пользователя удаленного доступа и программы командной строки<br />-Модуль удаленного доступа для Windows PowerShell<br /><br />Зависимости включают следующее:<br /><br />-Консоль управления групповыми политиками<br />-Пакет администрирования диспетчера подключений RAS \(пакета администрирования диспетчера Подключений\)<br />— Windows PowerShell 3.0<br />-Графические средства управления и инфраструктуры|  
|Балансировка сетевой нагрузки|Данный компонент обеспечивает балансировку нагрузки в кластере при помощи компонента балансировки сетевой нагрузки Windows.|  

## <a name="BKMK_HARD"></a>Требования к оборудованию  
Для этого сценария действуют следующие требования к оборудованию.  

-   Минимум два компьютера, которые удовлетворяют требованиям к оборудованию для Windows Server 2012.  

-   Для сценария внешней подсистемы балансировки нагрузки, требуется специальное оборудование \(например F5 BigIP\).  

-   Для проверки данного сценария, необходимо иметь по крайней мере один компьютер под управлением Windows 10, которые настроены в качестве AlwaysOn VPN-клиента.   

## <a name="BKMK_SOFT"></a>Требования к программному обеспечению  
Для этого сценария действуют следующие требования.  

-   Требования к программному обеспечению для развертывания на одном сервере. Дополнительные сведения см. в разделе [развертывание одиночного сервера DirectAccess с расширенными параметрами](../../directaccess/single-server-advanced/Deploy-a-Single-DirectAccess-Server-with-Advanced-Settings.md). Один для удаленного доступа).  

-   Помимо требования к программному обеспечению для одного сервера существуют кластера\-конкретных требований:  

    -   На каждом сервере кластера, IP-адрес\-сертификат HTTPS, имя субъекта должно соответствовать адресу ConnectTo. Кластерное развертывание поддерживает набор подстановочных знаков и не\-групповые сертификаты на узле кластера.  

    -   Если на сервере удаленного доступа установлен сервер сетевых расположений, то на каждом сервере кластера сертификат сервера сетевых расположений должен иметь одно и то же имя субъекта. Кроме того, имя сертификата сервера сетевых расположений не должно совпадать с именем какого-либо сервера в развертывании DirectAccess.  

    -   IP-адрес\-HTTPS и сетевого расположения серверных сертификатов должен быть выдан используя тот же метод, с помощью которого был выдан сертификат с одним сервером. Например, если один сервер использует общедоступный центр сертификации \(ЦС\) все серверы в кластере должны иметь сертификат, выданный общедоступным центром сертификации. Или если один сервер использует самозаверяющий\-подписал сертификат для IP-адреса\-HTTPS, а затем все серверы в кластере должны иметь такие же сертификаты.  

    -   Префикс IPv6, назначенный клиентскому компьютеру DirectAccess в кластере сервера, должен иметь длину 59 бит. Если включена VPN, то префикс VPN тоже должен быть длиной 59 бит.  

## <a name="KnownIssues"></a>Известные проблемы  
Ниже приводятся известные проблемы, возникающие при настройке сценария кластера.  

-   После настройки DirectAccess в IPv4\-только модель развертывания с одним сетевым адаптером и после DNS64 по умолчанию \(IPv6-адрес, который содержит «: 3333::»\) автоматически настраивается на сетевом адаптере попытка включить нагрузки\-балансировки с помощью консоли управления удаленным доступом приводит к запрашивать пользователя ввести IPv6 DIP. Если указать DIP IPv6, после нажатия кнопки **Зафиксировать** возникает ошибка: Неверный параметр.  

    Чтобы решить эту проблему, выполните указанные ниже действия.  

    1.  Скачайте сценарии резервного копирования и восстановления из раздела [Настройка резервного копирования и восстановления конфигурации удаленного доступа](https://gallery.technet.microsoft.com/Back-up-and-Restore-Remote-e157e6a6).  

    2.  Резервное копирование в GPO удаленного доступа, с помощью Скачанный скрипт резервного копирования\-RemoteAccess.ps1  

    3.  Попытайтесь включить балансировку нагрузки, пока не возникнет ошибка. В диалоговом окне "Включение балансировки нагрузки" разверните область сведений, прямо\-щелкните в области сведений, затем нажмите кнопку **Копировать сценарий**.  

    4.  Откройте Блокнот и вставьте содержимое буфера обмена. Пример:  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0','fdc4:29bd:abde:3333::2/128') -InternetVirtualIPAddress @('fdc4:29bd:abde:3333::1/128', '10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    5.  Закройте все открытые диалоговые окна удаленного доступа и закройте консоль управления удаленным доступом.  

    6.  Измените вставленный текст и удалите IPv6-адреса. Пример:  

        ```  
        Set-RemoteAccessLoadBalancer -InternetDedicatedIPAddress @('10.244.4.19 /255.255.255.0') -InternetVirtualIPAddress @('10.244.4.21 /255.255.255.0') -ComputerName 'DA1.domain1.corp.contoso.com' -Verbose  
        ```  

    7.  В окне PowerShell с повышенными привилегиями выполните команду из предыдущего шага.  

    8.  Если командлет завершится сбоем, пока оно выполняется \(не из-за неправильных входных значений\), выполните команду восстановления\-RemoteAccess.ps1 и следуйте инструкциям, чтобы убедиться, что целостность исходной конфигурации поддерживается .  

    9. Теперь снова откройте консоль управления удаленным доступом.  
