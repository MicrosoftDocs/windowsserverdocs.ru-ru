---
title: Диагностика включения OTP
description: Этот раздел является частью руководства развертывание удаленного доступа с проверкой подлинности OTP в Windows Server 2016.
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology:
- networking-ras
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: b58252ca-4c1d-4664-a3c4-7301e2121517
ms.author: pashort
author: shortpatti
ms.openlocfilehash: d789671a0425974e560e5f4a43ebcba4c1741c76
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59819465"
---
# <a name="troubleshooting-enabling-otp"></a>Диагностика включения OTP

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

Этот раздел содержит информацию по устранению проблем, связанных с включением проверки подлинности методом OTP для DirectAccess с помощью **Enable DAOtpAuthentication** командлета PowerShell или консоли управления удаленным доступом.
  
## <a name="failed-to-enroll-the-otp-signing-certificate"></a>Не удалось зарегистрировать сертификат для подписи OTP  
**Сообщение об ошибке** (журнал событий сервера). Сертификат подписи OTP не может быть зарегистрированы с помощью шаблона сертификата < OTP_signing_template_name >  
  
**Причина**  
  
Существует три возможных причин этой ошибки.  
  
-   Шаблон не существует.  
  
-   Разрешениях, заданных в шаблоне запретить серверу DirectAccess для регистрации.  
  
-   Отсутствует подключение сети выдающий центр сертификации (ЦС).  
  
**Решение**  
  
1.  Убедитесь, что подписывание OTP шаблон с заданным именем сертификата:  
  
    1.  Существует и имеет соответствующие разрешения.  
  
    2.  Имеет значение быть выдан центром сертификации по крайней мере один, который может выдавать сертификаты на сервере DirectAccess.  
  
2.  Если шаблон не существует, создайте его, как описано в разделе 3.3 плана сертификата центра регистрации или если существует другой подходящий шаблон перенастроить OTP для DirectAccess с новым именем шаблона.  
  
## <a name="failed-to-enable-directaccess-otp-when-webdav-is-installed"></a>Не удалось включить OTP для DirectAccess при установке WebDAV  
**Сценарий**. При попытке применить конфигурацию DirectAccess OTP в консоли управления удаленным доступом или с помощью `Enable-DAOtpAuthentication` командлет PowerShell, операция завершится ошибкой.  
  
**Сообщение об ошибке** (журнал событий сервера). Не удалось применить настройки DirectAccess OTP, поскольку расширение WebDAV IIS выполняется на сервере. Удалите WebDAV и повторно применить параметры.  
  
**Причина**  
  
Службу OTP для DirectAccess несовместим с помощью функции публикации WebDAV и невозможно активировать, пока устанавливается WebDAV.  
  
**Решение**  
  
Удалите роль WebDAV:  
  
1.  В консоли диспетчера сервера в области слева, щелкните **IIS**.  
  
2.  На главной панели найдите **РОЛЕЙ и КОМПОНЕНТОВ**.  
  
3.  Щелкните правой кнопкой мыши **Публикация WebDAV**, а затем нажмите кнопку **удалить роль или компонент**.  
  
4.  Выполните удаление мастера ролей и компонентов.  
  
5.  Повторно примените конфигурацию DirectAccess OTP.  
  
## <a name="no-templates-available-in-the-remote-access-management-console"></a>Нет шаблонов, доступных в консоли управления удаленным доступом  
**Сценарий**. При настройке OTP или регистрацию шаблонов сертификатов центра, в консоли управления удаленным доступом, некоторые или все шаблоны отсутствуют окна выбора.  
  
**Причина**  
  
Существуют две возможные причины этой ошибки:  
  
-   Шаблон не настроен в соответствии с требованиями OTP для DirectAccess, и поэтому не могут быть выбраны.  
  
-   Выбранный сервер клиентского доступа в разделе **серверы ЦС OTP** не настроены для выдачи необходимые шаблоны.  
  
**Решение**  
  
1.  Убедитесь, что шаблон входа OTP и подписи шаблона сертификата OTP настроены должным образом, как описано в плане 3.2, шаблона сертификата OTP и 3.3 плана сертификата центра регистрации.  
  
2.  Убедитесь, что настроенный ЦС в **серверы ЦС OTP** список проблем настроены соответствующие шаблоны:  
  
    1.  На сервере ЦС откройте консоль центра сертификации.  
  
    2.  В левой области разверните выбранный сервер ЦС.  
  
    3.  Нажмите кнопку **шаблонов сертификатов** и убедитесь, что включены необходимые шаблоны. Если это не так, щелкните правой кнопкой мыши **шаблонов сертификатов**, нажмите кнопку **New**, нажмите кнопку **шаблона сертификата для выдачи**и выберите шаблон, который вы хотите включить.  
  
## <a name="cannot-set-renewal-period-of-otp-template-to-1-hour"></a>Не удается задать период обновления шаблона OTP до 1 часа  
**Сценарий**. При настройке OTP для DirectAccess шаблон входа, с помощью сертификации Windows 2003, не позволяют задать период обновления шаблона до 1 часа.  
  
**Причина**  
  
Оснастку консоли MMC для шаблонов сертификатов в Windows Server 2003 не позволяет задать период обновления шаблона до 1 часа.  
  
**Решение**  
  
Установить оснастку шаблонов сертификатов на сервере после Windows Server 2003 и использовать его для настройки шаблона входа OTP, см. в разделе [установите оснастку шаблонов сертификатов](https://technet.microsoft.com/library/cc732445.aspx).  
  


