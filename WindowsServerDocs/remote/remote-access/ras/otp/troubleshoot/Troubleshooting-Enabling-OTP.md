---
title: Диагностика включения OTP
description: Эта статья является частью руководств по развертыванию удаленного доступа с помощью проверки подлинности OTP в Windows Server 2016.
manager: brianlic
ms.prod: windows-server
ms.technology: networking-ras
ms.topic: article
ms.assetid: b58252ca-4c1d-4664-a3c4-7301e2121517
ms.author: lizross
author: eross-msft
ms.openlocfilehash: 9be7ef4c4d07b522f683a403e46a11e109dbd226
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80853647"
---
# <a name="troubleshooting-enabling-otp"></a>Диагностика включения OTP

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016

В этом разделе содержатся сведения об устранении неполадок, связанных с включением проверки подлинности DirectAccess методом OTP с помощью командлета PowerShell **Enable-даотпаусентикатион** или консоли управления удаленным доступом.
  
## <a name="failed-to-enroll-the-otp-signing-certificate"></a>Не удалось зарегистрировать сертификат для подписи OTP  
**Получена ошибка** (журнал событий сервера). Не удается зарегистрировать сертификат подписи OTP с помощью < шаблона сертификата OTP_signing_template_name >  
  
**Причина**  
  
Существует три возможные причины этой ошибки:  
  
-   Шаблон не существует.  
  
-   Разрешения, заданные для шаблона, не позволяют серверу DirectAccess регистрироваться.  
  
-   Отсутствует сетевое подключение к выдающему центру сертификации (ЦС).  
  
**Решение**  
  
1.  Убедитесь, что шаблон сертификата подписывания OTP с указанным именем:  
  
    1.  Существует и имеет соответствующие разрешения.  
  
    2.  Выдается по крайней мере одним центром сертификации, который может выдавать сертификаты на сервер DirectAccess.  
  
2.  Если шаблон не существует, создайте его, как описано в 3,3. в разделе Планирование сертификата центра регистрации или в случае существования другого совпадающего шаблона перенастройте OTP DirectAccess с новым именем шаблона.  
  
## <a name="failed-to-enable-directaccess-otp-when-webdav-is-installed"></a>Не удалось включить OTP DirectAccess при установке WebDAV  
**Сценарий**. При попытке применить конфигурацию OTP DirectAccess в консоли управления удаленным доступом или с помощью командлета `Enable-DAOtpAuthentication` PowerShell операция завершается ошибкой.  
  
**Получена ошибка** (журнал событий сервера). Параметры OTP DirectAccess не могут быть применены, так как расширение WebDAV IIS запущено на сервере. Удалите WebDAV и снова примените параметры.  
  
**Причина**  
  
Служба OTP DirectAccess несовместима с компонентом публикации WebDAV и не может быть включена во время установки WebDAV.  
  
**Решение**  
  
Удалите роль WebDAV:  
  
1.  В консоли диспетчер сервера в области слева щелкните **IIS**.  
  
2.  В основной области перейдите к **роли и компоненты**.  
  
3.  Щелкните правой кнопкой мыши пункт **публикация WebDAV**и выберите пункт **удалить роль или компонент**.  
  
4.  Завершите работу мастера удаления ролей и компонентов.  
  
5.  Повторно примените конфигурацию OTP DirectAccess.  
  
## <a name="no-templates-available-in-the-remote-access-management-console"></a>Нет доступных шаблонов в консоли управления удаленным доступом  
**Сценарий**. При настройке шаблонов сертификатов OTP или центра регистрации с помощью консоли управления удаленным доступом некоторые или все шаблоны отсутствуют в окнах выбора.  
  
**Причина**  
  
Эта ошибка может быть вызвана двумя причинами.  
  
-   Шаблон не настроен в соответствии с требованиями OTP DirectAccess и поэтому не может быть выбран.  
  
-   Выбранные ЦС на **серверах ЦС OTP** не настроены на выдачу необходимых шаблонов.  
  
**Решение**  
  
1.  Убедитесь, что шаблон входа OTP и шаблон сертификата для подписи OTP настроены правильно, как описано в 3,2 Планирование шаблона сертификата OTP и 3,3 Планирование сертификата центра регистрации.  
  
2.  Убедитесь, что настроенные ЦС в списке **серверы ЦС OTP** настроены на выдачи соответствующих шаблонов:  
  
    1.  На сервере ЦС откройте консоль центра сертификации.  
  
    2.  В левой области разверните выбранный сервер ЦС.  
  
    3.  Щелкните **шаблоны сертификатов** и убедитесь, что необходимые шаблоны включены. В противном случае щелкните правой кнопкой мыши **шаблоны сертификатов**, выберите команду **создать**, щелкните **Выдаваемый шаблон сертификата**, а затем выберите шаблоны, которые необходимо включить.  
  
## <a name="cannot-set-renewal-period-of-otp-template-to-1-hour"></a>Не удается задать период продления шаблона OTP равным 1 часу  
**Сценарий**. При настройке шаблона входа в DirectAccess с помощью центра сертификации Windows 2003 невозможно задать период продления шаблона равным 1 часу.  
  
**Причина**  
  
Оснастка консоли MMC "Шаблоны сертификатов" в Windows Server 2003 не позволяет задать период продления шаблона равным 1 часу.  
  
**Решение**  
  
Установить оснастку "Шаблоны сертификатов" на сервере после Windows Server 2003 и использовать его для настройки шаблона входа OTP см. в разделе [Установка оснастки "Шаблоны сертификатов](https://technet.microsoft.com/library/cc732445.aspx)".  
  


