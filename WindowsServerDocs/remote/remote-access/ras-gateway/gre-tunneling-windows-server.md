---
title: Туннелирование GRE в Windows Server 2016
description: С помощью этого раздела можно получить представление об обновлениях функции туннелирования GRE для шлюза RAS в Windows Server 2016.
manager: brianlic
ms.topic: article
ms.assetid: df2023bf-ba64-481e-b222-6f709edaa5c1
ms.author: lizross
author: eross-msft
ms.date: 08/07/2020
ms.openlocfilehash: de33ba380da611dd4bece67da382ffd72d56e5eb
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97947420"
---
# <a name="gre-tunneling-in-windows-server-2016"></a>Туннелирование GRE в Windows Server 2016

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

Windows Server 2016 предоставляет обновления для шлюза RAS с универсальной маршрутизацией \( GRE \) .

GRE — это упрощенный протокол туннелирования, который может инкапсулировать разнообразные протоколы сетевого уровня внутри виртуальных каналов "точка-точка" в IP-сети. Реализация Microsoft GRE может инкапсулировать IPv4 и IPv6.

Туннели GRE полезны во многих сценариях, поскольку:

-   Они являются упрощенными и совместимыми с RFC 2890, что делает их совместимыми с различными устройствами поставщика.

-   \(Для динамической маршрутизации можно использовать протокол BGP BGP. \)

-   Вы можете настроить многоклиентские шлюзы GRE для использования с программно определяемой сетью \( Sdn.\)

-   System Center Virtual Machine Manager можно использовать для управления \- шлюзами RAS на основе GRE

-   Можно достичь до 2,0 Гбит/с на виртуальной машине с 6 ядрами, настроенной в качестве шлюза RAS GRE.

-   Один шлюз поддерживает несколько режимов подключения.

Туннели на основе GRE обеспечивают подключение между виртуальными сетями клиентов и внешними сетями. Поскольку протокол GRE является легковесным и поддержка GRE доступна на большинстве сетевых устройств, она становится идеальным выбором для туннелирования, где шифрование данных не требуется.

Поддержка GRE в туннельах типа "сеть — сеть" (S2S) решает проблему переадресации между виртуальными сетями клиента и внешними сетями клиента с помощью шлюза с несколькими клиентами, как описано далее в этом разделе.

Функция туннелирования GRE предназначена для решения следующих требований:

-   Поставщик услуг размещения должен иметь возможность создавать виртуальные сети для перенаправления без изменения конфигурации физического коммутатора.

-   Поставщик услуг размещения должен иметь возможность добавлять подсети к внешним сетям, не изменяя конфигурацию физических коммутаторов в своей инфраструктуре.
Функция туннелирования GRE включает или расширяет несколько ключевых сценариев для поставщиков услуг размещения, использующих технологии Майкрософт для реализации программно определяемых сетей в своих предложениях услуг.

Ниже приведены некоторые примеры сценариев.

-   [Доступ из виртуальных сетей клиента к физическим сетям клиента](#BKMK_Access)

-   [Высокая скорость подключения](#BKMK_Speed)

-   [Интеграция с изоляцией на основе VLAN](#BKMK_Integration)

-   [Доступ к общим ресурсам](#BKMK_Shared)

-   [Службы сторонних устройств для клиентов](#BKMK_thirdparty)

## <a name="key-scenarios"></a>Основные сценарии

Ниже приведены основные сценарии, в которых используется функция туннелирования GRE.

### <a name="access-from-tenant-virtual-networks-to-tenant-physical-networks"></a><a name="BKMK_Access"></a>Доступ из виртуальных сетей клиента к физическим сетям клиента

Этот сценарий обеспечивает масштабируемый способ предоставления доступа из виртуальных сетей клиента физическим сетям клиента, расположенным в локальной организации поставщика услуг размещения. Конечная точка туннеля GRE установлена в многоклиентский шлюз, другая конечная точка туннеля GRE устанавливается на устройстве стороннего производителя в физической сети. Трафик уровня 3 направляется между виртуальными машинами в виртуальной сети и устройством стороннего производителя в физической сети.

![Подключается физическая сеть и виртуальная сеть клиента поставщика услуг размещения](../../media/gre-tunneling-in-windows-server/GRE_.png)

### <a name="high-speed-connectivity"></a><a name="BKMK_Speed"></a>Высокая скорость подключения

Этот сценарий позволяет масштабировать способ обеспечения высокоскоростного подключения из локальной сети клиента к их виртуальной сети, расположенной в сети поставщика услуг размещения. Клиент подключается к сети поставщика услуг с помощью многопротокольного переключения меток (MPLS), где между граничным маршрутизатором поставщика услуг размещения и многоклиентским шлюзом устанавливается туннель GRE для виртуальной сети клиента.

![Туннель GRE, соединяющий клиентскую сеть и виртуальную сеть клиента MPLS Enterprise](../../media/gre-tunneling-in-windows-server/GRE-.png)

### <a name="integration-with-vlan-based-isolation"></a><a name="BKMK_Integration"></a>Интеграция с изоляцией на основе VLAN

Этот сценарий позволяет интегрировать изоляцию на основе виртуальной ЛС с виртуализацией сети Hyper-V. Физическая сеть в сети поставщика услуг размещения содержит балансировщик нагрузки, использующий изоляцию на основе виртуальной ЛС. Многоклиентский шлюз устанавливает туннели GRE между подсистемой балансировки нагрузки в физической сети и многоклиентским шлюзом в виртуальной сети.

Между источником и назначением можно установить несколько туннелей, а ключ GRE используется для различения туннелей.

![Несколько туннелей GRE, соединяющих виртуальные сети клиентов](../../media/gre-tunneling-in-windows-server/GRE-VLANIsolation.png)

### <a name="access-shared-resources"></a><a name="BKMK_Shared"></a>Доступ к общим ресурсам

Этот сценарий позволяет получить доступ к общим ресурсам в физической сети, расположенной в сети поставщика услуг размещения.

У вас может быть общая служба, расположенная на сервере в физической сети, расположенной в сети поставщика услуг размещения, к которой вы хотите предоставить общий доступ с несколькими виртуальными сетями клиента.

Клиентские сети с непересекающимися подсетями получают доступ к общей сети через туннель GRE. Один маршрут шлюза клиента между туннелями GRE, что приводит к маршрутизации пакетов в соответствующие клиентские сети.

В этом сценарии один шлюз клиента можно заменить аппаратными устройствами сторонних производителей.

![Шлюз с одним клиентом, использующий несколько туннелей для подключения нескольких виртуальных сетей;](../../media/gre-tunneling-in-windows-server/GRE-SharedResource.png)

### <a name="services-of-third-party-devices-to-tenants"></a><a name="BKMK_thirdparty"></a>Службы сторонних устройств для клиентов

Этот сценарий можно использовать для интеграции сторонних устройств (таких как аппаратные подсистемы балансировки нагрузки) в поток трафика виртуальной сети клиента. Например, трафик, исходящий от корпоративного сайта, проходит через туннель S2S с многоклиентским шлюзом. Трафик направляется в подсистему балансировки нагрузки через туннель GRE. Балансировщик нагрузки направляет трафик на несколько виртуальных машин в виртуальной сети предприятия. То же самое происходит для другого клиента с потенциально перекрывающимися IP-адресами в виртуальных сетях. Сетевой трафик изолируется подсистемой балансировки нагрузки с помощью виртуальных ЛС и применяется ко всем устройствам уровня 3, поддерживающим виртуальные ЛС.

![Несколько туннелей GRE, соединяющих виртуальные сети с устройствами сторонних производителей](../../media/gre-tunneling-in-windows-server/GREThirdParty.png)

## <a name="configuration-and-deployment"></a>Конфигурация и развертывание

Туннель GRE предоставляется в качестве дополнительного протокола в интерфейсе S2S. Он реализуется аналогично туннелю IPSec S2S, описанному в следующем блоге по сети: [VPN-шлюз типа "сеть-сеть" с несколькими клиентами (S2S) с Windows Server 2012 R2](https://techcommunity.microsoft.com/t5/networking-blog/bg-p/NetworkingBlog)

Пример развертывания шлюзов, включая туннельные шлюзы GRE, см. в следующем разделе:

[Развертывание инфраструктуры программно-конфигурируемой сети с помощью скриптов](../../../networking/sdn/deploy/Deploy-a-Software-Defined-Network-infrastructure-using-scripts.md)

## <a name="more-information"></a>Дополнительные сведения

Дополнительные сведения о развертывании шлюзов S2S см. в следующих разделах:

-   [Шлюз RAS-сервера](RAS-Gateway.md)

-   [Протокол BGP &#40;BGP&#41;](../bgp/Border-Gateway-Protocol-BGP.md)

-   [Новые функции! Рекомендации по развертыванию многоклиентского шлюза RAS в Windows Server 2012 R2](https://techcommunity.microsoft.com/t5/networking-blog/bg-p/NetworkingBlog)

-   [Развертывание протокол BGP (BGP) с помощью многоклиентского шлюза RAS](https://techcommunity.microsoft.com/t5/networking-blog/bg-p/NetworkingBlog)

