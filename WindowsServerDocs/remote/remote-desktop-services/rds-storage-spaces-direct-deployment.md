---
title: Развертывание двух узлов хранения пробелы прямой масштабируемого файлового сервера для хранилища UPD в Azure
description: Сведения об использовании дисковых пространств с помощью RDS.
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 1099f21d-5f07-475a-92dd-ad08bc155da1
author: haley-rowland
ms.author: harowl
ms.date: 07/17/2018
manager: scottman
ms.openlocfilehash: 8af3a389ec726bbb5ebd62db57d9b3a9861ac63f
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59890965"
---
# <a name="deploy-a-two-node-storage-spaces-direct-scale-out-file-server-for-upd-storage-in-azure"></a>Развертывание двух узлов дисковых пространств масштабируемого файлового сервера для хранилища UPD в Azure

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

Службы удаленных рабочих столов (RDS) требуется присоединенных к домену файловый сервер для дисков профилей пользователей (UPD). Для развертывания присоединенных к домену масштабируемого файлового сервера высокой доступности (SOFS) в Azure, используйте дисковые пространства с Windows Server 2016. Если вы не знакомы с диски UPD или служб удаленных рабочих столов, ознакомьтесь с [Добро пожаловать в службы удаленных рабочих столов](welcome-to-rds.md).

> [!NOTE] 
> Корпорация Майкрософт только что опубликовал [шаблон Azure для развертывания дисковых пространств масштабируемого файлового сервера](https://azure.microsoft.com/documentation/templates/301-storage-spaces-direct/)! Можно использовать шаблон для создания развертывания, или следуйте инструкциям в этой статье. 

Мы рекомендуем развертывать на масштабируемых файловых СЕРВЕРОВ с виртуальными машинами серии DS и дисках данных хранилища уровня "премиум", где же количество и размеры создаваемых дисков данных на каждой виртуальной Машине. Вам потребуется как минимум две учетные записи хранения. 

Для небольших развертываний мы рекомендуем двухузловой кластер с помощью облака-свидетеля, где зеркальное отображение тома с 2 копии. Развивайте небольших развертываниях, добавления дисков с данными. Увеличение объема более крупных развертываний путем добавления узлов (виртуальных машин). 

Эти инструкции предназначены для развертывания двух узлов. Ниже приведены размеры виртуальных Машин и дисков, вам потребуется для хранения диски UPD для числа пользователей в вашем бизнесе. 

| Пользователи | Всего (ГБ) | Виртуальная машина | # Дисков | Тип диска | Размер диска (ГБ) | Конфигурация   |
|-------|------------|----|---------|-----------|----------------|-----------------|
| 10    | 50         | DS1 | 2       | P10       | 128            | 2x(DS1 + 2 P10)  |
| 25    | 125        | DS1 | 2       | P10       | 128            | 2x(DS1 + 2 P10)  |
| 50    | 250        | DS1 | 2       | P10       | 128            | 2x(DS1 + 2 P10)  |
| 100   | 500        | DS1 | 2       | P20       | 512            | 2x(DS1 + 2 P20)  |
| 250   | 1250       | DS1 | 2       | P30       | 1024           | 2x(DS1 + 2 P30)  |
| 500   | 2500       | DS2 | 3       | P30       | 1024           | 2x(DS2 + 3 P30)  |
| 1000  | 5000       | DS3 | 5       | P30       | 1024           | 2 x (DS3 + 5 P30)  |
| 2500  | 12500      | DS4 | 13      | P30       | 1024           | 2 x (DS4 + 13 P30) |
| 5000  | 25000      | DS5 | 25      | P30       | 1024           | 2 x (DS5 + 25 P30) | 

Следуйте инструкциям ниже для создания контроллера домена (мы вызывали нашего «my-dc» ниже) и два узла виртуальных машин («my fsn1» и «Мои fsn2») и настройки виртуальных машин, чтобы быть 2 узлов хранения пробелы прямой масштабируемого файлового сервера.

1. Создание [подписки Microsoft Azure](https://azure.microsoft.com).
2. Войдите в [портала Azure](https://ms.portal.azure.com).
3. Создание [учетной записи хранения Azure](https://azure.microsoft.com/documentation/articles/storage-create-storage-account/#create-a-storage-account) в Azure Resource Manager. Создайте его в новую группу ресурсов и использовать следующие конфигурации:
   - Модель развертывания: Resource Manager
   - Тип учетной записи хранения: Общего назначения
   - Уровень производительности: "Премиум"
   - Параметр репликации: LRS
4. Установите лес Active Directory, с помощью шаблона быстрого запуска или развертывания леса вручную. 
   - Развертывание с помощью шаблона быстрого запуска Azure:
      - [Создание виртуальной Машины Azure с помощью нового леса AD](https://azure.microsoft.com/documentation/templates/active-directory-new-domain/)
      - [Создание нового домена AD с 2 контроллера домена](https://azure.microsoft.com/documentation/templates/active-directory-new-domain-ha-2-dc/) (для обеспечения высокой доступности)
   - Вручную [развертывание леса](https://azure.microsoft.com/documentation/articles/active-directory-new-forest-virtual-machine/) со следующими конфигурациями:
      - Создание виртуальной сети в той же группе ресурсов, что учетная запись хранения.
      - Рекомендуемый размер: DS2 (увеличение размера, если контроллер домена будет содержать дополнительные объекты домена)
      - Используйте автоматически созданную виртуальную сеть.
      - Выполните шаги по установке AD DS.
5. Настройка узлов кластера файловых серверов. Это можно сделать путем развертывания [Windows Server 2016 хранилище пробелы прямой кластера масштабируемых файловых СЕРВЕРОВ шаблона Azure](https://azure.microsoft.com/resources/templates/301-storage-spaces-direct/) или выполнив следующие шаги 6 – 11, чтобы развернуть вручную.
5. Чтобы вручную настроить узлов кластера файловых серверов:
   1. Создайте первый узел. 
      1. Создайте виртуальную машину из образа Windows Server 2016. (Щелкните **New > виртуальные машины > Windows Server 2016.** Выберите **Resource Manager**, а затем нажмите кнопку **создать**.)
      2. Настройте базовую конфигурацию следующим образом:
         - Имя: my-fsn1
         - Тип диска виртуальной Машины SSD
         - Используйте существующую группу ресурсов, созданного на шаге 3. 
      3. Размер: DS1, DS2, DS3, DS4 или DS5 в зависимости от пользователя требуется (см. таблицу в начале этих инструкций). Убедитесь, что выбрана поддержка дисков premium.
      4. Параметры: 
         - Учетная запись хранения: Выберите учетную запись хранения, созданную на шаге 3.
         - Высокая доступность — создать новую группу доступности. (Щелкните **высокий уровень доступности > создать**, а затем введите имя (например, s2d-cluster). Используйте значения по умолчанию для **домены обновления** и **домены сбоя**.)
   2. Создайте второй узел. Повторите шаг выше со следующими изменениями:
      - Имя: my-fsn2
      - Высокая доступность — выберите необходимую группу доступности, созданного ранее.  
6. [Подключить диски данных](https://azure.microsoft.com/documentation/articles/virtual-machines-windows-attach-disk-portal/) на узел кластера виртуальных машин в соответствии с вашей пользователя должна (как показано в таблице выше). После данных диски создаются и подключен к виртуальной Машине, задайте **кэширования узла** для **None**.
7. Настройка IP-адреса для всех виртуальных машин для **статических**. 
   1. В группе ресурсов, выберите виртуальную Машину, а затем нажмите кнопку **сетевые интерфейсы** (в разделе **параметры**). Выберите перечисленные сетевой интерфейс и нажмите кнопку **IP-конфигурации**. Выберите перечисленные IP-конфигурации, выберите **статический**, а затем нажмите кнопку **Сохранить**.
   2. Обратите внимание, домен контроллера my-для нашего примера частный IP-адрес (10.x.x.x).
8. Значение основной адрес DNS-сервера на сетевые интерфейсы виртуальных машин для узлов кластера сервера Мои контроллера домена. Выберите виртуальную Машину и нажмите кнопку **сетевых интерфейсов > DNS-серверы > пользовательская служба DNS**. Введите частный IP-адрес, указанный выше и нажмите кнопку **Сохранить**.
9. Создание [учетной записи хранения Azure, чтобы быть в облако-свидетель](https://docs.microsoft.com/windows-server/failover-clustering/deploy-cloud-witness). (Если вы используете соответствующих инструкциях, остановитесь, когда вы сможете «Настройка облака следящего сервера с отработки отказа кластера диспетчер графическим интерфейсом пользователя» — мы сделаем этот шаг ниже.)
10. Настройте дисковые пространства файлового сервера. Подключиться к узлу виртуальной Машины и запустите следующие командлеты Windows PowerShell.
   1. Установка компонента отказоустойчивости кластеров и компонент сервера файл на виртуальных машинах узла кластера сервера два файла:

      ```powershell
      $nodes = ("my-fsn1", "my-fsn2")
      icm $nodes {Install-WindowsFeature Failover-Clustering -IncludeAllSubFeature -IncludeManagementTools} 
      icm $nodes {Install-WindowsFeature FS-FileServer} 
      ```
   2. Проверка виртуальных машин узла кластера и создание двух узлов кластера масштабируемых файловых СЕРВЕРОВ:

      ```powershell
      Test-Cluster -node $nodes
      New-Cluster -Name MY-CL1 -Node $nodes –NoStorage –StaticAddress [new address within your addr space]
      ``` 
   3. Настройте облако-свидетель. Использование cloud следящий сервер хранилища учетной записи имени и ключа.

      ```powershell
      Set-ClusterQuorum –CloudWitness –AccountName <StorageAccountName> -AccessKey <StorageAccountAccessKey> 
      ```
   4. Включение локальных дисковых.

      ```powershell
      Enable-ClusterS2D 
      ```
      
   5. Создание тома виртуального диска.

      ```powershell
      New-Volume -StoragePoolFriendlyName S2D* -FriendlyName VDisk01 -FileSystem CSVFS_REFS -Size 120GB 
      ```
      Чтобы просмотреть сведения о общий том кластера в кластере масштабируемых файловых СЕРВЕРОВ, выполните следующий командлет:

      ```powershell
      Get-ClusterSharedVolume
      ```
   
   6. Создание масштабируемого файлового сервера (SOFS):

      ```powershell
      Add-ClusterScaleOutFileServerRole -Name my-sofs1 -Cluster MY-CL1
      ```

   7. Создайте новый файловый ресурс SMB в кластере масштабируемых файловых СЕРВЕРОВ.

      ```powershell
      New-Item -Path C:\ClusterStorage\Volume1\Data -ItemType Directory
      New-SmbShare -Name UpdStorage -Path C:\ClusterStorage\Volume1\Data
      ```

Теперь у вас есть общую папку в &#92;\my-sofs1\UpdStorage, который можно использовать для хранилища UPD при вы [включить UPD](https://social.technet.microsoft.com/wiki/contents/articles/15304.installing-and-configuring-user-profile-disks-upd-in-windows-server-2012.aspx) для пользователей. 
