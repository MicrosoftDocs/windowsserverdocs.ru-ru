---
title: Служба размещения рабочих столов
description: Описывает компоненты службы размещения рабочих столов.
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.author: helohr
ms.date: 07/06/2018
ms.tgt_pltfrm: na
ms.topic: article
author: heidilohr
manager: dougkim
ms.openlocfilehash: 597016ecf10da0febb7ba1bb099da0c1dddf96ce
ms.sourcegitcommit: 3743cf691a984e1d140a04d50924a3a0a19c3e5c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/17/2019
ms.locfileid: "63749221"
---
# <a name="desktop-hosting-service"></a>Служба размещения рабочих столов

>Относится к: Windows Server (Semi-Annual Channel), Windows Server 2019, Windows Server 2016

В этой статье подробно описаны компоненты службы размещения рабочих столов.

## <a name="tenant-environment"></a>Среда клиента

Как описано в разделе [Роли службы удаленного рабочего стола](rds-roles.md), каждая роль имеет особое значение в среде клиента.

Служба размещения рабочих столов поставщика реализована как набор изолированных сред клиентов. Каждая среда клиента состоит из контейнера хранилища, набора виртуальных машин и сочетания служб Azure, общающихся по изолированной виртуальной сети. Каждая виртуальная машина содержит компоненты, составляющие среду размещенных рабочих столов клиента. В следующих подразделах описываются компоненты, входящие в состав каждой среды рабочих столов клиента.

## <a name="active-directory-domain-services"></a>Доменные службы Active Directory

Доменные службы Active Directory (AD DS) предоставляют сведения о домене и лесе таким образом, чтобы пользователи клиента могли входить на рабочие столы и в приложения для выполнения своих рабочих нагрузок. Они также позволяют настроить или подключить необходимые общие папки и базы данных, которые могут потребоваться для приложений Windows.

Отношение доверия с лесом управления поставщика для леса клиента не требуется. Можно настроить учетную запись администратора домена в домене клиента, чтобы дать техническим специалистам поставщика возможность выполнения административных задач в среде клиента (например, мониторинга состояния системы и установки обновлений программного обеспечения) и помощи в устранении неполадок и настройке.

Существует несколько способов развертывания AD DS.

1. Включение доменных служб Azure Active Directory в виртуальной сетевой среде клиента. Это приведет к созданию управляемого экземпляра AD DS для клиента на основе пользователей и групп, которые существуют в Azure AD.
2. Настройка изолированного сервера AD DS в виртуальной сетевой среде клиента. Это обеспечивает полный контроль над экземпляром AD DS, работающим на виртуальных машинах.
3. Создание VPN-подключения "сеть — сеть" к серверу AD DS, расположенному в локальной среде клиента. Это позволяет клиенту подключить свой существующий экземпляр AD DS, устранив дублирование пользователей, групп, подразделений и т. д.

Дополнительные сведения доступны в следующих статьях.

* [Документация по доменным службам Active Directory](https://docs.microsoft.com/azure/active-directory-domain-services/)
* [Руководство по эталонной архитектуре размещения рабочих столов для Windows Server 2012 R2](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)
* [Создание подключения "сеть — сеть" на портале Azure](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-howto-site-to-site-resource-manager-portal)

## <a name="sql-database"></a>База данных SQL

База данных SQL высокой доступности используется посредником подключений к удаленному рабочему столу, чтобы хранить сведения о развертывании, такие как сопоставление текущих пользователей подключений с серверами узла.

Существует несколько способов развертывания базы данных SQL.

1. Создание базы данных SQL Azure в среде клиента. Это дает избыточную базу данных SQL без необходимости самостоятельно управлять серверами. Это также позволяет вам платить только за используемые ресурсы, не делая капитальных инвестиций в инфраструктуру.
2. Создание кластера SQL Server AlwaysOn. Это позволяет использовать существующую инфраструктуру SQL Server и дает полный контроль над экземплярами SQL Server.

Дополнительные сведения о настройке инфраструктуры высокой доступности для базы данных SQL см. в следующих статьях:

* [Что такое служба базы данных SQL Azure?](https://docs.microsoft.com/azure/sql-database/sql-database-technical-overview)
* [Создание и настройка групп доступности (SQL Server)](https://docs.microsoft.com/sql/database-engine/availability-groups/windows/creation-and-configuration-of-availability-groups-sql-server?view=sql-server-2017).
* [Добавление сервера посредника подключений к удаленному рабочему столу в развертывание и настройка высокого уровня доступности](rds-connection-broker-cluster.md)

## <a name="file-server"></a>Файловый сервер

Файловый сервер использует протокол Server Message Block (SMB) 3.0 для поддержки общих папок. Эти общие папки позволяют создать и сохранить файлы диска профиля пользователя (.vhdx) для резервного копирования данных и дают пользователям возможность обмениваться данными друг с другом в пределах клиента облачной службы.

Виртуальная машина, на которой развертывается файловый сервер, должен иметь подключенный диск данных Azure и настроенные общие папки. Диски данных Azure используют кэширование со сквозной записью, гарантируя, что операции записи на диск не удаляются при перезапуске виртуальной машины.

Маленькие клиенты могут снизить затраты путем объединения файлового сервера и [роли лицензирования удаленных рабочих столов](rds-roles.md#remote-desktop-licensing) на одной виртуальной машине в своей среде клиента.

Дополнительные сведения доступны в следующих статьях.

* [Хранилище в Windows Server](../../storage/storage.md)
* [Как подключить управляемый диск данных к виртуальной машине Windows на портале Azure](https://docs.microsoft.com/azure/virtual-machines/windows/attach-managed-disk-portal?toc=%2Fazure%2Fvirtual-machines%2Fwindows%2Fclassic%2Ftoc.json)

### <a name="user-profile-disks"></a>Диски профилей пользователей

Диски профилей пользователей позволяют пользователям сохранять личные настройки и файлы, если они входят в сеанс на одном сервере узла сеансов удаленных рабочих столов в коллекции, а затем обращаются к параметрам и файлам при входе на другой сервер [узла сеансов удаленных рабочих столов](rds-roles.md#remote-desktop-session-host) в той же коллекции. При первом входе пользователя файловый сервер клиента создает диск профиля пользователя, подключаемый к серверу узла сеансов удаленных рабочих столов, к которому в данный момент подключен пользователь. Для каждого последующего входа диск профиля пользователя подключается к соответствующему серверу узла сеансов удаленных рабочих столов; при выходе он отключается. Только пользователь может получить доступ к содержимому диска профиля.