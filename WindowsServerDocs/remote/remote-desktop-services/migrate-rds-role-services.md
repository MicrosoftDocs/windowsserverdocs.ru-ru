---
title: Перенос развертывания служб удаленных рабочих столов в Windows Server 2016
description: В этой статье описывается, как перенести развертывание служб удаленных рабочих столов (RDS) на новые сервера Windows Server 2016.
ms.prod: windows-server
ms.technology: remote-desktop-services
ms.author: chrimo
ms.date: 11/01/2016
ms.topic: article
ms.assetid: 9b1fa833-4325-48a8-bf34-46265f40c001
author: christianmontoya
manager: scottman
ms.openlocfilehash: 88806c7302474b111b700376c75b9b09f4da9236
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "80853007"
---
# <a name="migrate-your-remote-desktop-services-deployment-to-windows-server-2016"></a>Перенос развертывания служб удаленных рабочих столов в Windows Server 2016

Если в настоящее время вы запускаете службы удаленных рабочих столов в Windows Server 2012 R2, то вы можете перейти на Windows Server 2016, чтобы воспользоваться преимуществами новых функций, таких как поддержка SQL Azure и Локальные дисковые пространства.

Перенос развертывания служб удаленных рабочих столов поддерживается с исходных серверов Windows Server 2016 на целевые серверы под управлением Windows Server 2016. Другими словами, невозможно напрямую перенести службы удаленных рабочих столов из Windows Server 2012 R2 в Windows Server 2016. Вместо этого для большинства компонентов RDS сначала нужно выполнить обновление до Windows Server 2016, а затем перенести данные и лицензии. Единственными компонентами, переносимыми напрямую, являются служба веб-доступа к удаленному рабочему столу, шлюз удаленных рабочих столов и сервер лицензирования.

Дополнительные сведения о процессе обновления и требованиях см. в разделе [Обновление развертывания служб удаленных рабочих столов до Windows Server 2016](upgrade-to-rds-2016.md).

Ниже приведены инструкции по переносу развертывания служб удаленных рабочих столов:

- [Перенос серверов посредника подключений к удаленному рабочему столу](#migrate-rdconnection-broker-servers)

- [Перенос коллекций сеансов](#migrate-session-collections)

- [Перенос коллекций виртуальных рабочих столов](#migrate-virtual-desktop-collections)

- [Перенос серверов веб-доступа к удаленным рабочим столам](#migrate-rdweb-access-servers)

- [Перенос серверов шлюза удаленных рабочих столов](#migrate-rdgateway-servers)

- [Перенос серверов лицензирования удаленных рабочих столов](#migrate-rdgateway-servers)

- [Перенос сертификатов](#migrate-certificates)

## <a name="migrate-rdconnection-broker-servers"></a>Перенос серверов посредника подключений к удаленному рабочему столу

Это первый и самый важный шаг переноса: перенос посредников подключений к удаленному рабочему столу на целевые серверы под управлением Windows Server 2016.

> [!IMPORTANT]
> Чтобы обеспечить перенос, на исходных серверах посредника подключений к удаленному рабочему столу должна быть настроена высокая доступность. Дополнительные сведения см. в разделе [Развертывание кластера посредника подключений к удаленному рабочему столу](Deploy-a-Remote-Desktop-Connection-Broker-cluster.md).

1. Если у вас несколько серверов посредника подключений к удаленному рабочему столу с настройкой высокой надежности, удалите все такие серверы за исключением активного на данный момент.

2. [Обновите](upgrade-to-rds-2016.md) оставшийся сервер посредника подключений к удаленному рабочему столу до Windows Server 2016.

3. Добавьте серверы посредника подключений к удаленному рабочему столу Windows Server 2016 в высокодоступное развертывание.

> [!NOTE] 
> Смешанная конфигурация высокой доступности с Windows Server 2016 и Windows Server 2012 R2 не поддерживается для серверов посредника подключений к удаленному рабочему столу. Посредник подключений к удаленному рабочему столу под управлением Windows Server 2016 может обслуживать коллекции сеансов с серверами узла сеансов удаленных рабочих столов под управлением Windows Server 2012 R2, а также коллекции виртуальных рабочих столов с серверами узла виртуализации удаленных рабочих столов под управлением Windows Server 2012 R2.

## <a name="migrate-session-collections"></a>Перенос коллекций сеансов

Чтобы перенести коллекцию сеансов из Windows Server 2012 R2 в Windows Server 2016, выполните следующие действия.

> [!IMPORTANT]
> Переносите коллекции сеансов только после успешного завершения предыдущего шага: [Перенос серверов посредника подключений к удаленному рабочему столу](#migrate-rdconnection-broker-servers).

1. [Обновите коллекцию сеансов](Upgrade-to-RDSH-2016.md) с Windows Server 2012 R2 до Windows Server 2016.

2. Добавьте новый сервер узла сеансов удаленных рабочих столов под управлением Windows Server 2016 в коллекцию сеансов.

3. Выйдите из всех сеансов на серверах узла сеансов удаленных рабочих столов, и удалите серверы, требующие миграции, из коллекции сеансов.

   > [!NOTE]
   > Если в коллекцию сеансов включен шаблон UVHD (UVHD-template.vhdx), а файловый сервер перенесен на новый сервер, обновите свойство коллекции "User Profile Disks: Location", указав новый путь. В новом расположении диски профилей пользователей должны быть доступны по тому же относительному пути, что и на исходном сервере.
   >
   > Коллекция сеансов с серверами узла сеансов удаленных рабочих столов, работающими под управлением Windows Server 2012 R2 и Windows Server 2016, не поддерживается.

## <a name="migrate-virtual-desktop-collections"></a>Перенос коллекций виртуальных рабочих столов

Чтобы перенести коллекцию виртуальных рабочих столов с исходного сервера под управлением Windows Server 2012 R2 на целевой сервер под управлением Windows Server 2016, выполните следующие действия.

> [!IMPORTANT]
> Переносите коллекции виртуальных рабочих столов только после успешного завершения предыдущего шага: [Перенос коллекций виртуальных рабочих столов](#migrate-rdconnection-broker-servers).

1. [Обновите коллекцию виртуальных рабочих столов](Upgrade-to-RDVH-2016.md) с сервера под управлением Windows Server 2012 R2 до Windows Server 2016.

2. Добавьте новые серверы узла виртуализации удаленных рабочих столов под управлением Windows Server 2016 в коллекцию сеансов.

3. Перенесите на новые серверы все виртуальные машины в текущей коллекции виртуальных рабочих столов, которые работают на серверах узла виртуализации удаленных рабочих столов.

4. Удалите все серверы узла виртуализации удаленных рабочих столов, требующие миграции, из коллекции виртуальных рабочих столов исходного сервера.

> [!NOTE]
> Если в коллекцию сеансов включен шаблон UVHD (UVHD-template.vhdx), а файловый сервер перенесен на новый сервер, обновите свойство коллекции "User Profile Disks: Location", указав новый путь. В новом расположении диски профилей пользователей должны быть доступны по тому же относительному пути, что и на исходном сервере.
>
> Коллекция виртуальных рабочих столов с серверами узла сеансов удаленных рабочих столов, работающими под управлением Windows Server 2012 R2 и Windows Server 2016, не поддерживается.

## <a name="migrate-rdweb-access-servers"></a>Перенос серверов веб-доступа к удаленным рабочим столам

Выполните следующие действия, чтобы перенести серверы веб-доступа к удаленным рабочим столам.

- Присоедините целевые серверы под управлением Windows Server 2016 к развертыванию служб удаленных рабочих столов и установите роль веб-доступа к удаленным рабочим столам.

- Используйте [средство веб-развертывания IIS](https://www.iis.net/) для переноса параметров веб-сайта веб-доступа к удаленным рабочим столам с текущих серверов веб-доступа к удаленным рабочим столам на целевые серверы под управлением Windows Server 2016.

- [Перенесите сертификаты](#migrate-certificates) на целевые серверы под управлением Windows Server 2016.

- Удалите исходные серверы из развертывания служб удаленных рабочих столов.

## <a name="migrate-rdgateway-servers"></a>Перенос серверов шлюза удаленных рабочих столов

Выполните следующие действия, чтобы перенести серверы шлюза удаленных рабочих столов.

- Присоедините целевые серверы под управлением Windows Server 2016 к развертыванию служб удаленных рабочих столов и установите роль шлюза удаленных рабочих столов.

- Используйте [средство веб-развертывания IIS](https://www.iis.net/) для переноса параметров конечной точки шлюза удаленных рабочих столов с текущих серверов шлюза удаленных рабочих столов на целевые серверы под управлением Windows Server 2016.

- [Перенесите сертификаты](#migrate-certificates) на целевые серверы под управлением Windows Server 2016.

- Удалите исходные серверы из развертывания служб удаленных рабочих столов.

## <a name="migrate-rdlicensing-servers"></a>Перенос серверов лицензирования удаленных рабочих столов

Выполните следующие действия, чтобы перенести сервер лицензирования удаленных рабочих столов с исходного сервера под управлением Windows Server 2012 или Windows Server 2012 R2 на целевой сервер под управлением Windows Server 2016.

1. [Перенесите клиентские лицензии служб удаленных рабочих столов](migrate-rds-cals.md) с исходного на целевой сервер.

2. Измените **свойства развертывания** в **диспетчере серверов** на сервере управления удаленными рабочими столами (который обычно запускается на первом сервере посредника подключений к удаленному рабочему столу), чтобы добавить только новый сервер лицензирования удаленных рабочих столов под управлением Windows Server 2016.

3. Отключите исходный сервер лицензирования удаленных рабочих столов. В **диспетчере лицензирования удаленных рабочих столов** щелкните соответствующий сервер правой кнопкой мыши, наведите указатель мыши на пункт **Дополнительно** и выберите **Деактивировать сервер**. После этого следуйте указаниям мастера.

4. Удалите исходные серверы лицензирования удаленных рабочих столов из развертывания в **диспетчере серверов** на сервере управления удаленными рабочими столами.

## <a name="migrate-certificates"></a>Перенос сертификатов

Чтобы успешно перенести сертификаты, требуется перенести сертификаты и обновить сведения о сертификатах в свойствах развертывания служб удаленных рабочих столов.

Обычно перенос сертификатов включает в себя следующие шаги:

- экспорт сертификата в PFX-файл с закрытым ключом;

- импорт сертификата из PFX-файла.

После переноса соответствующих сертификатов обновите приведенные ниже обязательные сертификаты для развертывания служб удаленных рабочих столов в диспетчере серверов или PowerShell:

- RD Connection Broker - single sign-on;

- RD Connection Broker - RDP file publishing;

- RD Gateway - HTTPS connection;

- RD Web Access - HTTPS connection and RemoteApp/desktop connection subscription.
