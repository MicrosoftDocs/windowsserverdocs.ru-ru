---
title: Клиенты не могут подключиться и получают сообщение об ошибке "Нет доступных лицензий"
description: Узнайте, как устранить ошибку "Нет доступных лицензий" при подключении к удаленному рабочему столу.
ms.reviewer: rklemen
ms.topic: troubleshooting
author: kaushika-msft
manager: dcscontentpm
ms.author: delhan
ms.date: 07/24/2019
ms.localizationpriority: medium
ms.openlocfilehash: f163908277b2ab8cc0e3bfbcbc4ae5e8001a2b4a
ms.sourcegitcommit: 3a3d62f938322849f81ee9ec01186b3e7ab90fe0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/23/2020
ms.locfileid: "80857177"
---
# <a name="clients-cant-connect-and-see-no-licenses-available-error"></a>Клиенты не могут подключиться и получают сообщение об ошибке "Нет доступных лицензий"

Такая ситуация наблюдается в развертываниях, в которых задействован сервер RDSH и сервер лицензирования удаленных рабочих столов.

Сначала определите, какое поведение видят пользователи:

- Сеанс был отключен из-за отсутствия лицензий или сервера лицензирования.
- Доступ запрещен из-за ошибки безопасности.

Войдите на узел сеансов удаленных рабочих столов как администратор домена и откройте средство диагностики лицензирования удаленных рабочих столов. Найдите следующие сообщения:

  - Льготный период для сервера узла сеансов Удаленных рабочих столов истек, но на этом сервере не были настроены серверы лицензирования. Подключение к этому серверу будет невозможно, пока для него не будет настроен сервер лицензирования.
  - Сервер лицензирования \<имя_компьютера\> недоступен. Это может быть вызвано проблемами в сети, остановкой службы лицензирования удаленных рабочих столов на сервере лицензирования или недоступностью этих служб.

Как правило, эти проблемы связаны со следующими сообщениями для пользователя:

  - Удаленный сеанс отключен, так как для этого компьютера отсутствуют клиентские лицензии удаленного рабочего стола.
  - Удаленный сеанс отключен, так как отсутствуют доступные серверы лицензирования удаленных рабочих столов, которые могли бы обеспечить лицензирование.

В таком случае [настройте службу лицензирования удаленных рабочих столов](#configure-the-rd-licensing-service).

Если в средстве диагностики лицензий удаленных рабочих столов перечислены другие проблемы, например "Компонент X.224 RDP-протокола обнаружил ошибку в потоке протокола и отключил этот клиент", вероятно, возникла проблема, которая влияет на сертификаты лицензий. Как правило, такие проблемы связаны со следующими сообщениями для пользователя:

Из-за ошибки безопасности клиент не смог подключиться к серверу терминалов. Убедитесь, что вы вошли в сеть, и повторите попытку подключения к серверу.

В этом случае [обновите разделы реестра для сертификата X509](#refresh-the-x509-certificate-registry-keys).

## <a name="configure-the-rd-licensing-service"></a>Настройка службы лицензирования удаленных рабочих столов

В следующей процедуре используется диспетчер серверов для изменения конфигурации. См. подробнее о том, как [настроить и использовать диспетчер серверов](../../../administration/server-manager/server-manager.md).

1. Откройте **диспетчер серверов** и перейдите в раздел **Службы удаленных рабочих столов**.
2. На вкладке **Обзор развертывания** выберите **Задачи**, а затем выберите **Изменить свойства развертывания**.
3. Выберите **Лицензирование удаленных рабочих столов** и подходящий режим лицензирования для развертывания (**На устройство** или **На пользователя**).
4. Укажите полное доменное имя (FQDN) сервера лицензирования удаленных рабочих столов, а затем выберите **Добавить**.
5. Если у вас несколько серверов лицензирования удаленных рабочих столов, повторите шаг 4 для каждого сервера. 
    ![Параметры конфигурации сервера лицензирования удаленных рабочих столов в диспетчере серверов.](../media/troubleshoot-remote-desktop-connections/RDLicensing_Configure.png)

## <a name="refresh-the-x509-certificate-registry-keys"></a>Обновление разделов реестра для сертификата X509

> [!IMPORTANT]  
> В точности следуйте инструкциям из этого раздела. Неправильное изменение реестра может вызвать серьезные проблемы. Прежде чем редактировать реестр, [создайте резервную копию реестра](https://support.microsoft.com/help/322756), чтобы вы могли восстановить его в случае ошибки.

Чтобы устранить эту проблему, создайте резервные копии для разделов реестра сертификата X509 и удалите эти разделы, а затем перезагрузите компьютер и повторно активируйте сервер лицензирования удаленных рабочих столов. Выполните следующие действия.

> [!NOTE]
> Выполните следующую процедуру на каждом сервере RDSH.

Чтобы повторно активировать сервер лицензирования удаленных рабочих столов:

1. Откройте редактор реестра и перейдите к разделу **HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\RCM**.
2. В меню "Реестр" выберите команду **Экспорт файла реестра**.
3. Введите **exported- Certificate** в поле **Имя файла** и нажмите **Сохранить**.
4. Правой кнопкой мыши щелкните каждое из следующих значений, выберите **Удалить**, а затем нажмите кнопку **Да** для подтверждения удаления.  
      - **Сертификат**
      - **Сертификат X509**
      - **Идентификатор сертификата X509**
      - **X509 Certificate2**
5. Закройте редактор реестра и перезапустите сервер RDSH.