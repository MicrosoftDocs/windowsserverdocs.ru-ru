---
title: При подключении пользователь получает сообщение "Служба удаленных рабочих столов сейчас занята"
description: Узнайте, как устранить ошибку "Служба удаленных рабочих столов сейчас занята" при подключении к удаленному рабочему столу.
audience: itpro
ms.custom: na
ms.reviewer: rklemen
ms.suite: na
ms.tgt_pltfrm: na
ms.topic: troubleshooting
ms.assetid: ''
author: kaushika-msft
manager: dcscontentpm
ms.author: delhan
ms.date: 07/24/2019
ms.localizationpriority: medium
ms.openlocfilehash: 989591f1d312446b680d708b2be7bea9b26ab8f9
ms.sourcegitcommit: c5709021aa98abd075d7a8f912d4fd2263db8803
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/18/2020
ms.locfileid: "76265886"
---
# <a name="on-connecting-user-receives-remote-desktop-service-is-currently-busy-message"></a>При подключении пользователь получает сообщение "Служба удаленных рабочих столов сейчас занята"

Чтобы определить соответствующее решение этой проблемы, выполните следующие действия:

- Перестает ли служба удаленных рабочих столов отвечать на запросы (например, клиент удаленного рабочего стола зависает на экране приветствия)?  
   - Если служба перестает отвечать, см. раздел [Проблемы с памятью на сервере RDSH](#rdsh-server-memory-issue).
   - Если клиент взаимодействует со службой без проблем, перейдите к следующему шагу.
- Могут ли пользователи отключиться от сеансов удаленного рабочего стола и снова подключиться к ним?  
   - Если служба по-прежнему отклоняет подключения независимо от того, сколько пользователей отключили сеансы, см. раздел [Проблема с прослушивателем удаленных рабочих столов](#rd-listener-issue).
   - Если служба принимает подключения только после того, как несколько пользователей отключили сеансы, [проверьте политику ограничения числа подключений](#check-the-connection-limit-policy).

## <a name="rdsh-server-memory-issue"></a>Проблемы с памятью на сервере RDSH

На некоторых серверах RDSH с Windows Server 2012 R2 обнаружена утечка памяти. Со временем эти серверы начинают отклонять подключения к удаленному рабочему столу и входы в локальную консоль с отображением таких сообщений:

> Не удается завершить требуемую операцию, так как службы удаленных рабочих столов сейчас заняты. Повторите попытку через несколько минут. Другие пользователи должны по-прежнему иметь возможность входа.

При попытке подключения клиенты удаленного рабочего стола также перестают отвечать на запросы.

Чтобы устранить эту проблему, перезапустите сервер RDSH.

Чтобы устранить эту проблему, установите обновление KB 4093114 ([10 апреля 2018 г. — KB4093114 (ежемесячный накопительный пакет)](https://support.microsoft.com/help/4093114/)) на серверах RDSH.

## <a name="rd-listener-issue"></a>Проблема с прослушивателем удаленных рабочих столов

Проблема обнаружена на тех же серверах RDSH, которые были обновлены с Windows Server 2008 R2 непосредственно до Windows Server 2012 R2 или Windows Server 2016. Когда клиент удаленного рабочего стола подключается к серверу RDSH, этот сервер создает прослушиватель удаленных рабочих столов для сеанса пользователя. На затронутых серверах ведется подсчет числа прослушивателей к удаленному рабочему столу, которое увеличивается по мере подключения пользователей, но никогда не уменьшается.

Вы можете решить эту проблему с помощью следующих методов:

  - Перезапустите сервер RDSH, чтобы сбросить счетчик прослушивателей удаленного рабочего стола.
  - Измените политику ограничения числа подключений, задав очень большое значение. Дополнительные сведения об управлении политикой ограничения числа подключения см. в разделе [Проверка политики ограничения числа подключений](#check-the-connection-limit-policy).

Чтобы устранить эту проблему, установите следующие обновления на серверы RDSH:

  - Windows Server 2012 R2: [30 августа 2018 г. — KB4343891 (ознакомительная версия ежемесячного накопительного пакета)](https://support.microsoft.com/help/4343891/windows-81-update-kb4343891);
  - Windows Server 2016: [30 августа 2018 г. — KB4343884 (сборка ОС 14393.2457)](https://support.microsoft.com/help/4343884/windows-10-update-kb4343884).

## <a name="check-the-connection-limit-policy"></a>Проверка политики ограничения числа подключений

Вы можете задать ограничение на число одновременных подключений к удаленному рабочему столу на уровне отдельного компьютера или путем настройки объекта групповой политики. По умолчанию ограничение не задано.

Чтобы проверить текущие параметры и определить существующие объекты групповой политики на сервере RDSH, откройте окно командной строки как администратор и введите следующую команду:
  
```cmd
gpresult /H c:\gpresult.html
```
   
Когда команда будет выполнена, откройте файл **gpresult.html**. Выберите **Конфигурация компьютера\\Административные шаблоны\\Компоненты Windows\\Службы удаленных рабочих столов\\Узел сеансов удаленных рабочих столов\\Подключения** и найдите политику **Ограничить количество подключений**.

  - Если для параметра этой политики задано значение **Отключено**, групповая политика не ограничивает подключения по протоколу RDP.
  - Если же для параметра этой политики задано значение **Включено**, проверьте **результирующий объект групповой политики**. Если нужно удалить или изменить ограничение числа подключений, измените этот объект групповой политики.

Чтобы применить изменения политики, откройте окно командной строки на соответствующем компьютере и введите следующую команду:
  
```cmd
gpupdate /force
```
  
