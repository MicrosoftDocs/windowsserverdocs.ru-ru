---
title: Создание виртуальных машин для удаленного рабочего стола
description: Создайте виртуальные машины для размещения компонентов удаленного рабочего стола в облаке.
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.author: elizapo
ms.date: 08/01/2016
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: b0f62d6f-0915-44ca-afef-be44a922e20e
author: lizap
manager: dongill
ms.openlocfilehash: 5c61d9f08cb799d6a63a004bedab924a6ba37fdc
ms.sourcegitcommit: eaf071249b6eb6b1a758b38579a2d87710abfb54
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/31/2019
ms.locfileid: "66446736"
---
# <a name="create-virtual-machines-for-remote-desktop"></a>Создание виртуальных машин для удаленного рабочего стола

>Относится к: Windows Server (полугодовой канал), Windows Server 2019 г., Windows Server 2016

Следуйте инструкциям ниже, чтобы создать виртуальные машины в среде клиента, который будет использоваться для выполнения роли Windows Server 2016, служб и компонентов, необходимых для развертывания по размещению рабочих столов.   
  
В этом примере базового развертывания создается минимальное из трех виртуальных машин. Одна виртуальная машина будет размещаться служб ролей посредника подключений удаленных рабочих столов (RD) и сервер лицензий и общей папки для развертывания. Второй виртуальной машины будут размещаться службы роли шлюза удаленных рабочих Столов и веб-доступа.  Третьей виртуальной машине размещаются служба роли узла сеансов удаленных рабочих Столов. Для очень небольших развертываниях можно сократить расходы виртуальной Машины с помощью прокси приложения AAD, чтобы исключить все общедоступные конечные точки из развертывания и сочетая все службы ролей на одной виртуальной Машины. Для более крупных развертываний различных служб ролей можно установить на отдельных виртуальных машин, чтобы разрешить лучше масштабирования.  
  
В этом разделе описаны действия, необходимые для развертывания виртуальных машин для каждой роли, на основе образов Windows Server в [Microsoft Azure Marketplace](https://azure.microsoft.com/marketplace/). Если вам нужно создать виртуальные машины из пользовательского образа, которая требует PowerShell, см. статью [Создание виртуальной Машины Windows с помощью Resource Manager и PowerShell](https://azure.microsoft.com/documentation/articles/virtual-machines-windows-ps-create/). Затем вернитесь сюда, чтобы подключить диски данных Azure для общей папки и введите внешний URL-адрес для развертывания.  
  
1. [Создание виртуальных машин Windows](https://azure.microsoft.com/documentation/articles/virtual-machines-windows-hero-tutorial/) для размещения сервера посредника подключений к удаленному рабочему Столу, сервер лицензирования удаленных рабочих Столов и файл.  
  
   Для наших целей мы использовали следующие соглашения об именовании:  
   - Посредник подключений к удаленному рабочему Столу, сервер лицензирования и файлового сервера:   
       - ВИРТУАЛЬНАЯ МАШИНА: Contoso-Cb1  
       - Группа доступности: CbAvSet    
   - Веб-доступа к удаленным рабочим Столам и шлюза удаленных рабочих Столов:   
       - ВИРТУАЛЬНАЯ МАШИНА: Contoso-WebGw1  
       - Группа доступности: WebGwAvSet  
          
   - Узел сеансов удаленных рабочих Столов:   
       - ВИРТУАЛЬНАЯ МАШИНА: Contoso-Sh1  
       - Группа доступности: ShAvSet  
          
   Каждая виртуальная машина использует ту же группу ресурсов.  
2. Создать и подключить диск данных Azure для ресурса для диска (UPD) профиля пользователя:  
   1.  На портале Azure откройте **Обзор > группы ресурсов**, щелкните группу ресурсов для развертывания и нажмите кнопку виртуальной Машины, созданной для посредника подключений к удаленному рабочему Столу (например, Contoso-Cb1).  
   2.  Нажмите кнопку **параметры > диски > подключить новый**.  
   3.  Примите значения по умолчанию для имени и типа.  
   4.  Введите размер (в ГБ), достаточное для хранения общих сетевых ресурсов для среды клиента, включая диски профилей пользователей и сертификаты. Его можно реализовать приблизительно 5 ГБ на пользователя, который вы планируете использовать  
   5.  Примите значения по умолчанию для расположения и кэширование узла и нажмите кнопку **ОК**.  
3. Создайте внешний балансировщик нагрузки доступ к развертыванию извне:
   1. На портале Azure откройте **Обзор > подсистемы балансировки нагрузки**, а затем нажмите кнопку **добавить**.
   2. Введите **имя**выберите **открытый** как **тип** подсистемы балансировки нагрузки и выберите соответствующую **подписки**,  **Группа ресурсов**, и **расположение**.
   3. Выберите **выберите общедоступный IP-адрес**, **создать**, введите имя и выберите **ОК**.
   4. Выберите **создать** для создания подсистемы балансировки нагрузки.
4. Настройте подсистему балансировки нагрузки для развертывания
   1. На портале Azure откройте **Обзор > группы ресурсов**, щелкните группу ресурсов для развертывания и нажмите кнопку подсистемы балансировки нагрузки, созданную для развертывания.
   2. Добавьте серверный пул для балансировщика нагрузки для отправки трафика:
       1. Выберите **серверного пула** и **добавить**.
       2. Введите **имя** и выберите  **\+ добавить виртуальную машину**.
       3. Выберите **доступности** и **WebGwAvSet**.
       4. Выберите **виртуальных машин**, **Contoso WebGw1**, **выберите**, **ОК**, и **ОК**.
   3. Добавьте пробу, поэтому подсистемы балансировки нагрузки известно, какие машины активны:
       1. Выберите **пробы** и **добавить**.
       2. Введите **имя** (например, HTTPS), выберите **TCP**, введите **порт** 443 и выберите **ОК**.
   4. Введите правила для балансировки входящего трафика балансировки нагрузки:
      1. Выберите **правила балансировки нагрузки** и **добавить**
      2. Введите **имя** (например, HTTPS), выберите **TCP**и порт 443 для обоих **порт** и **внутренний порт**.
          - Для Windows 10 и развертывание Windows Server 2016, оставьте **Сохранение сеанса** как **None**, в противном случае выберите **IP-адрес клиента**.
      3. Выберите **ОК** принимать правило HTTPS.
      4. Создать новое правило, выбрав **добавить**.
      5. Введите **имя** (например, UDP), выберите **UDP**и 3391 для обоих <strong>порт и ** внутренний порт</strong>.
          - Для развертывания Windows 10 и Windows Server 2016, оставить **Сохранение сеанса** как **None**, в противном случае выберите **IP-адрес клиента**.
      6. Выберите **ОК** принимать правило UDP.
   5. Введите правило входящего трафика NAT для прямого подключения к Contoso WebGw1
       1. Выберите **правила NAT для входящего Трафика** и **добавить**.
       2. Введите **имя** (например, RDP-Contoso-WebGw1), выберите **Customm** для службы, **TCP** для протокола и введите 14000 для **порт**.
       3. Выберите **выберите виртуальную машину** и Contoso WebGw1.
       4. Выберите **Custom** для сопоставления портов, введите 3389 для **целевой порт**и выберите **ОК**.
5. Введите внешний URL-адрес или DNS-имя для развертывания на внешний доступ к ней:  
   1.  На портале Azure щелкните **Обзор > группы ресурсов**, щелкните группу ресурсов для развертывания и выберите общедоступный IP-адрес, созданный для веб-доступа к удаленным рабочим Столам и шлюза удаленных рабочих Столов.  
   2.  Нажмите кнопку **конфигурации**, введите метку DNS-имени (например, contoso) и нажмите кнопку **Сохранить**. Эта метка имени DNS (contoso.westus.cloudapp.azure.com) — это DNS-имя, которое будет использоваться для подключения к серверу веб-доступа к удаленным рабочим Столам и шлюза удаленных рабочих Столов.  

