---
title: Добавление высокого уровня доступности веб-интерфейс веб-удаленных рабочих Столов и шлюза
description: Пошаговые инструкции по установке веб-удаленных рабочих Столов и шлюза серверы в развертывании служб удаленных рабочих СТОЛОВ.
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: remote-desktop-services
ms.tgt_pltfrm: na
ms.topic: article
author: lizap
ms.author: elizapo
ms.date: 11/08/2016
manager: dongill
ms.openlocfilehash: fa09532e0b327b24ebb1c0e155c26c25d1043b63
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59854605"
---
# <a name="add-high-availability-to-the-rd-web-and-gateway-web-front"></a>Добавление высокого уровня доступности веб-интерфейс веб-удаленных рабочих Столов и шлюза

>Область применения. Windows Server (полугодовой канал), Windows Server 2016


Вы можете развернуть Web Access удаленных рабочих столов (RD Web Access) и фермы шлюза удаленных рабочих столов (шлюз RD), для повышения доступности и объема развертывания Windows Server Remote Desktop Services (RDS) 

Добавление веб-удаленных рабочих Столов и шлюз сервера к существующему развертыванию основных служб удаленных рабочих столов, выполните следующие действия.  

## <a name="pre-requisites"></a>Предварительные требования

Настройка сервера в качестве дополнительный Web удаленных рабочих Столов и шлюза удаленных рабочих Столов — это может быть физический сервер или виртуальную Машину. Сюда входит присоединение сервера к домену и включение удаленного управления.

## <a name="step-1-configure-the-new-server-to-be-part-of-the-rds-environment"></a>Шаг 1. Настройка нового сервера как часть среды служб удаленных рабочих СТОЛОВ

1. Подключитесь к серверу СУРБД на портале Azure, с помощью клиента удаленного рабочего стола.
2. Добавьте новый сервер веб-удаленных рабочих Столов и шлюз в диспетчер серверов:
    1. Запустите диспетчер сервера, щелкните **Управление > Добавление серверов**.   
    2. В диалоговом окне "Добавление серверов", нажмите кнопку **найти**.   
    3. Выберите только что созданный сервер, веб-удаленных рабочих Столов и шлюза (например, Contoso-WebGw2) и нажмите кнопку **ОК**.
3. Добавить веб-удаленных рабочих Столов и шлюза серверы в развертывание  
    1. Запустите диспетчер сервера.  
    2. Нажмите кнопку **служб удаленных рабочих столов > Обзор > серверов развертывания > задачи > Добавить серверы веб-доступа к удаленному рабочему Столу**.   
    3. Выберите только что созданный сервер (например, Contoso-WebGw2) и нажмите кнопку **Далее**.  
    4. На странице подтверждения выберите **перезагрузки удаленных компьютеров, при необходимости**, а затем нажмите кнопку **добавить**.  
    5. Повторите эти шаги, чтобы добавить сервер шлюза удаленных рабочих Столов, но выберите **серверы шлюза удаленных рабочих Столов** на шаге b.
4. Повторно установите сертификаты для серверов шлюза удаленных рабочих Столов:
    1.  В диспетчере серверов на сервере СУРБД, щелкнуть **служб удаленных рабочих столов > Обзор > задачи > изменить свойства развертывания**.  
    2.  Разверните **сертификаты**.  
    3.  Прокрутите вниз до таблицы. Нажмите кнопку к удаленному рабочему Столу **службы роли шлюза > выберите существующий сертификат.**  
    4.  Нажмите кнопку **выбрать другой сертификат** и затем найти нужный сертификат. Например, \Contoso-CB1\Certificates). Выберите файл сертификата для сервера веб-удаленных рабочих Столов и шлюз, созданный во время предварительные требования (например ContosoRdGwCert) и нажмите кнопку **откройте**.  
    5.  Введите пароль для сертификата, выберите **разрешить сертификат для добавления в хранилище сертификатов доверенных корневых центров сертификации на конечных компьютерах**, а затем нажмите кнопку **ОК**.  
    6.  Щелкните **Применить**.
    > [!Note] 
    > Необходимо вручную перезапустить службу TSGateway, выполняемых на каждом сервере шлюза удаленных рабочих Столов, либо через диспетчер серверов или диспетчере задач.
    7.  Повторите шаги от до f доступа роли к удаленному рабочему Столу веб-службы.

## <a name="step-2-configure-rd-web-and-rd-gateway-properties-on-the-new-server"></a>Шаг 2. Настройка свойств веб-удаленных рабочих Столов и шлюза удаленных рабочих Столов на новом сервере
1. Настройте сервер должен входить в ферму шлюза удаленных рабочих Столов.
    1.  В диспетчере серверов на сервере СУРБД, щелкнуть **все серверы**. Щелкните правой кнопкой мыши один из серверов шлюза удаленных рабочих Столов, а затем нажмите кнопку **подключение удаленного рабочего стола**.
    2.  Войдите на сервер шлюза удаленных рабочих Столов, используя учетную запись администратора домена.  
    3.  В диспетчере серверов на сервере шлюза удаленных рабочих Столов, нажмите кнопку **средства > служб удаленных рабочих столов > Диспетчер шлюза удаленных рабочих Столов**.  
    4.  В области навигации выберите локальный компьютер (например, Contoso-WebGw1).  
    5.  Нажмите кнопку **члены добавить фермы серверов шлюза удаленных рабочих Столов**.  
    6.  На **фермы серверов** , введите имя каждого сервера шлюза удаленных рабочих Столов, а затем нажмите кнопку **добавить** и **применить**.  
    7.  Повторите шаги от до f на каждом сервере шлюза удаленных рабочих Столов таким образом, чтобы они узнают друг друга как серверы шлюза удаленных рабочих Столов в ферме. Не волнуйтесь, при наличии предупреждений, так как может потребоваться время для параметров DNS для распространения.
2. Настройте сервер должен входить в ферму веб-доступа к удаленным рабочим Столам. Проверки и расшифровки машинных ключей должны совпадать на обоих сайтах RDWeb, настройте указанные ниже действия.
    1.  В диспетчере серверов на сервере СУРБД, щелкнуть **все серверы**. Щелкните правой кнопкой мыши первый сервер RD Web Access (например, Contoso-WebGw1) и нажмите кнопку **подключение удаленного рабочего стола**.  
    2.  Войдите на сервер RD Web Access, используя учетную запись администратора домена.  
    3.  В диспетчере серверов на сервере веб-доступа к удаленному рабочему Столу, нажмите кнопку **Сервис > Диспетчер Internet Information Services (IIS)**.  
    4.  В левой области диспетчера служб IIS разверните узел **сервера (например, Contoso-WebGw1) > сайты > веб-сайт по умолчанию**, а затем нажмите кнопку **RDWeb**.  
    5.  Щелкните правой кнопкой мыши **ключ компьютера**, а затем нажмите кнопку **открыть компонент**.
    6.  На странице "ключ компьютера" в **действия** области выберите **Generate Keys**, а затем нажмите кнопку **применить**.
    7.  Скопируйте ключ проверки (можно щелкните ключ правой кнопкой мыши и выберите команду **копирования**.)
    8.  В диспетчере служб IIS в разделе **Default Web Site**выберите **веб-канала**, **FeedLogon** и **страниц** в свою очередь.
    9. Для каждого:
        1.  Щелкните правой кнопкой мыши **ключ компьютера**, а затем нажмите кнопку **открыть компонент**.
        2.  Ключ проверки, снимите **автоматически формировать во время выполнения**, а затем вставьте ключ, скопированный на шаге g.
    10.  Сверните окно подключения к удаленному рабочему Столу для этого к удаленному рабочему Столу веб-сервера.  
    11.  Повторяйте шаги b – e для второго сервера веб-доступа к удаленным рабочим Столам, заканчивая в представлении функций из **ключ компьютера**.
    12. Ключ проверки, снимите **автоматически формировать во время выполнения**, а затем вставьте ключ, скопированный на шаге g.
    13. Щелкните **Применить**.
    14. Завершить этот процесс для **RDWeb**, **веб-канала**, **FeedLogon** и **страниц** страниц.
    15. Свернуть окно подключения к удаленному рабочему Столу на второй сервер RD Web Access, а затем разверните окно подключения к удаленному рабочему Столу для первого сервера веб-доступа к удаленным рабочим Столам.  
    16. Повторите шаги g до n, чтобы скопировать ключ расшифровки.
    17. После проверки и расшифровки ключей идентичны на обоих серверах RD Web Access для **RDWeb**, **веб-канала**, **FeedLogon** и **страниц**страниц, выйдите из всех подключений к удаленному рабочему Столу windows.

## <a name="step-3-configure-load-balancing-for-the-rd-web-and-rd-gateway-servers"></a>Шаг 3. Настройка балансировки нагрузки для серверов веб-удаленных рабочих Столов и шлюза удаленных рабочих Столов

Если вы используете инфраструктуру Azure, можно создать внешние Azure load balancer; в противном случае можно настроить отдельные программного или аппаратного балансировщика нагрузки. Балансировка нагрузки — ключ, так что трафик будет равномерно распределенных долгоживущих соединения от клиентов удаленного рабочего стола через шлюз удаленных рабочих Столов, к серверам, что пользователи будут выполняться свои рабочие нагрузки.

> [!Note] 
> Если предыдущий сервер под управлением веб-удаленных рабочих Столов и шлюза удаленных рабочих Столов уже было задано за пределами подсистемы балансировки нагрузки, перейти к шагу шаг 4, выберите существующий пул серверной части и добавьте новый сервер в пул.

1.  Создание подсистемы балансировки нагрузки Azure:  
    1.  На портале Azure откройте **Обзор > подсистемы балансировки нагрузки > Добавить**.  
    2.  Введите имя, например **WebGwLB**.  
    3.  Выберите **открытый** для **схемы**, **общедоступный IP-адрес**и **общедоступный IP-адрес**. Можно выбрать существующий общедоступный IP-адрес или создайте новую. 
    4.  Выберите соответствующий **подписки**, **группы ресурсов**, и **расположение**.
    5.  Нажмите кнопку **Создать**.  
2. Создание [пробы](https://azure.microsoft.com/documentation/articles/load-balancer-custom-probe-overview/) к монитору, какие серверы являются проверки активности:  
    1.  На портале Azure откройте **Обзор > подсистемы балансировки нагрузки**., подсистемы балансировки нагрузки вы только что создали, например WebGwLB и параметры  
    2.  Нажмите кнопку **пробы > Добавить**.  
    3.  Введите имя, например, **HTTPS**, для проверки. Выберите **TCP** как **протокола**и введите **443** для **порт**, затем нажмите кнопку **ОК**.   
3.  Создание правил балансировки нагрузки HTTPS и UDP:  
    1.  В **параметры**, нажмите кнопку **правила балансировки нагрузки**.  
    2.  Выберите **добавить** для **правило HTPPS**.  
    3.  Введите имя для правила, например, HTTPS и выберите **TCP** для **протокола**. Введите **443** для обоих **порт** и **внутренний порт**и нажмите кнопку **ОК**.  
    4.  В **правила балансировки нагрузки**, нажмите кнопку **добавить** для **правило UDP**.  
    5.  Например, введите имя для правила, **UDP**и выберите **UDP** для **протокола**. Введите **3391** для обоих **порт** и **внутренний порт**и нажмите кнопку **ОК**.  
4. Создайте внутренний пул для серверов веб-удаленных рабочих Столов и шлюза удаленных рабочих Столов:
      1. В **параметры**, нажмите кнопку **внутренние пулы адресов > Добавить**.   
      2. Введите имя (например, **WebGwBackendPool**), затем нажмите кнопку **добавить виртуальную машину**.  
      3. Выберите группу доступности (например, WebGwAvSet), а затем нажмите кнопку **ОК**.   
      4. Нажмите кнопку **выберите виртуальные машины**, выберите все виртуальные машины и нажмите кнопку **выберите > ОК > ОК**.
