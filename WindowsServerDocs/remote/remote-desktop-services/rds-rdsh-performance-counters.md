---
title: Используйте счетчики производительности для диагностики проблем отклик приложения на узлах сеанса удаленного рабочего стола
description: Ваше приложение запущено медленно служб удаленных рабочих СТОЛОВ? Сведения о счетчиках производительности, которые можно использовать для диагностики проблем производительности приложения на сервере RDSH
ms.prod: windows-server-threshold
ms.technology: remote-desktop-services
ms.author: elizapo
ms.date: 09/19/2018
ms.tgt_pltfrm: na
ms.topic: article
author: lizap
manager: dougkim
ms.localizationpriority: medium
ms.openlocfilehash: 241b2b776a68cf5aec68a4d331201a07f0e5ea53
ms.sourcegitcommit: e84e328c13a701e8039b16a4824a6e58a6e59b0b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/22/2018
ms.locfileid: "4133720"
---
# Используйте счетчики производительности для диагностики проблем производительности приложения на узлах сеанса удаленного рабочего стола

Одной из наиболее сложных проблем для диагностики является ухудшению производительности приложения — приложений работает медленно или не отвечает. Традиционно запустите вашего диагностики, собирает ЦП, памяти, диска ввода вывода и другие параметры и затем воспользоваться таких средств, как Windows Performance Analyzer нужно определить, что причиной проблемы. К сожалению в большинстве случаев эти данные не поможет вам определить причину, поскольку счетчики потребления ресурсов часто и больших варианты. Это становится трудно читать данные и сопоставить его с известной проблемой. Чтобы облегчить вам быстро устранить проблемы производительности вашего приложения, мы добавили некоторые новые счетчики производительности (доступны [для скачивания](#download-windows-server-insider-software) в рамках [Программы предварительной оценки Windows](https://insider.windows.com)), измерения потоков ввода пользователя.

Счетчик задержка ввода пользователя поможет вам быстро определить причину для неправильных конечного пользователя звено протокола удаленного рабочего СТОЛА. Этот счетчик измеряет, как долго любого пользовательского ввода (например, использование клавиатуры или мыши) остается в очереди перед применена процессом, и счетчик работает в локальные и удаленные сеансы.

На следующем рисунке показано представление грубый поток ввода пользователя от клиента для приложения.

![Удаленный рабочий стол - ввода действий пользователя с клиентом удаленного рабочего стола пользователей в приложение](.\media\rds-user-input.png)

Задержка ввода пользователя счетчик измеряет max разницу (в пределах интервал времени) между входные данные в очередь и когда применена приложением в [цикл традиционных сообщений](https://msdn.microsoft.com/library/windows/desktop/ms644927.aspx#loop), как показано на следующей диаграмме потока:

![Удаленный рабочий стол - ввод задержки потока счетчиков производительности](.\media\rds-user-input-delay.png)

Один важные компонентом этого счетчика является, что он сообщает, что задержка ввода максимальное пользователя в настраиваемой интервале. Это продолжительное время, необходимое для входных данных к приложению, которое может повлиять на скорость важные и видимым таких операций, как ввод с клавиатуры.

Например в таблице ниже задержку ввода пользователя будет выступать в качестве 1000 ms в этом интервале. Счетчик сообщает медленного пользователя ввода задержки в течение интервала, так как «медленно» восприятие пользователя определяется низкую ввода времени (максимум) они сталкиваются, не среднюю скорость всех общее входных данных.

|Число| 0 | 1 | 2 |
|------|---|---|---|
|Задержка |16 ms| 20 мс| 1000 ms|

## Включение и использование новые счетчики производительности

Чтобы использовать эти новые счетчики производительности, сначала необходимо включить раздел реестра, выполнив следующую команду:

```
reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v "EnableLagCounter" /t REG_DWORD /d 0x1 /f
```

>[!NOTE]
> Если вы используете Windows 10, версии 1809 или более поздней версии либо Windows Server 2019 или более поздней версии, вам не потребуется включить в разделе реестра.

Затем перезапустите сервер. Затем откройте системный монитор и выберите плюс (+), как показано на следующем снимке экрана.

![Счетчик производительности задержка ввода удаленного рабочего стола - снимок экрана, показывающий, как добавить пользователя](.\media\rds-add-user-input-counter-screen.png)

После этого вы должны увидеть добавить счетчики диалоговое окно, где можно выбрать **Задержки ввода пользователя на процесс** или **Задержка ввода пользователя для сеанса**.

![Удаленный рабочий стол - снимок экрана, показывающий, как добавить задержку ввода пользователя для сеанса](.\media\rds-user-delay-per-session.png)

![Удаленный рабочий стол - снимок экрана, показывающий, как добавить задержку ввода пользователя на процесс](.\media\rds-user-delay-per-process.png)

При выборе **Задержка ввода пользователя на процесс**, вы увидите **экземпляры выбранного объекта** (другими словами, процессы) в ```SessionID:ProcessID <Process Image>``` формат.

Например, если приложение "Калькулятор" работает в [сеансе Идентификатором 1](https://msdn.microsoft.com/library/ms524326.aspx), вы увидите ```1:4232 <Calculator.exe>```.

> [!NOTE]
> Не все процессы будут включены. Вы не увидите все процессы, которые выполняются в качестве системы.

Счетчик начинается отчетов задержка ввода пользователя сразу же после его добавить. Обратите внимание, что максимальный масштаб имеет значение 100 (мс) по умолчанию. 

![Удаленный рабочий стол - пример действие для задержки ввода пользователя на процесс системный монитор](.\media\rds-sample-user-input-delay-perfmon.png)

Далее рассмотрим **Задержка ввода пользователя для сеанса**. Существует экземпляров для каждого идентификатора сеанса и счетчиками отображения задержку ввода пользователя любого процесса в пределах указанного сеанса. Кроме того существует два экземпляра под названием «Max» (максимальное пользователя ввода задержку между сеансами все) и «Средняя» (среднее acorss всех сеансов).

В этой таблице показаны наглядный пример этих экземпляров. (Вы можете получить те же сведения в системного монитора, переключившись на графе типа отчета.)

|Тип счетчика|Имя экземпляра|Переданные задержка (мс)|
|---------------|-------------|-------------------|
|Задержка ввода пользователя на процесс|1:4232 < Calculator.exe >|  200|
|Задержка ввода пользователя на процесс|2:1000 < Calculator.exe >|  16|
|Задержка ввода пользователя на процесс|1:2000 < Calculator.exe >|  32|
|Задержка ввода пользователя для сеанса|1|    200|
|Задержка ввода пользователя для сеанса|2|    16|
|Задержка ввода пользователя для сеанса|Средняя|  108|
|Задержка ввода пользователя для сеанса|Максимальный срок хранения|  200|

## Счетчики, используемые в систему перегруженные

Теперь давайте рассмотрим, что вы увидите в отчете Если снижается производительность приложения. На следующем графике показано показания для пользователей, работающих удаленно, в Microsoft Word. В этом случае как больше пользователей, войдите в систему, со временем ухудшение производительности сервера RDSH.

![Удаленный рабочий стол - граф примере производительности для сервера RDSH под управлением Microsoft Word](.\media\rds-user-input-perf-graph.png)

Ниже приведен порядок чтения графа строки:

- Розовая линия показано число сеансов, который выполнил вход на сервер.
- Красная линия является ЦП.
- Зеленая линия, задержка ввода максимальное пользователя на всех сеансов.
- Синяя строка (отображается черным; в этом графике) представляет средний пользователь задержка ввода всех сеансах.

Вы заметите, что существует взаимосвязь между пиков ЦП и задержку ввода пользователя — по мере ЦП Подробнее об использовании, пользовательского ввода задержка увеличивается. Кроме того как добавления других пользователей в систему, ЦП получает ближе к 100%, ведет к более частые пиков задержка ввода пользователя. Хотя этот счетчик очень полезна в случаях, где выполняется сервер ресурсы, вы также можно использовать для отслеживания задержка ввода пользователя, относящиеся к конкретному приложению.

## Параметры конфигурации

Важно помнить при использовании этого счетчика производительности —, что он сообщает задержка ввода пользователя на интервалом в 1000 ms по умолчанию. Если свойство производительности счетчика пример интервал (как показано на следующем снимке экрана) к чему разные, переданное значение будет неверно.

![Удаленный рабочий стол - свойства для монитора производительности](.\media\rds-user-input-perfmon-properties.png)

Чтобы устранить эту проблему, можно задать следующий раздел реестра в соответствии с интервал (в миллисекундах), которое вы хотите использовать. Например если необходимо изменить пример каждые x секунд 5 секунд, требуется установить этот ключ 5000 мс.

```
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server]

"LagCounterInterval"=dword:00005000
```

>[!NOTE]
>Если вы используете Windows 10, версии 1809 или более поздней версии либо Windows Server 2019 или более поздней версии, не нужно задавать LagCounterInterval устранения счетчик производительности.

Мы также добавили несколько клавиш, которые могут быть полезны в тот же раздел реестра:

**LagCounterImageNameFirst** — значение этого ключа `DWORD 1` (значение по умолчанию 0 или ключ не существует). Это изменения имена счетчиков «Изображение имя < SessionID:ProcessId >». Например «explorer < 1:7964 >.» Это полезно, если требуется отсортировать по имени изображения.

**LagCounterShowUnknown** — значение этого ключа `DWORD 1` (значение по умолчанию 0 или ключ не существует). Это показывает все процессы, которые выполняются в качестве службы или системы. Некоторые процессы будет отображаться с свой сеанс, задать в качестве «?.»

Это, как оно выглядит при включении сочетания клавиш:

![Удаленный рабочий стол - системный монитор с помощью сочетания клавиш на](.\media\rds-user-input-delay-with-two-counters.png)

## Используя новые счетчики с помощью инструментов сторонних разработчиков

Средства наблюдения за может потреблять этот счетчик с помощью [API системного монитора](https://msdn.microsoft.com/library/windows/desktop/aa371903.aspx).

## Загрузить программное обеспечение предварительной оценки Windows Server

Зарегистрированные участники программы можно перейти непосредственно к [странице загрузки предварительной оценки Windows Server](https://www.microsoft.com/en-us/software-download/windowsinsiderpreviewserver) для получения последних обновлений программного обеспечения для предварительной оценки.  Узнайте, как зарегистрировать как участник программы предварительной оценки, см. в разделе [Приступая к работе с сервером](https://insider.windows.com/en-us/for-business-getting-started-server/).

## Поделитесь своим мнением

Вы можете отправить отзыв для этой функции через Центр отзывов. Выберите **приложений > все остальные приложения** и включить «счетчики производительности служб удаленных рабочих СТОЛОВ — системный монитор» в поле название вашей post.

Общие функции сведения посетите [страницу UserVoice служб удаленных рабочих СТОЛОВ](https://aka.ms/uservoice-rds).
