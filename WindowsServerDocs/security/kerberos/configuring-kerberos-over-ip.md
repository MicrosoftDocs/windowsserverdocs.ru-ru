---
title: Настройка Kerberos для IP-адреса
description: Поддержка Kerberos для имен участников-служб на основе IP
author: daveba
ms.author: daveba
ms.date: 07/27/2020
ms.topic: article
ms.openlocfilehash: d7203711e1d1eb42c7e9b06fe2b8a4cc66e7d74b
ms.sourcegitcommit: 40905b1f9d68f1b7d821e05cab2d35e9b425e38d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/06/2021
ms.locfileid: "97949720"
---
# <a name="kerberos-clients-allow-ipv4-and-ipv6-address-hostnames-in-service-principal-names-spns"></a>Клиенты Kerberos разрешают адреса узлов IPv4 и IPv6 в именах субъектов-служб (SPN).

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

Начиная с Windows 10 версии 1507 и Windows Server 2016, клиенты Kerberos можно настроить для поддержки имен узлов IPv4 и IPv6 в именах участников-служб.

По умолчанию Windows не будет пытаться выполнить проверку подлинности Kerberos для узла, если имя узла является IP-адресом. Она будет возвращаться к другим включенным протоколам проверки подлинности, таким как NTLM. Однако иногда приложения жестко используют IP-адреса, что означает, что приложение будет возвращаться к NTLM, а не использовать Kerberos. Это может вызвать проблемы совместимости, так как среда переходит в отключенную среду NTLM.

Чтобы снизить влияние отключения NTLM, была введена новая возможность, которая позволяет администраторам использовать IP-адреса в качестве имен узлов в именах участников-служб. Эта возможность включена на клиенте с помощью значения раздела реестра.

```cmd
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System\Kerberos\Parameters" /v TryIPSPN /t REG_DWORD /d 1 /f
```

Чтобы настроить поддержку имен узлов в именах участников-служб, создайте запись Трипспн. Эта запись не существует в реестре по умолчанию. После создания записи измените значение DWORD на 1. Это значение реестра необходимо установить на каждом клиентском компьютере, которому требуется доступ к ресурсам, защищенным с помощью Kerberos, по IP-адресу.

## <a name="configuring-a-service-principal-name-as-ip-address"></a>Настройка имени субъекта-службы в качестве адреса IP

Имя субъекта-службы — это уникальный идентификатор, используемый при проверке подлинности Kerberos для идентификации службы в сети. SPN состоит из службы, имени узла и, при необходимости, порта в виде, `service/hostname[:port]` например `host/fs.contoso.com` . Windows будет регистрировать несколько имен участников-служб в объекте компьютера при присоединении компьютера к Active Directory.

IP-адреса обычно не используются вместо имен узлов, так как IP-адреса часто являются временными. Это может привести к конфликтам и ошибкам проверки подлинности в случае истечения срока действия аренды адресов и продления сроков. Поэтому регистрация SPN на основе IP-адреса выполняется вручную и должна использоваться, только если невозможно переключиться на имя узла на основе DNS.

Рекомендуемый подход заключается в использовании средства [Setspn.exe](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/cc731241(v=ws.11)) . Обратите внимание, что имя участника-службы может быть зарегистрировано только в одной учетной записи в Active Directory за раз, поэтому при использовании DHCP рекомендуется использовать статические аренды для IP адресов.

```
Setspn -s <service>/ip.address> <domain-user-account>
```

Пример

```
Setspn -s host/192.168.1.1 server01
```
