---
title: Kerberos Constrained Delegation Overview
description: Безопасность Windows Server
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-kerberos
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 51923b0a-0c1a-47b2-93a0-d36f8e295589
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: d77dd6f6f310ae71a4d9e2d52b44cc9b1bef6401
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59821935"
---
# <a name="kerberos-constrained-delegation-overview"></a>Kerberos Constrained Delegation Overview

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

В этой обзорной статье для ИТ-специалистов описываются новые возможности ограниченного делегирования Kerberos в Windows Server 2012 R2 и Windows Server 2012.

**Описание компонента**

Ограниченное делегирование Kerberos было впервые представлено в Windows Server 2003 как более безопасное делегирование, которое может использоваться службами. При настройке ограниченного делегирования происходит ограничение количества служб, к которым может обращаться указанный сервер от имени пользователя. При этом для настройки учетной записи домена для службы требуются привилегии администратора домена, а количество доменов для учетной записи ограничивается одним. На современных предприятиях интерфейсные службы не предназначены для ограничиваться интеграции только службами своего домена.

В более ранних версиях операционных систем, в которых настройки службы осуществлялись администратором домена, администратор служб не имел возможности узнать, какие службы интерфейса делегировали проверку подлинности имеющимся службам ресурсов. В результате все службы интерфейса, которые могли делегировать проверку подлинности службе ресурсов, находились под угрозой атаки. Если сервер, на котором размещалась служба интерфейса и настройки которого позволяли делегировать проверку подлинности службам ресурсов, был скомпрометирован, службы ресурсов также могли быть скомпрометированы.

В Windows Server 2012 R2 и Windows Server 2012 возможность настройки ограниченного делегирования для служб была передана от администратора домена к администратору служб. Таким образом, администратор внутренних служб может разрешать или запрещать службы интерфейса.

Подробные сведения об ограниченном делегировании, представленном в Windows Server 2003, см. в разделе [Передача протокола и ограниченное делегирование Kerberos](https://technet.microsoft.com/library/cc739587(v=ws.10)).

Реализации протокола Kerberos в Windows Server 2012 R2 и Windows Server 2012 включает расширения, специально предназначенные для ограниченного делегирования.  Расширение Service for User to Proxy (S4U2Proxy) позволяет службе использовать билет службы Kerberos, благодаря которому пользователь получает билет службы из центра распространения ключей (KDC) для внутренней службы. Эти расширения позволяют ограниченное делегирование может быть настроено для учетной записи службы серверной части, который может быть в другом домене. Дополнительные сведения об этих расширениях см. в разделе [ \[MS-SFU\]: Расширения протокола Kerberos: S4u и спецификация протокола ограниченного делегирования](https://msdn.microsoft.com/library/cc246071(PROT.13).aspx) в библиотеке MSDN.

**Практическое применение**

Ограниченное делегирование позволяет администраторам служб указывать и обеспечивать границы доверия приложений с помощью ограничения области, в которой службы приложения могут действовать от имени пользователя. Администраторы служб могут указывать в настройках учетные записи служб интерфейса, которые будут делегированы во внутренние службы.

Путем поддержки ограниченного делегирования в доменах в Windows Server 2012 R2 и Windows Server 2012, интерфейсные службы, такие как Microsoft Internet Security and Acceleration (ISA) Server, Microsoft Forefront Threat Management Gateway, Microsoft Exchange Outlook Web Access (OWA) и Microsoft SharePoint Server можно настроить для использования ограниченного делегирования для проверки подлинности серверов в других доменах. Это обеспечивает поддержку передачи запросов между доменами с помощью существующей инфраструктуры Kerberos. Ограниченным делегированием Kerberos могут управлять администраторы домена или администраторы служб.

## <a name="resource-based-constrained-delegation-across-domains"></a>Основанное на ресурсах ограниченное делегирование в доменах

Ограниченное делегирование Kerberos можно использовать для предоставления ограниченного делегирования, когда служба интерфейса и службы ресурсов находятся в одном домене. Администраторы служб могут настроить новое делегирование, указав в домене учетные записи служб интерфейса, которые будут выполнять олицетворение пользователей в объектах учетных записей служб ресурсов.

**Какой эффект дает это изменение?**

С помощью поддержки ограниченного делегирования в доменах можно, вместо неограниченного делегирования, настроить службы на использование ограниченного делегирования для проверки подлинности при обращении к серверам в других доменах. Это обеспечивает поддержку проверки подлинности для передачи запросов между доменами с помощью существующей инфраструктуры Kerberos. При этом не возникает необходимости доверять службам интерфейса делегирование другим службам.

Это также сдвигает представлена ли сервер должен из надежного источника делегированные удостоверения от администратора домена делегирование из владельцу ресурса.

**Что работает иначе?**

Изменение базового протокола позволяет осуществлять делегирование между доменами. Реализации протокола Kerberos в Windows Server 2012 R2 и Windows Server 2012 включает расширения службу для пользователя, для протокола Proxy (S4U2Proxy). Данный набор расширений для протокола Kerberos позволяет службе использовать билет службы Kerberos, благодаря которому пользователь получает билет службы из центра распространения ключей (KDC) для внутренней службы.

Сведения о реализации этих расширений, см. в разделе [ \[MS-SFU\]: Расширения протокола Kerberos: S4u и спецификация протокола ограниченного делегирования](https://msdn.microsoft.com/library/cc246071(PROT.10).aspx) в библиотеке MSDN.

Дополнительные сведения об основной последовательности сообщений для делегирования Kerberos с помощью пересланного билета предоставления билета (TGT) по сравнению с службы для расширения User (S4U) см. раздел [1.3.3 Обзор протокола](https://msdn.microsoft.com/library/cc246080(v=prot.10).aspx) в [MS-SFU]: Расширения протокола Kerberos: S4U и спецификация протокола ограниченного делегирования».

**Вопросы безопасности во время основанное на ресурсах ограниченного делегирования**

Основанное на ресурсах ограниченное делегирование управления помещает делегирования в руках администратора владельцем ресурса к которому выполняется доступ. Это зависит от атрибутов службу ресурсов, а не службы, становится доверенным для делегирования. Таким образом основанное на ресурсах ограниченное делегирование нельзя использовать надежные к-проверки подлинности — для делегирования бит, который ранее управляемый переход протокола. Центр распространения КЛЮЧЕЙ всегда позволяет смены протокола, при выполнении основанное на ресурсах ограниченного делегирования, как если бы были значение бита.

Так, как центр распространения КЛЮЧЕЙ не ограничивает смены протокола, нужно присвоить данный элемент управления администратор ресурсов были введены две новые хорошо известные идентификаторы безопасности.  Эти идентификаторы безопасности понять смены протокола произошла и может использоваться со стандартным доступом управления списками предоставить или ограничить доступ, при необходимости.

|SID|Описание|
|-------|--------|
|AUTHENTICATION_AUTHORITY_ASSERTED_IDENTITY<br />S-1-18-1|Идентификатор безопасности, это значит, что удостоверение клиента подается по центру проверки подлинности, в зависимости от проверка принадлежности учетных данных клиента.|
|SERVICE_ASSERTED_IDENTITY<br />S-1-18-2|Идентификатор безопасности, это значит, что удостоверение клиента подается службой.|

В серверную службу можно использовать стандартные выражения ACL для определения того, как пользователь прошел проверку.

**Настройка основанное на ресурсах ограниченное делегирование**

Чтобы настроить службу ресурсов для предоставления доступа к службе интерфейса от имени пользователя, используйте командлеты Windows PowerShell.

-   Чтобы получить список субъектов, используйте **Get-ADComputer**, **Get-ADServiceAccount**, и **Get-ADUser** командлетов с **свойства PrincipalsAllowedToDelegateToAccount** параметра.

-   Чтобы настроить службу ресурсов, используйте **New-ADComputer**, **New-ADServiceAccount**, **New-ADUser**, **Set-ADComputer**,  **SET-ADServiceAccount**, и **Set-ADUser** командлетов с **PrincipalsAllowedToDelegateToAccount** параметра.

## <a name="BKMK_SOFT"></a>Требования к программному обеспечению
Основанное на ресурсах ограниченное делегирование можно настроить только на контроллере домена под управлением Windows Server 2012 R2 и Windows Server 2012, но может применяться внутри леса смешанного режима.

Необходимо установить следующее исправление ко всем контроллерам домена под управлением Windows Server 2012 в пользовательских доменах учетных записей на пути ссылок между доменами интерфейсной и серверной части, работающих под управлением операционных систем более ранних, чем Windows Server:  Основанное на ресурсах сбой ограниченного делегирования KDC_ERR_POLICY в средах, имеющих контроллеры домена под управлением Windows Server 2008 R2.
