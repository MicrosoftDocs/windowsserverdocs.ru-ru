---
title: Архитектура интерфейса поставщика поддержки безопасности
description: Безопасность Windows Server
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: de09e099-5711-48f8-adbd-e7b8093a0336
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 8b0a74089c5d8a88a380f8a56e3b9e03b84081c1
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59827025"
---
# <a name="security-support-provider-interface-architecture"></a>Архитектура интерфейса поставщика поддержки безопасности

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

В этом справочном разделе для ИТ-специалистов описываются протоколы проверки подлинности Windows, которые используются в архитектуре интерфейса поставщика поддержки безопасности (SSPI).

Microsoft Security поддержки интерфейса (SSPI) является основой для проверки подлинности Windows. Приложения и службы инфраструктуры, требующих проверки подлинности позволяет повысить его SSPI.

SSPI — это реализация из универсального безопасности службы API (GSSAPI) в операционных системах Windows Server. Дополнительные сведения о GSSAPI см. в RFC 2743 и 2744 RFC в базе данных RFC IETF.

По умолчанию поставщиков поддержки безопасности (SSP), которые вызывают конкретных протоколов проверки подлинности в Windows включены в SSPI в виде библиотек DLL. В следующих разделах описываются эти SSP по умолчанию. Могут быть включены дополнительные SSP, если они могут работать с SSPI.

Как показано на следующем рисунке, SSPI в Windows предоставляет механизм, который переносится существующий канал связи между клиентским компьютером и сервером проверки подлинности маркеров. При двух компьютеров или устройств нужно пройти проверку подлинности для безопасного взаимодействия, запросы проверки подлинности направляются в SSPI, который завершает процесс проверки подлинности независимо от сетевого протокола в текущий момент. SSPI возвращает прозрачный больших двоичных объектов. Они передаются между приложениями, после чего они могут передаваться на уровне SSPI. Таким образом SSPI позволяет приложению использовать различные модели безопасности, доступные на компьютере или в сети без изменения интерфейса системы безопасности.

![Схема, показывающая архитектура интерфейса поставщика поддержки безопасности](../media/security-support-provider-interface-architecture/AuthN_SecuritySupportProviderInterfaceArchitecture.jpg)

В следующих разделах описаны SSP по умолчанию, которые взаимодействуют с SSPI. SSP используются по-разному в операционных системах Windows для обеспечения безопасного обмена данными в небезопасными сетевой среде.

-   [Поставщик поддержки безопасности Kerberos](#BKMK_KerbSSP)

-   [Поставщик поддержки безопасности NTLM](#BKMK_NTLMSSP)

-   [Поставщик поддержки безопасности хэш-кода](#BKMK_DigestSSP)

-   [Поставщик поддержки безопасности Schannel](#BKMK_SchannelSSP)

-   [Поставщик поддержки безопасности Negotiate](#BKMK_NegoSSP)

-   [Поставщик поддержки безопасности учетных данных](#BKMK_CredSSP)

-   [Согласование поставщика поддержки безопасности расширений](#BKMK_NegoExtsSSP)

-   [Поставщик поддержки безопасности PKU2U](#BKMK_PKU2USSP)

Также включены в этом разделе:

[Выбор поставщика поддержки безопасности](security-support-provider-interface-architecture.md#BKMK_SecuritySupportProviderSelection)

### <a name="BKMK_KerbSSP"></a>Поставщик поддержки безопасности Kerberos
Портал Самообслуживания использует только протокол Kerberos версии 5, согласно реализации корпорацией Майкрософт. Этот протокол основан на версии черновик и RFC 4120 сетевой работы группы. Это стандартный протокол, который используется с помощью пароля или смарт-карты для интерактивного входа. Это также способ проверки подлинности для служб в Windows.

Так как протокол Kerberos протокола проверки подлинности по умолчанию времен Windows 2000, все службы домена поддерживают Kerberos поставщиком. Доступны следующие службы:

-   Active Directory запросы, использующие Lightweight Directory Access протокола (LDAP)

-   Удаленное управление сервера или рабочей станции, который использует служба удаленного вызова процедур

-   Службы печати

-   Проверка подлинности между клиентом и сервером

-   Удаленный доступ к файлам, использующий протокол Server Message Block (SMB) (также называется Common Internet File System или CIFS)

-   Управление распределенной файловой системой и ссылок

-   Проверка подлинности интрасети в Internet Information Services (IIS)

-   Проверка подлинности центра безопасности для Internet Protocol security (IPsec)

-   Запросы на сертификаты со службами сертификатов Active Directory для пользователей и компьютеров домена

Location: %windir%\Windows\System32\kerberos.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале этого раздела, а также, Windows Server 2003 и Windows XP.

**Дополнительные ресурсы для протокола Kerberos и Kerberos SSP**

-   [Microsoft Kerberos (Windows)](https://msdn.microsoft.com/library/aa378747(VS.85).aspx)

-   [\[MS-KILE\]: Расширения протокола Kerberos](https://msdn.microsoft.com/library/cc233855(PROT.10).aspx)

-   [\[MS-SFU\]: Расширения протокола Kerberos: S4u и спецификация протокола ограниченного делегирования](https://msdn.microsoft.com/library/cc246071(PROT.13).aspx)

-   [Kerberos SSP/AP (Windows)](https://msdn.microsoft.com/library/aa377942(VS.85).aspx)

-   [Расширения Kerberos](https://technet.microsoft.com/library/cc749438(v=ws.10).aspx) для Windows Vista

-   [Изменения в проверке подлинности Kerberos](https://technet.microsoft.com/library/dd560670(v=ws.10).aspx) для Windows 7 

-   [Технический справочник для проверки подлинности Kerberos](https://technet.microsoft.com/library/cc739058(v=ws.10).aspx)

### <a name="BKMK_NTLMSSP"></a>Поставщик поддержки безопасности NTLM
Поставщик поддержки безопасности NTLM (NTLM SSP) представляет собой двоичный файл обмен сообщениями протокола, используемого с интерфейса поставщика поддержки безопасности (SSPI) для обеспечения проверки подлинности NTLM запрос ответ и согласования параметров целостности и конфиденциальности. Везде, где используется проверка подлинности SSPI, в том числе для проверки подлинности протокол SMB или CIFS, проверка подлинности HTTP Negotiate (например, Web проверки подлинности через Интернет) и служба удаленного вызова процедур, используется NTLM. NTLM SSP включает в себя NTLM и NTLM версии 2 (NTLMv2) протоколы проверки подлинности.

Поддерживаемые операционные системы Windows можно использовать NTLM SSP для следующих элементов:

-   Проверка подлинности клиента и сервера

-   Службы печати

-   Доступ к файлам по протоколу CIFS (SMB)

-   Служба удаленного вызова процедур или службы DCOM

Location: %windir%\Windows\System32\msv1_0.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале этого раздела, а также, Windows Server 2003 и Windows XP.

**Дополнительные ресурсы для протокола NTLM и NTLM SSP**

-   [Пакет проверки подлинности Msv1_0 (Windows)](https://msdn.microsoft.com/library/aa378753(VS.85).aspx)

-   [Изменения в проверке подлинности NTLM](https://technet.microsoft.com/library/dd566199(v=ws.10).aspx) в Windows 7 

-   [Microsoft NTLM (Windows)](https://msdn.microsoft.com/library/aa378749(VS.85).aspx)

-   [Аудиту и ограничению руководство по использованию NTLM](https://technet.microsoft.com/library/jj865674(v=ws.10).aspx)

### <a name="BKMK_DigestSSP"></a>Поставщик поддержки безопасности хэш-кода
Дайджест-проверка подлинности — это отраслевой стандарт, используемый для Lightweight Directory Access Protocol (LDAP) и веб-проверки подлинности. Дайджест-проверки подлинности учетные данные передаются по сети как дайджест хэша или сообщения MD5.

Хэш-кода поставщика общих СЛУЖБ (Wdigest.dll) используется в следующих целях:

-   Доступ к Internet Explorer и Internet Information Services (IIS)

-   LDAP-запросах

Location: %windir%\Windows\System32\Digest.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале этого раздела, а также, Windows Server 2003 и Windows XP.

**Дополнительные ресурсы для протокола хэш-кода и SSP хэш-кода**

-   [Дайджест-аутентификация Microsoft (Windows)](https://msdn.microsoft.com/library/aa378745(VS.85).aspx)

-   [\[MS-DPSP\]: Расширения протокола хэш-кода](https://msdn.microsoft.com/library/cc227906(PROT.13).aspx)

### <a name="BKMK_SchannelSSP"></a>Поставщик поддержки безопасности Schannel
Безопасного канала (Schannel) используется для проверки подлинности веб-сервера, например когда пользователь пытается получить доступ к безопасному веб-серверу.

Протокол TLS, протокол SSL, протокол технологии конфиденциальной связи (PCT) и протокол уровня транспорта датаграмм (DTLS) основаны на шифровании с открытым ключом. Все эти протоколы входят в Schannel. Для всех протоколов канала SCHANNEL используется модель клиент-сервер. Schannel SSP использует сертификаты открытого ключа для проверки подлинности сторон. При проверке подлинности сторон, Schannel SSP выбирает протокол в следующем порядке предпочтения:

-   Транспорт Layer Security (TLS) версии 1.0

-   Транспорт Layer Security (TLS) версии 1.1

-   Транспорт Layer Security (TLS) версии 1.2

-   Secure Socket Layer (SSL) версии 2.0

-   Secure Socket Layer (SSL) версии 3.0

-   Технологии связи Private (счетчик производительности ")

    **Примечание** PCT отключен по умолчанию.

Протокол, который выбран — протокол проверки подлинности, который может поддерживать клиентом и сервером. Например если сервер поддерживает все протоколы Schannel, и клиент поддерживает только SSL 3.0 и 2.0, SSL, процесс проверки подлинности использует SSL 3.0.

Протокол DTLS используется при явном вызове приложением. Дополнительные сведения о DTLS и другие протоколы, используемые поставщиком Schannel, см. в разделе [технические поставщика поддержки безопасности Schannel](../tls/schannel-security-support-provider-technical-reference.md).

Расположение: %windir%\Windows\System32\Schannel.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале этого раздела, а также, Windows Server 2003 и Windows XP.

> [!NOTE]
> Протокол TLS 1.2 впервые появился в этот поставщик в Windows Server 2008 R2 и Windows 7. Протокол DTLS впервые появился в этот поставщик в Windows Server 2012 и Windows 8.

**Дополнительные ресурсы для протоколов TLS и SSL и Schannel SSP**

-   [Безопасный канал (Windows)](https://msdn.microsoft.com/library/aa380123(VS.85).aspx)

-   [Технический справочник по TLS/SSL](https://technet.microsoft.com/library/cc784149(v=ws.10).aspx)

-   [\[MS-TLSP\]: Транспортный уровень безопасности (TLS) профиль](https://msdn.microsoft.com/library/dd207968(PROT.13).aspx)

### <a name="BKMK_NegoSSP"></a>Поставщик поддержки безопасности Negotiate
Простой и механизм согласования с Protected GSS-API (SPNEGO) — это основа для согласования SSP, whichcan позволяет согласовать протокол проверки подлинности. Когда приложение обращается к интерфейсу SSPI для выполнения входа в сеть, оно может указать SSP для обработки запроса. Если приложение указывает согласования SSP, он анализирует запрос и выбирает соответствующий поставщик для обработки запроса, в соответствии с политиками безопасности, настроенной пользователем.

SPNEGO указано в RFC 2478.

В поддерживаемых версиях операционных систем Windows безопасности Negotiate поддерживает поставщик выбирает между протокол Kerberos и NTLM. Согласование выбирает протокол Kerberos по умолчанию, если только этот протокол не может использоваться с одной из систем, участвующие в проверке подлинности или вызывающего приложения не предоставил достаточно сведений для использования протокола Kerberos.

Расположение: %windir%\Windows\System32\lsasrv.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале этого раздела, а также, Windows Server 2003 и Windows XP.

**Дополнительные ресурсы для согласования SSP**

-   [Microsoft Negotiate (Windows)](https://msdn.microsoft.com/library/aa378748(VS.85).aspx)

-   [\[MS-SPNG\]: Расширения (SPNEGO) механизм согласования простые и защищенные GSS-API](https://msdn.microsoft.com/library/cc247021(PROT.13).aspx)

-   [\[MS-N2HT\]: Согласование и спецификация протокола проверки подлинности HTTP Nego2](https://msdn.microsoft.com/library/dd303576(PROT.13).aspx)

### <a name="BKMK_CredSSP"></a>Поставщик поддержки безопасности учетных данных
Поставщика службы безопасности учетных данных (CredSSP) предоставляет единый вход (SSO) пользовательский интерфейс при запуске новых сеансов служб терминалов и служб удаленных рабочих столов. CredSSP позволяет приложениям для делегирования учетных данных пользователей с клиентского компьютера (с помощью поставщика общих СЛУЖБ на стороне клиента) на целевой сервер (с помощью SSP на стороне сервера), на основе политик клиента. CredSSP политик с помощью групповой политики и делегирование учетных данных будет отключено по умолчанию.

Расположение: %windir%\Windows\System32\credssp.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале этого раздела.

**Дополнительные ресурсы учетных данных поставщика общих служб**

-   [\[MS-CSSP\]: Спецификация протокола поставщика (CredSSP) для поддержки учетных данных безопасности](https://msdn.microsoft.com/library/cc226764(PROT.13).aspx)

-   [Учетные данные поставщика службы безопасности и единый вход для терминалов служб входа в систему](https://technet.microsoft.com/library/cc749211(v=ws.10).aspx)

### <a name="BKMK_NegoExtsSSP"></a>Согласование поставщика поддержки безопасности расширений
Согласование расширения (NegoExts) — это пакет проверки подлинности, который согласования использования SSP, отличный от протокола Kerberos, NTLM, или, для приложений и сценариев, реализованных корпорацией Майкрософт и другого программного обеспечения компании.

Это расширение, чтобы пакет Negotiate разрешает следующие сценарии:

-   **Широкие возможности клиента доступность в пределах федеративной системы.** Документы могут быть доступны на сайтах SharePoint, и их можно изменить с помощью полнофункционального приложения Microsoft Office.

-   **Полнофункциональный клиент поддерживает для служб Microsoft Office.** Пользователи могут входить в службы Microsoft Office и использовать полнофункциональные приложения Microsoft Office.

-   **Внутрипроцессные сервера Microsoft Exchange и Outlook.** Нет доверия домена установить, так как Exchange Server, размещенных в Интернете. Outlook использует службу Windows Live для проверки подлинности пользователей.

-   **Широкие возможности клиента доступности между клиентскими компьютерами и серверами.** Компоненты операционной системы сети и проверки подлинности используются.

Пакета Windows Negotiate рассматривает NegoExts SSP так же, как и для Kerberos и NTLM. NegoExts.dll загружается в локальной системе (LSA) во время запуска. При получении запрос на проверку подлинности на основе источника запроса NegoExts согласовывает между поддерживаемых поставщиков общих служб. Он собирает учетные данные и политики, шифрует их и отправляет эти сведения в соответствующие SSP, где создается маркер безопасности.

SSP, поддерживаемых NegoExts не автономного поставщиков общих служб, таких как Kerberos и NTLM. Таким образом в составе NegoExts SSP, при сбое метода проверки подлинности для какой-либо причине сообщение сбой проверки подлинности будет отображаться или в журнал. Возможны методы проверки подлинности не включали или откат.

Location: %windir%\Windows\System32\negoexts.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале данной статьи, за исключением Windows Server 2008 и Windows Vista.

### <a name="BKMK_PKU2USSP"></a>Поставщик поддержки безопасности PKU2U
Протокол PKU2U введенный и реализованы в виде поставщика общих СЛУЖБ в Windows 7 и Windows Server 2008 R2. Портал Самообслуживания включает аутентификацию peer-to-peer, особенно через мультимедиа и общий доступ к файлам, называемого "Домашняя группа", которая была введена в Windows 7. Эта функция позволяет совместное использование между компьютерами, которые не являются членами домена.

Location: %windir%\Windows\System32\pku2u.dll

Этот поставщик включен по умолчанию в версиях, указанных в **применяется к** списка в начале данной статьи, за исключением Windows Server 2008 и Windows Vista.

**Дополнительные ресурсы для протокола PKU2U и PKU2U SSP**

-   [Введение в Интеграция удостоверений Online](https://technet.microsoft.com/library/dd560662(v=ws.10).aspx)

## <a name="BKMK_SecuritySupportProviderSelection"></a>Выбор поставщика поддержки безопасности
Windows SSPI можно использовать любой из протоколов, которые поддерживаются с помощью установленных поставщиков поддержки безопасности. Тем не менее так как не все операционные системы поддерживают те же пакеты поставщика общих СЛУЖБ, как каждый компьютер под управлением Windows Server, клиенты и серверы должны согласовывать на использование протокола, обе они поддерживают. Windows Server является предпочтительным для клиентских компьютеров и приложений для использования протокола Kerberos, надежный протокол на основе стандартов, когда возможно, но операционная система продолжает позволить клиентским компьютерам и клиентских приложений, которые не поддерживают Kerberos протокол для проверки подлинности.

Прежде чем проверка подлинности может занять место две связи компьютеров необходимо согласовать протокол, обе они поддерживают. Для любого протокола для использования через SSPI каждый компьютер должен иметь соответствующие поставщиком. Например для компьютера клиента и сервера с использованием протокола проверки подлинности Kerberos, они должны поддерживать протокол Kerberos v5. Windows Server использует функцию **EnumerateSecurityPackages** для определения, какие SSP поддерживаются на компьютере и что являются возможности этих поставщиков общих служб.

Выбор протокола проверки подлинности могут обрабатываться одним из следующих двух способов:

1.  [Протокол проверки подлинности](#BKMK_SingleAuth)

2.  [Согласование параметр](#BKMK_Negotiate)

### <a name="BKMK_SingleAuth"></a>Протокол проверки подлинности
При указании одного допустимого протокола на сервере клиентский компьютер должен поддерживать указанный протокол, иначе связь завершится сбоем. При указании одного допустимого протокола проверки подлинности exchange выполняется следующим образом:

1.  Клиентский компьютер запрашивает доступ к службе.

2.  Сервер отвечает на запрос и указывает протокол, который будет использоваться.

3.  Клиентский компьютер проверяет содержимое ответа и проверки, чтобы определить, поддерживает ли указанный протокол. Если клиентский компьютер поддерживает указанный протокол, проверка подлинности продолжается. Если клиентский компьютер не поддерживает протокол, проверка подлинности завершается ошибкой, независимо от того, ли клиентский компьютер имеет права доступа к ресурсам.

### <a name="BKMK_Negotiate"></a>Согласование параметр
Если задан параметр negotiate позволяют разрешить клиента и сервера, чтобы попытаться найти допустимые протокола. Это зависит от простой, механизм согласования с Protected GSS-API (SPNEGO). При проверки подлинности начинается с параметром для согласования протокола проверки подлинности, обмен SPNEGO производится следующим образом:

1.  Клиентский компьютер запрашивает доступ к службе.

2.  Сервер отправляет список протоколов проверки подлинности, может поддерживать и запрос проверки подлинности или ответа в зависимости от протокол, который является его первым. Например сервер может протокола Kerberos и NTLM и отправлять ответ проверки подлинности Kerberos.

3.  Клиентский компьютер проверяет содержимое ответа и проверки, чтобы проверить, поддерживает ли любой из указанных протоколов.

    -   Если клиентский компьютер поддерживает предпочтительного протокола, проверка подлинности выполняется.

    -   Если клиентский компьютер не поддерживает предпочтительного протокола, но он поддерживает один из других протоколов, перечисленных на сервере, клиентский компьютер позволяет серверу определить, какие протокол проверки подлинности, которые она поддерживает и проверку подлинности продолжается.

    -   Если клиентский компьютер не поддерживает любой из указанных протоколов, происходит сбой аутентификации.

## <a name="see-also"></a>См. также
[Архитектура проверки подлинности Windows](https://technet.microsoft.com/library/dn169024(v=ws.10).aspx)


