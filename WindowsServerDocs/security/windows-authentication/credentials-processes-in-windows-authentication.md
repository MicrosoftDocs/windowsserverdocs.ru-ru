---
title: Процедуры с учетными данными в проверке подлинности Windows
description: Безопасность Windows Server
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-windows-auth
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 48c60816-fb8b-447c-9c8e-800c2e05b14f
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 52d50a1bb6bfbe9d35146f362a2a5184df0a6504
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59839865"
---
# <a name="credentials-processes-in-windows-authentication"></a>Процедуры с учетными данными в проверке подлинности Windows

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

В этом справочном разделе для ИТ-специалистов описывается, как проверка подлинности Windows обрабатывает учетные данные.

Управление учетными данными Windows — это процесс, по которому операционной системы, получает учетные данные для службы или пользователя, а также обеспечивает защиту, сведения о будущих презентацию, чтобы целевой объект проверки подлинности. В случае с компьютера, присоединенного к домену целевой объект проверки подлинности — контроллер домена. Учетные данные, используемые в проверке подлинности, цифровые документы, которые связывают удостоверение пользователя в некоторую форму проверки подлинности, например сертификат, пароль или ПИН-код.

По умолчанию в базе данных диспетчера учетных записей безопасности (SAM) на локальном компьютере или с помощью Active Directory на присоединенных к домену компьютере через службу Winlogon, проверяются учетные данные Windows. Учетные данные собираются в рамках ввод данных пользователем в интерфейсе пользователя для входа в систему, или программно через интерфейс программирования (API), которые будут отображаться для проверки подлинности целевой объект.

Сведения о локальной безопасности хранятся в разделе реестра **HKEY_LOCAL_MACHINE\SECURITY**. К числу хранимых сведений относится параметры политики безопасности по умолчанию и такие кэшированные учетные данные учетной записи. Также копию базы данных SAM хранится здесь, несмотря на то, что он защищен от записи.

В примере ниже показан компоненты, которые необходимы и пути принимать учетные данные через систему для проверки подлинности пользователя или процесса, для успешного входа в систему.

![Схема, показывающая компоненты, которые необходимы и пути, что учетные данные через систему для проверки подлинности пользователя или процесса, для успешного входа в систему.](../media/credentials-processes-in-windows-authentication/AuthN_LSA_Architecture_Client.gif)

В следующей таблице описаны каждого компонента, который управляет учетными данными в процессе проверки подлинности при входе в систему.

**Компоненты проверки подлинности для всех систем**

|Component|Описание|
|-------|--------|
|Вход пользователя в систему|Winlogon.exe — исполняемый файл, ответственных за управление взаимодействия безопасности пользователей. Для службы Winlogon запускает процесс входа для операционных систем Windows, передавая учетные данные, полученные действием пользователя на безопасном рабочем столе (пользовательский Интерфейс входа в систему) для локальной системы безопасности (LSA) через Secur32.dll.|
|Вход в приложение|Приложение или служба входа в систему, не требуется интерактивный вход в систему. Большинство процессов, инициируемых пользователем, работать в пользовательском режиме, используя Secur32.dll, тогда как процессов, инициируемых во время запуска, таких как службы, выполняться в режиме ядра, с помощью Ksecdd.sys.<br /><br />Дополнительные сведения о пользовательском режиме и работающих в режиме ядра см. в разделе приложений и режим пользователя или служб и режима ядра в этом разделе.|
|Secur32.dll|Несколько поставщиков проверки подлинности, которые формируют основу процесса проверки подлинности.|
|Lsasrv.dll|Служба сервера LSA, которая выступает в роли диспетчера пакетов безопасности для LSA и применяет политики безопасности. Локальный администратор безопасности содержит функцию Negotiate, который выбирает протокол Kerberos или NTLM, Выяснив, какой протокол будет успешной.|
|Поставщиков поддержки безопасности|Набор поставщиков, которые по отдельности может вызывать одного или нескольких протоколов проверки подлинности. Набор поставщиков, по умолчанию можно изменить с каждой версией операционной системы Windows, и пользовательские поставщики могут записываться.|
|Netlogon.dll|Ниже приведены службы, которые выполняет служба сетевого входа в систему.<br /><br />-Обеспечивает безопасный канал (не следует путать с Schannel) к контроллеру домена компьютера.<br />-Передает учетные данные пользователя через безопасный канал к контроллеру домена и возвращает доменные идентификаторы безопасности (SID) и права пользователя для пользователя.<br />-Публикует записи ресурсов в системе доменных имен (DNS) и использует DNS для разрешения имен в адреса протокола Интернета (IP), контроллеров домена.<br />-Реализует протокол репликации, основанного на удаленный вызов процедур (RPC) для синхронизации уровня главных контроллеров домена (PDC) и резервные контроллеры домена (BDC).|
|Samsrv.dll|Диспетчера учетных записей (SAM), где хранятся учетные записи локальной системы безопасности, принудительно применяет политики, хранимые локально и поддерживает API-интерфейсы.|
|Реестр|Реестр содержит копию базы данных SAM, параметры локальной политики безопасности, значения по умолчанию безопасности и сведения об учетной записи, которая доступна только в системе.|

В этом разделе содержатся следующие подразделы:

-   [Ввод учетных данных для входа в систему](#BKMK_CrentialInputForUserLogon)

-   [Ввод учетных данных для приложения и службы входа в систему](#BKMK_CredentialInputForApplicationAndServiceLogon)

-   [Локальный администратор безопасности](#BKMK_LSA)

-   [Кэшированные учетные данные и проверка](#BKMK_CachedCredentialsAndValidation)

-   [Хранение учетных данных и проверки](#BKMK_CredentialStorageAndValidation)

-   [Базы данных диспетчера учетных записей безопасности](#BKMK_SAM)

-   [Локальных доменов и доверенных доменах](#BKMK_LocalDomainsAndTrustedDomains)

-   [Сертификаты проверки подлинности Windows](#BKMK_CertificatesInWindowsAuthentication)

## <a name="BKMK_CrentialInputForUserLogon"></a>Ввод учетных данных для входа в систему
В Windows Server 2008 и Windows Vista архитектура Graphical Identification and Authentication (GINA) была заменена модель поставщика учетных данных, который позволил бы перечислить типы различных входа при помощи плитки входа в систему. Обе модели описаны ниже.

**Архитектура графического Идентификация и аутентификация**

Архитектура Graphical Identification and Authentication (GINA) применяется к операционным системам Windows Server 2003, Microsoft Windows 2000 Server, Windows XP и Windows 2000 Professional. В этих системах каждый сеанс интерактивного входа в систему создается отдельный экземпляр службы Winlogon. Архитектура GINA загружается в пространстве процесса, используемый процессом Winlogon, получает и обрабатывает учетные данные и выполняет вызовы интерфейсов проверки подлинности через LSALogonUser.

Экземпляры процесса Winlogon для интерактивного входа в систему выполняется в сеансе 0. Сеанс 0 узлов системные службы и другие важные процессы, включая процесс Local Security Authority (LSA).

В примере ниже показан процесс обработки учетных данных для Windows Server 2003, Microsoft Windows 2000 Server, Windows XP и Microsoft Windows 2000 Professional.

![Схема, показывающая процесс обработки учетных данных для Windows Server 2003, Microsoft Windows 2000 Server, Windows XP и Microsoft Windows 2000 Professional](../media/credentials-processes-in-windows-authentication/AuthN_GINA_Architecture.gif)

**Архитектура поставщика учетных данных**

Архитектура поставщика учетных данных применяется к версиями, указанными в **применяется к** списка в начале этого раздела. В этих системах архитектура ввода учетных данных изменены в расширяемую модель с помощью поставщиков учетных данных. Эти поставщики представлены различные входа плитки на безопасном рабочем столе, которые разрешают любое количество сценарии входа в систему - различные учетные записи для одного пользователя и разные методы проверки подлинности, например пароля, смарт-карт и биометрических данных.

Архитектура поставщика учетных данных Winlogon всегда начинается пользовательский Интерфейс входа в систему после получения последовательности на специальное событие. Пользовательский Интерфейс входа запрашивает каждый поставщик учетных данных для число различных типов учетных данных поставщика, настроенных для перечисления. Поставщики учетных данных имеют возможность указать один из этих плиток по умолчанию. После всех поставщиков перечислили их плитки, пользовательский Интерфейс входа в систему отображаются для пользователя. Пользователь взаимодействует с плитку, чтобы вводить свои учетные данные. Пользовательский Интерфейс входа передает эти учетные данные для проверки подлинности.

Поставщики учетных данных не являются механизмы введения ограничений. Они используются для сбора и сериализации учетных данных. Пакеты локальным администратором безопасности и проверки подлинности, применение политик безопасности.

Поставщики учетных данных, зарегистрированных на компьютере и отвечают за следующее:

-   Описывающий учетные данные, необходимые для проверки подлинности.

-   Обработка связи и логики с помощью центров внешней проверки подлинности.

-   Учетные данные упаковки для интерактивных и вход в сеть.

Учетные данные упаковки для интерактивных и вход в сеть включает в себя процесс сериализации. Путем сериализации учетные данные могут отображаться несколько плиток входа на пользовательский Интерфейс входа. Таким образом вашей организации можно управлять отображением входа в систему как пользователям, целевых систем для входа в систему, предварительного доступ к сети и рабочей станции блокировки политики — с помощью настраиваемых учетных данных поставщиков. Несколько поставщиков учетных данных могут сосуществовать на одном компьютере.

Единый вход (SSO) поставщики могут разрабатываться как поставщик стандартных учетных данных или в качестве поставщика предварительного-доступа.

Каждая версия Windows содержит один используемый по умолчанию поставщик учетных данных и до подключения одно значение по умолчанию-доступ Provider (PLAP), также известный как поставщик единого входа. Поставщик единого входа позволяет пользователям устанавливать подключение к сети перед входом в систему на локальном компьютере. При реализации этого поставщика, поставщик не перечислить плиток в пользовательском Интерфейсе входа.

Поставщик единого входа предназначено для использования в следующих сценариях:

-   **Вход в сеть проверки подлинности и компьютером, обрабатываются поставщиков различных учетных данных.** Включить варианты для этого сценария:

    -   Пользователь имеет возможность подключения к сети, таких как подключение к виртуальной частной сети (VPN), чтобы войти на компьютер, но для этого подключения не требуется.

    -   Чтобы получить сведения, используемые во время интерактивной проверки подлинности на локальном компьютере требуется проверка подлинности сети.

    -   Многократной проверки подлинности сети следует один из других сценариев. Например пользователь проходит проверку подлинности для поставщика услуг Интернета (ISP), проходит проверку подлинности для VPN-Подключение и затем использует учетные данные учетной записи пользователя для входа на локально.

    -   Кэшированные учетные данные отключены, и проверить подлинность пользователя перед локальный вход в систему требуется соединение служб удаленного доступа через VPN.

    -   Пользователь домена не имеет локальную учетную запись на компьютере, присоединенном к домену и необходимо установить соединение служб удаленного доступа через VPN-подключение перед завершением интерактивный вход в систему.

-   **Вход в сеть проверки подлинности и компьютером, обрабатываются один и тот же поставщик учетных данных.** В этом случае пользователь необходим для подключения к сети до входа в систему компьютера.

**Перечисление Плитка входа в систему**

Поставщик учетных данных перечисляет входа плитки в следующих случаях:

-   Для этих операционных систем, указанных в **применяется к** списка в начале этого раздела.

-   Поставщик учетных данных перечисляет плитки для входа в рабочую станцию. Поставщик учетных данных обычно сериализует учетные данные для проверки подлинности с локальным администратором безопасности. Этот процесс отображаются плитки, специфичные для каждого пользователя и определенных для каждого пользователя целевых систем.

-   Архитектура входа в систему и проверки подлинности позволяет пользователю использовать плитки, перечисленный с помощью поставщика учетных данных для разблокирования рабочей станции. Как правило выполнившего вход пользователя является Плитка "по умолчанию", но если более чем один пользователь вошел в систему, многочисленные плитки отображаются.

-   Поставщик учетных данных перечисляет плиток в ответ на запрос пользователя изменить свой пароль или другую конфиденциальную информацию, например ПИН-код. Как правило выполнившего вход пользователя является Плитка "по умолчанию"; Тем не менее если более чем один пользователь вошел в систему, отображаются несколько плиток.

-   Поставщик учетных данных перечисляет плитки, исходя из сериализованного учетных данных для проверки подлинности на удаленных компьютерах. Учетные данные пользовательского интерфейса не использовать один и тот же экземпляр поставщика как пользовательский Интерфейс входа в систему, разблокировать рабочей станции или изменить пароль. Таким образом невозможно сохранять сведения о состоянии в поставщике между экземплярами пользовательский Интерфейс учетных данных. Эта структура приводит к одному элементу для каждого входа удаленного компьютера, при условии, что правильно сериализации учетные данные. Этот сценарий также используется в контроля учетных записей (UAC), что может помочь предотвратить несанкционированные изменения на компьютере, запрашивая у пользователя разрешение или пароль администратора, прежде чем удалять действия, которые могут оказать влияние на работу системы или можно изменить параметры, влияющие на других пользователей компьютера.

В примере ниже показан процесс учетных данных для операционных систем, указанным в **применяется к** списка в начале этого раздела.

![Схема, показывающая процесс учетных данных для операционных систем, указанных в ** относится к ** списка в начале этого раздела](../media/credentials-processes-in-windows-authentication/AuthN_CredMan_CredProv.gif)

## <a name="BKMK_CredentialInputForApplicationAndServiceLogon"></a>Ввод учетных данных для приложения и службы входа в систему
Проверка подлинности Windows предназначена для управления учетными данными для приложений или служб, не требующих вмешательства пользователя. Приложения в пользовательском режиме ограничены с точки зрения, какие системные ресурсы, они имеют доступ, пока службы сможет получить неограниченный доступ к системной памяти и внешних устройств.

Системные службы и транспортного уровня приложений, доступ к поставщика поддержки безопасности (SSP) через безопасности поддержки поставщика интерфейс (SSPI) в Windows, которая предоставляет функции для перечисления пакетов безопасности, доступных в системе, выбрав пакет, а получить подключение с проверкой подлинности с помощью этого пакета.

Когда соединение клиент сервер проходит проверку подлинности:

-   Приложения на клиентской стороне соединения отправляет учетные данные на сервер с помощью функции SSPI `InitializeSecurityContext (General)`.

-   Приложения на стороне сервера, соединения отвечает с функцией SSPI `AcceptSecurityContext (General)`.

-   Функции SSPI `InitializeSecurityContext (General)` и `AcceptSecurityContext (General)` повторяются, пока все необходимые проверки подлинности сообщения обмена для завершится успехом или ошибкой проверки подлинности.

-   После проверки подлинности подключения LSA на сервере использует сведения от клиента для построения контекст безопасности, который содержит маркер доступа.

-   Сервер может затем вызвать функцию SSPI `ImpersonateSecurityContext` присоединить маркер доступа к поток олицетворения для службы.

**Приложения и пользовательского режима**

Режим пользователя в Windows состоит из двух систем, которые позволяют устанавливать запросов ввода-вывода для соответствующих в режиме ядра драйверы: в систему среды, которая запускает приложения, написанные для различных типов операционных систем, и целочисленный система, которая работает функции, характерные для системы от имени system среды.

Целочисленный система управляет system'specific функции от имени system среды и состоит из процесс системы безопасности (LSA), служба рабочей станции и служба сервера. Процесс системы безопасности имеет дело с маркерами безопасности, предоставляет или запрещает разрешения на доступ к учетным записям пользователей, на основе ресурсов разрешений, обрабатывает запросы на вход и инициирует проверку подлинности и определяет, какие системные ресурсы операционной системы требуется для аудита.

Приложения могут выполняться в пользовательском режиме, где его можно выполнять как любому участнику, в том числе в контексте безопасности из Local System (SYSTEM). Приложения могут также выполняться в режиме ядра где его можно выполнять в контексте безопасности из Local System (SYSTEM).

SSPI доступна через модуль Secur32.dll, который является интерфейс API, используемый для получения интегрированных служб безопасности для проверки подлинности, целостность и конфиденциальность сообщений. Он предоставляет уровень абстракции между протоколы уровня приложений и протоколы безопасности. Так как для различных приложений требуется различные способы идентификации или проверки подлинности пользователей и различные способы шифрования данных при передаче по сети, SSPI предоставляет способ доступа к библиотеки динамической компоновки (DLL), которые содержат различные проверки подлинности и криптографических функций. Эти библиотеки DLL, называются поставщиков поддержки безопасности (SSP).

Управляемые учетные записи служб и виртуальные учетные записи были введены в Windows Server 2008 R2 и Windows 7 для обеспечения важных приложений, таких как Microsoft SQL Server и Internet Information Services (IIS), изоляцией собственных учетных записей домена, а устраняя необходимость в ручном администрировании имени участника-службы (SPN) и учетные данные для этих учетных записей. Дополнительные сведения об этих функциях и их роли в проверке подлинности см. в разделе [управляемые службы учетных записей документации для Windows 7 и Windows Server 2008 R2](https://technet.microsoft.com/library/ff641731(v=ws.10).aspx) и [Обзор групповых управляемых служб учетных записей](../group-managed-service-accounts/group-managed-service-accounts-overview.md).

**Службы режим и режим ядра**

Несмотря на то, что большинство приложений Windows выполняются в контексте безопасности пользователя, который запускает их, это не так служб. Многие службы Windows, таких как сеть и служб печати, запускаются контроллер, когда пользователь запускает компьютер. Эти службы могут выполняться как Local Service или Local System и могут продолжать работать после выхода из системы последнего пользователя.

> [!NOTE]
> Службы обычно работают в контекстах безопасности, известный как Local System (SYSTEM), Network Service или Local Service.  Windows Server 2008 R2 появился службы, работающие под управляемой учетной записи службы, которые являются субъектами домена.

Перед запуском службы, в контроллер служб входит в систему с учетной записи, назначенный для службы, а также предоставляет учетных данных службы, для проверки подлинности, LSA. Служба Windows реализует программный интерфейс, который диспетчером управления службами можно использовать для управления службой. Служба Windows запускается автоматически при запуске системы или вручную с помощью служебной программы управления. Например когда клиентский компьютер Windows будет присоединен к домену, служба сообщений на компьютере подключается к контроллеру домена и открывает защищенный канал к нему. Чтобы получить подключение с проверкой подлинности, служба должна иметь учетные данные, которым доверяет удаленного компьютера Local Security Authority (LSA). При обмене данными с другими компьютерами в сети, LSA использует учетные данные для учетной записи домена для локального компьютера, как и всех других служб, работающих в контекст безопасности Local System и Network Service. Службы на локальном компьютере запустите систему, чтобы учетные данные не обязательно должны быть представлены в LSA.

Файл Ksecdd.sys управляет и шифрует эти учетные данные и использует вызов локальной процедуры в LSA. Тип файла DRV (драйвер) и известно, как поставщик поддержки безопасности в режиме ядра (SSP) и, в этих версиях, указанных в **применяется к** перечислены в начале этого раздела, соответствует стандарту FIPS 140-2 уровня 1-совместимым.

В режиме ядра имеет полный доступ к ресурсам оборудования и системы компьютера. Режим ядра останавливает службы пользовательского режима и приложениям доступ к критические области операционной системы, которой не нужен доступ к.

## <a name="BKMK_LSA"></a>Локальный администратор безопасности
Local Security Authority (LSA) является защищенным системным процессом, который выполняет проверку подлинности и вход пользователей в систему на локальном компьютере. Кроме того локальный администратор безопасности содержит сведения обо всех аспектах безопасности локальной на компьютере (эти аспекты, совокупно называются локальной политики безопасности), и предоставляет различные службы для трансляции имена и идентификаторы безопасности (SID). Следит за процесса обеспечения безопасности системы, локальной безопасности центра сервера службы (LSASS), политики безопасности и учетных записей, которые действуют в системе компьютера.

Локальный администратор безопасности проверяет удостоверение пользователя, на основании которого следующих двух сущностей, выданный учетной записи пользователя:

-   **Локальный администратор безопасности.** LSA можно проверить сведения о пользователе, проверка базы данных диспетчера учетных записей безопасности (SAM), расположенный на одном компьютере. Любой рабочей станции или рядового сервера можно хранить локальные учетные записи пользователей и сведения о локальных группах. Тем не менее эти учетные записи могут использоваться для доступа к данной рабочей станции или компьютера.

-   **Центр безопасности для локального домена или доверенного домена.** LSA обращается лицо, выдавшее учетной записи и запрашивает проверку, что учетная запись действительна и что запрос исходит от ее владельца.

Служба LSASS сохраняет в памяти учетные данные пользователей с активными сеансами Windows. Сохраненные учетные данные позволяют легко получать доступ к сетевым ресурсам, например общих папок, почтовых ящиков Exchange Server и узлов SharePoint, без необходимости повторного ввода учетных данных для каждой удаленной службы.

Служба LSASS способна хранить учетные данных в различных форматах, включая

-   Зашифрованный обычный текст с возможностью дешифровки

-   Билеты Kerberos (билета предоставления билетов (TGT), билеты служб)

-   NT-хэш

-   Хэш LAN Manager (LM)

Если пользователь выполняет вход в Windows с помощью смарт-карты, LSASS не хранит текстовый пароль, но он сохраняет соответствующий NT хэш-значение для учетной записи и открытый текст ПИН-кода смарт-карты. Если для смарт-карты, необходимой для интерактивного входа, включается атрибут учетной записи, то для соответствующего профиля происходит автоматическая генерация произвольного NT-хэша, который используется вместо изначального хэша пароля. Хэш пароля, автоматически сгенерированный при установке атрибута, не изменяется.

Если пользователь выполняет вход на компьютере под управлением Windows с помощью пароля, который совместим с хеш-значения LAN Manager (LM), данной структуры проверки подлинности находится в памяти.

Хранение учетных данных в памяти в виде обычного текста нельзя выключить, даже если этого требуют поставщики учетных данных.

Сохраненные учетные данные напрямую связываются с локальной безопасности центра подсистему службы () сеансами LSASS, которые были запущены после последнего перезапуска и не были закрыты. Например, сеансы с сохраненными учетными данными LSA создаются, когда пользователь выполняет одно из следующих действий.

-   Выполняет вход на локальный сеанс или сеанс удаленного рабочего стола (RDP) на компьютере

-   Запускает задание с помощью команды **RunAs**

-   Запускает на компьютере активную службу Windows

-   Запускает назначенное или пакетное задание

-   Запускает на локальном компьютере задание с помощью средства удаленного администрирования.

В некоторых случаях секреты LSA, — это секретный части данных, которые доступны только для СИСТЕМНЫХ процессов учетной записи, хранятся на жестком диске. Некоторые из этих секретов представляют собой учетные данные, которые должны сохраниться после перезагрузки и хранящиеся на жестком диске в зашифрованном виде. Учетные данные, хранящиеся в виде секретов LSA, могут включать

-   Пароль учетной записи для учетных записей доменных служб Active Directory (AD DS)

-   Пароли учетных записей служб Windows, настроенных на компьютере

-   Пароли учетных записей настроенных назначенных заданий

-   Пароли учетных записей для пулов приложений IIS и веб-сайтов.

-   Пароли для учетных записей Майкрософт

Представленный в Windows 8.1, клиентская операционная система обеспечивает дополнительную защиту для LSA, предотвращая считывание памяти и внедрение кода незащищенными процессами. Такая защита повышает безопасность для учетных данных, которые хранит LSA и управляет.

Дополнительные сведения об этой дополнительной защиты, см. в разделе [Configuring Additional LSA Protection](../credentials-protection-and-management/configuring-additional-lsa-protection.md).

## <a name="BKMK_CachedCredentialsAndValidation"></a>Кэшированные учетные данные и проверка
Механизмы проверки зависит от представления учетных данных во время входа в систему. Однако когда компьютер отключен от контроллера домена, и пользователь является предоставлять учетные данные домена, Windows использует процесс кэшированные учетные данные в механизм проверки.

Каждый раз при входе пользователя в домен Windows кэширует учетные данные, предоставленные и сохраняет их в кусте безопасности в реестре в операционной системе.

Кэшированные учетные данные, пользователь может войти входит в домен без подключения к контроллеру домена в рамках этого домена.


## <a name="BKMK_CredentialStorageAndValidation"></a>Хранение учетных данных и проверки
Не всегда желательно использовать один набор учетных данных для доступа к различным ресурсам. Например администратор может потребоваться использовать администратора, а не учетные данные пользователя при входе на удаленный сервер. Аналогично Если пользователь получает доступ к внешним ресурсам, например на банковском счете, он или она можно использовать только учетные данные, которые отличаются от учетных данных домена. В следующих разделах описаны различия в управлении учетными данными между текущие версии операционных систем Windows и операционные системы Windows Vista и Windows XP.

### <a name="remote-logon-credential-processes"></a>Процессы учетных данных удаленного входа
Протокол удаленного рабочего стола (RDP) управляет учетными данными пользователя, который подключается к удаленному компьютеру с помощью клиента удаленного рабочего стола, которая была введена в Windows 8. Учетные данные в виде открытого текста, отправляются на узел назначения, где узел пытается выполнить процесс проверки подлинности и, в случае успешного выполнения пользователь подключается к допустимые ресурсы. RDP не хранит учетные данные на клиенте, но учетные данные пользователя домена, хранятся в LSASS.

Представленный в Windows Server 2012 R2 и Windows 8.1, ограниченного административного режима обеспечивает дополнительную безопасность для сценариев входа в удаленную систему. Этот режим удаленного рабочего стола приводит к клиентскому приложению выполнения сетевого входа в систему запрос ответ с необратимой функции NT (NTOWF) или использовать билет службы Kerberos, при проверке подлинности на удаленный узел. После проверки подлинности администратора, администратор имеет соответствующие учетные данные в LSASS, так как они не были указаны на удаленный узел. Вместо этого администратор имеет учетные данные учетной записи компьютера для сеанса. Учетные данные администратора не поставляются на удаленный узел, так как учетная запись компьютера выполняются действия. Ресурсы также ограничены учетной записи компьютера, и администратор нет доступа к ресурсам с помощью собственную учетную запись.

### <a name="automatic-restart-sign-on-credential-process"></a>Автоматический перезапуск процесса учетных данных единого входа
При входе пользователя на устройстве Windows 8.1, LSA сохраняет учетные данные пользователя в зашифрованных памяти, которые доступны только LSASS.exe. При обновлении Windows инициирует автоматический перезапуск без присутствия пользователя, эти учетные данные используются для настройки автоматического входа для пользователя.

При перезапуске пользователь автоматически выполнил вход с помощью механизма автоматического входа, а затем компьютер блокируется Кроме того для защиты сеанс пользователя. Блокировка инициируется через функцию Winlogon, тогда как управление учетными данными выполняется путем LSA. Автоматически вход и блокировка сеанса пользователя на консоли приложений экрана блокировки пользователя перезапуск и доступность.

Дополнительные сведения о ARSO, см. в разделе [Winlogon автоматического перезапуска вход &#40;ARSO&#41;](winlogon-automatic-restart-sign-on-arso.md).

### <a name="stored-user-names-and-passwords-in-windows-vista-and-windows-xp"></a>Сохранение имен пользователей и паролей в Windows Vista и Windows XP
В Windows Server 2008, Windows Server 2003, Windows Vista и Windows XP **сохраненные имена пользователей и пароли** панели управления, упрощает управление и использование несколько наборов учетных данных, включая сертификаты X.509, используемые с помощью смарт-карты и динамической учетные данные Windows (теперь называется учетной записью Майкрософт). -Часть профиля пользователя - учетные данные хранятся в том случае, пока они не понадобятся. Это действие можно увеличить безопасность на основе каждого ресурса, гарантируя, что если нарушена один пароль, он не влияет на получаемые все параметры безопасности.

Когда пользователь входит в систему, а пытается получить доступ к дополнительным ресурсам, защищенной паролем, например общую папку на сервере, и если учетные данные пользователя для входа по умолчанию недостаточно для получения доступа, **сохраненные имена пользователей и пароли** запрашивается . Если альтернативные учетные данные с правильные учетные данные были сохранены в **сохраненные имена пользователей и пароли**, эти учетные данные используются для получения доступа. В противном случае пользователю будет предложено укажите новые учетные данные, которые затем можно сохранить для повторного использования, в сеансе входа в систему или во время последующих сеансов.

Применяются следующие ограничения:

-   Если **сохраненные имена пользователей и пароли** содержит недопустимые или неправильные учетные данные для определенного ресурса, доступ к ресурсу запрещен и **сохраненные имена пользователей и пароли** не поддерживает диалоговое окно отображаются.

-   **Сохранение имен пользователей и пароли** хранит учетные данные только для NTLM, протокол Kerberos, учетной записи Майкрософт (ранее Windows Live ID) и проверку подлинности Secure Sockets Layer (SSL). Некоторые версии Internet Explorer поддержки собственных кэша для обычной проверки подлинности.

Эти учетные данные становятся зашифрованных частью локального профиля пользователя в \Documents and Settings\Username\Application Data\Microsoft\Credentials каталога. Таким образом эти учетные данные можно перемещаться с пользователем, если в политике сети поддерживает перемещаемых профилей пользователей. Тем не менее если пользователь имеет копий **сохраненные имена пользователей и пароли** на двух разных компьютерах и изменения учетных данных, которые связаны с ресурсом на одном из этих компьютеров, изменение не распространяется на  **Сохранение имен пользователей и пароли** на втором компьютере.

### <a name="windows-vault-and-credential-manager"></a>Хранилище Windows и диспетчер учетных данных
Диспетчер учетных данных появилась в Windows Server 2008 R2 и Windows 7, как компонент панели управления для хранения и управления имена пользователей и пароли. Диспетчер учетных данных позволяет пользователям сохранять учетные данные, относящиеся к другим системам и веб-сайтов в безопасное хранилище Windows. Некоторые версии Internet Explorer эту функцию для проверки подлинности для веб-сайтов.

Управление учетными данными с помощью диспетчера учетных данных контролируется пользователем локального компьютера. Чтобы пользователям было удобно регистрироваться в поддерживаемых браузерах и Windows-приложениях, они могут сохранять и хранить учетные данные с этих ресурсов. Учетные данные сохраняются в специальных зашифрованных папках на компьютере в профиле пользователя. Приложения, которые поддерживают эту функцию (посредством API диспетчера учетных данных), таких как веб-браузеры и приложения, можно представить правильные учетные данные другим компьютерам и веб-сайтов при входе в систему.

Если веб-сайт, приложение или другой запрашивает проверку подлинности компьютера через протокол Kerberos или NTLM, диалоговое окно отображается в чего можно выбрать **обновить учетные данные по умолчанию** или **сохранить пароль**"флажок". Это диалоговое окно, которое позволяет пользователю сохранить учетные данные локально создается приложением, которое поддерживает API диспетчера учетных данных. Если пользователь выбирает **сохранить пароль** следит за флажок, диспетчер учетных данных пользователя имя пользователя, пароль и другие сведения о службе проверки подлинности, который уже используется.

При очередном используется служба, диспетчер учетных данных автоматически предоставляет учетные данные, хранящиеся в хранилище Windows. Если данные не принимаются, пользователю предлагается ввести правильную информацию для получения доступа. Если доступ разрешен с новыми учетными данными, диспетчер учетных данных перезаписывает предыдущие учетные данные на новую, а затем сохраняет новые учетные данные в хранилище Windows.

## <a name="BKMK_SAM"></a>Базы данных диспетчера учетных записей безопасности
Диспетчер учетных записей безопасности (SAM) — это база данных, в которой хранятся учетные записи локальных пользователей и групп. Он присутствует во все операционные системы Windows; Тем не менее если компьютер присоединен к домену, Active Directory управляет учетными записями домена в доменах Active Directory.

Например клиентские компьютеры под управлением ОС Windows участвовать в сетевой домен, связываясь с контроллером домена, даже в том случае, если человека пользователь не вошел в систему. Инициировать обмен данными, компьютер должен иметь активную учетную запись в домене. Прежде чем принимать подключения от компьютера, LSA на контроллере домена проверяет подлинность удостоверения компьютера и затем создает контекст безопасности компьютера, так же, как для создания субъекта безопасности человека. Этот контекст безопасности определяет удостоверение и возможности пользователя или службы на конкретный компьютер или пользователя, служба или компьютер в сети. Например маркер доступа, содержащихся в контекст безопасности определяет ресурсы (например, общую папку или принтер), доступных и действий (например, чтение, запись или изменение), которые можно выполнить с этого участника - пользователя, компьютера или службы, на который ресурс.

Контекст безопасности пользователя или компьютера может варьироваться от одного компьютера на другой, например при входе пользователя в систему на сервере или рабочей станции, отличные от основной рабочей станции пользователя. Он также может составлять от одного сеанса на другой, например, когда администратор изменяет права и разрешения пользователя. Кроме того контекст безопасности обычно отличается, когда пользователь или компьютер работает отдельно, в сети, или как часть домена Active Directory.

## <a name="BKMK_LocalDomainsAndTrustedDomains"></a>Локальных доменов и доверенных доменах
При наличии доверия между двумя доменами, механизмов проверки подлинности для каждого домена зависит от допустимости проверок подлинности, поступающих из другого домена. Доверительные отношения помогут обеспечить управляемый доступ к общим ресурсам в домене ресурсов (доверяющий домен), проверяя, что входящие запросы проверки подлинности поступают из доверенного центра (доверенный домен). Таким образом отношения доверия выступать в качестве мостов, которые позволяют только проверить travel запросы проверки подлинности между доменами.

Как определенные доверия передает запросы на проверку подлинности зависит от того, как оно настроено. Отношения доверия может быть односторонней связи, предоставляя доступ к ресурсам в доверяющем домене из доверенного домена или двустороннее, предоставляя доступ к ресурсам в другом домене из каждого домена. Отношения доверия также являются нетранзитивными, в этом случае существует отношение доверия только между доменами партнеров два отношения доверия, либо транзитивным, в этом случае отношение доверия автоматически распространяется на другие домены, которым доверяет участники.

Сведения об отношениях доверия домена и леса, связанные с проверкой подлинности, см. в разделе [делегированной проверки подлинности и отношения доверия](https://technet.microsoft.com/library/dn169022.aspx).

## <a name="BKMK_CertificatesInWindowsAuthentication"></a>Сертификаты проверки подлинности Windows
Инфраструктура открытых ключей (PKI) представляет собой сочетание программного обеспечения, технологии шифрования, процессов и служб, которые позволяют организациям защитить его обмена данными и бизнес-транзакций. Возможности инфраструктуры открытых ключей для защиты обмена данными и бизнес-транзакций основана на exchange цифровых сертификатов между проверкой подлинности пользователей и доверенных ресурсов.

Сертификат — это электронный документ, содержащий сведения о сущности, к которой он принадлежит, сущность, на которой он был выдан, уникальный серийный номер или другие уникальный код, выдачи и даты окончания срока действия и цифровой отпечаток.

Проверка подлинности — это процесс определения, если удаленный узел можно доверять. Для установки уровня безопасности, удаленный узел должен предоставить сертификат проверки подлинности.

Удаленными узлами установить их надежности, получение сертификата из центра сертификации (ЦС). ЦС, в свою очередь, может иметь сертификации с более высокими полномочиями, для которого создается цепочка доверия. Чтобы определить, заслуживает ли сертификат, приложение должно идентификации корневого ЦС и определить, является ли trustworthy.

Аналогичным образом удаленного узла или локальном компьютере необходимо определить ли подлинность сертификата, предоставленного пользователем или приложением. Сертификата, предоставленного пользователем с помощью LSA и SSPI оценивается на подлинность на локальном компьютере для локального входа, в сети или в домене через хранилищ сертификатов в Active Directory.

Для создания сертификата, данные проверки подлинности проходит хэш-алгоритмы, такие как Secure Hash Algorithm 1 (SHA1), для создания хэш-кода. Хэш сообщения цифровую подпись с помощью закрытого ключа отправителя, чтобы доказать, что хэш-кода был создан с помощью отправителя.

> [!NOTE]
> SHA1 используется по умолчанию в Windows 7 и Windows Vista, но было изменено на SHA2 в Windows 8.

**Проверка подлинности смарт-карты**

Технология смарт-карты является примером проверки подлинности на основе сертификата. Вход в сеть с помощью смарт-карты обеспечивает строгую проверку подлинности, так как оно использует Идентификация на основе криптографии и подтверждение владения, при входе пользователя в домен. Службы сертификатов Active Directory (AD CS) обеспечивает идентификацию шифрования на основе через выдачи сертификата для входа для каждого смарт-карты.

Сведения о проверке подлинности смарт-карты, см. в разделе [Технический справочник по смарт-карт Windows](https://technet.microsoft.com/library/ff404297.aspx).

Технология виртуальной смарт-карты появился в Windows 8. Он хранит сертификат смарт-карты в компьютер и затем защищает его с помощью микросхема защиты устройства от несанкционированного доверенного платформенного модуля (TPM). Таким образом, компьютер фактически становится смарт-карты, который необходимо получить ПИН-код пользователя, чтобы пройти проверку подлинности.

**Проверка подлинности удаленного, так и беспроводных**

Проверка подлинности удаленного и беспроводной сети является другая технология, которая использует сертификаты для проверки подлинности. Internet Authentication Service (IAS) и серверы виртуальной частной сети в целях расширяемый безопасность на уровне транспорта протокола проверки подлинности (EAP-TLS), защищенный протокол проверки подлинности (PEAP) или IP-безопасность (IPsec) выполните проверку подлинности на основе сертификата для многих типов доступа к сети, включая виртуальной частной сети (VPN) и беспроводных подключений.

Сведения о проверке подлинности на основе сертификата в сети, см. в разделе [сетевой проверки подлинности для доступа и сертификаты](https://technet.microsoft.com/library/cc759575(WS.10).aspx).

## <a name="BKMK_SeeAlso"></a>См. также
[Основные понятия проверки подлинности Windows](https://technet.microsoft.com/library/d169018.aspx)


