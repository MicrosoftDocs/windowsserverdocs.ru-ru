---
title: Рекомендации по планированию защищенной структуры и экранированной виртуальной машины для клиентов
ms.prod: windows-server
ms.topic: article
ms.assetid: 392af37f-a02d-4d40-a25d-384211cbbfdd
manager: dongill
author: nirb-ms
ms.author: nirb
ms.technology: security-guarded-fabric
ms.openlocfilehash: 5d50721ddf51bc956d8afd256ff047c94c5d5a5e
ms.sourcegitcommit: acfdb7b2ad283d74f526972b47c371de903d2a3d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/05/2020
ms.locfileid: "87769452"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-tenants"></a>Рекомендации по планированию защищенной структуры и экранированной виртуальной машины для клиентов

>Область применения: Windows Server 2019, Windows Server (половина ежегодного канала), Windows Server 2016

В этом разделе рассматриваются владельцы виртуальных машин, которые хотели бы защищать свои виртуальные машины (ВМ) для обеспечения соответствия требованиям и безопасности. Независимо от того, работают ли виртуальные машины в защищенной структуре поставщика услуг размещения или в частной защищенной структуре, владельцам ВИРТУАЛЬНЫХ машин необходимо управлять уровнем безопасности экранированных виртуальных машин, что включает в себя возможность расшифровывать их при необходимости.

При использовании экранированных виртуальных машин необходимо учитывать три аспекта.

- Уровень безопасности для виртуальных машин
- Криптографические ключи, используемые для их защиты
- Данные экранирования — конфиденциальная информация, используемая для создания экранированных виртуальных машин

## <a name="security-level-for-the-vms"></a>Уровень безопасности для виртуальных машин

При развертывании экранированных виртуальных машин необходимо выбрать один из двух уровней безопасности:

- Экранирование
- Поддерживается шифрование

К виртуальным машинам с экранированными и шифрованием подключены виртуальный доверенный платформенный модуль, а те, которые работают под управлением Windows, защищены BitLocker. Основное отличие заключается в том, что экранированные виртуальные машины блокируют доступ администраторами структуры, а виртуальные машины, поддерживающие шифрование, позволяют администраторам структуры иметь тот же уровень доступа, что и для обычной виртуальной машины. Дополнительные сведения об этих различиях см. в статье [Обзор защищенной структуры и экранированных виртуальных машин](guarded-fabric-and-shielded-vms.md).

Выберите **экранированные виртуальные машины** , если вы хотите защитить виртуальную машину от скомпрометированной структуры (включая скомпрометированных администраторов). Их следует использовать в средах, где администраторы структуры и сама структура не являются доверенными. Выберите **Поддерживаемые шифрование виртуальные машины** , если вы ищете строку соответствия требованиям, для которой может потребоваться шифрование неактивных данных и шифрование виртуальной машины по сети (например, во время динамической миграции).

Виртуальные машины, поддерживаемые шифрованием, идеально подходят в средах, где администраторы структуры являются полностью доверенными, но шифрование остается обязательным.

Вы можете выполнять смесь обычных виртуальных машин, экранированных виртуальных машин и поддерживаемых шифрованием виртуальных машин в защищенной структуре и даже на одном узле Hyper-V.

Наличие экранированной виртуальной машины или поддержка шифрования определяется данными экранирования, выбранными при создании виртуальной машины. Владельцы виртуальных машин настраивают уровень безопасности при создании данных экранирования (см. раздел [данные экранирования](#shielding-data) ).
Обратите внимание, что после внесения этого выбора его нельзя изменить, пока виртуальная машина остается в структуре виртуализации.

## <a name="cryptographic-keys-used-for-shielded-vms"></a>Криптографические ключи, используемые для экранированных виртуальных машин

Экранированные виртуальные машины защищаются от векторов атак структуры виртуализации с помощью зашифрованных дисков и других зашифрованных элементов, которые могут быть расшифрованы только с помощью:

- Ключ владельца — это криптографический ключ, поддерживаемый владельцем виртуальной машины, который обычно используется для восстановления или устранения неполадок в последнем случае. Владельцы виртуальных машин несут ответственность за поддержку ключей владельца в безопасном месте.
- Один или несколько хранителей (ключи опекуна узла) — каждый защитник представляет структуру виртуализации, на которой владелец разрешает запускать экранированные виртуальные машины. Предприятия часто имеют как основную, так и аварийное восстановление (DR), и обычно разрешают их запуск на обеих виртуальных машинах. В некоторых случаях вторичная структура (DR) может размещаться у поставщика общедоступного облака. Закрытые ключи для любой защищенной структуры поддерживаются только в структуре виртуализации, в то время как открытые ключи могут быть скачаны и содержатся в его защитнике.

**Разделы справки создать ключ владельца?** Ключ владельца представляется двумя сертификатами. Сертификат для шифрования и сертификат для подписи. Эти два сертификата можно создать с помощью собственной инфраструктуры PKI или получить SSL-сертификаты из общедоступного центра сертификации (ЦС). В целях тестирования можно также создать самозаверяющий сертификат на любом компьютере, начиная с Windows 10 или Windows Server 2016.

**Сколько ключей владельца должно быть?** Можно использовать один ключ владельца или несколько ключей владельца. Рекомендации рекомендуют использовать один ключ владельца для группы виртуальных машин с одинаковым уровнем безопасности, доверия или уровня риска, а также для административного управления. Вы можете совместно использовать один ключ владельца для всех экранированных виртуальных машин, присоединенных к домену, и указать, что ключ владельца должен управляться администраторами домена.

**Можно ли использовать собственные ключи для защиты узла?** Да, вы можете "присвоить свой собственный ключ поставщику услуг размещения" и использовать этот ключ для экранированных виртуальных машин. Это позволяет использовать определенные ключи (в сравнении с ключом поставщика услуг размещения) и может использоваться при наличии конкретных требований к безопасности или нормативам, которые необходимо соблюдать. Для основных санации ключи защитника узла должны отличаться от ключей владельца.

## <a name="shielding-data"></a>Данные экранирования

Данные экранирования содержат секреты, необходимые для развертывания виртуальных машин, поддерживаемых экранированием или шифрованием. Он также используется при преобразовании обычных виртуальных машин в экранированные.

Данные экранирования создаются с помощью мастера файлов данных экранирования и хранятся в PDK-файлах, которые владельцы виртуальных машин отправляют в защищенную структуру.

Экранированные виртуальные машины помогают защититься от атак скомпрометированной структуры виртуализации, поэтому нам нужен надежный механизм для передачи конфиденциальных данных инициализации, таких как пароль администратора, учетные данные присоединение к домену или сертификаты RDP, не раскрывая их самой структуре виртуализации или ее администраторам. Кроме того, данные экранирования содержат следующие сведения:

1. Уровень безопасности — поддерживается экранирование или шифрование
2. Владелец и список опекунов доверенных узлов, в которых может выполняться виртуальная машина
3. Данные инициализации виртуальной машины (unattend.xml, сертификат RDP)
4. Список надежных дисков шаблонов с доверенной подписью для создания виртуальной машины в среде виртуализации

При создании виртуальной машины с экранированием или с поддержкой шифрования или при преобразовании существующей виртуальной машины вам будет предложено выбрать данные экранирования вместо запроса конфиденциальной информации.

**Сколько нужно файлов данных экранирования?** Для создания каждой экранированной виртуальной машины можно использовать один файл данных экранирования. Однако если для данной экранированной виртуальной машины требуется, чтобы любой из четырех элементов был разным, потребуется дополнительный файл данных экранирования. Например, у вас может быть один файл данных экранирования для ИТ-отдела и другой файл данных экранирования для отдела кадров, так как их первоначальный пароль администратора и сертификаты RDP различаются.

Хотя для каждой экранированной виртуальной машины можно использовать отдельные файлы данных экранирования, это необязательно является оптимальным выбором и должно выполняться по правильным причинам. Например, если для каждой экранированной виртуальной машины требуется другой пароль администратора, рассмотрите возможность использования службы управления паролями или средства, например, [решения Microsoft локального администратора (Lap)](https://www.microsoft.com/download/details.aspx?id=46899).

## <a name="creating-a-shielded-vm-on-a-virtualization-fabric"></a>Создание экранированной виртуальной машины в структуре виртуализации

Существует несколько вариантов создания экранированной виртуальной машины в структуре виртуализации (для виртуальных машин, поддерживаемых экранированием и шифрования):

1. Создание экранированной виртуальной машины в среде и ее отправка в структуру виртуализации
2. Создание новой экранированной виртуальной машины из подписанного шаблона в структуре виртуализации
3. Экранирование существующей виртуальной машины (существующая виртуальная машина должна иметь поколение 2 и должна работать под Windows Server 2012 или более поздней версии)

Создание новых виртуальных машин из шаблона является обычным методом. Тем не менее, поскольку диск шаблона, используемый для создания экранированной виртуальной машины, находится в структуре виртуализации, необходимо выполнить дополнительные меры, чтобы убедиться, что она не была незаконна администратором вредоносной структуры или вредоносной программой, работающей в структуре. Эта проблема решена с помощью подписанных дисков шаблонов. подписанные диски шаблонов и их подписи дисков создаются доверенными администраторами или владельцем виртуальной машины. При создании экранированной виртуальной машины подпись диска шаблона сравнивается с сигнатурами, содержащимися в указанном файле данных экранирования. Если любой из подписей файла данных экранирования соответствует подписи диска шаблона, процесс развертывания продолжится. Если совпадений не найдено, процесс развертывания прерывается, гарантируя, что секреты виртуальной машины не будут скомпрометированы из-за ненадежного диска шаблона.

При использовании подписанных дисков шаблонов для создания экранированных виртуальных машин доступны два варианта.

1. Используйте существующий подписанный диск шаблона, предоставленный поставщиком виртуализации. В этом случае поставщик виртуализации поддерживает подписанные диски шаблонов.
2. Отправьте подписанный диск шаблона в структуру виртуализации. Владелец виртуальной машины отвечает за поддержание дисков с подписанным шаблоном.


