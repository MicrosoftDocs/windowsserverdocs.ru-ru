---
title: Защищенной структуры и экранированной виртуальной Машины, руководство для поставщиков услуг размещения
ms.custom: na
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: 854defc8-99f8-4573-82c0-f484e0785859
manager: dongill
author: nirb-ms
ms.technology: security-guarded-fabric
ms.date: 08/29/2018
ms.openlocfilehash: f280fbe682ebf706ce6ea5b53ea8af5e6f39d75d
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59857815"
---
# <a name="guarded-fabric-and-shielded-vm-planning-guide-for-hosters"></a>Защищенной структуры и экранированной виртуальной Машины, руководство для поставщиков услуг размещения

>Относится к: Windows Server 2019 г., Windows Server (полугодовой канал), Windows Server 2016

В этом разделе рассматриваются этапы планирования, которые требуется сделать для включения экранированных виртуальных машин для запуска в структуре. Обновление существующих структуру Hyper-V или создания новой структуры, запуск экранированных виртуальных машин состоит из двух основных компонентов:

- Службы Защитника узлов (HGS) предоставляет аттестации и защиты ключей, поэтому можно убедиться в том, что экранированные виртуальные машины будут запускаться только на утвержденных и работоспособных узлов Hyper-V. 
- Утвержденные, так и работоспособных узлов Hyper-V, на которых может запускаться экранированные виртуальные машины (и обычными виртуальными машинами) — они известны как защищенных узлов.

![HGS и защищенный узел](../media/Guarded-Fabric-Shielded-VM/guarded-host-hgs-plus-host-diagram-basic.png)

## <a name="decision-1-trust-level-in-the-fabric"></a>Решение #1: Уровень в структуре доверия

Реализация службы защиты узла и защищенных узлов Hyper-V зависит главным образом надежности доверия, которое вы хотите достичь в структуре. Степень доверия регулируется режим аттестации. Существует два варианта взаимоисключающими:

1. Аттестация доверенного платформенного МОДУЛЯ

    Если ваша цель — для защиты виртуальных машин от вредоносных "Администраторы" или скомпрометированной структуры, будет использовать аттестацию доверенного платформенного МОДУЛЯ. Этот параметр хорошо подходит для размещения сценариях с несколькими клиентами также как и для ценные ресурсы в корпоративных средах, таких как контроллеры домена или серверов содержимого, например SQL или SharePoint.
    Проводятся политики целостности (HVCI) кода, защищенного с помощью низкоуровневой оболочки и их действительность, обеспечиваемая HGS, прежде чем будет разрешено выполнение узла экранированных виртуальных машин. 

2. Аттестация ключей узла

    Если требования к главным образом определяются соответствия, которое требуется виртуальной машины шифруются как при хранении, а также активных, будет использовать аттестацию ключей узла. Этот вариант подходит для центров обработки данных общего назначения, где вам удобно работать с Hyper-V узла и структуры Администраторы, имеющие доступ для гостевых операционных систем виртуальных машин для повседневного обслуживания и операций. 

    В этом режиме администратор структуры только она несет ответственность за обеспечение работоспособности узлов Hyper-V. 
    Поскольку HGS играет роль, нет в определении того, какова или не разрешено запускать, вредоносных программ и отладчики будет правильно работать. 
    
    Тем не менее отладчики, которые пытаются подключиться непосредственно к процессу (WinDbg.exe) блокируются для экранированных виртуальных машин, так как рабочий процесс виртуальной Машины (VMWP.exe) является свет защищенного процесса (PPL). 
    Альтернативные методы отладки, например используемые LiveKd.exe, не блокируются. 
    В отличие от экранированные виртуальные машины рабочий процесс для виртуальных машин с поддержкой шифрования не выполняет PPL, поэтому Традиционные отладчики, такие как WinDbg.exe продолжит работать нормально.

    Аналогичный режим аттестации с именем аттестацию с доверием администратора (на основе Active Directory) устарел начиная с Windows Server 2019. 

Выбранный уровень доверия будет определяться требования к оборудованию для узлов Hyper-V, а также политиках, применяемых в структуре. При необходимости можно развернуть в защищенной структуре, с помощью существующего оборудования и аттестацию с доверием администратора и затем преобразовать ее аттестации доверенного платформенного МОДУЛЯ при оборудование будет обновлен и укрепить безопасность fabric.

## <a name="decision-2-existing-hyper-v-fabric-versus-a-new-separate-hyper-v-fabric"></a>Решение #2: Существующие структуру Hyper-V и новый отдельную структуру Hyper-V

Если у вас есть существующие структуры (Hyper-V или других), это очень вероятно, что его можно использовать для запуска экранированных виртуальных машин вместе с обычными виртуальными машинами. Некоторые клиенты предпочитают интегрировать экранированных виртуальных машин в свои существующие средства и структур, вертикальные другие разделяют структуре для обеспечения бизнес.

## <a name="hgs-admin-planning-for-the-host-guardian-service"></a>Планирование службы защиты узла администратора HGS

Развертывание службы Защитника узлов (HGS) в среде имеет высокий уровень безопасности, будь то на выделенном сервере физический, экранированной виртуальной Машины, виртуальной Машины на изолированный узел Hyper-V (с запятыми из структуры защиты), или один, логически разделен, используя другой Azure подписка.   

| Область | Подробности |
|------|---------|
| Требования к установке | <ul><li>Один сервер (кластер с тремя узлами рекомендуется использовать для обеспечения высокой доступности)</li><li>Для отката необходимы по крайней мере два сервера HGS</li><li>Серверы можно, виртуальный или физический (репликация физических серверов с TPM 2.0 рекомендуется; TPM 1.2 также поддерживается)</li><li>Установка основных серверных компонентов Windows Server 2016 или более поздней версии</li><li>Сети напрямую обращаться к структуре, позволяя HTTP или [конфигурация резервирования.](guarded-fabric-manage-branch-office.md#fallback-configuration)</li><li>Сертификат HTTPS, рекомендуется использовать для проверки доступа</li></ul> |
| Изменения размера | Каждый узел сервера HGS среднего размера (8 core/4 ГБ) может обрабатывать 1000 узлов Hyper-V. |
| Management | Назначьте конкретные пользователи, которые будут управлять HGS. Они должны быть отдельно от администраторов структуры. Для сравнения HGS кластеров можно рассматривать так же, как сертификации (ЦС) с точки зрения администратора изоляции, физическое развертывание и общий уровень безопасности чувствительности. |
| Узел защиты службы Active Directory | По умолчанию HGS устанавливает свой собственный внутренний Active Directory для управления. Это является автономным, самостоятельно контролируемых леса и Рекомендуемая конфигурация может помочь выявить HGS из матрицы.<br><br>При наличии высоким уровнем привилегий леса Active Directory, который используется для изоляции леса можно использовать вместо леса по умолчанию HGS. Очень важно, что HGS не присоединен к домену в одном лесу с узлов Hyper-V или средств управления fabric. Это делает возможным fabric администратору, чтобы получить контроль над HGS. |
| Аварийное восстановление | Этот параметр может иметь три значения:<br><ol><li>Установить отдельный кластер HGS в каждом центре обработки данных и авторизуйте экранированных виртуальных машин для запуска в основного и резервного центров обработки данных. Это избавляет от необходимости растянутый кластер в глобальной сети и позволяет изолировать виртуальные машины, таким образом, они выполняются только в их назначенного сайта.</li><li>Установите HGS для растянутого кластера между центрами обработки данных два (или более). Это обеспечивает устойчивость, если глобальной сети выходит из строя, но помещает ограничения отказоустойчивой кластеризации. Не удается выявить рабочих нагрузок на одном узле; виртуальную Машину, авторизованных для запуска на одном сайте может работать на любой другой.</li><li>Регистрация узла Hyper-V в другой службе HGS переход на другой ресурс.</li></ol>Необходимо также создать резервную копию каждые HGS, экспортировав свою конфигурацию, чтобы вы всегда можете восстановить локально. Дополнительные сведения см. в разделе [экспорта HgsServerState](https://technet.microsoft.com/library/mt652164.aspx) и [HgsServerState импорта](https://technet.microsoft.com/library/mt652168.aspx). |
| Ключи службы защиты узла | Служба защиты узла использует две пары асимметричных ключей, ключ шифрования и ключ подписывания, каждый из которых представлен с использованием сертификата SSL. Для создания этих ключей двумя способами:<br><ol><li>Внутреннего центра сертификации — вы можете создавать эти ключи, с помощью внутренней инфраструктуры PKI. Это подходит для среды центра обработки данных.</li><li>Публично доверенных центров сертификации — использовать набор ключей, полученный из общедоступный доверенный центр сертификации. Это параметр, который следует использовать поставщиков услуг размещения.</li></ol>Обратите внимание, что хотя можно использовать самозаверяющие сертификаты, не рекомендуется для сценариев развертывания, отличных от лабораторные занятия по подтверждению концепции.<br><br>Помимо ключей HGS, поставщика услуг размещения можно использовать «Используй свой ключ,» которой клиенты могут создавать свои собственные ключи, таким образом, чтобы некоторые (или все) клиентов может иметь свои собственные определенного ключа HGS. Этот вариант подходит для поставщиков услуг размещения, которые могут предоставить процесс каналу для клиентов отправить свои ключи. |
| Хранилище ключей службы защиты узла | Для наиболее высокий уровень безопасности, возможно мы рекомендуем что HGS ключи создаются и хранятся исключительно в аппаратный модуль безопасности (HSM). Если вы не используете аппаратные модули безопасности, применение BitLocker на серверах HGS настоятельно рекомендуется. |

## <a name="fabric-admin-planning-for-guarded-hosts"></a>Fabric планирование администратора защищенных узлов

| Область | Подробности |
|------|---------|
| Оборудование | <ul><li>Аттестация ключей узла: Любое имеющееся оборудование можно использовать как на защищенный узел. Существует несколько исключений (чтобы убедиться, что ваш узел может использовать новые механизмы безопасности, начиная с Windows Server 2016, см. в разделе [совместимое оборудование с помощью защиты целостности кода на основе виртуализации Windows Server 2016](guarded-fabric-compatible-hardware-with-virtualization-based-protection-of-code-integrity.md).</li><li>Аттестация доверенного платформенного МОДУЛЯ: Можно использовать любой оборудования, предоставляющего [оборудования Assurance дополнительные уточнения](https://msdn.microsoft.com/windows/hardware/commercialize/design/compatibility/systems#system-server-assurance) до тех пор, пока он настроен соответствующим образом (см. в разделе [конфигурации сервера, которые соответствуют экранированных виртуальных машин и на основе виртуализации защиты целостности кода](guarded-fabric-compatible-hardware-with-virtualization-based-protection-of-code-integrity.md) для конкретной конфигурации). Сюда входят версии UEFI 2.3.1c и TPM 2.0 и более поздних версий.</li></ul> |
| ОС | Мы рекомендуем использовать вариант основных серверных компонентов для ОС узла Hyper-V. |
| Влияние на производительность | Исходя из тестирования производительности, мы ожидаем приблизительно 5% плотности различие между выполнения экранированных виртуальных машин и неэкранированные виртуальные машины. Это означает, что если заданный узел Hyper-V можно запустить 20 неэкранированные виртуальные машины, ожидается, что он выполняется 19 экранированных виртуальных машин.<br><br>Убедитесь в том, что для проверки изменения размера с типичные рабочие нагрузки. Например могут существовать некоторые выбросы с большим объемом записи ввода-ВЫВОДА рабочих нагрузок, которые дополнительно повлияют на разницу плотности. |
| Рекомендации для филиалов | Начиная с Windows Server версии 1709, можно указать резервный URL-адрес для виртуализированных HGS сервера, работающего локально как экранированной виртуальной Машины в филиале. Резервный URL-адрес может использоваться, когда филиале теряет связь с серверами HGS в центре обработки данных. В предыдущих версиях Windows Server узел Hyper-V, работающих в подключение потребности филиалов в службе защиты узла для включения питания или динамическая миграция экранированных виртуальных машин. Дополнительные сведения см. в разделе [ветви вопросы office](guarded-fabric-manage-branch-office.md). |
