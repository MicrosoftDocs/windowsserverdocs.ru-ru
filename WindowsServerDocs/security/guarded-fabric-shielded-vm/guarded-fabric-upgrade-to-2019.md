---
title: Обновление защищенной структуры до Windows Server 2019
ms.prod: windows-server-threshold
ms.topic: article
manager: dongill
author: rpsqrd
ms.technology: security-guarded-fabric
ms.date: 11/21/2018
ms.openlocfilehash: 39974806c02e55b37d3d16748c4ca0e3f361ee45
ms.sourcegitcommit: afb0602767de64a76aaf9ce6a60d2f0e78efb78b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/20/2019
ms.locfileid: "67284108"
---
# <a name="upgrade-a-guarded-fabric-to-windows-server-2019"></a>Обновление защищенной структуры до Windows Server 2019

> Относится к: Windows Server 2019 г., Windows Server (полугодовой канал), Windows Server 2016

В этой статье описываются действия, необходимые для обновления существующего защищенной структуры из Windows Server 2016, Windows Server версии 1709 или Windows Server версии ниже 1803 для Windows Server 2019.

## <a name="whats-new-in-windows-server-2019"></a>Новые возможности в Windows Server 2019

При запуске защищенной структуры на Windows Server 2019, можно воспользоваться преимуществами несколько новых возможностей:

**Аттестация ключей размещения** наши новейшие режим аттестации, позволяют легко запускать экранированные виртуальные машины, если узлы Hyper-V нет доступных устройств TPM 2.0 для аттестации доверенного платформенного МОДУЛЯ. Аттестация ключей узла использует пары ключей для проверки подлинности узлов с HGS, удаление требования для узлов, которую необходимо присоединить к домену Active Directory, устраняя AD доверие между HGS и корпоративный лес и снижает количество портов, откройте брандмауэр. Аттестация ключей узла заменяет аттестации Active Directory, который является устаревшим в Windows Server 2019.

**Версия v2 аттестации** — для поддержки аттестации ключ узла и новые функции в будущем, мы представили управление версиями для HGS. Установки HGS на Windows Server 2019 приведет к серверу с помощью аттестации v2, который означает, что он поддерживает Аттестация ключей узла для узлов Windows Server 2019 и по-прежнему поддерживают узлы v1 в Windows Server 2016. Обновление на месте для 2019 останется на уровне версии v1, пока вы вручную не включите v2. Теперь у многих командлетов есть параметр - HgsVersion, который позволяет указать, если вы хотите работать с политиками прежних версий или современных аттестации.

**Поддержка Linux экранированных виртуальных машин** -узлы Hyper-V под управлением Windows Server 2019 можно выполнения экранированные виртуальные машины Linux. Хотя Linux экранированных виртуальных машин были введены с появлением Windows Server версии 1709, Windows Server 2019 является первым выпуском канала обслуживания долго термин для их поддержки.

**Ветвление улучшения** -мы упростили для запуска экранированных виртуальных машин в филиалах с поддержкой автономных экранированные виртуальные машины и настроек резервирования на узлах Hyper-V.

**Доверенный платформенный модуль привязки к узлу** -для максимальной защиты рабочих нагрузок, где требуется экранированной виртуальной Машины для запуска только на первом узле, где он был созданный, но никакие другие, теперь можно привязать виртуальной Машины для этого узла, используя хоста доверенного платформенного МОДУЛЯ. Это лучше всего подходит для рабочих станций с привилегированным доступом и филиалов, а не рабочих нагрузок общего центра обработки данных, которые необходимо переносить между узлами.

## <a name="compatibility-matrix"></a>Матрица совместимости

Перед обновлением до Windows Server 2019 в защищенной структуре, проверьте в приведенной ниже таблице совместимости, чтобы увидеть, если ваша конфигурация поддерживается.

|  | WS2016 HGS | WS2019 HGS|
|---|---|---|
|**WS2016 Узел Hyper-V** | Поддерживается | Поддерживается<sup>1</sup>|
|**WS2019 Узел Hyper-V** | Неподдерживаемый<sup>2</sup> | Поддерживается|

<sup>1</sup> узлы Windows Server 2016, подтвердят только на серверах Windows Server 2019 HGS, с помощью протокола аттестации v1. Новые возможности, доступные исключительно в от используемого протокола аттестации v2, включая Аттестация ключей узла, не поддерживаются для узлов Windows Server 2016.

<sup>2</sup> корпорации Майкрософт известно о проблеме, предотвращая Windows Server 2019 узлы, использующие аттестацию доверенного платформенного МОДУЛЯ из успешно заверяющую на сервере Windows Server 2016 HGS. Это ограничение будет снято в будущем обновлении для Windows Server 2016.

## <a name="upgrade-hgs-to-windows-server-2019"></a>Обновление до Windows Server 2019 HGS

Мы рекомендуем обновить кластер HGS до Windows Server 2019 перед обновлением узлов Hyper-V для всех узлов ли они под управлением Windows Server 2016 или 2019 г., можно по-прежнему оценить, требуется ли успешно.

Обновление кластера HGS потребует временно удалить один узел из кластера за раз во время его обновления. Это позволит снизить емкостью кластера, чтобы отвечать на запросы с узлов Hyper-V и может привести к большим временем ответа или простои служб для клиентов. Убедитесь, что вы имеете достаточную емкость для обработки аттестации и выходом ключевых версий запросы перед обновлением развернутый сервер HGS.

Чтобы обновить кластер HGS, выполните следующие действия на каждом узле кластера, один узел за раз.

1.  Удалите сервер HGS из кластера, выполнив `Clear-HgsServer` в строке PowerShell с повышенными привилегиями. Этот командлет приведет к удалению хранилища реплицируются HGS, HGS веб-сайтов и узел из отказоустойчивого кластера.
2.  Если HGS сервер является контроллером домена (конфигурация по умолчанию), будет необходимо запустить `adprep /forestprep` и `adprep /domainprep` на первом узле, обновляется для подготовки домена для обновления ОС. См. в разделе [документации по обновлению доменных служб Active Directory](https://docs.microsoft.com/windows-server/identity/ad-ds/deploy/upgrade-domain-controllers#supported-in-place-upgrade-paths) Дополнительные сведения.
3.  Выполните [обновление на месте](../../get-started-19/install-upgrade-migrate-19.md) для Windows Server 2019.
4.  Запустите [Initialize HgsServer](guarded-fabric-configure-additional-hgs-nodes.md) соединить узел обратно в кластер.

Как только все узлы будут обновлены до Windows Server 2019, вы можете обновить HGS версии до версии 2 для поддержки новых функций, таких как Аттестация ключей узла.

```powershell
Set-HgsServerVersion  v2
```

## <a name="upgrade-hyper-v-hosts-to-windows-server-2019"></a>Обновление узлов Hyper-V для Windows Server 2019

Перед обновлением узлов Hyper-V для Windows Server 2019, убедитесь, что HGS кластера уже обновлен до Windows Server 2019 и что после перемещения всех виртуальных машин с сервера Hyper-V.

1.  При использовании политики целостности кода для управления приложениями в Защитнике Windows на сервере (всегда так при использовании аттестации доверенного платформенного МОДУЛЯ), убедитесь, что политика находится в режиме аудита или отключены перед повторной попыткой обновления сервера. [Дополнительные сведения об отключении политики WDAC](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-application-control/disable-windows-defender-application-control-policies)
2.  Следуйте указаниям в [Центр обновления Windows Server](http://aka.ms/upgradecenter) обновление ведущее приложение для Windows Server 2019. Если на узле Hyper-V входит в отказоустойчивый кластер, рассмотрите возможность использования [последовательного обновления кластерной ОС](../../failover-clustering/Cluster-Operating-System-Rolling-Upgrade.md).
3.  [Тестирование и повторное включение](https://docs.microsoft.com/windows/security/threat-protection/windows-defender-application-control/audit-windows-defender-application-control-policies) политики управления приложениями в Защитнике Windows, если у вас есть один включена до обновления.
4.  Запустите `Get-HgsClientConfiguration` для проверки, если **IsHostGuarded = True**, то есть узел успешно передает аттестацию с сервером HGS.
5.  При использовании аттестации TPM, может потребоваться [повторно записать политику целостности кода или базовый показатель доверенного платформенного МОДУЛЯ](guarded-fabric-add-host-information-for-tpm-trusted-attestation.md) после обновления до пройти аттестацию.
6.  Запущены экранированных виртуальных машин на узле снова!

## <a name="switch-to-host-key-attestation"></a>Переключиться в режим размещения Аттестация ключей

Если в данный момент выполняются аттестации на основе Active Directory и хотите обновить до Аттестация ключей узла, выполните следующие действия. Обратите внимание, что аттестации на основе Active Directory в Windows Server 2019 устарел и могут быть удалены в будущих выпусках.

1.  Убедитесь, что сервер HGS работает в режиме аттестации v2, выполнив следующую команду. Существующие узлы v1 продолжит подтверждающим даже в том случае, когда сервер HGS обновляется до версии 2.

    ```powershell
    Set-HgsServerVersion v2
    ```

2.  [Создание ключей узла](guarded-fabric-create-host-key.md) от каждого из Hyper-V размещает и их регистрации в службе HGS. Поскольку HGS по-прежнему работает в режиме Active Directory, вы получите предупреждение, что новые ключи узла не немедленно вступает в силу. Это намеренно, так как вы не хотите изменяется на хост-ключа режим, пока все узлы можно оценить, требуется ли с ключами узла успешно.

3.  После регистрации узла ключей для каждого узла можно настроить HGS для использования аттестации ключей хост-режим:

    ```powershell
    Set-HgsServer -TrustHostKey
    ```

    Если возникли проблемы при использовании режима ключей узла и вам необходимо вернуться к аттестации на основе Active Directory, выполните следующую команду на HGS:

    ```powershell
    Set-HgsServer -TrustActiveDirectory
    ```