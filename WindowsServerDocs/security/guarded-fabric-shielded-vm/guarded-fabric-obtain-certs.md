---
title: Получение сертификатов для HGS
ms.custom: na
ms.prod: windows-server-threshold
ms.topic: article
ms.assetid: f4b4d1a8-bf6d-4881-9150-ddeca8b48038
manager: dongill
author: rpsqrd
ms.technology: security-guarded-fabric
ms.date: 08/29/2018
ms.openlocfilehash: 14ee8eb6431a266d05897160d241d63e8cdb09a4
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59887735"
---
# <a name="obtain-certificates-for-hgs"></a>Получение сертификатов для HGS

>Относится к: Windows Server 2019 г., Windows Server (полугодовой канал), Windows Server 2016

При развертывании HGS, вам будет предложено предоставить сертификаты подписывания и шифрования, которые используются для защиты конфиденциальных данных, необходимых для загрузки экранированной виртуальной Машины.
Эти сертификаты никогда не оставьте HGS и используются только для ключей расшифровки экранированных виртуальных Машин при узел, на котором они выполняются оказалось, что он работоспособен.
Клиенты (Владельцы виртуальных Машин) использовать общедоступный, половина сертификаты в для авторизации центра обработки данных для выполнения их экранированные виртуальные машины.
В этом разделе рассматриваются шаги, необходимые для получения совместимых сертификатов подписи и шифрования для HGS.

## <a name="request-certificates-from-your-certificate-authority"></a>Запрашивать сертификаты из центра сертификации

Не обязательно, настоятельно рекомендуется получить сертификаты из доверенного центра сертификации.
Это облегчит Владельцы виртуальных Машин убедитесь, что они авторизации правильный сервер HGS (т. е. поставщика услуг или центра обработки данных) для выполнения их экранированные виртуальные машины.
На предприятии можно использовать собственный центр сертификации предприятия для выдачи этих сертификатов.
Поставщикам услуг размещения и поставщикам услуг следует рассмотреть возможность использования хорошо известного, общедоступный ЦС вместо этого.

Сертификаты подписи и шифрования должны быть выданы со следующими свойствами сертификат, (если только помеченные «рекомендованных»):

Свойства шаблона сертификата | Обязательное значение 
------------------------------|----------------
Поставщик криптографии               | Любой поставщик хранилища ключей (KSP). Устаревшие поставщики службы криптографии (CSP), **не** поддерживается.
Алгоритм ключа                 | RSA
Минимальный размер ключа              | 2048 бит
Алгоритм подписи           | Рекомендуемое: SHA256
Использование ключей                     | Цифровая подпись *и* шифрование данных
Расширенное использование ключа            | Проверка подлинности сервера
Пока выполняется обновление ключа политики            | Обновление с прежним ключом. Обновление сертификатов HGS с разными ключами будет препятствовать запуск экранированных виртуальных машин.
Имя субъекта                  | Рекомендуется: имя или веб-адрес организации. Эти сведения будут отображаться Владельцы виртуальных Машин в мастер файлов данных экранирования.

Эти требования применяются независимо используются сертификаты, оборудования или программного обеспечения.
По соображениям безопасности рекомендуется создавать ключи HGS в аппаратный модуль безопасности (HSM) для предотвращения закрытые ключи от копирования выход из системы.
Следуйте указаниям из поставщику HSM для запроса сертификатов с помощью указанных атрибутов и убедитесь, что для установки и авторизовать KSP HSM на каждом узле HGS.

Каждый узел HGS требуется доступ к тем же подписи и сертификатов шифрования.
Если вы используете сертификаты на основе программного обеспечения, можно экспортировать в PFX-файл с помощью пароля и разрешить HGS для управления сертификатами для вас.
Также можно установить сертификаты в хранилище сертификатов локального компьютера на каждом узле HGS, а затем предоставить отпечаток HGS.
Оба варианта описаны в [инициализировать кластер HGS](guarded-fabric-initialize-hgs.md) раздела.

## <a name="create-self-signed-certificates-for-test-scenarios"></a>Создать самозаверяющие сертификаты для тестовых сценариев

Если при создании лабораторной среды HGS и не имеют или требуется использование центра сертификации, можно создать самозаверяющие сертификаты.
Вы получите предупреждение при импорте данные сертификата в мастер файлов данных экранирования, но все функциональные возможности остается неизменным.

Чтобы создать самозаверяющий сертификат и экспортировать их в PFX-файл, выполните следующие команды PowerShell:

```powershell
$certificatePassword = Read-Host -AsSecureString -Prompt "Enter a password for the PFX file"

$signCert = New-SelfSignedCertificate -Subject "CN=HGS Signing Certificate"
Export-PfxCertificate -FilePath .\signCert.pfx -Password $certificatePassword -Cert $signCert
Remove-Item $signCert.PSPath

$encCert = New-SelfSignedCertificate -Subject "CN=HGS Encryption Certificate"
Export-PfxCertificate -FilePath .\encCert.pfx -Password $certificatePassword -Cert $encCert
Remove-Item $encCert.PSPath
```

## <a name="request-an-ssl-certificate"></a>Запрос SSL-сертификата

Все ключи и конфиденциальные данные, передаваемые между узлами Hyper-V и на уровне сообщения шифруются HGS — то есть эта информация шифруется с помощью ключей, известные как для HGS или Hyper-V, предотвращая кто-то из перехват сетевого трафика и кражу ключи к виртуальным машинам.
Тем не менее если у вас reqiurements соответствия или просто хотите шифровать обмен данными между Hyper-V и HGS, можно настроить HGS с SSL-сертификат, который шифрует все данные на уровне транспорта.

HGS узлы и узлы Hyper-V необходимо доверять SSL-сертификат, который вы укажете, поэтому рекомендуется запросе SSL-сертификат от центра сертификации предприятия. При запросе сертификата, не забудьте задать следующие параметры:

Свойства сертификата SSL | Обязательное значение
-------------------------|---------------
Имя субъекта             | Имя кластера HGS (имя распределенной сети). Это будет результатом конкатенации для имени службы HGS `Initialize-HgsServer` и имя вашего домена HGS.
Альтернативное имя субъекта | Если вы будете использовать другое DNS-имя для доступа к кластеру HGS (например в случае с подсистемой балансировки нагрузки), не забудьте включить эти DNS-имена в поле SAN для запроса сертификата.

Параметры для указания этого сертификата, при инициализации сервера HGS охваченных [настроить первый узел HGS](guarded-fabric-initialize-hgs.md).
Можно также добавить или изменить SSL-сертификат в позже, используя [HgsServer набора](https://docs.microsoft.com/powershell/module/hgsserver/set-hgsserver?view=win10-ps) командлета.

## <a name="next-step"></a>Дальнейшие действия

>[!div class="nextstepaction"]
[Установка HGS](guarded-fabric-choose-where-to-install-hgs.md)