---
title: Получение сертификатов для HGS
ms.topic: article
ms.assetid: f4b4d1a8-bf6d-4881-9150-ddeca8b48038
manager: dongill
author: rpsqrd
ms.author: ryanpu
ms.date: 09/25/2019
ms.openlocfilehash: 0f9499402a5788cd3dc9ad9cd262d65636f9284c
ms.sourcegitcommit: 076504a92cddbd4b84bfcd89da1bf1c8c9e79495
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/03/2020
ms.locfileid: "89427496"
---
# <a name="obtain-certificates-for-hgs"></a>Получение сертификатов для HGS

>Область применения: Windows Server 2019, Windows Server (половина ежегодного канала), Windows Server 2016

При развертывании HGS вам будет предложено предоставить сертификаты подписи и шифрования, которые используются для защиты конфиденциальной информации, необходимой для запуска экранированной виртуальной машины.
Эти сертификаты никогда не оставляют HGS и используются только для расшифровки экранированных ключей виртуальных машин, когда узел, на котором они выполняются, доказан, что он работоспособен.
Клиенты (владельцы виртуальных машин) используют общедоступную половину сертификатов, чтобы авторизовать центр обработки данных для запуска экранированных виртуальных машин.
В этом разделе описаны шаги, необходимые для получения совместимых сертификатов подписывания и шифрования для HGS.

## <a name="request-certificates-from-your-certificate-authority"></a>Запрос сертификатов из центра сертификации

Хотя это и не является обязательным, настоятельно рекомендуется получать сертификаты из доверенного центра сертификации.
Это помогает владельцам виртуальных машин убедиться, что они выполняют авторизацию правильного сервера HGS (т. е. поставщика услуг или центра обработки данных) для запуска экранированных виртуальных машин.
В корпоративном сценарии вы можете использовать собственный ЦС предприятия для выпуска этих сертификатов.
Поставщики услуг размещения и службы должны использовать хорошо известный общедоступный ЦС.

Оба сертификата подписывания и шифрования должны быть выданы со следующими свойствами цертифиЦиате (если не отмечено как "рекомендуемый"):

Свойство шаблона сертификата | Обязательное значение
------------------------------|----------------
Поставщик криптографии               | Любой поставщик хранилища ключей (KSP). Устаревшие поставщики служб шифрования (CSP) **не** поддерживаются.
Алгоритм ключа                 | RSA
Минимальный размер ключа              | 2048 бит
Алгоритм подписи           | Рекомендуется: SHA256
Использование ключа                     | Цифровая подпись *и* шифрование данных
Расширенное использование ключа            | Проверка подлинности сервера
Политика обновления ключей            | Продлить с помощью того же ключа. Обновление сертификатов HGS с разными ключами предотвратит запуск экранированных виртуальных машин.
Имя субъекта                  | Рекомендуется: название или веб-адрес вашей компании. Эти сведения будут отображаться для владельцев виртуальных машин в мастере файлов данных экранирования.

Эти требования относятся к использованию сертификатов, поддерживаемых оборудованием или программным обеспечением.
По соображениям безопасности рекомендуется создавать ключи HGS в аппаратном модуле безопасности (HSM), чтобы предотвратить копирование закрытых ключей из системы.
Следуйте указаниям поставщика HSM, чтобы запросить сертификаты с указанными выше атрибутами, и не забудьте установить и авторизовать KSP HSM на каждом узле HGS.

Каждому узлу HGS потребуется доступ к одним и тем же сертификатам подписи и шифрования.
Если вы используете программно-ориентированные сертификаты, вы можете экспортировать сертификаты в PFX-файл с паролем и разрешить службе HGS управлять сертификатами.
Вы также можете установить сертификаты в хранилище сертификатов локального компьютера на каждом узле HGS и предоставить отпечаток для HGS.
Оба варианта описаны в разделе [Инициализация кластера HGS](guarded-fabric-initialize-hgs.md) .

## <a name="create-self-signed-certificates-for-test-scenarios"></a>Создание самозаверяющих сертификатов для тестовых сценариев

Если вы создаете лабораторную среду HGS и не хотите использовать центр сертификации, можно создать самозаверяющие сертификаты.
При импорте сведений о сертификате в мастере файлов данных экранирования будет выдано предупреждение, но все функциональные возможности останутся прежними.

Чтобы создать самозаверяющие сертификаты и экспортировать их в PFX-файл, выполните следующие команды в PowerShell:

```powershell
$certificatePassword = Read-Host -AsSecureString -Prompt "Enter a password for the PFX file"

$signCert = New-SelfSignedCertificate -Subject "CN=HGS Signing Certificate" -KeyUsage DataEncipherment, DigitalSignature
Export-PfxCertificate -FilePath .\signCert.pfx -Password $certificatePassword -Cert $signCert
Remove-Item $signCert.PSPath

$encCert = New-SelfSignedCertificate -Subject "CN=HGS Encryption Certificate" -KeyUsage DataEncipherment, DigitalSignature
Export-PfxCertificate -FilePath .\encCert.pfx -Password $certificatePassword -Cert $encCert
Remove-Item $encCert.PSPath
```

## <a name="request-an-ssl-certificate"></a>Запрос SSL-сертификата

Все ключи и конфиденциальная информация, передаваемая между узлами Hyper-V и HGS, шифруются на уровне сообщений. Это означает, что информация шифруется с помощью ключей, известных либо для HGS, либо для Hyper-V, что предотвращает перехват сетевого трафика и кражи ключей для виртуальных машин.
Однако если у вас есть соответствие рекиурементс или просто предпочитаете шифрование всех сообщений между Hyper-V и HGS, вы можете настроить HGS с помощью SSL-сертификата, который будет шифровать все данные на транспортном уровне.

Как узлы Hyper-V, так и узлы HGS должны доверять предоставленному SSL-сертификату, поэтому рекомендуется запросить сертификат SSL из центра сертификации предприятия. При запросе сертификата обязательно укажите следующее:

Свойство SSL-сертификата | Обязательное значение
-------------------------|---------------
Имя субъекта             | Имя кластера HGS (название распределенной сети или полное доменное имя объекта виртуального компьютера). Это будет объединение имени службы HGS, предоставленного в `Initialize-HgsServer` , и имени домена HGS.
Альтернативное имя субъекта | Если для достижения кластера HGS будет использоваться другое DNS-имя (например, если оно находится за подсистемой балансировки нагрузки), обязательно включите эти DNS-имена в поле SAN запроса на сертификат.

Параметры для указания этого сертификата при инициализации сервера HGS рассматриваются в разделе [Настройка первого узла HGS](guarded-fabric-initialize-hgs.md).
Вы также можете добавить или изменить SSL-сертификат позже с помощью командлета [Set-HgsServer](/powershell/module/hgsserver/set-hgsserver?view=win10-ps) .

## <a name="next-step"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Установка HGS](guarded-fabric-choose-where-to-install-hgs.md)
