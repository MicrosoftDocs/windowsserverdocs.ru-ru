---
title: Создание корневого ключа служб распространения ключей (KDS)
description: Безопасность Windows Server
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-gmsa
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 42e5db8f-1516-4d42-be0a-fa932f5588e9
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 3d5f7b46b28e6a2fbfafb664b69aebc8d34886fe
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/17/2019
ms.locfileid: "59867215"
---
# <a name="create-the-key-distribution-services-kds-root-key"></a>Создание корневого ключа служб распространения ключей (KDS)

>Область применения. Windows Server (полугодовой канал), Windows Server 2016

В этом разделе для ИТ-специалистов описывается создать корневой ключ службы распространения ключей Майкрософт (kdssvc.dll) на контроллере домена, с помощью Windows PowerShell для создания паролей к групповым управляемую учетную запись службы в Windows Server 2012.

 Контроллеры домена Windows Server 2012 (DC) необходим корневой ключ для начала создания паролей gMSA. Групповые управляемые учетные записи служб создаются только через 10 часов после создания ключа, чтобы все контроллеры доменов успели выполнить схождение своих репликаций Active Directory. Это сделано для того, чтобы генерация паролей не началась прежде, чем все контроллеры доменов в среде смогут ответить на запросы групповой управляемой учетной записи службы.  При попытке использовать управляемой слишком рано ключ может не были реплицированы на все контроллеры домена Windows Server 2012, и поэтому получение пароля может завершиться ошибкой при попытке получить пароль узла групповой управляемой учетной записи. Ошибка получения пароля групповой управляемой учетной записью служб может возникнуть также при использовании контроллеров домена с ограниченным расписанием репликации или при наличии проблем с репликацией.

Минимальным требованием для выполнения этой процедуры является членство в группе **Администраторы домена**, **Администраторы предприятия** или другой эквивалентной группе. Дополнительные сведения об использовании подходящих учетных записей и членства в группах см. в разделе [Локальные группы и группы домена по умолчанию](https://technet.microsoft.com/library/dd728026(WS.10).aspx).

> [!NOTE]
> Для выполнения команд Windows PowerShell, которые используются для администрирования групповых управляемых учетных записей служб, необходима 64-разрядная архитектура.

#### <a name="to-create-the-kds-root-key-using-the-add-kdsrootkey-cmdlet"></a>Создание корневого ключа KDS с помощью командлета Add-KdsRootKey

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Добавление KdsRootKey - EffectiveImmediately**

    > [!TIP]
    > Для предоставления контроллерам доменов достаточного времени для получения ключей перед их использованием можно использовать параметр "Срок действия". С помощью Add-KdsRootKey - EffectiveImmediately добавит корневой ключ для целевого контроллера домена, которая будет использоваться службой KDS немедленно. Тем не менее другие контроллеры домена Windows Server 2012 нельзя будет использовать корневой ключ вплоть до завершения репликации.

В тестовых средах с одним контроллером домена можно создать корневой ключ KDS и установить начальную дату в прошлом, выполнив указанные ниже действия. Это позволит избежать периода ожидания для генерирования ключа. При этом в журнале событий KDS должно зарегистрироваться событие 4004.

#### <a name="to-create-the-kds-root-key-in-a-test-environment-for-immediate-effectiveness"></a>Создание корневого ключа KDS в тестовой среде для незамедлительного использования

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **$= Get-Date**

    **$b=$a.AddHours(-10)**

    **Добавление KdsRootKey - EffectiveTime $b**

    Либо введите одну команду:

    **Добавление KdsRootKey - EffectiveTime ((get-date).addhours(-10))**

## <a name="see-also"></a>См. также
[Приступая к работе с группой управляемые учетные записи служб](getting-started-with-group-managed-service-accounts.md)


