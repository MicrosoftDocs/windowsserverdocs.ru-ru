---
title: "Создание корневого ключа KDS службы распространения ключей"
description: "Безопасность Windows Server"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-gmsa
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 42e5db8f-1516-4d42-be0a-fa932f5588e9
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 30075e56f3ca8e90a0655508efeacfcf2aaa0337
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="create-the-key-distribution-services-kds-root-key"></a>Создание корневого ключа KDS службы распространения ключей

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

В этом разделе для ИТ-специалистов описывается, как создать корневой ключ службы распространения ключей Майкрософт (kdssvc.dll) на контроллере домена, с помощью Windows PowerShell для создания групповой управляемой учетной записи службы пароли в Windows Server 2012.

 Контроллеры домена Windows Server 2012 (DC) необходим корневой ключ для создания паролей групповой управляемой учетной записи. Контроллеры домена будет ожидать до 10 часов с момента создания, чтобы все контроллеры домена, выполнить схождение своих репликаций AD перед разрешением на создание групповой управляемой учетной записи. 10 часов — это мера безопасности для предотвращения генерация паролей началась прежде, чем все контроллеры домена в среде смогут ответить на запросы групповой управляемой учетной записи.  Если вы попытаетесь использовать управляемую слишком рано ключ может не были реплицированы на все контроллеры домена Windows Server 2012 и поэтому получение пароля может оказаться неудачной попытка узла групповой управляемой учетной записи получить пароль. Ошибка получения пароля групповой управляемой учетной записи также может возникать при использовании контроллеров домена с ограниченным расписанием репликации или при наличии проблем репликации.

Членство в группе **"Администраторы домена"** или **администраторов предприятия** групп, либо эквивалентной, является минимальным требованием для выполнения этой процедуры. Подробные сведения об использовании соответствующих учетных записей и членства в группах см. в разделе [локальные и доменные группы по умолчанию](https://technet.microsoft.com/library/dd728026(WS.10).aspx).

> [!NOTE]
> Для выполнения команд Windows PowerShell, которые используются для администрирования групповых управляемых учетных записей служб, необходима 64-разрядной архитектуры.

#### <a name="to-create-the-kds-root-key-using-the-new-kdsrootkey-cmdlet"></a>Создание корневого ключа KDS с помощью командлета New-KdsRootKey

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **Add-KdsRootKey - EffectiveImmediately**

    > [!TIP]
    > Срок действия параметр можно использовать для предоставления времени для ключей передаются на все контроллеры домена, перед использованием. Команда Add-KdsRootKey - EffectiveImmediately добавляет корневой ключ к целевому контроллеру домена, который будет использоваться службой KDS, незамедлительно. Тем не менее другие контроллеры домена Windows Server 2012 нельзя будет использовать этот корневой ключ вплоть до завершения репликации.

В тестовых средах с одним контроллером домена можно создать корневой ключ KDS и установить начальную дату в прошлом, чтобы избежать периода ожидания для генерирования ключа с помощью следующей процедуры. Проверьте, что регистрации в журнале событий kds должно зарегистрироваться событие 4004.

#### <a name="to-create-the-kds-root-key-in-a-test-environment-for-immediate-effectiveness"></a>Создание корневого ключа KDS в тестовой среде для незамедлительного использования

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **$= Get-Date.**

    **$b=$a.AddHours(-10)**

    **Add-KdsRootKey - EffectiveTime $b**

    Или введите одну команду:

    **Add-KdsRootKey - EffectiveTime ((get-date).addhours(-10))**

## <a name="see-also"></a>См. также:
[Начало работы с групповыми управляемыми учетными записями служб](getting-started-with-group-managed-service-accounts.md)


