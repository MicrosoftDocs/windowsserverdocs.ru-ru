---
title: Создать корневой ключ KDS службы распространения ключей
description: Безопасность Windows Server
ms.topic: article
ms.assetid: 42e5db8f-1516-4d42-be0a-fa932f5588e9
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 90fa1203f09bc04b27885034895e52db5fa1c5f0
ms.sourcegitcommit: dfa48f77b751dbc34409aced628eb2f17c912f08
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2020
ms.locfileid: "87971491"
---
# <a name="create-the-key-distribution-services-kds-root-key"></a>Создать корневой ключ KDS службы распространения ключей

>Область применения. Windows Server (Semi-Annual Channel), Windows Server 2016

В этой статье для ИТ-специалистов описывается создание корневого ключа службы распространения ключей (kdssvc.dll) на контроллере домена с помощью Windows PowerShell для создания групповых управляемых паролей учетных записей служб в Windows Server 2012 или более поздней версии.

Контроллеры домена должны иметь корневой ключ, чтобы начать создавать пароли gMSA. Групповые управляемые учетные записи служб создаются только через 10 часов после создания ключа, чтобы все контроллеры доменов успели выполнить схождение своих репликаций Active Directory. Это сделано для того, чтобы генерация паролей не началась прежде, чем все контроллеры доменов в среде смогут ответить на запросы групповой управляемой учетной записи службы.  Если вы попытаетесь использовать gMSA слишком быстро, возможно, ключ не был реплицирован на все контроллеры домена, поэтому получение пароля может завершиться ошибкой, когда узел gMSA попытается получить пароль. Ошибка получения пароля групповой управляемой учетной записью служб может возникнуть также при использовании контроллеров домена с ограниченным расписанием репликации или при наличии проблем с репликацией.

> [!NOTE]
> Удаление и повторное создание корневого ключа может привести к проблемам, когда старый ключ будет продолжать использоваться после удаления из-за кэширования ключа. При повторном создании корневого ключа служба распространения ключей (KDC) должна быть перезапущена на всех контроллерах домена.

Минимальным требованием для выполнения этой процедуры является членство в группе **Администраторы домена**, **Администраторы предприятия** или другой эквивалентной группе. Дополнительные сведения об использовании подходящих учетных записей и участия в группах см. в разделе [Локальные группы и группы домена по умолчанию](https://technet.microsoft.com/library/dd728026(WS.10).aspx).

> [!NOTE]
> Для выполнения команд Windows PowerShell, которые используются для администрирования групповых управляемых учетных записей служб, необходима 64-разрядная архитектура.

#### <a name="to-create-the-kds-root-key-using-the-add-kdsrootkey-cmdlet"></a>Создание корневого ключа KDS с помощью командлета Add-Кдсруткэй

1.  На контроллере домена Windows Server 2012 или более поздней версии запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Add-Кдсруткэй-Еффективеиммедиатели**

    > [!TIP]
    > Для предоставления контроллерам доменов достаточного времени для получения ключей перед их использованием можно использовать параметр "Срок действия". Использование Add-Кдсруткэй-Еффективеиммедиатели добавит корневой ключ к целевому контроллеру домена, который будет использоваться службой KDS немедленно. Однако другие контроллеры домена не смогут использовать корневой ключ до тех пор, пока репликация не будет успешной.

В тестовых средах с одним контроллером домена можно создать корневой ключ KDS и установить начальную дату в прошлом, выполнив указанные ниже действия. Это позволит избежать периода ожидания для генерирования ключа. При этом в журнале событий KDS должно зарегистрироваться событие 4004.

#### <a name="to-create-the-kds-root-key-in-a-test-environment-for-immediate-effectiveness"></a>Создание корневого ключа KDS в тестовой среде для незамедлительного использования

1.  На контроллере домена Windows Server 2012 или более поздней версии запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **$a=Get-Date**

    **$b=$a.AddHours(-10)**

    **Add-Кдсруткэй-Еффективетиме $b**

    Либо введите одну команду:

    **Add-Кдсруткэй-Еффективетиме ((Get-Date). AddHours (-10))**

## <a name="see-also"></a>См. также:
[начало работы с групповыми управляемыми учетными записями службы](getting-started-with-group-managed-service-accounts.md)


