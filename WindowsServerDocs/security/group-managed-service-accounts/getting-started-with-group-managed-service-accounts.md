---
title: "Начало работы с групповыми управляемыми учетными записями служб"
description: "Безопасность Windows Server"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-gmsa
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 7130ad73-9688-4f64-aca1-46a9187a46cf
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: cd1e92f93701e5b430d1425fcf9a2f3590d1fe5d
ms.sourcegitcommit: db290fa07e9d50686667bfba3969e20377548504
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/12/2017
---
# <a name="getting-started-with-group-managed-service-accounts"></a>Начало работы с групповыми управляемыми учетными записями служб

>Область применения: Windows Server (канал точками годовой), Windows Server 2016


В этом руководстве приведены пошаговые инструкции и общие сведения об активации и использовании групповых управляемых учетных записей служб в Windows Server 2012.

**В этом документе**

-   [Предварительные требования](#BKMK_Prereqs)

-   [Введение](#BKMK_Intro)

-   [Развертывание фермы серверов федерации](#BKMK_DeployNewFarm)

-   [Добавление узлов в существующую ферму серверов](#BKMK_AddMemberHosts)

-   [Обновление свойств групповой учетной записи службы](#BKMK_Update_gMSA)

-   [Списание узлов из существующей фермы серверов](#BKMK_DecommMemberHosts)


> [!NOTE]
> Этот раздел содержит пример командлеты Windows PowerShell, который можно использовать для автоматизации некоторых описанных процедур. Дополнительные сведения см. в разделе [использование командлетов](https://go.microsoft.com/fwlink/p/?linkid=230693).

## <a name="BKMK_Prereqs"></a>Предварительные требования
См. в разделе в подразделе на [требования для групповых управляемых учетных записей служб](#BKMK_gMSA_Req).

## <a name="BKMK_Intro"></a>Введение
Когда клиентский компьютер подключается к службе, размещенной на ферме серверов с использованием балансировки сетевой нагрузки (NLB) или другого метода, с которой все серверы кажутся одной и той же службы клиенту, затем протоколы проверки подлинности, поддерживающие взаимную проверку подлинности, например Kerberos не может использоваться только если на всех экземплярах служб используется один и тот же субъект. Это означает, что каждой службы должно использовать те же пароли и ключи для окончательного подтверждения удостоверения.

> [!NOTE]
> Отказоустойчивые кластеры не поддерживают gMSAs. Тем не менее службы, работающие поверх службы кластеров можно использовать управляемую или автономную, если они службы Windows, пул приложений, назначенного задания, или иметь встроенную поддержку групповой управляемой учетной записи или автономную.

Службы имеют следующие субъекты для выбора и каждого есть определенные ограничения.

|Субъекты|Область|Поддерживаемые службы|Управление паролями|
|-------|-----|-----------|------------|
|Компьютерная система учетную запись Windows|Домен|Ограничена одним доменом присоединен сервер|Управляется компьютером|
|Учетная запись компьютера без системы Windows|Домен|Любой сервер в домене|Нет|
|Виртуальная учетная запись|Локальный|Ограничена одним сервером|Управляется компьютером|
|Автономные управляемые учетные записи служб для Windows 7|Домен|Ограничена одним доменом присоединен сервер|Управляется компьютером|
|Учетная запись пользователя|Домен|Любой сервер в домене|Нет|
|Групповой управляемой учетной записи службы|Домен|Любой сервер присоединен к домену Windows Server 2012|Управляется контроллером домена и извлекается узлом|

Учетные записи компьютеров Windows или автономные управляемые учетные записи служб (автономные), Windows 7 и виртуальные учетные записи не могут использоваться совместно несколькими системами. Если настроить учетную запись службы на фермах серверов, необходимо будет выбрать учетную запись пользователя или учетную запись компьютера, помимо системы Windows. В любом случае эти учетные записи не имеют возможности управления паролями одной точки элемента управления. Это создает проблему, где каждой организации придется создавать дорогое решение для обновления ключей для службы в Active Directory, а затем распространить ключи, чтобы все экземпляры этих служб.

В Windows Server 2012 службам или администраторам служб не требуется управлять синхронизацией паролей между экземплярами служб при использовании групповых управляемых учетных записей служб (gMSA). Подготовки групповой управляемой учетной записи в AD, а затем настройте службу, поддерживающую управляемые учетные записи служб. Этот способ позволяет подготовить групповой управляемой учетной записи с помощью *-ADServiceAccount командлеты, которые являются частью этого модуля Active Directory. Конфигурацию удостоверения службы на узле поддерживается:

-   Те же API, что и для автономных, поэтому продукты, которые поддерживают автономные поддерживают и групповые

-   Службы, которые используют диспетчер управления службами для настройки удостоверения для входа в систему

-   Службы, которые используют для настройки удостоверения диспетчер IIS для пулов приложений

-   Задачи с помощью планировщика заданий.

### <a name="BKMK_gMSA_Req"></a>Требования для групповых управляемых учетных записей служб
В следующей таблице перечислены требования к операционной системе для проверки подлинности Kerberos для работы со службами, использующими групповой управляемой учетной записи. Требования к Active Directory перечислены под таблицей.

Для выполнения команд Windows PowerShell, которые используются для администрирования групповых управляемых учетных записей служб, необходима 64-разрядной архитектуры.

**Требования к операционной системе**

|Элемент|Требования|Операционная система|
|------|--------|----------|
|Узел клиентского приложения|RFC-совместимый клиент Kerberos|Не ниже Windows XP|
|Контроллеры домена учетной записи пользователя|RFC-совместимый KDC|Не ниже Windows Server 2003|
|Узлы члена службу общего доступа|| Windows Server 2012 |
|Контроллеры домена входящего в службу узла|RFC-совместимый KDC|Не ниже Windows Server 2003|
|Контроллеры домена групповой управляемой учетной записи| Windows Server 2012 контроллеры доменов для извлечения пароля|Домен с Windows Server 2012, которая может иметь некоторые системы более ранних, чем Windows Server 2012 |
|Узел внутренней службы|RFC-совместимый сервер приложений Kerberos|Не ниже Windows Server 2003|
|Контроллеры домена учетной записи службы внутренней|RFC-совместимый KDC|Не ниже Windows Server 2003|
|Windows PowerShell для Active Directory|Windows PowerShell для Active Directory, установленный на компьютере с поддержкой 64-разрядной архитектуры или на компьютере удаленного управления (например, с помощью средств удаленного администрирования сервера)| Windows Server 2012 |

**Домен требования служб Active Directory**

-   Схема Active Directory в лесу домена таких учетных записей необходимо обновить до Windows Server 2012, чтобы создать управляемую.

    Для обновления схемы можно установить контроллер домена под управлением Windows Server 2012 или запустить соответствующую версию adprep.exe с компьютера под управлением Windows Server 2012. Значение атрибута объекта версии объекта CN = Schema, CN = Configuration, DC = Contoso, DC = Com должно быть равным 52.

-   Новая групповой управляемой учетной записи учетная запись.

-   Если вы управляете узлу службы разрешение для использования групповой управляемой учетной записи, группы, а затем новый или существующая группа безопасности

-   Если управление управление доступом к группе, а затем новый или существующая группа безопасности

-   Если первый основной корневой ключ для Active Directory не развернут в домене или не был создан, его необходимо создайте. Результат создания можно проверить в журнале рабочих KdsSvc, идентификатор события — 4004.

Инструкции Создание ключа см [создание корневого ключа KDS службы распространения ключей](create-the-key-distribution-services-kds-root-key.md). Службы распространения ключей Майкрософт (kdssvc.dll) корневой ключ для AD.

**Жизненный цикл**

Жизненный цикл фермы серверов с использованием групповой управляемой учетной записи функции включает следующие задачи:

-   Развертывание фермы серверов федерации

-   Добавление узлов в существующую ферму серверов

-   Списание узлов из существующей фермы серверов

-   Списание существующей фермы серверов

-   Удаление скомпрометированного узла из фермы серверов при необходимости.

## <a name="BKMK_DeployNewFarm"></a>Развертывание фермы серверов федерации
При развертывании новой фермы серверов администратору службы необходимо определить:

-   Поддерживает ли служба использование gMSAs

-   Если служба запрашивает входящих или исходящих подключений с проверкой подлинности

-   Имена учетных записей компьютеров для входящих в службу узлов с использованием групповой управляемой учетной записи службы

-   NetBIOS-имя для службы

-   Имя узла DNS для службы

-   Имена субъектов-служб (SPN) для службы

-   Периодичность смены пароля (по умолчанию — 30 дней).

### <a name="BKMK_Step1"></a>Шаг 1: Создание групповых управляемых учетных записей служб
Можно создать управляемую только в том случае, если схема леса обновлена до Windows Server 2012, основной корневой ключ для Active Directory была развернута и имеется по крайней мере один контроллер домена Windows Server 2012 в домене, где создается эта учетная запись.

Членство в группе **"Администраторы домена"**, **операторы учета** или права на создание объектов msDS-GroupManagedServiceAccount является минимальным требованием для выполнения следующих процедур.

#### <a name="BKMK_CreateGMSA"></a>Для создания групповой управляемой учетной записи, с помощью командлета New-ADServiceAccount.

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке для Windows PowerShell введите следующую команду и нажмите клавишу ВВОД. (Модуль Active Directory загрузится автоматически).

    **Новый ADServiceAccount [-имя] <string> - DNSHostName <string> [-KerberosEncryptionType <ADKerberosEncryptionType>] [-ManagedPasswordIntervalInDays < Nullable [Int32] >] [-PrincipalsAllowedToRetrieveManagedPassword < ADPrincipal [] >] - SamAccountName <string> - ServicePrincipalNames < string [] >**

    |Параметр|Строка|Пример|
    |-------|-----|------|
    |Имя|Имя учетной записи|ITFarm1|
    |DNSHostName|DNS-имя узла службы|ITFarm1.contoso.com|
    |KerberosEncryptionType|Любые виды шифрования, поддерживаемые серверами узлов|AES256 RC4, AES128,|
    |ManagedPasswordIntervalInDays|Периодичность смены пароля в днях (по умолчанию 30 дней, если не указано)|90|
    |PrincipalsAllowedToRetrieveManagedPassword|Учетные записи компьютеров, входящих в службу узлов или группы безопасности, в которую входят узлы членом|ITFarmHosts|
    |SamAccountName|NetBIOS-имя службы, если не совпадает с именем|ITFarm1|
    |ServicePrincipalNames|Имена участника-службы (SPN) для службы|http/ITFarm1.contoso.com/contoso.com, http/ITFarm1.contoso.com/contoso, http/ITFarm1/contoso.com, http, ITFarm1 или contoso|

    > [!IMPORTANT]
    > Периодичность смены пароля можно настроить только во время создания. Если требуется изменить интервал, необходимо создать новый групповой управляемой учетной записи и настроить его во время создания.

    **Пример**

    Введите команду в одну строку, даже если они могут показаться словам здесь несколько строк из-за ограничений форматирования.

    ```
    New-ADServiceAccount ITFarm1 -DNSHostName ITFarm1.contoso.com -PrincipalsAllowedToRetrieveManagedPassword ITFarmHosts -KerberosEncryptionType RC4, AES128, AES256 -ServicePrincipalNames http/ITFarm1.contoso.com/contoso.com, http/ITFarm1.contoso.com/contoso, http/ITFarm1/contoso.com, http/ITFarm1/contoso

    ```

Членство в группе **"Администраторы домена"**, **операторы учета**, или права на создание объектов msDS-GroupManagedServiceAccount является минимальным требованием для выполнения этой процедуры. Подробные сведения об использовании соответствующих учетных записей и членства в группах см. в разделе [локальные и доменные группы по умолчанию](https://technet.microsoft.com/library/dd728026(WS.10).aspx).

##### <a name="to-create-a-gmsa-for-outbound-authentication-only-using-the-new-adserviceaccount-cmdlet"></a>Чтобы создать управляемую для исходящей проверки подлинности с помощью командлета New-ADServiceAccount.

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **Новый ADServiceAccount [-имя] <string> - RestrictToOutboundAuthenticationOnly [-ManagedPasswordIntervalInDays < Nullable [Int32] >] [-PrincipalsAllowedToRetrieveManagedPassword < ADPrincipal [] >]**

    |Параметр|Строка|Пример|
    |-------|-----|------|
    |Имя|Имя учетной записи|ITFarm1|
    |ManagedPasswordIntervalInDays|Периодичность смены пароля в днях (по умолчанию 30 дней, если не указано)|75|
    |PrincipalsAllowedToRetrieveManagedPassword|Учетные записи компьютеров, входящих в службу узлов или группы безопасности, в которую входят узлы членом|ITFarmHosts|

    > [!IMPORTANT]
    > Периодичность смены пароля можно настроить только во время создания. Если требуется изменить интервал, необходимо создать новый групповой управляемой учетной записи и настроить его во время создания.

**Пример**

```
New-ADServiceAccount ITFarm1 -RestrictToOutboundAuthenticationOnly - PrincipalsAllowedToRetrieveManagedPassword ITFarmHosts

```

### <a name="BKMK_ConfigureServiceIdentity"></a>Шаг 2: Настройка службы удостоверения приложения служб
Настройка служб в Windows Server 2012, см. следующую документацию:

-   Пул приложений IIS

    Дополнительные сведения см. в разделе [укажите удостоверение пула приложений (IIS 7)](https://technet.microsoft.com/library/cc771170(WS.10).aspx).

-   Службы Windows

    Дополнительные сведения см. в разделе [службы](https://technet.microsoft.com/library/cc772408.aspx).

-   Задачи

    Дополнительные сведения см. в разделе [Обзор планировщика задач](https://technet.microsoft.com/library/cc721871.aspx).

Эта учетная запись может поддерживать и другие службы. См. в документации соответствующего продукта, сведения о настройке этих служб.

## <a name="BKMK_AddMemberHosts"></a>Добавление узлов в существующую ферму серверов
Если для управления с использованием групп безопасности, добавьте учетную запись компьютера для нового узла члена в группу безопасности (которые gMSA входят узлы членом) с помощью одного из следующих методов.

Членство в группе **"Администраторы домена"**, или права на добавление объектов в группу безопасности, является минимальным требованием для выполнения этих процедур.

-   Метод 1: Active Directory-пользователи и компьютеры

    Для процедуры порядок использования данного метода см. в разделе [Добавление учетной записи компьютера в группу](https://technet.microsoft.com/library/cc733097.aspx) с помощью интерфейса Windows и [управление различными доменами в центре администрирования Active Directory](manage-different-domains-in-active-directory-administrative-center.md).

-   Метод 2: dsmod

    Для процедуры порядок использования данного метода см. в разделе [Добавление учетной записи компьютера в группу](https://technet.microsoft.com/library/cc733097.aspx) с помощью командной строки.

-   Метод 3: Windows PowerShell Active Directory командлет Add-ADPrincipalGroupMembership

    Для процедуры порядок использования данного метода см. в разделе [Add-ADPrincipalGroupMembership](https://technet.microsoft.com/library/ee617203.aspx).

Если используются учетные записи компьютеров, найдите существующие учетные записи и добавьте новую учетную запись компьютера.

Членство в группе **"Администраторы домена"**, **операторы учета**, или права на управление объектами msDS-GroupManagedServiceAccount является минимальным требованием для выполнения этой процедуры. Подробные сведения об использовании соответствующих учетных записей и членства в группах см. в разделе локальные и доменные группы по умолчанию.

#### <a name="to-add-member-hosts-using-the-set-adserviceaccount-cmdlet"></a>Чтобы добавить узлы с помощью командлета Set-ADServiceAccount

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **Get-ADServiceAccount [-имя] <string> - PrincipalsAllowedToRetrieveManagedPassword**

3.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **SET-ADServiceAccount [-имя] <string> - PrincipalsAllowedToRetrieveManagedPassword < ADPrincipal [] >**

|Параметр|Строка|Пример|
|-------|-----|------|
|Имя|Имя учетной записи|ITFarm1|
|PrincipalsAllowedToRetrieveManagedPassword|Учетные записи компьютеров, входящих в службу узлов или группы безопасности, в которую входят узлы членом|Узел3 узел1, узел2,|

**Пример**

Например чтобы добавить член узлов введите следующие команды и нажмите клавишу ВВОД.

```
Get-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword

```

```
Set-ADServiceAccount [-Name] ITFarm1-PrincipalsAllowedToRetrieveManagedPassword Host1 Host2 Host3

```

## <a name="BKMK_Update_gMSA"></a>Обновление свойств групповой управляемой учетной записи службы
Членство в группе **"Администраторы домена"**, **операторы учета**, или права на запись в объекты msDS-GroupManagedServiceAccount является минимальным требованием для выполнения этих процедур.

Откройте модуль Active Directory для Windows PowerShell и настройте желаемые свойства с помощью командлета Set-ADServiceAccount.

Подробную информацию об установке этих свойств см. в разделе [Set-ADServiceAccount](https://technet.microsoft.com/library/ee617252.aspx) в библиотеке TechNet или введите **Get-Help Set-ADServiceAccount** командной строке модуля Active Directory для Windows PowerShell командной строке и нажмите клавишу ВВОД.

## <a name="BKMK_DecommMemberHosts"></a>Списание узлов из существующей фермы серверов
Членство в группе **"Администраторы домена"**, или возможности для удаления членов из объектов в группу безопасности, является минимальным требованием для выполнения этих процедур.

### <a name="step-1-remove-member-host-from-gmsa"></a>Шаг 1: Удаление узла из групповой управляемой учетной записи
Если для управления с использованием групп безопасности, удалите учетную запись компьютера для списываемого узла из группы безопасности, что узлы, входящие в управляемой являются членами одним из следующих методов.

-   Метод 1: Active Directory-пользователи и компьютеры

    Для процедуры порядок использования данного метода см. в разделе [удалить учетную запись компьютера](https://technet.microsoft.com/library/cc754624.aspx) с помощью интерфейса Windows и [управление различными доменами в центре администрирования Active Directory](manage-different-domains-in-active-directory-administrative-center.md).

-   Метод 2: drsm

    Для процедуры порядок использования данного метода см. в разделе [удалить учетную запись компьютера](https://technet.microsoft.com/library/cc754624.aspx) с помощью командной строки.

-   Метод 3: Командлет Remove-ADPrincipalGroupMembership в Windows PowerShell Active Directory

    Подробную информацию об это сделать, см. статью [Remove-ADPrincipalGroupMembership](https://technet.microsoft.com/library/ee617243.aspx) в библиотеке TechNet или введите **Get-Help Remove-ADPrincipalGroupMembership** командной строке модуля Active Directory для Windows PowerShell командной строке и нажмите клавишу ВВОД.

Если используются учетные записи компьютеров, извлеките существующие учетные записи и добавьте все, кроме учетной записи удаленных компьютеров.

Членство в группе **"Администраторы домена"**, **операторы учета**, или права на управление объектами msDS-GroupManagedServiceAccount является минимальным требованием для выполнения этой процедуры. Подробные сведения об использовании соответствующих учетных записей и членства в группах см. в разделе локальные и доменные группы по умолчанию.

##### <a name="to-remove-member-hosts-using-the-set-adserviceaccount-cmdlet"></a>Удаление входящих в службу узлов с помощью командлета Set-ADServiceAccount

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **Get-ADServiceAccount [-имя] <string> - PrincipalsAllowedToRetrieveManagedPassword**

3.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **SET-ADServiceAccount [-имя] <string> - PrincipalsAllowedToRetrieveManagedPassword < ADPrincipal [] >**

|Параметр|Строка|Пример|
|-------|-----|------|
|Имя|Имя учетной записи|ITFarm1|
|PrincipalsAllowedToRetrieveManagedPassword|Учетные записи компьютеров, входящих в службу узлов или группы безопасности, в которую входят узлы членом|Узел1 Узел3|

**Пример**

Например чтобы удалить элемент узлов введите следующие команды и нажмите клавишу ВВОД.

```
Get-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword

```

```
Set-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword Host1 Host3

```

### <a name="BKMK_RemoveGMSA"></a>Шаг 2: Удаление групповой управляемой учетной записи службы из системы
Удаление групповой управляемой учетной записи кэшированные учетные данные с узла элемента, используя Uninstall-ADServiceAccount или NetRemoveServiceAccount API в системе узла.

Членство в группе **Администраторы**, или в эквивалентной минимальным требованием для выполнения этих процедур.

##### <a name="to-remove-a-gmsa-using-the-uninstall-adserviceaccount-cmdlet"></a>Для удаления групповой управляемой учетной записи, с помощью командлета Uninstall-ADServiceAccount

1.  На контроллере домена Windows Server 2012, запустите Windows PowerShell из панели задач.

2.  В командной строке модуля Active Directory в Windows PowerShell введите следующую команду и нажмите клавишу ВВОД:

    **Uninstall-ADServiceAccount < Учетная_запись_службы_ad >**

    **Пример**

    Например чтобы удалить кэшированные учетные данные групповой управляемой учетной записи именованный ITFarm1, введите следующую команду и нажмите клавишу ВВОД:

    ```
    Uninstall-ADServiceAccount ITFarm1
    ```

Дополнительные сведения о командлете Uninstall-ADServiceAccount командной строке модуля Active Directory для командной строки Windows PowerShell, введите **Get-Help Uninstall-ADServiceAccount**и нажмите клавишу ВВОД либо см. информацию на веб-сайте TechNet [Uninstall-ADServiceAccount](https://technet.microsoft.com/library/ee617202.aspx).



## <a name="BKMK_Links"></a>См. также:

-   [Обзор учетных записей группы управляемых служб](group-managed-service-accounts-overview.md)



