---
title: Начало работы с групповыми управляемыми учетными записями служб
description: Безопасность Windows Server
ms.prod: windows-server
ms.technology: security-gmsa
ms.topic: article
ms.assetid: 7130ad73-9688-4f64-aca1-46a9187a46cf
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 52456b8027196f20c4ca52a08bcd7f7bba92eb82
ms.sourcegitcommit: b00d7c8968c4adc8f699dbee694afe6ed36bc9de
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/08/2020
ms.locfileid: "80856997"
---
# <a name="getting-started-with-group-managed-service-accounts"></a>Начало работы с групповыми управляемыми учетными записями служб

>Область применения: Windows Server (Semi-Annual Channel), Windows Server 2016


Это краткое описание содержит пошаговые инструкции и общие сведения о включении и использовании групповых управляемых учетных записей служб в Windows Server 2012.

**В этом документе**

-   [Предварительные условия](#BKMK_Prereqs)

-   [Введение](#BKMK_Intro)

-   [Развертывание новой фермы серверов](#BKMK_DeployNewFarm)

-   [Добавление узлов участников в существующую ферму серверов](#BKMK_AddMemberHosts)

-   [Обновление свойств групповой управляемой учетной записи службы](#BKMK_Update_gMSA)

-   [Списание узлов членов из существующей фермы серверов](#BKMK_DecommMemberHosts)


> [!NOTE]
> В этом разделе приведены примеры командлетов Windows PowerShell, которые могут быть использованы для автоматизации некоторых описанных процедур. Дополнительные сведения см. в разделе [Командлеты](https://go.microsoft.com/fwlink/p/?linkid=230693).

## <a name="prerequisites"></a><a name="BKMK_Prereqs"></a>Требований
См. раздел на эту тему в статье [Требования к групповым учетным записям служб](#BKMK_gMSA_Req).

## <a name="introduction"></a><a name="BKMK_Intro"></a>Общие
Когда клиентский компьютер подключается к службе, размещенной на ферме серверов с использованием балансировки сетевой нагрузки (NLB) или какого-либо другого метода, при котором клиенту, проходящему проверку подлинности, все службы кажутся одной, протоколы проверки подлинности, поддерживающие взаимную проверку подлинности (такие как Kerberos), можно использовать, только если на всех экземплярах служб используется один и тот же субъект. Это означает, что удостоверение каждой службы должно подтверждаться одинаковым паролем или ключом.

> [!NOTE]
> Отказоустойчивые кластеры не поддерживают групповые управляемые учетные записи служб. При этом групповую или автономную учетную запись службы могут использовать службы, работающие поверх службы кластеров и представляющие собой службу Windows, пул приложений или назначенную задачу либо поддерживающие такие учетные записи изначально.

Службы могут выбирать следующие разрешенные субъекты, каждый из которых обладает определенными свойствами:

|Участники|Область видимости|Поддерживаемые службы|Управление паролями|
|-------|-----|-----------|------------|
|Учетная запись компьютера в системе Windows|Домен|Ограничена одним сервером в домене|Управляется компьютером|
|Учетная запись компьютера без системы Windows|Домен|Любой сервер в домене|Нет|
|Виртуальная учетная запись|Local|Ограничена одним сервером|Управляется компьютером|
|Автономная управляемая учетная запись Windows 7|Домен|Ограничена одним сервером в домене|Управляется компьютером|
|Учетная запись пользователя|Домен|Любой сервер в домене|Нет|
|Групповая управляемая учетная запись службы|Домен|Любой сервер, присоединенный к домену Windows Server 2012|Управляется контроллером домена и извлекается узлом|

Учетные записи компьютеров Windows, автономные управляемые учетные записи Windows 7 и виртуальные учетные записи могут использоваться только в одной системе. Если вы настраиваете учетную запись, которая будет использоваться различными службами на фермах серверов, выберите учетную запись пользователя или учетную запись не в системе Windows. Такие учетные записи не имеют функции централизованного управления паролями, а значит, каждой организации придется создавать дорогое решение для обновления ключей для служб в каталоге Active Directory и их передачи во все экземпляры этих служб.

В Windows Server 2012 администраторам служб или служб не требуется управлять синхронизацией паролей между экземплярами службы при использовании групповых управляемых учетных записей служб (gMSA). Вы создаете групповую управляемую учетную запись службы в Active Directory и настраиваете службу, поддерживающую управляемые учетные записи. Для подготовки групповой управляемой учетной записи службы можно использовать командлеты *-ADServiceAccount, входящие в модуль Active Directory. Конфигурацию удостоверения службы на узле поддерживают:

-   те же API, что и для автономных управляемых учетных записей служб, поэтому продукты, которые поддерживают автономные управляемые учетные записи служб, поддерживают и групповые;

-   службы, которые настраивают удостоверения для входа с помощью диспетчера управления службами;

-   службы, которые используют для настройки удостоверения диспетчер IIS для пулов приложений;

-   задачи, использующие планировщик заданий.

### <a name="requirements-for-group-managed-service-accounts"></a><a name="BKMK_gMSA_Req"></a>Требования для групповых управляемых учетных записей служб
В приведенной ниже таблице указаны требования к операционной системе, которые должны выполняться для работы проверки подлинности Kerberos со службами, использующими групповые управляемые учетные записи служб. Требования  Active Directory перечислены под таблицей.

Для выполнения команд Windows PowerShell, которые используются для администрирования групповых управляемых учетных записей служб, необходима 64-разрядная архитектура.

**Требования к операционной системе**

|Элемент|Требование|Операционная система|
|------|--------|----------|
|Узел клиентского приложения|RFC-совместимый клиент Kerberos|Не ниже Windows XP|
|Доменные контроллеры домена учетной записи пользователя|RFC-совместимый KDC|Не ниже Windows Server 2003|
|Узлы, входящие в службу общего доступа|| Windows Server 2012 |
|Доменные контроллеры домена узла участника|RFC-совместимый KDC|Не ниже Windows Server 2003|
|Доменные контроллеры домена учетной записи gMSA| Контроллеры домена Windows Server 2012, доступные для получения пароля узлом|Домен с Windows Server 2012, на котором могут быть установлены системы, предшествующие Windows Server 2012 |
|Узел внутренней службы|RFC-совместимый сервер приложений Kerberos|Не ниже Windows Server 2003|
|Доменные контроллеры домена учетной записи внутренней службы|RFC-совместимый KDC|Не ниже Windows Server 2003|
|Windows PowerShell для Active Directory|Windows PowerShell для Active Directory, установленный на компьютере с поддержкой 64-разрядной архитектуры или на компьютере удаленного управления (например, с помощью средств удаленного администрирования сервера).| Windows Server 2012 |

**Требования к службам домен Active Directory**

-   Для создания gMSA схему Active Directory в лесу домена gMSA необходимо обновить до Windows Server 2012.

    Схему можно обновить, установив контроллер домена под управлением Windows Server 2012 или выполнив версию средства Adprep. exe на компьютере с Windows Server 2012. Значение атрибута для версии объекта CN=Schema,CN=Configuration,DC=Contoso,DC=Com должно быть равным 52.

-   Новая групповая управляемая учетная запись.

-   Новая или существующая группа безопасности, если вы даете узлу службы разрешение на использование групповой управляемой учетной записи службы группой.

-   Новая или существующая группа безопасности, если вы даете группе управление доступом к управляемой группе.

-   Если первый основной корневой ключ для Active Directory не развернут в домене или не создан, его необходимо создать. Результат создания ключа можно проверить в журнале рабочих событий KdsSvc, идентификатор события — 4004.

Инструкции по созданию ключа см. в разделе [Создание корневого ключа KDS служб распространения ключей](create-the-key-distribution-services-kds-root-key.md). Корневым ключом для Active Directory является ключ службы распространения ключей (Майкрософт) — kdssvc.dll.

**Файлу**

Жизненный цикл фермы серверов с использованием функции групповых управляемых учетных записей служб включает следующие задачи:

-   Развертывание фермы серверов федерации

-   Добавление узлов в существующую ферму серверов

-   Списание узлов из существующей фермы серверов

-   Списание существующей фермы серверов

-   Удаление скомпрометированного узла из фермы серверов при необходимости

## <a name="deploying-a-new-server-farm"></a><a name="BKMK_DeployNewFarm"></a>Развертывание новой фермы серверов
При развертывании новой фермы серверов администратору службы необходимо определить:

-   поддерживает ли служба использование групповых управляемых учетных записей служб;

-   требует ли служба проверки подлинности входящих или исходящих подключений;

-   имена учетных записей компьютеров для входящих в службу узлов с использованием групповых управляемых учетных записей служб;

-   NetBIOS-имя службы;

-   имя DNS-узла службы;

-   имена субъектов-служб (SPN) для службы;

-   периодичность смены пароля (по умолчанию 30 дней).

### <a name="step-1-provisioning-group-managed-service-accounts"></a><a name="BKMK_Step1"></a>Шаг 1. подготовка групп управляемых учетных записей служб
Вы можете создать gMSA, только если схема леса была обновлена до Windows Server 2012, был развернут главный корневой ключ для Active Directory, а в домене, в котором будет создана gMSA, существует по крайней мере один контроллер домена Windows Server 2012.

Минимальным требованием для выполнения этих процедур является членство в группе **Администраторы домена** либо **Операторы учета** или наличие права на создание объектов msDS-GroupManagedServiceAccount.

> [!NOTE]
> Значение параметра-Name всегда является обязательным (если вы указали-Name или NOT), где-DNSHostName,-Рестрикттосинглекомпутер и-Рестрикттуутбаундаусентикатион являются вторичными требованиями для трех сценариев развертывания.    


#### <a name="to-create-a-gmsa-using-the-new-adserviceaccount-cmdlet"></a><a name="BKMK_CreateGMSA"></a>Создание gMSA с помощью командлета New-Адсервицеаккаунт

1.  На контроллере домена Windows Server 2012 запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД (модуль Active Directory загрузится автоматически):

    **New-Адсервицеаккаунт [-name] &lt;строка&gt;-DNSHostName &lt;строка&gt; [-Керберосенкриптионтипе &lt;Адкерберосенкриптионтипе&gt;] [-Манажедпассвординтервалиндайс < Nullable [Int32] >] [-PrincipalsAllowedToRetrieveManagedPassword < строка >] [-ADPrincipal &lt;String []&gt;]**

    |Параметр|Строка|Пример|
    |-------|-----|------|
    |Имя|Имя учетной записи|ITFarm1|
    |DNSHostName|Имя DNS-узла службы|ITFarm1.contoso.com|
    |KerberosEncryptionType|Любые виды шифрования, поддерживаемые серверами узлов|None, RC4, AES128, AES256|
    |ManagedPasswordIntervalInDays|Периодичность смены пароля в днях (если не указано, используется значение по умолчанию 30)|90|
    |PrincipalsAllowedToRetrieveManagedPassword|Имена учетных записей компьютеров для входящих в службу узлов или групп безопасности, в которые входят эти узлы|ITFarmHosts|
    |SamAccountName|NetBIOS-имя службы, если не совпадает с именем|ITFarm1|
    |ServicePrincipalNames|Имена субъектов-служб (SPN) для службы|HTTP/ITFarm1. contoso. com/contoso. com, HTTP/ITFarm1. contoso. com/contoso, HTTP/ITFarm1/contoso. com, HTTP/ITFarm1/Contoso, MSSQLSvc/ITFarm1. contoso. com: 1433, MSSQLSvc/ITFarm1. contoso. com: INST01|

    > [!IMPORTANT]
    > Периодичность смены пароля можно настроить только в процессе создания. Если вам нужно изменить это значение, создайте новую групповую управляемую учетную запись службы и настройте этот параметр в процессе ее создания.
   
    **Пример**

    Введите команды в одну строку, даже если кажется, что из-за ограничений форматирования они переносятся по словам на другую строку.

    ```Powershell
    New-ADServiceAccount ITFarm1 -DNSHostName ITFarm1.contoso.com -PrincipalsAllowedToRetrieveManagedPassword ITFarmHosts$ -KerberosEncryptionType RC4, AES128, AES256 -ServicePrincipalNames http/ITFarm1.contoso.com/contoso.com, http/ITFarm1.contoso.com/contoso, http/ITFarm1/contoso.com, http/ITFarm1/contoso
    ```

Минимальным требованием для выполнения этих процедур является членство в группе **Администраторы домена** либо **Операторы учета** или наличие права на создание объектов msDS-GroupManagedServiceAccount. Дополнительные сведения об использовании подходящих учетных записей и членства в группах см. в разделе [Локальные группы и группы домена по умолчанию](https://technet.microsoft.com/library/dd728026(WS.10).aspx).

##### <a name="to-create-a-gmsa-for-outbound-authentication-only-using-the-new-adserviceaccount-cmdlet"></a>Чтобы создать групповую управляемую учетную запись службы для исходящей проверки подлинности, используйте командлет New-ADServiceAccount.

1.  На контроллере домена Windows Server 2012 запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **New-Адсервицеаккаунт [-name] &lt;строка&gt;-Рестрикттуутбаундаусентикатиононли [-Манажедпассвординтервалиндайс < Nullable [Int32] >] [-PrincipalsAllowedToRetrieveManagedPassword < ADPrincipal [] >]**

    |Параметр|Строка|Пример|
    |-------|-----|------|
    |Имя|Имя учетной записи|ITFarm1|
    |ManagedPasswordIntervalInDays|Периодичность смены пароля в днях (если не указано, используется значение по умолчанию 30)|75|
    |PrincipalsAllowedToRetrieveManagedPassword|Имена учетных записей компьютеров для входящих в службу узлов или групп безопасности, в которые входят эти узлы|ITFarmHosts|

    > [!IMPORTANT]
    > Периодичность смены пароля можно настроить только в процессе создания. Если вам нужно изменить это значение, создайте новую групповую управляемую учетную запись службы и настройте этот параметр в процессе ее создания.
    
  **Пример**

```PowerShell
New-ADServiceAccount ITFarm1 -RestrictToOutboundAuthenticationOnly - PrincipalsAllowedToRetrieveManagedPassword ITFarmHosts$
```

### <a name="step-2-configuring-service-identity-application-service"></a><a name="BKMK_ConfigureServiceIdentity"></a>Шаг 2. Настройка службы приложений для идентификации служб
Сведения о настройке служб в Windows Server 2012 см. в следующей документации по функциям:

-   Пул приложений IIS

    Дополнительные сведения см. в разделе [Указание удостоверения для пула приложений (IIS 7)](https://technet.microsoft.com/library/cc771170(WS.10).aspx).

-   Службы Windows

    Дополнительные сведения см. в разделе [Службы](https://technet.microsoft.com/library/cc772408.aspx).

-   Задачи

    Дополнительные сведения см. в статье [Обзор планировщика задач](https://technet.microsoft.com/library/cc721871.aspx).

Групповые управляемые учетные записи могут поддерживать и другие службы. Информацию о настройки таких служб см. в документации к соответствующим продуктам.

## <a name="adding-member-hosts-to-an-existing-server-farm"></a><a name="BKMK_AddMemberHosts"></a>Добавление узлов участников в существующую ферму серверов
Если для управления узлами-членами используются группы безопасности, добавьте учетную запись компьютера для нового узла члена в группу безопасности (членом которой являются узлы gMSA), используя один из следующих методов.

Минимальным требованием для выполнения этих процедур является членство в группе **Администраторы домена** или наличие права на добавление объектов в группу безопасности.

-   Метод 1: Active Directory — пользователи и компьютеры

    Порядок использования данного метода см. в статье [Добавление учетной записи компьютера в группу](https://technet.microsoft.com/library/cc733097.aspx) с помощью интерфейса Windows и [Управление различными доменами в центре администрирования Active Directory](manage-different-domains-in-active-directory-administrative-center.md).

-   Метод 2: dsmod

    Порядок использования данного метода см. в статье [Добавление учетной записи компьютера в группу](https://technet.microsoft.com/library/cc733097.aspx) с помощью командной строки.

-   Метод 3: командлет Add-ADPrincipalGroupMembership в Windows PowerShell Active Directory

    Порядок использования данного метода см. в статье [Add-ADPrincipalGroupMembership](https://technet.microsoft.com/library/ee617203.aspx).

Если используются учетные записи компьютеров, найдите существующие учетные записи и добавьте новую учетную запись компьютера.

Минимальным требованием для выполнения этой процедуры является членство в группе **Администраторы домена** либо **Операторы учета** или наличие права на управление объектами msDS-GroupManagedServiceAccount. Дополнительные сведения об использовании подходящих учетных записей и членства в группах см. в разделе "Локальные группы и группы домена по умолчанию".

#### <a name="to-add-member-hosts-using-the-set-adserviceaccount-cmdlet"></a>Добавление входящих в службу узлов с помощью командлета Set-ADServiceAccount

1.  На контроллере домена Windows Server 2012 запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Get-Адсервицеаккаунт [-name] &lt;строка&gt;-ПринЦипалсалловедторетриевеманажедпассворд**

3.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Set-Адсервицеаккаунт [-name] &lt;String&gt;-ПринЦипалсалловедторетриевеманажедпассворд < АдпринЦипал [] >**

|Параметр|Строка|Пример|
|-------|-----|------|
|Имя|Имя учетной записи|ITFarm1|
|PrincipalsAllowedToRetrieveManagedPassword|Имена учетных записей компьютеров для входящих в службу узлов или групп безопасности, в которые входят эти узлы|Host1, Host2, Host3|

**Пример**

Например, чтобы добавить входящие в службу узлы, введите следующие команды и нажмите клавишу ВВОД:

```PowerShell
Get-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword
```

```PowerShell
Set-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword Host1$,Host2$,Host3$
```

## <a name="updating-the-group-managed-service-account-properties"></a><a name="BKMK_Update_gMSA"></a>Обновление свойств групповой управляемой учетной записи службы
Минимальным требованием для выполнения этой процедуры является членство в группе **Администраторы домена** либо **Операторы учета** или наличие права на запись в объекты msDS-GroupManagedServiceAccount.

Откройте модуль Active Directory для Windows PowerShell и настройте желаемые свойства с помощью командлета Set-ADServiceAccount.

Подробную информацию об установке этих свойств см. в статье [Set-ADServiceAccount](https://technet.microsoft.com/library/ee617252.aspx) в библиотеке TechNet или введите **Get-Help Set-ADServiceAccount** в командной строке модуля Active Directory для Windows PowerShell и нажмите клавишу ВВОД.

## <a name="decommissioning-member-hosts-from-an-existing-server-farm"></a><a name="BKMK_DecommMemberHosts"></a>Списание узлов членов из существующей фермы серверов
Минимальным требованием для выполнения этих процедур является членство в группе **Администраторы домена** или наличие права на удаление объектов из группы безопасности.

### <a name="step-1-remove-member-host-from-gmsa"></a>Шаг 1. Удаление узла из групповой управляемой учетной записи службы
Если для управления узлами-членами используются группы безопасности, удалите учетную запись компьютера для отключенного узла из группы безопасности, членом которой являются узлы gMSA, с помощью одного из следующих методов.

-   Метод 1: Active Directory — пользователи и компьютеры

    Порядок использования данного метода см. в статье [Удаление учетной записи компьютера](https://technet.microsoft.com/library/cc754624.aspx) с помощью интерфейса Windows и [Управление различными доменами в центре администрирования Active Directory](manage-different-domains-in-active-directory-administrative-center.md).

-   Метод 2: drsm

    Порядок использования данного метода см. в статье [Удаление учетной записи компьютера](https://technet.microsoft.com/library/cc754624.aspx) с помощью командной строки.

-   Метод 3: командлет Remove-ADPrincipalGroupMembership в Windows PowerShell Active Directory

    Подробную информацию об использовании данного метода см. в статье  [Remove-ADPrincipalGroupMembership](https://technet.microsoft.com/library/ee617243.aspx) в библиотеке TechNet или введите **Get-Help Remove-ADPrincipalGroupMembership** в командной строке модуля Active Directory для Windows PowerShell и нажмите клавишу ВВОД.

Если используются учетные записи компьютеров, извлеките существующие учетные записи и добавьте все учетные записи компьютеров, кроме удаленных.

Минимальным требованием для выполнения этой процедуры является членство в группе **Администраторы домена** либо **Операторы учета** или наличие права на управление объектами msDS-GroupManagedServiceAccount. Дополнительные сведения об использовании подходящих учетных записей и членства в группах см. в разделе "Локальные группы и группы домена по умолчанию".

##### <a name="to-remove-member-hosts-using-the-set-adserviceaccount-cmdlet"></a>Удаление входящих в службу узлов с помощью командлета Set-ADServiceAccount

1.  На контроллере домена Windows Server 2012 запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Get-Адсервицеаккаунт [-name] &lt;строка&gt;-ПринЦипалсалловедторетриевеманажедпассворд**

3.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Set-Адсервицеаккаунт [-name] &lt;String&gt;-ПринЦипалсалловедторетриевеманажедпассворд < АдпринЦипал [] >**

|Параметр|Строка|Пример|
|-------|-----|------|
|Имя|Имя учетной записи|ITFarm1|
|PrincipalsAllowedToRetrieveManagedPassword|Имена учетных записей компьютеров для входящих в службу узлов или групп безопасности, в которые входят эти узлы|Host1,  Host3|

**Пример**

Например, чтобы удалить входящие в службу узлы, введите следующую команду и нажмите клавишу ВВОД:

```PowerShell
Get-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword
```

```PowerShell
Set-ADServiceAccount [-Name] ITFarm1 -PrincipalsAllowedToRetrieveManagedPassword Host1$,Host3$
```

### <a name="step-2-removing-a-group-managed-service-account-from-the-system"></a><a name="BKMK_RemoveGMSA"></a>Шаг 2. Удаление групповой управляемой учетной записи службы из системы
Удалите кэшированные учетные данные групповой управляемой учетной записи службы с входящего в службу узла с помощью API Uninstall-ADServiceAccount или NetRemoveServiceAccount API в системе соответствующего узла.

Минимальным требованием для выполнения этих процедур является членство в группе **Администраторы** или наличие эквивалентных прав.

##### <a name="to-remove-a-gmsa-using-the-uninstall-adserviceaccount-cmdlet"></a>Удаление групповой управляемой учетной записи службы с помощью командлета Uninstall-ADServiceAccount

1.  На контроллере домена Windows Server 2012 запустите Windows PowerShell на панели задач.

2.  Введите следующие команды в командной строке Windows PowerShell и нажмите клавишу ВВОД:

    **Uninstall-Адсервицеаккаунт &lt;Адсервицеаккаунт&gt;**

    **Пример**

    Например, чтобы удалить кэшированные учетные данные групповой управляемой учетной записи службы ITFarm1, введите следующую команду и нажмите клавишу ВВОД:

    ```PowerShell
    Uninstall-ADServiceAccount ITFarm1
    ```

Для получения дополнительных сведений о командлете Uninstall-ADServiceAccount введите в командной строке модуля Active Directory для Windows PowerShell команду **Get-Help Uninstall-ADServiceAccount**и нажмите клавишу ВВОД либо изучите статью [Uninstall-ADServiceAccount](https://technet.microsoft.com/library/ee617202.aspx)на веб-сайте TechNet.



## <a name="see-also"></a><a name="BKMK_Links"></a> См. также

-   [Общие сведения о групповой управляемых учетных записях служб](group-managed-service-accounts-overview.md)
