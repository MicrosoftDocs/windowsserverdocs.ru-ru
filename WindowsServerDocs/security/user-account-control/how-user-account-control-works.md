---
title: "Как работает контроль учетных записей пользователей"
description: "Безопасность Windows Server"
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.suite: na
ms.technology: security-tpm
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: da83ddb2-6182-417c-aa8e-0b47b2e17d13
author: coreyp-at-msft
ms.author: coreyp
manager: dongill
ms.date: 10/12/2016
ms.openlocfilehash: 7f5ad234959ebfe0687b8bc10f9e43f2092252f2
ms.sourcegitcommit: 583355400f6b0d880dc0ac6bc06f0efb50d674f7
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/17/2017
---
# <a name="how-user-account-control-works"></a>Как работает контроль учетных записей пользователей

>Область применения: Windows Server (канал точками годовой), Windows Server 2016

Контроль учетных записей (UAC) позволяет предотвратить вредоносные программы (также) повредить компьютер, а также в организации хорошо управляемых рабочих столов. Благодаря UAC приложения и задачи всегда выполняются в безопасном контексте неадминистративной учетной записи, если администратор специально предоставит доступ уровня администратора к системе. UAC может блокировать автоматическую установку неразрешенных приложений и предотвращаются нежелательные изменения параметров системы.

## <a name="uac-process-and-interactions"></a>Процесс UAC и принципы взаимодействия
Каждое приложение, требующее маркер доступа администратора, должны запрашивать подтверждение администратора. Единственным исключением является взаимосвязи между родительским и дочерним процессам. Дочерние процессы наследуют маркер доступа пользователя от родительского процесса. Тем не менее, родительский и дочерний процессы, необходимо иметь один и тот же уровень целостности. Windows Server 2012 защищает процессы, помечая их уровни целостности. Уровни целостности — измерения доверия. Приложение «высокий» целостности, которое выполняет задачи, которые изменять данные системы, такие как секционирования приложения, пока приложение целостности «низкий» — это выполняет задачи, которые может привести к нарушению операционной системы, например, веб-браузер. Приложения с низким уровнем целостности не могут изменять данные в приложениях с высоким уровнем целостности. Когда обычный пользователь пытается запустить приложение, требующее маркер доступа администратора, служба UAC требует, чтобы пользователь предоставил действительные учетные данные администратора.

Для лучшего понимания этого процесса, это важно для просмотра сведений при входе в систему Windows Server 2012.

### <a name="windows-server-2012-logon-process"></a>Процесс входа в систему Windows Server 2012
На следующем рисунке показано, как отличается процесс входа в систему для администратора от процесса входа для обычного пользователя.

![Иллюстрации, демонстрирующие, как отличается процесс входа в систему для администратора от процесса входа для обычного пользователя](../media/How-User-Account-Control-Works/UACWindowsLogonProcess.gif)

По умолчанию обычные пользователи и Администраторы доступ к ресурсам и запускают приложения в контексте безопасности обычных пользователей. При входе пользователя на компьютере, система создает маркер доступа для этого пользователя. Маркер доступа содержит сведения об уровне доступа, пользователь, включая идентификаторы безопасности (SID) и привилегии в Windows.

Когда администратор входит в систему, для пользователя создаются два различных маркера доступа: маркер доступа обычного пользователя и маркер доступа администратора. Маркер доступа обычного пользователя содержит те же сведения конкретного пользователя, как маркер доступа администратора, но административные привилегии в Windows и ИД безопасности удаляются. Маркер доступа обычного пользователя используется для запуска приложений, которые не выполняют задач администрирования (приложений обычного пользователя). Затем маркер доступа обычного пользователя используется для отображения рабочего стола (Explorer.exe). Explorer.exe является родительский процесс, с которого всех других процессов, инициализированные пользователем наследуют их маркер доступа. В результате все приложения запускаются от имени обычного пользователя, если пользователь не предоставит согласие или учетные данные, чтобы одобрить приложение, чтобы использовать маркер доступа администратора.

Пользователя, который является членом группы «Администраторы» можно войти в систему, в Интернете и читать почту, используя маркер доступа обычного пользователя. Если администратору необходимо выполнить задачу, требующую маркера доступа администратора, Windows Server 2012, автоматически запрашивает подтверждение пользователя. Этот запрос называется запроса на повышение прав, и его поведение можно настроить с помощью локальной политики безопасности оснастки (Secpol.msc) или групповой политики.

> [!NOTE]
> Термин «повышение прав» используется для обозначения процесса в Windows Server 2012, который запрашивает у пользователя согласие или учетные данные для использования полного доступа администратора.

### <a name="the-uac-user-experience"></a>Взаимодействие с пользователем контроля учетных Записей
Если включен контроль учетных Записей, взаимодействие с пользователем для обычных пользователей отличается от администраторов в режиме одобрения администратором. Рекомендуемый и более безопасный способ под управлением Windows Server 2012 — сделать первичной учетной записью обычного пользователя. В целях повышения безопасности для управляемой среды позволяет работающей под учетной записью обычного пользователя. С встроенный компонент повышение прав контроля учетных Записей обычных пользователей можно эффективно выполнять задачи администрирования, введя действительные учетные данные для учетной записи локального администратора. Значение по умолчанию, встроенный компонент повышение прав контроля учетных Записей для обычных пользователей — запрос учетных данных.

Альтернативой под управлением как обычный пользователь, является запуск от имени администратора в режиме одобрения администратором. С встроенный компонент повышение прав контроля учетных Записей члены локальной группы администраторов можно эффективно выполнять задачи администрирования, предоставляя утверждения. По умолчанию встроенный компонент повышение прав контроля учетных Записей для учетной записи администратора в режиме одобрения администратором называется запрос согласия. Работу запроса повышение прав контроля учетных Записей можно настроить с помощью локальной политики безопасности оснастки (Secpol.msc) или групповой политики.

**Согласия и запрос учетных данных**

При Включенном Windows Server 2012 делает запрос на продолжение или предлагает ввести учетные данные действительной локальной учетной записи администратора, перед запуском программы или задачи, требующей маркера полного доступа администратора. Этот запрос гарантирует, что вредоносные программы могут устанавливаться без вмешательства пользователя.

**Запрос согласия**

Запрос согласия выводится тогда, когда пользователь пытается выполнить задачу, требующую пользователя административного маркера доступа. Ниже приведен снимок экрана запроса согласия.

![Запрос согласия контроля учетных Записей (снимок экрана)](../media/How-User-Account-Control-Works/UACConsentPrompt.gif)

**Запрос учетных данных**

Запрос учетных данных выводится тогда, когда обычный пользователь пытается выполнить задачу, требующую пользователя административного маркера доступа. Работу запроса обычного пользователя по умолчанию можно настроить с помощью локальной политики безопасности оснастки (Secpol.msc) или групповой политики. Администраторы могут также должны предоставить свои учетные данные, задав контроль учетных записей пользователей: поведение запроса на повышение прав для администраторов в режиме одобрения администратором политики значение в строке для учетных данных.

На следующем снимке экрана является примером запроса Учетных данных.

![Снимок экрана с примером запроса Учетных данных](../media/How-User-Account-Control-Works/UACCredentialPrompt.gif)

**Запросы на повышение прав контроля учетных Записей**

Запросы на повышение прав контроля Учетных отображаются разными цветами каждого для конкретного приложения, позволяя моментально определять, для какого приложения существует потенциальная угроза. Когда приложение пытается выполнить, используя маркер полного доступа администратора, Windows Server 2012 сначала анализирует исполняемый файл, чтобы определить его издателя. Сначала приложения разделяются на три категории в зависимости от издателя исполняемого файла: Windows Server 2012, подтвержденный издатель (подписанный) и неподтвержденный издатель (неподписанный). Следующей схеме показано, как Windows Server 2012 определяет, какой цвет запроса на повышение прав для предоставления пользователю.

Запрашивать повышение прав цветовое кодирование выглядит следующим образом:

-   Красный фон с красным значком щита: приложение заблокировано групповой политикой или принадлежит от издателя, которое заблокировано.

-   Синий фон с сине -золотым щита: приложение является административным приложением Windows Server 2012, например, элемент панели управления.

-   Синий фон с синей щита: приложение, подписанные с помощью Authenticode и является доверенным на локальном компьютере.

-   Желтый фон с желтым щита: подписанные или неподписанные приложения, но еще не получил доверия на локальном компьютере.

**Значок щита**

Некоторые панели управления элементов, таких как **свойства даты и времени**, содержащие это сочетание администратора и обычного пользователя operations. Стандартные пользователи могут просматривать часы и изменить часовой пояс, но требуется маркер доступа администратора, чтобы изменить локальным системным временем. Ниже приведен снимок экрана **свойства даты и времени** элемент панели управления.

![Отображение снимок экрана ** элемента Дата и время свойства ** панели управления](../media/How-User-Account-Control-Works/UACShieldIcon.gif)

Значок щита на **изменить дату и время** кнопки означает, что процесс требует полного доступа администратора и отображает запроса на повышение прав контроля учетных Записей.

**Защита запроса на повышение прав**

Процесс повышения дополнительной защитой, указывая запрос на безопасном рабочем столе. По умолчанию в Windows Server 2012 согласия и запрос учетных данных отображаются на безопасном рабочем столе. Только процессы Windows получить доступ к безопасному рабочему столу. Для более высокого уровня безопасности рекомендуется хранения **контроль учетных записей пользователей: переключение к безопасному рабочему столу при выполнении запроса на повышение прав** включен параметр политики.

Когда исполняемый файл запроса на повышение прав, на безопасном рабочем столе стала интерактивном рабочем столе, также называемое рабочего стола пользователя. Безопасный рабочий стол потемнеет рабочего стола пользователя и отображает запрос на повышение прав, необходимо ответить в перед продолжением. Когда пользователь нажимает кнопку Да или нет, рабочий стол переключается на рабочем столе пользователя.

Вредоносные программы могут создавать имитации безопасного рабочего стола, но когда контроля учетных записей пользователей: поведение запроса на повышение прав для администраторов в режиме одобрения администратором политика задано значение Запрос согласия, вредоносные программы не получить повышение прав, если пользователь щелкает Да имитацию. Если этот параметр политики присвоено запрос учетных данных, имитация запрос учетных данных от вредоносных программ может иметь возможность собрать учетные данные пользователя. Тем не менее вредоносные программы не получают повышенным уровнем привилегий, и в системе есть другие средства защиты, которые устранения вредоносных программ, перехват управления пользовательского интерфейса, даже при наличии полученного пароля.

Вредоносные программы могут создавать имитации безопасного рабочего стола, эта проблема может произойти, если пользователь предварительно установил вредоносную программу на компьютере. Поскольку процессы требует маркер доступа администратора нельзя установить без вмешательства пользователя, если включен контроль учетных Записей, пользователь должен явно дать свое согласие, щелкнув **Да** или предоставив учетные данные администратора. Определенное поведение запроса на повышение прав контроля учетных Записей зависит от групповой политики.

## <a name="uac-architecture"></a>Архитектура контроля учетных Записей
Следующая схема подробное описание архитектуры контроля учетных Записей.

![Схема с подробными сведениями о архитектуры контроля учетных Записей](../media/How-User-Account-Control-Works/UACArchitecture.gif)

Чтобы лучше понять назначение каждого компонента, рассмотрите таблицу ниже.

|Компонент|Описание|
|-------|--------|
|**Пользователь**||
|Пользователь выполняет операции, требующие привилегий|Если операция изменения файловой системы или реестра, называется виртуализации. Все операции вызов ShellExecute.|
|ShellExecute|ShellExecute вызов CreateProcess. ShellExecute выглядит сообщение об ошибке ERROR_ELEVATION_REQUIRED из CreateProcess. Если он получает сообщение об ошибке, ShellExecute вызывает службу данных приложений при попытке выполнить запрошенную задачу с помощью строки с повышенными привилегиями.|
|CreateProcess|Если приложению требуется повышение прав, CreateProcess отклоняет вызова с ERROR_ELEVATION_REQUIRED.|
|**Системы**||
|Служба сведений о приложении|Системная служба, позволяющая запускать приложения, для которых требуются повышенные привилегии или права пользователя для выполнения, например локальные задачи администрирования и приложений, требующих более высокого уровня целостности. Сведения о приложении служба позволяет запускать такие приложения путем создания нового процесса приложения с маркером полного доступа административного пользователя в, когда требуется повышение прав и (в зависимости от групповой политики) согласие задается для этого пользователя.|
|Повышение привилегий для установки ActiveX|Если не установить ActiveX, система будет проверять уровень ползунка контроля учетных Записей. Если установить ActiveX **контроль учетных записей пользователей: переключение к безопасному рабочему столу при выполнении запроса на повышение прав** установлен параметр групповой политики.|
|Проверьте уровень ползунка контроля учетных Записей|Контроль учетных Записей теперь имеет четыре уровня уведомлений можно выбрать, а также ползунок, применяемый для выбора уровня уведомлений.<br /><br /><ul><li>Высокий<br /><br />    Если ползунок установлен в значение **всегда уведомлять**, система проверяет, включена ли безопасный рабочий стол.</li><li>Средний<br /><br />    Если ползунок установлен в значение **по умолчанию — Уведомлять только при попытках программ внести изменения в компьютер**, **контроль учетных записей: повышение прав только для подписанных и проверенных исполняемых файлов** установлен параметр политики:<br /><br /><ul><li>Если этот параметр политики включен, перед тем, как он будет разрешен его запуск утверждение пути сертификации инфраструктуры открытых ключей (PKI) применяется для конкретного исполняемого файла.</li><li>Если параметр политики не включен (по умолчанию), перед тем, как будет разрешено выполнение данного исполняемого файла утверждение пути сертификации PKI не применяется. **Контроль учетных записей пользователей: переключение к безопасному рабочему столу при выполнении запроса на повышение прав** установлен параметр групповой политики.</li></ul></li><li>Низкий<br /><br />    Если ползунок установлен в значение **Уведомлять только при попытках программ внести изменения в компьютер (не затемнять рабочий стол)**, вызывается CreateProcess.</li><li>Никогда не уведомлять<br /><br />    Если ползунок установлен в значение **никогда не уведомлять при**, контроль учетных Записей будет никогда не уведомлять пользователя при попытке установки программы или при его попытке внесения изменений на компьютере. **Важно:** этот параметр не рекомендуется. Этот параметр не отличается от параметра **контроль учетных записей: поведение запроса на повышение прав для администраторов в режиме одобрения администратором** параметр политики, чтобы **повышение без запроса**.</li></ul>|
|Включить безопасный рабочий стол|**Контроль учетных записей пользователей: переключение к безопасному рабочему столу при выполнении запроса на повышение прав** установлен параметр политики:<br /><br />— Если включен безопасный рабочий стол, все запросы повышения привилегий перейдите к безопасному рабочему столу, независимо от параметров политики вывода запросов для администраторов и обычных пользователей.<br />-Если безопасный рабочий стол не включена, все запросы повышения привилегий перейдите на рабочем столе интерактивного пользователя и используются параметры пользователя для администраторов и обычных пользователей.|
|CreateProcess|CreateProcess вызывает AppCompat, Fusion и обнаружение установщика для оценки, требуется ли приложению повышение прав. Затем исполняемый файл проверяется для определения запрашиваемого уровня выполнения, который хранится в манифесте приложения для исполняемого файла. CreateProcess завершается сбоем, если запрошенный уровень выполнения указанной в манифесте не соответствует маркер доступа и возвращает сообщение об ошибке (ERROR_ELEVATION_REQUIRED) ShellExecute. |
|Совместимость приложений|База данных AppCompat сохраняет информацию в записи исправление совместимости приложения для приложения.|
|Fusion|База данных Fusion хранит информацию из манифеста приложения, которые описывают приложения. Чтобы добавить новое поле уровня выполнения обновления манифеста схемы.|
|Обнаружение установщика|Обнаружения установщика служит исполняемые файлы установки, благодаря чему можно избежать установки выполняется без ведома и согласия пользователя.|
|**Ядра**||
|Виртуализация|Технология виртуализации позволяет несовместимых приложений сбой не без вмешательства пользователя или такой сбой таким образом, что не удается определить причину. Контроль учетных Записей также предоставляет виртуализацию файлов и реестра и ведения журнала для приложений, записывающих в защищенные области.|
|Файловую систему и реестр|Виртуализацию файлов и реестра пользователя перенаправляет запросы записи файла и реестра на компьютере расположений эквивалентные пользователя. Чтение запросы перенаправляются в папку виртуализированных пользователя второй сначала, а также расположение на компьютере.|

Изменяется на контроля учетных Записей Windows Server 2012 с предыдущих версий Windows. Новый ползунок никогда не отключает контроль учетных Записей полностью. Новый параметр будет:

-   Сохранить службой контроля учетных Записей.

-   Сделанные все запросы повышения прав администраторами, будут автоматически утверждены без отображения запроса UAC;

-   Автоматически отклонять все запросы на повышение прав для обычных пользователей.

> [!IMPORTANT]
> Чтобы полностью отключить контроль учетных Записей необходимо отключить политику **контроль учетных записей пользователей: все администраторы работают в режиме одобрения администратором**.

> [!WARNING]
> Специализированные приложения не будут работать в Windows Server 2012, при отключении контроля учетных Записей.

### <a name="virtualization"></a>Виртуализация
Так как системные администраторы в корпоративных средах попытка защитить системы, многие бизнес-приложения (LOB), предназначенные для использования только маркер доступа обычного пользователя. В результате администраторам ИТ не придется заменять большую часть приложений при работе с включенным контролем учетных Записей Microsoft Windows Server 2012.

 Windows Server 2012 включает технологию виртуализации файлов и реестра для приложений, которые не соответствуют UAC и в которых требуется маркер доступа администратора для правильного запуска. Виртуализация гарантирует, что даже приложения, которые не соответствуют UAC совместимы с Windows Server 2012. Когда административное приложение, несовместимое попытается выполнить запись в защищенную папку, например Program Files, контроль учетных Записей предоставляет приложению его собственное виртуализированное представление ресурса, который оно пытается изменить. Виртуализированные копирования сохраняется в профиле пользователя. Эта стратегия предполагает создание отдельной копии виртуализированного файла для каждого пользователя, запускающего несовместимое приложение.

Большинство приложений корректно работают с использованием функций виртуализации. Несмотря на то, что виртуализация позволяет большинством приложений для запуска, это временное решение проблемы и долгосрочное решение. Разработчики приложений должны изменить свои приложения, чтобы быть совместимыми с программой logo Windows Server 2012 как можно быстрее, а не полагаться на виртуализацию файлов, папок и реестра.

Виртуализация не применяется в следующих ситуациях.

1.  Виртуализация не применяется к приложениям, которые более высокого уровня, которые работают с маркером полный административный доступ.

2.  Виртуализация поддерживает только 32-разрядные приложения. 64-разрядные приложения без повышенных прав просто получают сообщение об отказе при попытке получить дескриптор (уникальный идентификатор) объекта Windows. Собственных Windows 64-разрядных приложений требуются для обеспечения совместимости с контролем учетных Записей, так и для записи данных в нужные расположения.

3.  Виртуализация отключается для приложения, если приложение содержит манифест приложения с запрошенным атрибутом уровня выполнения.

### <a name="request-execution-levels"></a>Уровни выполнения запроса
Манифест приложения представляет XML-файл, описывающий и определяющий общие и закрытые side-by-side сборки, которым приложение должно осуществлять привязку во время выполнения. В Windows Server 2012 манифест приложения включает записи для обеспечения совместимости приложений UAC. Административные приложения, содержащие запись в манифесте приложения запрашивают у пользователя разрешение на доступ к его маркеру доступа. Несмотря на то, что запись в манифесте приложения отсутствует, большинство административных приложений могут выполняться без изменения с помощью исправления совместимости приложений. Исправления совместимости приложений — это записи базы данных, которые позволяют приложениям, которые не соответствуют UAC для работы с Windows Server 2012.

Все приложения, несовместимых с UAC, должны иметь запрошенный уровень выполнения включенный в манифест приложения. Если приложению требуется административный доступ к системе, маркировка запрошенный выполнения, уровень «требуется администратор» гарантирует, что система определит эту программу как административное приложение и выполняет действия, необходимые повышение прав. Запрошенные уровни выполнения определяют привилегии, требуемые для приложения.

### <a name="installer-detection-technology"></a>Технология обнаружения установщика
Программы установки — это приложения, предназначенные для развертывания программного обеспечения. Большинство программ установки записи в системных каталогах и разделы реестра. Эти расположения защищенную систему обычно доступного для записи только администратором в технология обнаружения установщика, это означает, что обычные пользователи не иметь достаточных прав доступа для установки программ. Windows Server 2012 эвристически вычисляет программы установки и учетные данные администратора запросов или утверждения администратора для запуска с правами доступа. Windows Server 2012 также эвристически определяет обновления и программы, удаление приложений. Одна из целей проектирования контроля учетных Записей — предотвратить установки выполняется без ведома пользователя и дать согласие, так как программы установки запись в защищенные области файловую систему и реестр.

Обнаружение установщика относится только к:

-   32-разрядные исполняемые файлы.

-   Приложений без запрошенным атрибутом уровня выполнения.

-   Интерактивный процессы, выполняющиеся в режиме обычного пользователя с включенным контролем учетных Записей.

До создания 32-разрядном процессе, чтобы определить, является ли установщик проверяется следующие атрибуты:

-   Имя файла содержит ключевые слова, такие как «установка», «настройки» или «обновления».

-   Управление версиями ресурсов поля содержат следующие ключевые слова: поставщика, название компании, название продукта, описание файла, исходное имя файла, внутреннее имя и имя экспорта.

-   Ключевые слова в манифесте side-by-side встроены в исполняемый файл.

-   Ключевые слова в записи конкретных StringTable связаны в исполняемый файл.

-   Основные атрибуты в данных для скрипта ресурсов связаны в исполняемый файл.

-   Существует целевых последовательности байтов в исполняемом файле.

> [!NOTE]
> Ключевые слова и последовательность байтов был получен из общих характеристик, наблюдаемыми из различных технологий установщика.

> [!NOTE]
> Контроль учетных записей: Обнаружение установки приложений и запрос для обнаружения установщика для обнаружения программы установки необходимо включить параметр политики повышение прав. Этот параметр включен по умолчанию и можно настроить локально с помощью оснастки локальной политики безопасности (Secpol.msc) или настроен для домена, OU или определенных групп с помощью групповой политики (Gpedit.msc).


